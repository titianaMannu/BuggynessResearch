{"sha":"5d863b858e01e06aa5dd33d9c6cc7c71494d20ff","node_id":"MDQ6QmxvYjIwNjM2NDo1ZDg2M2I4NThlMDFlMDZhYTVkZDMzZDljNmNjN2M3MTQ5NGQyMGZm","size":109451,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5d863b858e01e06aa5dd33d9c6cc7c71494d20ff","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk5vdFNlcmlhbGl6\nYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXRTdHJl\nYW07CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1dDsKaW1wb3J0IGphdmEu\naW8uT2JqZWN0T3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5TZXJpYWxp\nemFibGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRp\nbC5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5U\naW1lWm9uZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJp\nbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5K\nUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVu\naGFuY2UuRHluYW1pY1BlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5lbmhhbmNlLkZpZWxkTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLk1hbmFnZWRJbnN0YW5jZVByb3Zp\nZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdp\nc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNp\nc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhh\nbmNlLlJlZGVmaW5pdGlvbkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudE1hbmFnZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZldGNoR3JvdXA7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVXBkYXRlU3RyYXRlZ2llczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZVN0cmF0ZWdpZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5BcHBsaWNhdGlvbklk\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkV4Y2VwdGlvbnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnZhbGlkU3Rh\ndGVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5P\nYmplY3ROb3RGb3VuZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlByb3h5TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9yOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKaW1wb3J0IHNl\ncnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIEltcGxlbWVudGF0aW9uIG9mIHRo\nZSB7QGxpbmsgT3BlbkpQQVN0YXRlTWFuYWdlcn0gaW50ZXJmYWNlIGZvciB1\nc2UKICogd2l0aCB0aGlzIHJ1bnRpbWUuIEVhY2ggc3RhdGUgbWFuYWdlciBt\nYW5hZ2VzIHRoZSBzdGF0ZSBvZiBhIHNpbmdsZQogKiBwZXJzaXN0ZW5jZSBj\nYXBhYmxlIGluc3RhbmNlLiBUaGUgc3RhdGUgbWFuYWdlciBpcyBhbHNvIHJl\nc3BvbnNpYmxlIGZvcgogKiBhbGwgY29tbXVuaWNhdGlvbnMgYWJvdXQgdGhl\nIGluc3RhbmNlIHRvIHRoZSB7QGxpbmsgU3RvcmVNYW5hZ2VyfS4KICogIFRo\nZSBzdGF0ZSBtYW5hZ2VyIHVzZXMgdGhlIFN0YXRlIHBhdHRlcm4gaW4gYm90\naCBpdHMgaW50ZXJhY3Rpb24gd2l0aAogKiB0aGUgZ292ZXJuZWQgaW5zdGFu\nY2UgYW5kIGl0cyBpbnRlcmFjdGlvbiB3aXRoIHRoZSBicm9rZXIuCiAqIElu\nIGl0cyBpbnRlcmFjdGlvbnMgd2l0aCB0aGUgcGVyc2lzdGVuY2UgY2FwYWJs\nZSBpbnN0YW5jZSwgaXQgdXNlcyB0aGUKICoge0BsaW5rIEZpZWxkTWFuYWdl\ncn0gaW50ZXJmYWNlLiBTaW1pbGFybHksIHdoZW4gaW50ZXJhY3Rpbmcgd2l0\naCB0aGUKICogYnJva2VyLCBpdCB1c2VzIHRoZSB7QGxpbmsgUENTdGF0ZX0g\nc2luZ2xldG9uIHRoYXQgcmVwcmVzZW50cwogKiB0aGUgY3VycmVudCBsaWZl\nY3ljbGUgc3RhdGUgb2YgdGhlIGluc3RhbmNlLgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFN0YXRlTWFuYWdlckltcGwKICAg\nIGltcGxlbWVudHMgT3BlbkpQQVN0YXRlTWFuYWdlciwgU2VyaWFsaXphYmxl\nIHsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBMT0FEX0ZHUyA9IDA7\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBMT0FEX0FMTCA9IDE7CiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBMT0FEX1NFUklBTElaRSA9IDI7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfU0FWRSA9IDIg\nPDwgMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0RFUkVG\nID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdf\nTE9BREVEID0gMiA8PCAyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50\nIEZMQUdfUkVBRF9MT0NLRUQgPSAyIDw8IDM7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19XUklURV9MT0NLRUQgPSAyIDw8IDQ7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19PSURfQVNTSUdORUQgPSAy\nIDw8IDU7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19MT0FE\nSU5HID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfUFJFX0RFTEVUSU5HID0gMiA8PCA3OwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfRkxVU0hFRCA9IDIgPDwgODsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX1BSRV9GTFVTSEVEID0gMiA8PCA5Owog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfRkxVU0hFRF9ESVJU\nWSA9IDIgPDwgMTA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxB\nR19JTVBMX0NBQ0hFID0gMiA8PCAxMTsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX0lOVkVSU0VTID0gMiA8PCAxMjsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX05PX1VOUFJPWFkgPSAyIDw8IDEzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfVkVSU0lPTl9DSEVD\nSyA9IDIgPDwgMTQ7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxB\nR19WRVJTSU9OX1VQREFURSA9IDIgPDwgMTU7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19ERVRBQ0hJTkcgPSAyIDw8IDE2OwoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVy\nLmZvclBhY2thZ2UKICAgICAgICAoU3RhdGVNYW5hZ2VySW1wbC5jbGFzcyk7\nCgogICAgLy8gaW5mb3JtYXRpb24gYWJvdXQgdGhlIGluc3RhbmNlCiAgICBw\ncml2YXRlIHRyYW5zaWVudCBQZXJzaXN0ZW5jZUNhcGFibGUgX3BjID0gbnVs\nbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IENsYXNzTWV0YURhdGEgX21ldGEg\nPSBudWxsOwogICAgcHJpdmF0ZSBCaXRTZXQgX2xvYWRlZCA9IG51bGw7CiAg\nICBwcml2YXRlIEJpdFNldCBfZGlydHkgPSBudWxsOwogICAgcHJpdmF0ZSBC\naXRTZXQgX2ZsdXNoID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9mbGFncyA9\nIDA7CgogICAgLy8gaWQgaXMgdGhlIHN0YXRlIG1hbmFnZXIgaWRlbnRpdHk7\nIG9pZCBpcyB0aGUgcGVyc2lzdGVudCBpZGVudGl0eS4gIG9pZAogICAgLy8g\nbWF5IGJlIG51bGwgZm9yIGVtYmVkZGVkIGFuZCB0cmFuc2llbnQtdHJhbnNh\nY3Rpb25hbCBvYmplY3RzIG9yIG5ldwogICAgLy8gaW5zdGFuY2VzIHRoYXQg\naGF2ZW4ndCBiZWVuIGFzc2lnbmVkIGFuIG9pZC4gIGlkIGlzIHJlYXNzaWdu\nZWQgdG8gb2lkCiAgICAvLyBvbiBzdWNjZXNzZnVsIG9pZCBhc3NpZ25tZW50\nIChvciBmbHVzaCBjb21wbGV0aW9uIGlmIGFzc2lnbm1lbnQgaXMKICAgIC8v\nIGR1cmluZyBmbHVzaCkKICAgIHByaXZhdGUgT2JqZWN0IF9pZCA9IG51bGw7\nCiAgICBwcml2YXRlIE9iamVjdCBfb2lkID0gbnVsbDsKCiAgICAvLyB0aGUg\nbWFuYWdpbmcgcGVyc2lzdGVuY2UgbWFuYWdlciBhbmQgbGlmZWN5Y2xlIHN0\nYXRlCiAgICBwcml2YXRlIHRyYW5zaWVudCBCcm9rZXJJbXBsIF9icm9rZXI7\nIC8vIHRoaXMgaXMgc2VyaWFsaXplZCBzcGVjaWFsbHkKICAgIHByaXZhdGUg\nUENTdGF0ZSBfc3RhdGUgPSBQQ1N0YXRlLlRSQU5TSUVOVDsKCiAgICAvLyB0\naGUgY3VycmVudCBhbmQgbGFzdCBsb2FkZWQgdmVyc2lvbiBpbmRpY2F0b3Jz\nLCBhbmQgdGhlIGxvY2sgb2JqZWN0CiAgICBwcml2YXRlIE9iamVjdCBfdmVy\nc2lvbiA9IG51bGw7CiAgICBwcml2YXRlIE9iamVjdCBfbG9hZFZlcnNpb24g\nPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3QgX2xvY2sgPSBudWxsOwogICAg\ncHJpdmF0ZSBpbnQgX3JlYWRMb2NrTGV2ZWwgPSAtMTsKICAgIHByaXZhdGUg\naW50IF93cml0ZUxvY2tMZXZlbCA9IC0xOwoKICAgIC8vIGRlbGVnYXRlcyB3\naGVuIHByb3ZpZGluZy9yZXBsYWNpbmcgaW5zdGFuY2UgZGF0YQogICAgcHJp\ndmF0ZSBTaW5nbGVGaWVsZE1hbmFnZXIgX3NpbmdsZSA9IG51bGw7CiAgICBw\ncml2YXRlIFNhdmVGaWVsZE1hbmFnZXIgX3NhdmVkID0gbnVsbDsKICAgIHBy\naXZhdGUgRmllbGRNYW5hZ2VyIF9mbSA9IG51bGw7CgogICAgLy8gaW1wbGRh\ndGE7IGZpZWxkIGltcGxkYXRhIGFuZCBpbnRlcm1lZGlhdGUgZGF0YSBzaGFy\nZSB0aGUgc2FtZSBhcnJheQogICAgcHJpdmF0ZSBPYmplY3QgX2ltcGwgPSBu\ndWxsOwogICAgcHJpdmF0ZSBPYmplY3RbXSBfZmllbGRJbXBsID0gbnVsbDsK\nCiAgICAvLyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgb3duZXIgb2YgdGhpcyBp\nbnN0YW5jZSwgaWYgaXQgaXMgZW1iZWRkZWQKICAgIHByaXZhdGUgU3RhdGVN\nYW5hZ2VySW1wbCBfb3duZXIgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX293\nbmVySW5kZXggPSAtMTsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBz\ndXBwbHkgaWQsIHR5cGUgbWV0YWRhdGEsIGFuZCBvd25pbmcgcGVyc2lzdGVu\nY2UgbWFuYWdlci4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdl\nckltcGwoT2JqZWN0IGlkLCBDbGFzc01ldGFEYXRhIG1ldGEsIAogICAgICAg\nIEJyb2tlckltcGwgYnJva2VyKSB7CiAgICAgICAgX2lkID0gaWQ7CiAgICAg\nICAgX21ldGEgPSBtZXRhOwogICAgICAgIF9icm9rZXIgPSBicm9rZXI7CiAg\nICAgICAgX3NpbmdsZSA9IG5ldyBTaW5nbGVGaWVsZE1hbmFnZXIodGhpcywg\nYnJva2VyKTsKCiAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgp\nID09IENsYXNzTWV0YURhdGEuSURfVU5LTk9XTikKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93bmlk\nIiwgX21ldGEpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgb3du\naW5nIHN0YXRlIGFuZCBmaWVsZCBpZiB0aGlzIGlzIGFuIGVtYmVkZGVkIGlu\nc3RhbmNlLgogICAgICovCiAgICB2b2lkIHNldE93bmVyKFN0YXRlTWFuYWdl\nckltcGwgb3duZXIsIFZhbHVlTWV0YURhdGEgb3duZXJNZXRhKSB7CiAgICAg\nICAgX293bmVyID0gb3duZXI7CiAgICAgICAgX293bmVySW5kZXggPSBvd25l\nck1ldGEuZ2V0RmllbGRNZXRhRGF0YSgpLmdldEluZGV4KCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgc3RhdGUgbWFuYWdlciBpcyBp\nbiB0aGUgbWlkZGxlIG9mIGEgbG9hZC4KICAgICAqLwogICAgYm9vbGVhbiBp\nc0xvYWRpbmcoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0xP\nQURJTkcpID4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhp\ncyBzdGF0ZSBtYW5hZ2VyIGlzIGluIHRoZSBtaWRkbGUgb2YgYSBsb2FkIGlu\naXRpYXRlZAogICAgICogYnkgb3V0c2lkZSBjb2RlOyBmb3IgYW55IGludGVy\nbmFsIG1ldGhvZHMgdGhhdCBjYXVzZSBsb2FkaW5nLCB0aGUKICAgICAqIGxv\nYWRpbmcgZmxhZyBpcyBzZXQgYXV0b21hdGljYWxseS4KICAgICAqLwogICAg\ndm9pZCBzZXRMb2FkaW5nKGJvb2xlYW4gbG9hZGluZykgewogICAgICAgIGlm\nIChsb2FkaW5nKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19MT0FESU5H\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0xP\nQURJTkc7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgb3IgcmVzZXQgdGhl\nIGxpZmVjeWNsZSBzdGF0ZSBvZiB0aGUgbWFuYWdlZCBpbnN0YW5jZS4gSWYg\ndGhlCiAgICAgKiB0cmFuc2FjdGlvbmFsIHN0YXRlIG9mIHRoZSBpbnN0YW5j\nZSBjaGFuZ2VzLCBpdCB3aWxsIGJlIGVubGlzdGVkLwogICAgICogZGVsaXN0\nZWQgZnJvbSB0aGUgY3VycmVudCB0cmFuc2FjdGlvbiBhcyBuZWNlc3Nhcnku\nIFRoZSBnaXZlbgogICAgICogc3RhdGUgd2lsbCBiZSBpbml0aWFsaXplZCBh\nZnRlciBiZWluZyBzZXQuIElmIHRoZSBnaXZlbiBzdGF0ZQogICAgICogaXMg\ndGhlIHNhbWUgYXMgdGhlIGN1cnJlbnQgc3RhdGUsIHRoaXMgbWV0aG9kIHdp\nbGwgaGF2ZSBubyBlZmZlY3QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBz\nZXRQQ1N0YXRlKFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICBpZiAoX3N0YXRl\nID09IHN0YXRlKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBub3RpZnkgdGhlIHN0\nb3JlIG1hbmFnZXIgdGhhdCB3ZSdyZSBjaGFuZ2luZyBzdGF0ZXM7IGNhbiB2\nZXRvCiAgICAgICAgICAgIF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuYmVm\nb3JlU3RhdGVDaGFuZ2UodGhpcywgX3N0YXRlLCBzdGF0ZSk7CgogICAgICAg\nICAgICAvLyByZXBsYWNlIHN0YXRlCiAgICAgICAgICAgIGJvb2xlYW4gd2Fz\nRGVsZXRlZCA9IF9zdGF0ZS5pc0RlbGV0ZWQoKTsKICAgICAgICAgICAgYm9v\nbGVhbiB3YXNEaXJ0eSA9IF9zdGF0ZS5pc0RpcnR5KCk7CiAgICAgICAgICAg\nIGJvb2xlYW4gd2FzUGVuZGluZyA9IF9zdGF0ZS5pc1BlbmRpbmdUcmFuc2Fj\ndGlvbmFsKCk7CiAgICAgICAgICAgIF9zdGF0ZSA9IHN0YXRlOwoKICAgICAg\nICAgICAgLy8gZW5saXN0L2RlbGlzdCBmcm9tIHRyYW5zYWN0aW9uCiAgICAg\nICAgICAgIGlmIChfc3RhdGUuaXNUcmFuc2FjdGlvbmFsKCkpIHsKICAgICAg\nICAgICAgICAgIF9icm9rZXIuYWRkVG9UcmFuc2FjdGlvbih0aGlzKTsKICAg\nICAgICAgICAgICAgIGlmIChfc3RhdGUuaXNEZWxldGVkKCkgIT0gd2FzRGVs\nZXRlZCkKICAgICAgICAgICAgICAgICAgICBfYnJva2VyLnNldERpcnR5KHRo\naXMsICF3YXNEaXJ0eSB8fCBpc0ZsdXNoZWQoKSk7CiAgICAgICAgICAgICAg\nICBlbHNlIGlmIChfc3RhdGUuaXNEaXJ0eSgpICYmICF3YXNEaXJ0eSkKICAg\nICAgICAgICAgICAgICAgICBfYnJva2VyLnNldERpcnR5KHRoaXMsIHRydWUp\nOwogICAgICAgICAgICB9IGVsc2UgaWYgKCF3YXNQZW5kaW5nICYmIF9zdGF0\nZS5pc1BlbmRpbmdUcmFuc2FjdGlvbmFsKCkpCiAgICAgICAgICAgICAgICBf\nYnJva2VyLmFkZFRvUGVuZGluZ1RyYW5zYWN0aW9uKHRoaXMpOwogICAgICAg\nICAgICBlbHNlIGlmICh3YXNQZW5kaW5nICYmICFfc3RhdGUuaXNQZW5kaW5n\nVHJhbnNhY3Rpb25hbCgpKQogICAgICAgICAgICAgICAgX2Jyb2tlci5yZW1v\ndmVGcm9tUGVuZGluZ1RyYW5zYWN0aW9uKHRoaXMpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBfYnJva2VyLnJlbW92ZUZyb21UcmFuc2Fj\ndGlvbih0aGlzKTsKCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUKICAgICAg\nICAgICAgX3N0YXRlLmluaXRpYWxpemUodGhpcyk7CiAgICAgICAgICAgIGlm\nIChfc3RhdGUuaXNEZWxldGVkKCkgJiYgIXdhc0RlbGV0ZWQpCiAgICAgICAg\nICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQUZU\nRVJfREVMRVRFKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6\nZShDbGFzcyBjbHMsIFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICAvLyBjaGVj\nayB0byBzZWUgaWYgb3VyIGN1cnJlbnQgb2JqZWN0IGlkIGluc3RhbmNlIGlz\nIHRoZQogICAgICAgIC8vIGNvcnJlY3QgaWQgdHlwZSBmb3IgdGhlIHNwZWNp\nZmllZCBjbGFzczsgdGhpcyBpcyBmb3IgY2FzZXMKICAgICAgICAvLyB3aGVu\nIHdlIGhhdmUgYW4gYXBwbGljYXRpb24gaWQgaGllcmFyY2h5IGFuZCB3ZSBo\nYWQgc2V0IHRoZQogICAgICAgIC8vIG1ldGFkYXRhIHRvIGEgc3VwZXJjbGFz\ncyBpZCAtLSB0aGUgc3ViY2xhc3MnIGlkIG1heSBiZSBhCiAgICAgICAgLy8g\nZGlmZmVyZW50IGNsYXNzLCBzbyB3ZSBuZWVkIHRvIHJlc2V0IGl0CiAgICAg\nICAgaWYgKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSAhPSBjbHMpIHsKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdWIgPSBfbWV0YS5nZXRSZXBvc2l0\nb3J5KCkuZ2V0TWV0YURhdGEKICAgICAgICAgICAgICAgIChjbHMsIF9icm9r\nZXIuZ2V0Q2xhc3NMb2FkZXIoKSwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChf\nb2lkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChfbWV0YS5nZXRJ\nZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRSkK\nICAgICAgICAgICAgICAgICAgICBfb2lkID0gX2Jyb2tlci5nZXRTdG9yZU1h\nbmFnZXIoKS5jb3B5RGF0YVN0b3JlSWQoX29pZCwKICAgICAgICAgICAgICAg\nICAgICAgICAgc3ViKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9tZXRh\nLmlzT3BlbkpQQUlkZW50aXR5KCkpCiAgICAgICAgICAgICAgICAgICAgX29p\nZCA9IEFwcGxpY2F0aW9uSWRzLmNvcHkoX29pZCwgc3ViKTsKICAgICAgICAg\nICAgICAgIGVsc2UgaWYgKHN1Yi5nZXRPYmplY3RJZFR5cGUoKSAhPSBfbWV0\nYS5nZXRPYmplY3RJZFR5cGUoKSkgewogICAgICAgICAgICAgICAgICAgIE9i\namVjdFtdIHBrRmllbGRzID0gQXBwbGljYXRpb25JZHMudG9QS1ZhbHVlcyhf\nb2lkLCBfbWV0YSk7CiAgICAgICAgICAgICAgICAgICAgX29pZCA9IEFwcGxp\nY2F0aW9uSWRzLmZyb21QS1ZhbHVlcyhwa0ZpZWxkcywgc3ViKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfbWV0YSA9\nIHN1YjsKICAgICAgICB9CgogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBp\nbnN0ID0gUENSZWdpc3RyeS5uZXdJbnN0YW5jZShjbHMsIHRoaXMsIF9vaWQs\nIHRydWUpOwogICAgICAgIGlmIChpbnN0ID09IG51bGwpIHsKICAgICAgICAg\nICAgLy8gdGhlIGluc3RhbmNlIHdhcyBudWxsOiBjaGVjayB0byBzZWUgaWYg\ndGhlIGluc3RhbmNlIGlzCiAgICAgICAgICAgIC8vIGFic3RyYWN0IChhcyBj\nYW4gc29tZXRpbWVzIGJlIHRoZSBjYXNlIHdoZW4gdGhlCiAgICAgICAgICAg\nIC8vIGNsYXNzIGRpc2NyaW1pbmF0b3Igc3RyYXRlZ3kgaXMgbm90IGNvbmZp\nZ3VyZWQgY29ycmVjdGx5KQogICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNB\nYnN0cmFjdChjbHMuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImluc3RhbnRpYXRl\nLWFic3RyYWN0IiwKICAgICAgICAgICAgICAgICAgICBjbHMuZ2V0TmFtZSgp\nLCBfb2lkKSk7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2Vw\ndGlvbigpOwogICAgICAgIH0KCiAgICAgICAgaW5pdGlhbGl6ZShpbnN0LCBz\ndGF0ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIHdpdGgg\ndGhlIGdpdmVuIGluc3RhbmNlIGFuZCBzdGF0ZS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgaW5pdGlhbGl6ZShQZXJzaXN0ZW5jZUNhcGFibGUgcGMs\nIFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICBpZiAocGMgPT0gbnVsbCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImlu\naXQtbnVsbC1wYyIsIF9tZXRhKSk7CiAgICAgICAgaWYgKHBjLnBjR2V0U3Rh\ndGVNYW5hZ2VyKCkgIT0gbnVsbCAmJiBwYy5wY0dldFN0YXRlTWFuYWdlcigp\nICE9IHRoaXMpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJpbml0LXNtLXBjIiwKICAgICAgICAgICAgICAgIEV4Y2Vw\ndGlvbnMudG9TdHJpbmcocGMpKSkuc2V0RmFpbGVkT2JqZWN0KHBjKTsKICAg\nICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIodGhpcyk7CgogICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAg\nICAgICAgX2xvYWRlZCA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAg\nICAgIF9mbHVzaCA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAgICAg\nIF9kaXJ0eSA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwoKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgLy8gbWFyayBwcmltYXJ5IGtleSBhbmQgbm9uLXBlcnNpc3RlbnQg\nZmllbGRzIGFzIGxvYWRlZAogICAgICAgICAgICBpZiAoZm1kc1tpXS5pc1By\naW1hcnlLZXkoKQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRNYW5h\nZ2VtZW50KCkgIT0gZm1kc1tpXS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAg\nICAgICAgICAgIF9sb2FkZWQuc2V0KGkpOwoKICAgICAgICAgICAgLy8gcmVj\nb3JkIHdoZXRoZXIgdGhlcmUgYXJlIGFueSBtYW5hZ2VkIGludmVyc2UgZmll\nbGRzCiAgICAgICAgICAgIGlmIChfYnJva2VyLmdldEludmVyc2VNYW5hZ2Vy\nKCkgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgZm1kc1tpXS5nZXRJbnZl\ncnNlTWV0YURhdGFzKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX0lOVkVSU0VTOwogICAgICAgIH0KCiAgICAgICAgcGMu\ncGNTZXREZXRhY2hlZFN0YXRlKG51bGwpOwogICAgICAgIF9wYyA9IHBjOwoK\nICAgICAgICBpZiAoX29pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkKICAgICAg\nICAgICAgKChPcGVuSlBBSWQpIF9vaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5\ncGUoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKCiAgICAgICAgLy8gaW5p\ndGlhbGl6ZSBvdXIgc3RhdGUgYW5kIGFkZCBvdXJzZWx2ZXMgdG8gdGhlIGJy\nb2tlcidzIGNhY2hlCiAgICAgICAgc2V0UENTdGF0ZShzdGF0ZSk7CiAgICAg\nICAgX2Jyb2tlci5zZXRTdGF0ZU1hbmFnZXIoX2lkLCB0aGlzLCBCcm9rZXJJ\nbXBsLlNUQVRVU19JTklUKTsKICAgICAgICBpZiAoc3RhdGUgPT0gUENTdGF0\nZS5QTkVXKQogICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5\nY2xlRXZlbnQuQUZURVJfUEVSU0lTVCk7CgogICAgICAgIC8vIGlmIHRoaXMg\naXMgYSBub24tdHJhY2tpbmcgUEMsIGFkZCBhIGhhcmQgcmVmIHRvIHRoZSBh\ncHByb3ByaWF0ZSBkYXRhCiAgICAgICAgLy8gc2V0cyBhbmQgZ2l2ZSBpdCBh\nbiBvcHBvcnR1bml0eSB0byBtYWtlIGEgc3RhdGUgc25hcHNob3QuCiAgICAg\nICAgaWYgKCFpc0ludGVyY2VwdGluZygpKSB7CiAgICAgICAgICAgIHNhdmVG\naWVsZHModHJ1ZSk7CiAgICAgICAgICAgIGlmICghaXNOZXcoKSkKICAgICAg\nICAgICAgICAgIFJlZGVmaW5pdGlvbkhlbHBlci5hc3NpZ25MYXp5TG9hZFBy\nb3hpZXModGhpcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciBvciBub3QgZGF0YSBhY2Nlc3MgaW4gdGhpcyBpbnN0YW5jZSBp\ncyBpbnRlcmNlcHRlZC4gVGhpcyBkaWZmZXJzCiAgICAgKiBmcm9tIHtAbGlu\nayBDbGFzc01ldGFEYXRhI2lzSW50ZXJjZXB0aW5nKCl9IGluIHRoYXQgaXQg\nY2hlY2tzIGZvcgogICAgICogcHJvcGVydHkgYWNjZXNzICsgc3ViY2xhc3Np\nbmcgaW4gYWRkaXRpb24gdG8gdGhlIHJlZGVmaW5pdGlvbiAvCiAgICAgKiBl\nbmhhbmNlbWVudCBjaGVja3MuCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4w\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzSW50ZXJjZXB0aW5nKCkg\newogICAgICAgIGlmIChnZXRNZXRhRGF0YSgpLmlzSW50ZXJjZXB0aW5nKCkp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChnZXRNZXRh\nRGF0YSgpLmdldEFjY2Vzc1R5cGUoKSAhPSBDbGFzc01ldGFEYXRhLkFDQ0VT\nU19GSUVMRAogICAgICAgICAgICAmJiBfcGMgaW5zdGFuY2VvZiBEeW5hbWlj\nUGVyc2lzdGVuY2VDYXBhYmxlKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nRmlyZSB0aGUgZ2l2ZW4gbGlmZWN5Y2xlIGV2ZW50IHRvIGFsbCBsaXN0ZW5l\ncnMuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBmaXJlTGlmZWN5Y2xl\nRXZlbnQoaW50IHR5cGUpIHsKICAgICAgICByZXR1cm4gX2Jyb2tlci5maXJl\nTGlmZWN5Y2xlRXZlbnQoZ2V0TWFuYWdlZEluc3RhbmNlKCksIG51bGwsCiAg\nICAgICAgICAgIF9tZXRhLCB0eXBlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBsb2FkKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGxv\nYWQoZmV0Y2gsIExPQURfRkdTLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBzdGF0ZSBvZiB0aGlzIGluc3Rh\nbmNlIGJhc2VkIG9uIHRoZSBnaXZlbiBmZXRjaCBjb25maWd1cmF0aW9uCiAg\nICAgKiBhbmQgbG9hZCBtb2RlLiBSZXR1cm4gdHJ1ZSBpZiBhbnkgZGF0YSB3\nYXMgbG9hZGVkLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBib29sZWFuIGxvYWQoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBp\nbnQgbG9hZE1vZGUsCiAgICAgICAgQml0U2V0IGV4Y2x1ZGUsIE9iamVjdCBz\nZGF0YSwgYm9vbGVhbiBmb3JXcml0ZSkgewogICAgICAgIGlmICghZm9yV3Jp\ndGUgJiYgKCFpc1BlcnNpc3RlbnQoKSB8fCBpc05ldygpIHx8IGlzRGVsZXRl\nZCgpKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBp\nZiBhbnkgZmllbGRzIGJlaW5nIGxvYWRlZCwgZG8gc3RhdGUgdHJhbnNpdGlv\nbnMgZm9yIHJlYWQKICAgICAgICBCaXRTZXQgZmllbGRzID0gZ2V0VW5sb2Fk\nZWRJbnRlcm5hbChmZXRjaCwgbG9hZE1vZGUsIGV4Y2x1ZGUpOwogICAgICAg\nIGJvb2xlYW4gYWN0aXZlID0gX2Jyb2tlci5pc0FjdGl2ZSgpOwogICAgICAg\nIGlmICghZm9yV3JpdGUgJiYgZmllbGRzICE9IG51bGwpCiAgICAgICAgICAg\nIGJlZm9yZVJlYWQoLTEpOwoKICAgICAgICAvLyBjYWxsIGxvYWQgZXZlbiBp\nZiBubyBmaWVsZHMgYXJlIGJlaW5nIGxvYWRlZCwgYmVjYXVzZSBpdCB0YWtl\ncwogICAgICAgIC8vIGNhcmUgb2YgY2hlY2tpbmcgaWYgdGhlIERGRyBpcyBs\nb2FkZWQsIG1ha2luZyBzdXJlIHZlcnNpb24gaW5mbwogICAgICAgIC8vIGlz\nIGxvYWRlZCwgZXRjCiAgICAgICAgaW50IGxvY2tMZXZlbCA9IGNhbGN1bGF0\nZUxvY2tMZXZlbChhY3RpdmUsIGZvcldyaXRlLCBmZXRjaCk7CiAgICAgICAg\nYm9vbGVhbiByZXQgPSBsb2FkRmllbGRzKGZpZWxkcywgZmV0Y2gsIGxvY2tM\nZXZlbCwgc2RhdGEpOwogICAgICAgIG9idGFpbkxvY2tzKGFjdGl2ZSwgZm9y\nV3JpdGUsIGxvY2tMZXZlbCwgZmV0Y2gsIHNkYXRhKTsKICAgICAgICByZXR1\ncm4gcmV0OwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0TWFuYWdlZElu\nc3RhbmNlKCkgewogICAgICAgIGlmIChfcGMgaW5zdGFuY2VvZiBNYW5hZ2Vk\nSW5zdGFuY2VQcm92aWRlcikKICAgICAgICAgICAgcmV0dXJuICgoTWFuYWdl\nZEluc3RhbmNlUHJvdmlkZXIpIF9wYykuZ2V0TWFuYWdlZEluc3RhbmNlKCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gX3BjOwogICAgfQoK\nICAgIHB1YmxpYyBQZXJzaXN0ZW5jZUNhcGFibGUgZ2V0UGVyc2lzdGVuY2VD\nYXBhYmxlKCkgewogICAgICAgIHJldHVybiBfcGM7CiAgICB9CgogICAgcHVi\nbGljIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEoKSB7CiAgICAgICAgcmV0\ndXJuIF9tZXRhOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIGdldE93bmVyKCkgewogICAgICAgIHJldHVybiBfb3duZXI7CiAgICB9\nCgogICAgcHVibGljIGludCBnZXRPd25lckluZGV4KCkgewogICAgICAgIHJl\ndHVybiBfb3duZXJJbmRleDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0VtYmVkZGVkKCkgewogICAgICAgIHJldHVybiBfb3duZXIgIT0gbnVsbDsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ZsdXNoZWQoKSB7CiAgICAg\nICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0ZMVVNIRUQpID4gMDsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ZsdXNoZWREaXJ0eSgpIHsKICAgICAg\nICByZXR1cm4gKF9mbGFncyAmIEZMQUdfRkxVU0hFRF9ESVJUWSkgPiAwOwog\nICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgZ2V0TG9hZGVkKCkgewogICAgICAg\nIHJldHVybiBfbG9hZGVkOwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgZ2V0\nRmx1c2hlZCgpIHsKICAgICAgICByZXR1cm4gX2ZsdXNoOwogICAgfQoKICAg\nIHB1YmxpYyBCaXRTZXQgZ2V0RGlydHkoKSB7CiAgICAgICAgcmV0dXJuIF9k\naXJ0eTsKICAgIH0KCiAgICBwdWJsaWMgQml0U2V0IGdldFVubG9hZGVkKEZl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIC8vIGNvbGxlY3Qg\nZmllbGRzIHRvIGxvYWQgZnJvbSBkYXRhIHN0b3JlIGJhc2VkIG9uIGZldGNo\nIGNvbmZpZ3VyYXRpb24KICAgICAgICBCaXRTZXQgZmllbGRzID0gZ2V0VW5s\nb2FkZWRJbnRlcm5hbChmZXRjaCwgTE9BRF9GR1MsIG51bGwpOwogICAgICAg\nIHJldHVybiAoZmllbGRzID09IG51bGwpID8gbmV3IEJpdFNldCgwKSA6IGZp\nZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIHZlcnNpb24g\nb2Yge0BsaW5rIE9wZW5KUEFTdGF0ZU1hbmFnZXIjZ2V0VW5sb2FkZWR9IHRo\nYXQgYXZvaWRzCiAgICAgKiBjcmVhdGluZyBhbiBlbXB0eSBiaXQgc2V0IGJ5\nIHJldHVybmluZyBudWxsIHdoZW4gdGhlcmUgYXJlIG5vIHVubG9hZGVkCiAg\nICAgKiBmaWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUgQml0U2V0IGdldFVu\nbG9hZGVkSW50ZXJuYWwoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQg\nbW9kZSwKICAgICAgICBCaXRTZXQgZXhjbHVkZSkgewogICAgICAgIGlmIChl\neGNsdWRlID09IFN0b3JlQ29udGV4dC5FWENMVURFX0FMTCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIEJpdFNldCBmaWVsZHMgPSBudWxs\nOwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgYm9vbGVhbiBsb2FkOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoX2xvYWRlZC5nZXQoaSkgfHwgKGV4Y2x1ZGUgIT0gbnVsbCAmJiBleGNs\ndWRlLmdldChpKSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgICAgICAgICAgY2FzZSBM\nT0FEX1NFUklBTElaRToKICAgICAgICAgICAgICAgICAgICBsb2FkID0gIWZt\nZHNbaV0uaXNUcmFuc2llbnQoKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgTE9BRF9GR1M6CiAgICAgICAgICAg\nICAgICAgICAgbG9hZCA9IGZldGNoID09IG51bGwgfHwgZmV0Y2gucmVxdWly\nZXNGZXRjaChmbWRzW2ldKSAKICAgICAgICAgICAgICAgICAgICAgICAgIT0g\nRmV0Y2hDb25maWd1cmF0aW9uLkZFVENIX05PTkU7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OiAvLyBMT0FE\nX0FMTAogICAgICAgICAgICAgICAgICAgIGxvYWQgPSB0cnVlOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBpZiAobG9hZCkgewogICAgICAgICAgICAg\nICAgaWYgKGZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGZp\nZWxkcyA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAgICAgICAgICAg\nICAgZmllbGRzLnNldChpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gZmllbGRzOwogICAgfQoKICAgIHB1YmxpYyBTdG9yZUNv\nbnRleHQgZ2V0Q29udGV4dCgpIHsKICAgICAgICByZXR1cm4gX2Jyb2tlcjsK\nICAgIH0KCiAgICAvKioKICAgICAqIE1hbmFnaW5nIGJyb2tlci4KICAgICAq\nLwogICAgQnJva2VySW1wbCBnZXRCcm9rZXIoKSB7CiAgICAgICAgcmV0dXJu\nIF9icm9rZXI7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRJZCgpIHsK\nICAgICAgICByZXR1cm4gX2lkOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3Qg\nZ2V0T2JqZWN0SWQoKSB7CiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9\nIHRoaXM7CiAgICAgICAgd2hpbGUgKHNtLmdldE93bmVyKCkgIT0gbnVsbCkK\nICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgc20uZ2V0T3du\nZXIoKTsKICAgICAgICByZXR1cm4gc20uX29pZDsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRPYmplY3RJZChPYmplY3Qgb2lkKSB7CiAgICAgICAgX29p\nZCA9IG9pZDsKICAgICAgICBpZiAoX3BjICE9IG51bGwgJiYgb2lkIGluc3Rh\nbmNlb2YgT3BlbkpQQUlkKQogICAgICAgICAgICAoKE9wZW5KUEFJZCkgb2lk\nKS5zZXRNYW5hZ2VkSW5zdGFuY2VUeXBlKF9tZXRhLmdldERlc2NyaWJlZFR5\ncGUoKSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gYXNzaWduT2JqZWN0\nSWQoYm9vbGVhbiBmbHVzaCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZXR1cm4gYXNzaWduT2JqZWN0SWQoZmx1c2gs\nIGZhbHNlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc2sgc3Rv\ncmUgbWFuYWdlciB0byBhc3NpZ24gb3VyIG9pZCwgb3B0aW9uYWxseSBmbHVz\naGluZyBhbmQKICAgICAqIG9wdGlvbmFsbHkgcmVjYWNoaW5nIG9uIHRoZSBu\nZXcgb2lkLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gYXNzaWduT2Jq\nZWN0SWQoYm9vbGVhbiBmbHVzaCwgYm9vbGVhbiBwcmVGbHVzaGluZykgewog\nICAgICAgIGlmIChfb2lkICE9IG51bGwgfHwgaXNFbWJlZGRlZCgpIHx8ICFp\nc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAg\nICAgIGlmIChfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLmFzc2lnbk9iamVj\ndElkKHRoaXMsIHByZUZsdXNoaW5nKSkgewogICAgICAgICAgICBpZiAoIXBy\nZUZsdXNoaW5nKQogICAgICAgICAgICAgICAgYXNzZXJ0T2JqZWN0SWRBc3Np\nZ25lZCh0cnVlKTsKICAgICAgICB9IGVsc2UgaWYgKGZsdXNoKQogICAgICAg\nICAgICBfYnJva2VyLmZsdXNoKCk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBNYWtlIHN1cmUgd2Ugd2VyZSBhc3NpZ25lZCBhbiBv\naWQsIGFuZCBwZXJmb3JtIGFjdGlvbnMgdG8gbWFrZSBpdAogICAgICogcGVy\nbWFuZW50LgogICAgICoKICAgICAqIEBwYXJhbSByZWNhY2hlIHdoZXRoZXIg\ndG8gcmVjYWNoZSBvdXJzZWxmIG9uIHRoZSBuZXcgb2lkCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhc3NlcnRPYmplY3RJZEFzc2lnbmVkKGJvb2xlYW4g\ncmVjYWNoZSkgewogICAgICAgIGlmICghaXNOZXcoKSB8fCBpc0RlbGV0ZWQo\nKSB8fCBpc1Byb3Zpc2lvbmFsKCkgCiAgICAgICAgICAgIHx8IChfZmxhZ3Mg\nJiBGTEFHX09JRF9BU1NJR05FRCkgIT0gMCkKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIGlmIChfb2lkID09IG51bGwpIHsKICAgICAgICAgICAgaWYg\nKF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURf\nREFUQVNUT1JFKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFs\nRXhjZXB0aW9uKEV4Y2VwdGlvbnMudG9TdHJpbmcKICAgICAgICAgICAgICAg\nICAgICAoZ2V0TWFuYWdlZEluc3RhbmNlKCkpKTsKICAgICAgICAgICAgX29p\nZCA9IEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShfcGMsIF9tZXRhKTsKICAgICAg\nICB9CgogICAgICAgIE9iamVjdCBvcmlnID0gX2lkOwogICAgICAgIF9pZCA9\nIF9vaWQ7CiAgICAgICAgaWYgKHJlY2FjaGUpIHsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIF9icm9rZXIuc2V0U3RhdGVNYW5hZ2VyKG9y\naWcsIHRoaXMsCiAgICAgICAgICAgICAgICAgICAgQnJva2VySW1wbC5TVEFU\nVVNfT0lEX0FTU0lHTik7CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIF9pZCA9IG9yaWc7CiAg\nICAgICAgICAgICAgICBfb2lkID0gbnVsbDsKICAgICAgICAgICAgICAgIHRo\ncm93IHJlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9mbGFn\ncyB8PSBGTEFHX09JRF9BU1NJR05FRDsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFzc2lnbiB0aGUgcHJvcGVyIGdlbmVyYXRlZCB2YWx1ZSB0byB0aGUgZ2l2\nZW4gZmllbGQgYmFzZWQgb24gaXRzCiAgICAgKiB2YWx1ZS1zdHJhdGVneS4K\nICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGFzc2lnbkZpZWxkKGludCBm\naWVsZCwgYm9vbGVhbiBwcmVGbHVzaGluZykgewogICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20gPSB0aGlzOwogICAgICAgIHdoaWxlIChzbS5pc0Vt\nYmVkZGVkKCkpCiAgICAgICAgICAgIHNtID0gc20uZ2V0T3duZXIoKTsKICAg\nICAgICBpZiAoIXNtLmlzTmV3KCkgfHwgc20uaXNGbHVzaGVkKCkgfHwgc20u\naXNEZWxldGVkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgLy8gc3BlY2lhbC1jYXNlIG9pZCBmaWVsZHMsIHdoaWNoIHJlcXVpcmUg\ndXMgdG8gbG9vayBpbnNpZGUgdGhlIG9pZAogICAgICAgIC8vIG9iamVjdAog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmll\nbGQpOwogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09\nIEphdmFUeXBlcy5PSUQpIHsKICAgICAgICAgICAgLy8gdHJ5IHRvIHNob3J0\nY3V0IGlmIHBvc3NpYmxlCiAgICAgICAgICAgIGlmIChfb2lkICE9IG51bGwg\nfHwgaXNFbWJlZGRlZCgpIHx8ICFpc1BlcnNpc3RlbnQoKSkKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgLy8gY2hlY2sgZW1i\nZWRkZWQgZmllbGRzIG9mIG9pZCBmb3IgdmFsdWUgc3RyYXRlZ3kgKyBkZWZh\ndWx0IHZhbHVlCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBm\nbWQuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwogICAgICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG9pZHNtID0gbnVsbDsKICAgICAg\nICAgICAgYm9vbGVhbiBhc3NpZ24gPSBmYWxzZTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7ICFhc3NpZ24gJiYgaSA8IHBrcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgaWYgKHBrc1tpXS5nZXRWYWx1ZVN0cmF0ZWd5\nKCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAob2lkc20gPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBvaWRzbSA9IG5ldyBPYmplY3RJZFN0\nYXRlTWFuYWdlcihmZXRjaE9iamVjdEZpZWxkKGZpZWxkKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgdGhpcywgZm1kKTsKICAgICAgICAgICAgICAgIGFz\nc2lnbiA9IG9pZHNtLmlzRGVmYXVsdFZhbHVlKGkpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJldHVybiBhc3NpZ24gJiYgYXNzaWduT2JqZWN0SWQo\nIXByZUZsdXNoaW5nLCBwcmVGbHVzaGluZyk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBKdXN0IHJldHVybiBpZiB0aGVyZSdzIG5vIHZhbHVlIGdlbmVyYXRp\nb24gc3RyYXRlZ3kKICAgICAgICBpZiAoZm1kLmdldFZhbHVlU3RyYXRlZ3ko\nKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIAogICAgICAgIC8vIFRocm93IGV4Y2VwdGlvbiBp\nZiBmaWVsZCBhbHJlYWR5IGhhcyBhIHZhbHVlIGFzc2lnbmVkLgogICAgICAg\nIC8vIEBHZW5lcmF0ZWRWYWx1ZSBvdmVycmlkZXMgUE9KTyBpbml0aWFsIHZh\nbHVlcyBhbmQgc2V0dGVyIG1ldGhvZHMKICAgICAgICBpZiAoIWZtZC5pc1Zh\nbHVlR2VuZXJhdGVkKCkgJiYgIWlzRGVmYXVsdFZhbHVlKGZpZWxkKSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9j\nLmdldCgKICAgICAgICAgICAgICAgICJleGlzdGluZy12YWx1ZS1vdmVycmlk\nZS1leGNlcCIsIGZtZC5nZXRGdWxsTmFtZShmYWxzZSkpKTsKCiAgICAgICAg\nLy8gZm9yIHByaW1hcnkga2V5IGZpZWxkcywgYXNzaWduIHRoZSBvYmplY3Qg\naWQgYW5kIHJlY2FjaGUgc28gdGhhdAogICAgICAgIC8vIHRvIHRoZSB1c2Vy\nLCBzbyBpdCBsb29rcyBsaWtlIHRoZSBvaWQgYWx3YXlzIG1hdGNoZXMgdGhl\nIHBrIGZpZWxkcwogICAgICAgIGlmIChmbWQuaXNQcmltYXJ5S2V5KCkgJiYg\nIWlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGFzc2lnbk9iamVj\ndElkKCFwcmVGbHVzaGluZywgcHJlRmx1c2hpbmcpOwoKICAgICAgICAvLyBm\nb3Igb3RoZXIgZmllbGRzIGp1c3QgYXNzaWduIHRoZSBmaWVsZCBvciBmbHVz\naCBpZiBuZWVkZWQKICAgICAgICBpZiAoX2Jyb2tlci5nZXRTdG9yZU1hbmFn\nZXIoKS5hc3NpZ25GaWVsZCh0aGlzLCBmaWVsZCwgcHJlRmx1c2hpbmcpKSB7\nCiAgICAgICAgICAgIGZtZC5zZXRWYWx1ZUdlbmVyYXRlZCh0cnVlKTsKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmICgh\ncHJlRmx1c2hpbmcpCiAgICAgICAgICAgIF9icm9rZXIuZmx1c2goKTsKICAg\nICAgICByZXR1cm4gIXByZUZsdXNoaW5nOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3QgZ2V0TG9jaygpIHsKICAgICAgICByZXR1cm4gX2xvY2s7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0TG9jayhPYmplY3QgbG9jaykgewogICAg\nICAgIF9sb2NrID0gbG9jazsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIF92ZXJzaW9uOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldFZlcnNpb24oT2JqZWN0IHZlcnNpb24pIHsK\nICAgICAgICBfbG9hZFZlcnNpb24gPSB2ZXJzaW9uOwogICAgICAgIGFzc2ln\nblZlcnNpb25GaWVsZCh2ZXJzaW9uKTsKICAgIH0KCiAgICBPYmplY3QgZ2V0\nTG9hZFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkVmVyc2lvbjsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROZXh0VmVyc2lvbihPYmplY3Qg\ndmVyc2lvbikgewogICAgICAgIGFzc2lnblZlcnNpb25GaWVsZCh2ZXJzaW9u\nKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYXNzaWduVmVyc2lvbkZpZWxk\nKE9iamVjdCB2ZXJzaW9uKSB7CiAgICAgICAgX3ZlcnNpb24gPSB2ZXJzaW9u\nOwogICAgICAgIEZpZWxkTWV0YURhdGEgdmZpZWxkID0gX21ldGEuZ2V0VmVy\nc2lvbkZpZWxkKCk7CiAgICAgICAgaWYgKHZmaWVsZCAhPSBudWxsKQogICAg\nICAgICAgICBzdG9yZSh2ZmllbGQuZ2V0SW5kZXgoKSwgSmF2YVR5cGVzLmNv\nbnZlcnQodmVyc2lvbiwKICAgICAgICAgICAgICAgIHZmaWVsZC5nZXRUeXBl\nQ29kZSgpKSk7CiAgICB9CgogICAgcHVibGljIFBDU3RhdGUgZ2V0UENTdGF0\nZSgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlOwogICAgfQoKICAgIHB1Ymxp\nYyBzeW5jaHJvbml6ZWQgT2JqZWN0IGdldEltcGxEYXRhKCkgewogICAgICAg\nIHJldHVybiBfaW1wbDsKICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVk\nIE9iamVjdCBzZXRJbXBsRGF0YShPYmplY3QgZGF0YSwgYm9vbGVhbiBjYWNo\nZWFibGUpIHsKICAgICAgICBPYmplY3Qgb2xkID0gX2ltcGw7CiAgICAgICAg\nX2ltcGwgPSBkYXRhOwogICAgICAgIGlmIChjYWNoZWFibGUgJiYgZGF0YSAh\nPSBudWxsKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19JTVBMX0NBQ0hF\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0lN\nUExfQ0FDSEU7CiAgICAgICAgcmV0dXJuIG9sZDsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0ltcGxEYXRhQ2FjaGVhYmxlKCkgewogICAgICAgIHJl\ndHVybiAoX2ZsYWdzICYgRkxBR19JTVBMX0NBQ0hFKSAhPSAwOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgZ2V0SW1wbERhdGEoaW50IGZpZWxkKSB7CiAg\nICAgICAgcmV0dXJuIGdldEV4dHJhRmllbGREYXRhKGZpZWxkLCB0cnVlKTsK\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHNldEltcGxEYXRhKGludCBmaWVs\nZCwgT2JqZWN0IGRhdGEpIHsKICAgICAgICByZXR1cm4gc2V0RXh0cmFGaWVs\nZERhdGEoZmllbGQsIGRhdGEsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyBz\neW5jaHJvbml6ZWQgYm9vbGVhbiBpc0ltcGxEYXRhQ2FjaGVhYmxlKGludCBm\naWVsZCkgewogICAgICAgIGlmIChfZmllbGRJbXBsID09IG51bGwgfHwgIV9s\nb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIGlmIChfbWV0YS5nZXRGaWVsZChmaWVsZCkudXNlc0ltcGxEYXRh\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIGludCBpZHggPSBfbWV0YS5nZXRFeHRyYUZpZWxkRGF0YUluZGV4KGZpZWxk\nKTsKICAgICAgICByZXR1cm4gaWR4ICE9IC0xICYmIF9maWVsZEltcGxbaWR4\nXSAhPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0SW50ZXJt\nZWRpYXRlKGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBnZXRFeHRyYUZp\nZWxkRGF0YShmaWVsZCwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldEludGVybWVkaWF0ZShpbnQgZmllbGQsIE9iamVjdCBkYXRhKSB7CiAg\nICAgICAgc2V0RXh0cmFGaWVsZERhdGEoZmllbGQsIGRhdGEsIGZhbHNlKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGF0YSBmcm9tIHRo\nZSBwcm9wZXIgaW5kZXggb2YgdGhlIGV4dHJhIGZpZWxkIGRhdGEgYXJyYXku\nCiAgICAgKi8KICAgIHByaXZhdGUgc3luY2hyb25pemVkIE9iamVjdCBnZXRF\neHRyYUZpZWxkRGF0YShpbnQgZmllbGQsIGJvb2xlYW4gaXNMb2FkZWQpIHsK\nICAgICAgICAvLyBvbmx5IHJldHVybiB0aGUgZmllbGQgZGF0YSBpZiB0aGUg\nZmllbGQgaXMgaW4gdGhlIHJpZ2h0IGxvYWRlZAogICAgICAgIC8vIHN0YXRl\nOyBvdGhlcndpc2Ugd2UgbWlnaHQgcmV0dXJuIGludGVybWVkaWF0ZSBmb3Ig\naW1wbCBkYXRhIG9yCiAgICAgICAgLy8gdmljZSB2ZXJzYQogICAgICAgIGlm\nIChfZmllbGRJbXBsID09IG51bGwgfHwgX2xvYWRlZC5nZXQoZmllbGQpICE9\nIGlzTG9hZGVkKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBp\nbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJbmRleChmaWVsZCk7\nCiAgICAgICAgcmV0dXJuIChpZHggPT0gLTEpID8gbnVsbCA6IF9maWVsZElt\ncGxbaWR4XTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZGF0YSBm\ncm9tIHRvIHByb3BlciBpbmRleCBvZiB0aGUgZXh0cmEgZmllbGQgZGF0YSBh\ncnJheS4KICAgICAqLwogICAgcHJpdmF0ZSBzeW5jaHJvbml6ZWQgT2JqZWN0\nIHNldEV4dHJhRmllbGREYXRhKGludCBmaWVsZCwgT2JqZWN0IGRhdGEsCiAg\nICAgICAgYm9vbGVhbiBsb2FkZWQpIHsKICAgICAgICBpbnQgaWR4ID0gX21l\ndGEuZ2V0RXh0cmFGaWVsZERhdGFJbmRleChmaWVsZCk7CiAgICAgICAgaWYg\nKGlkeCA9PSAtMSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhj\nZXB0aW9uKFN0cmluZy52YWx1ZU9mKF9tZXRhLmdldEZpZWxkKGZpZWxkKSkp\nOwoKICAgICAgICBPYmplY3Qgb2xkID0gKF9maWVsZEltcGwgPT0gbnVsbCkg\nPyBudWxsIDogX2ZpZWxkSW1wbFtpZHhdOwogICAgICAgIGlmIChkYXRhICE9\nIG51bGwpIHsKICAgICAgICAgICAgLy8gY2Fubm90IHNldCBpZiBmaWVsZCBp\nbiB3cm9uZyBsb2FkZWQgc3RhdGUKICAgICAgICAgICAgaWYgKF9sb2FkZWQu\nZ2V0KGZpZWxkKSAhPSBsb2FkZWQpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW50ZXJuYWxFeGNlcHRpb24oU3RyaW5nLnZhbHVlT2YoX21ldGEuZ2V0\nRmllbGQKICAgICAgICAgICAgICAgICAgICAoZmllbGQpKSk7CgogICAgICAg\nICAgICAvLyBzZXQgZGF0YQogICAgICAgICAgICBpZiAoX2ZpZWxkSW1wbCA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX2ZpZWxkSW1wbCA9IG5ldyBPYmpl\nY3RbX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFMZW5ndGgoKV07CiAgICAgICAg\nICAgIF9maWVsZEltcGxbaWR4XSA9IGRhdGE7CiAgICAgICAgfSBlbHNlIGlm\nIChfZmllbGRJbXBsICE9IG51bGwgJiYgX2xvYWRlZC5nZXQoZmllbGQpID09\nIGxvYWRlZCkKICAgICAgICAgICAgX2ZpZWxkSW1wbFtpZHhdID0gbnVsbDsK\nICAgICAgICByZXR1cm4gb2xkOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3Qg\nZmV0Y2goaW50IGZpZWxkKSB7CiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNo\nRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gX21ldGEuZ2V0\nRmllbGQoZmllbGQpLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKTsK\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNoRmllbGQoaW50IGZpZWxk\nLCBib29sZWFuIHRyYW5zaXRpb25zKSB7CiAgICAgICAgRmllbGRNZXRhRGF0\nYSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZt\nZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tZmllbGQiLAogICAgICAgICAgICAgICAgU3RyaW5n\nLnZhbHVlT2YoZmllbGQpLCBnZXRNYW5hZ2VkSW5zdGFuY2UoKS5nZXRDbGFz\ncygpKSkuCiAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFu\nYWdlZEluc3RhbmNlKCkpOwoKICAgICAgICAvLyBkbyBub3JtYWwgc3RhdGUg\ndHJhbnNpdGlvbnMKICAgICAgICBpZiAoIWZtZC5pc1ByaW1hcnlLZXkoKSAm\nJiB0cmFuc2l0aW9ucykKICAgICAgICAgICAgYWNjZXNzaW5nRmllbGQoZmll\nbGQpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGZldGNoU3RyaW5nRmllbGQoZmllbGQpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBy\nZXR1cm4gKGZldGNoQm9vbGVhbkZpZWxkKGZpZWxkKSkgPyBCb29sZWFuLlRS\nVUUKICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4uRkFMU0U7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IEJ5dGUoZmV0Y2hCeXRlRmllbGQoZmllbGQpKTsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgQ2hhcmFjdGVyKGZldGNoQ2hhckZpZWxkKGZpZWxkKSk7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAg\nICAgIHJldHVybiBuZXcgRG91YmxlKGZldGNoRG91YmxlRmllbGQoZmllbGQp\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IEZsb2F0KGZldGNoRmxvYXRGaWVsZChmaWVs\nZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAg\nICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGZldGNoSW50RmllbGQo\nZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAg\nICAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZmV0Y2hMb25n\nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hP\nUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNob3J0KGZldGNoU2hv\ncnRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZldGNoT2JqZWN0RmllbGQoZmllbGQpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZShpbnQgZmllbGQs\nIE9iamVjdCB2YWwpIHsKICAgICAgICB2YWwgPSBfbWV0YS5nZXRGaWVsZChm\naWVsZCkuZ2V0RmllbGRWYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgICAgIHN0\nb3JlRmllbGQoZmllbGQsIHZhbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3RvcmVGaWVsZChpbnQgZmllbGQsIE9iamVjdCB2YWwpIHsKICAgICAgICBz\ndG9yZUZpZWxkKGZpZWxkLCB2YWwsIHRoaXMpOwogICAgfQoKICAgIC8qKgog\nICAgICogPHA+Q2hlY2tzIHdoZXRoZXIgb3Igbm90IDxjb2RlPl9wYzwvY29k\nZT4gaXMgZGlydHkuIEluIHRoZSBjYXNlcyB3aGVyZQogICAgICogZmllbGQg\ndHJhY2tpbmcgaXMgbm90IGhhcHBlbmluZyAoc2VlIGJlbG93KSwgdGhpcyBt\nZXRob2Qgd2lsbCBkbyBhCiAgICAgKiBzdGF0ZSBjb21wYXJpc29uIHRvIGZp\nbmQgd2hldGhlciA8Y29kZT5fcGM8L2NvZGU+IGlzIGRpcnR5LCBhbmQgd2ls\nbAogICAgICogdXBkYXRlIHRoaXMgaW5zdGFuY2Ugd2l0aCB0aGlzIGluZm9y\nbWF0aW9uLiBJbiB0aGUgY2FzZXMgd2hlcmUgZmllbGQKICAgICAqIHRyYWNr\naW5nIGlzIGhhcHBlbmluZywgdGhpcyBtZXRob2QgaXMgYSBuby1vcC48L3A+\nCiAgICAgKgogICAgICogPHA+RmllbGRzIGFyZSB0cmFja2VkIGZvciBhbGwg\nY2xhc3NlcyB0aGF0IGFyZSBydW4gdGhyb3VnaCB0aGUgT3BlbkpQQQogICAg\nICogZW5oYW5jZXIgcHJpb3IgdG8gb3IgZHVyaW5nIGRlcGxveW1lbnQsIGFu\nZCBhbGwgY2xhc3NlcyAoZW5oYW5jZWQgb3IKICAgICAqIHVuZW5oYW5jZWQp\nIGluIGEgSmF2YSA2IGVudmlyb25tZW50IG9yIG5ld2VyLjwvcD4KICAgICAq\nCiAgICAgKiA8cD5JbiBhIEphdmEgNSBWTSBvciBvbGRlcjoKICAgICAqIDxi\ncj4tIGluc3RhbmNlcyBvZiB1bmVuaGFuY2VkIGNsYXNzZXMgdGhhdCB1c2UK\nICAgICAqIHByb3BlcnR5IGFjY2VzcyBhbmQgb2JleSB0aGUgcHJvcGVydHkg\nYWNjZXNzIGxpbWl0YXRpb25zIGFyZSB0cmFja2VkCiAgICAgKiB3aGVuIHRo\nZSBpbnN0YW5jZXMgYXJlIGxvYWRlZCBmcm9tIHRoZSBkYXRhYmFzZSBieSBP\ncGVuSlBBLCBhbmQgYXJlCiAgICAgKiBub3QgdHJhY2tlZCB3aGVuIHRoZSBp\nbnN0YW5jZXMgYXJlIGNyZWF0ZWQgYnkgYXBwbGljYXRpb24gY29kZS4KICAg\nICAqIDxicj4tIGluc3RhbmNlcyBvZiB1bmVuaGFuY2VkIGNsYXNzZXMgdGhh\ndCB1c2UgZmllbGQgYWNjZXNzIGFyZQogICAgICogbmV2ZXIgdHJhY2tlZC48\nL3A+CiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIGRpcnR5Q2hlY2soKSB7CiAgICAgICAgaWYgKCFuZWVkc0Rp\ncnR5Q2hlY2soKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBTYXZl\nRmllbGRNYW5hZ2VyIHNhdmVkID0gZ2V0U2F2ZUZpZWxkTWFuYWdlcigpOwog\nICAgICAgIGlmIChzYXZlZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXNhdmVkLWZpZWxk\ncyIsCiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YSgpLmdldERlc2NyaWJl\nZFR5cGUoKS5nZXROYW1lKCkpKTsKCiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZtZHMgPSBnZXRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAvLyBwayBhbmQgdmVyc2lvbiBmaWVsZHMgY2Fubm90IGJlIG11dGF0\nZWQ7IGRvbid0IG1hcmsgdGhlbQogICAgICAgICAgICAvLyBhcyBzdWNoLiAj\nIyMjIyB2YWxpZGF0ZT8KICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlzUHJp\nbWFyeUtleSgpICYmICFmbWRzW2ldLmlzVmVyc2lvbigpCiAgICAgICAgICAg\nICAgICAmJiBfbG9hZGVkLmdldChpKSkgewogICAgICAgICAgICAgICAgaWYg\nKCFzYXZlZC5pc0ZpZWxkRXF1YWwoaSwgZmV0Y2goaSkpKSB7CiAgICAgICAg\nICAgICAgICAgICAgZGlydHkoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFu\nIG5lZWRzRGlydHlDaGVjaygpIHsKICAgICAgICBpZiAoaXNJbnRlcmNlcHRp\nbmcoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChp\nc0RlbGV0ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIGlmIChpc05ldygpICYmICFpc0ZsdXNoZWQoKSkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgZmV0Y2hJbml0aWFsRmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgaWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkgPT0g\nUmVzdG9yZVN0YXRlLlJFU1RPUkVfTk9ORQogICAgICAgICAgICAmJiAoKF9m\nbGFncyAmIEZMQUdfSU5WRVJTRVMpID09IDAKICAgICAgICAgICAgfHwgZm1k\nLmdldEludmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPT0gMCkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nInJlc3RvcmUtdW5zZXQiKSk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5EQVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JK\nRUNUOgogICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgbm90IHNhdmluZyBt\ndXRhYmxlIHR5cGVzLCB0aHJvdyBhbiBleGNlcHRpb24KICAgICAgICAgICAg\nICAgIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpICE9IFJlc3RvcmVT\ndGF0ZS5SRVNUT1JFX0FMTAogICAgICAgICAgICAgICAgICAgICYmICgoX2Zs\nYWdzICYgRkxBR19JTlZFUlNFUykgPT0gMAogICAgICAgICAgICAgICAgICAg\nIHx8IGZtZC5nZXRJbnZlcnNlTWV0YURhdGFzKCkubGVuZ3RoID09IDApKQog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJtdXRh\nYmxlLXJlc3RvcmUtdW5zZXQiKSk7CiAgICAgICAgfQoKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlZCA9PSBu\ndWxsIHx8ICFfbG9hZGVkLmdldChmaWVsZCkgfHwgIV9kaXJ0eS5nZXQoZmll\nbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoRmllbGQoZmllbGQs\nIGZhbHNlKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBmaWVsZCBpcyBkaXJ0\neSBidXQgd2UgbmV2ZXIgbG9hZGVkIGl0LCB3ZSBjYW4ndCByZXN0b3JlIGl0\nCiAgICAgICAgICAgIGlmIChfc2F2ZWQuZ2V0VW5sb2FkZWQoKS5nZXQoZmll\nbGQpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4\nY2VwdGlvbihfbG9jLmdldCgiaW5pdGlhbC11bmxvYWRlZCIsCiAgICAgICAg\nICAgICAgICAgICAgZm1kKSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQo\nX3NhdmVkLmdldFN0YXRlKCksIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgcmV0dXJuIGZldGNoRmllbGQoX3NpbmdsZSwgZm1kKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBGZXRjaCB0aGUgc3BlY2lmaWVkIGZpZWxk\nIGZyb20gdGhlIHNwZWNpZmllZCBmaWVsZCBtYW5hZ2VyLCB3cmFwcGluZyBp\ndAogICAgICogaW4gYW4gb2JqZWN0IGlmIGl0J3MgYSBwcmltaXRpdmUuIEEg\nZmllbGQgc2hvdWxkIGJlIHByb3ZpZGVkIHRvIHRoZQogICAgICogZmllbGQg\nbWFuYWdlciBiZWZvcmUgdGhpcyBjYWxsIGlzIG1hZGUuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIE9iamVjdCBmZXRjaEZpZWxkKEZpZWxkTWFuYWdl\nciBmbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpbnQgZmllbGQg\nPSBmbWQuZ2V0SW5kZXgoKTsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQk9PTEVBTjoKICAgICAgICAgICAgICAgIHJldHVybiAoZm0uZmV0Y2hCb29s\nZWFuRmllbGQoZmllbGQpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAg\nICAgICAgIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQllURToKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZShm\nbS5mZXRjaEJ5dGVGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFy\nYWN0ZXIoZm0uZmV0Y2hDaGFyRmllbGQoZmllbGQpKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBEb3VibGUoZm0uZmV0Y2hEb3VibGVGaWVsZChmaWVsZCkpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAg\nIHJldHVybiBuZXcgRmxvYXQoZm0uZmV0Y2hGbG9hdEZpZWxkKGZpZWxkKSk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAg\nICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZm0uZmV0Y2hJbnRGaWVsZChm\naWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAg\nICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihmbS5mZXRjaExv\nbmdGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5T\nSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2hvcnQoZm0uZmV0\nY2hTaG9ydEZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlNUUklORzoKICAgICAgICAgICAgICAgIHJldHVybiBmbS5mZXRjaFN0\ncmluZ0ZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIHJldHVybiBmbS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVtb3RlKGlu\ndCBmaWVsZCwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZp\nZWxkLCBCb29sZWFuLkZBTFNFLCBmYWxzZSk7CiAgICAgICAgICAgIHN0b3Jl\nRmllbGQoZmllbGQsIHZhbHVlLCBfc2luZ2xlKTsKICAgICAgICAgICAgcmVw\nbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBw\nb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwogICAgLy8gTGlmZWN5Y2xlIG9wZXJhdGlvbnMKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogTm90\naWZpY2F0aW9uIHRoYXQgdGhlIG9iamVjdCBpcyBhYm91dCB0byBiZSBhY2Nl\nc3NlZC4KICAgICAqCiAgICAgKiBAcGFyYW0gZmllbGQgdGhlIGZpZWxkIG51\nbWJlciBiZWluZyByZWFkLCBvciAtMSBpZiBub3QgYSBzaW5nbGUKICAgICAq\nIGZpZWxkIHJlYWQKICAgICAqLwogICAgdm9pZCBiZWZvcmVSZWFkKGludCBm\naWVsZCkgewogICAgICAgIC8vIGFsbG93IHVubWVkaWF0ZWQgcmVhZHMgb2Yg\ncHJpbWFyeSBrZXkgZmllbGRzCiAgICAgICAgaWYgKGZpZWxkICE9IC0xICYm\nIF9tZXRhLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlLZXkoKSkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2Jyb2tlci5pc0FjdGl2ZSgp\nICYmICFfYnJva2VyLmlzVHJhbnNhY3Rpb25FbmRpbmcoKSkgewogICAgICAg\nICAgICBpZiAoX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkpCiAgICAgICAgICAg\nICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVPcHRpbWlzdGljUmVhZCh0\naGlzLCBmaWVsZCkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVSZWFkKHRoaXMsIGZpZWxkKSk7\nCiAgICAgICAgfSBlbHNlIGlmIChfYnJva2VyLmdldE5vbnRyYW5zYWN0aW9u\nYWxSZWFkKCkpCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmJlZm9y\nZU5vbnRyYW5zYWN0aW9uYWxSZWFkKHRoaXMsIGZpZWxkKSk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0\naW9uKF9sb2MuZ2V0KCJub24tdHJhbnMtcmVhZCIpKS4KICAgICAgICAgICAg\nICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQg\nc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2JlZm9yZUZsdXNo\nCiAgICAgKi8KICAgIHZvaWQgYmVmb3JlRmx1c2goaW50IHJlYXNvbiwgT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIF9zdGF0ZS5iZWZvcmVGbHVzaCh0\naGlzLCByZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FMLCBjYWxs\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3Vy\ncmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjZmx1c2gK\nICAgICAqLwogICAgdm9pZCBhZnRlckZsdXNoKGludCByZWFzb24pIHsKICAg\nICAgICAvLyBub3RoaW5nIGhhcHBlbnMgd2hlbiB3ZSBmbHVzaCBub24tcGVy\nc2lzdGVudCBzdGF0ZXMKICAgICAgICBpZiAoIWlzUGVyc2lzdGVudCgpKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChyZWFzb24gIT0gQnJv\na2VySW1wbC5GTFVTSF9ST0xMQkFDSwogICAgICAgICAgICAmJiByZWFzb24g\nIT0gQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FMKSB7CiAgICAgICAgICAgIC8v\nIGFuYWx5emUgcHJldmlvdXMgc3RhdGUgZm9yIGxhdGVyCiAgICAgICAgICAg\nIGJvb2xlYW4gd2FzTmV3ID0gaXNOZXcoKTsKICAgICAgICAgICAgYm9vbGVh\nbiB3YXNGbHVzaGVkID0gaXNGbHVzaGVkKCk7CiAgICAgICAgICAgIGJvb2xl\nYW4gd2FzRGVsZXRlZCA9IGlzRGVsZXRlZCgpOwoKICAgICAgICAgICAgLy8g\nYWxsIGRpcnR5IGZpZWxkcyB3ZXJlIGZsdXNoZWQKICAgICAgICAgICAgX2Zs\ndXNoLm9yKF9kaXJ0eSk7CgogICAgICAgICAgICAvLyBpbXBvcnRhbnQgdG8g\nc2V0IGZsdXNoZWQgYml0IGFmdGVyIGNhbGxpbmcgX3N0YXRlLmZsdXNoIHNv\nCiAgICAgICAgICAgIC8vIHRoYXQgdGhlIHN0YXRlIGNhbiB0ZWxsIHdoZXRo\nZXIgdGhpcyBpcyB0aGUgZmlyc3QgZmx1c2gKICAgICAgICAgICAgc2V0UENT\ndGF0ZShfc3RhdGUuZmx1c2godGhpcykpOwogICAgICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19GTFVTSEVEOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nRkxVU0hFRF9ESVJUWTsKCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19W\nRVJTSU9OX0NIRUNLOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfVkVS\nU0lPTl9VUERBVEU7CgogICAgICAgICAgICAvLyBpZiB0aGlzIHdhcyBhbiBp\nbmMgZmx1c2ggZHVyaW5nIHdoaWNoIHdlIGhhZCBvdXIgaWRlbnRpdHkKICAg\nICAgICAgICAgLy8gYXNzaWduZWQsIHRlbGwgdGhlIGJyb2tlciB0byBjYWNo\nZSB1cyB1bmRlciBvdXIgZmluYWwgb2lkCiAgICAgICAgICAgIGlmIChyZWFz\nb24gPT0gQnJva2VySW1wbC5GTFVTSF9JTkMpCiAgICAgICAgICAgICAgICBh\nc3NlcnRPYmplY3RJZEFzc2lnbmVkKHRydWUpOwoKICAgICAgICAgICAgLy8g\naWYgdGhpcyBvYmplY3Qgd2FzIHN0b3JlZCB3aXRoIHByZUZsdXNoLCBkbyBw\nb3N0LXN0b3JlIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19QUkVfRkxVU0hFRCkgPiAwKQogICAgICAgICAgICAgICAgZmlyZUxp\nZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1NUT1JFKTsKCiAg\nICAgICAgICAgIC8vIGRvIHBvc3QtdXBkYXRlIGFzIG5lZWRlZAogICAgICAg\nICAgICBpZiAod2FzTmV3ICYmICF3YXNGbHVzaGVkKQogICAgICAgICAgICAg\nICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1BF\nUlNJU1RfUEVSRk9STUVEKTsKICAgICAgICAgICAgZWxzZSBpZiAod2FzRGVs\nZXRlZCkKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZl\nY3ljbGVFdmVudC5BRlRFUl9ERUxFVEVfUEVSRk9STUVEKTsKICAgICAgICAg\nICAgZWxzZSAKICAgICAgICAgICAgICAgIC8vIHVwZGF0ZXMgYW5kIG5ldy1m\nbHVzaGVkIHdpdGggY2hhbmdlcwogICAgICAgICAgICAgICAgZmlyZUxpZmVj\neWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1VQREFURV9QRVJGT1JN\nRUQpOwogICAgICAgIH0gZWxzZSBpZiAocmVhc29uID09IEJyb2tlckltcGwu\nRkxVU0hfUk9MTEJBQ0spIHsKICAgICAgICAgICAgLy8gcmV2ZXJ0IHRvIGxh\nc3QgbG9hZGVkIHZlcnNpb24gYW5kIG9yaWdpbmFsIG9pZAogICAgICAgICAg\nICBhc3NpZ25WZXJzaW9uRmllbGQoX2xvYWRWZXJzaW9uKTsKICAgICAgICAg\nICAgaWYgKGlzTmV3KCkgJiYgKF9mbGFncyAmIEZMQUdfT0lEX0FTU0lHTkVE\nKSA9PSAwKQogICAgICAgICAgICAgICAgX29pZCA9IG51bGw7CiAgICAgICAg\nfQogICAgICAgIF9mbGFncyAmPSB+RkxBR19QUkVfRkxVU0hFRDsKICAgIH0K\nCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0\nZSBhZnRlciBjaGVja2luZyB0aGUgdmFsdWUKICAgICAqIG9mIHRoZSBSZXRh\naW5TdGF0ZSBmbGFnLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNjb21t\naXQKICAgICAqIEBzZWUgUENTdGF0ZSNjb21taXRSZXRhaW4KICAgICAqLwog\nICAgdm9pZCBjb21taXQoKSB7CiAgICAgICAgLy8gcmVsZWFzZSBsb2NrcyBi\nZWZvcmUgb2lkIHVwZGF0ZWQKICAgICAgICByZWxlYXNlTG9ja3MoKTsKCiAg\nICAgICAgLy8gdXBkYXRlIHZlcnNpb24gYW5kIG9pZCBpbmZvcm1hdGlvbgog\nICAgICAgIHNldFZlcnNpb24oX3ZlcnNpb24pOwogICAgICAgIF9mbGFncyAm\nPSB+RkxBR19GTFVTSEVEOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVT\nSEVEX0RJUlRZOwoKICAgICAgICBPYmplY3Qgb3JpZyA9IF9pZDsKICAgICAg\nICBhc3NlcnRPYmplY3RJZEFzc2lnbmVkKGZhbHNlKTsKCiAgICAgICAgYm9v\nbGVhbiB3YXNOZXcgPSBpc05ldygpICYmICFpc0RlbGV0ZWQoKSAmJiAhaXNQ\ncm92aXNpb25hbCgpOwogICAgICAgIGlmIChfYnJva2VyLmdldFJldGFpblN0\nYXRlKCkpCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmNvbW1pdFJl\ndGFpbih0aGlzKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRQQ1N0\nYXRlKF9zdGF0ZS5jb21taXQodGhpcykpOwoKICAgICAgICAvLyBhc2sgdGhl\nIGJyb2tlciB0byByZS1jYWNoZSB1cyBpZiB3ZSB3ZXJlIG5ldyBwcmV2aW91\nc2x5CiAgICAgICAgaWYgKHdhc05ldykKICAgICAgICAgICAgX2Jyb2tlci5z\nZXRTdGF0ZU1hbmFnZXIob3JpZywgdGhpcywgQnJva2VySW1wbC5TVEFUVVNf\nQ09NTUlUX05FVyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMg\ndG8gdGhlIGN1cnJlbnQgc3RhdGUgYWZ0ZXIgY2hlY2tpbmcgdGhlIHZhbHVl\nCiAgICAgKiBvZiB0aGUgUmV0YWluU3RhdGUgZmxhZy4KICAgICAqCiAgICAg\nKiBAc2VlIFBDU3RhdGUjcm9sbGJhY2sKICAgICAqIEBzZWUgUENTdGF0ZSNy\nb2xsYmFja1Jlc3RvcmUKICAgICAqLwogICAgdm9pZCByb2xsYmFjaygpIHsK\nICAgICAgICAvLyByZWxlYXNlIGxvY2tzCiAgICAgICAgcmVsZWFzZUxvY2tz\nKCk7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRUQ7CiAgICAgICAg\nX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRURfRElSVFk7CiAgICAgICAgYWZ0ZXJG\nbHVzaChCcm9rZXJJbXBsLkZMVVNIX1JPTExCQUNLKTsKCiAgICAgICAgaWYg\nKF9icm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkgIT0gUmVzdG9yZVN0YXRlLlJF\nU1RPUkVfTk9ORSkKICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUucm9s\nbGJhY2tSZXN0b3JlKHRoaXMpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHNldFBDU3RhdGUoX3N0YXRlLnJvbGxiYWNrKHRoaXMpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJvbGxiYWNrIHN0YXRlIG9mIHRoZSBtYW5hZ2VkIGlu\nc3RhbmNlIHRvIHRoZSBnaXZlbiBzYXZlcG9pbnQuCiAgICAgKi8KICAgIHZv\naWQgcm9sbGJhY2tUb1NhdmVwb2ludChTYXZlcG9pbnRGaWVsZE1hbmFnZXIg\nc2F2ZXBvaW50KSB7CiAgICAgICAgX3N0YXRlID0gc2F2ZXBvaW50LmdldFBD\nU3RhdGUoKTsKICAgICAgICBCaXRTZXQgbG9hZGVkID0gc2F2ZXBvaW50Lmdl\ndExvYWRlZCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBsb2Fk\nZWQubGVuZ3RoKCk7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBpZiAo\nbG9hZGVkLmdldChpKSAmJiBzYXZlcG9pbnQucmVzdG9yZUZpZWxkKGkpKSB7\nCiAgICAgICAgICAgICAgICBwcm92aWRlRmllbGQoc2F2ZXBvaW50LmdldENv\ncHkoKSwgc2F2ZXBvaW50LCBpKTsKICAgICAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChfcGMsIHNhdmVwb2ludCwgaSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgX2xvYWRlZCA9IGxvYWRlZDsKICAgICAgICBfZGlydHkg\nPSBzYXZlcG9pbnQuZ2V0RGlydHkoKTsKICAgICAgICBfZmx1c2ggPSBzYXZl\ncG9pbnQuZ2V0Rmx1c2hlZCgpOwogICAgICAgIF92ZXJzaW9uID0gc2F2ZXBv\naW50LmdldFZlcnNpb24oKTsKICAgICAgICBfbG9hZFZlcnNpb24gPSBzYXZl\ncG9pbnQuZ2V0TG9hZFZlcnNpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAg\nKiBAc2VlIFBDU3RhdGUjcGVyc2lzdAogICAgICogQHNlZSBCcm9rZXIjcGVy\nc2lzdAogICAgICovCiAgICB2b2lkIHBlcnNpc3QoKSB7CiAgICAgICAgc2V0\nUENTdGF0ZShfc3RhdGUucGVyc2lzdCh0aGlzKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAg\nKgogICAgICogQHNlZSBQQ1N0YXRlI2RlbGV0ZQogICAgICogQHNlZSBCcm9r\nZXIjZGVsZXRlCiAgICAgKi8KICAgIHZvaWQgZGVsZXRlKCkgewogICAgICAg\nIHNldFBDU3RhdGUoX3N0YXRlLmRlbGV0ZSh0aGlzKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAg\nICAgKgogICAgICogQHNlZSBQQ1N0YXRlI25vbnRyYW5zYWN0aW9uYWwKICAg\nICAqIEBzZWUgQnJva2VyI25vbnRyYW5zYWN0aW9uYWwKICAgICAqLwogICAg\ndm9pZCBub250cmFuc2FjdGlvbmFsKCkgewogICAgICAgIHNldFBDU3RhdGUo\nX3N0YXRlLm5vbnRyYW5zYWN0aW9uYWwodGhpcykpOwogICAgfQoKICAgIC8q\nKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAg\nICoKICAgICAqIEBzZWUgUENTdGF0ZSN0cmFuc2FjdGlvbmFsCiAgICAgKiBA\nc2VlIEJyb2tlciN0cmFuc2FjdGlvbmFsCiAgICAgKi8KICAgIHZvaWQgdHJh\nbnNhY3Rpb25hbCgpIHsKICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS50cmFu\nc2FjdGlvbmFsKHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVn\nYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2Vl\nIFBDU3RhdGUjbm9ucHJvdmlzaW9uYWwKICAgICAqLwogICAgdm9pZCBub25w\ncm92aXNpb25hbChib29sZWFuIGxvZ2ljYWwsIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5ub25wcm92aXNpb25hbCh0\naGlzLCBsb2dpY2FsLCBjYWxsKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBE\nZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICog\nQHNlZSBQQ1N0YXRlI3JlbGVhc2UKICAgICAqIEBzZWUgQnJva2VyI3JlbGVh\nc2UKICAgICAqLwogICAgdm9pZCByZWxlYXNlKGJvb2xlYW4gdW5wcm94eSkg\newogICAgICAgIHJlbGVhc2UodW5wcm94eSwgZmFsc2UpOwogICAgfQoKICAg\nIHZvaWQgcmVsZWFzZShib29sZWFuIHVucHJveHksIGJvb2xlYW4gZm9yY2Up\nIHsKICAgICAgICAvLyBvcHRpbWl6YXRpb24gZm9yIGRldGFjaC1pbi1wbGFj\nZSBzcGVjaWFsIGNhc2Ugd2hlbiBmaWVsZHMgYXJlCiAgICAgICAgLy8gYWxy\nZWFkeSAodW4pcHJveGllZCBjb3JyZWN0bHkKICAgICAgICBpZiAoIXVucHJv\neHkpCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX05PX1VOUFJPWFk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGZvcmNlKQogICAgICAgICAg\nICAgICAgc2V0UENTdGF0ZShQQ1N0YXRlLlRSQU5TSUVOVCk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLnJl\nbGVhc2UodGhpcykpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIF9mbGFncyAmPSB+RkxBR19OT19VTlBST1hZOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0\nZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjZXZpY3QKICAgICAqIEBz\nZWUgQnJva2VyI2V2aWN0CiAgICAgKi8KICAgIHZvaWQgZXZpY3QoKSB7CiAg\nICAgICAgc2V0UENTdGF0ZShfc3RhdGUuZXZpY3QodGhpcykpOwogICAgfQoK\nICAgIC8qKgogICAgICogR2F0aGVyIHJlbGF0aW9ucyByZWFjaGFibGUgZnJv\nbSB2YWx1ZXMgdXNpbmcKICAgICAqIHtAbGluayBWYWx1ZU1ldGFEYXRhI0NB\nU0NBREVfSU1NRURJQVRFfS4KICAgICAqLwogICAgdm9pZCBnYXRoZXJDYXNj\nYWRlUmVmcmVzaChPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKCFfbG9hZGVkLmdldChpKSkKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0Q2FzY2FkZVJl\nZnJlc2goKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFCiAg\nICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdldEtleSgpLmdldENhc2NhZGVS\nZWZyZXNoKCkKICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FT\nQ0FERV9JTU1FRElBVEUKICAgICAgICAgICAgICAgIHx8IGZtZHNbaV0uZ2V0\nRWxlbWVudCgpLmdldENhc2NhZGVSZWZyZXNoKCkKICAgICAgICAgICAgICAg\nID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpIHsKICAgICAg\nICAgICAgICAgIF9zaW5nbGUuc3RvcmVPYmplY3RGaWVsZChpLCBmZXRjaEZp\nZWxkKGksIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmdhdGhl\nckNhc2NhZGVSZWZyZXNoKGNhbGwpOwogICAgICAgICAgICAgICAgX3Npbmds\nZS5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGJlZm9yZVJlZnJlc2goYm9vbGVhbiByZWZyZXNo\nQWxsKSB7CiAgICAgICAgLy8gbm90ZTogYWxsIGxvZ2ljIHBsYWNlZCBoZXJl\nIHJhdGhlciB0aGFuIGluIHRoZSBzdGF0ZXMgZm9yCiAgICAgICAgLy8gb3B0\naW1pemF0aW9uOyB0aGlzIG1ldGhvZCBwdWJsaWMgYi9jIHVzZWQgYnkgcmVt\nb3RlIHBhY2thZ2UKCiAgICAgICAgLy8gbm90aGluZyB0byBkbyBmb3Igbm9u\nIHBlcnNpc3RlbnQgb3IgbmV3IHVuZmx1c2hlZCBpbnN0YW5jZXMKICAgICAg\nICBpZiAoIWlzUGVyc2lzdGVudCgpIHx8IChpc05ldygpICYmICFpc0ZsdXNo\nZWQoKSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIGRpcnR5IG5l\nZWQgdG8gY2xlYXIgZmllbGRzCiAgICAgICAgICAgIGlmIChpc0RpcnR5KCkp\nIHsKICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gaWYgc29tZSBmaWVsZHMgaGF2ZSBiZWVuIGxvYWRlZCBidXQgdGhlIGlu\nc3RhbmNlIGlzIG91dCBvZgogICAgICAgICAgICAvLyBkYXRlIG9yIHRoaXMg\naXMgcGFydCBvZiBhIHJlZnJlc2hBbGwoKSBhbmQgd2UgZG9uJ3Qgd2FudCB0\nbwogICAgICAgICAgICAvLyB0YWtlIHRoZSBleHRyYSBoaXQgdG8gc2VlIGlm\nIHRoZSBpbnN0YW5jZSBpcyBvdXQgb2YgZGF0ZSwgY2xlYXIKICAgICAgICAg\nICAgaWYgKF9sb2FkZWQubGVuZ3RoKCkgPiAwICYmIChyZWZyZXNoQWxsIHx8\nIGlzRW1iZWRkZWQoKQogICAgICAgICAgICAgICAgfHwgIXN5bmNWZXJzaW9u\nKG51bGwpKSkgewogICAgICAgICAgICAgICAgT2JqZWN0IHZlcnNpb24gPSBf\ndmVyc2lvbjsKICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7CgogICAg\nICAgICAgICAgICAgLy8gaWYgc3luY1ZlcnNpb24ganVzdCByZXBsYWNlZCB0\naGUgdmVyc2lvbiwgcmVzZXQgaXQKICAgICAgICAgICAgICAgIGlmICghcmVm\ncmVzaEFsbCAmJiAhaXNFbWJlZGRlZCgpKQogICAgICAgICAgICAgICAgICAg\nIHNldFZlcnNpb24odmVyc2lvbik7CiAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBzdGF0ZSB0\ncmFuc2l0aW9ucyBhZnRlciByZWZyZXNoLiBUaGlzIG1ldGhvZCBpcyBvbmx5\nCiAgICAgKiBjYWxsZWQgaWYge0BsaW5rICNiZWZvcmVSZWZyZXNofSByZXR1\ncm5zIHRydWUuCiAgICAgKi8KICAgIHZvaWQgYWZ0ZXJSZWZyZXNoKCkgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB0\ncmFuc2l0aW9uIHRvIGNsZWFuIG9yIG5vbnRyYW5zYWN0aW9uYWwgZGVwZW5k\naW5nIG9uIHRyYW5zIHN0YXR1cwogICAgICAgICAgICBpZiAoIV9icm9rZXIu\naXNBY3RpdmUoKSkKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRl\nLmFmdGVyTm9udHJhbnNhY3Rpb25hbFJlZnJlc2goKSk7CiAgICAgICAgICAg\nIGVsc2UgaWYgKF9icm9rZXIuZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAg\nICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYWZ0ZXJPcHRpbWlzdGljUmVmcmVz\naCgpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc2V0UENT\ndGF0ZShfc3RhdGUuYWZ0ZXJSZWZyZXNoKCkpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIE1hcmsgdGhpcyBvYmplY3QgYXMgYSBkZXJlZmVyZW5j\nZWQgZGVwZW5kZW50IG9iamVjdC4KICAgICAqLwogICAgdm9pZCBzZXREZXJl\nZmVyZW5jZWREZXBlbmRlbnQoYm9vbGVhbiBkZXJlZiwgYm9vbGVhbiBub3Rp\nZnkpIHsKICAgICAgICBpZiAoIWRlcmVmICYmIChfZmxhZ3MgJiBGTEFHX0RF\nUkVGKSA+IDApIHsKICAgICAgICAgICAgaWYgKG5vdGlmeSkKICAgICAgICAg\nICAgICAgIF9icm9rZXIucmVtb3ZlRGVyZWZlcmVuY2VkRGVwZW5kZW50KHRo\naXMpOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfREVSRUY7CiAgICAg\nICAgfSBlbHNlIGlmIChkZXJlZiAmJiAoX2ZsYWdzICYgRkxBR19ERVJFRikg\nPT0gMCkgewogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19ERVJFRjsKICAg\nICAgICAgICAgaWYgKG5vdGlmeSkKICAgICAgICAgICAgICAgIF9icm9rZXIu\nYWRkRGVyZWZlcmVuY2VkRGVwZW5kZW50KHRoaXMpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvLy8vLy8vLy8vLwogICAgLy8gTG9ja2luZwogICAgLy8vLy8v\nLy8vLy8KCiAgICAvKioKICAgICAqIE5vdGlmaWNhdGlvbiB0aGF0IHdlJ3Zl\nIGJlZW4gcmVhZC1sb2NrZWQuIFBhc3MgaW4gdGhlIGxldmVsIGF0IHdoaWNo\nCiAgICAgKiB3ZSB3ZXJlIGxvY2tlZCBhbmQgdGhlIGxldmVsIGF0IHdoaWNo\nIHdlIHNob3VsZCB3cml0ZSBsb2NrIG91cnNlbHZlcwogICAgICogb24gZGly\ndHkuCiAgICAgKi8KICAgIHZvaWQgcmVhZExvY2tlZChpbnQgcmVhZExvY2tM\nZXZlbCwgaW50IHdyaXRlTG9ja0xldmVsKSB7CiAgICAgICAgLy8gbWFrZSBz\ndXJlIG9iamVjdCBpcyBhZGRlZCB0byB0cmFuc2FjdGlvbiBzbyBsb2NrIHdp\nbGwgZ2V0CiAgICAgICAgLy8gY2xlYXJlZCBvbiBjb21taXQvcm9sbGJhY2sK\nICAgICAgICBpZiAocmVhZExvY2tMZXZlbCAhPSBMb2NrTGV2ZWxzLkxPQ0tf\nTk9ORSkKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbCgpOwoKICAgICAgICBf\ncmVhZExvY2tMZXZlbCA9IHJlYWRMb2NrTGV2ZWw7CiAgICAgICAgX3dyaXRl\nTG9ja0xldmVsID0gd3JpdGVMb2NrTGV2ZWw7CiAgICAgICAgX2ZsYWdzIHw9\nIEZMQUdfUkVBRF9MT0NLRUQ7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1dS\nSVRFX0xPQ0tFRDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nbG9jayBsZXZlbCB0byB1c2Ugd2hlbiBsb2FkaW5nIHN0YXRlLgogICAgICov\nCiAgICBwcml2YXRlIGludCBjYWxjdWxhdGVMb2NrTGV2ZWwoYm9vbGVhbiBh\nY3RpdmUsIGJvb2xlYW4gZm9yV3JpdGUsCiAgICAgICAgRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKCFhY3RpdmUpCiAgICAgICAg\nICAgIHJldHVybiBMb2NrTGV2ZWxzLkxPQ0tfTk9ORTsKICAgICAgICBpZiAo\nZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAgZmV0Y2ggPSBfYnJva2VyLmdl\ndEZldGNoQ29uZmlndXJhdGlvbigpOwoKICAgICAgICBpZiAoX3JlYWRMb2Nr\nTGV2ZWwgPT0gLTEpCiAgICAgICAgICAgIF9yZWFkTG9ja0xldmVsID0gZmV0\nY2guZ2V0UmVhZExvY2tMZXZlbCgpOwogICAgICAgIGlmIChfd3JpdGVMb2Nr\nTGV2ZWwgPT0gLTEpCiAgICAgICAgICAgIF93cml0ZUxvY2tMZXZlbCA9IGZl\ndGNoLmdldFdyaXRlTG9ja0xldmVsKCk7CiAgICAgICAgcmV0dXJuIChmb3JX\ncml0ZSkgPyBfd3JpdGVMb2NrTGV2ZWwgOiBfcmVhZExvY2tMZXZlbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIE1ha2Ugc3VyZSB3ZSdyZSBsb2NrZWQgYXQg\ndGhlIGdpdmVuIGxldmVsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgb2J0\nYWluTG9ja3MoYm9vbGVhbiBhY3RpdmUsIGJvb2xlYW4gZm9yV3JpdGUsIGlu\ndCBsb2NrTGV2ZWwsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBPYmplY3Qgc2RhdGEpIHsKICAgICAgICBpZiAoIWFjdGl2ZSkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiB3ZSBoYXZlbid0IGJlZW4g\nbG9ja2VkIHlldCwgbG9jayBub3cgYXQgdGhlIGdpdmVuIGxldmVsCiAgICAg\nICAgaW50IGZsYWcgPSAoZm9yV3JpdGUpID8gRkxBR19XUklURV9MT0NLRUQg\nOiBGTEFHX1JFQURfTE9DS0VEOwogICAgICAgIGlmICgoX2ZsYWdzICYgZmxh\nZykgPT0gMCkgewogICAgICAgICAgICAvLyBtYWtlIHN1cmUgb2JqZWN0IGlz\nIGFkZGVkIHRvIHRyYW5zYWN0aW9uIHNvIGxvY2sgd2lsbCBnZXQKICAgICAg\nICAgICAgLy8gY2xlYXJlZCBvbiBjb21taXQvcm9sbGJhY2sKICAgICAgICAg\nICAgaWYgKGxvY2tMZXZlbCAhPSBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSkKICAg\nICAgICAgICAgICAgIHRyYW5zYWN0aW9uYWwoKTsKCiAgICAgICAgICAgIGlm\nIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICAgICAgZmV0Y2ggPSBfYnJv\na2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBfYnJv\na2VyLmdldExvY2tNYW5hZ2VyKCkubG9jayh0aGlzLCBsb2NrTGV2ZWwsCiAg\nICAgICAgICAgICAgICBmZXRjaC5nZXRMb2NrVGltZW91dCgpLCBzZGF0YSk7\nCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1JFQURfTE9DS0VEOwogICAg\nICAgICAgICBfZmxhZ3MgfD0gZmxhZzsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZWxlYXNlIGxvY2tzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcmVsZWFzZUxvY2tzKCkgewogICAgICAgIGlmIChfbG9jayAhPSBu\ndWxsKQogICAgICAgICAgICBfYnJva2VyLmdldExvY2tNYW5hZ2VyKCkucmVs\nZWFzZSh0aGlzKTsKICAgICAgICBfcmVhZExvY2tMZXZlbCA9IC0xOwogICAg\nICAgIF93cml0ZUxvY2tMZXZlbCA9IC0xOwogICAgICAgIF9mbGFncyAmPSB+\nRkxBR19SRUFEX0xPQ0tFRDsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfV1JJ\nVEVfTE9DS0VEOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbXBsZW1lbnRhdGlvbiBv\nZiBTdGF0ZU1hbmFnZXIgaW50ZXJmYWNlCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICog\nQHJldHVybiB3aGV0aGVyIG9yIG5vdCB1bmxvYWRlZCBmaWVsZHMgc2hvdWxk\nIGJlIGNsb3NlZC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc2VyaWFs\naXppbmcoKSB7CiAgICAgICAgLy8gaWYgdGhlIGJyb2tlciBpcyBpbiB0aGUg\nbWlkc3Qgb2YgYSBzZXJpYWxpemF0aW9uLCB0aGVuIG5vIHNwZWNpYWwKICAg\nICAgICAvLyBoYW5kbGluZyBzaG91bGQgYmUgcGVyZm9ybWVkIG9uIHRoZSBp\nbnN0YW5jZSwgYW5kIG5vIHN1YnNlcXVlbnQKICAgICAgICAvLyBsb2FkIHNo\nb3VsZCBoYXBwZW4KICAgICAgICBpZiAoX2Jyb2tlci5pc1NlcmlhbGl6aW5n\nKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKF9tZXRhLmlzRGV0YWNoYWJsZSgpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIERldGFjaE1hbmFnZXIucHJlU2VyaWFsaXplKHRo\naXMpOwoKICAgICAgICAgICAgbG9hZChfYnJva2VyLmdldEZldGNoQ29uZmln\ndXJhdGlvbigpLCBMT0FEX1NFUklBTElaRSwgbnVsbCwgbnVsbCwgCiAgICAg\nICAgICAgICAgICBmYWxzZSk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIHdyaXRlRGV0YWNoZWQoT2JqZWN0T3V0cHV0\nIG91dCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIEJp\ndFNldCBpZHhzID0gbmV3IEJpdFNldChfbWV0YS5nZXRGaWVsZHMoKS5sZW5n\ndGgpOwogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBib29sZWFuIGRldHNtID0gRGV0YWNoTWFuYWdlci53cml0ZURldGFjaGVk\nU3RhdGUodGhpcywgb3V0LCBpZHhzKTsKICAgICAgICAgICAgaWYgKGRldHNt\nKQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfREVUQUNISU5HOwoK\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRG\naWVsZHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5p\nc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7\nCiAgICAgICAgICAgICAgICBfc2luZ2xlLnNlcmlhbGl6ZShvdXQsICFpZHhz\nLmdldChpKSk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0\naHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIF9mbGFncyAmPSB+RkxBR19ERVRBQ0hJTkc7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBw\ncm94eURldGFjaGVkRGVzZXJpYWxpemVkKGludCBpZHgpIHsKICAgICAgICAv\nLyB3ZSBkb24ndCBzZXJpYWxpemUgc3RhdGUgbWFuYWdlciBpbXBscwogICAg\nICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzVHJhbnNhY3Rpb25hbCgpIHsKICAgICAgICAv\nLyBzcGVjaWFsIGNhc2UgZm9yIFRDTEVBTiwgd2hpY2ggd2Ugd2FudCB0byBh\ncHBlYXIgbm9uLXRyYW5zIHRvCiAgICAgICAgLy8gaW50ZXJuYWwgY29kZSwg\nYnV0IHdoaWNoIHB1YmxpY2x5IHNob3VsZCBiZSB0cmFuc2FjdGlvbmFsCiAg\nICAgICAgcmV0dXJuIF9zdGF0ZSA9PSBQQ1N0YXRlLlRDTEVBTiB8fCBfc3Rh\ndGUuaXNUcmFuc2FjdGlvbmFsKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaXNQZW5kaW5nVHJhbnNhY3Rpb25hbCgpIHsKICAgICAgICByZXR1cm4g\nX3N0YXRlLmlzUGVuZGluZ1RyYW5zYWN0aW9uYWwoKTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1Byb3Zpc2lvbmFsKCkgewogICAgICAgIHJldHVy\nbiBfc3RhdGUuaXNQcm92aXNpb25hbCgpOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzUGVyc2lzdGVudCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRl\nLmlzUGVyc2lzdGVudCgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nTmV3KCkgewogICAgICAgIHJldHVybiBfc3RhdGUuaXNOZXcoKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RlbGV0ZWQoKSB7CiAgICAgICAgcmV0\ndXJuIF9zdGF0ZS5pc0RlbGV0ZWQoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0RpcnR5KCkgewogICAgICAgIHJldHVybiBfc3RhdGUuaXNEaXJ0\neSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGV0YWNoZWQoKSB7\nCiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0RFVEFDSElORykgIT0g\nMDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldEdlbmVyaWNDb250ZXh0\nKCkgewogICAgICAgIHJldHVybiBfYnJva2VyOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZmV0Y2hPYmplY3RJZCgpIHsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NpZ25PYmplY3RJZCh0cnVlKTsKICAgICAgICAgICAgaWYg\nKF9vaWQgPT0gbnVsbCB8fCAhX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCku\nCiAgICAgICAgICAgICAgICBnZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKS5n\nZXRDb3B5T2JqZWN0SWRzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gX29p\nZDsKCiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9\nPSBDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRSkKICAgICAgICAgICAgICAg\nIHJldHVybiBfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLmNvcHlEYXRhU3Rv\ncmVJZChfb2lkLCBfbWV0YSk7CiAgICAgICAgICAgIHJldHVybiBBcHBsaWNh\ndGlvbklkcy5jb3B5KF9vaWQsIF9tZXRhKTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5z\nbGF0ZShyZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3Qg\nZ2V0UENQcmltYXJ5S2V5KE9iamVjdCBvaWQsIGludCBmaWVsZCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIE9iamVjdCBwayA9IEFwcGxpY2F0aW9uSWRzLmdldChvaWQs\nIGZtZCk7CiAgICAgICAgaWYgKHBrID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBDbGFzc01ldGFEYXRhIHJlbG1ldGEgPSBm\nbWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAgICBpZiAocmVs\nbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RB\nVEFTVE9SRQogICAgICAgICAgICAmJiBmbWQuZ2V0T2JqZWN0SWRGaWVsZFR5\ncGVDb2RlKCkgPT0gSmF2YVR5cGVzLkxPTkcpCiAgICAgICAgICAgIHBrID0g\nX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5uZXdEYXRhU3RvcmVJZChwaywg\ncmVsbWV0YSk7CiAgICAgICAgZWxzZSBpZiAocmVsbWV0YS5nZXRJZGVudGl0\neVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OIAogICAg\nICAgICAgICAmJiBmbWQuZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKSAhPSByZWxt\nZXRhLmdldE9iamVjdElkVHlwZSgpKQogICAgICAgICAgICBwayA9IEFwcGxp\nY2F0aW9uSWRzLmZyb21QS1ZhbHVlcyhuZXcgT2JqZWN0W10geyBwayB9LCBy\nZWxtZXRhKTsKICAgICAgICByZXR1cm4gX2Jyb2tlci5maW5kKHBrLCBmYWxz\nZSwgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGJ5dGUgcmVwbGFjZUZsYWdz\nKCkgewogICAgICAgIC8vIHdlIGFsd2F5cyB1c2UgbG9hZCByZXF1aXJlZCBz\nbyB0aGF0IHdlIGNhbiBkZXRlY3Qgd2hlbiBvYmplY3RzCiAgICAgICAgLy8g\nYXJlIHRvdWNoZWQgZm9yIGxvY2tpbmcgb3IgbWFraW5nIHRyYW5zYWN0aW9u\nYWwKICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VDYXBhYmxlLkxPQURfUkVR\nVUlSRUQ7CiAgICB9CgogICAgcHVibGljIFN0YXRlTWFuYWdlciByZXBsYWNl\nU3RhdGVNYW5hZ2VyKFN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIHJldHVy\nbiBzbTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhY2Nlc3NpbmdGaWVsZChp\nbnQgZmllbGQpIHsKICAgICAgICAvLyBwb3NzaWJseSBjaGFuZ2Ugc3RhdGUK\nICAgICAgICB0cnkgewogICAgICAgICAgICBiZWZvcmVSZWFkKGZpZWxkKTsK\nICAgICAgICAgICAgYmVmb3JlQWNjZXNzRmllbGQoZmllbGQpOwogICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAg\ndGhyb3cgdHJhbnNsYXRlKHJlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBMb2FkIHRoZSBnaXZlbiBmaWVsZCBiZWZvcmUgYWNjZXNzLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBiZWZvcmVBY2Nlc3NGaWVsZChp\nbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYm9vbGVhbiBhY3RpdmUgPSBfYnJva2VyLmlzQWN0aXZlKCk7\nCiAgICAgICAgICAgIGludCBsb2NrTGV2ZWwgPSBjYWxjdWxhdGVMb2NrTGV2\nZWwoYWN0aXZlLCBmYWxzZSwgbnVsbCk7CiAgICAgICAgICAgIGlmICghX2xv\nYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZp\nZWxkLCBsb2NrTGV2ZWwsIGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgYXNzaWduRmllbGQoZmllbGQsIGZhbHNlKTsK\nICAgICAgICAgICAgb2J0YWluTG9ja3MoYWN0aXZlLCBmYWxzZSwgbG9ja0xl\ndmVsLCBudWxsLCBudWxsKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRpcnR5KFN0cmluZyBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAg\nICAgICAgdGhyb3cgdHJhbnNsYXRlKG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1maWVsZCIsIGZpZWxkLAogICAgICAgICAgICAgICAgSW1wbEhl\nbHBlci5nZXRNYW5hZ2VkSW5zdGFuY2UoX3BjKS5nZXRDbGFzcygpKSkKICAg\nICAgICAgICAgICAgIC5zZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3Rh\nbmNlKCkpKTsKCiAgICAgICAgZGlydHkoZm1kLmdldEluZGV4KCksIG51bGws\nIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRpcnR5KGludCBmaWVs\nZCkgewogICAgICAgIGRpcnR5KGZpZWxkLCBudWxsLCB0cnVlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIE1ha2UgdGhlIGdpdmVuIGZpZWxkIGRpcnR5Lgog\nICAgICoKICAgICAqIEBwYXJhbSBtdXRhdGUgaWYgbnVsbCwgbWF5IGJlIGFu\nIFNDTyBtdXRhdGlvbjsgaWYgdHJ1ZSwgaXMgY2VydGFpbmx5CiAgICAgKiBh\nIG11dGF0aW9uIChvciBhdCBsZWFzdCB0cmVhdCBhcyBvbmUpCiAgICAgKiBA\ncmV0dXJuIHtAbGluayBCb29sZWFuI0ZBTFNFfSBpZiB0aGlzIGluc3RhbmNl\nIHdhcyBhbHJlYWR5IGRpcnR5LAogICAgICogPGNvZGU+bnVsbDwvY29kZT4g\naWYgaXQgd2FzIGRpcnR5IGJ1dCBub3Qgc2luY2UgZmx1c2gsIGFuZAogICAg\nICoge0BsaW5rIEJvb2xlYW4jVFJVRX0gaWYgaXQgd2FzIG5vdCBkaXJ0eQog\nICAgICovCiAgICBwcml2YXRlIEJvb2xlYW4gZGlydHkoaW50IGZpZWxkLCBC\nb29sZWFuIG11dGF0ZSwgYm9vbGVhbiBsb2FkRmV0Y2hHcm91cCkgewogICAg\nICAgIGJvb2xlYW4gbG9ja2VkID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBu\nZXdGbHVzaCA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gY2xlYW4gPSBmYWxz\nZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgaWYgKCFp\nc05ldygpIHx8IGlzRmx1c2hlZCgpKSB7CiAgICAgICAgICAgICAgICBpZiAo\nZm1kLmdldFVwZGF0ZVN0cmF0ZWd5KCkgPT0gVXBkYXRlU3RyYXRlZ2llcy5S\nRVNUUklDVCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAg\nICAgICgidXBkYXRlLXJlc3RyaWN0IiwgZm1kKSk7CiAgICAgICAgICAgICAg\nICBpZiAoZm1kLmdldFVwZGF0ZVN0cmF0ZWd5KCkgPT0gVXBkYXRlU3RyYXRl\nZ2llcy5JR05PUkUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xl\nYW4uRkFMU0U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc0Vt\nYmVkZGVkKCkpIHsKICAgICAgICAgICAgICAgIC8vIG5vdGlmeSBvd25lciBv\nZiBjaGFuZ2UKICAgICAgICAgICAgICAgIF9vd25lci5kaXJ0eShfb3duZXJJ\nbmRleCwgQm9vbGVhbi5UUlVFLCBsb2FkRmV0Y2hHcm91cCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGlzIHRoaXMgYSBkaXJlY3QgbXV0YXRp\nb24gb2YgYW4gc2NvIGZpZWxkPwogICAgICAgICAgICBpZiAobXV0YXRlID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRBVEU6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FM\nRU5EQVI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JK\nRUNUOgogICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGUgPSBCb29sZWFu\nLlRSVUU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAg\nICAgICAgICAgICBtdXRhdGUgPQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKGZtZC5pc0VtYmVkZGVkKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVh\nbi5GQUxTRTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAg\nICAgbXV0YXRlID0gQm9vbGVhbi5GQUxTRTsgLy8gbm90IHNjbwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBwb3Nz\naWJseSBjaGFuZ2Ugc3RhdGUKICAgICAgICAgICAgYm9vbGVhbiBhY3RpdmUg\nPSBfYnJva2VyLmlzQWN0aXZlKCk7CiAgICAgICAgICAgIGNsZWFuID0gIV9z\ndGF0ZS5pc0RpcnR5KCk7IC8vIGludGVudGlvbmFsIGRpcmVjdCBhY2Nlc3MK\nCiAgICAgICAgICAgIC8vIGZpcmUgZXZlbnQgZmFzdCBiZWZvcmUgc3RhdGUg\nY2hhbmdlLgogICAgICAgICAgICBpZiAoY2xlYW4pCiAgICAgICAgICAgICAg\nICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0RJ\nUlRZKTsKICAgICAgICAgICAgaWYgKGFjdGl2ZSkgewogICAgICAgICAgICAg\nICAgaWYgKF9icm9rZXIuZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAgICAg\nICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmJlZm9yZU9wdGltaXN0aWNXcml0\nZSh0aGlzLCBmaWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgbXV0YXRl\nLmJvb2xlYW5WYWx1ZSgpKSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlV3JpdGUo\ndGhpcywgZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgIG11dGF0ZS5i\nb29sZWFuVmFsdWUoKSkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZtZC5n\nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lT\nVEVOVCkgewogICAgICAgICAgICAgICAgaWYgKGlzUGVyc2lzdGVudCgpICYm\nICFfYnJva2VyLmdldE5vbnRyYW5zYWN0aW9uYWxXcml0ZSgpKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJub24tdHJhbnMt\nd3JpdGUiKSkuc2V0RmFpbGVkT2JqZWN0CiAgICAgICAgICAgICAgICAgICAg\nICAgIChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CgogICAgICAgICAgICAgICAg\nc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlTm9udHJhbnNhY3Rpb25hbFdyaXRl\nKHRoaXMsIGZpZWxkLAogICAgICAgICAgICAgICAgICAgIG11dGF0ZS5ib29s\nZWFuVmFsdWUoKSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0gMCkgewogICAgICAgICAgICAg\nICAgbmV3Rmx1c2ggPSAoX2ZsYWdzICYgRkxBR19GTFVTSEVEX0RJUlRZKSA9\nPSAwOwogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hFRF9E\nSVJUWTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jaygpOwogICAg\nICAgICAgICBsb2NrZWQgPSB0cnVlOwoKICAgICAgICAgICAgLy8gbm90ZSB0\naGF0IHRoZSBmaWVsZCBpcyBpbiBuZWVkIG9mIGZsdXNoaW5nIGFnYWluLCBh\nbmQgdGVsbCB0aGUKICAgICAgICAgICAgLy8gYnJva2VyIHRvbwogICAgICAg\nICAgICBfZmx1c2guY2xlYXIoZmllbGQpOwogICAgICAgICAgICBfYnJva2Vy\nLnNldERpcnR5KHRoaXMsIG5ld0ZsdXNoICYmICFjbGVhbik7CgogICAgICAg\nICAgICAvLyBzYXZlIHRoZSBmaWVsZCBmb3Igcm9sbGJhY2sgaWYgbmVlZGVk\nCiAgICAgICAgICAgIHNhdmVGaWVsZChmaWVsZCk7CgogICAgICAgICAgICAv\nLyBkaXJ0eSB0aGUgZmllbGQgYW5kIG1hcmsgbG9hZGVkOyBsb2FkIGZldGNo\nIGdyb3VwIGlmIG5lZWRlZAogICAgICAgICAgICBpbnQgbG9ja0xldmVsID0g\nY2FsY3VsYXRlTG9ja0xldmVsKGFjdGl2ZSwgdHJ1ZSwgbnVsbCk7CiAgICAg\nICAgICAgIGlmICghX2RpcnR5LmdldChmaWVsZCkpIHsKICAgICAgICAgICAg\nICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBf\nZGlydHkuc2V0KGZpZWxkKTsKCiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhlIGZpZWxkJ3MgZmV0Y2ggZ3JvdXAgaXMgbG9hZGVkCiAgICAgICAg\nICAgICAgICBpZiAobG9hZEZldGNoR3JvdXAgJiYgaXNQZXJzaXN0ZW50KCkK\nICAgICAgICAgICAgICAgICAgICAmJiBmbWQuZ2V0TWFuYWdlbWVudCgpID09\nIGZtZC5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgICAgICBs\nb2FkRmllbGQoZmllbGQsIGxvY2tMZXZlbCwgdHJ1ZSwgdHJ1ZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgb2J0YWluTG9ja3MoYWN0aXZlLCB0cnVl\nLCBsb2NrTGV2ZWwsIG51bGwsIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNs\nYXRlKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\nbG9ja2VkKQogICAgICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQoK\nICAgICAgICBpZiAoY2xlYW4pCiAgICAgICAgICAgIHJldHVybiBCb29sZWFu\nLlRSVUU7CiAgICAgICAgaWYgKG5ld0ZsdXNoKSB7CiAgICAgICAgICAgIC8v\nIHRoaXMgZXZlbnQgY2FuIGJlIGZpcmVkIGxhdGVyIGNhdXNlIHdlJ3JlIGFs\ncmVhZHkgZGlydHkuCiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChM\naWZlY3ljbGVFdmVudC5CRUZPUkVfRElSVFlfRkxVU0hFRCk7CiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQm9v\nbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUgcG9zdC1k\naXJ0eSBldmVudHMgYWZ0ZXIgZmllbGQgdmFsdWUgY2hhbmdlcy4KICAgICAq\nCiAgICAgKiBAcGFyYW0gc3RhdHVzIHJldHVybiB2YWx1ZSBmcm9tIHtAbGlu\nayAjZGlydHkoaW50LCBCb29sZWFuLCBib29sZWFuKX0KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBvc3REaXJ0eShCb29sZWFuIHN0YXR1cykgewogICAg\nICAgIGlmIChCb29sZWFuLlRSVUUuZXF1YWxzKHN0YXR1cykpCiAgICAgICAg\nICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9E\nSVJUWSk7CiAgICAgICAgZWxzZSBpZiAoc3RhdHVzID09IG51bGwpCiAgICAg\nICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRF\nUl9ESVJUWV9GTFVTSEVEKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZW1v\ndmVkKGludCBmaWVsZCwgT2JqZWN0IHJlbW92ZWQsIGJvb2xlYW4ga2V5KSB7\nCiAgICAgICAgaWYgKHJlbW92ZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBkZXJlZmVyZW5j\nZSBkZXBlbmRlbnQgZmllbGRzLCBkZWxldGUgZW1iZWRkZWQKICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgICAgIFZhbHVlTWV0YURhdGEgdm1kID0gKGtleSkgPyBmbWQu\nZ2V0S2V5KCkgOiBmbWQuZ2V0RWxlbWVudCgpOwogICAgICAgICAgICBpZiAo\ndm1kLmlzRW1iZWRkZWRQQygpKQogICAgICAgICAgICAgICAgX3NpbmdsZS5k\nZWxldGUodm1kLCByZW1vdmVkLCBudWxsKTsKICAgICAgICAgICAgZWxzZSBp\nZiAodm1kLmdldENhc2NhZGVEZWxldGUoKSA9PSBWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfQVVUTykKICAgICAgICAgICAgICAgIF9zaW5nbGUuZGVyZWZlcmVu\nY2VEZXBlbmRlbnQocmVtb3ZlZCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUo\ncmUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IG5ld1By\nb3h5KGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\nX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0\nZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBuZXdGaWVsZFByb3h5\nKGZpZWxkKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0VHlwZUNvZGUoKSkg\newogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAg\nICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBqYXZhLnNxbC5E\nYXRlLmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgamF2\nYS5zcWwuRGF0ZShTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CiAgICAg\nICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGphdmEu\nc3FsLlRpbWVzdGFtcC5jbGFzcykKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IGphdmEuc3FsLlRpbWVzdGFtcChTeXN0ZW0uY3VycmVudFRpbWVN\naWxsaXMoKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVk\nVHlwZSgpID09IGphdmEuc3FsLlRpbWUuY2xhc3MpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBqYXZhLnNxbC5UaW1lKFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0\nZSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAg\nICAgICAgICAgICAgIHJldHVybiBDYWxlbmRhci5nZXRJbnN0YW5jZSgpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBIYXNoTWFwKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3RmllbGRQcm94eShpbnQgZmll\nbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZp\nZWxkKGZpZWxkKTsKICAgICAgICBQcm94eU1hbmFnZXIgbWdyID0gX2Jyb2tl\nci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldFByb3h5TWFu\nYWdlckluc3RhbmNlKCk7CiAgICAgICAgT2JqZWN0IGluaXQgPSBmbWQuZ2V0\nSW5pdGlhbGl6ZXIoKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRB\nVEU6CiAgICAgICAgICAgICAgICByZXR1cm4gbWdyLm5ld0RhdGVQcm94eShm\nbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgIHJldHVybiBtZ3IubmV3\nQ2FsZW5kYXJQcm94eShmbWQuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAg\nICAgICAgICAgICAgaW5pdCBpbnN0YW5jZW9mIFRpbWVab25lID8gKFRpbWVa\nb25lKSBpbml0IDogbnVsbCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICByZXR1cm4gbWdyLm5ld0Nv\nbGxlY3Rpb25Qcm94eShmbWQuZ2V0UHJveHlUeXBlKCksCiAgICAgICAgICAg\nICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSwK\nICAgICAgICAgICAgICAgICAgICBpbml0IGluc3RhbmNlb2YgQ29tcGFyYXRv\nciA/IChDb21wYXJhdG9yKSBpbml0IDogbnVsbCk7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIHJldHVybiBtZ3Iu\nbmV3TWFwUHJveHkoZm1kLmdldFByb3h5VHlwZSgpLAogICAgICAgICAgICAg\nICAgICAgIGZtZC5nZXRLZXkoKS5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAg\nICAgICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlw\nZSgpLAogICAgICAgICAgICAgICAgICAgIGluaXQgaW5zdGFuY2VvZiBDb21w\nYXJhdG9yID8gKENvbXBhcmF0b3IpIGluaXQgOiBudWxsKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaXNEZWZhdWx0VmFsdWUoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsK\nICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQp\nOwogICAgICAgICAgICBib29sZWFuIHJldCA9IF9zaW5nbGUuaXNEZWZhdWx0\nVmFsdWUoKTsKICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAg\nICAgICByZXR1cm4gcmV0OwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KICAgIC8vIFJlY29yZCB0aGF0IHRoZSBmaWVsZCBpcyBkaXJ0eSAod2hp\nY2ggbWlnaHQgbG9hZCBERkcpCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJs\naWMgdm9pZCBzZXR0aW5nQm9vbGVhbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYywgaW50IGZpZWxkLAogICAgICAgIGJvb2xlYW4gY3VyVmFsLCBib29s\nZWFuIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VU\nX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAm\nJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7\nCiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4u\nRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUu\nc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAg\nIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldHRpbmdCeXRlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBp\nbnQgZmllbGQsCiAgICAgICAgYnl0ZSBjdXJWYWwsIGJ5dGUgbmV3VmFsLCBp\nbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAg\nICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0\nKGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9Cgog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29s\nZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09\nIFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUJ5dGVGaWVs\nZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBj\nLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ0NoYXJG\naWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAg\nICBjaGFyIGN1clZhbCwgY2hhciBuZXdWYWwsIGludCBzZXQpIHsKICAgICAg\nICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5l\nd1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlL\nZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5\nKGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBuZXdWYWwp\nOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nRG91YmxlRmllbGQoUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgZG91YmxlIGN1clZh\nbCwgZG91YmxlIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQg\nIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1\nclZhbCAmJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShm\naWVsZCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJv\nb2xlYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9z\naW5nbGUuc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAg\nICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAg\nICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0dGluZ0Zsb2F0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxl\nIHBjLCBpbnQgZmllbGQsCiAgICAgICAgZmxvYXQgY3VyVmFsLCBmbG9hdCBu\nZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1P\nVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xv\nYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAg\nICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNF\nLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0b3Jl\nRmxvYXRGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFj\nZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3RE\naXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\ndGluZ0ludEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxk\nLAogICAgICAgIGludCBjdXJWYWwsIGludCBuZXdWYWwsIGludCBzZXQpIHsK\nICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAg\naWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1By\naW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9\nIGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIp\nOwogICAgICAgICAgICBfc2luZ2xlLnN0b3JlSW50RmllbGQoZmllbGQsIG5l\nd1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdMb25nRmllbGQoUGVyc2lz\ndGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgbG9uZyBjdXJW\nYWwsIGxvbmcgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAh\nPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3Vy\nVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZp\nZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9v\nbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3Np\nbmdsZS5zdG9yZUxvbmdGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAg\nICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAg\nICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0dGluZ09iamVjdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkLAogICAgICAgIE9iamVjdCBjdXJWYWwsIE9iamVjdCBu\nZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1P\nVEUpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGlmIChfbG9hZGVkLmdldChm\naWVsZCkpIHsKICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFs\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAg\nICAvLyBvbmx5IGNvbXBhcmUgbmV3IHRvIG9sZCB2YWx1ZXMgaWYgdGhlIGNv\nbXBhcmlzb24gaXMgZ29pbmcgdG8KICAgICAgICAgICAgICAgIC8vIGJlIGNo\nZWFwIC0tIGRvbid0IGNvbXBhcmUgY29sbGVjdGlvbnMsIG1hcHMsIFVEVHMK\nICAgICAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFS\nUkFZOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExF\nQ1RJT046CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQ\nOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAg\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAg\nICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdW\nYWwgIT0gbnVsbCAmJiBuZXdWYWwuZXF1YWxzKGN1clZhbCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0\naGlzIGlzIGEgZGVwZW5kZW50IHVubG9hZGVkIGZpZWxkLCBtYWtlIHN1cmUg\ndG8gbG9hZAogICAgICAgICAgICAgICAgLy8gaXQgbm93CiAgICAgICAgICAg\nICAgICBpZiAoZm1kLmdldENhc2NhZGVEZWxldGUoKSA9PSBWYWx1ZU1ldGFE\nYXRhLkNBU0NBREVfQVVUTwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5n\nZXRLZXkoKS5nZXRDYXNjYWRlRGVsZXRlKCkKICAgICAgICAgICAgICAgICAg\nICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTwogICAgICAgICAgICAg\nICAgICAgIHx8IGZtZC5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZURlbGV0ZSgp\nCiAgICAgICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURF\nX0FVVE8pCiAgICAgICAgICAgICAgICAgICAgY3VyVmFsID0gZmV0Y2hPYmpl\nY3RGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFz\nc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgICAgIGlm\nIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQp\nCiAgICAgICAgICAgICAgICBhc3NlcnROb3RNYW5hZ2VkT2JqZWN0SWQobmV3\nVmFsKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9v\nbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgaWYg\nKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xl\nLnN0b3JlT2JqZWN0RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAg\nICAgICBfc2luZ2xlLnVucHJveHkoKTsKICAgICAgICAgICAgICAgIF9zaW5n\nbGUuZGVyZWZlcmVuY2VEZXBlbmRlbnQoKTsKICAgICAgICAgICAgICAgIF9z\naW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfc2lu\nZ2xlLnN0b3JlT2JqZWN0RmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAg\nICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAg\nICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldHRpbmdTaG9ydEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkLAogICAgICAgIHNob3J0IGN1clZhbCwgc2hvcnQgbmV3\nVmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RF\nKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2Fk\nZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAg\nICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwg\nc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZVNo\nb3J0RmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGly\ndHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRp\nbmdTdHJpbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVs\nZCwKICAgICAgICBTdHJpbmcgY3VyVmFsLCBTdHJpbmcgbmV3VmFsLCBpbnQg\nc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAg\nICAgICAgIGlmIChTdHJpbmdVdGlscy5lcXVhbHMobmV3VmFsLCBjdXJWYWwp\nICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxk\nKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVh\nbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3Npbmds\nZS5zdG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAg\nICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIERpc2FsbG93cyBjaGFuZ2luZyBwcmltYXJ5IGtleSBmaWVsZHMgZm9y\nIGluc3RhbmNlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFzc2VydE5v\nUHJpbWFyeUtleUNoYW5nZShpbnQgZmllbGQpIHsKICAgICAgICBpZiAoX29p\nZCAhPSBudWxsICYmIF9tZXRhLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlL\nZXkoKSkKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKG5ldyBJbnZhbGlk\nU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICgiY2hh\nbmdlLWlkZW50aXR5IikpLnNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5z\ndGFuY2UoKSkpOwogICAgfQoKICAgIC8qKgogICAgICogRGlzYWxsb3dzIHNl\ndHRpbmcgYW4gb2JqZWN0IGlkIGZpZWxkIHRvIGEgbWFuYWdlZCBpbnN0YW5j\nZS4KICAgICAqLwogICAgdm9pZCBhc3NlcnROb3RNYW5hZ2VkT2JqZWN0SWQo\nT2JqZWN0IHZhbCkgewogICAgICAgIGlmICh2YWwgIT0gbnVsbAogICAgICAg\nICAgICAmJiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh2YWws\nCiAgICAgICAgICAgICAgICAgZ2V0Q29udGV4dCgpLmdldENvbmZpZ3VyYXRp\nb24oKSkpLnBjR2V0R2VuZXJpY0NvbnRleHQoKSE9IG51bGwpCiAgICAgICAg\nICAgIHRocm93IHRyYW5zbGF0ZShuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAoIm1hbmFnZWQtb2lkIiwgRXhj\nZXB0aW9ucy50b1N0cmluZyh2YWwpLAogICAgICAgICAgICAgICAgICAgIEV4\nY2VwdGlvbnMudG9TdHJpbmcoZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuCiAg\nICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3Rh\nbmNlKCkpKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBEZWxlZ2F0ZSB0byBGaWVsZE1hbmFnZXIKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBwcm92\naWRlZEJvb2xlYW5GaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCwKICAgICAgICBib29sZWFuIGN1clZhbCkgewogICAgICAgIF9mbS5z\ndG9yZUJvb2xlYW5GaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBwcm92aWRlZEJ5dGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMsIGludCBmaWVsZCwKICAgICAgICBieXRlIGN1clZhbCkgewogICAg\nICAgIF9mbS5zdG9yZUJ5dGVGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZENoYXJGaWVsZChQZXJzaXN0ZW5j\nZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBjaGFyIGN1clZhbCkg\newogICAgICAgIF9mbS5zdG9yZUNoYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZERvdWJsZUZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGRvdWJs\nZSBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVEb3VibGVGaWVsZChmaWVs\nZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZEZs\nb2F0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAg\nICAgICAgZmxvYXQgY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlRmxvYXRG\naWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBw\ncm92aWRlZEludEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZp\nZWxkLAogICAgICAgIGludCBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVJ\nbnRGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBwcm92aWRlZExvbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGlu\ndCBmaWVsZCwKICAgICAgICBsb25nIGN1clZhbCkgewogICAgICAgIF9mbS5z\ndG9yZUxvbmdGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBwcm92aWRlZE9iamVjdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYywgaW50IGZpZWxkLAogICAgICAgIE9iamVjdCBjdXJWYWwpIHsKICAg\nICAgICBfZm0uc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZFNob3J0RmllbGQoUGVyc2lz\ndGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgc2hvcnQgY3Vy\nVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlU2hvcnRGaWVsZChmaWVsZCwgY3Vy\nVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZFN0cmluZ0Zp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAg\nIFN0cmluZyBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVTdHJpbmdGaWVs\nZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBy\nZXBsYWNlQm9vbGVhbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50\nIGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaEJvb2xlYW5GaWVs\nZChmaWVsZCk7CiAgICB9CgogICAgcHVibGljIGJ5dGUgcmVwbGFjZUJ5dGVG\naWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAg\nICAgIHJldHVybiBfZm0uZmV0Y2hCeXRlRmllbGQoZmllbGQpOwogICAgfQoK\nICAgIHB1YmxpYyBjaGFyIHJlcGxhY2VDaGFyRmllbGQoUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZl\ndGNoQ2hhckZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgZG91Ymxl\nIHJlcGxhY2VEb3VibGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGlu\ndCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hEb3VibGVGaWVs\nZChmaWVsZCk7CiAgICB9CgogICAgcHVibGljIGZsb2F0IHJlcGxhY2VGbG9h\ndEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAg\nICAgICAgcmV0dXJuIF9mbS5mZXRjaEZsb2F0RmllbGQoZmllbGQpOwogICAg\nfQoKICAgIHB1YmxpYyBpbnQgcmVwbGFjZUludEZpZWxkKFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5m\nZXRjaEludEZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBy\nZXBsYWNlTG9uZ0ZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZp\nZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaExvbmdGaWVsZChmaWVs\nZCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCByZXBsYWNlT2JqZWN0Rmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAg\nICByZXR1cm4gX2ZtLmZldGNoT2JqZWN0RmllbGQoZmllbGQpOwogICAgfQoK\nICAgIHB1YmxpYyBzaG9ydCByZXBsYWNlU2hvcnRGaWVsZChQZXJzaXN0ZW5j\nZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0u\nZmV0Y2hTaG9ydEZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIHJlcGxhY2VTdHJpbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMs\nIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hTdHJpbmdG\naWVsZChmaWVsZCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgRmllbGRN\nYW5hZ2VyCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCgogICAgcHVibGljIGJvb2xlYW4gZmV0Y2hCb29sZWFuKGludCBmaWVsZCkg\newogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQo\nZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAg\nICAgICAgICAgIHJldHVybiBmZXRjaEJvb2xlYW5GaWVsZChmaWVsZCk7Cgog\nICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7\nCiAgICAgICAgcmV0dXJuICgoQm9vbGVhbikgZm1kLmdldEV4dGVybmFsVmFs\ndWUodmFsLCBfYnJva2VyKSkuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gZmV0Y2hCb29sZWFuRmllbGQoaW50IGZpZWxkKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZp\nZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNl\nKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZp\nZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hCb29sZWFu\nRmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYnl0ZSBm\nZXRjaEJ5dGUoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQu\naXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoQnl0\nZUZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmll\nbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZt\nZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLmJ5dGVWYWx1ZSgp\nOwogICAgfQoKICAgIHB1YmxpYyBieXRlIGZldGNoQnl0ZUZpZWxkKGludCBm\naWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAg\nIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNl\nLCBmYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2lu\nZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNo\nQnl0ZUZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGNo\nYXIgZmV0Y2hDaGFyKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICgh\nZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRj\naENoYXJGaWVsZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRj\naEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoQ2hhcmFj\ndGVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5jaGFy\nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgY2hhciBmZXRjaENoYXJGaWVs\nZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAg\nICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05F\nLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9w\nYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3Npbmds\nZS5mZXRjaENoYXJGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBkb3VibGUgZmV0Y2hEb3VibGUoaW50IGZpZWxkKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAg\ncmV0dXJuIGZldGNoRG91YmxlRmllbGQoZmllbGQpOwoKICAgICAgICBPYmpl\nY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJl\ndHVybiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJv\na2VyKSkuZG91YmxlVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgZG91Ymxl\nIGZldGNoRG91YmxlRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQo\nZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2Nr\nTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAg\nIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hEb3VibGVGaWVsZChmaWVsZCk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBmbG9hdCBmZXRjaEZsb2F0KGludCBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVk\nKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaEZsb2F0RmllbGQoZmllbGQp\nOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFs\nc2UpOwogICAgICAgIHJldHVybiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFs\nVmFsdWUodmFsLCBfYnJva2VyKSkuZmxvYXRWYWx1ZSgpOwogICAgfQoKICAg\nIHB1YmxpYyBmbG9hdCBmZXRjaEZsb2F0RmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgh\nX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxk\nKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsK\nCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hGbG9hdEZpZWxk\nKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBmZXRjaElu\ndChpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9t\nZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVy\nbmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hJbnRGaWVsZChm\naWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxk\nLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0\nZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5pbnRWYWx1ZSgpOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgZmV0Y2hJbnRGaWVsZChpbnQgZmllbGQpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFf\nbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQo\nZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoK\nICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQp\nOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaEludEZpZWxkKGZp\nZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGxvbmcgZmV0Y2hMb25n\nKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21l\ndGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJu\nYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaExvbmdGaWVsZChm\naWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxk\nLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0\nZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5sb25nVmFsdWUoKTsKICAgIH0K\nCiAgICBwdWJsaWMgbG9uZyBmZXRjaExvbmdGaWVsZChpbnQgZmllbGQpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmll\nbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2Up\nOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmll\nbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaExvbmdGaWVs\nZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0\nY2hPYmplY3QoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQu\naXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoT2Jq\nZWN0RmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hG\naWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVybiBmbWQuZ2V0RXh0\nZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3QgZmV0Y2hPYmplY3RGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVk\nLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQs\nIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAg\nICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAg\nICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaE9iamVjdEZpZWxkKGZpZWxk\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHNob3J0IGZldGNoU2hvcnQo\naW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0\nYS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5h\nbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoU2hvcnRGaWVsZChm\naWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxk\nLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0\nZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5zaG9ydFZhbHVlKCk7CiAgICB9\nCgogICAgcHVibGljIHNob3J0IGZldGNoU2hvcnRGaWVsZChpbnQgZmllbGQp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2Fk\nRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFs\nc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaFNob3J0\nRmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5n\nIGZldGNoU3RyaW5nKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICgh\nZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRj\naFN0cmluZ0ZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZl\ndGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKFN0cmlu\nZykgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKTsKICAgIH0K\nCiAgICBwdWJsaWMgU3RyaW5nIGZldGNoU3RyaW5nRmllbGQoaW50IGZpZWxk\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9h\nZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZh\nbHNlKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUs\nIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hTdHJp\nbmdGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHN0b3JlQm9vbGVhbihpbnQgZmllbGQsIGJvb2xlYW4gZXh0ZXJuYWxWYWwp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxk\nKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQog\nICAgICAgICAgICBzdG9yZUJvb2xlYW5GaWVsZChmaWVsZCwgZXh0ZXJuYWxW\nYWwpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBPYmplY3QgdmFsID0g\nKGV4dGVybmFsVmFsKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7\nCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZh\nbHVlKHZhbCwgX2Jyb2tlcikpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzdG9yZUJvb2xlYW5GaWVsZChpbnQgZmllbGQsIGJvb2xlYW4g\nY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIF9zaW5nbGUuc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIGN1clZh\nbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZp\nZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAg\nICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzdG9yZUJ5dGUoaW50IGZpZWxkLCBieXRlIGV4\ndGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0\nYS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5h\nbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVCeXRlRmllbGQoZmllbGQsIGV4\ndGVybmFsVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmll\nbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBCeXRlKGV4dGVybmFs\nVmFsKSwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzdG9yZUJ5dGVGaWVsZChpbnQgZmllbGQsIGJ5dGUgY3Vy\nVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIF9zaW5nbGUuc3RvcmVCeXRlRmllbGQoZmllbGQsIGN1clZhbCk7CiAg\nICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsK\nICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAg\nICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzdG9yZUNoYXIoaW50IGZpZWxkLCBjaGFyIGV4dGVybmFs\nVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQo\nKSkKICAgICAgICAgICAgc3RvcmVDaGFyRmllbGQoZmllbGQsIGV4dGVybmFs\nVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmll\nbGQsIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBDaGFyYWN0ZXIoZXh0ZXJuYWxW\nYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHN0b3JlQ2hhckZpZWxkKGludCBmaWVsZCwgY2hhciBjdXJW\nYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgX3NpbmdsZS5zdG9yZUNoYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAg\nICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwog\nICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAg\nICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHN0b3JlRG91YmxlKGludCBmaWVsZCwgZG91YmxlIGV4dGVy\nbmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6\nZWQoKSkKICAgICAgICAgICAgc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgZXh0\nZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVs\nZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUobmV3IERvdWJsZShleHRlcm5h\nbFZhbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc3RvcmVEb3VibGVGaWVsZChpbnQgZmllbGQsIGRvdWJs\nZSBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgX3NpbmdsZS5zdG9yZURvdWJsZUZpZWxkKGZpZWxkLCBjdXJW\nYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBm\naWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAg\nICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc3RvcmVGbG9hdChpbnQgZmllbGQsIGZsb2F0\nIGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVGbG9hdEZpZWxkKGZpZWxk\nLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9y\nZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShuZXcgRmxvYXQoZXh0\nZXJuYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHN0b3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZs\nb2F0IGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBfc2luZ2xlLnN0b3JlRmxvYXRGaWVsZChmaWVsZCwgY3Vy\nVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwog\nICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlSW50KGludCBmaWVsZCwgaW50IGV4\ndGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0\nYS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5h\nbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVJbnRGaWVsZChmaWVsZCwgZXh0\nZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVs\nZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUoTnVtYmVycy52YWx1ZU9mKGV4\ndGVybmFsVmFsKSwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzdG9yZUludEZpZWxkKGludCBmaWVsZCwgaW50\nIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlSW50RmllbGQoZmllbGQsIGN1clZhbCk7\nCiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAg\nICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzdG9yZUxvbmcoaW50IGZpZWxkLCBsb25nIGV4dGVy\nbmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6\nZWQoKSkKICAgICAgICAgICAgc3RvcmVMb25nRmllbGQoZmllbGQsIGV4dGVy\nbmFsVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQo\nZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKE51bWJlcnMudmFsdWVPZihleHRl\ncm5hbFZhbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc3RvcmVMb25nRmllbGQoaW50IGZpZWxkLCBsb25n\nIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBjdXJWYWwp\nOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVs\nZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAg\nICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc3RvcmVPYmplY3QoaW50IGZpZWxkLCBPYmplY3Qg\nZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9t\nZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBleHRlcm5hbFZhbCA9IGZt\nZC5vcmRlcihleHRlcm5hbFZhbCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVPYmplY3RGaWVsZChmaWVs\nZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Rv\ncmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUoZXh0ZXJuYWxWYWws\nIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZU9iamVj\ndEZpZWxkKGludCBmaWVsZCwgT2JqZWN0IGN1clZhbCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0b3Jl\nT2JqZWN0RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIF9zaW5n\nbGUucHJveHkodHJ1ZSwgZmFsc2UpOwogICAgICAgICAgICByZXBsYWNlRmll\nbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNldExvYWRl\nZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBu\ndWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVTaG9y\ndChpbnQgZmllbGQsIHNob3J0IGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3Rv\ncmVTaG9ydEZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRW\nYWx1ZShuZXcgU2hvcnQoZXh0ZXJuYWxWYWwpLAogICAgICAgICAgICAgICAg\nX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU2hvcnRG\naWVsZChpbnQgZmllbGQsIHNob3J0IGN1clZhbCkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0b3JlU2hv\ncnRGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZp\nZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2Fk\nZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwg\nbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU3Ry\naW5nKGludCBmaWVsZCwgU3RyaW5nIGV4dGVybmFsVmFsKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAg\nc3RvcmVTdHJpbmdGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZp\nZWxkVmFsdWUoZXh0ZXJuYWxWYWwsIF9icm9rZXIpKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzdG9yZVN0cmluZ0ZpZWxkKGludCBmaWVsZCwgU3RyaW5n\nIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlU3RyaW5nRmllbGQoZmllbGQsIGN1clZh\nbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZp\nZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAg\nICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSBnaXZlbiBmaWVsZCB2YWx1ZSBp\nbnRvIHRoZSBnaXZlbiBmaWVsZCBtYW5hZ2VyLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgc3RvcmVGaWVsZChpbnQgZmllbGQsIE9iamVjdCB2YWwsIEZp\nZWxkTWFuYWdlciBmbSkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\nX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmIChmbWQgPT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLWZpZWxkLWluZGV4IiwKICAgICAgICAgICAgICAgIFN0cmluZy52\nYWx1ZU9mKGZpZWxkKSwgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkuCiAg\nICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3Rh\nbmNlKCkpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoK\nICAgICAgICAgICAgICAgIGJvb2xlYW4gYm9vbCA9IHZhbCAhPSBudWxsICYm\nICgoQm9vbGVhbikgdmFsKS5ib29sZWFuVmFsdWUoKTsKICAgICAgICAgICAg\nICAgIGZtLnN0b3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBib29sKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFOgogICAgICAgICAgICAgICAgYnl0ZSBiID0gKHZhbCA9PSBudWxsKSA/\nIDAgOiAoKE51bWJlcikgdmFsKS5ieXRlVmFsdWUoKTsKICAgICAgICAgICAg\nICAgIGZtLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBiKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgog\nICAgICAgICAgICAgICAgY2hhciBjID0gKHZhbCA9PSBudWxsKSA/IDAgOiAo\nKENoYXJhY3RlcikgdmFsKS5jaGFyVmFsdWUoKTsKICAgICAgICAgICAgICAg\nIGZtLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBjKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAg\nICAgICAgICAgICAgICBkb3VibGUgZCA9ICh2YWwgPT0gbnVsbCkgPyAwIDog\nKChOdW1iZXIpIHZhbCkuZG91YmxlVmFsdWUoKTsKICAgICAgICAgICAgICAg\nIGZtLnN0b3JlRG91YmxlRmllbGQoZmllbGQsIGQpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgog\nICAgICAgICAgICAgICAgZmxvYXQgZiA9ICh2YWwgPT0gbnVsbCkgPyAwIDog\nKChOdW1iZXIpIHZhbCkuZmxvYXRWYWx1ZSgpOwogICAgICAgICAgICAgICAg\nZm0uc3RvcmVGbG9hdEZpZWxkKGZpZWxkLCBmKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAg\nICAgICAgICAgICBpbnQgaSA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1i\nZXIpIHZhbCkuaW50VmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3Jl\nSW50RmllbGQoZmllbGQsIGkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAg\nICBsb25nIGwgPSAodmFsID09IG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwp\nLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3RvcmVMb25nRmll\nbGQoZmllbGQsIGwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgc2hv\ncnQgcyA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZhbCkuc2hv\ncnRWYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3RvcmVTaG9ydEZpZWxk\nKGZpZWxkLCBzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICBmbS5z\ndG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCAoU3RyaW5nKSB2YWwpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICBmbS5zdG9yZU9iamVjdEZpZWxkKGZpZWxkLCB2YWwpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vCiAgICAvLyBVdGlsaXRp\nZXMKICAgIC8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIEVyYXNlIHRo\nZSBmYWN0IHRoYXQgdGhpcyBpbnN0YW5jZSBoYXMgYmVlbiBmbHVzaGVkLgog\nICAgICovCiAgICB2b2lkIGVyYXNlRmx1c2goKSB7CiAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX0ZMVVNIRUQ7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZM\nVVNIRURfRElSVFk7CgogICAgICAgIGludCBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCkubGVuZ3RoOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\nczsgaSsrKQogICAgICAgICAgICBfZmx1c2guY2xlYXIoaSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWNvcmRzIHRoYXQgYWxsIGluc3RhbmNlIGZpZWxk\ncyBhcmUvYXJlIG5vdCBsb2FkZWQuCiAgICAgKiBQcmltYXJ5IGtleSBhbmQg\nbm9uLXBlcnNpc3RlbnQgZmllbGRzIGFyZSBub3QgYWZmZWN0ZWQuCiAgICAg\nKi8KICAgIHZvaWQgc2V0TG9hZGVkKGJvb2xlYW4gdmFsKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlzUHJpbWFyeUtleSgpCiAgICAg\nICAgICAgICAgICAmJiBmbWRzW2ldLmdldE1hbmFnZW1lbnQoKSA9PSBmbWRz\nW2ldLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgc2V0TG9h\nZGVkKGksIHZhbCk7CiAgICAgICAgfQogICAgICAgIGlmICghdmFsKSB7CiAg\nICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19MT0FERUQ7CiAgICAgICAgICAg\nIHNldERpcnR5KGZhbHNlKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nX2ZsYWdzIHw9IEZMQUdfTE9BREVEOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVjb3JkcyB0aGF0IGFsbCBpbnN0YW5jZSBmaWVsZHMgYXJlL2FyZSBub3Qg\nZGlydHksCiAgICAgKiBhbmQgY2hhbmdlcyB0aGUgZmxhZ3Mgb2YgdGhlIGlu\nc3RhbmNlIGFjY29yZGluZ2x5LgogICAgICovCiAgICB2b2lkIHNldERpcnR5\nKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBib29sZWFuIHVwZGF0ZSA9\nICFpc05ldygpIHx8IGlzRmx1c2hlZCgpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\ndmFsICYmICghdXBkYXRlCiAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdl\ndFVwZGF0ZVN0cmF0ZWd5KCkgIT0gVXBkYXRlU3RyYXRlZ2llcy5JR05PUkUp\nKQogICAgICAgICAgICAgICAgX2RpcnR5LnNldChpKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoIXZhbCkgewogICAgICAgICAgICAgICAgLy8gd2UgbmV2ZXIg\nY29uc2lkZXIgY2xlYW4gZmllbGRzIGZsdXNoZWQ7IHRoaXMgYWxzbyB0YWtl\ncwogICAgICAgICAgICAgICAgLy8gY2FyZSBvZiBjbGVhcmluZyB0aGUgZmx1\nc2hlZCBmaWVsZHMgb24gY29tbWl0L3JvbGxiYWNrCiAgICAgICAgICAgICAg\nICBfZmx1c2guY2xlYXIoaSk7CiAgICAgICAgICAgICAgICBfZGlydHkuY2xl\nYXIoaSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh2\nYWwpCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0xPQURFRDsKICAgIH0K\nCiAgICAvKioKICAgICAqIEV4ZWN1dGVzIHByZS1jbGVhciBjYWxsYmFja3Ms\nIGNsZWFycyBhbGwgbWFuYWdlZCBmaWVsZHMsIGFuZCBjYWxscyB0aGUKICAg\nICAqIHtAbGluayAjc2V0TG9hZGVkfSBtZXRob2Qgd2l0aCBhIHZhbHVlIG9m\nIGZhbHNlLiBQcmltYXJ5IGtleSBmaWVsZHMKICAgICAqIGFyZSBub3QgY2xl\nYXJlZC4KICAgICAqLwogICAgdm9pZCBjbGVhckZpZWxkcygpIHsKICAgICAg\nICBpZiAoIWlzSW50ZXJjZXB0aW5nKCkpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJF\nRk9SRV9DTEVBUik7CgogICAgICAgIC8vIHVucHJveHkgYWxsIGZpZWxkcwog\nICAgICAgIHVucHJveHlGaWVsZHMoKTsKCiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNsZWFyIG5vbi1wayBmaWVsZHMK\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRG\naWVsZHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoIWZtZHNbaV0u\naXNQcmltYXJ5S2V5KCkgJiYgZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkKICAg\nICAgICAgICAgICAgICAgICA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJT\nSVNURU5UKQogICAgICAgICAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMs\nIENsZWFyRmllbGRNYW5hZ2VyLmdldEluc3RhbmNlKCksIGkpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBmb3JnZXQgdmVyc2lvbiBpbmZvIGFu\nZCBpbXBsIGRhdGEgc28gd2UgcmUtcmVhZCBuZXh0IHRpbWUKICAgICAgICAg\nICAgc2V0TG9hZGVkKGZhbHNlKTsKICAgICAgICAgICAgX3ZlcnNpb24gPSBu\ndWxsOwogICAgICAgICAgICBfbG9hZFZlcnNpb24gPSBudWxsOwogICAgICAg\nICAgICBpZiAoX2ZpZWxkSW1wbCAhPSBudWxsKQogICAgICAgICAgICAgICAg\nQXJyYXlzLmZpbGwoX2ZpZWxkSW1wbCwgbnVsbCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQoKICAgICAg\nICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQUZURVJfQ0xF\nQVIpOwogICAgfQoKICAgIC8qKgogICAgICogUmVjb3JkIHRoYXQgd2Ugc2hv\ndWxkIHNhdmUgYW55IGZpZWxkcyB0aGF0IGNoYW5nZSBmcm9tIHRoaXMgcG9p\nbnQKICAgICAqIGZvcndhcmQuCiAgICAgKi8KICAgIHZvaWQgc2F2ZUZpZWxk\ncyhib29sZWFuIGltbWVkaWF0ZSkgewogICAgICAgIGlmIChfYnJva2VyLmdl\ndFJlc3RvcmVTdGF0ZSgpID09IFJlc3RvcmVTdGF0ZS5SRVNUT1JFX05PTkUK\nICAgICAgICAgICAgJiYgKF9mbGFncyAmIEZMQUdfSU5WRVJTRVMpID09IDAp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgX2ZsYWdzIHw9IEZMQUdf\nU0FWRTsKICAgICAgICBpZiAoaW1tZWRpYXRlKSB7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwLCBsZW4gPSBfbG9hZGVkLmxlbmd0aCgpOyBpIDwgbGVu\nOyBpKyspCiAgICAgICAgICAgICAgICBzYXZlRmllbGQoaSk7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+RkxBR19TQVZFOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIElmIHRoZSBmaWVsZCBpc24ndCBhbHJlYWR5IHNhdmVk\nLCBzYXZlcyB0aGUgY3VycmVudGx5IGxvYWRlZCBmaWVsZAogICAgICogc3Rh\ndGUgb2YgdGhlIGluc3RhbmNlLiBUaGUgc2F2ZWQgdmFsdWVzIGNhbiBhbGwg\nYmUgcmVzdG9yZWQgdmlhCiAgICAgKiB7QGxpbmsgI3Jlc3RvcmVGaWVsZHN9\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2F2ZUZpZWxkKGludCBmaWVs\nZCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TQVZFKSA9PSAwKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGlmIHRoaXMgaXMgYSBt\nYW5hZ2VkIGludmVyc2UgZmllbGQsIGxvYWQgaXQgc28gd2UncmUgc3VyZSB0\nbyBoYXZlCiAgICAgICAgLy8gdGhlIG9yaWdpbmFsIHZhbHVlCiAgICAgICAg\naWYgKCFfbG9hZGVkLmdldChmaWVsZCkgJiYgKChfZmxhZ3MgJiBGTEFHX0lO\nVkVSU0VTKSAhPSAwCiAgICAgICAgICAgICYmIF9tZXRhLmdldEZpZWxkKGZp\nZWxkKS5nZXRJbnZlcnNlTWV0YURhdGFzKCkubGVuZ3RoID4gMCkpCiAgICAg\nICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUs\nIGZhbHNlLCBmYWxzZSk7CgogICAgICAgIC8vIGRvbid0IGJvdGhlciBjcmVh\ndGluZyB0aGUgc2F2ZSBmaWVsZCBtYW5hZ2VyIGlmIHdlJ3JlIG5vdCBnb2lu\nZyB0bwogICAgICAgIC8vIHNhdmUgdGhlIG9sZCBmaWVsZCB2YWx1ZSBhbnl3\nYXkKICAgICAgICBpZiAoX3NhdmVkID09IG51bGwpIHsKICAgICAgICAgICAg\naWYgKF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIF9zYXZl\nZCA9IG5ldyBTYXZlRmllbGRNYW5hZ2VyKHRoaXMsIG51bGwsIF9kaXJ0eSk7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CgogICAgICAgIC8vIGNvcHkgdGhlIGZpZWxkIHRvIHNhdmUgZmll\nbGQgbWFuYWdlcjsgaWYgdGhlIGZpZWxkIGlzIG5vdCBkaXJlY3RseQogICAg\nICAgIC8vIGNvcHlhYmxlLCBpbW1lZGlhdGVseSBwcm92aWRlIGFuZCByZXBs\nYWNlIGl0IHZpYSB0aGUgc2F2ZSBmaWVsZAogICAgICAgIC8vIG1hbmFnZXIs\nIHdoaWNoIHdpbGwgY29weSB0aGUgbXV0YWJsZSB2YWx1ZSB0byBwcmV2ZW50\nIGJ5LXJlZiBtb2RzCiAgICAgICAgaWYgKF9zYXZlZC5zYXZlRmllbGQoZmll\nbGQpKSB7CiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zYXZlZCwg\nZmllbGQpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3NhdmVkLmdldFN0\nYXRlKCksIF9zYXZlZCwgZmllbGQpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIE5vdGlmaWNhdGlvbiB0aGF0IHRoZSBzdGF0ZSB3aWxsIG5v\ndCBuZWVkIHRvIGJlIHJvbGxlZCBiYWNrCiAgICAgKiB0byB0aGF0IG9mIHRo\nZSBsYXN0IGNhbGwgdG8ge0BsaW5rICNzYXZlRmllbGRzfS4KICAgICAqLwog\nICAgdm9pZCBjbGVhclNhdmVkRmllbGRzKCkgewogICAgICAgIGlmIChpc0lu\ndGVyY2VwdGluZygpKSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19T\nQVZFOwogICAgICAgICAgICBfc2F2ZWQgPSBudWxsOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgU2F2ZUZpZWxkTWFuYWdlciBnZXRTYXZlRmllbGRN\nYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfc2F2ZWQ7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSb2xsYmFjayB0aGUgc3RhdGUgb2YgdGhlIGluc3RhbmNl\nIHRvIHRoZSBzYXZlZCBzdGF0ZSBmcm9tIHRoZQogICAgICogbGFzdCBjYWxs\nIHRvIHtAbGluayAjc2F2ZUZpZWxkc30sIG9yIHRvIGRlZmF1bHQgdmFsdWVz\nIGlmIG5ldmVyIHNhdmVkLgogICAgICovCiAgICB2b2lkIHJlc3RvcmVGaWVs\nZHMoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmIChfc2F2ZWQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYg\nKChfZmxhZ3MgJiBGTEFHX1NBVkUpID09IDApCiAgICAgICAgICAgICAgICAg\nICAgY2xlYXJGaWVsZHMoKTsKICAgICAgICAgICAgICAgIGVsc2UgLy8gb25s\neSB1bmxvYWRlZCBmaWVsZHMgd2VyZSBkaXJ0aWVkCiAgICAgICAgICAgICAg\nICAgICAgX2xvYWRlZC5hbmROb3QoX2xvYWRlZCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgLy8gd2UgZGlyZWN0IHN0YXRlIHRyYW5zaXRpb25zIGJh\nc2VkIG9uIG91ciBvd24gZ2V0UmVzdG9yZVN0YXRlCiAgICAgICAgICAgIC8v\nIG1ldGhvZCwgYnV0IHRvIGRlY2lkZSB3aGV0aGVyIHRvIGFjdHVhbGx5IHJv\nbGxiYWNrIGZpZWxkCiAgICAgICAgICAgIC8vIHZhbHVlcywgd2UgY29uc3Vs\ndCB0aGUgYnJva2VyIGZvciB0aGUgdXNlcidzIHNldHRpbmcKICAgICAgICAg\nICAgZWxzZSBpZiAoX2Jyb2tlci5nZXRSZXN0b3JlU3RhdGUoKSAhPSBSZXN0\nb3JlU3RhdGUuUkVTVE9SRV9OT05FKSB7CiAgICAgICAgICAgICAgICAvLyBy\nb2xsYmFjayBhbGwgY3VycmVudGx5LWxvYWRlZCBmaWVsZHMKICAgICAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBfbG9hZGVkLmxlbmd0aCgp\nOyBpIDwgbGVuOyBpKyspCiAgICAgICAgICAgICAgICAgICAgaWYgKF9sb2Fk\nZWQuZ2V0KGkpICYmIF9zYXZlZC5yZXN0b3JlRmllbGQoaSkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zYXZlZCwgaSk7\nCgogICAgICAgICAgICAgICAgLy8gcm9sbGJhY2sgbG9hZGVkIHNldAogICAg\nICAgICAgICAgICAgX2xvYWRlZC5hbmROb3QoX3NhdmVkLmdldFVubG9hZGVk\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXBsYWNlcyBhbGwgc2Vjb25kIGNsYXNzIG9iamVjdCBm\naWVsZHMgd2l0aCBmcmVzaCBwcm94aWVkIGluc3RhbmNlcwogICAgICogY29u\ndGFpbmluZyB0aGUgc2FtZSBpbmZvcm1hdGlvbiBhcyB0aGUgb3JpZ2luYWxz\nLgogICAgICovCiAgICB2b2lkIHByb3h5RmllbGRzKGJvb2xlYW4gcmVzZXQs\nIGJvb2xlYW4gcmVwbGFjZU51bGwpIHsKICAgICAgICAvLyB3ZSBvbmx5IHJl\ncGxhY2UgbnVsbHMgaWYgdGhlIHJ1bnRpbWUgY2FuJ3QgZGlmZmVyZW50aWF0\nZSBiZXR3ZWVuCiAgICAgICAgLy8gbnVsbCBhbmQgZW1wdHkgY29udGFpbmVy\ncy4gIHdlIHJlcGxhY2UgbnVsbHMgaW4gdGhpcyBjYXNlIHRvCiAgICAgICAg\nLy8gbWFpbnRhaW4gY29uc2lzdGVuY3kgd2hldGhlciB2YWx1ZXMgYXJlIGJl\naW5nIHJldGFpbmVkIG9yIG5vdAogICAgICAgIGlmIChyZXBsYWNlTnVsbCkK\nICAgICAgICAgICAgcmVwbGFjZU51bGwgPSAhX2Jyb2tlci5nZXRDb25maWd1\ncmF0aW9uKCkuc3VwcG9ydGVkT3B0aW9ucygpLgogICAgICAgICAgICAgICAg\nY29udGFpbnMoT3BlbkpQQUNvbmZpZ3VyYXRpb24uT1BUSU9OX05VTExfQ09O\nVEFJTkVSKTsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBfbG9hZGVkLmxlbmd0aCgp\nOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChfbG9hZGVk\nLmdldChpKSkgewogICAgICAgICAgICAgICAgICAgIHByb3ZpZGVGaWVsZChf\ncGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAgICAgICAgICAgIGlmIChfc2lu\nZ2xlLnByb3h5KHJlc2V0LCByZXBsYWNlTnVsbCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAg\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAg\nX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVW5wcm94eSBhbGwg\nZmllbGRzLgogICAgICovCiAgICB2b2lkIHVucHJveHlGaWVsZHMoKSB7CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX05PX1VOUFJPWFkpICE9IDApCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBfbG9hZGVk\nLmxlbmd0aCgpOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHBy\nb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAgICAgICAg\nX3NpbmdsZS51bnByb3h5KCk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnJl\nbGVhc2VFbWJlZGRlZCgpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5jbGVh\ncigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBHZXQgcmVhZHkgZm9yIGEgZmx1c2guIFBlcnNpc3RzIGFs\nbCBwZXJzaXN0ZW5jZS1jYXBhYmxlIG9iamVjdCBmaWVsZHMsCiAgICAgKiBh\nbmQgY2hlY2tzIGZvciBpbGxlZ2FsIG51bGwgdmFsdWVzLiBBbHNvIGFzc2ln\nbnMgb2lkcyBhbmQgZmllbGQgdmFsdWVzCiAgICAgKiBmb3IgYWxsIHN0cmF0\nZWdpZXMgdGhhdCBkb24ndCByZXF1aXJlIGZsdXNoaW5nLgogICAgICovCiAg\nICB2b2lkIHByZUZsdXNoKGJvb2xlYW4gbG9naWNhbCwgT3BDYWxsYmFja3Mg\nY2FsbCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVfRkxVU0hF\nRCkgIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoaXNQ\nZXJzaXN0ZW50KCkpIHsKICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50\nKExpZmVjeWNsZUV2ZW50LkJFRk9SRV9TVE9SRSk7CiAgICAgICAgICAgIC8v\nIEJFRk9SRV9QRVJTSVNUIGlzIGhhbmRsZWQgZHVyaW5nIEJyb2tlci5wZXJz\naXN0IGFuZCBCcm9rZXIuYXR0YWNoCiAgICAgICAgICAgIGlmIChpc0RlbGV0\nZWQoKSkKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZl\nY3ljbGVFdmVudC5CRUZPUkVfREVMRVRFKTsKICAgICAgICAgICAgZWxzZSBp\nZiAoIShpc05ldygpICYmICFpc0ZsdXNoZWQoKSkpCiAgICAgICAgICAgICAg\nICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX1VQ\nREFURSk7CiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1BSRV9GTFVTSEVE\nOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmICghbG9naWNhbCkKICAgICAgICAgICAgICAgIGFzc2ln\nbk9iamVjdElkKGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDAsIGxlbiA9IF9tZXRhLmdldEZpZWxkcygpLmxlbmd0aDsgaSA8IGxl\nbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoKGxvZ2ljYWwgfHwgIWFz\nc2lnbkZpZWxkKGksIHRydWUpKSAmJiAhX2ZsdXNoLmdldChpKQogICAgICAg\nICAgICAgICAgICAgICYmIF9kaXJ0eS5nZXQoaSkpIHsKICAgICAgICAgICAg\nICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBpKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAoX3NpbmdsZS5wcmVGbHVzaChsb2dpY2FsLCBj\nYWxsKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9w\nYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRpcnR5Q2hl\nY2soKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGNhbGxi\nYWNrcyBmb3IgZGVsZXRpb24uCiAgICAgKi8KICAgIHZvaWQgcHJlRGVsZXRl\nKCkgewogICAgICAgIC8vIHNldCBhIGZsYWcgd2hpbGUgY2FsbCBwcmUgZGVs\nZXRlIGNhbGxiYWNrIHNvIHRoYXQgdXNlciBjYW4ndAogICAgICAgIC8vIGdl\ndCBpbnRvIGluZmluaXRlIHJlY3Vyc2lvbiBieSBjYWxsaW5nIGRlbGV0ZSh0\naGlzKQogICAgICAgIC8vIHdpdGhpbiBoaXMgY2FsbGJhY2sgbWV0aG9kCiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRV9ERUxFVElORykgPT0gMCkg\newogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19QUkVfREVMRVRJTkc7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xl\nRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0RFTEVURSk7CiAgICAgICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBfZmxhZ3MgJj0gfkZM\nQUdfUFJFX0RFTEVUSU5HOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogQ2FzY2FkZSBkZWxldGVzIGFuZCBkZXJlZmVy\nZW5jZSBkZXBlbmRlbnQgZmllbGRzLgogICAgICovCiAgICB2b2lkIGNhc2Nh\nZGVEZWxldGUoT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGlmIChmbWRzW2ldLmdldENhc2NhZGVEZWxldGUoKSAhPSBWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfTk9ORQogICAgICAgICAgICAgICAgfHwgZm1kc1tp\nXS5nZXRLZXkoKS5nZXRDYXNjYWRlRGVsZXRlKCkKICAgICAgICAgICAgICAg\nICE9IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FCiAgICAgICAgICAgICAg\nICB8fCBmbWRzW2ldLmdldEVsZW1lbnQoKS5nZXRDYXNjYWRlRGVsZXRlKCkK\nICAgICAgICAgICAgICAgICE9IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05F\nKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQo\naSwgZmV0Y2hGaWVsZChpLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgX3Np\nbmdsZS5kZWxldGUoY2FsbCk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmNs\nZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDYWxsZWQgYWZ0ZXIgYW4gaW5zdGFuY2UgaXMgcGVyc2lzdGVk\nIGJ5IGEgdXNlciB0aHJvdWdoIHRoZSBicm9rZXIuCiAgICAgKiBDYXNjYWRl\ncyB0aGUgcGVyc2lzdCBvcGVyYXRpb24gdG8gZmllbGRzIG1hcmtlZAogICAg\nICoge0BsaW5rIFZhbHVlTWV0YURhdGEjQ0FTQ0FERV9JTU1FRElBVEV9Lgog\nICAgICovCiAgICB2b2lkIGNhc2NhZGVQZXJzaXN0KE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdl\ndEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGkp\nKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICBpZiAo\nZm1kc1tpXS5nZXRDYXNjYWRlUGVyc2lzdCgpID09IFZhbHVlTWV0YURhdGEu\nQ0FTQ0FERV9JTU1FRElBVEUKICAgICAgICAgICAgICAgIHx8IGZtZHNbaV0u\nZ2V0S2V5KCkuZ2V0Q2FzY2FkZVBlcnNpc3QoKQogICAgICAgICAgICAgICAg\nPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURQogICAgICAgICAg\nICAgICAgfHwgZm1kc1tpXS5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZVBlcnNp\nc3QoKQogICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURF\nX0lNTUVESUFURSkgewogICAgICAgICAgICAgICAgX3NpbmdsZS5zdG9yZU9i\namVjdEZpZWxkKGksIGZldGNoRmllbGQoaSwgZmFsc2UpKTsKICAgICAgICAg\nICAgICAgIF9zaW5nbGUucGVyc2lzdChjYWxsKTsKICAgICAgICAgICAgICAg\nIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGdpdmVuIGZpZWxkIHNldCBm\ncm9tIHRoZSBkYXRhIHN0b3JlIGludG8gdGhlIGluc3RhbmNlLgogICAgICog\nUmV0dXJuIHRydWUgaWYgYW55IGRhdGEgaXMgbG9hZGVkLCBmYWxzZSBvdGhl\ncndpc2UuCiAgICAgKi8KICAgIGJvb2xlYW4gbG9hZEZpZWxkcyhCaXRTZXQg\nZmllbGRzLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBsb2NrTGV2\nZWwsCiAgICAgICAgT2JqZWN0IHNkYXRhKSB7CiAgICAgICAgLy8gY2FuJ3Qg\nbG9hZCB2ZXJzaW9uIGZpZWxkIGZyb20gc3RvcmUKICAgICAgICBpZiAoZmll\nbGRzICE9IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSB2Zmll\nbGQgPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQoKTsKICAgICAgICAgICAgaWYg\nKHZmaWVsZCAhPSBudWxsKQogICAgICAgICAgICAgICAgZmllbGRzLmNsZWFy\nKHZmaWVsZC5nZXRJbmRleCgpKTsKICAgICAgICB9CgogICAgICAgIGJvb2xl\nYW4gcmV0ID0gZmFsc2U7CiAgICAgICAgc2V0TG9hZGluZyh0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyBpZiBhbnkgZmllbGRzIGdpdmVu\nLCBsb2FkIHRoZW0KICAgICAgICAgICAgaW50IGxlbiA9IChmaWVsZHMgPT0g\nbnVsbCkgPyAwIDogZmllbGRzLmxlbmd0aCgpOwogICAgICAgICAgICBpZiAo\nbGVuID4gMCkgewogICAgICAgICAgICAgICAgaWYgKGZldGNoID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgZmV0Y2ggPSBfYnJva2VyLmdldEZldGNo\nQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKCFfYnJva2Vy\nLmdldFN0b3JlTWFuYWdlcigpLmxvYWQodGhpcywgZmllbGRzLCBmZXRjaCwK\nICAgICAgICAgICAgICAgICAgICBsb2NrTGV2ZWwsIHNkYXRhKSkgewogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2Vw\ndGlvbihfbG9jLmdldCgiZGVsLWluc3RhbmNlIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBfb2lkKSkuCiAg\nICAgICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5h\nZ2VkSW5zdGFuY2UoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICByZXQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBtYWtlIHN1cmUgdmVyc2lvbiBpbmZvcm1hdGlvbiBoYXMgYmVlbiBzZXQ7\nIHZlcnNpb24gaW5mbyBtdXN0CiAgICAgICAgICAgIC8vIGFsd2F5cyBiZSBz\nZXQgYWZ0ZXIgdGhlIGZpcnN0IHN0YXRlIGxvYWQgb3Igc2V0ICh3aGljaCBp\ncyB3aHkKICAgICAgICAgICAgLy8gd2UgZG8gdGhpcyBldmVuIGlmIG5vIGZp\nZWxkcyB3ZXJlIGxvYWRlZCAtLSBjb3VsZCBiZSB0aGF0IHRoaXMKICAgICAg\nICAgICAgLy8gbWV0aG9kIGlzIGJlaW5nIGNhbGxlZCBhZnRlciBhIGZpZWxk\nIGlzIHNldCkuLi4gc29tZSBpbnN0YW5jZXMKICAgICAgICAgICAgLy8gbWln\naHQgbm90IGhhdmUgdmVyc2lvbiBpbmZvLCBpbiB3aGljaCBjYXNlIHRoaXMg\nZ2V0cyBjYWxsZWQKICAgICAgICAgICAgLy8gbXV0aXBsZSB0aW1lczsgdGhh\ndCBzaG91bGQgYmUgb2sgdG9vCiAgICAgICAgICAgIGlmIChfbG9hZFZlcnNp\nb24gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgc3luY1ZlcnNpb24oc2Rh\ndGEpOwogICAgICAgICAgICAgICAgcmV0ID0gcmV0IHx8IF9sb2FkVmVyc2lv\nbiAhPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZp\nbmFsbHkgewogICAgICAgICAgICBzZXRMb2FkaW5nKGZhbHNlKTsKICAgICAg\nICB9CgogICAgICAgIC8vIHNlZSBpZiB0aGUgZGZnIGlzIG5vdyBsb2FkZWQ7\nIGRvIHRoaXMgcmVnYXJkbGVzcyBvZiB3aGV0aGVyIHdlCiAgICAgICAgLy8g\nbG9hZGVkIGFueSBmaWVsZHMsIGNhdXNlIG1heSBhbHJlYWR5IGhhdmUgYmVl\nbiBsb2FkZWQgYnkKICAgICAgICAvLyBTdG9yZU1hbmFnZXIgZHVyaW5nIGlu\naXRpYWxpemF0aW9uCiAgICAgICAgcG9zdExvYWQoLTEsIGZldGNoKTsKICAg\nICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0\naGUgZ2l2ZW4gZmllbGQncyBmZXRjaCBncm91cDsgdGhlIGZpZWxkIGl0c2Vs\nZiBtYXkgYWxyZWFkeSBiZQogICAgICogbG9hZGVkIGlmIGl0IGlzIGJlaW5n\nIHNldCBieSB0aGUgdXNlci4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\nbG9hZEZpZWxkKGludCBmaWVsZCwgaW50IGxvY2tMZXZlbCwgYm9vbGVhbiBm\nb3JXcml0ZSwKICAgICAgICBib29sZWFuIGZncykgewogICAgICAgIEZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCA9IF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgQml0U2V0IGZpZWxkcyA9IG51bGw7\nCgogICAgICAgIC8vIGlmIHRoaXMgaXMgYSBkZmcgZmllbGQgb3Igd2UgbmVl\nZCB0byBsb2FkIG91ciBkZmcsIGRvIHNvCiAgICAgICAgaWYgKGZncyAmJiAo\nX2ZsYWdzICYgRkxBR19MT0FERUQpID09IDApCiAgICAgICAgICAgIGZpZWxk\ncyA9IGdldFVubG9hZGVkSW50ZXJuYWwoZmV0Y2gsIExPQURfRkdTLCBudWxs\nKTsKICAgICAgICAKICAgICAgICAvLyBjaGVjayBmb3IgbG9hZCBmZXRjaCBn\ncm91cAogICAgICAgIFN0cmluZyBsZmcgPSBmbWQuZ2V0TG9hZEZldGNoR3Jv\ndXAoKTsKICAgICAgICBib29sZWFuIGxmZ0FkZGVkID0gZmFsc2U7CiAgICAg\nICAgaWYgKGxmZyAhPSBudWxsKSB7ICAKICAgICAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGkpICYmIChpID09IGZpZWxk\nCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5pc0luRmV0Y2hHcm91\ncChsZmcpKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZHMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gbmV3IEJp\ndFNldChmbWRzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgZmllbGRz\nLnNldChpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gcmVsYXRpb24gZmllbGQgaXMgbG9hZGVkIHdpdGggdGhl\nIGxvYWQtZmV0Y2gtZ3JvdXAKICAgICAgICAgICAgLy8gYnV0IHRoaXMgYWRk\naXRpb24gbXVzdCBiZSByZXZlcnRlZCBvbmNlIHRoZSBsb2FkIGlzIG92ZXIK\nICAgICAgICAgICAgaWYgKCFmZXRjaC5oYXNGZXRjaEdyb3VwKGxmZykpIHsK\nICAgICAgICAgICAgICAgIGZldGNoLmFkZEZldGNoR3JvdXAobGZnKTsKICAg\nICAgICAgICAgICAgIGxmZ0FkZGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gZWxzZSBpZiAoZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgp\nICYmIGZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIG5vIGxvYWQg\nZ3JvdXAgYnV0IGRmZzogYWRkIGRmZyBmaWVsZHMgaWYgd2UgaGF2ZW4ndCBh\nbHJlYWR5CiAgICAgICAgICAgIGZpZWxkcyA9IGdldFVubG9hZGVkSW50ZXJu\nYWwoZmV0Y2gsIExPQURfRkdTLCBudWxsKTsKICAgICAgICB9IGVsc2UgaWYg\nKCFfbG9hZGVkLmdldChmbWQuZ2V0SW5kZXgoKSkpIHsKICAgICAgICAgICAg\nLy8gbm8gbG9hZCBncm91cCBvciBkZmc6IGxvYWQgaW5kaXZpZHVhbCBmaWVs\nZAogICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAg\nICAgICBmaWVsZHMgPSBuZXcgQml0U2V0KCk7CiAgICAgICAgICAgIGZpZWxk\ncy5zZXQoZm1kLmdldEluZGV4KCkpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nY2FsbCB0aGlzIG1ldGhvZCBldmVuIGlmIHRoZXJlIGFyZSBubyB1bmxvYWRl\nZCBmaWVsZHM7IGxvYWRGaWVsZHMKICAgICAgICAvLyB0YWtlcyBjYXJlIG9m\nIHRoaW5ncyBsaWtlIGxvYWRpbmcgdmVyc2lvbiBpbmZvIGFuZCBzZXR0aW5n\nIFBDIGZsYWdzCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9hZEZpZWxk\ncyhmaWVsZHMsIGZldGNoLCBsb2NrTGV2ZWwsIG51bGwpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGlmIChsZmdBZGRlZCkKICAgICAgICAg\nICAgICAgIGZldGNoLnJlbW92ZUZldGNoR3JvdXAobGZnKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHByb3Zp\nZGUgdGhlIGdpdmVuIGZpZWxkIG51bWJlciB0byB0aGUgZ2l2ZW4KICAgICAq\nIGZpZWxkIG1hbmFnZXIuCiAgICAgKi8KICAgIHZvaWQgcHJvdmlkZUZpZWxk\nKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgRmllbGRNYW5hZ2VyIHN0b3JlLCBp\nbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1hbmFnZXIgYmVmb3JlRk0gPSBf\nZm07CiAgICAgICAgX2ZtID0gc3RvcmU7CiAgICAgICAgcGMucGNQcm92aWRl\nRmllbGQoZmllbGQpOwogICAgICAgIC8vIFJldGFpbmluZyBvcmlnaW5hbCBG\nTSBiZWNhdXNlIG9mIHRoZSBwb3NzaWJpbGl0eSBvZiByZWVudHJhbnQgY2Fs\nbHMKICAgICAgICBfZm0gPSBiZWZvcmVGTTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEhlbHBlciBtZXRob2QgdG8gcmVwbGFjZSB0aGUgZ2l2ZW4gZmllbGQg\nbnVtYmVyIHRvIHRoZSBnaXZlbgogICAgICogZmllbGQgbWFuYWdlci4KICAg\nICAqLwogICAgdm9pZCByZXBsYWNlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxl\nIHBjLCBGaWVsZE1hbmFnZXIgbG9hZCwgaW50IGZpZWxkKSB7CiAgICAgICAg\nRmllbGRNYW5hZ2VyIGJlZm9yZUZNID0gX2ZtOwogICAgICAgIF9mbSA9IGxv\nYWQ7CiAgICAgICAgcGMucGNSZXBsYWNlRmllbGQoZmllbGQpOwogICAgICAg\nIC8vIFJldGFpbmluZyBvcmlnaW5hbCBGTSBiZWNhdXNlIG9mIHRoZSBwb3Nz\naWJpbGl0eSBvZiByZWVudHJhbnQgY2FsbHMKICAgICAgICBfZm0gPSBiZWZv\ncmVGTTsKICAgIH0KCiAgICAvKioKICAgICAqIE1hcmsgdGhlIGZpZWxkIGFz\nIGxvYWRlZCBvciB1bmxvYWRlZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHNldExvYWRlZChpbnQgZmllbGQsIGJvb2xlYW4gaXNMb2FkZWQpIHsKICAg\nICAgICAvLyBkb24ndCBjb250aW51ZSBpZiBsb2FkZWQgc3RhdGUgaXMgYWxy\nZWFkeSBjb3JyZWN0OyBvdGhlcndpc2Ugd2UKICAgICAgICAvLyBjYW4gZW5k\nIHVwIGNsZWFyaW5nIF9maWVsZEltcGwgd2hlbiB3ZSBzaG91bGRuJ3QKICAg\nICAgICBpZiAoX2xvYWRlZC5nZXQoZmllbGQpID09IGlzTG9hZGVkKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGlmIGxvYWRpbmcsIGNsZWFy\nIGludGVybWVkaWF0ZSBkYXRhOyBpZiB1bmxvYWRpbmcsIGNsZWFyIGltcGwg\nZGF0YQogICAgICAgIGlmIChfZmllbGRJbXBsICE9IG51bGwpIHsKICAgICAg\nICAgICAgaW50IGlkeCA9IF9tZXRhLmdldEV4dHJhRmllbGREYXRhSW5kZXgo\nZmllbGQpOwogICAgICAgICAgICBpZiAoaWR4ICE9IC0xKQogICAgICAgICAg\nICAgICAgX2ZpZWxkSW1wbFtpZHhdID0gbnVsbDsKICAgICAgICB9CgogICAg\nICAgIGlmIChpc0xvYWRlZCkKICAgICAgICAgICAgX2xvYWRlZC5zZXQoZmll\nbGQpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2xvYWRlZC5jbGVhcihm\naWVsZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIHBvc3QtbG9h\nZCBzdGVwcywgaW5jbHVkaW5nIHRoZSBwb3N0IGxvYWQgY2FsbGJhY2suCiAg\nICAgKiBXZSBoYXZlIHRvIGNoZWNrIHRoZSBkZmcgYWZ0ZXIgYWxsIGZpZWxk\nIGxvYWRzIGJlY2F1c2UgaXQgbWlnaHQgYmUKICAgICAqIGxvYWRlZCBpbiBt\ndWx0aXBsZSBzdGVwcyB3aGVuIHBhZ2luZyBpcyBpbnZvbHZlZDsgdGhlIGlu\naXRpYWwgbG9hZAogICAgICogbWlnaHQgZXhjbHVkZSBzb21lIGZpZWxkcyB3\naGljaCBhcmUgdGhlbiBpbW1lZGlhdGVseSBsb2FkZWQgaW4gYQogICAgICog\nc2VwYXJhdGUgc3RlcCBiZWZvcmUgYmVpbmcgcmV0dXJuZWQgdG8gdGhlIHVz\nZXIuCiAgICAgKgogICAgICogQHBhcmFtIGZpZWxkIHRoZSBmaWVsZCBpbmRl\neCB0aGF0IHdhcyBsb2FkZWQsIG9yIC0xIHRvIGluZGljYXRlCiAgICAgKiB0\naGF0IGEgZ3JvdXAgb2YgcG9zc2libHkgdW5rbm93biBmaWVsZHMgd2FzIGxv\nYWRlZAogICAgICovCiAgICBwcml2YXRlIHZvaWQgcG9zdExvYWQoaW50IGZp\nZWxkLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICAvLyBu\nbyBuZWVkIGZvciBwb3N0TG9hZCBjYWxsYmFjaz8KICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfTE9BREVEKSAhPSAwKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIC8vIGluIHRoZSBtaWRkbGUgb2YgYSBncm91cCBsb2FkLCBh\nZnRlciB3aGljaCB0aGlzIG1ldGhvZCB3aWxsIGJlCiAgICAgICAgLy8gY2Fs\nbGVkIGFnYWluPwogICAgICAgIGlmIChmaWVsZCAhPSAtMSAmJiBpc0xvYWRp\nbmcoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBubyBsaXN0\nZW5lcnM/CiAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyIG1nciA9IF9i\ncm9rZXIuZ2V0TGlmZWN5Y2xlRXZlbnRNYW5hZ2VyKCk7CiAgICAgICAgaWYg\nKG1nciA9PSBudWxsIHx8ICFtZ3IuaGFzTG9hZExpc3RlbmVycyhnZXRNYW5h\nZ2VkSW5zdGFuY2UoKSwgX21ldGEpKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRjaCA9\nIF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgLy8g\naXMgdGhpcyBmaWVsZCBhIHBvc3QtbG9hZCBmaWVsZD8KICAgICAgICBpZiAo\nZmllbGQgIT0gLTEpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGlmIChmbWQu\naXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAgICAgICAgICAgICAgICAmJiBm\nZXRjaC5oYXNGZXRjaEdyb3VwKEZldGNoR3JvdXAuTkFNRV9ERUZBVUxUKQog\nICAgICAgICAgICAgICAgJiYgcG9zdExvYWQoRmV0Y2hHcm91cC5OQU1FX0RF\nRkFVTFQsIGZldGNoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgU3RyaW5nW10gZmdzID0gZm1kLmdldEN1c3RvbUZldGNoR3JvdXBz\nKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmdzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKGZldGNoLmhhc0ZldGNoR3Jv\ndXAoZmdzW2ldKSAmJiBwb3N0TG9hZChmZ3NbaV0sIGZldGNoKSkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBmZXRjaC5nZXRGZXRjaEdyb3Vw\ncygpLml0ZXJhdG9yKCk7IAogICAgICAgICAgICAgICAgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIGlmIChwb3N0TG9hZCgoU3RyaW5nKSBp\ndHIubmV4dCgpLCBmZXRjaCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUGVyZm9ybSBwb3N0LWxvYWQgYWN0aW9ucyBpZiB0aGUgZ2l2ZW4gZmV0\nY2ggZ3JvdXAgaXMgYSBwb3N0LWxvYWQgZ3JvdXAKICAgICAqIGFuZCBpcyBm\ndWxseSBsb2FkZWQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBwb3N0\nTG9hZChTdHJpbmcgZmdOYW1lLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gp\nIHsKICAgICAgICBGZXRjaEdyb3VwIGZnID0gX21ldGEuZ2V0RmV0Y2hHcm91\ncChmZ05hbWUpOwogICAgICAgIGlmIChmZyA9PSBudWxsIHx8ICFmZy5pc1Bv\nc3RMb2FkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoaSkgJiYgZm1kc1tpXS5pc0lu\nRmV0Y2hHcm91cChmZ05hbWUpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICBfZmxhZ3MgfD0gRkxBR19MT0FERUQ7CiAgICAgICAg\nX2Jyb2tlci5maXJlTGlmZWN5Y2xlRXZlbnQoZ2V0TWFuYWdlZEluc3RhbmNl\nKCksIGZldGNoLCBfbWV0YSwgCiAgICAgICAgCUxpZmVjeWNsZUV2ZW50LkFG\nVEVSX0xPQUQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8q\nKgogICAgICogU3luY2hyb25pemUgb3VyIHZlcnNpb24gb2JqZWN0IHdpdGgg\ndGhlIGRhdGFzdG9yZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHN5\nbmNWZXJzaW9uKE9iamVjdCBzZGF0YSkgewogICAgICAgIHJldHVybiBfYnJv\na2VyLmdldFN0b3JlTWFuYWdlcigpLnN5bmNWZXJzaW9uKHRoaXMsIHNkYXRh\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgd2hldGhlciB0aGlz\nIGluc3RhbmNlIG5lZWRzIGEgdmVyc2lvbiBjaGVjay4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gaXNWZXJzaW9uQ2hlY2tSZXF1aXJlZCgpIHsKICAg\nICAgICAvLyBleHBsaWNpdCBmbGFnIGZvciB2ZXJzaW9uIGNoZWNrCiAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX1ZFUlNJT05fQ0hFQ0spICE9IDApCiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICBpZiAoIV9icm9rZXIu\nZ2V0T3B0aW1pc3RpYygpICYmICFfYnJva2VyLmdldENvbmZpZ3VyYXRpb24o\nKS4KICAgICAgICAgICAgZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCkuZ2V0\nTm9uT3B0aW1pc3RpY1ZlcnNpb25DaGVjaygpKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc1ZlcnNpb25DaGVj\na1JlcXVpcmVkKHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHdo\nZXRoZXIgdGhpcyBpbnN0YW5jZSByZXF1aXJlcyBhIHZlcnNpb24gY2hlY2sg\nb24gdGhlIG5leHQgZmx1c2guCiAgICAgKi8KICAgIHZvaWQgc2V0Q2hlY2tW\nZXJzaW9uKGJvb2xlYW4gdmVyc2lvbkNoZWNrKSB7CiAgICAgICAgaWYgKHZl\ncnNpb25DaGVjaykKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfVkVSU0lP\nTl9DSEVDSzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAmPSB+\nRkxBR19WRVJTSU9OX0NIRUNLOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJucyB3aGV0aGVyIHRoaXMgaW5zdGFuY2UgbmVlZHMgYSB2ZXJzaW9uIHVw\nZGF0ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNWZXJzaW9uVXBk\nYXRlUmVxdWlyZWQoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFH\nX1ZFUlNJT05fVVBEQVRFKSA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgd2hldGhlciB0aGlzIGluc3RhbmNlIHJlcXVpcmVzIGEgdmVyc2lvbiB1\ncGRhdGUgb24gdGhlIG5leHQgZmx1c2guCiAgICAgKi8KICAgIHZvaWQgc2V0\nVXBkYXRlVmVyc2lvbihib29sZWFuIHZlcnNpb25VcGRhdGUpIHsKICAgICAg\nICBpZiAodmVyc2lvblVwZGF0ZSkKICAgICAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfVkVSU0lPTl9VUERBVEU7CiAgICAgICAgZWxzZQogICAgICAgICAgICBf\nZmxhZ3MgJj0gfkZMQUdfVkVSU0lPTl9VUERBVEU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUcmFuc2xhdGUgdGhlIGdpdmVuIGV4Y2VwdGlvbiBiYXNlZCBv\nbiB0aGUgYnJva2VyJ3MgaW1wbGljaXQgYmVoYXZpb3IuCiAgICAgKiBUcmFu\nc2xhdGlvbiBvbmx5IG9jY3VycyBpZiB0aGUgZXhjZXB0aW9uIGlzIGluaXRp\nYXRlZCBieSBhIHVzZXIgYWN0aW9uCiAgICAgKiBvbiBhbiBpbnN0YW5jZSwg\nYW5kIHRoZXJlZm9yZSB3aWxsIG5vdCBiZSBjYXVnaHQgYW5kIHRyYW5zbGF0\nZWQgYnkgdGhlCiAgICAgKiBicm9rZXIuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBSdW50aW1lRXhjZXB0aW9uIHRyYW5zbGF0ZShSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3IgdHJh\nbnMgPSBfYnJva2VyLgogICAgICAgICAgICBnZXRJbnN0YW5jZUV4Y2VwdGlv\nblRyYW5zbGF0b3IoKTsKICAgICAgICByZXR1cm4gKHRyYW5zID09IG51bGwp\nID8gcmUgOiB0cmFucy50cmFuc2xhdGUocmUpOwogICAgfQoKICAgIC8qKgog\nICAgICogTG9jayB0aGUgc3RhdGUgbWFuYWdlciBpZiB0aGUgbXVsdGl0aHJl\nYWRlZCBvcHRpb24gaXMgc2V0LgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCBsb2NrKCkgewogICAgICAgIC8vIHVzZSBicm9rZXItbGV2ZWwgbG9jayB0\nbyBhdm9pZCBkZWFkbG9jayBzaXR1YXRpb25zIHdpdGggdGhlIHN0YXRlCiAg\nICAgICAgLy8gbWFuYWdlciBsb2NrIGFuZCBicm9rZXIgbG9jayBiZWluZyBv\nYnRhaW5lZCBpbiBkaWZmZXJlbnQgb3JkZXJzCiAgICAgICAgX2Jyb2tlci5s\nb2NrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBVbmxvY2sgdGhlIHN0YXRl\nIG1hbmFnZXIuCiAgICAgKi8KCXByb3RlY3RlZCB2b2lkIHVubG9jayAoKQoJ\newoJCS8vIHVzZSBicm9rZXItbGV2ZWwgbG9jayB0byBhdm9pZCBkZWFkbG9j\nayBzaXR1YXRpb25zIHdpdGggdGhlIHN0YXRlIAoJCS8vIG1hbmFnZXIgbG9j\nayBhbmQgYnJva2VyIGxvY2sgYmVpbmcgb2J0YWluZWQgaW4gZGlmZmVyZW50\nIG9yZGVycwoJCV9icm9rZXIudW5sb2NrICgpOwoJfQoKICAgIHByaXZhdGUg\ndm9pZCB3cml0ZU9iamVjdChPYmplY3RPdXRwdXRTdHJlYW0gb29zKSB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIG9vcy53cml0ZU9iamVjdChfYnJv\na2VyKTsKICAgICAgICBvb3MuZGVmYXVsdFdyaXRlT2JqZWN0KCk7CiAgICAg\nICAgb29zLndyaXRlT2JqZWN0KF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7\nCiAgICAgICAgd3JpdGVQQyhvb3MsIF9wYyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXcml0ZSA8Y29kZT5wYzwvY29kZT4gdG8gPGNvZGU+b29zPC9jb2Rl\nPiwgaGFuZGxpbmcgaW50ZXJuYWwtZm9ybQogICAgICogc2VyaWFsaXphdGlv\nbi4gPGNvZGU+cGM8L2NvZGU+IG11c3QgYmUgb2YgdGhlIHNhbWUgdHlwZSB0\naGF0IHRoaXMKICAgICAqIHN0YXRlIG1hbmFnZXIgbWFuYWdlcy4KICAgICAq\nCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgdm9pZCB3cml0ZVBD\nKE9iamVjdE91dHB1dFN0cmVhbSBvb3MsIFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYykKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmICgh\nU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE5vdFNl\ncmlhbGl6YWJsZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgIF9tZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkpOwoKICAgICAgICBvb3Mud3Jp\ndGVPYmplY3QocGMpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCByZWFkT2Jq\nZWN0KE9iamVjdElucHV0U3RyZWFtIGluKQogICAgICAgIHRocm93cyBJT0V4\nY2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiB7CiAgICAgICAgX2Jy\nb2tlciA9IChCcm9rZXJJbXBsKSBpbi5yZWFkT2JqZWN0KCk7CiAgICAgICAg\naW4uZGVmYXVsdFJlYWRPYmplY3QoKTsKCiAgICAgICAgLy8gd2UgbmVlZCB0\nbyBzdG9yZSB0aGUgY2xhc3MgYmVmb3JlIHRoZSBwYyBpbnN0YW5jZSBzbyB0\naGF0IHdlIGNhbgogICAgICAgIC8vIGNyZWF0ZSBfbWV0YSBiZWZvcmUgY2Fs\nbGluZyByZWFkUEMoKSwgd2hpY2ggcmVsaWVzIG9uIF9tZXRhIGJlaW5nCiAg\nICAgICAgLy8gbm9uLW51bGwgd2hlbiByZWNvbnN0aXR1dGluZyBSZWZsZWN0\naW5nUEMgaW5zdGFuY2VzLiBTYWRseSwgdGhpcwogICAgICAgIC8vIHBlbmFs\naXplcyB0aGUgc2VyaWFsaXphdGlvbiBmb290cHJpbnQgb2Ygbm9uLVJlZmxl\nY3RpbmdQQyBTTXMgYWxzby4KICAgICAgICBDbGFzcyBtYW5hZ2VkVHlwZSA9\nIChDbGFzcykgaW4ucmVhZE9iamVjdCgpOwogICAgICAgIF9tZXRhID0gX2Jy\nb2tlci5nZXRDb25maWd1cmF0aW9uKCkuZ2V0TWV0YURhdGFSZXBvc2l0b3J5\nSW5zdGFuY2UoKQogICAgICAgICAgICAuZ2V0TWV0YURhdGEobWFuYWdlZFR5\ncGUsIG51bGwsIHRydWUpOwoKICAgICAgICBfcGMgPSByZWFkUEMoaW4pOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29udmVydHMgdGhlIGRlc2VyaWFsaXpl\nZCA8Y29kZT5vPC9jb2RlPiB0byBhIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFi\nbGV9CiAgICAgKiBpbnN0YW5jZSBhcHByb3ByaWF0ZSBmb3Igc3RvcmluZyBp\nbiA8Y29kZT5fcGM8L2NvZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAxLjEu\nMAogICAgICovCiAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcmVhZFBDKE9iamVj\ndElucHV0U3RyZWFtIGluKQogICAgICAgIHRocm93cyBDbGFzc05vdEZvdW5k\nRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IG8gPSBp\nbi5yZWFkT2JqZWN0KCk7CgogICAgICAgIGlmIChvID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGM7CiAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIFBlcnNpc3RlbmNl\nQ2FwYWJsZSkpCiAgICAgICAgICAgIHBjID0gSW1wbEhlbHBlci50b1BlcnNp\nc3RlbmNlQ2FwYWJsZShvLCB0aGlzKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHBjID0gKFBlcnNpc3RlbmNlQ2FwYWJsZSkgbzsKCiAgICAgICAgcGMu\ncGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHRoaXMpOwogICAgICAgIHJldHVybiBw\nYzsKICAgIH0KfQo=\n","encoding":"base64"}

