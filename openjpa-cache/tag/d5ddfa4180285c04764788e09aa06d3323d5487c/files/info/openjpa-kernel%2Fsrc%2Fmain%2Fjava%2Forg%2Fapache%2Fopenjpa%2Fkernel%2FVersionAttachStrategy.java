{"sha":"d9277e869e82c00d4b785ed38aba7b9f4690fa15","node_id":"MDQ6QmxvYjIwNjM2NDpkOTI3N2U4NjllODJjMDBkNGI3ODVlZDM4YWJhN2I5ZjQ2OTBmYTE1","size":15137,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d9277e869e82c00d4b785ed38aba7b9f4690fa15","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5TdGF0ZU1hbmFnZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wdGlt\naXN0aWNFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50\nLkxpZmVjeWNsZUV2ZW50OwoKLyoqCiAqIEhhbmRsZXMgYXR0YWNoaW5nIGlu\nc3RhbmNlcyB1c2luZyB2ZXJzaW9uIGFuZCBwcmltYXJ5IGtleSBmaWVsZHMu\nCiAqCiAqIEBub2phdmFkb2MKICogQGF1dGhvciBTdGV2ZSBLaW0KICovCmNs\nYXNzIFZlcnNpb25BdHRhY2hTdHJhdGVneQogICAgZXh0ZW5kcyBBdHRhY2hT\ndHJhdGVneQogICAgaW1wbGVtZW50cyBEZXRhY2hTdGF0ZSB7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIu\nZm9yUGFja2FnZQogICAgICAgIChWZXJzaW9uQXR0YWNoU3RyYXRlZ3kuY2xh\nc3MpOwoKICAgIHByb3RlY3RlZCBPYmplY3QgZ2V0RGV0YWNoZWRPYmplY3RJ\nZChBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgT2JqZWN0IHRvQXR0\nYWNoKSB7CiAgICAgICAgQnJva2VyIGJyb2tlciA9IG1hbmFnZXIuZ2V0QnJv\na2VyKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gYnJva2VyLmdl\ndENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0TWV0YURhdGFSZXBv\nc2l0b3J5SW5zdGFuY2UoKS5nZXRNZXRhRGF0YSgKICAgICAgICAgICAgICAg\nIEltcGxIZWxwZXIuZ2V0TWFuYWdlZEluc3RhbmNlKHRvQXR0YWNoKS5nZXRD\nbGFzcygpLAogICAgICAgICAgICAgICAgYnJva2VyLmdldENsYXNzTG9hZGVy\nKCksIHRydWUpOwogICAgICAgIHJldHVybiBBcHBsaWNhdGlvbklkcy5jcmVh\ndGUoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh0b0F0dGFjaCwK\nICAgICAgICAgICAgYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKSksCiAgICAg\nICAgICAgIG1ldGEpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHByb3Zp\nZGVGaWVsZChPYmplY3QgdG9BdHRhY2gsIFN0YXRlTWFuYWdlckltcGwgc20s\nCiAgICAgICAgaW50IGZpZWxkKSB7CiAgICAgICAgc20ucHJvdmlkZUZpZWxk\nKEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUodG9BdHRhY2gsCiAg\nICAgICAgICAgIHNtLmdldENvbnRleHQoKS5nZXRDb25maWd1cmF0aW9uKCkp\nLCB0aGlzLCBmaWVsZCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBhdHRh\nY2goQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBPYmplY3QgdG9BdHRhY2gsCiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhLCBQZXJzaXN0ZW5jZUNhcGFibGUg\naW50bywgT3BlbkpQQVN0YXRlTWFuYWdlciBvd25lciwKICAgICAgICBWYWx1\nZU1ldGFEYXRhIG93bmVyTWV0YSwgYm9vbGVhbiBleHBsaWNpdCkgewogICAg\nICAgIEJyb2tlckltcGwgYnJva2VyID0gbWFuYWdlci5nZXRCcm9rZXIoKTsK\nICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBJbXBsSGVscGVyLnRv\nUGVyc2lzdGVuY2VDYXBhYmxlKHRvQXR0YWNoLAogICAgICAgICAgICBtZXRh\nLmdldFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCkpOwoKICAgICAg\nICBib29sZWFuIGVtYmVkZGVkID0gb3duZXJNZXRhICE9IG51bGwgJiYgb3du\nZXJNZXRhLmlzRW1iZWRkZWRQQygpOwogICAgICAgIGJvb2xlYW4gaXNOZXcg\nPSAhYnJva2VyLmlzRGV0YWNoZWQocGMpOwogICAgICAgIE9iamVjdCB2ZXJz\naW9uID0gbnVsbDsKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwoKICAg\nICAgICAvLyBpZiB0aGUgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGVtYmVkZGVk\nIGluc3RhbmNlIGlzIG51bGwsIHRoZW4KICAgICAgICAvLyBpdCBzaG91bGQg\nYmUgdHJlYXRlZCBhcyBhIG5ldyBpbnN0YW5jZSAoc2luY2UgdGhlCiAgICAg\nICAgLy8gbmV3bHkgcGVyc2lzdGVkIG93bmVyIG1heSBjcmVhdGUgYSBuZXcg\nZW1iZWRkZWQgaW5zdGFuY2UKICAgICAgICAvLyBpbiB0aGUgY29uc3RydWN0\nb3IpOyBmaXhlZCBidWcgIzEwNzUuCiAgICAgICAgLy8gYWxzbywgaWYgdGhl\nIHVzZXIgaGFzIGF0dGFjaGVkIGEgZGV0YWNoZWQgb2JqIGZyb20gc29tZXdo\nZXJlCiAgICAgICAgLy8gZWxzZSBpbiB0aGUgZ3JhcGggdG8gYW4gZW1iZWRk\nZWQgZmllbGQgdGhhdCB3YXMgcHJldmlvdXNseSBudWxsLAogICAgICAgIC8v\nIGNvcHkgaW50byBhIG5ldyBlbWJlZGRlZCBpbnN0YW5jZQogICAgICAgIGlm\nIChlbWJlZGRlZCAmJiAoaXNOZXcgfHwgaW50byA9PSBudWxsCiAgICAgICAg\nICAgIHx8IGJyb2tlci5nZXRTdGF0ZU1hbmFnZXIoaW50bykgPT0gbnVsbCkp\nIHsKICAgICAgICAgICAgaWYgKGludG8gPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGludG8gPSBwYy5wY05ld0luc3RhbmNlKG51bGwsIGZhbHNlKTsKICAg\nICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgYnJva2VyLmVtYmVk\nKGludG8sIG51bGwsIG93bmVyLCBvd25lck1ldGEpOwogICAgICAgICAgICBp\nbnRvID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgfSBl\nbHNlIGlmIChpc05ldykgewogICAgICAgICAgICBPYmplY3Qgb2lkID0gbnVs\nbDsKICAgICAgICAgICAgaWYgKCFpc1ByaW1hcnlLZXlzR2VuZXJhdGVkKG1l\ndGEpKQogICAgICAgICAgICAgICAgb2lkID0gQXBwbGljYXRpb25JZHMuY3Jl\nYXRlKHBjLCBtZXRhKTsKCiAgICAgICAgICAgIHNtID0gcGVyc2lzdChtYW5h\nZ2VyLCBwYywgbWV0YSwgb2lkLCBleHBsaWNpdCk7CiAgICAgICAgICAgIGlu\ndG8gPSBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICB9IGVs\nc2UgaWYgKCFlbWJlZGRlZCAmJiBpbnRvID09IG51bGwpIHsKICAgICAgICAg\nICAgT2JqZWN0IGlkID0gZ2V0RGV0YWNoZWRPYmplY3RJZChtYW5hZ2VyLCB0\nb0F0dGFjaCk7CiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgaW50byA9CiAgICAgICAgICAgICAgICAgICAgSW1wbEhlbHBl\nci50b1BlcnNpc3RlbmNlQ2FwYWJsZShicm9rZXIuZmluZChpZCwgdHJ1ZSwg\nbnVsbCksCiAgICAgICAgICAgICAgICAgICAgICAgIGJyb2tlci5nZXRDb25m\naWd1cmF0aW9uKCkpOwogICAgICAgICAgICBpZiAoaW50byA9PSBudWxsKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9wdGltaXN0aWNFeGNlcHRpb24o\nX2xvYy5nZXQoImF0dGFjaC12ZXJzaW9uLWRlbCIsCiAgICAgICAgICAgICAg\nICAgICAgSW1wbEhlbHBlci5nZXRNYW5hZ2VkSW5zdGFuY2UocGMpLmdldENs\nYXNzKCksIGlkLCB2ZXJzaW9uKSkKICAgICAgICAgICAgICAgICAgICAuc2V0\nRmFpbGVkT2JqZWN0KHRvQXR0YWNoKTsKCiAgICAgICAgICAgIHNtID0gbWFu\nYWdlci5hc3NlcnRNYW5hZ2VkKGludG8pOwogICAgICAgICAgICBpZiAobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkKICAgICAgICAgICAgICAgICE9IHNtLmdl\ndE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKSB7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oX2xvYy5n\nZXQKICAgICAgICAgICAgICAgICAgICAoImF0dGFjaC13cm9uZ2NsYXNzIiwg\naWQsIHRvQXR0YWNoLmdldENsYXNzKCksCiAgICAgICAgICAgICAgICAgICAg\nICAgIHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKSkuCiAg\nICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KHRvQXR0YWNoKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZQogICAgICAgICAgICBzbSA9\nIG1hbmFnZXIuYXNzZXJ0TWFuYWdlZChpbnRvKTsKCiAgICAgICAgLy8gbWFy\nayB0aGF0IHdlIGF0dGFjaGVkIHRoZSBpbnN0YW5jZSAqYmVmb3JlKiB3ZQog\nICAgICAgIC8vIGZpbGwgaW4gdmFsdWVzIHRvIGF2b2lkIGVuZGxlc3MgcmVj\ndXJzaW9uCiAgICAgICAgbWFuYWdlci5zZXRBdHRhY2hlZENvcHkodG9BdHRh\nY2gsIGludG8pOwoKICAgICAgICAvLyBpZiBwZXJzaXN0aW5nIGluIHBsYWNl\nLCBqdXN0IGF0dGFjaCBmaWVsZCB2YWx1ZXMKICAgICAgICBpZiAocGMgPT0g\naW50bykgewogICAgICAgICAgICBhdHRhY2hGaWVsZHNJblBsYWNlKG1hbmFn\nZXIsIHNtKTsKICAgICAgICAgICAgcmV0dXJuIGludG87CiAgICAgICAgfQoK\nICAgICAgICBpZiAoaXNOZXcpIHsKICAgICAgICAgICAgYnJva2VyLmZpcmVM\naWZlY3ljbGVFdmVudCh0b0F0dGFjaCwgbnVsbCwgbWV0YSwKICAgICAgICAg\nICAgICAgIExpZmVjeWNsZUV2ZW50LkJFRk9SRV9QRVJTSVNUKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAvLyBpbnZva2UgYW55IHByZUF0dGFj\naCBvbiB0aGUgZGV0YWNoZWQgaW5zdGFuY2UKICAgICAgICAgICAgbWFuYWdl\nci5maXJlQmVmb3JlQXR0YWNoKHRvQXR0YWNoLCBtZXRhKTsKICAgICAgICB9\nCgogICAgICAgIC8vIGFzc2lnbiB0aGUgZGV0YWNoZWQgcGMgdGhlIHNhbWUg\nc3RhdGUgbWFuYWdlciBhcyB0aGUgb2JqZWN0IHdlJ3JlCiAgICAgICAgLy8g\nY29weWluZyBpbnRvIGR1cmluZyB0aGUgYXR0YWNoIHByb2Nlc3MKICAgICAg\nICBTdGF0ZU1hbmFnZXIgc21CZWZvcmUgPSBwYy5wY0dldFN0YXRlTWFuYWdl\ncigpOwogICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihzbSk7CiAg\nICAgICAgaW50IGRldGFjaCA9IChpc05ldykgPyBERVRBQ0hfQUxMIDogYnJv\na2VyLmdldERldGFjaFN0YXRlKCk7CiAgICAgICAgRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoID0gYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRz\nID0gbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBz\nd2l0Y2ggKGRldGFjaCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgREVU\nQUNIX0FMTDoKICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNoRmllbGQo\nbWFuYWdlciwgdG9BdHRhY2gsIHNtLCBmbWRzW2ldLCB0cnVlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAg\nY2FzZSBERVRBQ0hfRkVUQ0hfR1JPVVBTOgogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoZmV0Y2gucmVxdWlyZXNGZXRjaChmbWRzW2ldKSAKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICE9IEZldGNoQ29uZmlndXJhdGlvbi5G\nRVRDSF9OT05FKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNo\nRmllbGQobWFuYWdlciwgdG9BdHRhY2gsIHNtLCBmbWRzW2ldLCB0cnVlKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICAgICAgY2FzZSBERVRBQ0hfTE9BREVEOgogICAgICAgICAgICAgICAgICAg\nICAgICBhdHRhY2hGaWVsZChtYW5hZ2VyLCB0b0F0dGFjaCwgc20sIGZtZHNb\naV0sIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIoc21C\nZWZvcmUpOwogICAgICAgIH0KICAgICAgICBpZiAoIWVtYmVkZGVkICYmICFp\nc05ldykKICAgICAgICAgICAgY29tcGFyZVZlcnNpb24oc20sIHBjKTsKICAg\nICAgICByZXR1cm4gSW1wbEhlbHBlci5nZXRNYW5hZ2VkSW5zdGFuY2UoaW50\nbyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHN1cmUgdGhlIHZlcnNp\nb24gaW5mb3JtYXRpb24gaXMgY29ycmVjdCBpbiB0aGUgZGV0YWNoZWQgb2Jq\nZWN0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY29tcGFyZVZlcnNpb24o\nU3RhdGVNYW5hZ2VySW1wbCBzbSwgUGVyc2lzdGVuY2VDYXBhYmxlIHBjKSB7\nCiAgICAgICAgT2JqZWN0IHZlcnNpb24gPSBwYy5wY0dldFZlcnNpb24oKTsK\nICAgICAgICBpZiAodmVyc2lvbiA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIC8vIGRvbid0IG5lZWQgdG8gbG9hZCB1bmxvYWRlZCBm\naWVsZHMgc2luY2UgaXRzIGltcGxpY2l0bHkKICAgICAgICAvLyBhIHNpbmds\nZSBmaWVsZCB2YWx1ZQogICAgICAgIFN0b3JlTWFuYWdlciBzdG9yZSA9IHNt\nLmdldEJyb2tlcigpLmdldFN0b3JlTWFuYWdlcigpOwogICAgICAgIHN3aXRj\naCAoc3RvcmUuY29tcGFyZVZlcnNpb24oc20sIHZlcnNpb24sIHNtLmdldFZl\ncnNpb24oKSkpIHsKICAgICAgICAgICAgY2FzZSBTdG9yZU1hbmFnZXIuVkVS\nU0lPTl9MQVRFUjoKICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUgYSBsYXRl\nciB2ZXJzaW9uOiBzZXQgaXQgaW50byB0aGUgb2JqZWN0LgogICAgICAgICAg\nICAgICAgLy8gbG9jayB2YWxpZGF0aW9uIHdpbGwgb2NjdXIgYXQgY29tbWl0\nIHRpbWUKICAgICAgICAgICAgICAgIHNtLnNldFZlcnNpb24odmVyc2lvbik7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBTdG9y\nZU1hbmFnZXIuVkVSU0lPTl9FQVJMSUVSOgogICAgICAgICAgICBjYXNlIFN0\nb3JlTWFuYWdlci5WRVJTSU9OX0RJRkZFUkVOVDoKICAgICAgICAgICAgICAg\nIHNtLnNldFZlcnNpb24odmVyc2lvbik7CiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihzbS5nZXRNYW5hZ2VkSW5zdGFu\nY2UoKSk7CiAgICAgICAgICAgIGNhc2UgU3RvcmVNYW5hZ2VyLlZFUlNJT05f\nU0FNRToKICAgICAgICAgICAgICAgIC8vIG5vIGFjdGlvbiByZXF1aXJlZAog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQXR0YWNoIHRoZSBmaWVsZHMgb2YgYW4gaW4tcGxhY2UgcGVy\nc2lzdGVkIGluc3RhbmNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXR0\nYWNoRmllbGRzSW5QbGFjZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmbWRzID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IEZp\nZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgIE9iamVjdCBjdXIsIGF0dGFjaGVk\nOwogICAgICAgICAgICBzd2l0Y2ggKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAg\nICAgICAgICAgICAgICAgICAgY3VyID0gc20uZmV0Y2hPYmplY3RGaWVsZChp\nKTsKICAgICAgICAgICAgICAgICAgICBhdHRhY2hlZCA9IGF0dGFjaEluUGxh\nY2UobWFuYWdlciwgc20sIGZtZHNbaV0sIGN1cik7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5B\nUlJBWToKICAgICAgICAgICAgICAgICAgICBpZiAoIWZtZHNbaV0uZ2V0RWxl\nbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgY3VyID0gc20u\nZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAgICAgICAgICAgICAgICBhdHRh\nY2hlZCA9CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaEluUGxhY2Uo\nbWFuYWdlciwgc20sIGZtZHNbaV0sIChPYmplY3RbXSkgY3VyKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgaWYgKCFm\nbWRzW2ldLmdldEVsZW1lbnQoKS5pc0RlY2xhcmVkVHlwZVBDKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAg\nICAgIGN1ciA9IHNtLmZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAg\nICAgICAgICAgYXR0YWNoZWQgPSBhdHRhY2hJblBsYWNlKG1hbmFnZXIsIHNt\nLCBmbWRzW2ldLAogICAgICAgICAgICAgICAgICAgICAgICAoQ29sbGVjdGlv\nbikgY3VyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgICAg\nICBpZiAoIWZtZHNbaV0uZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMo\nKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAhZm1kc1tpXS5nZXRLZXko\nKS5pc0RlY2xhcmVkVHlwZVBDKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGN1ciA9IHNtLmZldGNo\nT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAgICAgICAgYXR0YWNoZWQg\nPSBhdHRhY2hJblBsYWNlKG1hbmFnZXIsIHNtLCBmbWRzW2ldLCAoTWFwKSBj\ndXIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1ciAhPSBhdHRhY2hlZCkK\nICAgICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChzbS5nZXRQ\nZXJzaXN0ZW5jZUNhcGFibGUoKSwgaSwKICAgICAgICAgICAgICAgICAgICBj\ndXIsIGF0dGFjaGVkLCBTdGF0ZU1hbmFnZXIuU0VUX1JFTU9URSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZlbiBw\nYy4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgYXR0YWNoSW5QbGFjZShB\ndHRhY2hNYW5hZ2VyIG1hbmFnZXIsIFN0YXRlTWFuYWdlckltcGwgc20sCiAg\nICAgICAgVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCBwYykgewogICAgICAg\nIGlmIChwYyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBPYmplY3QgYXR0YWNoZWQgPSBtYW5hZ2VyLmdldEF0dGFjaGVkQ29w\neShwYyk7CiAgICAgICAgaWYgKGF0dGFjaGVkICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBhdHRhY2hlZDsKCiAgICAgICAgT3BlbkpQQVN0YXRlTWFu\nYWdlciBpbnRvID0gbWFuYWdlci5nZXRCcm9rZXIoKS5nZXRTdGF0ZU1hbmFn\nZXIocGMpOwogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRvUEMgPSAo\naW50byA9PSBudWxsKSA/IG51bGwKICAgICAgICAgICAgOiBpbnRvLmdldFBl\ncnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgIGlmICh2bWQuaXNFbWJlZGRl\nZCgpKQogICAgICAgICAgICByZXR1cm4gbWFuYWdlci5hdHRhY2gocGMsIGlu\ndG9QQywgc20sIHZtZCwgZmFsc2UpOwogICAgICAgIHJldHVybiBtYW5hZ2Vy\nLmF0dGFjaChwYywgaW50b1BDLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBdHRhY2ggdGhlIGdpdmVuIGFycmF5LgogICAg\nICovCiAgICBwcml2YXRlIE9iamVjdFtdIGF0dGFjaEluUGxhY2UoQXR0YWNo\nTWFuYWdlciBtYW5hZ2VyLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLAogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kLCBPYmplY3RbXSBhcnIpIHsKICAgICAgICBp\nZiAoYXJyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgYXJyW2ldID0gYXR0YWNoSW5QbGFjZShtYW5hZ2VyLCBzbSwg\nZm1kLmdldEVsZW1lbnQoKSwgYXJyW2ldKTsKICAgICAgICByZXR1cm4gYXJy\nOwogICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZlbiBjb2xs\nZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIENvbGxlY3Rpb24gYXR0YWNo\nSW5QbGFjZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgU3RhdGVN\nYW5hZ2VySW1wbCBzbSwgRmllbGRNZXRhRGF0YSBmbWQsIENvbGxlY3Rpb24g\nY29sbCkgewogICAgICAgIGlmIChjb2xsID09IG51bGwgfHwgY29sbC5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIHJldHVybiBjb2xsOwoKICAgICAgICAvLyBj\nb3B5IGlmIGVsZW1lbnRzIGVtYmVkZGVkIG9yIGNvbnRhaW5zIGRldGFjaGVk\nLCB3aGljaCB3aWxsIG1lYW4KICAgICAgICAvLyB3ZSdsbCBoYXZlIHRvIGNv\ncHkgdGhlIGV4aXN0aW5nIGVsZW1lbnRzCiAgICAgICAgQ29sbGVjdGlvbiBj\nb3B5ID0gbnVsbDsKICAgICAgICBpZiAoZm1kLmdldEVsZW1lbnQoKS5pc0Vt\nYmVkZGVkKCkpCiAgICAgICAgICAgIGNvcHkgPSAoQ29sbGVjdGlvbikgc20u\nbmV3RmllbGRQcm94eShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY29sbC5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgaWYgKG1h\nbmFnZXIuZ2V0QnJva2VyKCkuaXNEZXRhY2hlZChpdHIubmV4dCgpKSkgewog\nICAgICAgICAgICAgICAgICAgIGNvcHkgPSAoQ29sbGVjdGlvbikgc20ubmV3\nRmllbGRQcm94eShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIE9iamVjdCBhdHRhY2hlZDsKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IGNvbGwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgYXR0YWNoZWQgPSBhdHRhY2hJblBsYWNlKG1h\nbmFnZXIsIHNtLCBmbWQuZ2V0RWxlbWVudCgpLAogICAgICAgICAgICAgICAg\naXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChjb3B5ICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBjb3B5LmFkZChhdHRhY2hlZCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiAoY29weSA9PSBudWxsKSA/IGNvbGwgOiBjb3B5Owog\nICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZlbiBtYXAuCiAg\nICAgKi8KICAgIHByaXZhdGUgTWFwIGF0dGFjaEluUGxhY2UoQXR0YWNoTWFu\nYWdlciBtYW5hZ2VyLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLAogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kLCBNYXAgbWFwKSB7CiAgICAgICAgaWYgKG1hcCA9\nPSBudWxsIHx8IG1hcC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBt\nYXA7CgogICAgICAgIE1hcCBjb3B5ID0gbnVsbDsKICAgICAgICBNYXAuRW50\ncnkgZW50cnk7CiAgICAgICAgYm9vbGVhbiBrZXlQQyA9IGZtZC5nZXRLZXko\nKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgYm9vbGVhbiB2YWxQQyA9\nIGZtZC5nZXRFbGVtZW50KCkuaXNEZWNsYXJlZFR5cGVQQygpOwoKICAgICAg\nICAvLyBjb3B5IGlmIGVtYmVkZGVkIHBjcyBvciBkZXRhY2hlZCBwY3MsIHdo\naWNoIHdpbGwgcmVxdWlyZSB1cyB0bwogICAgICAgIC8vIGNvcHkgZWxlbWVu\ndHMKICAgICAgICBpZiAoZm1kLmdldEtleSgpLmlzRW1iZWRkZWRQQygpIHx8\nIGZtZC5nZXRFbGVtZW50KCkuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAg\nIGNvcHkgPSAoTWFwKSBzbS5uZXdGaWVsZFByb3h5KGZtZC5nZXRJbmRleCgp\nKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKChrZXlQQyAmJiBtYW5hZ2Vy\nLmdldEJyb2tlcigpLmlzRGV0YWNoZWQoZW50cnkuZ2V0S2V5KCkpKQogICAg\nICAgICAgICAgICAgICAgIHx8ICh2YWxQQyAmJiBtYW5hZ2VyLmdldEJyb2tl\ncigpLmlzRGV0YWNoZWQKICAgICAgICAgICAgICAgICAgICAoZW50cnkuZ2V0\nVmFsdWUoKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgY29weSA9IChNYXAp\nIHNtLm5ld0ZpZWxkUHJveHkoZm1kLmdldEluZGV4KCkpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBPYmplY3Qga2V5LCB2YWw7CiAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChN\nYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGtleSA9IGVudHJ5\nLmdldEtleSgpOwogICAgICAgICAgICBpZiAoa2V5UEMpCiAgICAgICAgICAg\nICAgICBrZXkgPSBhdHRhY2hJblBsYWNlKG1hbmFnZXIsIHNtLCBmbWQuZ2V0\nS2V5KCksIGtleSk7CiAgICAgICAgICAgIHZhbCA9IGVudHJ5LmdldFZhbHVl\nKCk7CiAgICAgICAgICAgIGlmICh2YWxQQykKICAgICAgICAgICAgICAgIHZh\nbCA9IGF0dGFjaEluUGxhY2UobWFuYWdlciwgc20sIGZtZC5nZXRFbGVtZW50\nKCksIHZhbCk7CiAgICAgICAgICAgIGlmIChjb3B5ICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBjb3B5LnB1dChrZXksIHZhbCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiAoY29weSA9PSBudWxsKSA/IG1hcCA6IGNvcHk7Cgl9Cgog\nICAgLyoqCiAgICAgKiBGaW5kIGEgUGVyc2lzdGVuY2VDYXBhYmxlIGluc3Rh\nbmNlIG9mIGFuIE9iamVjdCBpZiBpdCBleGlzdHMgaW4gdGhlCiAgICAgKiBk\nYXRhYmFzZS4gSWYgdGhlIG9iamVjdCBpcyBudWxsIG9yIGNhbid0IGJlIGZv\ndW5kIGluIHRoZSBkYXRhYmFzZS4KICAgICAqCiAgICAgKiBAcGFyYW0gcGMg\nQW4gb2JqZWN0IHdoaWNoIHdpbGwgYmUgYXR0YWNoZWQgaW50byB0aGUgY3Vy\ncmVudCBjb250ZXh0LiBUaGUKICAgICAqIG9iamVjdCBtYXkgb3IgbWF5IG5v\ndCBjb3JyZXNwb25kIHRvIGEgcm93IGluIHRoZSBkYXRhYmFzZS4KICAgICAq\nCiAgICAgKiBAcmV0dXJuIElmIHRoZSBvYmplY3QgaXMgbnVsbCBvciBjYW4n\ndCBiZSBmb3VuZCBpbiB0aGUgZGF0YWJhc2UgdGhpcwogICAgICogbWV0aG9k\nIHJldHVybnMgbnVsbC4gT3RoZXJ3aXNlIGEgUGVyc2lzdGVuY2VDYXBhYmxl\nIHJlcHJlc2VudGF0aW9uIG9mIHRoZQogICAgICogb2JqZWN0IGlzIHJldHVy\nbmVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgUGVyc2lzdGVuY2VDYXBhYmxl\nIGZpbmRGcm9tRGF0YWJhc2UoQXR0YWNoTWFuYWdlciBtYW5hZ2VyLAogICAg\nICAgIE9iamVjdCBwYykgewogICAgICAgIE9iamVjdCBvaWQgPSBtYW5hZ2Vy\nLmdldEJyb2tlcigpLm5ld09iamVjdElkKHBjLmdldENsYXNzKCksCiAgICAg\nICAgICAgIG1hbmFnZXIuZ2V0RGV0YWNoZWRPYmplY3RJZChwYykpOwoKICAg\nICAgICBpZiAob2lkICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIElt\ncGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUoCiAgICAgICAgICAgICAg\nICBtYW5hZ2VyLmdldEJyb2tlcigpLmZpbmQob2lkLCB0cnVlLCBudWxsKSwK\nICAgICAgICAgICAgICAgIG1hbmFnZXIuZ2V0QnJva2VyKCkuZ2V0Q29uZmln\ndXJhdGlvbigpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFu\nIGlzUHJpbWFyeUtleXNHZW5lcmF0ZWQoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IG1ldGEuZ2V0UHJpbWFy\neUtleUZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGtz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwa3NbaV0uZ2V0VmFs\ndWVTdHJhdGVneSgpICE9IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KfQo=\n","encoding":"base64"}

