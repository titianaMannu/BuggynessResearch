{"sha":"1c954f91399626a6c250b60c63bd449aa7712b8b","node_id":"MDQ6QmxvYjIwNjM2NDoxYzk1NGY5MTM5OTYyNmE2YzI1MGI2MGM2M2JkNDQ5YWE3NzEyYjhi","size":62556,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1c954f91399626a6c250b60c63bd449aa7712b8b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmpwcWw7CgppbXBv\ncnQgamF2YS5pby5QcmludFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uU2VyaWFs\naXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmllbGQ7CmltcG9y\ndCBqYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5TdGFjazsKaW1w\nb3J0IGphdmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29t\nbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5FeHByZXNzaW9uU3RvcmVRdWVyeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlDb250ZXh0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeU9wZXJhdGlv\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlQ29u\ndGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuQnJva2Vy\nRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5BYnN0cmFjdEV4cHJlc3Npb25CdWlsZGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuRXhwcmVzc2lvbkZhY3Rvcnk7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuTGl0ZXJh\nbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5QYXJh\nbWV0ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMu\nUGF0aDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5R\ndWVyeUV4cHJlc3Npb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5leHBzLlN1YnF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5leHBzLlZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuTWV0YURhdGFSZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5jb25mLkNvbXBhdGliaWxpdHk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0\nIHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIEJ1aWxkZXIgZm9yIEpQUUwg\nZXhwcmVzc2lvbnMuIFRoaXMgY2xhc3MgdGFrZXMgdGhlIHF1ZXJ5IHBhcnNl\nZAogKiBpbiB7QGxpbmsgSlBRTH0gYW5kIGNvbnZlcnRzIGl0IHRvIGFuIGV4\ncHJlc3Npb24gdHJlZSB1c2luZwogKiBhbiB7QGxpbmsgRXhwcmVzc2lvbkZh\nY3Rvcnl9LiBQdWJsaWMgZm9yIHVuaXQgdGVzdGluZyBwdXJwb3Nlcy4KICoK\nICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICogQGF1dGhvciBQYXRy\naWNrIExpbnNrZXkKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEpQ\nUUxFeHByZXNzaW9uQnVpbGRlcgogICAgZXh0ZW5kcyBBYnN0cmFjdEV4cHJl\nc3Npb25CdWlsZGVyCiAgICBpbXBsZW1lbnRzIEpQUUxUcmVlQ29uc3RhbnRz\nIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgVkFSX1BBVEggPSAx\nOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFZBUl9FUlJPUiA9IDI7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChKUFFMRXhwcmVzc2lvbkJ1\naWxkZXIuY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgU3RhY2sgY29udGV4\ndHMgPSBuZXcgU3RhY2soKTsKICAgIHByaXZhdGUgTGlua2VkTWFwIHBhcmFt\nZXRlclR5cGVzOwogICAgcHJpdmF0ZSBpbnQgYWxpYXNDb3VudCA9IDA7Cgog\nICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAqCiAgICAgKiBAcGFy\nYW0gZmFjdG9yeSB0aGUgZXhwcmVzc2lvbiBmYWN0b3J5IHRvIHVzZQogICAg\nICogQHBhcmFtIHF1ZXJ5IHVzZWQgdG8gcmVzb2x2ZSB2YXJpYWJsZXMsIHBh\ncmFtZXRlcnMsCiAgICAgKiBhbmQgY2xhc3MgbmFtZXMgdXNlZCBpbiB0aGUg\ncXVlcnkKICAgICAqIEBwYXJhbSBwYXJzZWRRdWVyeSB0aGUgcGFyc2VkIHF1\nZXJ5CiAgICAgKi8KICAgIHB1YmxpYyBKUFFMRXhwcmVzc2lvbkJ1aWxkZXIo\nRXhwcmVzc2lvbkZhY3RvcnkgZmFjdG9yeSwKICAgICAgICBFeHByZXNzaW9u\nU3RvcmVRdWVyeSBxdWVyeSwgT2JqZWN0IHBhcnNlZFF1ZXJ5KSB7CiAgICAg\nICAgc3VwZXIoZmFjdG9yeSwgcXVlcnkuZ2V0UmVzb2x2ZXIoKSk7CgogICAg\nICAgIGNvbnRleHRzLnB1c2gobmV3IENvbnRleHQocGFyc2VkUXVlcnkgaW5z\ndGFuY2VvZiBQYXJzZWRKUFFMCiAgICAgICAgICAgID8gKFBhcnNlZEpQUUwp\nIHBhcnNlZFF1ZXJ5CiAgICAgICAgICAgIDogcGFyc2VkUXVlcnkgaW5zdGFu\nY2VvZiBTdHJpbmcKICAgICAgICAgICAgPyBnZXRQYXJzZWRRdWVyeSgoU3Ry\naW5nKSBwYXJzZWRRdWVyeSkKICAgICAgICAgICAgOiBudWxsLCBudWxsKSk7\nCgogICAgICAgIGlmIChjdHgoKS5wYXJzZWQgPT0gbnVsbCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKHBhcnNlZFF1ZXJ5ICsg\nIiIpOwogICAgfQoKICAgIHByb3RlY3RlZCBMb2NhbGl6ZXIgZ2V0TG9jYWxp\nemVyKCkgewogICAgICAgIHJldHVybiBfbG9jOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBDbGFzc0xvYWRlciBnZXRDbGFzc0xvYWRlcigpIHsKICAgICAgICAv\nLyB3ZSBkb24ndCByZXNvbHZlIGluIHRoZSBjb250ZXh0IG9mIGFueXRoaW5n\nIGJ1dCBvdXJzZWx2ZXMKICAgICAgICByZXR1cm4gZ2V0Q2xhc3MoKS5nZXRD\nbGFzc0xvYWRlcigpOwogICAgfQoKICAgIHByb3RlY3RlZCBQYXJzZWRKUFFM\nIGdldFBhcnNlZFF1ZXJ5KCkgewogICAgICAgIHJldHVybiBjdHgoKS5wYXJz\nZWQ7CiAgICB9CgogICAgcHJvdGVjdGVkIFBhcnNlZEpQUUwgZ2V0UGFyc2Vk\nUXVlcnkoU3RyaW5nIGpwcWwpIHsKICAgICAgICByZXR1cm4gbmV3IFBhcnNl\nZEpQUUwoanBxbCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHNldENhbmRp\nZGF0ZShDbGFzc01ldGFEYXRhIGNtZCwgU3RyaW5nIHNjaGVtYUFsaWFzKSB7\nCiAgICAgICAgYWRkQWNjZXNzUGF0aChjbWQpOwoKICAgICAgICBpZiAoY21k\nICE9IG51bGwpCiAgICAgICAgICAgIGN0eCgpLm1ldGEgPSBjbWQ7CgogICAg\nICAgIGlmIChzY2hlbWFBbGlhcyAhPSBudWxsKQogICAgICAgICAgICBjdHgo\nKS5zY2hlbWFBbGlhcyA9IHNjaGVtYUFsaWFzOwogICAgfQoKICAgIHByaXZh\ndGUgU3RyaW5nIG5leHRBbGlhcygpIHsKICAgICAgICByZXR1cm4gImpwcWxh\nbGlhcyIgKyAoKythbGlhc0NvdW50KTsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nQ2xhc3NNZXRhRGF0YSByZXNvbHZlQ2xhc3NNZXRhRGF0YShKUFFMTm9kZSBu\nb2RlKSB7CiAgICAgICAgLy8gaGFuZGxlIGxvb2tpbmcgdXAgYWxpYXMgbmFt\nZXMKICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSA9IGFzc2VydFNjaGVtYU5h\nbWUobm9kZSk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBnZXRDbGFz\nc01ldGFEYXRhKHNjaGVtYU5hbWUsIGZhbHNlKTsKICAgICAgICBpZiAoY21k\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBjbWQ7CgogICAgICAgIC8v\nIHdlIG1pZ2h0IGJlIHJlZmVyZW5jaW5nIGEgY29sbGVjdGlvbiBmaWVsZCBv\nZiBhIHN1YnF1ZXJ5J3MgcGFyZW50CiAgICAgICAgaWYgKGlzUGF0aChub2Rl\nKSkgewogICAgICAgICAgICBQYXRoIHBhdGggPSBnZXRQYXRoKG5vZGUpOwog\nICAgICAgICAgICByZXR1cm4gZ2V0RmllbGRUeXBlKHBhdGgubGFzdCgpKTsK\nICAgICAgICB9CgogICAgICAgIC8vIG5vdyBydW4gYWdhaW4gdG8gdGhyb3cg\ndGhlIGNvcnJlY3QgZXhjZXB0aW9uCiAgICAgICAgcmV0dXJuIGdldENsYXNz\nTWV0YURhdGEoc2NoZW1hTmFtZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJpdmF0\nZSBDbGFzc01ldGFEYXRhIGdldENsYXNzTWV0YURhdGEoU3RyaW5nIGFsaWFz\nLCBib29sZWFuIGFzc2VydFZhbGlkKSB7CiAgICAgICAgQ2xhc3NMb2FkZXIg\nbG9hZGVyID0gZ2V0Q2xhc3NMb2FkZXIoKTsKICAgICAgICBNZXRhRGF0YVJl\ncG9zaXRvcnkgcmVwb3MgPSByZXNvbHZlci5nZXRDb25maWd1cmF0aW9uKCku\nCiAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7\nCgogICAgICAgIC8vIGZpcnN0IGNoZWNrIGZvciB0aGUgYWxpYXMKICAgICAg\nICBDbGFzc01ldGFEYXRhIGNtZCA9IHJlcG9zLmdldE1ldGFEYXRhKGFsaWFz\nLCBsb2FkZXIsIGZhbHNlKTsKCiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gY21kOwoKICAgICAgICAvLyBub3cgY2hlY2sg\nZm9yIHRoZSBjbGFzcyBuYW1lOyB0aGlzIGlzIG5vdCB0ZWNobmljYWxseSBw\nZXJtaXR0ZWQKICAgICAgICAvLyBieSB0aGUgSlBBIHNwZWMsIGJ1dCBpcyBy\nZXF1aXJlZCBpbiBvcmRlciB0byBiZSBhYmxlIHRvIGV4ZWN1dGUKICAgICAg\nICAvLyBKUFFMIHF1ZXJpZXMgZnJvbSBvdGhlciBmYWNhZGVzIChsaWtlIEpE\nTykgdGhhdCBkbyBub3QgaGF2ZQogICAgICAgIC8vIHRoZSBjb25jZXB0IG9m\nIGVudGl0eSBuYW1lcyBvciBhbGlhc2VzCiAgICAgICAgQ2xhc3MgYyA9IHJl\nc29sdmVyLmNsYXNzRm9yTmFtZShhbGlhcywgbnVsbCk7CiAgICAgICAgaWYg\nKGMgIT0gbnVsbCkKICAgICAgICAgICAgY21kID0gcmVwb3MuZ2V0TWV0YURh\ndGEoYywgbG9hZGVyLCBhc3NlcnRWYWxpZCk7CiAgICAgICAgZWxzZSBpZiAo\nYXNzZXJ0VmFsaWQpCiAgICAgICAgICAgIGNtZCA9IHJlcG9zLmdldE1ldGFE\nYXRhKGFsaWFzLCBsb2FkZXIsIGZhbHNlKTsKCiAgICAgICAgaWYgKGNtZCA9\nPSBudWxsICYmIGFzc2VydFZhbGlkKSB7CiAgICAgICAgICAgIFN0cmluZyBj\nbG9zZSA9IHJlcG9zLmdldENsb3Nlc3RBbGlhc05hbWUoYWxpYXMpOwogICAg\nICAgICAgICBpZiAoY2xvc2UgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3Qtc2NoZW1hLW5hbWUt\naGludCIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBhbGlh\ncywgY2xvc2UsIHJlcG9zLmdldEFsaWFzTmFtZXMoKSB9LCBudWxsKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNl\ncHRpb24oRVhfVVNFUiwgIm5vdC1zY2hlbWEtbmFtZSIsCiAgICAgICAgICAg\nICAgICAgICAgbmV3IE9iamVjdFtdeyBhbGlhcywgcmVwb3MuZ2V0QWxpYXNO\nYW1lcygpIH0sIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNt\nZDsKICAgIH0KCiAgICBwcml2YXRlIENsYXNzIGdldENhbmRpZGF0ZVR5cGUo\nKSB7CiAgICAgICAgcmV0dXJuIGdldENhbmRpZGF0ZU1ldGFEYXRhKCkuZ2V0\nRGVzY3JpYmVkVHlwZSgpOwogICAgfQoKICAgIHByaXZhdGUgQ2xhc3NNZXRh\nRGF0YSBnZXRDYW5kaWRhdGVNZXRhRGF0YSgpIHsKICAgICAgICBpZiAoY3R4\nKCkubWV0YSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gY3R4KCkubWV0\nYTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbHMgPSBnZXRDYW5kaWRhdGVN\nZXRhRGF0YShyb290KCkpOwogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAg\nICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC1z\nY2hlbWEtbmFtZSIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IHJv\nb3QoKSB9LCBudWxsKTsKCiAgICAgICAgc2V0Q2FuZGlkYXRlKGNscywgbnVs\nbCk7CiAgICAgICAgcmV0dXJuIGNsczsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nQ2xhc3NNZXRhRGF0YSBnZXRDYW5kaWRhdGVNZXRhRGF0YShKUFFMTm9kZSBu\nb2RlKSB7CiAgICAgICAgLy8gZXhhbWluZyB0aGUgbm9kZSB0byBmaW5kIHRo\nZSBjYW5kaWRhdGUgcXVlcnkKICAgICAgICAvLyAjIyMgdGhpcyBzaG91bGQg\nYWN0dWFsbHkgYmUgdGhlIHByaW1hcnkgU0VMRUNUIGluc3RhbmNlCiAgICAg\nICAgLy8gcmVzb2x2ZWQgYWdhaW5zdCB0aGUgZnJvbSB2YXJpYWJsZSBkZWNs\nYXJhdGlvbnMKICAgICAgICBKUFFMTm9kZSBmcm9tID0gbm9kZS5maW5kQ2hp\nbGRCeUlEKEpKVEZST01JVEVNLCB0cnVlKTsKICAgICAgICBpZiAoZnJvbSA9\nPSBudWxsKSB7CiAgICAgICAgICAgIC8vIE9QRU5KUEEtMTUgYWxsb3cgc3Vi\ncXVlcnkgd2l0aG91dCBhIEZST01JVEVNCiAgICAgICAgICAgIGlmIChub2Rl\nLmlkID09IEpKVFNVQlNFTEVDVCkgeyAKICAgICAgICAgICAgICAgIGZyb20g\nPSBub2RlLmZpbmRDaGlsZEJ5SUQoSkpURlJPTSwgdHJ1ZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJv\ndyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm8tZnJvbS1jbGF1c2UiLCBu\ndWxsLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmcm9tLmNoaWxkcmVuLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIEpQUUxOb2RlIG4gPSBmcm9tLmNoaWxkcmVuW2ld\nOwoKICAgICAgICAgICAgaWYgKG4uaWQgPT0gSkpUQUJTVFJBQ1RTQ0hFTUFO\nQU1FKSB7CiAgICAgICAgICAgICAgICAvLyB3ZSBzaW1wbHkgcmV0dXJuIHRo\nZSBmaXJzdCBhYnN0cmFjdCBzY2hlbWEgY2hpbGQKICAgICAgICAgICAgICAg\nIC8vIGFzIHJlc29sdmVkIGludG8gYSBjbGFzcwogICAgICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBjbWQgPSByZXNvbHZlQ2xhc3NNZXRhRGF0YShuKTsK\nCiAgICAgICAgICAgICAgICBpZiAoY21kICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGNtZDsKCiAgICAgICAgICAgICAgICAvLyBub3Qg\nYSBzY2hlbWE6IHRyZWF0IGl0IGFzIGEgY2xhc3MKICAgICAgICAgICAgICAg\nIFN0cmluZyBjbHMgPSBhc3NlcnRTY2hlbWFOYW1lKG4pOwogICAgICAgICAg\nICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3Qtc2NoZW1hLW5hbWUi\nLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IHJvb3Qo\nKSB9LCBudWxsKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2xhc3NN\nZXRhRGF0YShjbHMsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIC8vIE9QRU5KUEEtMTUgc3VwcG9ydCBzdWJxdWVyeSdzIGZyb20gY2xhdXNl\nIGRvIG5vdCBzdGFydCB3aXRoIAogICAgICAgICAgICAvLyBpZGVudGlmaWNh\ndGlvbl92YXJpYWJsZV9kZWNsYXJhdGlvbigpCiAgICAgICAgICAgIGlmIChu\nb2RlLmlkID09IEpKVFNVQlNFTEVDVCkgewogICAgICAgICAgICAgICAgaWYg\nKG4uaWQgPT0gSkpUSU5ORVJKT0lOKSB7CiAgICAgICAgICAgICAgICAgICAg\nbiA9IG4uZ2V0Q2hpbGQoMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICBpZiAobi5pZCA9PSBKSlRQQVRIKSB7CiAgICAgICAgICAgICAg\nICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0aChuKTsKICAgICAgICAgICAgICAg\nICAgICBDbGFzc01ldGFEYXRhIGNtZCA9IGdldEZpZWxkVHlwZShwYXRoLmxh\nc3QoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNtZCAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbWQ7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAg\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9V\nU0VSLCAibm8tYWxpYXMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W117IG4gfSwgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ICAgICAg\nICAgICAKICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoK\nICAgIHByb3RlY3RlZCBTdHJpbmcgY3VycmVudFF1ZXJ5KCkgewogICAgICAg\nIHJldHVybiBjdHgoKS5wYXJzZWQgPT0gbnVsbCB8fCByb290KCkucGFyc2Vy\nID09IG51bGwgPyBudWxsCiAgICAgICAgICAgIDogcm9vdCgpLnBhcnNlci5q\ncHFsOwogICAgfQoKICAgIFF1ZXJ5RXhwcmVzc2lvbnMgZ2V0UXVlcnlFeHBy\nZXNzaW9ucygpIHsKICAgICAgICBRdWVyeUV4cHJlc3Npb25zIGV4cHMgPSBu\nZXcgUXVlcnlFeHByZXNzaW9ucygpOwoKICAgICAgICBldmFsUXVlcnlPcGVy\nYXRpb24oZXhwcyk7CgogICAgICAgIEV4cHJlc3Npb24gZmlsdGVyID0gbnVs\nbDsKICAgICAgICBmaWx0ZXIgPSBhbmQoZXZhbEZyb21DbGF1c2Uocm9vdCgp\nLmlkID09IEpKVFNFTEVDVCksIGZpbHRlcik7CiAgICAgICAgZmlsdGVyID0g\nYW5kKGV2YWxXaGVyZUNsYXVzZSgpLCBmaWx0ZXIpOwogICAgICAgIGZpbHRl\nciA9IGFuZChldmFsU2VsZWN0Q2xhdXNlKGV4cHMpLCBmaWx0ZXIpOwoKICAg\nICAgICBleHBzLmZpbHRlciA9IGZpbHRlciA9PSBudWxsID8gZmFjdG9yeS5l\nbXB0eUV4cHJlc3Npb24oKSA6IGZpbHRlcjsKCiAgICAgICAgZXZhbEdyb3Vw\naW5nQ2xhdXNlKGV4cHMpOwogICAgICAgIGV2YWxIYXZpbmdDbGF1c2UoZXhw\ncyk7CiAgICAgICAgZXZhbEZldGNoSm9pbnMoZXhwcyk7CiAgICAgICAgZXZh\nbFNldENsYXVzZShleHBzKTsKICAgICAgICBldmFsT3JkZXJpbmdDbGF1c2Vz\nKGV4cHMpOwoKICAgICAgICBpZiAocGFyYW1ldGVyVHlwZXMgIT0gbnVsbCkK\nICAgICAgICAgICAgZXhwcy5wYXJhbWV0ZXJUeXBlcyA9IHBhcmFtZXRlclR5\ncGVzOwoKICAgICAgICBleHBzLmFjY2Vzc1BhdGggPSBnZXRBY2Nlc3NQYXRo\nKCk7CgogICAgICAgIHJldHVybiBleHBzOwogICAgfQoKICAgIHByaXZhdGUg\nRXhwcmVzc2lvbiBhbmQoRXhwcmVzc2lvbiBlMSwgRXhwcmVzc2lvbiBlMikg\newogICAgICAgIHJldHVybiBlMSA9PSBudWxsID8gZTIgOiBlMiA9PSBudWxs\nID8gZTEgOiBmYWN0b3J5LmFuZChlMSwgZTIpOwogICAgfQoKICAgIHByaXZh\ndGUgc3RhdGljIFN0cmluZyBhc3NlbWJsZShKUFFMTm9kZSBub2RlKSB7CiAg\nICAgICAgcmV0dXJuIGFzc2VtYmxlKG5vZGUsICIuIiwgMCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBc3NlbWJsZSB0aGUgY2hpbGRyZW4gb2YgdGhlIHNw\nZWNpZmljIG5vZGUgYnkgYXBwZW5kaW5nIGVhY2gKICAgICAqIGNoaWxkLCBz\nZXBhcmF0ZWQgYnkgdGhlIGRlbGltaXRlci4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgU3RyaW5nIGFzc2VtYmxlKEpQUUxOb2RlIG5vZGUsIFN0cmlu\nZyBkZWxpbWl0ZXIsIGludCBsYXN0KSB7CiAgICAgICAgU3RyaW5nQnVmZmVy\nIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBKUFFMTm9k\nZVtdIHBhcnRzID0gbm9kZS5jaGlsZHJlbjsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgcGFydHMgIT0gbnVsbCAmJiBpIDwgcGFydHMubGVuZ3RoIC0gbGFz\ndDsgaSsrKQogICAgICAgICAgICByZXN1bHQuYXBwZW5kKHJlc3VsdC5sZW5n\ndGgoKSA+IDAgPyBkZWxpbWl0ZXIgOiAiIikuCiAgICAgICAgICAgICAgICBh\ncHBlbmQocGFydHNbaV0udGV4dCk7CgogICAgICAgIHJldHVybiByZXN1bHQu\ndG9TdHJpbmcoKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gYXNz\naWduUHJvamVjdGlvbnMoSlBRTE5vZGUgcGFyYW1ldGVyc05vZGUsCiAgICAg\nICAgUXVlcnlFeHByZXNzaW9ucyBleHBzKSB7CiAgICAgICAgaW50IGNvdW50\nID0gcGFyYW1ldGVyc05vZGUuZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgIGV4\ncHMucHJvamVjdGlvbnMgPSBuZXcgVmFsdWVbY291bnRdOwogICAgICAgIGV4\ncHMucHJvamVjdGlvbkNsYXVzZXMgPSBuZXcgU3RyaW5nW2NvdW50XTsKICAg\nICAgICBleHBzLnByb2plY3Rpb25BbGlhc2VzID0gbmV3IFN0cmluZ1tjb3Vu\ndF07CgogICAgICAgIEV4cHJlc3Npb24gZXhwID0gbnVsbDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgICAg\nSlBRTE5vZGUgcGFyZW50ID0gcGFyYW1ldGVyc05vZGUuZ2V0Q2hpbGQoaSk7\nCiAgICAgICAgICAgIEpQUUxOb2RlIG5vZGUgPSBvbmx5Q2hpbGQocGFyZW50\nKTsKICAgICAgICAgICAgVmFsdWUgcHJvaiA9IGdldFZhbHVlKG5vZGUpOwog\nICAgICAgICAgICBleHBzLnByb2plY3Rpb25zW2ldID0gcHJvajsKICAgICAg\nICAgICAgZXhwcy5wcm9qZWN0aW9uQ2xhdXNlc1tpXSA9IGFzc2VtYmxlKG5v\nZGUpOwogICAgICAgICAgICBleHBzLnByb2plY3Rpb25BbGlhc2VzW2ldID0g\nbmV4dEFsaWFzKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBleHA7CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIGV2YWxRdWVyeU9wZXJhdGlvbihRdWVy\neUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICAvLyBkZXRlcm1pbmUgd2hl\ndGhlciB3ZSB3YW50IHRvIHNlbGVjdCwgZGVsZXRlLCBvciB1cGRhdGUKICAg\nICAgICBpZiAocm9vdCgpLmlkID09IEpKVFNFTEVDVCB8fCByb290KCkuaWQg\nPT0gSkpUU1VCU0VMRUNUKQogICAgICAgICAgICBleHBzLm9wZXJhdGlvbiA9\nIFF1ZXJ5T3BlcmF0aW9ucy5PUF9TRUxFQ1Q7CiAgICAgICAgZWxzZSBpZiAo\ncm9vdCgpLmlkID09IEpKVERFTEVURSkKICAgICAgICAgICAgZXhwcy5vcGVy\nYXRpb24gPSBRdWVyeU9wZXJhdGlvbnMuT1BfREVMRVRFOwogICAgICAgIGVs\nc2UgaWYgKHJvb3QoKS5pZCA9PSBKSlRVUERBVEUpCiAgICAgICAgICAgIGV4\ncHMub3BlcmF0aW9uID0gUXVlcnlPcGVyYXRpb25zLk9QX1VQREFURTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVY\nX1VOU1VQUE9SVEVELCAidW5yZWNvZ25pemVkLW9wZXJhdGlvbiIsCiAgICAg\nICAgICAgICAgICBuZXcgT2JqZWN0W117IHJvb3QoKSB9LCBudWxsKTsKICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgZXZhbEdyb3VwaW5nQ2xhdXNlKFF1ZXJ5\nRXhwcmVzc2lvbnMgZXhwcykgewogICAgICAgIC8vIGhhbmRsZSBHUk9VUCBC\nWSBjbGF1c2VzCiAgICAgICAgSlBRTE5vZGUgZ3JvdXBCeU5vZGUgPSByb290\nKCkuZmluZENoaWxkQnlJRChKSlRHUk9VUEJZLCB0cnVlKTsKCiAgICAgICAg\naWYgKGdyb3VwQnlOb2RlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgaW50IGdyb3VwQnlDb3VudCA9IGdyb3VwQnlOb2RlLmdldENo\naWxkQ291bnQoKTsKCiAgICAgICAgZXhwcy5ncm91cGluZyA9IG5ldyBWYWx1\nZVtncm91cEJ5Q291bnRdOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGdyb3VwQnlDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIEpQUUxOb2RlIG5v\nZGUgPSBncm91cEJ5Tm9kZS5nZXRDaGlsZChpKTsKICAgICAgICAgICAgZXhw\ncy5ncm91cGluZ1tpXSA9IGdldFZhbHVlKG5vZGUpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgZXZhbEhhdmluZ0NsYXVzZShRdWVyeUV4\ncHJlc3Npb25zIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgSEFWSU5HIGNs\nYXVzZXMKICAgICAgICBKUFFMTm9kZSBoYXZpbmdOb2RlID0gcm9vdCgpLmZp\nbmRDaGlsZEJ5SUQoSkpUSEFWSU5HLCB0cnVlKTsKCiAgICAgICAgaWYgKGhh\ndmluZ05vZGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBleHBzLmhhdmluZyA9IGdldEV4cHJlc3Npb24ob25seUNoaWxkKGhhdmlu\nZ05vZGUpKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZhbE9yZGVyaW5n\nQ2xhdXNlcyhRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICAvLyBo\nYW5kbGUgT1JERVIgQlkgY2xhdXNlcwogICAgICAgIEpQUUxOb2RlIG9yZGVy\nYnkgPSByb290KCkuZmluZENoaWxkQnlJRChKSlRPUkRFUkJZLCBmYWxzZSk7\nCiAgICAgICAgaWYgKG9yZGVyYnkgIT0gbnVsbCkgewogICAgICAgICAgICBp\nbnQgb3JkZXJjb3VudCA9IG9yZGVyYnkuZ2V0Q2hpbGRDb3VudCgpOwogICAg\nICAgICAgICBleHBzLm9yZGVyaW5nID0gbmV3IFZhbHVlW29yZGVyY291bnRd\nOwogICAgICAgICAgICBleHBzLm9yZGVyaW5nQ2xhdXNlcyA9IG5ldyBTdHJp\nbmdbb3JkZXJjb3VudF07CiAgICAgICAgICAgIGV4cHMuYXNjZW5kaW5nID0g\nbmV3IGJvb2xlYW5bb3JkZXJjb3VudF07CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgb3JkZXJjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBKUFFMTm9kZSBub2RlID0gb3JkZXJieS5nZXRDaGlsZChpKTsKICAgICAg\nICAgICAgICAgIGV4cHMub3JkZXJpbmdbaV0gPSBnZXRWYWx1ZShmaXJzdENo\naWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgIGV4cHMub3JkZXJpbmdDbGF1\nc2VzW2ldID0gYXNzZW1ibGUoZmlyc3RDaGlsZChub2RlKSk7CiAgICAgICAg\nICAgICAgICAvLyBvbW1pc3Npb24gb2YgQVNDL0RFU0MgdG9rZW4gaW1wbGll\ncyBhc2NlbmRpbmcKICAgICAgICAgICAgICAgIGV4cHMuYXNjZW5kaW5nW2ld\nID0gbm9kZS5nZXRDaGlsZENvdW50KCkgPD0gMSB8fAogICAgICAgICAgICAg\nICAgICAgIGxhc3RDaGlsZChub2RlKS5pZCA9PSBKSlRBU0NFTkRJTkcgPyB0\ncnVlIDogZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgcHJpdmF0ZSBFeHByZXNzaW9uIGV2YWxTZWxlY3RDbGF1c2UoUXVlcnlF\neHByZXNzaW9ucyBleHBzKSB7CiAgICAgICAgaWYgKGV4cHMub3BlcmF0aW9u\nICE9IFF1ZXJ5T3BlcmF0aW9ucy5PUF9TRUxFQ1QpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBKUFFMTm9kZSBzZWxlY3ROb2RlID0gcm9v\ndCgpOwoKICAgICAgICBKUFFMTm9kZSBzZWxlY3RDbGF1c2UgPSBzZWxlY3RO\nb2RlLgogICAgICAgICAgICBmaW5kQ2hpbGRCeUlEKEpKVFNFTEVDVENMQVVT\nRSwgZmFsc2UpOwogICAgICAgIGlmIChzZWxlY3RDbGF1c2UgIT0gbnVsbCAm\nJiBzZWxlY3RDbGF1c2UuaGFzQ2hpbGRJRChKSlRESVNUSU5DVCkpCiAgICAg\nICAgICAgIGV4cHMuZGlzdGluY3QgPSBleHBzLkRJU1RJTkNUX1RSVUUgfCBl\neHBzLkRJU1RJTkNUX0FVVE87CiAgICAgICAgZWxzZQogICAgICAgICAgICBl\neHBzLmRpc3RpbmN0ID0gZXhwcy5ESVNUSU5DVF9GQUxTRTsKCiAgICAgICAg\nSlBRTE5vZGUgY29uc3RydWN0b3IgPSBzZWxlY3ROb2RlLmZpbmRDaGlsZEJ5\nSUQoSkpUQ09OU1RSVUNUT1IsIHRydWUpOwogICAgICAgIGlmIChjb25zdHJ1\nY3RvciAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGJ1aWxkIHVwIHRoZSBm\ndWxseS1xdWFsaWZpZWQgcmVzdWx0IGNsYXNzIG5hbWUgYnkKICAgICAgICAg\nICAgLy8gYXBwZW5kaW5nIHRvZ2V0aGVyIHRoZSBjb21wb25lbnRzIG9mIHRo\nZSBjaGlsZHJlbgogICAgICAgICAgICBTdHJpbmcgcmVzdWx0Q2xhc3NOYW1l\nID0gYXNzZW1ibGUobGVmdChjb25zdHJ1Y3RvcikpOwogICAgICAgICAgICBl\neHBzLnJlc3VsdENsYXNzID0gcmVzb2x2ZXIuY2xhc3NGb3JOYW1lKHJlc3Vs\ndENsYXNzTmFtZSwgbnVsbCk7CgogICAgICAgICAgICAvLyBub3cgYXNzaWdu\nIHRoZSBhcmd1bWVudHMgdG8gdGhlIHNlbGVjdCBjbGF1c2UgYXMgdGhlIHBy\nb2plY3Rpb25zCiAgICAgICAgICAgIHJldHVybiBhc3NpZ25Qcm9qZWN0aW9u\ncyhyaWdodChjb25zdHJ1Y3RvciksIGV4cHMpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIC8vIGhhbmRsZSBTRUxFQ1QgY2xhdXNlcwogICAgICAg\nICAgICBKUFFMTm9kZSBleHBOb2RlID0gc2VsZWN0Tm9kZS4KICAgICAgICAg\nICAgICAgIGZpbmRDaGlsZEJ5SUQoSkpUU0VMRUNURVhQUkVTU0lPTlMsIHRy\ndWUpOwogICAgICAgICAgICBpZiAoZXhwTm9kZSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICBpbnQgc2VsZWN0\nQ291bnQgPSBleHBOb2RlLmdldENoaWxkQ291bnQoKTsKICAgICAgICAgICAg\nSlBRTE5vZGUgc2VsZWN0Q2hpbGQgPSBmaXJzdENoaWxkKGV4cE5vZGUpOwoK\nICAgICAgICAgICAgLy8gaWYgd2UgYXJlIHNlbGVjdGluZyBqdXN0IG9uZSB0\naGluZyBhbmQgdGhhdCB0aGluZyBpcyB0aGUKICAgICAgICAgICAgLy8gc2No\nZW1hJ3MgYWxpYXMsIHRoZW4gZG8gbm90IHRyZWF0IGl0IGFzIGEgcHJvamVj\ndGlvbgogICAgICAgICAgICBpZiAoc2VsZWN0Q291bnQgPT0gMSAmJiBzZWxl\nY3RDaGlsZCAhPSBudWxsICYmCiAgICAgICAgICAgICAgICBzZWxlY3RDaGls\nZC5nZXRDaGlsZENvdW50KCkgPT0gMSAmJgogICAgICAgICAgICAgICAgb25s\neUNoaWxkKHNlbGVjdENoaWxkKSAhPSBudWxsICYmCiAgICAgICAgICAgICAg\nICBhc3NlcnRTY2hlbWFBbGlhcygpLgogICAgICAgICAgICAgICAgICAgIGVx\ndWFsc0lnbm9yZUNhc2Uob25seUNoaWxkKHNlbGVjdENoaWxkKS50ZXh0KSkg\newogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBKUFFMIGRvZXMgbm90IGZpbHRl\nciByZWxhdGlvbmFsIGpvaW5zIGZvciBwcm9qZWN0aW9ucwogICAgICAgICAg\nICAgICAgZXhwcy5kaXN0aW5jdCAmPSB+ZXhwcy5ESVNUSU5DVF9BVVRPOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGFzc2lnblByb2plY3Rpb25zKGV4cE5v\nZGUsIGV4cHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgU3RyaW5nIGFzc2VydFNjaGVtYUFsaWFzKCkgewogICAgICAg\nIFN0cmluZyBhbGlhcyA9IGN0eCgpLnNjaGVtYUFsaWFzOwoKICAgICAgICBp\nZiAoYWxpYXMgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNl\ncHRpb24oRVhfVVNFUiwgImFsaWFzLXJlcXVpcmVkIiwKICAgICAgICAgICAg\nICAgIG5ldyBPYmplY3RbXXsgY3R4KCkubWV0YSB9LCBudWxsKTsKCiAgICAg\nICAgcmV0dXJuIGFsaWFzOwogICAgfQoKICAgIHByb3RlY3RlZCBFeHByZXNz\naW9uIGV2YWxGZXRjaEpvaW5zKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykgewog\nICAgICAgIEV4cHJlc3Npb24gZmlsdGVyID0gbnVsbDsKCiAgICAgICAgLy8g\naGFuZGxlIEpPSU4gRkVUQ0gKICAgICAgICBTZXQgam9pbnMgPSBudWxsOwog\nICAgICAgIFNldCBpbm5lckpvaW5zID0gbnVsbDsKCiAgICAgICAgSlBRTE5v\nZGVbXSBvdXRlcnMgPSByb290KCkuZmluZENoaWxkcmVuQnlJRChKSlRPVVRF\nUkZFVENISk9JTik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IG91dGVycyAh\nPSBudWxsICYmIGkgPCBvdXRlcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nIChqb2lucyA9PSBudWxsID8gam9pbnMgPSBuZXcgVHJlZVNldCgpIDogam9p\nbnMpLgogICAgICAgICAgICAgICAgYWRkKGdldFBhdGgob25seUNoaWxkKG91\ndGVyc1tpXSkpLmxhc3QoKS5nZXRGdWxsTmFtZShmYWxzZSkpOwoKICAgICAg\nICBKUFFMTm9kZVtdIGlubmVycyA9IHJvb3QoKS5maW5kQ2hpbGRyZW5CeUlE\nKEpKVElOTkVSRkVUQ0hKT0lOKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naW5uZXJzICE9IG51bGwgJiYgaSA8IGlubmVycy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBTdHJpbmcgcGF0aCA9IGdldFBhdGgob25seUNoaWxkKGlu\nbmVyc1tpXSkpLmxhc3QoKQogICAgICAgICAgICAgICAgLmdldEZ1bGxOYW1l\nKGZhbHNlKTsKICAgICAgICAgICAgKGpvaW5zID09IG51bGwgPyBqb2lucyA9\nIG5ldyBUcmVlU2V0KCkgOiBqb2lucykuYWRkKHBhdGgpOwogICAgICAgICAg\nICAoaW5uZXJKb2lucyA9PSBudWxsID8gaW5uZXJKb2lucyA9IG5ldyBUcmVl\nU2V0KCkgOiBpbm5lckpvaW5zKS4KICAgICAgICAgICAgICAgIGFkZChwYXRo\nKTsKICAgICAgICB9CgogICAgICAgIGlmIChqb2lucyAhPSBudWxsKQogICAg\nICAgICAgICBleHBzLmZldGNoUGF0aHMgPSAoU3RyaW5nW10pIGpvaW5zLgog\nICAgICAgICAgICAgICAgdG9BcnJheShuZXcgU3RyaW5nW2pvaW5zLnNpemUo\nKV0pOwogICAgICAgIGlmIChpbm5lckpvaW5zICE9IG51bGwpCiAgICAgICAg\nICAgIGV4cHMuZmV0Y2hJbm5lclBhdGhzID0gKFN0cmluZ1tdKSBpbm5lckpv\naW5zLgogICAgICAgICAgICAgICAgdG9BcnJheShuZXcgU3RyaW5nW2lubmVy\nSm9pbnMuc2l6ZSgpXSk7CgogICAgICAgIHJldHVybiBmaWx0ZXI7CiAgICB9\nCgogICAgcHJvdGVjdGVkIHZvaWQgZXZhbFNldENsYXVzZShRdWVyeUV4cHJl\nc3Npb25zIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgU0VUIGZpZWxkID0g\ndmFsdWUKICAgICAgICBKUFFMTm9kZVtdIG5vZGVzID0gcm9vdCgpLmZpbmRD\naGlsZHJlbkJ5SUQoSkpUVVBEQVRFSVRFTSk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IG5vZGVzICE9IG51bGwgJiYgaSA8IG5vZGVzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIFBhdGggcGF0aCA9IGdldFBhdGgoZmlyc3RDaGls\nZChub2Rlc1tpXSkpOwogICAgICAgICAgICBWYWx1ZSB2YWwgPSBnZXRWYWx1\nZShvbmx5Q2hpbGQobGFzdENoaWxkKG5vZGVzW2ldKSkpOwogICAgICAgICAg\nICBleHBzLnB1dFVwZGF0ZShwYXRoLCB2YWwpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZXZhbFdoZXJlQ2xhdXNlKCkgewog\nICAgICAgIC8vIGV2YWx1YXRlIHRoZSBXSEVSRSBjbGF1c2UKICAgICAgICBK\nUFFMTm9kZSB3aGVyZU5vZGUgPSByb290KCkuZmluZENoaWxkQnlJRChKSlRX\nSEVSRSwgZmFsc2UpOwogICAgICAgIGlmICh3aGVyZU5vZGUgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIChFeHBy\nZXNzaW9uKSBldmFsKHdoZXJlTm9kZSk7CiAgICB9CgogICAgcHJpdmF0ZSBF\neHByZXNzaW9uIGV2YWxGcm9tQ2xhdXNlKGJvb2xlYW4gbmVlZHNBbGlhcykg\newogICAgICAgIEV4cHJlc3Npb24gZXhwID0gbnVsbDsKCiAgICAgICAgLy8g\nYnVpbGQgdXAgdGhlIGFsaWFzIG1hcCBpbiB0aGUgRlJPTSBjbGF1c2UKICAg\nICAgICBKUFFMTm9kZSBmcm9tID0gcm9vdCgpLmZpbmRDaGlsZEJ5SUQoSkpU\nRlJPTSwgZmFsc2UpOwogICAgICAgIGlmIChmcm9tID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJuby1mcm9t\nLWNsYXVzZSIsIG51bGwsIG51bGwpOwoKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZyb20uY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgSlBRTE5vZGUgbm9kZSA9IGZyb20uY2hpbGRyZW5baV07CgogICAgICAg\nICAgICBpZiAobm9kZS5pZCA9PSBKSlRGUk9NSVRFTSkKICAgICAgICAgICAg\nICAgIGV4cCA9IGV2YWxGcm9tSXRlbShleHAsIG5vZGUsIG5lZWRzQWxpYXMp\nOwogICAgICAgICAgICBlbHNlIGlmIChub2RlLmlkID09IEpKVE9VVEVSSk9J\nTikKICAgICAgICAgICAgICAgIGV4cCA9IGFkZEpvaW4obm9kZSwgZmFsc2Us\nIGV4cCk7CiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUuaWQgPT0gSkpUSU5O\nRVJKT0lOKQogICAgICAgICAgICAgICAgZXhwID0gYWRkSm9pbihub2RlLCB0\ncnVlLCBleHApOwogICAgICAgICAgICBlbHNlIGlmIChub2RlLmlkID09IEpK\nVElOTkVSRkVUQ0hKT0lOKQogICAgICAgICAgICAgICAgOyAvLyB3ZSBoYW5k\nbGUgaW5uZXIgZmV0Y2ggam9pbnMgaW4gdGhlIGV2YWxGZXRjaEpvaW5zKCkg\nbWV0aG9kCiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUuaWQgPT0gSkpUT1VU\nRVJGRVRDSEpPSU4pCiAgICAgICAgICAgICAgICA7IC8vIHdlIGhhbmRsZSBv\ndXRlciBmZXRjaCBqb2lucyBpbiB0aGUgZXZhbEZldGNoSm9pbnMoKSBtZXRo\nb2QKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cgcGFy\nc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC1zY2hlbWEtbmFtZSIsCiAgICAg\nICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2RlIH0sIG51bGwpOwog\nICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgYSBqb2luIGNvbmRpdGlvbiB0byB0aGUgZ2l2ZW4gZXhw\ncmVzc2lvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gbm9kZSB0aGUgbm9kZSB0\nbyBjaGVjawogICAgICogQHBhcmFtIGlubmVyIHdoZXRoZXIgb3Igbm90IHRo\nZSBqb2luIHNob3VsZCBiZSBhbiBpbm5lciBqb2luCiAgICAgKiBAcGFyYW0g\nZXhwIGFuIGV4aXN0aW5nIGV4cHJlc3Npb24gdG8gQU5ELCBvciBudWxsIGlm\nIG5vbmUKICAgICAqIEByZXR1cm4gdGhlIEV4cHJlc3Npb24gd2l0aCB0aGUg\nam9pbiBjb25kaXRpb24gYWRkZWQKICAgICAqLwogICAgcHJpdmF0ZSBFeHBy\nZXNzaW9uIGFkZEpvaW4oSlBRTE5vZGUgbm9kZSwgYm9vbGVhbiBpbm5lciwg\nRXhwcmVzc2lvbiBleHApIHsKICAgICAgICAvLyB0aGUgdHlwZSB3aWxsIGJl\nIHRoZSBkZWNsYXJlZCB0eXBlIGZvciB0aGUgZmllbGQKICAgICAgICBQYXRo\nIHBhdGggPSBnZXRQYXRoKGZpcnN0Q2hpbGQobm9kZSksIGZhbHNlLCBpbm5l\ncik7CgogICAgICAgIEpQUUxOb2RlIGFsaWFzID0gbm9kZS5nZXRDaGlsZENv\ndW50KCkgPj0gMiA/IHJpZ2h0KG5vZGUpIDogbnVsbDsKICAgICAgICAvLyBP\nUEVOSlBBLTE1IHN1cHBvcnQgc3VicXVlcnkncyBmcm9tIGNsYXVzZSBkbyBu\nb3Qgc3RhcnQgd2l0aCAKICAgICAgICAvLyBpZGVudGlmaWNhdGlvbl92YXJp\nYWJsZV9kZWNsYXJhdGlvbigpCiAgICAgICAgaWYgKGlubmVyICYmIGN0eCgp\nLnN1YnF1ZXJ5ICE9IG51bGwgJiYgY3R4KCkuc2NoZW1hQWxpYXMgPT0gbnVs\nbCkgewogICAgICAgICAgICBzZXRDYW5kaWRhdGUoZ2V0RmllbGRUeXBlKHBh\ndGgubGFzdCgpKSwgYWxpYXMudGV4dCk7CgogICAgICAgICAgICBQYXRoIHN1\nYnBhdGggPSBmYWN0b3J5Lm5ld1BhdGgoY3R4KCkuc3VicXVlcnkpOwogICAg\nICAgICAgICBzdWJwYXRoLnNldE1ldGFEYXRhKGN0eCgpLnN1YnF1ZXJ5Lmdl\ndE1ldGFEYXRhKCkpOwogICAgICAgICAgICBleHAgPSAgYW5kKGV4cCwgZmFj\ndG9yeS5lcXVhbChwYXRoLCBzdWJwYXRoKSk7CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gYWRkSm9pbihwYXRoLCBhbGlhcywgZXhwKTsKICAgIH0KCiAg\nICBwcml2YXRlIEV4cHJlc3Npb24gYWRkSm9pbihQYXRoIHBhdGgsIEpQUUxO\nb2RlIGFsaWFzTm9kZSwKICAgICAgICBFeHByZXNzaW9uIGV4cCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gcGF0aC5sYXN0KCk7CgogICAgICAg\nIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNl\ncHRpb24oRVhfVVNFUiwgInBhdGgtbm8tbWV0YSIsCiAgICAgICAgICAgICAg\nICBuZXcgT2JqZWN0W117IHBhdGgsIG51bGwgfSwgbnVsbCk7CgogICAgICAg\nIFN0cmluZyBhbGlhcyA9IGFsaWFzTm9kZSAhPSBudWxsID8gYWxpYXNOb2Rl\nLnRleHQgOiBuZXh0QWxpYXMoKTsKCiAgICAgICAgVmFsdWUgdmFyID0gZ2V0\nVmFyaWFibGUoYWxpYXMsIHRydWUpOwogICAgICAgIHZhci5zZXRNZXRhRGF0\nYShnZXRGaWVsZFR5cGUoZm1kKSk7CgogICAgICAgIEV4cHJlc3Npb24gam9p\nbiA9IG51bGw7CgogICAgICAgIC8vIGlmIHRoZSB2YXJpYWJsZSBpcyBhbHJl\nYWR5IGJvdW5kLCBnZXQgdGhlIHZhcidzIHZhbHVlIGFuZAogICAgICAgIC8v\nIGRvIGEgcmVndWxhciBjb250YWlucyB3aXRoIHRoYXQKICAgICAgICBib29s\nZWFuIGJvdW5kID0gaXNCb3VuZCh2YXIpOwogICAgICAgIGlmIChib3VuZCkg\newogICAgICAgICAgICB2YXIgPSBnZXRWYWx1ZShhbGlhc05vZGUsIFZBUl9Q\nQVRIKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiaW5kKHZhcik7\nCiAgICAgICAgICAgIGpvaW4gPSBhbmQoam9pbiwgZmFjdG9yeS5iaW5kVmFy\naWFibGUodmFyLCBwYXRoKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWZt\nZC5pc1R5cGVQQygpKSAvLyBtdWx0aS12YWx1ZWQgcmVsYXRpb24KICAgICAg\nICB7CiAgICAgICAgICAgIGlmIChib3VuZCkKICAgICAgICAgICAgICAgIGpv\naW4gPSBhbmQoam9pbiwgZmFjdG9yeS5jb250YWlucyhwYXRoLCB2YXIpKTsK\nCiAgICAgICAgICAgIHNldEltcGxpY2l0Q29udGFpbnNUeXBlcyhwYXRoLCB2\nYXIsIENPTlRBSU5TX1RZUEVfRUxFTUVOVCk7CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gYW5kKGV4cCwgam9pbik7CiAgICB9CgogICAgcHJpdmF0ZSBF\neHByZXNzaW9uIGV2YWxGcm9tSXRlbShFeHByZXNzaW9uIGV4cCwgSlBRTE5v\nZGUgbm9kZSwKICAgICAgICBib29sZWFuIG5lZWRzQWxpYXMpIHsKICAgICAg\nICBDbGFzc01ldGFEYXRhIGNtZCA9IHJlc29sdmVDbGFzc01ldGFEYXRhKGZp\ncnN0Q2hpbGQobm9kZSkpOwoKICAgICAgICBTdHJpbmcgYWxpYXMgPSBudWxs\nOwoKICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENvdW50KCkgPCAyKSB7CiAg\nICAgICAgICAgIGlmIChuZWVkc0FsaWFzKQogICAgICAgICAgICAgICAgdGhy\nb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImFsaWFzLXJlcXVpcmVkIiwK\nICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGNtZCB9LCBudWxs\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGlhcyA9IHJpZ2h0\nKG5vZGUpLnRleHQ7CiAgICAgICAgICAgIEpQUUxOb2RlIGxlZnQgPSBsZWZ0\nKG5vZGUpOwoKICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSB3\nZSBhcmUgcmVmZXJyaW5nIHRvIGEgcGF0aCBpbiB0aGUgZnJvbQogICAgICAg\nICAgICAvLyBjbGF1c2UsIHNpbmNlIHdlIG1pZ2h0IGJlIGluIGEgc3VicXVl\ncnkgYWdhaW5zdCBhIGNvbGxlY3Rpb24KICAgICAgICAgICAgaWYgKGlzUGF0\naChsZWZ0KSkgewogICAgICAgICAgICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0\naChsZWZ0KTsKICAgICAgICAgICAgICAgIHNldENhbmRpZGF0ZShnZXRGaWVs\nZFR5cGUocGF0aC5sYXN0KCkpLCBhbGlhcyk7CgogICAgICAgICAgICAgICAg\nUGF0aCBzdWJwYXRoID0gZmFjdG9yeS5uZXdQYXRoKGN0eCgpLnN1YnF1ZXJ5\nKTsKICAgICAgICAgICAgICAgIHN1YnBhdGguc2V0TWV0YURhdGEoY3R4KCku\nc3VicXVlcnkuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gYW5kKGV4cCwgZmFjdG9yeS5lcXVhbChwYXRoLCBzdWJwYXRoKSk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyB3ZSBoYXZl\nIGFuIGFsaWFzOiBiaW5kIGl0IGFzIGEgdmFyaWFibGUKICAgICAgICAgICAg\nICAgIFZhbHVlIHZhciA9IGdldFZhcmlhYmxlKGFsaWFzLCB0cnVlKTsKICAg\nICAgICAgICAgICAgIHZhci5zZXRNZXRhRGF0YShjbWQpOwogICAgICAgICAg\nICAgICAgYmluZCh2YXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyAjIyMgd2UgYXNzaWduIHRoZSBmaXJzdCBGUk9NSVRFTSBpbnN0\nYW5jZSB3ZSBzZWUgYXMKICAgICAgICAvLyB0aGUgZ2xvYmFsIGNhbmRpZGF0\nZSwgd2hpY2ggaXMgaW5jb3JyZWN0OiB3ZSBzaG91bGQKICAgICAgICAvLyBp\nbnN0ZWFkIGJlIG1hcHBpbmcgdGhpcyB0byB0aGUgU0VMRUNUSVRFTSB0byBz\nZWUKICAgICAgICAvLyB3aGljaCBpcyB0aGUgZGVzaXJlZCBjYW5kaWRhdGUK\nICAgICAgICBpZiAoY3R4KCkuc2NoZW1hQWxpYXMgPT0gbnVsbCkKICAgICAg\nICAgICAgc2V0Q2FuZGlkYXRlKGNtZCwgYWxpYXMpOwoKICAgICAgICByZXR1\ncm4gZXhwOwogICAgfQoKICAgIHByb3RlY3RlZCBib29sZWFuIGlzRGVjbGFy\nZWRWYXJpYWJsZShTdHJpbmcgbmFtZSkgewogICAgICAgIC8vIEpQUUwgZG9l\nc24ndCBzdXBwb3J0IGRlY2xhcmluZyB2YXJpYWJsZXMKICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0byBzZWUg\naWYgdGhlIHNwZWNpZmljIG5vZGUgaXMgYSBwYXRoICh2cy4gYSBzY2hlbWEg\nbmFtZSkKICAgICAqLwogICAgYm9vbGVhbiBpc1BhdGgoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIGlmIChub2RlLmdldENoaWxkQ291bnQoKSA8IDIpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgZmluYWwgU3RyaW5n\nIG5hbWUgPSBmaXJzdENoaWxkKG5vZGUpLnRleHQ7CiAgICAgICAgaWYgKG5h\nbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICAvLyBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdGhlIGNsYXNzIG5hbWUgaXMg\ndGhlIGFsaWFzCiAgICAgICAgLy8gZm9yIHRoZSBjYW5kaWRhdGUgKHdlIGRv\nbid0IHVzZSB2YXJpYWJsZXMgZm9yIHRoaXMpCiAgICAgICAgaWYgKGdldE1l\ndGFEYXRhRm9yQWxpYXMobmFtZSkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CgogICAgICAgIGlmICghaXNTZWVuVmFyaWFibGUobmFtZSkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgZmluYWwgVmFs\ndWUgdmFyID0gZ2V0VmFyaWFibGUobmFtZSwgZmFsc2UpOwoKICAgICAgICBp\nZiAodmFyICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBpc0JvdW5kKHZh\ncik7CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwcml2YXRl\nIHN0YXRpYyBDbGFzc01ldGFEYXRhIGdldEZpZWxkVHlwZShGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0g\nbnVsbDsKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZDsKCiAgICAgICAgaWYg\nKCh2bWQgPSBmbWQuZ2V0RWxlbWVudCgpKSAhPSBudWxsKQogICAgICAgICAg\nICBjbWQgPSB2bWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAg\nICBlbHNlIGlmICgodm1kID0gZm1kLmdldEtleSgpKSAhPSBudWxsKQogICAg\nICAgICAgICBjbWQgPSB2bWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsK\nICAgICAgICBlbHNlIGlmICgodm1kID0gZm1kLmdldFZhbHVlKCkpICE9IG51\nbGwpCiAgICAgICAgICAgIGNtZCA9IHZtZC5nZXREZWNsYXJlZFR5cGVNZXRh\nRGF0YSgpOwoKICAgICAgICBpZiAoY21kID09IG51bGwgfHwgY21kLmdldERl\nc2NyaWJlZFR5cGUoKSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIGNt\nZCA9IGZtZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwoKICAgICAgICBy\nZXR1cm4gY21kOwogICAgfQoKICAgIC8qKgogICAgICogSWRlbnRpZmljYXRp\nb24gdmFyaWFibGVzIGluIEpQUUwgYXJlIGNhc2UgaW5zZW5zaXRpdmUsIHNv\nIGxvd2VyLWNhc2UKICAgICAqIGFsbCB2YXJpYWJsZXMgd2UgYXJlIGdvaW5n\nIHRvIGJpbmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWYWx1ZSBnZXRWYXJp\nYWJsZShTdHJpbmcgaWQsIGJvb2xlYW4gYmluZCkgewogICAgICAgIGlmIChp\nZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\ncmV0dXJuIHN1cGVyLmdldFZhcmlhYmxlKGlkLnRvTG93ZXJDYXNlKCksIGJp\nbmQpOwogICAgfQoKICAgIHByb3RlY3RlZCBib29sZWFuIGlzU2VlbmRWYXJp\nYWJsZShTdHJpbmcgaWQpIHsKICAgICAgICByZXR1cm4gaWQgIT0gbnVsbCAm\nJiBzdXBlci5pc1NlZW5WYXJpYWJsZShpZC50b0xvd2VyQ2FzZSgpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGNsYXNzIG5hbWUgdXNp\nbmcgdGhlIGNoaWxkcmVuIG9mIHRoZSBKUFFMTm9kZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBTdHJpbmcgYXNzZXJ0U2NoZW1hTmFtZShKUFFMTm9kZSBub2Rl\nKSB7CiAgICAgICAgaWYgKG5vZGUuaWQgIT0gSkpUQUJTVFJBQ1RTQ0hFTUFO\nQU1FKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VS\nLCAibm90LWlkZW50aWZlciIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW117IG5vZGUgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBhc3NlbWJsZShu\nb2RlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZSBoZWxwZXIg\nbWV0aG9kIHRvIGV2YWx1YXRlIHRoZSBnaXZlbiBub2RlLgogICAgICovCiAg\nICBwcml2YXRlIE9iamVjdCBldmFsKEpQUUxOb2RlIG5vZGUpIHsKICAgICAg\nICBWYWx1ZSB2YWwxID0gbnVsbDsKICAgICAgICBWYWx1ZSB2YWwyID0gbnVs\nbDsKICAgICAgICBWYWx1ZSB2YWwzID0gbnVsbDsKCiAgICAgICAgYm9vbGVh\nbiBub3QgPSBub2RlLm5vdDsKCiAgICAgICAgc3dpdGNoIChub2RlLmlkKSB7\nCiAgICAgICAgICAgIGNhc2UgSkpUV0hFUkU6IC8vIHRvcC1sZXZlbCBXSEVS\nRSBjbGF1c2UKICAgICAgICAgICAgICAgIHJldHVybiBnZXRFeHByZXNzaW9u\nKG9ubHlDaGlsZChub2RlKSk7CgogICAgICAgICAgICBjYXNlIEpKVEJPT0xF\nQU5MSVRFUkFMOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3\nTGl0ZXJhbCgidHJ1ZSIuZXF1YWxzSWdub3JlQ2FzZQogICAgICAgICAgICAg\nICAgICAgIChub2RlLnRleHQpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRSwKICAgICAgICAgICAgICAgICAgICBMaXRlcmFsLlRZUEVfQk9PTEVB\nTik7CgogICAgICAgICAgICBjYXNlIEpKVElOVEVHRVJMSVRFUkFMOgogICAg\nICAgICAgICAgICAgLy8gdXNlIEJpZ0RlY2ltYWwgYmVjYXVzZSBpdCBjYW4g\naGFuZGxlIHBhcnNpbmcgZXhwb25lbnRzCiAgICAgICAgICAgICAgICBCaWdE\nZWNpbWFsIGludGxpdCA9IG5ldyBCaWdEZWNpbWFsCiAgICAgICAgICAgICAg\nICAgICAgKG5vZGUudGV4dC5lbmRzV2l0aCgibCIpIHx8IG5vZGUudGV4dC5l\nbmRzV2l0aCgiTCIpCiAgICAgICAgICAgICAgICAgICAgICAgID8gbm9kZS50\nZXh0LnN1YnN0cmluZygwLCBub2RlLnRleHQubGVuZ3RoKCkgLSAxKQogICAg\nICAgICAgICAgICAgICAgICAgICA6IG5vZGUudGV4dCkuCiAgICAgICAgICAg\nICAgICAgICAgbXVsdGlwbHkobmV3IEJpZ0RlY2ltYWwobmVnYXRpdmUobm9k\nZSkpKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVy\nYWwobmV3IExvbmcoaW50bGl0LmxvbmdWYWx1ZSgpKSwKICAgICAgICAgICAg\nICAgICAgICBMaXRlcmFsLlRZUEVfTlVNQkVSKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUREVDSU1BTExJVEVSQUw6CiAgICAgICAgICAgICAgICBCaWdEZWNp\nbWFsIGRlY2xpdCA9IG5ldyBCaWdEZWNpbWFsCiAgICAgICAgICAgICAgICAg\nICAgKG5vZGUudGV4dC5lbmRzV2l0aCgiZCIpIHx8IG5vZGUudGV4dC5lbmRz\nV2l0aCgiRCIpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUudGV4\ndC5lbmRzV2l0aCgiZiIpIHx8IG5vZGUudGV4dC5lbmRzV2l0aCgiRiIpCiAg\nICAgICAgICAgICAgICAgICAgICAgID8gbm9kZS50ZXh0LnN1YnN0cmluZygw\nLCBub2RlLnRleHQubGVuZ3RoKCkgLSAxKQogICAgICAgICAgICAgICAgICAg\nICAgICA6IG5vZGUudGV4dCkuCiAgICAgICAgICAgICAgICAgICAgbXVsdGlw\nbHkobmV3IEJpZ0RlY2ltYWwobmVnYXRpdmUobm9kZSkpKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwoZGVjbGl0LCBMaXRl\ncmFsLlRZUEVfTlVNQkVSKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU1RSSU5H\nTElURVJBTDoKICAgICAgICAgICAgY2FzZSBKSlRUUklNQ0hBUkFDVEVSOgog\nICAgICAgICAgICBjYXNlIEpKVEVTQ0FQRUNIQVJBQ1RFUjoKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwodHJpbVF1b3Rlcyhu\nb2RlLnRleHQpLAogICAgICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9T\nUV9TVFJJTkcpOwoKICAgICAgICAgICAgY2FzZSBKSlRQQVRURVJOVkFMVUU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbChmaXJzdENoaWxkKG5vZGUp\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTkFNRURJTlBVVFBBUkFNRVRFUjoK\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXJhbWV0ZXIobm9kZS50ZXh0\nLCBmYWxzZSk7CgogICAgICAgICAgICBjYXNlIEpKVFBPU0lUSU9OQUxJTlBV\nVFBBUkFNRVRFUjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXJhbWV0\nZXIobm9kZS50ZXh0LCB0cnVlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUT1I6\nIC8vIHggT1IgeQogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkub3Io\nZ2V0RXhwcmVzc2lvbihsZWZ0KG5vZGUpKSwKICAgICAgICAgICAgICAgICAg\nICBnZXRFeHByZXNzaW9uKHJpZ2h0KG5vZGUpKSk7CgogICAgICAgICAgICBj\nYXNlIEpKVEFORDogLy8geCBBTkQgeQogICAgICAgICAgICAgICAgcmV0dXJu\nIGFuZChnZXRFeHByZXNzaW9uKGxlZnQobm9kZSkpLAogICAgICAgICAgICAg\nICAgICAgIGdldEV4cHJlc3Npb24ocmlnaHQobm9kZSkpKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpURVFVQUxTOiAvLyB4ID0geQogICAgICAgICAgICAgICAg\ndmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAg\ndmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAg\nIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKTsKCiAg\nICAgICAgICAgIGNhc2UgSkpUTk9URVFVQUxTOiAvLyB4IDw+IHkKICAgICAg\nICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAg\nICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAg\nICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkubm90RXF1YWwodmFs\nMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVExFU1NUSEFOOiAvLyB4\nIDwgeQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9k\nZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5v\nZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwg\ndmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5s\nZXNzVGhhbih2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTEVT\nU09SRVFVQUw6IC8vIHggPD0geQogICAgICAgICAgICAgICAgdmFsMSA9IGdl\ndFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdl\ndFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxp\nY2l0VHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFjdG9yeS5sZXNzVGhhbkVxdWFsKHZhbDEsIHZhbDIpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRHUkVBVEVSVEhBTjogLy8geCA+IHkKICAgICAg\nICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAg\nICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAg\nICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ3JlYXRlclRoYW4o\ndmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVEdSRUFURVJPUkVR\nVUFMOiAvLyB4ID49IHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1\nZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1\nZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5\ncGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhY3RvcnkuZ3JlYXRlclRoYW5FcXVhbCh2YWwxLCB2YWwyKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUQUREOiAvLyB4ICsgeQogICAgICAgICAgICAgICAg\ndmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAg\ndmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAg\nIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgVFlQRV9OVU1CRVIpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYWRkKHZhbDEsIHZhbDIp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRTVUJUUkFDVDogLy8geCAtIHkKICAg\nICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAg\nICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAg\nICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZ\nUEVfTlVNQkVSKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN1\nYnRyYWN0KHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRNVUxU\nSVBMWTogLy8geCAqIHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1\nZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1\nZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5\ncGVzKHZhbDEsIHZhbDIsIFRZUEVfTlVNQkVSKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5Lm11bHRpcGx5KHZhbDEsIHZhbDIpOwoKICAgICAg\nICAgICAgY2FzZSBKSlRESVZJREU6IC8vIHggLyB5CiAgICAgICAgICAgICAg\nICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAg\nICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBUWVBFX05VTUJFUik7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5kaXZpZGUodmFsMSwg\ndmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVEJFVFdFRU46IC8vIHguZmll\nbGQgW05PVF0gQkVUV0VFTiA1IEFORCAxMAogICAgICAgICAgICAgICAgdmFs\nMSA9IGdldFZhbHVlKGNoaWxkKG5vZGUsIDAsIDMpKTsKICAgICAgICAgICAg\nICAgIHZhbDIgPSBnZXRWYWx1ZShjaGlsZChub2RlLCAxLCAzKSk7CiAgICAg\nICAgICAgICAgICB2YWwzID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMiwgMykp\nOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwy\nLCBudWxsKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFs\nMSwgdmFsMywgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbE5v\ndChub3QsIGFuZChmYWN0b3J5LmdyZWF0ZXJUaGFuRXF1YWwodmFsMSwgdmFs\nMiksCiAgICAgICAgICAgICAgICAgICAgZmFjdG9yeS5sZXNzVGhhbkVxdWFs\nKHZhbDEsIHZhbDMpKSk7CgogICAgICAgICAgICBjYXNlIEpKVElOOiAvLyB4\nLmZpZWxkIFtOT1RdIElOICgnYScsICdiJywgJ2MnKQoKICAgICAgICAgICAg\nICAgIEV4cHJlc3Npb24gaW5FeHAgPSBudWxsOwogICAgICAgICAgICAgICAg\nSXRlcmF0b3IgaW5JdGVyYXRvciA9IG5vZGUuaXRlcmF0b3IoKTsKICAgICAg\nICAgICAgICAgIC8vIHRoZSBmaXJzdCBjaGlsZCBpcyB0aGUgcGF0aAogICAg\nICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKChKUFFMTm9kZSkgaW5JdGVy\nYXRvci5uZXh0KCkpOwoKICAgICAgICAgICAgICAgIHdoaWxlIChpbkl0ZXJh\ndG9yLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgICAgIHZhbDIgPSBn\nZXRWYWx1ZSgoSlBRTE5vZGUpIGluSXRlcmF0b3IubmV4dCgpKTsKCiAgICAg\nICAgICAgICAgICAgICAgLy8gc3BlY2lhbCBjYXNlIGZvciA8dmFsdWU+IElO\nICg8c3VicXVlcnk+KSBvcgogICAgICAgICAgICAgICAgICAgIC8vIDx2YWx1\nZT4gSU4gKDxzaW5nbGUgdmFsdWU+KQogICAgICAgICAgICAgICAgICAgIGlm\nICghKHZhbDIgaW5zdGFuY2VvZiBMaXRlcmFsKSAmJiBub2RlLmdldENoaWxk\nQ291bnQoKSA9PSAyKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZXZhbE5vdChub3QsIGZhY3RvcnkuY29udGFpbnModmFsMiwgdmFsMSkpOyAK\nCiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBpcyBjdXJyZW50bHkgYSBz\nZXF1ZW5jZSBvZiBPUiBleHByZXNzaW9ucywgc2luY2Ugd2UKICAgICAgICAg\nICAgICAgICAgICAvLyBkbyBub3QgaGF2ZSBzdXBwb3J0IGZvciBJTiBleHBy\nZXNzaW9ucwogICAgICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXMo\ndmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlu\nRXhwID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGluRXhwID0g\nZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGluRXhwID0gZmFjdG9y\neS5vcihpbkV4cCwgZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKSk7CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gd2UgYWRkaXRpb25h\nbGx5IG5lZWQgdG8gYWRkIGluIGEgIk5PVCBOVUxMIiBjbGF1c2UsIHNpbmNl\nCiAgICAgICAgICAgICAgICAvLyB0aGUgSU4gYmVoYXZpb3IgdGhhdCBpcyBl\neHBlY3RlZCBieSB0aGUgQ1RTIGFsc28gZXhwZWN0cwogICAgICAgICAgICAg\nICAgLy8gdG8gZmlsdGVyIG91ciBOVUxMcwogICAgICAgICAgICAgICAgcmV0\ndXJuIGFuZChldmFsTm90KG5vdCwgaW5FeHApLAogICAgICAgICAgICAgICAg\nICAgIGZhY3Rvcnkubm90RXF1YWwodmFsMSwgZmFjdG9yeS5nZXROdWxsKCkp\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUSVNOVUxMOiAvLyB4LmZpZWxkIElT\nIFtOT1RdIE5VTEwKICAgICAgICAgICAgICAgIGlmIChub3QpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkubm90RXF1YWwKICAgICAgICAg\nICAgICAgICAgICAgICAgKGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSksIGZh\nY3RvcnkuZ2V0TnVsbCgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5lcXVhbAogICAgICAgICAg\nICAgICAgICAgICAgICAoZ2V0VmFsdWUob25seUNoaWxkKG5vZGUpKSwgZmFj\ndG9yeS5nZXROdWxsKCkpOwoKICAgICAgICAgICAgY2FzZSBKSlRQQVRIOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldFBhdGhPckNvbnN0YW50KG5vZGUp\nOwoKICAgICAgICAgICAgY2FzZSBKSlRJREVOVElGSUVSOgogICAgICAgICAg\nICBjYXNlIEpKVElERU5USUZJQ0FUSU9OVkFSSUFCTEU6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0SWRlbnRpZmllcihub2RlKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUTk9UOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnku\nbm90KGdldEV4cHJlc3Npb24ob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAg\nICAgICBjYXNlIEpKVExJS0U6IC8vIGZpZWxkIExJS0UgJyVzb21ldmFsJScK\nICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsK\nICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7\nCgogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVf\nU1RSSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwy\nLCBUWVBFX1NUUklORyk7CgogICAgICAgICAgICAgICAgLy8gbG9vayBmb3Ig\nYW4gZXNjYXBlIGNoYXJhY3RlciBiZW5lYXRoIHRoZSBub2RlCiAgICAgICAg\nICAgICAgICBTdHJpbmcgZXNjYXBlID0gbnVsbDsKICAgICAgICAgICAgICAg\nIEpQUUxOb2RlIGVzY2FwZU5vZGUgPSByaWdodChub2RlKS4KICAgICAgICAg\nICAgICAgICAgICBmaW5kQ2hpbGRCeUlEKEpKVEVTQ0FQRUNIQVJBQ1RFUiwg\ndHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAoZXNjYXBlTm9kZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGVzY2FwZSA9IHRyaW1RdW90ZXMob25s\neUNoaWxkKGVzY2FwZU5vZGUpLnRleHQpOwoKICAgICAgICAgICAgICAgIGlm\nIChub3QpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkubm90\nTWF0Y2hlcyh2YWwxLCB2YWwyLCAiXyIsICIlIiwgZXNjYXBlKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5tYXRjaGVzKHZhbDEsIHZhbDIsICJfIiwgIiUiLCBlc2NhcGUpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRJU0VNUFRZOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGV2YWxOb3Qobm90LAogICAgICAgICAgICAgICAgICAgIGZhY3Rv\ncnkuaXNFbXB0eShnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKSk7CgogICAg\nICAgICAgICBjYXNlIEpKVFNJWkU6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFjdG9yeS5zaXplKGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRVUFBFUjoKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAg\nc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVfU1RSSU5HKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5LnRvVXBwZXJDYXNlKHZhbDEpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRMT1dFUjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5LnRvTG93ZXJDYXNlKGdldFN0cmluZ1ZhbHVlKG9ubHlDaGls\nZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRMRU5HVEg6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5zdHJpbmdMZW5ndGgoZ2V0U3Ry\naW5nVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNl\nIEpKVEFCUzoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmFicyhn\nZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUU1FSVDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLnNxcnQoZ2V0TnVtYmVyVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAg\nICAgICAgICBjYXNlIEpKVE1PRDoKICAgICAgICAgICAgICAgIHZhbDEgPSBn\nZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBn\nZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBs\naWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZUEVfTlVNQkVSKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm1vZCh2YWwxLCB2YWwyKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUVFJJTTogLy8gVFJJTShbW3doZXJlXSBbY2hhcl0g\nRlJPTV0gZmllbGQpCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUo\nbGFzdENoaWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0\nVHlwZSh2YWwxLCBUWVBFX1NUUklORyk7CgogICAgICAgICAgICAgICAgQm9v\nbGVhbiB0cmltV2hlcmUgPSBudWxsOwoKICAgICAgICAgICAgICAgIEpQUUxO\nb2RlIGZpcnN0VHJpbUNoaWxkID0gZmlyc3RDaGlsZChub2RlKTsKCiAgICAg\nICAgICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENvdW50KCkgPiAxKSB7CiAg\nICAgICAgICAgICAgICAgICAgdHJpbVdoZXJlID0KICAgICAgICAgICAgICAg\nICAgICAgICAgZmlyc3RUcmltQ2hpbGQuaWQgPT0gSkpUVFJJTUxFQURJTkcg\nPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDoK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0VHJpbUNoaWxkLmlk\nID09IEpKVFRSSU1UUkFJTElORyA/IEJvb2xlYW4uRkFMU0UKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICA6IG51bGw7CiAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgVmFsdWUgdHJpbUNoYXI7CgogICAgICAg\nICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIDMgY2hpbGRyZW4sIHRoZW4gd2Ug\na25vdyB0aGUgdHJpbQogICAgICAgICAgICAgICAgLy8gY2hhciBpcyB0aGUg\nc2Vjb25kIG5vZGUKICAgICAgICAgICAgICAgIGlmIChub2RlLmdldENoaWxk\nQ291bnQoKSA9PSAzKQogICAgICAgICAgICAgICAgICAgIHRyaW1DaGFyID0g\nZ2V0VmFsdWUoc2Vjb25kQ2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAg\nICAgIC8vIGlmIHRoZXJlIGFyZSB0d28gY2hpbGRyZW4sIHRoZW4gd2UgbmVl\nZCB0byBjaGVjayB0byBzZWUKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0\naGUgZmlyc3QgY2hpbGQgaXMgYSBsZWFkaW5nL3RyYWlsaW5nL2JvdGggbm9k\nZSwKICAgICAgICAgICAgICAgICAgICAvLyBvciB0aGUgdHJpbSBjaGFyYWN0\nZXIgbm9kZQogICAgICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5nZXRDaGls\nZENvdW50KCkgPT0gMgogICAgICAgICAgICAgICAgICAgICYmIGZpcnN0VHJp\nbUNoaWxkLmlkICE9IEpKVFRSSU1MRUFESU5HCiAgICAgICAgICAgICAgICAg\nICAgJiYgZmlyc3RUcmltQ2hpbGQuaWQgIT0gSkpUVFJJTVRSQUlMSU5HCiAg\nICAgICAgICAgICAgICAgICAgJiYgZmlyc3RUcmltQ2hpbGQuaWQgIT0gSkpU\nVFJJTUJPVEgpCiAgICAgICAgICAgICAgICAgICAgdHJpbUNoYXIgPSBnZXRW\nYWx1ZShmaXJzdENoaWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgICAgICAv\nLyBvdGh3ZXJ3aXNlLCB3ZSBkZWZhdWx0IHRvIHRyaW1taW5nIHRoZSBzcGFj\nZSBjaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICB0cmltQ2hhciA9IGZhY3RvcnkubmV3TGl0ZXJhbCgiICIsIExp\ndGVyYWwuVFlQRV9TVFJJTkcpOwoKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5LnRyaW0odmFsMSwgdHJpbUNoYXIsIHRyaW1XaGVyZSk7CgogICAg\nICAgICAgICBjYXNlIEpKVENPTkNBVDoKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIg\nPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlKHZhbDIsIFRZUEVfU1RSSU5HKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWN0b3J5LmNvbmNhdCh2YWwxLCB2YWwyKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUU1VCU1RSSU5HOgogICAgICAgICAgICAg\nICAgdmFsMSA9IGdldFZhbHVlKGNoaWxkKG5vZGUsIDAsIDMpKTsKICAgICAg\nICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShjaGlsZChub2RlLCAxLCAzKSk7\nCiAgICAgICAgICAgICAgICB2YWwzID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwg\nMiwgMykpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEs\nIFRZUEVfU1RSSU5HKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlw\nZSh2YWwyLCBJbnRlZ2VyLlRZUEUpOwogICAgICAgICAgICAgICAgc2V0SW1w\nbGljaXRUeXBlKHZhbDMsIEludGVnZXIuVFlQRSk7CgogICAgICAgICAgICAg\nICAgLy8gdGhlIHNlbWFudGljcyBvZiB0aGUgSlBRTCBzdWJzdHJpbmcoKSBm\ndW5jdGlvbgogICAgICAgICAgICAgICAgLy8gYXJlIHRoYXQgYXJnMiBpcyB0\naGUgMS1iYXNlZCBzdGFydCBpbmRleCwgYW5kIGFyZzMgaXMKICAgICAgICAg\nICAgICAgIC8vIHRoZSBsZW5ndGggb2YgdGhlIHN0cmluZyB0byBiZSByZXR1\ncm47IHRoaXMgaXMgZGlmZmVyZW50CiAgICAgICAgICAgICAgICAvLyB0aGFu\nIHRoZSBzZW1hbnRpY3Mgb2YgdGhlIEV4cHJlc3Npb25GYWN0b3J5J3Mgc3Vi\nc3RyaW5nLAogICAgICAgICAgICAgICAgLy8gd2hpY2ggbWF0Y2hlcyB0aGUg\nSmF2YSBsYW5ndWFnZSAoMC1iYXNlZCBzdGFydCBpbmRleCwKICAgICAgICAg\nICAgICAgIC8vIGFyZzIgaXMgdGhlIGVuZCBpbmRleCk6IHdlIHBlcmZvcm0g\ndGhlIHRyYW5zbGF0aW9uIGJ5CiAgICAgICAgICAgICAgICAvLyBhZGRpbmcg\nb25lIHRvIHRoZSBmaXJzdCBhcmd1bWVudCwgYW5kIHRoZW4gYWRkaW5nIHRo\nZQogICAgICAgICAgICAgICAgLy8gZmlyc3QgYXJndW1lbnQgdG8gdGhlIHNl\nY29uZCBhcmd1bWVudCB0byBnZXQgdGhlIGVuZEluZGV4CiAgICAgICAgICAg\nICAgICBWYWx1ZSBzdGFydDsKICAgICAgICAgICAgICAgIFZhbHVlIGVuZDsK\nICAgICAgICAgICAgICAgIGlmICh2YWwyIGluc3RhbmNlb2YgTGl0ZXJhbCAm\nJiB2YWwzIGluc3RhbmNlb2YgTGl0ZXJhbCkgewogICAgICAgICAgICAgICAg\nICAgIC8vIG9wdGltaXplIFNRTCBmb3IgdGhlIGNvbW1vbiBjYXNlIG9mIHR3\nbyBsaXRlcmFscwogICAgICAgICAgICAgICAgICAgIGxvbmcganBxbFN0YXJ0\nID0gKChOdW1iZXIpICgoTGl0ZXJhbCkgdmFsMikuZ2V0VmFsdWUoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgLmxvbmdWYWx1ZSgpOwogICAgICAgICAg\nICAgICAgICAgIGxvbmcgbGVuZ3RoID0gKChOdW1iZXIpICgoTGl0ZXJhbCkg\ndmFsMykuZ2V0VmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgLmxv\nbmdWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gZmFjdG9y\neS5uZXdMaXRlcmFsKG5ldyBMb25nKGpwcWxTdGFydCAtIDEpLAogICAgICAg\nICAgICAgICAgICAgICAgICBMaXRlcmFsLlRZUEVfTlVNQkVSKTsKICAgICAg\nICAgICAgICAgICAgICBsb25nIGVuZEluZGV4ID0gbGVuZ3RoICsgKGpwcWxT\ndGFydCAtIDEpOwogICAgICAgICAgICAgICAgICAgIGVuZCA9IGZhY3Rvcnku\nbmV3TGl0ZXJhbChuZXcgTG9uZyhlbmRJbmRleCksCiAgICAgICAgICAgICAg\nICAgICAgICAgIExpdGVyYWwuVFlQRV9OVU1CRVIpOwogICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGZhY3Rv\ncnkuc3VidHJhY3QodmFsMiwgZmFjdG9yeS5uZXdMaXRlcmFsCiAgICAgICAg\nICAgICAgICAgICAgICAgIChOdW1iZXJzLnZhbHVlT2YoMSksIExpdGVyYWwu\nVFlQRV9OVU1CRVIpKTsKICAgICAgICAgICAgICAgICAgICBlbmQgPSBmYWN0\nb3J5LmFkZCh2YWwzLAogICAgICAgICAgICAgICAgICAgICAgICAoZmFjdG9y\neS5zdWJ0cmFjdCh2YWwyLCBmYWN0b3J5Lm5ld0xpdGVyYWwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIChOdW1iZXJzLnZhbHVlT2YoMSksIExpdGVy\nYWwuVFlQRV9OVU1CRVIpKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhY3Rvcnkuc3Vic3RyaW5nKHZhbDEsIGZhY3Rv\ncnkubmV3QXJndW1lbnRMaXN0KAogICAgICAgICAgICAgICAgICAgIHN0YXJ0\nLCBlbmQpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTE9DQVRFOgogICAgICAg\nICAgICAgICAgLy8gYXMgd2l0aCBTVUJTVFJJTkcgKGFib3ZlKSwgdGhlIHNl\nbWFudGljcyBmb3IgTE9DQVRFIGRpZmZlcgogICAgICAgICAgICAgICAgLy8g\nZnJvbSBFeHByZXNzaW9uRmFjdG9yeS5pbmRleE9mIGluIHRoYXQgTE9DQVRF\nIHVzZXMgYQogICAgICAgICAgICAgICAgLy8gMC1iYXNlZCBpbmRleCwgYW5k\nIGluZGV4T2YgdXNlcyBhIDEtYmFzZWQgaW5kZXgKICAgICAgICAgICAgICAg\nIFZhbHVlIGxvY2F0ZVBhdGggPSBnZXRWYWx1ZShmaXJzdENoaWxkKG5vZGUp\nKTsKICAgICAgICAgICAgICAgIFZhbHVlIGxvY2F0ZVNlYXJjaCA9IGdldFZh\nbHVlKHNlY29uZENoaWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgIFZhbHVl\nIGxvY2F0ZUZyb21JbmRleCA9IG51bGw7CiAgICAgICAgICAgICAgICBpZiAo\nbm9kZS5nZXRDaGlsZENvdW50KCkgPiAyKSAvLyBvcHRpb25hbCBzdGFydCBp\nbmRleCBhcmcKICAgICAgICAgICAgICAgICAgICBsb2NhdGVGcm9tSW5kZXgg\nPSBnZXRWYWx1ZSh0aGlyZENoaWxkKG5vZGUpKTsKCiAgICAgICAgICAgICAg\nICBzZXRJbXBsaWNpdFR5cGUobG9jYXRlUGF0aCwgVFlQRV9TVFJJTkcpOwog\nICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKGxvY2F0ZVNlYXJjaCwg\nVFlQRV9TVFJJTkcpOwoKICAgICAgICAgICAgICAgIGlmIChsb2NhdGVGcm9t\nSW5kZXggIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBzZXRJbXBsaWNp\ndFR5cGUobG9jYXRlRnJvbUluZGV4LCBUWVBFX1NUUklORyk7CgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYWRkKGZhY3RvcnkuaW5kZXhPZihs\nb2NhdGVTZWFyY2gsCiAgICAgICAgICAgICAgICAgICAgbG9jYXRlRnJvbUlu\nZGV4ID09IG51bGwgPyBsb2NhdGVQYXRoCiAgICAgICAgICAgICAgICAgICAg\nICAgIDogZmFjdG9yeS5uZXdBcmd1bWVudExpc3QobG9jYXRlUGF0aCwKICAg\nICAgICAgICAgICAgICAgICAgICAgZmFjdG9yeS5zdWJ0cmFjdChsb2NhdGVG\ncm9tSW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWN0b3J5\nLm5ld0xpdGVyYWwoTnVtYmVycy52YWx1ZU9mKDEpLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9OVU1CRVIpKSkpLAog\nICAgICAgICAgICAgICAgICAgIGZhY3RvcnkubmV3TGl0ZXJhbChOdW1iZXJz\nLnZhbHVlT2YoMSksCiAgICAgICAgICAgICAgICAgICAgICAgIExpdGVyYWwu\nVFlQRV9OVU1CRVIpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQUdHUkVHQVRF\nOgogICAgICAgICAgICAgICAgLy8gc2ltcGx5IHBhc3MtdGhyb3VnaCB3aGls\nZSBhc3NlcnRpbmcgYSBzaW5nbGUgY2hpbGQKICAgICAgICAgICAgICAgIHJl\ndHVybiBldmFsKG9ubHlDaGlsZChub2RlKSk7CgogICAgICAgICAgICBjYXNl\nIEpKVENPVU5UOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuY291\nbnQoZ2V0VmFsdWUobGFzdENoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBj\nYXNlIEpKVE1BWDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm1h\neChnZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpUTUlOOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rv\ncnkubWluKGdldE51bWJlclZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRTVU06CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFjdG9yeS5zdW0oZ2V0TnVtYmVyVmFsdWUob25seUNoaWxkKG5vZGUpKSk7\nCgogICAgICAgICAgICBjYXNlIEpKVEFWRVJBR0U6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFjdG9yeS5hdmcoZ2V0TnVtYmVyVmFsdWUob25seUNoaWxk\nKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVERJU1RJTkNUUEFUSDoK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmRpc3RpbmN0KGdldFZh\nbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRF\nWElTVFM6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5pc05vdEVt\ncHR5KChWYWx1ZSkgZXZhbChvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpUQU5ZOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rv\ncnkuYW55KChWYWx1ZSkgZXZhbChvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUQUxMOgogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nY3RvcnkuYWxsKChWYWx1ZSkgZXZhbChvbmx5Q2hpbGQobm9kZSkpKTsKCiAg\nICAgICAgICAgIGNhc2UgSkpUU1VCU0VMRUNUOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGdldFN1YnF1ZXJ5KG5vZGUpOwoKICAgICAgICAgICAgY2FzZSBK\nSlRNRU1CRVJPRjoKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShs\nZWZ0KG5vZGUpLCBWQVJfUEFUSCk7CiAgICAgICAgICAgICAgICB2YWwyID0g\nZ2V0VmFsdWUocmlnaHQobm9kZSksIFZBUl9QQVRIKTsKICAgICAgICAgICAg\nICAgIHNldEltcGxpY2l0Q29udGFpbnNUeXBlcyh2YWwyLCB2YWwxLCBDT05U\nQUlOU19UWVBFX0VMRU1FTlQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGV2\nYWxOb3Qobm90LCBmYWN0b3J5LmNvbnRhaW5zKHZhbDIsIHZhbDEpKTsKCiAg\nICAgICAgICAgIGNhc2UgSkpUQ1VSUkVOVERBVEU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFjdG9yeS5nZXRDdXJyZW50RGF0ZSgpOwoKICAgICAgICAg\nICAgY2FzZSBKSlRDVVJSRU5UVElNRToKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5LmdldEN1cnJlbnRUaW1lKCk7CgogICAgICAgICAgICBjYXNl\nIEpKVENVUlJFTlRUSU1FU1RBTVA6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFjdG9yeS5nZXRDdXJyZW50VGltZXN0YW1wKCk7CgogICAgICAgICAgICBj\nYXNlIEpKVFNFTEVDVEVYVEVOU0lPTjoKICAgICAgICAgICAgICAgIGFzc2Vy\ndFF1ZXJ5RXh0ZW5zaW9ucygiU0VMRUNUIik7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZXZhbChvbmx5Q2hpbGQobm9kZSkpOwoKICAgICAgICAgICAgY2Fz\nZSBKSlRHUk9VUEJZRVhURU5TSU9OOgogICAgICAgICAgICAgICAgYXNzZXJ0\nUXVlcnlFeHRlbnNpb25zKCJHUk9VUCBCWSIpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIGV2YWwob25seUNoaWxkKG5vZGUpKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUT1JERVJCWUVYVEVOU0lPTjoKICAgICAgICAgICAgICAgIGFzc2Vy\ndFF1ZXJ5RXh0ZW5zaW9ucygiT1JERVIgQlkiKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBldmFsKG9ubHlDaGlsZChub2RlKSk7CgogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24o\nRVhfRkFUQUwsICJiYWQtdHJlZSIsCiAgICAgICAgICAgICAgICAgICAgbmV3\nIE9iamVjdFtdeyBub2RlIH0sIG51bGwpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwcml2YXRlIHZvaWQgYXNzZXJ0UXVlcnlFeHRlbnNpb25zKFN0cmluZyBj\nbGF1c2UpIHsKICAgICAgICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mID0g\ncmVzb2x2ZXIuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgIHN3aXRjaChj\nb25mLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgpLmdldEpQUUwoKSkgewog\nICAgICAgICAgICBjYXNlIENvbXBhdGliaWxpdHkuSlBRTF9XQVJOOgogICAg\nICAgICAgICAgICAgLy8gY2hlY2sgaWYgd2UndmUgYWxyZWFkeSB3YXJuZWQg\nZm9yIHRoaXMgcXVlcnktZmFjdG9yeSBjb21ibwogICAgICAgICAgICAgICAg\nU3RvcmVDb250ZXh0IGN0eCA9IHJlc29sdmVyLmdldFF1ZXJ5Q29udGV4dCgp\nLmdldFN0b3JlQ29udGV4dCgpOwogICAgICAgICAgICAgICAgU3RyaW5nIHF1\nZXJ5ID0gY3VycmVudFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICBpZiAoY3R4\nLmdldEJyb2tlcigpICE9IG51bGwgJiYgcXVlcnkgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIFN0cmluZyBrZXkgPSBnZXRDbGFzcygpLmdldE5h\nbWUoKSArICI6IiArIHF1ZXJ5OwogICAgICAgICAgICAgICAgICAgIEJyb2tl\nckZhY3RvcnkgZmFjdG9yeSA9IGN0eC5nZXRCcm9rZXIoKS5nZXRCcm9rZXJG\nYWN0b3J5KCk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IGhhc1dhcm5l\nZCA9IGZhY3RvcnkuZ2V0VXNlck9iamVjdChrZXkpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChoYXNXYXJuZWQgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgICAgICBmYWN0b3J5LnB1dFVzZXJPYmplY3Qoa2V5\nLCBCb29sZWFuLlRSVUUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgTG9nIGxvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0\naW9uLkxPR19RVUVSWSk7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9j\nLmdldCgicXVlcnktZXh0ZW5zaW9ucy13YXJuaW5nIiwgY2xhdXNlLAogICAg\nICAgICAgICAgICAgICAgICAgICBjdXJyZW50UXVlcnkoKSkpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgQ29tcGF0aWJpbGl0\neS5KUFFMX1NUUklDVDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBQYXJz\nZUV4Y2VwdGlvbihfbG9jLmdldCgicXVlcnktZXh0ZW5zaW9ucy1lcnJvciIs\nCiAgICAgICAgICAgICAgICAgICAgY2xhdXNlLCBjdXJyZW50UXVlcnkoKSku\nZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgY2FzZSBDb21wYXRpYmlsaXR5\nLkpQUUxfRVhURU5ERUQ6CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxl\nZ2FsU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgIkNvbXBh\ndGliaWxpdHkuZ2V0SlBRTCgpID09ICIKICAgICAgICAgICAgICAgICAgICAg\nICAgKyBjb25mLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgpLmdldEpQUUwo\nKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHNldElt\ncGxpY2l0VHlwZXMoVmFsdWUgdmFsMSwgVmFsdWUgdmFsMiwgQ2xhc3MgZXhw\nZWN0ZWQpIHsKICAgICAgICBzdXBlci5zZXRJbXBsaWNpdFR5cGVzKHZhbDEs\nIHZhbDIsIGV4cGVjdGVkKTsKCiAgICAgICAgLy8gYXMgd2VsbCBhcyBzZXR0\naW5nIHRoZSB0eXBlcyBmb3IgY29udmVyc2lvbnMsIHdlIGFsc28gbmVlZCB0\nbwogICAgICAgIC8vIGVuc3VyZSB0aGF0IGFueSBwYXJhbWV0ZXJzIGFyZSBk\nZWNsYXJlZCB3aXRoIHRoZSBjb3JyZWN0IHR5cGUsCiAgICAgICAgLy8gc2lu\nY2UgdGhlIEpQQSBzcGVjIGV4cGVjdHMgdGhhdCB0aGVzZSB3aWxsIGJlIHZh\nbGlkYXRlZAogICAgICAgIFBhcmFtZXRlciBwYXJhbSA9IHZhbDEgaW5zdGFu\nY2VvZiBQYXJhbWV0ZXIgPyAoUGFyYW1ldGVyKSB2YWwxCiAgICAgICAgICAg\nIDogdmFsMiBpbnN0YW5jZW9mIFBhcmFtZXRlciA/IChQYXJhbWV0ZXIpIHZh\nbDIgOiBudWxsOwogICAgICAgIFBhdGggcGF0aCA9IHZhbDEgaW5zdGFuY2Vv\nZiBQYXRoID8gKFBhdGgpIHZhbDEKICAgICAgICAgICAgOiB2YWwyIGluc3Rh\nbmNlb2YgUGF0aCA/IChQYXRoKSB2YWwyIDogbnVsbDsKCiAgICAgICAgLy8g\nd2Ugb25seSBjaGVjayBmb3IgcGFyYW1ldGVyLXRvLXBhdGggY29tcGFyaXNv\nbnMKICAgICAgICBpZiAocGFyYW0gPT0gbnVsbCB8fCBwYXRoID09IG51bGwg\nfHwgcGFyYW1ldGVyVHlwZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IHBhdGgubGFzdCgpOwog\nICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBDbGFzcyB0eXBlID0gcGF0aC5pc1hQYXRoKCkgPyBwYXRoLmdl\ndFR5cGUoKSA6IGZtZC5nZXRUeXBlKCk7CiAgICAgICAgaWYgKHR5cGUgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBTdHJpbmcgcGFy\nYW1OYW1lID0gcGFyYW0uZ2V0UGFyYW1ldGVyTmFtZSgpOwogICAgICAgIGlm\nIChwYXJhbU5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICAvLyBtYWtlIHN1cmUgd2UgaGF2ZSBhbHJlYWR5IGRlY2xhcmVkIHRo\nZSBwYXJhbWV0ZXIKICAgICAgICBpZiAocGFyYW1ldGVyVHlwZXMuY29udGFp\nbnNLZXkocGFyYW1OYW1lKSkKICAgICAgICAgICAgcGFyYW1ldGVyVHlwZXMu\ncHV0KHBhcmFtTmFtZSwgdHlwZSk7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1\nZSBnZXRTdHJpbmdWYWx1ZShKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0\ndXJuIGdldFR5cGVWYWx1ZShub2RlLCBUWVBFX1NUUklORyk7CiAgICB9Cgog\nICAgcHJpdmF0ZSBWYWx1ZSBnZXROdW1iZXJWYWx1ZShKUFFMTm9kZSBub2Rl\nKSB7CiAgICAgICAgcmV0dXJuIGdldFR5cGVWYWx1ZShub2RlLCBUWVBFX05V\nTUJFUik7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRUeXBlVmFsdWUo\nSlBRTE5vZGUgbm9kZSwgQ2xhc3MgaW1wbGljaXRUeXBlKSB7CiAgICAgICAg\nVmFsdWUgdmFsID0gZ2V0VmFsdWUobm9kZSk7CiAgICAgICAgc2V0SW1wbGlj\naXRUeXBlKHZhbCwgaW1wbGljaXRUeXBlKTsKICAgICAgICByZXR1cm4gdmFs\nOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0U3VicXVlcnkoSlBRTE5v\nZGUgbm9kZSkgewogICAgICAgIGZpbmFsIGJvb2xlYW4gc3ViY2xhc3NlcyA9\nIHRydWU7CiAgICAgICAgU3RyaW5nIGFsaWFzID0gbmV4dEFsaWFzKCk7Cgog\nICAgICAgIC8vIHBhcnNlIHRoZSBzdWJxdWVyeQogICAgICAgIFBhcnNlZEpQ\nUUwgcGFyc2VkID0gbmV3IFBhcnNlZEpQUUwobm9kZS5wYXJzZXIuanBxbCwg\nbm9kZSk7CgogICAgICAgIENsYXNzTWV0YURhdGEgY2FuZGlkYXRlID0gZ2V0\nQ2FuZGlkYXRlTWV0YURhdGEobm9kZSk7CiAgICAgICAgU3VicXVlcnkgc3Vi\ncSA9IGZhY3RvcnkubmV3U3VicXVlcnkoY2FuZGlkYXRlLCBzdWJjbGFzc2Vz\nLCBhbGlhcyk7CiAgICAgICAgc3VicS5zZXRNZXRhRGF0YShjYW5kaWRhdGUp\nOwoKICAgICAgICBjb250ZXh0cy5wdXNoKG5ldyBDb250ZXh0KHBhcnNlZCwg\nc3VicSkpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBRdWVyeUV4cHJl\nc3Npb25zIHN1YmV4cCA9IGdldFF1ZXJ5RXhwcmVzc2lvbnMoKTsKICAgICAg\nICAgICAgc3VicS5zZXRRdWVyeUV4cHJlc3Npb25zKHN1YmV4cCk7CiAgICAg\nICAgICAgIHJldHVybiBzdWJxOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIC8vIHJlbW92ZSB0aGUgc3VicXVlcnkgcGFyc2UgY29udGV4dAog\nICAgICAgICAgICBjb250ZXh0cy5wb3AoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWNvcmQgdGhlIG5hbWVzIGFuZCBvcmRlciBvZiBp\nbXBsaWNpdCBwYXJhbWV0ZXJzLgogICAgICovCiAgICBwcml2YXRlIFBhcmFt\nZXRlciBnZXRQYXJhbWV0ZXIoU3RyaW5nIGlkLCBib29sZWFuIHBvc2l0aW9u\nYWwpIHsKICAgICAgICBpZiAocGFyYW1ldGVyVHlwZXMgPT0gbnVsbCkKICAg\nICAgICAgICAgcGFyYW1ldGVyVHlwZXMgPSBuZXcgTGlua2VkTWFwKDYpOwog\nICAgICAgIGlmICghcGFyYW1ldGVyVHlwZXMuY29udGFpbnNLZXkoaWQpKQog\nICAgICAgICAgICBwYXJhbWV0ZXJUeXBlcy5wdXQoaWQsIFRZUEVfT0JKRUNU\nKTsKCiAgICAgICAgQ2xhc3MgdHlwZSA9IE9iamVjdC5jbGFzczsKICAgICAg\nICBDbGFzc01ldGFEYXRhIG1ldGEgPSBudWxsOwogICAgICAgIGludCBpbmRl\neDsKCiAgICAgICAgaWYgKHBvc2l0aW9uYWwpIHsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIC8vIGluZGV4ZXMgaW4gSlBRTCBhcmUgMS1i\nYXNlZCwgYXMgb3Bwb3NlZCB0byAwLWJhc2VkIGluCiAgICAgICAgICAgICAg\nICAvLyB0aGUgY29yZSBFeHByZXNzaW9uRmFjdG9yeQogICAgICAgICAgICAg\nICAgaW5kZXggPSBJbnRlZ2VyLnBhcnNlSW50KGlkKSAtIDE7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAiYmFk\nLXBvc2l0aW9uYWwtcGFyYW1ldGVyIiwKICAgICAgICAgICAgICAgICAgICBu\nZXcgT2JqZWN0W117IGlkIH0sIGUpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBpZiAoaW5kZXggPCAwKQogICAgICAgICAgICAgICAgdGhyb3cgcGFy\nc2VFeGNlcHRpb24oRVhfVVNFUiwgImJhZC1wb3NpdGlvbmFsLXBhcmFtZXRl\nciIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBpZCB9LCBu\ndWxsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBvdGhlcndp\nc2UgdGhlIGluZGV4IGlzIGp1c3QgdGhlIGN1cnJlbnQgc2l6ZSBvZiB0aGUg\ncGFyYW1zCiAgICAgICAgICAgIGluZGV4ID0gcGFyYW1ldGVyVHlwZXMuaW5k\nZXhPZihpZCk7CiAgICAgICAgfQoKICAgICAgICBQYXJhbWV0ZXIgcGFyYW0g\nPSBmYWN0b3J5Lm5ld1BhcmFtZXRlcihpZCwgdHlwZSk7CiAgICAgICAgcGFy\nYW0uc2V0TWV0YURhdGEobWV0YSk7CiAgICAgICAgcGFyYW0uc2V0SW5kZXgo\naW5kZXgpOwoKICAgICAgICByZXR1cm4gcGFyYW07CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDaGVja3MgdG8gc2VlIGlmIHdlIHNob3VsZCBldmFsdWF0ZSBm\nb3IgYSBOT1QgZXhwcmVzc2lvbi4KICAgICAqLwogICAgcHJpdmF0ZSBFeHBy\nZXNzaW9uIGV2YWxOb3QoYm9vbGVhbiBub3QsIEV4cHJlc3Npb24gZXhwKSB7\nCiAgICAgICAgcmV0dXJuIG5vdCA/IGZhY3Rvcnkubm90KGV4cCkgOiBleHA7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUcmltIG9mZiBsZWFkaW5nIGFuZCB0\ncmFpbGluZyBzaW5nbGUtcXVvdGVzLCBhbmQgdGhlbgogICAgICogcmVwbGFj\nZSBhbnkgaW50ZXJuYWwgJycgaW5zdGFuY2VzIHdpdGggJyAoc2luY2UgcmVw\nZWF0aW5nIHRoZQogICAgICogcXVvdGUgaXMgdGhlIEpQUUwgbWVjaGFuaXNt\nIG9mIGVzY2FwaW5nIGEgc2luZ2xlIHF1b3RlKS4KICAgICAqLwogICAgcHJp\ndmF0ZSBTdHJpbmcgdHJpbVF1b3RlcyhTdHJpbmcgc3RyKSB7CiAgICAgICAg\naWYgKHN0ciA9PSBudWxsIHx8IHN0ci5sZW5ndGgoKSA8PSAxKQogICAgICAg\nICAgICByZXR1cm4gc3RyOwoKICAgICAgICBpZiAoc3RyLnN0YXJ0c1dpdGgo\nIiciKSAmJiBzdHIuZW5kc1dpdGgoIiciKSkKICAgICAgICAgICAgc3RyID0g\nc3RyLnN1YnN0cmluZygxLCBzdHIubGVuZ3RoKCkgLSAxKTsKCiAgICAgICAg\naW50IGluZGV4ID0gLTE7CgogICAgICAgIHdoaWxlICgoaW5kZXggPSBzdHIu\naW5kZXhPZigiJyciLCBpbmRleCArIDEpKSAhPSAtMSkKICAgICAgICAgICAg\nc3RyID0gc3RyLnN1YnN0cmluZygwLCBpbmRleCArIDEpICsgc3RyLnN1YnN0\ncmluZyhpbmRleCArIDIpOwoKICAgICAgICByZXR1cm4gc3RyOwogICAgfQoK\nICAgIC8qKgogICAgICogQW4gSW50ZWdlckxpdGVyYWwgYW5kIERlY2ltYWxM\naXRlcmFsIG5vZGUgd2lsbAogICAgICogaGF2ZSBhIGNoaWxkIG5vZGUgb2Yg\nTmVnYXRpdmUgaWYgaXQgaXMgbmVnYXRpdmU6CiAgICAgKiBpZiBzbywgdGhp\ncyBtZXRob2QgcmV0dXJucyAtMSwgZWxzZSBpdCByZXR1cm5zIDEuCiAgICAg\nKi8KICAgIHByaXZhdGUgc2hvcnQgbmVnYXRpdmUoSlBRTE5vZGUgbm9kZSkg\newogICAgICAgIGlmIChub2RlLmNoaWxkcmVuICE9IG51bGwgJiYgbm9kZS5j\naGlsZHJlbi5sZW5ndGggPT0gMQogICAgICAgICAgICAmJiBmaXJzdENoaWxk\nKG5vZGUpLmlkID09IEpKVE5FR0FUSVZFKQogICAgICAgICAgICByZXR1cm4g\nLTE7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gMTsKICAgIH0K\nCiAgICBwcml2YXRlIFZhbHVlIGdldElkZW50aWZpZXIoSlBRTE5vZGUgbm9k\nZSkgewogICAgICAgIGZpbmFsIFN0cmluZyBuYW1lID0gbm9kZS50ZXh0Owog\nICAgICAgIGZpbmFsIFZhbHVlIHZhbCA9IGdldFZhcmlhYmxlKG5hbWUsIGZh\nbHNlKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBnZXRNZXRhRGF0\nYUZvckFsaWFzKG5hbWUpOwoKICAgICAgICBpZiAoY21kICE9IG51bGwpIHsK\nICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSBjbGFz\ncyBuYW1lIGlzIHRoZSBhbGlhcwogICAgICAgICAgICAvLyBmb3IgdGhlIGNh\nbmRpZGF0ZSAod2UgZG9uJ3QgdXNlIHZhcmlhYmxlcyBmb3IgdGhpcykKICAg\nICAgICAgICAgVmFsdWUgdGhpeiA9IGZhY3RvcnkuZ2V0VGhpcygpOwogICAg\nICAgICAgICB0aGl6LnNldE1ldGFEYXRhKGNtZCk7CiAgICAgICAgICAgIHJl\ndHVybiB0aGl6OwogICAgICAgIH0gZWxzZSBpZiAodmFsIGluc3RhbmNlb2Yg\nUGF0aCkgewogICAgICAgICAgICByZXR1cm4gKFBhdGgpIHZhbDsKICAgICAg\nICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFZhbHVlKSB7CiAgICAgICAg\nICAgIHJldHVybiAoVmFsdWUpIHZhbDsKICAgICAgICB9CgogICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ1bmtub3duLWlkZW50aWZp\nZXIiLAogICAgICAgICAgICBuZXcgT2JqZWN0W117IG5hbWUgfSwgbnVsbCk7\nCiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRQYXRoT3JDb25zdGFudChK\nUFFMTm9kZSBub2RlKSB7CiAgICAgICAgLy8gZmlyc3QgY2hlY2sgdG8gc2Vl\nIGlmIHRoZSBwYXRoIGlzIGFuIGVudW0gb3Igc3RhdGljIGZpZWxkLCBhbmQK\nICAgICAgICAvLyBpZiBzbywgbG9hZCBpdAogICAgICAgIFN0cmluZyBjbGFz\nc05hbWUgPSBhc3NlbWJsZShub2RlLCAiLiIsIDEpOwogICAgICAgIENsYXNz\nIGMgPSByZXNvbHZlci5jbGFzc0Zvck5hbWUoY2xhc3NOYW1lLCBudWxsKTsK\nICAgICAgICBpZiAoYyAhPSBudWxsKSB7CiAgICAgICAgICAgIFN0cmluZyBm\naWVsZE5hbWUgPSBsYXN0Q2hpbGQobm9kZSkudGV4dDsKCiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBGaWVsZCBmaWVsZCA9IGMuZ2V0Rmll\nbGQoZmllbGROYW1lKTsKICAgICAgICAgICAgICAgIE9iamVjdCB2YWx1ZSA9\nIGZpZWxkLmdldChudWxsKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0\nb3J5Lm5ld0xpdGVyYWwodmFsdWUsIExpdGVyYWwuVFlQRV9VTktOT1dOKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoTm9TdWNoRmllbGRFeGNlcHRpb24gbnNm\nZSkgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuaW5FbnVtUGF0aCkKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VS\nLCAibm8tZmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IGMuZ2V0TmFtZSgpLCBmaWVsZE5hbWUgfSwgbnNmZSk7CiAgICAg\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndFBhdGgobm9kZSwgZmFsc2UsIHRydWUpOwogICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VF\neGNlcHRpb24oRVhfVVNFUiwgInVuYWNjZXNzaWJsZS1maWVsZCIsCiAgICAg\nICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBjbGFzc05hbWUsIGZpZWxk\nTmFtZSB9LCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIHJldHVybiBnZXRQYXRoKG5vZGUsIGZhbHNlLCB0cnVlKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBQYXRoIGdldFBhdGgoSlBR\nTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVybiBnZXRQYXRoKG5vZGUsIGZh\nbHNlLCB0cnVlKTsKICAgIH0KCiAgICBwcml2YXRlIFBhdGggZ2V0UGF0aChK\nUFFMTm9kZSBub2RlLCBib29sZWFuIHBjT25seSwgYm9vbGVhbiBpbm5lcikg\newogICAgICAgIC8vIHJlc29sdmUgdGhlIGZpcnN0IGVsZW1lbnQgYWdhaW5z\ndCB0aGUgYWxpYXNlcyBtYXAgLi4uCiAgICAgICAgLy8gaS5lLiwgdGhlIHBh\ndGggIlNFTEVDVCB4LmlkIEZST00gU29tZUNsYXNzIHggd2hlcmUgeC5pZCA+\nIDEwIgogICAgICAgIC8vIHdpbGwgbmVlZCB0byBoYXZlICJ4IiBpbiB0aGUg\nYWxpYXMgbWFwIGluIG9yZGVyIHRvIHJlc29sdmUKICAgICAgICBQYXRoIHBh\ndGg7CgogICAgICAgIGZpbmFsIFN0cmluZyBuYW1lID0gZmlyc3RDaGlsZChu\nb2RlKS50ZXh0OwogICAgICAgIGZpbmFsIFZhbHVlIHZhbCA9IGdldFZhcmlh\nYmxlKG5hbWUsIGZhbHNlKTsKCiAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNl\nIHdoZXJlIHRoZSBjbGFzcyBuYW1lIGlzIHRoZSBhbGlhcwogICAgICAgIC8v\nIGZvciB0aGUgY2FuZGlkYXRlICh3ZSBkb24ndCB1c2UgdmFyaWFibGVzIGZv\nciB0aGlzKQogICAgICAgIGlmIChuYW1lLmVxdWFsc0lnbm9yZUNhc2UoY3R4\nKCkuc2NoZW1hQWxpYXMpKSB7CiAgICAgICAgICAgIGlmIChjdHgoKS5zdWJx\ndWVyeSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBwYXRoID0gZmFjdG9y\neS5uZXdQYXRoKGN0eCgpLnN1YnF1ZXJ5KTsKICAgICAgICAgICAgICAgIHBh\ndGguc2V0TWV0YURhdGEoY3R4KCkuc3VicXVlcnkuZ2V0TWV0YURhdGEoKSk7\nCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYXRoID0g\nZmFjdG9yeS5uZXdQYXRoKCk7CiAgICAgICAgICAgICAgICBwYXRoLnNldE1l\ndGFEYXRhKGN0eCgpLm1ldGEpOwogICAgICAgICAgICB9CiAgICAgICAgfSBl\nbHNlIGlmIChnZXRNZXRhRGF0YUZvckFsaWFzKG5hbWUpICE9IG51bGwpCiAg\nICAgICAgICAgIHBhdGggPSBuZXdQYXRoKG51bGwsIGdldE1ldGFEYXRhRm9y\nQWxpYXMobmFtZSkpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIFBhdGgpCiAgICAgICAgICAgIHBhdGggPSAoUGF0aCkgdmFsOwogICAgICAg\nIGVsc2UgaWYgKHZhbC5nZXRNZXRhRGF0YSgpICE9IG51bGwpCiAgICAgICAg\nICAgIHBhdGggPSBuZXdQYXRoKHZhbCwgdmFsLmdldE1ldGFEYXRhKCkpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24o\nRVhfVVNFUiwgInBhdGgtaW52YWxpZCIsCiAgICAgICAgICAgICAgICBuZXcg\nT2JqZWN0W117IGFzc2VtYmxlKG5vZGUpLCBuYW1lIH0sIG51bGwpOwoKICAg\nICAgICAvLyB3YWxrIHRocm91Z2ggdGhlIGNoaWxkcmVuIGFuZCBhc3NlbWJs\nZSB0aGUgcGF0aAogICAgICAgIGJvb2xlYW4gYWxsb3dOdWxsID0gIWlubmVy\nOwogICAgICAgIGZvciAoaW50IGkgPSAxOyBpIDwgbm9kZS5jaGlsZHJlbi5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAocGF0aC5pc1hQYXRoKCkp\nIHsKICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSBpOyBqIDxub2RlLmNo\naWxkcmVuLmxlbmd0aDsgaisrKQogICAgICAgICAgICAgICAgICAgIHBhdGgg\nPSAoUGF0aCkgdHJhdmVyc2VYUGF0aChwYXRoLCBub2RlLmNoaWxkcmVuW2pd\nLnRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJuIHBhdGg7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcGF0aCA9IChQYXRoKSB0cmF2ZXJzZVBhdGgo\ncGF0aCwgbm9kZS5jaGlsZHJlbltpXS50ZXh0LCBwY09ubHksCiAgICAgICAg\nICAgICAgICBhbGxvd051bGwpOwoKICAgICAgICAgICAgLy8gYWxsIHRyYXZl\ncnNhbHMgYnV0IHRoZSBmaXJzdCBvbmUgd2lsbCBhbHdheXMgYmUgaW5uZXIg\nam9pbnMKICAgICAgICAgICAgYWxsb3dOdWxsID0gZmFsc2U7CiAgICAgICAg\nfQoKICAgICAgICByZXR1cm4gcGF0aDsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nQ2xhc3MgZ2V0RGVjbGFyZWRWYXJpYWJsZVR5cGUoU3RyaW5nIG5hbWUpIHsK\nICAgICAgICBDbGFzc01ldGFEYXRhIGNtZCA9IGdldE1ldGFEYXRhRm9yQWxp\nYXMobmFtZSk7CiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gY21kLmdldERlc2NyaWJlZFR5cGUoKTsKCiAgICAgICAgaWYg\nKG5hbWUgIT0gbnVsbCAmJiBuYW1lLmVxdWFscyhjdHgoKS5zY2hlbWFBbGlh\ncykpCiAgICAgICAgICAgIHJldHVybiBnZXRDYW5kaWRhdGVUeXBlKCk7Cgog\nICAgICAgIC8vIEpQUUwgaGFzIG5vIGRlY2xhcmVkIHZhcmlhYmxlcwogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\ncyBhbiBFeHByZXNzaW9uIGZvciB0aGUgZ2l2ZW4gbm9kZSBieSBldmFsJ2lu\nZyBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBFeHByZXNzaW9uIGdldEV4cHJl\nc3Npb24oSlBRTE5vZGUgbm9kZSkgewogICAgICAgIE9iamVjdCBleHAgPSBl\ndmFsKG5vZGUpOwoKICAgICAgICAvLyBjaGVjayBmb3IgYm9vbGVhbiB2YWx1\nZXMgdXNlZCBhcyBleHByZXNzaW9ucwogICAgICAgIGlmICghKGV4cCBpbnN0\nYW5jZW9mIEV4cHJlc3Npb24pKQogICAgICAgICAgICByZXR1cm4gZmFjdG9y\neS5hc0V4cHJlc3Npb24oKFZhbHVlKSBleHApOwogICAgICAgIHJldHVybiAo\nRXhwcmVzc2lvbikgZXhwOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0\nVmFsdWUoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVybiBnZXRWYWx1\nZShub2RlLCBWQVJfUEFUSCk7CiAgICB9CgogICAgcHJpdmF0ZSBQYXRoIG5l\nd1BhdGgoVmFsdWUgdmFsLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAg\nICBQYXRoIHBhdGggPSB2YWwgPT0gbnVsbCA/IGZhY3RvcnkubmV3UGF0aCgp\nIDogZmFjdG9yeS5uZXdQYXRoKHZhbCk7CiAgICAgICAgaWYgKG1ldGEgIT0g\nbnVsbCkKICAgICAgICAgICAgcGF0aC5zZXRNZXRhRGF0YShtZXRhKTsKICAg\nICAgICByZXR1cm4gcGF0aDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbnMgYSBWYWx1ZSBmb3IgdGhlIGdpdmVuIG5vZGUgYnkgZXZhbCdpbmcgaXQu\nCiAgICAgKi8KICAgIHByaXZhdGUgVmFsdWUgZ2V0VmFsdWUoSlBRTE5vZGUg\nbm9kZSwgaW50IGhhbmRsZVZhcikgewogICAgICAgIFZhbHVlIHZhbCA9IChW\nYWx1ZSkgZXZhbChub2RlKTsKCiAgICAgICAgLy8gZGV0ZXJtaW5lZCBob3cg\ndG8gZXZhbHVhdGUgYSB2YXJpYWJsZQogICAgICAgIGlmICghdmFsLmlzVmFy\naWFibGUoKSkKICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICBlbHNl\nIGlmIChoYW5kbGVWYXIgPT0gVkFSX1BBVEggJiYgISh2YWwgaW5zdGFuY2Vv\nZiBQYXRoKSkKICAgICAgICAgICAgcmV0dXJuIG5ld1BhdGgodmFsLCB2YWwu\nZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgZWxzZSBpZiAoaGFuZGxlVmFyID09\nIFZBUl9FUlJPUikKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24o\nRVhfVVNFUiwgInVuZXhwZWN0ZWQtdmFyIiwKICAgICAgICAgICAgICAgIG5l\ndyBPYmplY3RbXXsgbm9kZS50ZXh0IH0sIG51bGwpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQYXJzZSBDb250ZXh0IE1hbmFn\nZW1lbnQKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBw\ncml2YXRlIENvbnRleHQgY3R4KCkgewogICAgICAgIHJldHVybiAoQ29udGV4\ndCkgY29udGV4dHMucGVlaygpOwogICAgfQoKICAgIHByaXZhdGUgSlBRTE5v\nZGUgcm9vdCgpIHsKICAgICAgICByZXR1cm4gY3R4KCkucGFyc2VkLnJvb3Q7\nCiAgICB9CgogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRh\nRm9yQWxpYXMoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAgZm9yIChpbnQgaSA9\nIGNvbnRleHRzLnNpemUoKSAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAg\nICAgIENvbnRleHQgY29udGV4dCA9IChDb250ZXh0KSBjb250ZXh0cy5nZXQo\naSk7CiAgICAgICAgICAgIGlmIChhbGlhcy5lcXVhbHNJZ25vcmVDYXNlKGNv\nbnRleHQuc2NoZW1hQWxpYXMpKQogICAgICAgICAgICAgICAgcmV0dXJuIGNv\nbnRleHQubWV0YTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIHByaXZhdGUgY2xhc3MgQ29udGV4dCB7CgogICAgICAgIHBy\naXZhdGUgZmluYWwgUGFyc2VkSlBRTCBwYXJzZWQ7CiAgICAgICAgcHJpdmF0\nZSBDbGFzc01ldGFEYXRhIG1ldGE7CiAgICAgICAgcHJpdmF0ZSBTdHJpbmcg\nc2NoZW1hQWxpYXM7CiAgICAgICAgcHJpdmF0ZSBTdWJxdWVyeSBzdWJxdWVy\neTsKCiAgICAgICAgQ29udGV4dChQYXJzZWRKUFFMIHBhcnNlZCwgU3VicXVl\ncnkgc3VicXVlcnkpIHsKICAgICAgICAgICAgdGhpcy5wYXJzZWQgPSBwYXJz\nZWQ7CiAgICAgICAgICAgIHRoaXMuc3VicXVlcnkgPSBzdWJxdWVyeTsKICAg\nICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwogICAgLy8gTm9kZSB0cmF2ZXJzYWwgdXRpbGl0aWVzCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHJpdmF0ZSBKUFFMTm9kZSBv\nbmx5Q2hpbGQoSlBRTE5vZGUgbm9kZSkKICAgICAgICB0aHJvd3MgVXNlckV4\nY2VwdGlvbiB7CiAgICAgICAgSlBRTE5vZGUgY2hpbGQgPSBmaXJzdENoaWxk\nKG5vZGUpOwoKICAgICAgICBpZiAobm9kZS5jaGlsZHJlbi5sZW5ndGggPiAx\nKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAi\nbXVsdGktY2hpbGRyZW4iLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtd\neyBub2RlLCBBcnJheXMuYXNMaXN0KG5vZGUuY2hpbGRyZW4pIH0sIG51bGwp\nOwoKICAgICAgICByZXR1cm4gY2hpbGQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHRoZSBsZWZ0IG5vZGUgKHRoZSBmaXJzdCBvZiB0aGUgY2hp\nbGRyZW4pLCBhbmQgYXNzZXJ0cwogICAgICogdGhhdCB0aGVyZSBhcmUgZXhh\nY3RseSB0d28gY2hpbGRyZW4uCiAgICAgKi8KICAgIHByaXZhdGUgSlBRTE5v\nZGUgbGVmdChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIGNoaWxk\nKG5vZGUsIDAsIDIpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0\naGUgcmlnaHQgbm9kZSAodGhlIHNlY29uZCBvZiB0aGUgY2hpbGRyZW4pLCBh\nbmQgYXNzZXJ0cwogICAgICogdGhhdCB0aGVyZSBhcmUgZXhhY3RseSB0d28g\nY2hpbGRyZW4uCiAgICAgKi8KICAgIHByaXZhdGUgSlBRTE5vZGUgcmlnaHQo\nSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVybiBjaGlsZChub2RlLCAx\nLCAyKTsKICAgIH0KCiAgICBwcml2YXRlIEpQUUxOb2RlIGNoaWxkKEpQUUxO\nb2RlIG5vZGUsIGludCBjaGlsZE51bSwgaW50IGFzc2VydENvdW50KSB7CiAg\nICAgICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoICE9IGFzc2VydENvdW50\nKQogICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAi\nd3JvbmctY2hpbGQtY291bnQiLAogICAgICAgICAgICAgICAgbmV3IE9iamVj\ndFtdeyBuZXcgSW50ZWdlcihhc3NlcnRDb3VudCksIG5vZGUsCiAgICAgICAg\nICAgICAgICAgICAgQXJyYXlzLmFzTGlzdChub2RlLmNoaWxkcmVuKSB9LCBu\ndWxsKTsKCiAgICAgICAgcmV0dXJuIG5vZGUuY2hpbGRyZW5bY2hpbGROdW1d\nOwogICAgfQoKICAgIHByaXZhdGUgSlBRTE5vZGUgZmlyc3RDaGlsZChKUFFM\nTm9kZSBub2RlKSB7CiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gPT0gbnVs\nbCB8fCBub2RlLmNoaWxkcmVuLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0\naHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm8tY2hpbGRyZW4iLAog\nICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2RlIH0sIG51bGwpOwog\nICAgICAgIHJldHVybiBub2RlLmNoaWxkcmVuWzBdOwogICAgfQoKICAgIHBy\naXZhdGUgc3RhdGljIEpQUUxOb2RlIHNlY29uZENoaWxkKEpQUUxOb2RlIG5v\nZGUpIHsKICAgICAgICByZXR1cm4gbm9kZS5jaGlsZHJlblsxXTsKICAgIH0K\nCiAgICBwcml2YXRlIHN0YXRpYyBKUFFMTm9kZSB0aGlyZENoaWxkKEpQUUxO\nb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4gbm9kZS5jaGlsZHJlblsyXTsK\nICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBKUFFMTm9kZSBsYXN0Q2hpbGQo\nSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVybiBsYXN0Q2hpbGQobm9k\nZSwgMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgTnRoIGZyb20gdGhl\nIGxhc3QgY2hpbGQuIEUuZy4sCiAgICAgKiBsYXN0Q2hpbGQoMSkgd2lsbCBy\nZXR1cm4gdGhlIHNlY29uZC10by10aGUtbGFzdCBjaGlsZC4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgSlBRTE5vZGUgbGFzdENoaWxkKEpQUUxOb2Rl\nIG5vZGUsIGludCBmcm9tTGFzdCkgewogICAgICAgIHJldHVybiBub2RlLmNo\naWxkcmVuW25vZGUuY2hpbGRyZW4ubGVuZ3RoIC0gKDEgKyBmcm9tTGFzdCld\nOwogICAgfQoKICAgIC8qKgogICAgICogQmFzZSBub2RlIHRoYXQgd2lsbCBi\nZSBnZW5lcmF0ZWQgYnkgdGhlIEpQUUxFeHByZXNzaW9uQnVpbGRlcjsgYmFz\nZQogICAgICogY2xhc3Mgb2YgdGhlIHtAbGluayBTaW1wbGVOb2RlfSB0aGF0\nIGlzIHVzZWQgYnkge0BsaW5rIEpQUUx9LgogICAgICoKICAgICAqIEBhdXRo\nb3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAgKiBAc2VlIE5vZGUKICAgICAq\nIEBzZWUgU2ltcGxlTm9kZQogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJh\nY3Qgc3RhdGljIGNsYXNzIEpQUUxOb2RlCiAgICAgICAgaW1wbGVtZW50cyBO\nb2RlLCBTZXJpYWxpemFibGUgewoKICAgICAgICBmaW5hbCBpbnQgaWQ7CiAg\nICAgICAgZmluYWwgSlBRTCBwYXJzZXI7CiAgICAgICAgSlBRTE5vZGUgcGFy\nZW50OwogICAgICAgIEpQUUxOb2RlW10gY2hpbGRyZW47CiAgICAgICAgU3Ry\naW5nIHRleHQ7CiAgICAgICAgYm9vbGVhbiBub3QgPSBmYWxzZTsKICAgICAg\nICBib29sZWFuIGluRW51bVBhdGggPSBmYWxzZTsKCiAgICAgICAgcHVibGlj\nIEpQUUxOb2RlKEpQUUwgcGFyc2VyLCBpbnQgaWQpIHsKICAgICAgICAgICAg\ndGhpcy5pZCA9IGlkOwogICAgICAgICAgICB0aGlzLnBhcnNlciA9IHBhcnNl\ncjsKICAgICAgICAgICAgdGhpcy5pbkVudW1QYXRoID0gcGFyc2VyLmluRW51\nbVBhdGg7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBqanRPcGVu\nKCkgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgamp0Q2xvc2Uo\nKSB7CiAgICAgICAgfQoKICAgICAgICBKUFFMTm9kZVtdIGZpbmRDaGlsZHJl\nbkJ5SUQoaW50IGlkKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb24gc2V0ID0g\nbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgZmluZENoaWxkcmVuQnlJRChp\nZCwgc2V0KTsKICAgICAgICAgICAgcmV0dXJuIChKUFFMTm9kZVtdKSBzZXQu\ndG9BcnJheShuZXcgSlBRTE5vZGVbc2V0LnNpemUoKV0pOwogICAgICAgIH0K\nCiAgICAgICAgcHJpdmF0ZSB2b2lkIGZpbmRDaGlsZHJlbkJ5SUQoaW50IGlk\nLCBDb2xsZWN0aW9uIHNldCkgewogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgY2hpbGRyZW4gIT0gbnVsbCAmJiBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIGlmIChjaGlsZHJlbltpXS5pZCA9PSBp\nZCkKICAgICAgICAgICAgICAgICAgICBzZXQuYWRkKGNoaWxkcmVuW2ldKTsK\nCiAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS5maW5kQ2hpbGRyZW5CeUlE\nKGlkLCBzZXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBi\nb29sZWFuIGhhc0NoaWxkSUQoaW50IGlkKSB7CiAgICAgICAgICAgIHJldHVy\nbiBmaW5kQ2hpbGRCeUlEKGlkLCBmYWxzZSkgIT0gbnVsbDsKICAgICAgICB9\nCgogICAgICAgIEpQUUxOb2RlIGZpbmRDaGlsZEJ5SUQoaW50IGlkLCBib29s\nZWFuIHJlY3Vyc2UpIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNo\naWxkcmVuICE9IG51bGwgJiYgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgICAgICBKUFFMTm9kZSBjaGlsZCA9IGNoaWxkcmVuW2ld\nOwoKICAgICAgICAgICAgICAgIGlmIChjaGlsZC5pZCA9PSBpZCkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gY2hpbGRyZW5baV07CgogICAgICAgICAg\nICAgICAgaWYgKHJlY3Vyc2UpIHsKICAgICAgICAgICAgICAgICAgICBKUFFM\nTm9kZSBmb3VuZCA9IGNoaWxkLmZpbmRDaGlsZEJ5SUQoaWQsIHJlY3Vyc2Up\nOwogICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm91bmQ7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vdCBmb3Vu\nZAogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIGpqdFNldFBhcmVudChOb2RlIHBhcmVudCkgewogICAg\nICAgICAgICB0aGlzLnBhcmVudCA9IChKUFFMTm9kZSkgcGFyZW50OwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIE5vZGUgamp0R2V0UGFyZW50KCkgewog\nICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQ7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBqanRBZGRDaGlsZChOb2RlIG4sIGludCBpKSB7\nCiAgICAgICAgICAgIGlmIChjaGlsZHJlbiA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBjaGlsZHJlbiA9IG5ldyBKUFFMTm9kZVtpICsgMV07CiAgICAg\nICAgICAgIH0gZWxzZSBpZiAoaSA+PSBjaGlsZHJlbi5sZW5ndGgpIHsKICAg\nICAgICAgICAgICAgIEpQUUxOb2RlIGNbXSA9IG5ldyBKUFFMTm9kZVtpICsg\nMV07CiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGNoaWxkcmVu\nLCAwLCBjLCAwLCBjaGlsZHJlbi5sZW5ndGgpOwogICAgICAgICAgICAgICAg\nY2hpbGRyZW4gPSBjOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjaGls\nZHJlbltpXSA9IChKUFFMTm9kZSkgbjsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBOb2RlIGpqdEdldENoaWxkKGludCBpKSB7CiAgICAgICAgICAgIHJl\ndHVybiBjaGlsZHJlbltpXTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBp\nbnQgZ2V0Q2hpbGRDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIGpqdEdl\ndE51bUNoaWxkcmVuKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSlBR\nTE5vZGUgZ2V0Q2hpbGQoaW50IGluZGV4KSB7CiAgICAgICAgICAgIHJldHVy\nbiAoSlBRTE5vZGUpIGpqdEdldENoaWxkKGluZGV4KTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBJdGVyYXRvciBpdGVyYXRvcigpIHsKICAgICAgICAg\nICAgcmV0dXJuIEFycmF5cy5hc0xpc3QoY2hpbGRyZW4pLml0ZXJhdG9yKCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGpqdEdldE51bUNoaWxk\ncmVuKCkgewogICAgICAgICAgICByZXR1cm4gKGNoaWxkcmVuID09IG51bGwp\nID8gMCA6IGNoaWxkcmVuLmxlbmd0aDsKICAgICAgICB9CgogICAgICAgIHZv\naWQgc2V0VGV4dChTdHJpbmcgdGV4dCkgewogICAgICAgICAgICB0aGlzLnRl\neHQgPSB0ZXh0OwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzZXRUb2tlbihU\nb2tlbiB0KSB7CiAgICAgICAgICAgIHNldFRleHQodC5pbWFnZSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAg\nICAgICAgICByZXR1cm4gSlBRTFRyZWVDb25zdGFudHMuamp0Tm9kZU5hbWVb\ndGhpcy5pZF07CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRv\nU3RyaW5nKFN0cmluZyBwcmVmaXgpIHsKICAgICAgICAgICAgcmV0dXJuIHBy\nZWZpeCArIHRvU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBEZWJ1Z2dpbmcgbWV0aG9kLgogICAgICAgICAqCiAgICAgICAg\nICogQHNlZSAjZHVtcChqYXZhLmlvLlByaW50U3RyZWFtLFN0cmluZykKICAg\nICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBkdW1wKFN0cmluZyBwcmVm\naXgpIHsKICAgICAgICAgICAgZHVtcChTeXN0ZW0ub3V0LCBwcmVmaXgpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgZHVtcCgpIHsKICAgICAg\nICAgICAgZHVtcCgiICIpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAg\nICAgICogRGVidWdnaW5nIG1ldGhvZCB0byBvdXRwdXQgYSBwYXJzZSB0cmVl\nLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG91dCB0aGUgc3RyZWFt\nIHRvIHdoaWNoIHRvIHdyaXRlIHRoZSBkZWJ1Z2dpbmcgaW5mbwogICAgICAg\nICAqIEBwYXJhbSBwcmVmaXggdGhlIHByZWZpeCB0byB3cml0ZSBvdXQgYmVm\nb3JlIGxpbmVzCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZHVt\ncChQcmludFN0cmVhbSBvdXQsIFN0cmluZyBwcmVmaXgpIHsKICAgICAgICAg\nICAgZHVtcChvdXQsIHByZWZpeCwgZmFsc2UpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgZHVtcChQcmludFN0cmVhbSBvdXQsIFN0cmluZyBw\ncmVmaXgsIGJvb2xlYW4gdGV4dCkgewogICAgICAgICAgICBvdXQucHJpbnRs\nbih0b1N0cmluZyhwcmVmaXgpCiAgICAgICAgICAgICAgICArICh0ZXh0ICYm\nIHRoaXMudGV4dCAhPSBudWxsID8gIiBbIiArIHRoaXMudGV4dCArICJdIiA6\nICIiKSk7CiAgICAgICAgICAgIGlmIChjaGlsZHJlbiAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNoaWxkcmVuLmxl\nbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgSlBRTE5vZGUgbiA9\nIChKUFFMTm9kZSkgY2hpbGRyZW5baV07CiAgICAgICAgICAgICAgICAgICAg\naWYgKG4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBuLmR1\nbXAob3V0LCBwcmVmaXggKyAiICIsIHRleHQpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFB1YmxpYyBmb3IgdW5pdCB0ZXN0\naW5nIHB1cnBvc2VzLgogICAgICogQG5vamF2YWRvYwogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGNsYXNzIFBhcnNlZEpQUUwKICAgICAgICBpbXBsZW1l\nbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIC8vIFRoaXMgaXMgb25seSBl\ndmVyIHVzZWQgZHVyaW5nIHBhcnNlOyB3aGVuIFBhcnNlZEpQUUwgaW5zdGFu\nY2VzCiAgICAgICAgLy8gYXJlIHNlcmlhbGl6ZWQsIHRoZXkgd2lsbCBoYXZl\nIGFscmVhZHkgYmVlbiBwYXJzZWQuCiAgICAgICAgcHJpdmF0ZSBmaW5hbCB0\ncmFuc2llbnQgSlBRTE5vZGUgcm9vdDsKCiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBTdHJpbmcgcXVlcnk7CiAgICAgICAgCiAgICAgICAgLy8gY2FjaGUgb2Yg\nY2FuZGlkYXRlIHR5cGUgZGF0YS4gVGhpcyBpcyBzdG9yZWQgaGVyZSBpbiBj\nYXNlIHRoaXMgIAogICAgICAgIC8vIHBhcnNlIHRyZWUgaXMgcmV1c2VkIGlu\nIGEgY29udGV4dCB0aGF0IGRvZXMgbm90IGtub3cgd2hhdCB0aGUgCiAgICAg\nICAgLy8gY2FuZGlkYXRlIHR5cGUgaXMgYWxyZWFkeS4gCiAgICAgICAgcHJp\ndmF0ZSBDbGFzcyBfY2FuZGlkYXRlVHlwZTsKCiAgICAgICAgUGFyc2VkSlBR\nTChTdHJpbmcganBxbCkgewogICAgICAgICAgICB0aGlzKGpwcWwsIHBhcnNl\nKGpwcWwpKTsKICAgICAgICB9CgogICAgICAgIFBhcnNlZEpQUUwoU3RyaW5n\nIHF1ZXJ5LCBKUFFMTm9kZSByb290KSB7CiAgICAgICAgICAgIHRoaXMucm9v\ndCA9IHJvb3Q7CiAgICAgICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeTsKICAg\nICAgICB9CgogICAgICAgIHByaXZhdGUgc3RhdGljIEpQUUxOb2RlIHBhcnNl\nKFN0cmluZyBqcHFsKSB7CiAgICAgICAgICAgIGlmIChqcHFsID09IG51bGwp\nCiAgICAgICAgICAgICAgICBqcHFsID0gIiI7CgogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgcmV0dXJuIChKUFFMTm9kZSkgbmV3IEpQUUwo\nanBxbCkucGFyc2VRdWVyeSgpOwogICAgICAgICAgICB9IGNhdGNoIChFcnJv\nciBlKSB7CiAgICAgICAgICAgICAgICAvLyBzcGVjaWFsIGhhbmRsaW5nIGZv\nciBFcnJvciBzdWJjbGFzc2VzLCB3aGljaCB0aGUKICAgICAgICAgICAgICAg\nIC8vIHBhcnNlciBtYXkgc29tZXRpbWVzICh1bmZvcnR1bmF0ZWx5KSB0aHJv\ndwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoInBhcnNlLWVycm9yIiwKICAgICAgICAgICAgICAgICAgICBuZXcg\nT2JqZWN0W117IGUudG9TdHJpbmcoKSwganBxbCB9KSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIHZvaWQgcG9wdWxhdGUoRXhwcmVzc2lv\nblN0b3JlUXVlcnkgcXVlcnkpIHsKICAgICAgICAgICAgUXVlcnlDb250ZXh0\nIGN0eCA9IHF1ZXJ5LmdldENvbnRleHQoKTsKCiAgICAgICAgICAgIC8vIGlm\nIHRoZSBvd25pbmcgcXVlcnkncyBjb250ZXh0IGRvZXMgbm90IGhhdmUKICAg\nICAgICAgICAgLy8gYW55IGNhbmRpZGF0ZSBjbGFzcywgdGhlbiBzZXQgaXQg\naGVyZQogICAgICAgICAgICBpZiAoY3R4LmdldENhbmRpZGF0ZVR5cGUoKSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX2NhbmRpZGF0ZVR5cGUg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfY2FuZGlkYXRlVHlwZSA9\nIG5ldyBKUFFMRXhwcmVzc2lvbkJ1aWxkZXIKICAgICAgICAgICAgICAgICAg\nICAgICAgKG51bGwsIHF1ZXJ5LCB0aGlzKS5nZXRDYW5kaWRhdGVUeXBlKCk7\nCiAgICAgICAgICAgICAgICBjdHguc2V0Q2FuZGlkYXRlVHlwZShfY2FuZGlk\nYXRlVHlwZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgCiAgICAgICAgLyoqCiAgICAgICAgICogUHVibGljIGZvciB1bml0IHRl\nc3RpbmcgcHVycG9zZXMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIENs\nYXNzIGdldENhbmRpZGF0ZVR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBf\nY2FuZGlkYXRlVHlwZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJp\nbmcgdG9TdHJpbmcgKCkKCQl7CgkJCXJldHVybiB0aGlzLnF1ZXJ5OwoJCX0K\nCX0KfQoK\n","encoding":"base64"}

