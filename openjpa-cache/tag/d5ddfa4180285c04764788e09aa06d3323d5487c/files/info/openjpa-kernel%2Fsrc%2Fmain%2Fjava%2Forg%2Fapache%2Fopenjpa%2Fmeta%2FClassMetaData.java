{"sha":"264df7fe4416d7366e4bc997b6410d1687468299","node_id":"MDQ6QmxvYjIwNjM2NDoyNjRkZjdmZTQ0MTZkNzM2NmU0YmM5OTdiNjQxMGQxNjg3NDY4Mjk5","size":79346,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/264df7fe4416d7366e4bc997b6410d1687468299","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2\nYS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1w\nb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7\nCmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5EYXRhQ2FjaGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJs\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubWV0YS5Tb3VyY2VUcmFja2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2\nSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIueG1sLkNv\nbW1lbnRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQmln\nRGVjaW1hbElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQmln\nSW50ZWdlcklkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQnl0\nZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2hhcklkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRGF0ZUlkOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRG91YmxlSWQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5GbG9hdElkOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkludElkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLk9iamVjdElkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuU2hvcnRJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlN0cmluZ0lkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nVW5zdXBwb3J0ZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7\nCgovKioKICogQ29udGFpbnMgbWV0YWRhdGEgYWJvdXQgYSBwZXJzaXN0ZW50\nIHR5cGUuCiAqIFRoaXMgbWV0YWRhdGEgaXMgYXZhaWxhYmxlIGJvdGggYXQg\nZW5oYW5jZW1lbnQgdGltZSBhbmQgcnVudGltZS4KICogIE5vdGUgdGhhdCB0\naGlzIGNsYXNzIGVtcGxveXMgYWdncmVzc2l2ZSBjYWNoaW5nLCBhbmQgdGhl\ncmVmb3JlIGl0IGlzCiAqIGltcG9ydGFudCB0byBmaW5hbGl6ZSB0aGUgY29u\nZmlndXJhdGlvbiBvZiBmaWVsZCBtZXRhZGF0YXMgYmVmb3JlIGludm9raW5n\nCiAqIG1ldGhvZHMgdGhhdCBkZXBlbmQgb24gdGhhdCBjb25maWd1cmF0aW9u\nLCBzdWNoIGFzCiAqIHtAbGluayAjZ2V0UHJpbWFyeUtleUZpZWxkc30uCiAq\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgQ2xhc3NN\nZXRhRGF0YQogICAgZXh0ZW5kcyBFeHRlbnNpb25zCiAgICBpbXBsZW1lbnRz\nIENvbXBhcmFibGUsIFNvdXJjZVRyYWNrZXIsIE1ldGFEYXRhQ29udGV4dCwg\nTWV0YURhdGFNb2RlcywKICAgIENvbW1lbnRhYmxlIHsKCiAgICAvKioKICAg\nICAqIFVua29ud24gaWRlbnRpdHkgdHlwZS4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgSURfVU5LTk9XTiA9IDA7CgogICAgLyoqCiAg\nICAgKiBEYXRhc3RvcmUgaWRlbnRpdHkgdHlwZS4KICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBpbnQgSURfREFUQVNUT1JFID0gMTsKCiAgICAv\nKioKICAgICAqIEFwcGxpY2F0aW9uIGlkZW50aXR5IHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IElEX0FQUExJQ0FUSU9OID0g\nMjsKCiAgICAvKioKICAgICAqIFVua25vd24gYWNjZXNzIHR5cGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEFDQ0VTU19VTktOT1dO\nID0gMDsKCiAgICAvKioKICAgICAqIFBlcnNpc3RlbnQgYXR0cmlidXRlcyBh\ncmUgYWNjZXNzZWQgdmlhIGRpcmVjdCBmaWVsZCBhY2Nlc3MuIEJpdCBmbGFn\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBBQ0NFU1Nf\nRklFTEQgPSAyIDw8IDA7CgogICAgLyoqCiAgICAgKiBQZXJzaXN0ZW50IGF0\ndHJpYnV0ZXMgYXJlIGFjY2Vzc2VkIHZpYSBzZXR0ZXJzIGFuZCBnZXR0ZXJz\nLiBCaXQgZmxhZy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgQUNDRVNTX1BST1BFUlRZID0gMiA8PCAxOwoKICAgIC8qKgogICAgICog\nVmFsdWUgZm9yIHVzaW5nIGEgc3ludGhldGljIGRldGFjaGVkIHN0YXRlIGZp\nZWxkLCB3aGljaCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBTdHJpbmcgU1lOVEhFVElDID0gImBzeW4iOwoKICAg\nIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgU3RyaW5nIERFRkFVTFRfU1RSSU5H\nID0gImAiOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQ2xhc3NNZXRh\nRGF0YS5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgRmV0Y2hH\ncm91cFtdIEVNUFRZX0ZFVENIX0dST1VQX0FSUkFZCiAgICAgICAgPSBuZXcg\nRmV0Y2hHcm91cFswXTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmlu\nZ1tdIEVNUFRZX1NUUklOR19BUlJBWSA9IG5ldyBTdHJpbmdbMF07CgogICAg\ncHJpdmF0ZSBNZXRhRGF0YVJlcG9zaXRvcnkgX3JlcG9zOwogICAgcHJpdmF0\nZSB0cmFuc2llbnQgQ2xhc3NMb2FkZXIgX2xvYWRlciA9IG51bGw7CgogICAg\ncHJpdmF0ZSBmaW5hbCBWYWx1ZU1ldGFEYXRhIF9vd25lcjsKICAgIHByaXZh\ndGUgZmluYWwgTGlmZWN5Y2xlTWV0YURhdGEgX2xpZmVNZXRhID0gbmV3IExp\nZmVjeWNsZU1ldGFEYXRhKHRoaXMpOwogICAgcHJpdmF0ZSBGaWxlIF9zcmNG\naWxlID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9zcmNUeXBlID0gU1JDX09U\nSEVSOwogICAgcHJpdmF0ZSBTdHJpbmdbXSBfY29tbWVudHMgPSBudWxsOwog\nICAgcHJpdmF0ZSBpbnQgX2xpc3RJbmRleCA9IC0xOwogICAgcHJpdmF0ZSBp\nbnQgX3NyY01vZGUgPSBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkc7CiAgICBw\ncml2YXRlIGludCBfcmVzTW9kZSA9IE1PREVfTk9ORTsKCiAgICBwcml2YXRl\nIENsYXNzIF90eXBlID0gT2JqZWN0LmNsYXNzOwogICAgcHJpdmF0ZSBmaW5h\nbCBNYXAgX2ZpZWxkTWFwID0gbmV3IFRyZWVNYXAoKTsKICAgIHByaXZhdGUg\nTWFwIF9zdXBGaWVsZE1hcCA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4g\nX2RlZlN1cEZpZWxkcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBDb2xsZWN0aW9u\nIF9zdGF0aWNGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBpbnRbXSBfZmll\nbGREYXRhVGFibGUgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2ZnTWFwID0g\nbnVsbDsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTm90\nZTogaWYgeW91IGFkZCBhZGRpdGlvbmFsIHN0YXRlLCBtYWtlIHN1cmUgdG8g\nYWRkIGl0IHRvIGNvcHkoKQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nCiAgICBwcml2YXRlIENsYXNzIF9vYmplY3RJZCA9IG51bGw7CiAgICBwcml2\nYXRlIEJvb2xlYW4gX29iamVjdElkU2hhcmVkID0gbnVsbDsKICAgIHByaXZh\ndGUgQm9vbGVhbiBfb3BlbmpwYUlkID0gbnVsbDsKICAgIHByaXZhdGUgQm9v\nbGVhbiBfZXh0ZW50ID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBfZW1i\nZWRkZWQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9pbnRlcmZhY2Ug\nPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzcyBfaW1wbCA9IG51bGw7CiAgICBw\ncml2YXRlIExpc3QgX2ludGVyZmFjZXMgPSBudWxsOwogICAgcHJpdmF0ZSBm\naW5hbCBNYXAgX2lmYWNlTWFwID0gbmV3IEhhc2hNYXAoKTsKICAgIHByaXZh\ndGUgaW50IF9pZGVudGl0eSA9IElEX1VOS05PV047CiAgICBwcml2YXRlIGlu\ndCBfaWRTdHJhdGVneSA9IFZhbHVlU3RyYXRlZ2llcy5OT05FOwogICAgcHJp\ndmF0ZSBpbnQgX2FjY2Vzc1R5cGUgPSBBQ0NFU1NfVU5LTk9XTjsKCiAgICBw\ncml2YXRlIFN0cmluZyBfc2VxTmFtZSA9IERFRkFVTFRfU1RSSU5HOwogICAg\ncHJpdmF0ZSBTZXF1ZW5jZU1ldGFEYXRhIF9zZXFNZXRhID0gbnVsbDsKICAg\nIHByaXZhdGUgU3RyaW5nIF9jYWNoZU5hbWUgPSBERUZBVUxUX1NUUklORzsK\nICAgIHByaXZhdGUgaW50IF9jYWNoZVRpbWVvdXQgPSBJbnRlZ2VyLk1JTl9W\nQUxVRTsKICAgIHByaXZhdGUgQm9vbGVhbiBfZGV0YWNoYWJsZSA9IG51bGw7\nCiAgICBwcml2YXRlIFN0cmluZyBfZGV0YWNoU3RhdGUgPSBERUZBVUxUX1NU\nUklORzsKICAgIHByaXZhdGUgU3RyaW5nIF9hbGlhcyA9IG51bGw7CiAgICBw\ncml2YXRlIGludCBfdmVyc2lvbklkeCA9IEludGVnZXIuTUlOX1ZBTFVFOwoK\nICAgIHByaXZhdGUgQ2xhc3MgX3N1cGVyID0gbnVsbDsKICAgIHByaXZhdGUg\nQ2xhc3NNZXRhRGF0YSBfc3VwZXJNZXRhID0gbnVsbDsKICAgIHByaXZhdGUg\nQ2xhc3NbXSBfc3VicyA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzTWV0YURh\ndGFbXSBfc3ViTWV0YXMgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc01ldGFE\nYXRhW10gX21hcFN1Yk1ldGFzID0gbnVsbDsKCiAgICBwcml2YXRlIEZpZWxk\nTWV0YURhdGFbXSBfZmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRN\nZXRhRGF0YVtdIF91bm1nZEZpZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIEZp\nZWxkTWV0YURhdGFbXSBfYWxsRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUg\nRmllbGRNZXRhRGF0YVtdIF9hbGxQS0ZpZWxkcyA9IG51bGw7CiAgICBwcml2\nYXRlIEZpZWxkTWV0YURhdGFbXSBfYWxsREZHRmllbGRzID0gbnVsbDsKICAg\nIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9kZWZpbmVkRmllbGRzID0gbnVs\nbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9saXN0aW5nRmllbGRz\nID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9hbGxMaXN0\naW5nRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmV0Y2hHcm91cFtdIF9m\nZ3MgPSBudWxsOwogICAgcHJpdmF0ZSBGZXRjaEdyb3VwW10gX2N1c3RvbUZH\ncyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ludGVyY2VwdGluZyA9\nIGZhbHNlOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBk\nZXNjcmliZWQgdHlwZSBhbmQgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIENsYXNzTWV0YURhdGEoQ2xhc3MgdHlwZSwgTWV0YURhdGFSZXBv\nc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICAg\nICAgX293bmVyID0gbnVsbDsKICAgICAgICBzZXREZXNjcmliZWRUeXBlKHR5\ncGUpOwogICAgfQoKICAgIC8qKgogICAgICogRW1iZWRkZWQgY29uc3RydWN0\nb3IuIFN1cHBseSBlbWJlZGRpbmcgdmFsdWUuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBDbGFzc01ldGFEYXRhKFZhbHVlTWV0YURhdGEgb3duZXIpIHsKICAg\nICAgICBfb3duZXIgPSBvd25lcjsKICAgICAgICBfcmVwb3MgPSBvd25lci5n\nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgc2V0RW52Q2xhc3NMb2FkZXIob3du\nZXIuZ2V0RmllbGRNZXRhRGF0YSgpLmdldERlZmluaW5nTWV0YURhdGEoKS4K\nICAgICAgICAgICAgZ2V0RW52Q2xhc3NMb2FkZXIoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG93bmluZyByZXBvc2l0b3J5LgogICAg\nICovCiAgICBwdWJsaWMgTWV0YURhdGFSZXBvc2l0b3J5IGdldFJlcG9zaXRv\ncnkoKSB7CiAgICAgICAgcmV0dXJuIF9yZXBvczsKICAgIH0KCiAgICAvKioK\nICAgICAqIElmIHRoaXMgbWV0YWRhdGEgaXMgZm9yIGFuIGVtYmVkZGVkIG9i\namVjdCwgcmV0dXJuaW5nIHRoZSBvd25pbmcgdmFsdWUuCiAgICAgKi8KICAg\nIHB1YmxpYyBWYWx1ZU1ldGFEYXRhIGdldEVtYmVkZGluZ01ldGFEYXRhKCkg\newogICAgICAgIHJldHVybiBfb3duZXI7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgcGVyc2lzdGVuY2UgY2FwYWJsZSBjbGFzcyBkZXNjcmliZWQgYnkg\ndGhpcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIENsYXNzIGdldERl\nc2NyaWJlZFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF90eXBlOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBjbGFzcyBkZXNjaWJlZCBieSB0aGlz\nIG1ldGFkYXRhLiBUaGUgdHlwZSBtYXkgYmUgcmVzZXQgd2hlbgogICAgICog\nYW4gZW1iZWRkZWQgdmFsdWUgY2hhbmdlcyBpdHMgZGVjbGFyZWQgdHlwZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2V0RGVzY3JpYmVkVHlwZShD\nbGFzcyB0eXBlKSB7CiAgICAgICAgaWYgKHR5cGUuZ2V0U3VwZXJjbGFzcygp\nICE9IG51bGwgJiYgImphdmEubGFuZy5FbnVtIi5lcXVhbHMKICAgICAgICAg\nICAgKHR5cGUuZ2V0U3VwZXJjbGFzcygpLmdldE5hbWUoKSkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW51\nbSIsIHR5cGUpKTsKICAgICAgICBfdHlwZSA9IHR5cGU7CiAgICAgICAgaWYg\nKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5\ncGUpKQogICAgICAgICAgICBzZXRJbnRlcmNlcHRpbmcodHJ1ZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgZW52aXJvbm1lbnRhbCBsb2FkZXIgdXNl\nZCB3aGVuIGxvYWRpbmcgdGhpcyBtZXRhZGF0YS4KICAgICAqIFRoZSBjbGFz\ncyBtZXRhZGF0YSBzaG91bGQgdXNlIHRoaXMgbG9hZGVyIHdoZW4gbG9hZGlu\nZyBtZXRhZGF0YSBmb3IKICAgICAqIGl0cyBzdXBlcmNsYXNzIGFuZCBmaWVs\nZCB0eXBlcy4KICAgICAqLwogICAgcHVibGljIENsYXNzTG9hZGVyIGdldEVu\ndkNsYXNzTG9hZGVyKCkgewogICAgICAgIHJldHVybiBfbG9hZGVyOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIGNsYXNzIGVudmlyb25tZW50YWwgbG9h\nZGVyIHVzZWQgd2hlbiBsb2FkaW5nIHRoaXMgbWV0YWRhdGEuCiAgICAgKiBU\naGUgY2xhc3MgbWV0YWRhdGEgc2hvdWxkIHVzZSB0aGlzIGxvYWRlciB3aGVu\nIGxvYWRpbmcgbWV0YWRhdGEgZm9yCiAgICAgKiBpdHMgc3VwZXJjbGFzcyBh\nbmQgZmllbGQgdHlwZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVu\ndkNsYXNzTG9hZGVyKENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIF9s\nb2FkZXIgPSBsb2FkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgcGVy\nc2lzdGVuY2UgY2FwYWJsZSBzdXBlcmNsYXNzIG9mIHRoZSBkZXNjcmliZWQg\ndHlwZS4KICAgICAqLwogICAgcHVibGljIENsYXNzIGdldFBDU3VwZXJjbGFz\ncygpIHsKICAgICAgICByZXR1cm4gX3N1cGVyOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIHBlcnNpc3RlbmNlIGNhcGFibGUgc3VwZXJjbGFzcyBvZiB0\naGUgZGVzY3JpYmVkIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFBDU3VwZXJjbGFzcyhDbGFzcyBwYykgewogICAgICAgIGNsZWFyQWxsRmll\nbGRDYWNoZSgpOwogICAgICAgIF9zdXBlciA9IHBjOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIG1ldGFkYXRhIGZvciB0aGlzIGNsYXNzJyBzdXBlcmNs\nYXNzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpIHsKICAgICAgICBpZiAoX3N1cGVyTWV0YSA9\nPSBudWxsICYmIF9zdXBlciAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChf\nb3duZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX3N1cGVyTWV0YSA9\nIF9yZXBvcy5uZXdFbWJlZGRlZENsYXNzTWV0YURhdGEoX293bmVyKTsKICAg\nICAgICAgICAgICAgIF9zdXBlck1ldGEuc2V0RGVzY3JpYmVkVHlwZShfc3Vw\nZXIpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIF9zdXBl\nck1ldGEgPSBfcmVwb3MuZ2V0TWV0YURhdGEoX3N1cGVyLCBfbG9hZGVyLCB0\ncnVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9zdXBlck1ldGE7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgZm9yIHRoaXMgY2xh\nc3MnIHN1cGVyY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAg\nICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAgICAgIF9zdXBlck1ldGEg\nPSBtZXRhOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAg\nIHNldFBDU3VwZXJjbGFzcyhtZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgY2xhc3MgaXMgbWFw\ncGVkIHRvIHRoZSBkYXRhc3RvcmUuIEJ5IGRlZmF1bHQsIG9ubHkKICAgICAq\nIHJldHVybnMgZmFsc2UgaWYgY2xhc3MgaXMgZW1iZWRkZWQtb25seSwgYnV0\nIHN1YmNsYXNzZXMgbWlnaHQgb3ZlcnJpZGUKICAgICAqIHRvIGFsbG93IHVu\nbWFwcGVkIG90aGVyIHR5cGVzLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc01hcHBlZCgpIHsKICAgICAgICByZXR1cm4gX2VtYmVkZGVkICE9IEJv\nb2xlYW4uVFJVRTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nY2xvc2VzdCBtYXBwZWQgc3VwZXJjbGFzcy4KICAgICAqLwogICAgcHVibGlj\nIENsYXNzTWV0YURhdGEgZ2V0TWFwcGVkUENTdXBlcmNsYXNzTWV0YURhdGEo\nKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgPT0gbnVsbCB8fCBzdXAu\naXNNYXBwZWQoKSkKICAgICAgICAgICAgcmV0dXJuIHN1cDsKICAgICAgICBy\nZXR1cm4gc3VwLmdldE1hcHBlZFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGtub3duIHBlcnNpc3Rl\nbmNlIGNhcGFibGUgc3ViY2xhc3NlcyBvZiB0aGUgZGVzY3JpYmVkIHR5cGUs\nCiAgICAgKiBvciBlbXB0eSBhcnJheSBpZiBub25lIG9yIGlmIHRoaXMgaXMg\nZW1iZWRkZWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc1td\nIGdldFBDU3ViY2xhc3NlcygpIHsKICAgICAgICBpZiAoX293bmVyICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBfcmVwb3MuRU1QVFlfQ0xBU1NFUzsK\nCiAgICAgICAgX3JlcG9zLnByb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcyhfbG9h\nZGVyKTsKICAgICAgICBpZiAoX3N1YnMgPT0gbnVsbCkgewogICAgICAgICAg\nICBDb2xsZWN0aW9uIHN1YnMgPSBfcmVwb3MuZ2V0UENTdWJjbGFzc2VzKF90\neXBlKTsKICAgICAgICAgICAgX3N1YnMgPSAoQ2xhc3NbXSkgc3Vicy50b0Fy\ncmF5KG5ldyBDbGFzc1tzdWJzLnNpemUoKV0pOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gX3N1YnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIG1ldGFkYXRhIGZvciB0aGUga25vd24gcGVyc2lzdGVuY2UgY2FwYWJs\nZSBzdWJjbGFzc2VzIG9mCiAgICAgKiB0aGUgZGVzY3JpYmVkIHR5cGUsIG9y\nIGVtcHR5IGFycmF5IGlmIG5vbmUgb3IgaWYgdGhpcyBpcyBlbWJlZGRlZAog\nICAgICogbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFE\nYXRhW10gZ2V0UENTdWJjbGFzc01ldGFEYXRhcygpIHsKICAgICAgICBpZiAo\nX293bmVyICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfcmVwb3MuRU1Q\nVFlfTUVUQVM7CgogICAgICAgIENsYXNzW10gc3VicyA9IGdldFBDU3ViY2xh\nc3NlcygpOyAvLyBjaGVja3MgZm9yIG5ldwogICAgICAgIGlmIChfc3ViTWV0\nYXMgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoc3Vicy5sZW5ndGggPT0g\nMCkKICAgICAgICAgICAgICAgIF9zdWJNZXRhcyA9IF9yZXBvcy5FTVBUWV9N\nRVRBUzsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBDbGFz\nc01ldGFEYXRhW10gbWV0YXMgPSBfcmVwb3MubmV3Q2xhc3NNZXRhRGF0YUFy\ncmF5CiAgICAgICAgICAgICAgICAgICAgKHN1YnMubGVuZ3RoKTsKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vicy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgICAgICAgICBtZXRhc1tpXSA9IF9yZXBvcy5nZXRN\nZXRhRGF0YShzdWJzW2ldLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAg\nICAgIF9zdWJNZXRhcyA9IG1ldGFzOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBfc3ViTWV0YXM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYWxsIG1hcHBlZCBzdWJjbGFzc2VzLgogICAgICovCiAg\nICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdldE1hcHBlZFBDU3ViY2xhc3NN\nZXRhRGF0YXMoKSB7CiAgICAgICAgaWYgKF9vd25lciAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gX3JlcG9zLkVNUFRZX01FVEFTOwoKICAgICAgICBD\nbGFzc01ldGFEYXRhW10gc3VicyA9IGdldFBDU3ViY2xhc3NNZXRhRGF0YXMo\nKTsgLy8gY2hlY2tzIGZvciBuZXcKICAgICAgICBpZiAoX21hcFN1Yk1ldGFz\nID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKHN1YnMubGVuZ3RoID09IDAp\nCiAgICAgICAgICAgICAgICBfbWFwU3ViTWV0YXMgPSBzdWJzOwogICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIExpc3QgbWFwcGVkID0gbmV3\nIEFycmF5TGlzdChzdWJzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHN1YnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nICAgICAgICAgaWYgKHN1YnNbaV0uaXNNYXBwZWQoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgbWFwcGVkLmFkZChzdWJzW2ldKTsKICAgICAgICAgICAg\nICAgIF9tYXBTdWJNZXRhcyA9IChDbGFzc01ldGFEYXRhW10pIG1hcHBlZC50\nb0FycmF5CiAgICAgICAgICAgICAgICAgICAgKF9yZXBvcy5uZXdDbGFzc01l\ndGFEYXRhQXJyYXkobWFwcGVkLnNpemUoKSkpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBfbWFwU3ViTWV0YXM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiBpZGVudGl0eSBiZWluZyB1c2Vk\nLiBUaGlzIHdpbGwgYmUgb25lIG9mOgogICAgICogPHVsPgogICAgICogPGxp\nPntAbGluayAjSURfVU5LTk9XTn06IHVua25vd24gaWRlbnRpdHkgdHlwZTwv\nbGk+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9EQVRBU1RPUkV9OiBpZGVudGl0\neSBtYW5hZ2VkIGJ5IHRoZSBkYXRhIHN0b3JlIGFuZAogICAgICogaW5kZXBl\nbmRlbnQJb2YgdGhlIGZpZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xpPgogICAg\nICogPGxpPntAbGluayAjSURfQVBQTElDQVRJT059OiBpZGVudGl0eSBtYW5h\nZ2VkIGJ5IHRoZSBhcHBsaWNhdGlvbiBhbmQKICAgICAqIGRlZmluZWQgYnkg\nb25lIG9yIG1vcmUgZmllbGRzIG9mIHRoZSBpbnN0YW5jZTwvbGk+CiAgICAg\nKiA8L3VsPiBJZiB1bnNwZWNpZmllZCwgZGVmYXVsdHMgdG8ge0BsaW5rICNJ\nRF9EQVRBU1RPUkV9IGlmIHRoZXJlIGFyZSBubwogICAgICogcHJpbWFyeSBr\nZXkgZmllbGRzLCBhbmQge0BsaW5rICNJRF9BUFBMSUNBVElPTn0gb3RoZXJ3\naXNlLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldElkZW50aXR5VHlwZSgp\nIHsKICAgICAgICBpZiAoX2lkZW50aXR5ID09IElEX1VOS05PV04pIHsKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3Vw\nLmdldElkZW50aXR5VHlwZSgpICE9IElEX1VOS05PV04pCiAgICAgICAgICAg\nICAgICBfaWRlbnRpdHkgPSBzdXAuZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKGdldFByaW1hcnlLZXlGaWVsZHMoKS5sZW5ndGgg\nPiAwKQogICAgICAgICAgICAgICAgX2lkZW50aXR5ID0gSURfQVBQTElDQVRJ\nT047CiAgICAgICAgICAgIGVsc2UgaWYgKGlzTWFwcGVkKCkpCiAgICAgICAg\nICAgICAgICBfaWRlbnRpdHkgPSBJRF9EQVRBU1RPUkU7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIF9pZGVudGl0eSA9IF9yZXBvcy5nZXRN\nZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0cygpLgogICAgICAgICAgICAg\nICAgICAgIGdldERlZmF1bHRJZGVudGl0eVR5cGUoKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9pZGVudGl0eTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSB0eXBlIG9mIGlkZW50aXR5IGJlaW5nIHVzZWQuIFRoaXMgd2lsbCBi\nZSBvbmUgb2Y6CiAgICAgKiA8dWw+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9V\nTktOT1dOfTogdW5rbm93biBpZGVudGl0eSB0eXBlPC9saT4KICAgICAqIDxs\naT57QGxpbmsgI0lEX0RBVEFTVE9SRX06IGlkZW50aXR5IG1hbmFnZWQgYnkg\ndGhlIGRhdGEgc3RvcmUgYW5kCiAgICAgKiBpbmRlcGVuZGVudAlvZiB0aGUg\nZmllbGRzIG9mIHRoZSBpbnN0YW5jZTwvbGk+CiAgICAgKiA8bGk+e0BsaW5r\nICNJRF9BUFBMSUNBVElPTn06IGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGFw\ncGxpY2F0aW9uIGFuZAogICAgICogZGVmaW5lZCBieSBvbmUgb3IgbW9yZSBm\naWVsZHMgb2YgdGhlIGluc3RhbmNlPC9saT4KICAgICAqIDwvdWw+IElmIHVu\nc3BlY2lmaWVkLCBkZWZhdWx0cyB0byB7QGxpbmsgI0lEX0RBVEFTVE9SRX0g\naWYgdGhlcmUgYXJlIG5vCiAgICAgKiBwcmltYXJ5IGtleSBmaWVsZHMsIGFu\nZCB7QGxpbmsgI0lEX0FQUExJQ0FUSU9OfSBvdGhlcndpc2UuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldElkZW50aXR5VHlwZShpbnQgdHlwZSkgewog\nICAgICAgIF9pZGVudGl0eSA9IHR5cGU7CiAgICAgICAgaWYgKHR5cGUgIT0g\nSURfQVBQTElDQVRJT04pIHsKICAgICAgICAgICAgX29iamVjdElkID0gbnVs\nbDsKICAgICAgICAgICAgX29wZW5qcGFJZCA9IG51bGw7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhLXNwZWNpZmllZCBj\nbGFzcyB0byB1c2UgZm9yIHRoZSBvYmplY3QgSUQuCiAgICAgKi8KICAgIHB1\nYmxpYyBDbGFzcyBnZXRPYmplY3RJZFR5cGUoKSB7CiAgICAgICAgaWYgKF9v\nYmplY3RJZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX29iamVjdElk\nOwogICAgICAgIGlmIChnZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9BUFBMSUNB\nVElPTikKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAg\nICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0SWRlbnRpdHlUeXBlKCkg\nIT0gSURfVU5LTk9XTikgewogICAgICAgICAgICBfb2JqZWN0SWQgPSBzdXAu\nZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0\nSWQ7CiAgICAgICAgfQoKICAgICAgICAvLyBmaWd1cmUgb3V0IG9wZW5qcGEg\naWRlbnRpdHkgdHlwZSBiYXNlZCBvbiBwcmltYXJ5IGtleSBmaWVsZAogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBnZXRQcmltYXJ5S2V5RmllbGRz\nKCk7CiAgICAgICAgaWYgKHBrcy5sZW5ndGggIT0gMSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgc3dpdGNoIChwa3NbMF0uZ2V0T2JqZWN0\nSWRGaWVsZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6\nCiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBCeXRlSWQuY2xhc3M7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ0hBUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6\nCiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBDaGFySWQuY2xhc3M7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVf\nT0JKOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gRG91YmxlSWQuY2xh\nc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZM\nT0FUX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IEZsb2F0SWQu\nY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlRfT0JKOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gSW50SWQuY2xh\nc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9O\nR19PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBMb25nSWQuY2xh\nc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNI\nT1JUX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IFNob3J0SWQu\nY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgX29iamVjdElk\nID0gU3RyaW5nSWQuY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAg\nIF9vYmplY3RJZCA9IERhdGVJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIF9v\nYmplY3RJZCA9IE9iamVjdElkLmNsYXNzOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAg\nICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBCaWdEZWNpbWFsSWQuY2xhc3M7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9\nIEJpZ0ludGVnZXJJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX29iamVjdElkOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIG1ldGFkYXRhLXNwZWNpZmllZCBjbGFzcyB0byB1\nc2UgZm9yIHRoZSBvYmplY3QgSUQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldE9iamVjdElkVHlwZShDbGFzcyBjbHMsIGJvb2xlYW4gc2hhcmVkKSB7\nCiAgICAgICAgX29iamVjdElkID0gbnVsbDsKICAgICAgICBfb3BlbmpwYUlk\nID0gbnVsbDsKICAgICAgICBfb2JqZWN0SWRTaGFyZWQgPSBudWxsOwogICAg\nICAgIGlmIChjbHMgIT0gbnVsbCkgewogICAgICAgICAgICAvLyBkb24ndCBs\nZXQgcGVvcGxlIGFzc2lnbiBPcGVuSlBBSWQgdHlwZXM7IHNhZmVyIHRvIGNh\nbGN1bGF0ZSBpdAogICAgICAgICAgICAvLyBvdXJzZWx2ZXMKICAgICAgICAg\nICAgc2V0SWRlbnRpdHlUeXBlKElEX0FQUExJQ0FUSU9OKTsKICAgICAgICAg\nICAgaWYgKCFPcGVuSlBBSWQuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMp\nKSB7CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBjbHM7CiAgICAgICAg\nICAgICAgICBfb2JqZWN0SWRTaGFyZWQgPSAoc2hhcmVkKSA/IEJvb2xlYW4u\nVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgdHlwZSB1c2Vz\nIGFuIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzIHRoYXQgaXMgc2hhcmVk\nCiAgICAgKiB3aXRoIG90aGVyIGNsYXNzZXMsIGFuZCBpcyB0aGVyZWZvcmUg\nd3JhcHBlZCBpbiBhbiB7QGxpbmsgT2JqZWN0SWR9LgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc09iamVjdElkVHlwZVNoYXJlZCgpIHsKICAgICAg\nICBpZiAoX29iamVjdElkU2hhcmVkICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBfb2JqZWN0SWRTaGFyZWQuYm9vbGVhblZhbHVlKCk7CiAgICAgICAg\naWYgKF9zdXBlciAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKS5pc09iamVjdElkVHlwZVNoYXJlZCgpOwog\nICAgICAgIHJldHVybiBpc09wZW5KUEFJZGVudGl0eSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogV2hldGhlciB0aGlzIHR5cGUgdXNlcyBPcGVuSlBBIGlk\nZW50aXR5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc09wZW5KUEFJ\nZGVudGl0eSgpIHsKICAgICAgICBpZiAoX29wZW5qcGFJZCA9PSBudWxsKSB7\nCiAgICAgICAgICAgIENsYXNzIGNscyA9IGdldE9iamVjdElkVHlwZSgpOwog\nICAgICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIF9vcGVuanBhSWQgPSAoT3BlbkpQ\nQUlkLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkgPyBCb29sZWFuLlRS\nVUUKICAgICAgICAgICAgICAgIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIF9vcGVuanBhSWQuYm9vbGVhblZhbHVlKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgc3RyYXRlZ3kgdG8gdXNlIGZvciBk\nYXRhc3RvcmUgaWRlbnRpdHkgZ2VuZXJhdGlvbi4KICAgICAqIE9uZSBvZiB0\naGUgY29uc3RhbnRzIGZyb20ge0BsaW5rIFZhbHVlU3RyYXRlZ2llc30uCiAg\nICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0SWRlbnRpdHlTdHJhdGVneSgpIHsK\nICAgICAgICBpZiAoZ2V0SWRlbnRpdHlUeXBlKCkgPT0gSURfREFUQVNUT1JF\nCiAgICAgICAgICAgICYmIF9pZFN0cmF0ZWd5ID09IFZhbHVlU3RyYXRlZ2ll\ncy5OT05FKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAh\nPSBudWxsICYmIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dO\nKQogICAgICAgICAgICAgICAgX2lkU3RyYXRlZ3kgPSBzdXAuZ2V0SWRlbnRp\ndHlTdHJhdGVneSgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBfaWRTdHJhdGVneSA9IFZhbHVlU3RyYXRlZ2llcy5OQVRJVkU7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBfaWRTdHJhdGVneTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBzdHJhdGVneSB0byB1c2UgZm9yIGRhdGFzdG9yZSBp\nZGVudGl0eSBnZW5lcmF0aW9uLgogICAgICogT25lIG9mIHRoZSBjb25zdGFu\ndHMgZnJvbSB7QGxpbmsgVmFsdWVTdHJhdGVnaWVzfS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0SWRlbnRpdHlTdHJhdGVneShpbnQgc3RyYXRlZ3kp\nIHsKICAgICAgICBfaWRTdHJhdGVneSA9IHN0cmF0ZWd5OwogICAgICAgIGlm\nIChzdHJhdGVneSAhPSBWYWx1ZVN0cmF0ZWdpZXMuU0VRVUVOQ0UpCiAgICAg\nICAgICAgIHNldElkZW50aXR5U2VxdWVuY2VOYW1lKG51bGwpOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIGRhdGFzdG9yZSBpZGVudGl0eSBzZXF1ZW5j\nZSBuYW1lLCBvciBudWxsIGZvciBub25lLgogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nIGdldElkZW50aXR5U2VxdWVuY2VOYW1lKCkgewogICAgICAgIGlm\nIChERUZBVUxUX1NUUklORy5lcXVhbHMoX3NlcU5hbWUpKSB7CiAgICAgICAg\nICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zZXFO\nYW1lID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXRJZGVudGl0eVNl\ncXVlbmNlTmFtZSgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBfc2VxTmFtZSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nc2VxTmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBkYXRhc3RvcmUg\naWRlbnRpdHkgc2VxdWVuY2UgbmFtZSwgb3IgbnVsbCBmb3Igbm9uZS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUo\nU3RyaW5nIHNlcU5hbWUpIHsKICAgICAgICBfc2VxTmFtZSA9IHNlcU5hbWU7\nCiAgICAgICAgX3NlcU1ldGEgPSBudWxsOwogICAgICAgIGlmIChzZXFOYW1l\nICE9IG51bGwpCiAgICAgICAgICAgIHNldElkZW50aXR5U3RyYXRlZ3koVmFs\ndWVTdHJhdGVnaWVzLlNFUVVFTkNFKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE1ldGFkYXRhIGZvciB0aGUgZGF0YXN0b3JlIGlkZW50aXR5IHNlcXVlbmNl\nLgogICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0YSBnZXRJZGVu\ndGl0eVNlcXVlbmNlTWV0YURhdGEoKSB7CiAgICAgICAgaWYgKF9zZXFNZXRh\nID09IG51bGwgJiYgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKSAhPSBudWxs\nKQogICAgICAgICAgICBfc2VxTWV0YSA9IF9yZXBvcy5nZXRTZXF1ZW5jZU1l\ndGFEYXRhKHRoaXMsCiAgICAgICAgICAgICAgICBnZXRJZGVudGl0eVNlcXVl\nbmNlTmFtZSgpLCB0cnVlKTsKICAgICAgICByZXR1cm4gX3NlcU1ldGE7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbmZvcm1hdGlvbiBhYm91dCBsaWZlY3lj\nbGUgY2FsbGJhY2tzIGZvciB0aGlzIGNsYXNzLgogICAgICovCiAgICBwdWJs\naWMgTGlmZWN5Y2xlTWV0YURhdGEgZ2V0TGlmZWN5Y2xlTWV0YURhdGEoKSB7\nCiAgICAgICAgcmV0dXJuIF9saWZlTWV0YTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybnMgdGhlIGFsaWFzIGZvciB0aGUgZGVzY3JpYmVkIHR5cGUs\nIG9yIDxjb2RlPm51bGw8L2NvZGU+IGlmIG5vbmUKICAgICAqIGhhcyBiZWVu\nIHNldC4KICAgICAqIAogICAgICogQHNlZSAjc2V0VHlwZUFsaWFzCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VHlwZUFsaWFzKCkgewogICAgICAg\nIGlmIChfYWxpYXMgPT0gbnVsbCkKICAgICAgICAgICAgX2FsaWFzID0gU3Ry\naW5ncy5nZXRDbGFzc05hbWUoX3R5cGUpOwogICAgICAgIHJldHVybiBfYWxp\nYXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBhbGlhcyBmb3Ig\ndGhlIGRlc2NyaWJlZCB0eXBlLiBUaGUgYWxpYXMgY2FuIGJlCiAgICAgKiBh\nbnkgYXJiaXRyYXJ5IHN0cmluZyB0aGF0IHRoZSBpbXBsZW1lbnRhdGlvbiBj\nYW4gbGF0ZXIgdXNlIHRvCiAgICAgKiByZWZlciB0byB0aGUgY2xhc3MuIE5v\ndGUgdGhhdCBhdCBydW50aW1lLCBvbmx5IHRoZSBhbGlhcwogICAgICogY29t\ncHV0ZWQgd2hlbiB0aGUgcGVyc2lzdGVudCB0eXBlIHdhcyBlbmhhbmNlZCBp\ncyB1c2VkLgogICAgICoKICAgICAqIEBwYXJhbSBhbGlhcyB0aGUgYWxpYXMg\nbmFtZSB0byBhcHBseSB0byB0aGUgZGVzY3JpYmVkIHR5cGUKICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0VHlwZUFsaWFzKFN0cmluZyBhbGlhcykgewog\nICAgICAgIF9hbGlhcyA9IGFsaWFzOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIGFjY2VzcyB0eXBlIHVzZWQgYnkgdGhpcyBjbGFzcy4gRWl0aGVyIHtA\nbGluayAjQUNDRVNTX0ZJRUxEfQogICAgICogb3Ige0BsaW5rICNBQ0NFU1Nf\nUFJPUEVSVFl9LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldEFjY2Vzc1R5\ncGUoKSB7CiAgICAgICAgaWYgKF9hY2Nlc3NUeXBlID09IEFDQ0VTU19VTktO\nT1dOKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHN1cC5nZXRBY2Nlc3NUeXBl\nKCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YUZhY3RvcnkoKS4KICAgICAg\nICAgICAgICAgICAgICBnZXREZWZhdWx0cygpLmdldERlZmF1bHRBY2Nlc3NU\neXBlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIF9hY2Nlc3NUeXBlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGFjY2Vz\ncyB0eXBlIHVzZWQgYnkgdGhpcyBjbGFzcy4gTXVzdCBiZSBlaXRoZXIKICAg\nICAqIHtAbGluayAjQUNDRVNTX0ZJRUxEfSBvciB7QGxpbmsgI0FDQ0VTU19Q\nUk9QRVJUWX0uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEFjY2Vzc1R5\ncGUoaW50IHR5cGUpIHsKICAgICAgICBfYWNjZXNzVHlwZSA9IHR5cGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHJlcXVpcmVz\nIGV4dGVudCBtYW5hZ2VtZW50LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRSZXF1aXJlc0V4dGVudCgpIHsKICAgICAgICBpZiAoX293bmVyICE9\nIG51bGwgfHwgaXNFbWJlZGRlZE9ubHkoKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICBpZiAoX2V4dGVudCA9PSBudWxsKSB7CiAgICAg\nICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgX2V4dGVudCA9IChzdXAuZ2V0UmVxdWlyZXNFeHRlbnQoKSkg\nPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9leHRl\nbnQgPSBCb29sZWFuLlRSVUU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nZXh0ZW50LmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGUgdHlwZSByZXF1aXJlcyBleHRlbnQgbWFuYWdlbWVudC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVxdWlyZXNFeHRlbnQoYm9v\nbGVhbiByZXEpIHsKICAgICAgICBfZXh0ZW50ID0gKHJlcSkgPyBCb29sZWFu\nLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGUgdHlwZSBjYW4gb25seSBiZSB1c2VkIGFzIGFuIGVtYmVk\nZGVkIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNFbWJl\nZGRlZE9ubHkoKSB7CiAgICAgICAgaWYgKF9lbWJlZGRlZCA9PSBudWxsKSB7\nCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX2VtYmVkZGVkID0gKHN1cC5pc0VtYmVkZGVkT25s\neSgpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAgICAgICAgIDogQm9v\nbGVhbi5GQUxTRTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nX2VtYmVkZGVkID0gQm9vbGVhbi5GQUxTRTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIF9lbWJlZGRlZC5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgY2FuIG9ubHkgYmUgdXNlZCBh\ncyBhbiBlbWJlZGRlZCBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEVtYmVkZGVkT25seShib29sZWFuIGVtYmVkKSB7CiAgICAgICAgX2Vt\nYmVkZGVkID0gKGVtYmVkKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFM\nU0U7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlJ3Mg\nZmllbGRzIGFyZSBhY3RpdmVseSBpbnRlcmNlcHRlZCwgZWl0aGVyIGJ5CiAg\nICAgKiByZWRlZmluaXRpb24gb3IgZW5oYW5jZW1lbnQuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGlzSW50ZXJjZXB0aW5nKCkgewogICAgICAgIHJl\ndHVybiBfaW50ZXJjZXB0aW5nOwogICAgfQoKICAgIC8qKgogICAgICogV2hl\ndGhlciB0aGUgdHlwZSdzIGZpZWxkcyBhcmUgYWN0aXZlbHkgaW50ZXJjZXB0\nZWQsIGVpdGhlciBieQogICAgICogcmVkZWZpbml0aW9uIG9yIGVuaGFuY2Vt\nZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRlcmNlcHRpbmco\nYm9vbGVhbiBpbnRlcmNlcHRpbmcpIHsKICAgICAgICBfaW50ZXJjZXB0aW5n\nID0gaW50ZXJjZXB0aW5nOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0aGUgdHlwZSBpcyBhIG1hbmFnZWQgaW50ZXJmYWNlLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc01hbmFnZWRJbnRlcmZhY2UoKSB7CiAgICAg\nICAgaWYgKCFfdHlwZS5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9pbnRlcmZhY2UgPT0gbnVsbCA/\nIGZhbHNlIDogX2ludGVyZmFjZS5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgaXMgYSBtYW5hZ2VkIGlu\ndGVyZmFjZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNYW5hZ2VkSW50\nZXJmYWNlKGJvb2xlYW4gbWFuYWdlZEludGVyZmFjZSkgewogICAgICAgIGlm\nICghX3R5cGUuaXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtaW50ZXJmYWNlIiwg\nX3R5cGUpKTsKICAgICAgICBfaW50ZXJmYWNlID0gbWFuYWdlZEludGVyZmFj\nZSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CgogICAgICAgIC8v\nIG1hbmFnZWQgaW50ZXJmYWNlcyBhbHdheXMgZG8gcHJvcGVyIGludGVyY2Vw\ndGlvbjsgT3BlbkpQQSBnZW5lcmF0ZXMKICAgICAgICAvLyB0aGUgaW1wbGVt\nZW50YXRpb25zLgogICAgICAgIGlmIChpc01hbmFnZWRJbnRlcmZhY2UoKSkK\nICAgICAgICAgICAgc2V0SW50ZXJjZXB0aW5nKHRydWUpOwoKICAgICAgICAv\nLyBtYW5hZ2VkIGludGVyZmFjZXMgYWx3YXlzIHVzZSBwcm9wZXJ0eSBhY2Nl\nc3MuCiAgICAgICAgc2V0QWNjZXNzVHlwZShBQ0NFU1NfUFJPUEVSVFkpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtYW5hZ2VkIGludGVy\nZmFjZSBpbXBsZW1lbnRvciBpZiBhbnkuCiAgICAgKi8KICAgIHB1YmxpYyBD\nbGFzcyBnZXRJbnRlcmZhY2VJbXBsKCkgewogICAgICAgIHJldHVybiBfaW1w\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgbWFuYWdlZCBpbnRl\ncmZhY2UgaW1wbGVtZW50b3IgY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldEludGVyZmFjZUltcGwoQ2xhc3MgaW1wbCkgewogICAgICAgIF9p\nbXBsID0gaW1wbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbGwg\nZXhwbGljaXRseSBkZWNsYXJlZCBpbnRlcmZhY2VzIHRoaXMgY2xhc3MgaW1w\nbGVtZW50cy4KICAgICAqLwogICAgcHVibGljIENsYXNzW10gZ2V0RGVjbGFy\nZWRJbnRlcmZhY2VzKCkgewogICAgICAgIGlmIChfaW50ZXJmYWNlcyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gTWV0YURhdGFSZXBvc2l0b3J5LkVN\nUFRZX0NMQVNTRVM7CiAgICAgICAgcmV0dXJuIChDbGFzc1tdKSBfaW50ZXJm\nYWNlcy50b0FycmF5KG5ldyBDbGFzc1tfaW50ZXJmYWNlcy5zaXplKCldKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEV4cGxpY2l0bHkgZGVjbGFyZSB0aGUg\nZ2l2ZW4gaW50ZXJmYWNlIGFtb25nIHRoZSBvbmVzIHRoaXMKICAgICAqIGNs\nYXNzIGltcGxlbWVudHMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFkZERl\nY2xhcmVkSW50ZXJmYWNlKENsYXNzIGlmYWNlKSB7CiAgICAgICAgaWYgKGlm\nYWNlID09IG51bGwgfHwgIWlmYWNlLmlzSW50ZXJmYWNlKCkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZGVj\nbGFyZS1ub24taW50ZXJmYWNlIiwKICAgICAgICAgICAgICAgIHRoaXMsIGlm\nYWNlKSk7CiAgICAgICAgaWYgKF9pbnRlcmZhY2VzID09IG51bGwpCiAgICAg\nICAgICAgIF9pbnRlcmZhY2VzID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAg\nIF9pbnRlcmZhY2VzLmFkZChpZmFjZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZW1vdmUgdGhlIGdpdmVuIGludGVyZmFjZSBmcm9tIHRoZSBkZWNsYXJl\nZCBsaXN0LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVEZWNs\nYXJlZEludGVyZmFjZShDbGFzcyBpZmFjZSkgewogICAgICAgIGlmIChfaW50\nZXJmYWNlcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgcmV0dXJuIF9pbnRlcmZhY2VzLnJlbW92ZShpZmFjZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBbGlhcyBwcm9wZXJ0aWVzIGZyb20gdGhlIGdp\ndmVuIGludGVyZmFjZSBkdXJpbmcgIHF1ZXJpZXMgdG8KICAgICAqIHRoZSBs\nb2NhbCBmaWVsZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW50ZXJm\nYWNlUHJvcGVydHlBbGlhcyhDbGFzcyBpZmFjZSwgU3RyaW5nIG9yaWcsIAog\nICAgICAgIFN0cmluZyBsb2NhbCkgewogICAgICAgIHN5bmNocm9uaXplZCAo\nX2lmYWNlTWFwKSB7CiAgICAgICAgICAgIE1hcCBmaWVsZHMgPSAoTWFwKSBf\naWZhY2VNYXAuZ2V0KGlmYWNlKTsKICAgICAgICAgICAgaWYgKGZpZWxkcyA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmaWVsZHMgPSBuZXcgSGFzaE1h\ncCgpOwogICAgICAgICAgICAgICAgX2lmYWNlTWFwLnB1dChpZmFjZSwgZmll\nbGRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmllbGRzLmNv\nbnRhaW5zS2V5KG9yaWcpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJkdXBsaWNhdGUtaWZhY2UtYWxp\nYXMiLCAKICAgICAgICAgICAgICAgICAgICB0aGlzLCBvcmlnLCBsb2NhbCkp\nOwogICAgICAgICAgICBmaWVsZHMucHV0KG9yaWcsIGxvY2FsKTsKICAgICAg\nICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0IGxvY2FsIGZpZWxk\nIGFsaWFzIGZvciB0aGUgZ2l2ZW4gaW50ZXJmYWNlIHByb3BlcnR5LgogICAg\nICovCiAgICBwdWJsaWMgU3RyaW5nIGdldEludGVyZmFjZVByb3BlcnR5QWxp\nYXMoQ2xhc3MgaWZhY2UsIFN0cmluZyBvcmlnKSB7CiAgICAgICAgc3luY2hy\nb25pemVkIChfaWZhY2VNYXApIHsKICAgICAgICAgICAgTWFwIGZpZWxkcyA9\nIChNYXApIF9pZmFjZU1hcC5nZXQoaWZhY2UpOwogICAgICAgICAgICBpZiAo\nZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICAgICAgcmV0dXJuIChTdHJpbmcpIGZpZWxkcy5nZXQob3JpZyk7\nCiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiBh\nbGwgYWxpYXNlcyBwcm9wZXJ0eSBuYW1lZCBmb3IgdGhlIGdpdmVuIGludGVy\nZmFjZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldEludGVyZmFj\nZUFsaWFzZWRQcm9wZXJ0aWVzKENsYXNzIGlmYWNlKSB7CiAgICAgICAgc3lu\nY2hyb25pemVkIChfaWZhY2VNYXApIHsKICAgICAgICAgICAgTWFwIGZpZWxk\ncyA9IChNYXApIF9pZmFjZU1hcC5nZXQoaWZhY2UpOwogICAgICAgICAgICBp\nZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gRU1Q\nVFlfU1RSSU5HX0FSUkFZOwogICAgICAgICAgICByZXR1cm4gKFN0cmluZ1td\nKSBmaWVsZHMua2V5U2V0KCkudG9BcnJheSgKICAgICAgICAgICAgICAgIG5l\ndyBTdHJpbmdbZmllbGRzLnNpemUoKV0pOwogICAgICAgIH0KICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiBmaWVsZHMg\ndGhhdCB1c2UgaW1wbCBvciBpbnRlcm1lZGlhdGUgZGF0YSwgaW4KICAgICAq\nIG9yZGVyIHRvIGNyZWF0ZSBhIGNvbXBhY3RlZCBhcnJheSBmb3Igc3RvcmFn\nZSBvZiBzYWlkIGRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0RXh0\ncmFGaWVsZERhdGFMZW5ndGgoKSB7CiAgICAgICAgaW50W10gdGFibGUgPSBn\nZXRFeHRyYUZpZWxkRGF0YVRhYmxlKCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIHRhYmxlLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKQogICAgICAgICAgICBp\nZiAodGFibGVbaV0gIT0gLTEpCiAgICAgICAgICAgICAgICByZXR1cm4gdGFi\nbGVbaV0gKyAxOwogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBpbXBsIC8gaW50ZXJtZWRpYXRlIGZpZWxkIGRh\ndGEgaW5kZXggb2YgdGhlIGdpdmVuIGZpZWxkCiAgICAgKiBpbiB0aGUgY29t\ncGFjdGVkIGFycmF5LCBvciAtMSBpZiB0aGUgZmllbGQgZG9lcyBub3QgdXNl\nIGV4dHJhIGRhdGEuCiAgICAgKgogICAgICogQHNlZSAjZ2V0RXh0cmFGaWVs\nZERhdGFMZW5ndGgKICAgICAqLwogICAgcHVibGljIGludCBnZXRFeHRyYUZp\nZWxkRGF0YUluZGV4KGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBnZXRF\neHRyYUZpZWxkRGF0YVRhYmxlKClbZmllbGRdOwogICAgfQoKICAgIC8qKgog\nICAgICogQ3JlYXRlcyBhIHRhYmxlIG1hcHBpbmcgZWFjaCBmaWVsZCBpbmRl\neCB0byBpdHMgZXh0cmEgZGF0YSBpbmRleC4KICAgICAqLwogICAgcHJpdmF0\nZSBpbnRbXSBnZXRFeHRyYUZpZWxkRGF0YVRhYmxlKCkgewogICAgICAgIGlm\nIChfZmllbGREYXRhVGFibGUgPT0gbnVsbCkgewogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZm1kcyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBp\nbnRbXSB0YWJsZSA9IG5ldyBpbnRbZm1kcy5sZW5ndGhdOwogICAgICAgICAg\nICBpbnQgaWR4ID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoZm1k\nc1tpXS51c2VzSW50ZXJtZWRpYXRlKCkKICAgICAgICAgICAgICAgICAgICB8\nfCBmbWRzW2ldLnVzZXNJbXBsRGF0YSgpICE9IEJvb2xlYW4uRkFMU0UpCiAg\nICAgICAgICAgICAgICAgICAgdGFibGVbaV0gPSBpZHgrKzsKICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB0YWJsZVtpXSA9IC0x\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9maWVsZERhdGFUYWJsZSA9\nIHRhYmxlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2ZpZWxkRGF0YVRh\nYmxlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhl\nIGdpdmVuIG5hbWUgcmVwcmVzZW50cyBhIG1hbmFnZWQgb3Igc3RhdGljIGZp\nZWxkIG9mCiAgICAgKiB0aGlzIGNsYXNzLCBpbmNsdWRpbmcgc3VwZXJjbGFz\ncyBmaWVsZHMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQWNjZXNz\naWJsZUZpZWxkKFN0cmluZyBmaWVsZCkgewogICAgICAgIGlmIChnZXREZWNs\nYXJlZEZpZWxkKGZpZWxkKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICBpZiAoX3N0YXRpY0ZpZWxkcyA9PSBudWxsKSB7CiAg\nICAgICAgICAgIEZpZWxkW10gZmllbGRzID0gKEZpZWxkW10pIEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIuZ2V0RGVjbGFyZWRGaWVsZHNBY3Rpb24oX3R5cGUpKTsgCiAg\nICAgICAgICAgIFNldCBuYW1lcyA9IG5ldyBIYXNoU2V0KChpbnQpIChmaWVs\nZHMubGVuZ3RoICogMS4zMyArIDEpKTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBpZiAoTW9kaWZpZXIuaXNTdGF0aWMoZmllbGRzW2ldLmdldE1vZGlmaWVy\ncygpKSkKICAgICAgICAgICAgICAgICAgICBuYW1lcy5hZGQoZmllbGRzW2ld\nLmdldE5hbWUoKSk7CiAgICAgICAgICAgIF9zdGF0aWNGaWVsZHMgPSBuYW1l\nczsKICAgICAgICB9CiAgICAgICAgaWYgKF9zdGF0aWNGaWVsZHMuY29udGFp\nbnMoZmllbGQpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBp\nZiAoX3N1cGVyICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpLmlzQWNjZXNzaWJsZUZpZWxkKGZpZWxkKTsK\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYWxsIGZpZWxkIG1ldGFkYXRhcywgaW5jbHVkaW5nIHN1cGVyY2xh\nc3MgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtd\nIGdldEZpZWxkcygpIHsKICAgICAgICBpZiAoX2FsbEZpZWxkcyA9PSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChfc3VwZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9hbGxGaWVsZHMgPSBnZXREZWNsYXJlZEZpZWxkcygpOwogICAg\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBmaWVsZHMgPSBnZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIHN1cEZpZWxkcyA9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0RmllbGRzKCk7\nCgogICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGFsbEZpZWxkcyA9\nIF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkKICAgICAgICAgICAgICAg\nICAgICAoZmllbGRzLmxlbmd0aCArIHN1cEZpZWxkcy5sZW5ndGgpOwogICAg\nICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShzdXBGaWVsZHMsIDAsIGFs\nbEZpZWxkcywgMCwgc3VwRmllbGRzLmxlbmd0aCk7CiAgICAgICAgICAgICAg\nICByZXBsYWNlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMoYWxsRmllbGRzLCBz\ndXBGaWVsZHMubGVuZ3RoKTsKCiAgICAgICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAg\nICAgICAgIGZpZWxkc1tpXS5zZXRJbmRleChzdXBGaWVsZHMubGVuZ3RoICsg\naSk7CiAgICAgICAgICAgICAgICAgICAgYWxsRmllbGRzW3N1cEZpZWxkcy5s\nZW5ndGggKyBpXSA9IGZpZWxkc1tpXTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIF9hbGxGaWVsZHMgPSBhbGxGaWVsZHM7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9hbGxGaWVsZHM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlIHN1cGVyY2xhc3MgZmllbGRz\nIHRoYXQgd2UgZGVmaW5lIHdpdGggb3VyIHZlcnNpb24uCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCByZXBsYWNlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMo\nRmllbGRNZXRhRGF0YVtdIGZpZWxkcywKICAgICAgICBpbnQgbGVuKSB7CiAg\nICAgICAgaWYgKF9zdXBGaWVsZE1hcCA9PSBudWxsIHx8ICFfZGVmU3VwRmll\nbGRzKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGRvbid0IGFz\nc3VtZSBmaWVsZHMgYXJlIGluIG9yZGVyOyB0aGlzIG1ldGhvZCBpcyB1c2Vk\nIGZvcgogICAgICAgIC8vIGxpc3Rpbmcgb3JkZXIgYXMgd2VsbAogICAgICAg\nIEZpZWxkTWV0YURhdGEgc3VwRmllbGQ7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBzdXBGaWVsZCA9IChG\naWVsZE1ldGFEYXRhKSBfc3VwRmllbGRNYXAuZ2V0KGZpZWxkc1tpXS5nZXRO\nYW1lKCkpOwogICAgICAgICAgICBpZiAoc3VwRmllbGQgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgZmllbGRzW2ldID0gc3VwRmllbGQ7CiAgICAgICAg\nICAgICAgICBzdXBGaWVsZC5zZXRJbmRleChpKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc3Vw\nZXJjbGFzcyBjb3B5IG9mIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIEZpZWxkTWV0YURhdGEgZ2V0U3VwZXJjbGFzc0ZpZWxkKEZp\nZWxkTWV0YURhdGEgc3VwRmllbGQpIHsKICAgICAgICBDbGFzc01ldGFEYXRh\nIHNtID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCA9IHNtID09IG51bGwgPyBudWxsIDogc20uZ2V0Rmll\nbGQoc3VwRmllbGQuZ2V0TmFtZSgpKTsKICAgICAgICBpZiAoZm1kID09IG51\nbGwgfHwgZm1kLmdldE1hbmFnZW1lbnQoKSAhPSBmbWQuTUFOQUdFX1BFUlNJ\nU1RFTlQpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgidW5tYW5hZ2VkLXN1cC1maWVsZCIsCiAgICAgICAgICAg\nICAgICBzdXBGaWVsZCwgdGhpcykpOwogICAgICAgIHJldHVybiBmbWQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gb25seSB0aGUgZmllbGRzIGZv\nciB0aGlzIGNsYXNzLCB3aXRob3V0IHN1cGVyY2xhc3MgZmllbGRzLgogICAg\nICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldERlY2xhcmVkRmll\nbGRzKCkgewogICAgICAgIGlmIChfZmllbGRzID09IG51bGwpIHsKICAgICAg\nICAgICAgTGlzdCBmaWVsZHMgPSBuZXcgQXJyYXlMaXN0KF9maWVsZE1hcC5z\naXplKCkpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZDsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZmllbGRNYXAudmFsdWVzKCku\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nIGZtZCA9IChGaWVsZE1ldGFEYXRhKSBpdHIubmV4dCgpOwogICAgICAgICAg\nICAgICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0\nYS5NQU5BR0VfTk9ORSkgewogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRE\nZWNsYXJlZEluZGV4KGZpZWxkcy5zaXplKCkpOwogICAgICAgICAgICAgICAg\nICAgIGZtZC5zZXRJbmRleChmbWQuZ2V0RGVjbGFyZWRJbmRleCgpKTsKICAg\nICAgICAgICAgICAgICAgICBmaWVsZHMuYWRkKGZtZCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2ZpZWxkcyA9IChG\naWVsZE1ldGFEYXRhW10pIGZpZWxkcy50b0FycmF5CiAgICAgICAgICAgICAg\nICAoX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheShmaWVsZHMuc2l6ZSgp\nKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZmllbGRzOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHByaW1hcnkga2V5IGZpZWxkcywgb3Ig\nZW1wdHkgYXJyYXkgaWYgbm9uZS4gVGhlIG9yZGVyCiAgICAgKiBpbiB3aGlj\naCB0aGUga2V5cyBhcmUgcmV0dXJuZWQgd2lsbCBiZSB0aGUgb3JkZXIgaW4g\nd2hpY2gKICAgICAqIHRoZSBmaWVsZHMgYXJlIGRlY2xhcmVkLCBzdGFydGlu\nZyBhdCB0aGUgbGVhc3QtZGVyaXZlZCBzdXBlcmNsYXNzCiAgICAgKiBhbmQg\nZW5kaW5nIHdpdGggdGhlIHByaW1hcnkga2V5IGZpZWxkcyBvZiB0aGUgbW9z\ndC1kZXJpdmVkIHN1YmNsYXNzLgogICAgICovCiAgICBwdWJsaWMgRmllbGRN\nZXRhRGF0YVtdIGdldFByaW1hcnlLZXlGaWVsZHMoKSB7CiAgICAgICAgLy8g\nY2hlY2sgZm9yIHBrIGZpZWxkcyBldmVuIGlmIG5vdCBzZXQgdG8gSURfQVBQ\nTElDQVRJT04gc28gdGhhdAogICAgICAgIC8vIGFwcCBpZCB0b29sIHNlZXMg\ndGhlbSBldmVuIHdoZW4gdXNlciBkb2Vzbid0IGRlY2xhcmUgYXBwIGlkCiAg\nICAgICAgaWYgKF9hbGxQS0ZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAg\nICAgICAgaW50IG51bSA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYg\nKGZpZWxkc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAgICAg\nICBudW0rKzsKCiAgICAgICAgICAgIGlmIChudW0gPT0gMCkKICAgICAgICAg\nICAgICAgIF9hbGxQS0ZpZWxkcyA9IF9yZXBvcy5FTVBUWV9GSUVMRFM7CiAg\nICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIHBrcyA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkobnVtKTsK\nICAgICAgICAgICAgICAgIG51bSA9IDA7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNQcmltYXJ5S2V5KCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzW2ldLnNldFByaW1hcnlL\nZXlJbmRleChudW0pOwogICAgICAgICAgICAgICAgICAgICAgICBwa3NbbnVt\nXSA9IGZpZWxkc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgbnVtKys7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgX2FsbFBLRmllbGRzID0gcGtzOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWxsUEtGaWVsZHM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGxpc3Qgb2YgZmllbGRzIGlu\nIHRoZSBkZWZhdWx0IGZldGNoIGdyb3VwLAogICAgICogaW5jbHVkaW5nIHN1\ncGVyY2xhc3MgZmllbGRzLCBvciBhbiBlbXB0eSBhcnJheSBpZiBub25lLgog\nICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldERlZmF1bHRG\nZXRjaEdyb3VwRmllbGRzKCkgewogICAgICAgIGlmIChfYWxsREZHRmllbGRz\nID09IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxk\ncyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBpbnQgbnVtID0gMDsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgICAgICBpZiAoZmllbGRzW2ldLmlzSW5EZWZhdWx0\nRmV0Y2hHcm91cCgpKQogICAgICAgICAgICAgICAgICAgIG51bSsrOwoKICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGRmZ3MgPSBfcmVwb3MubmV3Rmll\nbGRNZXRhRGF0YUFycmF5KG51bSk7CiAgICAgICAgICAgIG51bSA9IDA7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc0luRGVmYXVs\ndEZldGNoR3JvdXAoKSkKICAgICAgICAgICAgICAgICAgICBkZmdzW251bSsr\nXSA9IGZpZWxkc1tpXTsKICAgICAgICAgICAgX2FsbERGR0ZpZWxkcyA9IGRm\nZ3M7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWxsREZHRmllbGRzOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2ZXJzaW9uIGZpZWxk\nIGZvciB0aGlzIGNsYXNzLCBpZiBhbnkuCiAgICAgKi8KICAgIHB1YmxpYyBG\naWVsZE1ldGFEYXRhIGdldFZlcnNpb25GaWVsZCgpIHsKICAgICAgICBpZiAo\nX3ZlcnNpb25JZHggPT0gSW50ZWdlci5NSU5fVkFMVUUpIHsKICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAg\nICAgICAgICBpbnQgaWR4ID0gLTE7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAoZmllbGRzW2ldLmlzVmVyc2lvbigpKSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGlkeCAhPSAtMSkKICAgICAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAoIm11bHQtdmVycy1maWVsZHMiLCB0aGlz\nLCBmaWVsZHNbaWR4XSwgZmllbGRzW2ldKSk7CiAgICAgICAgICAgICAgICAg\nICAgaWR4ID0gaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgICAgICBfdmVyc2lvbklkeCA9IGlkeDsKICAgICAgICB9CiAgICAg\nICAgaWYgKF92ZXJzaW9uSWR4ID09IC0xKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICByZXR1cm4gZ2V0RmllbGRzKClbX3ZlcnNpb25JZHhd\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBm\nb3IgdGhlIHBlcnNpc3RlbnQgb3IgdHJhbnNhY3Rpb25hbCBmaWVsZCB3aXRo\nCiAgICAgKiB0aGUgZ2l2ZW4gYWJzb2x1dGUgaW5kZXguCiAgICAgKgogICAg\nICogQHJldHVybiB0aGUgZmllbGQncyBtZXRhZGF0YSwgb3IgbnVsbCBpZiBu\nb3QgZm91bmQKICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0\nRmllbGQoaW50IGluZGV4KSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZp\nZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgIGlmIChpbmRleCA8IDAgfHwg\naW5kZXggPj0gZmllbGRzLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgcmV0dXJuIGZpZWxkc1tpbmRleF07CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgcGVyc2lz\ndGVudCBvciB0cmFuc2FjdGlvbmFsIGZpZWxkIHdpdGgKICAgICAqIHRoZSBn\naXZlbiByZWxhdGl2ZSBpbmRleC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRo\nZSBmaWVsZCdzIG1ldGFkYXRhLCBvciBudWxsIGlmIG5vdCBmb3VuZAogICAg\nICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXREZWNsYXJlZEZpZWxk\nKGludCBpbmRleCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMg\nPSBnZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGlmIChpbmRleCA8IDAg\nfHwgaW5kZXggPj0gZmllbGRzLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgcmV0dXJuIGZpZWxkc1tpbmRleF07CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgcGVy\nc2lzdGVudCBvciB0cmFuc2FjdGlvbmFsIGZpZWxkIHdpdGgKICAgICAqIHRo\nZSBnaXZlbiBuYW1lLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpZWxk\nJ3MgbWV0YWRhdGEsIG9yIG51bGwgaWYgbm90IGZvdW5kCiAgICAgKi8KICAg\nIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldEZpZWxkKFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBnZXREZWNsYXJlZEZpZWxk\nKG5hbWUpOwogICAgICAgIGlmIChmbWQgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGZtZDsKICAgICAgICBpZiAoX3N1cEZpZWxkTWFwICE9IG51bGwg\nJiYgX2RlZlN1cEZpZWxkcykgewogICAgICAgICAgICBmbWQgPSAoRmllbGRN\nZXRhRGF0YSkgX3N1cEZpZWxkTWFwLmdldChuYW1lKTsKICAgICAgICAgICAg\naWYgKGZtZCAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZtZDsK\nICAgICAgICB9CiAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXRGaWVs\nZChuYW1lKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBwZXJzaXN0ZW50\nIG9yIHRyYW5zYWN0aW9uYWwgZmllbGQgd2l0aAogICAgICogdGhlIGdpdmVu\nIG5hbWUsIHdpdGhvdXQgaW5jbHVkaW5nIHN1cGVyY2xhc3MgZmllbGRzLgog\nICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpZWxkJ3MgbWV0YWRhdGEsIG9y\nIG51bGwgaWYgbm90IGZvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1l\ndGFEYXRhIGdldERlY2xhcmVkRmllbGQoU3RyaW5nIG5hbWUpIHsKICAgICAg\nICBGaWVsZE1ldGFEYXRhIGZpZWxkID0gKEZpZWxkTWV0YURhdGEpIF9maWVs\nZE1hcC5nZXQobmFtZSk7CiAgICAgICAgaWYgKGZpZWxkID09IG51bGwgfHwg\nZmllbGQuZ2V0TWFuYWdlbWVudCgpID09IGZpZWxkLk1BTkFHRV9OT05FKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZmllbGQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW55IGZpZWxkcyB0aGF0\nIHdlcmUgYWRkZWQgYXMgbm9uLW1hbmFnZWQuCiAgICAgKiBBbGwgb3RoZXIg\nbWV0aG9kcyB0byBnZXQgZmllbGRzIHJldHVybiBvbmx5IHRob3NlIHRoYXQg\nYXJlIG1hbmFnZWQuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRh\nW10gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVsZHMoKSB7CiAgICAgICAgaWYg\nKF91bm1nZEZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIENvbGxlY3Rp\nb24gdW5tYW5hZ2VkID0gbmV3IEFycmF5TGlzdCgzKTsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSBmaWVsZDsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBfZmllbGRNYXAudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGZpZWxkID0gKEZpZWxkTWV0\nYURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGQu\nZ2V0TWFuYWdlbWVudCgpID09IEZpZWxkTWV0YURhdGEuTUFOQUdFX05PTkUp\nCiAgICAgICAgICAgICAgICAgICAgdW5tYW5hZ2VkLmFkZChmaWVsZCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgX3VubWdkRmllbGRzID0gKEZpZWxk\nTWV0YURhdGFbXSkgdW5tYW5hZ2VkLnRvQXJyYXkKICAgICAgICAgICAgICAg\nIChfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFycmF5KHVubWFuYWdlZC5zaXpl\nKCkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF91bm1nZEZpZWxkczsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIG5ldyBmaWVsZCBtZXRhZGF0\nYSB0byB0aGlzIGNsYXNzLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRh\nRGF0YSBhZGREZWNsYXJlZEZpZWxkKFN0cmluZyBuYW1lLCBDbGFzcyB0eXBl\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfcmVwb3MubmV3Rmll\nbGRNZXRhRGF0YShuYW1lLCB0eXBlLCB0aGlzKTsKICAgICAgICBjbGVhckZp\nZWxkQ2FjaGUoKTsKICAgICAgICBfZmllbGRNYXAucHV0KG5hbWUsIGZtZCk7\nCiAgICAgICAgcmV0dXJuIGZtZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nbW92ZSB0aGUgZ2l2ZW4gZmllbGQgZnJvbSBtYW5hZ2VtZW50LgogICAgICoK\nICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZmllbGQgd2FzIHJlbW92ZWQs\nIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBy\nZW1vdmVEZWNsYXJlZEZpZWxkKEZpZWxkTWV0YURhdGEgZmllbGQpIHsKICAg\nICAgICBpZiAoZmllbGQgIT0gbnVsbCAmJiBfZmllbGRNYXAucmVtb3ZlKGZp\nZWxkLmdldE5hbWUoKSkgIT0gbnVsbCkgewogICAgICAgICAgICBjbGVhckZp\nZWxkQ2FjaGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgZGVmaW5lZCBzdXBlcmNsYXNzIGZpZWxkIHdpdGggdGhl\nIGdpdmVuIG5hbWUsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVi\nbGljIEZpZWxkTWV0YURhdGEgZ2V0RGVmaW5lZFN1cGVyY2xhc3NGaWVsZChT\ndHJpbmcgbmFtZSkgewogICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIChG\naWVsZE1ldGFEYXRhKSBfc3VwRmllbGRNYXAuZ2V0KG5hbWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkIGEgbmV3IGRlZmluZWQgc3VwZXJjbGFzcyBm\naWVsZCBtZXRhZGF0YSB0byB0aGlzIGNsYXNzLgogICAgICovCiAgICBwdWJs\naWMgRmllbGRNZXRhRGF0YSBhZGREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKFN0\ncmluZyBuYW1lLCBDbGFzcyB0eXBlLAogICAgICAgIENsYXNzIHN1cCkgewog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX3JlcG9zLm5ld0ZpZWxkTWV0\nYURhdGEobmFtZSwgdHlwZSwgdGhpcyk7CiAgICAgICAgZm1kLnNldERlY2xh\ncmluZ1R5cGUoc3VwKTsKICAgICAgICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsK\nICAgICAgICBfZGVmU3VwRmllbGRzID0gZmFsc2U7CiAgICAgICAgaWYgKF9z\ndXBGaWVsZE1hcCA9PSBudWxsKQogICAgICAgICAgICBfc3VwRmllbGRNYXAg\nPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIF9zdXBGaWVsZE1hcC5wdXQobmFt\nZSwgZm1kKTsKICAgICAgICByZXR1cm4gZm1kOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVtb3ZlIHRoZSBnaXZlbiBmaWVsZCBmcm9tIG1hbmFnZW1lbnQu\nCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBmaWVsZCB3YXMg\ncmVtb3ZlZCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIHJlbW92ZURlZmluZWRTdXBlcmNsYXNzRmllbGQoRmllbGRNZXRh\nRGF0YSBmaWVsZCkgewogICAgICAgIGlmIChmaWVsZCAhPSBudWxsICYmIF9z\ndXBGaWVsZE1hcCAhPSBudWxsCiAgICAgICAgICAgICYmIF9zdXBGaWVsZE1h\ncC5yZW1vdmUoZmllbGQuZ2V0TmFtZSgpKSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAgICAgICAgICBfZGVmU3Vw\nRmllbGRzID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJbmNvcnBvcmF0ZSBzdXBlcmNsYXNzIGZpZWxkcyByZWRlZmluZWQg\naW4gdGhpcyBzdWJjbGFzcyBpbnRvIHRoaXMKICAgICAqIG1ldGFkYXRhLiBU\naGlzIG1ldGhvZCBpcyBnZW5lcmFsbHkgY2FsbGVkIGFmdGVyIG1ldGFkYXRh\nIGlzIHJlc29sdmVkCiAgICAgKiBhbmQgbWFwcGluZyBpbmZvcm1hdGlvbiBp\ncyBsb2FkZWQsIGJ1dCBiZWZvcmUgbWFwcGluZyByZXNvbHZlLgogICAgICoK\nICAgICAqIEBwYXJhbSBmb3JjZSB3aGV0aGVyIHRvIGZvcmNlIHJlLW1hcHBp\nbmcgb2YgZXZlbiBtYXBwZWQgc3VwZXJjbGFzcyBmaWVsZHMKICAgICAqLwog\nICAgcHVibGljIHZvaWQgZGVmaW5lU3VwZXJjbGFzc0ZpZWxkcyhib29sZWFu\nIGZvcmNlKSB7CiAgICAgICAgaWYgKF9kZWZTdXBGaWVsZHMpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChpc01hcHBlZCgp\nICYmIHN1cCAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIHJlZGVmaW5lIGFs\nbCB1bm1hcHBlZCBzdXBlcmNsYXNzIGZpZWxkcwogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gc3VwcyA9IHN1cC5nZXRGaWVsZHMoKTsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdXBzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBpZiAoKGZvcmNlIHx8ICFzdXBzW2ldLmdldERlZmlu\naW5nTWV0YURhdGEoKS5pc01hcHBlZCgpKQogICAgICAgICAgICAgICAgICAg\nICYmIGdldERlZmluZWRTdXBlcmNsYXNzRmllbGQoc3Vwc1tpXS5nZXROYW1l\nKCkpID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBhZGREZWZpbmVk\nU3VwZXJjbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAg\nICAgICAgICAgICAgICBzdXBzW2ldLmdldERlY2xhcmVkVHlwZSgpLCBzdXBz\nW2ldLmdldERlY2xhcmluZ1R5cGUoKSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVzb2x2ZURlZmluZWRT\ndXBlcmNsYXNzRmllbGRzKCk7CgogICAgICAgIC8vIHRoaXMgZW5zdXJlcyB0\naGF0IGFsbCBmaWVsZCBpbmRleGVzIGdldCBzZXQgd2hlbiBmaWVsZHMgYXJl\nIGNhY2hlZC4KICAgICAgICAvLyBJIGRvbid0IGxpa2UgZG9pbmcgdGhpcyB0\nd2ljZSAoaXQncyBhbHNvIGRvbmUgaW4gcmVzb2x2ZU1ldGEpLCBidXQKICAg\nICAgICAvLyB3ZSBoYXZlIHRvIHJlLWNhY2hlIGluIGNhc2UgdGhpcyBjbGFz\ncyBvciBhbnkgc3VwZXJjbGFzcyByZXBsYWNlZAogICAgICAgIC8vIHNvbWUg\nZmllbGRzIHdpdGggcmVkZWZpbmVkIHZlcnNpb25zLCBhbmQgSSBkb24ndCB3\nYW50IG91dHNpZGUgY29kZQogICAgICAgIC8vIHRvIGhhdmUgdG8gY2FsbCB0\naGlzIG1ldGhvZCBhZnRlciByZXNvbHZlIGp1c3QgdG8gZ2V0IGZpZWxkIGlu\nZGV4ZXMsCiAgICAgICAgLy8gZXRjIHNldCBjb3JyZWN0bHkKICAgICAgICBj\nbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICBjYWNoZUZpZWxkcygpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBzdXBlcmNsYXNzIGZpZWxk\ncyB3ZSd2ZSByZWRlZmluZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBy\nZXNvbHZlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMoKSB7CiAgICAgICAgX2Rl\nZlN1cEZpZWxkcyA9IHRydWU7CiAgICAgICAgaWYgKF9zdXBGaWVsZE1hcCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kOwogICAgICAgIEZpZWxkTWV0YURhdGEgc3VwOwogICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gX3N1cEZpZWxkTWFwLnZhbHVlcygpLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGZtZCA9\nIChGaWVsZE1ldGFEYXRhKSBpdHIubmV4dCgpOwogICAgICAgICAgICBzdXAg\nPSBnZXRTdXBlcmNsYXNzRmllbGQoZm1kKTsKCiAgICAgICAgICAgIC8vIGpw\nYSBtZXRhZGF0YSBkb2Vzbid0IHF1YWxpZnkgc3VwZXJjbGFzcyBmaWVsZCBu\nYW1lcywgc28gd2UKICAgICAgICAgICAgLy8gbWlnaHQgbm90IGtub3cgdGhl\nIGRlY2xhcmluZyB0eXBlIHVudGlsIG5vdwogICAgICAgICAgICBpZiAoZm1k\nLmdldERlY2xhcmluZ1R5cGUoKSA9PSBPYmplY3QuY2xhc3MpIHsKICAgICAg\nICAgICAgICAgIGZtZC5zZXREZWNsYXJpbmdUeXBlKHN1cC5nZXREZWNsYXJp\nbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgZm1kLmJhY2tpbmdNZW1iZXIo\nZ2V0UmVwb3NpdG9yeSgpLmdldE1ldGFEYXRhRmFjdG9yeSgpLgogICAgICAg\nICAgICAgICAgICAgIGdldERlZmF1bHRzKCkuZ2V0QmFja2luZ01lbWJlcihm\nbWQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbWQuY29weShzdXAp\nOwogICAgICAgICAgICBmbWQucmVzb2x2ZShNT0RFX01FVEEpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gYXJyYXkgb2Yg\nYWxsIHRoZSBmaWVsZHMgZGVmaW5lZCBieSB0aGlzIGNsYXNzLgogICAgICog\nVGhpcyBpbmNsdWRlcyBtYXBwZWQgZGVjbGFyZWQgZmllbGRzIGFuZCBhbnkg\nY29uY3JldGUgbWFwcGluZyBvZgogICAgICogdW5tYXBwZWQgc3VwZXJjbGFz\ncyBmaWVsZHMgcGVyZm9ybWVkIGJ5IHRoaXMgY2xhc3MuCiAgICAgKi8KICAg\nIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVmaW5lZEZpZWxkcygpIHsK\nICAgICAgICBpZiAoX2RlZmluZWRGaWVsZHMgPT0gbnVsbCkgewogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RmllbGRzKCk7CiAg\nICAgICAgICAgIExpc3QgZGVmaW5lZCA9IG5ldyBBcnJheUxpc3QoZmllbGRz\nLmxlbmd0aCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmll\nbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoZmllbGRz\nW2ldLmlzTWFwcGVkKCkKICAgICAgICAgICAgICAgICAgICAmJiBmaWVsZHNb\naV0uZ2V0RGVmaW5pbmdNZXRhRGF0YSgpID09IHRoaXMpCiAgICAgICAgICAg\nICAgICAgICAgZGVmaW5lZC5hZGQoZmllbGRzW2ldKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBfZGVmaW5lZEZpZWxkcyA9IChGaWVsZE1ldGFEYXRh\nW10pIGRlZmluZWQudG9BcnJheQogICAgICAgICAgICAgICAgKF9yZXBvcy5u\nZXdGaWVsZE1ldGFEYXRhQXJyYXkoZGVmaW5lZC5zaXplKCkpKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIF9kZWZpbmVkRmllbGRzOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJucyBhbGwgZmllbGRzIGluIHRoZSBvcmRlciB0\naGV5IGFyZSBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRhCiAgICAgKiBmaWxlLiBV\nbmxpc3RlZCBmaWVsZHMgYXJlIHBsYWNlZCBhZnRlciBsaXN0ZWQgb25lcy4K\nICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXRGaWVsZHNJ\nbkxpc3RpbmdPcmRlcigpIHsKICAgICAgICBpZiAoX2FsbExpc3RpbmdGaWVs\nZHMgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBjb21iaW5lIGRlY2xhcmVk\nIGFuZCB1bm1hbmFnZWQgZmllbGRzIGludG8gbGlzdGluZyBvcmRlciBhcnJh\neQogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZGVjID0gZ2V0RGVjbGFy\nZWRGaWVsZHMoKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHVubWdk\nID0gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVsZHMoKTsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGRlY0xpc3RpbmcgPSBfcmVwb3MubmV3RmllbGRN\nZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAgICAoZGVjLmxlbmd0aCArIHVu\nbWdkLmxlbmd0aCk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoZGVj\nLCAwLCBkZWNMaXN0aW5nLCAwLCBkZWMubGVuZ3RoKTsKICAgICAgICAgICAg\nU3lzdGVtLmFycmF5Y29weSh1bm1nZCwgMCwgZGVjTGlzdGluZywgZGVjLmxl\nbmd0aCwgdW5tZ2QubGVuZ3RoKTsKICAgICAgICAgICAgQXJyYXlzLnNvcnQo\nZGVjTGlzdGluZywgTGlzdGluZ09yZGVyQ29tcGFyYXRvci5nZXRJbnN0YW5j\nZSgpKTsKCiAgICAgICAgICAgIGlmIChfc3VwZXIgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9hbGxMaXN0aW5nRmllbGRzID0gZGVjTGlzdGluZzsKICAg\nICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBwbGFjZSBzdXBl\ncmNsYXNzIGZpZWxkcyBpbiBsaXN0aW5nIG9yZGVyIGJlZm9yZSBvdXIKICAg\nICAgICAgICAgICAgIC8vIGxpc3Rpbmctb3JkZXIgZGVjbGFyZWQgZmllbGRz\nCiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gc3VwID0gZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKS4KICAgICAgICAgICAgICAgICAgICBnZXRG\naWVsZHNJbkxpc3RpbmdPcmRlcigpOwogICAgICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGxpc3RpbmcgPSBfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFy\ncmF5CiAgICAgICAgICAgICAgICAgICAgKHN1cC5sZW5ndGggKyBkZWNMaXN0\naW5nLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5\nKHN1cCwgMCwgbGlzdGluZywgMCwgc3VwLmxlbmd0aCk7CiAgICAgICAgICAg\nICAgICByZXBsYWNlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMobGlzdGluZywg\nc3VwLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5\nKGRlY0xpc3RpbmcsIDAsIGxpc3RpbmcsIHN1cC5sZW5ndGgsCiAgICAgICAg\nICAgICAgICAgICAgZGVjTGlzdGluZy5sZW5ndGgpOwogICAgICAgICAgICAg\nICAgX2FsbExpc3RpbmdGaWVsZHMgPSBsaXN0aW5nOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWxsTGlzdGluZ0ZpZWxkczsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIGZpZWxkcyBkZWZp\nbmVkIGJ5IHRoaXMgY2xhc3MgaW4gdGhlIG9yZGVyIHRoZXkgYXJlIGxpc3Rl\nZAogICAgICogaW4gdGhlIG1ldGFkYXRhIGZpbGUuIFVubGlzdGVkIGZpZWxk\ncyBhcmUgcGxhY2VkIGFmdGVyIGxpc3RlZCBvbmVzLgogICAgICogVGhpcyBh\ncnJheSBpbmNsdWRlcyBkZWNsYXJlZCB0cmFuc2FjdGlvbmFsIGFuZCB1bm1h\nbmFnZWQgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0\nYVtdIGdldERlZmluZWRGaWVsZHNJbkxpc3RpbmdPcmRlcigpIHsKICAgICAg\nICBpZiAoX2xpc3RpbmdGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBG\naWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RmllbGRzKCk7CiAgICAgICAg\nICAgIExpc3QgZGVmaW5lZCA9IG5ldyBBcnJheUxpc3QoZmllbGRzLmxlbmd0\naCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5nZXRE\nZWZpbmluZ01ldGFEYXRhKCkgPT0gdGhpcykKICAgICAgICAgICAgICAgICAg\nICBkZWZpbmVkLmFkZChmaWVsZHNbaV0pOwogICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gdW5tZ2QgPSBnZXREZWNsYXJlZFVubWFuYWdlZEZpZWxkcygp\nOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gbGlzdGluZyA9IF9yZXBv\ncy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkKICAgICAgICAgICAgICAgIChkZWZp\nbmVkLnNpemUoKSArIHVubWdkLmxlbmd0aCk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZGVmaW5lZC5zaXplKCk7IGkrKykKICAgICAgICAg\nICAgICAgIGxpc3RpbmdbaV0gPSAoRmllbGRNZXRhRGF0YSkgZGVmaW5lZC5n\nZXQoaSk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkodW5tZ2QsIDAs\nIGxpc3RpbmcsIGRlZmluZWQuc2l6ZSgpLCB1bm1nZC5sZW5ndGgpOwogICAg\nICAgICAgICBBcnJheXMuc29ydChsaXN0aW5nLCBMaXN0aW5nT3JkZXJDb21w\nYXJhdG9yLmdldEluc3RhbmNlKCkpOwogICAgICAgICAgICBfbGlzdGluZ0Zp\nZWxkcyA9IGxpc3Rpbmc7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfbGlz\ndGluZ0ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9m\nIHRoZSBkYXRhY2FjaGUgdG8gdXNlIGZvciB0aGlzIGNsYXNzLCBvciBudWxs\nIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0RGF0YUNh\nY2hlTmFtZSgpIHsKICAgICAgICBpZiAoREVGQVVMVF9TVFJJTkcuZXF1YWxz\nKF9jYWNoZU5hbWUpKSB7CiAgICAgICAgICAgIGlmIChfc3VwZXIgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBnZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpLmdldERhdGFDYWNoZU5hbWUoKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgX2NhY2hlTmFtZSA9IERhdGFDYWNoZS5O\nQU1FX0RFRkFVTFQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY2FjaGVO\nYW1lOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBjYWNoZSBuYW1l\nIGZvciB0aGlzIGNsYXNzLiBTZXQgdG8gbnVsbCB0byBkaXNhYmxlIGNhY2hp\nbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERhdGFDYWNoZU5hbWUo\nU3RyaW5nIG5hbWUpIHsKICAgICAgICBfY2FjaGVOYW1lID0gbmFtZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBjYWNoZSB0aW1lb3V0IGZvciB0aGlz\nIGNsYXNzLiAtMSBpbmRpY2F0ZXMgbm8gdGltZW91dC4KICAgICAqLwogICAg\ncHVibGljIGludCBnZXREYXRhQ2FjaGVUaW1lb3V0KCkgewogICAgICAgIGlm\nIChfY2FjaGVUaW1lb3V0ID09IEludGVnZXIuTUlOX1ZBTFVFKSB7CiAgICAg\nICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9j\nYWNoZVRpbWVvdXQgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLgogICAg\nICAgICAgICAgICAgICAgIGdldERhdGFDYWNoZVRpbWVvdXQoKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2NhY2hlVGltZW91dCA9IF9y\nZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICAgICAg\nZ2V0RGF0YUNhY2hlVGltZW91dCgpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2NhY2hlVGltZW91dDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBj\nYWNoZSB0aW1lb3V0IGZvciB0aGlzIGNsYXNzLiAtMSBpbmRpY2F0ZXMgbm8g\ndGltZW91dC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGF0YUNhY2hl\nVGltZW91dChpbnQgdGltZW91dCkgewogICAgICAgIF9jYWNoZVRpbWVvdXQg\nPSB0aW1lb3V0OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBk\nYXRhIGNhY2hlIGZvciB0aGlzIGNsYXNzLCBvciBudWxsIGlmIGl0IGlzIG5v\ndCBjYWNoYWJsZS4KICAgICAqLwogICAgcHVibGljIERhdGFDYWNoZSBnZXRE\nYXRhQ2FjaGUoKSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSBnZXREYXRhQ2Fj\naGVOYW1lKCk7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIF9yZXBvcy5nZXRDb25m\naWd1cmF0aW9uKCkuZ2V0RGF0YUNhY2hlTWFuYWdlckluc3RhbmNlKCkuCiAg\nICAgICAgICAgIGdldERhdGFDYWNoZShuYW1lLCB0cnVlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgaW5zdGFuY2VzIGFyZSBkZXRhY2hhYmxl\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RldGFjaGFibGUoKSB7\nCiAgICAgICAgaWYgKF9kZXRhY2hhYmxlID09IG51bGwpIHsKICAgICAgICAg\nICAgaWYgKF9zdXBlciAhPSBudWxsKQogICAgICAgICAgICAgICAgX2RldGFj\naGFibGUgPSAoZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5pc0RldGFjaGFi\nbGUoKSkKICAgICAgICAgICAgICAgICAgICA/IEJvb2xlYW4uVFJVRSA6IEJv\nb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIF9kZXRhY2hhYmxlID0gQm9vbGVhbi5GQUxTRTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9kZXRhY2hhYmxlLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciBpbnN0YW5jZXMgYXJlIGRldGFjaGFi\nbGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERldGFjaGFibGUoYm9v\nbGVhbiBkZXRhY2hhYmxlKSB7CiAgICAgICAgX2RldGFjaGFibGUgPSAoZGV0\nYWNoYWJsZSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIG5hbWUgb2YgdGhlIGRldGFjaCBzdGF0\nZSBmaWVsZCwgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nIGdldERldGFjaGVkU3RhdGUoKSB7CiAgICAgICAgaWYgKERFRkFV\nTFRfU1RSSU5HLmVxdWFscyhfZGV0YWNoU3RhdGUpKSB7CiAgICAgICAgICAg\nIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5pc0RldGFj\naGFibGUoKSA9PSBpc0RldGFjaGFibGUoKSkKICAgICAgICAgICAgICAgIF9k\nZXRhY2hTdGF0ZSA9IHN1cC5nZXREZXRhY2hlZFN0YXRlKCk7CiAgICAgICAg\nICAgIGVsc2UgewogICAgICAgICAgICAgICAgQm9vbGVhbiB1c2UgPSB1c2Vz\nRGV0YWNoZWRTdGF0ZShTWU5USEVUSUMsIHRydWUpOwogICAgICAgICAgICAg\nICAgX2RldGFjaFN0YXRlID0gKEJvb2xlYW4uRkFMU0UuZXF1YWxzKHVzZSkp\nID8gbnVsbCA6IFNZTlRIRVRJQzsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX2RldGFjaFN0YXRlOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIG5hbWUgb2YgdGhlIGRldGFjaCBzdGF0ZSBmaWVsZCwgb3Ig\nbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREZXRh\nY2hlZFN0YXRlKFN0cmluZyBmaWVsZCkgewogICAgICAgIF9kZXRhY2hTdGF0\nZSA9IGZpZWxkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBk\nZXRhY2ggc3RhdGUgZmllbGQsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwog\nICAgcHVibGljIEZpZWxkIGdldERldGFjaGVkU3RhdGVGaWVsZCgpIHsKICAg\nICAgICAvLyBubyBjYWNoaW5nOyBvbmx5IHVzZWQgYXQgZW5oYW5jZW1lbnQK\nICAgICAgICBTdHJpbmcgZmllbGROYW1lID0gZ2V0RGV0YWNoZWRTdGF0ZSgp\nOwogICAgICAgIGlmIChmaWVsZE5hbWUgPT0gbnVsbCB8fCBTWU5USEVUSUMu\nZXF1YWxzKGZpZWxkTmFtZSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBGaWVsZCBmID0gUmVmbGVjdGlvbi5maW5kRmllbGQoX3R5cGUs\nIGZpZWxkTmFtZSwgZmFsc2UpOwogICAgICAgIGlmIChmICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBmOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKAogICAgICAgICAgICAgICAg\nX2xvYy5nZXQoIm5vLWRldGFjaC1zdGF0ZSIsIGZpZWxkTmFtZSwgX3R5cGUp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgYW4gaW5zdGFuY2Ug\nb2YgdGhpcyB0eXBlIGhhcyBkZXRhY2hlZCBzdGF0ZS4KICAgICAqCiAgICAg\nKiBAcmV0dXJuIHRydWUgaWYgYSBkZXRhY2hlZCBpbnN0YW5jZSBtdXN0IGhh\ndmUgZGV0YWNoZWQgc3RhdGUsIGZhbHNlCiAgICAgKiBpZiBpdCBkb2VzIG5v\ndCwgYW5kIG51bGwgaWYgaXQgbWF5IHVzZSBhCiAgICAgKiBtYW51YWxseS1j\nb25zdHJ1Y3RlZCBpbnN0YW5jZSB3aXRob3V0IGRldGFjaGVkIHN0YXRlCiAg\nICAgKi8KICAgIHB1YmxpYyBCb29sZWFuIHVzZXNEZXRhY2hlZFN0YXRlKCkg\newogICAgICAgIC8vIG5vIG5lZWQgdG8gbGV0IGNvbmYgZGlzYWxsb3cgYmVj\nYXVzZSBpdCdzIHRha2VuIGludG8gYWNjb3VudCBpbgogICAgICAgIC8vIGdl\ndERldGFjaGVkU3RhdGUoKSBjYWxsCiAgICAgICAgcmV0dXJuIHVzZXNEZXRh\nY2hlZFN0YXRlKGdldERldGFjaGVkU3RhdGUoKSwgZmFsc2UpOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciBhbiBpbnN0YW5jZSBvZiB0aGlzIHR5\ncGUgaGFzIGRldGFjaGVkIHN0YXRlLCBhc3N1bWluZyB0aGUgZ2l2ZW4KICAg\nICAqIGRldGFjaGVkIHN0YXRlIGZpZWxkLgogICAgICoKICAgICAqIEByZXR1\ncm4gdHJ1ZSBpZiBhIGRldGFjaGVkIGluc3RhbmNlIG11c3QgaGF2ZSBkZXRh\nY2hlZCBzdGF0ZSwgZmFsc2UKICAgICAqIGlmIGl0IGRvZXMgbm90LCBhbmQg\nbnVsbCBpZiBpdCBtYXkgdXNlIGEKICAgICAqIG1hbnVhbGx5LWNvbnN0cnVj\ndGVkIGluc3RhbmNlIHdpdGhvdXQgZGV0YWNoZWQgc3RhdGUKICAgICAqLwog\nICAgcHJpdmF0ZSBCb29sZWFuIHVzZXNEZXRhY2hlZFN0YXRlKFN0cmluZyBk\nZXRhY2hlZEZpZWxkLAogICAgICAgIGJvb2xlYW4gY29uZkRpc2FsbG93cykg\newogICAgICAgIGlmICghaXNEZXRhY2hhYmxlKCkpCiAgICAgICAgICAgIHJl\ndHVybiBCb29sZWFuLkZBTFNFOwoKICAgICAgICAvLyBpZiB3ZSBkZWNsYXJl\nIGEgZGV0YWNoZWQgc3RhdGUgZmllbGQsIGhhdmUgdG8gdXNlIGl0CiAgICAg\nICAgaWYgKGRldGFjaGVkRmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgaWYgKCFTWU5USEVUSUMuZXF1\nYWxzKGRldGFjaGVkRmllbGQpKQogICAgICAgICAgICByZXR1cm4gQm9vbGVh\nbi5UUlVFOwoKICAgICAgICAvLyBhbGxvdyBjb25mIHRvIGRpc2FsbG93CiAg\nICAgICAgaWYgKGNvbmZEaXNhbGxvd3MgJiYgIV9yZXBvcy5nZXRDb25maWd1\ncmF0aW9uKCkuCiAgICAgICAgICAgIGdldERldGFjaFN0YXRlSW5zdGFuY2Uo\nKS5nZXREZXRhY2hlZFN0YXRlRmllbGQoKSkKICAgICAgICAgICAgcmV0dXJu\nIEJvb2xlYW4uRkFMU0U7CgogICAgICAgIC8vIGhhdmUgdG8gdXNlIGRldGFj\naGVkIHN0YXRlIHRvIHN0b3JlIGRhdGFzdG9yZSBpZAogICAgICAgIGlmIChn\nZXRJZGVudGl0eVR5cGUoKSA9PSBJRF9EQVRBU1RPUkUpCiAgICAgICAgICAg\nIHJldHVybiBCb29sZWFuLlRSVUU7CgogICAgICAgIC8vIGFsbG93IGRldGFj\naGVkIHN0YXRlIHVzZSwgYnV0IGRvbid0IHJlcXVpcmUKICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGNhY2hlZCBm\naWVsZCBkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhckFs\nbEZpZWxkQ2FjaGUoKSB7CiAgICAgICAgX2FsbEZpZWxkcyA9IG51bGw7CiAg\nICAgICAgX2FsbERGR0ZpZWxkcyA9IG51bGw7CiAgICAgICAgX2FsbFBLRmll\nbGRzID0gbnVsbDsKICAgICAgICBfZGVmaW5lZEZpZWxkcyA9IG51bGw7CiAg\nICAgICAgX2xpc3RpbmdGaWVsZHMgPSBudWxsOwogICAgICAgIF9hbGxMaXN0\naW5nRmllbGRzID0gbnVsbDsKICAgICAgICBfZmllbGREYXRhVGFibGUgPSBu\ndWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgZGVmaW5lZCBmaWVs\nZCBkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhckRlZmlu\nZWRGaWVsZENhY2hlKCkgewogICAgICAgIF9kZWZpbmVkRmllbGRzID0gbnVs\nbDsKICAgICAgICBfbGlzdGluZ0ZpZWxkcyA9IG51bGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDbGVhciBjYWNoZWQgZmllbGQgZGF0YS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJGaWVsZENhY2hlKCkgewogICAgICAg\nIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAgICAgIF9maWVsZHMgPSBudWxs\nOwogICAgICAgIF91bm1nZEZpZWxkcyA9IG51bGw7CiAgICAgICAgX3ZlcnNp\nb25JZHggPSBJbnRlZ2VyLk1JTl9WQUxVRTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENsZWFyIGNhY2hlZCBzdWJjbGFzcyBkYXRhLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBjbGVhclN1YmNsYXNzQ2FjaGUoKSB7CiAgICAgICAg\nX3N1YnMgPSBudWxsOwogICAgICAgIF9zdWJNZXRhcyA9IG51bGw7CiAgICAg\nICAgX21hcFN1Yk1ldGFzID0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIENsZWFyIGltcGwgZGF0YSBhbmQgaW50ZXJtZWRpYXRlIGRhdGEgdGFibGUu\nCiAgICAgKi8KICAgIHZvaWQgY2xlYXJFeHRyYUZpZWxkRGF0YVRhYmxlKCkg\newogICAgICAgIF9maWVsZERhdGFUYWJsZSA9IG51bGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDYWNoZSBmaWVsZCBhcnJheXMuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBjYWNoZUZpZWxkcygpIHsKICAgICAgICBnZXRGaWVsZHMo\nKTsKICAgICAgICBnZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICB9CgogICAg\ncHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICByZXR1cm4gX3R5cGUu\nZ2V0TmFtZSgpLmhhc2hDb2RlKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9\nPSB0aGlzKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAo\nIShvdGhlciBpbnN0YW5jZW9mIENsYXNzTWV0YURhdGEpKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF90eXBlID09ICgoQ2xh\nc3NNZXRhRGF0YSkgb3RoZXIpLmdldERlc2NyaWJlZFR5cGUoKTsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IGNvbXBhcmVUbyhPYmplY3Qgb3RoZXIpIHsKICAg\nICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgcmV0dXJuIDA7\nCiAgICAgICAgcmV0dXJuIF90eXBlLmdldE5hbWUoKS5jb21wYXJlVG8oKChD\nbGFzc01ldGFEYXRhKSBvdGhlcikuCiAgICAgICAgICAgIGdldERlc2NyaWJl\nZFR5cGUoKS5nZXROYW1lKCkpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcg\ndG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIGdldERlc2NyaWJlZFR5cGUo\nKS5nZXROYW1lKCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBSZXNvbHZlIGFuZCB2YWxpZGF0ZQogICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBUaGUgcmVzb2x2ZSBt\nb2RlIGZvciB0aGlzIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldFJlc29sdmUoKSB7CiAgICAgICAgcmV0dXJuIF9yZXNNb2RlOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIHJlc29sdmUgbW9kZSBmb3IgdGhpcyBt\nZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVzb2x2ZShp\nbnQgbW9kZSkgewogICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSByZXNvbHZlIG1vZGUgZm9yIHRoaXMgbWV0YWRh\ndGEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc29sdmUoaW50IG1v\nZGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAobW9kZSA9PSBNT0RFX05P\nTkUpCiAgICAgICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgICAgICBlbHNl\nIGlmIChvbikKICAgICAgICAgICAgX3Jlc01vZGUgfD0gbW9kZTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIF9yZXNNb2RlICY9IH5tb2RlOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVzb2x2ZSBhbmQgdmFsaWRhdGUgbWV0YWRhdGEu\nIFJldHVybiB0cnVlIGlmIGFscmVhZHkgcmVzb2x2ZWQuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIHJlc29sdmUoaW50IG1vZGUpIHsKICAgICAgICBp\nZiAoKF9yZXNNb2RlICYgbW9kZSkgPT0gbW9kZSkKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgaW50IGN1ciA9IF9yZXNNb2RlOwogICAgICAg\nIF9yZXNNb2RlIHw9IG1vZGU7CgogICAgICAgIGludCB2YWwgPSBfcmVwb3Mu\nZ2V0VmFsaWRhdGUoKTsKICAgICAgICBib29sZWFuIHJ1bnRpbWUgPSAodmFs\nICYgX3JlcG9zLlZBTElEQVRFX1JVTlRJTUUpICE9IDA7CiAgICAgICAgYm9v\nbGVhbiB2YWxpZGF0ZSA9CiAgICAgICAgICAgICFJbXBsSGVscGVyLmlzTWFu\nYWdlZFR5cGUoZ2V0UmVwb3NpdG9yeSgpLmdldENvbmZpZ3VyYXRpb24oKSwg\nX3R5cGUpCiAgICAgICAgICAgIHx8ICh2YWwgJiBNZXRhRGF0YVJlcG9zaXRv\ncnkuVkFMSURBVEVfVU5FTkhBTkNFRCkgPT0gMDsKCiAgICAgICAgLy8gd2Ug\nb25seSBkbyBhbnkgYWN0aW9ucyBmb3IgbWV0YWRhdGEgbW9kZQogICAgICAg\nIGlmICgobW9kZSAmIE1PREVfTUVUQSkgIT0gMCAmJiAoY3VyICYgTU9ERV9N\nRVRBKSA9PSAwKSB7CiAgICAgICAgICAgIHJlc29sdmVNZXRhKHJ1bnRpbWUp\nOwogICAgICAgICAgICBpZiAodmFsaWRhdGUgJiYgKHZhbCAmIF9yZXBvcy5W\nQUxJREFURV9NRVRBKSAhPSAwKQogICAgICAgICAgICAgICAgdmFsaWRhdGVN\nZXRhKHJ1bnRpbWUpOwogICAgICAgIH0KICAgICAgICBpZiAoKG1vZGUgJiBN\nT0RFX01BUFBJTkcpICE9IDAgJiYgKGN1ciAmIE1PREVfTUFQUElORykgPT0g\nMCkgewogICAgICAgICAgICByZXNvbHZlTWFwcGluZyhydW50aW1lKTsKICAg\nICAgICAgICAgaWYgKHZhbGlkYXRlICYmICh2YWwgJiBfcmVwb3MuVkFMSURB\nVEVfTUFQUElORykgIT0gMCkKICAgICAgICAgICAgICAgIHZhbGlkYXRlTWFw\ncGluZyhydW50aW1lKTsKICAgICAgICB9CiAgICAgICAgaWYgKChtb2RlICYg\nTU9ERV9NQVBQSU5HX0lOSVQpICE9IDAgJiYgKGN1ciAmIE1PREVfTUFQUElO\nR19JTklUKSA9PSAwKQogICAgICAgICAgICBpbml0aWFsaXplTWFwcGluZygp\nOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlc29sdmUgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIHJlc29sdmVNZXRhKGJvb2xlYW4gcnVudGltZSkgewogICAgICAgIGJvb2xl\nYW4gZW1iZWQgPSBfb3duZXIgIT0gbnVsbCAmJiBfb3duZXIuZ2V0RGVjbGFy\nZWRUeXBlKCkgPT0gX3R5cGU7CiAgICAgICAgTG9nIGxvZyA9IF9yZXBvcy5n\nZXRMb2coKTsKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgoZW1iZWQpID8gInJlc29s\ndmUtZW1iZWQtbWV0YSIgOiAicmVzb2x2ZS1tZXRhIiwKICAgICAgICAgICAg\nICAgIHRoaXMgKyAiQCIgKyBTeXN0ZW0uaWRlbnRpdHlIYXNoQ29kZSh0aGlz\nKSkpOwoKICAgICAgICBpZiAocnVudGltZSAmJiAhX3R5cGUuaXNJbnRlcmZh\nY2UoKSAmJgogICAgICAgICAgICAhSW1wbEhlbHBlci5pc01hbmFnZWRUeXBl\nKGdldFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCksX3R5cGUpKQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vdC1lbmhhbmNlZCIsIF90eXBlKSk7CgogICAgICAgIC8vIGFyZSB3\nZSB0aGUgdGFyZ2V0IG9mIGFuIGVtYmVkZGVkIHZhbHVlPwogICAgICAgIGlm\nIChlbWJlZCkgewogICAgICAgICAgICBpZiAoX293bmVyLmdldEZpZWxkTWV0\nYURhdGEoKS5nZXREZWZpbmluZ01ldGFEYXRhKCkuCiAgICAgICAgICAgICAg\nICBnZXREZXNjcmliZWRUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShfdHlwZSkp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoInJlY3Vyc2UtZW1iZWQiLCBfb3duZXIpKTsKCiAgICAgICAg\nICAgIC8vIGNvcHkgaW5mbyBmcm9tIHRoZSAicmVhbCIgbWV0YWRhdGEgZm9y\nIHRoaXMgdHlwZQogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBf\ncmVwb3MuZ2V0TWV0YURhdGEoX3R5cGUsIF9sb2FkZXIsIHRydWUpOwogICAg\nICAgICAgICBtZXRhLnJlc29sdmUoTU9ERV9NRVRBKTsKICAgICAgICAgICAg\nY29weSh0aGlzLCBtZXRhKTsKICAgICAgICAgICAgX2VtYmVkZGVkID0gQm9v\nbGVhbi5GQUxTRTsgLy8gZW1iZWRkZWQgaW5zdGFuY2UgaXNuJ3QgZW1iZWRk\nZWQtb25seQogICAgICAgIH0KCiAgICAgICAgLy8gbWFrZSBzdXJlIHN1cGVy\nY2xhc3MgaXMgcmVzb2x2ZWQKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9\nIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAh\nPSBudWxsKSB7CiAgICAgICAgICAgIHN1cC5yZXNvbHZlKE1PREVfTUVUQSk7\nCiAgICAgICAgICAgIGlmIChlbWJlZCkgewogICAgICAgICAgICAgICAgLy8g\nZW1iZWRkZWQgaW5zdGFuY2UgYWx3YXlzIHJlZGVmaW5lIGFsbCBzdXBlcmNs\nYXNzIGZpZWxkcwogICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHN1\ncHMgPSBzdXAuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHN1cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoX3N1cEZpZWxkTWFwID09IG51bGwKICAgICAgICAgICAg\nICAgICAgICAgICAgfHwgIV9zdXBGaWVsZE1hcC5jb250YWluc0tleShzdXBz\nW2ldLmdldE5hbWUoKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRk\nRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChzdXBzW2ldLmdldE5hbWUoKSwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHN1cHNbaV0uZ2V0RGVjbGFyZWRU\neXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBzW2ldLmdl\ndERlY2xhcmluZ1R5cGUoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvLyByZXNvbHZlIGZpZWxkcyBhbmQgcmVtb3ZlIGludmFsaWRzCiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQ7CiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBfZmllbGRNYXAudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgLy8gb25seSBwYXNzIG9uIG1ldGFkYXRh\nIHJlc29sdmUgbW9kZSBzbyB0aGF0IG1ldGFkYXRhIGlzIGFsd2F5cwogICAg\nICAgICAgICAvLyByZXNvbHZlZCBiZWZvcmUgYW55IG90aGVyIHJlc29sdmUg\nbW9kZXMgb3VyIHN1YmNsYXNzZXMgcGFzcyBhbG9uZwogICAgICAgICAgICBm\nbWQgPSAoRmllbGRNZXRhRGF0YSkgaXRyLm5leHQoKTsKICAgICAgICAgICAg\nZm1kLnJlc29sdmUoTU9ERV9NRVRBKTsKCiAgICAgICAgICAgIGlmICghZm1k\nLmlzRXhwbGljaXQoKQogICAgICAgICAgICAgICAgJiYgKGZtZC5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLk9CSkVDVAogICAgICAgICAg\nICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlw\nZXMuUENfVU5UWVBFRAogICAgICAgICAgICAgICAgfHwgKGZtZC5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLkFSUkFZCiAgICAgICAgICAg\nICAgICAmJiBmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZUNvZGUo\nKQogICAgICAgICAgICAgICAgPT0gSmF2YVR5cGVzLk9CSkVDVCkpKSB7CiAg\nICAgICAgICAgICAgICBfcmVwb3MuZ2V0TG9nKCkud2FybihfbG9jLmdldCgi\ncm0tZmllbGQiLCBmbWQpKTsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0\nTGlzdGluZ0luZGV4KCkgIT0gLTEpCiAgICAgICAgICAgICAgICAgICAgZm1k\nLnNldE1hbmFnZW1lbnQoZm1kLk1BTkFHRV9OT05FKTsKICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpdHIucmVtb3ZlKCk7CiAg\nICAgICAgICAgICAgICBjbGVhckZpZWxkQ2FjaGUoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgLy8gZW1iZWRkZWQgaW5zdGFuY2VzIG11\nc3QgZW1iZWQgYWxsIHN1cGVyY2xhc3MgZmllbGRzIHRvbwogICAgICAgIGlm\nIChlbWJlZCkgewogICAgICAgICAgICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsK\nICAgICAgICAgICAgcmVzb2x2ZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyB0aGlzIGVuc3VyZXMgdGhhdCBhbGwg\nZmllbGQgaW5kZXhlcyBnZXQgc2V0IHdoZW4gZmllbGRzIGFyZSBjYWNoZWQK\nICAgICAgICBjYWNoZUZpZWxkcygpOwoKICAgICAgICAvLyByZXNvbHZlIGxp\nZmVjeWNsZSBtZXRhZGF0YSBub3cgdG8gcHJldmVudCBsYXp5IHRocmVhZGlu\nZyBwcm9ibGVtcwogICAgICAgIF9saWZlTWV0YS5yZXNvbHZlKCk7CgogICAg\nICAgIC8vIHJlY29yZCBpbXBsZW1lbnRzIGluIHRoZSByZXBvc2l0b3J5CiAg\nICAgICAgaWYgKF9pbnRlcmZhY2VzICE9IG51bGwpIHsKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdCA9IF9pbnRlcmZhY2VzLml0ZXJhdG9yKCk7IGl0\nLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICBfcmVwb3MuYWRkRGVjbGFy\nZWRJbnRlcmZhY2VJbXBsKHRoaXMsIChDbGFzcykgaXQubmV4dCgpKTsKICAg\nICAgICB9CgogICAgICAgIC8vIHJlc29sdmUgZmV0Y2ggZ3JvdXBzCiAgICAg\nICAgaWYgKF9mZ01hcCAhPSBudWxsKQogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IF9mZ01hcC52YWx1ZXMoKS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgICAgICgoRmV0Y2hHcm91cCkgaXRyLm5l\neHQoKSkucmVzb2x2ZSgpOwoKICAgICAgICBpZiAoIWVtYmVkICYmIF90eXBl\nLmlzSW50ZXJmYWNlKCkpIHsKICAgICAgICAgICAgaWYgKF9pbnRlcmZhY2Ug\nIT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnRlcmZhY2UiLCBfdHlwZSkp\nOwoKICAgICAgICAgICAgaWYgKHJ1bnRpbWUpIHsKICAgICAgICAgICAgICAg\nIF9pbXBsID0gX3JlcG9zLmdldEltcGxHZW5lcmF0b3IoKS5jcmVhdGVJbXBs\nKHRoaXMpOwogICAgICAgICAgICAgICAgX3JlcG9zLnNldEludGVyZmFjZUlt\ncGwodGhpcywgX2ltcGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyBpZiB0aGlzIGlzIHJ1bnRpbWUsIGNyZWF0ZSBhIHBjIGluc3Rh\nbmNlIGFuZCBzY2FuIGl0IGZvciBjb21wYXJhdG9ycwogICAgICAgIGlmIChy\ndW50aW1lICYmICFNb2RpZmllci5pc0Fic3RyYWN0KF90eXBlLmdldE1vZGlm\naWVycygpKSkgewogICAgICAgICAgICBQcm94eVNldHVwU3RhdGVNYW5hZ2Vy\nIHNtID0gbmV3IFByb3h5U2V0dXBTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAg\nICAgc20uc2V0UHJveHlEYXRhKFBDUmVnaXN0cnkubmV3SW5zdGFuY2UoX3R5\ncGUsIHNtLCBmYWxzZSksIHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFZhbGlkYXRlIHJlc29sdmVkIG1ldGFkYXRhLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCB2YWxpZGF0ZU1ldGEoYm9vbGVhbiBydW50\naW1lKSB7CiAgICAgICAgdmFsaWRhdGVEYXRhQ2FjaGUoKTsKICAgICAgICB2\nYWxpZGF0ZURldGFjaGFibGUoKTsKICAgICAgICB2YWxpZGF0ZUV4dGVuc2lv\nbktleXMoKTsKICAgICAgICB2YWxpZGF0ZUlkZW50aXR5KCk7CiAgICAgICAg\ndmFsaWRhdGVBY2Nlc3NUeXBlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXNvbHZlIG1hcHBpbmcgZGF0YS4gTG9ncyByZXNvbHZlIG1lc3NhZ2UgYW5k\nIHJlc29sdmVzIHN1cGVyIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCB2b2lkIHJlc29sdmVNYXBwaW5nKGJvb2xlYW4gcnVudGltZSkgewog\nICAgICAgIExvZyBsb2cgPSBfcmVwb3MuZ2V0TG9nKCk7CiAgICAgICAgaWYg\nKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJhY2Uo\nX2xvYy5nZXQoInJlc29sdmUtbWFwcGluZyIsIHRoaXMgKyAiQCIKICAgICAg\nICAgICAgICAgICsgU3lzdGVtLmlkZW50aXR5SGFzaENvZGUodGhpcykpKTsK\nCiAgICAgICAgLy8gbWFrZSBzdXJlIHN1cGVyY2xhc3MgaXMgcmVzb2x2ZWQg\nZmlyc3QKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAg\nICAgICAgICBzdXAucmVzb2x2ZShNT0RFX01BUFBJTkcpOwogICAgfQoKICAg\nIC8qKgogICAgICogVmFsaWRhdGUgbWFwcGluZyBkYXRhLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCB2YWxpZGF0ZU1hcHBpbmcoYm9vbGVhbiBydW50\naW1lKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIG1hcHBp\nbmcuIExvZ3MgaW5pdCBtZXNzYWdlIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIGluaXRpYWxpemVNYXBwaW5nKCkgewogICAgICAg\nIExvZyBsb2cgPSBfcmVwb3MuZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5p\nc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5n\nZXQoImluaXQtbWFwcGluZyIsIHRoaXMgKyAiQCIKICAgICAgICAgICAgICAg\nICsgU3lzdGVtLmlkZW50aXR5SGFzaENvZGUodGhpcykpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFZhbGlkYXRlIGRhdGEgY2FjaGUgc2V0dGluZ3MuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZURhdGFDYWNoZSgpIHsK\nICAgICAgICBpbnQgdGltZW91dCA9IGdldERhdGFDYWNoZVRpbWVvdXQoKTsK\nICAgICAgICBpZiAodGltZW91dCA8IC0xIHx8IHRpbWVvdXQgPT0gMCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJjYWNoZS10aW1lb3V0LWludmFsaWQiLAogICAgICAgICAgICAgICAgX3R5\ncGUsIFN0cmluZy52YWx1ZU9mKHRpbWVvdXQpKSk7CgogICAgICAgIGlmIChf\nc3VwZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIFN0\ncmluZyBjYWNoZSA9IGdldERhdGFDYWNoZU5hbWUoKTsKICAgICAgICBpZiAo\nY2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBT\ndHJpbmcgc3VwZXJDYWNoZSA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCku\nZ2V0RGF0YUNhY2hlTmFtZSgpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMu\nZXF1YWxzKGNhY2hlLCBzdXBlckNhY2hlKSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJjYWNoZS1uYW1lcyIs\nIG5ldyBPYmplY3RbXQogICAgICAgICAgICAgICAgeyBfdHlwZSwgY2FjaGUs\nIF9zdXBlciwgc3VwZXJDYWNoZSB9KSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBc3NlcnQgdGhhdCB0aGUgaWRlbnRpdHkgaGFuZGxpbmcgZm9yIHRoaXMg\nY2xhc3MgaXMgdmFsaWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxp\nZGF0ZUlkZW50aXR5KCkgewogICAgICAgIC8vIG1ha2Ugc3VyZSBpZGVudGl0\neSB0eXBlcyBhcmUgY29uc2lzdGVudAogICAgICAgIENsYXNzTWV0YURhdGEg\nc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpbnQg\naWQgPSBnZXRJZGVudGl0eVR5cGUoKTsKICAgICAgICBpZiAoc3VwICE9IG51\nbGwgJiYgc3VwLmdldElkZW50aXR5VHlwZSgpICE9IElEX1VOS05PV04KICAg\nICAgICAgICAgJiYgc3VwLmdldElkZW50aXR5VHlwZSgpICE9IGlkKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImlkLXR5cGVzIiwgX3R5cGUpKTsKCiAgICAgICAgLy8gY2hlY2sgZm9yIHRo\naW5ncyB0aGUgZGF0YSBzdG9yZSBkb2Vzbid0IHN1cHBvcnQKICAgICAgICBD\nb2xsZWN0aW9uIG9wdHMgPSBfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLnN1\ncHBvcnRlZE9wdGlvbnMoKTsKICAgICAgICBpZiAoaWQgPT0gSURfQVBQTElD\nQVRJT04KICAgICAgICAgICAgJiYgIW9wdHMuY29udGFpbnMoT3BlbkpQQUNv\nbmZpZ3VyYXRpb24uT1BUSU9OX0lEX0FQUExJQ0FUSU9OKSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQo\nImFwcGlkLW5vdC1zdXBwb3J0ZWQiLAogICAgICAgICAgICAgICAgX3R5cGUp\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlkID09IElEX0RBVEFTVE9SRQog\nICAgICAgICAgICAmJiAhb3B0cy5jb250YWlucyhPcGVuSlBBQ29uZmlndXJh\ndGlvbi5PUFRJT05fSURfREFUQVNUT1JFKSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAg\nICAgICAgICgiZGF0YXN0b3JlaWQtbm90LXN1cHBvcnRlZCIsIF90eXBlKSk7\nCiAgICAgICAgfQoKICAgICAgICBpZiAoaWQgPT0gSURfQVBQTElDQVRJT04p\nIHsKICAgICAgICAgICAgaWYgKF9pZFN0cmF0ZWd5ICE9IFZhbHVlU3RyYXRl\nZ2llcy5OT05FKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJhcHBpZC1zdHJhdGVneSIsIF90eXBlKSk7\nCiAgICAgICAgICAgIHZhbGlkYXRlQXBwSWRDbGFzcygpOwogICAgICAgIH0g\nZWxzZSBpZiAoaWQgIT0gSURfVU5LTk9XTikKICAgICAgICAgICAgdmFsaWRh\ndGVOb1BLRmllbGRzKCk7CgogICAgICAgIGludCBzdHJhdGVneSA9IGdldElk\nZW50aXR5U3RyYXRlZ3koKTsKICAgICAgICBpZiAoc3RyYXRlZ3kgPT0gVmFs\ndWVTdHJhdGVnaWVzLlNFUVVFTkNFCiAgICAgICAgICAgICYmIGdldElkZW50\naXR5U2VxdWVuY2VOYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1zZXEtbmFtZSIs\nIF90eXBlKSk7CgogICAgICAgIFZhbHVlU3RyYXRlZ2llcy5hc3NlcnRTdXBw\nb3J0ZWQoc3RyYXRlZ3ksIHRoaXMsCiAgICAgICAgICAgICJkYXRhc3RvcmUg\naWRlbnRpdHkgc3RyYXRlZ3kiKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1h\na2Ugc3VyZSB0aGUgYXBwbGljYXRpb24gaWRlbnRpdHkgY2xhc3MgaXMgdmFs\naWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFwcElkQ2xh\nc3MoKSB7CiAgICAgICAgLy8gYmFzZSB0eXBlcyBtdXN0IGRlY2xhcmUgYW4g\nb2lkIGNsYXNzIGlmIG5vdCBzaW5nbGUtZmllbGQgaWRlbnRpdHkKICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gcGtzID0gZ2V0UHJpbWFyeUtleUZpZWxkcygp\nOwogICAgICAgIGlmIChnZXRPYmplY3RJZFR5cGUoKSA9PSBudWxsKSB7CiAg\nICAgICAgICAgIGlmIChwa3MubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInVuc3Vw\ncG9ydGVkLWlkLXR5cGUiLAogICAgICAgICAgICAgICAgICAgIF90eXBlLCBw\na3NbMF0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIHBrc1swXS5n\nZXREZWNsYXJlZFR5cGUoKS5nZXROYW1lKCkpKTsKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1pZC1jbGFz\ncyIsIF90eXBlKSk7CiAgICAgICAgfQogICAgICAgIGlmIChfb2JqZWN0SWQg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoaXNP\ncGVuSlBBSWRlbnRpdHkoKSkgewogICAgICAgICAgICBpZiAocGtzWzBdLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0lEKSB7CiAgICAg\nICAgICAgICAgICBDbGFzc01ldGFEYXRhIGVtYmVkID0gcGtzWzBdLmdldEVt\nYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIHZhbGlkYXRlQXBw\nSWRDbGFzc01ldGhvZHMoZW1iZWQuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAg\nICAgICAgICAgICAgIHZhbGlkYXRlQXBwSWRDbGFzc1BLcyhlbWJlZCwgZW1i\nZWQuZ2V0RmllbGRzKCksCiAgICAgICAgICAgICAgICAgICAgZW1iZWQuZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwp\nIHsKICAgICAgICAgICAgLy8gY29uY3JldGUgc3VwZXJjbGFzcyBvaWRzIG11\nc3QgbWF0Y2ggb3IgYmUgcGFyZW50IG9mIG91cnMKICAgICAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwog\nICAgICAgICAgICBpZiAoIXN1cC5nZXRPYmplY3RJZFR5cGUoKS5pc0Fzc2ln\nbmFibGVGcm9tKF9vYmplY3RJZCkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImlkLWNsYXNzZXMiLAog\nICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgX3R5cGUsIF9vYmpl\nY3RJZCwgX3N1cGVyLAogICAgICAgICAgICAgICAgICAgICAgICBzdXAuZ2V0\nT2JqZWN0SWRUeXBlKCkgfSkpOwoKICAgICAgICAgICAgLy8gdmFsaWRhdGUg\ndGhhdCBubyBvdGhlciBwa3MgYXJlIGRlY2xhcmVkIGlmIHdlIGhhdmUgYQog\nICAgICAgICAgICAvLyBjb25jcmV0ZSBQQyBzdXBlcmNsYXNzCiAgICAgICAg\nICAgIGlmIChoYXNDb25jcmV0ZVBDU3VwZXJjbGFzcygpKQogICAgICAgICAg\nICAgICAgdmFsaWRhdGVOb1BLRmllbGRzKCk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBpZiB0aGlzIGNsYXNzIGhhcyBpdHMgb3duIG9pZCBjbGFzcywgZG8g\nc29tZSBtb3JlIHZhbGlkYXRpb24KICAgICAgICBpZiAoX3N1cGVyID09IG51\nbGwKICAgICAgICAgICAgfHwgX29iamVjdElkICE9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCkuZ2V0T2JqZWN0SWRUeXBlKCkpIHsKICAgICAgICAgICAg\nLy8gbWFrZSBzdXJlIG5vbi1hYnN0cmFjdCBvaWQgY2xhc3NlcyBvdmVycmlk\nZSB0aGUgcHJvcGVyIG1ldGhvZHMKICAgICAgICAgICAgaWYgKCFNb2RpZmll\nci5pc0Fic3RyYWN0KF9vYmplY3RJZC5nZXRNb2RpZmllcnMoKSkpCiAgICAg\nICAgICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3NNZXRob2RzKF9vYmplY3RJ\nZCk7CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGFwcCBpZCBjbGFz\ncyBoYXMgYWxsIHBrIGZpZWxkcwogICAgICAgICAgICB2YWxpZGF0ZUFwcElk\nQ2xhc3NQS3ModGhpcywgcGtzLCBfb2JqZWN0SWQpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoaXMgY2xhc3Mg\naGFzIGEgY29uY3JldGUgcGVyc2lzdGVudCBzdXBlcmNsYXNzLgogICAgICov\nCiAgICBwcml2YXRlIGJvb2xlYW4gaGFzQ29uY3JldGVQQ1N1cGVyY2xhc3Mo\nKSB7CiAgICAgICAgaWYgKF9zdXBlciA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFNb2RpZmllci5pc0Fic3RyYWN0\nKF9zdXBlci5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIHJldHVybiBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nLmhhc0NvbmNyZXRlUENTdXBlcmNsYXNzKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBFbnN1cmUgdGhhdCB0aGUgdXNlciBoYXMgb3ZlcnJpZGRlbiB0aGUg\nZXF1YWxzIGFuZCBoYXNoQ29kZSBtZXRob2RzLAogICAgICogYW5kIGhhcyB0\naGUgcHJvcGVyIGNvbnN0cnVjdG9ycy4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHZhbGlkYXRlQXBwSWRDbGFzc01ldGhvZHMoQ2xhc3Mgb2lkKSB7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgb2lkLmdldENvbnN0cnVjdG9yKChD\nbGFzc1tdKSBudWxsKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm51bGwtY29ucyIsIF90eXBlKSkuCiAgICAgICAgICAgICAgICBz\nZXRDYXVzZShlKTsKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIGZvciBl\ncXVhbHMgYW5kIGhhc2hjb2RlIG92ZXJyaWRlczsgZG9uJ3QgZW5mb3JjZSBp\ndAogICAgICAgIC8vIGZvciBhYnN0cmFjdCBhcHAgaWQgY2xhc3Nlcywgc2lu\nY2UgdGhleSBtYXkgbm90IG5lY2Vzc2FyaWx5CiAgICAgICAgLy8gZGVjbGFy\nZSBwcmltYXJ5IGtleSBmaWVsZHMKICAgICAgICBNZXRob2QgbWV0aG9kOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1ldGhvZCA9IG9pZC5nZXRNZXRo\nb2QoImVxdWFscyIsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSkuc2V0RmF0YWwodHJ1ZSk7CiAg\nICAgICAgfQoKICAgICAgICBib29sZWFuIGFicyA9IE1vZGlmaWVyLmlzQWJz\ndHJhY3QoX3R5cGUuZ2V0TW9kaWZpZXJzKCkpOwogICAgICAgIGlmICghYWJz\nICYmIG1ldGhvZC5nZXREZWNsYXJpbmdDbGFzcygpID09IE9iamVjdC5jbGFz\ncykKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJlcS1tZXRob2QiLCBfdHlwZSkpOwoKICAgICAgICB0cnkgewog\nICAgICAgICAgICBtZXRob2QgPSBvaWQuZ2V0TWV0aG9kKCJoYXNoQ29kZSIs\nIChDbGFzc1tdKSBudWxsKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihl\nKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFhYnMg\nJiYgbWV0aG9kLmdldERlY2xhcmluZ0NsYXNzKCkgPT0gT2JqZWN0LmNsYXNz\nKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImhjLW1ldGhvZCIsIF90eXBlKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBWYWxpZGF0ZSB0aGF0IHRoZSBwcmltYXJ5IGtleSBjbGFzcyBoYXMg\nYWxsIHBrIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlk\nYXRlQXBwSWRDbGFzc1BLcyhDbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMsIENsYXNzIG9pZCkgewogICAgICAgIGlm\nIChmbWRzLmxlbmd0aCA9PSAwICYmICFNb2RpZmllci5pc0Fic3RyYWN0KG1l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpLgogICAgICAgICAgICBnZXRNb2RpZmll\ncnMoKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tcGsiLCBfdHlwZSkpOwoKICAgICAgICAvLyBjaGVj\nayB0aGF0IHRoZSBvaWQgdHlwZSBjb250YWlucyBhbGwgcGsgZmllbGRzCiAg\nICAgICAgRmllbGQgZjsKICAgICAgICBNZXRob2QgbTsKICAgICAgICBDbGFz\ncyBjOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBzd2l0Y2ggKGZtZHNbaV0uZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5BUlJBWToKICAgICAgICAgICAgICAgICAgICBjID0gZm1kc1tpXS5nZXRE\nZWNsYXJlZFR5cGUoKS5nZXRDb21wb25lbnRUeXBlKCk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGMgPT0gYnl0ZS5jbGFzcyB8fCBjID09IEJ5dGUuY2xh\nc3MKICAgICAgICAgICAgICAgICAgICAgICAgfHwgYyA9PSBjaGFyLmNsYXNz\nIHx8IGMgPT0gQ2hhcmFjdGVyLmNsYXNzKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGMgPSBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgLy8gZWxzZSBubyBicmVhawogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5PSUQ6IC8vIHdlJ3JlIHZhbGlkYXRpbmcgZW1iZWRkZWQg\nZmllbGRzCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtcGstdHlwZSIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIGZtZHNbaV0pKTsKICAgICAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICAgICAgYyA9IGZtZHNbaV0uZ2V0T2JqZWN0\nSWRGaWVsZFR5cGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYg\nKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IEFDQ0VTU19GSUVMRCkgewogICAg\nICAgICAgICAgICAgZiA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZCwgZm1k\nc1tpXS5nZXROYW1lKCksIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmIChm\nID09IG51bGwgfHwgIWYuZ2V0VHlwZSgpLmlzQXNzaWduYWJsZUZyb20oYykp\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJpbnZhbGlkLWlkIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgX3R5cGUsIGZtZHNbaV0uZ2V0TmFtZSgpKSk7CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQUNDRVNTX1BS\nT1BFUlRZKSB7CiAgICAgICAgICAgICAgICBtID0gUmVmbGVjdGlvbi5maW5k\nR2V0dGVyKG9pZCwgZm1kc1tpXS5nZXROYW1lKCksIGZhbHNlKTsKICAgICAg\nICAgICAgICAgIGlmIChtID09IG51bGwgfHwgIW0uZ2V0UmV0dXJuVHlwZSgp\nLmlzQXNzaWduYWJsZUZyb20oYykpCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLWlk\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgX3R5cGUsIGZtZHNbaV0uZ2V0\nTmFtZSgpKSk7CiAgICAgICAgICAgICAgICBtID0gUmVmbGVjdGlvbi5maW5k\nU2V0dGVyKG9pZCwgZm1kc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAg\nICAgICAgZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlwZSgpLCBmYWxzZSk7\nCiAgICAgICAgICAgICAgICBpZiAobSA9PSBudWxsIHx8IG0uZ2V0UmV0dXJu\nVHlwZSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLWlk\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgX3R5cGUsIGZtZHNbaV0uZ2V0\nTmFtZSgpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBWYWxpZGF0ZSB0aGF0IHRoaXMgY2xhc3MgZG9lc24ndCBk\nZWNsYXJlIGFueSBwcmltYXJ5IGtleSBmaWVsZHMuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCB2YWxpZGF0ZU5vUEtGaWVsZHMoKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldERlY2xhcmVkRmllbGRzKCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImJhZC1wayIsIGZpZWxkc1tpXSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogQXNzZXJ0IHRoYXQgdGhpcyBjbGFzcycgYWNjZXNzIHR5cGUgaXMg\nYWxsb3dlZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlQWNj\nZXNzVHlwZSgpIHsKICAgICAgICBpZiAoX2FjY2Vzc1R5cGUgPT0gQUNDRVNT\nX1VOS05PV04pCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBDbGFzc01l\ndGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAg\nICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5nZXRBY2Nlc3NUeXBlKCkgIT0g\nQUNDRVNTX1VOS05PV04KICAgICAgICAgICAgJiYgc3VwLmdldEFjY2Vzc1R5\ncGUoKSAhPSBfYWNjZXNzVHlwZSAmJgogICAgICAgICAgICBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpLmdldEZpZWxkcygpLmxlbmd0aCA+IDApIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJpbmNvbnNpc3RlbnQtYWNjZXNzIiwKICAgICAgICAgICAgICAgIHRoaXMs\nIHN1cCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFzc2Vy\ndCB0aGF0IGRldGFjaG1lbnQgY29uZmlndXJhdGlvbiBpcyB2YWxpZC4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlRGV0YWNoYWJsZSgpIHsK\nICAgICAgICBib29sZWFuIGZpcnN0ID0gdHJ1ZTsKICAgICAgICBmb3IgKENs\nYXNzTWV0YURhdGEgcGFyZW50ID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKTsKICAgICAgICAgICAgZmlyc3QgJiYgcGFyZW50ICE9IG51bGw7IHBhcmVu\ndCA9IHBhcmVudC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKQogICAgICAg\nIHsKICAgICAgICAgICAgaWYgKHBhcmVudC5pc0RldGFjaGFibGUoKSkKICAg\nICAgICAgICAgICAgIGZpcnN0ID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAg\nICBGaWVsZCBmaWVsZCA9IGdldERldGFjaGVkU3RhdGVGaWVsZCgpOwogICAg\nICAgIGlmIChmaWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmICghZmly\nc3QpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoInBhcmVudC1kZXRhY2gtc3RhdGUiLAogICAgICAgICAg\nICAgICAgICAgIF90eXBlKSk7CiAgICAgICAgICAgIGlmIChnZXRGaWVsZChm\naWVsZC5nZXROYW1lKCkpICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm1hbmFnZWQtZGV0\nYWNoLXN0YXRlIiwKICAgICAgICAgICAgICAgICAgICBmaWVsZC5nZXROYW1l\nKCksIF90eXBlKSk7CiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRUeXBlKCkg\nIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZGV0YWNoLXN0YXRlIiwK\nICAgICAgICAgICAgICAgICAgICBmaWVsZC5nZXROYW1lKCksIF90eXBlKSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nRmV0Y2ggR3JvdXAKICAgIC8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBmZXRjaCBncm91cHMgZGVjbGFyZWQgZXhwbGljaXRs\neSBpbiB0aGlzIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBGZXRjaEdyb3Vw\nW10gZ2V0RGVjbGFyZWRGZXRjaEdyb3VwcygpIHsKICAgICAgICBpZiAoX2Zn\ncyA9PSBudWxsKQogICAgICAgICAgICBfZmdzID0gKF9mZ01hcCA9PSBudWxs\nKSA/IEVNUFRZX0ZFVENIX0dST1VQX0FSUkFZIDogKEZldGNoR3JvdXBbXSkK\nICAgICAgICAgICAgICAgIF9mZ01hcC52YWx1ZXMoKS50b0FycmF5KG5ldyBG\nZXRjaEdyb3VwW19mZ01hcC5zaXplKCldKTsgCiAgICAgICAgcmV0dXJuIF9m\nZ3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGZldGNoIGdy\nb3VwcyBmb3IgdGhpcyB0eXBlLCBpbmNsdWRpbmcgc3VwZXJjbGFzcyBncm91\ncHMuCiAgICAgKi8KICAgIHB1YmxpYyBGZXRjaEdyb3VwW10gZ2V0Q3VzdG9t\nRmV0Y2hHcm91cHMoKSB7CiAgICAgICAgaWYgKF9jdXN0b21GR3MgPT0gbnVs\nbCkgewogICAgICAgICAgICAvLyBtYXAgZmdzIHRvIG5hbWVzLCBhbGxvd2lu\nZyBvdXIgZmdzIHRvIG92ZXJyaWRlIHN1cGVycwogICAgICAgICAgICBNYXAg\nZmdzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAg\nICBpZiAoc3VwICE9IG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAg\nICAgIEZldGNoR3JvdXBbXSBzdXBGR3MgPSBzdXAuZ2V0Q3VzdG9tRmV0Y2hH\ncm91cHMoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc3VwRkdzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGZncy5w\ndXQoc3VwRkdzW2ldLmdldE5hbWUoKSwgc3VwRkdzW2ldKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBGZXRjaEdyb3VwW10gZGVjcyA9IGdldERlY2xh\ncmVkRmV0Y2hHcm91cHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBkZWNzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgZmdzLnB1\ndChkZWNzW2ldLmdldE5hbWUoKSwgZGVjc1tpXSk7CiAgICAgICAgICAgIAog\nICAgICAgICAgICAvLyByZW1vdmUgc3RkIGdyb3VwcwogICAgICAgICAgICBm\nZ3MucmVtb3ZlKEZldGNoR3JvdXAuTkFNRV9ERUZBVUxUKTsKICAgICAgICAg\nICAgZmdzLnJlbW92ZShGZXRjaEdyb3VwLk5BTUVfQUxMKTsKCiAgICAgICAg\nICAgIF9jdXN0b21GR3MgPSAoRmV0Y2hHcm91cFtdKSBmZ3MudmFsdWVzKCku\ndG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBGZXRjaEdyb3VwW2Zncy5z\naXplKCldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jdXN0b21GR3M7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIGEgbmFtZWQgZmVjdGggZ3Jv\ndXAuIElmIG5vdCBhdmFpbGFibGUgaW4gdGhpcyByZWNlaXZlciB0aGVuIGxv\nb2tzCiAgICAgKiB1cCB0aGUgaW5oZXJpdGVuY2UgaGllcmFyY2h5LiAKICAg\nICAqCiAgICAgKiBAcGFyYW0gbmFtZSBuYW1lIG9mIGEgZmV0Y2ggZ3JvdXAu\nCiAgICAgKiBAcmV0dXJuIGFuIGV4aXN0aW5nIGZlY3RoIGdyb3VwIG9mIHRo\nZSBnaXZlbiBuYW1lIGlmIGtub3duIHRvIHRoaXMgCiAgICAgKiByZWNlaXZl\nciBvciBhbnkgb2YgaXRzIHN1cGVyY2xhc3Nlcy4gT3RoZXJ3aXNlIG51bGwu\nCiAgICAgKi8KICAgIHB1YmxpYyBGZXRjaEdyb3VwIGdldEZldGNoR3JvdXAo\nU3RyaW5nIG5hbWUpIHsKICAgICAgICBGZXRjaEdyb3VwIGZnID0gKF9mZ01h\ncCA9PSBudWxsKSA/IG51bGwgOiAoRmV0Y2hHcm91cCkgX2ZnTWFwLmdldChu\nYW1lKTsKICAgICAgICBpZiAoZmcgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIGZnOwogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAoc3VwICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBzdXAuZ2V0RmV0Y2hHcm91cChuYW1lKTsKICAg\nICAgICBpZiAoRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQuZXF1YWxzKG5hbWUp\nKQogICAgICAgICAgICByZXR1cm4gRmV0Y2hHcm91cC5ERUZBVUxUOwogICAg\nICAgIGlmIChGZXRjaEdyb3VwLk5BTUVfQUxMLmVxdWFscyhuYW1lKSkKICAg\nICAgICAgICAgcmV0dXJuIEZldGNoR3JvdXAuQUxMOwogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBmZXRjaCBncm91\ncCBvZiB0aGUgZ2l2ZW4gbmFtZSwgb3IgcmV0dXJucyBleGlzdGluZyBpbnN0\nYW5jZS4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSBhIG5vbi1udWxsLCBu\nb24tZW1wdHkgbmFtZS4gTXVzdCBiZSB1bmlxdWUgd2l0aGluIHRoaXMKICAg\nICAqIHJlY2VpdmVyJ3Mgc2NvcGUuIFRoZSBzdXBlciBjbGFzcyA8ZW0+bWF5\nPC9lbT4gaGF2ZSBhIGdyb3VwIHdpdGgKICAgICAqIHRoZSBzYW1lIG5hbWUu\nCiAgICAgKi8KICAgIHB1YmxpYyBGZXRjaEdyb3VwIGFkZERlY2xhcmVkRmV0\nY2hHcm91cChTdHJpbmcgbmFtZSkgewogICAgCWlmIChTdHJpbmdVdGlscy5p\nc0VtcHR5KG5hbWUpKQogICAgCQl0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoImVtcHR5LWZnLW5hbWUiLCB0aGlzKSk7CiAgICAgICAg\naWYgKF9mZ01hcCA9PSBudWxsKQogICAgICAgICAgICBfZmdNYXAgPSBuZXcg\nSGFzaE1hcCgpOwogICAgICAgIEZldGNoR3JvdXAgZmcgPSAoRmV0Y2hHcm91\ncCkgX2ZnTWFwLmdldChuYW1lKTsKICAgICAgICBpZiAoZmcgPT0gbnVsbCkg\newogICAgICAgIAlmZyA9IG5ldyBGZXRjaEdyb3VwKHRoaXMsIG5hbWUpOwog\nICAgICAgIAlfZmdNYXAucHV0KG5hbWUsIGZnKTsKICAgICAgICAgICAgX2Zn\ncyA9IG51bGw7CiAgICAgICAgICAgIF9jdXN0b21GR3MgPSBudWxsOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZmc7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZW1vdmUgYSBkZWNsYXJlZCBmZXRjaCBncm91cC4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gcmVtb3ZlRGVjbGFyZWRGZXRjaEdyb3VwKEZldGNo\nR3JvdXAgZmcpIHsKICAgICAgICBpZiAoZmcgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChfZmdNYXAucmVtb3ZlKGZn\nLmdldE5hbWUoKSkgIT0gbnVsbCkgewogICAgICAgICAgICBfZmdzID0gbnVs\nbDsKICAgICAgICAgICAgX2N1c3RvbUZHcyA9IG51bGw7CiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFNvdXJjZVRy\nYWNrZXIKICAgIC8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIEZpbGUg\nZ2V0U291cmNlRmlsZSgpIHsKICAgICAgICByZXR1cm4gX3NyY0ZpbGU7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBnZXRTb3VyY2VTY29wZSgpIHsKICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldFNv\ndXJjZVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF9zcmNUeXBlOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldFNvdXJjZShGaWxlIGZpbGUsIGludCBzcmNU\neXBlKSB7CiAgICAgICAgX3NyY0ZpbGUgPSBmaWxlOwogICAgICAgIF9zcmNU\neXBlID0gc3JjVHlwZTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFJl\nc291cmNlTmFtZSgpIHsKICAgICAgICByZXR1cm4gX3R5cGUuZ2V0TmFtZSgp\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBtb2RlIHRoaXMg\nbWV0YWRhdGEgaGFzIGJlZW4gbG9hZGVkIHVuZGVyLgogICAgICovCiAgICBw\ndWJsaWMgaW50IGdldFNvdXJjZU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIF9z\ncmNNb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBtb2Rl\nIHRoaXMgbWV0YWRhdGEgaGFzIGJlZW4gbG9hZGVkIHVuZGVyLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlKSB7CiAg\nICAgICAgX3NyY01vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHNvdXJjZSBtb2RlIHRoaXMgbWV0YWRhdGEgaGFzIGJlZW4gbG9hZGVk\nIHVuZGVyLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTb3VyY2VNb2Rl\nKGludCBtb2RlLCBib29sZWFuIG9uKSB7CiAgICAgICAgaWYgKG1vZGUgPT0g\nTU9ERV9OT05FKQogICAgICAgICAgICBfc3JjTW9kZSA9IG1vZGU7CiAgICAg\nICAgZWxzZSBpZiAob24pCiAgICAgICAgICAgIF9zcmNNb2RlIHw9IG1vZGU7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBfc3JjTW9kZSAmPSB+bW9kZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBpbmRleCBpbiB3aGljaCB0aGlz\nIGNsYXNzIHdhcyBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRhLiBEZWZhdWx0cyB0\nbwogICAgICogPGNvZGU+LTE8L2NvZGU+IGlmIHRoaXMgY2xhc3Mgd2FzIG5v\ndCBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMg\naW50IGdldExpc3RpbmdJbmRleCgpIHsKICAgICAgICByZXR1cm4gX2xpc3RJ\nbmRleDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBpbmRleCBpbiB3aGlj\naCB0aGlzIGZpZWxkIHdhcyBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRhLiBEZWZh\ndWx0cyB0bwogICAgICogPGNvZGU+LTE8L2NvZGU+IGlmIHRoaXMgY2xhc3Mg\nd2FzIG5vdCBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRhLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRMaXN0aW5nSW5kZXgoaW50IGluZGV4KSB7CiAgICAg\nICAgX2xpc3RJbmRleCA9IGluZGV4OwogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gQ29tbWVudGFibGUKICAgIC8vLy8vLy8vLy8vLy8vLwoK\nICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDb21tZW50cygpIHsKICAgICAgICBy\nZXR1cm4gKF9jb21tZW50cyA9PSBudWxsKSA/IEVNUFRZX0NPTU1FTlRTIDog\nX2NvbW1lbnRzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbW1lbnRz\nKFN0cmluZ1tdIGNvbW1lbnRzKSB7CiAgICAgICAgX2NvbW1lbnRzID0gY29t\nbWVudHM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8KICAgIC8vIFN0YXRl\nIGNvcHkKICAgIC8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBDb3B5\nIHRoZSBtZXRhZGF0YSBmcm9tIHRoZSBnaXZlbiBpbnN0YW5jZSB0byB0aGlz\nIG9uZS4gRG8gbm90CiAgICAgKiBjb3B5IG1hcHBpbmcgaW5mb3JtYXRpb24u\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNvcHkoQ2xhc3NNZXRhRGF0YSBt\nZXRhKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpICE9\nIF90eXBlKQogICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oKTsKICAgICAgICBzdXBlci5jb3B5KG1ldGEpOwoKICAgICAgICAvLyBj\nb3B5IGNsYXNzLWxldmVsIGluZm87IHVzZSBnZXQgbWV0aG9kcyB0byBmb3Jj\nZSByZXNvbHV0aW9uIG9mCiAgICAgICAgLy8gbGF6eSBkYXRhCiAgICAgICAg\nX3N1cGVyID0gbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKTsKICAgICAgICBfb2Jq\nZWN0SWQgPSBtZXRhLmdldE9iamVjdElkVHlwZSgpOwogICAgICAgIF9leHRl\nbnQgPSAobWV0YS5nZXRSZXF1aXJlc0V4dGVudCgpKSA/IEJvb2xlYW4uVFJV\nRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgX2VtYmVkZGVkID0gKG1ldGEu\naXNFbWJlZGRlZE9ubHkoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZB\nTFNFOwogICAgICAgIF9pbnRlcmZhY2UgPSAobWV0YS5pc01hbmFnZWRJbnRl\ncmZhY2UoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAg\nICAgIHNldEludGVyY2VwdGluZyhtZXRhLmlzSW50ZXJjZXB0aW5nKCkpOwog\nICAgICAgIF9pbXBsID0gbWV0YS5nZXRJbnRlcmZhY2VJbXBsKCk7CiAgICAg\nICAgX2lkZW50aXR5ID0gbWV0YS5nZXRJZGVudGl0eVR5cGUoKTsKICAgICAg\nICBfaWRTdHJhdGVneSA9IG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVneSgpOwog\nICAgICAgIF9zZXFOYW1lID0gbWV0YS5nZXRJZGVudGl0eVNlcXVlbmNlTmFt\nZSgpOwogICAgICAgIF9zZXFNZXRhID0gbnVsbDsKICAgICAgICBfYWxpYXMg\nPSBtZXRhLmdldFR5cGVBbGlhcygpOwogICAgICAgIF9hY2Nlc3NUeXBlID0g\nbWV0YS5nZXRBY2Nlc3NUeXBlKCk7CgogICAgICAgIC8vIG9ubHkgY29weSB0\naGlzIGluZm9ybWF0aW9uIGlmIGl0IHdhc24ndCBzZXQgZXhwbGljaXRseSBm\nb3IgdGhpcwogICAgICAgIC8vIGluc3RhbmNlCiAgICAgICAgaWYgKERFRkFV\nTFRfU1RSSU5HLmVxdWFscyhfY2FjaGVOYW1lKSkKICAgICAgICAgICAgX2Nh\nY2hlTmFtZSA9IG1ldGEuZ2V0RGF0YUNhY2hlTmFtZSgpOwogICAgICAgIGlm\nIChfY2FjaGVUaW1lb3V0ID09IEludGVnZXIuTUlOX1ZBTFVFKQogICAgICAg\nICAgICBfY2FjaGVUaW1lb3V0ID0gbWV0YS5nZXREYXRhQ2FjaGVUaW1lb3V0\nKCk7CiAgICAgICAgaWYgKF9kZXRhY2hhYmxlID09IG51bGwpCiAgICAgICAg\nICAgIF9kZXRhY2hhYmxlID0gbWV0YS5fZGV0YWNoYWJsZTsKICAgICAgICBp\nZiAoREVGQVVMVF9TVFJJTkcuZXF1YWxzKF9kZXRhY2hTdGF0ZSkpCiAgICAg\nICAgICAgIF9kZXRhY2hTdGF0ZSA9IG1ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgp\nOwoKICAgICAgICAvLyBzeW5jaCBmaWVsZCBpbmZvcm1hdGlvbjsgZmlyc3Qg\ncmVtb3ZlIGV4dHJhIGZpZWxkcwogICAgICAgIGNsZWFyRmllbGRDYWNoZSgp\nOwogICAgICAgIF9maWVsZE1hcC5rZXlTZXQoKS5yZXRhaW5BbGwobWV0YS5f\nZmllbGRNYXAua2V5U2V0KCkpOwoKICAgICAgICAvLyBhZGQgY29waWVzIG9m\nIGRlY2xhcmVkIGZpZWxkczsgb3RoZXIgZGVmaW5lZCBmaWVsZHMgYWxyZWFk\neSBjb3BpZWQKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gbWV0\nYS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIEZpZWxkTWV0YURhdGEg\nZmllbGQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgZmllbGQgPSBnZXREZWNsYXJlZEZp\nZWxkKGZpZWxkc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBpZiAoZmll\nbGQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGZpZWxkID0gYWRkRGVjbGFy\nZWRGaWVsZChmaWVsZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAg\nICAgIGZpZWxkc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAg\nIGZpZWxkLnNldERlY2xhcmVkSW5kZXgoLTEpOwogICAgICAgICAgICBmaWVs\nZC5zZXRJbmRleCgtMSk7CiAgICAgICAgICAgIGZpZWxkLmNvcHkoZmllbGRz\nW2ldKTsKICAgICAgICB9CgogICAgICAgIC8vIGNvcHkgZmV0Y2ggZ3JvdXBz\nCiAgICAgICAgRmV0Y2hHcm91cFtdIGZncyA9IG1ldGEuZ2V0RGVjbGFyZWRG\nZXRjaEdyb3VwcygpOwogICAgICAgIEZldGNoR3JvdXAgZmc7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmZ3MubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgZmcgPSBhZGREZWNsYXJlZEZldGNoR3JvdXAoZmdzW2ldLmdldE5h\nbWUoKSk7CiAgICAgICAgICAgIGZnLmNvcHkoZmdzW2ldKTsgCiAgICAgICAg\nfQoKICAgICAgICAvLyBjb3B5IGlmYWNlIHJlLW1hcHBpbmcKICAgICAgICBf\naWZhY2VNYXAuY2xlYXIoKTsKICAgICAgICBfaWZhY2VNYXAucHV0QWxsKG1l\ndGEuX2lmYWNlTWFwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2\nZSBoZWxwZXIgdG8gY29weSBlbWJlZGRlZCBtZXRhZGF0YS4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBjb3B5KENsYXNzTWV0YURhdGEgZW1i\nZWQsIENsYXNzTWV0YURhdGEgZGVjKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBzdXAgPSBkZWMuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAg\nICBpZiAoc3VwICE9IG51bGwpIHsKICAgICAgICAgICAgZW1iZWQuc2V0UENT\ndXBlcmNsYXNzKHN1cC5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAg\nICBjb3B5KGVtYmVkLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCksIHN1cCk7\nCiAgICAgICAgfQogICAgICAgIGVtYmVkLmNvcHkoZGVjKTsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgdm9pZCBhZGRFeHRlbnNpb25LZXlzKENvbGxlY3Rpb24g\nZXh0cykgewogICAgICAgIF9yZXBvcy5nZXRNZXRhRGF0YUZhY3RvcnkoKS5h\nZGRDbGFzc0V4dGVuc2lvbktleXMoZXh0cyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb21wYXJhdG9yIHVzZWQgdG8gcHV0IGZpZWxkIG1ldGFkYXRhcyBp\nbnRvIGxpc3Rpbmcgb3JkZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIExpc3RpbmdPcmRlckNvbXBhcmF0b3IKICAgICAgICBpbXBsZW1l\nbnRzIENvbXBhcmF0b3IgewoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBMaXN0aW5nT3JkZXJDb21wYXJhdG9yIF9pbnN0YW5jZQogICAgICAgICAg\nICA9IG5ldyBMaXN0aW5nT3JkZXJDb21wYXJhdG9yKCk7CgogICAgICAgIC8q\nKgogICAgICAgICAqIEFjY2VzcyBzaW5nbGV0b24gaW5zdGFuY2UuCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0aW5nT3JkZXJDb21w\nYXJhdG9yIGdldEluc3RhbmNlKCkgewogICAgICAgICAgICByZXR1cm4gX2lu\nc3RhbmNlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBjb21wYXJl\nKE9iamVjdCBvMSwgT2JqZWN0IG8yKSB7CiAgICAgICAgICAgIGlmIChvMSA9\nPSBvMikKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICBp\nZiAobzEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAg\nICAgICAgICBpZiAobzIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiAtMTsKCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZjEgPSAoRmllbGRN\nZXRhRGF0YSkgbzE7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZjIgPSAo\nRmllbGRNZXRhRGF0YSkgbzI7CiAgICAgICAgICAgIGlmIChmMS5nZXRMaXN0\naW5nSW5kZXgoKSA9PSBmMi5nZXRMaXN0aW5nSW5kZXgoKSkgewogICAgICAg\nICAgICAgICAgaWYgKGYxLmdldEluZGV4KCkgPT0gZjIuZ2V0SW5kZXgoKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZjEuZ2V0RnVsbE5hbWUoZmFs\nc2UpLmNvbXBhcmVUbwogICAgICAgICAgICAgICAgICAgICAgICAoZjIuZ2V0\nRnVsbE5hbWUoZmFsc2UpKTsKCQkJCWlmIChmMS5nZXRJbmRleCAoKSA9PSAt\nMSkKCQkJCQlyZXR1cm4gMTsKCQkJCWlmIChmMi5nZXRJbmRleCAoKSA9PSAt\nMSkKCQkJCQlyZXR1cm4gLTE7CgkJCQlyZXR1cm4gZjEuZ2V0SW5kZXggKCkg\nLSBmMi5nZXRJbmRleCAoKTsKCQkJfQkKCQkJaWYgKGYxLmdldExpc3RpbmdJ\nbmRleCAoKSA9PSAtMSkKCQkJCXJldHVybiAxOwoJCQlpZiAoZjIuZ2V0TGlz\ndGluZ0luZGV4ICgpID09IC0xKQoJCQkJcmV0dXJuIC0xOwoJCQlyZXR1cm4g\nZjEuZ2V0TGlzdGluZ0luZGV4ICgpIC0gZjIuZ2V0TGlzdGluZ0luZGV4ICgp\nOwoJCX0KCX0KfQo=\n","encoding":"base64"}

