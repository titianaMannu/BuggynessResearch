{"sha":"de67d40aee3628e7897051fc6fe0f636cf65ea2b","node_id":"MDQ6QmxvYjIwNjM2NDpkZTY3ZDQwYWVlMzYyOGU3ODk3MDUxZmM2ZmUwZjYzNmNmNjVlYTJi","size":23384,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/de67d40aee3628e7897051fc6fe0f636cf65ea2b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0\nLk1vZGlmaWVyOwppbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9y\ndCBqYXZhLm1hdGguQmlnSW50ZWdlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmls\nZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwoK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLkZpZWxkTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDUmVnaXN0\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0\nZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5PYmplY3RJZFN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuU3RhdGVNYW5hZ2VySW1wbDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5hZ2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVn\naWVzOwppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogVXRpbGl0\neSBjbGFzcyBmb3IgbWFuaXB1bGF0aW5nIGFwcGxpY2F0aW9uIG9iamVjdCBp\nZHMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICov\nCnB1YmxpYyBjbGFzcyBBcHBsaWNhdGlvbklkcyB7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZQogICAgICAgIChBcHBsaWNhdGlvbklkcy5jbGFzcyk7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYzIgPSBMb2NhbGl6ZXIu\nZm9yUGFja2FnZQogICAgICAgIChTdGF0ZU1hbmFnZXJJbXBsLmNsYXNzKTsK\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJpbWFyeSBrZXkgdmFsdWVz\nIGZvciB0aGUgZ2l2ZW4gb2JqZWN0IGlkLiBUaGUgdmFsdWVzCiAgICAgKiB3\naWxsIGJlIHJldHVybmVkIGluIHRoZSBzYW1lIG9yZGVyIGFzIHRoZSBtZXRh\nZGF0YSBwcmltYXJ5IGtleSBmaWVsZHMuCiAgICAgKiBWYWx1ZXMgZm9yIFBD\nIHByaW1hcnkga2V5IGZpZWxkcyB3aWxsIGJlIHRoZSBwcmltYXJreSBrZXkg\ndmFsdWUgb3IKICAgICAqIG9pZCB2YWx1ZSBvZiB0aGUgcmVsYXRlZCBpbnN0\nYW5jZSAoZGVwZW5kaW5nIG9uIAogICAgICoge0BsaW5rIEZpZWxkTWV0YURh\ndGEjaXNPYmplY3RJZEZpZWxkSWRPZlBDfSkuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgT2JqZWN0W10gdG9QS1ZhbHVlcyhPYmplY3Qgb2lkLCBDbGFz\nc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgT2JqZWN0W10gcGtz\nOwogICAgICAgIGlmIChtZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAg\nICAgICAgICAgcGtzID0gbmV3IE9iamVjdFsxXTsKICAgICAgICAgICAgaWYg\nKG9pZCAhPSBudWxsKQogICAgICAgICAgICAgICAgcGtzWzBdID0gKChPcGVu\nSlBBSWQpIG9pZCkuZ2V0SWRPYmplY3QoKTsKICAgICAgICAgICAgcmV0dXJu\nIHBrczsKICAgICAgICB9CgogICAgICAgIC8vIHJlc2V0IG93bmluZyAnbWV0\nYScgdG8gdGhlIG93bmVyIG9mIHRoZSBwcmltYXJ5IGtleSBmaWVsZHMsIGJl\nY2F1c2UKICAgICAgICAvLyB0aGUgb25lIHBhc3NlZCBpbiBtaWdodCBiZSBh\nIHByb3h5LCBsaWtlIGZvciBlbWJlZGRlZCBtYXBwaW5nczsKICAgICAgICAv\nLyBzaW5jZSBnZXRQcmltYXJ5S2V5RmllbGRzIGlzIGd1YXJhbnRlZWQgdG8g\ncmV0dXJuIHRoZSBwcmltYXJ5CiAgICAgICAgLy8ga2V5cyBpbiB0aGUgb3Jk\nZXIgb2YgaW5oZXJpdGFuY2UsIHdlIGFyZSBndWFyYW50ZWVkIHRoYXQKICAg\nICAgICAvLyB0aGUgbGFzdCBlbGVtZW50IHdpbGwgYmUgdGhlIG1vc3QtZGVy\naXZlZCBjbGFzcy4KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IG1l\ndGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgIG1ldGEgPSBmbWRz\nW2ZtZHMubGVuZ3RoIC0gMV0uZ2V0RGVjbGFyaW5nTWV0YURhdGEoKTsKICAg\nICAgICBwa3MgPSBuZXcgT2JqZWN0W2ZtZHMubGVuZ3RoXTsKICAgICAgICBp\nZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBwa3M7CgogICAg\nICAgIGlmICghTW9kaWZpZXIuaXNBYnN0cmFjdChtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKS5nZXRNb2RpZmllcnMoKSkpIHsKICAgICAgICAgICAgLy8gY29w\neSBmaWVsZHMgZnJvbSB0aGUgb2lkCiAgICAgICAgICAgIFByaW1hcnlLZXlG\naWVsZE1hbmFnZXIgY29uc3VtZXIgPSBuZXcgUHJpbWFyeUtleUZpZWxkTWFu\nYWdlcigpOwogICAgICAgICAgICBjb25zdW1lci5zZXRTdG9yZShwa3MpOwog\nICAgICAgICAgICBQQ1JlZ2lzdHJ5LmNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0\nSWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICBj\nb25zdW1lciwgb2lkKTsKICAgICAgICAgICAgcmV0dXJuIGNvbnN1bWVyLmdl\ndFN0b3JlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBkZWZhdWx0IHRvIHJl\nZmxlY3Rpb24KICAgICAgICBpZiAobWV0YS5pc09iamVjdElkVHlwZVNoYXJl\nZCgpKQogICAgICAgICAgICBvaWQgPSAoKE9iamVjdElkKSBvaWQpLmdldElk\nKCk7CiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IG9pZC5nZXRDbGFzcygpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xh\nc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpCiAgICAgICAgICAgICAgICBwa3Nb\naV0gPSBSZWZsZWN0aW9uLmdldChvaWQsIFJlZmxlY3Rpb24uZmluZEZpZWxk\nKG9pZFR5cGUsIAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0TmFt\nZSgpLCB0cnVlKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIHBrc1tpXSA9IFJlZmxlY3Rpb24uZ2V0KG9pZCwgUmVmbGVjdGlvbi5maW5k\nR2V0dGVyKG9pZFR5cGUsCiAgICAgICAgICAgICAgICAgICAgZm1kc1tpXS5n\nZXROYW1lKCksIHRydWUpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBr\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBvYmplY3Qg\naWQgY29uc3RydWN0ZWQgZnJvbSB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgdmFs\ndWVzLgogICAgICogVmFsdWVzIGZvciBQQyBwcmltYXJ5IGtleSBmaWVsZHMg\nc2hvdWxkIGJlIHRoZSBwcmltYXJreSBrZXkgdmFsdWUgb3IKICAgICAqIG9p\nZCB2YWx1ZSBvZiB0aGUgcmVsYXRlZCBpbnN0YW5jZSAoZGVwZW5kaW5nIG9u\nIAogICAgICoge0BsaW5rIEZpZWxkTWV0YURhdGEjaXNPYmplY3RJZEZpZWxk\nSWRPZlBDfSkuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGZy\nb21QS1ZhbHVlcyhPYmplY3RbXSBwa3MsIENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIGlmIChtZXRhID09IG51bGwgfHwgcGtzID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBib29sZWFuIGNvbnZl\ncnQgPSAhbWV0YS5nZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigp\nLgogICAgICAgICAgICBnZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKS5nZXRT\ndHJpY3RJZGVudGl0eVZhbHVlcygpOwogICAgICAgIGlmIChtZXRhLmlzT3Bl\nbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgaW50IHR5cGUgPSBtZXRh\nLmdldFByaW1hcnlLZXlGaWVsZHMoKVswXS5nZXRPYmplY3RJZEZpZWxkVHlw\nZUNvZGUoKTsKICAgICAgICAgICAgT2JqZWN0IHZhbCA9IChjb252ZXJ0KSA/\nIEphdmFUeXBlcy5jb252ZXJ0KHBrc1swXSwgdHlwZSkgOiBwa3NbMF07CiAg\nICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgICAgIGlmICghY29udmVy\ndCAmJiAhKHZhbCBpbnN0YW5jZW9mIEJ5dGUpKQogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKCIhKHggaW5z\ndGFuY2VvZiBCeXRlKSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgQnl0ZUlkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAg\nICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFs\nKS5ieXRlVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DSEFSOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9P\nQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFySWQobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHZhbCA9PSBudWxsID8gMCA6ICgoQ2hhcmFjdGVyKSB2YWwpLmNoYXJWYWx1\nZSgpKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3Rh\nbmNlb2YgRG91YmxlKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IENsYXNzQ2FzdEV4Y2VwdGlvbigiISh4IGluc3RhbmNlb2YgRG91Ymxl\nKSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRG91YmxlSWQo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAg\nICAgIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZh\nbHVlKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3Rh\nbmNlb2YgRmxvYXQpKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKCIhKHggaW5zdGFuY2VvZiBGbG9hdCki\nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0SWQobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmZsb2F0VmFsdWUo\nKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAg\nICAgICAgICAgIGlmICghY29udmVydCAmJiAhKHZhbCBpbnN0YW5jZW9mIElu\ndGVnZXIpKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xh\nc3NDYXN0RXhjZXB0aW9uKCIhKHggaW5zdGFuY2VvZiBJbnRlZ2VyKSIpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSW50SWQobWV0YS5nZXRE\nZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9\nPSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmludFZhbHVlKCkpOwogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICAgICAg\nICAgIGlmICghY29udmVydCAmJiAhKHZhbCBpbnN0YW5jZW9mIExvbmcpKQog\nICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhj\nZXB0aW9uKCIhKHggaW5zdGFuY2VvZiBMb25nKSIpOwogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgTG9uZ0lkKG1ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAg\nOiAoKE51bWJlcikgdmFsKS5sb25nVmFsdWUoKSk7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgICAgICBpZiAo\nIWNvbnZlcnQgJiYgISh2YWwgaW5zdGFuY2VvZiBTaG9ydCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRpb24o\nIiEoeCBpbnN0YW5jZW9mIFNob3J0KSIpOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBuZXcgU2hvcnRJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChO\ndW1iZXIpIHZhbCkuc2hvcnRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IFN0cmluZ0lkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCAoU3Ry\naW5nKSB2YWwpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFU\nRToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGVJZChtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSwgKERhdGUpIHZhbCk7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBPYmplY3RJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgdmFsKTsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3Rh\nbmNlb2YgQmlnRGVjaW1hbCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRpb24oIiEoeCBpbnN0YW5jZW9mIEJp\nZ0RlY2ltYWwpIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBC\naWdEZWNpbWFsSWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIChCaWdEZWNp\nbWFsKXZhbCk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJ\nTlRFR0VSOgogICAgICAgICAgICAgICAgICAgIGlmICghY29udmVydCAmJiAh\nKHZhbCBpbnN0YW5jZW9mIEJpZ0ludGVnZXIpKQogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKCIhKHggaW5z\ndGFuY2VvZiBCaWdJbnRlZ2VyKSIpOwogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgQmlnSW50ZWdlcklkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nLCAoQmlnSW50ZWdlcil2YWwpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY29w\neSBwa3MgdG8gb2lkCiAgICAgICAgaWYgKCFNb2RpZmllci5pc0Fic3RyYWN0\nKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE1vZGlmaWVycygpKSkgewog\nICAgICAgICAgICBPYmplY3Qgb2lkID0gUENSZWdpc3RyeS5uZXdPYmplY3RJ\nZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgIFByaW1h\ncnlLZXlGaWVsZE1hbmFnZXIgcHJvZHVjZXIgPSBuZXcgUHJpbWFyeUtleUZp\nZWxkTWFuYWdlcigpOwogICAgICAgICAgICBwcm9kdWNlci5zZXRTdG9yZShw\na3MpOwogICAgICAgICAgICBpZiAoY29udmVydCkKICAgICAgICAgICAgICAg\nIHByb2R1Y2VyLnNldE1ldGFEYXRhKG1ldGEpOwogICAgICAgICAgICBQQ1Jl\nZ2lzdHJ5LmNvcHlLZXlGaWVsZHNUb09iamVjdElkKG1ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgcHJvZHVjZXIsIG9pZCk7CiAg\nICAgICAgICAgIHJldHVybiBvaWQ7CiAgICAgICAgfQoKICAgICAgICAvLyBk\nZWZhdWx0IHRvIHJlZmxlY3Rpb24KICAgICAgICBDbGFzcyBvaWRUeXBlID0g\nbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBpZiAoTW9kaWZpZXIu\naXNBYnN0cmFjdChvaWRUeXBlLmdldE1vZGlmaWVycygpKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm9iamVjdGlk\nLWFic3RyYWN0IiwgbWV0YSkpOwogICAgICAgIE9iamVjdCBjb3B5ID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb3B5ID0gQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihvaWRUeXBlKSk7CiAgICAgICAg\nfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgaWYgKHQgaW5z\ndGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKQogICAgICAgICAg\nICAgICAgdCA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgdCkuZ2V0\nRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhj\nZXB0aW9uKHQpOwogICAgICAgIH0KCiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZtZHMgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBP\nYmplY3QgdmFsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YWwgPSAoY29udmVydCkgPyBK\nYXZhVHlwZXMuY29udmVydChwa3NbaV0sCiAgICAgICAgICAgICAgICBmbWRz\nW2ldLmdldE9iamVjdElkRmllbGRUeXBlQ29kZSgpKSA6IHBrc1tpXTsKICAg\nICAgICAgICAgaWYgKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0\nYURhdGEuQUNDRVNTX0ZJRUxEKQogICAgICAgICAgICAgICAgUmVmbGVjdGlv\nbi5zZXQoY29weSwgUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwgCiAg\nICAgICAgICAgICAgICAgICAgZm1kc1tpXS5nZXROYW1lKCksIHRydWUpLCB2\nYWwpOyAKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgUmVmbGVj\ndGlvbi5zZXQoY29weSwgUmVmbGVjdGlvbi5maW5kU2V0dGVyKG9pZFR5cGUs\nIAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0TmFtZSgpLCBmbWRz\nW2ldLmdldERlY2xhcmVkVHlwZSgpLCB0cnVlKSwgdmFsKTsKICAgICAgICB9\nCgogICAgICAgIGlmIChtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAg\nICAgICAgICAgIGNvcHkgPSBuZXcgT2JqZWN0SWQobWV0YS5nZXREZXNjcmli\nZWRUeXBlKCksIGNvcHkpOwogICAgICAgIHJldHVybiBjb3B5OwogICAgfQoK\nICAgIC8qKgogICAgICogQ29weSB0aGUgZ2l2ZW4gb2lkIHZhbHVlLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBjb3B5KE9iamVjdCBvaWQs\nIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51\nbGwgfHwgb2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBpZiAobWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAg\nICAgICAgIC8vIHVzZSBtZXRhIHR5cGUgaW5zdGVhZCBvZiBvaWQgdHlwZSBp\nbiBjYXNlIGl0J3MgYSBzdWJjbGFzcwogICAgICAgICAgICBDbGFzcyBjbHMg\nPSBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgT3BlbkpQ\nQUlkIGtvaWQgPSAoT3BlbkpQQUlkKSBvaWQ7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGEgcGsgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKVswXTsK\nICAgICAgICAgICAgc3dpdGNoIChway5nZXRPYmplY3RJZEZpZWxkVHlwZUNv\nZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZUlkKGNscywgKChCeXRl\nSWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29p\nZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNI\nQVJfT0JKOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcklk\nKGNscywgKChDaGFySWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IERvdWJsZUlkKGNscywgKChEb3VibGVJZCkgb2lkKS5nZXRJ\nZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNz\nZXMoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0SWQoY2xzLCAoKEZs\nb2F0SWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAg\na29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UX09CSjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEludElk\nKGNscywgKChJbnRJZCkgb2lkKS5nZXRJZCgpLAogICAgICAgICAgICAgICAg\nICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBMb25nSWQoY2xzLCAoKExvbmdJZCkgb2lkKS5nZXRJZCgpLAogICAg\nICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IFNob3J0SWQoY2xzLCAoKFNob3J0SWQpIG9p\nZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5oYXNT\ndWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU1RSSU5HOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5n\nSWQoY2xzLCBvaWQudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgZW1iZWQgPSBway5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAg\nICAgICAgICAgICAgICAgT2JqZWN0IGlubmVyID0ga29pZC5nZXRJZE9iamVj\ndCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChlbWJlZCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBpbm5lciA9IGNvcHkoaW5uZXIsIGVt\nYmVkLCBlbWJlZC5nZXRGaWVsZHMoKSk7CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBPYmplY3RJZChjbHMsIGlubmVyLCBrb2lkLmhhc1N1YmNs\nYXNzZXMoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpF\nQ1Q6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RJZChj\nbHMsIGtvaWQuZ2V0SWRPYmplY3QoKSwgCiAgICAgICAgICAgICAgICAgICAg\nICAgIGtvaWQuaGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBEYXRlSWQoY2xzLCAoKERhdGVJZCkgb2lkKS5nZXRJZCgpLAogICAg\nICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQmlnRGVjaW1hbElkKGNscywg\nKChCaWdEZWNpbWFsSWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IEJpZ0ludGVnZXJJZChjbHMsICgoQmlnSW50ZWdl\ncklkKSBvaWQpLmdldElkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGtv\naWQuaGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0\naW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNy\nZWF0ZSBhIG5ldyBwYyBpbnN0YW5jZSBvZiB0aGUgcmlnaHQgdHlwZSwgc2V0\nIGl0cyBrZXkgZmllbGRzCiAgICAgICAgLy8gdG8gdGhlIG9yaWdpbmFsIG9p\nZCB2YWx1ZXMsIHRoZW4gY29weSBpdHMga2V5IGZpZWxkcyB0byBhIG5ldwog\nICAgICAgIC8vIG9pZCBpbnN0YW5jZQogICAgICAgIGlmICghTW9kaWZpZXIu\naXNBYnN0cmFjdChtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXRNb2RpZmll\ncnMoKSkKICAgICAgICAgICAgJiYgIWhhc1BDUHJpbWFyeUtleUZpZWxkcyht\nZXRhKSkgewogICAgICAgICAgICBDbGFzcyB0eXBlID0gbWV0YS5nZXREZXNj\ncmliZWRUeXBlKCk7CiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYyA9IFBDUmVnaXN0cnkubmV3SW5zdGFuY2UodHlwZSwgbnVsbCwgb2lkLCAK\nICAgICAgICAgICAgICAgICBmYWxzZSk7CiAgICAgICAgICAgIE9iamVjdCBj\nb3B5ID0gcGMucGNOZXdPYmplY3RJZEluc3RhbmNlKCk7CiAgICAgICAgICAg\nIHBjLnBjQ29weUtleUZpZWxkc1RvT2JqZWN0SWQoY29weSk7CiAgICAgICAg\nICAgIHJldHVybiBjb3B5OwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IGNv\ncHkgPSAoIW1ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgPyBvaWQKICAg\nICAgICAgICAgOiAoKE9iamVjdElkKSBvaWQpLmdldElkKCk7CiAgICAgICAg\nY29weSA9IGNvcHkoY29weSwgbWV0YSwgbWV0YS5nZXRQcmltYXJ5S2V5Rmll\nbGRzKCkpOwogICAgICAgIGlmIChtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVk\nKCkpCiAgICAgICAgICAgIGNvcHkgPSBuZXcgT2JqZWN0SWQobWV0YS5nZXRE\nZXNjcmliZWRUeXBlKCksIGNvcHksCiAgICAgICAgICAgICAgICAoKE9wZW5K\nUEFJZCkgb2lkKS5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgIHJldHVybiBj\nb3B5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgYW55\nIG9mIHRoZSBnaXZlbiB0eXBlJ3MgcHJpbWFyeSBrZXkgZmllbGRzIGFyZSAK\nICAgICAqIHBlcnNpc3RlbnQgb2JqZWN0cy4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgYm9vbGVhbiBoYXNQQ1ByaW1hcnlLZXlGaWVsZHMoQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlm\nIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMu\nUEMpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb3B5IHRoZSBnaXZl\nbiBpZGVudGl0eSBvYmplY3QgdXNpbmcgcmVmbGVjdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGNvcHkoT2JqZWN0IG9pZCwgQ2xh\nc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRz\nKSB7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IG9pZC5nZXRDbGFz\ncygpOwogICAgICAgIE9iamVjdCBjb3B5ID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICBjb3B5ID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0\nYW5jZUFjdGlvbihvaWRUeXBlKSk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dh\nYmxlIHQpIHsKICAgICAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBQcml2aWxl\nZ2VkQWN0aW9uRXhjZXB0aW9uKQogICAgICAgICAgICAgICAgdCA9ICgoUHJp\ndmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgdCkuZ2V0RXhjZXB0aW9uKCk7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHQpOwogICAg\nICAgIH0KCiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAgICAgT2JqZWN0IHZh\nbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgp\nICE9IEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChtZXRhLmdldEFj\nY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkgewog\nICAgICAgICAgICAgICAgICAgIGZpZWxkID0gUmVmbGVjdGlvbi5maW5kRmll\nbGQob2lkVHlwZSwgZm1kc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAg\nICAgICAgICAgIHRydWUpOwogICAgICAgICAgICAgICAgICAgIFJlZmxlY3Rp\nb24uc2V0KGNvcHksIGZpZWxkLCBSZWZsZWN0aW9uLmdldChvaWQsIGZpZWxk\nKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBwcm9wZXJ0eQogICAg\nICAgICAgICAgICAgICAgIHZhbCA9IFJlZmxlY3Rpb24uZ2V0KG9pZCwgUmVm\nbGVjdGlvbi5maW5kR2V0dGVyKG9pZFR5cGUsCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZtZHNbaV0uZ2V0TmFtZSgpLCB0cnVlKSk7CiAgICAgICAgICAg\nICAgICAgICAgUmVmbGVjdGlvbi5zZXQoY29weSwgUmVmbGVjdGlvbi5maW5k\nU2V0dGVyKG9pZFR5cGUsIGZtZHNbaV0uCiAgICAgICAgICAgICAgICAgICAg\nICAgIGdldE5hbWUoKSwgZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlwZSgp\nLCB0cnVlKSwgdmFsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gY29weTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgZmllbGQgdmFsdWUg\nZnJvbSB0aGUgZ2l2ZW4gb2lkLgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIE9iamVjdCBnZXQoT2JqZWN0IG9pZCwgRmllbGRNZXRhRGF0YSBmbWQpIHsK\nICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIGlmIChvaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQpCiAg\nICAgICAgICAgIHJldHVybiAoKE9wZW5KUEFJZCkgb2lkKS5nZXRJZE9iamVj\ndCgpOwoKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBmbWQuZ2V0RGVm\naW5pbmdNZXRhRGF0YSgpOwogICAgICAgIENsYXNzIG9pZFR5cGUgPSBvaWQu\nZ2V0Q2xhc3MoKTsKICAgICAgICBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkg\nPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpCiAgICAgICAgICAgIHJl\ndHVybiBSZWZsZWN0aW9uLmdldChvaWQsIFJlZmxlY3Rpb24uZmluZEZpZWxk\nKG9pZFR5cGUsIAogICAgICAgICAgICAgICAgZm1kLmdldE5hbWUoKSwgdHJ1\nZSkpOwogICAgICAgIHJldHVybiBSZWZsZWN0aW9uLmdldChvaWQsIFJlZmxl\nY3Rpb24uZmluZEdldHRlcihvaWRUeXBlLCBmbWQuZ2V0TmFtZSgpLAogICAg\nICAgICAgICB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0\nZSBhbiBhcHBsaWNhdGlvbiBpZCBiYXNlZCBvbiB0aGUgY3VycmVudCBwcmlt\nYXJ5IGtleSBmaWVsZCBzdGF0ZQogICAgICogb2YgdGhlIGdpdmVuIGluc3Rh\nbmNlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBjcmVhdGUo\nUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICBpZiAocGMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIE9iamVjdCBvaWQgPSBwYy5wY05ld09iamVjdElkSW5z\ndGFuY2UoKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICBpZiAoIW1ldGEuaXNPcGVuSlBBSWRl\nbnRpdHkoKSkgewogICAgICAgICAgICBwYy5wY0NvcHlLZXlGaWVsZHNUb09i\namVjdElkKG9pZCk7CiAgICAgICAgICAgIHJldHVybiBvaWQ7CiAgICAgICAg\nfQoKICAgICAgICBGaWVsZE1ldGFEYXRhIHBrID0gbWV0YS5nZXRQcmltYXJ5\nS2V5RmllbGRzKClbMF07CiAgICAgICAgaWYgKHBrLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSAhPSBKYXZhVHlwZXMuT0lEKQogICAgICAgICAgICByZXR1cm4g\nb2lkOwoKICAgICAgICAvLyBhbHdheXMgY29weSBvaWQgb2JqZWN0IGluIGNh\nc2UgZmllbGQgdmFsdWUgbXV0YXRlcyBvciBiZWNvbWVzCiAgICAgICAgLy8g\nbWFuYWdlZAogICAgICAgIE9iamVjdElkIG9iamlkID0gKE9iamVjdElkKSBv\naWQ7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBlbWJlZCA9IHBrLmdldEVtYmVk\nZGVkTWV0YURhdGEoKTsKICAgICAgICBvYmppZC5zZXRJZChjb3B5KG9iamlk\nLmdldElkKCksIGVtYmVkLCBlbWJlZC5nZXRGaWVsZHMoKSkpOwogICAgICAg\nIHJldHVybiBvYmppZDsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2lnbiBh\nbiBhcHBsaWNhdGlvbiBpZGVudGl0eSBvYmplY3QgdG8gdGhlIGdpdmVuIHN0\nYXRlLCBvciByZXR1cm4KICAgICAqIGZhbHNlIGlmIGRldGVybWluaW5nIHRo\nZSBhcHBsaWNhdGlvbiBpZGVudGl0eSByZXF1aXJlcyBhIGZsdXNoLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gYXNzaWduKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIFN0b3JlTWFuYWdlciBzdG9yZSwKICAgICAgICBi\nb29sZWFuIHByZUZsdXNoKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRh\nID0gc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICBpZiAobWV0YS5nZXRJZGVu\ndGl0eVR5cGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQog\nICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKCiAg\nICAgICAgYm9vbGVhbiByZXQ7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBr\ncyA9IG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgIGlmICht\nZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkKICAgICAgICAgICAgJiYgcGtzWzBd\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0lEKSB7CiAg\nICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb2lkc20gPSBuZXcgT2Jq\nZWN0SWRTdGF0ZU1hbmFnZXIKICAgICAgICAgICAgICAgIChzbS5mZXRjaE9i\namVjdEZpZWxkKHBrc1swXS5nZXRJbmRleCgpKSwgc20sIHBrc1swXSk7CiAg\nICAgICAgICAgIHJldCA9IGFzc2lnbihvaWRzbSwgc3RvcmUsIHBrc1swXS5n\nZXRFbWJlZGRlZE1ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICBnZXRGaWVs\nZHMoKSwgcHJlRmx1c2gpOwogICAgICAgICAgICBzbS5zdG9yZU9iamVjdEZp\nZWxkKHBrc1swXS5nZXRJbmRleCgpLAogICAgICAgICAgICAgICAgb2lkc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAgICAgIH0gZWxzZQogICAgICAg\nICAgICByZXQgPSBhc3NpZ24oc20sIHN0b3JlLCBtZXRhLmdldFByaW1hcnlL\nZXlGaWVsZHMoKSwgcHJlRmx1c2gpOwogICAgICAgIGlmICghcmV0KQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGJhc2Ugb2lkIG9u\nIGZpZWxkIHZhbHVlcwogICAgICAgIHNtLnNldE9iamVjdElkKGNyZWF0ZShz\nbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSwgbWV0YSkpOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQXNzaWduIGdlbmVy\nYXRlZCB2YWx1ZXMgdG8gZ2l2ZW4gcHJpbWFyeSBrZXkgZmllbGRzLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGFzc2lnbihPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBTdG9yZU1hbmFnZXIgc3RvcmUsCiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIHBrcywgYm9vbGVhbiBwcmVGbHVzaCkgewogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGtzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICAvLyBJZiB3ZSBhcmUgZ2VuZXJhdGluZyB2YWx1ZXMuLi4KICAg\nICAgICAgICAgaWYgKHBrc1tpXS5nZXRWYWx1ZVN0cmF0ZWd5KCkgIT0gVmFs\ndWVTdHJhdGVnaWVzLk5PTkUpIHsKICAgICAgICAgICAgICAgIC8vIElmIGEg\ndmFsdWUgYWxyZWFkeSBleGlzdHMgb24gdGhpcyBmaWVsZCwgdGhyb3cgZXhj\nZXB0aW9uLgogICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBjb25zaWRlcmVk\nIGFuIGFwcGxpY2F0aW9uIGNvZGluZyBlcnJvci4KICAgICAgICAgICAgICAg\nIGlmICghc20uaXNEZWZhdWx0VmFsdWUocGtzW2ldLmdldEluZGV4KCkpKQog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYzIuZ2V0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nImV4aXN0aW5nLXZhbHVlLW92ZXJyaWRlLWV4Y2VwIiwgcGtzW2ldCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRGdWxsTmFtZShm\nYWxzZSkpKTsKICAgICAgICAgICAgICAgIC8vIEFzc2lnbiB0aGUgZ2VuZXJh\ndGVkIHZhbHVlCiAgICAgICAgICAgICAgICBpZiAoc3RvcmUuYXNzaWduRmll\nbGQoc20sIHBrc1tpXS5nZXRJbmRleCgpLCBwcmVGbHVzaCkpCiAgICAgICAg\nICAgICAgICAgICAgcGtzW2ldLnNldFZhbHVlR2VuZXJhdGVkKHRydWUpOwog\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIGNsYXNzIHVzZWQgdG8gdHJh\nbnNmZXIgcGsgdmFsdWVzIHRvL2Zyb20gYXBwbGljYXRpb24gb2lkcy4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUHJpbWFyeUtleUZpZWxk\nTWFuYWdlcgogICAgICAgIGltcGxlbWVudHMgRmllbGRNYW5hZ2VyIHsKCiAg\nICAgICAgcHJpdmF0ZSBPYmplY3RbXSBfc3RvcmUgPSBudWxsOwogICAgICAg\nIHByaXZhdGUgaW50IF9pbmRleCA9IDA7CiAgICAgICAgcHJpdmF0ZSBDbGFz\nc01ldGFEYXRhIF9tZXRhID0gbnVsbDsKCiAgICAgICAgcHVibGljIHZvaWQg\nc2V0TWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgICAg\nIF9tZXRhID0gbWV0YTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmpl\nY3RbXSBnZXRTdG9yZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdG9yZTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldFN0b3JlKE9iamVj\ndFtdIHN0b3JlKSB7CiAgICAgICAgICAgIF9zdG9yZSA9IHN0b3JlOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVCb29sZWFuRmllbGQo\naW50IGZpZWxkLCBib29sZWFuIHZhbCkgewogICAgICAgICAgICBzdG9yZSgo\ndmFsKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVCeXRlRmllbGQoaW50IGZp\nZWxkLCBieXRlIHZhbCkgewogICAgICAgICAgICBzdG9yZShuZXcgQnl0ZSh2\nYWwpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hh\nckZpZWxkKGludCBmaWVsZCwgY2hhciB2YWwpIHsKICAgICAgICAgICAgc3Rv\ncmUobmV3IENoYXJhY3Rlcih2YWwpKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIHN0b3JlU2hvcnRGaWVsZChpbnQgZmllbGQsIHNob3J0IHZh\nbCkgewogICAgICAgICAgICBzdG9yZShuZXcgU2hvcnQodmFsKSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUludEZpZWxkKGludCBm\naWVsZCwgaW50IHZhbCkgewogICAgICAgICAgICBzdG9yZShOdW1iZXJzLnZh\nbHVlT2YodmFsKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBz\ndG9yZUxvbmdGaWVsZChpbnQgZmllbGQsIGxvbmcgdmFsKSB7CiAgICAgICAg\nICAgIHN0b3JlKE51bWJlcnMudmFsdWVPZih2YWwpKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlRmxvYXRGaWVsZChpbnQgZmllbGQs\nIGZsb2F0IHZhbCkgewogICAgICAgICAgICBzdG9yZShuZXcgRmxvYXQodmFs\nKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZURvdWJs\nZUZpZWxkKGludCBmaWVsZCwgZG91YmxlIHZhbCkgewogICAgICAgICAgICBz\ndG9yZShuZXcgRG91YmxlKHZhbCkpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHZvaWQgc3RvcmVTdHJpbmdGaWVsZChpbnQgZmllbGQsIFN0cmluZyB2\nYWwpIHsKICAgICAgICAgICAgc3RvcmUodmFsKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIHN0b3JlT2JqZWN0RmllbGQoaW50IGZpZWxkLCBP\nYmplY3QgdmFsKSB7CiAgICAgICAgICAgIHN0b3JlKHZhbCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBmZXRjaEJvb2xlYW5GaWVsZChp\nbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuIChyZXRyaWV2ZShmaWVs\nZCkgPT0gQm9vbGVhbi5UUlVFKSA/IHRydWUgOiBmYWxzZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBjaGFyIGZldGNoQ2hhckZpZWxkKGludCBmaWVs\nZCkgewogICAgICAgICAgICByZXR1cm4gKChDaGFyYWN0ZXIpIHJldHJpZXZl\nKGZpZWxkKSkuY2hhclZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgYnl0ZSBmZXRjaEJ5dGVGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAg\nICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkpLmJ5dGVWYWx1\nZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHNob3J0IGZldGNoU2hv\ncnRGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVt\nYmVyKSByZXRyaWV2ZShmaWVsZCkpLnNob3J0VmFsdWUoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBpbnQgZmV0Y2hJbnRGaWVsZChpbnQgZmllbGQp\nIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVs\nZCkpLmludFZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgbG9u\nZyBmZXRjaExvbmdGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0\ndXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkpLmxvbmdWYWx1ZSgpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGZsb2F0IGZldGNoRmxvYXRGaWVs\nZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBy\nZXRyaWV2ZShmaWVsZCkpLmZsb2F0VmFsdWUoKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBkb3VibGUgZmV0Y2hEb3VibGVGaWVsZChpbnQgZmllbGQp\nIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVs\nZCkpLmRvdWJsZVZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nU3RyaW5nIGZldGNoU3RyaW5nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAg\nICAgIHJldHVybiAoU3RyaW5nKSByZXRyaWV2ZShmaWVsZCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGZldGNoT2JqZWN0RmllbGQoaW50\nIGZpZWxkKSB7CiAgICAgICAgICAgIHJldHVybiByZXRyaWV2ZShmaWVsZCk7\nCiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgc3RvcmUoT2JqZWN0\nIHZhbCkgewogICAgICAgICAgICBfc3RvcmVbX2luZGV4KytdID0gdmFsOwog\nICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBPYmplY3QgcmV0cmlldmUoaW50\nIGZpZWxkKSB7CiAgICAgICAgICAgIE9iamVjdCB2YWwgPSBfc3RvcmVbX2lu\nZGV4KytdOwogICAgICAgICAgICBpZiAoX21ldGEgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICAg\nICAgdmFsID0gSmF2YVR5cGVzLmNvbnZlcnQodmFsLCBmbWQuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICB2YWwgPSBKYXZhVHlwZXMuY29udmVydCh2YWwsIEphdmFU\neXBlcy5nZXRUeXBlQ29kZShmbWQuCiAgICAgICAgICAgICAgICAgICAgICAg\nIGdldE9iamVjdElkRmllbGRUeXBlKCkpKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICByZXR1cm4gdmFsOwoJCX0KCX0KfQo=\n","encoding":"base64"}

