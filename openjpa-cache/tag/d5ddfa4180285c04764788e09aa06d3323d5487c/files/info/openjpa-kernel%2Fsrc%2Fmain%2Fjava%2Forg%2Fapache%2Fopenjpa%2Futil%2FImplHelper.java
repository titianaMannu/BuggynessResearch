{"sha":"f25dfb4f02bf34134c2b36f47e3f4a32468f6fb9","node_id":"MDQ6QmxvYjIwNjM2NDpmMjVkZmI0ZjAyYmYzNDEzNGMyYjM2ZjQ3ZTNmNGEzMjQ2OGY2ZmI5","size":12422,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f25dfb4f02bf34134c2b36f47e3f4a32468f6fb9","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbDsNCg0KaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7DQppbXBvcnQg\namF2YS51dGlsLkJpdFNldDsNCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlv\nbjsNCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7DQppbXBvcnQgamF2\nYS51dGlsLkl0ZXJhdG9yOw0KaW1wb3J0IGphdmEudXRpbC5NYXA7DQoNCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNh\ncGFibGU7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENS\nZWdpc3RyeTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5T\ndGF0ZU1hbmFnZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFu\nY2UuTWFuYWdlZEluc3RhbmNlUHJvdmlkZXI7DQppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGluZ1BlcnNpc3RlbmNlQ2FwYWJs\nZTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5SdW50aW1l\nVW5lbmhhbmNlZENsYXNzc2VzTW9kZXM7DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb247DQppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Mb2NrTWFuYWdlcjsNCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7\nDQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5QQ1N0YXRlOw0K\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVDb250ZXh0\nOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5h\nZ2VyOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5DbG9z\nZWFibGU7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlJl\nZmVyZW5jZU1hcDsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuVVVJREdlbmVyYXRvcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50UmVmZXJlbmNlSGFzaE1h\ncDsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFE\nYXRhOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0\nYURhdGE7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5\ncGVzOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlNlcXVlbmNl\nTWV0YURhdGE7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFs\ndWVTdHJhdGVnaWVzOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25m\nLk9wZW5KUEFDb25maWd1cmF0aW9uOw0KDQovKioNCiAqIEhlbHBlciBmb3Ig\nT3BlbkpQQSBiYWNrLWVuZHMuDQogKg0KICogQHNpbmNlIDAuMy4wDQogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQ0KICogQG5vamF2YWRvYw0KICovDQpwdWJsaWMg\nY2xhc3MgSW1wbEhlbHBlciB7DQoNCiAgICAvLyBDYWNoZSBmb3IgZnJvbS90\nbyB0eXBlIGFzc2lnbm1lbnRzDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nTWFwIF9hc3NpZ25hYmxlVHlwZXMgPQ0KICAgICAgICBuZXcgQ29uY3VycmVu\ndFJlZmVyZW5jZUhhc2hNYXAoUmVmZXJlbmNlTWFwLldFQUssIFJlZmVyZW5j\nZU1hcC5IQVJEKTsNCg0KICAgIC8vIG1hcCBvZiBhbGwgbmV3IHVuZW5oYW5j\nZWQgaW5zdGFuY2VzIGFjdGl2ZSBpbiB0aGlzIGNsYXNzbG9hZGVyDQogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBNYXAgX3VuZW5oYW5jZWRJbnN0YW5jZU1h\ncCA9DQogICAgICAgIG5ldyBDb25jdXJyZW50UmVmZXJlbmNlSGFzaE1hcChS\nZWZlcmVuY2VNYXAuV0VBSywgUmVmZXJlbmNlTWFwLkhBUkQpIHsNCg0KICAg\nICAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4gZXEoT2JqZWN0IHgsIE9iamVj\ndCB5KSB7DQogICAgICAgICAgICAgICAgLy8gdGhlIEVudHJpZXMgaW4gQ29u\nY3VycmVudFJlZmVyZW5jZUhhc2hNYXAgZGVsZWdhdGUgYmFjayB0bw0KICAg\nICAgICAgICAgICAgIC8vIGVxKCkgaW4gdGhlaXIgZXF1YWxzKCkgaW1wbHMN\nCiAgICAgICAgICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIE1hcC5FbnRyeSkN\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmVxKHgsIHkpOw0K\nICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIHggPT0geTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHJv\ndGVjdGVkIGludCBoYyhPYmplY3Qgbykgew0KICAgICAgICAgICAgICAgIC8v\nIHRoZSBFbnRyaWVzIGluIENvbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFwIGRl\nbGVnYXRlIGJhY2sgdG8NCiAgICAgICAgICAgICAgICAvLyBoYygpIGluIHRo\nZWlyIGhhc2hDb2RlKCkgaW1wbHMNCiAgICAgICAgICAgICAgICBpZiAobyBp\nbnN0YW5jZW9mIE1hcC5FbnRyeSkNCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmhjKG8pOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIFN5c3RlbS5pZGVudGl0eUhhc2hDb2Rl\nKG8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgLyoqDQog\nICAgICogSGVscGVyIGZvciBzdG9yZSBtYW5hZ2VyIGltcGxlbWVudGF0aW9u\ncy4gVGhpcyBtZXRob2Qgc2ltcGx5IGRlbGVnYXRlcw0KICAgICAqIHRvIHRo\nZSBwcm9wZXIgc2luZ3VsYXIgbWV0aG9kIGZvciBlYWNoIHN0YXRlIG1hbmFn\nZXIuDQogICAgICoNCiAgICAgKiBAc2VlIFN0b3JlTWFuYWdlciNsb2FkQWxs\nDQogICAgICogQHNpbmNlIDAuNC4wDQogICAgICovDQogICAgcHVibGljIHN0\nYXRpYyBDb2xsZWN0aW9uIGxvYWRBbGwoQ29sbGVjdGlvbiBzbXMsIFN0b3Jl\nTWFuYWdlciBzdG9yZSwNCiAgICAgICAgUENTdGF0ZSBzdGF0ZSwgaW50IGxv\nYWQsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGNvbnRleHQp\nIHsNCiAgICAgICAgQ29sbGVjdGlvbiBmYWlsZWQgPSBudWxsOw0KICAgICAg\nICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtOw0KICAgICAgICBMb2NrTWFuYWdl\nciBsbTsNCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzbXMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgIHNtID0gKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIpIGl0ci5uZXh0KCk7DQogICAgICAgICAgICBp\nZiAoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkgPT0gbnVsbCkgew0KICAgICAg\nICAgICAgICAgIGlmICghc3RvcmUuaW5pdGlhbGl6ZShzbSwgc3RhdGUsIGZl\ndGNoLCBjb250ZXh0KSkNCiAgICAgICAgICAgICAgICAgICAgZmFpbGVkID0g\nYWRkRmFpbGVkSWQoc20sIGZhaWxlZCk7DQogICAgICAgICAgICB9IGVsc2Ug\naWYgKGxvYWQgIT0gU3RvcmVNYW5hZ2VyLkZPUkNFX0xPQURfTk9ORQ0KICAg\nICAgICAgICAgICAgIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLkhP\nTExPVykgew0KICAgICAgICAgICAgICAgIGxtID0gc20uZ2V0Q29udGV4dCgp\nLmdldExvY2tNYW5hZ2VyKCk7DQogICAgICAgICAgICAgICAgaWYgKCFzdG9y\nZS5sb2FkKHNtLCBzbS5nZXRVbmxvYWRlZChmZXRjaCksIGZldGNoLCANCiAg\nICAgICAgICAgICAgICAgICAgbG0uZ2V0TG9ja0xldmVsKHNtKSwgY29udGV4\ndCkpDQogICAgICAgICAgICAgICAgICAgIGZhaWxlZCA9IGFkZEZhaWxlZElk\nKHNtLCBmYWlsZWQpOw0KICAgICAgICAgICAgfSBlbHNlIGlmICghc3RvcmUu\nZXhpc3RzKHNtLCBjb250ZXh0KSkNCiAgICAgICAgICAgICAgICBmYWlsZWQg\nPSBhZGRGYWlsZWRJZChzbSwgZmFpbGVkKTsNCiAgICAgICAgfQ0KICAgICAg\nICByZXR1cm4gKGZhaWxlZCA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZ\nX0xJU1QgOiBmYWlsZWQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQWRk\nIGlkZW50aXR5IG9mIGdpdmVuIGluc3RhbmNlIHRvIGNvbGxlY3Rpb24uDQog\nICAgICovDQogICAgcHJpdmF0ZSBzdGF0aWMgQ29sbGVjdGlvbiBhZGRGYWls\nZWRJZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLA0KICAgICAgICBDb2xsZWN0\naW9uIGZhaWxlZCkgew0KICAgICAgICBpZiAoZmFpbGVkID09IG51bGwpDQog\nICAgICAgICAgICBmYWlsZWQgPSBuZXcgQXJyYXlMaXN0KCk7DQogICAgICAg\nIGZhaWxlZC5hZGQoc20uZ2V0SWQoKSk7DQogICAgICAgIHJldHVybiBmYWls\nZWQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2VuZXJhdGUgYSB2YWx1\nZSBmb3IgdGhlIGdpdmVuIG1ldGFkYXRhLCBvciByZXR1cm4gbnVsbC4gR2Vu\nZXJhdGVzDQogICAgICogdmFsdWVzIGZvciBodGUgZm9sbG93aW5nIHN0cmF0\nZWdpZXM6IHtAbGluayBWYWx1ZVN0cmF0ZWdpZXMjU0VRVUVOQ0V9LA0KICAg\nICAqIHtAbGluayBWYWx1ZVN0cmF0ZWdpZXMjVVVJRF9TVFJJTkd9LCB7QGxp\nbmsgVmFsdWVTdHJhdGVnaWVzI1VVSURfSEVYfQ0KICAgICAqLw0KICAgIHB1\nYmxpYyBzdGF0aWMgT2JqZWN0IGdlbmVyYXRlSWRlbnRpdHlWYWx1ZShTdG9y\nZUNvbnRleHQgY3R4LA0KICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEsIGlu\ndCB0eXBlQ29kZSkgew0KICAgICAgICByZXR1cm4gZ2VuZXJhdGVWYWx1ZShj\ndHgsIG1ldGEsIG51bGwsIHR5cGVDb2RlKTsNCiAgICB9DQoNCiAgICAvKioN\nCiAgICAgKiBHZW5lcmF0ZSBhIHZhbHVlIGZvciB0aGUgZ2l2ZW4gbWV0YWRh\ndGEsIG9yIHJldHVybiBudWxsLiBHZW5lcmF0ZXMNCiAgICAgKiB2YWx1ZXMg\nZm9yIGh0ZSBmb2xsb3dpbmcgc3RyYXRlZ2llczoge0BsaW5rIFZhbHVlU3Ry\nYXRlZ2llcyNTRVFVRU5DRX0sDQogICAgICoge0BsaW5rIFZhbHVlU3RyYXRl\nZ2llcyNVVUlEX1NUUklOR30sIHtAbGluayBWYWx1ZVN0cmF0ZWdpZXMjVVVJ\nRF9IRVh9DQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBPYmplY3QgZ2Vu\nZXJhdGVGaWVsZFZhbHVlKFN0b3JlQ29udGV4dCBjdHgsDQogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kKSB7DQogICAgICAgIHJldHVybiBnZW5lcmF0ZVZh\nbHVlKGN0eCwgZm1kLmdldERlZmluaW5nTWV0YURhdGEoKSwgZm1kLCANCiAg\nICAgICAgICAgIGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpOw0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIEdlbmVyYXRlIGEgdmFsdWUgZm9yIHRoZSBn\naXZlbiBtZXRhZGFhLg0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIE9i\namVjdCBnZW5lcmF0ZVZhbHVlKFN0b3JlQ29udGV4dCBjdHgsDQogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSwgRmllbGRNZXRhRGF0YSBmbWQsIGludCB0\neXBlQ29kZSkgew0KICAgICAgICBpbnQgc3RyYXRlZ3kgPSAoZm1kID09IG51\nbGwpID8gbWV0YS5nZXRJZGVudGl0eVN0cmF0ZWd5KCkNCiAgICAgICAgICAg\nIDogZm1kLmdldFZhbHVlU3RyYXRlZ3koKTsNCiAgICAgICAgc3dpdGNoIChz\ndHJhdGVneSkgew0KICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMu\nU0VRVUVOQ0U6DQogICAgICAgICAgICAgICAgU2VxdWVuY2VNZXRhRGF0YSBz\nbWQgPSAoZm1kID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgID8gbWV0\nYS5nZXRJZGVudGl0eVNlcXVlbmNlTWV0YURhdGEoKQ0KICAgICAgICAgICAg\nICAgICAgICA6IGZtZC5nZXRWYWx1ZVNlcXVlbmNlTWV0YURhdGEoKTsNCiAg\nICAgICAgICAgICAgICByZXR1cm4gSmF2YVR5cGVzLmNvbnZlcnQoc21kLmdl\ndEluc3RhbmNlKGN0eC5nZXRDbGFzc0xvYWRlcigpKS4NCiAgICAgICAgICAg\nICAgICAgICAgbmV4dChjdHgsIG1ldGEpLCB0eXBlQ29kZSk7DQogICAgICAg\nICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX1NUUklORzoNCiAgICAg\nICAgICAgICAgICByZXR1cm4gVVVJREdlbmVyYXRvci5uZXh0U3RyaW5nKCk7\nDQogICAgICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX0hFWDoN\nCiAgICAgICAgICAgICAgICByZXR1cm4gVVVJREdlbmVyYXRvci5uZXh0SGV4\nKCk7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIHJl\ndHVybiBudWxsOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAg\nICogUmV0dXJucyB0aGUgZmllbGRzIG9mIHRoZSBzdGF0ZSB0aGF0IHJlcXVp\ncmUgYW4gdXBkYXRlLg0KICAgICAqDQogICAgICogQHBhcmFtICBzbSAgdGhl\nIHN0YXRlIHRvIGNoZWNrDQogICAgICogQHJldHVybiB0aGUgQml0U2V0IG9m\nIGZpZWxkcyB0aGF0IG5lZWQgdXBkYXRlLCBvciBudWxsIGlmIG5vbmUNCiAg\nICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIEJpdFNldCBnZXRVcGRhdGVGaWVs\nZHMoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgew0KICAgICAgICBpZiAoKHNt\nLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBESVJUWQ0KICAgICAgICAgICAg\nJiYgKCFzbS5pc0ZsdXNoZWQoKSB8fCBzbS5pc0ZsdXNoZWREaXJ0eSgpKSkN\nCiAgICAgICAgICAgIHx8IChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5Q\nTkVXICYmIHNtLmlzRmx1c2hlZERpcnR5KCkpKSB7DQogICAgICAgICAgICBC\naXRTZXQgZGlydHkgPSBzbS5nZXREaXJ0eSgpOw0KICAgICAgICAgICAgaWYg\nKHNtLmlzRmx1c2hlZCgpKSB7DQogICAgICAgICAgICAgICAgZGlydHkgPSAo\nQml0U2V0KSBkaXJ0eS5jbG9uZSgpOw0KICAgICAgICAgICAgICAgIGRpcnR5\nLmFuZE5vdChzbS5nZXRGbHVzaGVkKCkpOw0KICAgICAgICAgICAgfQ0KICAg\nICAgICAgICAgaWYgKGRpcnR5Lmxlbmd0aCgpID4gMCkNCiAgICAgICAgICAg\nICAgICByZXR1cm4gZGlydHk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJu\nIG51bGw7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2xvc2UgdGhlIGdp\ndmVuIHJlc291cmNlLiBUaGUgcmVzb3VyY2UgY2FuIGJlIGFuIGV4dGVudCBp\ndGVyYXRvciwNCiAgICAgKiBxdWVyeSByZXN1bHQsIGxhcmdlIHJlc3VsdCBz\nZXQgcmVsYXRpb24sIG9yIGFueSBjbG9zZWFibGUgT3BlbkpQQQ0KICAgICAq\nIGNvbXBvbmVudC4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQg\nY2xvc2UoT2JqZWN0IG8pIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAg\nIGlmIChvIGluc3RhbmNlb2YgQ2xvc2VhYmxlKQ0KICAgICAgICAgICAgICAg\nICgoQ2xvc2VhYmxlKSBvKS5jbG9zZSgpOw0KICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAgICB0aHJvdyByZTsN\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOw0KICAgICAgICB9DQog\nICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBz\ncGVjaWZpZWQgY2xhc3MgaXMgYSB0eXBlIHRoYXQgY2FuIGJlIG1hbmFnZWQg\nYnkNCiAgICAgKiBPcGVuSlBBLg0KICAgICAqDQogICAgICogQHBhcmFtIHR5\ncGUgdGhlIGNsYXNzIHRvIHRlc3QNCiAgICAgKiBAcmV0dXJuIHRydWUgaWYg\ndGhlIGNsYXNzIGlzIG1hbmFnZWFibGUuDQogICAgICoNCiAgICAgKiBAc2lu\nY2UgMS4wLjANCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4g\naXNNYW5hZ2VkVHlwZShPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBDbGFz\ncyB0eXBlKSB7DQogICAgICAgIHJldHVybiAoUGVyc2lzdGVuY2VDYXBhYmxl\nLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkNCiAgICAgICAgICAgIHx8\nICh0eXBlICE9IG51bGwNCiAgICAgICAgICAgICAgICAmJiAoY29uZiA9PSBu\ndWxsIHx8IGNvbmYuZ2V0UnVudGltZVVuZW5oYW5jZWRDbGFzc2VzQ29uc3Rh\nbnQoKQ0KICAgICAgICAgICAgICAgICAgICA9PSBSdW50aW1lVW5lbmhhbmNl\nZENsYXNzc2VzTW9kZXMuU1VQUE9SVEVEKQ0KICAgICAgICAgICAgICAgICYm\nIFBDUmVnaXN0cnkuaXNSZWdpc3RlcmVkKHR5cGUpKSk7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBzcGVjaWZpZWQg\naW5zdGFuY2UgaXMgbWFuYWdlYWJsZS4NCiAgICAgKg0KICAgICAqIEBwYXJh\nbSBpbnN0YW5jZSB0aGUgb2JqZWN0IHRvIGNoZWNrDQogICAgICogQHJldHVy\nbiB0cnVlIGlmIHRoZSBpbnN0YW5jZSBpcyBhIHBlcnNpc3RlbnQgdHlwZSwg\nZmFsc2Ugb3RoZXJ3aXNlDQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBi\nb29sZWFuIGlzTWFuYWdlYWJsZShPYmplY3QgaW5zdGFuY2UpIHsNCiAgICAg\nICAgcmV0dXJuIGluc3RhbmNlIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBh\nYmxlDQogICAgICAgICAgICB8fCBpbnN0YW5jZSAhPSBudWxsICYmIFBDUmVn\naXN0cnkuaXNSZWdpc3RlcmVkKGluc3RhbmNlLmdldENsYXNzKCkpOw0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgcmVm\nZXJlbmNlZCAidG8iIGNsYXNzIGlzIGFzc2lnbmFibGUgdG8gdGhlICJmcm9t\nIg0KICAgICAqIGNsYXNzLiAgVGhpcyBoZWxwZXIgbWV0aG9kIHV0aWxpemVz\nIGEgY2FjaGUgdG8gaGVscCBhdm9pZCB0aGUgb3ZlcmhlYWQNCiAgICAgKiBv\nZiB0aGUgQ2xhc3MuaXNBc3NpZ25hYmxlRnJvbSgpIG1ldGhvZC4NCiAgICAg\nKg0KICAgICAqIEBwYXJhbSBmcm9tIHRhcmdldCBjbGFzcyBpbnN0YW5jZSB0\nbyBiZSBjaGVja2VkIGZvciBhc3NpZ25hYmlsaXR5DQogICAgICogQHBhcmFt\nIHRvIHNlY29uZCBjbGFzcyBpbnN0YW5jZSB0byBiZSBjaGVja2VkIGZvciBh\nc3NpZ25hYmlsaXR5DQogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSAidG8i\nIGNsYXNzIGlzIGFzc2lnbmFibGUgdG8gdGhlICJmcm9tIiBjbGFzcw0KICAg\nICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc0Fzc2lnbmFibGUo\nQ2xhc3MgZnJvbSwgQ2xhc3MgdG8pIHsNCiAgICAgICAgaWYgKGZyb20gPT0g\nbnVsbCB8fCB0byA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOw0KDQogICAgICAgIEJvb2xlYW4gaXNBc3NpZ25hYmxlID0gbnVsbDsNCiAg\nICAgICAgTWFwIGFzc2lnbmFibGVUbyA9IChNYXApIF9hc3NpZ25hYmxlVHlw\nZXMuZ2V0KGZyb20pOw0KICAgICAgICBpZiAoYXNzaWduYWJsZVRvID09IG51\nbGwpIHsgLy8gInRvIiBjYWNoZSBkb2Vzbid0IGV4aXN0LCBzbyBjcmVhdGUg\naXQuLi4NCiAgICAgICAgICAgIGFzc2lnbmFibGVUbyA9IG5ldyBDb25jdXJy\nZW50UmVmZXJlbmNlSGFzaE1hcChSZWZlcmVuY2VNYXAuV0VBSywNCiAgICAg\nICAgICAgICAgICAgICAgUmVmZXJlbmNlTWFwLkhBUkQpOw0KICAgICAgICAg\nICAgX2Fzc2lnbmFibGVUeXBlcy5wdXQoZnJvbSwgYXNzaWduYWJsZVRvKTsN\nCiAgICAgICAgfSBlbHNlIHsgLy8gInRvIiBjYWNoZSBleGlzdHMuLi4NCiAg\nICAgICAgICAgIGlzQXNzaWduYWJsZSA9IChCb29sZWFuKSBhc3NpZ25hYmxl\nVG8uZ2V0KHRvKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChpc0Fzc2ln\nbmFibGUgPT0gbnVsbCkgey8vIHdlIGRvbid0IGhhdmUgYSByZWNvcmQgb2Yg\ndGhpcyBwYWlyLi4uDQogICAgICAgICAgICBpc0Fzc2lnbmFibGUgPSBCb29s\nZWFuLnZhbHVlT2YoZnJvbS5pc0Fzc2lnbmFibGVGcm9tKHRvKSk7DQogICAg\nICAgICAgICBhc3NpZ25hYmxlVG8ucHV0KHRvLCBpc0Fzc2lnbmFibGUpOw0K\nICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGlzQXNzaWduYWJsZS5ib29s\nZWFuVmFsdWUoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBAcmV0dXJu\nIHRoZSBwZXJzaXN0ZW5jZS1jYXBhYmxlIGluc3RhbmNlIHJlc3BvbnNpYmxl\nIGZvciBtYW5hZ2luZw0KICAgICAqIDxjb2RlPm88L2NvZGU+LCBvciA8Y29k\nZT5udWxsPC9jb2RlPiBpZiA8Y29kZT5vPC9jb2RlPiBpcyBub3QgbWFuYWdl\nYWJsZS4NCiAgICAgKiBAc2luY2UgMS4wLjANCiAgICAgKi8NCiAgICBwdWJs\naWMgc3RhdGljIFBlcnNpc3RlbmNlQ2FwYWJsZSB0b1BlcnNpc3RlbmNlQ2Fw\nYWJsZShPYmplY3QgbywgT2JqZWN0IGN0eCl7DQogICAgICAgIGlmIChvIGlu\nc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKQ0KICAgICAgICAgICAgcmV0\ndXJuIChQZXJzaXN0ZW5jZUNhcGFibGUpIG87DQoNCiAgICAgICAgT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24gY29uZiA9IG51bGw7DQogICAgICAgIGlmIChjdHgg\naW5zdGFuY2VvZiBPcGVuSlBBQ29uZmlndXJhdGlvbikNCiAgICAgICAgICAg\nIGNvbmYgPSAoT3BlbkpQQUNvbmZpZ3VyYXRpb24pIGN0eDsNCiAgICAgICAg\nZWxzZSBpZiAoY3R4IGluc3RhbmNlb2YgU3RhdGVNYW5hZ2VyDQogICAgICAg\nICAgICAmJiAoKFN0YXRlTWFuYWdlcikgY3R4KS5nZXRHZW5lcmljQ29udGV4\ndCgpIGluc3RhbmNlb2YgU3RvcmVDb250ZXh0KQ0KICAgICAgICAgICAgY29u\nZiA9ICgoU3RvcmVDb250ZXh0KSAoKFN0YXRlTWFuYWdlcikgY3R4KS5nZXRH\nZW5lcmljQ29udGV4dCgpKQ0KICAgICAgICAgICAgICAgIC5nZXRDb25maWd1\ncmF0aW9uKCk7DQoNCiAgICAgICAgaWYgKCFpc01hbmFnZWFibGUobykpDQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsNCg0KICAgICAgICAvLyBpZiB3ZSBo\nYWQgYSBwdXRJZkFic2VudCgpIG1ldGhvZCwgd2Ugd291bGRuJ3QgbmVlZCB0\nbyBzeW5jIGhlcmUNCiAgICAgICAgc3luY2hyb25pemVkIChvKSB7DQogICAg\nICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSAoUGVyc2lzdGVuY2VD\nYXBhYmxlKQ0KICAgICAgICAgICAgICAgIF91bmVuaGFuY2VkSW5zdGFuY2VN\nYXAuZ2V0KG8pOw0KDQogICAgICAgICAgICBpZiAocGMgIT0gbnVsbCkNCiAg\nICAgICAgICAgICAgICByZXR1cm4gcGM7DQoNCiAgICAgICAgICAgIC8vIGlm\nIHdlIGRvbid0IGhhdmUgYSBjb25mIHBhc3NlZCBpbiwgdGhlbiB3ZSBjYW4n\ndCBjcmVhdGUgYSBuZXcNCiAgICAgICAgICAgIC8vIFJlZmxlY3RpbmdQQzsg\ndGhpcyB3aWxsIG9ubHkgYmUgdGhlIGNhc2Ugd2hlbiBpbnZva2VkIGZyb20g\nYQ0KICAgICAgICAgICAgLy8gY29udGV4dCBvdXRzaWRlIG9mIE9wZW5KUEEu\nDQogICAgICAgICAgICBpZiAoY29uZiA9PSBudWxsKQ0KICAgICAgICAgICAg\nICAgIHJldHVybiBudWxsOw0KDQogICAgICAgICAgICBwYyA9IG5ldyBSZWZs\nZWN0aW5nUGVyc2lzdGVuY2VDYXBhYmxlKG8sIGNvbmYpOw0KICAgICAgICAg\nICAgX3VuZW5oYW5jZWRJbnN0YW5jZU1hcC5wdXQobywgcGMpOw0KICAgICAg\nICAgICAgcmV0dXJuIHBjOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVi\nbGljIHN0YXRpYyB2b2lkIHJlZ2lzdGVyUGVyc2lzdGVuY2VDYXBhYmxlKA0K\nICAgICAgICBSZWZsZWN0aW5nUGVyc2lzdGVuY2VDYXBhYmxlIHBjKSB7DQog\nICAgICAgIF91bmVuaGFuY2VkSW5zdGFuY2VNYXAucHV0KHBjLmdldE1hbmFn\nZWRJbnN0YW5jZSgpLCBwYyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICog\nQHJldHVybiB0aGUgdXNlci12aXNpYmxlIHJlcHJlc2VudGF0aW9uIG9mIDxj\nb2RlPm88L2NvZGU+Lg0KICAgICAqIEBzaW5jZSAxLjAuMA0KICAgICAqLw0K\nICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGdldE1hbmFnZWRJbnN0YW5jZShP\nYmplY3Qgbykgew0KICAgICAgICBpZiAobyBpbnN0YW5jZW9mIE1hbmFnZWRJ\nbnN0YW5jZVByb3ZpZGVyKQ0KICAgICAgICAgICAgcmV0dXJuICgoTWFuYWdl\nZEluc3RhbmNlUHJvdmlkZXIpIG8pLmdldE1hbmFnZWRJbnN0YW5jZSgpOw0K\nICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gbzsNCiAgICB9DQp9\nDQo=\n","encoding":"base64"}

