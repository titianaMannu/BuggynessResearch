{"sha":"9048d2151ebf0cfc2639f2ffc499c727a2b48d17","node_id":"MDQ6QmxvYjIwNjM2NDo5MDQ4ZDIxNTFlYmYwY2ZjMjYzOWYyZmZjNDk5YzcyN2EyYjQ4ZDE3","size":63170,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9048d2151ebf0cfc2639f2ffc499c727a2b48d17","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbDsNCg0KaW1wb3J0IGphdmEuaW8uRmlsZTsNCmltcG9ydCBqYXZhLmlv\nLklPRXhjZXB0aW9uOw0KaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFtRXhj\nZXB0aW9uOw0KaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkFycmF5Ow0KaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0LkNvbnN0cnVjdG9yOw0KaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsNCmltcG9ydCBqYXZhLmxhbmcucmVm\nbGVjdC5Nb2RpZmllcjsNCmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0Nv\nbnRyb2xsZXI7DQppbXBvcnQgamF2YS5zZWN1cml0eS5Qcml2aWxlZ2VkQWN0\naW9uOw0KaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4\nY2VwdGlvbjsNCmltcG9ydCBqYXZhLnNxbC5UaW1lc3RhbXA7DQppbXBvcnQg\namF2YS51dGlsLkFycmF5TGlzdDsNCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlz\nOw0KaW1wb3J0IGphdmEudXRpbC5DYWxlbmRhcjsNCmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsNCmltcG9ydCBqYXZhLnV0aWwuQ29tcGFyYXRvcjsN\nCmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsNCmltcG9ydCBqYXZhLnV0aWwuR3Jl\nZ29yaWFuQ2FsZW5kYXI7DQppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7DQpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7DQppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7DQppbXBvcnQgamF2YS51dGlsLkxpc3Q7DQppbXBvcnQgamF2\nYS51dGlsLk1hcDsNCmltcG9ydCBqYXZhLnV0aWwuU2V0Ow0KaW1wb3J0IGph\ndmEudXRpbC5Tb3J0ZWRNYXA7DQppbXBvcnQgamF2YS51dGlsLlNvcnRlZFNl\ndDsNCmltcG9ydCBqYXZhLnV0aWwuVGltZVpvbmU7DQppbXBvcnQgamF2YS51\ndGlsLlRyZWVNYXA7DQppbXBvcnQgamF2YS51dGlsLlRyZWVTZXQ7DQppbXBv\ncnQgamF2YS51dGlsLlF1ZXVlOw0KDQppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmxhbmcuU3RyaW5nVXRpbHM7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOw0KaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5GaWxlczsNCmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7DQppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkphdmFWZXJzaW9uczsNCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOw0K\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5PcHRpb25zOw0K\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5jb25jdXJyZW50\nLk51bGxTYWZlQ29uY3VycmVudEhhc2hNYXA7DQoNCmltcG9ydCBqYXZhLnV0\naWwuY29uY3VycmVudC5Db25jdXJyZW50SGFzaE1hcDsNCmltcG9ydCBzZXJw\nLmJ5dGVjb2RlLkJDQ2xhc3M7DQppbXBvcnQgc2VycC5ieXRlY29kZS5CQ0Zp\nZWxkOw0KaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNNZXRob2Q7DQppbXBvcnQg\nc2VycC5ieXRlY29kZS5Db2RlOw0KaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSnVt\ncEluc3RydWN0aW9uOw0KaW1wb3J0IHNlcnAuYnl0ZWNvZGUuUHJvamVjdDsN\nCmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsNCg0KLyoqDQogKiBEZWZhdWx0\nIGltcGxlbWVudGF0aW9uIG9mIHRoZSB7QGxpbmsgUHJveHlNYW5hZ2VyfSBp\nbnRlcmZhY2UuDQogKg0KICogQGF1dGhvciBBYmUgV2hpdGUNCiAqLw0KcHVi\nbGljIGNsYXNzIFByb3h5TWFuYWdlckltcGwNCiAgICBpbXBsZW1lbnRzIFBy\nb3h5TWFuYWdlciB7DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgUFJPWFlfU1VGRklYID0gIiRwcm94eSI7DQoNCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlDQogICAgICAgIChQcm94eU1hbmFnZXJJbXBsLmNsYXNzKTsNCg0KICAg\nIHByaXZhdGUgc3RhdGljIGxvbmcgX3Byb3h5SWQgPSAwTDsNCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBNYXAgX3N0ZENvbGxlY3Rpb25zID0gbmV3IEhh\nc2hNYXAoKTsNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBNYXAgX3N0ZE1h\ncHMgPSBuZXcgSGFzaE1hcCgpOw0KICAgIHN0YXRpYyB7DQogICAgICAgIF9z\ndGRDb2xsZWN0aW9ucy5wdXQoQ29sbGVjdGlvbi5jbGFzcywgQXJyYXlMaXN0\nLmNsYXNzKTsNCiAgICAgICAgX3N0ZENvbGxlY3Rpb25zLnB1dChTZXQuY2xh\nc3MsIEhhc2hTZXQuY2xhc3MpOw0KICAgICAgICBfc3RkQ29sbGVjdGlvbnMu\ncHV0KFNvcnRlZFNldC5jbGFzcywgVHJlZVNldC5jbGFzcyk7DQogICAgICAg\nIF9zdGRDb2xsZWN0aW9ucy5wdXQoTGlzdC5jbGFzcywgQXJyYXlMaXN0LmNs\nYXNzKTsNCiAgICAgICAgX3N0ZENvbGxlY3Rpb25zLnB1dChRdWV1ZS5jbGFz\ncywgTGlua2VkTGlzdC5jbGFzcyk7DQogICAgICAgIF9zdGRNYXBzLnB1dChN\nYXAuY2xhc3MsIEhhc2hNYXAuY2xhc3MpOw0KICAgICAgICBfc3RkTWFwcy5w\ndXQoU29ydGVkTWFwLmNsYXNzLCBUcmVlTWFwLmNsYXNzKTsNCiAgICB9DQoN\nCiAgICBwcml2YXRlIGZpbmFsIFNldCBfdW5wcm94eWFibGUgPSBuZXcgSGFz\naFNldCgpOw0KICAgIHByaXZhdGUgZmluYWwgTWFwIF9wcm94aWVzID0gbmV3\nIE51bGxTYWZlQ29uY3VycmVudEhhc2hNYXAoKTsNCiAgICBwcml2YXRlIGJv\nb2xlYW4gX3RyYWNrQ2hhbmdlcyA9IHRydWU7DQogICAgcHJpdmF0ZSBib29s\nZWFuIF9hc3NlcnRUeXBlID0gZmFsc2U7DQoNCiAgICBwdWJsaWMgUHJveHlN\nYW5hZ2VySW1wbCgpIHsNCiAgICAgICAgX3VucHJveHlhYmxlLmFkZChUaW1l\nWm9uZS5jbGFzcy5nZXROYW1lKCkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAg\nICAqIFdoZXRoZXIgcHJveGllcyBwcm9kdWNlZCBieSB0aGlzIGZhY3Rvcnkg\nd2lsbCB1c2Uge0BsaW5rIENoYW5nZVRyYWNrZXJ9cw0KICAgICAqIHRvIHRy\neSB0byBjdXQgZG93biBvbiBkYXRhIHN0b3JlIG9wZXJhdGlvbnMgYXQgdGhl\nIGNvc3Qgb2Ygc29tZSBleHRyYQ0KICAgICAqIGJvb2trZWVwaW5nIG92ZXJo\nZWFkLiBEZWZhdWx0cyB0byB0cnVlLg0KICAgICAqLw0KICAgIHB1YmxpYyBi\nb29sZWFuIGdldFRyYWNrQ2hhbmdlcygpIHsNCiAgICAgICAgcmV0dXJuIF90\ncmFja0NoYW5nZXM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogV2hldGhl\nciBwcm94aWVzIHByb2R1Y2VkIGJ5IHRoaXMgZmFjdG9yeSB3aWxsIHVzZSB7\nQGxpbmsgQ2hhbmdlVHJhY2tlcn1zDQogICAgICogdG8gdHJ5IHRvIGN1dCBk\nb3duIG9uIGRhdGEgc3RvcmUgb3BlcmF0aW9ucyBhdCB0aGUgY29zdCBvZiBz\nb21lIGV4dHJhDQogICAgICogYm9va2tlZXBpbmcgb3ZlcmhlYWQuIERlZmF1\nbHRzIHRvIHRydWUuDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2V0VHJh\nY2tDaGFuZ2VzKGJvb2xlYW4gdHJhY2spIHsNCiAgICAgICAgX3RyYWNrQ2hh\nbmdlcyA9IHRyYWNrOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFdoZXRo\nZXIgdG8gcGVyZm9ybSBydW50aW1lIGNoZWNrcyB0byBlbnN1cmUgdGhhdCBh\nbGwgZWxlbWVudHMNCiAgICAgKiBhZGRlZCB0byBjb2xsZWN0aW9uIGFuZCBt\nYXAgcHJveGllcyBhcmUgdGhlIHByb3BlciBlbGVtZW50L2tleS92YWx1ZQ0K\nICAgICAqIHR5cGUgYXMgZGVmaW5lZCBieSB0aGUgbWV0YWRhdGEuIERlZmF1\nbHRzIHRvIGZhbHNlLg0KICAgICAqLw0KICAgIHB1YmxpYyBib29sZWFuIGdl\ndEFzc2VydEFsbG93ZWRUeXBlKCkgew0KICAgICAgICByZXR1cm4gX2Fzc2Vy\ndFR5cGU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogV2hldGhlciB0byBw\nZXJmb3JtIHJ1bnRpbWUgY2hlY2tzIHRvIGVuc3VyZSB0aGF0IGFsbCBlbGVt\nZW50cw0KICAgICAqIGFkZGVkIHRvIGNvbGxlY3Rpb24gYW5kIG1hcCBwcm94\naWVzIGFyZSB0aGUgcHJvcGVyIGVsZW1lbnQva2V5L3ZhbHVlDQogICAgICog\ndHlwZSBhcyBkZWZpbmVkIGJ5IHRoZSBtZXRhZGF0YS4gRGVmYXVsdHMgdG8g\nZmFsc2UuDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2V0QXNzZXJ0QWxs\nb3dlZFR5cGUoYm9vbGVhbiBhc3NlcnRUeXBlKSB7DQogICAgICAgIF9hc3Nl\ncnRUeXBlID0gYXNzZXJ0VHlwZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAg\nKiBSZXR1cm4gYSBtdXRhYmxlIHZpZXcgb2YgY2xhc3MgbmFtZXMgd2Uga25v\ndyBjYW5ub3QgYmUgcHJveGllZCAgDQogICAgICogY29ycmVjdGx5IGJ5IHRo\naXMgbWFuYWdlci4NCiAgICAgKi8NCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBn\nZXRVbnByb3h5YWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIF91bnByb3h5YWJs\nZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBQcm92aWRlZCBmb3IgYXV0\nby1jb25maWd1cmF0aW9uLiAgQWRkIHRoZSBnaXZlbiBzZW1pY29sb24tc2Vw\nYXJhdGVkDQogICAgICogY2xhc3MgbmFtZXMgdG8gdGhlIHNldCBvZiBjbGFz\ncyBuYW1lcyB3ZSBrbm93IGNhbm5vdCBiZSBwcm94aWVkIGNvcnJlY3RseQ0K\nICAgICAqIGJ5IHRoaXMgbWFuYWdlci4NCiAgICAgKi8NCiAgICBwdWJsaWMg\ndm9pZCBzZXRVbnByb3h5YWJsZShTdHJpbmcgY2xzTmFtZXMpIHsNCiAgICAg\nICAgaWYgKGNsc05hbWVzICE9IG51bGwpDQogICAgICAgICAgICBfdW5wcm94\neWFibGUuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5ncy5zcGxpdChjbHNO\nYW1lcywgIjsiLCAwKSkpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3Qg\nY29weUFycmF5KE9iamVjdCBvcmlnKSB7DQogICAgICAgIGlmIChvcmlnID09\nIG51bGwpDQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCg0KICAgICAgICB0\ncnkgew0KICAgICAgICAgICAgaW50IGxlbmd0aCA9IEFycmF5LmdldExlbmd0\naChvcmlnKTsNCiAgICAgICAgICAgIE9iamVjdCBhcnJheSA9IEFycmF5Lm5l\nd0luc3RhbmNlKG9yaWcuZ2V0Q2xhc3MoKS4NCiAgICAgICAgICAgICAgICBn\nZXRDb21wb25lbnRUeXBlKCksIGxlbmd0aCk7DQoNCiAgICAgICAgICAgIFN5\nc3RlbS5hcnJheWNvcHkob3JpZywgMCwgYXJyYXksIDAsIGxlbmd0aCk7DQog\nICAgICAgICAgICByZXR1cm4gYXJyYXk7DQogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1hcnJheSIsDQogICAgICAgICAg\nICAgICAgZS5nZXRNZXNzYWdlKCkpLCBlKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIHB1YmxpYyBDb2xsZWN0aW9uIGNvcHlDb2xsZWN0aW9uKENvbGxl\nY3Rpb24gb3JpZykgew0KICAgICAgICBpZiAob3JpZyA9PSBudWxsKQ0KICAg\nICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIGlmIChvcmlnIGluc3Rh\nbmNlb2YgUHJveHkpDQogICAgICAgICAgICByZXR1cm4gKENvbGxlY3Rpb24p\nICgoUHJveHkpIG9yaWcpLmNvcHkob3JpZyk7DQoNCiAgICAgICAgUHJveHlD\nb2xsZWN0aW9uIHByb3h5ID0gZ2V0RmFjdG9yeVByb3h5Q29sbGVjdGlvbihv\ncmlnLmdldENsYXNzKCkpOw0KICAgICAgICByZXR1cm4gKENvbGxlY3Rpb24p\nIHByb3h5LmNvcHkob3JpZyk7DQogICAgfQ0KDQogICAgcHVibGljIFByb3h5\nIG5ld0NvbGxlY3Rpb25Qcm94eShDbGFzcyB0eXBlLCBDbGFzcyBlbGVtZW50\nVHlwZSwNCiAgICAgICAgQ29tcGFyYXRvciBjb21wYXJlKSB7DQogICAgICAg\nIHR5cGUgPSB0b1Byb3h5YWJsZUNvbGxlY3Rpb25UeXBlKHR5cGUpOw0KICAg\nICAgICBQcm94eUNvbGxlY3Rpb24gcHJveHkgPSBnZXRGYWN0b3J5UHJveHlD\nb2xsZWN0aW9uKHR5cGUpOw0KICAgICAgICByZXR1cm4gcHJveHkubmV3SW5z\ndGFuY2UoKF9hc3NlcnRUeXBlKSA/IGVsZW1lbnRUeXBlIDogbnVsbCwgY29t\ncGFyZSwNCiAgICAgICAgICAgIF90cmFja0NoYW5nZXMpOw0KICAgIH0NCg0K\nICAgIHB1YmxpYyBNYXAgY29weU1hcChNYXAgb3JpZykgew0KICAgICAgICBp\nZiAob3JpZyA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQog\nICAgICAgIGlmIChvcmlnIGluc3RhbmNlb2YgUHJveHkpDQogICAgICAgICAg\nICByZXR1cm4gKE1hcCkgKChQcm94eSkgb3JpZykuY29weShvcmlnKTsNCg0K\nICAgICAgICBQcm94eU1hcCBwcm94eSA9IGdldEZhY3RvcnlQcm94eU1hcChv\ncmlnLmdldENsYXNzKCkpOw0KICAgICAgICByZXR1cm4gKE1hcCkgcHJveHku\nY29weShvcmlnKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgUHJveHkgbmV3TWFw\nUHJveHkoQ2xhc3MgdHlwZSwgQ2xhc3Mga2V5VHlwZSwgDQogICAgICAgIENs\nYXNzIGVsZW1lbnRUeXBlLCBDb21wYXJhdG9yIGNvbXBhcmUpIHsNCiAgICAg\nICAgdHlwZSA9IHRvUHJveHlhYmxlTWFwVHlwZSh0eXBlKTsNCiAgICAgICAg\nUHJveHlNYXAgcHJveHkgPSBnZXRGYWN0b3J5UHJveHlNYXAodHlwZSk7DQog\nICAgICAgIHJldHVybiBwcm94eS5uZXdJbnN0YW5jZSgoX2Fzc2VydFR5cGUp\nID8ga2V5VHlwZSA6IG51bGwsIA0KICAgICAgICAgICAgKF9hc3NlcnRUeXBl\nKSA/IGVsZW1lbnRUeXBlIDogbnVsbCwgY29tcGFyZSwgX3RyYWNrQ2hhbmdl\ncyk7DQogICAgfQ0KDQogICAgcHVibGljIERhdGUgY29weURhdGUoRGF0ZSBv\ncmlnKSB7DQogICAgICAgIGlmIChvcmlnID09IG51bGwpDQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsNCiAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBQ\ncm94eSkNCiAgICAgICAgICAgIHJldHVybiAoRGF0ZSkgKChQcm94eSkgb3Jp\nZykuY29weShvcmlnKTsNCg0KICAgICAgICBQcm94eURhdGUgcHJveHkgPSBn\nZXRGYWN0b3J5UHJveHlEYXRlKG9yaWcuZ2V0Q2xhc3MoKSk7DQogICAgICAg\nIHJldHVybiAoRGF0ZSkgcHJveHkuY29weShvcmlnKTsNCiAgICB9DQoNCiAg\nICBwdWJsaWMgUHJveHkgbmV3RGF0ZVByb3h5KENsYXNzIHR5cGUpIHsNCiAg\nICAgICAgUHJveHlEYXRlIHByb3h5ID0gZ2V0RmFjdG9yeVByb3h5RGF0ZSh0\neXBlKTsNCiAgICAgICAgcmV0dXJuIHByb3h5Lm5ld0luc3RhbmNlKCk7DQog\nICAgfQ0KDQogICAgcHVibGljIENhbGVuZGFyIGNvcHlDYWxlbmRhcihDYWxl\nbmRhciBvcmlnKSB7DQogICAgICAgIGlmIChvcmlnID09IG51bGwpDQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgaWYgKG9yaWcgaW5zdGFu\nY2VvZiBQcm94eSkNCiAgICAgICAgICAgIHJldHVybiAoQ2FsZW5kYXIpICgo\nUHJveHkpIG9yaWcpLmNvcHkob3JpZyk7DQoNCiAgICAgICAgUHJveHlDYWxl\nbmRhciBwcm94eSA9IGdldEZhY3RvcnlQcm94eUNhbGVuZGFyKG9yaWcuZ2V0\nQ2xhc3MoKSk7DQogICAgICAgIHJldHVybiAoQ2FsZW5kYXIpIHByb3h5LmNv\ncHkob3JpZyk7DQogICAgfQ0KDQogICAgcHVibGljIFByb3h5IG5ld0NhbGVu\nZGFyUHJveHkoQ2xhc3MgdHlwZSwgVGltZVpvbmUgem9uZSkgew0KICAgICAg\nICBpZiAodHlwZSA9PSBDYWxlbmRhci5jbGFzcykNCiAgICAgICAgICAgIHR5\ncGUgPSBHcmVnb3JpYW5DYWxlbmRhci5jbGFzczsNCiAgICAgICAgUHJveHlD\nYWxlbmRhciBwcm94eSA9IGdldEZhY3RvcnlQcm94eUNhbGVuZGFyKHR5cGUp\nOw0KICAgICAgICBQcm94eUNhbGVuZGFyIGNhbCA9IHByb3h5Lm5ld0luc3Rh\nbmNlKCk7DQogICAgICAgIGlmICh6b25lICE9IG51bGwpDQogICAgICAgICAg\nICAoKENhbGVuZGFyKSBjYWwpLnNldFRpbWVab25lKHpvbmUpOw0KICAgICAg\nICByZXR1cm4gY2FsOw0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3QgY29w\neUN1c3RvbShPYmplY3Qgb3JpZykgew0KICAgICAgICBpZiAob3JpZyA9PSBu\ndWxsKQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIGlmIChv\ncmlnIGluc3RhbmNlb2YgUHJveHkpDQogICAgICAgICAgICByZXR1cm4gKChQ\ncm94eSkgb3JpZykuY29weShvcmlnKTsNCiAgICAgICAgaWYgKEltcGxIZWxw\nZXIuaXNNYW5hZ2VhYmxlKG9yaWcpKQ0KICAgICAgICAgICAgcmV0dXJuIG51\nbGw7DQogICAgICAgIGlmIChvcmlnIGluc3RhbmNlb2YgQ29sbGVjdGlvbikN\nCiAgICAgICAgICAgIHJldHVybiBjb3B5Q29sbGVjdGlvbigoQ29sbGVjdGlv\nbikgb3JpZyk7DQogICAgICAgIGlmIChvcmlnIGluc3RhbmNlb2YgTWFwKQ0K\nICAgICAgICAgICAgcmV0dXJuIGNvcHlNYXAoKE1hcCkgb3JpZyk7DQogICAg\nICAgIGlmIChvcmlnIGluc3RhbmNlb2YgRGF0ZSkNCiAgICAgICAgICAgIHJl\ndHVybiBjb3B5RGF0ZSgoRGF0ZSkgb3JpZyk7DQogICAgICAgIGlmIChvcmln\nIGluc3RhbmNlb2YgQ2FsZW5kYXIpDQogICAgICAgICAgICByZXR1cm4gY29w\neUNhbGVuZGFyKChDYWxlbmRhcikgb3JpZyk7DQogICAgICAgIFByb3h5QmVh\nbiBwcm94eSA9IGdldEZhY3RvcnlQcm94eUJlYW4ob3JpZyk7DQogICAgICAg\nIHJldHVybiAocHJveHkgPT0gbnVsbCkgPyBudWxsIDogcHJveHkuY29weShv\ncmlnKTsgDQogICAgfQ0KDQogICAgcHVibGljIFByb3h5IG5ld0N1c3RvbVBy\nb3h5KE9iamVjdCBvcmlnKSB7DQogICAgICAgIGlmIChvcmlnID09IG51bGwp\nDQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgaWYgKG9yaWcg\naW5zdGFuY2VvZiBQcm94eSkNCiAgICAgICAgICAgIHJldHVybiAoUHJveHkp\nIG9yaWc7DQogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShv\ncmlnKSkNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICBpZiAo\nb3JpZyBpbnN0YW5jZW9mIENvbGxlY3Rpb24pIHsNCiAgICAgICAgICAgIENv\nbXBhcmF0b3IgY29tcCA9IChvcmlnIGluc3RhbmNlb2YgU29ydGVkU2V0KSAN\nCiAgICAgICAgICAgICAgICA/ICgoU29ydGVkU2V0KSBvcmlnKS5jb21wYXJh\ndG9yKCkgOiBudWxsOw0KICAgICAgICAgICAgQ29sbGVjdGlvbiBjID0gKENv\nbGxlY3Rpb24pIG5ld0NvbGxlY3Rpb25Qcm94eShvcmlnLmdldENsYXNzKCks\nIA0KICAgICAgICAgICAgICAgIG51bGwsIGNvbXApOyANCiAgICAgICAgICAg\nIGMuYWRkQWxsKChDb2xsZWN0aW9uKSBvcmlnKTsNCiAgICAgICAgICAgIHJl\ndHVybiAoUHJveHkpIGM7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG9yaWcg\naW5zdGFuY2VvZiBNYXApIHsNCiAgICAgICAgICAgIENvbXBhcmF0b3IgY29t\ncCA9IChvcmlnIGluc3RhbmNlb2YgU29ydGVkTWFwKSANCiAgICAgICAgICAg\nICAgICA/ICgoU29ydGVkTWFwKSBvcmlnKS5jb21wYXJhdG9yKCkgOiBudWxs\nOw0KICAgICAgICAgICAgTWFwIG0gPSAoTWFwKSBuZXdNYXBQcm94eShvcmln\nLmdldENsYXNzKCksIG51bGwsIG51bGwsIGNvbXApOw0KICAgICAgICAgICAg\nbS5wdXRBbGwoKE1hcCkgb3JpZyk7DQogICAgICAgICAgICByZXR1cm4gKFBy\nb3h5KSBtOw0KICAgICAgICB9DQogICAgICAgIGlmIChvcmlnIGluc3RhbmNl\nb2YgRGF0ZSkgew0KICAgICAgICAgICAgRGF0ZSBkID0gKERhdGUpIG5ld0Rh\ndGVQcm94eShvcmlnLmdldENsYXNzKCkpOw0KICAgICAgICAgICAgZC5zZXRU\naW1lKCgoRGF0ZSkgb3JpZykuZ2V0VGltZSgpKTsNCiAgICAgICAgICAgIGlm\nIChvcmlnIGluc3RhbmNlb2YgVGltZXN0YW1wKQ0KICAgICAgICAgICAgICAg\nICgoVGltZXN0YW1wKSBkKS5zZXROYW5vcygoKFRpbWVzdGFtcCkgb3JpZyku\nZ2V0TmFub3MoKSk7DQogICAgICAgICAgICByZXR1cm4gKFByb3h5KSBkOw0K\nICAgICAgICB9DQogICAgICAgIGlmIChvcmlnIGluc3RhbmNlb2YgQ2FsZW5k\nYXIpIHsNCiAgICAgICAgICAgIENhbGVuZGFyIGMgPSAoQ2FsZW5kYXIpIG5l\nd0NhbGVuZGFyUHJveHkob3JpZy5nZXRDbGFzcygpLA0KICAgICAgICAgICAg\nICAgICgoQ2FsZW5kYXIpIG9yaWcpLmdldFRpbWVab25lKCkpOw0KICAgICAg\nICAgICAgYy5zZXRUaW1lSW5NaWxsaXMoKChDYWxlbmRhcikgb3JpZykuZ2V0\nVGltZUluTWlsbGlzKCkpOw0KICAgICAgICAgICAgcmV0dXJuIChQcm94eSkg\nYzsNCiAgICAgICAgfQ0KDQogICAgICAgIFByb3h5QmVhbiBwcm94eSA9IGdl\ndEZhY3RvcnlQcm94eUJlYW4ob3JpZyk7DQogICAgICAgIHJldHVybiAocHJv\neHkgPT0gbnVsbCkgPyBudWxsIDogcHJveHkubmV3SW5zdGFuY2Uob3JpZyk7\nDQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJuIHRoZSBjb25jcmV0\nZSB0eXBlIGZvciBwcm94eWluZy4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQg\nQ2xhc3MgdG9Qcm94eWFibGVDb2xsZWN0aW9uVHlwZShDbGFzcyB0eXBlKSB7\nDQogICAgICAgIGlmICh0eXBlLmdldE5hbWUoKS5lbmRzV2l0aChQUk9YWV9T\nVUZGSVgpKQ0KICAgICAgICAgICAgdHlwZSA9IHR5cGUuZ2V0U3VwZXJjbGFz\ncygpOw0KICAgICAgICBlbHNlIGlmICh0eXBlLmlzSW50ZXJmYWNlKCkpIHsN\nCiAgICAgICAgICAgIHR5cGUgPSB0b0NvbmNyZXRlVHlwZSh0eXBlLCBfc3Rk\nQ29sbGVjdGlvbnMpOw0KICAgICAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkN\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vLXByb3h5LWludGYiLCB0eXBlKSk7DQogICAgICAg\nIH0gZWxzZSBpZiAoTW9kaWZpZXIuaXNBYnN0cmFjdCh0eXBlLmdldE1vZGlm\naWVycygpKSkNCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4\nY2VwdGlvbihfbG9jLmdldCgibm8tcHJveHktYWJzdHJhY3QiLCB0eXBlKSk7\nDQogICAgICAgIHJldHVybiB0eXBlOw0KICAgIH0NCg0KICAgIC8qKg0KICAg\nICAqIFJldHVybiB0aGUgY29uY3JldGUgdHlwZSBmb3IgcHJveHlpbmcuDQog\nICAgICovDQogICAgcHJvdGVjdGVkIENsYXNzIHRvUHJveHlhYmxlTWFwVHlw\nZShDbGFzcyB0eXBlKSB7DQogICAgICAgIGlmICh0eXBlLmdldE5hbWUoKS5l\nbmRzV2l0aChQUk9YWV9TVUZGSVgpKQ0KICAgICAgICAgICAgdHlwZSA9IHR5\ncGUuZ2V0U3VwZXJjbGFzcygpOw0KICAgICAgICBlbHNlIGlmICh0eXBlLmlz\nSW50ZXJmYWNlKCkpIHsNCiAgICAgICAgICAgIHR5cGUgPSB0b0NvbmNyZXRl\nVHlwZSh0eXBlLCBfc3RkTWFwcyk7DQogICAgICAgICAgICBpZiAodHlwZSA9\nPSBudWxsKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRl\nZEV4Y2VwdGlvbihfbG9jLmdldCgibm8tcHJveHktaW50ZiIsIHR5cGUpKTsN\nCiAgICAgICAgfSBlbHNlIGlmIChNb2RpZmllci5pc0Fic3RyYWN0KHR5cGUu\nZ2V0TW9kaWZpZXJzKCkpKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1wcm94eS1hYnN0cmFjdCIs\nIHR5cGUpKTsNCiAgICAgICAgcmV0dXJuIHR5cGU7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogTG9jYXRlIGEgY29uY3JldGUgdHlwZSB0byBwcm94eSBm\nb3IgdGhlIGdpdmVuIGNvbGxlY3Rpb24gaW50ZXJmYWNlLg0KICAgICAqLw0K\nICAgIHByaXZhdGUgc3RhdGljIENsYXNzIHRvQ29uY3JldGVUeXBlKENsYXNz\nIGludGYsIE1hcCBjb25jcmV0ZXMpIHsNCiAgICAgICAgQ2xhc3MgY29uY3Jl\ndGUgPSAoQ2xhc3MpIGNvbmNyZXRlcy5nZXQoaW50Zik7DQogICAgICAgIGlm\nIChjb25jcmV0ZSAhPSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuIGNvbmNy\nZXRlOw0KICAgICAgICBDbGFzc1tdIGludGZzID0gaW50Zi5nZXRJbnRlcmZh\nY2VzKCk7ICAgICAgICAgDQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\naW50ZnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGNvbmNyZXRlID0g\ndG9Db25jcmV0ZVR5cGUoaW50ZnNbaV0sIGNvbmNyZXRlcyk7DQogICAgICAg\nICAgICBpZiAoY29uY3JldGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICBy\nZXR1cm4gY29uY3JldGU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG51\nbGw7IA0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiB0aGUgY2Fj\naGVkIGZhY3RvcnkgcHJveHkgZm9yIHRoZSBnaXZlbiBjb2xsZWN0aW9uIHR5\ncGUuDQogICAgICovDQogICAgcHJpdmF0ZSBQcm94eUNvbGxlY3Rpb24gZ2V0\nRmFjdG9yeVByb3h5Q29sbGVjdGlvbihDbGFzcyB0eXBlKSB7DQogICAgICAg\nIC8vIHdlIGRvbid0IGxvY2sgaGVyZTsgb2sgaWYgdHdvIHByb3hpZXMgZ2V0\nIGdlbmVyYXRlZCBmb3Igc2FtZSB0eXBlDQogICAgICAgIFByb3h5Q29sbGVj\ndGlvbiBwcm94eSA9IChQcm94eUNvbGxlY3Rpb24pIF9wcm94aWVzLmdldCh0\neXBlKTsNCiAgICAgICAgaWYgKHByb3h5ID09IG51bGwpIHsNCiAgICAgICAg\nICAgIENsYXNzTG9hZGVyIGwgPSBHZW5lcmF0ZWRDbGFzc2VzLmdldE1vc3RE\nZXJpdmVkTG9hZGVyKHR5cGUsDQogICAgICAgICAgICAgICAgUHJveHlDb2xs\nZWN0aW9uLmNsYXNzKTsNCiAgICAgICAgICAgIENsYXNzIHBjbHMgPSBsb2Fk\nQnVpbGRUaW1lUHJveHkodHlwZSwgbCk7DQogICAgICAgICAgICBpZiAocGNs\ncyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHBjbHMgPSBHZW5lcmF0ZWRD\nbGFzc2VzLmxvYWRCQ0NsYXNzKA0KICAgICAgICAgICAgICAgICAgICBnZW5l\ncmF0ZVByb3h5Q29sbGVjdGlvbkJ5dGVjb2RlKHR5cGUsIHRydWUpLCBsKTsN\nCiAgICAgICAgICAgIHByb3h5ID0gKFByb3h5Q29sbGVjdGlvbikgaW5zdGFu\ndGlhdGVQcm94eShwY2xzLCBudWxsLCBudWxsKTsNCiAgICAgICAgICAgIF9w\ncm94aWVzLnB1dCh0eXBlLCBwcm94eSk7DQogICAgICAgIH0NCiAgICAgICAg\ncmV0dXJuIHByb3h5Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVy\nbiB0aGUgY2FjaGVkIGZhY3RvcnkgcHJveHkgZm9yIHRoZSBnaXZlbiBtYXAg\ndHlwZS4NCiAgICAgKi8NCiAgICBwcml2YXRlIFByb3h5TWFwIGdldEZhY3Rv\ncnlQcm94eU1hcChDbGFzcyB0eXBlKSB7DQogICAgICAgIC8vIHdlIGRvbid0\nIGxvY2sgaGVyZTsgb2sgaWYgdHdvIHByb3hpZXMgZ2V0IGdlbmVyYXRlZCBm\nb3Igc2FtZSB0eXBlDQogICAgICAgIFByb3h5TWFwIHByb3h5ID0gKFByb3h5\nTWFwKSBfcHJveGllcy5nZXQodHlwZSk7DQogICAgICAgIGlmIChwcm94eSA9\nPSBudWxsKSB7DQogICAgICAgICAgICBDbGFzc0xvYWRlciBsID0gR2VuZXJh\ndGVkQ2xhc3Nlcy5nZXRNb3N0RGVyaXZlZExvYWRlcih0eXBlLA0KICAgICAg\nICAgICAgICAgIFByb3h5TWFwLmNsYXNzKTsNCiAgICAgICAgICAgIENsYXNz\nIHBjbHMgPSBsb2FkQnVpbGRUaW1lUHJveHkodHlwZSwgbCk7DQogICAgICAg\nICAgICBpZiAocGNscyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHBjbHMg\nPSBHZW5lcmF0ZWRDbGFzc2VzLmxvYWRCQ0NsYXNzKA0KICAgICAgICAgICAg\nICAgICAgICBnZW5lcmF0ZVByb3h5TWFwQnl0ZWNvZGUodHlwZSwgdHJ1ZSks\nIGwpOw0KICAgICAgICAgICAgcHJveHkgPSAoUHJveHlNYXApIGluc3RhbnRp\nYXRlUHJveHkocGNscywgbnVsbCwgbnVsbCk7DQogICAgICAgICAgICBfcHJv\neGllcy5wdXQodHlwZSwgcHJveHkpOw0KICAgICAgICB9DQogICAgICAgIHJl\ndHVybiBwcm94eTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4g\ndGhlIGNhY2hlZCBmYWN0b3J5IHByb3h5IGZvciB0aGUgZ2l2ZW4gZGF0ZSB0\neXBlLg0KICAgICAqLw0KICAgIHByaXZhdGUgUHJveHlEYXRlIGdldEZhY3Rv\ncnlQcm94eURhdGUoQ2xhc3MgdHlwZSkgew0KICAgICAgICAvLyB3ZSBkb24n\ndCBsb2NrIGhlcmU7IG9rIGlmIHR3byBwcm94aWVzIGdldCBnZW5lcmF0ZWQg\nZm9yIHNhbWUgdHlwZQ0KICAgICAgICBQcm94eURhdGUgcHJveHkgPSAoUHJv\neHlEYXRlKSBfcHJveGllcy5nZXQodHlwZSk7DQogICAgICAgIGlmIChwcm94\neSA9PSBudWxsKSB7DQogICAgICAgICAgICBDbGFzc0xvYWRlciBsID0gR2Vu\nZXJhdGVkQ2xhc3Nlcy5nZXRNb3N0RGVyaXZlZExvYWRlcih0eXBlLA0KICAg\nICAgICAgICAgICAgIFByb3h5RGF0ZS5jbGFzcyk7DQogICAgICAgICAgICBD\nbGFzcyBwY2xzID0gbG9hZEJ1aWxkVGltZVByb3h5KHR5cGUsIGwpOw0KICAg\nICAgICAgICAgaWYgKHBjbHMgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBw\nY2xzID0gR2VuZXJhdGVkQ2xhc3Nlcy5sb2FkQkNDbGFzcygNCiAgICAgICAg\nICAgICAgICAgICAgZ2VuZXJhdGVQcm94eURhdGVCeXRlY29kZSh0eXBlLCB0\ncnVlKSwgbCk7DQogICAgICAgICAgICBwcm94eSA9IChQcm94eURhdGUpIGlu\nc3RhbnRpYXRlUHJveHkocGNscywgbnVsbCwgbnVsbCk7DQogICAgICAgICAg\nICBfcHJveGllcy5wdXQodHlwZSwgcHJveHkpOw0KICAgICAgICB9DQogICAg\nICAgIHJldHVybiBwcm94eTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBS\nZXR1cm4gdGhlIGNhY2hlZCBmYWN0b3J5IHByb3h5IGZvciB0aGUgZ2l2ZW4g\nY2FsZW5kYXIgdHlwZS4NCiAgICAgKi8NCiAgICBwcml2YXRlIFByb3h5Q2Fs\nZW5kYXIgZ2V0RmFjdG9yeVByb3h5Q2FsZW5kYXIoQ2xhc3MgdHlwZSkgew0K\nICAgICAgICAvLyB3ZSBkb24ndCBsb2NrIGhlcmU7IG9rIGlmIHR3byBwcm94\naWVzIGdldCBnZW5lcmF0ZWQgZm9yIHNhbWUgdHlwZQ0KICAgICAgICBQcm94\neUNhbGVuZGFyIHByb3h5ID0gKFByb3h5Q2FsZW5kYXIpIF9wcm94aWVzLmdl\ndCh0eXBlKTsNCiAgICAgICAgaWYgKHByb3h5ID09IG51bGwpIHsNCiAgICAg\nICAgICAgIENsYXNzTG9hZGVyIGwgPSBHZW5lcmF0ZWRDbGFzc2VzLmdldE1v\nc3REZXJpdmVkTG9hZGVyKHR5cGUsDQogICAgICAgICAgICAgICAgUHJveHlD\nYWxlbmRhci5jbGFzcyk7DQogICAgICAgICAgICBDbGFzcyBwY2xzID0gbG9h\nZEJ1aWxkVGltZVByb3h5KHR5cGUsIGwpOw0KICAgICAgICAgICAgaWYgKHBj\nbHMgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBwY2xzID0gR2VuZXJhdGVk\nQ2xhc3Nlcy5sb2FkQkNDbGFzcygNCiAgICAgICAgICAgICAgICAgICAgZ2Vu\nZXJhdGVQcm94eUNhbGVuZGFyQnl0ZWNvZGUodHlwZSwgdHJ1ZSksIGwpOw0K\nICAgICAgICAgICAgcHJveHkgPSAoUHJveHlDYWxlbmRhcikgaW5zdGFudGlh\ndGVQcm94eShwY2xzLCBudWxsLCBudWxsKTsNCiAgICAgICAgICAgIF9wcm94\naWVzLnB1dCh0eXBlLCBwcm94eSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0\ndXJuIHByb3h5Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiB0\naGUgY2FjaGVkIGZhY3RvcnkgcHJveHkgZm9yIHRoZSBnaXZlbiBiZWFuIHR5\ncGUuDQogICAgICovDQogICAgcHJpdmF0ZSBQcm94eUJlYW4gZ2V0RmFjdG9y\neVByb3h5QmVhbihPYmplY3Qgb3JpZykgew0KICAgICAgICBmaW5hbCBDbGFz\ncyB0eXBlID0gb3JpZy5nZXRDbGFzcygpOw0KICAgICAgICBpZiAoaXNVbnBy\nb3h5YWJsZSh0eXBlKSkNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KDQog\nICAgICAgIC8vIHdlIGRvbid0IGxvY2sgaGVyZTsgb2sgaWYgdHdvIHByb3hp\nZXMgZ2V0IGdlbmVyYXRlZCBmb3Igc2FtZSB0eXBlDQogICAgICAgIFByb3h5\nQmVhbiBwcm94eSA9IChQcm94eUJlYW4pIF9wcm94aWVzLmdldCh0eXBlKTsN\nCiAgICAgICAgaWYgKHByb3h5ID09IG51bGwgJiYgIV9wcm94aWVzLmNvbnRh\naW5zS2V5KHR5cGUpKSB7DQogICAgICAgICAgICBDbGFzc0xvYWRlciBsID0g\nR2VuZXJhdGVkQ2xhc3Nlcy5nZXRNb3N0RGVyaXZlZExvYWRlcih0eXBlLA0K\nICAgICAgICAgICAgICAgIFByb3h5QmVhbi5jbGFzcyk7DQogICAgICAgICAg\nICBDbGFzcyBwY2xzID0gbG9hZEJ1aWxkVGltZVByb3h5KHR5cGUsIGwpOw0K\nICAgICAgICAgICAgaWYgKHBjbHMgPT0gbnVsbCkgew0KICAgICAgICAgICAg\nICAgIEJDQ2xhc3MgYmMgPSAoQkNDbGFzcykgQWNjZXNzQ29udHJvbGxlcg0K\nICAgICAgICAgICAgICAgICAgICAuZG9Qcml2aWxlZ2VkKG5ldyBQcml2aWxl\nZ2VkQWN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlj\nIE9iamVjdCBydW4oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGdlbmVyYXRlUHJveHlCZWFuQnl0ZWNvZGUodHlwZSwgdHJ1ZSk7\nDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAg\nICAgIH0pOw0KICAgICAgICAgICAgICAgIGlmIChiYyAhPSBudWxsKQ0KICAg\nICAgICAgICAgICAgICAgICBwY2xzID0gR2VuZXJhdGVkQ2xhc3Nlcy5sb2Fk\nQkNDbGFzcyhiYywgbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBp\nZiAocGNscyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHByb3h5ID0gKFBy\nb3h5QmVhbikgaW5zdGFudGlhdGVQcm94eShwY2xzLA0KICAgICAgICAgICAg\nICAgICAgICBmaW5kQ29weUNvbnN0cnVjdG9yKHR5cGUpLCBuZXcgT2JqZWN0\nW10ge29yaWd9KTsNCiAgICAgICAgICAgIF9wcm94aWVzLnB1dCh0eXBlLCBw\ncm94eSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHByb3h5Ow0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZl\nbiB0eXBlIGlzIGtub3duIHRvIGJlIHVucHJveHlhYmxlLg0KICAgICAqLw0K\nICAgIHByb3RlY3RlZCBib29sZWFuIGlzVW5wcm94eWFibGUoQ2xhc3MgdHlw\nZSkgew0KICAgICAgICBmb3IgKDsgdHlwZSAhPSBudWxsICYmIHR5cGUgIT0g\nT2JqZWN0LmNsYXNzOyANCiAgICAgICAgICAgIHR5cGUgPSB0eXBlLmdldFN1\ncGVyY2xhc3MoKSkgew0KICAgICAgICAgICAgaWYgKF91bnByb3h5YWJsZS5j\nb250YWlucyh0eXBlLmdldE5hbWUoKSkpDQogICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0K\nICAgIH0NCg0KICAgIC8qKg0KICAgICAqIExvYWQgdGhlIHByb3h5IGNsYXNz\nIGdlbmVyYXRlZCBhdCBidWlsZCB0aW1lIGZvciB0aGUgZ2l2ZW4gdHlwZSwN\nCiAgICAgKiByZXR1cm5pbmcgbnVsbCBpZiBub25lIGV4aXN0cy4NCiAgICAg\nKi8NCiAgICBwcm90ZWN0ZWQgQ2xhc3MgbG9hZEJ1aWxkVGltZVByb3h5KENs\nYXNzIHR5cGUsIENsYXNzTG9hZGVyIGxvYWRlcikgew0KICAgICAgICB0cnkg\new0KICAgICAgICAgICAgcmV0dXJuIENsYXNzLmZvck5hbWUoZ2V0UHJveHlD\nbGFzc05hbWUodHlwZSwgZmFsc2UpLCB0cnVlLCBsb2FkZXIpOw0KICAgICAg\nICB9IGNhdGNoIChUaHJvd2FibGUgdCkgew0KICAgICAgICAgICAgcmV0dXJu\nIG51bGw7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJ\nbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gcHJveHkgY2xhc3MuDQogICAgICovDQog\nICAgcHJpdmF0ZSBQcm94eSBpbnN0YW50aWF0ZVByb3h5KENsYXNzIGNscywg\nQ29uc3RydWN0b3IgY29ucywgT2JqZWN0W10gYXJncykgew0KICAgICAgICB0\ncnkgew0KICAgICAgICAgICAgaWYgKGNvbnMgIT0gbnVsbCkNCiAgICAgICAg\nICAgICAgICByZXR1cm4gKFByb3h5KSBjbHMuZ2V0Q29uc3RydWN0b3IoY29u\ncy5nZXRQYXJhbWV0ZXJUeXBlcygpKS4NCiAgICAgICAgICAgICAgICAgICAg\nbmV3SW5zdGFuY2UoYXJncyk7DQogICAgICAgICAgICByZXR1cm4gKFByb3h5\nKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgNCiAgICAgICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihjbHMpKTsN\nCiAgICAgICAgfSBjYXRjaCAoSW5zdGFudGlhdGlvbkV4Y2VwdGlvbiBpZSkg\new0KICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJjYW50LW5ld2luc3RhbmNlIiwNCiAgICAgICAgICAgICAg\nICBjbHMuZ2V0U3VwZXJjbGFzcygpLmdldE5hbWUoKSkpOw0KICAgICAgICB9\nIGNhdGNoIChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uIHBhZSkgew0KICAg\nICAgICAgICAgRXhjZXB0aW9uIGUgPSBwYWUuZ2V0RXhjZXB0aW9uKCk7DQog\nICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEluc3RhbnRpYXRpb25FeGNl\ncHRpb24pDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVk\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJjYW50LW5ld2luc3RhbmNlIiwNCiAgICAg\nICAgICAgICAgICAgICAgY2xzLmdldFN1cGVyY2xhc3MoKS5nZXROYW1lKCkp\nKTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihjbHMuZ2V0TmFtZSgpKS5zZXRDYXVzZShl\nKTsNCiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsNCiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGNscy5nZXROYW1lKCkp\nLnNldENhdXNlKHQpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQog\nICAgICogR2VuZXJhdGUgdGhlIGJ5dGVjb2RlIGZvciBhIGNvbGxlY3Rpb24g\ncHJveHkgZm9yIHRoZSBnaXZlbiB0eXBlLg0KICAgICAqLw0KICAgIHByb3Rl\nY3RlZCBCQ0NsYXNzIGdlbmVyYXRlUHJveHlDb2xsZWN0aW9uQnl0ZWNvZGUo\nQ2xhc3MgdHlwZSwgDQogICAgICAgIGJvb2xlYW4gcnVudGltZSkgew0KICAg\nICAgICBhc3NlcnROb3RGaW5hbCh0eXBlKTsNCiAgICAgICAgUHJvamVjdCBw\ncm9qZWN0ID0gbmV3IFByb2plY3QoKTsgDQogICAgICAgIEJDQ2xhc3MgYmMg\nPSAoQkNDbGFzcykgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJE\nb1ByaXZIZWxwZXINCiAgICAgICAgICAgIC5sb2FkUHJvamVjdENsYXNzQWN0\naW9uKHByb2plY3QsIGdldFByb3h5Q2xhc3NOYW1lKHR5cGUsIHJ1bnRpbWUp\nKSk7IA0KICAgICAgICBiYy5zZXRTdXBlcmNsYXNzKHR5cGUpOw0KICAgICAg\nICBiYy5kZWNsYXJlSW50ZXJmYWNlKFByb3h5Q29sbGVjdGlvbi5jbGFzcyk7\nDQogDQogICAgICAgIGRlbGVnYXRlQ29uc3RydWN0b3JzKGJjLCB0eXBlKTsN\nCiAgICAgICAgYWRkUHJveHlNZXRob2RzKGJjLCBmYWxzZSk7DQogICAgICAg\nIGFkZFByb3h5Q29sbGVjdGlvbk1ldGhvZHMoYmMsIHR5cGUpOw0KICAgICAg\nICBwcm94eVJlY29nbml6ZWRNZXRob2RzKGJjLCB0eXBlLCBQcm94eUNvbGxl\nY3Rpb25zLmNsYXNzLCANCiAgICAgICAgICAgIFByb3h5Q29sbGVjdGlvbi5j\nbGFzcyk7DQogICAgICAgIHByb3h5U2V0dGVycyhiYywgdHlwZSk7DQogICAg\nICAgIGFkZFdyaXRlUmVwbGFjZU1ldGhvZChiYywgcnVudGltZSk7DQogICAg\nICAgIHJldHVybiBiYzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1\ncm4gdGhlIG5hbWUgb2YgdGhlIHByb3h5IGNsYXNzIHRvIGdlbmVyYXRlIGZv\nciB0aGUgZ2l2ZW4gdHlwZS4gICANCiAgICAgKi8NCiAgICBwcml2YXRlIHN0\nYXRpYyBTdHJpbmcgZ2V0UHJveHlDbGFzc05hbWUoQ2xhc3MgdHlwZSwgYm9v\nbGVhbiBydW50aW1lKSB7DQogICAgICAgIFN0cmluZyBpZCA9IChydW50aW1l\nKSA/ICIkIiArIG5leHRQcm94eUlkKCkgOiAiIjsNCiAgICAgICAgcmV0dXJu\nIFN0cmluZ3MuZ2V0UGFja2FnZU5hbWUoUHJveHlNYW5hZ2VySW1wbC5jbGFz\ncykgKyAiLiIgDQogICAgICAgICAgICArIHR5cGUuZ2V0TmFtZSgpLnJlcGxh\nY2UoJy4nLCAnJCcpICsgaWQgKyBQUk9YWV9TVUZGSVg7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogVGhyb3cgYXBwcm9wcmlhdGUgZXhjZXB0aW9uIGlm\nIHRoZSBnaXZlbiB0eXBlIGlzIGZpbmFsLg0KICAgICAqLw0KICAgIHByaXZh\ndGUgc3RhdGljIHZvaWQgYXNzZXJ0Tm90RmluYWwoQ2xhc3MgdHlwZSkgew0K\nICAgICAgICBpZiAoTW9kaWZpZXIuaXNGaW5hbCh0eXBlLmdldE1vZGlmaWVy\ncygpKSkNCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tcHJveHktZmluYWwiLCB0eXBlKSk7DQogICAg\nfQ0KDQogICAgLyoqDQogICAgICogR2VuZXJhdGUgdGhlIGJ5dGVjb2RlIGZv\nciBhIG1hcCBwcm94eSBmb3IgdGhlIGdpdmVuIHR5cGUuDQogICAgICovDQog\nICAgcHJvdGVjdGVkIEJDQ2xhc3MgZ2VuZXJhdGVQcm94eU1hcEJ5dGVjb2Rl\nKENsYXNzIHR5cGUsIGJvb2xlYW4gcnVudGltZSkgew0KICAgICAgICBhc3Nl\ncnROb3RGaW5hbCh0eXBlKTsNCiAgICAgICAgUHJvamVjdCBwcm9qZWN0ID0g\nbmV3IFByb2plY3QoKTsgDQogICAgICAgIEJDQ2xhc3MgYmMgPSAoQkNDbGFz\ncykgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxw\nZXINCiAgICAgICAgICAgIC5sb2FkUHJvamVjdENsYXNzQWN0aW9uKHByb2pl\nY3QsIGdldFByb3h5Q2xhc3NOYW1lKHR5cGUsIHJ1bnRpbWUpKSk7IA0KICAg\nICAgICBiYy5zZXRTdXBlcmNsYXNzKHR5cGUpOw0KICAgICAgICBiYy5kZWNs\nYXJlSW50ZXJmYWNlKFByb3h5TWFwLmNsYXNzKTsNCiANCiAgICAgICAgZGVs\nZWdhdGVDb25zdHJ1Y3RvcnMoYmMsIHR5cGUpOw0KICAgICAgICBhZGRQcm94\neU1ldGhvZHMoYmMsIGZhbHNlKTsNCiAgICAgICAgYWRkUHJveHlNYXBNZXRo\nb2RzKGJjLCB0eXBlKTsNCiAgICAgICAgcHJveHlSZWNvZ25pemVkTWV0aG9k\ncyhiYywgdHlwZSwgUHJveHlNYXBzLmNsYXNzLCBQcm94eU1hcC5jbGFzcyk7\nDQogICAgICAgIHByb3h5U2V0dGVycyhiYywgdHlwZSk7DQogICAgICAgIGFk\nZFdyaXRlUmVwbGFjZU1ldGhvZChiYywgcnVudGltZSk7DQogICAgICAgIHJl\ndHVybiBiYzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZW5lcmF0ZSB0\naGUgYnl0ZWNvZGUgZm9yIGEgZGF0ZSBwcm94eSBmb3IgdGhlIGdpdmVuIHR5\ncGUuDQogICAgICovDQogICAgcHJvdGVjdGVkIEJDQ2xhc3MgZ2VuZXJhdGVQ\ncm94eURhdGVCeXRlY29kZShDbGFzcyB0eXBlLCBib29sZWFuIHJ1bnRpbWUp\nIHsNCiAgICAgICAgYXNzZXJ0Tm90RmluYWwodHlwZSk7DQogICAgICAgIFBy\nb2plY3QgcHJvamVjdCA9IG5ldyBQcm9qZWN0KCk7IA0KICAgICAgICBCQ0Ns\nYXNzIGJjID0gKEJDQ2xhc3MpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKEoyRG9Qcml2SGVscGVyDQogICAgICAgICAgICAubG9hZFByb2plY3RD\nbGFzc0FjdGlvbihwcm9qZWN0LCBnZXRQcm94eUNsYXNzTmFtZSh0eXBlLCBy\ndW50aW1lKSkpOyANCiAgICAgICAgYmMuc2V0U3VwZXJjbGFzcyh0eXBlKTsN\nCiAgICAgICAgYmMuZGVjbGFyZUludGVyZmFjZShQcm94eURhdGUuY2xhc3Mp\nOw0KIA0KICAgICAgICBkZWxlZ2F0ZUNvbnN0cnVjdG9ycyhiYywgdHlwZSk7\nDQogICAgICAgIGFkZFByb3h5TWV0aG9kcyhiYywgdHJ1ZSk7DQogICAgICAg\nIGFkZFByb3h5RGF0ZU1ldGhvZHMoYmMsIHR5cGUpOw0KICAgICAgICBwcm94\neVNldHRlcnMoYmMsIHR5cGUpOw0KICAgICAgICBhZGRXcml0ZVJlcGxhY2VN\nZXRob2QoYmMsIHJ1bnRpbWUpOw0KICAgICAgICByZXR1cm4gYmM7DQogICAg\nfQ0KDQogICAgLyoqDQogICAgICogR2VuZXJhdGUgdGhlIGJ5dGVjb2RlIGZv\nciBhIGNhbGVuZGFyIHByb3h5IGZvciB0aGUgZ2l2ZW4gdHlwZS4NCiAgICAg\nKi8NCiAgICBwcm90ZWN0ZWQgQkNDbGFzcyBnZW5lcmF0ZVByb3h5Q2FsZW5k\nYXJCeXRlY29kZShDbGFzcyB0eXBlLCANCiAgICAgICAgYm9vbGVhbiBydW50\naW1lKSB7DQogICAgICAgIGFzc2VydE5vdEZpbmFsKHR5cGUpOw0KICAgICAg\nICBQcm9qZWN0IHByb2plY3QgPSBuZXcgUHJvamVjdCgpOyANCiAgICAgICAg\nQkNDbGFzcyBiYyA9IChCQ0NsYXNzKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZChKMkRvUHJpdkhlbHBlcg0KICAgICAgICAgICAgLmxvYWRQcm9q\nZWN0Q2xhc3NBY3Rpb24ocHJvamVjdCwgZ2V0UHJveHlDbGFzc05hbWUodHlw\nZSwgcnVudGltZSkpKTsgDQogICAgICAgIGJjLnNldFN1cGVyY2xhc3ModHlw\nZSk7DQogICAgICAgIGJjLmRlY2xhcmVJbnRlcmZhY2UoUHJveHlDYWxlbmRh\nci5jbGFzcyk7DQogDQogICAgICAgIGRlbGVnYXRlQ29uc3RydWN0b3JzKGJj\nLCB0eXBlKTsNCiAgICAgICAgYWRkUHJveHlNZXRob2RzKGJjLCB0cnVlKTsN\nCiAgICAgICAgYWRkUHJveHlDYWxlbmRhck1ldGhvZHMoYmMsIHR5cGUpOw0K\nICAgICAgICBwcm94eVNldHRlcnMoYmMsIHR5cGUpOw0KICAgICAgICBhZGRX\ncml0ZVJlcGxhY2VNZXRob2QoYmMsIHJ1bnRpbWUpOw0KICAgICAgICByZXR1\ncm4gYmM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2VuZXJhdGUgdGhl\nIGJ5dGVjb2RlIGZvciBhIGJlYW4gcHJveHkgZm9yIHRoZSBnaXZlbiB0eXBl\nLg0KICAgICAqLw0KICAgIHByb3RlY3RlZCBCQ0NsYXNzIGdlbmVyYXRlUHJv\neHlCZWFuQnl0ZWNvZGUoQ2xhc3MgdHlwZSwgYm9vbGVhbiBydW50aW1lKSB7\nDQogICAgICAgIGlmIChNb2RpZmllci5pc0ZpbmFsKHR5cGUuZ2V0TW9kaWZp\nZXJzKCkpKQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIGlm\nIChJbXBsSGVscGVyLmlzTWFuYWdlZFR5cGUobnVsbCwgdHlwZSkpDQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsNCg0KICAgICAgICAvLyB3ZSBjYW4gb25s\neSBnZW5lcmF0ZSBhIHZhbGlkIHByb3h5IGlmIHRoZXJlIGlzIGEgY29weSBj\nb25zdHJ1Y3Rvcg0KICAgICAgICAvLyBvciBhIGRlZmF1bHQgY29uc3RydWN0\nb3INCiAgICAgICAgQ29uc3RydWN0b3IgY29ucyA9IGZpbmRDb3B5Q29uc3Ry\ndWN0b3IodHlwZSk7DQogICAgICAgIGlmIChjb25zID09IG51bGwpIHsNCiAg\nICAgICAgICAgIENvbnN0cnVjdG9yW10gY3MgPSB0eXBlLmdldENvbnN0cnVj\ndG9ycygpOw0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNvbnMgPT0g\nbnVsbCAmJiBpIDwgY3MubGVuZ3RoOyBpKyspDQogICAgICAgICAgICAgICBp\nZiAoY3NbaV0uZ2V0UGFyYW1ldGVyVHlwZXMoKS5sZW5ndGggPT0gMCkNCiAg\nICAgICAgICAgICAgICAgICAgY29ucyA9IGNzW2ldOyANCiAgICAgICAgICAg\nIGlmIChjb25zID09IG51bGwpDQogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7DQogICAgICAgIH0NCg0KICAgICAgICBQcm9qZWN0IHByb2plY3QgPSBu\nZXcgUHJvamVjdCgpOyANCiAgICAgICAgQkNDbGFzcyBiYyA9IChCQ0NsYXNz\nKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBl\ncg0KICAgICAgICAgICAgLmxvYWRQcm9qZWN0Q2xhc3NBY3Rpb24ocHJvamVj\ndCwgZ2V0UHJveHlDbGFzc05hbWUodHlwZSwgcnVudGltZSkpKTsgDQogICAg\nICAgIGJjLnNldFN1cGVyY2xhc3ModHlwZSk7DQogICAgICAgIGJjLmRlY2xh\ncmVJbnRlcmZhY2UoUHJveHlCZWFuLmNsYXNzKTsNCiANCiAgICAgICAgZGVs\nZWdhdGVDb25zdHJ1Y3RvcnMoYmMsIHR5cGUpOw0KICAgICAgICBhZGRQcm94\neU1ldGhvZHMoYmMsIHRydWUpOw0KICAgICAgICBhZGRQcm94eUJlYW5NZXRo\nb2RzKGJjLCB0eXBlLCBjb25zKTsNCiAgICAgICAgaWYgKCFwcm94eVNldHRl\ncnMoYmMsIHR5cGUpKQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAg\nICAgIGFkZFdyaXRlUmVwbGFjZU1ldGhvZChiYywgcnVudGltZSk7DQogICAg\nICAgIHJldHVybiBiYzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVh\ndGUgcGFzcy10aHJvdWdoIGNvbnN0cnVjdG9ycyB0byBiYXNlIHR5cGUuDQog\nICAgICovDQogICAgcHJpdmF0ZSB2b2lkIGRlbGVnYXRlQ29uc3RydWN0b3Jz\nKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUpIHsNCiAgICAgICAgQ29uc3RydWN0\nb3JbXSBjb25zID0gdHlwZS5nZXRDb25zdHJ1Y3RvcnMoKTsNCiAgICAgICAg\nQ2xhc3NbXSBwYXJhbXM7DQogICAgICAgIEJDTWV0aG9kIG07DQogICAgICAg\nIENvZGUgY29kZTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb25z\nLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBwYXJhbXMgPSBjb25zW2ld\nLmdldFBhcmFtZXRlclR5cGVzKCk7DQogICAgICAgICAgICBtID0gYmMuZGVj\nbGFyZU1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFzcywgcGFyYW1zKTsgDQog\nICAgICAgICAgICBtLm1ha2VQdWJsaWMoKTsNCg0KICAgICAgICAgICAgY29k\nZSA9IG0uZ2V0Q29kZSh0cnVlKTsNCiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRUaGlzKCk7DQogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8\nIHBhcmFtcy5sZW5ndGg7IGorKykNCiAgICAgICAgICAgICAgICBjb2RlLnhs\nb2FkKCkuc2V0UGFyYW0oaikuc2V0VHlwZShwYXJhbXNbal0pOw0KICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGNvbnNbaV0p\nOw0KICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7DQogICAgICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7DQogICAgICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heExvY2FscygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogSW1wbGVtZW50IHRoZSBtZXRob2RzIGluIHRoZSB7QGxp\nbmsgUHJveHl9IGludGVyZmFjZSwgd2l0aCB0aGUgZXhjZXB0aW9uDQogICAg\nICogb2Yge0BsaW5rIFByb3h5I2NvcHl9Lg0KICAgICAqDQogICAgICogQHBh\ncmFtIGNoYW5nZVRyYWNrZXIgd2hldGhlciB0byBpbXBsZW1lbnQgYSBudWxs\nIGNoYW5nZSB0cmFja2VyOyBpZiBmYWxzZQ0KICAgICAqIHRoZSBjaGFuZ2Ug\ndHJhY2tlciBtZXRob2QgaXMgbGVmdCB1bmltcGxlbWVudGVkDQogICAgICov\nDQogICAgcHJpdmF0ZSB2b2lkIGFkZFByb3h5TWV0aG9kcyhCQ0NsYXNzIGJj\nLCBib29sZWFuIGNoYW5nZVRyYWNrZXIpIHsNCiAgICAgICAgQkNGaWVsZCBz\nbSA9IGJjLmRlY2xhcmVGaWVsZCgic20iLCBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nLmNsYXNzKTsNCiAgICAgICAgc20uc2V0VHJhbnNpZW50KHRydWUpOw0KICAg\nICAgICBCQ0ZpZWxkIGZpZWxkID0gYmMuZGVjbGFyZUZpZWxkKCJmaWVsZCIs\nIGludC5jbGFzcyk7DQogICAgICAgIGZpZWxkLnNldFRyYW5zaWVudCh0cnVl\nKTsNCg0KICAgICAgICBCQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1ldGhvZCgi\nc2V0T3duZXIiLCB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7DQogICAgICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyLmNsYXNzLCBpbnQuY2xhc3MgfSk7\nDQogICAgICAgIG0ubWFrZVB1YmxpYygpOw0KICAgICAgICBDb2RlIGNvZGUg\nPSBtLmdldENvZGUodHJ1ZSk7DQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRU\naGlzKCk7DQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAg\nICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKHNtKTsNCiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFRoaXMoKTsNCiAgICAgICAgY29kZS5pbG9hZCgp\nLnNldFBhcmFtKDEpOw0KICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0Rmll\nbGQoZmllbGQpOw0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsNCiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOw0KICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heExvY2FscygpOw0KDQogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0\naG9kKCJnZXRPd25lciIsIE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MsIG51\nbGwpOw0KICAgICAgICBtLm1ha2VQdWJsaWMoKTsNCiAgICAgICAgY29kZSA9\nIG0uZ2V0Q29kZSh0cnVlKTsNCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRo\naXMoKTsNCiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKHNtKTsN\nCiAgICAgICAgY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsNCg0KICAgICAgICBtID0gYmMuZGVjbGFyZU1ldGhvZCgiZ2V0T3du\nZXJGaWVsZCIsIGludC5jbGFzcywgbnVsbCk7DQogICAgICAgIG0ubWFrZVB1\nYmxpYygpOw0KICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOw0KICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOw0KICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoZmllbGQpOw0KICAgICAgICBjb2RlLmlyZXR1\ncm4oKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOw0KICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOw0KDQogICAgICAgIC8q\nIA0KICAgICAgICAgKiBjbG9uZSAocmV0dXJuIGRldGFjaGVkIHByb3h5IG9i\namVjdCkNCiAgICAgICAgICogTm90ZTogIFRoaXMgbWV0aG9kIGlzIG9ubHkg\nYmVpbmcgcHJvdmlkZWQgdG8gc2F0aXNmeSBhIHF1aXJrIHdpdGgNCiAgICAg\nICAgICogdGhlIElCTSBKREsgLS0gd2hpbGUgY29tcGFyaW5nIENhbGVuZGFy\nIG9iamVjdHMsIHRoZSBjbG9uZSgpIG1ldGhvZA0KICAgICAgICAgKiB3YXMg\naW52b2tlZC4gIFNvLCB3ZSBhcmUgbm93IG92ZXJyaWRpbmcgdGhlIGNsb25l\nKCkgbWV0aG9kIHNvIGFzIHRvDQogICAgICAgICAqIHByb3ZpZGUgYSBkZXRh\nY2hlZCBwcm94eSBvYmplY3QgKG51bGwgb3V0IHRoZSBTdGF0ZU1hbmFnZXIp\nLg0KICAgICAgICAgKi8NCiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRob2Qo\nImNsb25lIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsNCiAgICAgICAgbS5tYWtl\nUHVibGljKCk7DQogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7DQog\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChiYy5nZXRTdXBlcmNsYXNzVHlw\nZSgpLCAiY2xvbmUiLA0KICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywg\nbnVsbCk7ICANCiAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFBy\nb3h5LmNsYXNzKTsgIA0KICAgICAgICBpbnQgb3RoZXIgPSBjb2RlLmdldE5l\neHRMb2NhbHNJbmRleCgpOw0KICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExv\nY2FsKG90aGVyKTsNCiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG90\naGVyKTsNCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsNCiAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDApOw0KICAgICAgICBj\nb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChQcm94eS5jbGFzcywg\nInNldE93bmVyIiwgdm9pZC5jbGFzcywNCiAgICAgICAgICAgICAgICBuZXcg\nQ2xhc3NbXSB7IE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3MsIGludC5jbGFz\ncyB9KTsNCiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG90aGVyKTsN\nCiAgICAgICAgY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsNCiAgICAgICAgDQogICAgICAgIGlmIChjaGFuZ2VUcmFja2VyKSB7\nDQogICAgICAgICAgICBtID0gYmMuZGVjbGFyZU1ldGhvZCgiZ2V0Q2hhbmdl\nVHJhY2tlciIsIENoYW5nZVRyYWNrZXIuY2xhc3MsIG51bGwpOw0KICAgICAg\nICAgICAgbS5tYWtlUHVibGljKCk7DQogICAgICAgICAgICBjb2RlID0gbS5n\nZXRDb2RlKHRydWUpOw0KICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndE51bGwoKTsNCiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOw0KICAgICAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOw0KICAgICAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIEltcGxlbWVudCB0aGUgbWV0aG9kcyBpbiB0\naGUge0BsaW5rIFByb3h5Q29sbGVjdGlvbn0gaW50ZXJmYWNlLg0KICAgICAq\nLw0KICAgIHByaXZhdGUgdm9pZCBhZGRQcm94eUNvbGxlY3Rpb25NZXRob2Rz\nKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUpIHsNCiAgICAgICAgLy8gY2hhbmdl\nIHRyYWNrZXINCiAgICAgICAgQkNGaWVsZCBjaGFuZ2VUcmFja2VyID0gYmMu\nZGVjbGFyZUZpZWxkKCJjaGFuZ2VUcmFja2VyIiwgDQogICAgICAgICAgICBD\nb2xsZWN0aW9uQ2hhbmdlVHJhY2tlci5jbGFzcyk7DQogICAgICAgIGNoYW5n\nZVRyYWNrZXIuc2V0VHJhbnNpZW50KHRydWUpOw0KICAgICAgICBCQ01ldGhv\nZCBtID0gYmMuZGVjbGFyZU1ldGhvZCgiZ2V0Q2hhbmdlVHJhY2tlciIsIENo\nYW5nZVRyYWNrZXIuY2xhc3MsIA0KICAgICAgICAgICAgbnVsbCk7DQogICAg\nICAgIG0ubWFrZVB1YmxpYygpOw0KICAgICAgICBDb2RlIGNvZGUgPSBtLmdl\ndENvZGUodHJ1ZSk7DQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7\nDQogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChjaGFuZ2VUcmFj\na2VyKTsNCiAgICAgICAgY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsNCg0KICAgICAgICAvLyBjb2xsZWN0aW9uIGNvcHkNCiAg\nICAgICAgQ29uc3RydWN0b3IgY29ucyA9IGZpbmRDb3B5Q29uc3RydWN0b3Io\ndHlwZSk7DQogICAgICAgIGlmIChjb25zID09IG51bGwgJiYgU29ydGVkU2V0\nLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkpDQogICAgICAgICAgICBj\nb25zID0gZmluZENvbXBhcmF0b3JDb25zdHJ1Y3Rvcih0eXBlKTsNCiAgICAg\nICAgQ2xhc3NbXSBwYXJhbXMgPSAoY29ucyA9PSBudWxsKSA/IG5ldyBDbGFz\nc1swXSANCiAgICAgICAgICAgIDogY29ucy5nZXRQYXJhbWV0ZXJUeXBlcygp\nOw0KDQogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJjb3B5IiwgT2Jq\nZWN0LmNsYXNzLCBuZXcgQ2xhc3NbXSB7T2JqZWN0LmNsYXNzfSk7DQogICAg\nICAgIG0ubWFrZVB1YmxpYygpOw0KICAgICAgICBjb2RlID0gbS5nZXRDb2Rl\nKHRydWUpOw0KDQogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUodHlwZSk7\nDQogICAgICAgIGNvZGUuZHVwKCk7DQogICAgICAgIGlmIChwYXJhbXMubGVu\nZ3RoID09IDEpIHsNCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsNCiAgICAgICAgICAgIGlmIChwYXJhbXNbMF0gPT0gQ29tcGFyYXRv\nci5jbGFzcykgew0KICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZShTb3J0ZWRTZXQuY2xhc3MpOw0KICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNvcnRlZFNldC5jbGFz\ncywgImNvbXBhcmF0b3IiLCANCiAgICAgICAgICAgICAgICAgICAgQ29tcGFy\nYXRvci5jbGFzcywgbnVsbCk7DQogICAgICAgICAgICB9IGVsc2UNCiAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUocGFyYW1zWzBd\nKTsNCiAgICAgICAgfQ0KICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5z\nZXRNZXRob2QodHlwZSwgIjxpbml0PiIsIHZvaWQuY2xhc3MsIHBhcmFtcyk7\nDQogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDAgfHwgcGFyYW1zWzBd\nID09IENvbXBhcmF0b3IuY2xhc3MpIHsNCiAgICAgICAgICAgIGNvZGUuZHVw\nKCk7DQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7DQog\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQ29sbGVjdGlv\nbi5jbGFzcyk7DQogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QodHlwZSwgImFkZEFsbCIsIGJvb2xlYW4uY2xhc3MsIA0KICAg\nICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgQ29sbGVjdGlvbi5jbGFzcyB9\nKTsNCiAgICAgICAgICAgIGNvZGUucG9wKCk7DQogICAgICAgIH0NCiAgICAg\nICAgY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsN\nCg0KICAgICAgICAvLyBlbGVtZW50IHR5cGUNCiAgICAgICAgQkNGaWVsZCBl\nbGVtZW50VHlwZSA9IGJjLmRlY2xhcmVGaWVsZCgiZWxlbWVudFR5cGUiLCBD\nbGFzcy5jbGFzcyk7DQogICAgICAgIGVsZW1lbnRUeXBlLnNldFRyYW5zaWVu\ndCh0cnVlKTsNCiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRob2QoImdldEVs\nZW1lbnRUeXBlIiwgQ2xhc3MuY2xhc3MsIG51bGwpOw0KICAgICAgICBtLm1h\na2VQdWJsaWMoKTsNCiAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsN\nCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsNCiAgICAgICAgY29k\nZS5nZXRmaWVsZCgpLnNldEZpZWxkKGVsZW1lbnRUeXBlKTsNCiAgICAgICAg\nY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsNCg0K\nICAgICAgICAvLyBuZXcgaW5zdGFuY2UgZmFjdG9yeQ0KICAgICAgICBtID0g\nYmMuZGVjbGFyZU1ldGhvZCgibmV3SW5zdGFuY2UiLCBQcm94eUNvbGxlY3Rp\nb24uY2xhc3MsIA0KICAgICAgICAgICAgbmV3IENsYXNzW10geyBDbGFzcy5j\nbGFzcywgQ29tcGFyYXRvci5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsNCiAg\nICAgICAgbS5tYWtlUHVibGljKCk7DQogICAgICAgIGNvZGUgPSBtLmdldENv\nZGUodHJ1ZSk7DQoNCiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShiYyk7\nIA0KICAgICAgICBjb2RlLmR1cCgpOw0KICAgICAgICBjb25zID0gZmluZENv\nbXBhcmF0b3JDb25zdHJ1Y3Rvcih0eXBlKTsNCiAgICAgICAgcGFyYW1zID0g\nKGNvbnMgPT0gbnVsbCkgPyBuZXcgQ2xhc3NbMF0gOiBjb25zLmdldFBhcmFt\nZXRlclR5cGVzKCk7DQogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDEp\nDQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSk7DQogICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwg\ndm9pZC5jbGFzcywgcGFyYW1zKTsNCiAgICAgICAgaW50IHJldCA9IGNvZGUu\nZ2V0TmV4dExvY2Fsc0luZGV4KCk7DQogICAgICAgIGNvZGUuYXN0b3JlKCku\nc2V0TG9jYWwocmV0KTsNCg0KICAgICAgICAvLyBzZXQgZWxlbWVudCB0eXBl\nDQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChyZXQpOw0KICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7DQogICAgICAgIGNvZGUucHV0\nZmllbGQoKS5zZXRGaWVsZChlbGVtZW50VHlwZSk7DQoNCiAgICAgICAgLy8g\nY3JlYXRlIGNoYW5nZSB0cmFja2VyIGFuZCBzZXQgaXQNCiAgICAgICAgY29k\nZS5pbG9hZCgpLnNldFBhcmFtKDIpOw0KICAgICAgICBKdW1wSW5zdHJ1Y3Rp\nb24gaWZpbnMgPSBjb2RlLmlmZXEoKTsNCiAgICAgICAgY29kZS5hbG9hZCgp\nLnNldExvY2FsKHJldCk7DQogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUo\nQ29sbGVjdGlvbkNoYW5nZVRyYWNrZXJJbXBsLmNsYXNzKTsNCiAgICAgICAg\nY29kZS5kdXAoKTsNCiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKHJl\ndCk7DQogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShhbGxvd3NE\ndXBsaWNhdGVzKHR5cGUpKTsNCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGlzT3JkZXJlZCh0eXBlKSk7DQogICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZChDb2xsZWN0aW9uQ2hhbmdlVHJhY2tlcklt\ncGwuY2xhc3MsIA0KICAgICAgICAgICAgIjxpbml0PiIsIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tdIHsgQ29sbGVjdGlvbi5jbGFzcywgDQogICAgICAgICAg\nICBib29sZWFuLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOw0KICAgICAgICBj\nb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoY2hhbmdlVHJhY2tlcik7DQoNCiAg\nICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUuYWxvYWQoKS5zZXRMb2NhbChy\nZXQpKTsNCiAgICAgICAgY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4g\nd2hldGhlciB0aGUgZ2l2ZW4gY29sbGVjdGlvbiB0eXBlIGFsbG93cyBkdXBs\naWNhdGVzLg0KICAgICAqLw0KICAgIHByb3RlY3RlZCBib29sZWFuIGFsbG93\nc0R1cGxpY2F0ZXMoQ2xhc3MgdHlwZSkgew0KICAgICAgICByZXR1cm4gIVNl\ndC5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpOw0KICAgIH0NCg0KICAg\nIC8qKg0KICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBjb2xsZWN0\naW9uIHR5cGUgbWFpbnRhaW5zIGFuIGFydGlmaWNpYWwgDQogICAgICogb3Jk\nZXJpbmcuDQogICAgICovDQogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNPcmRl\ncmVkKENsYXNzIHR5cGUpIHsNCiAgICAgICAgcmV0dXJuIExpc3QuY2xhc3Mu\naXNBc3NpZ25hYmxlRnJvbSh0eXBlKQ0KICAgICAgICAgICAgfHwgImphdmEu\ndXRpbC5MaW5rZWRIYXNoU2V0Ii5lcXVhbHModHlwZS5nZXROYW1lKCkpOw0K\nICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEltcGxlbWVudCB0aGUgbWV0aG9k\ncyBpbiB0aGUge0BsaW5rIFByb3h5TWFwfSBpbnRlcmZhY2UuDQogICAgICov\nDQogICAgcHJpdmF0ZSB2b2lkIGFkZFByb3h5TWFwTWV0aG9kcyhCQ0NsYXNz\nIGJjLCBDbGFzcyB0eXBlKSB7DQogICAgICAgIC8vIGNoYW5nZSB0cmFja2Vy\nDQogICAgICAgIEJDRmllbGQgY2hhbmdlVHJhY2tlciA9IGJjLmRlY2xhcmVG\naWVsZCgiY2hhbmdlVHJhY2tlciIsIA0KICAgICAgICAgICAgTWFwQ2hhbmdl\nVHJhY2tlci5jbGFzcyk7DQogICAgICAgIGNoYW5nZVRyYWNrZXIuc2V0VHJh\nbnNpZW50KHRydWUpOw0KICAgICAgICBCQ01ldGhvZCBtID0gYmMuZGVjbGFy\nZU1ldGhvZCgiZ2V0Q2hhbmdlVHJhY2tlciIsIENoYW5nZVRyYWNrZXIuY2xh\nc3MsIA0KICAgICAgICAgICAgbnVsbCk7DQogICAgICAgIG0ubWFrZVB1Ymxp\nYygpOw0KICAgICAgICBDb2RlIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7DQog\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAgICAgIGNvZGUu\nZ2V0ZmllbGQoKS5zZXRGaWVsZChjaGFuZ2VUcmFja2VyKTsNCiAgICAgICAg\nY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsNCg0K\nICAgICAgICAvLyBtYXAgY29weQ0KICAgICAgICBDb25zdHJ1Y3RvciBjb25z\nID0gZmluZENvcHlDb25zdHJ1Y3Rvcih0eXBlKTsNCiAgICAgICAgaWYgKGNv\nbnMgPT0gbnVsbCAmJiBTb3J0ZWRNYXAuY2xhc3MuaXNBc3NpZ25hYmxlRnJv\nbSh0eXBlKSkNCiAgICAgICAgICAgIGNvbnMgPSBmaW5kQ29tcGFyYXRvckNv\nbnN0cnVjdG9yKHR5cGUpOw0KICAgICAgICBDbGFzc1tdIHBhcmFtcyA9IChj\nb25zID09IG51bGwpID8gbmV3IENsYXNzWzBdIA0KICAgICAgICAgICAgOiBj\nb25zLmdldFBhcmFtZXRlclR5cGVzKCk7DQoNCiAgICAgICAgbSA9IGJjLmRl\nY2xhcmVNZXRob2QoImNvcHkiLCBPYmplY3QuY2xhc3MsIG5ldyBDbGFzc1td\nIHtPYmplY3QuY2xhc3N9KTsNCiAgICAgICAgbS5tYWtlUHVibGljKCk7DQog\nICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7DQoNCiAgICAgICAgY29k\nZS5hbmV3KCkuc2V0VHlwZSh0eXBlKTsNCiAgICAgICAgY29kZS5kdXAoKTsN\nCiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMSkgew0KICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAgICAgICAgaWYg\nKHBhcmFtc1swXSA9PSBDb21wYXJhdG9yLmNsYXNzKSB7DQogICAgICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFNvcnRlZE1hcC5jbGFz\ncyk7DQogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5z\nZXRNZXRob2QoU29ydGVkTWFwLmNsYXNzLCAiY29tcGFyYXRvciIsIA0KICAg\nICAgICAgICAgICAgICAgICBDb21wYXJhdG9yLmNsYXNzLCBudWxsKTsNCiAg\nICAgICAgICAgIH0gZWxzZSANCiAgICAgICAgICAgICAgICBjb2RlLmNoZWNr\nY2FzdCgpLnNldFR5cGUocGFyYW1zWzBdKTsNCiAgICAgICAgfQ0KICAgICAg\nICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QodHlwZSwgIjxpbml0\nPiIsIHZvaWQuY2xhc3MsIHBhcmFtcyk7DQogICAgICAgIGlmIChwYXJhbXMu\nbGVuZ3RoID09IDAgfHwgcGFyYW1zWzBdID09IENvbXBhcmF0b3IuY2xhc3Mp\nIHsNCiAgICAgICAgICAgIGNvZGUuZHVwKCk7DQogICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oMCk7DQogICAgICAgICAgICBjb2RlLmNoZWNr\nY2FzdCgpLnNldFR5cGUoTWFwLmNsYXNzKTsNCiAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBlLCAicHV0QWxsIiwgdm9p\nZC5jbGFzcywgDQogICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBNYXAu\nY2xhc3MgfSk7DQogICAgICAgIH0NCiAgICAgICAgY29kZS5hcmV0dXJuKCk7\nDQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsNCiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsNCg0KICAgICAgICAvLyBrZXkg\ndHlwZQ0KICAgICAgICBCQ0ZpZWxkIGtleVR5cGUgPSBiYy5kZWNsYXJlRmll\nbGQoImtleVR5cGUiLCBDbGFzcy5jbGFzcyk7DQogICAgICAgIGtleVR5cGUu\nc2V0VHJhbnNpZW50KHRydWUpOw0KICAgICAgICBtID0gYmMuZGVjbGFyZU1l\ndGhvZCgiZ2V0S2V5VHlwZSIsIENsYXNzLmNsYXNzLCBudWxsKTsNCiAgICAg\nICAgbS5tYWtlUHVibGljKCk7DQogICAgICAgIGNvZGUgPSBtLmdldENvZGUo\ndHJ1ZSk7DQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChrZXlUeXBlKTsNCiAgICAg\nICAgY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsN\nCg0KICAgICAgICAvLyB2YWx1ZSB0eXBlDQogICAgICAgIEJDRmllbGQgdmFs\ndWVUeXBlID0gYmMuZGVjbGFyZUZpZWxkKCJ2YWx1ZVR5cGUiLCBDbGFzcy5j\nbGFzcyk7DQogICAgICAgIHZhbHVlVHlwZS5zZXRUcmFuc2llbnQodHJ1ZSk7\nDQogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJnZXRWYWx1ZVR5cGUi\nLCBDbGFzcy5jbGFzcywgbnVsbCk7DQogICAgICAgIG0ubWFrZVB1YmxpYygp\nOw0KICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOw0KICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0VGhpcygpOw0KICAgICAgICBjb2RlLmdldGZpZWxk\nKCkuc2V0RmllbGQodmFsdWVUeXBlKTsNCiAgICAgICAgY29kZS5hcmV0dXJu\nKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsNCiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsNCg0KICAgICAgICAvLyBu\nZXcgaW5zdGFuY2UgZmFjdG9yeQ0KICAgICAgICBtID0gYmMuZGVjbGFyZU1l\ndGhvZCgibmV3SW5zdGFuY2UiLCBQcm94eU1hcC5jbGFzcywgDQogICAgICAg\nICAgICBuZXcgQ2xhc3NbXSB7IENsYXNzLmNsYXNzLCBDbGFzcy5jbGFzcywg\nQ29tcGFyYXRvci5jbGFzcywgDQogICAgICAgICAgICBib29sZWFuLmNsYXNz\nIH0pOw0KICAgICAgICBtLm1ha2VQdWJsaWMoKTsNCiAgICAgICAgY29kZSA9\nIG0uZ2V0Q29kZSh0cnVlKTsNCg0KICAgICAgICBjb2RlLmFuZXcoKS5zZXRU\neXBlKGJjKTsgDQogICAgICAgIGNvZGUuZHVwKCk7DQogICAgICAgIGNvbnMg\nPSBmaW5kQ29tcGFyYXRvckNvbnN0cnVjdG9yKHR5cGUpOw0KICAgICAgICBw\nYXJhbXMgPSAoY29ucyA9PSBudWxsKSA/IG5ldyBDbGFzc1swXSA6IGNvbnMu\nZ2V0UGFyYW1ldGVyVHlwZXMoKTsNCiAgICAgICAgaWYgKHBhcmFtcy5sZW5n\ndGggPT0gMSkNCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgy\nKTsNCiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKCI8\naW5pdD4iLCB2b2lkLmNsYXNzLCBwYXJhbXMpOw0KICAgICAgICBpbnQgcmV0\nID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsNCiAgICAgICAgY29kZS5h\nc3RvcmUoKS5zZXRMb2NhbChyZXQpOw0KDQogICAgICAgIC8vIHNldCBrZXkg\nYW5kIHZhbHVlIHR5cGVzDQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChyZXQpOw0KICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7DQog\nICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChrZXlUeXBlKTsNCiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKHJldCk7DQogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsNCiAgICAgICAgY29kZS5wdXRmaWVs\nZCgpLnNldEZpZWxkKHZhbHVlVHlwZSk7DQoNCiAgICAgICAgLy8gY3JlYXRl\nIGNoYW5nZSB0cmFja2VyIGFuZCBzZXQgaXQNCiAgICAgICAgY29kZS5pbG9h\nZCgpLnNldFBhcmFtKDMpOw0KICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZp\nbnMgPSBjb2RlLmlmZXEoKTsNCiAgICAgICAgY29kZS5hbG9hZCgpLnNldExv\nY2FsKHJldCk7DQogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoTWFwQ2hh\nbmdlVHJhY2tlckltcGwuY2xhc3MpOw0KICAgICAgICBjb2RlLmR1cCgpOw0K\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwocmV0KTsNCiAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKE1hcENoYW5nZVRyYWNr\nZXJJbXBsLmNsYXNzLCANCiAgICAgICAgICAgICI8aW5pdD4iLCB2b2lkLmNs\nYXNzLCBuZXcgQ2xhc3NbXSB7IE1hcC5jbGFzcyB9KTsNCiAgICAgICAgY29k\nZS5wdXRmaWVsZCgpLnNldEZpZWxkKGNoYW5nZVRyYWNrZXIpOw0KDQogICAg\nICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0TG9jYWwocmV0\nKSk7DQogICAgICAgIGNvZGUuYXJldHVybigpOw0KICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW1wbGVtZW50\nIHRoZSBtZXRob2RzIGluIHRoZSB7QGxpbmsgUHJveHlEYXRlfSBpbnRlcmZh\nY2UuDQogICAgICovDQogICAgcHJpdmF0ZSB2b2lkIGFkZFByb3h5RGF0ZU1l\ndGhvZHMoQkNDbGFzcyBiYywgQ2xhc3MgdHlwZSkgew0KICAgICAgICBib29s\nZWFuIGhhc0RlZmF1bHRDb25zID0gYmMuZ2V0RGVjbGFyZWRNZXRob2QoIjxp\nbml0PiIsIA0KICAgICAgICAgICAgKENsYXNzW10pIG51bGwpICE9IG51bGw7\nDQogICAgICAgIGJvb2xlYW4gaGFzTWlsbGlzQ29ucyA9IGJjLmdldERlY2xh\ncmVkTWV0aG9kKCI8aW5pdD4iLCANCiAgICAgICAgICAgIG5ldyBDbGFzc1td\nIHsgbG9uZy5jbGFzcyB9KSAhPSBudWxsOw0KICAgICAgICBpZiAoIWhhc0Rl\nZmF1bHRDb25zICYmICFoYXNNaWxsaXNDb25zKQ0KICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1kYXRl\nLWNvbnMiLCB0eXBlKSk7DQoNCiAgICAgICAgLy8gYWRkIGEgZGVmYXVsdCBj\nb25zdHJ1Y3RvciB0aGF0IGRlbGVnYXRlcyB0byB0aGUgbWlsbGlzIGNvbnN0\ncnVjdG9yDQogICAgICAgIEJDTWV0aG9kIG07DQogICAgICAgIENvZGUgY29k\nZTsNCiAgICAgICAgaWYgKCFoYXNEZWZhdWx0Q29ucykgew0KICAgICAgICAg\nICAgbSA9IGJjLmRlY2xhcmVNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3Ms\nIG51bGwpOw0KICAgICAgICAgICAgbS5tYWtlUHVibGljKCk7DQogICAgICAg\nICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOw0KICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFRoaXMoKTsNCiAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3RhdGljKCkuc2V0TWV0aG9kKFN5c3RlbS5jbGFzcywgImN1cnJlbnRUaW1l\nTWlsbGlzIiwNCiAgICAgICAgICAgICAgICBsb25nLmNsYXNzLCBudWxsKTsN\nCiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0\neXBlLCAiPGluaXQ+Iiwgdm9pZC5jbGFzcywNCiAgICAgICAgICAgICAgICBu\nZXcgQ2xhc3NbXSB7IGxvbmcuY2xhc3MgfSk7DQogICAgICAgICAgICBjb2Rl\nLnZyZXR1cm4oKTsNCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsgICAgICAgICAgIA0KICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIGRhdGUgY29w\neQ0KICAgICAgICBDb25zdHJ1Y3RvciBjb25zID0gZmluZENvcHlDb25zdHJ1\nY3Rvcih0eXBlKTsNCiAgICAgICAgQ2xhc3NbXSBwYXJhbXM7DQogICAgICAg\nIGlmIChjb25zICE9IG51bGwpDQogICAgICAgICAgICBwYXJhbXMgPSBjb25z\nLmdldFBhcmFtZXRlclR5cGVzKCk7DQogICAgICAgIGVsc2UgaWYgKGhhc01p\nbGxpc0NvbnMpDQogICAgICAgICAgICBwYXJhbXMgPSBuZXcgQ2xhc3NbXSB7\nIGxvbmcuY2xhc3MgfTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcGFy\nYW1zID0gbmV3IENsYXNzWzBdOw0KDQogICAgICAgIG0gPSBiYy5kZWNsYXJl\nTWV0aG9kKCJjb3B5IiwgT2JqZWN0LmNsYXNzLCBuZXcgQ2xhc3NbXSB7T2Jq\nZWN0LmNsYXNzfSk7DQogICAgICAgIG0ubWFrZVB1YmxpYygpOw0KICAgICAg\nICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOw0KDQogICAgICAgIGNvZGUuYW5l\ndygpLnNldFR5cGUodHlwZSk7DQogICAgICAgIGNvZGUuZHVwKCk7DQogICAg\nICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDEpIHsNCiAgICAgICAgICAgIGlm\nIChwYXJhbXNbMF0gPT0gbG9uZy5jbGFzcykgew0KICAgICAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoRGF0ZS5jbGFzcyk7DQogICAgICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKERhdGUu\nY2xhc3MsICJnZXRUaW1lIiwgDQogICAgICAgICAgICAgICAgICAgIGxvbmcu\nY2xhc3MsIG51bGwpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7DQogICAgICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHBhcmFtc1swXSk7DQog\nICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4iLCB2b2lkLmNsYXNz\nLCBwYXJhbXMpOw0KICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PSAwKSB7\nDQogICAgICAgICAgICBjb2RlLmR1cCgpOw0KICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKERhdGUuY2xhc3MpOw0KICAgICAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKERhdGUuY2xhc3MsICJnZXRUaW1l\nIiwgbG9uZy5jbGFzcywgDQogICAgICAgICAgICAgICAgbnVsbCk7DQogICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QodHlwZSwg\nInNldFRpbWUiLCB2b2lkLmNsYXNzLA0KICAgICAgICAgICAgICAgIG5ldyBD\nbGFzc1tdIHsgbG9uZy5jbGFzcyB9KTsNCiAgICAgICAgfQ0KICAgICAgICBp\nZiAoKHBhcmFtcy5sZW5ndGggPT0gMCB8fCBwYXJhbXNbMF0gPT0gbG9uZy5j\nbGFzcykgDQogICAgICAgICAgICAmJiBUaW1lc3RhbXAuY2xhc3MuaXNBc3Np\nZ25hYmxlRnJvbSh0eXBlKSkgew0KICAgICAgICAgICAgY29kZS5kdXAoKTsN\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShUaW1lc3RhbXAuY2xh\nc3MpOw0KICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKFRpbWVzdGFtcC5jbGFzcywgImdldE5hbm9zIiwgDQogICAgICAgICAg\nICAgICAgaW50LmNsYXNzLCBudWxsKTsNCiAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBlLCAic2V0TmFub3MiLCB2b2lk\nLmNsYXNzLA0KICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgaW50LmNs\nYXNzIH0pOw0KICAgICAgICB9DQogICAgICAgIGNvZGUuYXJldHVybigpOw0K\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7DQogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7DQoNCiAgICAgICAgLy8gbmV3IGlu\nc3RhbmNlIGZhY3RvcnkNCiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRob2Qo\nIm5ld0luc3RhbmNlIiwgUHJveHlEYXRlLmNsYXNzLCBudWxsKTsgDQogICAg\nICAgIG0ubWFrZVB1YmxpYygpOw0KICAgICAgICBjb2RlID0gbS5nZXRDb2Rl\nKHRydWUpOw0KICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKGJjKTsgDQog\nICAgICAgIGNvZGUuZHVwKCk7DQogICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7DQog\nICAgICAgIGNvZGUuYXJldHVybigpOw0KICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW1wbGVtZW50IHRoZSBt\nZXRob2RzIGluIHRoZSB7QGxpbmsgUHJveHlDYWxlbmRhcn0gaW50ZXJmYWNl\nLg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9pZCBhZGRQcm94eUNhbGVuZGFy\nTWV0aG9kcyhCQ0NsYXNzIGJjLCBDbGFzcyB0eXBlKSB7DQogICAgICAgIC8v\nIGNhbGVuZGFyIGNvcHkNCiAgICAgICAgQ29uc3RydWN0b3IgY29ucyA9IGZp\nbmRDb3B5Q29uc3RydWN0b3IodHlwZSk7DQogICAgICAgIENsYXNzW10gcGFy\nYW1zID0gKGNvbnMgPT0gbnVsbCkgPyBuZXcgQ2xhc3NbMF0gDQogICAgICAg\nICAgICA6IGNvbnMuZ2V0UGFyYW1ldGVyVHlwZXMoKTsNCg0KICAgICAgICBC\nQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1ldGhvZCgiY29weSIsIE9iamVjdC5j\nbGFzcywgDQogICAgICAgICAgICBuZXcgQ2xhc3NbXSB7T2JqZWN0LmNsYXNz\nfSk7DQogICAgICAgIG0ubWFrZVB1YmxpYygpOw0KICAgICAgICBDb2RlIGNv\nZGUgPSBtLmdldENvZGUodHJ1ZSk7DQoNCiAgICAgICAgY29kZS5hbmV3KCku\nc2V0VHlwZSh0eXBlKTsNCiAgICAgICAgY29kZS5kdXAoKTsNCiAgICAgICAg\naWYgKHBhcmFtcy5sZW5ndGggPT0gMSkgew0KICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKHBhcmFtc1swXSk7DQogICAgICAgIH0NCiAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4i\nLCB2b2lkLmNsYXNzLCBwYXJhbXMpOw0KICAgICAgICBpZiAocGFyYW1zLmxl\nbmd0aCA9PSAwKSB7DQogICAgICAgICAgICBjb2RlLmR1cCgpOw0KICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAgICAgICAg\nY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKENhbGVuZGFyLmNsYXNzKTsNCiAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChDYWxl\nbmRhci5jbGFzcywgImdldFRpbWVJbk1pbGxpcyIsIA0KICAgICAgICAgICAg\nICAgIGxvbmcuY2xhc3MsIG51bGwpOw0KICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHR5cGUsICJzZXRUaW1lSW5NaWxsaXMi\nLCB2b2lkLmNsYXNzLA0KICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsg\nbG9uZy5jbGFzcyB9KTsNCg0KICAgICAgICAgICAgY29kZS5kdXAoKTsNCiAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAgICAgICAg\nICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShDYWxlbmRhci5jbGFzcyk7\nDQogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nQ2FsZW5kYXIuY2xhc3MsICJpc0xlbmllbnQiLCANCiAgICAgICAgICAgICAg\nICBib29sZWFuLmNsYXNzLCBudWxsKTsNCiAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBlLCAic2V0TGVuaWVudCIsIHZv\naWQuY2xhc3MsDQogICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBib29s\nZWFuLmNsYXNzIH0pOw0KDQogICAgICAgICAgICBjb2RlLmR1cCgpOw0KICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKENhbGVuZGFyLmNsYXNzKTsN\nCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChD\nYWxlbmRhci5jbGFzcywgImdldEZpcnN0RGF5T2ZXZWVrIiwgDQogICAgICAg\nICAgICAgICAgaW50LmNsYXNzLCBudWxsKTsNCiAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBlLCAic2V0Rmlyc3REYXlP\nZldlZWsiLCANCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7IGludC5jbGFzcyB9KTsNCg0KICAgICAgICAgICAgY29kZS5kdXAo\nKTsNCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsNCiAg\nICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShDYWxlbmRhci5j\nbGFzcyk7DQogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QoQ2FsZW5kYXIuY2xhc3MsIA0KICAgICAgICAgICAgICAgICJnZXRN\naW5pbWFsRGF5c0luRmlyc3RXZWVrIiwgaW50LmNsYXNzLCBudWxsKTsNCiAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBl\nLCAic2V0TWluaW1hbERheXNJbkZpcnN0V2VlayIsIA0KICAgICAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgaW50LmNsYXNzIH0pOw0K\nDQogICAgICAgICAgICBjb2RlLmR1cCgpOw0KICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOw0KICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKENhbGVuZGFyLmNsYXNzKTsNCiAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChDYWxlbmRhci5jbGFzcywg\nImdldFRpbWVab25lIiwgDQogICAgICAgICAgICAgICAgVGltZVpvbmUuY2xh\nc3MsIG51bGwpOw0KICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKHR5cGUsICJzZXRUaW1lWm9uZSIsIHZvaWQuY2xhc3MsDQog\nICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBUaW1lWm9uZS5jbGFzcyB9\nKTsNCiAgICAgICAgfQ0KICAgICAgICBjb2RlLmFyZXR1cm4oKTsNCiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOw0KICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heExvY2FscygpOw0KDQogICAgICAgIC8vIG5ldyBpbnN0YW5j\nZSBmYWN0b3J5DQogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJuZXdJ\nbnN0YW5jZSIsIFByb3h5Q2FsZW5kYXIuY2xhc3MsIG51bGwpOyANCiAgICAg\nICAgbS5tYWtlUHVibGljKCk7DQogICAgICAgIGNvZGUgPSBtLmdldENvZGUo\ndHJ1ZSk7DQogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoYmMpOyANCiAg\nICAgICAgY29kZS5kdXAoKTsNCiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFs\nKCkuc2V0TWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBudWxsKTsNCiAg\nICAgICAgY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsNCg0KICAgICAgICAvLyBwcm94eSB0aGUgcHJvdGVjdGVkIGNvbXB1dGVG\naWVsZHMgbWV0aG9kIGIvYyBpdCBpcyBjYWxsZWQgb24NCiAgICAgICAgLy8g\nbXV0YXRlLCBhbmQgc29tZSBzZXR0ZXJzIGFyZSBmaW5hbCBhbmQgdGhlcmVm\nb3JlIG5vdCBwcm94eWFibGUNCiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRo\nb2QoImNvbXB1dGVGaWVsZHMiLCB2b2lkLmNsYXNzLCBudWxsKTsNCiAgICAg\nICAgbS5tYWtlUHJvdGVjdGVkKCk7DQogICAgICAgIGNvZGUgPSBtLmdldENv\nZGUodHJ1ZSk7DQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQog\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsNCiAgICAg\nICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUHJveGllcy5jbGFz\ncywgImRpcnR5Iiwgdm9pZC5jbGFzcywNCiAgICAgICAgICAgIG5ldyBDbGFz\nc1tdIHsgUHJveHkuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7DQogICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7DQogICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiY29tcHV0ZUZpZWxkcyIsIHZv\naWQuY2xhc3MsIG51bGwpOw0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsNCiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOw0KICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOw0KICAgIH0NCg0KICAgIC8qKg0KICAg\nICAqIEltcGxlbWVudCB0aGUgbWV0aG9kcyBpbiB0aGUge0BsaW5rIFByb3h5\nQmVhbn0gaW50ZXJmYWNlLg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9pZCBh\nZGRQcm94eUJlYW5NZXRob2RzKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUsIENv\nbnN0cnVjdG9yIGNvbnMpIHsNCiAgICAgICAgLy8gYmVhbiBjb3B5DQogICAg\nICAgIEJDTWV0aG9kIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJjb3B5IiwgT2Jq\nZWN0LmNsYXNzLCANCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0\nLmNsYXNzIH0pOw0KICAgICAgICBtLm1ha2VQdWJsaWMoKTsNCiAgICAgICAg\nQ29kZSBjb2RlID0gbS5nZXRDb2RlKHRydWUpOw0KDQogICAgICAgIGNvZGUu\nYW5ldygpLnNldFR5cGUodHlwZSk7DQogICAgICAgIGNvZGUuZHVwKCk7DQog\nICAgICAgIENsYXNzW10gcGFyYW1zID0gY29ucy5nZXRQYXJhbWV0ZXJUeXBl\ncygpOw0KICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PSAxKSB7DQogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7DQogICAgICAgICAg\nICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUocGFyYW1zWzBdKTsNCiAgICAg\nICAgfQ0KICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qo\nY29ucyk7DQogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDApDQogICAg\nICAgICAgICBjb3B5UHJvcGVydGllcyh0eXBlLCBjb2RlKTsNCiAgICAgICAg\nY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsNCg0K\nICAgICAgICAvLyBuZXcgaW5zdGFuY2UgZmFjdG9yeQ0KICAgICAgICBtID0g\nYmMuZGVjbGFyZU1ldGhvZCgibmV3SW5zdGFuY2UiLCBQcm94eUJlYW4uY2xh\nc3MsIA0KICAgICAgICAgICAgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3Mg\nfSk7IA0KICAgICAgICBtLm1ha2VQdWJsaWMoKTsNCiAgICAgICAgY29kZSA9\nIG0uZ2V0Q29kZSh0cnVlKTsNCiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlw\nZShiYyk7IA0KICAgICAgICBjb2RlLmR1cCgpOw0KICAgICAgICBpZiAocGFy\nYW1zLmxlbmd0aCA9PSAxKSB7DQogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7DQogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUocGFyYW1zWzBdKTsNCiAgICAgICAgfQ0KICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3Ms\nIHBhcmFtcyk7DQogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDApDQog\nICAgICAgICAgICBjb3B5UHJvcGVydGllcyh0eXBlLCBjb2RlKTsNCiAgICAg\nICAgY29kZS5hcmV0dXJuKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsN\nCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb3B5IGJlYW4gcHJvcGVydGll\ncy4gIENhbGxlZCB3aXRoIHRoZSBjb3B5IG9iamVjdCBvbiB0aGUgc3RhY2su\nICBNdXN0DQogICAgICogcmV0dXJuIHdpdGggdGhlIGNvcHkgb2JqZWN0IG9u\nIHRoZSBzdGFjay4NCiAgICAgKi8NCiAgICBwcml2YXRlIHZvaWQgY29weVBy\nb3BlcnRpZXMoQ2xhc3MgdHlwZSwgQ29kZSBjb2RlKSB7DQogICAgICAgIGlu\ndCBjb3B5ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsNCiAgICAgICAg\nY29kZS5hc3RvcmUoKS5zZXRMb2NhbChjb3B5KTsNCiAgICAgICAgDQogICAg\nICAgIE1ldGhvZFtdIG1ldGhzID0gdHlwZS5nZXRNZXRob2RzKCk7DQogICAg\nICAgIE1ldGhvZCBnZXR0ZXI7DQogICAgICAgIGludCBtb2RzOw0KICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IG1ldGhzLmxlbmd0aDsgaSsrKSB7DQog\nICAgICAgICAgICBtb2RzID0gbWV0aHNbaV0uZ2V0TW9kaWZpZXJzKCk7IA0K\nICAgICAgICAgICAgaWYgKCFNb2RpZmllci5pc1B1YmxpYyhtb2RzKSB8fCBN\nb2RpZmllci5pc1N0YXRpYyhtb2RzKSkNCiAgICAgICAgICAgICAgICBjb250\naW51ZTsNCiAgICAgICAgICAgIGlmICghc3RhcnRzV2l0aChtZXRoc1tpXS5n\nZXROYW1lKCksICJzZXQiKQ0KICAgICAgICAgICAgICAgIHx8IG1ldGhzW2ld\nLmdldFBhcmFtZXRlclR5cGVzKCkubGVuZ3RoICE9IDEpDQogICAgICAgICAg\nICAgICAgY29udGludWU7DQogICAgICAgICAgICBnZXR0ZXIgPSBmaW5kR2V0\ndGVyKHR5cGUsIG1ldGhzW2ldKTsNCiAgICAgICAgICAgIGlmIChnZXR0ZXIg\nPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCg0KICAgICAg\nICAgICAgLy8gY29weS5zZXRYWFgob3JpZy5nZXRYWFgoKSk7DQogICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoY29weSk7DQogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7DQogICAgICAgICAgICBjb2Rl\nLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7DQogICAgICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoZ2V0dGVyKTsNCiAgICAgICAg\nICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChtZXRoc1tpXSk7\nDQogICAgICAgIH0NCiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGNv\ncHkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFByb3h5IHJlY29nbml6\nZWQgbWV0aG9kcyB0byBpbnZva2UgaGVscGVycyBpbiBnaXZlbiBoZWxwZXIg\nY2xhc3MuDQogICAgICovDQogICAgcHJpdmF0ZSB2b2lkIHByb3h5UmVjb2du\naXplZE1ldGhvZHMoQkNDbGFzcyBiYywgQ2xhc3MgdHlwZSwgQ2xhc3MgaGVs\ncGVyLA0KICAgICAgICBDbGFzcyBwcm94eVR5cGUpIHsNCiAgICAgICAgTWV0\naG9kW10gbWV0aHMgPSB0eXBlLmdldE1ldGhvZHMoKTsNCiAgICAgICAgQ2xh\nc3NbXSBwYXJhbXM7DQogICAgICAgIENsYXNzW10gYWZ0ZXJQYXJhbXM7DQog\nICAgICAgIE1ldGhvZCBtYXRjaDsNCiAgICAgICAgTWV0aG9kIGFmdGVyOw0K\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1ldGhzLmxlbmd0aDsgaSsr\nKSB7DQogICAgICAgICAgICBwYXJhbXMgPSB0b0hlbHBlclBhcmFtZXRlcnMo\nbWV0aHNbaV0uZ2V0UGFyYW1ldGVyVHlwZXMoKSwgDQogICAgICAgICAgICAg\nICAgcHJveHlUeXBlKTsNCg0KICAgICAgICAgICAgLy8gZmlyc3QgY2hlY2sg\nZm9yIG92ZXJyaWRpbmcgbWV0aG9kIA0KICAgICAgICAgICAgdHJ5IHsNCiAg\nICAgICAgICAgICAgICBtYXRjaCA9IGhlbHBlci5nZXRNZXRob2QobWV0aHNb\naV0uZ2V0TmFtZSgpLCBwYXJhbXMpOyANCiAgICAgICAgICAgICAgICBwcm94\neU92ZXJyaWRlTWV0aG9kKGJjLCBtZXRoc1tpXSwgbWF0Y2gsIHBhcmFtcyk7\nDQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9IGNh\ndGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgew0KICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsNCiAgICAgICAgICAgIH0N\nCg0KICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGJlZm9yZSBhbmQgYWZ0ZXIg\nbWV0aG9kcywgZWl0aGVyIG9mIHdoaWNoIG1heSBub3QNCiAgICAgICAgICAg\nIC8vIGV4aXN0DQogICAgICAgICAgICBtYXRjaCA9IG51bGw7DQogICAgICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgICAgIG1hdGNoID0gaGVscGVyLmdl\ndE1ldGhvZCgiYmVmb3JlIiANCiAgICAgICAgICAgICAgICAgICAgKyBTdHJp\nbmdVdGlscy5jYXBpdGFsaXplKG1ldGhzW2ldLmdldE5hbWUoKSksIHBhcmFt\ncyk7DQogICAgICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gbnNtZSkgew0KICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGFmdGVyID0gbnVs\nbDsNCiAgICAgICAgICAgIGFmdGVyUGFyYW1zID0gbnVsbDsNCiAgICAgICAg\nICAgIHRyeSB7DQogICAgICAgICAgICAgICAgYWZ0ZXJQYXJhbXMgPSB0b0hl\nbHBlckFmdGVyUGFyYW1ldGVycyhwYXJhbXMsIA0KICAgICAgICAgICAgICAg\nICAgICBtZXRoc1tpXS5nZXRSZXR1cm5UeXBlKCksIChtYXRjaCA9PSBudWxs\nKSANCiAgICAgICAgICAgICAgICAgICAgPyB2b2lkLmNsYXNzIDogbWF0Y2gu\nZ2V0UmV0dXJuVHlwZSgpKTsNCiAgICAgICAgICAgICAgICBhZnRlciA9IGhl\nbHBlci5nZXRNZXRob2QoImFmdGVyIiANCiAgICAgICAgICAgICAgICAgICAg\nKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKG1ldGhzW2ldLmdldE5hbWUoKSks\nIGFmdGVyUGFyYW1zKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiBuc21lKSB7DQogICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAg\naWYgKG1hdGNoICE9IG51bGwgfHwgYWZ0ZXIgIT0gbnVsbCkNCiAgICAgICAg\nICAgICAgICBwcm94eUJlZm9yZUFmdGVyTWV0aG9kKGJjLCB0eXBlLCBtZXRo\nc1tpXSwgbWF0Y2gsIHBhcmFtcywgYWZ0ZXIsDQogICAgICAgICAgICAgICAg\nICAgIGFmdGVyUGFyYW1zKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8q\nKg0KICAgICAqIFJldHVybiB0aGUgcGFyYW1ldGVyIHR5cGVzIHRvIHRoZSBj\nb3JyZXNwb25kaW5nIGhlbHBlciBjbGFzcyBtZXRob2QuDQogICAgICovIA0K\nICAgIHByaXZhdGUgc3RhdGljIENsYXNzW10gdG9IZWxwZXJQYXJhbWV0ZXJz\nKENsYXNzW10gY2xzLCBDbGFzcyBoZWxwZXIpIHsNCiAgICAgICAgQ2xhc3Nb\nXSBwYXJhbXMgPSBuZXcgQ2xhc3NbY2xzLmxlbmd0aCArIDFdOw0KICAgICAg\nICBwYXJhbXNbMF0gPSBoZWxwZXI7DQogICAgICAgIFN5c3RlbS5hcnJheWNv\ncHkoY2xzLCAwLCBwYXJhbXMsIDEsIGNscy5sZW5ndGgpOyANCiAgICAgICAg\ncmV0dXJuIHBhcmFtczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1\ncm4gdGhlIHBhcmFtZXRlciB0eXBlcyB0byB0aGUgY29ycmVzcG9uZGluZyBo\nZWxwZXIgY2xhc3MgImFmdGVyIiAgICAgDQogICAgICogbWV0aG9kLg0KICAg\nICAqLw0KICAgIHByaXZhdGUgc3RhdGljIENsYXNzW10gdG9IZWxwZXJBZnRl\nclBhcmFtZXRlcnMoQ2xhc3NbXSBjbHMsIENsYXNzIHJldCwNCiAgICAgICAg\nQ2xhc3MgYmVmb3JlUmV0KSB7DQogICAgICAgIGlmIChyZXQgPT0gdm9pZC5j\nbGFzcyAmJiBiZWZvcmVSZXQgPT0gdm9pZC5jbGFzcykNCiAgICAgICAgICAg\nIHJldHVybiBjbHM7DQogICAgICAgIGludCBsZW4gPSBjbHMubGVuZ3RoOw0K\nICAgICAgICBpZiAocmV0ICE9IHZvaWQuY2xhc3MpDQogICAgICAgICAgICBs\nZW4rKzsNCiAgICAgICAgaWYgKGJlZm9yZVJldCAhPSB2b2lkLmNsYXNzKQ0K\nICAgICAgICAgICAgbGVuKys7DQogICAgICAgIENsYXNzW10gcGFyYW1zID0g\nbmV3IENsYXNzW2xlbl07DQogICAgICAgIFN5c3RlbS5hcnJheWNvcHkoY2xz\nLCAwLCBwYXJhbXMsIDAsIGNscy5sZW5ndGgpOw0KICAgICAgICBpbnQgcG9z\nID0gY2xzLmxlbmd0aDsNCiAgICAgICAgaWYgKHJldCAhPSB2b2lkLmNsYXNz\nKQ0KICAgICAgICAgICAgcGFyYW1zW3BvcysrXSA9IHJldDsNCiAgICAgICAg\naWYgKGJlZm9yZVJldCAhPSB2b2lkLmNsYXNzKQ0KICAgICAgICAgICAgcGFy\nYW1zW3BvcysrXSA9IGJlZm9yZVJldDsNCiAgICAgICAgcmV0dXJuIHBhcmFt\nczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBQcm94eSBzZXR0ZXIgbWV0\naG9kcyBvZiB0aGUgZ2l2ZW4gdHlwZS4NCiAgICAgKiANCiAgICAgKiBAcmV0\ndXJuIHRydWUgaWYgd2UgZmluZCBhbnkgc2V0dGVycywgZmFsc2Ugb3RoZXJ3\naXNlDQogICAgICovDQogICAgcHJpdmF0ZSBib29sZWFuIHByb3h5U2V0dGVy\ncyhCQ0NsYXNzIGJjLCBDbGFzcyB0eXBlKSB7DQogICAgICAgIE1ldGhvZFtd\nIG1ldGhzID0gdHlwZS5nZXRNZXRob2RzKCk7DQogICAgICAgIGludCBzZXR0\nZXJzID0gMDsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtZXRocy5s\nZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGlzU2V0dGVyKG1ldGhz\nW2ldKSAmJiAhTW9kaWZpZXIuaXNGaW5hbChtZXRoc1tpXS5nZXRNb2RpZmll\ncnMoKSkNCiAgICAgICAgICAgICAgICAmJiBiYy5nZXREZWNsYXJlZE1ldGhv\nZChtZXRoc1tpXS5nZXROYW1lKCksDQogICAgICAgICAgICAgICAgbWV0aHNb\naV0uZ2V0UGFyYW1ldGVyVHlwZXMoKSkgPT0gbnVsbCkgew0KICAgICAgICAg\nICAgICAgIHNldHRlcnMrKzsNCiAgICAgICAgICAgICAgICBwcm94eVNldHRl\ncihiYywgdHlwZSwgbWV0aHNbaV0pOw0KICAgICAgICAgICAgfQ0KICAgICAg\nICB9IA0KICAgICAgICByZXR1cm4gc2V0dGVycyA+IDA7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogUHJveHkgdGhlIGdpdmVuIG1ldGhvZCB3aXRoIG9u\nZSB0aGF0IG92ZXJyaWRlcyBpdCBieSBjYWxsaW5nIGludG8gdGhlDQogICAg\nICogZ2l2ZW4gaGVscGVyLg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9pZCBw\ncm94eU92ZXJyaWRlTWV0aG9kKEJDQ2xhc3MgYmMsIE1ldGhvZCBtZXRoLCAN\nCiAgICAgICAgTWV0aG9kIGhlbHBlciwgQ2xhc3NbXSBwYXJhbXMpIHsNCiAg\nICAgICAgQkNNZXRob2QgbSA9IGJjLmRlY2xhcmVNZXRob2QobWV0aC5nZXRO\nYW1lKCksIG1ldGguZ2V0UmV0dXJuVHlwZSgpLA0KICAgICAgICAgICAgbWV0\naC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsNCiAgICAgICAgbS5tYWtlUHVibGlj\nKCk7DQogICAgICAgIENvZGUgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsNCg0K\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOw0KICAgICAgICBmb3Ig\nKGludCBpID0gMTsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykNCiAgICAgICAg\nICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShpIC0gMSkuc2V0VHlwZShwYXJh\nbXNbaV0pOw0KICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhv\nZChoZWxwZXIpOw0KICAgICAgICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKG1l\ndGguZ2V0UmV0dXJuVHlwZSgpKTsNCg0KICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUHJveHkgdGhlIGdpdmVu\nIG1ldGhvZCB3aXRoIG9uZSB0aGF0IG92ZXJyaWRlcyBpdCBieSBjYWxsaW5n\nIGludG8gdGhlDQogICAgICogZ2l2ZW4gaGVscGVyLg0KICAgICAqLw0KICAg\nIHByaXZhdGUgdm9pZCBwcm94eUJlZm9yZUFmdGVyTWV0aG9kKEJDQ2xhc3Mg\nYmMsIENsYXNzIHR5cGUsIE1ldGhvZCBtZXRoLCANCiAgICAgICAgTWV0aG9k\nIGJlZm9yZSwgQ2xhc3NbXSBwYXJhbXMsIE1ldGhvZCBhZnRlciwgQ2xhc3Nb\nXSBhZnRlclBhcmFtcykgew0KICAgICAgICBCQ01ldGhvZCBtID0gYmMuZGVj\nbGFyZU1ldGhvZChtZXRoLmdldE5hbWUoKSwgbWV0aC5nZXRSZXR1cm5UeXBl\nKCksDQogICAgICAgICAgICBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkpOw0K\nICAgICAgICBtLm1ha2VQdWJsaWMoKTsNCiAgICAgICAgQ29kZSBjb2RlID0g\nbS5nZXRDb2RlKHRydWUpOw0KDQogICAgICAgIC8vIGludm9rZSBiZWZvcmUN\nCiAgICAgICAgaW50IGJlZm9yZVJldCA9IC0xOw0KICAgICAgICBpZiAoYmVm\nb3JlICE9IG51bGwpIHsNCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRU\naGlzKCk7DQogICAgICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IHBhcmFt\ncy5sZW5ndGg7IGkrKykNCiAgICAgICAgICAgICAgICBjb2RlLnhsb2FkKCku\nc2V0UGFyYW0oaSAtIDEpLnNldFR5cGUocGFyYW1zW2ldKTsNCiAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKGJlZm9yZSk7DQog\nICAgICAgICAgICBpZiAoYWZ0ZXIgIT0gbnVsbCAmJiBiZWZvcmUuZ2V0UmV0\ndXJuVHlwZSgpICE9IHZvaWQuY2xhc3MpIHsNCiAgICAgICAgICAgICAgICBi\nZWZvcmVSZXQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOw0KICAgICAg\nICAgICAgICAgIGNvZGUueHN0b3JlKCkuc2V0TG9jYWwoYmVmb3JlUmV0KS4N\nCiAgICAgICAgICAgICAgICAgICAgc2V0VHlwZShiZWZvcmUuZ2V0UmV0dXJu\nVHlwZSgpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAg\nIC8vIGludm9rZSBzdXBlcg0KICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhp\ncygpOw0KICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IHBhcmFtcy5sZW5n\ndGg7IGkrKykNCiAgICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShp\nIC0gMSkuc2V0VHlwZShwYXJhbXNbaV0pOw0KICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2QodHlwZSwgbWV0aC5nZXROYW1lKCksIA0K\nICAgICAgICAgICAgbWV0aC5nZXRSZXR1cm5UeXBlKCksIG1ldGguZ2V0UGFy\nYW1ldGVyVHlwZXMoKSk7DQoNCiAgICAgICAgLy8gaW52b2tlIGFmdGVyIA0K\nICAgICAgICBpZiAoYWZ0ZXIgIT0gbnVsbCkgew0KICAgICAgICAgICAgaW50\nIHJldCA9IC0xOw0KICAgICAgICAgICAgaWYgKG1ldGguZ2V0UmV0dXJuVHlw\nZSgpICE9IHZvaWQuY2xhc3MpIHsNCiAgICAgICAgICAgICAgICByZXQgPSBj\nb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOw0KICAgICAgICAgICAgICAgIGNv\nZGUueHN0b3JlKCkuc2V0TG9jYWwocmV0KS5zZXRUeXBlKG1ldGguZ2V0UmV0\ndXJuVHlwZSgpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRUaGlzKCk7DQogICAgICAgICAgICBmb3IgKGludCBpID0g\nMTsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykNCiAgICAgICAgICAgICAgICBj\nb2RlLnhsb2FkKCkuc2V0UGFyYW0oaSAtIDEpLnNldFR5cGUocGFyYW1zW2ld\nKTsNCiAgICAgICAgICAgIGlmIChyZXQgIT0gLTEpDQogICAgICAgICAgICAg\nICAgY29kZS54bG9hZCgpLnNldExvY2FsKHJldCkuc2V0VHlwZShtZXRoLmdl\ndFJldHVyblR5cGUoKSk7DQogICAgICAgICAgICBpZiAoYmVmb3JlUmV0ICE9\nIC0xKQ0KICAgICAgICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRMb2NhbChi\nZWZvcmVSZXQpLg0KICAgICAgICAgICAgICAgICAgICBzZXRUeXBlKGJlZm9y\nZS5nZXRSZXR1cm5UeXBlKCkpOw0KICAgICAgICAgICAgY29kZS5pbnZva2Vz\ndGF0aWMoKS5zZXRNZXRob2QoYWZ0ZXIpOw0KICAgICAgICB9DQogICAgICAg\nIGNvZGUueHJldHVybigpLnNldFR5cGUobWV0aC5nZXRSZXR1cm5UeXBlKCkp\nOw0KDQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsNCiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsNCiAgICB9DQoNCiAgICAv\nKioNCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gbWV0aG9kIGlz\nIGEgc2V0dGVyLg0KICAgICAqLw0KICAgIHByb3RlY3RlZCBib29sZWFuIGlz\nU2V0dGVyKE1ldGhvZCBtZXRoKSB7DQogICAgICAgIHJldHVybiBzdGFydHNX\naXRoKG1ldGguZ2V0TmFtZSgpLCAic2V0IikNCiAgICAgICAgICAgIHx8IHN0\nYXJ0c1dpdGgobWV0aC5nZXROYW1lKCksICJhZGQiKQ0KICAgICAgICAgICAg\nfHwgc3RhcnRzV2l0aChtZXRoLmdldE5hbWUoKSwgInJlbW92ZSIpDQogICAg\nICAgICAgICB8fCBzdGFydHNXaXRoKG1ldGguZ2V0TmFtZSgpLCAiaW5zZXJ0\nIikNCiAgICAgICAgICAgIHx8IHN0YXJ0c1dpdGgobWV0aC5nZXROYW1lKCks\nICJjbGVhciIpDQogICAgICAgICAgICB8fCBzdGFydHNXaXRoKG1ldGguZ2V0\nTmFtZSgpLCAicm9sbCIpOyAvLyB1c2VkIGJ5IENhbGVuZGFyDQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogUmV0dXJuIHRoZSBnZXR0ZXIgY29ycmVzcG9u\nZGluZyB0byB0aGUgZ2l2ZW4gc2V0dGVyLCBvciBudWxsLg0KICAgICAqLw0K\nICAgIHByb3RlY3RlZCBNZXRob2QgZmluZEdldHRlcihDbGFzcyB0eXBlLCBN\nZXRob2Qgc2V0dGVyKSB7DQogICAgICAgIFN0cmluZyBuYW1lID0gc2V0dGVy\nLmdldE5hbWUoKS5zdWJzdHJpbmcoMyk7DQogICAgICAgIENsYXNzIHBhcmFt\nID0gc2V0dGVyLmdldFBhcmFtZXRlclR5cGVzKClbMF07DQogICAgICAgIE1l\ndGhvZCBnZXR0ZXI7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBnZXR0\nZXIgPSB0eXBlLmdldE1ldGhvZCgiZ2V0IiArIG5hbWUsIChDbGFzc1tdKSBu\ndWxsKTsgICANCiAgICAgICAgICAgIGlmIChnZXR0ZXIuZ2V0UmV0dXJuVHlw\nZSgpLmlzQXNzaWduYWJsZUZyb20ocGFyYW0pDQogICAgICAgICAgICAgICAg\nfHwgcGFyYW0uaXNBc3NpZ25hYmxlRnJvbShnZXR0ZXIuZ2V0UmV0dXJuVHlw\nZSgpKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0dGVyOw0KICAgICAg\nICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgew0KICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7DQogICAgICAgIH0NCg0KICAg\nICAgICBpZiAocGFyYW0gPT0gYm9vbGVhbi5jbGFzcyB8fCBwYXJhbSA9PSBC\nb29sZWFuLmNsYXNzKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAg\nICAgICAgIGdldHRlciA9IHR5cGUuZ2V0TWV0aG9kKCJpcyIgKyBuYW1lLCAo\nQ2xhc3NbXSkgbnVsbCk7ICAgDQogICAgICAgICAgICAgICAgaWYgKGdldHRl\nci5nZXRSZXR1cm5UeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShwYXJhbSkNCiAg\nICAgICAgICAgICAgICAgICAgfHwgcGFyYW0uaXNBc3NpZ25hYmxlRnJvbShn\nZXR0ZXIuZ2V0UmV0dXJuVHlwZSgpKSkNCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGdldHRlcjsNCiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiBuc21lKSB7DQogICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQog\nICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAq\nIFJldHVybiB3aGV0aGVyIHRoZSB0YXJnZXQgc3RyaW5nIHN0YXJzIHdpdGgg\ndGhlIGdpdmVuIHRva2VuLg0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGlj\nIGJvb2xlYW4gc3RhcnRzV2l0aChTdHJpbmcgc3RyLCBTdHJpbmcgdG9rZW4p\nIHsNCiAgICAgICAgcmV0dXJuIHN0ci5zdGFydHNXaXRoKHRva2VuKQ0KICAg\nICAgICAgICAgJiYgKHN0ci5sZW5ndGgoKSA9PSB0b2tlbi5sZW5ndGgoKSAN\nCiAgICAgICAgICAgIHx8IENoYXJhY3Rlci5pc1VwcGVyQ2FzZShzdHIuY2hh\nckF0KHRva2VuLmxlbmd0aCgpKSkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAg\nICAqIFByb3h5IHRoZSBnaXZlbiBzZXR0ZXIgbWV0aG9kIHRvIGRpcnR5IHRo\nZSBwcm94eSBvd25lci4NCiAgICAgKi8NCiAgICBwcml2YXRlIHZvaWQgcHJv\neHlTZXR0ZXIoQkNDbGFzcyBiYywgQ2xhc3MgdHlwZSwgTWV0aG9kIG1ldGgp\nIHsNCiAgICAgICAgQ2xhc3NbXSBwYXJhbXMgPSBtZXRoLmdldFBhcmFtZXRl\nclR5cGVzKCk7DQogICAgICAgIENsYXNzIHJldCA9IG1ldGguZ2V0UmV0dXJu\nVHlwZSgpOw0KICAgICAgICBCQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1ldGhv\nZChtZXRoLmdldE5hbWUoKSwgcmV0LCBwYXJhbXMpOw0KICAgICAgICBtLm1h\na2VQdWJsaWMoKTsNCiAgICAgICAgQ29kZSBjb2RlID0gbS5nZXRDb2RlKHRy\ndWUpOw0KICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOw0KICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7DQogICAgICAgIGNv\nZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFByb3hpZXMuY2xhc3MsICJk\naXJ0eSIsIHZvaWQuY2xhc3MsDQogICAgICAgICAgICBuZXcgQ2xhc3NbXSB7\nIFByb3h5LmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOw0KICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0VGhpcygpOw0KICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHBhcmFtcy5sZW5ndGg7IGkrKykNCiAgICAgICAgICAgIGNvZGUueGxv\nYWQoKS5zZXRQYXJhbShpKS5zZXRUeXBlKHBhcmFtc1tpXSk7DQogICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCBtZXRoLmdl\ndE5hbWUoKSwgcmV0LCBwYXJhbXMpOw0KICAgICAgICBjb2RlLnhyZXR1cm4o\nKS5zZXRUeXBlKHJldCk7DQogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsNCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsNCiAg\nICB9DQoNCiAgICAvKioNCiAgICAgKiBBZGQgYSB3cml0ZVJlcGxhY2UgaW1w\nbGVtZW50YXRpb24gdGhhdCBzZXJpYWxpemVzIHRvIGEgbm9uLXByb3h5IHR5\ncGUNCiAgICAgKiB1bmxlc3MgZGV0YWNoZWQgYW5kIHRoaXMgaXMgYSBidWls\nZC10aW1lIGdlbmVyYXRlZCBjbGFzcy4NCiAgICAgKi8NCiAgICBwcml2YXRl\nIHZvaWQgYWRkV3JpdGVSZXBsYWNlTWV0aG9kKEJDQ2xhc3MgYmMsIGJvb2xl\nYW4gcnVudGltZSkgew0KICAgICAgICBCQ01ldGhvZCBtID0gYmMuZGVjbGFy\nZU1ldGhvZCgid3JpdGVSZXBsYWNlIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsN\nCiAgICAgICAgbS5tYWtlUHJvdGVjdGVkKCk7DQogICAgICAgIG0uZ2V0RXhj\nZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24oT2JqZWN0U3RyZWFtRXhjZXB0\naW9uLmNsYXNzKTsNCiAgICAgICAgQ29kZSBjb2RlID0gbS5nZXRDb2RlKHRy\ndWUpOw0KICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOw0KICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoIXJ1bnRpbWUpOw0KICAgICAg\nICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChQcm94aWVzLmNsYXNz\nLCAid3JpdGVSZXBsYWNlIiwgDQogICAgICAgICAgICBPYmplY3QuY2xhc3Ms\nIG5ldyBDbGFzc1tdIHsgUHJveHkuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7\nDQogICAgICAgIGNvZGUuYXJldHVybigpOw0KICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heExvY2FscygpOw0KICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlIGEgdW5p\ncXVlIGlkIHRvIGF2b2lkIHByb3h5IGNsYXNzIG5hbWUgY29uZmxpY3RzLg0K\nICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIHN5bmNocm9uaXplZCBsb25n\nIG5leHRQcm94eUlkKCkgew0KICAgICAgICByZXR1cm4gX3Byb3h5SWQrKzsN\nCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBGaW5kIGFuIGFwcHJvcHJpYXRl\nIGNvcHkgY29uc3RydWN0b3IgZm9yIHRoZSBnaXZlbiB0eXBlLCBvciByZXR1\ncm4gbnVsbA0KICAgICAqIGlmIG5vbmUuDQogICAgICovDQogICAgcHJvdGVj\ndGVkIENvbnN0cnVjdG9yIGZpbmRDb3B5Q29uc3RydWN0b3IoQ2xhc3MgY2xz\nKSB7DQogICAgICAgIENvbnN0cnVjdG9yW10gY29ucyA9IGNscy5nZXRDb25z\ndHJ1Y3RvcnMoKTsNCiAgICAgICAgQ29uc3RydWN0b3IgbWF0Y2ggPSBudWxs\nOw0KICAgICAgICBDbGFzcyBtYXRjaFBhcmFtID0gbnVsbDsNCiAgICAgICAg\nQ2xhc3NbXSBwYXJhbXM7DQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY29ucy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgcGFyYW1zID0gY29u\nc1tpXS5nZXRQYXJhbWV0ZXJUeXBlcygpOw0KICAgICAgICAgICAgaWYgKHBh\ncmFtcy5sZW5ndGggIT0gMSkNCiAgICAgICAgICAgICAgICBjb250aW51ZTsN\nCg0KICAgICAgICAgICAgLy8gcXVpdCBpbW1lZGlhdGVseSBvbiBleGFjdCBt\nYXRjaA0KICAgICAgICAgICAgaWYgKHBhcmFtc1swXSA9PSBjbHMpDQogICAg\nICAgICAgICAgICAgcmV0dXJuIGNvbnNbaV07DQoNCiAgICAgICAgICAgIGlm\nIChwYXJhbXNbMF0uaXNBc3NpZ25hYmxlRnJvbShjbHMpICYmIChtYXRjaFBh\ncmFtID09IG51bGwNCiAgICAgICAgICAgICAgICB8fCBtYXRjaFBhcmFtLmlz\nQXNzaWduYWJsZUZyb20ocGFyYW1zWzBdKSkpIHsNCiAgICAgICAgICAgICAg\nICAgLy8gdHJhY2sgbW9zdCBkZXJpdmVkIGNvbGxlY3Rpb24gY29uc3RydWN0\nb3INCiAgICAgICAgICAgICAgICBtYXRjaCA9IGNvbnNbaV07DQogICAgICAg\nICAgICAgICAgbWF0Y2hQYXJhbSA9IHBhcmFtc1swXTsNCiAgICAgICAgICAg\nIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbWF0Y2g7IA0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIFJldHVybiB0aGUgY29uc3RydWN0b3IgdGhh\ndCB0YWtlcyBhIGNvbXBhcmF0b3IgZm9yIHRoZSBnaXZlbiB0eXBlLCBvcg0K\nICAgICAqIG51bGwgaWYgbm9uZS4NCiAgICAgKi8NCiAgICBwcml2YXRlIHN0\nYXRpYyBDb25zdHJ1Y3RvciBmaW5kQ29tcGFyYXRvckNvbnN0cnVjdG9yKENs\nYXNzIGNscykgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcmV0dXJu\nIGNscy5nZXRDb25zdHJ1Y3RvcihuZXcgQ2xhc3NbXSB7IENvbXBhcmF0b3Iu\nY2xhc3MgfSk7DQogICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiBuc21lKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOw0KICAgICAgICB9DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogVXNhZ2U6IGphdmEgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwucHJveHkuUHJveHlNYW5hZ2VySW1wbCBbb3B0aW9uXSoNCiAg\nICAgKiAmbHQ7Y2xhc3MgbmFtZSZndDsrPGJyIC8+DQogICAgICogV2hlcmUg\ndGhlIGZvbGxvd2luZyBvcHRpb25zIGFyZSByZWNvZ25pemVkOg0KICAgICAq\nIDx1bD4gDQogICAgICogPGxpPjxpPi11dGlscy8tdSAmbHQ7bnVtYmVyJmd0\nOzwvaT46IEdlbmVyYXRlIHByb3hpZXMgZm9yIHRoZSBzdGFuZGFyZA0KICAg\nICAqIGphdmEudXRpbCBjb2xsZWN0aW9uLCBtYXAsIGRhdGUsIGFuZCBjYWxl\nbmRhciBjbGFzc2VzIG9mIHRoZSBnaXZlbiBKYXZhDQogICAgICogdmVyc2lv\nbi4gIFVzZSA0IGZvciBKYXZhIDEuNCwgNSBmb3IgSmF2YSA1LCBldGMuPC9s\naT4NCiAgICAgKiA8L3VsPg0KICAgICAqDQogICAgICogVGhlIG1haW4gbWV0\naG9kIGdlbmVyYXRlcyAuY2xhc3MgZmlsZXMgZm9yIHRoZSBwcm94aWVzIHRv\nIHRoZSBjbGFzc2VzICAgIA0KICAgICAqIGdpdmVuIG9uIHRoZSBjb21tYW5k\nIGxpbmUuICBJdCB3cml0ZXMgdGhlIGdlbmVyYXRlZCBjbGFzc2VzIHRvIGJl\nc2lkZSB0aGUNCiAgICAgKiBQcm94eU1hbmFnZXJJbXBsLmNsYXNzIGZpbGUg\naWYgcG9zc2libGU7IG90aGVyd2lzZSBpdCB3cml0ZXMgdG8gdGhlIA0KICAg\nICAqIGN1cnJlbnQgZGlyZWN0b3J5LiAgVGhlIHByb3h5IG1hbmFnZXIgbG9v\na3MgZm9yIHRoZXNlIGNsYXNzZXMgDQogICAgICogYmVmb3JlIGdlbmVyYXRp\nbmcgaXRzIG93biBwcm94aWVzIGF0IHJ1bnRpbWUuDQogICAgICovDQogICAg\ncHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgDQogICAg\nICAgIHRocm93cyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uLCBJT0V4Y2VwdGlv\nbiB7DQogICAgICAgIEZpbGUgZGlyID0gRmlsZXMuZ2V0Q2xhc3NGaWxlKFBy\nb3h5TWFuYWdlckltcGwuY2xhc3MpOw0KICAgICAgICBkaXIgPSAoZGlyID09\nIG51bGwpID8gbmV3IEZpbGUoKFN0cmluZykgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoDQogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRQ\ncm9wZXJ0eUFjdGlvbigidXNlci5kaXIiKSkpDQogICAgICAgICAgICA6IGRp\nci5nZXRQYXJlbnRGaWxlKCk7DQoNCiAgICAgICAgT3B0aW9ucyBvcHRzID0g\nbmV3IE9wdGlvbnMoKTsNCiAgICAgICAgYXJncyA9IG9wdHMuc2V0RnJvbUNt\nZExpbmUoYXJncyk7DQoNCiAgICAgICAgTGlzdCB0eXBlcyA9IG5ldyBBcnJh\neUxpc3QoKTsNCiAgICAgICAgdHlwZXMuYWRkQWxsKEFycmF5cy5hc0xpc3Qo\nYXJncykpOw0KICAgICAgICBpbnQgdXRpbHMgPSBvcHRzLnJlbW92ZUludFBy\nb3BlcnR5KCJ1dGlscyIsICJ1IiwgMCk7DQogICAgICAgIGlmICh1dGlscyA+\nPSA0KSB7DQogICAgICAgICAgICB0eXBlcy5hZGRBbGwoQXJyYXlzLmFzTGlz\ndChuZXcgU3RyaW5nW10gew0KICAgICAgICAgICAgICAgIGphdmEuc3FsLkRh\ndGUuY2xhc3MuZ2V0TmFtZSgpLA0KICAgICAgICAgICAgICAgIGphdmEuc3Fs\nLlRpbWUuY2xhc3MuZ2V0TmFtZSgpLA0KICAgICAgICAgICAgICAgIGphdmEu\nc3FsLlRpbWVzdGFtcC5jbGFzcy5nZXROYW1lKCksDQogICAgICAgICAgICAg\nICAgamF2YS51dGlsLkFycmF5TGlzdC5jbGFzcy5nZXROYW1lKCksDQogICAg\nICAgICAgICAgICAgamF2YS51dGlsLkRhdGUuY2xhc3MuZ2V0TmFtZSgpLA0K\nICAgICAgICAgICAgICAgIGphdmEudXRpbC5HcmVnb3JpYW5DYWxlbmRhci5j\nbGFzcy5nZXROYW1lKCksDQogICAgICAgICAgICAgICAgamF2YS51dGlsLkhh\nc2hNYXAuY2xhc3MuZ2V0TmFtZSgpLA0KICAgICAgICAgICAgICAgIGphdmEu\ndXRpbC5IYXNoU2V0LmNsYXNzLmdldE5hbWUoKSwNCiAgICAgICAgICAgICAg\nICBqYXZhLnV0aWwuSGFzaHRhYmxlLmNsYXNzLmdldE5hbWUoKSwNCiAgICAg\nICAgICAgICAgICBqYXZhLnV0aWwuTGlua2VkTGlzdC5jbGFzcy5nZXROYW1l\nKCksDQogICAgICAgICAgICAgICAgamF2YS51dGlsLlByb3BlcnRpZXMuY2xh\nc3MuZ2V0TmFtZSgpLA0KICAgICAgICAgICAgICAgIGphdmEudXRpbC5UcmVl\nTWFwLmNsYXNzLmdldE5hbWUoKSwNCiAgICAgICAgICAgICAgICBqYXZhLnV0\naWwuVHJlZVNldC5jbGFzcy5nZXROYW1lKCksDQogICAgICAgICAgICAgICAg\namF2YS51dGlsLlZlY3Rvci5jbGFzcy5nZXROYW1lKCksDQogICAgICAgICAg\nICB9KSk7IA0KICAgICAgICB9DQogICAgICAgIGlmICh1dGlscyA+PSA1KSB7\nDQogICAgICAgICAgICB0eXBlcy5hZGRBbGwoQXJyYXlzLmFzTGlzdChuZXcg\nU3RyaW5nW10gew0KICAgICAgICAgICAgICAgICJqYXZhLnV0aWwuRW51bU1h\ncCIsDQogICAgICAgICAgICAgICAgImphdmEudXRpbC5JZGVudGl0eUhhc2hN\nYXAiLA0KICAgICAgICAgICAgICAgICJqYXZhLnV0aWwuTGlua2VkSGFzaE1h\ncCIsDQogICAgICAgICAgICAgICAgImphdmEudXRpbC5MaW5rZWRIYXNoU2V0\nIiwNCiAgICAgICAgICAgICAgICAiamF2YS51dGlsLlByaW9yaXR5UXVldWUi\nLA0KICAgICAgICAgICAgfSkpOyANCiAgICAgICAgfQ0KDQogICAgICAgIGZp\nbmFsIFByb3h5TWFuYWdlckltcGwgbWdyID0gbmV3IFByb3h5TWFuYWdlcklt\ncGwoKTsNCiAgICAgICAgQ2xhc3MgY2xzOw0KICAgICAgICBCQ0NsYXNzIGJj\nOw0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHR5cGVzLnNpemUoKTsg\naSsrKSB7DQogICAgICAgICAgICBjbHMgPSBDbGFzcy5mb3JOYW1lKChTdHJp\nbmcpIHR5cGVzLmdldChpKSk7DQogICAgICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgICAgIGlmIChDbGFzcy5mb3JOYW1lKGdldFByb3h5Q2xhc3NOYW1l\nKGNscywgZmFsc2UpLCB0cnVlLA0KICAgICAgICAgICAgICAgICAgICBHZW5l\ncmF0ZWRDbGFzc2VzLmdldE1vc3REZXJpdmVkTG9hZGVyKGNscywgUHJveHku\nY2xhc3MpKQ0KICAgICAgICAgICAgICAgICAgICAhPSBudWxsKQ0KICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0gY2F0Y2gg\nKFRocm93YWJsZSB0KSB7DQogICAgICAgICAgICAgICAgLy8gZXhwZWN0ZWQg\naWYgdGhlIGNsYXNzIGhhc24ndCBiZWVuIGdlbmVyYXRlZA0KICAgICAgICAg\nICAgfQ0KDQogICAgICAgICAgICBpZiAoQ29sbGVjdGlvbi5jbGFzcy5pc0Fz\nc2lnbmFibGVGcm9tKGNscykpDQogICAgICAgICAgICAgICAgYmMgPSBtZ3Iu\nZ2VuZXJhdGVQcm94eUNvbGxlY3Rpb25CeXRlY29kZShjbHMsIGZhbHNlKTsg\nICAgICAgICANCiAgICAgICAgICAgIGVsc2UgaWYgKE1hcC5jbGFzcy5pc0Fz\nc2lnbmFibGVGcm9tKGNscykpDQogICAgICAgICAgICAgICAgYmMgPSBtZ3Iu\nZ2VuZXJhdGVQcm94eU1hcEJ5dGVjb2RlKGNscywgZmFsc2UpOyAgICAgICAg\nIA0KICAgICAgICAgICAgZWxzZSBpZiAoRGF0ZS5jbGFzcy5pc0Fzc2lnbmFi\nbGVGcm9tKGNscykpDQogICAgICAgICAgICAgICAgYmMgPSBtZ3IuZ2VuZXJh\ndGVQcm94eURhdGVCeXRlY29kZShjbHMsIGZhbHNlKTsNCiAgICAgICAgICAg\nIGVsc2UgaWYgKENhbGVuZGFyLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xz\nKSkNCiAgICAgICAgICAgICAgICBiYyA9IG1nci5nZW5lcmF0ZVByb3h5Q2Fs\nZW5kYXJCeXRlY29kZShjbHMsIGZhbHNlKTsNCiAgICAgICAgICAgIGVsc2Ug\new0KICAgICAgICAgICAgICAgIGZpbmFsIENsYXNzIGZDbHMgPSBjbHM7DQog\nICAgICAgICAgICAgICAgYmMgPSAoQkNDbGFzcykgQWNjZXNzQ29udHJvbGxl\ncg0KICAgICAgICAgICAgICAgICAgICAuZG9Qcml2aWxlZ2VkKG5ldyBQcml2\naWxlZ2VkQWN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcHVi\nbGljIE9iamVjdCBydW4oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIG1nci5nZW5lcmF0ZVByb3h5QmVhbkJ5dGVjb2RlKGZDbHMs\nIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAg\nICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAg\nIFN5c3RlbS5vdXQucHJpbnRsbihiYy5nZXROYW1lKCkpOw0KICAgICAgICAg\nICAgYmMud3JpdGUobmV3IEZpbGUoZGlyLCBiYy5nZXRDbGFzc05hbWUoKSAr\nICIuY2xhc3MiKSk7DQogICAgICAgIH0NCiAgICB9DQp9DQo=\n","encoding":"base64"}

