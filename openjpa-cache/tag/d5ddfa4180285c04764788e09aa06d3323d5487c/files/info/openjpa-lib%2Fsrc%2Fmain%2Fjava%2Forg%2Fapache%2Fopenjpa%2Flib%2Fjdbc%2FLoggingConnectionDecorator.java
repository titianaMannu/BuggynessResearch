{"sha":"c403e80382ff1be82898e20fdb0a845004b456c8","node_id":"MDQ6QmxvYjIwNjM2NDpjNDAzZTgwMzgyZmYxYmU4Mjg5OGUyMGZkYjBhODQ1MDA0YjQ1NmM4","size":47732,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c403e80382ff1be82898e20fdb0a845004b456c8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmM7CgppbXBvcnQg\namF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uUmVhZGVyOwpp\nbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9ydCBqYXZhLnNxbC5B\ncnJheTsKaW1wb3J0IGphdmEuc3FsLkJhdGNoVXBkYXRlRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS5zcWwuQmxvYjsKaW1wb3J0IGphdmEuc3FsLkNsb2I7Cmlt\ncG9ydCBqYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuRGF0\nYWJhc2VNZXRhRGF0YTsKaW1wb3J0IGphdmEuc3FsLkRhdGU7CmltcG9ydCBq\nYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlJl\nZjsKaW1wb3J0IGphdmEuc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3Fs\nLlJlc3VsdFNldE1ldGFEYXRhOwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0\naW9uOwppbXBvcnQgamF2YS5zcWwuU1FMV2FybmluZzsKaW1wb3J0IGphdmEu\nc3FsLlNhdmVwb2ludDsKaW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1w\nb3J0IGphdmEuc3FsLlRpbWU7CmltcG9ydCBqYXZhLnNxbC5UaW1lc3RhbXA7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5DYWxlbmRhcjsKaW1wb3J0IGph\ndmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwoKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsKCi8q\nKgogKiBBIHtAbGluayBDb25uZWN0aW9uRGVjb3JhdG9yfSB0aGF0IGNyZWF0\nZXMgbG9nZ2luZyBjb25uZWN0aW9ucyBhbmQKICoge0BsaW5rIFJlcG9ydGlu\nZ1NRTEV4Y2VwdGlvbn1zLgogKgogKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21t\nZWF1eAogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgTG9nZ2luZ0Nv\nbm5lY3Rpb25EZWNvcmF0b3IgaW1wbGVtZW50cyBDb25uZWN0aW9uRGVjb3Jh\ndG9yIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgU0VQID0g\nSjJEb1ByaXZIZWxwZXIuZ2V0TGluZVNlcGFyYXRvcigpOwoKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBXQVJOX0lHTk9SRSA9IDA7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgV0FSTl9MT0dfVFJBQ0UgPSAxOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFdBUk5fTE9HX0lORk8gPSAyOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFdBUk5fTE9HX1dBUk4gPSAz\nOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFdBUk5fTE9HX0VSUk9S\nID0gNDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBXQVJOX1RIUk9X\nID0gNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBXQVJOX0hBTkRM\nRSA9IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmdbXSBXQVJO\nSU5HX0FDVElPTlMgPSBuZXcgU3RyaW5nWzddOwoKICAgIHN0YXRpYyB7CiAg\nICAgICAgV0FSTklOR19BQ1RJT05TW1dBUk5fSUdOT1JFXSA9ICJpZ25vcmUi\nOwogICAgICAgIFdBUk5JTkdfQUNUSU9OU1tXQVJOX0xPR19UUkFDRV0gPSAi\ndHJhY2UiOwogICAgICAgIFdBUk5JTkdfQUNUSU9OU1tXQVJOX0xPR19JTkZP\nXSA9ICJpbmZvIjsKICAgICAgICBXQVJOSU5HX0FDVElPTlNbV0FSTl9MT0df\nV0FSTl0gPSAid2FybiI7CiAgICAgICAgV0FSTklOR19BQ1RJT05TW1dBUk5f\nTE9HX0VSUk9SXSA9ICJlcnJvciI7CiAgICAgICAgV0FSTklOR19BQ1RJT05T\nW1dBUk5fVEhST1ddID0gInRocm93IjsKICAgICAgICBXQVJOSU5HX0FDVElP\nTlNbV0FSTl9IQU5ETEVdID0gImhhbmRsZSI7CiAgICB9CgogICAgcHJpdmF0\nZSBmaW5hbCBEYXRhU291cmNlTG9ncyBfbG9ncyA9IG5ldyBEYXRhU291cmNl\nTG9ncygpOwogICAgcHJpdmF0ZSBTUUxGb3JtYXR0ZXIgX2Zvcm1hdHRlcjsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfcHJldHR5UHJpbnQ7CiAgICBwcml2YXRl\nIGludCBfcHJldHR5UHJpbnRMaW5lTGVuZ3RoID0gNjA7CiAgICBwcml2YXRl\nIGludCBfd2FybmluZ0FjdGlvbiA9IFdBUk5fSUdOT1JFOwogICAgcHJpdmF0\nZSBTUUxXYXJuaW5nSGFuZGxlciBfd2FybmluZ0hhbmRsZXI7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX3RyYWNrUGFyYW1ldGVycyA9IHRydWU7CgogICAgLyoq\nCiAgICAgKiBJZiBzZXQgdG8gPGNvZGU+dHJ1ZTwvY29kZT4sIHByZXR0eS1w\ncmludCBTUUwgYnkgcnVubmluZyBpdAogICAgICogdGhyb3VnaCB7QGxpbmsg\nU1FMRm9ybWF0dGVyI3ByZXR0eVByaW50fS4gSWYKICAgICAqIDxjb2RlPmZh\nbHNlPC9jb2RlPiwgZG9uJ3QgcHJldHR5LXByaW50LCBhbmQgb3V0cHV0IFNR\nTCBsb2dzIGluCiAgICAgKiBhIHNpbmdsZSBsaW5lLiBQcmV0dHktcHJpbnRl\nZCBTUUwgY2FuIGJlIGVhc2llciBmb3IgYSBodW1hbiB0bwogICAgICogcmVh\nZCwgYnV0IGlzIGhhcmRlciB0byBwYXJzZSB3aXRoIHRvb2xzIGxpa2UgZ3Jl\ncC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UHJldHR5UHJpbnQoYm9v\nbGVhbiBwcmV0dHlQcmludCkgewogICAgICAgIF9wcmV0dHlQcmludCA9IHBy\nZXR0eVByaW50OwogICAgICAgIGlmIChfZm9ybWF0dGVyID09IG51bGwgJiYg\nX3ByZXR0eVByaW50KSB7CiAgICAgICAgICAgIF9mb3JtYXR0ZXIgPSBuZXcg\nU1FMRm9ybWF0dGVyKCk7CiAgICAgICAgICAgIF9mb3JtYXR0ZXIuc2V0TGlu\nZUxlbmd0aChfcHJldHR5UHJpbnRMaW5lTGVuZ3RoKTsKICAgICAgICB9IGVs\nc2UgaWYgKCFfcHJldHR5UHJpbnQpCiAgICAgICAgICAgIF9mb3JtYXR0ZXIg\nPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQHNlZSAjc2V0UHJldHR5\nUHJpbnQKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0UHJldHR5UHJp\nbnQoKSB7CiAgICAgICAgcmV0dXJuIF9wcmV0dHlQcmludDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyB0byBwcmlu\ndCBwZXIgbGluZSB3aGVuCiAgICAgKiBwcmV0dHktcHJpbnRpbmcgb2YgU1FM\nIGlzIGVuYWJsZWQuIERlZmF1bHRzIHRvIDYwIHRvIHByb3ZpZGUKICAgICAq\nIHNvbWUgc3BhY2UgZm9yIGFueSBhbnQtcmVsYXRlZCBjaGFyYWN0ZXJzIG9u\nIHRoZSBsZWZ0IG9mIGEKICAgICAqIHN0YW5kYXJkIDgwLWNoYXJhY3RlciBk\naXNwbGF5LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQcmV0dHlQcmlu\ndExpbmVMZW5ndGgoaW50IGxlbmd0aCkgewogICAgICAgIF9wcmV0dHlQcmlu\ndExpbmVMZW5ndGggPSBsZW5ndGg7CiAgICAgICAgaWYgKF9mb3JtYXR0ZXIg\nIT0gbnVsbCkKICAgICAgICAgICAgX2Zvcm1hdHRlci5zZXRMaW5lTGVuZ3Ro\nKGxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAc2VlICNzZXRQcmV0\ndHlQcmludExpbmVMZW5ndGgKICAgICAqLwogICAgcHVibGljIGludCBnZXRQ\ncmV0dHlQcmludExpbmVMZW5ndGgoKSB7CiAgICAgICAgcmV0dXJuIF9wcmV0\ndHlQcmludExpbmVMZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIHRvIHRyYWNrIHBhcmFtZXRlcnMgZm9yIHRoZSBwdXJwb3NlcyBvZiBy\nZXBvcnRpbmcgZXhjZXB0aW9ucy4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0VHJhY2tQYXJhbWV0ZXJzKGJvb2xlYW4gdHJhY2tQYXJhbWV0ZXJzKSB7\nCiAgICAgICAgX3RyYWNrUGFyYW1ldGVycyA9IHRyYWNrUGFyYW1ldGVyczsK\nICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdHJhY2sgcGFyYW1l\ndGVycyBmb3IgdGhlIHB1cnBvc2VzIG9mIHJlcG9ydGluZyBleGNlcHRpb25z\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRUcmFja1BhcmFtZXRl\ncnMoKSB7CiAgICAgICAgcmV0dXJuIF90cmFja1BhcmFtZXRlcnM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGF0IHRvIGRvIHdpdGggU1FMIHdhcm5pbmdz\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRXYXJuaW5nQWN0aW9uKFN0\ncmluZyB3YXJuaW5nQWN0aW9uKSB7CiAgICAgICAgaW50IGluZGV4ID0gQXJy\nYXlzLmFzTGlzdChXQVJOSU5HX0FDVElPTlMpLmluZGV4T2Yod2FybmluZ0Fj\ndGlvbik7CiAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAgICAgaW5k\nZXggPSBXQVJOX0lHTk9SRTsKICAgICAgICBfd2FybmluZ0FjdGlvbiA9IGlu\nZGV4OwogICAgfQoKICAgIC8qKgogICAgICogV2hhdCB0byBkbyB3aXRoIFNR\nTCB3YXJuaW5ncy4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRXYXJu\naW5nQWN0aW9uKCkgewogICAgICAgIHJldHVybiBXQVJOSU5HX0FDVElPTlNb\nX3dhcm5pbmdBY3Rpb25dOwogICAgfQoKICAgIC8qKgogICAgICogV2hhdCB0\nbyBkbyB3aXRoIFNRTCB3YXJuaW5ncy4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0V2FybmluZ0hhbmRsZXIoU1FMV2FybmluZ0hhbmRsZXIgd2Fybmlu\nZ0hhbmRsZXIpIHsKICAgICAgICBfd2FybmluZ0hhbmRsZXIgPSB3YXJuaW5n\nSGFuZGxlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoYXQgdG8gZG8gd2l0\naCBTUUwgd2FybmluZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxXYXJuaW5n\nSGFuZGxlciBnZXRXYXJuaW5nSGFuZGxlcigpIHsKICAgICAgICByZXR1cm4g\nX3dhcm5pbmdIYW5kbGVyOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGxv\nZyB0byB3cml0ZSB0by4KICAgICAqLwogICAgcHVibGljIERhdGFTb3VyY2VM\nb2dzIGdldExvZ3MoKSB7CiAgICAgICAgcmV0dXJuIF9sb2dzOwogICAgfQoK\nICAgIHB1YmxpYyBDb25uZWN0aW9uIGRlY29yYXRlKENvbm5lY3Rpb24gY29u\nbikgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIG5ldyBM\nb2dnaW5nQ29ubmVjdGlvbihjb25uKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEluY2x1ZGUgU1FMIGluIGV4Y2VwdGlvbi4KICAgICAqLwogICAgcHJpdmF0\nZSBTUUxFeGNlcHRpb24gd3JhcChTUUxFeGNlcHRpb24gc3FsZSwgU3RhdGVt\nZW50IHN0bW50KSB7CiAgICAgICAgaWYgKHNxbGUgaW5zdGFuY2VvZiBSZXBv\ncnRpbmdTUUxFeGNlcHRpb24pCiAgICAgICAgICAgIHJldHVybiAoUmVwb3J0\naW5nU1FMRXhjZXB0aW9uKSBzcWxlOwogICAgICAgIHJldHVybiBuZXcgUmVw\nb3J0aW5nU1FMRXhjZXB0aW9uKHNxbGUsIHN0bW50KTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEluY2x1ZGUgU1FMIGluIGV4Y2VwdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBTUUxFeGNlcHRpb24gd3JhcChTUUxFeGNlcHRpb24gc3Fs\nZSwgU3RyaW5nIHNxbCkgewogICAgICAgIGlmIChzcWxlIGluc3RhbmNlb2Yg\nUmVwb3J0aW5nU1FMRXhjZXB0aW9uKQogICAgICAgICAgICByZXR1cm4gKFJl\ncG9ydGluZ1NRTEV4Y2VwdGlvbikgc3FsZTsKICAgICAgICByZXR1cm4gbmV3\nIFJlcG9ydGluZ1NRTEV4Y2VwdGlvbihzcWxlLCBzcWwpOwogICAgfQoKICAg\nIC8qKgogICAgICogSW50ZXJmYWNlIHRoYXQgYWxsb3dzIGN1c3RvbWl6YXRp\nb24gb2Ygd2hhdCB0byBkbyB3aGVuCiAgICAgKiB7QGxpbmsgU1FMV2Fybmlu\nZ31zIG9jY3VyLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGludGVyZmFj\nZSBTUUxXYXJuaW5nSGFuZGxlciB7CgogICAgICAgIHB1YmxpYyB2b2lkIGhh\nbmRsZVdhcm5pbmcoU1FMV2FybmluZyB3YXJuaW5nKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uOwogICAgfQoKICAgIC8qKgogICAgICogTG9nZ2luZyBjb25uZWN0\naW9uLgogICAgICovCiAgICBwcml2YXRlIGNsYXNzIExvZ2dpbmdDb25uZWN0\naW9uIGV4dGVuZHMgRGVsZWdhdGluZ0Nvbm5lY3Rpb24gewoKICAgICAgICBw\ndWJsaWMgTG9nZ2luZ0Nvbm5lY3Rpb24oQ29ubmVjdGlvbiBjb25uKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgc3VwZXIoY29ubik7CiAg\nICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQg\ncHJlcGFyZVN0YXRlbWVudChTdHJpbmcgc3FsLCBib29sZWFuIHdyYXApCiAg\nICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQg\nPSBzdXBlci5wcmVwYXJlU3RhdGVtZW50KHNxbCwgZmFsc2UpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQo\nc3RtbnQsIHNxbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICAgICAgdGhyb3cgd3JhcChzZSwgc3FsKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFBy\nZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwg\naW50IHJzVHlwZSwKICAgICAgICAgICAgaW50IHJzQ29uY3VyLCBib29sZWFu\nIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBz\ndXBlci5wcmVwYXJlU3RhdGVtZW50CiAgICAgICAgICAgICAgICAgICAgKHNx\nbCwgcnNUeXBlLCByc0NvbmN1ciwgZmFsc2UpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQoc3RtbnQsIHNx\nbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgd3JhcChzZSwgc3FsKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFN0YXRlbWVudCBj\ncmVhdGVTdGF0ZW1lbnQoYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgU3RhdGVtZW50IHN0bW50ID0gc3VwZXIuY3Jl\nYXRlU3RhdGVtZW50KGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBM\nb2dnaW5nU3RhdGVtZW50KHN0bW50KTsKICAgICAgICB9CgogICAgICAgIHBy\nb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGludCB0eXBlLCBp\nbnQgY29uY3VycmVuY3ksCiAgICAgICAgICAgIGJvb2xlYW4gd3JhcCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIFN0YXRlbWVudCBzdG1u\ndCA9IHN1cGVyLmNyZWF0ZVN0YXRlbWVudCh0eXBlLCBjb25jdXJyZW5jeSwg\nZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gbmV3IExvZ2dpbmdTdGF0ZW1l\nbnQoc3RtbnQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY29t\nbWl0KCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGxvbmcg\nc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN1cGVyLmNvbW1pdCgpOwogICAg\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9sb2dz\nLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5s\nb2dKREJDKCJjb21taXQiLCBzdGFydCwgdGhpcyk7CiAgICAgICAgICAgICAg\nICBoYW5kbGVTUUxXYXJuaW5nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrKCkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3Vy\ncmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHN1cGVyLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoInJvbGxiYWNr\nIiwgc3RhcnQsIHRoaXMpOwogICAgICAgICAgICAgICAgaGFuZGxlU1FMV2Fy\nbmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBjbG9zZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzdXBlci5jbG9z\nZSgpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\naWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBfbG9ncy5sb2dKREJDKCJjbG9zZSIsIHN0YXJ0LCB0aGlzKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIFNhdmVwb2ludCBz\nZXRTYXZlcG9pbnQoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVy\nLnNldFNhdmVwb2ludCgpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJzYXZlcG9pbnQiLCBzdGFy\ndCwgdGhpcyk7CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJuaW5nKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTYXZl\ncG9pbnQgc2V0U2F2ZXBvaW50KFN0cmluZyBuYW1lKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJy\nZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLnNldFNhdmVwb2ludChuYW1lKTsKICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5p\nc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9n\nSkRCQygic2F2ZXBvaW50OiAiICsgbmFtZSwgc3RhcnQsIHRoaXMpOwogICAg\nICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZygpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCByb2xsYmFjayhTYXZl\ncG9pbnQgc2F2ZXBvaW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3VwZXIucm9s\nbGJhY2soc2F2ZXBvaW50KTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpIHsKICAg\nICAgICAgICAgICAgICAgICBTdHJpbmcgbmFtZSA9IG51bGw7CiAgICAgICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFt\nZSA9IHNhdmVwb2ludC5nZXRTYXZlcG9pbnROYW1lKCk7CiAgICAgICAgICAg\nICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNxZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBuYW1lID0gU3RyaW5nLnZhbHVlT2Yoc2F2ZXBv\naW50LmdldFNhdmVwb2ludElkKCkpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJyb2xsYmFjazog\nIiArIG5hbWUsIHN0YXJ0LCB0aGlzKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5pbmcoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVsZWFzZVNhdmVw\nb2ludChTYXZlcG9pbnQgc2F2ZXBvaW50KSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nc3VwZXIucmVsZWFzZVNhdmVwb2ludChzYXZlcG9pbnQpOwogICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRC\nQ0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAgIFN0cmluZyBuYW1l\nID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgICAgICBuYW1lID0gc2F2ZXBvaW50LmdldFNhdmVwb2ludE5h\nbWUoKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc3FlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBTdHJp\nbmcudmFsdWVPZihzYXZlcG9pbnQuZ2V0U2F2ZXBvaW50SWQoKSk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxv\nZ0pEQkMoInJlbGVhc2U6ICIgKyBuYW1lLCBzdGFydCwgdGhpcyk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJuaW5n\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByb3RlY3Rl\nZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGludCByZXN1bHRTZXRUeXBl\nLAogICAgICAgICAgICBpbnQgcmVzdWx0U2V0Q29uY3VycmVuY3ksIGludCBy\nZXN1bHRTZXRIb2xkYWJpbGl0eSwgYm9vbGVhbiB3cmFwKQogICAgICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgU3RhdGVtZW50\nIHN0bW50ID0gc3VwZXIuY3JlYXRlU3RhdGVtZW50KHJlc3VsdFNldFR5cGUs\nCiAgICAgICAgICAgICAgICByZXN1bHRTZXRDb25jdXJyZW5jeSwgcmVzdWx0\nU2V0SG9sZGFiaWxpdHksIGZhbHNlKTsKICAgICAgICAgICAgaGFuZGxlU1FM\nV2FybmluZygpOwogICAgICAgICAgICByZXR1cm4gbmV3IExvZ2dpbmdTdGF0\nZW1lbnQoc3RtbnQpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFBy\nZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwK\nICAgICAgICAgICAgaW50IHJlc3VsdFNldFR5cGUsIGludCByZXN1bHRTZXRD\nb25jdXJyZW5jeSwKICAgICAgICAgICAgaW50IHJlc3VsdFNldEhvbGRhYmls\naXR5LCBib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQgPSBzdXBlci5wcmVwYXJlU3RhdGVtZW50CiAgICAgICAgICAg\nICAgICAgICAgKHNxbCwgcmVzdWx0U2V0VHlwZSwgcmVzdWx0U2V0Q29uY3Vy\ncmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFNldEhvbGRh\nYmlsaXR5LCBmYWxzZSk7CiAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJu\naW5nKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExvZ2dpbmdQcmVw\nYXJlZFN0YXRlbWVudChzdG1udCwgc3FsKTsKICAgICAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyB3\ncmFwKHNlLCBzcWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVu\ndChTdHJpbmcgc3FsLAogICAgICAgICAgICBpbnQgYXV0b0dlbmVyYXRlZEtl\neXMsIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCA9IHN1cGVyLnByZXBhcmVTdGF0ZW1lbnQKICAgICAgICAgICAg\nICAgICAgICAoc3FsLCBhdXRvR2VuZXJhdGVkS2V5cywgZmFsc2UpOwogICAg\nICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZygpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQoc3RtbnQs\nIHNxbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICAgICAgdGhyb3cgd3JhcChzZSwgc3FsKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFByZXBhcmVk\nU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwKICAgICAg\nICAgICAgaW50W10gY29sdW1uSW5kZXhlcywgYm9vbGVhbiB3cmFwKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gc3VwZXIucHJlcGFy\nZVN0YXRlbWVudAogICAgICAgICAgICAgICAgICAgIChzcWwsIGNvbHVtbklu\nZGV4ZXMsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5p\nbmcoKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTG9nZ2luZ1ByZXBh\ncmVkU3RhdGVtZW50KHN0bW50LCBzcWwpOwogICAgICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIHRocm93IHdy\nYXAoc2UsIHNxbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50\nKFN0cmluZyBzcWwsCiAgICAgICAgICAgIFN0cmluZ1tdIGNvbHVtbk5hbWVz\nLCBib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQgPSBzdXBlci5wcmVwYXJlU3RhdGVtZW50CiAgICAgICAgICAgICAg\nICAgICAgKHNxbCwgY29sdW1uTmFtZXMsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGhhbmRsZVNRTFdhcm5pbmcoKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50KHN0bW50LCBzcWwpOwog\nICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAg\nICAgICAgICAgIHRocm93IHdyYXAoc2UsIHNxbCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBEYXRhYmFzZU1ldGFEYXRh\nIGdldE1ldGFEYXRhKGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTG9nZ2lu\nZ0RhdGFiYXNlTWV0YURhdGEoc3VwZXIuZ2V0TWV0YURhdGEoZmFsc2UpKTsK\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIExvZyB0aW1lIGVs\nYXBzZWQgc2luY2UgZ2l2ZW4gc3RhcnQuCiAgICAgICAgICovCiAgICAgICAg\ncHJpdmF0ZSB2b2lkIGxvZ1RpbWUobG9uZyBzdGFydFRpbWUpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICBpZiAoX2xvZ3MuaXNTUUxFbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICBfbG9ncy5sb2dTUUwoInNwZW50Iiwg\nc3RhcnRUaW1lLCB0aGlzKTsgCiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBMb2cgdGltZSBlbGFwc2VkIHNpbmNlIGdpdmVuIHN0YXJ0Lgog\nICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBsb2dTUUwoU3RhdGVt\nZW50IHN0bW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\naWYgKF9sb2dzLmlzU1FMRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZ3MubG9nU1FMKCJleGVjdXRpbmcgIiArIHN0bW50LCB0aGlzKTsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIExvZyB0aW1lIGVsYXBzZWQg\nc2luY2UgZ2l2ZW4gc3RhcnQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0\nZSB2b2lkIGxvZ0JhdGNoU1FMKFN0YXRlbWVudCBzdG1udCkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChfbG9ncy5pc1NRTEVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgIF9sb2dzLmxvZ1NRTCgiZXhlY3V0aW5n\nIGJhdGNoICIgKyBzdG1udCwgdGhpcyk7CiAgICAgICAgfQoKICAgICAgICAv\nKioKICAgICAgICAgKiBIYW5kbGUgYW55IHtAbGluayBTUUxXYXJuaW5nfXMg\nb24gdGhlIGN1cnJlbnQge0BsaW5rIENvbm5lY3Rpb259LgogICAgICAgICAq\nCiAgICAgICAgICogQHNlZSAjaGFuZGxlU1FMV2FybmluZyhTUUxXYXJuaW5n\nKQogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBoYW5kbGVTUUxX\nYXJuaW5nKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlm\nIChfd2FybmluZ0FjdGlvbiA9PSBXQVJOX0lHTk9SRSkKICAgICAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBoYW5kbGVTUUxXYXJuaW5nKGdldFdhcm5pbmdzKCkpOwogICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgY2xlYXJXYXJuaW5ncygp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBIYW5kbGUgYW55IHtAbGluayBTUUxXYXJuaW5nfXMgb24gdGhlIHNw\nZWNpZmllZCB7QGxpbmsgU3RhdGVtZW50fS4KICAgICAgICAgKgogICAgICAg\nICAqIEBzZWUgI2hhbmRsZVNRTFdhcm5pbmcoU1FMV2FybmluZykKICAgICAg\nICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgaGFuZGxlU1FMV2FybmluZyhT\ndGF0ZW1lbnQgc3RtbnQpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICBpZiAoX3dhcm5pbmdBY3Rpb24gPT0gV0FSTl9JR05PUkUpCiAgICAg\nICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhzdG1udC5nZXRXYXJuaW5ncygp\nKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHN0\nbW50LmNsZWFyV2FybmluZ3MoKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogSGFuZGxlIGFueSB7QGxpbmsgU1FM\nV2FybmluZ31zIG9uIHRoZSBzcGVjaWZpZWQge0BsaW5rIFJlc3VsdFNldH0u\nCiAgICAgICAgICoKICAgICAgICAgKiBAc2VlICNoYW5kbGVTUUxXYXJuaW5n\nKFNRTFdhcm5pbmcpCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lk\nIGhhbmRsZVNRTFdhcm5pbmcoUmVzdWx0U2V0IHJzKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgaWYgKF93YXJuaW5nQWN0aW9uID09IFdB\nUk5fSUdOT1JFKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5pbmcocnMu\nZ2V0V2FybmluZ3MoKSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICBycy5jbGVhcldhcm5pbmdzKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEhhbmRsZSB0aGUg\nc3BlY2lmaWVkIHtAbGluayBTUUxXYXJuaW5nfSBkZXBlbmRpbmcgb24gdGhl\nCiAgICAgICAgICogc2V0dGluZyBvZiB0aGUge0BsaW5rICNzZXRXYXJuaW5n\nQWN0aW9ufSBhdHRyaWJ1dGUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFy\nYW0gd2FybmluZyB0aGUgd2FybmluZyB0byBoYW5kbGUKICAgICAgICAgKi8K\nICAgICAgICBwcml2YXRlIHZvaWQgaGFuZGxlU1FMV2FybmluZyhTUUxXYXJu\naW5nIHdhcm5pbmcpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICBpZiAod2FybmluZyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICBpZiAoX3dhcm5pbmdBY3Rpb24gPT0gV0FSTl9JR05P\nUkUpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBMb2cg\nbG9nID0gX2xvZ3MuZ2V0SkRCQ0xvZygpOwogICAgICAgICAgICBmb3IgKDsg\nd2FybmluZyAhPSBudWxsOyB3YXJuaW5nID0gd2FybmluZy5nZXROZXh0V2Fy\nbmluZygpKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF93YXJuaW5nQWN0\naW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBXQVJOX0xPR19UUkFD\nRToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNl\nKHdhcm5pbmcpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgICAgICBjYXNlIFdBUk5fTE9HX0lORk86CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChsb2cuaXNJbmZvRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmluZm8od2FybmluZyk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nICAgIGNhc2UgV0FSTl9MT0dfV0FSTjoKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsb2cud2Fybih3YXJuaW5nKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBXQVJO\nX0xPR19FUlJPUjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvZy5p\nc0Vycm9yRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbG9nLmVycm9yKHdhcm5pbmcpOwogICAgICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFdBUk5fVEhST1c6CiAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIGp1c3QgdGhyb3cgaXQgYXMgaWYg\naXQgd2VyZSBhIFNRTEV4Y2VwdGlvbgogICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvdyB3YXJuaW5nOwogICAgICAgICAgICAgICAgICAgIGNhc2UgV0FS\nTl9IQU5ETEU6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfd2Fybmlu\nZ0hhbmRsZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIF93YXJuaW5nSGFuZGxlci5oYW5kbGVXYXJuaW5nKHdhcm5pbmcpOwogICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUK\nICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIE1ldGFkYXRhIHdyYXBwZXIgdGhhdCBsb2dzIGFjdGlvbnMuCiAg\nICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBjbGFzcyBMb2dnaW5nRGF0YWJh\nc2VNZXRhRGF0YQogICAgICAgICAgICBleHRlbmRzIERlbGVnYXRpbmdEYXRh\nYmFzZU1ldGFEYXRhIHsKCiAgICAgICAgICAgIHB1YmxpYyBMb2dnaW5nRGF0\nYWJhc2VNZXRhRGF0YShEYXRhYmFzZU1ldGFEYXRhIG1ldGEpIHsKICAgICAg\nICAgICAgICAgIHN1cGVyKG1ldGEsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0\nIGdldEJlc3RSb3dJZGVudGlmaWVyKFN0cmluZyBjYXRhbG9nLAogICAgICAg\nICAgICAgICAgU3RyaW5nIHNjaGVtYSwgU3RyaW5nIHRhYmxlLCBpbnQgc2Nv\ncGUsIGJvb2xlYW4gbnVsbGFibGUpCiAgICAgICAgICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pE\nQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRC\nQygiZ2V0QmVzdFJvd0lkZW50aWZpZXI6ICIKICAgICAgICAgICAgICAgICAg\nICAgICAgKyBjYXRhbG9nICsgIiwgIiArIHNjaGVtYSArICIsICIgKyB0YWJs\nZSwKICAgICAgICAgICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24u\ndGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0QmVzdFJv\nd0lkZW50aWZpZXIoY2F0YWxvZywgc2NoZW1hLAogICAgICAgICAgICAgICAg\nICAgIHRhYmxlLCBzY29wZSwgbnVsbGFibGUpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0IGdldENhdGFsb2dzKCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3Mu\naXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxv\nZ0pEQkMoImdldENhdGFsb2dzIiwgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0Q2F0YWxvZ3MoKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIFJlc3VsdFNldCBn\nZXRDb2x1bW5Qcml2aWxlZ2VzKFN0cmluZyBjYXRhbG9nLCBTdHJpbmcgc2No\nZW1hLAogICAgICAgICAgICAgICAgU3RyaW5nIHRhYmxlLCBTdHJpbmcgY29s\ndW1uTmFtZVBhdHRlcm4pIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJnZXRDb2x1bW5Qcml2aWxlZ2Vz\nOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxvZyArICIsICIg\nKyBzY2hlbWEgKyAiLCAiICsgdGFibGUsCiAgICAgICAgICAgICAgICAgICAg\nICAgIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHN1cGVyLmdldENvbHVtblByaXZpbGVnZXMoY2F0YWxvZywgc2No\nZW1hLAogICAgICAgICAgICAgICAgICAgIHRhYmxlLCBjb2x1bW5OYW1lUGF0\ndGVybik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBSZXN1\nbHRTZXQgZ2V0Q29sdW1ucyhTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVt\nYVBhdHRlcm4sCiAgICAgICAgICAgICAgICBTdHJpbmcgdGFibGVOYW1lUGF0\ndGVybiwgU3RyaW5nIGNvbHVtbk5hbWVQYXR0ZXJuKQogICAgICAgICAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAo\nX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9s\nb2dzLmxvZ0pEQkMoImdldENvbHVtbnM6ICIKICAgICAgICAgICAgICAgICAg\nICAgICAgKyBjYXRhbG9nICsgIiwgIiArIHNjaGVtYVBhdHRlcm4gKyAiLCAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICsgdGFibGVOYW1lUGF0dGVybiAr\nICIsICIgKyBjb2x1bW5OYW1lUGF0dGVybiwKICAgICAgICAgICAgICAgICAg\nICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gc3VwZXIuZ2V0Q29sdW1ucyhjYXRhbG9nLCBzY2hlbWFQYXR0\nZXJuLAogICAgICAgICAgICAgICAgICAgIHRhYmxlTmFtZVBhdHRlcm4sIGNv\nbHVtbk5hbWVQYXR0ZXJuKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHVibGljIFJlc3VsdFNldCBnZXRDcm9zc1JlZmVyZW5jZShTdHJpbmcgcHJp\nbWFyeUNhdGFsb2csCiAgICAgICAgICAgICAgICBTdHJpbmcgcHJpbWFyeVNj\naGVtYSwgU3RyaW5nIHByaW1hcnlUYWJsZSwKICAgICAgICAgICAgICAgIFN0\ncmluZyBmb3JlaWduQ2F0YWxvZywgU3RyaW5nIGZvcmVpZ25TY2hlbWEsCiAg\nICAgICAgICAgICAgICBTdHJpbmcgZm9yZWlnblRhYmxlKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNF\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygi\nZ2V0Q3Jvc3NSZWZlcmVuY2U6ICIKICAgICAgICAgICAgICAgICAgICAgICAg\nKyBwcmltYXJ5Q2F0YWxvZyArICIsICIgKyBwcmltYXJ5U2NoZW1hICsgIiwg\nIgogICAgICAgICAgICAgICAgICAgICAgICArIHByaW1hcnlUYWJsZSArICIs\nICIgKyBmb3JlaWduQ2F0YWxvZyArICIsICIKICAgICAgICAgICAgICAgICAg\nICAgICAgKyBmb3JlaWduU2NoZW1hICsgIiwgIiArIGZvcmVpZ25TY2hlbWEs\nCiAgICAgICAgICAgICAgICAgICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLnRo\naXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldENyb3NzUmVm\nZXJlbmNlKHByaW1hcnlDYXRhbG9nLCBwcmltYXJ5U2NoZW1hLAogICAgICAg\nICAgICAgICAgICAgIHByaW1hcnlUYWJsZSwgZm9yZWlnbkNhdGFsb2csIGZv\ncmVpZ25TY2hlbWEsIGZvcmVpZ25UYWJsZSk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0RXhwb3J0ZWRLZXlzKFN0\ncmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hLAogICAgICAgICAgICAgICAg\nU3RyaW5nIHRhYmxlKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0RXhwb3J0ZWRLZXlzOiAiCiAg\nICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxvZyArICIsICIgKyBzY2hl\nbWEgKyAiLCAiICsgdGFibGUsCiAgICAgICAgICAgICAgICAgICAgICAgIExv\nZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHN1cGVyLmdldEV4cG9ydGVkS2V5cyhjYXRhbG9nLCBzY2hlbWEsIHRhYmxl\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIFJlc3VsdFNl\ndCBnZXRJbXBvcnRlZEtleXMoU3RyaW5nIGNhdGFsb2csIFN0cmluZyBzY2hl\nbWEsCiAgICAgICAgICAgICAgICBTdHJpbmcgdGFibGUpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0Vu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJn\nZXRJbXBvcnRlZEtleXM6ICIKICAgICAgICAgICAgICAgICAgICAgICAgKyBj\nYXRhbG9nICsgIiwgIiArIHNjaGVtYSArICIsICIgKyB0YWJsZSwKICAgICAg\nICAgICAgICAgICAgICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0SW1wb3J0ZWRLZXlzKGNh\ndGFsb2csIHNjaGVtYSwgdGFibGUpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgUmVzdWx0U2V0IGdldEluZGV4SW5mbyhTdHJpbmcgY2F0\nYWxvZywgU3RyaW5nIHNjaGVtYSwKICAgICAgICAgICAgICAgIFN0cmluZyB0\nYWJsZSwgYm9vbGVhbiB1bmlxdWUsIGJvb2xlYW4gYXBwcm94aW1hdGUpCiAg\nICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0SW5kZXhJbmZvOiAiCiAgICAg\nICAgICAgICAgICAgICAgICAgICsgY2F0YWxvZyArICIsICIgKyBzY2hlbWEg\nKyAiLCAiICsgdGFibGUsCiAgICAgICAgICAgICAgICAgICAgICAgIExvZ2dp\nbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1\ncGVyLmdldEluZGV4SW5mbyhjYXRhbG9nLCBzY2hlbWEsIHRhYmxlLCB1bmlx\ndWUsCiAgICAgICAgICAgICAgICAgICAgYXBwcm94aW1hdGUpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0IGdldFByaW1h\ncnlLZXlzKFN0cmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hLAogICAgICAg\nICAgICAgICAgU3RyaW5nIHRhYmxlKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0UHJpbWFyeUtl\neXM6ICIKICAgICAgICAgICAgICAgICAgICAgICAgKyBjYXRhbG9nICsgIiwg\nIiArIHNjaGVtYSArICIsICIgKyB0YWJsZSwKICAgICAgICAgICAgICAgICAg\nICAgICAgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gc3VwZXIuZ2V0UHJpbWFyeUtleXMoY2F0YWxvZywgc2NoZW1h\nLCB0YWJsZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBS\nZXN1bHRTZXQgZ2V0UHJvY2VkdXJlQ29sdW1ucyhTdHJpbmcgY2F0YWxvZywK\nICAgICAgICAgICAgICAgIFN0cmluZyBzY2hlbWFQYXR0ZXJuLCBTdHJpbmcg\ncHJvY2VkdXJlTmFtZVBhdHRlcm4sCiAgICAgICAgICAgICAgICBTdHJpbmcg\nY29sdW1uTmFtZVBhdHRlcm4pIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJnZXRQcm9jZWR1cmVDb2x1\nbW5zOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgY2F0YWxvZyArICIs\nICIgKyBzY2hlbWFQYXR0ZXJuICsgIiwgIgogICAgICAgICAgICAgICAgICAg\nICAgICArIHByb2NlZHVyZU5hbWVQYXR0ZXJuICsgIiwgIiArIGNvbHVtbk5h\nbWVQYXR0ZXJuLAogICAgICAgICAgICAgICAgICAgICAgICBMb2dnaW5nQ29u\nbmVjdGlvbi50aGlzKTsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5n\nZXRQcm9jZWR1cmVDb2x1bW5zKGNhdGFsb2csIHNjaGVtYVBhdHRlcm4sCiAg\nICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlTmFtZVBhdHRlcm4sIGNvbHVt\nbk5hbWVQYXR0ZXJuKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIFJlc3VsdFNldCBnZXRQcm9jZWR1cmVzKFN0cmluZyBjYXRhbG9nLAog\nICAgICAgICAgICAgICAgU3RyaW5nIHNjaGVtYVBhdHRlcm4sIFN0cmluZyBw\ncm9jZWR1cmVOYW1lUGF0dGVybikKICAgICAgICAgICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRC\nQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJD\nKCJnZXRQcm9jZWR1cmVzOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsg\nY2F0YWxvZyArICIsICIgKyBzY2hlbWFQYXR0ZXJuICsgIiwgIgogICAgICAg\nICAgICAgICAgICAgICAgICArIHByb2NlZHVyZU5hbWVQYXR0ZXJuLCBMb2dn\naW5nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICAgICAgICAgIHJldHVybiBz\ndXBlci5nZXRQcm9jZWR1cmVzKGNhdGFsb2csIHNjaGVtYVBhdHRlcm4sCiAg\nICAgICAgICAgICAgICAgICAgcHJvY2VkdXJlTmFtZVBhdHRlcm4pOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0U2V0IGdldFNj\naGVtYXMoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAg\nIGlmIChfbG9ncy5pc0pEQkNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgX2xvZ3MubG9nSkRCQygiZ2V0U2NoZW1hcyIsIExvZ2dpbmdDb25uZWN0\naW9uLnRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFNj\naGVtYXMoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIFJl\nc3VsdFNldCBnZXRUYWJsZVByaXZpbGVnZXMoU3RyaW5nIGNhdGFsb2csCiAg\nICAgICAgICAgICAgICBTdHJpbmcgc2NoZW1hUGF0dGVybiwgU3RyaW5nIHRh\nYmxlTmFtZVBhdHRlcm4pCiAgICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0\nVGFibGVQcml2aWxlZ2VzIiwgTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VGFibGVQcml2aWxlZ2Vz\nKGNhdGFsb2csIHNjaGVtYVBhdHRlcm4sCiAgICAgICAgICAgICAgICAgICAg\ndGFibGVOYW1lUGF0dGVybik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHB1YmxpYyBSZXN1bHRTZXQgZ2V0VGFibGVzKFN0cmluZyBjYXRhbG9nLCBT\ndHJpbmcgc2NoZW1hUGF0dGVybiwKICAgICAgICAgICAgICAgIFN0cmluZyB0\nYWJsZU5hbWVQYXR0ZXJuLCBTdHJpbmdbXSB0eXBlcykgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoImdl\ndFRhYmxlczogIgogICAgICAgICAgICAgICAgICAgICAgICArIGNhdGFsb2cg\nKyAiLCAiICsgc2NoZW1hUGF0dGVybiArICIsICIKICAgICAgICAgICAgICAg\nICAgICAgICAgKyB0YWJsZU5hbWVQYXR0ZXJuLCBMb2dnaW5nQ29ubmVjdGlv\nbi50aGlzKTsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5nZXRUYWJs\nZXMoY2F0YWxvZywgc2NoZW1hUGF0dGVybiwKICAgICAgICAgICAgICAgICAg\nICB0YWJsZU5hbWVQYXR0ZXJuLCB0eXBlcyk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHB1YmxpYyBSZXN1bHRTZXQgZ2V0VGFibGVUeXBlcygpIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKF9sb2dz\nLmlzSkRCQ0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9ncy5s\nb2dKREJDKCJnZXRUYWJsZVR5cGVzIiwgTG9nZ2luZ0Nvbm5lY3Rpb24udGhp\ncyk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VGFibGVUeXBl\ncygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgUmVzdWx0\nU2V0IGdldFR5cGVJbmZvKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoImdldFR5cGVJbmZvIiwgTG9n\nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nc3VwZXIuZ2V0VHlwZUluZm8oKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcHVibGljIFJlc3VsdFNldCBnZXRVRFRzKFN0cmluZyBjYXRhbG9nLCBT\ndHJpbmcgc2NoZW1hUGF0dGVybiwKICAgICAgICAgICAgICAgIFN0cmluZyB0\neXBlTmFtZVBhdHRlcm4sIGludFtdIHR5cGVzKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIGlmIChfbG9ncy5pc0pEQkNFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZ3MubG9nSkRCQygiZ2V0VURU\ncyIsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHN1cGVyLmdldFVEVHMoY2F0YWxvZywgc2NoZW1hUGF0dGVybiwK\nICAgICAgICAgICAgICAgICAgICB0eXBlTmFtZVBhdHRlcm4sIHR5cGVzKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIFJlc3VsdFNldCBn\nZXRWZXJzaW9uQ29sdW1ucyhTdHJpbmcgY2F0YWxvZywKICAgICAgICAgICAg\nICAgIFN0cmluZyBzY2hlbWEsIFN0cmluZyB0YWJsZSkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoImdl\ndFZlcnNpb25Db2x1bW5zOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsg\nY2F0YWxvZyArICIsICIgKyBzY2hlbWEgKyAiLCAiICsgdGFibGUsCiAgICAg\nICAgICAgICAgICAgICAgICAgIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFZlcnNpb25Db2x1bW5z\nKGNhdGFsb2csIHNjaGVtYSwgdGFibGUpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTdGF0ZW1lbnQgd3JhcHBl\nciB0aGF0IGxvZ3MgU1FMIHRvIHRoZSBwYXJlbnQgZGF0YSBzb3VyY2UgYW5k\nCiAgICAgICAgICogcmVtZW1iZXJzIHRoZSBsYXN0IHBpZWNlIG9mIFNRTCB0\nbyBiZSBleGVjdXRlZCBvbiBpdC4KICAgICAgICAgKi8KICAgICAgICBwcml2\nYXRlIGNsYXNzIExvZ2dpbmdTdGF0ZW1lbnQgZXh0ZW5kcyBEZWxlZ2F0aW5n\nU3RhdGVtZW50IHsKCiAgICAgICAgICAgIHByaXZhdGUgU3RyaW5nIF9zcWwg\nPSBudWxsOwoKICAgICAgICAgICAgcHVibGljIExvZ2dpbmdTdGF0ZW1lbnQo\nU3RhdGVtZW50IHN0bW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIHN1cGVyKHN0bW50LCBMb2dnaW5nQ29ubmVjdGlvbi50aGlz\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgYXBw\nZW5kSW5mbyhTdHJpbmdCdWZmZXIgYnVmKSB7CiAgICAgICAgICAgICAgICBp\nZiAoX3NxbCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiICIpOwogICAgICAgICAgICAgICAgICAgIGlmIChfZm9ybWF0dGVy\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVu\nZChTRVApOwogICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKF9m\nb3JtYXR0ZXIucHJldHR5UHJpbnQoX3NxbCkpOwogICAgICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoX3NxbCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwcm90ZWN0ZWQgUmVz\ndWx0U2V0IHdyYXBSZXN1bHQoUmVzdWx0U2V0IHJzLCBib29sZWFuIHdyYXAp\nIHsKICAgICAgICAgICAgICAgIGlmICghd3JhcCB8fCBycyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci53cmFwUmVzdWx0KHJz\nLCB3cmFwKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTG9nZ2luZ1Jl\nc3VsdFNldChycywgdGhpcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIGNhbmNlbCgpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgaWYgKF9sb2dzLmlzSkRCQ0VuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgICAgICBfbG9ncy5sb2dKREJDKCJjYW5jZWwgIiArIHRo\naXMsIExvZ2dpbmdDb25uZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAg\nc3VwZXIuY2FuY2VsKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBy\nb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KFN0cmluZyBzcWwsIGJv\nb2xlYW4gd3JhcCkKICAgICAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgX3NxbCA9IHNxbDsKICAgICAgICAgICAg\nICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAgIGxvbmcgc3RhcnQg\nPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1\ndGVRdWVyeShzcWwsIHdyYXApOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nd3JhcChzZSwgTG9nZ2luZ1N0YXRlbWVudC50aGlzKTsKICAgICAgICAgICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgbG9nVGltZShz\ndGFydCk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhM\nb2dnaW5nU3RhdGVtZW50LnRoaXMpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgaW50IGV4ZWN1dGVVcGRh\ndGUoU3RyaW5nIHNxbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgICAgICBfc3FsID0gc3FsOwogICAgICAgICAgICAgICAgbG9nU1FMKHRo\naXMpOwogICAgICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJy\nZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZVVwZGF0ZShzcWwp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgd3JhcChzZSwgTG9nZ2luZ1N0\nYXRlbWVudC50aGlzKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICAgICAgbG9nVGltZShzdGFydCk7CiAgICAgICAgICAg\nICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhMb2dnaW5nU3RhdGVtZW50LnRo\naXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBleGVjdXRlKFN0cmluZyBzcWwpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgX3NxbCA9IHNxbDsK\nICAgICAgICAgICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAg\nIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHN1cGVyLmV4ZWN1dGUoc3FsKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAgIHRocm93\nIHdyYXAoc2UsIExvZ2dpbmdTdGF0ZW1lbnQudGhpcyk7CiAgICAgICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUo\nc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5pbmco\nTG9nZ2luZ1N0YXRlbWVudC50aGlzKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBjbGFzcyBM\nb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQKICAgICAgICAgICAgZXh0ZW5kcyBE\nZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQgewoKICAgICAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBTdHJpbmcgX3NxbDsKICAgICAgICAgICAgcHJpdmF0ZSBM\naXN0IF9wYXJhbXMgPSBudWxsOwogICAgICAgICAgICBwcml2YXRlIExpc3Qg\nX3BhcmFtQmF0Y2ggPSBudWxsOwoKICAgICAgICAgICAgcHVibGljIExvZ2dp\nbmdQcmVwYXJlZFN0YXRlbWVudChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwg\nU3RyaW5nIHNxbCkKICAgICAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgc3VwZXIoc3RtbnQsIExvZ2dpbmdDb25u\nZWN0aW9uLnRoaXMpOwogICAgICAgICAgICAgICAgX3NxbCA9IHNxbDsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHJvdGVjdGVkIFJlc3VsdFNldCB3\ncmFwUmVzdWx0KFJlc3VsdFNldCBycywgYm9vbGVhbiB3cmFwKSB7CiAgICAg\nICAgICAgICAgICBpZiAoIXdyYXAgfHwgcnMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gc3VwZXIud3JhcFJlc3VsdChycywgd3JhcCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExvZ2dpbmdSZXN1bHRTZXQo\ncnMsIHRoaXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcm90ZWN0\nZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShTdHJpbmcgc3FsLCBib29sZWFu\nIHdyYXApCiAgICAgICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIGxvZ1NRTCh0aGlzKTsKICAgICAgICAgICAgICAg\nIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHN1cGVyLmV4ZWN1dGVRdWVyeShzcWwsIHdyYXApOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgd3JhcChzZSwgTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50\nLnRoaXMpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgICAgICAgICBsb2dUaW1lKHN0YXJ0KTsKICAgICAgICAgICAgICAgICAg\nICBjbGVhckxvZ1BhcmFtZXRlcnModHJ1ZSk7CiAgICAgICAgICAgICAgICAg\nICAgaGFuZGxlU1FMV2FybmluZyhMb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQu\ndGhpcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZShTdHJpbmcgc3FsKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGxvZ1NRTCh0\naGlzKTsKICAgICAgICAgICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3Vy\ncmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVVcGRhdGUoc3Fs\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICAgICAgICAgIHRocm93IHdyYXAoc2UsIExvZ2dpbmdQ\ncmVwYXJlZFN0YXRlbWVudC50aGlzKTsKICAgICAgICAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICAgICAgbG9nVGltZShzdGFydCk7CiAg\nICAgICAgICAgICAgICAgICAgY2xlYXJMb2dQYXJhbWV0ZXJzKHRydWUpOwog\nICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5pbmcoTG9nZ2luZ1By\nZXBhcmVkU3RhdGVtZW50LnRoaXMpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBleGVjdXRl\nKFN0cmluZyBzcWwpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICAgICAgbG9nU1FMKHRoaXMpOwogICAgICAgICAgICAgICAgbG9uZyBzdGFy\ndCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhl\nY3V0ZShzcWwpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgd3JhcChzZSwg\nTG9nZ2luZ1ByZXBhcmVkU3RhdGVtZW50LnRoaXMpOwogICAgICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBsb2dUaW1lKHN0\nYXJ0KTsKICAgICAgICAgICAgICAgICAgICBjbGVhckxvZ1BhcmFtZXRlcnMo\ndHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhM\nb2dnaW5nUHJlcGFyZWRTdGF0ZW1lbnQudGhpcyk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByb3RlY3RlZCBSZXN1\nbHRTZXQgZXhlY3V0ZVF1ZXJ5KGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgICAgICBsb2dTUUwodGhpcyk7CiAgICAg\nICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBzdXBlci5leGVjdXRlUXVlcnkod3JhcCk7CiAgICAgICAg\nICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyB3cmFwKHNlLCBMb2dnaW5nUHJlcGFyZWRTdGF0\nZW1lbnQudGhpcyk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQpOwogICAgICAgICAgICAg\nICAgICAgIGNsZWFyTG9nUGFyYW1ldGVycyh0cnVlKTsKICAgICAgICAgICAg\nICAgICAgICBoYW5kbGVTUUxXYXJuaW5nKExvZ2dpbmdQcmVwYXJlZFN0YXRl\nbWVudC50aGlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIGludCBleGVjdXRlVXBkYXRlKCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBsb2dTUUwodGhpcyk7\nCiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRU\naW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlVXBkYXRlKCk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyB3cmFwKHNlLCBMb2dnaW5nUHJlcGFyZWRT\ndGF0ZW1lbnQudGhpcyk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQpOwogICAgICAgICAg\nICAgICAgICAgIGNsZWFyTG9nUGFyYW1ldGVycyh0cnVlKTsKICAgICAgICAg\nICAgICAgICAgICBoYW5kbGVTUUxXYXJuaW5nKExvZ2dpbmdQcmVwYXJlZFN0\nYXRlbWVudC50aGlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIGludFtdIGV4ZWN1dGVCYXRjaCgpIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgbG9nQmF0Y2hT\nUUwodGhpcyk7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVt\nLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlQmF0Y2go\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBleGNlcHRpb24gaXMg\nYSBCYXRjaFVwZGF0ZUV4Y2VwdGlvbiwgYW5kCiAgICAgICAgICAgICAgICAg\nICAgLy8gd2UgYXJlIHRyYWNraW5nIHBhcmFtZXRlcnMsIHRoZW4gc2V0IHRo\nZSBjdXJyZW50CiAgICAgICAgICAgICAgICAgICAgLy8gcGFyYW1ldGVyIHNl\ndCB0byBiZSB0aGUgaW5kZXggb2YgdGhlIGZhaWxlZAogICAgICAgICAgICAg\nICAgICAgIC8vIHN0YXRlbWVudCBzbyB0aGF0IHRoZSBSZXBvcnRpbmdTUUxF\neGNlcHRpb24gd2lsbAogICAgICAgICAgICAgICAgICAgIC8vIHNob3cgdGhl\nIGNvcnJlY3QgcGFyYW0KICAgICAgICAgICAgICAgICAgICBpZiAoc2UgaW5z\ndGFuY2VvZiBCYXRjaFVwZGF0ZUV4Y2VwdGlvbgogICAgICAgICAgICAgICAg\nICAgICAgICAmJiBfcGFyYW1CYXRjaCAhPSBudWxsICYmIHNob3VsZFRyYWNr\nUGFyYW1ldGVycygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGludFtd\nIGNvdW50ID0gKChCYXRjaFVwZGF0ZUV4Y2VwdGlvbikgc2UpLgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZ2V0VXBkYXRlQ291bnRzKCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCAhPSBudWxsICYmIGNvdW50\nLmxlbmd0aCA8PSBfcGFyYW1CYXRjaC5zaXplKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBp\nbmRleCA9IC0xOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBjb3VudC5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIC0zIGlzIFN0YXRlbWVudC5TVEFU\nRU1FTlRfRkFJTEVELCBidXQgaXMKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAvLyBvbmx5IGF2YWlsYWJsZSBpbiBKREsgMS40KwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudFtpXSA9PSAtMykg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9\nIGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyBubyAtMyBlbGVtZW50OiBpdCBtYXkgYmUgdGhhdCB0aGUgc2Vy\ndmVyIHN0b3BwZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBy\nb2Nlc3NpbmcsIHNvIHRoZSBzaXplIG9mIHRoZSBjb3VudCB3aWxsIGJlCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgaW5kZXgKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PSAtMSkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGNvdW50Lmxlbmd0\naCArIDE7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRo\nZSBjdXJyZW50IHBhcmFtcyB0byB0aGUgc2F2ZWQgdmFsdWVzCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCBfcGFyYW1CYXRjaC5z\naXplKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3BhcmFt\ncyA9IChMaXN0KSBfcGFyYW1CYXRjaC5nZXQoaW5kZXgpOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIHRocm93IHdyYXAoc2UsIExvZ2dpbmdQcmVwYXJlZFN0\nYXRlbWVudC50aGlzKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICAgICAgbG9nVGltZShzdGFydCk7CiAgICAgICAgICAg\nICAgICAgICAgY2xlYXJMb2dQYXJhbWV0ZXJzKHRydWUpOwogICAgICAgICAg\nICAgICAgICAgIGhhbmRsZVNRTFdhcm5pbmcoTG9nZ2luZ1ByZXBhcmVkU3Rh\ndGVtZW50LnRoaXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBleGVjdXRlKCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBsb2dTUUwodGhpcyk7\nCiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRU\naW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlKCk7CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyB3cmFwKHNlLCBMb2dnaW5nUHJlcGFyZWRTdGF0ZW1l\nbnQudGhpcyk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICAgICAgICAgIGxvZ1RpbWUoc3RhcnQpOwogICAgICAgICAgICAgICAg\nICAgIGNsZWFyTG9nUGFyYW1ldGVycyh0cnVlKTsKICAgICAgICAgICAgICAg\nICAgICBoYW5kbGVTUUxXYXJuaW5nKExvZ2dpbmdQcmVwYXJlZFN0YXRlbWVu\ndC50aGlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIHZvaWQgY2FuY2VsKCkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZ3MuaXNKREJDRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2dzLmxvZ0pEQkMoImNhbmNl\nbCAiICsgdGhpcyArICI6ICIgKyBfc3FsLAogICAgICAgICAgICAgICAgICAg\nICAgICBMb2dnaW5nQ29ubmVjdGlvbi50aGlzKTsKCiAgICAgICAgICAgICAg\nICBzdXBlci5jYW5jZWwoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHVibGljIHZvaWQgc2V0TnVsbChpbnQgaTEsIGludCBpMikgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIo\naTEsICJudWxsIiwgbnVsbCk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRO\ndWxsKGkxLCBpMik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHNldEJvb2xlYW4oaW50IGksIGJvb2xlYW4gYikgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIo\naSwgYik7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRCb29sZWFuKGksIGIp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRC\neXRlKGludCBpLCBieXRlIGIpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksIGIpOwogICAgICAgICAg\nICAgICAgc3VwZXIuc2V0Qnl0ZShpLCBiKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2V0U2hvcnQoaW50IGksIHNob3J0IHMp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9n\nUGFyYW1ldGVyKGksIHMpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0U2hv\ncnQoaSwgcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHNldEludChpbnQgaTEsIGludCBpMikgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaTEsIGkyKTsK\nICAgICAgICAgICAgICAgIHN1cGVyLnNldEludChpMSwgaTIpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRMb25nKGludCBp\nLCBsb25nIGwpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAg\nICAgc2V0TG9nUGFyYW1ldGVyKGksIGwpOwogICAgICAgICAgICAgICAgc3Vw\nZXIuc2V0TG9uZyhpLCBsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHVibGljIHZvaWQgc2V0RmxvYXQoaW50IGksIGZsb2F0IGYpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVy\nKGksIGYpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0RmxvYXQoaSwgZik7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldERv\ndWJsZShpbnQgaSwgZG91YmxlIGQpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksIGQpOwogICAgICAg\nICAgICAgICAgc3VwZXIuc2V0RG91YmxlKGksIGQpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRCaWdEZWNpbWFsKGludCBp\nLCBCaWdEZWNpbWFsIGJkKQogICAgICAgICAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaSwg\nIkJpZ0RlY2ltYWwiLCBiZCk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRC\naWdEZWNpbWFsKGksIGJkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHVibGljIHZvaWQgc2V0U3RyaW5nKGludCBpLCBTdHJpbmcgcykgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0\nZXIoaSwgIlN0cmluZyIsIHMpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0\nU3RyaW5nKGksIHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJs\naWMgdm9pZCBzZXRCeXRlcyhpbnQgaSwgYnl0ZVtdIGIpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGks\nICJieXRlW10iLCBiKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldEJ5dGVz\nKGksIGIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBzZXREYXRlKGludCBpLCBEYXRlIGQpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJEYXRlIiwg\nZCk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXREYXRlKGksIGQpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRUaW1lKGlu\ndCBpLCBUaW1lIHQpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICAgICAgc2V0TG9nUGFyYW1ldGVyKGksICJUaW1lIiwgdCk7CiAgICAgICAg\nICAgICAgICBzdXBlci5zZXRUaW1lKGksIHQpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRUaW1lc3RhbXAoaW50IGksIFRp\nbWVzdGFtcCB0KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIHNldExvZ1BhcmFtZXRlcihpLCAiVGltZXN0YW1wIiwgdCk7CiAgICAg\nICAgICAgICAgICBzdXBlci5zZXRUaW1lc3RhbXAoaSwgdCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldEFzY2lpU3RyZWFt\nKGludCBpMSwgSW5wdXRTdHJlYW0gaXMsIGludCBpMikKICAgICAgICAgICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0\nTG9nUGFyYW1ldGVyKGkxLCAiSW5wdXRTdHJlYW0iLCBpcyk7CiAgICAgICAg\nICAgICAgICBzdXBlci5zZXRBc2NpaVN0cmVhbShpMSwgaXMsIGkyKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgc2V0VW5pY29k\nZVN0cmVhbShpbnQgaTEsIElucHV0U3RyZWFtIGlzLCBpbnQgaTIpCiAgICAg\nICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIHNldExvZ1BhcmFtZXRlcihpMSwgIklucHV0U3RyZWFtIiwgaXMpOwog\nICAgICAgICAgICAgICAgc3VwZXIuc2V0VW5pY29kZVN0cmVhbShpMiwgaXMs\nIGkyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQg\nc2V0QmluYXJ5U3RyZWFtKGludCBpMSwgSW5wdXRTdHJlYW0gaXMsIGludCBp\nMikKICAgICAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGkxLCAiSW5wdXRTdHJlYW0i\nLCBpcyk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRCaW5hcnlTdHJlYW0o\naTEsIGlzLCBpMik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIGNsZWFyUGFyYW1ldGVycygpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICAgICAgY2xlYXJMb2dQYXJhbWV0ZXJzKGZhbHNlKTsK\nICAgICAgICAgICAgICAgIHN1cGVyLmNsZWFyUGFyYW1ldGVycygpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRPYmplY3Qo\naW50IGkxLCBPYmplY3QgbywgaW50IGkyLCBpbnQgaTMpCiAgICAgICAgICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNl\ndExvZ1BhcmFtZXRlcihpMSwgIk9iamVjdCIsIG8pOwogICAgICAgICAgICAg\nICAgc3VwZXIuc2V0T2JqZWN0KGkxLCBvLCBpMiwgaTMpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZXRPYmplY3QoaW50IGkx\nLCBPYmplY3QgbywgaW50IGkyKQogICAgICAgICAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIo\naTEsICJPYmplY3QiLCBvKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldE9i\namVjdChpMSwgbywgaTIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBzZXRPYmplY3QoaW50IGksIE9iamVjdCBvKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFtZXRl\ncihpLCAiT2JqZWN0Iiwgbyk7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRP\nYmplY3QoaSwgbyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIGFkZEJhdGNoKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgICAgICBpZiAoX2xvZ3MuaXNTUUxFbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICAgICAgX2xvZ3MubG9nU1FMKCJiYXRjaGluZyAiICsgdGhpcywg\nTG9nZ2luZ0Nvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgICAgICAgICBsb25n\nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHN1cGVyLmFkZEJh\ndGNoKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNob3VsZFRyYWNrUGFy\nYW1ldGVycygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ug\nc3VyZSBvdXIgbGlzdCBpcyBpbml0aWFsaXplZAogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoX3BhcmFtQmF0Y2ggPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIF9wYXJhbUJhdGNoID0gbmV3IEFycmF5TGlzdCgp\nOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb3B5IHBhcmFtZXRlcnMg\nc2luY2UgdGhleSB3aWxsIGJlIHJlLXVzZWQKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKF9wYXJhbXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIF9wYXJhbUJhdGNoLmFkZChuZXcgQXJyYXlMaXN0KF9wYXJh\nbXMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgX3BhcmFtQmF0Y2guYWRkKG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGxvZ1RpbWUo\nc3RhcnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBzZXRDaGFyYWN0ZXJTdHJlYW0oaW50IGkx\nLCBSZWFkZXIgciwgaW50IGkyKQogICAgICAgICAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIo\naTEsICJSZWFkZXIiLCByKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldENo\nYXJhY3RlclN0cmVhbShpMSwgciwgaTIpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBzZXRSZWYoaW50IGksIFJlZiByKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNldExvZ1BhcmFt\nZXRlcihpLCAiUmVmIiwgcik7CiAgICAgICAgICAgICAgICBzdXBlci5zZXRS\nZWYoaSwgcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHNldEJsb2IoaW50IGksIEJsb2IgYikgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaSwgIkJsb2Ii\nLCBiKTsKICAgICAgICAgICAgICAgIHN1cGVyLnNldEJsb2IoaSwgYik7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldENsb2Io\naW50IGksIENsb2IgYykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaSwgIkNsb2IiLCBjKTsKICAgICAg\nICAgICAgICAgIHN1cGVyLnNldENsb2IoaSwgYyk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNldEFycmF5KGludCBpLCBBcnJh\neSBhKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHNl\ndExvZ1BhcmFtZXRlcihpLCAiQXJyYXkiLCBhKTsKICAgICAgICAgICAgICAg\nIHN1cGVyLnNldEFycmF5KGksIGEpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgUmVzdWx0U2V0TWV0YURhdGEgZ2V0TWV0YURhdGEoKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHJldHVybiBz\ndXBlci5nZXRNZXRhRGF0YSgpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZXREYXRlKGludCBpLCBEYXRlIGQsIENhbGVuZGFy\nIGMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgc2V0\nTG9nUGFyYW1ldGVyKGksICJEYXRlIiwgZCk7CiAgICAgICAgICAgICAgICBz\ndXBlci5zZXREYXRlKGksIGQsIGMpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBzZXRUaW1lKGludCBpLCBUaW1lIHQsIENhbGVu\nZGFyIGMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAg\nc2V0TG9nUGFyYW1ldGVyKGksICJUaW1lIiwgdCk7CiAgICAgICAgICAgICAg\nICBzdXBlci5zZXRUaW1lKGksIHQsIGMpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBzZXRUaW1lc3RhbXAoaW50IGksIFRpbWVz\ndGFtcCB0LCBDYWxlbmRhciBjKQogICAgICAgICAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIo\naSwgIlRpbWVzdGFtcCIsIHQpOwogICAgICAgICAgICAgICAgc3VwZXIuc2V0\nVGltZXN0YW1wKGksIHQsIGMpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZXROdWxsKGludCBpMSwgaW50IGkyLCBTdHJpbmcg\ncykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBzZXRM\nb2dQYXJhbWV0ZXIoaTEsICJudWxsIiwgbnVsbCk7CiAgICAgICAgICAgICAg\nICBzdXBlci5zZXROdWxsKGkxLCBpMiwgcyk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZEluZm8oU3RyaW5nQnVm\nZmVyIGJ1ZikgewogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIpOwog\nICAgICAgICAgICAgICAgaWYgKF9mb3JtYXR0ZXIgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoU0VQKTsKICAgICAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKF9mb3JtYXR0ZXIucHJldHR5UHJpbnQoX3Nx\nbCkpOwogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoU0VQKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZChfc3FsKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICBTdHJpbmdCdWZmZXIgcGFyYW1CdWYgPSBudWxsOwogICAgICAgICAg\nICAgICAgaWYgKF9wYXJhbXMgIT0gbnVsbCAmJiAhX3BhcmFtcy5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbUJ1ZiA9IG5ldyBTdHJp\nbmdCdWZmZXIoKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IF9wYXJhbXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1CdWYuYXBwZW5kKGl0ci5u\nZXh0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRyLmhhc05l\neHQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtQnVmLmFw\ncGVuZCgiLCAiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHBhcmFtQnVmICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIV9wcmV0dHlQcmludCkKICAg\nICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIpOwogICAgICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIltwYXJhbXM9IikuCiAgICAgICAg\nICAgICAgICAgICAgICAgIGFwcGVuZChwYXJhbUJ1Zi50b1N0cmluZygpKS5h\ncHBlbmQoIl0iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIHN1cGVyLmFwcGVuZEluZm8oYnVmKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgcHJpdmF0ZSB2b2lkIGNsZWFyTG9nUGFyYW1ldGVycyhib29sZWFu\nIGJhdGNoKSB7CiAgICAgICAgICAgICAgICBpZiAoX3BhcmFtcyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIF9wYXJhbXMuY2xlYXIoKTsKICAgICAg\nICAgICAgICAgIGlmIChiYXRjaCAmJiBfcGFyYW1CYXRjaCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIF9wYXJhbUJhdGNoLmNsZWFyKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgYm9vbGVhbiBzaG91bGRU\ncmFja1BhcmFtZXRlcnMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3Ry\nYWNrUGFyYW1ldGVycyB8fCBfbG9ncy5pc1NRTEVuYWJsZWQoKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSB2b2lkIHNldExvZ1BhcmFt\nZXRlcihpbnQgaW5kZXgsIGJvb2xlYW4gdmFsKSB7CiAgICAgICAgICAgICAg\nICBpZiAoc2hvdWxkVHJhY2tQYXJhbWV0ZXJzKCkpCiAgICAgICAgICAgICAg\nICAgICAgc2V0TG9nUGFyYW1ldGVyKGluZGV4LCAiKGJvb2xlYW4pICIgKyB2\nYWwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcml2YXRlIHZvaWQg\nc2V0TG9nUGFyYW1ldGVyKGludCBpbmRleCwgYnl0ZSB2YWwpIHsKICAgICAg\nICAgICAgICAgIGlmIChzaG91bGRUcmFja1BhcmFtZXRlcnMoKSkKICAgICAg\nICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaW5kZXgsICIoYnl0ZSkg\nIiArIHZhbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUg\ndm9pZCBzZXRMb2dQYXJhbWV0ZXIoaW50IGluZGV4LCBkb3VibGUgdmFsKSB7\nCiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVHJhY2tQYXJhbWV0ZXJzKCkp\nCiAgICAgICAgICAgICAgICAgICAgc2V0TG9nUGFyYW1ldGVyKGluZGV4LCAi\nKGRvdWJsZSkgIiArIHZhbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0ZXIoaW50IGluZGV4LCBmbG9h\ndCB2YWwpIHsKICAgICAgICAgICAgICAgIGlmIChzaG91bGRUcmFja1BhcmFt\nZXRlcnMoKSkKICAgICAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIo\naW5kZXgsICIoZmxvYXQpICIgKyB2YWwpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwcml2YXRlIHZvaWQgc2V0TG9nUGFyYW1ldGVyKGludCBpbmRl\neCwgaW50IHZhbCkgewogICAgICAgICAgICAgICAgaWYgKHNob3VsZFRyYWNr\nUGFyYW1ldGVycygpKQogICAgICAgICAgICAgICAgICAgIHNldExvZ1BhcmFt\nZXRlcihpbmRleCwgIihpbnQpICIgKyB2YWwpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwcml2YXRlIHZvaWQgc2V0TG9nUGFyYW1ldGVyKGludCBp\nbmRleCwgbG9uZyB2YWwpIHsKICAgICAgICAgICAgICAgIGlmIChzaG91bGRU\ncmFja1BhcmFtZXRlcnMoKSkKICAgICAgICAgICAgICAgICAgICBzZXRMb2dQ\nYXJhbWV0ZXIoaW5kZXgsICIobG9uZykgIiArIHZhbCk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHByaXZhdGUgdm9pZCBzZXRMb2dQYXJhbWV0ZXIo\naW50IGluZGV4LCBzaG9ydCB2YWwpIHsKICAgICAgICAgICAgICAgIGlmIChz\naG91bGRUcmFja1BhcmFtZXRlcnMoKSkKICAgICAgICAgICAgICAgICAgICBz\nZXRMb2dQYXJhbWV0ZXIoaW5kZXgsICIoc2hvcnQpICIgKyB2YWwpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwcml2YXRlIHZvaWQgc2V0TG9nUGFy\nYW1ldGVyKGludCBpbmRleCwgU3RyaW5nIHR5cGUsIE9iamVjdCB2YWwpIHsK\nICAgICAgICAgICAgICAgIGlmIChzaG91bGRUcmFja1BhcmFtZXRlcnMoKSkK\nICAgICAgICAgICAgICAgICAgICBzZXRMb2dQYXJhbWV0ZXIoaW5kZXgsICIo\nIiArIHR5cGUgKyAiKSAiICsgdmFsKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgcHJpdmF0ZSB2b2lkIHNldExvZ1BhcmFtZXRlcihpbnQgaW5kZXgs\nIFN0cmluZyB2YWwpIHsKICAgICAgICAgICAgICAgIGlmIChfcGFyYW1zID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3BhcmFtcyA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICAgICAgICAgIHdoaWxlIChfcGFyYW1zLnNpemUo\nKSA8IGluZGV4KQogICAgICAgICAgICAgICAgICAgIF9wYXJhbXMuYWRkKG51\nbGwpOwogICAgICAgICAgICAgICAgaWYgKHZhbC5sZW5ndGgoKSA+IDgwKQog\nICAgICAgICAgICAgICAgICAgIHZhbCA9IHZhbC5zdWJzdHJpbmcoMCwgNzcp\nICsgIi4uLiI7CiAgICAgICAgICAgICAgICBfcGFyYW1zLnNldChpbmRleCAt\nIDEsIHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8q\nKgogICAgICAgICAqIFdhcm5pbmctaGFuZGxpbmcgcmVzdWx0IHNldC4KICAg\nICAgICAgKi8KICAgICAgICBwcml2YXRlIGNsYXNzIExvZ2dpbmdSZXN1bHRT\nZXQgZXh0ZW5kcyBEZWxlZ2F0aW5nUmVzdWx0U2V0IHsKCiAgICAgICAgICAg\nIHB1YmxpYyBMb2dnaW5nUmVzdWx0U2V0KFJlc3VsdFNldCBycywgU3RhdGVt\nZW50IHN0bW50KSB7CiAgICAgICAgICAgICAgICBzdXBlcihycywgc3RtbnQp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBu\nZXh0KCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\nICAgIGhhbmRsZVNRTFdhcm5pbmcoTG9nZ2luZ1Jlc3VsdFNldC50aGlzKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHVibGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc3VwZXIu\nY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhMb2dnaW5nUmVzdWx0U2V0\nLnRoaXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBiZWZvcmVGaXJzdCgpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICBzdXBlci5iZWZvcmVGaXJzdCgpOwogICAgICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTUUxXYXJu\naW5nKExvZ2dpbmdSZXN1bHRTZXQudGhpcyk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGFmdGVy\nTGFzdCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBzdXBlci5hZnRlckxhc3QoKTsK\nICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAg\nICAgaGFuZGxlU1FMV2FybmluZyhMb2dnaW5nUmVzdWx0U2V0LnRoaXMpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBmaXJzdCgpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gc3VwZXIuZmlyc3QoKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU1FMV2FybmluZyhMb2dnaW5n\nUmVzdWx0U2V0LnRoaXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CgogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBsYXN0KCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBzdXBlci5sYXN0KCk7CiAgICAgICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNR\nTFdhcm5pbmcoTG9nZ2luZ1Jlc3VsdFNldC50aGlzKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGJvb2xl\nYW4gYWJzb2x1dGUoaW50IGEpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nc3VwZXIuYWJzb2x1dGUoYSk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5pbmcoTG9nZ2lu\nZ1Jlc3VsdFNldC50aGlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gcmVsYXRpdmUoaW50\nIGEpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIucmVsYXRpdmUo\nYSk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgICAgIGhhbmRsZVNRTFdhcm5pbmcoTG9nZ2luZ1Jlc3VsdFNldC50aGlz\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcHVibGljIGJvb2xlYW4gcHJldmlvdXMoKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHN1cGVyLnByZXZpb3VzKCk7CiAgICAgICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZVNRTFdhcm5p\nbmcoTG9nZ2luZ1Jlc3VsdFNldC50aGlzKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

