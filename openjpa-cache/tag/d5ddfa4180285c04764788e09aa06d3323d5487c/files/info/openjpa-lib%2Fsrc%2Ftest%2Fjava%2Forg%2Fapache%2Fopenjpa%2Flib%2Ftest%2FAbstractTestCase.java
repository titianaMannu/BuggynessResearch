{"sha":"0495c18519e646680e3da1c89f47cfebb33eadc0","node_id":"MDQ6QmxvYjIwNjM2NDowNDk1YzE4NTE5ZTY0NjY4MGUzZGExYzg5ZjQ3Y2ZlYmIzM2VhZGMw","size":37808,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0495c18519e646680e3da1c89f47cfebb33eadc0","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnRlc3Q7DQoNCmltcG9ydCBqYXZhLmJlYW5zLkJlYW5JbmZvOw0KaW1w\nb3J0IGphdmEuYmVhbnMuSW50cm9zcGVjdGlvbkV4Y2VwdGlvbjsNCmltcG9y\ndCBqYXZhLmJlYW5zLkludHJvc3BlY3RvcjsNCmltcG9ydCBqYXZhLmJlYW5z\nLlByb3BlcnR5RGVzY3JpcHRvcjsNCmltcG9ydCBqYXZhLmlvLkJ5dGVBcnJh\neUlucHV0U3RyZWFtOw0KaW1wb3J0IGphdmEuaW8uQnl0ZUFycmF5T3V0cHV0\nU3RyZWFtOw0KaW1wb3J0IGphdmEuaW8uRmlsZTsNCmltcG9ydCBqYXZhLmlv\nLkZpbGVJbnB1dFN0cmVhbTsNCmltcG9ydCBqYXZhLmlvLkZpbGVOb3RGb3Vu\nZEV4Y2VwdGlvbjsNCmltcG9ydCBqYXZhLmlvLkZpbGVPdXRwdXRTdHJlYW07\nDQppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsNCmltcG9ydCBqYXZhLmlv\nLklucHV0U3RyZWFtOw0KaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXRTdHJl\nYW07DQppbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXRTdHJlYW07DQppbXBv\ncnQgamF2YS5pby5QcmludFN0cmVhbTsNCmltcG9ydCBqYXZhLmlvLlByaW50\nV3JpdGVyOw0KaW1wb3J0IGphdmEuaW8uU3RyaW5nV3JpdGVyOw0KaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lkludm9jYXRpb25UYXJnZXRFeGNlcHRpb247\nDQppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOw0KaW1wb3J0IGph\ndmEubWF0aC5CaWdEZWNpbWFsOw0KaW1wb3J0IGphdmEubWF0aC5CaWdJbnRl\nZ2VyOw0KaW1wb3J0IGphdmEubmV0LlVSTDsNCmltcG9ydCBqYXZhLnRleHQu\nTnVtYmVyRm9ybWF0Ow0KaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7DQpp\nbXBvcnQgamF2YS51dGlsLkFycmF5czsNCmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbjsNCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7DQppbXBv\ncnQgamF2YS51dGlsLkNvbXBhcmF0b3I7DQppbXBvcnQgamF2YS51dGlsLkRh\ndGU7DQppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7DQppbXBvcnQgamF2YS51\ndGlsLkl0ZXJhdG9yOw0KaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0Ow0K\naW1wb3J0IGphdmEudXRpbC5MaXN0Ow0KaW1wb3J0IGphdmEudXRpbC5MaXN0\nSXRlcmF0b3I7DQppbXBvcnQgamF2YS51dGlsLk1hcDsNCmltcG9ydCBqYXZh\nLnV0aWwuTm9TdWNoRWxlbWVudEV4Y2VwdGlvbjsNCmltcG9ydCBqYXZhLnV0\naWwuU3RyaW5nVG9rZW5pemVyOw0KDQppbXBvcnQganVuaXQuZnJhbWV3b3Jr\nLlRlc3RDYXNlOw0KaW1wb3J0IGp1bml0LmZyYW1ld29yay5UZXN0UmVzdWx0\nOw0KaW1wb3J0IGp1bml0LnRleHR1aS5UZXN0UnVubmVyOw0KaW1wb3J0IG9y\nZy5hcGFjaGUucmVnZXhwLlJFOw0KaW1wb3J0IG9yZy5hcGFjaGUucmVnZXhw\nLlJFU3ludGF4RXhjZXB0aW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUucmVnZXhw\nLlJFVXRpbDsNCmltcG9ydCBvcmcuYXBhY2hlLnRvb2xzLmFudC5BbnRDbGFz\nc0xvYWRlcjsNCmltcG9ydCBvcmcuYXBhY2hlLnRvb2xzLmFudC5Qcm9qZWN0\nOw0KaW1wb3J0IG9yZy5hcGFjaGUudG9vbHMuYW50LlByb2plY3RIZWxwZXI7\nDQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOw0KaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZ0ZhY3RvcnlJbXBs\nOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7DQoNCi8qKg0KICogVGVzdENhc2UgZnJhbWV3b3JrIHRvIHJ1biB2YXJp\nb3VzIHRlc3RzIGFnYWluc3Qgc29sYXJtZXRyaWMgY29kZS4NCiAqIFRoaXMg\nY2xhc3MgY29udGFpbnMgdmFyaW91cyB1dGlsaXR5IG1ldGhvZHMgZm9yIHRo\nZSBmb2xsb3dpbmcgZnVuY3Rpb25zOg0KICogPHVsPg0KICogPGxpPlVzaW5n\nIG11bHRpcGxlLCBpc29sYXRlZCBDbGFzc0xvYWRlcnM8L2xpPg0KICogPGxp\nPlJ1bm5pbmcgYSB0ZXN0IGluIG11bHRpcGxlIGNvbmN1cnJlbnQgdGhyZWFk\nczwvbGk+DQogKiA8bGk+QXNzZXJ0aW9uIGhlbHBlcnM8L2xpPg0KICogPGxp\nPkNyZWF0aW5nIHJhbmRvbSBTdHJpbmdzLCBudW1iZXJzLCBldGMuPC9saT4N\nCiAqIDwvdWw+DQogKg0KICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgN\nCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5DQogKi8NCnB1YmxpYyBhYnN0\ncmFjdCBjbGFzcyBBYnN0cmFjdFRlc3RDYXNlIGV4dGVuZHMgVGVzdENhc2Ug\new0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgVEVTVF9NRVRI\nT0RTID0NCiAgICAgICAgU3lzdGVtLmdldFByb3BlcnR5KEFic3RyYWN0VGVz\ndENhc2UuY2xhc3MuZ2V0TmFtZSgpICsgIi50ZXN0TWV0aG9kcyIpOw0KICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgbG9uZyBQTEFURk9STV9BTEwgPSAyIDw8\nIDE7DQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBsb25nIFBMQVRGT1JNX1VO\nS05PV04gPSAyIDw8IDI7DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBTS0lQX1RPS0VOID0gIlNPTEFSU0tJUCI7DQogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBTdHJpbmcgU0tJUF9ERUxJTUlURVIgPSAifCI7DQoNCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9DQogICAg\nICAgIExvY2FsaXplci5mb3JQYWNrYWdlKEFic3RyYWN0VGVzdENhc2UuY2xh\nc3MpOw0KDQogICAgcHJpdmF0ZSBMb2cgbG9nID0gbnVsbDsNCg0KICAgIHBy\naXZhdGUgc3RhdGljIE1hcCBfdGltZXMgPSBuZXcgSGFzaE1hcCgpOw0KDQog\nICAgcHJpdmF0ZSBzdGF0aWMgQWJzdHJhY3RUZXN0Q2FzZSBfbGFzdFRlc3Qg\nPSBudWxsOw0KDQogICAgcHJpdmF0ZSBzdGF0aWMgV2F0Y2hkb2dUaHJlYWQg\nX3dhdGNoZG9nID0gbmV3IFdhdGNoZG9nVGhyZWFkKCk7DQogICAgcHJpdmF0\nZSBsb25nIF90aW1lb3V0Ow0KDQogICAgLyoqDQogICAgICogQ29uc3RydWN0\nb3IuIENyZWF0ZSBhIHRlc3QgY2FzZSB3aXRoIHRoZSBzcGVjaWZpZWQgbmFt\nZS4NCiAgICAgKi8NCiAgICBwdWJsaWMgQWJzdHJhY3RUZXN0Q2FzZShTdHJp\nbmcgdGVzdCkgew0KICAgICAgICBzdXBlcih0ZXN0KTsNCiAgICB9DQoNCiAg\nICBwdWJsaWMgQWJzdHJhY3RUZXN0Q2FzZSgpIHsNCiAgICB9DQoNCiAgICBw\ncm90ZWN0ZWQgZmluYWwgTG9nIGdldExvZygpIHsNCiAgICAgICAgaWYgKGxv\nZyA9PSBudWxsKQ0KICAgICAgICAgICAgbG9nID0gbmV3TG9nKCk7DQogICAg\nICAgIHJldHVybiBsb2c7DQogICAgfQ0KDQogICAgcHJvdGVjdGVkIExvZyBu\nZXdMb2coKSB7DQogICAgICAgIC8vIHRoaXMgaW1wbGVtZW50YXRpb24gbGVh\ndmVzIG11Y2ggdG8gYmUgZGVzaXJlZCwgYXMgaXQganVzdA0KICAgICAgICAv\nLyBjcmVhdGVzIGEgbmV3IExvZ0ZhY3RvcnlJbXBsIGVhY2ggdGltZSwgYW5k\nIGRvZXMgbm90IGFwcGx5DQogICAgICAgIC8vIGFueSBjb25maWd1cmF0aW9u\ncy4NCiAgICAgICAgcmV0dXJuIG5ldyBMb2dGYWN0b3J5SW1wbCgpLmdldExv\nZyhnZXRMb2dOYW1lKCkpOw0KICAgIH0NCg0KICAgIHByb3RlY3RlZCBTdHJp\nbmcgZ2V0TG9nTmFtZSgpIHsNCiAgICAgICAgcmV0dXJuICJjb20uc29sYXJt\nZXRyaWMuUnVudGltZSI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2Fs\nbGVkIGJlZm9yZSB0aGUgd2F0Y2hkb2cgdGhyZWFkIGlzIGFib3V0IHRvIGtp\nbGwgdGhlIGVudGlyZQ0KICAgICAqIEpWTSBkdWUgdG8gYSB0ZXN0IGNhc2Un\ncyB0aW1lb3V0LiBUaGlzIG1ldGhvZCBvZmZlcnMgdGhlDQogICAgICogYWJp\nbGl0eSB0byB0cnkgdG8gcmVzb2x2ZSB3aGF0ZXZlciBjb250ZW50aW9uIGlz\nIHRha2luZyBwbGFjZQ0KICAgICAqIGluIHRoZSB0ZXN0LiBJdCB3aWxsIGJl\nIGdpdmVuIDEwIHNlY29uZHMgdG8gdHJ5IHRvIGVuZCB0aGUNCiAgICAgKiB0\nZXN0IHBlYWNlZnVsbHkgYmVmb3JlIHRoZSB3YXRjaGRvZyBleGl0cyB0aGUg\nSlZNLg0KICAgICAqLw0KICAgIHByb3RlY3RlZCB2b2lkIHByZVRpbWVvdXQo\nKSB7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgcnVuKFRlc3RSZXN1bHQg\ncmVzdWx0KSB7DQogICAgICAgIGlmIChza2lwVGVzdCgpKSB7DQogICAgICAg\nICAgICAvLyBrZWVwIHRyYWNrIG9mIHRoZSB0ZXN0cyB3ZSBza2lwIHNvIHRo\nYXQgd2UgY2FuIGdldCBhbg0KICAgICAgICAgICAgLy8gaWRlYSBpbiB0aGUg\nYXV0b2J1aWxkIHN0YXR1cw0KICAgICAgICAgICAgU3lzdGVtLmVyci5wcmlu\ndGxuKFNLSVBfVE9LRU4gKyBTS0lQX0RFTElNSVRFUg0KICAgICAgICAgICAg\nICAgICsgKCIiICsgZ2V0Q2xhc3MoKS5nZXROYW1lKCkpDQogICAgICAgICAg\nICAgICAgKyAiLiIgKyBnZXROYW1lKCkgKyBTS0lQX0RFTElNSVRFUik7DQog\nICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBpZiAo\nX2xhc3RUZXN0ICE9IG51bGwgJiYgX2xhc3RUZXN0LmdldENsYXNzKCkgIT0g\nZ2V0Q2xhc3MoKSkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAg\nICAgICBfbGFzdFRlc3QudGVhckRvd25UZXN0Q2xhc3MoKTsNCiAgICAgICAg\nICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7DQogICAgICAgICAgICAgICAg\nZ2V0TG9nKCkuZXJyb3IobnVsbCwgdCk7DQogICAgICAgICAgICB9DQogICAg\nICAgIH0NCg0KICAgICAgICBpZiAoX2xhc3RUZXN0ID09IG51bGwgfHwgX2xh\nc3RUZXN0LmdldENsYXNzKCkgIT0gZ2V0Q2xhc3MoKSkgew0KICAgICAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBzZXRVcFRlc3RDbGFzcygpOw0K\nICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsNCiAgICAgICAg\nICAgICAgICBnZXRMb2coKS5lcnJvcihudWxsLCB0KTsNCiAgICAgICAgICAg\nIH0NCiAgICAgICAgfQ0KDQogICAgICAgIF9sYXN0VGVzdCA9IHRoaXM7DQoN\nCiAgICAgICAgLy8gaW5mb3JtIHRoZSB3YXRjaGRvZyB0aHJlYWQgdGhhdCB3\nZSBhcmUgZW50ZXJpbmcgdGhlIHRlc3QNCiAgICAgICAgX3dhdGNoZG9nLmVu\ndGVyaW5nVGVzdCh0aGlzKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAg\nIHN1cGVyLnJ1bihyZXN1bHQpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAg\nICAgICAgICAgX3dhdGNoZG9nLmxlYXZpbmdUZXN0KHRoaXMpOw0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSWYgdGhpcyB0ZXN0IHNo\nb3VsZCBiZSBza2lwcGVkIGdpdmVuIHRoZSBjdXJyZW50DQogICAgICogZW52\naXJvbm1lbnQsIHJldHVybiA8Y29kZT50cnVlPC9jb2RlPi4gVGhpcyBhbGxv\nd3MgYSB1bml0IHRlc3QNCiAgICAgKiBjbGFzcyB0byBkaXNhYmxlIHRlc3Qg\nY2FzZXMgb24gYSBwZXItbWV0aG9kIGdyYW51bGFyaXR5LCBhbmQNCiAgICAg\nKiBwcmV2ZW50cyB0aGUgdGVzdCBmcm9tIHNob3dpbmcgdXAgYXMgYSBwYXNz\nZWQgdGVzdCBqdXN0DQogICAgICogYmVjYXVzZSBpdCB3YXMgc2tpcHBlZC4N\nCiAgICAgKiBGb3IgZXhhbXBsZSwgaWYgYSBwYXJ0aWN1bGFyIHRlc3QgY2Fz\nZSBtZXRob2Qgc2hvdWxkIG5vdCBiZQ0KICAgICAqIHJ1biBhZ2FpbnN0IGEg\nY2VydGFpbiBkYXRhYmFzZSwgdGhpcyBtZXRob2QgY291bGQgY2hlY2sgdGhl\nDQogICAgICogbmFtZSBvZiB0aGUgdGVzdCByZXN1bHQgYW5kIHRoZSBjdXJy\nZW50IGRhdGFiYXNlIGNvbmZpZ3VyYXRpb24NCiAgICAgKiBpbiBvcmRlciB0\nbyBtYWtlIHRoZSBkZWNpc2lvbjoNCiAgICAgKiA8cC8+DQogICAgICogPGNv\nZGU+IHByb3RlY3RlZCBib29sZWFuIHNraXBUZXN0KCkgew0KICAgICAqIC8v\nIGRvbid0IHJ1biB3aXRoIHBvaW50YmFzZTogaXQgdXNlcyBhIERhdGFTb3Vy\nY2UsIHdoaWNoDQogICAgICogLy8gY2FuJ3QgYmUgdHJhbnNsYXRlZCBpbnRv\nIGEgSkJvc3MgRGF0YVNvdXJjZSBjb25maWd1cmF0aW9uLg0KICAgICAqIGlm\nICgidGVzdEpCb3NzIi5lcXVhbHMoZ2V0TmFtZSgpKSAmJg0KICAgICAqIGdl\ndEN1cnJlbnRQbGF0Zm9ybSgpID09IFBMQVRGT1JNX1BPSU5UQkFTRSkNCiAg\nICAgKiByZXR1cm4gdHJ1ZTsNCiAgICAgKiB9DQogICAgICogPC9jb2RlPg0K\nICAgICAqIElmIHlvdSB3YW50IHRvIGRpc2FibGUgZXhlY3V0aW9uIG9mIGFu\nIGVudGlyZSB0ZXN0IGNhc2UNCiAgICAgKiBjbGFzcyBmb3IgYSBnaXZlbiBk\nYXRhYmFzZSwgeW91IG1pZ2h0IHdhbnQgdG8gYWRkIHRoZSBjbGFzcyB0bw0K\nICAgICAqIHRoZSBleGNsdWRlZCB0ZXN0IGxpc3QgaW4gdGhhdCBkYXRhYmFz\nZSdzIHByb3BlcnRpZXMgZmlsZS4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiBza2lwVGVzdCgpIHsNCiAgICAgICAgaWYgKFRFU1RfTUVUSE9E\nUyAhPSBudWxsICYmIFRFU1RfTUVUSE9EUy5sZW5ndGgoKSA+IDApDQogICAg\nICAgICAgICByZXR1cm4gVEVTVF9NRVRIT0RTLmluZGV4T2YoZ2V0TmFtZSgp\nKSA9PSAtMTsNCg0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIGJlZm9yZSB0\naGUgZmlyc3QgdGVzdCBpbiB0aGlzIHRlc3QgY2xhc3MNCiAgICAgKiBpcyBl\neGVjdXRlZC4NCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZXRVcFRlc3RD\nbGFzcygpIHRocm93cyBFeGNlcHRpb24gew0KICAgIH0NCg0KICAgIC8qKg0K\nICAgICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBhZnRlciB0aGUgbGFzdCB0\nZXN0IGluIHRoaXMgdGVzdCBjbGFzcw0KICAgICAqIGlzIGV4ZWN1dGVkLiBJ\ndCBjYW4gYmUgdXNlZCB0byBkbyB0aGluZ3MgbGlrZSBjbGVhbiB1cA0KICAg\nICAqIGxhcmdlLCBzbG93IHByb2Nlc3NlcyB0aGF0IG1heSBoYXZlIGJlZW4g\nc3RhcnRlZC4NCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCB0ZWFyRG93blRl\nc3RDbGFzcygpIHRocm93cyBFeGNlcHRpb24gew0KICAgIH0NCg0KICAgIHB1\nYmxpYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlvbiB7DQogICAg\nICAgIGlmICgidHJ1ZSIuZXF1YWxzKFN5c3RlbS5nZXRQcm9wZXJ0eSgibWVt\naW5mbyIpKSkNCiAgICAgICAgICAgIHByaW50TWVtb3J5SW5mbygpOw0KDQog\nICAgICAgIHN1cGVyLnRlYXJEb3duKCk7DQogICAgfQ0KDQogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBHZW5lcmF0aW5nIHJhbmRv\nbSBkYXRhDQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KICAg\nIC8qKg0KICAgICAqIFN1cHBvcnQgbWV0aG9kIHRvIGdldCBhIHJhbmRvbSBJ\nbnRlZ2VyIGZvciB0ZXN0aW5nLg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0\naWMgSW50ZWdlciByYW5kb21JbnQoKSB7DQogICAgICAgIHJldHVybiBuZXcg\nSW50ZWdlcigoaW50KSAoTWF0aC5yYW5kb20oKSAqIEludGVnZXIuTUFYX1ZB\nTFVFKSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU3VwcG9ydCBtZXRo\nb2QgdG8gZ2V0IGEgcmFuZG9tIENoYXJhY3RlciBmb3IgdGVzdGluZy4NCiAg\nICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIENoYXJhY3RlciByYW5kb21DaGFy\nKCkgew0KICAgICAgICBjaGFyIFtdIFRFU1RfQ0hBUl9BUlJBWSA9IG5ldyBj\naGFyIFtdew0KICAgICAgICAgICAgJ2EnLCAnYicsICdjJywgJ2QnLCAnZScs\nICdmJywgJ2cnLCAnaCcsICdpJywNCiAgICAgICAgICAgICdqJywgJ2snLCAn\nbCcsICdtJywgJ24nLCAnbycsICdwJywgJ3EnLCAncicsDQogICAgICAgICAg\nICAncycsICd0JywgJ3UnLCAndicsICd3JywgJ3gnLCAneScsICd6JywgJzEn\nLA0KICAgICAgICAgICAgJzInLCAnMycsICc0JywgJzUnLCAnNicsICc3Jywg\nJzgnLCAnOScgfTsNCg0KICAgICAgICByZXR1cm4gbmV3IENoYXJhY3RlcihU\nRVNUX0NIQVJfQVJSQVlbDQogICAgICAgICAgICAoaW50KSAoTWF0aC5yYW5k\nb20oKSAqIFRFU1RfQ0hBUl9BUlJBWS5sZW5ndGgpXSk7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogU3VwcG9ydCBtZXRob2QgdG8gZ2V0IGEgcmFuZG9t\nIExvbmcgZm9yIHRlc3RpbmcuDQogICAgICovDQogICAgcHVibGljIHN0YXRp\nYyBMb25nIHJhbmRvbUxvbmcoKSB7DQogICAgICAgIHJldHVybiBuZXcgTG9u\nZygobG9uZykgKE1hdGgucmFuZG9tKCkgKiBMb25nLk1BWF9WQUxVRSkpOw0K\nICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFN1cHBvcnQgbWV0aG9kIHRvIGdl\ndCBhIHJhbmRvbSBTaG9ydCBmb3IgdGVzdGluZy4NCiAgICAgKi8NCiAgICBw\ndWJsaWMgc3RhdGljIFNob3J0IHJhbmRvbVNob3J0KCkgew0KICAgICAgICBy\nZXR1cm4gbmV3IFNob3J0KChzaG9ydCkgKE1hdGgucmFuZG9tKCkgKiBTaG9y\ndC5NQVhfVkFMVUUpKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTdXBw\nb3J0IG1ldGhvZCB0byBnZXQgYSByYW5kb20gRG91YmxlIGZvciB0ZXN0aW5n\nLg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgRG91YmxlIHJhbmRvbURv\ndWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEb3VibGUoKGRvdWJsZSkg\nKE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDUwMDBkKSkgLyAxMDAwZCk7\nDQogICAgfQ0KDQogICAgLyoqDQogICAgICogU3VwcG9ydCBtZXRob2QgdG8g\nZ2V0IGEgcmFuZG9tIEZsb2F0IGZvciB0ZXN0aW5nLg0KICAgICAqLw0KICAg\nIHB1YmxpYyBzdGF0aWMgRmxvYXQgcmFuZG9tRmxvYXQoKSB7DQogICAgICAg\nIHJldHVybiBuZXcgRmxvYXQoKGZsb2F0KSAoTWF0aC5yb3VuZChNYXRoLnJh\nbmRvbSgpICogNTAwMGYpKSAvIDEwMDBmKTsNCiAgICB9DQoNCiAgICAvKioN\nCiAgICAgKiBTdXBwb3J0IG1ldGhvZCB0byBnZXQgYSByYW5kb20gQnl0ZSBm\nb3IgdGVzdGluZy4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIEJ5dGUg\ncmFuZG9tQnl0ZSgpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBCeXRlKChieXRl\nKSAoTWF0aC5yYW5kb20oKSAqIEJ5dGUuTUFYX1ZBTFVFKSk7DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogU3VwcG9ydCBtZXRob2QgdG8gZ2V0IGEgcmFu\nZG9tIEJvb2xlYW4gZm9yIHRlc3RpbmcuDQogICAgICovDQogICAgcHVibGlj\nIHN0YXRpYyBCb29sZWFuIHJhbmRvbUJvb2xlYW4oKSB7DQogICAgICAgIHJl\ndHVybiBuZXcgQm9vbGVhbihNYXRoLnJhbmRvbSgpID4gMC41ID8gdHJ1ZSA6\nIGZhbHNlKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTdXBwb3J0IG1l\ndGhvZCB0byBnZXQgYSByYW5kb20gRGF0ZSBmb3IgdGVzdGluZy4NCiAgICAg\nKi8NCiAgICBwdWJsaWMgc3RhdGljIERhdGUgcmFuZG9tRGF0ZSgpIHsNCiAg\nICAgICAgbG9uZyBtaWxsaXMgPSAobG9uZykgKE1hdGgucmFuZG9tKCkgKiBT\neXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7DQoNCiAgICAgICAgLy8gcm91\nbmQgbWlsbGlzIHRvIHRoZSBuZWFyZXN0IDEwMDA6IHRoaXMgaXMgYmVjYXVz\nZSBzb21lDQogICAgICAgIC8vIGRhdGFiYXNlcyBkbyBub3Qgc3RvcmUgdGhl\nIG1pbGxpc2Vjb25kcyBjb3JyZWN0bHkoZS5nLiwgTXlTUUwpLg0KICAgICAg\nICAvLyBUaGlzIGlzIGEgcmVhbGx5IGEgYnVnIHdlIHNob3VsZCBmaXguIEZD\nICMyNy4NCiAgICAgICAgbWlsbGlzIC09IChtaWxsaXMgJSAxMDAwKTsNCg0K\nICAgICAgICByZXR1cm4gbmV3IERhdGUobWlsbGlzKTsNCiAgICB9DQoNCiAg\nICAvKioNCiAgICAgKiBTdXBwb3J0IG1ldGhvZCB0byBnZXQgYSByYW5kb20g\nU3RyaW5nIGZvciB0ZXN0aW5nLg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0\naWMgU3RyaW5nIHJhbmRvbVN0cmluZygpIHsNCiAgICAgICAgLy8gZGVmYXVs\ndCB0byBhIHNtYWxsIHN0cmluZywgaW4gY2FzZSBjb2x1bW4gc2l6ZXMgYXJl\nDQogICAgICAgIC8vIGxpbWl0ZWQoc3VjaCBhcyB3aXRoIGEgc3RyaW5nIHBy\naW1hcnkga2V5KQ0KICAgICAgICByZXR1cm4gcmFuZG9tU3RyaW5nKDUwKTsN\nCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTdXBwb3J0IG1ldGhvZCB0byBn\nZXQgYSByYW5kb20gU3RyaW5nIGZvciB0ZXN0aW5nLg0KICAgICAqLw0KICAg\nIHB1YmxpYyBzdGF0aWMgU3RyaW5nIHJhbmRvbVN0cmluZyhpbnQgbGVuKSB7\nDQogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVy\nKCk7DQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgKGludCkgKE1hdGgu\ncmFuZG9tKCkgKiBsZW4pICsgMTsgaSsrKQ0KICAgICAgICAgICAgYnVmLmFw\ncGVuZChyYW5kb21DaGFyKCkpOw0KICAgICAgICByZXR1cm4gYnVmLnRvU3Ry\naW5nKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU3VwcG9ydCBtZXRo\nb2QgdG8gZ2V0IGEgcmFuZG9tIGNsb2IgZm9yIHRlc3RpbmcuDQogICAgICov\nDQogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgcmFuZG9tQ2xvYigpIHsNCiAg\nICAgICAgU3RyaW5nQnVmZmVyIHNidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7\nDQogICAgICAgIHdoaWxlIChzYnVmLmxlbmd0aCgpIDwgKDUgKiAxMDI0KSkg\neyAvLyBhdCBsZWFzdCA1Sw0KICAgICAgICAgICAgc2J1Zi5hcHBlbmQocmFu\nZG9tU3RyaW5nKDEwMjQpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVy\nbiBzYnVmLnRvU3RyaW5nKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICog\nU3VwcG9ydCBtZXRob2QgdG8gZ2V0IGEgcmFuZG9tIEJpZ0ludGVnZXIgZm9y\nIHRlc3RpbmcuDQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBCaWdJbnRl\nZ2VyIHJhbmRvbUJpZ0ludGVnZXIoKSB7DQogICAgICAgIC8vIHRvbyBtYW55\nIG9mIG91ciB0ZXN0IGRhdGFiYXNlcyBkb24ndCBzdXBwb3J0IGJpZ2ludHMg\nPiBNQVhfTE9ORzoNCiAgICAgICAgLy8gSSBkb24ndCBsaWtlIGl0LCBidXQg\nZm9yIG5vdywgbGV0J3Mgb25seSB0ZXN0IGJlbG93IE1BWF9MT05HDQogICAg\nICAgIEJpZ0ludGVnZXIgbG5nID0gbmV3IEJpZ0ludGVnZXIoDQogICAgICAg\nICAgICAoKGxvbmcpIChNYXRoLnJhbmRvbSgpICogTG9uZy5NQVhfVkFMVUUp\nKSArICIiKTsNCg0KICAgICAgICBCaWdJbnRlZ2VyIG11bHRpcGxpZXIgPSBu\nZXcgQmlnSW50ZWdlcigiMSIpOw0KICAgICAgICAvLyAoMSArIChpbnQpKE1h\ndGgucmFuZG9tKCkgKiAxMDAwMCkpICsgIiIpOw0KICAgICAgICBpZiAoTWF0\naC5yYW5kb20oKSA8IDAuNSkNCiAgICAgICAgICAgIG11bHRpcGxpZXIgPSBt\ndWx0aXBsaWVyLm11bHRpcGx5KG5ldyBCaWdJbnRlZ2VyKCItMSIpKTsNCg0K\nICAgICAgICByZXR1cm4gbG5nLm11bHRpcGx5KG11bHRpcGxpZXIpOw0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIFN1cHBvcnQgbWV0aG9kIHRvIGdldCBh\nIHJhbmRvbSBCaWdEZWNpbWFsIGZvciB0ZXN0aW5nLg0KICAgICAqLw0KICAg\nIHB1YmxpYyBzdGF0aWMgQmlnRGVjaW1hbCByYW5kb21CaWdEZWNpbWFsKCkg\new0KICAgICAgICBCaWdJbnRlZ2VyIHN0YXJ0ID0gcmFuZG9tQmlnSW50ZWdl\ncigpOw0KICAgICAgICBTdHJpbmcgc3RyID0gc3RhcnQudG9TdHJpbmcoKTsN\nCiAgICAgICAgLy8gdHJ1bmNhdGUgb2ZmIHRoZSBsYXN0IDggZGlnaXRzOiB3\nZSBzdGlsbCBnZXQgc29tZQ0KICAgICAgICAvLyBvdmVyZmxvd3Mgd2l0aCBs\nYW1lIGRhdGFiYXNlcy4NCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCA4\nOyBpKyspDQogICAgICAgICAgICBpZiAoc3RyLmxlbmd0aCgpID4gMikNCiAg\nICAgICAgICAgICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKDAsIHN0ci5sZW5n\ndGgoKSAtIDEpOw0KICAgICAgICBzdGFydCA9IG5ldyBCaWdJbnRlZ2VyKHN0\ncik7DQoNCiAgICAgICAgU3RyaW5nIHZhbCA9IHN0YXJ0ICsgIi4iICsgKChp\nbnQpIChNYXRoLnJhbmRvbSgpICogMTApKQ0KICAgICAgICAgICAgKyAoKGlu\ndCkgKE1hdGgucmFuZG9tKCkgKiAxMCkpDQogICAgICAgICAgICArICgoaW50\nKSAoTWF0aC5yYW5kb20oKSAqIDEwKSkNCiAgICAgICAgICAgICsgKChpbnQp\nIChNYXRoLnJhbmRvbSgpICogMTApKQ0KICAgICAgICAgICAgKyAoKGludCkg\nKE1hdGgucmFuZG9tKCkgKiAxMCkpDQogICAgICAgICAgICArICgoaW50KSAo\nTWF0aC5yYW5kb20oKSAqIDEwKSkNCiAgICAgICAgICAgICsgKChpbnQpIChN\nYXRoLnJhbmRvbSgpICogMTApKQ0KICAgICAgICAgICAgKyAoKGludCkgKE1h\ndGgucmFuZG9tKCkgKiAxMCkpDQogICAgICAgICAgICArICgoaW50KSAoTWF0\naC5yYW5kb20oKSAqIDEwKSkNCiAgICAgICAgICAgICsgKChpbnQpIChNYXRo\nLnJhbmRvbSgpICogMTApKTsNCg0KICAgICAgICByZXR1cm4gbmV3IEJpZ0Rl\nY2ltYWwodmFsKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTdXBwb3J0\nIG1ldGhvZCB0byBnZXQgYSByYW5kb20gYmxvYiBmb3IgdGVzdGluZy4NCiAg\nICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGJ5dGVbXSByYW5kb21CbG9iKCkg\new0KICAgICAgICAvLyB1cCB0byAxMDBLIGJsb2INCiAgICAgICAgYnl0ZSBb\nXSBibG9iID0gbmV3IGJ5dGUgWyhpbnQpIChNYXRoLnJhbmRvbSgpICogMTAy\nNCAqIDEwMCldOw0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJsb2Iu\nbGVuZ3RoOyBpKyspDQogICAgICAgICAgICBibG9iW2ldID0gcmFuZG9tQnl0\nZSgpLmJ5dGVWYWx1ZSgpOw0KDQogICAgICAgIHJldHVybiBibG9iOw0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIEludm9rZSBzZXR0ZXJzIGZvciBwaW1p\ndGl2ZXMgYW5kIHByaW1pdGl2ZSB3cmFwcGVycyBvbiB0aGUNCiAgICAgKiBz\ncGVjaWZpZWQgb2JqZWN0Lg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMg\nT2JqZWN0IHJhbmRvbWl6ZUJlYW4oT2JqZWN0IGJlYW4pDQogICAgICAgIHRo\ncm93cyBJbnRyb3NwZWN0aW9uRXhjZXB0aW9uLCBJbGxlZ2FsQWNjZXNzRXhj\nZXB0aW9uLA0KICAgICAgICBJbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uIHsN\nCiAgICAgICAgQmVhbkluZm8gaW5mbyA9IEludHJvc3BlY3Rvci5nZXRCZWFu\nSW5mbyhiZWFuLmdldENsYXNzKCkpOw0KICAgICAgICBQcm9wZXJ0eURlc2Ny\naXB0b3IgW10gcHJvcHMgPSBpbmZvLmdldFByb3BlcnR5RGVzY3JpcHRvcnMo\nKTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7\nIGkrKykgew0KICAgICAgICAgICAgTWV0aG9kIHdyaXRlID0gcHJvcHNbaV0u\nZ2V0V3JpdGVNZXRob2QoKTsNCiAgICAgICAgICAgIGlmICh3cml0ZSA9PSBu\ndWxsKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KDQogICAgICAgICAg\nICBDbGFzcyBbXSBwYXJhbXMgPSB3cml0ZS5nZXRQYXJhbWV0ZXJUeXBlcygp\nOw0KICAgICAgICAgICAgaWYgKHBhcmFtcyA9PSBudWxsIHx8IHBhcmFtcy5s\nZW5ndGggIT0gMSkNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCg0KICAg\nICAgICAgICAgQ2xhc3MgcGFyYW1UeXBlID0gcGFyYW1zWzBdOw0KICAgICAg\nICAgICAgT2JqZWN0IGFyZyA9IG51bGw7DQoNCiAgICAgICAgICAgIGlmIChw\nYXJhbVR5cGUgPT0gYm9vbGVhbi5jbGFzcyB8fCBwYXJhbVR5cGUgPT0gQm9v\nbGVhbi5jbGFzcykNCiAgICAgICAgICAgICAgICBhcmcgPSByYW5kb21Cb29s\nZWFuKCk7DQogICAgICAgICAgICBlbHNlIGlmIChwYXJhbVR5cGUgPT0gYnl0\nZS5jbGFzcyB8fCBwYXJhbVR5cGUgPT0gQnl0ZS5jbGFzcykNCiAgICAgICAg\nICAgICAgICBhcmcgPSByYW5kb21CeXRlKCk7DQogICAgICAgICAgICBlbHNl\nIGlmIChwYXJhbVR5cGUgPT0gY2hhci5jbGFzcyB8fCBwYXJhbVR5cGUgPT0g\nQ2hhcmFjdGVyLmNsYXNzKQ0KICAgICAgICAgICAgICAgIGFyZyA9IHJhbmRv\nbUNoYXIoKTsNCiAgICAgICAgICAgIGVsc2UgaWYgKHBhcmFtVHlwZSA9PSBz\naG9ydC5jbGFzcyB8fCBwYXJhbVR5cGUgPT0gU2hvcnQuY2xhc3MpDQogICAg\nICAgICAgICAgICAgYXJnID0gcmFuZG9tU2hvcnQoKTsNCiAgICAgICAgICAg\nIGVsc2UgaWYgKHBhcmFtVHlwZSA9PSBpbnQuY2xhc3MgfHwgcGFyYW1UeXBl\nID09IEludGVnZXIuY2xhc3MpDQogICAgICAgICAgICAgICAgYXJnID0gcmFu\nZG9tSW50KCk7DQogICAgICAgICAgICBlbHNlIGlmIChwYXJhbVR5cGUgPT0g\nbG9uZy5jbGFzcyB8fCBwYXJhbVR5cGUgPT0gTG9uZy5jbGFzcykNCiAgICAg\nICAgICAgICAgICBhcmcgPSByYW5kb21Mb25nKCk7DQogICAgICAgICAgICBl\nbHNlIGlmIChwYXJhbVR5cGUgPT0gZG91YmxlLmNsYXNzIHx8IHBhcmFtVHlw\nZSA9PSBEb3VibGUuY2xhc3MpDQogICAgICAgICAgICAgICAgYXJnID0gcmFu\nZG9tRG91YmxlKCk7DQogICAgICAgICAgICBlbHNlIGlmIChwYXJhbVR5cGUg\nPT0gZmxvYXQuY2xhc3MgfHwgcGFyYW1UeXBlID09IEZsb2F0LmNsYXNzKQ0K\nICAgICAgICAgICAgICAgIGFyZyA9IHJhbmRvbUZsb2F0KCk7DQogICAgICAg\nICAgICBlbHNlIGlmIChwYXJhbVR5cGUgPT0gU3RyaW5nLmNsYXNzKQ0KICAg\nICAgICAgICAgICAgIGFyZyA9IHJhbmRvbVN0cmluZygpOw0KICAgICAgICAg\nICAgZWxzZSBpZiAocGFyYW1UeXBlID09IEJpZ0ludGVnZXIuY2xhc3MpDQog\nICAgICAgICAgICAgICAgYXJnID0gcmFuZG9tQmlnSW50ZWdlcigpOw0KICAg\nICAgICAgICAgZWxzZSBpZiAocGFyYW1UeXBlID09IEJpZ0RlY2ltYWwuY2xh\nc3MpDQogICAgICAgICAgICAgICAgYXJnID0gcmFuZG9tQmlnRGVjaW1hbCgp\nOw0KICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1UeXBlID09IERhdGUuY2xh\nc3MpDQogICAgICAgICAgICAgICAgYXJnID0gcmFuZG9tRGF0ZSgpOw0KDQog\nICAgICAgICAgICBpZiAoYXJnICE9IG51bGwpDQogICAgICAgICAgICAgICAg\nd3JpdGUuaW52b2tlKGJlYW4sIG5ldyBPYmplY3QgW117IGFyZyB9KTsNCiAg\nICAgICAgfQ0KDQogICAgICAgIHJldHVybiBiZWFuOw0KICAgIH0NCg0KICAg\nIC8qKg0KICAgICAqIFV0aWxpdHkgbWV0aG9kIHRvIHN0YXJ0IGEgcHJvZmls\nZS4NCiAgICAgKg0KICAgICAqIEBzZWUgI2VuZFByb2ZpbGUoU3RyaW5nKQ0K\nICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIHN0YXJ0UHJvZmlsZShTdHJpbmcg\nbmFtZSkgew0KICAgICAgICBfdGltZXMucHV0KG5hbWUsIG5ldyBMb25nKFN5\nc3RlbS5jdXJyZW50VGltZU1pbGxpcygpKSk7DQogICAgfQ0KDQogICAgLyoq\nDQogICAgICogVXRpbGl0eSB0byBlbmQgdGhlIHByb2ZpbGUgYW5kIHByaW50\nIG91dCB0aGUgdGltZS4gRXhhbXBsZSB1c2FnZToNCiAgICAgKiA8cC8+DQog\nICAgICogPHByZT48Y29kZT4gc3RhcnRQcm9maWxlKCJTb21lIGxvbmcgdGFz\nayIpOyBkb1NvbWVMb25nVGFzaygpOw0KICAgICAqIGVuZFByb2ZpbGUoIlNv\nbWUgbG9uZyB0YXNrIik7DQogICAgICogPC9jb2RlPjwvcHJlPg0KICAgICAq\nDQogICAgICogQHBhcmFtIG5hbWUNCiAgICAgKiBAcmV0dXJuIHRoZSBhbW91\nbnQgb2YgdGltZSB0aGF0IHRoaXMgcHJvZmlsZSBpbnZvY2F0aW9uIHRvb2ss\nIG9yDQogICAgICogICAgICAgICAtMSBpZiA8Y29kZT5uYW1lPC9jb2RlPiB3\nYXMgbmV2ZXIgc3RhcnRlZC4NCiAgICAgKi8NCiAgICBwdWJsaWMgbG9uZyBl\nbmRQcm9maWxlKFN0cmluZyBuYW1lKSB7DQogICAgICAgIExvbmcgdGltZSA9\nIChMb25nKSBfdGltZXMucmVtb3ZlKG5hbWUpOw0KDQogICAgICAgIGxvbmcg\nZWxhcHNlZCA9IC0xOw0KICAgICAgICBpZiAodGltZSAhPSBudWxsKQ0KICAg\nICAgICAgICAgZWxhcHNlZCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nIC0gdGltZS5sb25nVmFsdWUoKTsNCg0KICAgICAgICBnZXRMb2coKS5pbmZv\nKF9sb2MuZ2V0KCJwcm9maWxlLWluZm8iLCBuYW1lLA0KICAgICAgICAgICAg\nKHRpbWUgPT0gbnVsbCA/ICI/Pz8iIDogIiIgKyBlbGFwc2VkKSkpOw0KICAg\nICAgICByZXR1cm4gZWxhcHNlZDsNCiAgICB9DQoNCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vDQogICAgLy8gQ2xhc3NMb2FkZXIgZnVuY3Rpb25z\nDQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgLyoqDQog\nICAgICogQ3JlYXRlIGEgQ2xhc3NMb2FkZXIgdGhhdCB3aWxsIG5vdCB1c2Ug\ndGhlIHBhcmVudA0KICAgICAqIENsYXNzTG9hZGVyIHRvIHJlc29sdmUgY2xh\nc3Nlcy4gVGhpcyBpcyB1c2VmdWwgZm9yDQogICAgICogdGVzdGluZyBpbnRl\ncmFjdGlvbnMgYmV0d2VlbiBLb2RvIGluIHJ1bm5pbmcNCiAgICAgKiBpbiBD\nbGFzc0xvYWRlckEgYW5kIGluc3RhbmNlcyBpbiBDbGFzc0xvYWRlckIuDQog\nICAgICovDQogICAgcHVibGljIENsYXNzTG9hZGVyIGNyZWF0ZUlzb2xhdGVk\nQ2xhc3NMb2FkZXIoKSB7DQogICAgICAgIHJldHVybiBuZXcgSXNvbGF0ZWRD\nbGFzc0xvYWRlcigpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBOZXN0ZWRDbGFz\nc0xvYWRlciBjcmVhdGVOZXN0ZWRDbGFzc0xvYWRlcigpIHsNCiAgICAgICAg\ncmV0dXJuIG5ldyBOZXN0ZWRDbGFzc0xvYWRlcihmYWxzZSk7DQogICAgfQ0K\nDQogICAgcHVibGljIE5lc3RlZENsYXNzTG9hZGVyIGNyZWF0ZU5lc3RlZFBh\ncmVudENsYXNzTG9hZGVyKCkgew0KICAgICAgICByZXR1cm4gbmV3IE5lc3Rl\nZENsYXNzTG9hZGVyKHRydWUpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAq\nIFJlbG9hZCB0aGUgc3BlY2lmaWVkIGNsYXNzIGluIGFuIGlzb2xhdGVkIENs\nYXNzTG9hZGVyLg0KICAgICAqDQogICAgICogQHBhcmFtIHRhcmdldCB0aGUg\ndGFyZ2V0IGNsYXNzIHRvIGxvYWQNCiAgICAgKiBAcmV0dXJuIHRoZSBDbGFz\ncyBhcyByZWxvYWRlZCBpbiBhbiBuZXcgQ2xhc3NMb2FkZXINCiAgICAgKi8N\nCiAgICBwdWJsaWMgQ2xhc3MgaXNvbGF0ZShDbGFzcyB0YXJnZXQpIHRocm93\ncyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uIHsNCiAgICAgICAgQ2xhc3MgcmVz\ndWx0ID0gaXNvbGF0ZSh0YXJnZXQuZ2V0TmFtZSgpKTsNCiAgICAgICAgYXNz\nZXJ0VHJ1ZShyZXN1bHQgIT0gdGFyZ2V0KTsNCiAgICAgICAgYXNzZXJ0Tm90\nRXF1YWxzKHJlc3VsdCwgdGFyZ2V0KTsNCiAgICAgICAgYXNzZXJ0VHJ1ZShy\nZXN1bHQuZ2V0Q2xhc3NMb2FkZXIoKSAhPSB0YXJnZXQuZ2V0Q2xhc3NMb2Fk\nZXIoKSk7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAg\ncHVibGljIENsYXNzIGlzb2xhdGUoU3RyaW5nIHRhcmdldCkgdGhyb3dzIENs\nYXNzTm90Rm91bmRFeGNlcHRpb24gew0KICAgICAgICBDbGFzc0xvYWRlciBp\nbCA9IGNyZWF0ZUlzb2xhdGVkQ2xhc3NMb2FkZXIoKTsNCiAgICAgICAgQ2xh\nc3MgcmVzdWx0ID0gaWwubG9hZENsYXNzKHRhcmdldCk7DQogICAgICAgIGFz\nc2VydEVxdWFscyhyZXN1bHQuZ2V0TmFtZSgpLCB0YXJnZXQpOw0KDQogICAg\nICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcHVibGljIENsYXNz\nIG5lc3QoQ2xhc3MgdGFyZ2V0KSB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2Vw\ndGlvbiB7DQogICAgICAgIENsYXNzTG9hZGVyIGlsID0gY3JlYXRlTmVzdGVk\nQ2xhc3NMb2FkZXIoKTsNCiAgICAgICAgQ2xhc3MgcmVzdWx0ID0gaWwubG9h\nZENsYXNzKHRhcmdldC5nZXROYW1lKCkpOw0KICAgICAgICBhc3NlcnRUcnVl\nKHJlc3VsdCAhPSB0YXJnZXQpOw0KICAgICAgICBhc3NlcnROb3RFcXVhbHMo\ncmVzdWx0LCB0YXJnZXQpOw0KICAgICAgICBhc3NlcnRUcnVlKHJlc3VsdC5n\nZXRDbGFzc0xvYWRlcigpICE9IHRhcmdldC5nZXRDbGFzc0xvYWRlcigpKTsN\nCiAgICAgICAgYXNzZXJ0RXF1YWxzKHJlc3VsdC5nZXROYW1lKCksIHRhcmdl\ndC5nZXROYW1lKCkpOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAg\nfQ0KDQogICAgcHVibGljIE9iamVjdCBpc29sYXRlTmV3KENsYXNzIHRhcmdl\ndCkNCiAgICAgICAgdGhyb3dzIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIEls\nbGVnYWxBY2Nlc3NFeGNlcHRpb24sDQogICAgICAgIEluc3RhbnRpYXRpb25F\neGNlcHRpb24gew0KICAgICAgICByZXR1cm4gaXNvbGF0ZSh0YXJnZXQpLm5l\nd0luc3RhbmNlKCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgY2xh\nc3MgTmVzdGVkQ2xhc3NMb2FkZXIgZXh0ZW5kcyBBbnRDbGFzc0xvYWRlciB7\nDQoNCiAgICAgICAgcHVibGljIE5lc3RlZENsYXNzTG9hZGVyKGJvb2xlYW4g\ndXNlUGFyZW50KSB7DQogICAgICAgICAgICBzdXBlcihDbGFzc0xvYWRlci5n\nZXRTeXN0ZW1DbGFzc0xvYWRlcigpLCB1c2VQYXJlbnQpOw0KDQogICAgICAg\nICAgICBmb3IgKFN0cmluZ1Rva2VuaXplciBjbHRvayA9IG5ldyBTdHJpbmdU\nb2tlbml6ZXIoDQogICAgICAgICAgICAgICAgU3lzdGVtLmdldFByb3BlcnR5\nKCJqYXZhLmNsYXNzLnBhdGgiKSwgRmlsZS5wYXRoU2VwYXJhdG9yKTsNCiAg\nICAgICAgICAgICAgICBjbHRvay5oYXNNb3JlVG9rZW5zKCk7KSB7DQogICAg\nICAgICAgICAgICAgU3RyaW5nIHBhdGggPSBjbHRvay5uZXh0VG9rZW4oKTsN\nCg0KICAgICAgICAgICAgICAgIC8vIG9ubHkgbG9hZCB0ZXN0IHBhdGhzLCBu\nb3QgamFyIGZpbGVzDQogICAgICAgICAgICAgICAgaWYgKHBhdGguaW5kZXhP\nZigiLmphciIpICE9IC0xKQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51\nZTsNCiAgICAgICAgICAgICAgICBpZiAocGF0aC5pbmRleE9mKCIuemlwIikg\nIT0gLTEpDQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KDQogICAg\nICAgICAgICAgICAgYWRkUGF0aEVsZW1lbnQocGF0aCk7DQogICAgICAgICAg\nICB9DQoNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgaWYg\nKCF1c2VQYXJlbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0VHJ1\nZShsb2FkQ2xhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgIChBYnN0cmFj\ndFRlc3RDYXNlLmNsYXNzLmdldE5hbWUoKSkuZ2V0Q2xhc3NMb2FkZXIoKQ0K\nICAgICAgICAgICAgICAgICAgICAgICAgIT0gQWJzdHJhY3RUZXN0Q2FzZS5j\nbGFzcy5nZXRDbGFzc0xvYWRlcigpKTsNCiAgICAgICAgICAgICAgICB9DQog\nICAgICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uIGNu\nZmUpIHsNCiAgICAgICAgICAgICAgICBmYWlsKGNuZmUudG9TdHJpbmcoKSk7\nDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMg\nQ2xhc3MgZmluZENsYXNzKFN0cmluZyBuYW1lKSB0aHJvd3MgQ2xhc3NOb3RG\nb3VuZEV4Y2VwdGlvbiB7DQogICAgICAgICAgICAvLyBkb24ndCBpc29sYXRl\nIFBDIGFuZCByZWxhdGVkIGNsYXNzZXMgaW4ga29kby5lbmhuYWNlDQogICAg\nICAgICAgICBpZiAobmFtZS5pbmRleE9mKCIuZW5oYW5jZS4iKSAhPSAtMSkN\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NOb3RGb3VuZEV4Y2Vw\ndGlvbihuYW1lKTsNCiAgICAgICAgICAgIGlmIChuYW1lLmluZGV4T2YoIi9l\nbmhhbmNlLyIpICE9IC0xKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBD\nbGFzc05vdEZvdW5kRXhjZXB0aW9uKG5hbWUpOw0KICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmZpbmRDbGFzcyhuYW1lKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIEEgQ2xhc3NMb2FkZXIgdGhhdCBpcyBjb21w\nbGV0ZWx5IGlzb2xhdGVkIHdpdGggcmVzcGVjdCB0bw0KICAgICAqIGFueSBj\nbGFzc2VzIHRoYXQgYXJlIGxvYWRlZCBpbiB0aGUgU3lzdGVtIENsYXNzTG9h\nZGVyLg0KICAgICAqDQogICAgICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVh\ndXgNCiAgICAgKi8NCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBJc29sYXRl\nZENsYXNzTG9hZGVyIGV4dGVuZHMgTmVzdGVkQ2xhc3NMb2FkZXIgew0KDQog\nICAgICAgIHB1YmxpYyBJc29sYXRlZENsYXNzTG9hZGVyKCkgew0KICAgICAg\nICAgICAgc3VwZXIoZmFsc2UpOw0KICAgICAgICAgICAgc2V0SXNvbGF0ZWQo\nZmFsc2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8vLy8vLy8vLy8v\nLy8vDQogICAgLy8gQ29sbGVjdGlvbnMNCiAgICAvLy8vLy8vLy8vLy8vLy8N\nCg0KICAgIC8qKg0KICAgICAqIFZhbGlkYXRlIHRoYXQgdGhlIHNwZWNpZmll\nZCB7QGxpbmsgQ29sbGVjdGlvbn0gZnVsZmlsbHMgdGhlDQogICAgICogQ29s\nbGVjdGlvbiBjb250cmFjdCBhcyBzcGVjaWZpZWQgYnkgdGhlIENvbGxlY3Rp\nb25zIEFQSS4NCiAgICAgKiA8cC8+DQogICAgICogPHN0cm9uZz5Ob3RlPC9z\ndHJvbmc+OiBkb2VzIG5vdCB2YWxpZGF0ZSBtdXRhYmxlIG9wZXJhdGlvbnMN\nCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgdmFsaWRhdGVDb2xs\nZWN0aW9uKENvbGxlY3Rpb24gY29sbGVjdGlvbikgew0KICAgICAgICBpbnQg\nc2l6ZSA9IGNvbGxlY3Rpb24uc2l6ZSgpOw0KICAgICAgICBpbnQgaXRlcmF0\nZWQgPSAwOw0KICAgICAgICAvLyBlbnN1cmUgd2UgY2FuIHdhbGsgYWxvbmcg\ndGhlIGl0ZXJhdG9yDQogICAgICAgIGZvciAoSXRlcmF0b3IgaSA9IGNvbGxl\nY3Rpb24uaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7KSB7DQogICAgICAgICAg\nICBpdGVyYXRlZCsrOw0KICAgICAgICAgICAgaS5uZXh0KCk7DQogICAgICAg\nIH0NCg0KICAgICAgICAvLyBlbnN1cmUgdGhlIG51bWJlciBvZiB2YWx1ZXMg\naXRlcmF0ZWQgaXMgdGhlIHNhbWUgYXMgdGhlIGxpc3Qgc2l6ZQ0KICAgICAg\nICBhc3NlcnRFcXVhbHMoc2l6ZSwgaXRlcmF0ZWQpOw0KDQogICAgICAgIC8v\nIGFsc28gdmFsaWRhdGUgdGhlIGxpc3QNCiAgICAgICAgaWYgKGNvbGxlY3Rp\nb24gaW5zdGFuY2VvZiBMaXN0KSB7DQogICAgICAgICAgICBMaXN0IGxsID0g\nbmV3IEFycmF5TGlzdCgpOw0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCAxMDA7IGkrKykNCiAgICAgICAgICAgICAgICBsbC5hZGQobmV3IElu\ndGVnZXIoaSkpOw0KICAgICAgICAgICAgdmFsaWRhdGVMaXN0KChMaXN0KSBs\nbCk7DQogICAgICAgICAgICB2YWxpZGF0ZUxpc3QoKExpc3QpIGNvbGxlY3Rp\nb24pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVmFs\naWRhdGUgdGhhdCB0aGUgc3BlY2lmaWVkIHtAbGluayBMaXN0fSBmdWxmaWxs\ncyB0aGUNCiAgICAgKiBMaXN0IGNvbnRyYWN0IGFzIHNwZWNpZmllZCBieSB0\naGUgQ29sbGVjdGlvbnMgQVBJLg0KICAgICAqIDxwLz4NCiAgICAgKiA8c3Ry\nb25nPk5vdGU8L3N0cm9uZz46IGRvZXMgbm90IHZhbGlkYXRlIG11dGFibGUg\nb3BlcmF0aW9ucw0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCB2\nYWxpZGF0ZUxpc3QoTGlzdCBsaXN0KSB7DQogICAgICAgIE9iamVjdCBbXSBj\nb3JlVmFsdWVzID0gbGlzdC50b0FycmF5KCk7DQogICAgICAgIE9iamVjdCBb\nXSB2YWx1ZXMxID0gbmV3IE9iamVjdCBbbGlzdC5zaXplKCldOw0KICAgICAg\nICBPYmplY3QgW10gdmFsdWVzMiA9IG5ldyBPYmplY3QgW2xpc3Quc2l6ZSgp\nXTsNCiAgICAgICAgT2JqZWN0IFtdIHZhbHVlczMgPSBuZXcgT2JqZWN0IFts\naXN0LnNpemUoKV07DQogICAgICAgIE9iamVjdCBbXSB2YWx1ZXM0ID0gbmV3\nIE9iamVjdCBbbGlzdC5zaXplKCldOw0KDQogICAgICAgIC8vIGZpbGwgc2Vx\ndWVudGlhbCBpbmRleCBhY2Nlc3MgbGlzdA0KICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGxpc3Quc2l6ZSgpOyBpKyspDQogICAgICAgICAgICB2YWx1\nZXMxW2ldID0gbGlzdC5nZXQoaSk7DQoNCiAgICAgICAgLy8gZmlsbCBzZXF1\nZW50aWFsIGxpc3QNCiAgICAgICAgaW50IGluZGV4ID0gMDsNCiAgICAgICAg\nTGlzdEl0ZXJhdG9yIGl0ZXI7DQogICAgICAgIGZvciAoaXRlciA9IGxpc3Qu\nbGlzdEl0ZXJhdG9yKDApOyBpdGVyLmhhc05leHQoKTspIHsNCiAgICAgICAg\nICAgIGFzc2VydEVxdWFscyhpbmRleCwgaXRlci5uZXh0SW5kZXgoKSk7DQog\nICAgICAgICAgICBhc3NlcnRFcXVhbHMoaW5kZXgsIGl0ZXIucHJldmlvdXNJ\nbmRleCgpICsgMSk7DQogICAgICAgICAgICB2YWx1ZXMyW2luZGV4XSA9IGl0\nZXIubmV4dCgpOw0KICAgICAgICAgICAgYXNzZXJ0VHJ1ZShsaXN0LmNvbnRh\naW5zKHZhbHVlczJbaW5kZXhdKSk7DQogICAgICAgICAgICBpbmRleCsrOw0K\nICAgICAgICB9DQoNCiAgICAgICAgLy8gZW5zdXJlIE5vU3VjaEVsZW1lbnRF\neGNlcHRpb24gaXMgdGhyb3duIGFzIGFwcHJvcHJpYXRlDQogICAgICAgIHRy\neSB7DQogICAgICAgICAgICBpdGVyLm5leHQoKTsNCiAgICAgICAgICAgIGZh\naWwoIm5leHQoKSBzaG91bGQgaGF2ZSByZXN1bHRlZCBpbiBhIE5vU3VjaEVs\nZW1lbnRFeGNlcHRpb24iKTsNCiAgICAgICAgfSBjYXRjaCAoTm9TdWNoRWxl\nbWVudEV4Y2VwdGlvbiBlKSB7DQogICAgICAgIH0gLy8gYXMgZXhwZWN0ZWQN\nCg0KICAgICAgICAvLyBmaWxsIHJldmVyc2Ugc2VxdWVudGlhbCBsaXN0DQog\nICAgICAgIGludCBiYWNrID0gMDsNCiAgICAgICAgZm9yIChpdGVyID0gbGlz\ndC5saXN0SXRlcmF0b3IobGlzdC5zaXplKCkpOyBpdGVyLmhhc1ByZXZpb3Vz\nKCk7KSB7DQogICAgICAgICAgICBhc3NlcnRFcXVhbHMoaW5kZXgsIGl0ZXIu\ncHJldmlvdXNJbmRleCgpICsgMSk7DQogICAgICAgICAgICBhc3NlcnRFcXVh\nbHMoaW5kZXgsIGl0ZXIubmV4dEluZGV4KCkpOw0KICAgICAgICAgICAgdmFs\ndWVzM1stLWluZGV4XSA9IGl0ZXIucHJldmlvdXMoKTsNCiAgICAgICAgICAg\nIGJhY2srKzsNCiAgICAgICAgfQ0KICAgICAgICBhc3NlcnRFcXVhbHMobGlz\ndC5zaXplKCksIGJhY2spOw0KDQogICAgICAgIC8vIGVuc3VyZSBOb1N1Y2hF\nbGVtZW50RXhjZXB0aW9uIGlzIHRocm93biBhcyBhcHByb3ByaWF0ZQ0KICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgaXRlci5wcmV2aW91cygpOw0KICAg\nICAgICAgICAgZmFpbCgicHJldmlvdXMoKSBzaG91bGQgaGF2ZSByZXN1bHRl\nZCBpbiBhICINCiAgICAgICAgICAgICAgICArICJOb1N1Y2hFbGVtZW50RXhj\nZXB0aW9uIik7DQogICAgICAgIH0gY2F0Y2ggKE5vU3VjaEVsZW1lbnRFeGNl\ncHRpb24gZSkgew0KICAgICAgICB9IC8vIGFzIGV4cGVjdGVkDQoNCiAgICAg\nICAgLy8gZmlsbCByYW5kb20gYWNjZXNzIGxpc3QNCiAgICAgICAgTGlzdCBp\nbmRpY2VzID0gbmV3IExpbmtlZExpc3QoKTsNCiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBsaXN0LnNpemUoKTsgaSsrKQ0KICAgICAgICAgICAgaW5k\naWNlcy5hZGQobmV3IEludGVnZXIoaSkpOw0KDQogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbGlzdC5zaXplKCk7IGkrKykgew0KICAgICAgICAgICAg\naW50IHJhbmQgPSAoaW50KSAoTWF0aC5yYW5kb20oKSAqIGluZGljZXMuc2l6\nZSgpKTsNCiAgICAgICAgICAgIEludGVnZXIgcmFuZEluZGV4ID0gKEludGVn\nZXIpIGluZGljZXMucmVtb3ZlKHJhbmQpOw0KICAgICAgICAgICAgdmFsdWVz\nNFtyYW5kSW5kZXguaW50VmFsdWUoKV0gPSBsaXN0LmdldChyYW5kSW5kZXgu\naW50VmFsdWUoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBhc3NlcnRFcXVh\nbHMoQXJyYXlzLmFzTGlzdChjb3JlVmFsdWVzKSwgQXJyYXlzLmFzTGlzdCh2\nYWx1ZXMxKSk7DQogICAgICAgIGFzc2VydElkZW50aWNhbChBcnJheXMuYXNM\naXN0KGNvcmVWYWx1ZXMpLCBBcnJheXMuYXNMaXN0KHZhbHVlczEpKTsNCiAg\nICAgICAgYXNzZXJ0RXF1YWxzKEFycmF5cy5hc0xpc3QoY29yZVZhbHVlcyks\nIEFycmF5cy5hc0xpc3QodmFsdWVzMikpOw0KICAgICAgICBhc3NlcnRJZGVu\ndGljYWwoQXJyYXlzLmFzTGlzdChjb3JlVmFsdWVzKSwgQXJyYXlzLmFzTGlz\ndCh2YWx1ZXMyKSk7DQogICAgICAgIGFzc2VydEVxdWFscyhBcnJheXMuYXNM\naXN0KGNvcmVWYWx1ZXMpLCBBcnJheXMuYXNMaXN0KHZhbHVlczQpKTsNCiAg\nICAgICAgYXNzZXJ0SWRlbnRpY2FsKEFycmF5cy5hc0xpc3QoY29yZVZhbHVl\ncyksIEFycmF5cy5hc0xpc3QodmFsdWVzNCkpOw0KICAgICAgICBhc3NlcnRF\ncXVhbHMoQXJyYXlzLmFzTGlzdChjb3JlVmFsdWVzKSwgQXJyYXlzLmFzTGlz\ndCh2YWx1ZXMzKSk7DQogICAgICAgIGFzc2VydElkZW50aWNhbChBcnJheXMu\nYXNMaXN0KGNvcmVWYWx1ZXMpLCBBcnJheXMuYXNMaXN0KHZhbHVlczMpKTsN\nCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgZ2l2\nZW4gTGlzdCBjb250YWluIHRoZSBleGFjdCBzYW1lDQogICAgICogZWxlbWVu\ndHMuIFRoaXMgaXMgZGlmZmVyZW50IHRoYW4gdGhlIG5vcm1hbCBMaXN0IGNv\nbnRyYWN0LCB3aGljaA0KICAgICAqIHN0YXRlcyB0aGF0IGxpc3QxLmVxdWFs\ncyhsaXN0MikgaWYgZWFjaCBlbGVtZW50IGUxLmVxdWFscyhlMikuDQogICAg\nICogVGhpcyBtZXRob2QgYXNzZXJ0cyB0aGF0IGUxID09IG4yLg0KICAgICAq\nLw0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBhc3NlcnRJZGVudGljYWwoTGlz\ndCBjMSwgTGlzdCBjMikgew0KICAgICAgICBhc3NlcnRFcXVhbHMoYzEuc2l6\nZSgpLCBjMi5zaXplKCkpOw0KICAgICAgICBmb3IgKEl0ZXJhdG9yIGkxID0g\nYzEuaXRlcmF0b3IoKSwgaTIgPSBjMi5pdGVyYXRvcigpOw0KICAgICAgICAg\nICAgaTEuaGFzTmV4dCgpICYmIGkyLmhhc05leHQoKTspDQogICAgICAgICAg\nICBhc3NlcnRUcnVlKGkxLm5leHQoKSA9PSBpMi5uZXh0KCkpOw0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIEFzc2VydCB0aGF0IHRoZSBjb2xsZWN0aW9u\nIHBhcmFtZXRlciBpcyBhbHJlYWR5IG9yZGVyZWQNCiAgICAgKiBhY2NvcmRp\nbmcgdG8gdGhlIHNwZWNpZmllZCBjb21wYXJhdG9yLg0KICAgICAqLw0KICAg\nIHB1YmxpYyB2b2lkIGFzc2VydE9yZGVyZWQoQ29sbGVjdGlvbiBjLCBDb21w\nYXJhdG9yIGNvbXApIHsNCiAgICAgICAgTGlzdCBsMSA9IG5ldyBMaW5rZWRM\naXN0KGMpOw0KICAgICAgICBMaXN0IGwyID0gbmV3IExpbmtlZExpc3QoYyk7\nDQogICAgICAgIGFzc2VydEVxdWFscyhsMSwgbDIpOw0KICAgICAgICBDb2xs\nZWN0aW9ucy5zb3J0KGwyLCBjb21wKTsNCiAgICAgICAgYXNzZXJ0RXF1YWxz\nKGwxLCBsMik7DQogICAgICAgIENvbGxlY3Rpb25zLnNvcnQobDEsIGNvbXAp\nOw0KICAgICAgICBhc3NlcnRFcXVhbHMobDEsIGwyKTsNCiAgICB9DQoNCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLw0KICAgIC8vIEFzc2VydGlvbiBIZWxw\nZXJzDQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIHB1YmxpYyB2\nb2lkIGFzc2VydE5vdEVxdWFscyhPYmplY3QgYSwgT2JqZWN0IGIpIHsNCiAg\nICAgICAgaWYgKGEgPT0gbnVsbCAmJiBiICE9IG51bGwpDQogICAgICAgICAg\nICByZXR1cm47DQogICAgICAgIGlmIChhICE9IG51bGwgJiYgYiA9PSBudWxs\nKQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICBpZiAoIShhLmVxdWFs\ncyhiKSkpDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIGlmICghKGIu\nZXF1YWxzKGEpKSkNCiAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICBm\nYWlsKCJleHBlY3RlZCAhPCIgKyBhICsgIj4uZXF1YWxzKDwiICsgYiArICI+\nKSIpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGFzc2VydFNpemUoaW50\nIHNpemUsIE9iamVjdCBvYikgew0KICAgICAgICBpZiAob2IgPT0gbnVsbCkg\new0KICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKHNpemUsIDApOw0KICAgICAg\nICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKG9iIGlu\nc3RhbmNlb2YgQ29sbGVjdGlvbikNCiAgICAgICAgICAgIG9iID0gKChDb2xs\nZWN0aW9uKSBvYikuaXRlcmF0b3IoKTsNCiAgICAgICAgaWYgKG9iIGluc3Rh\nbmNlb2YgSXRlcmF0b3IpIHsNCiAgICAgICAgICAgIEl0ZXJhdG9yIGkgPSAo\nSXRlcmF0b3IpIG9iOw0KICAgICAgICAgICAgaW50IGNvdW50ID0gMDsNCiAg\nICAgICAgICAgIHdoaWxlIChpLmhhc05leHQoKSkgew0KICAgICAgICAgICAg\nICAgIGNvdW50Kys7DQogICAgICAgICAgICAgICAgaS5uZXh0KCk7DQogICAg\nICAgICAgICB9DQoNCiAgICAgICAgICAgIGFzc2VydEVxdWFscyhzaXplLCBj\nb3VudCk7DQogICAgICAgIH0gZWxzZQ0KICAgICAgICAgICAgZmFpbCgiYXNz\nZXJ0U2l6ZTogZXhwZWN0ZWQgQ29sbGVjdGlvbiwgSXRlcmF0b3IsICINCiAg\nICAgICAgICAgICAgICArICJRdWVyeSwgb3IgRXh0ZW50LCBidXQgZ290ICIg\nKyBvYi5nZXRDbGFzcygpLmdldE5hbWUoKSk7DQogICAgfQ0KDQogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vDQogICAgLy8gR2VuZXJpYyB1dGlsaXRpZXMN\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8NCg0KICAgIHB1YmxpYyB2b2lk\nIGNvcHkoRmlsZSBmcm9tLCBGaWxlIHRvKSB0aHJvd3MgSU9FeGNlcHRpb24g\new0KICAgICAgICBjb3B5KG5ldyBGaWxlSW5wdXRTdHJlYW0oZnJvbSksIHRv\nKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBjb3B5KElucHV0U3RyZWFt\nIGluLCBGaWxlIHRvKSB0aHJvd3MgSU9FeGNlcHRpb24gew0KICAgICAgICBG\naWxlT3V0cHV0U3RyZWFtIGZvdXQgPSBuZXcgRmlsZU91dHB1dFN0cmVhbSh0\nbyk7DQoNCiAgICAgICAgYnl0ZVtdIGIgPSBuZXcgYnl0ZVsxMDI0XTsNCg0K\nICAgICAgICBmb3IgKGludCBuID0gMDsgKG4gPSBpbi5yZWFkKGIpKSAhPSAt\nMTspDQogICAgICAgICAgICBmb3V0LndyaXRlKGIsIDAsIG4pOw0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIFByaW50IG91dCBpbmZvcm1hdGlvbiBvbiBt\nZW1vcnkgdXNhZ2UuDQogICAgICovDQogICAgcHVibGljIHZvaWQgcHJpbnRN\nZW1vcnlJbmZvKCkgew0KICAgICAgICBSdW50aW1lIHJ0ID0gUnVudGltZS5n\nZXRSdW50aW1lKCk7DQogICAgICAgIGxvbmcgdG90YWwgPSBydC50b3RhbE1l\nbW9yeSgpOw0KICAgICAgICBsb25nIGZyZWUgPSBydC5mcmVlTWVtb3J5KCk7\nDQogICAgICAgIGxvbmcgdXNlZCA9IHRvdGFsIC0gZnJlZTsNCg0KICAgICAg\nICBOdW1iZXJGb3JtYXQgbmYgPSBOdW1iZXJGb3JtYXQuZ2V0SW5zdGFuY2Uo\nKTsNCiAgICAgICAgZ2V0TG9nKCkud2FybihfbG9jLmdldCgibWVtLWluZm8i\nLA0KICAgICAgICAgICAgbmYuZm9ybWF0KHVzZWQpLA0KICAgICAgICAgICAg\nbmYuZm9ybWF0KHRvdGFsKSwNCiAgICAgICAgICAgIG5mLmZvcm1hdChmcmVl\nKSkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiBhIGxpc3Qg\nb2YgYWxsIHZhbHVlcyBpdGVyYXRlZCBieSB0aGUgZ2l2ZW4gaXRlcmF0b3Iu\nDQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBMaXN0IGl0ZXJhdG9yVG9M\naXN0KEl0ZXJhdG9yIGkpIHsNCiAgICAgICAgTGlua2VkTGlzdCBsaXN0ID0g\nbmV3IExpbmtlZExpc3QoKTsNCiAgICAgICAgd2hpbGUgKGkuaGFzTmV4dCgp\nKQ0KICAgICAgICAgICAgbGlzdC5hZGQoaS5uZXh0KCkpOw0KICAgICAgICBy\nZXR1cm4gbGlzdDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4g\nYW4gYXJyYXkgb2YgdGhlIG9iamVjdHMgaXRlcmF0ZWQgYnkgdGhlIGdpdmVu\nIGl0ZXJhdG9yLg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0\nIFtdIGl0ZXJhdG9yVG9BcnJheShJdGVyYXRvciBpLCBDbGFzcyBbXSBjbGF6\neikgew0KICAgICAgICByZXR1cm4gaXRlcmF0b3JUb0xpc3QoaSkudG9BcnJh\neShjbGF6eik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUnVuIGFudCBv\nbiB0aGUgc3BlY2lmaWVkIGJ1aWxkIGZpbGUuDQogICAgICoNCiAgICAgKiBA\ncGFyYW0gYnVpbGRGaWxlIHRoZSBidWlsZCBmaWxlIHRvIHVzZQ0KICAgICAq\nIEBwYXJhbSB0YXJnZXQgdGhlIG5hbWUgb2YgdGhlIHRhcmdldCB0byBpbnZv\na2UNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBhbnQoRmlsZSBidWlsZEZp\nbGUsIFN0cmluZyB0YXJnZXQpIHsNCiAgICAgICAgYXNzZXJ0VHJ1ZShidWls\nZEZpbGUuaXNGaWxlKCkpOw0KDQogICAgICAgIFByb2plY3QgcHJvamVjdCA9\nIG5ldyBQcm9qZWN0KCk7DQogICAgICAgIHByb2plY3QuaW5pdCgpOw0KICAg\nICAgICBwcm9qZWN0LnNldFVzZXJQcm9wZXJ0eSgiYW50LmZpbGUiLCBidWls\nZEZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkpOw0KICAgICAgICBQcm9qZWN0SGVs\ncGVyLmNvbmZpZ3VyZVByb2plY3QocHJvamVjdCwgYnVpbGRGaWxlKTsNCiAg\nICAgICAgcHJvamVjdC5leGVjdXRlVGFyZ2V0KHRhcmdldCk7DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogU2VyaWFsaXplIGFuZCBkZXNlcmlhbGl6ZSB0\naGUgb2JqZWN0Lg0KICAgICAqDQogICAgICogQHBhcmFtIHZhbGlkYXRlRXF1\nYWxpdHkgbWFrZSBzdXJlIHRoZSBoYXNoQ29kZSBhbmQgZXF1YWxzDQogICAg\nICogbWV0aG9kcyBob2xkIHRydWUNCiAgICAgKi8NCiAgICBwdWJsaWMgc3Rh\ndGljIE9iamVjdCByb3VuZHRyaXAoT2JqZWN0IG9yaWcsIGJvb2xlYW4gdmFs\naWRhdGVFcXVhbGl0eSkNCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBD\nbGFzc05vdEZvdW5kRXhjZXB0aW9uIHsNCiAgICAgICAgYXNzZXJ0Tm90TnVs\nbChvcmlnKTsNCg0KICAgICAgICBCeXRlQXJyYXlPdXRwdXRTdHJlYW0gYm91\ndCA9IG5ldyBCeXRlQXJyYXlPdXRwdXRTdHJlYW0oKTsNCiAgICAgICAgT2Jq\nZWN0T3V0cHV0U3RyZWFtIG91dCA9IG5ldyBPYmplY3RPdXRwdXRTdHJlYW0o\nYm91dCk7DQogICAgICAgIG91dC53cml0ZU9iamVjdChvcmlnKTsNCiAgICAg\nICAgQnl0ZUFycmF5SW5wdXRTdHJlYW0gYmluID0gbmV3IEJ5dGVBcnJheUlu\ncHV0U3RyZWFtKA0KICAgICAgICAgICAgYm91dC50b0J5dGVBcnJheSgpKTsN\nCiAgICAgICAgT2JqZWN0SW5wdXRTdHJlYW0gaW4gPSBuZXcgT2JqZWN0SW5w\ndXRTdHJlYW0oYmluKTsNCiAgICAgICAgT2JqZWN0IHJlc3VsdCA9IGluLnJl\nYWRPYmplY3QoKTsNCg0KICAgICAgICBpZiAodmFsaWRhdGVFcXVhbGl0eSkg\new0KICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKG9yaWcsIHJlc3VsdCk7DQog\nICAgICAgICAgICBhc3NlcnRFcXVhbHMob3JpZy5oYXNoQ29kZSgpLCByZXN1\nbHQuaGFzaENvZGUoKSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4g\ncmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEByZXR1cm4gdHJ1\nZSBpZiB0aGUgc3BlY2lmaWVkIGlucHV0IG1hdGNoZXMgdGhlIHJlZ3VsYXIg\nZXhwcmVzc2lvbiByZWdleC4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGlj\nIGJvb2xlYW4gbWF0Y2hlcyhTdHJpbmcgcmVnZXgsIFN0cmluZyBpbnB1dCkN\nCiAgICAgICAgdGhyb3dzIFJFU3ludGF4RXhjZXB0aW9uIHsNCiAgICAgICAg\nUkUgcmUgPSBSRVV0aWwuY3JlYXRlUkUocmVnZXgpOw0KICAgICAgICByZXR1\ncm4gcmUubWF0Y2goaW5wdXQpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0\naWMgdm9pZCBhc3NlcnRNYXRjaGVzKFN0cmluZyByZWdleCwgU3RyaW5nIGlu\ncHV0KSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoIShtYXRj\naGVzKHJlZ2V4LCBpbnB1dCkpKQ0KICAgICAgICAgICAgICAgIGZhaWwoIkV4\ncGVjdGVkIHJlZ3VsYXIgZXhwcmVzc2lvbjogPCIgKyByZWdleCArICI+Ig0K\nICAgICAgICAgICAgICAgICAgICArICIgZGlkIG5vdCBtYXRjaDogPCIgKyBp\nbnB1dCArICI+Iik7DQogICAgICAgIH0gY2F0Y2ggKFJFU3ludGF4RXhjZXB0\naW9uIGUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1l\nbnRFeGNlcHRpb24oZS50b1N0cmluZygpKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBhc3NlcnROb3RNYXRjaGVzKFN0\ncmluZyByZWdleCwgU3RyaW5nIGlucHV0KSB7DQogICAgICAgIHRyeSB7DQog\nICAgICAgICAgICBpZiAobWF0Y2hlcyhyZWdleCwgaW5wdXQpKQ0KICAgICAg\nICAgICAgICAgIGZhaWwoIlJlZ3VsYXIgZXhwcmVzc2lvbjogPCIgKyByZWdl\neCArICI+Ig0KICAgICAgICAgICAgICAgICAgICArICIgc2hvdWxkIG5vdCBt\nYXRjaDogPCIgKyBpbnB1dCArICI+Iik7DQogICAgICAgIH0gY2F0Y2ggKFJF\nU3ludGF4RXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oZS50b1N0cmluZygpKTsNCiAgICAg\nICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrIHRoZSBsaXN0\nIGlmIHN0cmluZ3MgYW5kIHJldHVybiB0aGUgb25lcyB0aGF0IG1hdGNoDQog\nICAgICogdGhlIHNwZWNpZmllZCBtYXRjaC4NCiAgICAgKi8NCiAgICBwdWJs\naWMgc3RhdGljIExpc3QgbWF0Y2hlcyhTdHJpbmcgcmVnZXgsIENvbGxlY3Rp\nb24gaW5wdXQpDQogICAgICAgIHRocm93cyBSRVN5bnRheEV4Y2VwdGlvbiB7\nDQogICAgICAgIExpc3QgbWF0Y2hlcyA9IG5ldyBBcnJheUxpc3QoKTsNCiAg\nICAgICAgZm9yIChJdGVyYXRvciBpID0gaW5wdXQuaXRlcmF0b3IoKTsgaS5o\nYXNOZXh0KCk7KSB7DQogICAgICAgICAgICBTdHJpbmcgY2hlY2sgPSAoU3Ry\naW5nKSBpLm5leHQoKTsNCiAgICAgICAgICAgIGlmIChtYXRjaGVzKHJlZ2V4\nLCBjaGVjaykpDQogICAgICAgICAgICAgICAgbWF0Y2hlcy5hZGQoY2hlY2sp\nOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIG1hdGNoZXM7DQogICAg\nfQ0KDQogICAgLyoqDQogICAgICogQXNzZXJ0IHRoYXQgdGhlIHNwZWNpZmll\nZCBjb2xsZWN0aW9uIG9mIFN0cmluZ3MgY29udGFpbnMgYXQgbGVhc3QNCiAg\nICAgKiBvbmUgc3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgc3BlY2lmaWVkIHJl\nZ3VsYXIgZXhwcmVzc2lvbi4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGlj\nIHZvaWQgYXNzZXJ0TWF0Y2hlcyhTdHJpbmcgcmVnZXgsIENvbGxlY3Rpb24g\naW5wdXQpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChtYXRj\naGVzKHJlZ2V4LCBpbnB1dCkuc2l6ZSgpID09IDApDQogICAgICAgICAgICAg\nICAgZmFpbCgiVGhlIHNwZWNpZmllZCBsaXN0IG9mIHNpemUgIiArIGlucHV0\nLnNpemUoKQ0KICAgICAgICAgICAgICAgICAgICArICIgZGlkIG5vdCBjb250\nYWluIGFueSBzdHJpbmdzIHRoYXQgbWF0Y2ggdGhlIg0KICAgICAgICAgICAg\nICAgICAgICArICIgc3BlY2lmaWVkIHJlZ3VsYXIgZXhwcmVzc2lvbihcIiIg\nKyByZWdleCArICJcIikiKTsNCiAgICAgICAgfSBjYXRjaCAoUkVTeW50YXhF\neGNlcHRpb24gZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbihlLnRvU3RyaW5nKCkpOw0KICAgICAgICB9DQog\nICAgfQ0KDQogICAgLyoqDQogICAgICogQXNzZXJ0IHRoYXQgdGhlIHNwZWNp\nZmllZCBjb2xsZWN0aW9uIG9mIFN0cmluZ3MgZG9lcyBub3QgbWF0Y2gNCiAg\nICAgKiB0aGUgc3BlY2lmaWVkIHJlZ3VsYXIgZXhwcmVzc2lvbi4NCiAgICAg\nKi8NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgYXNzZXJ0Tm90TWF0Y2hlcyhT\ndHJpbmcgcmVnZXgsIENvbGxlY3Rpb24gaW5wdXQpIHsNCiAgICAgICAgdHJ5\nIHsNCiAgICAgICAgICAgIExpc3QgbWF0Y2hlczsNCg0KICAgICAgICAgICAg\naWYgKCgobWF0Y2hlcyA9IG1hdGNoZXMocmVnZXgsIGlucHV0KSkpLnNpemUo\nKSA+IDApDQogICAgICAgICAgICAgICAgZmFpbCgiVGhlIHNwZWNpZmllZCBs\naXN0IG9mIHNpemUgIiArIGlucHV0LnNpemUoKQ0KICAgICAgICAgICAgICAg\nICAgICArICIgZGlkIGNvbnRhaW4gb25lIG9yIG1vcmUgc3RyaW5ncyB0aGF0\nIG1hdGNocyB0aGUiDQogICAgICAgICAgICAgICAgICAgICsgIiBzcGVjaWZp\nZWQgaWxsZWdhbCByZWd1bGFyIGV4cHJlc3Npb24iDQogICAgICAgICAgICAg\nICAgICAgICsgIiAoXCIiICsgcmVnZXggKyAiXCIpLiINCiAgICAgICAgICAg\nICAgICAgICAgKyAiIEZpcnN0IGV4YW1wbGUgb2YgYSBtYXRjaGluZyBtZXNz\nYWdlIGlzOiAiDQogICAgICAgICAgICAgICAgICAgICsgbWF0Y2hlcy5pdGVy\nYXRvcigpLm5leHQoKSk7DQogICAgICAgIH0gY2F0Y2ggKFJFU3ludGF4RXhj\nZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24oZS50b1N0cmluZygpKTsNCiAgICAgICAgfQ0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIFRvIGJlIGNhbGxlZCBieSB0aGUgY2hp\nbGQuIEUuZy46DQogICAgICogPGNvZGU+IHB1YmxpYyBzdGF0aWMgdm9pZCBt\nYWluKFN0cmluZyBbXSBhcmdzKSB7IG1haW4oVGVzdEJ1ZzM3NS5jbGFzcyk7\nDQogICAgICogfQ0KICAgICAqIDwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJs\naWMgc3RhdGljIHZvaWQgbWFpbihDbGFzcyBjKSB7DQogICAgICAgIFRlc3RS\ndW5uZXIucnVuKGMpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRvIGJl\nIGNhbGxlZCBieSBjaGlsZC4gRmlndXJlcyBvdXQgdGhlIGNsYXNzIGZyb20g\ndGhlIGNhbGxpbmcgY29udGV4dC4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3Rh\ndGljIHZvaWQgbWFpbigpIHsNCiAgICAgICAgU3RyaW5nIGNhbGxlciA9IG5l\ndyBTZWN1cml0eU1hbmFnZXIoKSB7DQogICAgICAgICAgICBwdWJsaWMgU3Ry\naW5nIHRvU3RyaW5nKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBnZXRD\nbGFzc0NvbnRleHQoKVsyXS5nZXROYW1lKCk7DQogICAgICAgICAgICB9DQog\nICAgICAgIH0udG9TdHJpbmcoKTsNCg0KICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgbWFpbihDbGFzcy5mb3JOYW1lKGNhbGxlcikpOw0KICAgICAgICB9\nIGNhdGNoIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uIGNuZmUpIHsNCiAgICAg\nICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKGNuZmUudG9TdHJp\nbmcoKSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBS\nZXR1cm5zIHRoZSBqYXIgZmlsZSBpbiB3aGljaCB0aGUgY2xhc3MgaXMgY29u\ndGFpbmVkLg0KICAgICAqDQogICAgICogQHJldHVybiB0aGUgamFyIGZpbGUs\nIG9yIG5vbmUgaWYgdGhlIGNsYXNzIGlzIG5vdCBpbiBhIGphcg0KICAgICAq\nIEB0aHJvd3MgRmlsZU5vdEZvdW5kRXhjZXB0aW9uIGlmIHRoZSBqYXIgZmls\nZSBjYW5ub3QgbG9jYXRlZA0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMg\nRmlsZSBnZXRKYXJGaWxlKENsYXNzIGNsYXp6KSB0aHJvd3MgRmlsZU5vdEZv\ndW5kRXhjZXB0aW9uIHsNCiAgICAgICAgVVJMIHVybCA9IGNsYXp6LmdldFJl\nc291cmNlKGNsYXp6LmdldE5hbWUoKS5zdWJzdHJpbmcoDQogICAgICAgICAg\nICBjbGF6ei5nZXROYW1lKCkubGFzdEluZGV4T2YoIi4iKSArIDEpICsgIi5j\nbGFzcyIpOw0KICAgICAgICBpZiAodXJsID09IG51bGwpDQogICAgICAgICAg\nICB0aHJvdyBuZXcgRmlsZU5vdEZvdW5kRXhjZXB0aW9uKGNsYXp6LnRvU3Ry\naW5nKCkpOw0KDQogICAgICAgIFN0cmluZyBmaWxlID0gdXJsLmdldEZpbGUo\nKTsNCiAgICAgICAgaWYgKGZpbGUgPT0gbnVsbCkNCiAgICAgICAgICAgIHRo\ncm93IG5ldyBGaWxlTm90Rm91bmRFeGNlcHRpb24odXJsLnRvU3RyaW5nKCkp\nOw0KICAgICAgICBpbnQgaW5kZXggPSBmaWxlLmluZGV4T2YoIiEiKTsNCiAg\nICAgICAgaWYgKGluZGV4ID09IC0xKQ0KICAgICAgICAgICAgdGhyb3cgbmV3\nIEZpbGVOb3RGb3VuZEV4Y2VwdGlvbihmaWxlKTsNCg0KICAgICAgICBmaWxl\nID0gZmlsZS5zdWJzdHJpbmcoMCwgaW5kZXgpOw0KICAgICAgICBmaWxlID0g\nZmlsZS5zdWJzdHJpbmcoImZpbGU6Ii5sZW5ndGgoKSk7DQoNCiAgICAgICAg\nRmlsZSBmID0gbmV3IEZpbGUoZmlsZSk7DQogICAgICAgIGlmICghKGYuaXNG\naWxlKCkpKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IEZpbGVOb3RGb3VuZEV4\nY2VwdGlvbihmaWxlKTsNCg0KICAgICAgICByZXR1cm4gZi5nZXRBYnNvbHV0\nZUZpbGUoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgbnVtYmVy\nIG9mIG1pbGxpc2Vjb25kcyBlYWNoIHRlc3QgY2FzZSB3aWxsIGhhdmUgZm9y\nIGEgdGltZW91dC4NCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZXRUaW1l\nb3V0KGxvbmcgdGltZW91dCkgew0KICAgICAgICBfdGltZW91dCA9IHRpbWVv\ndXQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhlIG51bWJlciBvZiBt\naWxsaXNlY29uZHMgZWFjaCB0ZXN0IGNhc2Ugd2lsbCBoYXZlIGZvciBhIHRp\nbWVvdXQuDQogICAgICovDQogICAgcHVibGljIGxvbmcgZ2V0VGltZW91dCgp\nIHsNCiAgICAgICAgcmV0dXJuIF90aW1lb3V0Ow0KICAgIH0NCg0KICAgIC8q\nKg0KICAgICAqIEEgd2F0Y2hkb2cgdGhhdCBqdXN0IGV4aXRzIHRoZSBKVk0g\naWYgYSB0ZXN0IGhhcyBub3QgY29tcGxldGVkIGluDQogICAgICogYSBjZXJ0\nYWluIGFtb3VudCBvZiB0aW1lLiBUaGlzIHNwZWVkcyB1cCB0aGUgbWVjaGFu\naXNtIG9mIGRldGVybWluaW5nDQogICAgICogaWYgYSB0aW1lb3V0IGhhcyBv\nY2N1cnJlZCwgc2luY2Ugd2UgY2FuIGV4aXQgdGhlIGVudGlyZSB0ZXN0IHJ1\nbg0KICAgICAqIGlmIGEgdGVzdCBoYXNuJ3QgY29tcGxldGVkIGluIGEgc2hv\ncnRlZCBhbW91bnQgb2YgdGltZSB0aGFuDQogICAgICogdGhlIGdsb2JhbCB0\nZXN0IHRpbWVvdXQuDQogICAgICoNCiAgICAgKiBAYXV0aG9yIE1hcmMgUHJ1\nZCdob21tZWF1eA0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIGNsYXNz\nIFdhdGNoZG9nVGhyZWFkIGV4dGVuZHMgVGhyZWFkIHsNCg0KICAgICAgICBw\ncml2YXRlIGZpbmFsIGxvbmcgX3RpbWVvdXRtczsNCiAgICAgICAgcHJpdmF0\nZSBsb25nIF9lbmR0aW1lID0gLTE7DQogICAgICAgIHByaXZhdGUgQWJzdHJh\nY3RUZXN0Q2FzZSBfY3VydGVzdCA9IG51bGw7DQoNCiAgICAgICAgcHVibGlj\nIFdhdGNoZG9nVGhyZWFkKCkgew0KICAgICAgICAgICAgc3VwZXIoIktvZG8g\ndGVzdCBjYXNlIHdhdGNoZG9nIHRocmVhZCIpOw0KICAgICAgICAgICAgc2V0\nRGFlbW9uKHRydWUpOw0KDQogICAgICAgICAgICBpbnQgdGltZW91dE1pbiA9\nIG5ldyBJbnRlZ2VyDQogICAgICAgICAgICAgICAgKFN5c3RlbS5nZXRQcm9w\nZXJ0eSgiYXV0b2J1aWxkLnRlc3RjYXNlLnRpbWVvdXQiLCAiMjAiKSkNCiAg\nICAgICAgICAgICAgICAuaW50VmFsdWUoKTsNCg0KICAgICAgICAgICAgX3Rp\nbWVvdXRtcyA9IHRpbWVvdXRNaW4gKiA2MCAqIDEwMDA7DQogICAgICAgIH0N\nCg0KICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7DQogICAgICAgICAgICB3\naGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAg\nICAgICAgICAgICAgIHNsZWVwKDIwMCk7DQogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsNCiAgICAgICAgICAg\nICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoX2VuZHRpbWUgPiAwICYm\nIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpID4gX2VuZHRpbWUpIHsNCiAg\nICAgICAgICAgICAgICAgICAgVGhyZWFkIHByZVRpbWVvdXQgPSBuZXcgVGhy\nZWFkDQogICAgICAgICAgICAgICAgICAgICAgICAoIkF0dGVtcHRpbmcgcHJl\nLXRpbWVvdXQgZm9yICIgKyBfY3VydGVzdCkgew0KICAgICAgICAgICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgew0KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIF9jdXJ0ZXN0LnByZVRpbWVvdXQoKTsNCiAgICAgICAg\nICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfTsNCiAg\nICAgICAgICAgICAgICAgICAgcHJlVGltZW91dC5zdGFydCgpOw0KDQogICAg\nICAgICAgICAgICAgICAgIC8vIHdhaXQgYSBsaXR0bGUgd2hpbGUgZm9yIHRo\nZSBwcmUtdGltZW91dA0KICAgICAgICAgICAgICAgICAgICAvLyB0aHJlYWQg\ndG8gY29tcGxldGUNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAg\nICAgICAgICAgICAgICAgICAgIHByZVRpbWVvdXQuam9pbigxMCAqIDEwMDAp\nOw0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\new0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAg\nICAgLy8gZ2l2ZSBpdCBhIGZldyBtb3JlIHNlY29uZHMuLi4NCiAgICAgICAg\nICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNs\nZWVwKDUgKiAxMDAwKTsNCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAg\nICAgICAgICAgICAgICAgIC8vIG5ldyBlbmR0aW1lPyByZXN1bWUuLi4NCiAg\nICAgICAgICAgICAgICAgICAgaWYgKFN5c3RlbS5jdXJyZW50VGltZU1pbGxp\ncygpIDwgX2VuZHRpbWUpDQogICAgICAgICAgICAgICAgICAgICAgICBjb250\naW51ZTsNCg0KICAgICAgICAgICAgICAgICAgICBuZXcgRXhjZXB0aW9uKCJ0\nZXN0IGNhc2UgIg0KICAgICAgICAgICAgICAgICAgICAgICAgKyAoX2N1cnRl\nc3QgIT0gbnVsbCA/IF9jdXJ0ZXN0LmdldE5hbWUoKQ0KICAgICAgICAgICAg\nICAgICAgICAgICAgOiAiVU5LTk9XTiIpICsgIiB0aW1lZCBvdXQgYWZ0ZXIg\nIg0KICAgICAgICAgICAgICAgICAgICAgICAgKyBfdGltZW91dG1zICsgIm1z\nIikucHJpbnRTdGFja1RyYWNlKCk7DQoNCiAgICAgICAgICAgICAgICAgICAg\nLy8gYWxzbyBydW4gImtpbGxhbGwgLVFVSVQgamF2YSIgdG8gdHJ5IHRvIGdy\nYWINCiAgICAgICAgICAgICAgICAgICAgLy8gYSBzdGFjayB0cmFjZQ0KICAg\nICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAg\nICAgUnVudGltZS5nZXRSdW50aW1lKCkuZXhlYw0KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIChuZXcgU3RyaW5nW117ICJraWxsYWxsIiwgIi1RVUlU\nIiwgImphdmEiIH0pOw0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgew0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNsZWVwKDEwMDApOw0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgew0KICAgICAgICAgICAgICAgICAg\nICB9DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gbm93IGFjdHVhbGx5IGV4\naXQNCiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmV4aXQoMTExKTsNCiAg\nICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0K\nICAgICAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgZW50ZXJpbmdUZXN0\nKEFic3RyYWN0VGVzdENhc2UgdGVzdCkgew0KICAgICAgICAgICAgbG9uZyB0\naW1lb3V0ID0gdGVzdC5nZXRUaW1lb3V0KCk7DQogICAgICAgICAgICBpZiAo\ndGltZW91dCA8PSAwKQ0KICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBfdGlt\nZW91dG1zOw0KDQogICAgICAgICAgICBfZW5kdGltZSA9IFN5c3RlbS5jdXJy\nZW50VGltZU1pbGxpcygpICsgdGltZW91dDsNCiAgICAgICAgICAgIF9jdXJ0\nZXN0ID0gdGVzdDsNCg0KICAgICAgICAgICAgaWYgKCFpc0FsaXZlKCkpDQog\nICAgICAgICAgICAgICAgc3RhcnQoKTsNCiAgICAgICAgfQ0KDQogICAgICAg\nIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBsZWF2aW5nVGVzdChBYnN0cmFj\ndFRlc3RDYXNlIHRlc3QpIHsNCiAgICAgICAgICAgIF9lbmR0aW1lID0gLTE7\nDQogICAgICAgICAgICBfY3VydGVzdCA9IG51bGw7DQogICAgICAgIH0NCiAg\nICB9DQp9DQo=\n","encoding":"base64"}

