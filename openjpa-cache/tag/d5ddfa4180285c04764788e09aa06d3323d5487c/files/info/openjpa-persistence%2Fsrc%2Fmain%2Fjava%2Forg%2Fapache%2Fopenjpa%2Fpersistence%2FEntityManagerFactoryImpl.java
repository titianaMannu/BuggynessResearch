{"sha":"c668d7a61dac4451df24a6ae5377c6943c7593e8","node_id":"MDQ6QmxvYjIwNjM2NDpjNjY4ZDdhNjFkYWM0NDUxZGYyNGE2YWU1Mzc3YzY5NDNjNzU5M2U4","size":11484,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c668d7a61dac4451df24a6ae5377c6943c7593e8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5JbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS51dGls\nLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9y\ndCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5Qcm9w\nZXJ0aWVzOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkVudGl0eU1hbmFnZXJGYWN0b3J5OwoKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuQXV0b0RldGFjaDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuQnJva2VyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Ccm9rZXJGYWN0b3J5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5EZWxlZ2F0aW5nQnJva2Vy\nRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGVs\nZWdhdGluZ0ZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLlByb2R1Y3REZXJpdmF0\naW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5WYWx1\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ2xvc2Vh\nYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4\nY2VwdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIElt\ncGxlbWVudGF0aW9uIG9mIHtAbGluayBFbnRpdHlNYW5hZ2VyRmFjdG9yeX0g\ndGhhdCBhY3RzIGFzIGEKICogZmFjYWRlIHRvIGEge0BsaW5rIEJyb2tlckZh\nY3Rvcnl9LgogKgogKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21tZWF1eAogKiBA\nbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRW50aXR5TWFuYWdlckZhY3Rv\ncnlJbXBsCiAgICBpbXBsZW1lbnRzIE9wZW5KUEFFbnRpdHlNYW5hZ2VyRmFj\ndG9yeSwgT3BlbkpQQUVudGl0eU1hbmFnZXJGYWN0b3J5U1BJLAogICAgQ2xv\nc2VhYmxlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIg\nX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEVudGl0eU1h\nbmFnZXJGYWN0b3J5SW1wbC5jbGFzcyk7CgogICAgcHJpdmF0ZSBEZWxlZ2F0\naW5nQnJva2VyRmFjdG9yeSBfZmFjdG9yeSA9IG51bGw7CiAgICBwcml2YXRl\nIHRyYW5zaWVudCBDb25zdHJ1Y3RvcjxGZXRjaFBsYW4+IF9wbGFuID0gbnVs\nbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IFN0b3JlQ2FjaGUgX2NhY2hlID0g\nbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IFF1ZXJ5UmVzdWx0Q2FjaGUg\nX3F1ZXJ5Q2FjaGUgPSBudWxsOwoKICAgIC8qKgogICAgICogRGVmYXVsdCBj\nb25zdHJ1Y3RvciBwcm92aWRlZCBmb3IgYXV0by1pbnN0YW50aWF0aW9uLgog\nICAgICovCiAgICBwdWJsaWMgRW50aXR5TWFuYWdlckZhY3RvcnlJbXBsKCkg\newogICAgfQoKICAgIC8qKgogICAgICogU3VwcGx5IGRlbGVnYXRlIG9uIGNv\nbnN0cnVjdGlvbi4KICAgICAqLwogICAgcHVibGljIEVudGl0eU1hbmFnZXJG\nYWN0b3J5SW1wbChCcm9rZXJGYWN0b3J5IGZhY3RvcnkpIHsKICAgICAgICBz\nZXRCcm9rZXJGYWN0b3J5KGZhY3RvcnkpOwogICAgfQoKICAgIC8qKgogICAg\nICogRGVsZWdhdGUuCiAgICAgKi8KICAgIHB1YmxpYyBCcm9rZXJGYWN0b3J5\nIGdldEJyb2tlckZhY3RvcnkoKSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5\nLmdldERlbGVnYXRlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0\nZSBtdXN0IGJlIHByb3ZpZGVkIGJlZm9yZSB1c2UuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEJyb2tlckZhY3RvcnkoQnJva2VyRmFjdG9yeSBmYWN0\nb3J5KSB7CiAgICAgICAgX2ZhY3RvcnkgPSBuZXcgRGVsZWdhdGluZ0Jyb2tl\nckZhY3RvcnkoZmFjdG9yeSwKICAgICAgICAgICAgUGVyc2lzdGVuY2VFeGNl\ncHRpb25zLlRSQU5TTEFUT1IpOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBB\nQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJl\ndHVybiBfZmFjdG9yeS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICB9CgogICAg\ncHVibGljIFByb3BlcnRpZXMgZ2V0UHJvcGVydGllcygpIHsKICAgICAgICBy\nZXR1cm4gX2ZhY3RvcnkuZ2V0UHJvcGVydGllcygpOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgcHV0VXNlck9iamVjdChPYmplY3Qga2V5LCBPYmplY3Qg\ndmFsKSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5LnB1dFVzZXJPYmplY3Qo\na2V5LCB2YWwpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0VXNlck9i\namVjdChPYmplY3Qga2V5KSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5Lmdl\ndFVzZXJPYmplY3Qoa2V5KTsKICAgIH0KCiAgICBwdWJsaWMgU3RvcmVDYWNo\nZSBnZXRTdG9yZUNhY2hlKCkgewogICAgICAgIF9mYWN0b3J5LmxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX2NhY2hlID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYg\nPSBfZmFjdG9yeS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgICAg\nICBfY2FjaGUgPSBuZXcgU3RvcmVDYWNoZUltcGwodGhpcywKICAgICAgICAg\nICAgICAgICAgICBjb25mLmdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgp\nLmdldFN5c3RlbURhdGFDYWNoZSgpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gX2NhY2hlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIF9mYWN0b3J5LnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgU3RvcmVDYWNoZSBnZXRTdG9yZUNhY2hlKFN0cmluZyBjYWNo\nZU5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFN0b3JlQ2FjaGVJbXBsKHRo\naXMsIF9mYWN0b3J5LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAg\nZ2V0RGF0YUNhY2hlTWFuYWdlckluc3RhbmNlKCkuZ2V0RGF0YUNhY2hlKGNh\nY2hlTmFtZSwgdHJ1ZSkpOwogICAgfQoKICAgIHB1YmxpYyBRdWVyeVJlc3Vs\ndENhY2hlIGdldFF1ZXJ5UmVzdWx0Q2FjaGUoKSB7CiAgICAgICAgX2ZhY3Rv\ncnkubG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfcXVl\ncnlDYWNoZSA9PSBudWxsKQogICAgICAgICAgICAgICAgX3F1ZXJ5Q2FjaGUg\nPSBuZXcgUXVlcnlSZXN1bHRDYWNoZUltcGwoX2ZhY3RvcnkuCiAgICAgICAg\nICAgICAgICAgICAgZ2V0Q29uZmlndXJhdGlvbigpLmdldERhdGFDYWNoZU1h\nbmFnZXJJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgICAgIGdldFN5c3Rl\nbVF1ZXJ5Q2FjaGUoKSk7CiAgICAgICAgICAgIHJldHVybiBfcXVlcnlDYWNo\nZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfZmFjdG9yeS51\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFF\nbnRpdHlNYW5hZ2VyU1BJIGNyZWF0ZUVudGl0eU1hbmFnZXIoKSB7CiAgICAg\nICAgcmV0dXJuIGNyZWF0ZUVudGl0eU1hbmFnZXIobnVsbCk7CiAgICB9Cgog\nICAgcHVibGljIE9wZW5KUEFFbnRpdHlNYW5hZ2VyU1BJIGNyZWF0ZUVudGl0\neU1hbmFnZXIoTWFwIHByb3BzKSB7CiAgICAgICAgaWYgKHByb3BzID09IG51\nbGwpCiAgICAgICAgICAgIHByb3BzID0gQ29sbGVjdGlvbnMuRU1QVFlfTUFQ\nOwogICAgICAgIGVsc2UgaWYgKCFwcm9wcy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHByb3BzID0gbmV3IEhhc2hNYXAocHJvcHMpOwoKICAgICAgICBPcGVu\nSlBBQ29uZmlndXJhdGlvbiBjb25mID0gZ2V0Q29uZmlndXJhdGlvbigpOwog\nICAgICAgIFN0cmluZyB1c2VyID0gKFN0cmluZykgQ29uZmlndXJhdGlvbnMu\ncmVtb3ZlUHJvcGVydHkKICAgICAgICAgICAgKCJDb25uZWN0aW9uVXNlck5h\nbWUiLCBwcm9wcyk7CiAgICAgICAgaWYgKHVzZXIgPT0gbnVsbCkKICAgICAg\nICAgICAgdXNlciA9IGNvbmYuZ2V0Q29ubmVjdGlvblVzZXJOYW1lKCk7CiAg\nICAgICAgU3RyaW5nIHBhc3MgPSAoU3RyaW5nKSBDb25maWd1cmF0aW9ucy5y\nZW1vdmVQcm9wZXJ0eQogICAgICAgICAgICAoIkNvbm5lY3Rpb25QYXNzd29y\nZCIsIHByb3BzKTsKICAgICAgICBpZiAocGFzcyA9PSBudWxsKQogICAgICAg\nICAgICBwYXNzID0gY29uZi5nZXRDb25uZWN0aW9uUGFzc3dvcmQoKTsKCiAg\nICAgICAgU3RyaW5nIHN0ciA9IChTdHJpbmcpIENvbmZpZ3VyYXRpb25zLnJl\nbW92ZVByb3BlcnR5CiAgICAgICAgICAgICgiVHJhbnNhY3Rpb25Nb2RlIiwg\ncHJvcHMpOwogICAgICAgIGJvb2xlYW4gbWFuYWdlZDsKICAgICAgICBpZiAo\nc3RyID09IG51bGwpCiAgICAgICAgICAgIG1hbmFnZWQgPSBjb25mLmlzVHJh\nbnNhY3Rpb25Nb2RlTWFuYWdlZCgpOwogICAgICAgIGVsc2UgewogICAgICAg\nICAgICBWYWx1ZSB2YWwgPSBjb25mLmdldFZhbHVlKCJUcmFuc2FjdGlvbk1v\nZGUiKTsKICAgICAgICAgICAgbWFuYWdlZCA9IEJvb2xlYW4ucGFyc2VCb29s\nZWFuKHZhbC51bmFsaWFzKHN0cikpOwogICAgICAgIH0KCiAgICAgICAgT2Jq\nZWN0IG9iaiA9IENvbmZpZ3VyYXRpb25zLnJlbW92ZVByb3BlcnR5KCJDb25u\nZWN0aW9uUmV0YWluTW9kZSIsIAogICAgICAgICAgICBwcm9wcyk7CiAgICAg\nICAgaW50IHJldGFpbk1vZGU7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9m\nIE51bWJlcikKICAgICAgICAgICAgcmV0YWluTW9kZSA9ICgoTnVtYmVyKSBv\nYmopLmludFZhbHVlKCk7CiAgICAgICAgZWxzZSBpZiAob2JqID09IG51bGwp\nCiAgICAgICAgICAgIHJldGFpbk1vZGUgPSBjb25mLmdldENvbm5lY3Rpb25S\nZXRhaW5Nb2RlQ29uc3RhbnQoKTsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgVmFsdWUgdmFsID0gY29uZi5nZXRWYWx1ZSgiQ29ubmVjdGlvblJldGFp\nbk1vZGUiKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJl\ndGFpbk1vZGUgPSBJbnRlZ2VyLnBhcnNlSW50KHZhbC51bmFsaWFzKChTdHJp\nbmcpIG9iaikpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9u\nKF9sb2MuZ2V0KCJiYWQtZW0tcHJvcCIsCiAgICAgICAgICAgICAgICAgICAg\nIm9wZW5qcGEuQ29ubmVjdGlvblJldGFpbk1vZGUiLCBvYmopLAogICAgICAg\nICAgICAgICAgICAgIG5ldyBUaHJvd2FibGVbXXsgZSB9LCBvYmosIHRydWUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBCcm9rZXIgYnJv\na2VyID0gX2ZhY3RvcnkubmV3QnJva2VyKHVzZXIsIHBhc3MsIG1hbmFnZWQs\nIHJldGFpbk1vZGUsCiAgICAgICAgICAgIGZhbHNlKTsKICAgICAgICAgICAg\nCiAgICAgICAgLy8gYWRkIGF1dG9kZXRhY2ggZm9yIGNsb3NlIGFuZCByb2xs\nYmFjayBjb25kaXRpb25zIHRvIHRoZSBjb25maWd1cmF0aW9uCiAgICAgICAg\nYnJva2VyLnNldEF1dG9EZXRhY2goQXV0b0RldGFjaC5ERVRBQ0hfQ0xPU0Us\nIHRydWUpOwogICAgICAgIGJyb2tlci5zZXRBdXRvRGV0YWNoKEF1dG9EZXRh\nY2guREVUQUNIX1JPTExCQUNLLCB0cnVlKTsKICAgICAgICAKICAgICAgICBi\ncm9rZXIuc2V0RGV0YWNoZWROZXcoZmFsc2UpOwogICAgICAgIE9wZW5KUEFF\nbnRpdHlNYW5hZ2VyU1BJIGVtID0gbmV3RW50aXR5TWFuYWdlckltcGwoYnJv\na2VyKTsKCiAgICAgICAgLy8gYWxsb3cgc2V0dGluZyBvZiBvdGhlciBiZWFu\nIHByb3BlcnRpZXMgb2YgRU0KICAgICAgICBTdHJpbmdbXSBwcmVmaXhlcyA9\nIFByb2R1Y3REZXJpdmF0aW9ucy5nZXRDb25maWd1cmF0aW9uUHJlZml4ZXMo\nKTsKICAgICAgICBMaXN0PFJ1bnRpbWVFeGNlcHRpb24+IGVycnMgPSBudWxs\nOwogICAgICAgIE1ldGhvZCBzZXR0ZXI7CiAgICAgICAgU3RyaW5nIHByb3As\nIHByZWZpeDsKICAgICAgICBPYmplY3QgdmFsOwogICAgICAgIGZvciAoTWFw\nLkVudHJ5IGVudHJ5IDogKFNldDxNYXAuRW50cnk+KSBwcm9wcy5lbnRyeVNl\ndCgpKSB7CiAgICAgICAgICAgIHByb3AgPSAoU3RyaW5nKSBlbnRyeS5nZXRL\nZXkoKTsKICAgICAgICAgICAgcHJlZml4ID0gbnVsbDsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBwcmVmaXhlcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgcHJlZml4ID0gcHJlZml4ZXNbaV0gKyAiLiI7CiAg\nICAgICAgICAgICAgICBpZiAocHJvcC5zdGFydHNXaXRoKHByZWZpeCkpCiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBwcmVm\naXggPSBudWxsOyAKICAgICAgICAgICAgfSAKICAgICAgICAgICAgaWYgKHBy\nZWZpeCA9PSBudWxsKQogICAgICAgICAgICAgICAgY29udGludWU7IAogICAg\nICAgICAgICBwcm9wID0gcHJvcC5zdWJzdHJpbmcocHJlZml4Lmxlbmd0aCgp\nKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHNldHRlciA9\nIFJlZmxlY3Rpb24uZmluZFNldHRlcihlbS5nZXRDbGFzcygpLCBwcm9wLCB0\ncnVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICAgICAgaWYgKGVycnMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBlcnJzID0gbmV3IExpbmtlZExpc3Q8UnVudGltZUV4\nY2VwdGlvbj4oKTsKICAgICAgICAgICAgICAgIGVycnMuYWRkKFBlcnNpc3Rl\nbmNlRXhjZXB0aW9ucy50b1BlcnNpc3RlbmNlRXhjZXB0aW9uKGtlKSk7CiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgdmFsID0gZW50cnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIm51bGwiLmVxdWFscyh2YWwp\nKQogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBudWxsOwogICAgICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdmFs\nID0gU3RyaW5ncy5wYXJzZSgoU3RyaW5nKSB2YWwsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBzZXR0ZXIuZ2V0UGFyYW1ldGVyVHlwZXMoKVswXSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBSZWZsZWN0aW9u\nLnNldChlbSwgc2V0dGVyLCB2YWwpOwogICAgICAgICAgICB9IGNhdGNoIChU\naHJvd2FibGUgdCkgewogICAgICAgICAgICAgICAgd2hpbGUgKHQuZ2V0Q2F1\nc2UoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHQgPSB0LmdldENh\ndXNlKCk7CiAgICAgICAgICAgICAgICBBcmd1bWVudEV4Y2VwdGlvbiBlcnIg\nPSBuZXcgQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAg\nICAgICAgICAoImJhZC1lbS1wcm9wIiwgcHJvcCwgZW50cnkuZ2V0VmFsdWUo\nKSksCiAgICAgICAgICAgICAgICAgICAgbmV3IFRocm93YWJsZVtdeyB0IH0s\nIG51bGwsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGVycnMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBlcnJzID0gbmV3IExpbmtlZExpc3Q8\nUnVudGltZUV4Y2VwdGlvbj4oKTsKICAgICAgICAgICAgICAgIGVycnMuYWRk\nKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChl\ncnJzICE9IG51bGwpIHsKICAgICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAg\nICAgICAgaWYgKGVycnMuc2l6ZSgpID09IDEpCiAgICAgICAgICAgICAgICB0\naHJvdyBlcnJzLmdldCgwKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3Vt\nZW50RXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZW0tcHJvcHMiKSwKICAgICAg\nICAgICAgICAgIGVycnMudG9BcnJheShuZXcgVGhyb3dhYmxlW2VycnMuc2l6\nZSgpXSksCiAgICAgICAgICAgICAgICBudWxsLCB0cnVlKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGVtOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgbmV3IGVudGl0eSBtYW5hZ2VyIGFyb3VuZCB0aGUgZ2l2ZW4gYnJv\na2VyLgogICAgICovCiAgICBwcm90ZWN0ZWQgRW50aXR5TWFuYWdlckltcGwg\nbmV3RW50aXR5TWFuYWdlckltcGwoQnJva2VyIGJyb2tlcikgewogICAgICAg\nIHJldHVybiBuZXcgRW50aXR5TWFuYWdlckltcGwodGhpcywgYnJva2VyKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRMaWZlY3ljbGVMaXN0ZW5lcihP\nYmplY3QgbGlzdGVuZXIsIENsYXNzLi4uIGNsYXNzZXMpIHsKICAgICAgICBf\nZmFjdG9yeS5hZGRMaWZlY3ljbGVMaXN0ZW5lcihsaXN0ZW5lciwgY2xhc3Nl\ncyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVtb3ZlTGlmZWN5Y2xlTGlz\ndGVuZXIoT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAgICAgX2ZhY3RvcnkucmVt\nb3ZlTGlmZWN5Y2xlTGlzdGVuZXIobGlzdGVuZXIpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGFkZFRyYW5zYWN0aW9uTGlzdGVuZXIoT2JqZWN0IGxpc3Rl\nbmVyKSB7CiAgICAgICAgX2ZhY3RvcnkuYWRkVHJhbnNhY3Rpb25MaXN0ZW5l\ncihsaXN0ZW5lcik7CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVtb3ZlVHJh\nbnNhY3Rpb25MaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsKICAgICAgICBf\nZmFjdG9yeS5yZW1vdmVUcmFuc2FjdGlvbkxpc3RlbmVyKGxpc3RlbmVyKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICBfZmFj\ndG9yeS5jbG9zZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzT3Bl\nbigpIHsKICAgICAgICByZXR1cm4gIV9mYWN0b3J5LmlzQ2xvc2VkKCk7CiAg\nICB9CgogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICByZXR1\ncm4gX2ZhY3RvcnkuaGFzaENvZGUoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVy\nID09IHRoaXMpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlm\nICghKG90aGVyIGluc3RhbmNlb2YgRW50aXR5TWFuYWdlckZhY3RvcnlJbXBs\nKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBf\nZmFjdG9yeS5lcXVhbHMoKChFbnRpdHlNYW5hZ2VyRmFjdG9yeUltcGwpIG90\naGVyKS5fZmFjdG9yeSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\nYSBzdG9yZS1zcGVjaWZpYyBmYWNhZGUgZm9yIHRoZSBnaXZlbiBmZXRjaCBj\nb25maWd1cmF0aW9uLgoJICogSWYgbm8gZmFjYWRlIGNsYXNzIGV4aXN0cywg\nd2UgdXNlIHRoZSBkZWZhdWx0IHtAbGluayBGZXRjaFBsYW59LgogICAgICov\nCiAgICBGZXRjaFBsYW4gdG9GZXRjaFBsYW4oQnJva2VyIGJyb2tlciwgRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKGZldGNoID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBpZiAo\nZmV0Y2ggaW5zdGFuY2VvZiBEZWxlZ2F0aW5nRmV0Y2hDb25maWd1cmF0aW9u\nKQogICAgICAgICAgICBmZXRjaCA9ICgoRGVsZWdhdGluZ0ZldGNoQ29uZmln\ndXJhdGlvbikgZmV0Y2gpLgogICAgICAgICAgICAgICAgZ2V0SW5uZXJtb3N0\nRGVsZWdhdGUoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9w\nbGFuID09IG51bGwpIHsKICAgICAgICAgICAgICAgIENsYXNzIHN0b3JlVHlw\nZSA9IChicm9rZXIgPT0gbnVsbCkgPyBudWxsIDogYnJva2VyLgogICAgICAg\nICAgICAgICAgICAgIGdldFN0b3JlTWFuYWdlcigpLmdldElubmVybW9zdERl\nbGVnYXRlKCkuZ2V0Q2xhc3MoKTsKICAgICAgICAgICAgICAgIENsYXNzIGNs\ncyA9IF9mYWN0b3J5LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAg\nICAgICAgICBnZXRTdG9yZUZhY2FkZVR5cGVSZWdpc3RyeSgpLgogICAgICAg\nICAgICAgICAgICAgIGdldEltcGxlbWVudGF0aW9uKEZldGNoUGxhbi5jbGFz\ncywgc3RvcmVUeXBlLCAKICAgICAgICAgICAgICAgICAgICAJCUZldGNoUGxh\nbkltcGwuY2xhc3MpOwogICAgICAgICAgICAgICAgX3BsYW4gPSBjbHMuZ2V0\nQ29uc3RydWN0b3IoRmV0Y2hDb25maWd1cmF0aW9uLmNsYXNzKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gX3BsYW4ubmV3SW5zdGFuY2Uo\nZmV0Y2gpOwogICAgICAgIH0gY2F0Y2ggKEludm9jYXRpb25UYXJnZXRFeGNl\ncHRpb24gaXRlKSB7CiAgICAgICAgICAgIHRocm93IFBlcnNpc3RlbmNlRXhj\nZXB0aW9ucy50b1BlcnNpc3RlbmNlRXhjZXB0aW9uCiAgICAgICAgICAgICAg\nICAoaXRlLmdldFRhcmdldEV4Y2VwdGlvbigpKTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBQZXJzaXN0ZW5j\nZUV4Y2VwdGlvbnMudG9QZXJzaXN0ZW5jZUV4Y2VwdGlvbihlKTsKICAgICAg\nICB9Cgl9Cn0K\n","encoding":"base64"}

