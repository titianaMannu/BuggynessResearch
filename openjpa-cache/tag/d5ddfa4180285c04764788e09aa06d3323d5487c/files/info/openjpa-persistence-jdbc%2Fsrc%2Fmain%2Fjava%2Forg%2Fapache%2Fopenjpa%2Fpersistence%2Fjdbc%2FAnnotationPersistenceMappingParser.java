{"sha":"757a29a0662aec8027c64d1080f394159c417631","node_id":"MDQ6QmxvYjIwNjM2NDo3NTdhMjlhMDY2MmFlYzgwMjdjNjRkMTA4MGYzOTQxNTljNDE3NjMx","size":63610,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/757a29a0662aec8027c64d1080f394159c417631","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYzsK\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1\ncml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2\nYS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuQXNzb2NpYXRpb25PdmVycmlkZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLkFzc29jaWF0aW9uT3ZlcnJpZGVzOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuQXR0cmlidXRlT3ZlcnJpZGU7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5BdHRyaWJ1dGVPdmVycmlkZXM7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW5SZXN1bHQ7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5EaXNjcmltaW5hdG9yQ29sdW1uOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuRGlzY3JpbWluYXRvclZhbHVlOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuRW50aXR5UmVzdWx0OwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuRW51bVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbnVt\nZXJhdGVkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRmllbGRSZXN1bHQ7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Jbmhlcml0YW5jZTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLkpvaW5Db2x1bW47CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5Kb2luQ29sdW1uczsKaW1wb3J0IGphdmF4LnBlcnNpc3Rl\nbmNlLkpvaW5UYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByaW1h\ncnlLZXlKb2luQ29sdW1uOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJp\nbWFyeUtleUpvaW5Db2x1bW5zOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nU2Vjb25kYXJ5VGFibGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TZWNv\nbmRhcnlUYWJsZXM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TcWxSZXN1\nbHRTZXRNYXBwaW5nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuU3FsUmVz\ndWx0U2V0TWFwcGluZ3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5UYWJs\nZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlRhYmxlR2VuZXJhdG9yOwpp\nbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuVGVtcG9yYWw7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5VbmlxdWVDb25zdHJhaW50OwoKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5FYWdlckZldGNo\nTW9kZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNs\nYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuQ2xhc3NNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5NYXBwaW5nSW5mbzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuTWFwcGluZ1JlcG9zaXRvcnk7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlF1ZXJ5UmVz\ndWx0TWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuU2VxdWVuY2VNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFwcGluZ0luZm87CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5FbnVtVmFsdWVIYW5k\nbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuRmxhdENsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5GdWxsQ2xhc3NTdHJhdGVneTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlZlcnRpY2Fs\nQ2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5KMkRvUHJpdjVIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEucGVyc2lzdGVuY2UuQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQ\nYXJzZXI7CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNp\nc3RlbmNlLmpkYmMuTWFwcGluZ1RhZy4qOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsK\nCi8qKgogKiBQZXJzaXN0ZW5jZSBhbm5vdGF0aW9uIG1hcHBpbmcgcGFyc2Vy\nLgogKgogKiBAYXV0aG9yIFBpbmFraSBQb2RkYXIKICogQGF1dGhvciBTdGV2\nZSBLaW0KICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIEFubm90YXRpb25QZXJzaXN0ZW5jZU1hcHBpbmdQYXJz\nZXIKICAgIGV4dGVuZHMgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQ\nYXJzZXIgewoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFRSVUUg\nPSAxOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRkFMU0UgPSAy\nOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0g\nTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQW5ub3RhdGlvblBlcnNp\nc3RlbmNlTWFwcGluZ1BhcnNlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTWFwPENsYXNzLCBNYXBwaW5nVGFnPiBfdGFncyA9CiAgICAg\nICAgbmV3IEhhc2hNYXA8Q2xhc3MsIE1hcHBpbmdUYWc+KCk7CgogICAgc3Rh\ndGljIHsKICAgICAgICBfdGFncy5wdXQoQXNzb2NpYXRpb25PdmVycmlkZS5j\nbGFzcywgQVNTT0NfT1ZFUlJJREUpOwogICAgICAgIF90YWdzLnB1dChBc3Nv\nY2lhdGlvbk92ZXJyaWRlcy5jbGFzcywgQVNTT0NfT1ZFUlJJREVTKTsKICAg\nICAgICBfdGFncy5wdXQoQXR0cmlidXRlT3ZlcnJpZGUuY2xhc3MsIEFUVFJf\nT1ZFUlJJREUpOwogICAgICAgIF90YWdzLnB1dChBdHRyaWJ1dGVPdmVycmlk\nZXMuY2xhc3MsIEFUVFJfT1ZFUlJJREVTKTsKICAgICAgICBfdGFncy5wdXQo\namF2YXgucGVyc2lzdGVuY2UuQ29sdW1uLmNsYXNzLCBDT0wpOwogICAgICAg\nIF90YWdzLnB1dChDb2x1bW5SZXN1bHQuY2xhc3MsIENPTFVNTl9SRVNVTFQp\nOwogICAgICAgIF90YWdzLnB1dChEaXNjcmltaW5hdG9yQ29sdW1uLmNsYXNz\nLCBESVNDUklNX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KERpc2NyaW1pbmF0\nb3JWYWx1ZS5jbGFzcywgRElTQ1JJTV9WQUwpOwogICAgICAgIF90YWdzLnB1\ndChFbGVtZW50Q29sdW1uLmNsYXNzLCBFTEVNX0NPTCk7CiAgICAgICAgX3Rh\nZ3MucHV0KEVsZW1lbnRDb2x1bW5zLmNsYXNzLCBFTEVNX0NPTFMpOwogICAg\nICAgIF90YWdzLnB1dChFbGVtZW50RW1iZWRkZWRNYXBwaW5nLmNsYXNzLCBF\nTEVNX0VNQkVEREVEX01BUFBJTkcpOwogICAgICAgIF90YWdzLnB1dChFbGVt\nZW50U3RyYXRlZ3kuY2xhc3MsIEVMRU1fU1RSQVQpOwogICAgICAgIF90YWdz\nLnB1dChFbnRpdHlSZXN1bHQuY2xhc3MsIEVOVElUWV9SRVNVTFQpOwogICAg\nICAgIF90YWdzLnB1dChFbnVtZXJhdGVkLmNsYXNzLCBFTlVNRVJBVEVEKTsK\nICAgICAgICBfdGFncy5wdXQoRmllbGRSZXN1bHQuY2xhc3MsIEZJRUxEX1JF\nU1VMVCk7CiAgICAgICAgX3RhZ3MucHV0KEluaGVyaXRhbmNlLmNsYXNzLCBJ\nTkhFUklUQU5DRSk7CiAgICAgICAgX3RhZ3MucHV0KEpvaW5Db2x1bW4uY2xh\nc3MsIEpPSU5fQ09MKTsKICAgICAgICBfdGFncy5wdXQoSm9pbkNvbHVtbnMu\nY2xhc3MsIEpPSU5fQ09MUyk7CiAgICAgICAgX3RhZ3MucHV0KEpvaW5UYWJs\nZS5jbGFzcywgSk9JTl9UQUJMRSk7CiAgICAgICAgX3RhZ3MucHV0KEtleUNv\nbHVtbi5jbGFzcywgS0VZX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KEtleUNv\nbHVtbnMuY2xhc3MsIEtFWV9DT0xTKTsKICAgICAgICBfdGFncy5wdXQoS2V5\nQ2xhc3NDcml0ZXJpYS5jbGFzcywgS0VZX0NMQVNTX0NSSVQpOwogICAgICAg\nIF90YWdzLnB1dChLZXlFbWJlZGRlZE1hcHBpbmcuY2xhc3MsIEtFWV9FTUJF\nRERFRF9NQVBQSU5HKTsKICAgICAgICBfdGFncy5wdXQoS2V5Rm9yZWlnbktl\neS5jbGFzcywgS0VZX0ZLKTsKICAgICAgICBfdGFncy5wdXQoS2V5SW5kZXgu\nY2xhc3MsIEtFWV9JTkRFWCk7CiAgICAgICAgX3RhZ3MucHV0KEtleUpvaW5D\nb2x1bW4uY2xhc3MsIEtFWV9KT0lOX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0\nKEtleUpvaW5Db2x1bW5zLmNsYXNzLCBLRVlfSk9JTl9DT0xTKTsKICAgICAg\nICBfdGFncy5wdXQoS2V5Tm9ucG9seW1vcnBoaWMuY2xhc3MsIEtFWV9OT05Q\nT0xZKTsKICAgICAgICBfdGFncy5wdXQoS2V5U3RyYXRlZ3kuY2xhc3MsIEtF\nWV9TVFJBVCk7CiAgICAgICAgX3RhZ3MucHV0KFByaW1hcnlLZXlKb2luQ29s\ndW1uLmNsYXNzLCBQS19KT0lOX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KFBy\naW1hcnlLZXlKb2luQ29sdW1ucy5jbGFzcywgUEtfSk9JTl9DT0xTKTsKICAg\nICAgICBfdGFncy5wdXQoU2Vjb25kYXJ5VGFibGUuY2xhc3MsIFNFQ09OREFS\nWV9UQUJMRSk7CiAgICAgICAgX3RhZ3MucHV0KFNlY29uZGFyeVRhYmxlcy5j\nbGFzcywgU0VDT05EQVJZX1RBQkxFUyk7CiAgICAgICAgX3RhZ3MucHV0KFNx\nbFJlc3VsdFNldE1hcHBpbmcuY2xhc3MsIFNRTF9SRVNVTFRfU0VUX01BUFBJ\nTkcpOwogICAgICAgIF90YWdzLnB1dChTcWxSZXN1bHRTZXRNYXBwaW5ncy5j\nbGFzcywgU1FMX1JFU1VMVF9TRVRfTUFQUElOR1MpOwogICAgICAgIF90YWdz\nLnB1dChUYWJsZS5jbGFzcywgVEFCTEUpOwogICAgICAgIF90YWdzLnB1dChU\nZW1wb3JhbC5jbGFzcywgVEVNUE9SQUwpOwogICAgICAgIF90YWdzLnB1dChU\nYWJsZUdlbmVyYXRvci5jbGFzcywgVEFCTEVfR0VOKTsKICAgICAgICBfdGFn\ncy5wdXQoQ2xhc3NDcml0ZXJpYS5jbGFzcywgQ0xBU1NfQ1JJVCk7CiAgICAg\nICAgX3RhZ3MucHV0KENvbHVtbnMuY2xhc3MsIENPTFMpOwogICAgICAgIF90\nYWdzLnB1dChDb250YWluZXJUYWJsZS5jbGFzcywgQ09OVEFJTkVSX1RBQkxF\nKTsKICAgICAgICBfdGFncy5wdXQoRGF0YVN0b3JlSWRDb2x1bW4uY2xhc3Ms\nIERBVEFTVE9SRV9JRF9DT0wpOwogICAgICAgIF90YWdzLnB1dChEaXNjcmlt\naW5hdG9yU3RyYXRlZ3kuY2xhc3MsIERJU0NSSU1fU1RSQVQpOwogICAgICAg\nIF90YWdzLnB1dChFYWdlckZldGNoTW9kZS5jbGFzcywgRUFHRVJfRkVUQ0hf\nTU9ERSk7CiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnRDbGFzc0NyaXRlcmlh\nLmNsYXNzLCBFTEVNX0NMQVNTX0NSSVQpOwogICAgICAgIF90YWdzLnB1dChF\nbGVtZW50Rm9yZWlnbktleS5jbGFzcywgRUxFTV9GSyk7CiAgICAgICAgX3Rh\nZ3MucHV0KEVsZW1lbnRJbmRleC5jbGFzcywgRUxFTV9JTkRFWCk7CiAgICAg\nICAgX3RhZ3MucHV0KEVsZW1lbnRKb2luQ29sdW1uLmNsYXNzLCBFTEVNX0pP\nSU5fQ09MKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudEpvaW5Db2x1bW5z\nLmNsYXNzLCBFTEVNX0pPSU5fQ09MUyk7CiAgICAgICAgX3RhZ3MucHV0KEVs\nZW1lbnROb25wb2x5bW9ycGhpYy5jbGFzcywgRUxFTV9OT05QT0xZKTsKICAg\nICAgICBfdGFncy5wdXQoRW1iZWRkZWRNYXBwaW5nLmNsYXNzLCBFTUJFRERF\nRF9NQVBQSU5HKTsKICAgICAgICBfdGFncy5wdXQoRm9yZWlnbktleS5jbGFz\ncywgRkspOwogICAgICAgIF90YWdzLnB1dChJbmRleC5jbGFzcywgSU5ERVgp\nOwogICAgICAgIF90YWdzLnB1dChNYXBwaW5nT3ZlcnJpZGUuY2xhc3MsIE1B\nUFBJTkdfT1ZFUlJJREUpOwogICAgICAgIF90YWdzLnB1dChNYXBwaW5nT3Zl\ncnJpZGVzLmNsYXNzLCBNQVBQSU5HX09WRVJSSURFUyk7CiAgICAgICAgX3Rh\nZ3MucHV0KE5vbnBvbHltb3JwaGljLmNsYXNzLCBOT05QT0xZKTsKICAgICAg\nICBfdGFncy5wdXQoT3JkZXJDb2x1bW4uY2xhc3MsIE9SREVSX0NPTCk7CiAg\nICAgICAgX3RhZ3MucHV0KFN0cmF0ZWd5LmNsYXNzLCBTVFJBVCk7CiAgICAg\nICAgX3RhZ3MucHV0KFN1YmNsYXNzRmV0Y2hNb2RlLmNsYXNzLCBTVUJDTEFT\nU19GRVRDSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQoVW5pcXVlLmNsYXNz\nLCBVTklRVUUpOwogICAgICAgIF90YWdzLnB1dChWZXJzaW9uQ29sdW1uLmNs\nYXNzLCBWRVJTSU9OX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KFZlcnNpb25D\nb2x1bW5zLmNsYXNzLCBWRVJTSU9OX0NPTFMpOwogICAgICAgIF90YWdzLnB1\ndChWZXJzaW9uU3RyYXRlZ3kuY2xhc3MsIFZFUlNJT05fU1RSQVQpOwogICAg\nICAgIF90YWdzLnB1dChYRW1iZWRkZWRNYXBwaW5nLmNsYXNzLCBYX0VNQkVE\nREVEX01BUFBJTkcpOwogICAgICAgIF90YWdzLnB1dChYSm9pbkNvbHVtbi5j\nbGFzcywgWF9KT0lOX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KFhKb2luQ29s\ndW1ucy5jbGFzcywgWF9KT0lOX0NPTFMpOwogICAgICAgIF90YWdzLnB1dChY\nTWFwcGluZ092ZXJyaWRlLmNsYXNzLCBYX01BUFBJTkdfT1ZFUlJJREUpOwog\nICAgICAgIF90YWdzLnB1dChYTWFwcGluZ092ZXJyaWRlcy5jbGFzcywgWF9N\nQVBQSU5HX09WRVJSSURFUyk7CiAgICAgICAgX3RhZ3MucHV0KFhTZWNvbmRh\ncnlUYWJsZS5jbGFzcywgWF9TRUNPTkRBUllfVEFCTEUpOwogICAgICAgIF90\nYWdzLnB1dChYU2Vjb25kYXJ5VGFibGVzLmNsYXNzLCBYX1NFQ09OREFSWV9U\nQUJMRVMpOwogICAgICAgIF90YWdzLnB1dChYVGFibGUuY2xhc3MsIFhfVEFC\nTEUpOwogICAgfQoKICAgIHB1YmxpYyBBbm5vdGF0aW9uUGVyc2lzdGVuY2VN\nYXBwaW5nUGFyc2VyKEpEQkNDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAg\nICBzdXBlcihjb25mKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3Rl\nY3RlZCB2b2lkIHBhcnNlUGFja2FnZU1hcHBpbmdBbm5vdGF0aW9ucyhQYWNr\nYWdlIHBrZykgewogICAgICAgIE1hcHBpbmdUYWcgdGFnOwogICAgICAgIGZv\nciAoQW5ub3RhdGlvbiBhbm5vIDogcGtnLmdldERlY2xhcmVkQW5ub3RhdGlv\nbnMoKSkgewogICAgICAgICAgICB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5v\ndGF0aW9uVHlwZSgpKTsKICAgICAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBoYW5kbGVVbmtub3duUGFja2FnZU1hcHBpbmdB\nbm5vdGF0aW9uKHBrZywgYW5ubyk7CiAgICAgICAgICAgICAgICBjb250aW51\nZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNoICh0YWcpIHsK\nICAgICAgICAgICAgICAgIGNhc2UgVEFCTEVfR0VOOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlVGFibGVHZW5lcmF0b3IocGtnLCAoVGFibGVHZW5lcmF0\nb3IpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInVuc3VwcG9ydGVk\nIiwgcGtnLAogICAgICAgICAgICAgICAgICAgICAgICBhbm5vLnRvU3RyaW5n\nKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEFsbG93IHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVua25vd24gYW5u\nb3RhdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhhbmRs\nZVVua25vd25QYWNrYWdlTWFwcGluZ0Fubm90YXRpb24oUGFja2FnZSBwa2cs\nCiAgICAgICAgQW5ub3RhdGlvbiBhbm5vKSB7CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFRhYmxlR2VuZXJh\ndG9yLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VUYWJsZUdlbmVy\nYXRvcihBbm5vdGF0ZWRFbGVtZW50IGVsLCBUYWJsZUdlbmVyYXRvciBnZW4p\nIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGdlbi5uYW1lKCk7CiAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tZ2VuLW5h\nbWUiLCBlbCkpOwoKICAgICAgICBMb2cgbG9nID0gZ2V0TG9nKCk7CiAgICAg\nICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cu\ndHJhY2UoX2xvYy5nZXQoInBhcnNlLWdlbiIsIG5hbWUpKTsKCiAgICAgICAg\nU2VxdWVuY2VNYXBwaW5nIG1ldGEgPSAoU2VxdWVuY2VNYXBwaW5nKSBnZXRS\nZXBvc2l0b3J5KCkuCiAgICAgICAgICAgIGdldENhY2hlZFNlcXVlbmNlTWV0\nYURhdGEobmFtZSk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkgewogICAg\nICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJkdXAtZ2VuIiwgbmFtZSwgZWwpKTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbWV0YSA9\nIChTZXF1ZW5jZU1hcHBpbmcpIGdldFJlcG9zaXRvcnkoKS5hZGRTZXF1ZW5j\nZU1ldGFEYXRhKG5hbWUpOwogICAgICAgIG1ldGEuc2V0U2VxdWVuY2VQbHVn\naW4oU2VxdWVuY2VNYXBwaW5nLklNUExfVkFMVUVfVEFCTEUpOwogICAgICAg\nIG1ldGEuc2V0VGFibGUodG9UYWJsZU5hbWUoZ2VuLnNjaGVtYSgpLCBnZW4u\ndGFibGUoKSkpOwogICAgICAgIG1ldGEuc2V0UHJpbWFyeUtleUNvbHVtbihn\nZW4ucGtDb2x1bW5OYW1lKCkpOwogICAgICAgIG1ldGEuc2V0U2VxdWVuY2VD\nb2x1bW4oZ2VuLnZhbHVlQ29sdW1uTmFtZSgpKTsKICAgICAgICBtZXRhLnNl\ndFByaW1hcnlLZXlWYWx1ZShnZW4ucGtDb2x1bW5WYWx1ZSgpKTsKICAgICAg\nICBtZXRhLnNldEluaXRpYWxWYWx1ZShnZW4uaW5pdGlhbFZhbHVlKCkpOwog\nICAgICAgIG1ldGEuc2V0QWxsb2NhdGUoZ2VuLmFsbG9jYXRpb25TaXplKCkp\nOwogICAgICAgIG1ldGEuc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgKGVs\nIGluc3RhbmNlb2YgQ2xhc3MpID8gZWwgOiBudWxsLAogICAgICAgICAgICBt\nZXRhLlNSQ19BTk5PVEFUSU9OUyk7CgogICAgICAgIC8vIyMjIEVKQjMKICAg\nICAgICBpZiAoZ2VuLnVuaXF1ZUNvbnN0cmFpbnRzKCkubGVuZ3RoID4gMCAm\nJiBsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cud2Fybihf\nbG9jLmdldCgidW5pcXVlLWNvbnN0cmFpbnRzIiwgbmFtZSkpOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VDbGFzc01h\ncHBpbmdBbm5vdGF0aW9ucyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAg\nICBDbGFzc01hcHBpbmcgY20gPSAoQ2xhc3NNYXBwaW5nKSBtZXRhOwogICAg\nICAgIENsYXNzIGNscyA9IGNtLmdldERlc2NyaWJlZFR5cGUoKTsKCiAgICAg\nICAgTWFwcGluZ1RhZyB0YWc7CiAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFu\nbm8gOiBjbHMuZ2V0RGVjbGFyZWRBbm5vdGF0aW9ucygpKSB7CiAgICAgICAg\nICAgIHRhZyA9IF90YWdzLmdldChhbm5vLmFubm90YXRpb25UeXBlKCkpOwog\nICAgICAgICAgICBpZiAodGFnID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGhhbmRsZVVua25vd25DbGFzc01hcHBpbmdBbm5vdGF0aW9uKGNtLCBhbm5v\nKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgY2Fz\nZSBBU1NPQ19PVkVSUklERToKICAgICAgICAgICAgICAgICAgICBwYXJzZUFz\nc29jaWF0aW9uT3ZlcnJpZGVzKGNtLCAoQXNzb2NpYXRpb25PdmVycmlkZSkg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEFTU09DX09WRVJSSURFUzoKICAgICAgICAgICAgICAgICAg\nICBwYXJzZUFzc29jaWF0aW9uT3ZlcnJpZGVzKGNtLCAoKEFzc29jaWF0aW9u\nT3ZlcnJpZGVzKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAgICAgdmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEFUVFJfT1ZFUlJJREU6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VBdHRyaWJ1dGVPdmVycmlkZXMoY20sIChBdHRyaWJ1dGVPdmVycmlk\nZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEFUVFJfT1ZFUlJJREVTOgogICAgICAgICAgICAgICAg\nICAgIHBhcnNlQXR0cmlidXRlT3ZlcnJpZGVzKGNtLCAoKEF0dHJpYnV0ZU92\nZXJyaWRlcykgYW5ubykuCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBESVNDUklNX0NPTDoKICAgICAgICAgICAgICAgICAgICBwYXJz\nZURpc2NyaW1pbmF0b3JDb2x1bW4oY20sIChEaXNjcmltaW5hdG9yQ29sdW1u\nKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgRElTQ1JJTV9WQUw6CiAgICAgICAgICAgICAgICAgICAg\nY20uZ2V0RGlzY3JpbWluYXRvcigpLmdldE1hcHBpbmdJbmZvKCkuc2V0VmFs\ndWUKICAgICAgICAgICAgICAgICAgICAgICAgKCgoRGlzY3JpbWluYXRvclZh\nbHVlKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nTW9kaWZpZXIuaXNBYnN0cmFjdChjbS5nZXREZXNjcmliZWRUeXBlKCkuCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRNb2RpZmllcnMoKSkgJiYg\nZ2V0TG9nKCkuaXNJbmZvRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGdldExvZygpLmluZm8oCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBfbG9jLmdldCgiZGlzY3JpbWluYXRvci1vbi1hYnN0cmFjdC1jbGFz\ncyIsIGNtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5n\nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBJTkhFUklUQU5DRToKICAgICAgICAgICAgICAgICAgICBw\nYXJzZUluaGVyaXRhbmNlKGNtLCAoSW5oZXJpdGFuY2UpIGFubm8pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQ\nS19KT0lOX0NPTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZVByaW1hcnlL\nZXlKb2luQ29sdW1ucyhjbSwgKFByaW1hcnlLZXlKb2luQ29sdW1uKSBhbm5v\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgUEtfSk9JTl9DT0xTOgogICAgICAgICAgICAgICAgICAgIHBhcnNl\nUHJpbWFyeUtleUpvaW5Db2x1bW5zKGNtLAogICAgICAgICAgICAgICAgICAg\nICAgICAoKFByaW1hcnlLZXlKb2luQ29sdW1ucykgYW5ubykuCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB2YWx1ZSgpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU0VDT05EQVJZX1RB\nQkxFOgogICAgICAgICAgICAgICAgICAgIHBhcnNlU2Vjb25kYXJ5VGFibGVz\nKGNtLCAoU2Vjb25kYXJ5VGFibGUpIGFubm8pOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTRUNPTkRBUllfVEFC\nTEVTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlU2Vjb25kYXJ5VGFibGVz\nKGNtLCAoKFNlY29uZGFyeVRhYmxlcykgYW5ubykudmFsdWUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNR\nTF9SRVNVTFRfU0VUX01BUFBJTkc6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VTUUxSZXN1bHRTZXRNYXBwaW5ncyhjbSwgKFNxbFJlc3VsdFNldE1hcHBp\nbmcpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBTUUxfUkVTVUxUX1NFVF9NQVBQSU5HUzoKICAgICAg\nICAgICAgICAgICAgICBwYXJzZVNRTFJlc3VsdFNldE1hcHBpbmdzKGNtLCAo\nKFNxbFJlc3VsdFNldE1hcHBpbmdzKSBhbm5vKS4KICAgICAgICAgICAgICAg\nICAgICAgICAgdmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgICAgICAg\nICAgIHBhcnNlVGFibGUoY20sIChUYWJsZSkgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRBQkxFX0dF\nTjoKICAgICAgICAgICAgICAgICAgICBwYXJzZVRhYmxlR2VuZXJhdG9yKGNs\ncywgKFRhYmxlR2VuZXJhdG9yKSBhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgREFUQVNUT1JFX0lEX0NP\nTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZURhdGFTdG9yZUlkQ29sdW1u\nKGNtLCAoRGF0YVN0b3JlSWRDb2x1bW4pIGFubm8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBESVNDUklNX1NU\nUkFUOgogICAgICAgICAgICAgICAgICAgIGNtLmdldERpc2NyaW1pbmF0b3Io\nKS5nZXRNYXBwaW5nSW5mbygpLnNldFN0cmF0ZWd5CiAgICAgICAgICAgICAg\nICAgICAgICAgICgoKERpc2NyaW1pbmF0b3JTdHJhdGVneSkgYW5ubykudmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEZLOgogICAgICAgICAgICAgICAgICAgIHBhcnNlRm9yZWln\nbktleShjbS5nZXRNYXBwaW5nSW5mbygpLCAoRm9yZWlnbktleSkgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIE1BUFBJTkdfT1ZFUlJJREU6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VNYXBwaW5nT3ZlcnJpZGVzKGNtLCAoTWFwcGluZ092ZXJyaWRlKSBhbm5v\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgTUFQUElOR19PVkVSUklERVM6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VNYXBwaW5nT3ZlcnJpZGVzKGNtLAogICAgICAgICAgICAgICAgICAg\nICAgICAoKE1hcHBpbmdPdmVycmlkZXMpIGFubm8pLnZhbHVlKCkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBT\nVFJBVDoKICAgICAgICAgICAgICAgICAgICBjbS5nZXRNYXBwaW5nSW5mbygp\nLnNldFN0cmF0ZWd5KCgoU3RyYXRlZ3kpIGFubm8pLnZhbHVlKCkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBT\nVUJDTEFTU19GRVRDSF9NT0RFOgogICAgICAgICAgICAgICAgICAgIGNtLnNl\ndFN1YmNsYXNzRmV0Y2hNb2RlKHRvRWFnZXJGZXRjaE1vZGVDb25zdGFudAog\nICAgICAgICAgICAgICAgICAgICAgICAoKChTdWJjbGFzc0ZldGNoTW9kZSkg\nYW5ubykudmFsdWUoKSkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBWRVJTSU9OX0NPTDoKICAgICAgICAgICAg\nICAgICAgICBwYXJzZVZlcnNpb25Db2x1bW5zKGNtLCAoVmVyc2lvbkNvbHVt\nbikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIFZFUlNJT05fQ09MUzoKICAgICAgICAgICAgICAgICAg\nICBwYXJzZVZlcnNpb25Db2x1bW5zKGNtLCAoKFZlcnNpb25Db2x1bW5zKSBh\nbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgVkVSU0lPTl9TVFJBVDoKICAgICAgICAgICAg\nICAgICAgICBjbS5nZXRWZXJzaW9uKCkuZ2V0TWFwcGluZ0luZm8oKS5zZXRT\ndHJhdGVneQogICAgICAgICAgICAgICAgICAgICAgICAoKChWZXJzaW9uU3Ry\nYXRlZ3kpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBYX01BUFBJTkdfT1ZFUlJJREU6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VNYXBwaW5nT3ZlcnJpZGVzKGNt\nLCAoWE1hcHBpbmdPdmVycmlkZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFhfTUFQUElOR19PVkVS\nUklERVM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VNYXBwaW5nT3ZlcnJp\nZGVzKGNtLAogICAgICAgICAgICAgICAgICAgICAgICAoKFhNYXBwaW5nT3Zl\ncnJpZGVzKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgWF9UQUJMRToKICAgICAgICAg\nICAgICAgIGNhc2UgWF9TRUNPTkRBUllfVEFCTEU6CiAgICAgICAgICAgICAg\nICBjYXNlIFhfU0VDT05EQVJZX1RBQkxFUzoKICAgICAgICAgICAgICAgICAg\nICAvLyBubyBicmVhazsgbm90IHN1cHBvcnRlZCB5ZXQKICAgICAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsIGNt\nLAogICAgICAgICAgICAgICAgICAgICAgICBhbm5vKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJj\nbGFzc2VzIHRvIGhhbmRsZSB1bmtub3duIGFubm90YXRpb25zLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYW5kbGVVbmtub3duQ2xhc3NNYXBw\naW5nQW5ub3RhdGlvbihDbGFzc01hcHBpbmcgY2xzLAogICAgICAgIEFubm90\nYXRpb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFBhcnNlIEBBc3NvY2lhdGlvbk92ZXJyaWRlKHMpLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VBc3NvY2lhdGlvbk92ZXJy\naWRlcyhDbGFzc01hcHBpbmcgY20sCiAgICAgICAgQXNzb2NpYXRpb25PdmVy\ncmlkZS4uLiBhc3NvY3MpIHsKICAgICAgICBGaWVsZE1hcHBpbmcgc3VwOwog\nICAgICAgIEpvaW5Db2x1bW5bXSBzY29sczsKICAgICAgICBpbnQgdW5pcXVl\nOwogICAgICAgIExpc3Q8Q29sdW1uPiBqY29sczsKICAgICAgICBmb3IgKEFz\nc29jaWF0aW9uT3ZlcnJpZGUgYXNzb2MgOiBhc3NvY3MpIHsKICAgICAgICAg\nICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoYXNzb2MubmFtZSgpKSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgibm8tb3ZlcnJpZGUtbmFtZSIsIGNtKSk7CiAgICAgICAgICAgIHN1\ncCA9IChGaWVsZE1hcHBpbmcpIGNtLmdldERlZmluZWRTdXBlcmNsYXNzRmll\nbGQoYXNzb2MubmFtZSgpKTsKICAgICAgICAgICAgaWYgKHN1cCA9PSBudWxs\nKQogICAgICAgICAgICAgICAgc3VwID0gKEZpZWxkTWFwcGluZykgY20uYWRk\nRGVmaW5lZFN1cGVyY2xhc3NGaWVsZAogICAgICAgICAgICAgICAgICAgIChh\nc3NvYy5uYW1lKCksIE9iamVjdC5jbGFzcywgT2JqZWN0LmNsYXNzKTsKICAg\nICAgICAgICAgc2NvbHMgPSBhc3NvYy5qb2luQ29sdW1ucygpOwogICAgICAg\nICAgICBpZiAoc2NvbHMgPT0gbnVsbCB8fCBzY29scy5sZW5ndGggPT0gMCkK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgamNvbHMg\nPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oc2NvbHMubGVuZ3RoKTsKICAgICAg\nICAgICAgdW5pcXVlID0gMDsKICAgICAgICAgICAgZm9yIChKb2luQ29sdW1u\nIHNjb2wgOiBzY29scykgewogICAgICAgICAgICAgICAgdW5pcXVlIHw9IChz\nY29sLnVuaXF1ZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICAgICAgICAg\nIGpjb2xzLmFkZChuZXdDb2x1bW4oc2NvbCkpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHNldENvbHVtbnMoc3VwLCBzdXAuZ2V0VmFsdWVJbmZvKCks\nIGpjb2xzLCB1bmlxdWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBBdHRyaWJ1dGVPdmVycmlkZShzKS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlQXR0cmlidXRlT3ZlcnJpZGVzKENsYXNzTWFw\ncGluZyBjbSwKICAgICAgICBBdHRyaWJ1dGVPdmVycmlkZS4uLiBhdHRycykg\newogICAgICAgIEZpZWxkTWFwcGluZyBzdXA7CiAgICAgICAgZm9yIChBdHRy\naWJ1dGVPdmVycmlkZSBhdHRyIDogYXR0cnMpIHsKICAgICAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmlzRW1wdHkoYXR0ci5uYW1lKCkpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1vdmVycmlkZS1uYW1lIiwgY20pKTsKICAgICAgICAgICAgc3VwID0gKEZp\nZWxkTWFwcGluZykgY20uZ2V0RGVmaW5lZFN1cGVyY2xhc3NGaWVsZChhdHRy\nLm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChzdXAgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHN1cCA9IChGaWVsZE1hcHBpbmcpIGNtLmFkZERlZmluZWRT\ndXBlcmNsYXNzRmllbGQoYXR0ci5uYW1lKCksCiAgICAgICAgICAgICAgICAg\nICAgT2JqZWN0LmNsYXNzLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBp\nZiAoYXR0ci5jb2x1bW4oKSAhPSBudWxsKQogICAgICAgICAgICAgICAgcGFy\nc2VDb2x1bW5zKHN1cCwgYXR0ci5jb2x1bW4oKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUGFyc2UgaW5oZXJpdGFuY2UgQFByaW1hcnlL\nZXlKb2luQ29sdW1uKHMpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VQcmltYXJ5S2V5Sm9pbkNvbHVtbnMoQ2xhc3NNYXBwaW5nIGNtLAogICAg\nICAgIFByaW1hcnlLZXlKb2luQ29sdW1uLi4uIGpvaW5zKSB7CiAgICAgICAg\nTGlzdDxDb2x1bW4+IGNvbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oam9p\nbnMubGVuZ3RoKTsKICAgICAgICBmb3IgKFByaW1hcnlLZXlKb2luQ29sdW1u\nIGpvaW4gOiBqb2lucykKICAgICAgICAgICAgY29scy5hZGQobmV3Q29sdW1u\nKGpvaW4pKTsKICAgICAgICBjbS5nZXRNYXBwaW5nSW5mbygpLnNldENvbHVt\nbnMoY29scyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\nc2NoZW1hIGNvbHVtbiB3aXRoIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVu\nIGFubm90YXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENvbHVt\nbiBuZXdDb2x1bW4oUHJpbWFyeUtleUpvaW5Db2x1bW4gam9pbikgewogICAg\nICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgY29sLnNl\ndEZsYWcoQ29sdW1uLkZMQUdfUEtfSk9JTiwgdHJ1ZSk7CiAgICAgICAgaWYg\nKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ubmFtZSgpKSkKICAgICAgICAg\nICAgY29sLnNldE5hbWUoam9pbi5uYW1lKCkpOwogICAgICAgIGlmICghU3Ry\naW5nVXRpbHMuaXNFbXB0eShqb2luLmNvbHVtbkRlZmluaXRpb24oKSkpCiAg\nICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZShqb2luLmNvbHVtbkRlZmluaXRp\nb24oKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4u\ncmVmZXJlbmNlZENvbHVtbk5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRU\nYXJnZXQoam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKTsKICAgICAgICBy\nZXR1cm4gY29sOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFNlY29u\nZGFyeVRhYmxlKHMpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VT\nZWNvbmRhcnlUYWJsZXMoQ2xhc3NNYXBwaW5nIGNtLAogICAgICAgIFNlY29u\nZGFyeVRhYmxlLi4uIHRhYmxlcykgewogICAgICAgIENsYXNzTWFwcGluZ0lu\nZm8gaW5mbyA9IGNtLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgTG9nIGxv\nZyA9IGdldExvZygpOwoKICAgICAgICBTdHJpbmcgbmFtZTsKICAgICAgICBM\naXN0PENvbHVtbj4gam9pbnM7CiAgICAgICAgYm9vbGVhbiB3YXJuVW5pcXVl\nID0gZmFsc2U7CiAgICAgICAgZm9yIChTZWNvbmRhcnlUYWJsZSB0YWJsZSA6\nIHRhYmxlcykgewogICAgICAgICAgICBuYW1lID0gdGFibGUubmFtZSgpOwog\nICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShuYW1lKSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgic2Vjb25kLW5hbWUiLCBjbSkpOwogICAgICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkodGFibGUuc2NoZW1hKCkpKQogICAgICAgICAg\nICAgICAgbmFtZSA9IHRhYmxlLnNjaGVtYSgpICsgIi4iICsgbmFtZTsKICAg\nICAgICAgICAgaWYgKHRhYmxlLnBrSm9pbkNvbHVtbnMoKS5sZW5ndGggPiAw\nKSB7CiAgICAgICAgICAgICAgICBqb2lucyA9IG5ldyBBcnJheUxpc3Q8Q29s\ndW1uPih0YWJsZS5wa0pvaW5Db2x1bW5zKCkubGVuZ3RoKTsKICAgICAgICAg\nICAgICAgIGZvciAoUHJpbWFyeUtleUpvaW5Db2x1bW4gam9pbiA6IHRhYmxl\nLnBrSm9pbkNvbHVtbnMoKSkKICAgICAgICAgICAgICAgICAgICBqb2lucy5h\nZGQobmV3Q29sdW1uKGpvaW4pKTsKICAgICAgICAgICAgICAgIGluZm8uc2V0\nU2Vjb25kYXJ5VGFibGVKb2luQ29sdW1ucyhuYW1lLCBqb2lucyk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgd2FyblVuaXF1ZSB8PSB0YWJsZS51bmlx\ndWVDb25zdHJhaW50cygpLmxlbmd0aCA+IDA7CiAgICAgICAgfQoKICAgICAg\nICAvLyMjIyBFSkIzCiAgICAgICAgaWYgKHdhcm5VbmlxdWUgJiYgbG9nLmlz\nV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQo\nInVuaXF1ZS1jb25zdHJhaW50cyIsIGNtKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgY2xhc3MgdGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZVRhYmxlKENsYXNzTWFwcGluZyBjbSwgVGFibGUgdGFibGUpIHsK\nICAgICAgICBTdHJpbmcgdGFibGVOYW1lID0gdG9UYWJsZU5hbWUodGFibGUu\nc2NoZW1hKCksIHRhYmxlLm5hbWUoKSk7CiAgICAgICAgaWYgKHRhYmxlTmFt\nZSAhPSBudWxsKQogICAgICAgICAgICBjbS5nZXRNYXBwaW5nSW5mbygpLnNl\ndFRhYmxlTmFtZSh0YWJsZU5hbWUpOwoKICAgICAgICBmb3IgKFVuaXF1ZUNv\nbnN0cmFpbnQgdW5pcXVlQ29uc3RyYWludDp0YWJsZS51bmlxdWVDb25zdHJh\naW50cygpKSB7CiAgICAgICAgICAgIFVuaXF1ZSB1bmlxdWUgPSBuZXdVbmlx\ndWUoY20sIG51bGwsIHVuaXF1ZUNvbnN0cmFpbnQuY29sdW1uTmFtZXMoKSk7\nCiAgICAgICAgICAgIGNtLmdldE1hcHBpbmdJbmZvKCkuYWRkVW5pcXVlKHVu\naXF1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRm9ybSBh\nIHF1YWxpZmllZCB0YWJsZSBuYW1lIGZyb20gYSBzY2hlbWEgYW5kIHRhYmxl\nIG5hbWUuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIFN0cmluZyB0b1Rh\nYmxlTmFtZShTdHJpbmcgc2NoZW1hLCBTdHJpbmcgdGFibGUpIHsKICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eSh0YWJsZSkpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5\nKHNjaGVtYSkpCiAgICAgICAgICAgIHJldHVybiB0YWJsZTsKICAgICAgICBy\nZXR1cm4gc2NoZW1hICsgIi4iICsgdGFibGU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQYXJzZXMgdGhlIGdpdmVuIGFubm90YXRpb24gdG8gY3JlYXRlIGFu\nZCBjYWNoZSBhCiAgICAgKiB7QGxpbmsgU1FMUmVzdWx0U2V0TWFwcGluZ01l\ndGFEYXRhfS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlU1FMUmVz\ndWx0U2V0TWFwcGluZ3MoQ2xhc3NNYXBwaW5nIGNtLAogICAgICAgIFNxbFJl\nc3VsdFNldE1hcHBpbmcuLi4gYW5ub3MpIHsKICAgICAgICBNYXBwaW5nUmVw\nb3NpdG9yeSByZXBvcyA9IChNYXBwaW5nUmVwb3NpdG9yeSkgZ2V0UmVwb3Np\ndG9yeSgpOwogICAgICAgIExvZyBsb2cgPSBnZXRMb2coKTsKICAgICAgICBm\nb3IgKFNxbFJlc3VsdFNldE1hcHBpbmcgYW5ubyA6IGFubm9zKSB7CiAgICAg\nICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIGxvZy50cmFjZShfbG9jLmdldCgicGFyc2Utc3FscnNtYXBwaW5nIiwg\nYW5uby5uYW1lKCkpKTsKCiAgICAgICAgICAgIFF1ZXJ5UmVzdWx0TWFwcGlu\nZyByZXN1bHQgPSByZXBvcy5nZXRDYWNoZWRRdWVyeVJlc3VsdE1hcHBpbmcK\nICAgICAgICAgICAgICAgIChudWxsLCBhbm5vLm5hbWUoKSk7CiAgICAgICAg\nICAgIGlmIChyZXN1bHQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYg\nKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9n\nLndhcm4oX2xvYy5nZXQoImR1cC1zcWxyc21hcHBpbmciLCBhbm5vLm5hbWUo\nKSwgY20pKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICByZXN1bHQgPSByZXBvcy5hZGRRdWVyeVJlc3Vs\ndE1hcHBpbmcobnVsbCwgYW5uby5uYW1lKCkpOwogICAgICAgICAgICByZXN1\nbHQuc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgY20uZ2V0RGVzY3JpYmVk\nVHlwZSgpLAogICAgICAgICAgICAgICAgcmVzdWx0LlNSQ19BTk5PVEFUSU9O\nUyk7CgogICAgICAgICAgICBmb3IgKEVudGl0eVJlc3VsdCBlbnRpdHkgOiBh\nbm5vLmVudGl0aWVzKCkpIHsKICAgICAgICAgICAgICAgIFF1ZXJ5UmVzdWx0\nTWFwcGluZy5QQ1Jlc3VsdCBlbnRpdHlSZXN1bHQgPSByZXN1bHQuYWRkUENS\nZXN1bHQKICAgICAgICAgICAgICAgICAgICAoZW50aXR5LmVudGl0eUNsYXNz\nKCkpOwogICAgICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKGVudGl0eS5kaXNjcmltaW5hdG9yQ29sdW1uKCkpKQogICAgICAgICAgICAg\nICAgICAgIGVudGl0eVJlc3VsdC5hZGRNYXBwaW5nKGVudGl0eVJlc3VsdC5E\nSVNDUklNSU5BVE9SLAogICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHku\nZGlzY3JpbWluYXRvckNvbHVtbigpKTsKCiAgICAgICAgICAgICAgICBmb3Ig\nKEZpZWxkUmVzdWx0IGZpZWxkIDogZW50aXR5LmZpZWxkcygpKQogICAgICAg\nICAgICAgICAgICAgIGVudGl0eVJlc3VsdC5hZGRNYXBwaW5nKGZpZWxkLm5h\nbWUoKSwgZmllbGQuY29sdW1uKCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGZvciAoQ29sdW1uUmVzdWx0IGNvbHVtbiA6IGFubm8uY29sdW1ucygp\nKQogICAgICAgICAgICAgICAgcmVzdWx0LmFkZENvbHVtblJlc3VsdChjb2x1\nbW4ubmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSBARGlzY3JpbWluYXRvckNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHBhcnNlRGlzY3JpbWluYXRvckNvbHVtbihDbGFzc01hcHBpbmcg\nY20sCiAgICAgICAgRGlzY3JpbWluYXRvckNvbHVtbiBkY29sKSB7CiAgICAg\nICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoZGNvbC5uYW1lKCkpKQogICAgICAgICAgICBj\nb2wuc2V0TmFtZShkY29sLm5hbWUoKSk7CiAgICAgICAgaWYgKCFTdHJpbmdV\ndGlscy5pc0VtcHR5KGRjb2wuY29sdW1uRGVmaW5pdGlvbigpKSkKICAgICAg\nICAgICAgY29sLnNldFR5cGVOYW1lKGRjb2wuY29sdW1uRGVmaW5pdGlvbigp\nKTsKICAgICAgICBEaXNjcmltaW5hdG9yIGRpc2NyaW0gPSBjbS5nZXREaXNj\ncmltaW5hdG9yKCk7CiAgICAgICAgc3dpdGNoIChkY29sLmRpc2NyaW1pbmF0\nb3JUeXBlKCkpIHsKICAgICAgICAgICAgY2FzZSBDSEFSOgogICAgICAgICAg\nICAgICAgY29sLnNldEphdmFUeXBlKEphdmFUeXBlcy5DSEFSKTsKICAgICAg\nICAgICAgICAgIGRpc2NyaW0uc2V0SmF2YVR5cGUoSmF2YVR5cGVzLkNIQVIp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSU5U\nRUdFUjoKICAgICAgICAgICAgICAgIGNvbC5zZXRKYXZhVHlwZShKYXZhVHlw\nZXMuSU5UKTsKICAgICAgICAgICAgICAgIGlmIChkY29sLmxlbmd0aCgpICE9\nIDMxKQogICAgICAgICAgICAgICAgICAgIGNvbC5zZXRTaXplKGRjb2wubGVu\nZ3RoKCkpOwogICAgICAgICAgICAgICAgZGlzY3JpbS5zZXRKYXZhVHlwZShK\nYXZhVHlwZXMuSU5UKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgY29sLnNldEphdmFUeXBl\nKEphdmFUeXBlcy5TVFJJTkcpOwogICAgICAgICAgICAgICAgY29sLnNldFNp\nemUoZGNvbC5sZW5ndGgoKSk7CiAgICAgICAgICAgICAgICBkaXNjcmltLnNl\ndEphdmFUeXBlKEphdmFUeXBlcy5TVFJJTkcpOwogICAgICAgIH0KICAgICAg\nICBjbS5nZXREaXNjcmltaW5hdG9yKCkuZ2V0TWFwcGluZ0luZm8oKS5zZXRD\nb2x1bW5zCiAgICAgICAgICAgIChBcnJheXMuYXNMaXN0KG5ldyBDb2x1bW5b\nXXsgY29sIH0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBJbmhl\ncml0YW5jZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlSW5oZXJp\ndGFuY2UoQ2xhc3NNYXBwaW5nIGNtLCBJbmhlcml0YW5jZSBpbmhlcml0KSB7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nSW5mbyBpbmZvID0gY20uZ2V0TWFwcGlu\nZ0luZm8oKTsKICAgICAgICBzd2l0Y2ggKGluaGVyaXQuc3RyYXRlZ3koKSkg\newogICAgICAgICAgICBjYXNlIFNJTkdMRV9UQUJMRToKICAgICAgICAgICAg\nICAgIGluZm8uc2V0SGllcmFyY2h5U3RyYXRlZ3koRmxhdENsYXNzU3RyYXRl\nZ3kuQUxJQVMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSk9JTkVEOgogICAgICAgICAgICAgICAgaW5mby5zZXRIaWVyYXJj\naHlTdHJhdGVneShWZXJ0aWNhbENsYXNzU3RyYXRlZ3kuQUxJQVMpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgVEFCTEVfUEVS\nX0NMQVNTOgogICAgICAgICAgICAgICAgaW5mby5zZXRIaWVyYXJjaHlTdHJh\ndGVneShGdWxsQ2xhc3NTdHJhdGVneS5BTElBUyk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGNsYXNzLWxldmVsIEBNYXBwaW5n\nT3ZlcnJpZGUocykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU1h\ncHBpbmdPdmVycmlkZXMoQ2xhc3NNYXBwaW5nIGNtLAogICAgICAgIE1hcHBp\nbmdPdmVycmlkZS4uLiBvdmVycykgewogICAgICAgIEZpZWxkTWFwcGluZyBz\ndXA7CiAgICAgICAgZm9yIChNYXBwaW5nT3ZlcnJpZGUgb3ZlciA6IG92ZXJz\nKSB7CiAgICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG92ZXIu\nbmFtZSgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgibm8tb3ZlcnJpZGUtbmFtZSIsIGNtKSk7CiAg\nICAgICAgICAgIHN1cCA9IChGaWVsZE1hcHBpbmcpIGNtLmdldERlZmluZWRT\ndXBlcmNsYXNzRmllbGQob3Zlci5uYW1lKCkpOwogICAgICAgICAgICBpZiAo\nc3VwID09IG51bGwpCiAgICAgICAgICAgICAgICBzdXAgPSAoRmllbGRNYXBw\naW5nKSBjbS5hZGREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKG92ZXIubmFtZSgp\nLAogICAgICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgT2JqZWN0LmNs\nYXNzKTsKICAgICAgICAgICAgcG9wdWxhdGUoc3VwLCBvdmVyKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQb3B1bGF0ZSB0aGUgZ2l2ZW4g\nZmllbGQgZnJvbSBvdmVycmlkZSBkYXRhLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcG9wdWxhdGUoRmllbGRNYXBwaW5nIGZtLCBNYXBwaW5nT3ZlcnJp\nZGUgb3ZlcikgewogICAgICAgIGlmIChvdmVyLmNvbnRhaW5lclRhYmxlKCku\nc3BlY2lmaWVkKCkpCiAgICAgICAgICAgIHBhcnNlQ29udGFpbmVyVGFibGUo\nZm0sIG92ZXIuY29udGFpbmVyVGFibGUoKSk7CiAgICAgICAgcGFyc2VDb2x1\nbW5zKGZtLCBvdmVyLmNvbHVtbnMoKSk7CiAgICAgICAgcGFyc2VYSm9pbkNv\nbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCB0cnVlLCBvdmVyLmpvaW5D\nb2x1bW5zKCkpOwogICAgICAgIHBhcnNlRWxlbWVudEpvaW5Db2x1bW5zKGZt\nLCBvdmVyLmVsZW1lbnRKb2luQ29sdW1ucygpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIGRhdGFzdG9yZSBpZGVudGl0eSBpbmZvcm1hdGlvbiBp\nbiBARGF0YVN0b3JlSWRDb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZURhdGFTdG9yZUlkQ29sdW1uKENsYXNzTWFwcGluZyBjbSwgRGF0\nYVN0b3JlSWRDb2x1bW4gaWQpIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3\nIENvbHVtbigpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShp\nZC5uYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFtZShpZC5uYW1lKCkp\nOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShpZC5jb2x1bW5E\nZWZpbml0aW9uKCkpKQogICAgICAgICAgICBjb2wuc2V0VHlwZU5hbWUoaWQu\nY29sdW1uRGVmaW5pdGlvbigpKTsKICAgICAgICBpZiAoaWQucHJlY2lzaW9u\nKCkgIT0gMCkKICAgICAgICAgICAgY29sLnNldFNpemUoaWQucHJlY2lzaW9u\nKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJU\nQUJMRSwgIWlkLmluc2VydGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWco\nQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUsICFpZC51cGRhdGFibGUoKSk7CiAg\nICAgICAgY20uZ2V0TWFwcGluZ0luZm8oKS5zZXRDb2x1bW5zKEFycmF5cy5h\nc0xpc3QobmV3IENvbHVtbltdeyBjb2wgfSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2UgdGhlIGdpdmVuIGZvcmVpZ24ga2V5LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcGFyc2VGb3JlaWduS2V5KE1hcHBpbmdJbmZvIGlu\nZm8sIEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBwYXJzZUZvcmVpZ25LZXko\naW5mbywgZmsubmFtZSgpLCBmay5lbmFibGVkKCksIGZrLmRlZmVycmVkKCks\nCiAgICAgICAgICAgIGZrLmRlbGV0ZUFjdGlvbigpLCBmay51cGRhdGVBY3Rp\nb24oKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgZm9yZWlnbiBrZXkg\nZGF0YSBvbiB0aGUgZ2l2ZW4gbWFwcGluZyBpbmZvLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBwYXJzZUZvcmVpZ25LZXkoTWFwcGluZ0luZm8gaW5m\nbywgU3RyaW5nIG5hbWUsCiAgICAgICAgYm9vbGVhbiBlbmFibGVkLCBib29s\nZWFuIGRlZmVycmVkLCBGb3JlaWduS2V5QWN0aW9uIGRlbGV0ZUFjdGlvbiwK\nICAgICAgICBGb3JlaWduS2V5QWN0aW9uIHVwZGF0ZUFjdGlvbikgewogICAg\nICAgIGlmICghZW5hYmxlZCkgewogICAgICAgICAgICBpbmZvLnNldENhbkZv\ncmVpZ25LZXkoZmFsc2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQoKICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9y\nZWlnbktleSBmayA9CiAgICAgICAgICAgIG5ldyBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuRm9yZWlnbktleSgpOwogICAgICAgIGlmICghU3Ry\naW5nVXRpbHMuaXNFbXB0eShuYW1lKSkKICAgICAgICAgICAgZmsuc2V0TmFt\nZShuYW1lKTsKICAgICAgICBmay5zZXREZWZlcnJlZChkZWZlcnJlZCk7CiAg\nICAgICAgZmsuc2V0RGVsZXRlQWN0aW9uKHRvRm9yZWlnbktleUFjdGlvbihk\nZWxldGVBY3Rpb24pKTsKICAgICAgICBmay5zZXRVcGRhdGVBY3Rpb24odG9G\nb3JlaWduS2V5QWN0aW9uKHVwZGF0ZUFjdGlvbikpOwogICAgICAgIGluZm8u\nc2V0Rm9yZWlnbktleShmayk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IG91ciBGSyBhY3Rpb24gZW51bSB0byBhbiBpbnRlcm5hbCBPcGVuSlBB\nIGFjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgdG9Gb3JlaWduS2V5\nQWN0aW9uKEZvcmVpZ25LZXlBY3Rpb24gYWN0aW9uKSB7CiAgICAgICAgc3dp\ndGNoIChhY3Rpb24pIHsKICAgICAgICAgICAgY2FzZSBSRVNUUklDVDoKICAg\nICAgICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJQ1Q7CiAgICAgICAgICAg\nIGNhc2UgQ0FTQ0FERToKICAgICAgICAgICAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleS5BQ1RJT05fQ0FT\nQ0FERTsKICAgICAgICAgICAgY2FzZSBOVUxMOgogICAgICAgICAgICAgICAg\ncmV0dXJuIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWdu\nS2V5LkFDVElPTl9OVUxMOwogICAgICAgICAgICBjYXNlIERFRkFVTFQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkZvcmVpZ25LZXkuQUNUSU9OX0RFRkFVTFQ7CiAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxF\neGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSB0aGUgZ2l2ZW4gaW5kZXguCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZUluZGV4KE1hcHBpbmdJbmZvIGluZm8sIEluZGV4IGlkeCkgewog\nICAgICAgIHBhcnNlSW5kZXgoaW5mbywgaWR4Lm5hbWUoKSwgaWR4LmVuYWJs\nZWQoKSwgaWR4LnVuaXF1ZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCBpbmRleCBkYXRhIG9uIHRoZSBnaXZlbiBtYXBwaW5nIGluZm8uCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlSW5kZXgoTWFwcGluZ0luZm8g\naW5mbywgU3RyaW5nIG5hbWUsCiAgICAgICAgYm9vbGVhbiBlbmFibGVkLCBi\nb29sZWFuIHVuaXF1ZSkgewogICAgICAgIGlmICghZW5hYmxlZCkgewogICAg\nICAgICAgICBpbmZvLnNldENhbkluZGV4KGZhbHNlKTsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLkluZGV4IGlkeCA9CiAgICAgICAgICAgIG5ldyBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuSW5kZXgoKTsKICAgICAgICBp\nZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIGlk\neC5zZXROYW1lKG5hbWUpOwogICAgICAgIGlkeC5zZXRVbmlxdWUodW5pcXVl\nKTsKICAgICAgICBpbmZvLnNldEluZGV4KGlkeCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgdW5pcXVlIGRhdGEgb24gdGhlIGdpdmVuIG1hcHBpbmcg\naW5mby4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlVW5pcXVlKEZp\nZWxkTWFwcGluZyBmbSwgCiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLnBl\ncnNpc3RlbmNlLmpkYmMuVW5pcXVlIGFubm8pIHsKICAgICAgICBWYWx1ZU1h\ncHBpbmdJbmZvIGluZm8gPSBmbS5nZXRWYWx1ZUluZm8oKTsKICAgICAgICBp\nZiAoIWFubm8uZW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGluZm8uc2V0Q2Fu\nVW5pcXVlKGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nCiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1\nZSB1bnEgPSAKICAgICAgICAgICAgbmV3IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS5VbmlxdWUoKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkoYW5uby5uYW1lKCkpKQogICAgICAgICAgICB1bnEuc2V0TmFt\nZShhbm5vLm5hbWUoKSk7CiAgICAgICAgdW5xLnNldERlZmVycmVkKGFubm8u\nZGVmZXJyZWQoKSk7CiAgICAgICAgaW5mby5zZXRVbmlxdWUodW5xKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBWZXJzaW9uQ29sdW1uKHMpLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VWZXJzaW9uQ29sdW1ucyhD\nbGFzc01hcHBpbmcgY20sIFZlcnNpb25Db2x1bW4uLi4gdmNvbHMpIHsKICAg\nICAgICBpZiAodmNvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSBuZXcgQXJyYXlMaXN0\nPENvbHVtbj4odmNvbHMubGVuZ3RoKTsKICAgICAgICBmb3IgKFZlcnNpb25D\nb2x1bW4gdmNvbCA6IHZjb2xzKQogICAgICAgICAgICBjb2xzLmFkZChuZXdD\nb2x1bW4odmNvbCkpOwogICAgICAgIGNtLmdldFZlcnNpb24oKS5nZXRNYXBw\naW5nSW5mbygpLnNldENvbHVtbnMoY29scyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgYSBuZXcgc2NoZW1hIGNvbHVtbiB3aXRoIGluZm9ybWF0\naW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIENvbHVtbiBuZXdDb2x1bW4oVmVyc2lvbkNvbHVtbiBh\nbm5vKSB7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAg\nICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5uYW1lKCkpKQog\nICAgICAgICAgICBjb2wuc2V0TmFtZShhbm5vLm5hbWUoKSk7CiAgICAgICAg\naWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8uY29sdW1uRGVmaW5pdGlv\nbigpKSkKICAgICAgICAgICAgY29sLnNldFR5cGVOYW1lKGFubm8uY29sdW1u\nRGVmaW5pdGlvbigpKTsKICAgICAgICBpZiAoYW5uby5wcmVjaXNpb24oKSAh\nPSAwKQogICAgICAgICAgICBjb2wuc2V0U2l6ZShhbm5vLnByZWNpc2lvbigp\nKTsKICAgICAgICBlbHNlIGlmIChhbm5vLmxlbmd0aCgpICE9IDI1NSkKICAg\nICAgICAgICAgY29sLnNldFNpemUoYW5uby5sZW5ndGgoKSk7CiAgICAgICAg\nY29sLnNldE5vdE51bGwoIWFubm8ubnVsbGFibGUoKSk7CiAgICAgICAgY29s\nLnNldERlY2ltYWxEaWdpdHMoYW5uby5zY2FsZSgpKTsKICAgICAgICBjb2wu\nc2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFhbm5vLmluc2Vy\ndGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5V\nUERBVEFCTEUsICFhbm5vLnVwZGF0YWJsZSgpKTsKICAgICAgICByZXR1cm4g\nY29sOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgY2xhc3MtbGV2ZWwg\nQFhNYXBwaW5nT3ZlcnJpZGUocykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZU1hcHBpbmdPdmVycmlkZXMoQ2xhc3NNYXBwaW5nIGNtLAogICAg\nICAgIFhNYXBwaW5nT3ZlcnJpZGUuLi4gb3ZlcnMpIHsKICAgICAgICBGaWVs\nZE1hcHBpbmcgc3VwOwogICAgICAgIGZvciAoWE1hcHBpbmdPdmVycmlkZSBv\ndmVyIDogb3ZlcnMpIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlz\nRW1wdHkob3Zlci5uYW1lKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1vdmVycmlkZS1uYW1l\nIiwgY20pKTsKICAgICAgICAgICAgc3VwID0gKEZpZWxkTWFwcGluZykgY20u\nZ2V0RGVmaW5lZFN1cGVyY2xhc3NGaWVsZChvdmVyLm5hbWUoKSk7CiAgICAg\nICAgICAgIGlmIChzdXAgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHN1cCA9\nIChGaWVsZE1hcHBpbmcpIGNtLmFkZERlZmluZWRTdXBlcmNsYXNzRmllbGQo\nb3Zlci5uYW1lKCksCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNz\nLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBwb3B1bGF0ZShzdXAsIG92\nZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBvcHVsYXRl\nIHRoZSBnaXZlbiBmaWVsZCBmcm9tIG92ZXJyaWRlIGRhdGEuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwb3B1bGF0ZShGaWVsZE1hcHBpbmcgZm0sIFhN\nYXBwaW5nT3ZlcnJpZGUgb3ZlcikgewogICAgICAgIGlmIChvdmVyLmNvbnRh\naW5lclRhYmxlKCkuc3BlY2lmaWVkKCkpCiAgICAgICAgICAgIHBhcnNlQ29u\ndGFpbmVyVGFibGUoZm0sIG92ZXIuY29udGFpbmVyVGFibGUoKSk7CiAgICAg\nICAgcGFyc2VDb2x1bW5zKGZtLCBvdmVyLmNvbHVtbnMoKSk7CiAgICAgICAg\ncGFyc2VYSm9pbkNvbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCB0cnVl\nLCBvdmVyLmpvaW5Db2x1bW5zKCkpOwogICAgICAgIHBhcnNlRWxlbWVudENv\nbHVtbnMoZm0sIG92ZXIuZWxlbWVudENvbHVtbnMoKSk7CiAgICAgICAgcGFy\nc2VFbGVtZW50Sm9pbkNvbHVtbnMoZm0sIG92ZXIuZWxlbWVudEpvaW5Db2x1\nbW5zKCkpOwogICAgICAgIHBhcnNlS2V5Q29sdW1ucyhmbSwgb3Zlci5rZXlD\nb2x1bW5zKCkpOwogICAgICAgIHBhcnNlS2V5Sm9pbkNvbHVtbnMoZm0sIG92\nZXIua2V5Sm9pbkNvbHVtbnMoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSBARWxlbWVudENvbHVtbihzKS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHBhcnNlRWxlbWVudENvbHVtbnMoRmllbGRNYXBwaW5nIGZtLCBFbGVt\nZW50Q29sdW1uLi4uIHBjb2xzKSB7CiAgICAgICAgaWYgKHBjb2xzLmxlbmd0\naCA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIExpc3Q8Q29s\ndW1uPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KHBjb2xzLmxlbmd0\naCk7CiAgICAgICAgaW50IHVuaXF1ZSA9IDA7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBwY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBj\nb2xzLmFkZChuZXdDb2x1bW4ocGNvbHNbaV0pKTsKICAgICAgICAgICAgdW5p\ncXVlIHw9IChwY29sc1tpXS51bmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7CiAg\nICAgICAgfQogICAgICAgIHNldENvbHVtbnMoZm0sIGZtLmdldEVsZW1lbnRN\nYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCksIGNvbHMsIHVuaXF1ZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc2NoZW1hIGNvbHVtbiB3\naXRoIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENvbHVtbiBuZXdDb2x1bW4oRWxl\nbWVudENvbHVtbiBhbm5vKSB7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBD\nb2x1bW4oKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5u\nby5uYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFtZShhbm5vLm5hbWUo\nKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8uY29s\ndW1uRGVmaW5pdGlvbigpKSkKICAgICAgICAgICAgY29sLnNldFR5cGVOYW1l\nKGFubm8uY29sdW1uRGVmaW5pdGlvbigpKTsKICAgICAgICBpZiAoYW5uby5w\ncmVjaXNpb24oKSAhPSAwKQogICAgICAgICAgICBjb2wuc2V0U2l6ZShhbm5v\nLnByZWNpc2lvbigpKTsKICAgICAgICBlbHNlIGlmIChhbm5vLmxlbmd0aCgp\nICE9IDI1NSkKICAgICAgICAgICAgY29sLnNldFNpemUoYW5uby5sZW5ndGgo\nKSk7CiAgICAgICAgY29sLnNldE5vdE51bGwoIWFubm8ubnVsbGFibGUoKSk7\nCiAgICAgICAgY29sLnNldERlY2ltYWxEaWdpdHMoYW5uby5zY2FsZSgpKTsK\nICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUs\nICFhbm5vLmluc2VydGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29s\ndW1uLkZMQUdfVU5VUERBVEFCTEUsICFhbm5vLnVwZGF0YWJsZSgpKTsKICAg\nICAgICByZXR1cm4gY29sOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Ug\nQEtleUpvaW5Db2x1bW4ocykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZUtleUpvaW5Db2x1bW5zKEZpZWxkTWFwcGluZyBmbSwgS2V5Sm9pbkNv\nbHVtbi4uLiBqb2lucykgewogICAgICAgIGlmIChqb2lucy5sZW5ndGggPT0g\nMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBMaXN0PENvbHVtbj4g\nY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihqb2lucy5sZW5ndGgpOwog\nICAgICAgIGludCB1bmlxdWUgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29scy5h\nZGQobmV3Q29sdW1uKGpvaW5zW2ldKSk7CiAgICAgICAgICAgIHVuaXF1ZSB8\nPSAoam9pbnNbaV0udW5pcXVlKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAg\nIH0KICAgICAgICBzZXRDb2x1bW5zKGZtLCBmbS5nZXRLZXlNYXBwaW5nKCku\nZ2V0VmFsdWVJbmZvKCksIGNvbHMsIHVuaXF1ZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiAgQ3JlYXRlIGEgbmV3IHNjaGVtYSBjb2x1bW4gd2l0aCBpbmZv\ncm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29sdW1uKEtleUpvaW5Db2x1\nbW4gam9pbikgewogICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7\nCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ubmFtZSgp\nKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoam9pbi5uYW1lKCkpOwogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLmNvbHVtbkRlZmlu\naXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZShqb2luLmNv\nbHVtbkRlZmluaXRpb24oKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5p\nc0VtcHR5KGpvaW4ucmVmZXJlbmNlZENvbHVtbk5hbWUoKSkpCiAgICAgICAg\nICAgIGNvbC5zZXRUYXJnZXQoam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgp\nKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZl\ncmVuY2VkQXR0cmlidXRlTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldFRh\ncmdldEZpZWxkKGpvaW4ucmVmZXJlbmNlZEF0dHJpYnV0ZU5hbWUoKSk7CiAg\nICAgICAgY29sLnNldE5vdE51bGwoIWpvaW4ubnVsbGFibGUoKSk7CiAgICAg\nICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAham9p\nbi5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5G\nTEFHX1VOVVBEQVRBQkxFLCAham9pbi51cGRhdGFibGUgKCkpOwogICAgICAg\nIHJldHVybiBjb2w7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVHJhbnNs\nYXRlIHRoZSBmZXRjaCBtb2RlIGVudW0gdmFsdWUgdG8gdGhlIGludGVybmFs\nIE9wZW5KUEEgY29uc3RhbnQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGludCB0b0VhZ2VyRmV0Y2hNb2RlQ29uc3RhbnQoRmV0Y2hNb2RlIG1vZGUp\nIHsKICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKICAgICAgICAgICAgY2FzZSBO\nT05FOgogICAgICAgICAgICAgICAgcmV0dXJuIEVhZ2VyRmV0Y2hNb2Rlcy5F\nQUdFUl9OT05FOwogICAgICAgICAgICBjYXNlIEpPSU46CiAgICAgICAgICAg\nICAgICByZXR1cm4gRWFnZXJGZXRjaE1vZGVzLkVBR0VSX0pPSU47CiAgICAg\nICAgICAgIGNhc2UgUEFSQUxMRUw6CiAgICAgICAgICAgICAgICByZXR1cm4g\nRWFnZXJGZXRjaE1vZGVzLkVBR0VSX1BBUkFMTEVMOwogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhj\nZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHJvdGVjdGVkIHZvaWQgcGFyc2VMb2JNYXBwaW5nKEZpZWxkTWV0YURhdGEg\nZm1kKSB7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAg\nICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlw\nZXMuU1RSSU5HCiAgICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSA9PSBjaGFyW10uY2xhc3MKICAgICAgICAgICAgfHwgZm1kLmdldERlY2xh\ncmVkVHlwZSgpID09IENoYXJhY3RlcltdLmNsYXNzKQogICAgICAgICAgICBj\nb2wuc2V0VHlwZShUeXBlcy5DTE9CKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIGNvbC5zZXRUeXBlKFR5cGVzLkJMT0IpOwogICAgICAgICgoRmllbGRN\nYXBwaW5nKSBmbWQpLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoQXJyYXlz\nLmFzTGlzdAogICAgICAgICAgICAobmV3IENvbHVtbltdeyBjb2wgfSkpOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VN\nZW1iZXJNYXBwaW5nQW5ub3RhdGlvbnMoRmllbGRNZXRhRGF0YSBmbWQpIHsK\nICAgICAgICBGaWVsZE1hcHBpbmcgZm0gPSAoRmllbGRNYXBwaW5nKSBmbWQ7\nCiAgICAgICAgQW5ub3RhdGVkRWxlbWVudCBlbCA9IChBbm5vdGF0ZWRFbGVt\nZW50KSBnZXRSZXBvc2l0b3J5KCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRh\nRmFjdG9yeSgpLmdldERlZmF1bHRzKCkuZ2V0QmFja2luZ01lbWJlcihmbWQp\nOwoKICAgICAgICBNYXBwaW5nVGFnIHRhZzsKICAgICAgICBmb3IgKEFubm90\nYXRpb24gYW5ubyA6IGVsLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewog\nICAgICAgICAgICB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0aW9uVHlw\nZSgpKTsKICAgICAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBoYW5kbGVVbmtub3duTWVtYmVyTWFwcGluZ0Fubm90YXRpb24o\nZm0sIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAg\nICAgICBjYXNlIEFTU09DX09WRVJSSURFOgogICAgICAgICAgICAgICAgICAg\nIHBhcnNlQXNzb2NpYXRpb25PdmVycmlkZXMoZm0sIChBc3NvY2lhdGlvbk92\nZXJyaWRlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgQVNTT0NfT1ZFUlJJREVTOgogICAgICAgICAg\nICAgICAgICAgIHBhcnNlQXNzb2NpYXRpb25PdmVycmlkZXMoZm0sICgoQXNz\nb2NpYXRpb25PdmVycmlkZXMpIGFubm8pLgogICAgICAgICAgICAgICAgICAg\nICAgICB2YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgQVRUUl9PVkVSUklERToKICAgICAgICAgICAg\nICAgICAgICBwYXJzZUF0dHJpYnV0ZU92ZXJyaWRlcyhmbSwgKEF0dHJpYnV0\nZU92ZXJyaWRlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgQVRUUl9PVkVSUklERVM6CiAgICAgICAg\nICAgICAgICAgICAgcGFyc2VBdHRyaWJ1dGVPdmVycmlkZXMoZm0sICgoQXR0\ncmlidXRlT3ZlcnJpZGVzKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAg\nICAgdmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIENPTDoKICAgICAgICAgICAgICAgICAgICBwYXJz\nZUNvbHVtbnMoZm0sIChqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW4pIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBDT0xTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQ29sdW1ucyhm\nbSwgKChDb2x1bW5zKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRU5VTUVSQVRFRDoK\nICAgICAgICAgICAgICAgICAgICBwYXJzZUVudW1lcmF0ZWQoZm0sIChFbnVt\nZXJhdGVkKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgSk9JTl9DT0w6CiAgICAgICAgICAgICAgICAg\nICAgcGFyc2VKb2luQ29sdW1ucyhmbSwgZm0uZ2V0VmFsdWVJbmZvKCksIHRy\ndWUsCiAgICAgICAgICAgICAgICAgICAgICAgIChKb2luQ29sdW1uKSBhbm5v\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgSk9JTl9DT0xTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlSm9p\nbkNvbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCB0cnVlLAogICAgICAg\nICAgICAgICAgICAgICAgICAoKEpvaW5Db2x1bW5zKSBhbm5vKS52YWx1ZSgp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgSk9JTl9UQUJMRToKICAgICAgICAgICAgICAgICAgICBwYXJzZUpv\naW5UYWJsZShmbSwgKEpvaW5UYWJsZSkgYW5ubyk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEtFWV9DTEFTU19D\nUklUOgogICAgICAgICAgICAgICAgICAgIGZtLmdldEtleU1hcHBpbmcoKS5n\nZXRWYWx1ZUluZm8oKS5zZXRVc2VDbGFzc0NyaXRlcmlhCiAgICAgICAgICAg\nICAgICAgICAgICAgICgoKEtleUNsYXNzQ3JpdGVyaWEpIGFubm8pLnZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBLRVlfQ09MOgogICAgICAgICAgICAgICAgICAgIHBhcnNlS2V5\nQ29sdW1ucyhmbSwgKEtleUNvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEtFWV9DT0xTOgog\nICAgICAgICAgICAgICAgICAgIHBhcnNlS2V5Q29sdW1ucyhmbSwgKChLZXlD\nb2x1bW5zKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgS0VZX0VNQkVEREVEX01BUFBJ\nTkc6CiAgICAgICAgICAgICAgICAgICAgS2V5RW1iZWRkZWRNYXBwaW5nIGtl\nbWJlZCA9IChLZXlFbWJlZGRlZE1hcHBpbmcpIGFubm87CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VFbWJlZGRlZE1hcHBpbmcoZm0uZ2V0S2V5TWFwcGlu\nZygpLAogICAgICAgICAgICAgICAgICAgICAgICBrZW1iZWQubnVsbEluZGlj\nYXRvckNvbHVtbk5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAga2Vt\nYmVkLm51bGxJbmRpY2F0b3JBdHRyaWJ1dGVOYW1lKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgIGtlbWJlZC5vdmVycmlkZXMoKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEtFWV9GSzoK\nICAgICAgICAgICAgICAgICAgICBLZXlGb3JlaWduS2V5IGtmayA9IChLZXlG\nb3JlaWduS2V5KSBhbm5vOwogICAgICAgICAgICAgICAgICAgIHBhcnNlRm9y\nZWlnbktleShmbS5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCksCiAg\nICAgICAgICAgICAgICAgICAgICAgIGtmay5uYW1lKCksIGtmay5lbmFibGVk\nKCksIGtmay5kZWZlcnJlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBr\nZmsuZGVsZXRlQWN0aW9uKCksIGtmay51cGRhdGVBY3Rpb24oKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEtF\nWV9JTkRFWDoKICAgICAgICAgICAgICAgICAgICBLZXlJbmRleCBraWR4ID0g\nKEtleUluZGV4KSBhbm5vOwogICAgICAgICAgICAgICAgICAgIHBhcnNlSW5k\nZXgoZm0uZ2V0S2V5TWFwcGluZygpLmdldFZhbHVlSW5mbygpLCBraWR4Lm5h\nbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAga2lkeC5lbmFibGVkKCks\nIGtpZHgudW5pcXVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBLRVlfSk9JTl9DT0w6CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VLZXlKb2luQ29sdW1ucyhmbSwgKEtleUpvaW5Db2x1\nbW4pIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBLRVlfSk9JTl9DT0xTOgogICAgICAgICAgICAgICAg\nICAgIHBhcnNlS2V5Sm9pbkNvbHVtbnMoZm0sICgoS2V5Sm9pbkNvbHVtbnMp\nIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBLRVlfTk9OUE9MWToKICAgICAgICAgICAg\nICAgICAgICBmbS5nZXRLZXlNYXBwaW5nKCkuc2V0UG9seW1vcnBoaWModG9Q\nb2x5bW9ycGhpY0NvbnN0YW50CiAgICAgICAgICAgICAgICAgICAgICAgICgo\nKEtleU5vbnBvbHltb3JwaGljKSBhbm5vKS52YWx1ZSgpKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEtFWV9T\nVFJBVDoKICAgICAgICAgICAgICAgICAgICBmbS5nZXRLZXlNYXBwaW5nKCku\nZ2V0VmFsdWVJbmZvKCkKICAgICAgICAgICAgICAgICAgICAgICAgLnNldFN0\ncmF0ZWd5KCgoS2V5U3RyYXRlZ3kpIGFubm8pLnZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQS19K\nT0lOX0NPTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZVByaW1hcnlLZXlK\nb2luQ29sdW1ucyhmbSwgKFByaW1hcnlLZXlKb2luQ29sdW1uKSBhbm5vKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgUEtfSk9JTl9DT0xTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlUHJp\nbWFyeUtleUpvaW5Db2x1bW5zKGZtLAogICAgICAgICAgICAgICAgICAgICAg\nICAoKFByaW1hcnlLZXlKb2luQ29sdW1ucykgYW5ubykuCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB2YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVEFCTEVfR0VOOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlVGFibGVHZW5lcmF0b3IoZWwsIChUYWJs\nZUdlbmVyYXRvcikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIFRFTVBPUkFMOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlVGVtcG9yYWwoZm0sIChUZW1wb3JhbCkgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIENMQVNTX0NSSVQ6CiAgICAgICAgICAgICAgICAgICAgZm0uZ2V0VmFsdWVJ\nbmZvKCkuc2V0VXNlQ2xhc3NDcml0ZXJpYQogICAgICAgICAgICAgICAgICAg\nICAgICAoKChDbGFzc0NyaXRlcmlhKSBhbm5vKS52YWx1ZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQ09O\nVEFJTkVSX1RBQkxFOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQ29udGFp\nbmVyVGFibGUoZm0sIChDb250YWluZXJUYWJsZSkgYW5ubyk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVBR0VS\nX0ZFVENIX01PREU6CiAgICAgICAgICAgICAgICAgICAgZm0uc2V0RWFnZXJG\nZXRjaE1vZGUodG9FYWdlckZldGNoTW9kZUNvbnN0YW50CiAgICAgICAgICAg\nICAgICAgICAgICAgICgoKEVhZ2VyRmV0Y2hNb2RlKSBhbm5vKS52YWx1ZSgp\nKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEVMRU1fQ0xBU1NfQ1JJVDoKICAgICAgICAgICAgICAgICAgICBm\nbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLnNldFVzZUNs\nYXNzQ3JpdGVyaWEKICAgICAgICAgICAgICAgICAgICAgICAgKCgoRWxlbWVu\ndENsYXNzQ3JpdGVyaWEpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTEVNX0NPTDoK\nICAgICAgICAgICAgICAgICAgICBwYXJzZUVsZW1lbnRDb2x1bW5zKGZtLCAo\nRWxlbWVudENvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fQ09MUzoKICAgICAgICAg\nICAgICAgICAgICBwYXJzZUVsZW1lbnRDb2x1bW5zKGZtLCAoKEVsZW1lbnRD\nb2x1bW5zKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9FTUJFRERFRF9NQVBQ\nSU5HOgogICAgICAgICAgICAgICAgICAgIEVsZW1lbnRFbWJlZGRlZE1hcHBp\nbmcgZWUgPSAoRWxlbWVudEVtYmVkZGVkTWFwcGluZykgYW5ubzsKICAgICAg\nICAgICAgICAgICAgICBwYXJzZUVtYmVkZGVkTWFwcGluZyhmbS5nZXRFbGVt\nZW50TWFwcGluZygpLAogICAgICAgICAgICAgICAgICAgICAgICBlZS5udWxs\nSW5kaWNhdG9yQXR0cmlidXRlTmFtZSgpLAogICAgICAgICAgICAgICAgICAg\nICAgICBlZS5udWxsSW5kaWNhdG9yQ29sdW1uTmFtZSgpLAogICAgICAgICAg\nICAgICAgICAgICAgICBlZS5vdmVycmlkZXMoKSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fRks6CiAg\nICAgICAgICAgICAgICAgICAgRWxlbWVudEZvcmVpZ25LZXkgZWZrID0gKEVs\nZW1lbnRGb3JlaWduS2V5KSBhbm5vOwogICAgICAgICAgICAgICAgICAgIHBh\ncnNlRm9yZWlnbktleShmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVl\nSW5mbygpLAogICAgICAgICAgICAgICAgICAgICAgICBlZmsubmFtZSgpLCBl\nZmsuZW5hYmxlZCgpLCBlZmsuZGVmZXJyZWQoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgZWZrLmRlbGV0ZUFjdGlvbigpLCBlZmsudXBkYXRlQWN0aW9u\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBFTEVNX0lOREVYOgogICAgICAgICAgICAgICAgICAgIEVsZW1l\nbnRJbmRleCBlaWR4ID0gKEVsZW1lbnRJbmRleCkgYW5ubzsKICAgICAgICAg\nICAgICAgICAgICBwYXJzZUluZGV4KGZtLmdldEVsZW1lbnRNYXBwaW5nKCku\nZ2V0VmFsdWVJbmZvKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGVpZHgu\nbmFtZSgpLCBlaWR4LmVuYWJsZWQoKSwgZWlkeC51bmlxdWUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVM\nRU1fSk9JTl9DT0w6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbGVtZW50\nSm9pbkNvbHVtbnMoZm0sIChFbGVtZW50Sm9pbkNvbHVtbikgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEVMRU1fSk9JTl9DT0xTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlRWxl\nbWVudEpvaW5Db2x1bW5zKGZtLCAoKEVsZW1lbnRKb2luQ29sdW1ucykgYW5u\nbykuCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTEVN\nX05PTlBPTFk6CiAgICAgICAgICAgICAgICAgICAgZm0uZ2V0RWxlbWVudE1h\ncHBpbmcoKS5zZXRQb2x5bW9ycGhpYyh0b1BvbHltb3JwaGljQ29uc3RhbnQK\nICAgICAgICAgICAgICAgICAgICAgICAgKCgoRWxlbWVudE5vbnBvbHltb3Jw\naGljKSBhbm5vKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fU1RSQVQ6CiAgICAgICAg\nICAgICAgICAgICAgZm0uZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUlu\nZm8oKQogICAgICAgICAgICAgICAgICAgICAgICAuc2V0U3RyYXRlZ3koKChF\nbGVtZW50U3RyYXRlZ3kpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTUJFRERFRF9N\nQVBQSU5HOgogICAgICAgICAgICAgICAgICAgIHBhcnNlRW1iZWRkZWRNYXBw\naW5nKGZtLCAoRW1iZWRkZWRNYXBwaW5nKSBhbm5vKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRks6CiAgICAg\nICAgICAgICAgICAgICAgcGFyc2VGb3JlaWduS2V5KGZtLmdldFZhbHVlSW5m\nbygpLCAoRm9yZWlnbktleSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElOREVYOgogICAgICAgICAg\nICAgICAgICAgIHBhcnNlSW5kZXgoZm0uZ2V0VmFsdWVJbmZvKCksIChJbmRl\neCkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIE5PTlBPTFk6CiAgICAgICAgICAgICAgICAgICAgZm0u\nc2V0UG9seW1vcnBoaWModG9Qb2x5bW9ycGhpY0NvbnN0YW50CiAgICAgICAg\nICAgICAgICAgICAgICAgICgoKE5vbnBvbHltb3JwaGljKSBhbm5vKS52YWx1\nZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIE9SREVSX0NPTDoKICAgICAgICAgICAgICAgICAgICBwYXJz\nZU9yZGVyQ29sdW1uKGZtLCAoT3JkZXJDb2x1bW4pIGFubm8pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTVFJB\nVDoKICAgICAgICAgICAgICAgICAgICBmbS5nZXRWYWx1ZUluZm8oKS5zZXRT\ndHJhdGVneSgoKFN0cmF0ZWd5KSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVU5JUVVF\nOgogICAgICAgICAgICAgICAgICAgIHBhcnNlVW5pcXVlKGZtLAogICAgICAg\nICAgICAgICAgICAgICAgICAob3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3Rl\nbmNlLmpkYmMuVW5pcXVlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgWF9FTUJFRERFRF9NQVBQSU5H\nOgogICAgICAgICAgICAgICAgICAgIFhFbWJlZGRlZE1hcHBpbmcgZW1iZWQg\nPSAoWEVtYmVkZGVkTWFwcGluZykgYW5ubzsKICAgICAgICAgICAgICAgICAg\nICBwYXJzZUVtYmVkZGVkTWFwcGluZyhmbSwgZW1iZWQubnVsbEluZGljYXRv\nckNvbHVtbk5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgZW1iZWQu\nbnVsbEluZGljYXRvckF0dHJpYnV0ZU5hbWUoKSwgZW1iZWQub3ZlcnJpZGVz\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBYX0pPSU5fQ09MOgogICAgICAgICAgICAgICAgICAgIHBhcnNl\nWEpvaW5Db2x1bW5zKGZtLCBmbS5nZXRWYWx1ZUluZm8oKSwgdHJ1ZSwKICAg\nICAgICAgICAgICAgICAgICAgICAgKFhKb2luQ29sdW1uKSBhbm5vKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nWF9KT0lOX0NPTFM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VYSm9pbkNv\nbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCB0cnVlLAogICAgICAgICAg\nICAgICAgICAgICAgICAoKFhKb2luQ29sdW1ucykgYW5ubykudmFsdWUoKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBmbSwKICAg\nICAgICAgICAgICAgICAgICAgICAgYW5uby50b1N0cmluZygpKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxv\ndyBzdWJjbGFzc2VzIHRvIGhhbmRsZSB1bmtub3duIGFubm90YXRpb25zLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYW5kbGVVbmtub3duTWVt\nYmVyTWFwcGluZ0Fubm90YXRpb24oRmllbGRNYXBwaW5nIGZtLAogICAgICAg\nIEFubm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUge0BsaW5rIFZhbHVlTWFw\ncGluZ30gPGNvZGU+UE9MWV8qPC9jb2RlPiBjb25zdGFudCBmb3IKICAgICAq\nIHRoZSBnaXZlbiBlbnVtIHZhbHVlLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nc3RhdGljIGludCB0b1BvbHltb3JwaGljQ29uc3RhbnQoTm9ucG9seW1vcnBo\naWNUeXBlIHZhbCkgewogICAgICAgIHN3aXRjaCAodmFsKSB7CiAgICAgICAg\nICAgIGNhc2UgRVhBQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gVmFsdWVN\nYXBwaW5nLlBPTFlfRkFMU0U7CiAgICAgICAgICAgIGNhc2UgSk9JTkFCTEU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gVmFsdWVNYXBwaW5nLlBPTFlfSk9J\nTkFCTEU7CiAgICAgICAgICAgIGNhc2UgRkFMU0U6CiAgICAgICAgICAgICAg\nICByZXR1cm4gVmFsdWVNYXBwaW5nLlBPTFlfVFJVRTsKICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4\nY2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIGdpdmVuIEBBc3NvY2lhdGlvbk92ZXJyaWRlIGFubm90YXRpb25zIG9u\nIGFuIGVtYmVkZGVkIG1hcHBpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZUFzc29jaWF0aW9uT3ZlcnJpZGVzKEZpZWxkTWFwcGluZyBmbSwK\nICAgICAgICBBc3NvY2lhdGlvbk92ZXJyaWRlLi4uIGFzc29jcykgewogICAg\nICAgIENsYXNzTWFwcGluZyBlbWJlZCA9IGZtLmdldEVtYmVkZGVkTWFwcGlu\nZygpOwogICAgICAgIGlmIChlbWJlZCA9PSBudWxsKQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1lbWJl\nZGRlZCIsIGZtKSk7CgogICAgICAgIEZpZWxkTWFwcGluZyBlZm07CiAgICAg\nICAgSm9pbkNvbHVtbltdIGVjb2xzOwogICAgICAgIGludCB1bmlxdWU7CiAg\nICAgICAgTGlzdDxDb2x1bW4+IGpjb2xzOwogICAgICAgIGZvciAoQXNzb2Np\nYXRpb25PdmVycmlkZSBhc3NvYyA6IGFzc29jcykgewogICAgICAgICAgICBl\nZm0gPSBlbWJlZC5nZXRGaWVsZE1hcHBpbmcoYXNzb2MubmFtZSgpKTsKICAg\nICAgICAgICAgaWYgKGVmbSA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbWJlZC1vdmVy\ncmlkZS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICBmbSwgYXNzb2MubmFt\nZSgpKSk7CiAgICAgICAgICAgIGVjb2xzID0gYXNzb2Muam9pbkNvbHVtbnMo\nKTsKICAgICAgICAgICAgaWYgKGVjb2xzID09IG51bGwgfHwgZWNvbHMubGVu\nZ3RoID09IDApCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg\nICAgIHVuaXF1ZSA9IDA7CiAgICAgICAgICAgIGpjb2xzID0gbmV3IEFycmF5\nTGlzdDxDb2x1bW4+KGVjb2xzLmxlbmd0aCk7CiAgICAgICAgICAgIGZvciAo\nSm9pbkNvbHVtbiBlY29sIDogZWNvbHMpIHsKICAgICAgICAgICAgICAgIHVu\naXF1ZSB8PSAoZWNvbC51bmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7CiAgICAg\nICAgICAgICAgICBqY29scy5hZGQobmV3Q29sdW1uKGVjb2wpKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBzZXRDb2x1bW5zKGVmbSwgZWZtLmdldFZh\nbHVlSW5mbygpLCBqY29scywgdW5pcXVlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBnaXZlbiBAQXR0cmlidXRlT3ZlcnJpZGUg\nYW5ub3RhdGlvbnMgb24gYW4gZW1iZWRkZWQgbWFwcGluZy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlQXR0cmlidXRlT3ZlcnJpZGVzKEZpZWxk\nTWFwcGluZyBmbSwKICAgICAgICBBdHRyaWJ1dGVPdmVycmlkZS4uLiBhdHRy\ncykgewogICAgICAgIENsYXNzTWFwcGluZyBlbWJlZCA9IGZtLmdldEVtYmVk\nZGVkTWFwcGluZygpOwogICAgICAgIGlmIChlbWJlZCA9PSBudWxsKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vdC1lbWJlZGRlZCIsIGZtKSk7CgogICAgICAgIEZpZWxkTWFwcGluZyBl\nZm07CiAgICAgICAgZm9yIChBdHRyaWJ1dGVPdmVycmlkZSBhdHRyIDogYXR0\ncnMpIHsKICAgICAgICAgICAgZWZtID0gZW1iZWQuZ2V0RmllbGRNYXBwaW5n\nKGF0dHIubmFtZSgpKTsKICAgICAgICAgICAgaWYgKGVmbSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJlbWJlZC1vdmVycmlkZS1uYW1lIiwKICAgICAgICAgICAgICAg\nICAgICBmbSwgYXR0ci5uYW1lKCkpKTsKICAgICAgICAgICAgaWYgKGF0dHIu\nY29sdW1uKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHBhcnNlQ29sdW1u\ncyhlZm0sIGF0dHIuY29sdW1uKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIEBFbnVtZXJhdGVkLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcGFyc2VFbnVtZXJhdGVkKEZpZWxkTWFwcGluZyBmbSwgRW51\nbWVyYXRlZCBhbm5vKSB7CiAgICAgICAgU3RyaW5nIHN0cmF0ID0gRW51bVZh\nbHVlSGFuZGxlci5jbGFzcy5nZXROYW1lKCkgKyAiKFN0b3JlT3JkaW5hbD0i\nCiAgICAgICAgICAgICsgU3RyaW5nLnZhbHVlT2YoYW5uby52YWx1ZSgpID09\nIEVudW1UeXBlLk9SRElOQUwpICsgIikiOwogICAgICAgIGZtLmdldFZhbHVl\nSW5mbygpLnNldFN0cmF0ZWd5KHN0cmF0KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBUZW1wb3JhbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHBhcnNlVGVtcG9yYWwoRmllbGRNYXBwaW5nIGZtLCBUZW1wb3JhbCBhbm5v\nKSB7CiAgICAgICAgTGlzdCBjb2xzID0gZm0uZ2V0VmFsdWVJbmZvKCkuZ2V0\nQ29sdW1ucygpOwogICAgICAgIGlmICghY29scy5pc0VtcHR5KCkgJiYgY29s\ncy5zaXplKCkgIT0gMSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJudW0tY29scy1taXNtYXRjaCIsIGZtLAog\nICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YoY29scy5zaXplKCkpLCAi\nMSIpKTsKICAgICAgICBpZiAoY29scy5pc0VtcHR5KCkpIHsKICAgICAgICAg\nICAgY29scyA9IEFycmF5cy5hc0xpc3QobmV3IENvbHVtbltdeyBuZXcgQ29s\ndW1uKCkgfSk7CiAgICAgICAgICAgIGZtLmdldFZhbHVlSW5mbygpLnNldENv\nbHVtbnMoY29scyk7CiAgICAgICAgfQoKICAgICAgICBDb2x1bW4gY29sID0g\nKENvbHVtbikgY29scy5nZXQoMCk7CiAgICAgICAgc3dpdGNoIChhbm5vLnZh\nbHVlKCkpIHsKICAgICAgICAgICAgY2FzZSBEQVRFOgogICAgICAgICAgICAg\nICAgY29sLnNldFR5cGUoVHlwZXMuREFURSk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBUSU1FOgogICAgICAgICAgICAgICAg\nY29sLnNldFR5cGUoVHlwZXMuVElNRSk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBUSU1FU1RBTVA6CiAgICAgICAgICAgICAg\nICBjb2wuc2V0VHlwZShUeXBlcy5USU1FU1RBTVApOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFy\nc2UgQENvbHVtbihzKS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFy\nc2VDb2x1bW5zKEZpZWxkTWFwcGluZyBmbSwKICAgICAgICBqYXZheC5wZXJz\naXN0ZW5jZS5Db2x1bW4uLi4gcGNvbHMpIHsKICAgICAgICBpZiAocGNvbHMu\nbGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\nbWlnaHQgYWxyZWFkeSBoYXZlIHNvbWUgY29sdW1uIGluZm9ybWF0aW9uIGZy\nb20gbWFwcGluZyBhbm5vdGF0aW9uCiAgICAgICAgTGlzdCBjb2xzID0gZm0u\nZ2V0VmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygpOwogICAgICAgIGlmICghY29s\ncy5pc0VtcHR5KCkgJiYgY29scy5zaXplKCkgIT0gcGNvbHMubGVuZ3RoKQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm51bS1jb2xzLW1pc21hdGNoIiwgZm0sCiAgICAgICAgICAgICAgICBT\ndHJpbmcudmFsdWVPZihjb2xzLnNpemUoKSksIFN0cmluZy52YWx1ZU9mKHBj\nb2xzLmxlbmd0aCkpKTsKCiAgICAgICAgLy8gY2FjaGUgdGhlIEpBWEIgWG1s\nVHlwZSBjbGFzcyBpZiBpdCBpcyBwcmVzZW50IHNvIHdlIGRvIG5vdAogICAg\nICAgIC8vIGhhdmUgYSBoYXJkLXdpcmVkIGRlcGVuZGVuY3kgb24gSkFYQiBo\nZXJlCiAgICAgICAgQ2xhc3MgeG1sVHlwZUNsYXNzID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICB4bWxUeXBlQ2xhc3MgPSBDbGFzcy5mb3JO\nYW1lKCJqYXZheC54bWwuYmluZC5hbm5vdGF0aW9uLlhtbFR5cGUiKTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgIH0KCiAgICAg\nICAgaW50IHVuaXF1ZSA9IDA7CiAgICAgICAgU3RyaW5nIHNlY29uZGFyeSA9\nIG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwY29scy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY29scy5zaXplKCkgPiBpKQog\nICAgICAgICAgICAgICAgc2V0dXBDb2x1bW4oKENvbHVtbikgY29scy5nZXQo\naSksIHBjb2xzW2ldKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nICAgICBpZiAoY29scy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAg\nY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihwY29scy5sZW5ndGgpOwog\nICAgICAgICAgICAgICAgY29scy5hZGQobmV3Q29sdW1uKHBjb2xzW2ldKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh4\nbWxUeXBlQ2xhc3MgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgU3RyaW5n\nVXRpbHMuaXNFbXB0eShwY29sc1tpXS5jb2x1bW5EZWZpbml0aW9uKCkpCiAg\nICAgICAgICAgICAgICAmJiAoKEJvb2xlYW4pIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKEoyRG9Qcml2NUhlbHBlcgogICAgICAgICAgICAgICAg\nICAgIC5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKGZtLmdldERlY2xhcmVk\nVHlwZSgpLAogICAgICAgICAgICAgICAgICAgICAgICB4bWxUeXBlQ2xhc3Mp\nKSkuYm9vbGVhblZhbHVlKCkpIHsKICAgICAgICAgICAgICAgIERCRGljdGlv\nbmFyeSBkaWN0ID0gKChNYXBwaW5nUmVwb3NpdG9yeSkgZ2V0UmVwb3NpdG9y\neSgpKQogICAgICAgICAgICAgICAgICAgIC5nZXREQkRpY3Rpb25hcnkoKTsK\nICAgICAgICAgICAgICAgIGlmIChkaWN0LnN1cHBvcnRzWE1MQ29sdW1uKQog\nICAgICAgICAgICAgICAgICAgIC8vIGNvbHVtbiBtYXBzIHRvIHhtbCB0eXBl\nCiAgICAgICAgICAgICAgICAgICAgKChDb2x1bW4pIGNvbHMuZ2V0KGkpKS5z\nZXRUeXBlTmFtZShkaWN0LnhtbFR5cGVOYW1lKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgdW5pcXVlIHw9IChwY29sc1tpXS51bmlxdWUoKSkgPyBU\nUlVFIDogRkFMU0U7CiAgICAgICAgICAgIHNlY29uZGFyeSA9IHRyYWNrU2Vj\nb25kYXJ5VGFibGUoZm0sIHNlY29uZGFyeSwKICAgICAgICAgICAgICAgIHBj\nb2xzW2ldLnRhYmxlKCksIGkpOwogICAgICAgIH0KCiAgICAgICAgc2V0Q29s\ndW1ucyhmbSwgZm0uZ2V0VmFsdWVJbmZvKCksIGNvbHMsIHVuaXF1ZSk7CiAg\nICAgICAgaWYgKHNlY29uZGFyeSAhPSBudWxsKQogICAgICAgICAgICBmbS5n\nZXRNYXBwaW5nSW5mbygpLnNldFRhYmxlTmFtZShzZWNvbmRhcnkpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBjb2x1bW4g\nd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9uLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29sdW1uKGph\ndmF4LnBlcnNpc3RlbmNlLkNvbHVtbiBhbm5vKSB7CiAgICAgICAgQ29sdW1u\nIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBzZXR1cENvbHVtbihjb2ws\nIGFubm8pOwogICAgICAgIHJldHVybiBjb2w7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXR1cCB0aGUgZ2l2ZW4gY29sdW1uIHdpdGggaW5mb3JtYXRpb24g\nZnJvbSB0aGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgdm9pZCBzZXR1cENvbHVtbihDb2x1bW4gY29sLCBqYXZheC5w\nZXJzaXN0ZW5jZS5Db2x1bW4gYW5ubykgewogICAgICAgIGlmICghU3RyaW5n\nVXRpbHMuaXNFbXB0eShhbm5vLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5z\nZXROYW1lKGFubm8ubmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkoYW5uby5jb2x1bW5EZWZpbml0aW9uKCkpKQogICAgICAgICAg\nICBjb2wuc2V0VHlwZU5hbWUoYW5uby5jb2x1bW5EZWZpbml0aW9uKCkpOwog\nICAgICAgIGlmIChhbm5vLnByZWNpc2lvbigpICE9IDApCiAgICAgICAgICAg\nIGNvbC5zZXRTaXplKGFubm8ucHJlY2lzaW9uKCkpOwogICAgICAgIGVsc2Ug\naWYgKGFubm8ubGVuZ3RoKCkgIT0gMjU1KQogICAgICAgICAgICBjb2wuc2V0\nU2l6ZShhbm5vLmxlbmd0aCgpKTsKICAgICAgICBjb2wuc2V0Tm90TnVsbCgh\nYW5uby5udWxsYWJsZSgpKTsKICAgICAgICBjb2wuc2V0RGVjaW1hbERpZ2l0\ncyhhbm5vLnNjYWxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5G\nTEFHX1VOSU5TRVJUQUJMRSwgIWFubm8uaW5zZXJ0YWJsZSgpKTsKICAgICAg\nICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgIWFubm8u\ndXBkYXRhYmxlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBn\naXZlbiBjb2x1bW5zIGFzIHRoZSBjb2x1bW5zIGZvciA8Y29kZT5mbTwvY29k\nZT4uCiAgICAgKgogICAgICogQHBhcmFtIHVuaXF1ZSBiaXR3aXNlIGNvbWJp\nbmF0aW9uIG9mIFRSVUUgYW5kIEZBTFNFIGZvciB0aGUKICAgICAqIHVuaXF1\nZSBhdHRyaWJ1dGUgb2YgZWFjaCBjb2x1bW4KICAgICAqLwogICAgcHJvdGVj\ndGVkIHZvaWQgc2V0Q29sdW1ucyhGaWVsZE1hcHBpbmcgZm0sIE1hcHBpbmdJ\nbmZvIGluZm8sCiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMsIGludCB1bmlx\ndWUpIHsKICAgICAgICBpbmZvLnNldENvbHVtbnMoY29scyk7CiAgICAgICAg\naWYgKHVuaXF1ZSA9PSBUUlVFKQogICAgICAgICAgICBpbmZvLnNldFVuaXF1\nZShuZXcgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZSgp\nKTsKCiAgICAgICAgLy8jIyMgRUpCMwogICAgICAgIExvZyBsb2cgPSBnZXRM\nb2coKTsKICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSAmJiB1bmlx\ndWUgPT0gKFRSVUUgfCBGQUxTRSkpCiAgICAgICAgICAgIGxvZy53YXJuKF9s\nb2MuZ2V0KCJpbmNvbnNpc3QtY29sLWF0dHJzIiwgZm0pKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEhlbHBlciB0byB0cmFjayB0aGUgc2Vjb25kYXJ5IHRh\nYmxlIGZvciBhIHNldCBvZiBjb2x1bW5zLgogICAgICoKICAgICAqIEBwYXJh\nbSBzZWNvbmRhcnkgc2Vjb25kYXJ5IHRhYmxlIGZvciBsYXN0IGNvbHVtbgog\nICAgICogQHBhcmFtIGNvbFNlY29uZGFyeSBzZWNvbmRhcnkgdGFibGUgZm9y\nIGN1cnJlbnQgY29sdW1uCiAgICAgKiBAcmV0dXJuIHNlY29uZGFyeSB0YWJs\nZSBmb3IgZmllbGQKICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgdHJhY2tT\nZWNvbmRhcnlUYWJsZShGaWVsZE1hcHBpbmcgZm0sIFN0cmluZyBzZWNvbmRh\ncnksCiAgICAgICAgU3RyaW5nIGNvbFNlY29uZGFyeSwgaW50IGNvbCkgewog\nICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGNvbFNlY29uZGFyeSkp\nCiAgICAgICAgICAgIGNvbFNlY29uZGFyeSA9IG51bGw7CiAgICAgICAgaWYg\nKGNvbCA9PSAwKQogICAgICAgICAgICByZXR1cm4gY29sU2Vjb25kYXJ5Owog\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuZXF1YWxzSWdub3JlQ2FzZShzZWNv\nbmRhcnksIGNvbFNlY29uZGFyeSkpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgic2Vjb25kLWluY29uc2lzdCIs\nIGZtKSk7CiAgICAgICAgcmV0dXJuIHNlY29uZGFyeTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIEBKb2luVGFibGUuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBwYXJzZUpvaW5UYWJsZShGaWVsZE1hcHBpbmcgZm0sIEpvaW5U\nYWJsZSBqb2luKSB7CiAgICAgICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5zZXRU\nYWJsZU5hbWUodG9UYWJsZU5hbWUoam9pbi5zY2hlbWEoKSwKICAgICAgICAg\nICAgam9pbi5uYW1lKCkpKTsKICAgICAgICBwYXJzZUpvaW5Db2x1bW5zKGZt\nLCBmbS5nZXRNYXBwaW5nSW5mbygpLCBmYWxzZSwgam9pbi5qb2luQ29sdW1u\ncygpKTsKICAgICAgICBwYXJzZUpvaW5Db2x1bW5zKGZtLCBmbS5nZXRFbGVt\nZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLCBmYWxzZSwKICAgICAgICAg\nICAgam9pbi5pbnZlcnNlSm9pbkNvbHVtbnMoKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBnaXZlbiBASm9pbkNvbHVtbiBhbm5vdGF0aW9ucy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlSm9pbkNvbHVtbnMoRmll\nbGRNYXBwaW5nIGZtLCBNYXBwaW5nSW5mbyBpbmZvLAogICAgICAgIGJvb2xl\nYW4gc2Vjb25kYXJ5QWxsb3dlZCwgSm9pbkNvbHVtbi4uLiBqb2lucykgewog\nICAgICAgIGlmIChqb2lucy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxp\nc3Q8Q29sdW1uPihqb2lucy5sZW5ndGgpOwogICAgICAgIGludCB1bmlxdWUg\nPSAwOwogICAgICAgIFN0cmluZyBzZWNvbmRhcnkgPSBudWxsOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgY29scy5hZGQobmV3Q29sdW1uKGpvaW5zW2ldKSk7CiAgICAg\nICAgICAgIHVuaXF1ZSB8PSAoam9pbnNbaV0udW5pcXVlKCkpID8gVFJVRSA6\nIEZBTFNFOwogICAgICAgICAgICBzZWNvbmRhcnkgPSB0cmFja1NlY29uZGFy\neVRhYmxlKGZtLCBzZWNvbmRhcnksCiAgICAgICAgICAgICAgICBqb2luc1tp\nXS50YWJsZSgpLCBpKTsKICAgICAgICAgICAgaWYgKCFzZWNvbmRhcnlBbGxv\nd2VkICYmIHNlY29uZGFyeSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtc2Vjb25k\nIiwgZm0pKTsKICAgICAgICB9CgogICAgICAgIHNldENvbHVtbnMoZm0sIGlu\nZm8sIGNvbHMsIHVuaXF1ZSk7CiAgICAgICAgaWYgKHNlY29uZGFyeSAhPSBu\ndWxsKQogICAgICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygpLnNldFRhYmxl\nTmFtZShzZWNvbmRhcnkpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIGEgbmV3IHNjaGVtYSBjb2x1bW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRo\nZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBDb2x1bW4gbmV3Q29sdW1uKEpvaW5Db2x1bW4gam9pbikgewogICAgICAg\nIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKCFTdHJp\nbmdVdGlscy5pc0VtcHR5KGpvaW4ubmFtZSgpKSkKICAgICAgICAgICAgY29s\nLnNldE5hbWUoam9pbi5uYW1lKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eShqb2luLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAg\nICAgIGNvbC5zZXRUeXBlTmFtZShqb2luLmNvbHVtbkRlZmluaXRpb24oKSk7\nCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ucmVmZXJl\nbmNlZENvbHVtbk5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRUYXJnZXQo\nam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKTsKICAgICAgICBjb2wuc2V0\nTm90TnVsbCgham9pbi5udWxsYWJsZSgpKTsKICAgICAgICBjb2wuc2V0Rmxh\nZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFqb2luLmluc2VydGFibGUo\nKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFC\nTEUsICFqb2luLnVwZGF0YWJsZSgpKTsKICAgICAgICByZXR1cm4gY29sOwog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQEtleUNvbHVtbihzKS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlS2V5Q29sdW1ucyhGaWVsZE1h\ncHBpbmcgZm0sIEtleUNvbHVtbi4uLiBwY29scykgewogICAgICAgIGlmIChw\nY29scy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBMaXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihw\nY29scy5sZW5ndGgpOwogICAgICAgIGludCB1bmlxdWUgPSAwOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgcGNvbHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgY29scy5hZGQobmV3Q29sdW1uKHBjb2xzW2ldKSk7CiAgICAg\nICAgICAgIHVuaXF1ZSB8PSAocGNvbHNbaV0udW5pcXVlKCkpID8gVFJVRSA6\nIEZBTFNFOwogICAgICAgIH0KICAgICAgICBzZXRDb2x1bW5zKGZtLCBmbS5n\nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCksIGNvbHMsIHVuaXF1ZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc2NoZW1hIGNv\nbHVtbiB3aXRoIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENvbHVtbiBuZXdDb2x1\nbW4oS2V5Q29sdW1uIGFubm8pIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3\nIENvbHVtbigpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShh\nbm5vLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXROYW1lKGFubm8ubmFt\nZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5j\nb2x1bW5EZWZpbml0aW9uKCkpKQogICAgICAgICAgICBjb2wuc2V0VHlwZU5h\nbWUoYW5uby5jb2x1bW5EZWZpbml0aW9uKCkpOwogICAgICAgIGlmIChhbm5v\nLnByZWNpc2lvbigpICE9IDApCiAgICAgICAgICAgIGNvbC5zZXRTaXplKGFu\nbm8ucHJlY2lzaW9uKCkpOwogICAgICAgIGVsc2UgaWYgKGFubm8ubGVuZ3Ro\nKCkgIT0gMjU1KQogICAgICAgICAgICBjb2wuc2V0U2l6ZShhbm5vLmxlbmd0\naCgpKTsKICAgICAgICBjb2wuc2V0Tm90TnVsbCghYW5uby5udWxsYWJsZSgp\nKTsKICAgICAgICBjb2wuc2V0RGVjaW1hbERpZ2l0cyhhbm5vLnNjYWxlKCkp\nOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJM\nRSwgIWFubm8uaW5zZXJ0YWJsZSgpKTsKICAgICAgICBjb2wuc2V0RmxhZyhD\nb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgIWFubm8udXBkYXRhYmxlKCkpOwog\nICAgICAgIHJldHVybiBjb2w7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBnaXZlbiBAUHJpbWFyeUtleUpvaW5Db2x1bW4gYW5ub3RhdGlvbnMuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVByaW1hcnlLZXlKb2luQ29s\ndW1ucyhGaWVsZE1hcHBpbmcgZm0sCiAgICAgICAgUHJpbWFyeUtleUpvaW5D\nb2x1bW4uLi4gam9pbnMpIHsKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9\nIG5ldyBBcnJheUxpc3Q8Q29sdW1uPihqb2lucy5sZW5ndGgpOwogICAgICAg\nIGZvciAoUHJpbWFyeUtleUpvaW5Db2x1bW4gam9pbiA6IGpvaW5zKQogICAg\nICAgICAgICBjb2xzLmFkZChuZXdDb2x1bW4oam9pbikpOwogICAgICAgIHNl\ndENvbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCBjb2xzLCAwKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGdpdmVuIEBYSm9pbkNvbHVtbiBh\nbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VY\nSm9pbkNvbHVtbnMoRmllbGRNYXBwaW5nIGZtLCBNYXBwaW5nSW5mbyBpbmZv\nLAogICAgICAgIGJvb2xlYW4gc2Vjb25kYXJ5QWxsb3dlZCwgWEpvaW5Db2x1\nbW4uLi4gam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMubGVuZ3RoID09IDAp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdDxDb2x1bW4+IGNv\nbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oam9pbnMubGVuZ3RoKTsKICAg\nICAgICBpbnQgdW5pcXVlID0gMDsKICAgICAgICBTdHJpbmcgc2Vjb25kYXJ5\nID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGpvaW5zLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbHMuYWRkKG5ld0NvbHVtbihq\nb2luc1tpXSkpOwogICAgICAgICAgICB1bmlxdWUgfD0gKGpvaW5zW2ldLnVu\naXF1ZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICAgICAgc2Vjb25kYXJ5\nID0gdHJhY2tTZWNvbmRhcnlUYWJsZShmbSwgc2Vjb25kYXJ5LAogICAgICAg\nICAgICAgICAgam9pbnNbaV0udGFibGUoKSwgaSk7CiAgICAgICAgICAgIGlm\nICghc2Vjb25kYXJ5QWxsb3dlZCAmJiBzZWNvbmRhcnkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiYmFkLXNlY29uZCIsIGZtKSk7CiAgICAgICAgfQoKICAgICAgICBz\nZXRDb2x1bW5zKGZtLCBpbmZvLCBjb2xzLCB1bmlxdWUpOwogICAgICAgIGlm\nIChzZWNvbmRhcnkgIT0gbnVsbCkKICAgICAgICAgICAgZm0uZ2V0TWFwcGlu\nZ0luZm8oKS5zZXRUYWJsZU5hbWUoc2Vjb25kYXJ5KTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIG5ldyBzY2hlbWEgY29sdW1uIHdpdGggaW5m\nb3JtYXRpb24gZnJvbSB0aGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgQ29sdW1uIG5ld0NvbHVtbihYSm9pbkNvbHVt\nbiBqb2luKSB7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsK\nICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5uYW1lKCkp\nKQogICAgICAgICAgICBjb2wuc2V0TmFtZShqb2luLm5hbWUoKSk7CiAgICAg\nICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4uY29sdW1uRGVmaW5p\ndGlvbigpKSkKICAgICAgICAgICAgY29sLnNldFR5cGVOYW1lKGpvaW4uY29s\ndW1uRGVmaW5pdGlvbigpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlz\nRW1wdHkoam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKSkKICAgICAgICAg\nICAgY29sLnNldFRhcmdldChqb2luLnJlZmVyZW5jZWRDb2x1bW5OYW1lKCkp\nOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLnJlZmVy\nZW5jZWRBdHRyaWJ1dGVOYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0VGFy\nZ2V0RmllbGQoam9pbi5yZWZlcmVuY2VkQXR0cmlidXRlTmFtZSgpKTsKICAg\nICAgICBjb2wuc2V0Tm90TnVsbCgham9pbi5udWxsYWJsZSgpKTsKICAgICAg\nICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFqb2lu\nLmluc2VydGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZM\nQUdfVU5VUERBVEFCTEUsICFqb2luLnVwZGF0YWJsZSgpKTsKICAgICAgICBy\nZXR1cm4gY29sOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgZW1iZWRk\nZWQgaW5mbyBmb3IgdGhlIGdpdmVuIG1hcHBpbmcuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBwYXJzZUVtYmVkZGVkTWFwcGluZyhGaWVsZE1hcHBpbmcg\nZm0sIEVtYmVkZGVkTWFwcGluZyBhbm5vKSB7CiAgICAgICAgQ2xhc3NNYXBw\naW5nIGVtYmVkID0gZm0uZ2V0RW1iZWRkZWRNYXBwaW5nKCk7CiAgICAgICAg\naWYgKGVtYmVkID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWVtYmVkZGVkIiwgZm0pKTsK\nCiAgICAgICAgRmllbGRNYXBwaW5nIGVmbTsKICAgICAgICBmb3IgKE1hcHBp\nbmdPdmVycmlkZSBvdmVyIDogYW5uby5vdmVycmlkZXMoKSkgewogICAgICAg\nICAgICBlZm0gPSBlbWJlZC5nZXRGaWVsZE1hcHBpbmcob3Zlci5uYW1lKCkp\nOwogICAgICAgICAgICBpZiAoZWZtID09IG51bGwpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImVtYmVk\nLW92ZXJyaWRlLW5hbWUiLAogICAgICAgICAgICAgICAgICAgIGZtLCBvdmVy\nLm5hbWUoKSkpOwogICAgICAgICAgICBwb3B1bGF0ZShlZm0sIG92ZXIpOwog\nICAgICAgIH0KCiAgICAgICAgU3RyaW5nIG51bGxJbmQgPSBudWxsOwogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm51bGxJbmRpY2F0\nb3JBdHRyaWJ1dGVOYW1lKCkpKQogICAgICAgICAgICBudWxsSW5kID0gYW5u\nby5udWxsSW5kaWNhdG9yQXR0cmlidXRlTmFtZSgpOwogICAgICAgIGVsc2Ug\naWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubnVsbEluZGljYXRvckNv\nbHVtbk5hbWUoKSkpCiAgICAgICAgICAgIG51bGxJbmQgPSBhbm5vLm51bGxJ\nbmRpY2F0b3JDb2x1bW5OYW1lKCk7CiAgICAgICAgaWYgKG51bGxJbmQgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBWYWx1ZU1hcHBp\nbmdJbmZvIGluZm8gPSBmbS5nZXRWYWx1ZUluZm8oKTsKICAgICAgICBwb3B1\nbGF0ZU51bGxJbmRpY2F0b3IobnVsbEluZCwgaW5mbyk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBlbWJlZGRlZCBpbmZvIGZvciB0aGUgZ2l2ZW4g\nbWFwcGluZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRW1iZWRk\nZWRNYXBwaW5nKFZhbHVlTWFwcGluZyB2bSwgCiAgICAgICAgU3RyaW5nIG51\nbGxJbmRpY2F0b3JBdHRyaWJ1dGUsIFN0cmluZyBudWxsSW5kaWNhdG9yQ29s\ndW1uLAogICAgICAgIFhNYXBwaW5nT3ZlcnJpZGVbXSBvdmVycmlkZXMpIHsK\nICAgICAgICBDbGFzc01hcHBpbmcgZW1iZWQgPSB2bS5nZXRFbWJlZGRlZE1h\ncHBpbmcoKTsKICAgICAgICBpZiAoZW1iZWQgPT0gbnVsbCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3Qt\nZW1iZWRkZWQiLCB2bSkpOwoKICAgICAgICBGaWVsZE1hcHBpbmcgZWZtOwog\nICAgICAgIGZvciAoWE1hcHBpbmdPdmVycmlkZSBvdmVyIDogb3ZlcnJpZGVz\nKSB7CiAgICAgICAgICAgIGVmbSA9IGVtYmVkLmdldEZpZWxkTWFwcGluZyhv\ndmVyLm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChlZm0gPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiZW1iZWQtb3ZlcnJpZGUtbmFtZSIsCiAgICAgICAgICAgICAgICAg\nICAgdm0sIG92ZXIubmFtZSgpKSk7CiAgICAgICAgICAgIHBvcHVsYXRlKGVm\nbSwgb3Zlcik7CiAgICAgICAgfQoKICAgICAgICBTdHJpbmcgbnVsbEluZCA9\nIG51bGw7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KG51bGxJ\nbmRpY2F0b3JBdHRyaWJ1dGUpKQogICAgICAgICAgICBudWxsSW5kID0gbnVs\nbEluZGljYXRvckF0dHJpYnV0ZTsKICAgICAgICBlbHNlIGlmICghU3RyaW5n\nVXRpbHMuaXNFbXB0eShudWxsSW5kaWNhdG9yQ29sdW1uKSkKICAgICAgICAg\nICAgbnVsbEluZCA9IG51bGxJbmRpY2F0b3JDb2x1bW47CiAgICAgICAgaWYg\nKG51bGxJbmQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBWYWx1ZU1hcHBpbmdJbmZvIGluZm8gPSB2bS5nZXRWYWx1ZUluZm8oKTsK\nICAgICAgICBwb3B1bGF0ZU51bGxJbmRpY2F0b3IobnVsbEluZCwgaW5mbyk7\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHBvcHVsYXRlTnVsbEluZGljYXRv\ncihTdHJpbmcgbnVsbEluZCwgVmFsdWVNYXBwaW5nSW5mbyBpbmZvKSB7CiAg\nICAgICAgaWYgKCJmYWxzZSIuZXF1YWxzKG51bGxJbmQpKQogICAgICAgICAg\nICBpbmZvLnNldENhbkluZGljYXRlTnVsbChmYWxzZSk7CiAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAg\nICAgICAgICAgIGlmICghInRydWUiLmVxdWFscyhudWxsSW5kKSkKICAgICAg\nICAgICAgICAgIGNvbC5zZXROYW1lKG51bGxJbmQpOwogICAgICAgICAgICBp\nbmZvLnNldENvbHVtbnMoQXJyYXlzLmFzTGlzdChuZXcgQ29sdW1uW117IGNv\nbCB9KSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Ug\nQENvbnRhaW5lclRhYmxlLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBw\nYXJzZUNvbnRhaW5lclRhYmxlKEZpZWxkTWFwcGluZyBmbSwgQ29udGFpbmVy\nVGFibGUgY3RibCkgewogICAgICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0\nVGFibGVOYW1lKHRvVGFibGVOYW1lKGN0Ymwuc2NoZW1hKCksCiAgICAgICAg\nICAgIGN0YmwubmFtZSgpKSk7CiAgICAgICAgcGFyc2VYSm9pbkNvbHVtbnMo\nZm0sIGZtLmdldE1hcHBpbmdJbmZvKCksIGZhbHNlLCBjdGJsLmpvaW5Db2x1\nbW5zKCkpOwogICAgICAgIGlmIChjdGJsLmpvaW5Gb3JlaWduS2V5KCkuc3Bl\nY2lmaWVkKCkpCiAgICAgICAgICAgIHBhcnNlRm9yZWlnbktleShmbS5nZXRN\nYXBwaW5nSW5mbygpLCBjdGJsLmpvaW5Gb3JlaWduS2V5KCkpOwogICAgICAg\nIGlmIChjdGJsLmpvaW5JbmRleCgpLnNwZWNpZmllZCgpKQogICAgICAgICAg\nICBwYXJzZUluZGV4KGZtLmdldE1hcHBpbmdJbmZvKCksIGN0Ymwuam9pbklu\nZGV4KCkpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE9yZGVyQ29s\ndW1uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VPcmRlckNvbHVt\nbihGaWVsZE1hcHBpbmcgZm0sIE9yZGVyQ29sdW1uIG9yZGVyKSB7CiAgICAg\nICAgaWYgKCFvcmRlci5lbmFibGVkKCkpIHsKICAgICAgICAgICAgZm0uZ2V0\nTWFwcGluZ0luZm8oKS5zZXRDYW5PcmRlckNvbHVtbihmYWxzZSk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIENvbHVtbiBjb2wg\nPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0Vt\ncHR5KG9yZGVyLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXROYW1lKG9y\nZGVyLm5hbWUoKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKG9yZGVyLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5z\nZXRUeXBlTmFtZShvcmRlci5jb2x1bW5EZWZpbml0aW9uKCkpOwogICAgICAg\nIGlmIChvcmRlci5wcmVjaXNpb24oKSAhPSAwKQogICAgICAgICAgICBjb2wu\nc2V0U2l6ZShvcmRlci5wcmVjaXNpb24oKSk7CiAgICAgICAgY29sLnNldEZs\nYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAhb3JkZXIuaW5zZXJ0YWJs\nZSgpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFU\nQUJMRSwgIW9yZGVyLnVwZGF0YWJsZSgpKTsKICAgICAgICBmbS5nZXRNYXBw\naW5nSW5mbygpLnNldE9yZGVyQ29sdW1uKGNvbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBARWxlbWVudEpvaW5Db2x1bW4ocykuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlRWxlbWVudEpvaW5Db2x1bW5zKEZp\nZWxkTWFwcGluZyBmbSwKICAgICAgICBFbGVtZW50Sm9pbkNvbHVtbi4uLiBq\nb2lucykgewogICAgICAgIGlmIChqb2lucy5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IG5l\ndyBBcnJheUxpc3Q8Q29sdW1uPihqb2lucy5sZW5ndGgpOwogICAgICAgIGlu\ndCB1bmlxdWUgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgam9p\nbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29scy5hZGQobmV3Q29s\ndW1uKGpvaW5zW2ldKSk7CiAgICAgICAgICAgIHVuaXF1ZSB8PSAoam9pbnNb\naV0udW5pcXVlKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAgIH0KICAgICAg\nICBzZXRDb2x1bW5zKGZtLCBmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZh\nbHVlSW5mbygpLCBjb2xzLCB1bmlxdWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBjb2x1bW4gd2l0aCBpbmZvcm1hdGlv\nbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29sdW1uKEVsZW1lbnRKb2luQ29sdW1u\nIGpvaW4pIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwog\nICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLm5hbWUoKSkp\nCiAgICAgICAgICAgIGNvbC5zZXROYW1lKGpvaW4ubmFtZSgpKTsKICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5jb2x1bW5EZWZpbml0\naW9uKCkpKQogICAgICAgICAgICBjb2wuc2V0VHlwZU5hbWUoam9pbi5jb2x1\nbW5EZWZpbml0aW9uKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNF\nbXB0eShqb2luLnJlZmVyZW5jZWRDb2x1bW5OYW1lKCkpKQogICAgICAgICAg\nICBjb2wuc2V0VGFyZ2V0KGpvaW4ucmVmZXJlbmNlZENvbHVtbk5hbWUoKSk7\nCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ucmVmZXJl\nbmNlZEF0dHJpYnV0ZU5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRUYXJn\nZXRGaWVsZChqb2luLnJlZmVyZW5jZWRBdHRyaWJ1dGVOYW1lKCkpOwogICAg\nICAgIGNvbC5zZXROb3ROdWxsKCFqb2luLm51bGxhYmxlKCkpOwogICAgICAg\nIGNvbC5zZXRGbGFnIChDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFqb2lu\nLmluc2VydGFibGUgKCkpOwoJCWNvbC5zZXRGbGFnIChDb2x1bW4uRkxBR19V\nTlVQREFUQUJMRSwgIWpvaW4udXBkYXRhYmxlICgpKTsKCQlyZXR1cm4gY29s\nOwoJfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBVbmlxdWUgbmV3VW5pcXVl\nKENsYXNzTWFwcGluZyBjbSwgU3RyaW5nIG5hbWUsIAogICAgICAgIFN0cmlu\nZ1tdIGNvbHVtbk5hbWVzKSB7CiAgICAgICAgaWYgKGNvbHVtbk5hbWVzID09\nIG51bGwgfHwgY29sdW1uTmFtZXMubGVuZ3RoID09IDApCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIFVuaXF1ZSB1bmlxdWVDb25zdHJhaW50\nID0gbmV3IFVuaXF1ZSgpOwogICAgICAgIHVuaXF1ZUNvbnN0cmFpbnQuc2V0\nTmFtZShuYW1lKTsKICAgICAgICBmb3IgKGludCBpPTA7IGk8Y29sdW1uTmFt\nZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxz\nLmlzRW1wdHkoY29sdW1uTmFtZXNbaV0pKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImVtcHR5LXVuaXF1ZS1j\nb2x1bW4iLCAKICAgICAgICAgICAgICAgICAgICBBcnJheXMudG9TdHJpbmco\nY29sdW1uTmFtZXMpLCBjbSkpOwogICAgICAgICAgICBDb2x1bW4gY29sdW1u\nID0gbmV3IENvbHVtbigpOwogICAgICAgICAgICBjb2x1bW4uc2V0TmFtZShj\nb2x1bW5OYW1lc1tpXSk7CiAgICAgICAgICAgIHVuaXF1ZUNvbnN0cmFpbnQu\nYWRkQ29sdW1uKGNvbHVtbik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1\nbmlxdWVDb25zdHJhaW50OwogICAgfQp9Cg==\n","encoding":"base64"}

