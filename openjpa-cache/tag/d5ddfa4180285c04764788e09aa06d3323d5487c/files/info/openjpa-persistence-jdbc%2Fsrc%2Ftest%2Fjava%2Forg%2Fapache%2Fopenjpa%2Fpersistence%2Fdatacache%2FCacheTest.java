{"sha":"2558974e54826c46edef481fd595192006678d9c","node_id":"MDQ6QmxvYjIwNjM2NDoyNTU4OTc0ZTU0ODI2YzQ2ZWRlZjQ4MWZkNTk1MTkyMDA2Njc4ZDlj","size":58880,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/2558974e54826c46edef481fd595192006678d9c","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\ncGVyc2lzdGVuY2UuZGF0YWNhY2hlOw0KDQppbXBvcnQgamF2YS51dGlsLkFy\ncmF5TGlzdDsNCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsNCmltcG9y\ndCBqYXZhLnV0aWwuRGF0ZTsNCmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsN\nCmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsNCmltcG9ydCBqYXZhLnV0aWwu\nSXRlcmF0b3I7DQppbXBvcnQgamF2YS51dGlsLkxpbmtlZExpc3Q7DQppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7DQppbXBvcnQgamF2YS51dGlsLkxvY2FsZTsN\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOw0KaW1wb3J0IGphdmEudXRpbC5TZXQ7\nDQppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50aXR5TWFuYWdlcjsNCg0K\nDQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLmRhdGFj\nYWNoZS5jb21tb24uYXBwcy5BcHBJZENhY2hlT2JqZWN0Ow0KaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29tbW9u\nLmFwcHMuQ2FjaGVPYmplY3RBOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29tbW9uLmFwcHMuQ2FjaGVPYmpl\nY3RBQ2hpbGQxOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0\nZW5jZS5kYXRhY2FjaGUuY29tbW9uLmFwcHMuQ2FjaGVPYmplY3RBQ2hpbGQy\nOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5kYXRh\nY2FjaGUuY29tbW9uLmFwcHMuQ2FjaGVPYmplY3RCOw0KaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29tbW9uLmFw\ncHMuQ2FjaGVPYmplY3RCQ2hpbGQxOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29tbW9uLmFwcHMuQ2FjaGVP\nYmplY3RDOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5j\nZS5kYXRhY2FjaGUuY29tbW9uLmFwcHMuQ2FjaGVPYmplY3REOw0KaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29t\nbW9uLmFwcHMuQ2FjaGVPYmplY3RFOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29tbW9uLmFwcHMuQ2FjaGVP\nYmplY3RGOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5j\nZS5kYXRhY2FjaGUuY29tbW9uLmFwcHMuQ2FjaGVPYmplY3RHOw0KaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29t\nbW9uLmFwcHMuQ2FjaGVPYmplY3RIOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5wZXJzaXN0ZW5jZS5kYXRhY2FjaGUuY29tbW9uLmFwcHMuQ2FjaGVP\nYmplY3RJbnRlcmZhY2U7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBl\ncnNpc3RlbmNlLmRhdGFjYWNoZS5jb21tb24uYXBwcy5DYWNoZU9iamVjdEo7\nDQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLmRhdGFj\nYWNoZS5jb21tb24uYXBwcy5SdW50aW1lVGVzdDE7DQppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLmNvbW1vbi51dGlscy5BYnN0cmFj\ndFRlc3RDYXNlOw0KaW1wb3J0IGp1bml0LmZyYW1ld29yay5Bc3NlcnRpb25G\nYWlsZWRFcnJvcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNh\nY2hlLkNvbmN1cnJlbnREYXRhQ2FjaGU7DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmRhdGFjYWNoZS5EYXRhQ2FjaGU7DQppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmRhdGFjYWNoZS5EZWxlZ2F0aW5nRGF0YUNhY2hlOw0KaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuUXVlcnlDYWNoZTsN\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlLlR5cGVzQ2hh\nbmdlZEV2ZW50Ow0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2Fj\naGUuRGF0YUNhY2hlTWFuYWdlcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLkJyb2tlcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7DQppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5QQ0RhdGE7DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5qcHFsLkpQUUxQYXJzZXI7DQppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsNCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOw0KaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsNCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuRXh0ZW50Ow0K\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5KUEFGYWNh\nZGVIZWxwZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3Rl\nbmNlLk9wZW5KUEFFbnRpdHlNYW5hZ2VyOw0KaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZS5PcGVuSlBBRW50aXR5TWFuYWdlckZhY3Rv\ncnk7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk9w\nZW5KUEFFbnRpdHlNYW5hZ2VyRmFjdG9yeVNQSTsNCmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuT3BlbkpQQVBlcnNpc3RlbmNlOw0K\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5PcGVuSlBB\nUXVlcnk7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2FjaGVN\nYXA7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7DQppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsNCmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOw0K\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlByb3h5RGF0ZTsNCg0K\nLyoqDQogKiAjIyMgc2hvdWxkIGFkZCAxLi4xIHJlbGF0aW9uIHRlc3QgIyMj\nIGFwcCBpZCBjb21wb3VuZCBrZXkgdGVzdA0KICovDQpwdWJsaWMgYWJzdHJh\nY3QgY2xhc3MgQ2FjaGVUZXN0IGV4dGVuZHMgQWJzdHJhY3RUZXN0Q2FzZSB7\nDQoNCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgT1JJR19OQU1FID0gIm9y\naWdOYW1lIjsNCg0KICAgIHByaXZhdGUgc3RhdGljIFN0cmluZyBORVdfTkFN\nRSA9ICJuZXdOYW1lIjsNCg0KICAgIHByaXZhdGUgc3RhdGljIGludCBPUklH\nX0FHRSA9IDMwOw0KDQogICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIE9SSUdf\nUEFSRU5UX05BTUUgPSAib3JpZ1BhcmVudE5hbWUiOw0KDQogICAgcHJpdmF0\nZSBzdGF0aWMgaW50IE9SSUdfUEFSRU5UX0FHRSA9IDMxOw0KDQogICAgcHJp\ndmF0ZSBPcGVuSlBBRW50aXR5TWFuYWdlckZhY3RvcnkgdGltZW91dEZhY3Rv\ncnkgPSBudWxsOw0KDQogICAgcHJpdmF0ZSBPcGVuSlBBRW50aXR5TWFuYWdl\nckZhY3RvcnkgZmFjdG9yeSA9IG51bGw7DQoNCiAgICBwcml2YXRlIE9wZW5K\nUEFFbnRpdHlNYW5hZ2VyRmFjdG9yeSBmYWN0b3J5MiA9IG51bGw7DQoNCiAg\nICBwcml2YXRlIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvczsNCg0KICAgIHBy\naXZhdGUgT2JqZWN0IG9pZDsNCg0KICAgIHByaXZhdGUgT2JqZWN0IHBhcmVu\ndE9pZDsNCg0KICAgIHByaXZhdGUgT2JqZWN0IG9pZHdpdGhjbGFzczsNCg0K\nICAgIHByaXZhdGUgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW07DQoNCiAgICBw\ncml2YXRlIENhY2hlT2JqZWN0QSBhOw0KDQogICAgcHVibGljIENhY2hlVGVz\ndChTdHJpbmcgdGVzdCkgew0KICAgICAgICBzdXBlcih0ZXN0LCAiZGF0YWNh\nY2hlY2FjdHVzYXBwIik7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgY2xl\nYXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsNCiAgICAgICAgT3BlbkpQQUVudGl0\neU1hbmFnZXIgZW0gPSAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkN\nCiAgICAgICAgICAgIC5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQogICAgICAg\nIHRyeSB7DQogICAgICAgICAgICBDbGFzc1tdIHRvRGVsZXRlID0gbmV3IENs\nYXNzW117IENhY2hlT2JqZWN0QS5jbGFzcywNCiAgICAgICAgICAgICAgICBD\nYWNoZU9iamVjdEIuY2xhc3MsIENhY2hlT2JqZWN0Qy5jbGFzcywgQ2FjaGVP\nYmplY3RELmNsYXNzLA0KICAgICAgICAgICAgICAgIENhY2hlT2JqZWN0RS5j\nbGFzcywgQ2FjaGVPYmplY3RKLmNsYXNzLA0KICAgICAgICAgICAgICAgIEFw\ncElkQ2FjaGVPYmplY3QuY2xhc3MsIH07DQogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHRvRGVsZXRlLmxlbmd0aDsgaSsrKSB7DQogICAgICAg\nICAgICAgICAgc3RhcnRUeChlbSk7DQogICAgICAgICAgICAgICAgRXh0ZW50\nIGUgPSBlbS5jcmVhdGVFeHRlbnQodG9EZWxldGVbaV0sIHRydWUpOw0KICAg\nICAgICAgICAgICAgIEl0ZXJhdG9yIGl0ID0gZS5pdGVyYXRvcigpOw0KICAg\nICAgICAgICAgICAgIHdoaWxlIChpdC5oYXNOZXh0KCkpIHsNCiAgICAgICAg\nICAgICAgICAgICAgZW0ucmVtb3ZlKGl0Lm5leHQoKSk7DQogICAgICAgICAg\nICAgICAgfQ0KICAgICAgICAgICAgICAgIGVuZFR4KGVtKTsNCiAgICAgICAg\nICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBqcGFlKSB7DQogICAgICAgICAgICBUaHJvd2FibGVbXSB0cyA9IGpw\nYWUuZ2V0TmVzdGVkVGhyb3dhYmxlcygpOw0KICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IHRzICE9IG51bGwgJiYgaSA8IHRzLmxlbmd0aDsgaSsrKSB7\nDQogICAgICAgICAgICAgICAgdHNbaV0ucHJpbnRTdGFja1RyYWNlKCk7DQog\nICAgICAgICAgICB9DQovLwkJCWpwYWUucHJpbnRTdGFja1RyYWNlKCk7DQoN\nCiAgICAgICAgfQ0KICAgICAgICBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVu\nZEVtKGVtKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAq\nIFJldHVybiBhIHN0cmluZyBhcnJheSBvZiBleHRyYSBjb25maWd1cmF0aW9u\nIG9wdGlvbnMgZm9yIHRoZSBzcGVjaWZpZWQNCiAgICAgKiBjYWNoZS4NCiAg\nICAgKi8NCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgU3RyaW5nW10gZ2V0Q29u\nZnMoKTsNCg0KICAgIC8qKg0KICAgICAqIFJldHVybiBhIHN0cmluZyBhcnJh\neSBvZiBleHRyYSBjb25maWd1cmF0aW9uIG9wdGlvbnMgZm9yIGEgc2Vjb25k\nIGNhY2hlLg0KICAgICAqLw0KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBTdHJp\nbmdbXSBnZXRDb25mczIoKTsNCg0KICAgIC8qKg0KICAgICAqIFJldHVybiB0\ncnVlIGlmIHRoaXMgY2FjaGUgaXMgYSBjb2hlcmVudCBvbmUgKG9uZSB3aGVy\nZSBjaGFuZ2VzIGluIG9uZQ0KICAgICAqIGNhY2hlIGFyZSBpbW1lZGlhdGVs\neSB2aXNpYmxlIGVsc2V3aGVyZSk7IG90aGVyd2lzZSByZXR1cm5zIGZhbHNl\nLiBJbiB0aGUNCiAgICAgKiBjb250ZXh0IG9mIHRoaXMgdGVzdCBjbGFzcywg\nY29oZXJlbmNlIGlzIGEgc2luZ2xlLUpWTSB0aGluZyBvbmx5Lg0KICAgICAq\nLw0KICAgIHByb3RlY3RlZCBib29sZWFuIGlzQ2FjaGVDb2hlcmVudCgpIHsN\nCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2\nb2lkIHNldFVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7DQoNCiAgICAgICAgU3Ry\naW5nW10gY29uZnMgPSBnZXRDb25mcygpOw0KICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGNvbmZzLmxlbmd0aDsgaSA9IGkgKyAyKSB7DQogICAgICAg\nICAgICBpZiAoIm9wZW5qcGEuRGF0YUNhY2hlIi5lcXVhbHMoY29uZnNbaV0p\nKQ0KICAgICAgICAgICAgICAgIGNvbmZzW2kgKyAxXSArPQ0KICAgICAgICAg\nICAgICAgICAgICAiLCB0cnVlKE5hbWU9bm90LXRoZS1kZWZhdWx0LWNhY2hl\nLCBDYWNoZVNpemU9MTApIjsNCiAgICAgICAgfQ0KDQogICAgICAgIFN0cmlu\nZ1tdIGNvbmZzMiA9IGdldENvbmZzMigpOw0KICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGNvbmZzMi5sZW5ndGg7IGkgPSBpICsgMikgew0KICAgICAg\nICAgICAgaWYgKCJvcGVuanBhLkRhdGFDYWNoZSIuZXF1YWxzKGNvbmZzMltp\nXSkpDQogICAgICAgICAgICAgICAgY29uZnMyW2kgKyAxXSArPQ0KICAgICAg\nICAgICAgICAgICAgICAiLCB0cnVlKE5hbWU9bm90LXRoZS1kZWZhdWx0LWNh\nY2hlLCBDYWNoZVNpemU9MTApIjsNCiAgICAgICAgfQ0KDQogICAgICAgIE1h\ncCBwcm9wc01hcDEgPSBuZXcgSGFzaE1hcCgpOw0KICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGNvbmZzLmxlbmd0aDsgaSArPSAyKSB7DQogICAgICAg\nICAgICBwcm9wc01hcDEucHV0KGNvbmZzW2ldLCBjb25mc1tpICsgMV0pOw0K\nICAgICAgICB9DQogICAgICAgIE1hcCBwcm9wc01hcDIgPSBuZXcgSGFzaE1h\ncCgpOw0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbmZzMi5sZW5n\ndGg7IGkgKz0gMikgew0KICAgICAgICAgICAgcHJvcHNNYXAyLnB1dChjb25m\nczJbaV0sIGNvbmZzMltpICsgMV0pOw0KICAgICAgICB9DQoNCiAgICAgICAg\nZmFjdG9yeSA9IChPcGVuSlBBRW50aXR5TWFuYWdlckZhY3RvcnkpIGdldEVt\nZihwcm9wc01hcDEpOw0KICAgICAgICBmYWN0b3J5MiA9IChPcGVuSlBBRW50\naXR5TWFuYWdlckZhY3RvcnkpIGdldEVtZihwcm9wc01hcDIpOw0KDQogICAg\nICAgIHJlcG9zID0gSlBBRmFjYWRlSGVscGVyLnRvQnJva2VyRmFjdG9yeShm\nYWN0b3J5KS5nZXRDb25maWd1cmF0aW9uKCkNCiAgICAgICAgICAgIC5nZXRN\nZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOw0KDQogICAgICAgIFN0cmlu\nZ1tdIGJpZ2dlckNvbmZzID0gbmV3IFN0cmluZ1tjb25mcy5sZW5ndGggKyAy\nXTsNCiAgICAgICAgU3lzdGVtLmFycmF5Y29weShjb25mcywgMCwgYmlnZ2Vy\nQ29uZnMsIDAsIGNvbmZzLmxlbmd0aCk7DQogICAgICAgIGJpZ2dlckNvbmZz\nW2JpZ2dlckNvbmZzLmxlbmd0aCAtIDJdID0gIm9wZW5qcGEuRGF0YUNhY2hl\nVGltZW91dCI7DQogICAgICAgIGJpZ2dlckNvbmZzW2JpZ2dlckNvbmZzLmxl\nbmd0aCAtIDFdID0gIjEwMDAiOw0KICAgICAgICBNYXAgcHJvcHNNYXAzID0g\nbmV3IEhhc2hNYXAoKTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBi\naWdnZXJDb25mcy5sZW5ndGg7IGkgKz0gMikgew0KICAgICAgICAgICAgcHJv\ncHNNYXAzLnB1dChiaWdnZXJDb25mc1tpXSwgYmlnZ2VyQ29uZnNbaSArIDFd\nKTsNCiAgICAgICAgfQ0KICAgICAgICB0aW1lb3V0RmFjdG9yeSA9IChPcGVu\nSlBBRW50aXR5TWFuYWdlckZhY3RvcnkpIGdldEVtZihwcm9wc01hcDMpOw0K\nDQogICAgICAgIGNsZWFyKCk7DQoNCiAgICAgICAgT3BlbkpQQUVudGl0eU1h\nbmFnZXIgZW0gPSAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkNCiAg\nICAgICAgICAgIC5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQoNCiAgICAgICAg\nQ2FjaGVPYmplY3RBIGE7DQogICAgICAgIENhY2hlT2JqZWN0QSBhcGFyZW50\nOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgLy8gd2UgY2FuJ3Qgc3Bl\nY2lmeSB0aGlzIGZvciBVc2VyVHJhbnNhY3Rpb24NCiAgICAgICAgICAgIC8q\nDQogICAgICAgICAgICAgICAgKiBwbS5jdXJyZW50VHJhbnNhY3Rpb24oKS5z\nZXROb250cmFuc2FjdGlvbmFsUmVhZCh0cnVlKTsNCiAgICAgICAgICAgICAg\nICAqIHBtLmN1cnJlbnRUcmFuc2FjdGlvbigpLnNldE9wdGltaXN0aWModHJ1\nZSk7DQogICAgICAgICAgICAgICAgKi8NCg0KLy8JCQllbS5zZXROb250cmFu\nc2FjdGlvbmFsUmVhZCh0cnVlKTsNCi8vCQkJZW0uc2V0T3B0aW1pc3RpYyh0\ncnVlKTsNCg0KICAgICAgICAgICAgYSA9IG5ldyBDYWNoZU9iamVjdEEoT1JJ\nR19OQU1FLCBPUklHX0FHRSk7DQogICAgICAgICAgICBhcGFyZW50ID0gbmV3\nIENhY2hlT2JqZWN0QShPUklHX1BBUkVOVF9OQU1FLCBPUklHX1BBUkVOVF9B\nR0UpOw0KICAgICAgICAgICAgYS5zZXRSZWxhdGVkT2JqZWN0KGFwYXJlbnQp\nOw0KICAgICAgICAgICAgTGlua2VkTGlzdCBjaGlsZHJlbiA9IG5ldyBMaW5r\nZWRMaXN0KCk7DQogICAgICAgICAgICBjaGlsZHJlbi5hZGQoYSk7DQogICAg\nICAgICAgICBhcGFyZW50LnNldFJlbGF0ZWRDb2xsZWN0aW9uKGNoaWxkcmVu\nKTsNCg0KICAgICAgICAgICAgc3RhcnRUeChlbSk7DQogICAgICAgICAgICBl\nbS5wZXJzaXN0KGEpOw0KICAgICAgICAgICAgZW0ucGVyc2lzdChhcGFyZW50\nKTsNCiAgICAgICAgICAgIG9pZCA9IGVtLmdldE9iamVjdElkKGEpOw0KICAg\nICAgICAgICAgb2lkd2l0aGNsYXNzID0gbmV3IElkKENhY2hlT2JqZWN0QS5j\nbGFzcywgb2lkLnRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgcGFyZW50T2lk\nID0gZW0uZ2V0T2JqZWN0SWQoYXBhcmVudCk7DQogICAgICAgICAgICBlbmRU\neChlbSk7DQogICAgICAgIH0NCiAgICAgICAgZmluYWxseSB7DQogICAgICAg\nICAgICBlbmRFbShlbSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBsb2Fk\nIGFuIG9iamVjdCBpbiBhIHNlcGFyYXRlIHBtIGJlZm9yZSB0aGUgdXBkYXRl\nDQogICAgICAgIC8vIGhhcHBlbnMuIFRoaXMgc2hvdWxkIG5vdCBjaGFuZ2Us\nIGVsc2Ugd2UncmUgaW4NCiAgICAgICAgLy8gdmlvbGF0aW9uIG9mIHRoZSBz\ncGVjLg0KICAgICAgICB0aGlzLmVtID0gZmFjdG9yeS5jcmVhdGVFbnRpdHlN\nYW5hZ2VyKCk7DQogICAgICAgIHN0YXJ0VHgodGhpcy5lbSk7DQogICAgICAg\nIHRyeSB7DQogICAgICAgICAgICAvLyBPcGVuSlBBRW50aXR5TWFuYWdlciBv\ncGVuRW09KE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSB0aGlzLmVtOw0KICAgICAg\nICAgICAgdGhpcy5hID0gKENhY2hlT2JqZWN0QSkgdGhpcy5lbS5maW5kKENh\nY2hlT2JqZWN0QS5jbGFzcywgb2lkKTsNCg0KICAgICAgICAgICAgLy8gbG9h\nZCB0aGUgcGFyZW50IGZvciB0ZXN0Q29sbGVjdGlvbnMoKS4NCiAgICAgICAg\nICAgIENhY2hlT2JqZWN0QSByZWwgPSB0aGlzLmEuZ2V0UmVsYXRlZE9iamVj\ndCgpOw0KICAgICAgICAgICAgcmVsLmdldFJlbGF0ZWRDb2xsZWN0aW9uKCk7\nDQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7DQog\nICAgICAgICAgICBlLnByaW50U3RhY2tUcmFjZSgpOw0KICAgICAgICB9DQog\nICAgICAgIGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kVHgodGhpcy5lbSk7\nDQogICAgICAgICAgICAvLyBlbmRFbSh0aGlzLmVtKTsNCiAgICAgICAgfQ0K\nDQogICAgICAgIGVtID0gZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7\nDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBzdGFydFR4KGVtKTsNCiAg\nICAgICAgICAgIGEgPSAoQ2FjaGVPYmplY3RBKSBlbS5maW5kKENhY2hlT2Jq\nZWN0QS5jbGFzcywgb2lkKTsNCiAgICAgICAgICAgIGEuc2V0TmFtZShORVdf\nTkFNRSk7DQoNCiAgICAgICAgICAgIGFwYXJlbnQgPSAoQ2FjaGVPYmplY3RB\nKSBlbS5maW5kKENhY2hlT2JqZWN0QS5jbGFzcywgcGFyZW50T2lkKTsNCg0K\nICAgICAgICAgICAgQ2FjaGVPYmplY3RBIGEyID0gbmV3IENhY2hlT2JqZWN0\nQShPUklHX05BTUUsIE9SSUdfQUdFKTsNCiAgICAgICAgICAgIGEyLnNldFJl\nbGF0ZWRPYmplY3QoYXBhcmVudCk7DQogICAgICAgICAgICBhcGFyZW50Lmdl\ndFJlbGF0ZWRDb2xsZWN0aW9uKCkuYWRkKGEyKTsNCiAgICAgICAgICAgIGVt\nLnBlcnNpc3QoYTIpOw0KICAgICAgICAgICAgZW5kVHgoZW0pOw0KDQogICAg\nICAgICAgICBhc3NlcnROZXcoYSk7DQogICAgICAgIH0NCiAgICAgICAgZmlu\nYWxseSB7DQogICAgICAgICAgICBlbmRFbShlbSk7DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZWFyRG93bigpIHRocm93cyBFeGNl\ncHRpb24gew0KICAgICAgICBlbmRFbShlbSk7DQoNCiAgICAgICAgdHJ5IHsN\nCiAgICAgICAgICAgIGZhY3RvcnkuY2xvc2UoKTsNCiAgICAgICAgfQ0KICAg\nICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgfQ0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgZmFjdG9yeTIuY2xvc2UoKTsNCiAgICAg\nICAgfQ0KICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpIHsNCiAgICAgICAg\nfQ0KICAgICAgICBzdXBlci50ZWFyRG93bigpOw0KDQogICAgICAgIGZhY3Rv\ncnkgPSBudWxsOw0KICAgICAgICBmYWN0b3J5MiA9IG51bGw7DQogICAgICAg\nIHRpbWVvdXRGYWN0b3J5ID0gbnVsbDsNCiAgICAgICAgb2lkID0gbnVsbDsN\nCiAgICAgICAgcGFyZW50T2lkID0gbnVsbDsNCiAgICAgICAgZW0gPSBudWxs\nOw0KICAgICAgICBhID0gbnVsbDsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0RGVsZXRlZE9uZVRvT25lUmVsYXRpb25zKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7DQogICAgICAgIEVudGl0eU1hbmFnZXIgZW0gPSBmYWN0b3J5LmNy\nZWF0ZUVudGl0eU1hbmFnZXIoKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAg\nICAgIHN0YXJ0VHgoZW0pOw0KICAgICAgICAgICAgQ2FjaGVPYmplY3RBIGEg\nPSAoQ2FjaGVPYmplY3RBKSBlbS5maW5kKENhY2hlT2JqZWN0QS5jbGFzcywg\nb2lkKTsNCiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoYS5nZXRSZWxhdGVk\nT2JqZWN0KCkpOw0KICAgICAgICAgICAgZW0ucmVtb3ZlKGEuZ2V0UmVsYXRl\nZE9iamVjdCgpKTsNCiAgICAgICAgICAgIGVuZFR4KGVtKTsNCiAgICAgICAg\nfQ0KICAgICAgICBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZEVtKGVtKTsN\nCiAgICAgICAgfQ0KDQogICAgICAgIEVudGl0eU1hbmFnZXIgZW0yID0gZmFj\ndG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQogICAgICAgIHRyeSB7DQog\nICAgICAgICAgICBDYWNoZU9iamVjdEEgYTIgPSAoQ2FjaGVPYmplY3RBKSBl\nbTIuZmluZChDYWNoZU9iamVjdEEuY2xhc3MsIG9pZCk7DQogICAgICAgICAg\nICBhc3NlcnROdWxsKGEyLmdldFJlbGF0ZWRPYmplY3QoKSk7DQogICAgICAg\nIH0NCiAgICAgICAgZmluYWxseSB7DQogICAgICAgICAgICBlbmRFbShlbTIp\nOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgdGVzdENh\nbkNhY2hlRXh0ZW5zaW9uKCkgdGhyb3dzIEV4Y2VwdGlvbiB7DQogICAgICAg\nIERhdGFDYWNoZSBjYWNoZSA9IGNhY2hlTWFuYWdlcihmYWN0b3J5KS5nZXRT\neXN0ZW1EYXRhQ2FjaGUoKTsNCg0KICAgICAgICAvLyBmaXJzdCwgdGVzdCBj\nYWNoaW5nIG9mIG5ld2x5IGNyZWF0ZWQgb2JqZWN0cy4NCiAgICAgICAgT3Bl\nbkpQQUVudGl0eU1hbmFnZXIgZW0gPSAoT3BlbkpQQUVudGl0eU1hbmFnZXIp\nIGZhY3RvcnkNCiAgICAgICAgICAgIC5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7\nDQogICAgICAgIE9iamVjdCBvOw0KICAgICAgICBPYmplY3Qgb2lkOw0KICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgc3RhcnRUeChlbSk7DQogICAgICAg\nICAgICBvID0gbmV3IENhY2hlT2JqZWN0QigiZm9vIik7DQogICAgICAgICAg\nICBlbS5wZXJzaXN0KG8pOw0KICAgICAgICAgICAgZW5kVHgoZW0pOw0KICAg\nICAgICAgICAgb2lkID0gZW0uZ2V0T2JqZWN0SWQobyk7DQogICAgICAgICAg\nICBhc3NlcnROb3ROdWxsKG9pZCk7DQogICAgICAgICAgICBhc3NlcnROdWxs\nKGNhY2hlLmdldChvaWQpKTsNCiAgICAgICAgfQ0KICAgICAgICBmaW5hbGx5\nIHsNCiAgICAgICAgICAgIGVuZEVtKGVtKTsNCiAgICAgICAgfQ0KDQogICAg\nICAgIC8vIG5vdywgdGVzdCBjYWNoaW5nIG9mIGRhdGEgbG9hZGVkIGZyb20g\ndGhlIGRhdGEgc3RvcmUuDQogICAgICAgIGVtID0gZmFjdG9yeS5jcmVhdGVF\nbnRpdHlNYW5hZ2VyKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBv\nID0gZW0uZmluZChDYWNoZU9iamVjdEIuY2xhc3MsIG9pZCk7DQogICAgICAg\nICAgICBhc3NlcnROb3ROdWxsKG8pOw0KICAgICAgICAgICAgYXNzZXJ0TnVs\nbChjYWNoZS5nZXQob2lkKSk7DQogICAgICAgIH0NCiAgICAgICAgZmluYWxs\neSB7DQogICAgICAgICAgICBlbmRFbShlbSk7DQogICAgICAgIH0NCiAgICB9\nDQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0R2V0Q2FjaGUoKSB7DQogICAgICAg\nIC8vIGZpcnN0LCB0ZXN0IGNhY2hpbmcgb2YgbmV3bHkgY3JlYXRlZCBvYmpl\nY3RzLg0KICAgICAgICBEYXRhQ2FjaGUgZGVmYXVsdENhY2hlID0gY2FjaGVN\nYW5hZ2VyKGZhY3RvcnkpLmdldERhdGFDYWNoZSgNCiAgICAgICAgICAgIERh\ndGFDYWNoZS5OQU1FX0RFRkFVTFQsIGZhbHNlKTsNCiAgICAgICAgYXNzZXJ0\nTm90TnVsbChkZWZhdWx0Q2FjaGUpOw0KDQogICAgICAgIERhdGFDYWNoZSBj\nYWNoZSA9IGNhY2hlTWFuYWdlcihmYWN0b3J5KS5nZXRTeXN0ZW1EYXRhQ2Fj\naGUoKTsNCiAgICAgICAgYXNzZXJ0RXF1YWxzKGRlZmF1bHRDYWNoZSwgY2Fj\naGUpOw0KDQogICAgICAgIENsYXNzTWV0YURhdGEgYU1ldGEgPSByZXBvcy5n\nZXRNZXRhRGF0YShDYWNoZU9iamVjdEEuY2xhc3MsIG51bGwsIHRydWUpOw0K\nICAgICAgICBDbGFzc01ldGFEYXRhIGFDaGlsZDFNZXRhID0gcmVwb3MuZ2V0\nTWV0YURhdGEoQ2FjaGVPYmplY3RBQ2hpbGQxLmNsYXNzLA0KICAgICAgICAg\nICAgbnVsbCwgdHJ1ZSk7DQogICAgICAgIENsYXNzTWV0YURhdGEgYUNoaWxk\nMk1ldGEgPSByZXBvcy5nZXRNZXRhRGF0YShDYWNoZU9iamVjdEFDaGlsZDIu\nY2xhc3MsDQogICAgICAgICAgICBudWxsLCB0cnVlKTsNCiAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBiTWV0YSA9IHJlcG9zLmdldE1ldGFEYXRhKENhY2hlT2Jq\nZWN0Qi5jbGFzcywgbnVsbCwgdHJ1ZSk7DQogICAgICAgIENsYXNzTWV0YURh\ndGEgYkNoaWxkMU1ldGEgPSByZXBvcy5nZXRNZXRhRGF0YShDYWNoZU9iamVj\ndEJDaGlsZDEuY2xhc3MsDQogICAgICAgICAgICBudWxsLCB0cnVlKTsNCiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBjTWV0YSA9IHJlcG9zLmdldE1ldGFEYXRh\nKENhY2hlT2JqZWN0Qy5jbGFzcywgbnVsbCwgdHJ1ZSk7DQogICAgICAgIENs\nYXNzTWV0YURhdGEgZE1ldGEgPSByZXBvcy5nZXRNZXRhRGF0YShDYWNoZU9i\namVjdEQuY2xhc3MsIG51bGwsIHRydWUpOw0KICAgICAgICBDbGFzc01ldGFE\nYXRhIGVNZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEoQ2FjaGVPYmplY3RFLmNs\nYXNzLCBudWxsLCB0cnVlKTsNCg0KICAgICAgICBjYWNoZSA9IGFNZXRhLmdl\ndERhdGFDYWNoZSgpOw0KICAgICAgICBhc3NlcnRFcXVhbHMoZGVmYXVsdENh\nY2hlLCBjYWNoZSk7DQogICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiKioq\nKioqRGF0YUNhY2hlTmFtZToiDQogICAgICAgICAgICArIGFDaGlsZDJNZXRh\nLmdldERhdGFDYWNoZU5hbWUoKSk7DQogICAgICAgIGFzc2VydE51bGwoYUNo\naWxkMk1ldGEuZ2V0RGF0YUNhY2hlKCkpOw0KDQogICAgICAgIGFzc2VydE51\nbGwoYk1ldGEuZ2V0RGF0YUNhY2hlKCkpOw0KDQogICAgICAgIGFzc2VydEVx\ndWFscyhjTWV0YS5nZXREYXRhQ2FjaGUoKSwgZE1ldGEuZ2V0RGF0YUNhY2hl\nKCkpOw0KICAgICAgICBpZiAoZE1ldGEuZ2V0RGF0YUNhY2hlKCkgaW5zdGFu\nY2VvZiBDb25jdXJyZW50RGF0YUNhY2hlKSB7DQogICAgICAgICAgICBDb25j\ndXJyZW50RGF0YUNhY2hlIGRDYWNoZUltcGwgPQ0KICAgICAgICAgICAgICAg\nIChDb25jdXJyZW50RGF0YUNhY2hlKSBkTWV0YS5nZXREYXRhQ2FjaGUoKTsN\nCiAgICAgICAgICAgIGFzc2VydEVxdWFscygxMCwgZENhY2hlSW1wbC5nZXRD\nYWNoZVNpemUoKSk7DQogICAgICAgIH0NCiAgICAgICAgYXNzZXJ0RXF1YWxz\nKGFNZXRhLmdldERhdGFDYWNoZSgpLCBlTWV0YS5nZXREYXRhQ2FjaGUoKSk7\nDQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgdGVzdFByaW1pdGl2ZXMoKSB0\naHJvd3MgRXhjZXB0aW9uIHsNCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQg\ndGhlICdhJyB0aGF0IHdhcyBmb3VuZCBiZWZvcmUgY2hhbmdlcw0KICAgICAg\nICAvLyB3ZXJlIG1hZGUgaXMgc3RpbGwgdmFsaWQuDQogICAgICAgIGFzc2Vy\ndE9sZChhKTsNCiAgICAgICAgZW0ucmVmcmVzaChhKTsNCiAgICAgICAgYXNz\nZXJ0TmV3KGEpOw0KICAgIH0NCg0KICAgIC8vIEZJWE1FIFNlZXRoYSBTZXAg\nMjUsMjAwNg0KICAgIC8qDQogICAgICAqIHB1YmxpYyB2b2lkIHRlc3RDb2xs\nZWN0aW9ucygpIHRocm93cyBFeGNlcHRpb24geyBDYWNoZU9iamVjdEEgcGFy\nZW50ID0NCiAgICAgICogKENhY2hlT2JqZWN0QSkgZW0uZmluZChDYWNoZU9i\namVjdEEuY2xhc3MsT1JJR19QQVJFTlRfTkFNRSk7DQogICAgICAqIGFzc2Vy\ndEVxdWFscygxLCBwYXJlbnQuZ2V0UmVsYXRlZENvbGxlY3Rpb24oKS5zaXpl\nKCkpOw0KICAgICAgKiBlbS5yZWZyZXNoKHBhcmVudCk7IGFzc2VydEVxdWFs\ncygyLA0KICAgICAgKiBwYXJlbnQuZ2V0UmVsYXRlZENvbGxlY3Rpb24oKS5z\naXplKCkpOyB9DQogICAgICAqLw0KDQogICAgLy8gRklYTUUgU2VldGhhIFNl\ncCAyNSwyMDA2DQogICAgLyoNCiAgICAgICogcHVibGljIHZvaWQgdGVzdEV4\ncGlyZWRDb2xsZWN0aW9ucygpIHsgQ2FjaGVPYmplY3RBIHBhcmVudCA9DQog\nICAgICAqIChDYWNoZU9iamVjdEEpIGVtLmZpbmQoQ2FjaGVPYmplY3RBLmNs\nYXNzLE9SSUdfUEFSRU5UX05BTUUpOw0KICAgICAgKiBlbS5yZWZyZXNoKHBh\ncmVudCk7IENvbGxlY3Rpb24gcmVsYXRlZE9pZHMgPSBuZXcgSGFzaFNldCgp\nOyBmb3IgKEl0ZXJhdG9yDQogICAgICAqIGl0ZXIgPSBwYXJlbnQuZ2V0UmVs\nYXRlZENvbGxlY3Rpb24oKS5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsp\nIHsNCiAgICAgICogcmVsYXRlZE9pZHMuYWRkKEpET0hlbHBlci5nZXRPYmpl\nY3RJZChpdGVyLm5leHQoKSkpOyB9DQogICAgICAqDQogICAgICAqIENsYXNz\nTWV0YURhdGEgbWV0YSA9IHJlcG9zLmdldE1ldGFEYXRhKENhY2hlT2JqZWN0\nQS5jbGFzcywgbnVsbCwgdHJ1ZSk7DQogICAgICAqIERhdGFDYWNoZSBjYWNo\nZSA9IG1ldGEuZ2V0RGF0YUNhY2hlKCk7DQogICAgICAqICAvLyBkcm9wIHRo\nZSByZWxhdGVkIGRhdGEgZnJvbSB0aGUgY2FjaGUgZm9yIChJdGVyYXRvciBp\ndGVyID0NCiAgICAgICogcmVsYXRlZE9pZHMuaXRlcmF0b3IoKTsgaXRlci5o\nYXNOZXh0KCk7KSBjYWNoZS5yZW1vdmUoaXRlci5uZXh0KCkpOw0KICAgICAg\nKg0KICAgICAgKiBQZXJzaXN0ZW5jZU1hbmFnZXIgcG0yID0gZmFjdG9yeS5n\nZXRQZXJzaXN0ZW5jZU1hbmFnZXIoKTsgdHJ5IHsNCiAgICAgICogYXNzZXJ0\nVHJ1ZShjYWNoZS5jb250YWlucyhwYXJlbnRPaWQpKTsgcGFyZW50ID0gKENh\nY2hlT2JqZWN0QSkNCiAgICAgICogcG0yLmdldE9iamVjdEJ5SWQocGFyZW50\nT2lkLCB0cnVlKTsNCiAgICAgICoNCiAgICAgICogdHJ5IHsgZm9yIChJdGVy\nYXRvciBpdGVyID0gcmVsYXRlZE9pZHMuaXRlcmF0b3IoKTsgaXRlci5oYXNO\nZXh0KCk7KQ0KICAgICAgKiBhc3NlcnRGYWxzZShjYWNoZS5jb250YWlucyhp\ndGVyLm5leHQoKSkpOyB9IGNhdGNoIChBc3NlcnRpb25GYWlsZWRFcnJvcg0K\nICAgICAgKiBlKSB7IGJ1Zyg0NjcsICJkYXRhIGNhY2hlIGNhbiBvdmVyLWVh\nZ2VybHkgbG9hZCByZWxhdGlvbiBkYXRhIik7IH0gfQ0KICAgICAgKiBmaW5h\nbGx5IHsgY2xvc2UocG0yKTsgfSB9DQogICAgICAqLw0KDQogICAgcHVibGlj\nIHZvaWQgdGVzdEV4cGlyZWRSZWxhdGlvbnMoKSB7DQogICAgICAgIENhY2hl\nT2JqZWN0QSBhID0gKENhY2hlT2JqZWN0QSkgZW0uZmluZChDYWNoZU9iamVj\ndEEuY2xhc3MsIG9pZCk7DQogICAgICAgIGVtLnJlZnJlc2goYSk7DQogICAg\nICAgIE9iamVjdCByZWxhdGlvbk9pZCA9IGVtLmdldE9iamVjdElkKGEuZ2V0\nUmVsYXRlZE9iamVjdCgpKTsNCiAgICAgICAgcmVsYXRpb25PaWQgPSBuZXcg\nSWQoQ2FjaGVPYmplY3RBLmNsYXNzLCByZWxhdGlvbk9pZC50b1N0cmluZygp\nKTsNCg0KICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSByZXBvcy5nZXRN\nZXRhRGF0YShDYWNoZU9iamVjdEEuY2xhc3MsIG51bGwsIHRydWUpOw0KICAg\nICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBtZXRhLmdldERhdGFDYWNoZSgpOw0K\nDQogICAgICAgIC8vIGRyb3AgdGhlIHJlbGF0ZWQgZGF0YSBmcm9tIHRoZSBj\nYWNoZQ0KICAgICAgICBjYWNoZS5yZW1vdmUocmVsYXRpb25PaWQpOw0KDQog\nICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtMiA9IChPcGVuSlBBRW50\naXR5TWFuYWdlcikgZmFjdG9yeQ0KICAgICAgICAgICAgLmNyZWF0ZUVudGl0\neU1hbmFnZXIoKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGFzc2Vy\ndFRydWUoY2FjaGUuY29udGFpbnMob2lkd2l0aGNsYXNzKSk7DQogICAgICAg\nICAgICBhID0gKENhY2hlT2JqZWN0QSkgZW0yLmZpbmQoQ2FjaGVPYmplY3RB\nLmNsYXNzLCBvaWQpOw0KDQogICAgICAgICAgICB0cnkgew0KICAgICAgICAg\nICAgICAgIGFzc2VydEZhbHNlKGNhY2hlLmNvbnRhaW5zKHJlbGF0aW9uT2lk\nKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoQXNzZXJ0\naW9uRmFpbGVkRXJyb3IgZSkgew0KICAgICAgICAgICAgICAgIC8vIGJ1Zyg0\nNjcsICJkYXRhIGNhY2hlIGNhbiBvdmVyLWVhZ2VybHkgbG9hZCByZWxhdGlv\nbiBkYXRhIik7DQogICAgICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2Uo\nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmaW5hbGx5\nIHsNCiAgICAgICAgICAgIGVuZEVtKGVtMik7DQogICAgICAgIH0NCiAgICB9\nDQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0UENBcnJheXMoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsNCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgbmV3RW0g\nPSAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkNCiAgICAgICAgICAg\nIC5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQogICAgICAgIHRyeSB7DQogICAg\nICAgICAgICBzdGFydFR4KG5ld0VtKTsNCiAgICAgICAgICAgIENhY2hlT2Jq\nZWN0QSBwYXJlbnQgPSAoQ2FjaGVPYmplY3RBKSBuZXdFbS5maW5kKENhY2hl\nT2JqZWN0QS5jbGFzcywNCiAgICAgICAgICAgICAgICBwYXJlbnRPaWQpOw0K\nICAgICAgICAgICAgQ2FjaGVPYmplY3RBIGEgPSAoQ2FjaGVPYmplY3RBKSBu\nZXdFbS5maW5kKENhY2hlT2JqZWN0QS5jbGFzcywgb2lkKTsNCiAgICAgICAg\nICAgIGEuc2V0UmVsYXRlZEFycmF5KG5ldyBDYWNoZU9iamVjdEFbXXsgcGFy\nZW50LCBhIH0pOw0KICAgICAgICAgICAgZW5kVHgobmV3RW0pOw0KICAgICAg\nICB9DQogICAgICAgIGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kRW0obmV3\nRW0pOw0KICAgICAgICB9DQoNCiAgICAgICAgbmV3RW0gPSAoT3BlbkpQQUVu\ndGl0eU1hbmFnZXIpIGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigpOw0K\nICAgICAgICB0cnkgew0KICAgICAgICAgICAgYSA9IChDYWNoZU9iamVjdEEp\nIG5ld0VtLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQpOw0KICAgICAg\nICAgICAgQ2FjaGVPYmplY3RBW10gYXJyYXkgPSBhLmdldFJlbGF0ZWRBcnJh\neSgpOw0KICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDIsIGFycmF5Lmxlbmd0\naCk7DQogICAgICAgICAgICBhc3NlcnRUcnVlKGFycmF5WzBdIGluc3RhbmNl\nb2YgQ2FjaGVPYmplY3RBKTsNCiAgICAgICAgICAgIGFzc2VydFRydWUoYXJy\nYXlbMV0gaW5zdGFuY2VvZiBDYWNoZU9iamVjdEEpOw0KDQogICAgICAgICAg\nICBPYmplY3QgYXJyYXlPaWQgPSBuZXdFbS5nZXRPYmplY3RJZChhcnJheVsw\nXSk7DQogICAgICAgICAgICBpZiAoIWFycmF5T2lkLmVxdWFscyhwYXJlbnRP\naWQpICYmICFhcnJheU9pZC5lcXVhbHMob2lkKSkgew0KICAgICAgICAgICAg\nICAgIGZhaWwoImFycmF5IGRvZXMgbm90IGNvbnRhaW4gY29ycmVjdCBvaWRz\nIik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGFycmF5T2lkID0g\nbmV3RW0uZ2V0T2JqZWN0SWQoYXJyYXlbMV0pOw0KICAgICAgICAgICAgaWYg\nKCFhcnJheU9pZC5lcXVhbHMocGFyZW50T2lkKSAmJiAhYXJyYXlPaWQuZXF1\nYWxzKG9pZCkpIHsNCiAgICAgICAgICAgICAgICBmYWlsKCJhcnJheSBkb2Vz\nIG5vdCBjb250YWluIGNvcnJlY3Qgb2lkcyIpOw0KICAgICAgICAgICAgfQ0K\nICAgICAgICB9DQogICAgICAgIGZpbmFsbHkgew0KICAgICAgICAgICAgZW5k\nRW0obmV3RW0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHZv\naWQgdGVzdFN0cmluZ0FycmF5cygpIHRocm93cyBFeGNlcHRpb24gew0KICAg\nICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBuZXdFbSA9IChPcGVuSlBBRW50\naXR5TWFuYWdlcikgZmFjdG9yeQ0KICAgICAgICAgICAgLmNyZWF0ZUVudGl0\neU1hbmFnZXIoKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHN0YXJ0\nVHgobmV3RW0pOw0KICAgICAgICAgICAgQ2FjaGVPYmplY3RBIGEgPSAoQ2Fj\naGVPYmplY3RBKSBuZXdFbS5maW5kKENhY2hlT2JqZWN0QS5jbGFzcywgb2lk\nKTsNCiAgICAgICAgICAgIGEuc2V0U3RyaW5nQXJyYXkobmV3IFN0cmluZ1td\neyAic3RyaW5nMCIsICJzdHJpbmcxIiwgInN0cmluZzIiIH0pOw0KICAgICAg\nICAgICAgZW5kVHgobmV3RW0pOw0KICAgICAgICB9DQogICAgICAgIGZpbmFs\nbHkgew0KICAgICAgICAgICAgZW5kRW0obmV3RW0pOw0KICAgICAgICB9DQoN\nCiAgICAgICAgbmV3RW0gPSAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGZhY3Rv\ncnkuY3JlYXRlRW50aXR5TWFuYWdlcigpOw0KICAgICAgICB0cnkgew0KICAg\nICAgICAgICAgYSA9IChDYWNoZU9iamVjdEEpIG5ld0VtLmZpbmQoQ2FjaGVP\nYmplY3RBLmNsYXNzLCBvaWQpOw0KICAgICAgICAgICAgU3RyaW5nW10gYXJy\nYXkgPSBhLmdldFN0cmluZ0FycmF5KCk7DQogICAgICAgICAgICBhc3NlcnRF\ncXVhbHMoMywgYXJyYXkubGVuZ3RoKTsNCiAgICAgICAgICAgIGFzc2VydEVx\ndWFscygic3RyaW5nMCIsIGFycmF5WzBdKTsNCiAgICAgICAgICAgIGFzc2Vy\ndEVxdWFscygic3RyaW5nMSIsIGFycmF5WzFdKTsNCiAgICAgICAgICAgIGFz\nc2VydEVxdWFscygic3RyaW5nMiIsIGFycmF5WzJdKTsNCiAgICAgICAgfQ0K\nICAgICAgICBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZEVtKG5ld0VtKTsN\nCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHRlc3RQcmlt\naXRpdmVBcnJheXMoKSB0aHJvd3MgRXhjZXB0aW9uIHsNCiAgICAgICAgT3Bl\nbkpQQUVudGl0eU1hbmFnZXIgbmV3RW0gPSAoT3BlbkpQQUVudGl0eU1hbmFn\nZXIpIGZhY3RvcnkNCiAgICAgICAgICAgIC5jcmVhdGVFbnRpdHlNYW5hZ2Vy\nKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBzdGFydFR4KG5ld0Vt\nKTsNCiAgICAgICAgICAgIENhY2hlT2JqZWN0QSBhID0gKENhY2hlT2JqZWN0\nQSkgbmV3RW0uZmluZChDYWNoZU9iamVjdEEuY2xhc3MsIG9pZCk7DQogICAg\nICAgICAgICBhLnNldFByaW1pdGl2ZUFycmF5KG5ldyBmbG9hdFtdeyAwLCAx\nLCAyIH0pOw0KICAgICAgICAgICAgZW5kVHgobmV3RW0pOw0KICAgICAgICB9\nDQogICAgICAgIGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kRW0obmV3RW0p\nOw0KICAgICAgICB9DQoNCiAgICAgICAgbmV3RW0gPSAoT3BlbkpQQUVudGl0\neU1hbmFnZXIpIGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigpOw0KICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgYSA9IChDYWNoZU9iamVjdEEpIG5l\nd0VtLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQpOw0KICAgICAgICAg\nICAgZmxvYXRbXSBhcnJheSA9IGEuZ2V0UHJpbWl0aXZlQXJyYXkoKTsNCiAg\nICAgICAgICAgIGFzc2VydEVxdWFscygzLCBhcnJheS5sZW5ndGgpOw0KICAg\nICAgICAgICAgYXNzZXJ0RXF1YWxzKDAuMEYsIGFycmF5WzBdLCAwKTsNCiAg\nICAgICAgICAgIGFzc2VydEVxdWFscygxLjBGLCBhcnJheVsxXSwgMCk7DQog\nICAgICAgICAgICBhc3NlcnRFcXVhbHMoMi4wZiwgYXJyYXlbMl0sIDApOw0K\nICAgICAgICB9DQogICAgICAgIGZpbmFsbHkgew0KICAgICAgICAgICAgZW5k\nRW0obmV3RW0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHZv\naWQgdGVzdERhdGVBcnJheXMoKSB0aHJvd3MgRXhjZXB0aW9uIHsNCiAgICAg\nICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgbmV3RW0gPSAoT3BlbkpQQUVudGl0\neU1hbmFnZXIpIGZhY3RvcnkNCiAgICAgICAgICAgIC5jcmVhdGVFbnRpdHlN\nYW5hZ2VyKCk7DQogICAgICAgIENhY2hlT2JqZWN0QSBhOw0KICAgICAgICBE\nYXRlW10gZGF0ZUFycmF5Ow0KICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nc3RhcnRUeChuZXdFbSk7DQogICAgICAgICAgICBhID0gKENhY2hlT2JqZWN0\nQSkgbmV3RW0uZmluZChDYWNoZU9iamVjdEEuY2xhc3MsIG9pZCk7DQogICAg\nICAgICAgICBkYXRlQXJyYXkgPSBuZXcgRGF0ZVtdeyBuZXcgRGF0ZSgpLCBu\nZXcgRGF0ZSgpLCBuZXcgRGF0ZSgpIH07DQogICAgICAgICAgICBhLnNldERh\ndGVBcnJheShkYXRlQXJyYXkpOw0KICAgICAgICAgICAgZW5kVHgobmV3RW0p\nOw0KICAgICAgICB9DQogICAgICAgIGZpbmFsbHkgew0KICAgICAgICAgICAg\nZW5kRW0obmV3RW0pOw0KICAgICAgICB9DQoNCiAgICAgICAgbmV3RW0gPSAo\nT3BlbkpQQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkuY3JlYXRlRW50aXR5TWFu\nYWdlcigpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYSA9IChDYWNo\nZU9iamVjdEEpIG5ld0VtLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQp\nOw0KICAgICAgICAgICAgRGF0ZVtdIGFycmF5ID0gYS5nZXREYXRlQXJyYXko\nKTsNCiAgICAgICAgICAgIGlmIChhcnJheVswXSA9PSBkYXRlQXJyYXlbMF0p\nIHsNCiAgICAgICAgICAgICAgICBmYWlsKCJkYXRlIG9iamVjdHMgYXJlIHRo\nZSBzYW1lIik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAg\nZmluYWxseSB7DQogICAgICAgICAgICBlbmRFbShuZXdFbSk7DQogICAgICAg\nIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0RGF0ZSgpIHRocm93\ncyBFeGNlcHRpb24gew0KICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBu\nZXdFbSA9IChPcGVuSlBBRW50aXR5TWFuYWdlcikgZmFjdG9yeQ0KICAgICAg\nICAgICAgLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsNCiAgICAgICAgQ2FjaGVP\nYmplY3RBIGE7DQogICAgICAgIERhdGUgZDsNCiAgICAgICAgdHJ5IHsNCiAg\nICAgICAgICAgIHN0YXJ0VHgobmV3RW0pOw0KICAgICAgICAgICAgYSA9IChD\nYWNoZU9iamVjdEEpIG5ld0VtLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLCBv\naWQpOw0KICAgICAgICAgICAgZCA9IG5ldyBEYXRlKCk7DQogICAgICAgICAg\nICBhLnNldERhdGUoZCk7DQogICAgICAgICAgICBlbmRUeChuZXdFbSk7DQog\nICAgICAgIH0NCiAgICAgICAgZmluYWxseSB7DQogICAgICAgICAgICBlbmRF\nbShuZXdFbSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBzbGVlcCBhIGJp\ndCBzbyB3ZSBjYW4gZW5zdXJlIHRoYXQgdGhlIGRhdGUgZG9lc24ndCBqdXN0\nDQogICAgICAgIC8vIGhhcHBlbiB0byBiZSB0aGUgc2FtZS4NCiAgICAgICAg\nVGhyZWFkLnNsZWVwKDEwMCk7DQoNCiAgICAgICAgbmV3RW0gPSAoT3BlbkpQ\nQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigp\nOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYSA9IChDYWNoZU9iamVj\ndEEpIG5ld0VtLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQpOw0KICAg\nICAgICAgICAgRGF0ZSBkMiA9IGEuZ2V0RGF0ZSgpOw0KICAgICAgICAgICAg\naWYgKGQgPT0gZDIpIHsNCiAgICAgICAgICAgICAgICBmYWlsKCJkYXRlIG9i\namVjdHMgYXJlIHRoZSBzYW1lIik7DQogICAgICAgICAgICB9DQoNCiAgICAg\nICAgICAgIGFzc2VydEVxdWFscyhkLmdldFRpbWUoKSwgZDIuZ2V0VGltZSgp\nKTsNCiAgICAgICAgfQ0KICAgICAgICBmaW5hbGx5IHsNCiAgICAgICAgICAg\nIGVuZEVtKG5ld0VtKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1Ymxp\nYyB2b2lkIHRlc3RMb2NhbGUoKSB0aHJvd3MgRXhjZXB0aW9uIHsNCiAgICAg\nICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgbmV3RW0gPSAoT3BlbkpQQUVudGl0\neU1hbmFnZXIpIGZhY3RvcnkNCiAgICAgICAgICAgIC5jcmVhdGVFbnRpdHlN\nYW5hZ2VyKCk7DQogICAgICAgIHN0YXJ0VHgobmV3RW0pOw0KICAgICAgICBD\nYWNoZU9iamVjdEEgYSA9IChDYWNoZU9iamVjdEEpIG5ld0VtLmZpbmQoQ2Fj\naGVPYmplY3RBLmNsYXNzLCBvaWQpOw0KICAgICAgICBMb2NhbGUgbCA9IExv\nY2FsZS5nZXREZWZhdWx0KCk7DQogICAgICAgIGEuc2V0TG9jYWxlKGwpOw0K\nICAgICAgICBlbmRUeChuZXdFbSk7DQoNCiAgICAgICAgT3BlbkpQQUVudGl0\neU1hbmFnZXIgbmV3RW0yID0gKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBmYWN0\nb3J5DQogICAgICAgICAgICAuY3JlYXRlRW50aXR5TWFuYWdlcigpOw0KDQog\nICAgICAgIGEgPSAoQ2FjaGVPYmplY3RBKSBuZXdFbTIuZmluZChDYWNoZU9i\namVjdEEuY2xhc3MsIG9pZCk7DQogICAgICAgIExvY2FsZSBsMiA9IGEuZ2V0\nTG9jYWxlKCk7DQogICAgICAgIC8vIGxvY2FsZXMgYXJlIGltbXV0YWJsZSBh\nbmQgZmluYWwsIHNvIHRoZSBkaWZmZXJlbnQgY2FjaGVkDQogICAgICAgIC8v\nIGNvcGllcyBzaG91bGQgYmUgPT0uDQogICAgICAgIGlmIChsICE9IGwyKSB7\nDQogICAgICAgICAgICBmYWlsKCJsb2NhbGUgb2JqZWN0cyBhcmUgbm90IHRo\nZSBzYW1lLiIpOw0KICAgICAgICB9DQoNCiAgICAgICAgZW5kRW0obmV3RW0p\nOw0KICAgICAgICBlbmRFbShuZXdFbTIpOw0KICAgIH0NCg0KICAgIC8vIC0t\nLS0tLS0tLS0gVGVzdCBxdWVyeSBjYWNoaW5nIC0tLS0tLS0tLS0NCiAgICAv\nLyAqIEZDT3MgYXMgcGFyYW1zDQogICAgLy8gKiBtdWx0aS10aHJlYWRlZCBz\ndHVmZg0KICAgIC8vICogYWNjZXNzIHBhdGggc3R1ZmYgKHNlZSBhbHNvIFRl\nc3RRdWVyeUFjY2Vzc1BhdGgpDQogICAgLy8gKiBzZXJpYWxpemFiaWxpdHkg\nb2YgcmV0dXJuZWQgbGlzdHMNCiAgICAvLyAqIFBNLnNldFF1ZXJ5Q2FjaGVF\nbmFibGVkIChmYWxzZSk7DQogICAgLy8gKiBRdWVyeS5zZXRRdWVyeUNhY2hl\nRW5hYmxlZCAoZmFsc2UpOw0KICAgIC8vICogUGVzc2ltaXN0aWMgdHJhbnNh\nY3Rpb25zDQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0QmFzaWNRdWVyeSgpIHsN\nCiAgICAgICAgYmFzaWNRdWVyaWVzKGZhY3RvcnkuY3JlYXRlRW50aXR5TWFu\nYWdlcigpLCBCb29sZWFuLkZBTFNFLCAzLCAxKTsNCiAgICAgICAgYmFzaWNR\ndWVyaWVzKGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigpLCBCb29sZWFu\nLlRSVUUsIDMsIDEpOw0KDQogICAgICAgIC8vIG1hbnVhbGx5IG5vdGlmeSB0\naGUgY2FjaGUgb2YgY2hhbmdlcw0KICAgICAgICBRdWVyeUNhY2hlIGNhY2hl\nID0gY2FjaGVNYW5hZ2VyKGZhY3RvcnkpLmdldFN5c3RlbVF1ZXJ5Q2FjaGUo\nKTsNCg0KICAgICAgICAvLyB0ZXN0IHRvIHNlZSBpZiBtb2RpZnlpbmcgQiBj\nYXVzZXMgQSdzIHF1ZXJ5IGNhY2hlIHRvIGJlIGZsdXNoZWQNCiAgICAgICAg\nU2V0IHMgPSBuZXcgSGFzaFNldCgpOw0KICAgICAgICBzLmFkZChDYWNoZU9i\namVjdEIuY2xhc3MpOw0KICAgICAgICBjYWNoZS5vblR5cGVzQ2hhbmdlZChu\nZXcgVHlwZXNDaGFuZ2VkRXZlbnQodGhpcywgcykpOw0KICAgICAgICBiYXNp\nY1F1ZXJpZXMoZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCksIEJvb2xl\nYW4uVFJVRSwgMywgMSk7DQoNCiAgICAgICAgLy8gdGVzdCB0byBzZWUgaWYg\nbW9kaWZ5aW5nIEEgY2F1c2VzIEEncyBxdWVyeSBjYWNoZSB0byBiZSBmbHVz\naGVkDQogICAgICAgIHMuYWRkKENhY2hlT2JqZWN0QS5jbGFzcyk7DQogICAg\nICAgIGNhY2hlLm9uVHlwZXNDaGFuZ2VkKG5ldyBUeXBlc0NoYW5nZWRFdmVu\ndCh0aGlzLCBzKSk7DQogICAgICAgIGJhc2ljUXVlcmllcyhmYWN0b3J5LmNy\nZWF0ZUVudGl0eU1hbmFnZXIoKSwgQm9vbGVhbi5GQUxTRSwgMywgMSk7DQoN\nCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgbm9uLW1hbnVhbCBub3RpZmlj\nYXRpb24gd29ya3MNCiAgICAgICAgRW50aXR5TWFuYWdlciBlbSA9IGZhY3Rv\ncnkuY3JlYXRlRW50aXR5TWFuYWdlcigpOw0KICAgICAgICB0cnkgew0KICAg\nICAgICAgICAgc3RhcnRUeChlbSk7DQogICAgICAgICAgICBDYWNoZU9iamVj\ndEEgYSA9IG5ldyBDYWNoZU9iamVjdEEoT1JJR19OQU1FLCBPUklHX0FHRSk7\nDQogICAgICAgICAgICBlbS5wZXJzaXN0KGEpOw0KICAgICAgICAgICAgZW5k\nVHgoZW0pOw0KICAgICAgICB9DQogICAgICAgIGZpbmFsbHkgew0KICAgICAg\nICAgICAgZW5kRW0oZW0pOw0KICAgICAgICB9DQoNCiAgICAgICAgYmFzaWNR\ndWVyaWVzKGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigpLCBCb29sZWFu\nLkZBTFNFLCA0LCAyKTsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgdm9pZCBi\nYXNpY1F1ZXJpZXMoRW50aXR5TWFuYWdlciBlbSwgQm9vbGVhbiBpbkNhY2hl\nLCBpbnQgYWxsU2l6ZSwNCiAgICAgICAgaW50IG9yaWdTaXplKSB7DQogICAg\nICAgIHRyeSB7DQogICAgICAgICAgICBsb25nIHN0YXJ0Ow0KICAgICAgICAg\nICAgbG9uZyBxMXAxOw0KICAgICAgICAgICAgbG9uZyBxMXAyOw0KICAgICAg\nICAgICAgbG9uZyBxMnAxOw0KICAgICAgICAgICAgbG9uZyBxMnAyOw0KDQog\nICAgICAgICAgICBCcm9rZXIgYnJva2VyID0gSlBBRmFjYWRlSGVscGVyLnRv\nQnJva2VyKGVtKTsNCiAgICAgICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuUXVlcnkgcSA9IGJyb2tlci5uZXdRdWVyeSgNCiAgICAgICAgICAg\nICAgICBKUFFMUGFyc2VyLkxBTkdfSlBRTCwgIlNlbGVjdCBhIEZST00gIg0K\nICAgICAgICAgICAgICAgICsgQ2FjaGVPYmplY3RBLmNsYXNzLmdldFNpbXBs\nZU5hbWUoKSArICIgYSIpOw0KICAgICAgICAgICAgcS5zZXRDYW5kaWRhdGVF\neHRlbnQoYnJva2VyLm5ld0V4dGVudChDYWNoZU9iamVjdEEuY2xhc3MsIGZh\nbHNlKSk7DQogICAgICAgICAgICBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOw0KICAgICAgICAgICAgYXNzZXJ0SW5DYWNoZShxLCBpbkNh\nY2hlKTsNCiAgICAgICAgICAgIExpc3QgbCA9IChMaXN0KSBxLmV4ZWN1dGUo\nKTsNCiAgICAgICAgICAgIGl0ZXJhdGUobCk7DQogICAgICAgICAgICBxMXAx\nID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgLSBzdGFydDsNCg0KICAg\nICAgICAgICAgYXNzZXJ0RXF1YWxzKGFsbFNpemUsIGwuc2l6ZSgpKTsNCg0K\nICAgICAgICAgICAgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMo\nKTsNCiAgICAgICAgICAgIExpc3QgbDIgPSAoTGlzdCkgcS5leGVjdXRlKCk7\nDQogICAgICAgICAgICBpdGVyYXRlKGwyKTsNCiAgICAgICAgICAgIHExcDIg\nPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSAtIHN0YXJ0Ow0KICAgICAg\nICAgICAgYXNzZXJ0RXF1YWxzKGFsbFNpemUsIGwyLnNpemUoKSk7DQoNCiAg\nICAgICAgICAgIHEgPSBicm9rZXIubmV3UXVlcnkoSlBRTFBhcnNlci5MQU5H\nX0pQUUwsDQogICAgICAgICAgICAgICAgInNlbGVjdCBhLm5hbWUsYS5hZ2Ug\nZnJvbSAiDQogICAgICAgICAgICAgICAgICAgICsgQ2FjaGVPYmplY3RBLmNs\nYXNzLmdldFNpbXBsZU5hbWUoKQ0KICAgICAgICAgICAgICAgICAgICArICIg\nYSB3aGVyZSBhLm5hbWUgPSA6biBBTkQgYS5hZ2UgPSA6YSIpOw0KICAgICAg\nICAgICAgcS5zZXRDYW5kaWRhdGVFeHRlbnQoYnJva2VyLm5ld0V4dGVudChD\nYWNoZU9iamVjdEEuY2xhc3MsIGZhbHNlKSk7DQogICAgICAgICAgICBzdGFy\ndCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOw0KICAgICAgICAgICAg\nYXNzZXJ0SW5DYWNoZShxLCBpbkNhY2hlLCBuZXcgT2JqZWN0W117IE9SSUdf\nTkFNRSwNCiAgICAgICAgICAgICAgICBuZXcgSW50ZWdlcihPUklHX0FHRSkg\nfSk7DQogICAgICAgICAgICBsID0gKExpc3QpIHEuZXhlY3V0ZShuZXcgT2Jq\nZWN0W117IE9SSUdfTkFNRSwNCiAgICAgICAgICAgICAgICBuZXcgSW50ZWdl\ncihPUklHX0FHRSkgfSk7DQogICAgICAgICAgICBpdGVyYXRlKGwpOw0KICAg\nICAgICAgICAgcTJwMSA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpIC0g\nc3RhcnQ7DQoNCiAgICAgICAgICAgIGFzc2VydEVxdWFscyhvcmlnU2l6ZSwg\nbC5zaXplKCkpOw0KDQogICAgICAgICAgICBzdGFydCA9IFN5c3RlbS5jdXJy\nZW50VGltZU1pbGxpcygpOw0KICAgICAgICAgICAgbDIgPSAoTGlzdCkgcS5l\neGVjdXRlKG5ldyBPYmplY3RbXXsgT1JJR19OQU1FLA0KICAgICAgICAgICAg\nICAgIG5ldyBJbnRlZ2VyKE9SSUdfQUdFKSB9KTsNCiAgICAgICAgICAgIGl0\nZXJhdGUobDIpOw0KICAgICAgICAgICAgcTJwMiA9IFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpIC0gc3RhcnQ7DQoNCiAgICAgICAgICAgIGFzc2VydEVx\ndWFscyhvcmlnU2l6ZSwgbDIuc2l6ZSgpKTsNCiAgICAgICAgICAgIC8vIFN5\nc3RlbS5vdXQucHJpbnRsbiAoImluQ2FjaGU6ICIgKyBpbkNhY2hlICsgIjtc\ndCBxMXAxOiAiICsgcTFwMQ0KICAgICAgICAgICAgLy8gKyAiO1x0IHExcDI6\nICIgKyBxMXAyICsgIjtcdCBxMnAxOiAiICsgcTJwMSArICI7XHQgcTJwMjog\nIg0KICAgICAgICAgICAgLy8gKyBxMnAyKTsNCiAgICAgICAgfQ0KICAgICAg\nICBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZEVtKGVtKTsNCiAgICAgICAg\nfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHRlc3ROb25DYWNoZWFibGVD\nbGFzcygpIHsNCiAgICAgICAgQnJva2VyIGJyb2tlciA9IEpQQUZhY2FkZUhl\nbHBlci50b0Jyb2tlckZhY3RvcnkoZmFjdG9yeSkubmV3QnJva2VyKCk7DQog\nICAgICAgIHRyeSB7DQogICAgICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLlF1ZXJ5IHEgPSBicm9rZXIubmV3UXVlcnkoDQogICAgICAgICAg\nICAgICAgSlBRTFBhcnNlci5MQU5HX0pQUUwsICJTZWxlY3QgYSBGUk9NICIN\nCiAgICAgICAgICAgICAgICArIENhY2hlT2JqZWN0Qi5jbGFzcy5nZXRTaW1w\nbGVOYW1lKCkgKyAiIGEiKTsNCg0KICAgICAgICAgICAgQ29sbGVjdGlvbiBj\nID0gKENvbGxlY3Rpb24pIHEuZXhlY3V0ZSgpOw0KICAgICAgICAgICAgaXRl\ncmF0ZShjKTsNCg0KICAgICAgICAgICAgYXNzZXJ0SW5DYWNoZShxLCBCb29s\nZWFuLkZBTFNFKTsNCiAgICAgICAgfQ0KICAgICAgICBmaW5hbGx5IHsNCiAg\nICAgICAgICAgIGNsb3NlKGJyb2tlcik7DQogICAgICAgIH0NCiAgICB9DQoN\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0Tm9uQ2FjaGVhYmxlQWNjZXNzUGF0aCgp\nIHsNCiAgICAgICAgQnJva2VyIGJyb2tlciA9IEpQQUZhY2FkZUhlbHBlci50\nb0Jyb2tlckZhY3RvcnkoZmFjdG9yeSkubmV3QnJva2VyKCk7DQogICAgICAg\nIHRyeSB7DQogICAgICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLlF1ZXJ5IHEgPSBicm9rZXIubmV3UXVlcnkoDQogICAgICAgICAgICAgICAg\nSlBRTFBhcnNlci5MQU5HX0pQUUwsICJTZWxlY3QgYSBGUk9NICINCiAgICAg\nICAgICAgICAgICArIENhY2hlT2JqZWN0QS5jbGFzcy5nZXRTaW1wbGVOYW1l\nKCkNCiAgICAgICAgICAgICAgICArICIgYSB3aGVyZSBhLnJlbGF0ZWRCLnN0\nciA9ICdmb28nIik7DQogICAgICAgICAgICAvLyAicmVsYXRlZEIuc3RyID09\nICdmb28nIik7DQogICAgICAgICAgICBxLnNldENhbmRpZGF0ZUV4dGVudChi\ncm9rZXIubmV3RXh0ZW50KENhY2hlT2JqZWN0QS5jbGFzcywgZmFsc2UpKTsN\nCg0KICAgICAgICAgICAgQ29sbGVjdGlvbiBjID0gKENvbGxlY3Rpb24pIHEu\nZXhlY3V0ZSgpOw0KICAgICAgICAgICAgaXRlcmF0ZShjKTsNCg0KICAgICAg\nICAgICAgYXNzZXJ0SW5DYWNoZShxLCBCb29sZWFuLkZBTFNFKTsNCiAgICAg\nICAgfQ0KICAgICAgICBmaW5hbGx5IHsNCiAgICAgICAgICAgIGNsb3NlKGJy\nb2tlcik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0\nZXN0Tm9uQ2FjaGVhYmxlU3ViY2xhc3NlczEoKSB7DQogICAgICAgIEJyb2tl\nciBicm9rZXIgPSBKUEFGYWNhZGVIZWxwZXIudG9Ccm9rZXJGYWN0b3J5KGZh\nY3RvcnkpLm5ld0Jyb2tlcigpOw0KICAgICAgICB0cnkgew0KICAgICAgICAg\nICAgLy8gYSBxdWVyeSBvbiB0aGUgQ2FjaGVPYmplY3RBIGNsYXNzIGluY2x1\nZGVzIGFuIHVuY2FjaGVhYmxlDQogICAgICAgICAgICAvLyBjbGFzczsgaXQg\nc2hvdWxkIHRoZXJlZm9yZSBub3QgYmUgY2FjaGVhYmxlLg0KICAgICAgICAg\nICAgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeSBxID0gYnJva2Vy\nLm5ld1F1ZXJ5KA0KICAgICAgICAgICAgICAgIEpQUUxQYXJzZXIuTEFOR19K\nUFFMLCAiU2VsZWN0IGEgRlJPTSAiDQogICAgICAgICAgICAgICAgKyBDYWNo\nZU9iamVjdEEuY2xhc3MuZ2V0U2ltcGxlTmFtZSgpICsgIiBhIik7DQoNCiAg\nICAgICAgICAgIENvbGxlY3Rpb24gYyA9IChDb2xsZWN0aW9uKSBxLmV4ZWN1\ndGUoKTsNCiAgICAgICAgICAgIGl0ZXJhdGUoYyk7DQoNCiAgICAgICAgICAg\nIGFzc2VydEluQ2FjaGUocSwgQm9vbGVhbi5GQUxTRSk7DQogICAgICAgIH0N\nCiAgICAgICAgZmluYWxseSB7DQogICAgICAgICAgICBjbG9zZShicm9rZXIp\nOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgdGVzdE5v\nbkNhY2hlYWJsZVN1YmNsYXNzZXMyKCkgew0KICAgICAgICBCcm9rZXIgYnJv\na2VyID0gSlBBRmFjYWRlSGVscGVyLnRvQnJva2VyRmFjdG9yeShmYWN0b3J5\nKS5uZXdCcm9rZXIoKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIC8v\nIGEgcXVlcnkgb24gdGhlIENhY2hlT2JqZWN0QSBleHRlbnQgY29uZmlndXJl\nZCB3aXRob3V0DQogICAgICAgICAgICAvLyBzdWJjbGFzc2VzIGRvZXMgbm90\nIGluY2x1ZGUgYW4gdW5jYWNoZWFibGUgY2xhc3M7IGl0IHNob3VsZA0KICAg\nICAgICAgICAgLy8gdGhlcmVmb3JlIGJlIGNhY2hlYWJsZS4NCiAgICAgICAg\nICAgIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgcSA9IGJyb2tl\nci5uZXdRdWVyeSgNCiAgICAgICAgICAgICAgICBKUFFMUGFyc2VyLkxBTkdf\nSlBRTCwgInNlbGVjdCBhIGZyb20gIg0KICAgICAgICAgICAgICAgICsgQ2Fj\naGVPYmplY3RBLmNsYXNzLmdldFNpbXBsZU5hbWUoKSArICIgYSIpOw0KICAg\nICAgICAgICAgcS5zZXRDYW5kaWRhdGVFeHRlbnQoYnJva2VyLm5ld0V4dGVu\ndChDYWNoZU9iamVjdEEuY2xhc3MsIGZhbHNlKSk7DQoNCiAgICAgICAgICAg\nIENvbGxlY3Rpb24gYyA9IChDb2xsZWN0aW9uKSBxLmV4ZWN1dGUoKTsNCiAg\nICAgICAgICAgIGl0ZXJhdGUoYyk7DQoNCiAgICAgICAgICAgIGFzc2VydElu\nQ2FjaGUocSwgQm9vbGVhbi5UUlVFKTsNCiAgICAgICAgfQ0KICAgICAgICBm\naW5hbGx5IHsNCiAgICAgICAgICAgIGNsb3NlKGJyb2tlcik7DQogICAgICAg\nIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0Q2FjaGVOYW1lcygp\nIHsNCiAgICAgICAgYXNzZXJ0Q2FjaGVOYW1lKENhY2hlT2JqZWN0QS5jbGFz\ncywgRGF0YUNhY2hlLk5BTUVfREVGQVVMVCk7DQogICAgICAgIGFzc2VydENh\nY2hlTmFtZShDYWNoZU9iamVjdEFDaGlsZDEuY2xhc3MsIERhdGFDYWNoZS5O\nQU1FX0RFRkFVTFQpOw0KICAgICAgICBhc3NlcnRDYWNoZU5hbWUoQ2FjaGVP\nYmplY3RBQ2hpbGQyLmNsYXNzLCBudWxsKTsNCiAgICAgICAgYXNzZXJ0Q2Fj\naGVOYW1lKENhY2hlT2JqZWN0Qi5jbGFzcywgbnVsbCk7DQogICAgICAgIGFz\nc2VydENhY2hlTmFtZShDYWNoZU9iamVjdEJDaGlsZDEuY2xhc3MsIG51bGwp\nOw0KICAgICAgICBhc3NlcnRDYWNoZU5hbWUoQ2FjaGVPYmplY3RDLmNsYXNz\nLCAibm90LXRoZS1kZWZhdWx0LWNhY2hlIik7DQogICAgICAgIGFzc2VydENh\nY2hlTmFtZShDYWNoZU9iamVjdEQuY2xhc3MsICJub3QtdGhlLWRlZmF1bHQt\nY2FjaGUiKTsNCiAgICAgICAgYXNzZXJ0Q2FjaGVOYW1lKENhY2hlT2JqZWN0\nRS5jbGFzcywgRGF0YUNhY2hlLk5BTUVfREVGQVVMVCk7DQogICAgICAgIGFz\nc2VydENhY2hlTmFtZShDYWNoZU9iamVjdEYuY2xhc3MsIERhdGFDYWNoZS5O\nQU1FX0RFRkFVTFQpOw0KICAgICAgICBhc3NlcnRDYWNoZU5hbWUoQ2FjaGVP\nYmplY3RHLmNsYXNzLCBEYXRhQ2FjaGUuTkFNRV9ERUZBVUxUKTsNCiAgICAg\nICAgYXNzZXJ0Q2FjaGVOYW1lKENhY2hlT2JqZWN0SC5jbGFzcywgRGF0YUNh\nY2hlLk5BTUVfREVGQVVMVCk7DQogICAgICAgIGFzc2VydENhY2hlTmFtZShD\nYWNoZU9iamVjdEouY2xhc3MsIERhdGFDYWNoZS5OQU1FX0RFRkFVTFQpOw0K\nICAgICAgICBhc3NlcnRDYWNoZU5hbWUoQXBwSWRDYWNoZU9iamVjdC5jbGFz\ncywgRGF0YUNhY2hlLk5BTUVfREVGQVVMVCk7DQogICAgfQ0KDQogICAgcHJp\ndmF0ZSB2b2lkIGFzc2VydENhY2hlTmFtZShDbGFzcyBjbHMsIFN0cmluZyBj\nYWNoZU5hbWUpIHsNCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gSlBB\nRmFjYWRlSGVscGVyLmdldE1ldGFEYXRhKGZhY3RvcnksIGNscyk7DQogICAg\nICAgIGlmIChjYWNoZU5hbWUgPT0gbnVsbCkNCiAgICAgICAgICAgIGFzc2Vy\ndE51bGwobWV0YS5nZXREYXRhQ2FjaGUoKSk7DQogICAgICAgIGVsc2Ugew0K\nICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChtZXRhLmdldERhdGFDYWNoZSgp\nKTsNCiAgICAgICAgICAgIGFzc2VydEVxdWFscyhjYWNoZU5hbWUsIG1ldGEu\nZ2V0RGF0YUNhY2hlKCkuZ2V0TmFtZSgpKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIC8vIEZJWE1FIFNlZXRoYSBTZXAgMjYsMjAwNg0KICAgIC8vIG5v\ndCBhYmxlIHRvIHJlcGxhY2UgcG0ubmV3UXVlcnkoQ2FjaGVPYmplY3RBLmNs\nYXNzKTsNCiAgICAvKg0KICAgICAgKiBwdWJsaWMgdm9pZCB0ZXN0UXVlcnlB\nZ2dyZWdhdGVzKCkgeyBQZXJzaXN0ZW5jZU1hbmFnZXIgcG0gPQ0KICAgICAg\nKiBmYWN0b3J5LmdldFBlcnNpc3RlbmNlTWFuYWdlcigpOyB0cnkgeyBRdWVy\neSBxID0NCiAgICAgICogcG0ubmV3UXVlcnkoQ2FjaGVPYmplY3RBLmNsYXNz\nKTsgcS5zZXRSZXN1bHQoIm1heCAoYWdlKSIpOyBPYmplY3QgbyA9DQogICAg\nICAqIHEuZXhlY3V0ZSgpOyBhc3NlcnRUcnVlKCJvIG11c3QgYmUgaW5zdGFu\nY2VvZiBOdW1iZXIiLCBvIGluc3RhbmNlb2YNCiAgICAgICogTnVtYmVyKTsg\nfSBmaW5hbGx5IHsgY2xvc2UocG0pOyB9IH0NCiAgICAgICovDQoNCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0Q2FjaGUyKCkgew0KICAgICAgICBPcGVuSlBBRW50\naXR5TWFuYWdlciBlbTEgPQ0KICAgICAgICAgICAgKE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyKSBmYWN0b3J5LmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsNCiAgICAg\nICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0yID0gbnVsbDsNCiAgICAgICAg\nRGF0YUNhY2hlIGNhY2hlOw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAg\nICBDYWNoZU9iamVjdEEgYTEgPSAoQ2FjaGVPYmplY3RBKSBlbTEuZmluZChD\nYWNoZU9iamVjdEEuY2xhc3MsIG9pZCk7DQoNCiAgICAgICAgICAgIGVtMiA9\nIChPcGVuSlBBRW50aXR5TWFuYWdlcikgZmFjdG9yeTIuY3JlYXRlRW50aXR5\nTWFuYWdlcigpOw0KICAgICAgICAgICAgQ2FjaGVPYmplY3RBIGEyID0gKENh\nY2hlT2JqZWN0QSkgZW0yLmZpbmQoQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQp\nOw0KDQogICAgICAgICAgICAvLyBhc3NlcnQgdGhhdCB0aGUgb2lkIGlzIGlu\nIGZhY3RvcnkyJ3MgY2FjaGUNCiAgICAgICAgICAgIC8vTWV0YURhdGFSZXBv\nc2l0b3J5IHJlcG9zMiA9IGZhY3RvcnkyLmdldENvbmZpZ3VyYXRpb24oKS5n\nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOw0KICAgICAgICAgICAg\nTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zMiA9DQogICAgICAgICAgICAgICAg\nKCgoKE9wZW5KUEFFbnRpdHlNYW5hZ2VyRmFjdG9yeVNQSSkgZmFjdG9yeTIp\nKS5nZXRDb25maWd1cmF0aW9uKCkpDQogICAgICAgICAgICAgICAgICAgIC5n\nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOw0KICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhID0gcmVwb3MyDQogICAgICAgICAgICAgICAg\nLmdldE1ldGFEYXRhKENhY2hlT2JqZWN0QS5jbGFzcywgZW0yLmdldENsYXNz\nTG9hZGVyKCksIHRydWUpOw0KICAgICAgICAgICAgY2FjaGUgPSBtZXRhLmdl\ndERhdGFDYWNoZSgpOw0KICAgICAgICAgICAgYXNzZXJ0VHJ1ZShjYWNoZS5j\nb250YWlucyhvaWR3aXRoY2xhc3MpKTsNCg0KICAgICAgICAgICAgLy8gbW9k\naWZ5IHRoZSBvYmplY3QuDQogICAgICAgICAgICBzdGFydFR4KGVtMSk7DQog\nICAgICAgICAgICBhMS5zZXROYW1lKGExLmdldE5hbWUoKSArICIgY2hhbmdl\nZCIpOw0KICAgICAgICAgICAgZW5kVHgoZW0xKTsNCiAgICAgICAgfQ0KICAg\nICAgICBmaW5hbGx5IHsNCiAgICAgICAgICAgIGlmIChlbTIgIT0gbnVsbCkN\nCiAgICAgICAgICAgICAgICBlbmRFbShlbTIpOw0KICAgICAgICAgICAgZW5k\nRW0oZW0xKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIGlmIHRoZSBjYWNo\nZSBpcyBhIGNvaGVyZW50IG9uZSwgdGhlbiB0aGUgY2hhbmdlcyBzaG91bGQg\nYmUNCiAgICAgICAgLy8gc2Vlbi4gT3RoZXJ3aXNlLCB0aGV5IHNob3VsZCBu\nb3QuDQogICAgICAgIGlmIChpc0NhY2hlQ29oZXJlbnQoKSB8fCBmYWN0b3J5\nID09IGZhY3RvcnkyKQ0KICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgia2V5ICIg\nKyBvaWQgKyAiIHdhcyBub3QgaW4gY2FjaGU7IHNob3VsZCBoYXZlIGJlZW4i\nLA0KICAgICAgICAgICAgICAgIGNhY2hlLmNvbnRhaW5zKG9pZHdpdGhjbGFz\ncykpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBhc3NlcnRGYWxzZSgi\na2V5ICIgKyBvaWQgKyAiIHdhcyBpbiBjYWNoZTsgc2hvdWxkIG5vdCBoYXZl\nIGJlZW4iLA0KICAgICAgICAgICAgICAgIGNhY2hlLmNvbnRhaW5zKG9pZHdp\ndGhjbGFzcykpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHRlc3RUaW1l\nb3V0czEoKSB0aHJvd3MgRXhjZXB0aW9uIHsNCiAgICAgICAgdGltZW91dHNU\nZXN0MSgxKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0aW1lb3V0c1Rl\nc3QxKGludCB0cmllcykgdGhyb3dzIEV4Y2VwdGlvbiB7DQogICAgICAgIC8v\nIHRoaXMgY3JhenkgZm9yIGxvb3Bpbmcgc3R1ZmYgaXMgaGVyZSBiZWNhdXNl\nIHdlJ3JlIHNlZWluZw0KICAgICAgICAvLyBpbnRlcm1pdHRlbnQgZmFpbHVy\nZXMgd2l0aCB0aGUgZ2FyYmFnZSBjb2xsZWN0b3Iga2lja2luZyBpbg0KICAg\nICAgICAvLyBkdXJpbmcgdGVzdGluZy4gU28sIHRoaXMgZGVjcmVhc2VzIHRo\nZSBjaGFuY2VzIHRoYXQgdGhhdA0KICAgICAgICAvLyB3aWxsIGhhcHBlbi4N\nCiAgICAgICAgRXhjZXB0aW9uIGUgPSBudWxsOw0KICAgICAgICBpbnQgaTsN\nCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRyaWVzOyBpKyspIHsNCiAgICAg\nICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgdGltZW91dHNIZWxwZXIo\nZmFjdG9yeSk7DQogICAgICAgICAgICAgICAgLy8gYW55IHN1Y2Nlc3NlcyB3\naWxsIHBhc3MgdGhlIHRlc3QNCiAgICAgICAgICAgICAgICByZXR1cm47DQog\nICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4\nKSB7DQogICAgICAgICAgICAgICAgZSA9IGV4Ow0KICAgICAgICAgICAgfQ0K\nICAgICAgICB9DQoNCiAgICAgICAgdGhyb3cgZTsNCiAgICB9DQoNCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0VGltZW91dHMyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nDQogICAgICAgIHRpbWVvdXRzVGVzdDIoMzApOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyB2b2lkIHRpbWVvdXRzVGVzdDIoaW50IHRyaWVzKSB0aHJvd3MgRXhj\nZXB0aW9uIHsNCiAgICAgICAgRXJyb3IgZSA9IG51bGw7DQogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgdHJpZXM7IGkrKykgew0KICAgICAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgICAgICB0aW1lb3V0c0hlbHBlcih0aW1lb3V0\nRmFjdG9yeSk7DQogICAgICAgICAgICAgICAgLy8gYW55IHN1Y2Nlc3NlcyB3\naWxsIHBhc3MgdGhlIHRlc3QNCiAgICAgICAgICAgICAgICByZXR1cm47DQog\nICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoQXNzZXJ0aW9uRmFp\nbGVkRXJyb3IgYWZlKSB7DQogICAgICAgICAgICAgICAgZSA9IGFmZTsNCiAg\nICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHRocm93IGU7DQog\nICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIHRpbWVvdXRzSGVscGVyKE9wZW5K\nUEFFbnRpdHlNYW5hZ2VyRmFjdG9yeSBmYWN0b3J5KQ0KICAgICAgICB0aHJv\nd3MgRXhjZXB0aW9uIHsNCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIg\nZW0gPSAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkNCiAgICAgICAg\nICAgIC5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQogICAgICAgIHRyeSB7DQog\nICAgICAgICAgICBzdGFydFR4KGVtKTsNCg0KICAgICAgICAgICAgQ2FjaGVP\nYmplY3RFIGUgPSBuZXcgQ2FjaGVPYmplY3RFKCJlIik7DQogICAgICAgICAg\nICBlbS5wZXJzaXN0KGUpOw0KDQogICAgICAgICAgICBDYWNoZU9iamVjdEYg\nZiA9IG5ldyBDYWNoZU9iamVjdEYoImYiKTsNCiAgICAgICAgICAgIGVtLnBl\ncnNpc3QoZik7DQoNCiAgICAgICAgICAgIENhY2hlT2JqZWN0RyBnID0gbmV3\nIENhY2hlT2JqZWN0RygiZyIpOw0KICAgICAgICAgICAgZW0ucGVyc2lzdChn\nKTsNCg0KICAgICAgICAgICAgQ2FjaGVPYmplY3RIIGggPSBuZXcgQ2FjaGVP\nYmplY3RIKCJoIik7DQogICAgICAgICAgICBlbS5wZXJzaXN0KGgpOw0KDQog\nICAgICAgICAgICBlbmRUeChlbSk7DQoNCiAgICAgICAgICAgIE9iamVjdFtd\nIGlkcyA9IG5ldyBPYmplY3RbNF07DQogICAgICAgICAgICBpZHNbMF0gPSBu\nZXcgSWQoQ2FjaGVPYmplY3RFLmNsYXNzLCBlbS5nZXRPYmplY3RJZChlKS50\nb1N0cmluZygpKTsNCiAgICAgICAgICAgIGlkc1sxXSA9IG5ldyBJZChDYWNo\nZU9iamVjdEYuY2xhc3MsIGVtLmdldE9iamVjdElkKGYpLnRvU3RyaW5nKCkp\nOw0KICAgICAgICAgICAgaWRzWzJdID0gbmV3IElkKENhY2hlT2JqZWN0Ry5j\nbGFzcywgZW0uZ2V0T2JqZWN0SWQoZykudG9TdHJpbmcoKSk7DQogICAgICAg\nICAgICBpZHNbM10gPSBuZXcgSWQoQ2FjaGVPYmplY3RILmNsYXNzLCBlbS5n\nZXRPYmplY3RJZChoKS50b1N0cmluZygpKTsNCg0KICAgICAgICAgICAgLy8g\nYnVpbGQgdXAgc29tZSBxdWVyaWVzIHRvIHRlc3QNCg0KICAgICAgICAgICAg\nLy8gdGhpcyBvbmUgc2hvdWxkIGJlIG9ubHkgb24gdGhlIHN1cGVyY2xhc3Ms\nIHNpbmNlDQogICAgICAgICAgICAvLyBDYWNoZU9iamVjdEYgaGFzIGEgdGlt\nZW91dC4NCiAgICAgICAgICAgIEJyb2tlciBicm9rZXIgPSBKUEFGYWNhZGVI\nZWxwZXIudG9Ccm9rZXIoZW0pOw0KICAgICAgICAgICAgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5RdWVyeSBxMSA9IGJyb2tlci5uZXdRdWVyeSgNCiAg\nICAgICAgICAgICAgICBKUFFMUGFyc2VyLkxBTkdfSlBRTCwgInNlbGVjdCBh\nIGZyb20gIg0KICAgICAgICAgICAgICAgICsgQ2FjaGVPYmplY3RFLmNsYXNz\nLmdldFNpbXBsZU5hbWUoKSArICIgYSIpOw0KICAgICAgICAgICAgcTEuc2V0\nQ2FuZGlkYXRlRXh0ZW50KGJyb2tlci5uZXdFeHRlbnQoQ2FjaGVPYmplY3RF\nLmNsYXNzLCBmYWxzZSkpOw0KICAgICAgICAgICAgaXRlcmF0ZSgoQ29sbGVj\ndGlvbikgcTEuZXhlY3V0ZSgpKTsNCiAgICAgICAgICAgIGFzc2VydEluQ2Fj\naGUocTEsIEJvb2xlYW4uVFJVRSk7DQoNCiAgICAgICAgICAgIG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgcTIgPSBicm9rZXIubmV3UXVlcnko\nDQogICAgICAgICAgICAgICAgSlBRTFBhcnNlci5MQU5HX0pQUUwsICJTZWxl\nY3QgYSBGUk9NICINCiAgICAgICAgICAgICAgICArIENhY2hlT2JqZWN0Ri5j\nbGFzcy5nZXRTaW1wbGVOYW1lKCkgKyAiIGEiKTsNCiAgICAgICAgICAgIGl0\nZXJhdGUoKENvbGxlY3Rpb24pIHEyLmV4ZWN1dGUoKSk7DQogICAgICAgICAg\nICBhc3NlcnRJbkNhY2hlKHEyLCBCb29sZWFuLlRSVUUpOw0KDQogICAgICAg\nICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBjYWNoZU1hbmFnZXIoZmFjdG9yeSku\nZ2V0RGF0YUNhY2hlKA0KICAgICAgICAgICAgICAgIERhdGFDYWNoZS5OQU1F\nX0RFRkFVTFQsIGZhbHNlKTsNCiAgICAgICAgICAgIGNoZWNrQ2FjaGUoY2Fj\naGUsIGlkcywgbmV3IGJvb2xlYW5bXXsgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1\nZSB9KTsNCg0KICAgICAgICAgICAgLy8gc2hvdWxkIGNhdXNlIGggdG8gYmUg\nZHJvcHBlZC4NCiAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCku\nc2xlZXAoNTUxKTsNCiAgICAgICAgICAgIFRocmVhZC55aWVsZCgpOw0KICAg\nICAgICAgICAgY2hlY2tDYWNoZShjYWNoZSwgaWRzLCBuZXcgYm9vbGVhbltd\neyB0cnVlLCB0cnVlLCB0cnVlLCBmYWxzZSB9KTsNCg0KICAgICAgICAgICAg\nLy8gaWYgdGhpcyBydW4gaGFzIGEgZGVmYXVsdCB0aW1lb3V0IChzZXQgdG8g\nMSBzZWMgaW4gdGhlIHRlc3QNCiAgICAgICAgICAgIC8vIGNhc2UpLCBlIHNo\nb3VsZCBiZSB0aW1lZCBvdXQgYnkgdGhpcyBwb2ludC4NCiAgICAgICAgICAg\nIC8vYm9vbGVhbiBlU3RhdHVzID0gIShmYWN0b3J5LmdldENvbmZpZ3VyYXRp\nb24oKS5nZXREYXRhQ2FjaGVUaW1lb3V0KCkgPiAwKTsNCiAgICAgICAgICAg\nIGJvb2xlYW4gZVN0YXR1cyA9DQogICAgICAgICAgICAgICAgISgoKChPcGVu\nSlBBRW50aXR5TWFuYWdlckZhY3RvcnlTUEkpIGZhY3RvcnkpLmdldENvbmZp\nZ3VyYXRpb24oKSkNCiAgICAgICAgICAgICAgICAgICAgLmdldERhdGFDYWNo\nZVRpbWVvdXQoKSA+IDApOw0KDQogICAgICAgICAgICAvLyBzaG91bGQgY2F1\nc2UgZiB0byBiZSBkcm9wcGVkLg0KICAgICAgICAgICAgVGhyZWFkLmN1cnJl\nbnRUaHJlYWQoKS5zbGVlcCg1NTApOw0KICAgICAgICAgICAgVGhyZWFkLnlp\nZWxkKCk7DQogICAgICAgICAgICBjaGVja0NhY2hlKGNhY2hlLCBpZHMsDQog\nICAgICAgICAgICAgICAgbmV3IGJvb2xlYW5bXXsgZVN0YXR1cywgZmFsc2Us\nIHRydWUsIGZhbHNlIH0pOw0KDQogICAgICAgICAgICAvLyBhdCB0aGlzIHBv\naW50LCBxMiBzaG91bGQgYmUgZHJvcHBlZCAoYmVjYXVzZSBpdHMgY2FuZGlk\nYXRlDQogICAgICAgICAgICAvLyBjbGFzcyBpcyBDYWNoZU9iamVjdEYpLCBh\nbmQgcTEgbWlnaHQgYmUgZHJvcHBlZCwgZGVwZW5kaW5nDQogICAgICAgICAg\nICAvLyBvbiB3aGV0aGVyIG9yIG5vdCB3ZSd2ZSBnb3QgYSB0aW1lb3V0IGNv\nbmZpZ3VyZWQuDQogICAgICAgICAgICBhc3NlcnRJbkNhY2hlKHExLCAoZVN0\nYXR1cykgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFKTsNCiAgICAg\nICAgICAgIGFzc2VydEluQ2FjaGUocTIsIEJvb2xlYW4uRkFMU0UpOw0KDQog\nICAgICAgICAgICAvLyBzaG91bGQgY2F1c2UgZyB0byBiZSBkcm9wcGVkLg0K\nICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5zbGVlcCg0MDUw\nKTsNCiAgICAgICAgICAgIFRocmVhZC55aWVsZCgpOw0KICAgICAgICAgICAg\nY2hlY2tDYWNoZShjYWNoZSwgaWRzLA0KICAgICAgICAgICAgICAgIG5ldyBi\nb29sZWFuW117IGVTdGF0dXMsIGZhbHNlLCBmYWxzZSwgZmFsc2UgfSk7DQog\nICAgICAgIH0NCiAgICAgICAgZmluYWxseSB7DQogICAgICAgICAgICBlbmRF\nbShlbSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0\nZXN0UXVlcnlUaW1lb3V0cygpIHRocm93cyBFeGNlcHRpb24gew0KICAgICAg\nICBxdWVyeVRpbWVvdXRzSGVscGVyKGZhY3RvcnkpOw0KICAgICAgICBxdWVy\neVRpbWVvdXRzSGVscGVyKHRpbWVvdXRGYWN0b3J5KTsNCiAgICB9DQoNCiAg\nICBwcml2YXRlIHZvaWQgcXVlcnlUaW1lb3V0c0hlbHBlcihPcGVuSlBBRW50\naXR5TWFuYWdlckZhY3RvcnkgZmFjdG9yeSkNCiAgICAgICAgdGhyb3dzIEV4\nY2VwdGlvbiB7DQogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0g\nKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBmYWN0b3J5DQogICAgICAgICAgICAu\nY3JlYXRlRW50aXR5TWFuYWdlcigpOw0KICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgc3RhcnRUeChlbSk7DQoNCiAgICAgICAgICAgIENhY2hlT2JqZWN0\nRSBlID0gbmV3IENhY2hlT2JqZWN0RSgiZSIpOw0KICAgICAgICAgICAgZW0u\ncGVyc2lzdChlKTsNCg0KICAgICAgICAgICAgQ2FjaGVPYmplY3RGIGYgPSBu\nZXcgQ2FjaGVPYmplY3RGKCJmIik7DQogICAgICAgICAgICBlbS5wZXJzaXN0\nKGYpOw0KDQogICAgICAgICAgICBlbmRUeChlbSk7DQoNCiAgICAgICAgICAg\nIC8vIGJ1aWxkIHVwIHNvbWUgcXVlcmllcyB0byB0ZXN0DQogICAgICAgICAg\nICBCcm9rZXIgYnJva2VyID0gSlBBRmFjYWRlSGVscGVyLnRvQnJva2VyKGVt\nKTsNCiAgICAgICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVl\ncnkgcTEgPSBicm9rZXINCiAgICAgICAgICAgICAgICAubmV3UXVlcnkoSlBR\nTFBhcnNlci5MQU5HX0pQUUwsICJTRUxFQ1QgYSBGUk9NIENhY2hlT2JqZWN0\nRSBhIik7DQoNCiAgICAgICAgICAgIHExLnNldENhbmRpZGF0ZUV4dGVudChi\ncm9rZXIubmV3RXh0ZW50KENhY2hlT2JqZWN0RS5jbGFzcywgZmFsc2UpKTsN\nCiAgICAgICAgICAgIGl0ZXJhdGUoKENvbGxlY3Rpb24pIHExLmV4ZWN1dGUo\nKSk7DQogICAgICAgICAgICBhc3NlcnRJbkNhY2hlKHExLCBCb29sZWFuLlRS\nVUUpOw0KDQogICAgICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLlF1ZXJ5IHEyID0gYnJva2VyDQogICAgICAgICAgICAgICAgLm5ld1F1ZXJ5\nKEpQUUxQYXJzZXIuTEFOR19KUFFMLCAiU0VMRUNUIGEgRlJPTSBDYWNoZU9i\namVjdEYgYSIpOw0KICAgICAgICAgICAgaXRlcmF0ZSgoQ29sbGVjdGlvbikg\ncTIuZXhlY3V0ZSgpKTsNCiAgICAgICAgICAgIGFzc2VydEluQ2FjaGUocTIs\nIEJvb2xlYW4uVFJVRSk7DQoNCiAgICAgICAgICAgIC8vIGlmIHRoaXMgcnVu\nIGhhcyBhIGRlZmF1bHQgdGltZW91dCAoc2V0IHRvIDEgc2VjIGluIHRoZSB0\nZXN0DQogICAgICAgICAgICAvLyBjYXNlKSwgZSBzaG91bGQgYmUgdGltZWQg\nb3V0IGJ5IHRoaXMgcG9pbnQuDQogICAgICAgICAgICAvL2Jvb2xlYW4gZVRp\nbWVkT3V0ID0gZmFjdG9yeS5nZXRDb25maWd1cmF0aW9uKCkuZ2V0RGF0YUNh\nY2hlVGltZW91dCgpID4gMDsNCiAgICAgICAgICAgIGJvb2xlYW4gZVRpbWVk\nT3V0ID0NCiAgICAgICAgICAgICAgICAoKCgoT3BlbkpQQUVudGl0eU1hbmFn\nZXJGYWN0b3J5U1BJKSBmYWN0b3J5KS5nZXRDb25maWd1cmF0aW9uKCkpDQog\nICAgICAgICAgICAgICAgICAgIC5nZXREYXRhQ2FjaGVUaW1lb3V0KCkgPiAw\nKTsNCg0KICAgICAgICAgICAgLy8gc2hvdWxkIGNhdXNlIGYgdG8gYmUgZHJv\ncHBlZC4NCiAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuc2xl\nZXAoMTAwMSk7DQoNCiAgICAgICAgICAgIC8vIGF0IHRoaXMgcG9pbnQsIHEy\nIHNob3VsZCBiZSBkcm9wcGVkIChiZWNhdXNlIGl0cyBjYW5kaWRhdGUNCiAg\nICAgICAgICAgIC8vIGNsYXNzIGlzIENhY2hlT2JqZWN0RiksIGFuZCBxMSBt\naWdodCBiZSBkcm9wcGVkLCBkZXBlbmRpbmcNCiAgICAgICAgICAgIC8vIG9u\nIHdoZXRoZXIgb3Igbm90IHdlJ3ZlIGdvdCBhIHRpbWVvdXQgY29uZmlndXJl\nZC4NCiAgICAgICAgICAgIGFzc2VydEluQ2FjaGUocTEsIChlVGltZWRPdXQp\nID8gQm9vbGVhbi5GQUxTRSA6IEJvb2xlYW4uVFJVRSk7DQogICAgICAgICAg\nICBhc3NlcnRJbkNhY2hlKHEyLCBCb29sZWFuLkZBTFNFKTsNCiAgICAgICAg\nfQ0KICAgICAgICBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZEVtKGVtKTsN\nCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHRlc3RRdWVy\neUltcGxpY2l0RXZpY3Rpb25zKCkgdGhyb3dzIEV4Y2VwdGlvbiB7DQogICAg\nICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gKE9wZW5KUEFFbnRpdHlN\nYW5hZ2VyKSBmYWN0b3J5DQogICAgICAgICAgICAuY3JlYXRlRW50aXR5TWFu\nYWdlcigpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgUnVudGltZVRl\nc3QxW10gaGVscGVyT2JqcyA9IG5ldyBSdW50aW1lVGVzdDFbNV07DQogICAg\nICAgICAgICBoZWxwZXJPYmpzWzBdID0gbmV3IFJ1bnRpbWVUZXN0MSgpOw0K\nICAgICAgICAgICAgaGVscGVyT2Jqc1sxXSA9IG5ldyBSdW50aW1lVGVzdDEo\nKTsNCiAgICAgICAgICAgIGhlbHBlck9ianNbMl0gPSBuZXcgUnVudGltZVRl\nc3QxKCk7DQogICAgICAgICAgICBoZWxwZXJPYmpzWzNdID0gbmV3IFJ1bnRp\nbWVUZXN0MSgpOw0KICAgICAgICAgICAgaGVscGVyT2Jqc1s0XSA9IG5ldyBS\ndW50aW1lVGVzdDEoKTsNCiAgICAgICAgICAgIHN0YXJ0VHgoZW0pOw0KICAg\nICAgICAgICAgZW0ucGVyc2lzdChoZWxwZXJPYmpzWzBdKTsNCiAgICAgICAg\nICAgIGVtLnBlcnNpc3QoaGVscGVyT2Jqc1sxXSk7DQogICAgICAgICAgICBl\nbS5wZXJzaXN0KGhlbHBlck9ianNbMl0pOw0KICAgICAgICAgICAgZW0ucGVy\nc2lzdChoZWxwZXJPYmpzWzNdKTsNCiAgICAgICAgICAgIGVtLnBlcnNpc3Qo\naGVscGVyT2Jqc1s0XSk7DQogICAgICAgICAgICBlbmRUeChlbSk7DQoNCiAg\nICAgICAgICAgIERhdGFDYWNoZSBjYWNoZSA9IGNhY2hlTWFuYWdlcihmYWN0\nb3J5KS5nZXREYXRhQ2FjaGUoDQogICAgICAgICAgICAgICAgRGF0YUNhY2hl\nLk5BTUVfREVGQVVMVCwgZmFsc2UpOw0KDQogICAgICAgICAgICBpZiAoIWlz\nT3BlbkpQQUNhY2hlKGNhY2hlKSkgew0KICAgICAgICAgICAgICAgIGJ1Zyg2\nMjcsICJUYW5nb3NvbCBjYWNoZSBpbXBsIG5lZWRzIG1vZGVybml6YXRpb24i\nKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoN\nCiAgICAgICAgICAgIGlmIChjYWNoZSBpbnN0YW5jZW9mIERlbGVnYXRpbmdE\nYXRhQ2FjaGUpDQogICAgICAgICAgICAgICAgY2FjaGUgPSAoKERlbGVnYXRp\nbmdEYXRhQ2FjaGUpIGNhY2hlKS5nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpOw0K\nICAgICAgICAgICAgaWYgKGNhY2hlIGluc3RhbmNlb2YgQ29uY3VycmVudERh\ndGFDYWNoZSkgew0KICAgICAgICAgICAgICAgIENhY2hlTWFwIG1hcCA9ICgo\nQ29uY3VycmVudERhdGFDYWNoZSkgY2FjaGUpLmdldENhY2hlTWFwKCk7DQog\nICAgICAgICAgICAgICAgbWFwLnNldENhY2hlU2l6ZSgzKTsNCiAgICAgICAg\nICAgICAgICBtYXAuc2V0U29mdFJlZmVyZW5jZVNpemUoMCk7DQogICAgICAg\nICAgICB9IGVsc2UgaWYgKGNhY2hlIGluc3RhbmNlb2YgQ29uY3VycmVudERh\ndGFDYWNoZSkgew0KICAgICAgICAgICAgICAgIENhY2hlTWFwIG1hcCA9ICgo\nQ29uY3VycmVudERhdGFDYWNoZSkgY2FjaGUpLmdldENhY2hlTWFwKCk7DQog\nICAgICAgICAgICAgICAgbWFwLnNldENhY2hlU2l6ZSgzKTsNCiAgICAgICAg\nICAgICAgICBtYXAuc2V0U29mdFJlZmVyZW5jZVNpemUoMCk7DQogICAgICAg\nICAgICB9DQoNCiAgICAgICAgICAgIHN0YXJ0VHgoZW0pOw0KICAgICAgICAg\nICAgQ2FjaGVPYmplY3RIIGggPSBuZXcgQ2FjaGVPYmplY3RIKCJoIik7DQog\nICAgICAgICAgICBlbS5wZXJzaXN0KGgpOw0KICAgICAgICAgICAgQ2FjaGVP\nYmplY3RKIGogPSBuZXcgQ2FjaGVPYmplY3RKKCJqIiwgaCk7DQogICAgICAg\nICAgICBlbS5wZXJzaXN0KGopOw0KICAgICAgICAgICAgZW5kVHgoZW0pOw0K\nICAgICAgICAgICAgT2JqZWN0IGhvaWQgPSBlbS5nZXRPYmplY3RJZChoKTsN\nCiAgICAgICAgICAgIE9iamVjdCBqb2lkID0gZW0uZ2V0T2JqZWN0SWQoaik7\nDQoNCiAgICAgICAgICAgIE9iamVjdCBob2lkd2l0aGNsYXNzID0gbmV3IElk\nKENhY2hlT2JqZWN0SC5jbGFzcywgaG9pZC50b1N0cmluZygpKTsNCiAgICAg\nICAgICAgIE9iamVjdCBqb2lkd2l0aGNsYXNzID0gbmV3IElkKENhY2hlT2Jq\nZWN0Si5jbGFzcywgam9pZC50b1N0cmluZygpKTsNCiAgICAgICAgICAgIGVu\nZEVtKGVtKTsNCg0KICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGogYW5kIGgg\nYXJlIGluIGNhY2hlOyBtYXkgbm90IGJlIGlmIG5vdCBMUlUNCiAgICAgICAg\nICAgIGludCBhdHRlbXB0cyA9IDA7DQogICAgICAgICAgICBmb3IgKDsgYXR0\nZW1wdHMgPCAxMDAgJiYgIWNhY2hlLmNvbnRhaW5zKGpvaWR3aXRoY2xhc3Mp\nOyBhdHRlbXB0cysrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAg\nIGVtID0gZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQogICAgICAg\nICAgICAgICAgaWYgKCFjYWNoZS5jb250YWlucyhob2lkd2l0aGNsYXNzKSkN\nCiAgICAgICAgICAgICAgICAgICAgZW0uZmluZChDYWNoZU9iamVjdEguY2xh\nc3MsIGhvaWQpOw0KICAgICAgICAgICAgICAgIGlmICghY2FjaGUuY29udGFp\nbnMoam9pZHdpdGhjbGFzcykpDQogICAgICAgICAgICAgICAgICAgIGVtLmZp\nbmQoQ2FjaGVPYmplY3RKLmNsYXNzLCBqb2lkKTsNCiAgICAgICAgICAgICAg\nICBlbmRFbShlbSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBhc3Nl\ncnRUcnVlKCJDb3VsZCBub3QgZ2V0IHF1ZXJpZWQgb2JqZWN0cyBpbnRvIGNh\nY2hlIiwNCiAgICAgICAgICAgICAgICBhdHRlbXB0cyA8IDEwMCk7DQoNCiAg\nICAgICAgICAgIC8vIGJ1aWxkIHVwIGEgcXVlcnkgdGhhdCB1c2VzIEggaW4g\naXRzIGFjY2VzcyBwYXRoLi4uDQogICAgICAgICAgICBlbSA9IGZhY3Rvcnku\nY3JlYXRlRW50aXR5TWFuYWdlcigpOw0KICAgICAgICAgICAgQnJva2VyIGJy\nb2tlciA9IEpQQUZhY2FkZUhlbHBlci50b0Jyb2tlcihlbSk7DQogICAgICAg\nICAgICBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5IHEgPSBicm9r\nZXIubmV3UXVlcnkoDQogICAgICAgICAgICAgICAgSlBRTFBhcnNlci5MQU5H\nX0pQUUwsICJTZWxlY3QgYSBGUk9NICINCiAgICAgICAgICAgICAgICArIENh\nY2hlT2JqZWN0Si5jbGFzcy5nZXRTaW1wbGVOYW1lKCkNCiAgICAgICAgICAg\nICAgICArICIgYSB3aGVyZSBhLnN0ciA9ICdoJyIpOw0KICAgICAgICAgICAg\naXRlcmF0ZSgoQ29sbGVjdGlvbikgcS5leGVjdXRlKCkpOw0KICAgICAgICAg\nICAgYXNzZXJ0SW5DYWNoZShxLCBCb29sZWFuLlRSVUUpOw0KICAgICAgICAg\nICAgZW5kRW0oZW0pOw0KDQogICAgICAgICAgICAvLyBmb3JjZSBoIG91dCBv\nZiB0aGUgY2FjaGUuIHdlIG1pZ2h0IGhhdmUgdG8gdHJ5IG11bHRpcGxlIHRp\nbWVzDQogICAgICAgICAgICAvLyBpZiB0aGUgY2FjaGUgaXMgbm90IExSVQ0K\nICAgICAgICAgICAgYXR0ZW1wdHMgPSAwOw0KICAgICAgICAgICAgZm9yICg7\nIGF0dGVtcHRzIDwgMTAwICYmIGNhY2hlLmNvbnRhaW5zKGpvaWR3aXRoY2xh\nc3MpOyBhdHRlbXB0cysrKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAg\nICAgIGVtID0gZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQogICAg\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCA1OyBpKyspDQogICAg\nICAgICAgICAgICAgICAgIGVtLmZpbmQoUnVudGltZVRlc3QxLmNsYXNzLCBl\nbS5nZXRPYmplY3RJZChoZWxwZXJPYmpzW2ldKSk7DQogICAgICAgICAgICAg\nICAgZW5kRW0oZW0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZSgiQ291bGQgbm90IGtpY2sgcXVlcmllZCBvYmplY3RzIG91dCBv\nZiBjYWNoZSIsDQogICAgICAgICAgICAgICAgYXR0ZW1wdHMgPCAxMDApOw0K\nDQogICAgICAgICAgICBlbSA9IGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdl\ncigpOw0KICAgICAgICAgICAgYnJva2VyID0gSlBBRmFjYWRlSGVscGVyLnRv\nQnJva2VyKGVtKTsNCiAgICAgICAgICAgIHEgPSBicm9rZXIubmV3UXVlcnko\nSlBRTFBhcnNlci5MQU5HX0pQUUwsICJTZWxlY3QgYSBGUk9NICINCiAgICAg\nICAgICAgICAgICArIENhY2hlT2JqZWN0Si5jbGFzcy5nZXRTaW1wbGVOYW1l\nKCkNCiAgICAgICAgICAgICAgICArICIgYSB3aGVyZSBhLnN0ciA9ICdoJyIp\nOw0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBhc3NlcnRJ\nbkNhY2hlKHEsIG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAg\nY2F0Y2ggKEFzc2VydGlvbkZhaWxlZEVycm9yIGUpIHsNCiAgICAgICAgICAg\nICAgICBidWcoNjI2LCAicXVlcnkgY2FjaGUgaW52YWxpZGF0aW9uIGlzIGJy\nb2tlbiIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyAjIyMg\nc2hvdWxkIHRlc3QgcmVtb3RlIGV2ZW50cyBjYXVzaW5nIHF1ZXJpZXMgdG8g\nZXZpY3QuDQogICAgICAgIH0NCiAgICAgICAgZmluYWxseSB7DQogICAgICAg\nICAgICBlbmRFbShlbSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBG\nSVhNRSBTRWV0aGEgU2VwIDI2LDIwMDYNCiAgICAvLyBub3QgYWJsZSB0byBy\nZXBsYWNlIHBtLm5ld1F1ZXJ5KENhY2hlT2JqZWN0RS5jbGFzcyk7DQogICAg\nLyoNCiAgICAgICogcHVibGljIHZvaWQgdGVzdEFsbGVnZWRRdWVyeU9yZGVy\naW5nQ2hhbmdlcygpIHRocm93cyBFeGNlcHRpb24geyAvLw0KICAgICAgKiBp\nbnNwaXJlZCBieSB0c2MgMzAxMy4gcGNsOiBJIGhhdmUgbm90IGJlZW4gYWJs\nZSB0byBnZXQgdGhpcyAvLyB0ZXN0IGNhc2UNCiAgICAgICogdG8gYWN0dWFs\nbHkgZmFpbC4gSG93ZXZlciwgZHVyaW5nIGFuYWx5c2lzIG9mIC8vIDMwMTMn\ncyBzdGFjayB0cmFjZXMsIEkNCiAgICAgICogZGlzY292ZXJlZCB0aGF0IHRo\nZSAvLyBRdWVyeUtleS5lcXVhbHMoKSBtZXRob2QgZGlkIG5vdCBkZWFsIHdp\ndGggdGhlDQogICAgICAqIG9yZGVyaW5nIC8vIGZpZWxkIGNvcnJlY3RseSwg\ncG9zc2libHkgY2F1c2luZyB0aGUgcHJvYmxlbS4NCiAgICAgICoNCiAgICAg\nICogT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSAoT3BlbkpQQUVudGl0eU1h\nbmFnZXIpDQogICAgICAqIGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigp\nOyB0cnkgeyBzdGFydFR4KGVtLA0KICAgICAgKiAoKSk7IENhY2hlT2JqZWN0\nRSBlID0gbmV3IENhY2hlT2JqZWN0RSgiZSIpOyBlbS5wZXJzaXN0KGUpOw0K\nICAgICAgKiBlbmRUeChlbSk7IH0gZmluYWxseSB7DQogICAgICAqIGVuZEVt\nKGVtKTsgfQ0KICAgICAgKg0KICAgICAgKiBlbSA9IGZhY3RvcnkuY3JlYXRl\nRW50aXR5TWFuYWdlcigpOyBRdWVyeSBxOyBDb2xsZWN0aW9uIGM7IExpc3Qg\nbDsgdHJ5IHsNCiAgICAgICogcSA9IGVtLmNyZWF0ZVF1ZXJ5KENhY2hlT2Jq\nZWN0RS5jbGFzcyk7IHEuc2V0T3JkZXJpbmcoInN0ciBhc2NlbmRpbmciKTsg\nYyA9DQogICAgICAqIChDb2xsZWN0aW9uKSBxLmV4ZWN1dGUoKTsgbCA9IG5l\ndyBMaW5rZWRMaXN0KGMpOyBhc3NlcnRFcXVhbHMoMSwNCiAgICAgICogYy5z\naXplKCkpOyB9IGZpbmFsbHkgeyBlbmRFbShlbSk7IH0NCiAgICAgICoNCiAg\nICAgICogZW0gPSBmYWN0b3J5LmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsgdHJ5\nIHsgcSA9DQogICAgICAqIGVtLmNyZWF0ZVF1ZXJ5KENhY2hlT2JqZWN0RS5j\nbGFzcyk7IHEuc2V0T3JkZXJpbmcoInN0ciBhc2NlbmRpbmciKTsgYyA9DQog\nICAgICAqIChDb2xsZWN0aW9uKSBxLmV4ZWN1dGUoKTsgbCA9IG5ldyBMaW5r\nZWRMaXN0KGMpOyBhc3NlcnRFcXVhbHMoMSwNCiAgICAgICogYy5zaXplKCkp\nOyB9IGZpbmFsbHkgeyBlbmRFbShlbSk7IH0NCiAgICAgICoNCiAgICAgICog\ndHJ5IHsgZW0gPSBmYWN0b3J5LmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsgcSA9\nDQogICAgICAqIGVtLmNyZWF0ZVF1ZXJ5KENhY2hlT2JqZWN0RS5jbGFzcyk7\nIHEuc2V0T3JkZXJpbmcoInN0ciBkZXNjZW5kaW5nIik7IGMgPQ0KICAgICAg\nKiAoQ29sbGVjdGlvbikgcS5leGVjdXRlKCk7IGFzc2VydEVxdWFscygxLCBj\nLnNpemUoKSk7IGwgPSBuZXcNCiAgICAgICogTGlua2VkTGlzdChjKTsgfSBm\naW5hbGx5IHsgZW5kRW0oZW0pOyB9IH0NCiAgICAgICovDQoNCiAgICBwdWJs\naWMgdm9pZCB0ZXN0QWxsZWdlZENvbmN1cnJlbnRNb2RpZmljYXRpb25FeGNl\ncHRpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsNCiAgICAgICAgT3BlbkpQQUVu\ndGl0eU1hbmFnZXIgZW0gPSAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGZhY3Rv\ncnkNCiAgICAgICAgICAgIC5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQogICAg\nICAgIENhY2hlT2JqZWN0RSBlOw0KICAgICAgICB0cnkgew0KICAgICAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gSlBBRmFjYWRlSGVscGVyLmdldE1l\ndGFEYXRhKGVtLA0KICAgICAgICAgICAgICAgIENhY2hlT2JqZWN0RS5jbGFz\ncyk7DQogICAgICAgICAgICBpZiAoIWlzT3BlbkpQQUNhY2hlKG1ldGEuZ2V0\nRGF0YUNhY2hlKCkpKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCg0KICAg\nICAgICAgICAgc3RhcnRUeChlbSk7DQogICAgICAgICAgICBlID0gbmV3IENh\nY2hlT2JqZWN0RSgiZSIpOw0KICAgICAgICAgICAgZW0ucGVyc2lzdChlKTsN\nCiAgICAgICAgICAgIGVuZFR4KGVtKTsNCiAgICAgICAgfQ0KICAgICAgICBm\naW5hbGx5IHsNCiAgICAgICAgICAgIGVuZEVtKGVtKTsNCiAgICAgICAgfQ0K\nDQogICAgICAgIGVtID0gZmFjdG9yeS5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7\nDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBzdGFydFR4KGVtKTsNCg0K\nICAgICAgICAgICAgLy8gZmluZCB0aGUgbmV3IG9iamVjdC4uLg0KICAgICAg\nICAgICAgT3BlbkpQQVF1ZXJ5IHEgPSBlbS5jcmVhdGVRdWVyeSgic2VsZWN0\nIGEgRlJPTSAiDQogICAgICAgICAgICAgICAgKyBDYWNoZU9iamVjdEUuY2xh\nc3MuZ2V0U2ltcGxlTmFtZSgpDQogICAgICAgICAgICAgICAgKyAiIGEgd2hl\ncmUgYS5zdHIgPSAnZSciKTsNCiAgICAgICAgICAgIGUgPSAoQ2FjaGVPYmpl\nY3RFKSAoKENvbGxlY3Rpb24pIHEuZ2V0UmVzdWx0TGlzdCgpKS5pdGVyYXRv\ncigpDQogICAgICAgICAgICAgICAgLm5leHQoKTsNCg0KICAgICAgICAgICAg\nLy8gLi4uIGFuZCBtb2RpZnkgdGhlIGNoYW5nZWQgb2JqZWN0Lg0KICAgICAg\nICAgICAgZS5zZXRTdHIoImUyIik7DQogICAgICAgICAgICBlLnNldFN0cigi\nZTMiKTsNCiAgICAgICAgICAgIGVuZFR4KGVtKTsNCiAgICAgICAgfQ0KICAg\nICAgICBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZEVtKGVtKTsNCiAgICAg\nICAgfQ0KICAgIH0NCg0KICAgIHByaXZhdGUgYm9vbGVhbiBpc09wZW5KUEFD\nYWNoZShEYXRhQ2FjaGUgY2FjaGUpIHsNCiAgICAgICAgaWYgKGNhY2hlIGlu\nc3RhbmNlb2YgRGVsZWdhdGluZ0RhdGFDYWNoZSkNCiAgICAgICAgICAgIGNh\nY2hlID0gKChEZWxlZ2F0aW5nRGF0YUNhY2hlKSBjYWNoZSkuZ2V0SW5uZXJt\nb3N0RGVsZWdhdGUoKTsNCg0KICAgICAgICByZXR1cm4gY2FjaGUgaW5zdGFu\nY2VvZiBDb25jdXJyZW50RGF0YUNhY2hlOw0KICAgIH0NCg0KICAgIC8vIC0t\nLS0tLS0tLS0gdXRpbGl0eSBtZXRob2RzIC0tLS0tLS0tLS0NCg0KICAgIHBy\naXZhdGUgdm9pZCBjaGVja0NhY2hlKERhdGFDYWNoZSBjYWNoZSwgT2JqZWN0\nW10gaWRzLCBib29sZWFuW10gc3RhdGkpIHsNCiAgICAgICAgQ2FjaGVUZXN0\nSGVscGVyLmNoZWNrQ2FjaGUodGhpcywgY2FjaGUsIGlkcywgc3RhdGkpOw0K\nICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBhc3NlcnRJbkNhY2hlKG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgcSwNCiAgICAgICAgQm9vbGVh\nbiBpbkNhY2hlKSB7DQogICAgICAgIENhY2hlVGVzdEhlbHBlci5hc3NlcnRJ\nbkNhY2hlKHRoaXMsIHEsIGluQ2FjaGUpOw0KICAgIH0NCg0KICAgIHByaXZh\ndGUgdm9pZCBhc3NlcnRJbkNhY2hlKG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuUXVlcnkgcSwNCiAgICAgICAgQm9vbGVhbiBpbkNhY2hlLCBPYmplY3Rb\nXSBhcmdzKSB7DQogICAgICAgIENhY2hlVGVzdEhlbHBlci5hc3NlcnRJbkNh\nY2hlKHRoaXMsIHEsIGluQ2FjaGUsIGFyZ3MpOw0KICAgIH0NCg0KICAgIHBy\naXZhdGUgdm9pZCBpdGVyYXRlKENvbGxlY3Rpb24gYykgew0KICAgICAgICBD\nYWNoZVRlc3RIZWxwZXIuaXRlcmF0ZShjKTsNCiAgICB9DQoNCiAgICBwdWJs\naWMgdm9pZCB0ZXN0SW50ZXJmYWNlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7DQog\nICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIG5ld0VtID0NCiAgICAgICAg\nICAgIChPcGVuSlBBRW50aXR5TWFuYWdlcikgZmFjdG9yeS5jcmVhdGVFbnRp\ndHlNYW5hZ2VyKCk7DQogICAgICAgIHN0YXJ0VHgobmV3RW0pOw0KICAgICAg\nICBDYWNoZU9iamVjdEEgYSA9IChDYWNoZU9iamVjdEEpIG5ld0VtLmZpbmQo\nQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQpOw0KICAgICAgICBDYWNoZU9iamVj\ndEMgYyA9IG5ldyBDYWNoZU9iamVjdEMoImJsYWgiKTsNCiAgICAgICAgYS5z\nZXRSZWxhdGVkSW50ZXJmYWNlKGMpOw0KICAgICAgICBlbmRUeChuZXdFbSk7\nDQogICAgICAgIE9iamVjdCBjSWQgPSBuZXdFbS5nZXRPYmplY3RJZChjKTsN\nCiAgICAgICAgZW5kRW0obmV3RW0pOw0KDQogICAgICAgIG5ld0VtID0gKE9w\nZW5KUEFFbnRpdHlNYW5hZ2VyKSBmYWN0b3J5LmNyZWF0ZUVudGl0eU1hbmFn\nZXIoKTsNCiAgICAgICAgYSA9IChDYWNoZU9iamVjdEEpIG5ld0VtLmZpbmQo\nQ2FjaGVPYmplY3RBLmNsYXNzLCBvaWQpOw0KDQogICAgICAgIENhY2hlT2Jq\nZWN0SW50ZXJmYWNlIGMyID0gYS5nZXRSZWxhdGVkSW50ZXJmYWNlKCk7DQog\nICAgICAgIGFzc2VydE5vdE51bGwoYzIpOw0KDQogICAgICAgIGFzc2VydEVx\ndWFscyhjSWQsIG5ld0VtLmdldE9iamVjdElkKGMyKSk7DQogICAgfQ0KDQog\nICAgcHVibGljIHZvaWQgdGVzdFF1ZXJpZXNPbkNvbGxlY3Rpb25zRG9udFVz\nZUNhY2hlKCkgew0KICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbSA9\nIChPcGVuSlBBRW50aXR5TWFuYWdlcikgZmFjdG9yeQ0KICAgICAgICAgICAg\nLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsNCiAgICAgICAgdHJ5IHsNCiAgICAg\nICAgICAgIHN0YXJ0VHgoZW0pOw0KICAgICAgICAgICAgQ2FjaGVPYmplY3RF\nIGUgPSBuZXcgQ2FjaGVPYmplY3RFKCJlIik7DQogICAgICAgICAgICBlbS5w\nZXJzaXN0KGUpOw0KICAgICAgICAgICAgZW5kVHgoZW0pOw0KICAgICAgICB9\nDQogICAgICAgIGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kRW0oZW0pOw0K\nICAgICAgICB9DQoNCiAgICAgICAgZW0gPSAoT3BlbkpQQUVudGl0eU1hbmFn\nZXIpIGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigpOw0KICAgICAgICBP\ncGVuSlBBUXVlcnkgcTsNCiAgICAgICAgQ29sbGVjdGlvbiBjOw0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgcSA9IGVtLmNyZWF0ZVF1ZXJ5KCJzZWxl\nY3QgYSBGUk9NICINCiAgICAgICAgICAgICAgICArIENhY2hlT2JqZWN0RS5j\nbGFzcy5nZXRTaW1wbGVOYW1lKCkNCiAgICAgICAgICAgICAgICArICIgYSB3\naGVyZSBhLnN0ciA9ICdlJyIpOw0KICAgICAgICAgICAgYyA9IG5ldyBBcnJh\neUxpc3QoKENvbGxlY3Rpb24pIHEuZ2V0UmVzdWx0TGlzdCgpKTsNCiAgICAg\nICAgICAgIGFzc2VydEVxdWFscygxLCBjLnNpemUoKSk7DQogICAgICAgICAg\nICBxLmNsb3NlQWxsKCk7DQogICAgICAgIH0NCiAgICAgICAgZmluYWxseSB7\nDQogICAgICAgICAgICBlbmRFbShlbSk7DQogICAgICAgIH0NCg0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgZW0gPSAoT3BlbkpQQUVudGl0eU1hbmFn\nZXIpIGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigpOw0KICAgICAgICAg\nICAgcSA9IGVtLmNyZWF0ZVF1ZXJ5KCJzZWxlY3QgYSBGUk9NICINCiAgICAg\nICAgICAgICAgICArIENhY2hlT2JqZWN0RS5jbGFzcy5nZXRTaW1wbGVOYW1l\nKCkNCiAgICAgICAgICAgICAgICArICIgYSB3aGVyZSBhLnN0ciA9ICdlJyIp\nOw0KICAgICAgICAgICAgcS5zZXRDYW5kaWRhdGVDb2xsZWN0aW9uKG5ldyBB\ncnJheUxpc3QoMCkpOw0KICAgICAgICAgICAgYyA9IChDb2xsZWN0aW9uKSBx\nLmdldFJlc3VsdExpc3QoKTsNCiAgICAgICAgICAgIGFzc2VydEVxdWFscygw\nLCBjLnNpemUoKSk7DQogICAgICAgICAgICBxLmNsb3NlQWxsKCk7DQogICAg\nICAgIH0NCiAgICAgICAgZmluYWxseSB7DQogICAgICAgICAgICBlbmRFbShl\nbSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nREZHRmllbGRzTG9hZGVkMSgpIHsNCiAgICAgICAgZGZnRmllbGRzTG9hZGVk\nSGVscGVyKGZhbHNlKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nREZHRmllbGRzTG9hZGVkMigpIHsNCiAgICAgICAgZGZnRmllbGRzTG9hZGVk\nSGVscGVyKHRydWUpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGRmZ0Zp\nZWxkc0xvYWRlZEhlbHBlcihib29sZWFuIHJlbGF0ZWQpIHsNCiAgICAgICAg\nT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSAoT3BlbkpQQUVudGl0eU1hbmFn\nZXIpIGZhY3RvcnkNCiAgICAgICAgICAgIC5jcmVhdGVFbnRpdHlNYW5hZ2Vy\nKCk7DQogICAgICAgIHN0YXJ0VHgoZW0pOw0KICAgICAgICBPcGVuSlBBUXVl\ncnkgcTsNCiAgICAgICAgQ29sbGVjdGlvbiBjOw0KICAgICAgICB0cnkgew0K\nDQogICAgICAgICAgICBxID0gZW0uY3JlYXRlUXVlcnkoDQogICAgICAgICAg\nICAgICAgInNlbGVjdCBhIEZST00gIiArIENhY2hlT2JqZWN0QS5jbGFzcy5n\nZXRTaW1wbGVOYW1lKCkNCiAgICAgICAgICAgICAgICAgICAgKyAiIGEgd2hl\ncmUgYS5uYW1lID0gOnBOYW1lIikuc2V0UGFyYW1ldGVyKCJwTmFtZSIsDQog\nICAgICAgICAgICAgICAgT1JJR19OQU1FKTsNCg0KICAgICAgICAgICAgYyA9\nIG5ldyBBcnJheUxpc3QoKENvbGxlY3Rpb24pIHEuZ2V0UmVzdWx0TGlzdCgp\nKTsNCiAgICAgICAgICAgIGFzc2VydEVxdWFscygxLCBjLnNpemUoKSk7DQog\nICAgICAgICAgICBDYWNoZU9iamVjdEEgYSA9IChDYWNoZU9iamVjdEEpIGMu\naXRlcmF0b3IoKS5uZXh0KCk7DQogICAgICAgICAgICBpZiAocmVsYXRlZCkN\nCiAgICAgICAgICAgICAgICBhLmdldFJlbGF0ZWRBcnJheSgpOw0KICAgICAg\nICAgICAgZW0uZGV0YWNoKGEpOw0KICAgICAgICAgICAgYXNzZXJ0RXF1YWxz\nKE9SSUdfTkFNRSwgYS5nZXROYW1lKCkpOw0KICAgICAgICAgICAgcS5jbG9z\nZUFsbCgpOw0KICAgICAgICB9DQogICAgICAgIGZpbmFsbHkgew0KICAgICAg\nICAgICAgcm9sbGJhY2tUeChlbSk7DQogICAgICAgICAgICBlbmRFbShlbSk7\nDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBGSVhNRSBTZWV0aGEgU2Vw\nIDI2LDIwMDYNCiAgICAvKg0KICAgICAgKiBwdWJsaWMgdm9pZCB0ZXN0UXVl\ncmllc0FmdGVyTW9kaWZpY2F0aW9uQXJlTm90SW5DYWNoZSgpIHsNCiAgICAg\nICogT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSAoT3BlbkpQQUVudGl0eU1h\nbmFnZXIpDQogICAgICAqIGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigp\nOyBPcGVuSlBBRW50aXR5TWFuYWdlciBlbTIgPQ0KICAgICAgKiAoT3BlbkpQ\nQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigp\nOw0KICAgICAgKg0KICAgICAgKiAvL0ZJWE1FIFNlZXRoYSBTZXAgMjYsMjAw\nNiAvL2VtLnNldElnbm9yZUNhY2hlKGZhbHNlKTsNCiAgICAgICogLy9lbTIu\nc2V0SWdub3JlQ2FjaGUoZmFsc2UpOyAoKEZldGNoUGxhbikgZW0uZ2V0RmV0\nY2hQbGFuKCkpLg0KICAgICAgKiBzZXRGbHVzaEJlZm9yZVF1ZXJpZXMoRmV0\nY2hQbGFuLkZMVVNIX1RSVUUpOyAoKEZldGNoUGxhbikNCiAgICAgICogZW0y\nLmdldEZldGNoUGxhbigpKS4gc2V0Rmx1c2hCZWZvcmVRdWVyaWVzKEZldGNo\nUGxhbi5GTFVTSF9UUlVFKTsNCiAgICAgICoNCiAgICAgICogdHJ5IHsgc3Rh\ncnRUeChlbSk7IENhY2hlT2JqZWN0RSBlID0gbmV3DQogICAgICAqIENhY2hl\nT2JqZWN0RSgiZSIpOyBlbS5wZXJzaXN0KGUpOyBlbmRUeChlbSwNCiAgICAg\nICogKCkpOw0KICAgICAgKg0KICAgICAgKiBzdGFydFR4KGVtKTsNCiAgICAg\nICogIC8vIGZpcnN0LCBhIHF1ZXJ5IHRoYXQgc2hvdWxkIGdldCBpbnRvIHRo\nZSBjYWNoZS4gQnJva2VyIGJyb2tlciA9DQogICAgICAqIEpQQUZhY2FkZUhl\nbHBlci50b0Jyb2tlcihlbSk7IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUXVlcnkgcSA9DQogICAgICAqIGJyb2tlci5uZXdRdWVyeShKUFFMUGFyc2Vy\nLkxBTkdfSlBRTCwgQ2FjaGVPYmplY3RFLmNsYXNzLCAic3RyID09DQogICAg\nICAqIFwiZVwiIik7IENvbGxlY3Rpb24gYyA9IChDb2xsZWN0aW9uKSBxLmV4\nZWN1dGUoKTsgZm9yIChJdGVyYXRvciBpdGVyID0NCiAgICAgICogYy5pdGVy\nYXRvcigpOyBpdGVyLmhhc05leHQoKTspIGl0ZXIubmV4dCgpOw0KICAgICAg\nKg0KICAgICAgKiBhc3NlcnRFcXVhbHMoMSwgYy5zaXplKCkpOyBhc3NlcnRJ\nbkNhY2hlKHEsIEJvb2xlYW4uVFJVRSk7DQogICAgICAqDQogICAgICAqIEJy\nb2tlciBicm9rZXIyID0gSlBBRmFjYWRlSGVscGVyLnRvQnJva2VyKGVtMik7\nDQogICAgICAqIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnkgcTIg\nPSBicm9rZXIyLm5ld1F1ZXJ5KHEuZ2V0TGFuZ3VhZ2UoKSwNCiAgICAgICog\ncSk7DQogICAgICAqICAvLyBtYWtlIHNvbWUgbW9kaWZpY2F0aW9ucyBhbmQg\nbG9vayBhZ2Fpbi4gU2hvdWxkIHJldHVybiAvLyB0d28gcmVzdWx0cy4NCiAg\nICAgICogZSA9IG5ldyBDYWNoZU9iamVjdEUoImUiKTsgZW0ucGVyc2lzdChl\nKTsNCiAgICAgICoNCiAgICAgICogcSA9IGJyb2tlci5uZXdRdWVyeShKUFFM\nUGFyc2VyLkxBTkdfSlBRTCwgQ2FjaGVPYmplY3RFLmNsYXNzLCAic3RyID09\nDQogICAgICAqIFwiZVwiIik7IGMgPSAoQ29sbGVjdGlvbikgcS5leGVjdXRl\nKCk7IGFzc2VydEVxdWFscygyLCBjLnNpemUoKSk7IGZvcg0KICAgICAgKiAo\nSXRlcmF0b3IgaXRlciA9IGMuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7\nKSBpdGVyLm5leHQoKTsNCiAgICAgICogIC8vIG9yaWdpbmFsIHF1ZXJ5IHNo\nb3VsZCBzdGlsbCBiZSBpbiBjYWNoZSBhc3NlcnRJbkNhY2hlKHEyLA0KICAg\nICAgKiBCb29sZWFuLlRSVUUpOw0KICAgICAgKg0KICAgICAgKiBDb2xsZWN0\naW9uIGMyID0gKENvbGxlY3Rpb24pIHEyLmV4ZWN1dGUoKTsgYXNzZXJ0RXF1\nYWxzKDEsIGMyLnNpemUoKSk7DQogICAgICAqICAvLyBuZXcgcXVlcnkgc2hv\ndWxkIG5vdCBtYWtlIGl0IGludG8gY2FjaGUNCiAgICAgICoNCiAgICAgICog\ncSA9IGJyb2tlciAubmV3UXVlcnkoSlBRTFBhcnNlci5MQU5HX0pQUUwsIENh\nY2hlT2JqZWN0RS5jbGFzcywgbnVsbCk7IGMgPQ0KICAgICAgKiAoQ29sbGVj\ndGlvbikgcS5leGVjdXRlKCk7IGFzc2VydEVxdWFscygyLCBjLnNpemUoKSk7\nIGZvciAoSXRlcmF0b3IgaXRlciA9DQogICAgICAqIGMuaXRlcmF0b3IoKTsg\naXRlci5oYXNOZXh0KCk7KSBpdGVyLm5leHQoKTsNCiAgICAgICoNCiAgICAg\nICogYXNzZXJ0SW5DYWNoZShxLCBCb29sZWFuLkZBTFNFKTsgfSBmaW5hbGx5\nIHsNCiAgICAgICogcm9sbGJhY2tUeChlbSk7DQogICAgICAqIGVuZEVtKGVt\nKTsNCiAgICAgICogZW5kRW0oZW0yKTsgfSB9DQogICAgICAqLw0KDQogICAg\ncHVibGljIHZvaWQgdGVzdENhY2hlZFF1ZXJ5Q2xvc3VyZVJlbGVhc2VzUmVz\nb3VyY2VzKCkgew0KICAgICAgICAvLyBQZXJzaXN0ZW5jZU1hbmFnZXJGYWN0\nb3J5IGZhY3RvcnkgPQ0KICAgICAgICAvLyBLb2RvSGVscGVyLmNyZWF0ZUVu\ndGl0eU1hbmFnZXJGYWN0b3J5ICgpOw0KICAgICAgICBFbnRpdHlNYW5hZ2Vy\nIGluaXRFbSA9IGZhY3RvcnkuY3JlYXRlRW50aXR5TWFuYWdlcigpOw0KICAg\nICAgICBzdGFydFR4KGluaXRFbSk7DQogICAgICAgIENhY2hlT2JqZWN0RSBl\nID0gbmV3IENhY2hlT2JqZWN0RSgiZSIpOw0KICAgICAgICBpbml0RW0ucGVy\nc2lzdChlKTsNCiAgICAgICAgZW5kVHgoaW5pdEVtKTsNCiAgICAgICAgZW5k\nRW0oaW5pdEVtKTsNCg0KICAgICAgICBCcm9rZXIgYnJva2VyID0gSlBBRmFj\nYWRlSGVscGVyLnRvQnJva2VyRmFjdG9yeShmYWN0b3J5KS5uZXdCcm9rZXIo\nKTsNCiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeSBx\nID0gYnJva2VyLm5ld1F1ZXJ5KA0KICAgICAgICAgICAgSlBRTFBhcnNlci5M\nQU5HX0pQUUwsICJTZWxlY3QgYSBGUk9NICINCiAgICAgICAgICAgICsgQ2Fj\naGVPYmplY3RFLmNsYXNzLmdldFNpbXBsZU5hbWUoKQ0KICAgICAgICAgICAg\nKyAiIGEgd2hlcmUgYS5zdHIgPSAnZSciKTsNCiAgICAgICAgQ29sbGVjdGlv\nbiBjID0gKENvbGxlY3Rpb24pIHEuZXhlY3V0ZSgpOw0KICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ZXIgPSBjLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgp\nOykNCiAgICAgICAgICAgIGl0ZXIubmV4dCgpOw0KDQogICAgICAgIGFzc2Vy\ndEVxdWFscygxLCBjLnNpemUoKSk7DQogICAgICAgIGFzc2VydEluQ2FjaGUo\ncSwgQm9vbGVhbi5UUlVFKTsNCg0KICAgICAgICBJbXBsSGVscGVyLmNsb3Nl\nKGMpOw0KDQogICAgICAgIGJyb2tlci5jbG9zZSgpOw0KICAgIH0NCg0KICAg\nIHB1YmxpYyB2b2lkIHRlc3RNdXRhYmxlU0NPc0FyZUNvbnZlcnRlZCgpIHsN\nCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0wID0gKE9wZW5KUEFF\nbnRpdHlNYW5hZ2VyKSBmYWN0b3J5DQogICAgICAgICAgICAuY3JlYXRlRW50\naXR5TWFuYWdlcigpOw0KICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBl\nbTEgPSAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGZhY3RvcnkNCiAgICAgICAg\nICAgIC5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7DQoNCiAgICAgICAgc3RhcnRU\neChlbTApOw0KICAgICAgICBDYWNoZU9iamVjdEEgYSA9IChDYWNoZU9iamVj\ndEEpIGVtMC5maW5kKENhY2hlT2JqZWN0QS5jbGFzcywgb2lkKTsNCg0KICAg\nICAgICBEYXRlIGQgPSBuZXcgRGF0ZSgpOw0KICAgICAgICBhLnNldERhdGUo\nZCk7DQoNCiAgICAgICAgZW5kVHgoZW0wKTsNCiAgICAgICAgRGF0YUNhY2hl\nIGNhY2hlID0gY2FjaGVNYW5hZ2VyKGZhY3RvcnkpLmdldERhdGFDYWNoZSgN\nCiAgICAgICAgICAgIERhdGFDYWNoZS5OQU1FX0RFRkFVTFQsIGZhbHNlKTsN\nCiAgICAgICAgYXNzZXJ0VHJ1ZShjYWNoZS5jb250YWlucyhvaWR3aXRoY2xh\nc3MpKTsNCiAgICAgICAgY2FjaGUucmVtb3ZlKG9pZHdpdGhjbGFzcyk7DQoN\nCiAgICAgICAgYSA9IChDYWNoZU9iamVjdEEpIGVtMS5maW5kKENhY2hlT2Jq\nZWN0QS5jbGFzcywgb2lkKTsNCiAgICAgICAgYXNzZXJ0VHJ1ZShjYWNoZS5j\nb250YWlucyhvaWR3aXRoY2xhc3MpKTsNCg0KICAgICAgICB0cnkgew0KICAg\nICAgICAgICAgUENEYXRhIGRhdGEgPSBjYWNoZS5nZXQob2lkd2l0aGNsYXNz\nKTsNCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9DQogICAgICAg\nICAgICAgICAgKChPcGVuSlBBRW50aXR5TWFuYWdlckZhY3RvcnlTUEkpIE9w\nZW5KUEFQZXJzaXN0ZW5jZQ0KICAgICAgICAgICAgICAgICAgICAuY2FzdChm\nYWN0b3J5KSkuZ2V0Q29uZmlndXJhdGlvbigpDQogICAgICAgICAgICAgICAg\nICAgIC5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLmdldE1ldGFE\nYXRhKGEuZ2V0Q2xhc3MoKSwNCiAgICAgICAgICAgICAgICAgICAgbnVsbCwg\nZmFsc2UpOw0KICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBtZXRh\nLmdldEZpZWxkKCJkYXRlIik7DQogICAgICAgICAgICBkID0gKERhdGUpIGRh\ndGEuZ2V0RGF0YShmbWQuZ2V0SW5kZXgoKSk7DQogICAgICAgICAgICBCcm9r\nZXIgYnJva2VyID0gSlBBRmFjYWRlSGVscGVyLnRvQnJva2VyKGVtMSk7DQog\nICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gYnJva2VyLmdl\ndFN0YXRlTWFuYWdlcihhKTsNCiAgICAgICAgICAgIGFzc2VydFRydWUoc20g\nPT0gKChQcm94eURhdGUpIGEuZ2V0RGF0ZSgpKS5nZXRPd25lcigpKTsNCiAg\nICAgICAgICAgIGFzc2VydEVxdWFscyhEYXRlLmNsYXNzLCBkLmdldENsYXNz\nKCkpOw0KICAgICAgICB9DQogICAgICAgIGZpbmFsbHkgew0KICAgICAgICAg\nICAgZW5kRW0oZW0wKTsNCiAgICAgICAgICAgIGVuZEVtKGVtMSk7DQogICAg\nICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0RW1wdHlSZXN1\nbHRzQXJlQ2FjaGVkKCkgew0KICAgICAgICBCcm9rZXIgYnJva2VyID0gSlBB\nRmFjYWRlSGVscGVyLnRvQnJva2VyRmFjdG9yeShmYWN0b3J5KS5uZXdCcm9r\nZXIoKTsNCiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVy\neSBxID0gYnJva2VyLm5ld1F1ZXJ5KA0KICAgICAgICAgICAgSlBRTFBhcnNl\nci5MQU5HX0pQUUwsICJTZWxlY3QgYSBGUk9NICINCiAgICAgICAgICAgICsg\nQ2FjaGVPYmplY3RBQ2hpbGQxLmNsYXNzLmdldFNpbXBsZU5hbWUoKQ0KICAg\nICAgICAgICAgKyAiIGEgd2hlcmUgYS5uYW1lID0gJ3Rlc3RFbXB0eVJlc3Vs\ndHNBcmVDYWNoZWQnIik7DQogICAgICAgIENvbGxlY3Rpb24gYyA9IChDb2xs\nZWN0aW9uKSBxLmV4ZWN1dGUoKTsNCiAgICAgICAgYXNzZXJ0RXF1YWxzKDAs\nIGMuc2l6ZSgpKTsNCiAgICAgICAgYXNzZXJ0SW5DYWNoZShxLCBCb29sZWFu\nLlRSVUUpOw0KICAgICAgICBicm9rZXIuY2xvc2UoKTsNCiAgICB9DQoNCiAg\nICBwcml2YXRlIHZvaWQgZG9hc3NlcnRUcnVlKEVudGl0eU1hbmFnZXIgZW0s\nIFN0cmluZyBuYW1lLCBpbnQgYWdlKQ0KICAgICAgICB0aHJvd3MgRXhjZXB0\naW9uIHsNCiAgICAgICAgQ2FjaGVPYmplY3RBIGEgPSAoQ2FjaGVPYmplY3RB\nKSBlbS5maW5kKENhY2hlT2JqZWN0QS5jbGFzcywgb2lkKTsNCiAgICAgICAg\nYXNzZXJ0VHJ1ZShuYW1lLmVxdWFscyhhLmdldE5hbWUoKSkpOw0KICAgICAg\nICBhc3NlcnRUcnVlKGEuZ2V0QWdlKCkgPT0gYWdlKTsNCiAgICAgICAgZW5k\nRW0oZW0pOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBhc3NlcnROZXco\nQ2FjaGVPYmplY3RBIGEpIHsNCiAgICAgICAgYXNzZXJ0VHJ1ZShORVdfTkFN\nRS5lcXVhbHMoYS5nZXROYW1lKCkpKTsNCiAgICAgICAgYXNzZXJ0VHJ1ZShP\nUklHX0FHRSA9PSBhLmdldEFnZSgpKTsNCiAgICB9DQoNCiAgICBwcml2YXRl\nIHZvaWQgYXNzZXJ0T2xkKENhY2hlT2JqZWN0QSBhKSB7DQogICAgICAgIGFz\nc2VydFRydWUoT1JJR19OQU1FLmVxdWFscyhhLmdldE5hbWUoKSkpOw0KICAg\nICAgICBhc3NlcnRUcnVlKE9SSUdfQUdFID09IGEuZ2V0QWdlKCkpOw0KICAg\nIH0NCg0KICAgIHByaXZhdGUgRGF0YUNhY2hlTWFuYWdlciBjYWNoZU1hbmFn\nZXIoT3BlbkpQQUVudGl0eU1hbmFnZXJGYWN0b3J5IGZhY3RvcnkpIHsNCiAg\nICAgICAgcmV0dXJuIENhY2hlVGVzdEhlbHBlcg0KICAgICAgICAgICAgLmNh\nY2hlTWFuYWdlcihKUEFGYWNhZGVIZWxwZXIudG9Ccm9rZXJGYWN0b3J5KGZh\nY3RvcnkpKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHZvaWQgY2xvc2UoRW50\naXR5TWFuYWdlciBlbSkgew0KICAgICAgICByb2xsYmFja1R4KGVtKTsNCiAg\nICAgICAgZW5kRW0oZW0pOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBj\nbG9zZShCcm9rZXIgYnJva2VyKSB7DQogICAgICAgIGlmIChicm9rZXIuaXNB\nY3RpdmUoKSkNCiAgICAgICAgICAgIGJyb2tlci5yb2xsYmFjaygpOw0KICAg\nICAgICBicm9rZXIuY2xvc2UoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3Rh\ndGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB0aHJvd3MgRXhjZXB0aW9u\nIHsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsg\naSsrKSB7DQogICAgICAgICAgICBTdHJpbmcgdHlwZSA9IGFyZ3NbaV07DQoN\nCiAgICAgICAgICAgIENhY2hlVGVzdCBjOw0KICAgICAgICAgICAgaWYgKHR5\ncGUuZXF1YWxzKCJ0Y3AiKSkgew0KICAgICAgICAgICAgICAgIGMgPSBuZXcg\nRGlzdHJpYnV0ZWRDYWNoZVRlc3QoInRpbWUgdGVzdCIsDQogICAgICAgICAg\nICAgICAgICAgIENvbmN1cnJlbnREYXRhQ2FjaGUuY2xhc3MpOw0KICAgICAg\nICAgICAgfSBlbHNlIGlmICh0eXBlLmVxdWFscygiam1zIikpIHsNCiAgICAg\nICAgICAgICAgICBjID0gbmV3IERpc3RyaWJ1dGVkQ2FjaGVUZXN0KCJ0aW1l\nIHRlc3QiLA0KICAgICAgICAgICAgICAgICAgICBDb25jdXJyZW50RGF0YUNh\nY2hlLmNsYXNzKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAg\nICAgICAgYyA9IG5ldyBUZXN0TG9jYWxDYWNoZSgidGltZSB0ZXN0Iik7DQog\nICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGMuc2V0VXAoKTsNCiAgICAg\nICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMo\nKTsNCiAgICAgICAgICAgIGludCBjb3VudCA9IDEwMDA7DQogICAgICAgICAg\nICBmb3IgKGludCBqID0gMDsgaiA8IGNvdW50OyBqKyspIHsNCiAgICAgICAg\nICAgICAgICBjLmRvYXNzZXJ0VHJ1ZShjLmZhY3RvcnkuY3JlYXRlRW50aXR5\nTWFuYWdlcigpLCBORVdfTkFNRSwNCiAgICAgICAgICAgICAgICAgICAgT1JJ\nR19BR0UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgU3lzdGVtLm91\ndC5wcmludGxuKGNvdW50ICsgIiBpdGVyYXRpb25zIGluICINCiAgICAgICAg\nICAgICAgICArIChTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSAtIHN0YXJ0\nKSArICIgbWlsbGlzIik7DQogICAgICAgICAgICBjLnRlYXJEb3duKCk7DQog\nICAgICAgIH0NCiAgICB9DQp9DQo=\n","encoding":"base64"}

