{"sha":"3b2f1e71de0b490c5d76fa4d9870568027611ea5","node_id":"MDQ6QmxvYjIwNjM2NDozYjJmMWU3MWRlMGI0OTBjNWQ3NmZhNGQ5ODcwNTY4MDI3NjExZWE1","size":19689,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3b2f1e71de0b490c5d76fa4d9870568027611ea5","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\ncGVyc2lzdGVuY2Uua2VybmVsOw0KDQppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOw0KaW1wb3J0IGphdmEudXRpbC5MaXN0Ow0KaW1wb3J0IGphdmEudXRp\nbC5NYXA7DQoNCg0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0\nZW5jZS5rZXJuZWwuY29tbW9uLmFwcHMuRGVwZW5kZW50RmllbGRzUEM7DQpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLkV4dGVudDsN\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuT3BlbkpQ\nQUVudGl0eU1hbmFnZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBl\ncnNpc3RlbmNlLk9wZW5KUEFQZXJzaXN0ZW5jZTsNCg0KcHVibGljIGNsYXNz\nIFRlc3REZXBlbmRlbnRGaWVsZHMyIGV4dGVuZHMgQmFzZUtlcm5lbFRlc3Qg\new0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IENPTU1JVCA9IDA7\nDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFJPTExCQUNLID0gMTsN\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgUFJFU1RPUkUgPSAyOw0K\nDQogICAgcHJpdmF0ZSBPYmplY3QgX3Jvb3QgPSBudWxsOw0KICAgIHByaXZh\ndGUgT2JqZWN0IF9yZWwgPSBudWxsOw0KICAgIHByaXZhdGUgT2JqZWN0IF9k\nZXBSZWwgPSBudWxsOw0KICAgIHByaXZhdGUgT2JqZWN0IF9kZWVwID0gbnVs\nbDsNCiAgICBwcml2YXRlIE9iamVjdCBfY29sbCA9IG51bGw7DQogICAgcHJp\ndmF0ZSBPYmplY3QgX2RlcENvbGwgPSBudWxsOw0KICAgIHByaXZhdGUgT2Jq\nZWN0IF9tYXAgPSBudWxsOw0KICAgIHByaXZhdGUgT2JqZWN0IF9kZXBNYXAg\nPSBudWxsOw0KICAgIHByaXZhdGUgT2JqZWN0IF9yZXBlYXQgPSBudWxsOw0K\nDQogICAgcHVibGljIFRlc3REZXBlbmRlbnRGaWVsZHMyKFN0cmluZyBjYXNl\nbmFtZSkgew0KICAgICAgICBzdXBlcihjYXNlbmFtZSk7DQogICAgfQ0KDQog\nICAgcHVibGljIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhjZXB0aW9uIHsNCiAg\nICAgICAgZGVsZXRlQWxsKERlcGVuZGVudEZpZWxkc1BDLmNsYXNzKTsNCg0K\nICAgICAgICBEZXBlbmRlbnRGaWVsZHNQQyByb290ID0gbmV3IERlcGVuZGVu\ndEZpZWxkc1BDKCk7DQogICAgICAgIHJvb3Quc2V0UmVsYXRpb24obmV3IERl\ncGVuZGVudEZpZWxkc1BDKCkpOw0KICAgICAgICByb290LmdldExpc3QoKS5h\nZGQobmV3IERlcGVuZGVudEZpZWxkc1BDKCkpOw0KICAgICAgICByb290Lmdl\ndE1hcCgpLnB1dCgia2V5IiwgbmV3IERlcGVuZGVudEZpZWxkc1BDKCkpOw0K\nICAgICAgICByb290LnNldERlcGVuZGVudFJlbGF0aW9uKG5ldyBEZXBlbmRl\nbnRGaWVsZHNQQygpKTsNCiAgICAgICAgcm9vdC5nZXREZXBlbmRlbnRSZWxh\ndGlvbigpLnNldERlcGVuZGVudFJlbGF0aW9uDQogICAgICAgICAgICAobmV3\nIERlcGVuZGVudEZpZWxkc1BDKCkpOw0KICAgICAgICByb290LmdldERlcGVu\nZGVudExpc3QoKS5hZGQobmV3IERlcGVuZGVudEZpZWxkc1BDKCkpOw0KICAg\nICAgICByb290LmdldERlcGVuZGVudE1hcCgpLnB1dCgia2V5IiwgbmV3IERl\ncGVuZGVudEZpZWxkc1BDKCkpOw0KDQogICAgICAgIERlcGVuZGVudEZpZWxk\nc1BDIHJlcGVhdCA9IG5ldyBEZXBlbmRlbnRGaWVsZHNQQygpOw0KICAgICAg\nICByb290LmdldERlcGVuZGVudExpc3QoKS5hZGQocmVwZWF0KTsNCiAgICAg\nICAgcm9vdC5nZXREZXBlbmRlbnRNYXAoKS5wdXQoInJlcGVhdCIsIHJlcGVh\ndCk7DQoNCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgcG0gPQ0KICAg\nICAgICAgICAgKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBjdXJyZW50RW50aXR5\nTWFuYWdlcigpOw0KICAgICAgICBzdGFydFR4KHBtKTsNCiAgICAgICAgcG0u\ncGVyc2lzdChyb290KTsNCiAgICAgICAgZW5kVHgocG0pOw0KDQogICAgICAg\nIF9yb290ID0gcG0uZ2V0T2JqZWN0SWQocm9vdCk7DQogICAgICAgIGFzc2Vy\ndE5vdE51bGwoX3Jvb3QpOw0KICAgICAgICBfcmVsID0gcG0uZ2V0T2JqZWN0\nSWQocm9vdC5nZXRSZWxhdGlvbigpKTsNCiAgICAgICAgX2RlcFJlbCA9IHBt\nLmdldE9iamVjdElkKHJvb3QuZ2V0RGVwZW5kZW50UmVsYXRpb24oKSk7DQog\nICAgICAgIF9kZWVwID0gcG0uZ2V0T2JqZWN0SWQocm9vdC5nZXREZXBlbmRl\nbnRSZWxhdGlvbigpLg0KICAgICAgICAgICAgZ2V0RGVwZW5kZW50UmVsYXRp\nb24oKSk7DQogICAgICAgIF9jb2xsID0gcG0uZ2V0T2JqZWN0SWQocm9vdC5n\nZXRMaXN0KCkuaXRlcmF0b3IoKS5uZXh0KCkpOw0KICAgICAgICBJdGVyYXRv\nciBpdHIgPSByb290LmdldERlcGVuZGVudExpc3QoKS5pdGVyYXRvcigpOw0K\nICAgICAgICBfZGVwQ29sbCA9IHBtLmdldE9iamVjdElkKGl0ci5uZXh0KCkp\nOw0KICAgICAgICBfcmVwZWF0ID0gcG0uZ2V0T2JqZWN0SWQoaXRyLm5leHQo\nKSk7DQogICAgICAgIF9tYXAgPSBwbS5nZXRPYmplY3RJZChyb290LmdldE1h\ncCgpLmdldCgia2V5IikpOw0KICAgICAgICBfZGVwTWFwID0gcG0uZ2V0T2Jq\nZWN0SWQocm9vdC5nZXREZXBlbmRlbnRNYXAoKS5nZXQoImtleSIpKTsNCg0K\nICAgICAgICBlbmRFbShwbSk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQg\ndGVzdERlcGVuZGVudEZpZWxkc0xvYWRlZCgpIHsNCiAgICAgICAgZGVsZXRl\nKHRydWUsIENPTU1JVCk7DQogICAgICAgIGNoZWNrRmllbGRzKCk7DQogICAg\nfQ0KDQogICAgcHVibGljIHZvaWQgdGVzdERlcGVuZGVudEZpZWxkc0xvYWRl\nZFdpdGhSb2xsYmFjaygpIHsNCiAgICAgICAgZGVsZXRlKHRydWUsIFJPTExC\nQUNLKTsNCiAgICAgICAgY2hlY2tGaWVsZHMoKTsNCiAgICB9DQoNCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0RGVwZW5kZW50RmllbGRzTG9hZGVkV2l0aFByZVN0\nb3JlKCkgew0KICAgICAgICBkZWxldGUodHJ1ZSwgUFJFU1RPUkUpOw0KICAg\nICAgICBjaGVja0ZpZWxkcygpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lk\nIHRlc3REZXBlbmRlbnRGaWVsZHNVbmxvYWRlZCgpIHsNCiAgICAgICAgZGVs\nZXRlKGZhbHNlLCBDT01NSVQpOw0KICAgICAgICBjaGVja0ZpZWxkcygpOw0K\nICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHRlc3REZXBlbmRlbnRGaWVsZHNV\nbmxvYWRlZFdpdGhSb2xsYmFjaygpIHsNCiAgICAgICAgZGVsZXRlKGZhbHNl\nLCBST0xMQkFDSyk7DQogICAgICAgIGNoZWNrRmllbGRzKCk7DQogICAgfQ0K\nDQogICAgcHVibGljIHZvaWQgdGVzdERlcGVuZGVudEZpZWxkc1VubG9hZGVk\nV2l0aFByZVN0b3JlKCkgew0KICAgICAgICBkZWxldGUoZmFsc2UsIFBSRVNU\nT1JFKTsNCiAgICAgICAgY2hlY2tGaWVsZHMoKTsNCiAgICB9DQoNCiAgICBw\ncml2YXRlIHZvaWQgZGVsZXRlKGJvb2xlYW4gbG9hZCwgaW50IGFjdGlvbikg\new0KICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBwbSA9IGdldFBNKHRy\ndWUsIHRydWUpOw0KICAgICAgICBEZXBlbmRlbnRGaWVsZHNQQyByb290Ow0K\nICAgICAgICBPYmplY3QgcmVsID0gbnVsbDsNCiAgICAgICAgT2JqZWN0IGRl\ncFJlbCA9IG51bGw7DQogICAgICAgIE9iamVjdCBjb2xsID0gbnVsbDsNCiAg\nICAgICAgT2JqZWN0IGRlcENvbGwgPSBudWxsOw0KICAgICAgICBPYmplY3Qg\nbWFwID0gbnVsbDsNCiAgICAgICAgT2JqZWN0IGRlcE1hcCA9IG51bGw7DQog\nICAgICAgIE9iamVjdCByZXBlYXQgPSBudWxsOw0KICAgICAgICBPYmplY3Qg\nZGVlcCA9IG51bGw7DQogICAgICAgIHdoaWxlICh0cnVlKSB7DQogICAgICAg\nICAgICBzdGFydFR4KHBtKTsNCiAgICAgICAgICAgIHJvb3QgPSAoRGVwZW5k\nZW50RmllbGRzUEMpIHBtLmZpbmQoRGVwZW5kZW50RmllbGRzUEMuY2xhc3Ms\nIF9yb290KTsNCiAgICAgICAgICAgIGlmIChsb2FkKSB7DQogICAgICAgICAg\nICAgICAgcmVsID0gcm9vdC5nZXRSZWxhdGlvbigpOw0KICAgICAgICAgICAg\nICAgIGFzc2VydE5vdE51bGwocmVsKTsNCiAgICAgICAgICAgICAgICBkZXBS\nZWwgPSByb290LmdldERlcGVuZGVudFJlbGF0aW9uKCk7DQogICAgICAgICAg\nICAgICAgYXNzZXJ0Tm90TnVsbChkZXBSZWwpOw0KICAgICAgICAgICAgICAg\nIGRlZXAgPSAoKERlcGVuZGVudEZpZWxkc1BDKSBkZXBSZWwpLmdldERlcGVu\nZGVudFJlbGF0aW9uKCk7DQogICAgICAgICAgICAgICAgYXNzZXJ0Tm90TnVs\nbChkZWVwKTsNCiAgICAgICAgICAgICAgICBjb2xsID0gcm9vdC5nZXRMaXN0\nKCkuaXRlcmF0b3IoKS5uZXh0KCk7DQogICAgICAgICAgICAgICAgYXNzZXJ0\nTm90TnVsbChjb2xsKTsNCiAgICAgICAgICAgICAgICBJdGVyYXRvciBpdHIg\nPSByb290LmdldERlcGVuZGVudExpc3QoKS5pdGVyYXRvcigpOw0KICAgICAg\nICAgICAgICAgIGRlcENvbGwgPSBpdHIubmV4dCgpOw0KICAgICAgICAgICAg\nICAgIHJlcGVhdCA9IGl0ci5uZXh0KCk7DQogICAgICAgICAgICAgICAgYXNz\nZXJ0Tm90TnVsbChkZXBDb2xsKTsNCiAgICAgICAgICAgICAgICBhc3NlcnRO\nb3ROdWxsKHJlcGVhdCk7DQogICAgICAgICAgICAgICAgbWFwID0gcm9vdC5n\nZXRNYXAoKS5nZXQoImtleSIpOw0KICAgICAgICAgICAgICAgIGFzc2VydE5v\ndE51bGwobWFwKTsNCiAgICAgICAgICAgICAgICBkZXBNYXAgPSByb290Lmdl\ndERlcGVuZGVudE1hcCgpLmdldCgia2V5Iik7DQogICAgICAgICAgICAgICAg\nYXNzZXJ0Tm90TnVsbChkZXBNYXApOw0KDQogICAgICAgICAgICAgICAgLy8g\ncGNsOiB0ZXN0IGJvdGggZGVwQ29sbCBhbmQgcmVwZWF0LCBzaW5jZSB0aGV5\nIG1pZ2h0DQogICAgICAgICAgICAgICAgLy8gaGF2ZSBiZWVuIG91dCBvZiBv\ncmRlciBhYm92ZS4NCiAgICAgICAgICAgICAgICBPYmplY3QgbyA9IHJvb3Qu\nZ2V0RGVwZW5kZW50TWFwKCkuZ2V0KCJyZXBlYXQiKTsNCiAgICAgICAgICAg\nICAgICBpZiAobyAhPSByZXBlYXQpDQogICAgICAgICAgICAgICAgICAgIGZh\naWwoImRlcGVuZGVudCBtYXAgZG9lcyBub3QgY29udGFpbiAncmVwZWF0JyIp\nOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcG0ucmVtb3ZlKHJvb3Qp\nOw0KDQogICAgICAgICAgICBpZiAoYWN0aW9uID09IFJPTExCQUNLKSB7DQog\nICAgICAgICAgICAgICAgcm9sbGJhY2tUeChwbSk7DQogICAgICAgICAgICAg\nICAgYWN0aW9uID0gQ09NTUlUOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChh\nY3Rpb24gPT0gQ09NTUlUKSB7DQogICAgICAgICAgICAgICAgZW5kVHgocG0p\nOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfSBlbHNl\nIHsNCiAgICAgICAgICAgICAgICBwbS5wcmVGbHVzaCgpOw0KICAgICAgICAg\nICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAg\nICAgICAgaWYgKGxvYWQpIHsNCiAgICAgICAgICAgIGlmIChhY3Rpb24gPT0g\nUFJFU1RPUkUpIHsNCiAgICAgICAgICAgICAgICBhc3NlcnRGYWxzZShwbS5p\nc1JlbW92ZWQocmVsKSk7DQogICAgICAgICAgICAgICAgYXNzZXJ0RmFsc2Uo\ncG0uaXNSZW1vdmVkKGNvbGwpKTsNCiAgICAgICAgICAgICAgICBhc3NlcnRG\nYWxzZShwbS5pc1JlbW92ZWQobWFwKSk7DQogICAgICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZShwbS5pc1JlbW92ZWQoZGVwUmVsKSk7DQogICAgICAgICAgICAg\nICAgYXNzZXJ0VHJ1ZShwbS5pc1JlbW92ZWQoZGVlcCkpOw0KICAgICAgICAg\nICAgICAgIGFzc2VydFRydWUocG0uaXNSZW1vdmVkKGRlcENvbGwpKTsNCiAg\nICAgICAgICAgICAgICBhc3NlcnRUcnVlKHBtLmlzUmVtb3ZlZChkZXBNYXAp\nKTsNCiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKHBtLmlzUmVtb3ZlZChy\nZXBlYXQpKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAg\nICAgYXNzZXJ0Tm90TnVsbChPcGVuSlBBUGVyc2lzdGVuY2UuZ2V0RW50aXR5\nTWFuYWdlcihyZWwpKTsNCiAgICAgICAgICAgICAgICBhc3NlcnROb3ROdWxs\nKE9wZW5KUEFQZXJzaXN0ZW5jZS5nZXRFbnRpdHlNYW5hZ2VyKGNvbGwpKTsN\nCiAgICAgICAgICAgICAgICBhc3NlcnROb3ROdWxsKE9wZW5KUEFQZXJzaXN0\nZW5jZS5nZXRFbnRpdHlNYW5hZ2VyKG1hcCkpOw0KICAgICAgICAgICAgICAg\nIGFzc2VydE51bGwoT3BlbkpQQVBlcnNpc3RlbmNlLmdldEVudGl0eU1hbmFn\nZXIoZGVwUmVsKSk7DQogICAgICAgICAgICAgICAgYXNzZXJ0TnVsbChPcGVu\nSlBBUGVyc2lzdGVuY2UuZ2V0RW50aXR5TWFuYWdlcihkZWVwKSk7DQogICAg\nICAgICAgICAgICAgYXNzZXJ0TnVsbChPcGVuSlBBUGVyc2lzdGVuY2UuZ2V0\nRW50aXR5TWFuYWdlcihkZXBDb2xsKSk7DQogICAgICAgICAgICAgICAgYXNz\nZXJ0TnVsbChPcGVuSlBBUGVyc2lzdGVuY2UuZ2V0RW50aXR5TWFuYWdlcihk\nZXBNYXApKTsNCiAgICAgICAgICAgICAgICBhc3NlcnROdWxsKE9wZW5KUEFQ\nZXJzaXN0ZW5jZS5nZXRFbnRpdHlNYW5hZ2VyKHJlcGVhdCkpOw0KICAgICAg\nICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGFjdGlvbiA9PSBQ\nUkVTVE9SRSkNCiAgICAgICAgICAgIGVuZFR4KHBtKTsNCiAgICAgICAgZW5k\nRW0ocG0pOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBjaGVja0ZpZWxk\ncygpIHsNCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgcG0gPSBnZXRQ\nTSh0cnVlLCB0cnVlKTsNCiAgICAgICAgYXNzZXJ0Tm90TnVsbChwbS5maW5k\nKERlcGVuZGVudEZpZWxkc1BDLmNsYXNzLCBfcmVsKSk7DQogICAgICAgIGFz\nc2VydE5vdE51bGwocG0uZmluZChEZXBlbmRlbnRGaWVsZHNQQy5jbGFzcywg\nX2NvbGwpKTsNCiAgICAgICAgYXNzZXJ0Tm90TnVsbChwbS5maW5kKERlcGVu\nZGVudEZpZWxkc1BDLmNsYXNzLCBfbWFwKSk7DQogICAgICAgIGFzc2VydE51\nbGwocG0uZmluZChEZXBlbmRlbnRGaWVsZHNQQy5jbGFzcywgX2RlcFJlbCkp\nOw0KICAgICAgICBhc3NlcnROdWxsKHBtLmZpbmQoRGVwZW5kZW50RmllbGRz\nUEMuY2xhc3MsIF9kZWVwKSk7DQogICAgICAgIGFzc2VydE51bGwocG0uZmlu\nZChEZXBlbmRlbnRGaWVsZHNQQy5jbGFzcywgX2RlcENvbGwpKTsNCiAgICAg\nICAgYXNzZXJ0TnVsbChwbS5maW5kKERlcGVuZGVudEZpZWxkc1BDLmNsYXNz\nLCBfZGVwTWFwKSk7DQoNCiAgICAgICAgZW5kRW0ocG0pOw0KICAgIH0NCg0K\nICAgIHB1YmxpYyB2b2lkIHRlc3ROdWxsRGVsZXRlc0RlcGVuZGVudCgpIHsN\nCiAgICAgICAgbnVsbERlbGV0ZXNEZXBlbmRlbnQoQ09NTUlUKTsNCiAgICB9\nDQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0TnVsbERlbGV0ZXNEZXBlbmRlbnRX\naXRoUm9sbGJhY2soKSB7DQogICAgICAgIG51bGxEZWxldGVzRGVwZW5kZW50\nKFJPTExCQUNLKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0TnVs\nbERlbGV0ZXNEZXBlbmRlbnRXaXRoUHJlU3RvcmUoKSB7DQogICAgICAgIG51\nbGxEZWxldGVzRGVwZW5kZW50KFBSRVNUT1JFKTsNCiAgICB9DQoNCiAgICBw\ncml2YXRlIHZvaWQgbnVsbERlbGV0ZXNEZXBlbmRlbnQoaW50IGFjdGlvbikg\new0KICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBwbSA9DQogICAgICAg\nICAgICAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGN1cnJlbnRFbnRpdHlNYW5h\nZ2VyKCk7DQogICAgICAgIERlcGVuZGVudEZpZWxkc1BDIHBjOw0KICAgICAg\nICBEZXBlbmRlbnRGaWVsZHNQQyBkZXBSZWw7DQogICAgICAgIHdoaWxlICh0\ncnVlKSB7DQogICAgICAgICAgICBzdGFydFR4KHBtKTsNCiAgICAgICAgICAg\nIHBjID0gKERlcGVuZGVudEZpZWxkc1BDKSBwbS5maW5kKERlcGVuZGVudEZp\nZWxkc1BDLmNsYXNzLCBfcm9vdCk7DQogICAgICAgICAgICBkZXBSZWwgPSBw\nYy5nZXREZXBlbmRlbnRSZWxhdGlvbigpOw0KICAgICAgICAgICAgYXNzZXJ0\nRXF1YWxzKF9kZXBSZWwsIHBtLmdldE9iamVjdElkKGRlcFJlbCkpOw0KICAg\nICAgICAgICAgcGMuc2V0RGVwZW5kZW50UmVsYXRpb24obnVsbCk7DQogICAg\nICAgICAgICBpZiAoYWN0aW9uID09IFJPTExCQUNLKSB7DQogICAgICAgICAg\nICAgICAgcm9sbGJhY2tUeChwbSk7DQogICAgICAgICAgICAgICAgYWN0aW9u\nID0gQ09NTUlUOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT0g\nQ09NTUlUKSB7DQogICAgICAgICAgICAgICAgZW5kVHgocG0pOw0KICAgICAg\nICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAg\nICAgICAgICAgICBwbS5wcmVGbHVzaCgpOw0KICAgICAgICAgICAgICAgIGJy\nZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYg\nKGFjdGlvbiA9PSBQUkVTVE9SRSkgew0KICAgICAgICAgICAgYXNzZXJ0VHJ1\nZShwbS5pc1JlbW92ZWQoZGVwUmVsKSk7DQogICAgICAgICAgICBlbmRUeChw\nbSk7DQogICAgICAgIH0NCg0KICAgICAgICBhc3NlcnRUcnVlKCFwbS5pc1Bl\ncnNpc3RlbnQoZGVwUmVsKSk7DQogICAgICAgIGFzc2VydE51bGwocG0uZmlu\nZChEZXBlbmRlbnRGaWVsZHNQQy5jbGFzcywgX2RlcFJlbCkpOw0KICAgICAg\nICBlbmRFbShwbSk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgdGVzdFJl\nbW92ZURlbGV0ZXNEZXBlbmRlbnQoKSB7DQogICAgICAgIHJlbW92ZURlbGV0\nZXNEZXBlbmRlbnQoQ09NTUlUKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0UmVtb3ZlRGVsZXRlc0RlcGVuZGVudFdpdGhSb2xsYmFjaygpIHsN\nCiAgICAgICAgcmVtb3ZlRGVsZXRlc0RlcGVuZGVudChST0xMQkFDSyk7DQog\nICAgfQ0KDQogICAgcHVibGljIHZvaWQgdGVzdFJlbW92ZURlbGV0ZXNEZXBl\nbmRlbnRXaXRoUHJlU3RvcmUoKSB7DQogICAgICAgIHJlbW92ZURlbGV0ZXNE\nZXBlbmRlbnQoUFJFU1RPUkUpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9p\nZCByZW1vdmVEZWxldGVzRGVwZW5kZW50KGludCBhY3Rpb24pIHsNCiAgICAg\nICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgcG0gPQ0KICAgICAgICAgICAgKE9w\nZW5KUEFFbnRpdHlNYW5hZ2VyKSBjdXJyZW50RW50aXR5TWFuYWdlcigpOw0K\nICAgICAgICBEZXBlbmRlbnRGaWVsZHNQQyBwYzsNCiAgICAgICAgRGVwZW5k\nZW50RmllbGRzUEMgZGVwQ29sbDsNCiAgICAgICAgRGVwZW5kZW50RmllbGRz\nUEMgZGVwTWFwOw0KICAgICAgICBMaXN0IGxpc3Q7DQogICAgICAgIE1hcCBt\nYXA7DQogICAgICAgIHdoaWxlICh0cnVlKSB7DQogICAgICAgICAgICBzdGFy\ndFR4KHBtKTsNCiAgICAgICAgICAgIHBjID0gKERlcGVuZGVudEZpZWxkc1BD\nKSBwbS5maW5kKERlcGVuZGVudEZpZWxkc1BDLmNsYXNzLCBfcm9vdCk7DQog\nICAgICAgICAgICBsaXN0ID0gcGMuZ2V0RGVwZW5kZW50TGlzdCgpOw0KICAg\nICAgICAgICAgYXNzZXJ0RXF1YWxzKCJsaXN0IHNpemUgPSEgMiIsIDIsIGxp\nc3Quc2l6ZSgpKTsNCiAgICAgICAgICAgIGRlcENvbGwgPSAoRGVwZW5kZW50\nRmllbGRzUEMpIGxpc3QucmVtb3ZlKDApOw0KICAgICAgICAgICAgYXNzZXJ0\nRXF1YWxzKCJfZGVwQ29sbCBpcyBub3QgcG0uZ2V0T2JqZWN0SWQoZGVwQ29s\nbCkiLCBfZGVwQ29sbCwNCiAgICAgICAgICAgICAgICBwbS5nZXRPYmplY3RJ\nZChkZXBDb2xsKSk7DQoNCiAgICAgICAgICAgIG1hcCA9IHBjLmdldERlcGVu\nZGVudE1hcCgpOw0KICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJtYXAgc2l6\nZSA9ISAyIiwgMiwgbWFwLnNpemUoKSk7DQogICAgICAgICAgICBkZXBNYXAg\nPSAoRGVwZW5kZW50RmllbGRzUEMpIG1hcC5yZW1vdmUoImtleSIpOw0KICAg\nICAgICAgICAgYXNzZXJ0RXF1YWxzKCJfZGVwTWFwIGlzIG5vdCBwbS5nZXRP\nYmplY3RJZChkZXBNYXApIiwgX2RlcE1hcCwNCiAgICAgICAgICAgICAgICBw\nbS5nZXRPYmplY3RJZChkZXBNYXApKTsNCg0KICAgICAgICAgICAgaWYgKGFj\ndGlvbiA9PSBST0xMQkFDSykgew0KICAgICAgICAgICAgICAgIHJvbGxiYWNr\nVHgocG0pOw0KICAgICAgICAgICAgICAgIGFjdGlvbiA9IENPTU1JVDsNCiAg\nICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09IENPTU1JVCkgew0KICAg\nICAgICAgICAgICAgIGVuZFR4KHBtKTsNCiAgICAgICAgICAgICAgICBicmVh\nazsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcG0u\ncHJlRmx1c2goKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAg\nICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChhY3Rpb24gPT0gUFJF\nU1RPUkUpIHsNCiAgICAgICAgICAgIGFzc2VydFRydWUocG0uaXNSZW1vdmVk\nKGRlcENvbGwpKTsNCiAgICAgICAgICAgIGFzc2VydFRydWUocG0uaXNSZW1v\ndmVkKGRlcE1hcCkpOw0KICAgICAgICAgICAgZW5kVHgocG0pOw0KICAgICAg\nICB9DQoNCi8vICAgICAgICBhc3NlcnRUcnVlKCJkZXBjb2xsIGlzIHBlcnNp\nc3RlbmNlIiwgIXBtLmlzUGVyc2lzdGVudChkZXBDb2xsKSk7DQogICAgICAg\nIGFzc2VydE51bGwocG0uZmluZChEZXBlbmRlbnRGaWVsZHNQQy5jbGFzcywg\nX2RlcENvbGwpKTsNCg0KLy8gICAgICAgIGFzc2VydFRydWUoImRlcE1hcCBp\ncyBwZXJzaXN0ZW5jZSIsICFwbS5pc1BlcnNpc3RlbnQoZGVwTWFwKSk7DQog\nICAgICAgIGFzc2VydE51bGwocG0uZmluZChEZXBlbmRlbnRGaWVsZHNQQy5j\nbGFzcywgX2RlcE1hcCkpOw0KDQogICAgICAgIGFzc2VydE5vdE51bGwoInJl\ncGVhdCBpcyBudWxsIiwNCiAgICAgICAgICAgIHBtLmZpbmQoRGVwZW5kZW50\nRmllbGRzUEMuY2xhc3MsIF9yZXBlYXQpKTsNCiAgICAgICAgZW5kRW0ocG0p\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHRlc3RNb3ZlRGVwZW5kZW50\nSW5Db250YWluZXIoKSB7DQogICAgICAgIG1vdmVEZXBlbmRlbnRJbkNvbnRh\naW5lcihDT01NSVQpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHRlc3RN\nb3ZlRGVwZW5kZW50SW5Db250YWluZXJXaXRoUm9sbGJhY2soKSB7DQogICAg\nICAgIG1vdmVEZXBlbmRlbnRJbkNvbnRhaW5lcihST0xMQkFDSyk7DQogICAg\nfQ0KDQogICAgcHVibGljIHZvaWQgdGVzdE1vdmVEZXBlbmRlbnRJbkNvbnRh\naW5lcldpdGhQcmVTdG9yZSgpIHsNCiAgICAgICAgbW92ZURlcGVuZGVudElu\nQ29udGFpbmVyKFBSRVNUT1JFKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHZv\naWQgbW92ZURlcGVuZGVudEluQ29udGFpbmVyKGludCBhY3Rpb24pIHsNCiAg\nICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgcG0gPQ0KICAgICAgICAgICAg\nKE9wZW5KUEFFbnRpdHlNYW5hZ2VyKSBjdXJyZW50RW50aXR5TWFuYWdlcigp\nOw0KICAgICAgICBEZXBlbmRlbnRGaWVsZHNQQyBwYzsNCiAgICAgICAgRGVw\nZW5kZW50RmllbGRzUEMgZGVwQ29sbDsNCiAgICAgICAgRGVwZW5kZW50Rmll\nbGRzUEMgZGVwTWFwOw0KICAgICAgICBMaXN0IGxpc3Q7DQogICAgICAgIE1h\ncCBtYXA7DQogICAgICAgIHdoaWxlICh0cnVlKSB7DQogICAgICAgICAgICBz\ndGFydFR4KHBtKTsNCiAgICAgICAgICAgIHBjID0gKERlcGVuZGVudEZpZWxk\nc1BDKSBwbS5maW5kKERlcGVuZGVudEZpZWxkc1BDLmNsYXNzLCBfcm9vdCk7\nDQogICAgICAgICAgICBsaXN0ID0gcGMuZ2V0RGVwZW5kZW50TGlzdCgpOw0K\nICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDIsIGxpc3Quc2l6ZSgpKTsNCiAg\nICAgICAgICAgIGRlcENvbGwgPSAoRGVwZW5kZW50RmllbGRzUEMpIGxpc3Qu\nZ2V0KDApOw0KICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKF9kZXBDb2xsLCBw\nbS5nZXRPYmplY3RJZChkZXBDb2xsKSk7DQogICAgICAgICAgICBsaXN0LnJl\nbW92ZSgwKTsNCiAgICAgICAgICAgIGxpc3QuYWRkKGRlcENvbGwpOw0KDQog\nICAgICAgICAgICBtYXAgPSBwYy5nZXREZXBlbmRlbnRNYXAoKTsNCiAgICAg\nICAgICAgIGFzc2VydEVxdWFscygyLCBtYXAuc2l6ZSgpKTsNCiAgICAgICAg\nICAgIGRlcE1hcCA9IChEZXBlbmRlbnRGaWVsZHNQQykgbWFwLmdldCgia2V5\nIik7DQogICAgICAgICAgICBhc3NlcnRFcXVhbHMoX2RlcE1hcCwgcG0uZ2V0\nT2JqZWN0SWQoZGVwTWFwKSk7DQogICAgICAgICAgICBtYXAucmVtb3ZlKCJr\nZXkiKTsNCiAgICAgICAgICAgIG1hcC5wdXQoIm5ld2tleSIsIGRlcE1hcCk7\nDQoNCiAgICAgICAgICAgIGlmIChhY3Rpb24gPT0gUk9MTEJBQ0spIHsNCiAg\nICAgICAgICAgICAgICByb2xsYmFja1R4KHBtKTsNCiAgICAgICAgICAgICAg\nICBhY3Rpb24gPSBDT01NSVQ7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGFj\ndGlvbiA9PSBDT01NSVQpIHsNCiAgICAgICAgICAgICAgICBlbmRUeChwbSk7\nDQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9IGVsc2Ug\new0KICAgICAgICAgICAgICAgIHBtLnByZUZsdXNoKCk7DQogICAgICAgICAg\nICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAg\nICAgICBpZiAoYWN0aW9uID09IFBSRVNUT1JFKSB7DQogICAgICAgICAgICBh\nc3NlcnRGYWxzZShwbS5pc1JlbW92ZWQoZGVwQ29sbCkpOw0KICAgICAgICAg\nICAgYXNzZXJ0RmFsc2UocG0uaXNSZW1vdmVkKGRlcE1hcCkpOw0KICAgICAg\nICAgICAgZW5kVHgocG0pOw0KICAgICAgICB9DQoNCiAgICAgICAgYXNzZXJ0\nVHJ1ZShwbS5pc1BlcnNpc3RlbnQoZGVwQ29sbCkpOw0KICAgICAgICBhc3Nl\ncnROb3ROdWxsKHBtLmZpbmQoRGVwZW5kZW50RmllbGRzUEMuY2xhc3MsIF9k\nZXBDb2xsKSk7DQogICAgICAgIGFzc2VydFRydWUocG0uaXNQZXJzaXN0ZW50\nKGRlcE1hcCkpOw0KICAgICAgICBhc3NlcnROb3ROdWxsKHBtLmZpbmQoRGVw\nZW5kZW50RmllbGRzUEMuY2xhc3MsIF9kZXBNYXApKTsNCiAgICAgICAgYXNz\nZXJ0Tm90TnVsbChwbS5maW5kKERlcGVuZGVudEZpZWxkc1BDLmNsYXNzLCBf\ncmVwZWF0KSk7DQogICAgICAgIGVuZEVtKHBtKTsNCiAgICB9DQoNCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0UmVmZWREZXBlbmRlbnROb3REZWxldGVkKCkgew0K\nICAgICAgICByZWZlZERlcGVuZGVudE5vdERlbGV0ZWQoQ09NTUlUKTsNCiAg\nICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZXN0UmVmZWREZXBlbmRlbnROb3RE\nZWxldGVkV2l0aFJvbGxiYWNrKCkgew0KICAgICAgICByZWZlZERlcGVuZGVu\ndE5vdERlbGV0ZWQoUk9MTEJBQ0spOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2\nb2lkIHRlc3RSZWZlZERlcGVuZGVudE5vdERlbGV0ZWRXaXRoUHJlU3RvcmUo\nKSB7DQogICAgICAgIHJlZmVkRGVwZW5kZW50Tm90RGVsZXRlZChQUkVTVE9S\nRSk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIHJlZmVkRGVwZW5kZW50\nTm90RGVsZXRlZChpbnQgYWN0aW9uKSB7DQogICAgICAgIE9wZW5KUEFFbnRp\ndHlNYW5hZ2VyIHBtID0NCiAgICAgICAgICAgIChPcGVuSlBBRW50aXR5TWFu\nYWdlcikgY3VycmVudEVudGl0eU1hbmFnZXIoKTsNCiAgICAgICAgRGVwZW5k\nZW50RmllbGRzUEMgcGM7DQogICAgICAgIERlcGVuZGVudEZpZWxkc1BDIG5l\nd1BDID0gbnVsbDsNCiAgICAgICAgRGVwZW5kZW50RmllbGRzUEMgZGVwUmVs\nOw0KICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgc3RhcnRU\neChwbSk7DQogICAgICAgICAgICBwYyA9IChEZXBlbmRlbnRGaWVsZHNQQykg\ncG0uZmluZChEZXBlbmRlbnRGaWVsZHNQQy5jbGFzcywgX3Jvb3QpOw0KICAg\nICAgICAgICAgaWYgKG5ld1BDID09IG51bGwpDQogICAgICAgICAgICAgICAg\nbmV3UEMgPSBuZXcgRGVwZW5kZW50RmllbGRzUEMoKTsNCiAgICAgICAgICAg\nIGRlcFJlbCA9IHBjLmdldERlcGVuZGVudFJlbGF0aW9uKCk7DQogICAgICAg\nICAgICBuZXdQQy5zZXREZXBlbmRlbnRSZWxhdGlvbihkZXBSZWwpOw0KICAg\nICAgICAgICAgcGMuc2V0RGVwZW5kZW50UmVsYXRpb24obnVsbCk7DQogICAg\nICAgICAgICBwbS5wZXJzaXN0KG5ld1BDKTsNCg0KICAgICAgICAgICAgaWYg\nKGFjdGlvbiA9PSBST0xMQkFDSykgew0KICAgICAgICAgICAgICAgIHJvbGxi\nYWNrVHgocG0pOw0KICAgICAgICAgICAgICAgIGFjdGlvbiA9IENPTU1JVDsN\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09IENPTU1JVCkgew0K\nICAgICAgICAgICAgICAgIGVuZFR4KHBtKTsNCiAgICAgICAgICAgICAgICBi\ncmVhazsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAg\ncG0ucHJlRmx1c2goKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAg\nICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChhY3Rpb24gPT0g\nUFJFU1RPUkUpIHsNCiAgICAgICAgICAgIGFzc2VydEZhbHNlKHBtLmlzUmVt\nb3ZlZChkZXBSZWwpKTsNCiAgICAgICAgICAgIGVuZFR4KHBtKTsNCiAgICAg\nICAgfQ0KDQogICAgICAgIGFzc2VydFRydWUocG0uaXNQZXJzaXN0ZW50KGRl\ncFJlbCkpOw0KICAgICAgICBhc3NlcnROb3ROdWxsKHBtLmZpbmQoRGVwZW5k\nZW50RmllbGRzUEMuY2xhc3MsIF9kZXBSZWwpKTsNCiAgICAgICAgZW5kRW0o\ncG0pOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHRlc3ROdWxsU2hhcmVk\nRGVwZW5kZW50KCkgew0KICAgICAgICBudWxsU2hhcmVkRGVwZW5kZW50KENP\nTU1JVCk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgdGVzdE51bGxTaGFy\nZWREZXBlbmRlbnRXaXRoUm9sbGJhY2soKSB7DQogICAgICAgIG51bGxTaGFy\nZWREZXBlbmRlbnQoUk9MTEJBQ0spOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2\nb2lkIHRlc3ROdWxsU2hhcmVkRGVwZW5kZW50V2l0aFByZVN0b3JlKCkgew0K\nICAgICAgICBudWxsU2hhcmVkRGVwZW5kZW50KFBSRVNUT1JFKTsNCiAgICB9\nDQoNCiAgICBwcml2YXRlIHZvaWQgbnVsbFNoYXJlZERlcGVuZGVudChpbnQg\nYWN0aW9uKSB7DQogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIHBtID0N\nCiAgICAgICAgICAgIChPcGVuSlBBRW50aXR5TWFuYWdlcikgY3VycmVudEVu\ndGl0eU1hbmFnZXIoKTsNCiAgICAgICAgRGVwZW5kZW50RmllbGRzUEMgcGM7\nDQogICAgICAgIERlcGVuZGVudEZpZWxkc1BDIHJlcGVhdDsNCiAgICAgICAg\nTGlzdCBsaXN0Ow0KICAgICAgICBNYXAgbWFwOw0KICAgICAgICB3aGlsZSAo\ndHJ1ZSkgew0KICAgICAgICAgICAgc3RhcnRUeChwbSk7DQogICAgICAgICAg\nICBwYyA9IChEZXBlbmRlbnRGaWVsZHNQQykgcG0uZmluZChEZXBlbmRlbnRG\naWVsZHNQQy5jbGFzcywgX3Jvb3QpOw0KICAgICAgICAgICAgbGlzdCA9IHBj\nLmdldERlcGVuZGVudExpc3QoKTsNCiAgICAgICAgICAgIGFzc2VydEVxdWFs\ncygyLCBsaXN0LnNpemUoKSk7DQogICAgICAgICAgICByZXBlYXQgPSAoRGVw\nZW5kZW50RmllbGRzUEMpIGxpc3QuZ2V0KDEpOw0KICAgICAgICAgICAgYXNz\nZXJ0RXF1YWxzKF9yZXBlYXQsIHBtLmdldE9iamVjdElkKHJlcGVhdCkpOw0K\nICAgICAgICAgICAgbGlzdC5yZW1vdmUoMSk7DQoNCiAgICAgICAgICAgIG1h\ncCA9IHBjLmdldERlcGVuZGVudE1hcCgpOw0KICAgICAgICAgICAgYXNzZXJ0\nRXF1YWxzKDIsIG1hcC5zaXplKCkpOw0KICAgICAgICAgICAgYXNzZXJ0RXF1\nYWxzKHJlcGVhdCwgKERlcGVuZGVudEZpZWxkc1BDKSBtYXAucmVtb3ZlKCJy\nZXBlYXQiKSk7DQoNCiAgICAgICAgICAgIGlmIChhY3Rpb24gPT0gUFJFU1RP\nUkUpDQogICAgICAgICAgICAgICAgcG0ucHJlRmx1c2goKTsNCiAgICAgICAg\nICAgIGVsc2UNCiAgICAgICAgICAgICAgICBwbS5mbHVzaCgpOw0KICAgICAg\nICAgICAgYXNzZXJ0VHJ1ZShwbS5pc1JlbW92ZWQocmVwZWF0KSk7DQoNCiAg\nICAgICAgICAgIC8vIG5vdyBhZnRlciBkZWxldGluZyBvbiBmbHVzaCwgYXNz\naWduaW5nIHRvIGFub3RoZXIgZmllbGQgYW5kDQogICAgICAgICAgICAvLyBh\ndHRlbXB0aW5nIHRvIGNvbW1pdCBzaG91bGQgdGhyb3cgYW4gZXJyb3IgLS0g\nY2FuJ3QgdW5kZWxldGUgYW4NCiAgICAgICAgICAgIC8vIG9iamVjdA0KICAg\nICAgICAgICAgcGMuZ2V0TGlzdCgpLmFkZChyZXBlYXQpOw0KDQogICAgICAg\nICAgICBpZiAoYWN0aW9uID09IFJPTExCQUNLKSB7DQogICAgICAgICAgICAg\nICAgcm9sbGJhY2tUeChwbSk7DQogICAgICAgICAgICAgICAgYWN0aW9uID0g\nQ09NTUlUOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBwbS5nZXRUcmFuc2FjdGlv\nbigpLmNvbW1pdCgpOw0KICAgICAgICAgICAgICAgICAgICBmYWlsKCJDb21t\naXR0ZWQgd2l0aCByZWYgdG8gZGVsZXRlZCBkZXBlbmRlbnQgb2JqZWN0Iik7\nDQogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGplKSB7DQog\nICAgICAgICAgICAgICAgICAgIHJvbGxiYWNrVHgocG0pOw0KICAgICAgICAg\nICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICAgICAgfQ0KICAgICAg\nICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoN\nCiAgICAgICAgZW5kRW0ocG0pOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lk\nIHRlc3RDbGVhck1hcHBlZERlcGVuZGVudE9mRGV0YWNoZWQoKSB7DQogICAg\nICAgIGNsZWFyRGVwZW5kZW50T2ZEZXRhY2hlZFRlc3QodHJ1ZSk7DQogICAg\nfQ0KDQogICAgcHVibGljIHZvaWQgdGVzdENsZWFySW52ZXJzZUtleURlcGVu\nZGVudE9mRGV0YWNoZWQoKSB7DQogICAgICAgIGNsZWFyRGVwZW5kZW50T2ZE\nZXRhY2hlZFRlc3QoZmFsc2UpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9p\nZCBjbGVhckRlcGVuZGVudE9mRGV0YWNoZWRUZXN0KGJvb2xlYW4gbWFwcGVk\nKSB7DQogICAgICAgIGRlbGV0ZUFsbChEZXBlbmRlbnRGaWVsZHNQQy5jbGFz\ncyk7DQoNCiAgICAgICAgRGVwZW5kZW50RmllbGRzUEMgb3duZXIgPSBuZXcg\nRGVwZW5kZW50RmllbGRzUEMoKTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCAyOyBpKyspIHsNCiAgICAgICAgICAgIERlcGVuZGVudEZpZWxkc1BD\nIGNoaWxkID0gbmV3IERlcGVuZGVudEZpZWxkc1BDKCk7DQogICAgICAgICAg\nICBpZiAobWFwcGVkKSB7DQogICAgICAgICAgICAgICAgb3duZXIuZ2V0RGVw\nZW5kZW50TWFwcGVkTGlzdCgpLmFkZChjaGlsZCk7DQogICAgICAgICAgICAg\nICAgY2hpbGQuc2V0T3duZXIob3duZXIpOw0KICAgICAgICAgICAgfSBlbHNl\nDQogICAgICAgICAgICAgICAgb3duZXIuZ2V0RGVwZW5kZW50SW52ZXJzZUtl\neUxpc3QoKS5hZGQoY2hpbGQpOw0KICAgICAgICB9DQoNCiAgICAgICAgT3Bl\nbkpQQUVudGl0eU1hbmFnZXIgcG0gPQ0KICAgICAgICAgICAgKE9wZW5KUEFF\nbnRpdHlNYW5hZ2VyKSBjdXJyZW50RW50aXR5TWFuYWdlcigpOw0KICAgICAg\nICBzdGFydFR4KHBtKTsNCiAgICAgICAgcG0ucGVyc2lzdChvd25lcik7DQog\nICAgICAgIGVuZFR4KHBtKTsNCiAgICAgICAgT2JqZWN0IG9pZCA9IHBtLmdl\ndE9iamVjdElkKG93bmVyKTsNCiAgICAgICAgYXNzZXJ0RXF1YWxzKDMsDQog\nICAgICAgICAgICAoKEV4dGVudCkgcG0uY3JlYXRlRXh0ZW50KERlcGVuZGVu\ndEZpZWxkc1BDLmNsYXNzLCB0cnVlKSkNCiAgICAgICAgICAgICAgICAubGlz\ndCgpLnNpemUoKSk7DQogICAgICAgIGVuZEVtKHBtKTsNCg0KICAgICAgICBw\nbSA9IChPcGVuSlBBRW50aXR5TWFuYWdlcikgY3VycmVudEVudGl0eU1hbmFn\nZXIoKTsNCiAgICAgICAgb3duZXIgPSAoRGVwZW5kZW50RmllbGRzUEMpIHBt\nLmZpbmQoRGVwZW5kZW50RmllbGRzUEMuY2xhc3MsIG9pZCk7DQogICAgICAg\nIGlmIChtYXBwZWQpDQogICAgICAgICAgICBhc3NlcnRFcXVhbHMoMiwgb3du\nZXIuZ2V0RGVwZW5kZW50TWFwcGVkTGlzdCgpLnNpemUoKSk7DQogICAgICAg\nIGVsc2UNCiAgICAgICAgICAgIGFzc2VydEVxdWFscygyLCBvd25lci5nZXRE\nZXBlbmRlbnRJbnZlcnNlS2V5TGlzdCgpLnNpemUoKSk7DQogICAgICAgIERl\ncGVuZGVudEZpZWxkc1BDIGRldGFjaGVkID0gKERlcGVuZGVudEZpZWxkc1BD\nKSBwbS5kZXRhY2gob3duZXIpOw0KICAgICAgICBlbmRFbShwbSk7DQoNCiAg\nICAgICAgaWYgKG1hcHBlZCkgew0KICAgICAgICAgICAgYXNzZXJ0RXF1YWxz\nKDIsIGRldGFjaGVkLmdldERlcGVuZGVudE1hcHBlZExpc3QoKS5zaXplKCkp\nOw0KICAgICAgICAgICAgZGV0YWNoZWQuZ2V0RGVwZW5kZW50TWFwcGVkTGlz\ndCgpLmNsZWFyKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBh\nc3NlcnRFcXVhbHMoMiwgZGV0YWNoZWQuZ2V0RGVwZW5kZW50SW52ZXJzZUtl\neUxpc3QoKS5zaXplKCkpOw0KICAgICAgICAgICAgZGV0YWNoZWQuZ2V0RGVw\nZW5kZW50SW52ZXJzZUtleUxpc3QoKS5jbGVhcigpOw0KICAgICAgICB9DQoN\nCiAgICAgICAgcG0gPSAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGN1cnJlbnRF\nbnRpdHlNYW5hZ2VyKCk7DQogICAgICAgIHN0YXJ0VHgocG0pOw0KICAgICAg\nICBvd25lciA9IChEZXBlbmRlbnRGaWVsZHNQQykgcG0ubWVyZ2UoZGV0YWNo\nZWQpOw0KICAgICAgICBpZiAobWFwcGVkKQ0KICAgICAgICAgICAgYXNzZXJ0\nRXF1YWxzKDAsIG93bmVyLmdldERlcGVuZGVudE1hcHBlZExpc3QoKS5zaXpl\nKCkpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBhc3NlcnRFcXVhbHMo\nMCwgb3duZXIuZ2V0RGVwZW5kZW50SW52ZXJzZUtleUxpc3QoKS5zaXplKCkp\nOw0KICAgICAgICBlbmRUeChwbSk7DQogICAgICAgIGFzc2VydEVxdWFscygx\nLA0KICAgICAgICAgICAgKChFeHRlbnQpIHBtLmNyZWF0ZUV4dGVudChEZXBl\nbmRlbnRGaWVsZHNQQy5jbGFzcywgdHJ1ZSkpLg0KICAgICAgICAgICAgICAg\nIGxpc3QoKS5zaXplKCkpOw0KICAgICAgICBlbmRFbShwbSk7DQoNCiAgICAg\nICAgcG0gPSAoT3BlbkpQQUVudGl0eU1hbmFnZXIpIGN1cnJlbnRFbnRpdHlN\nYW5hZ2VyKCk7DQogICAgICAgIG93bmVyID0gKERlcGVuZGVudEZpZWxkc1BD\nKSBwbS5maW5kKERlcGVuZGVudEZpZWxkc1BDLmNsYXNzLCBvaWQpOw0KICAg\nICAgICBpZiAobWFwcGVkKQ0KICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKDAs\nIG93bmVyLmdldERlcGVuZGVudE1hcHBlZExpc3QoKS5zaXplKCkpOw0KICAg\nICAgICBlbHNlDQogICAgICAgICAgICBhc3NlcnRFcXVhbHMoMCwgb3duZXIu\nZ2V0RGVwZW5kZW50SW52ZXJzZUtleUxpc3QoKS5zaXplKCkpOw0KICAgICAg\nICBlbmRFbShwbSk7DQogICAgfQ0KfQ0K\n","encoding":"base64"}

