{"sha":"4b066a33ce9a844050aea20b22237820fbe784ac","node_id":"MDQ6QmxvYjIwNjM2NDo0YjA2NmEzM2NlOWE4NDQwNTBhZWEyMGIyMjIzNzgyMGZiZTc4NGFj","size":17857,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4b066a33ce9a844050aea20b22237820fbe784ac","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\nc2xpY2UuamRiYzsNCg0KaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247DQpp\nbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOw0KaW1wb3J0IGphdmEudXRp\nbC5BcnJheUxpc3Q7DQppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOw0K\naW1wb3J0IGphdmEudXRpbC5MaXN0Ow0KaW1wb3J0IGphdmEudXRpbC5NYXA7\nDQppbXBvcnQgamF2YS51dGlsLlByb3BlcnRpZXM7DQppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQuRXhlY3V0b3JTZXJ2aWNlOw0KDQppbXBvcnQgamF2\nYXguc3FsLkRhdGFTb3VyY2U7DQppbXBvcnQgamF2YXguc3FsLlhBRGF0YVNv\ndXJjZTsNCg0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5K\nUEFDb25maWd1cmF0aW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247DQppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbkltcGw7DQpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkRhdGFTb3Vy\nY2VGYWN0b3J5Ow0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29u\nZi5Cb29sZWFuVmFsdWU7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5jb25mLkNvbmZpZ3VyYXRpb25Qcm92aWRlcjsNCmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmNvbmYuUGx1Z2luVmFsdWU7DQppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLlN0cmluZ0xpc3RWYWx1ZTsNCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuU3RyaW5nVmFsdWU7\nDQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlY29yYXRp\nbmdEYXRhU291cmNlOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\namRiYy5EZWxlZ2F0aW5nRGF0YVNvdXJjZTsNCmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLmxvZy5Mb2c7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5sb2cuTG9nRmFjdG9yeTsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmxvZy5Mb2dGYWN0b3J5SW1wbDsNCmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOw0KaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5zbGljZS5EaXN0cmlidXRlZEJyb2tlckltcGw7DQpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnNsaWNlLkRpc3RyaWJ1dGlvblBv\nbGljeTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuc2xpY2UuRXhlY3V0\nb3JTZXJ2aWNlVmFsdWU7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnNs\naWNlLlByb2R1Y3REZXJpdmF0aW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5zbGljZS5TbGljZTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Vc2VyRXhjZXB0aW9uOw0KDQovKioNCiAqIEltcGxlbWVudHMgYSBk\naXN0cmlidXRlZCBjb25maWd1cmF0aW9uIG9mIEpEQkNTdG9yZU1hbmFnZXJz\nLg0KICogVGhlIG9yaWdpbmFsIGNvbmZpZ3VyYXRpb24gcHJvcGVydGllcyBh\ncmUgYW5hbHl6ZWQgdG8gY3JlYXRlIGEgc2V0IG9mDQogKiBTbGljZSBzcGVj\naWZpYyBwcm9wZXJ0aWVzIHdpdGggZGVmYXVsdGluZyBydWxlcy4gDQogKiAN\nCiAqIEBhdXRob3IgUGluYWtpIFBvZGRhcg0KICogDQogKi8NCnB1YmxpYyBj\nbGFzcyBEaXN0cmlidXRlZEpEQkNDb25maWd1cmF0aW9uSW1wbCBleHRlbmRz\nIEpEQkNDb25maWd1cmF0aW9uSW1wbA0KICAgICAgICBpbXBsZW1lbnRzIERp\nc3RyaWJ1dGVkSkRCQ0NvbmZpZ3VyYXRpb24gew0KDQogICAgcHJpdmF0ZSBm\naW5hbCBMaXN0PFNsaWNlPiBfc2xpY2VzID0gbmV3IEFycmF5TGlzdDxTbGlj\nZT4oKTsNCiAgICBwcml2YXRlIExpc3Q8U3RyaW5nPiBfYWN0aXZlU2xpY2VO\nYW1lcyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOw0KICAgIHByaXZhdGUg\nU2xpY2UgX21hc3RlcjsNCiAgICANCiAgICBwcml2YXRlIERlY29yYXRpbmdE\nYXRhU291cmNlIHZpcnR1YWxEYXRhU291cmNlOw0KICAgIA0KICAgIHByb3Rl\nY3RlZCBCb29sZWFuVmFsdWUgbGVuaWVudFBsdWdpbjsNCiAgICBwcm90ZWN0\nZWQgU3RyaW5nVmFsdWUgbWFzdGVyUGx1Z2luOw0KICAgIHByb3RlY3RlZCBT\ndHJpbmdMaXN0VmFsdWUgbmFtZXNQbHVnaW47DQogICAgcHJvdGVjdGVkIEV4\nZWN1dG9yU2VydmljZVZhbHVlIGV4ZWN1dG9yU2VydmljZVBsdWdpbjsNCiAg\nICBwcm90ZWN0ZWQgUGx1Z2luVmFsdWUgZGlzdHJpYnV0aW9uUG9saWN5UGx1\nZ2luOw0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgRE9UID0g\nIi4iOw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFJFR0VYX0RP\nVCA9ICJcXC4iOw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFBS\nRUZJWF9TTElDRSA9IFByb2R1Y3REZXJpdmF0aW9uLlBSRUZJWF9TTElDRSAr\nIERPVDsNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBQUkVGSVhf\nT1BFTkpQQSA9ICJvcGVuanBhLiI7DQogICAgcHJpdmF0ZSBzdGF0aWMgTG9j\nYWxpemVyIF9sb2MgPQ0KICAgICAgICAgICAgTG9jYWxpemVyLmZvclBhY2th\nZ2UoRGlzdHJpYnV0ZWRKREJDQ29uZmlndXJhdGlvbkltcGwuY2xhc3MpOw0K\nDQogICAgLyoqDQogICAgICogQ29uZmlndXJlIGl0c2VsZiBhcyB3ZWxsIGFz\nIHVuZGVybHlpbmcgc2xpY2VzLg0KICAgICAqIA0KICAgICAqLw0KICAgIHB1\nYmxpYyBEaXN0cmlidXRlZEpEQkNDb25maWd1cmF0aW9uSW1wbChDb25maWd1\ncmF0aW9uUHJvdmlkZXIgY3ApIHsNCiAgICAgICAgc3VwZXIodHJ1ZSwgZmFs\nc2UpOw0KICAgICAgICBNYXAgcCA9IGNwLmdldFByb3BlcnRpZXMoKTsNCiAg\nICAgICAgU3RyaW5nIHBVbml0ID0gZ2V0UGVyc2lzdGVuY2VVbml0TmFtZShw\nKTsNCiAgICAgICAgc2V0RGlhZ25vc3RpY0NvbnRleHQocFVuaXQpOw0KICAg\nICAgICANCiAgICAgICAgYnJva2VyUGx1Z2luLnNldFN0cmluZyhEaXN0cmli\ndXRlZEJyb2tlckltcGwuY2xhc3MuZ2V0TmFtZSgpKTsNCiAgICAgICAgDQog\nICAgICAgIGRpc3RyaWJ1dGlvblBvbGljeVBsdWdpbiA9IGFkZFBsdWdpbigi\nRGlzdHJpYnV0aW9uUG9saWN5IiwgdHJ1ZSk7DQogICAgICAgIGRpc3RyaWJ1\ndGlvblBvbGljeVBsdWdpbi5zZXREeW5hbWljKHRydWUpOw0KICAgICAgICAN\nCiAgICAgICAgbGVuaWVudFBsdWdpbiA9IGFkZEJvb2xlYW4oIkxlbmllbnQi\nKTsNCiAgICAgICAgDQogICAgICAgIG1hc3RlclBsdWdpbiA9IGFkZFN0cmlu\nZygiTWFzdGVyIik7DQogICAgICAgIA0KICAgICAgICBuYW1lc1BsdWdpbiA9\nIGFkZFN0cmluZ0xpc3QoIk5hbWVzIik7DQogICAgICAgIA0KICAgICAgICBl\neGVjdXRvclNlcnZpY2VQbHVnaW4gPSBuZXcgRXhlY3V0b3JTZXJ2aWNlVmFs\ndWUoKTsNCiAgICAgICAgYWRkVmFsdWUoZXhlY3V0b3JTZXJ2aWNlUGx1Z2lu\nKTsNCiAgICAgICAgDQogICAgICAgIHNldFNsaWNlcyhwKTsNCiAgICB9DQog\nICAgDQogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0UGVyc2lzdGVuY2VVbml0TmFt\nZShNYXAgcCkgew0KICAgICAgICBPYmplY3QgdW5pdCA9IHAuZ2V0KFBSRUZJ\nWF9PUEVOSlBBK2lkLmdldFByb3BlcnR5KCkpOw0KICAgICAgICByZXR1cm4g\nKHVuaXQgPT0gbnVsbCkgPyAiPyIgOiB1bml0LnRvU3RyaW5nKCk7DQogICAg\nfQ0KICAgIA0KICAgIHByaXZhdGUgdm9pZCBzZXREaWFnbm9zdGljQ29udGV4\ndChTdHJpbmcgdW5pdCkgew0KICAgICAgICBMb2dGYWN0b3J5IGxvZ0ZhY3Rv\ncnkgPSBnZXRMb2dGYWN0b3J5KCk7DQogICAgICAgIGlmIChsb2dGYWN0b3J5\nIGluc3RhbmNlb2YgTG9nRmFjdG9yeUltcGwpIHsNCiAgICAgICAgICAgICgo\nTG9nRmFjdG9yeUltcGwpbG9nRmFjdG9yeSkuc2V0RGlhZ25vc3RpY0NvbnRl\neHQodW5pdCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAg\nKiBHZXRzIHRoZSBuYW1lIG9mIHRoZSBhY3RpdmUgc2xpY2VzLg0KICAgICAq\nLw0KICAgIHB1YmxpYyBMaXN0PFN0cmluZz4gZ2V0QWN0aXZlU2xpY2VOYW1l\ncygpIHsNCiAgICAgICAgaWYgKF9hY3RpdmVTbGljZU5hbWVzLmlzRW1wdHko\nKSkgew0KICAgICAgICAgICAgZm9yIChTbGljZSBzbGljZTpfc2xpY2VzKQ0K\nICAgICAgICAgICAgICAgIGlmIChzbGljZS5pc0FjdGl2ZSgpKQ0KICAgICAg\nICAgICAgICAgICAgICBfYWN0aXZlU2xpY2VOYW1lcy5hZGQoc2xpY2UuZ2V0\nTmFtZSgpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gX2FjdGl2ZVNs\naWNlTmFtZXM7DQogICAgfQ0KICAgIA0KICAgIC8qKg0KICAgICAqIEdldHMg\ndGhlIG5hbWUgb2YgdGhlIGF2YWlsYWJsZSBzbGljZXMuDQogICAgICovDQog\nICAgcHVibGljIExpc3Q8U3RyaW5nPiBnZXRBdmFpbGFibGVTbGljZU5hbWVz\nKCkgew0KICAgICAgICBMaXN0PFN0cmluZz4gcmVzdWx0ID0gbmV3IEFycmF5\nTGlzdDxTdHJpbmc+KCk7DQogICAgICAgIGZvciAoU2xpY2Ugc2xpY2U6X3Ns\naWNlcykNCiAgICAgICAgICAgIHJlc3VsdC5hZGQoc2xpY2UuZ2V0TmFtZSgp\nKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogICAgDQogICAg\nLyoqDQogICAgICogR2V0cyB0aGUgc2xpY2VzIG9mIGdpdmVuIHN0YXR1cy4g\nTnVsbCByZXR1cm5zIGFsbCBpcnJlc3BlY3RpdmUgb2Ygc3RhdHVzLg0KICAg\nICAqLw0KICAgIHB1YmxpYyBMaXN0PFNsaWNlPiBnZXRTbGljZXMoU2xpY2Uu\nU3RhdHVzLi4uc3RhdHVzZXMpIHsNCiAgICAgICAgaWYgKHN0YXR1c2VzID09\nIG51bGwpDQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMudW5tb2Rp\nZmlhYmxlTGlzdChfc2xpY2VzKTsNCiAgICAgICAgTGlzdDxTbGljZT4gcmVz\ndWx0ID0gbmV3IEFycmF5TGlzdDxTbGljZT4oKTsNCiAgICAgICAgZm9yIChT\nbGljZSBzbGljZTpfc2xpY2VzKSB7DQogICAgICAgICAgICBmb3IgKFNsaWNl\nLlN0YXR1cyBzdGF0dXM6c3RhdHVzZXMpDQogICAgICAgICAgICAgICAgaWYg\nKHNsaWNlLmdldFN0YXR1cygpLmVxdWFscyhzdGF0dXMpKQ0KICAgICAgICAg\nICAgICAgICAgICByZXN1bHQuYWRkKHNsaWNlKTsNCiAgICAgICAgfQ0KICAg\nICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCiAgICANCiAgICAvKioNCiAg\nICAgKiBHZXRzIHRoZSBtYXN0ZXIgc2xpY2UuIA0KICAgICAqLw0KICAgIHB1\nYmxpYyBTbGljZSBnZXRNYXN0ZXIoKSB7DQogICAgICAgIHJldHVybiBfbWFz\ndGVyOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCB0aGUgY29uZmln\ndXJhdGlvbiBmb3IgZ2l2ZW4gc2xpY2UuDQogICAgICovDQogICAgcHVibGlj\nIFNsaWNlIGdldFNsaWNlKFN0cmluZyBuYW1lKSB7DQogICAgICAgIGZvciAo\nU2xpY2Ugc2xpY2U6X3NsaWNlcykNCiAgICAgICAgICAgIGlmIChzbGljZS5n\nZXROYW1lKCkuZXF1YWxzKG5hbWUpKQ0KICAgICAgICAgICAgICAgIHJldHVy\nbiBzbGljZTsNCiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoInNsaWNlLW5vdC1mb3VuZCIsIG5hbWUsDQogICAgICAgICAgICAg\nICAgICAgIGdldEFjdGl2ZVNsaWNlTmFtZXMoKSkpOw0KICAgIH0NCg0KICAg\nIHB1YmxpYyBEaXN0cmlidXRpb25Qb2xpY3kgZ2V0RGlzdHJpYnV0aW9uUG9s\naWN5SW5zdGFuY2UoKSB7DQogICAgICAgIGlmIChkaXN0cmlidXRpb25Qb2xp\nY3lQbHVnaW4uZ2V0KCkgPT0gbnVsbCkgew0KICAgICAgICAgICAgZGlzdHJp\nYnV0aW9uUG9saWN5UGx1Z2luLmluc3RhbnRpYXRlKERpc3RyaWJ1dGlvblBv\nbGljeS5jbGFzcywNCiAgICAgICAgICAgICAgICAgICAgdGhpcywgdHJ1ZSk7\nDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIChEaXN0cmlidXRpb25Qb2xp\nY3kpIGRpc3RyaWJ1dGlvblBvbGljeVBsdWdpbi5nZXQoKTsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgdm9pZCBzZXREaXN0cmlidXRpb25Qb2xpY3lJbnN0YW5j\nZShTdHJpbmcgdmFsKSB7DQogICAgICAgIGRpc3RyaWJ1dGlvblBvbGljeVBs\ndWdpbi5zZXQodmFsKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndENvbm5lY3Rpb25GYWN0b3J5KCkgew0KICAgICAgICBpZiAodmlydHVhbERh\ndGFTb3VyY2UgPT0gbnVsbCkgew0KICAgICAgICAgICAgRGlzdHJpYnV0ZWRE\nYXRhU291cmNlIGRzID0gY3JlYXRlRGlzdHJpYnV0ZWREYXRhU3RvcmUoKTsN\nCiAgICAgICAgICAgIHZpcnR1YWxEYXRhU291cmNlID0NCiAgICAgICAgICAg\nICAgICAgICAgRGF0YVNvdXJjZUZhY3RvcnkuaW5zdGFsbERCRGljdGlvbmFy\neSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXREQkRpY3Rpb25h\ncnlJbnN0YW5jZSgpLCBkcywgdGhpcywgZmFsc2UpOw0KICAgICAgICB9DQog\nICAgICAgIHJldHVybiB2aXJ0dWFsRGF0YVNvdXJjZTsNCiAgICB9DQoNCiAg\nICAvKioNCiAgICAgKiBDcmVhdGUgYSB2aXJ0dWFsIERpc3RyaWJ1dGVkRGF0\nYVNvdXJjZSBhcyBhIGNvbXBvc2l0ZSBvZiBpbmRpdmlkdWFsDQogICAgICog\nc2xpY2VzIGFzIHBlciBjb25maWd1cmF0aW9uLCBvcHRpb25hbGx5IGlnbm9y\naW5nIHNsaWNlcyB0aGF0IGNhbiBub3QgYmUNCiAgICAgKiBjb25uZWN0ZWQu\nDQogICAgICovDQogICAgcHJpdmF0ZSBEaXN0cmlidXRlZERhdGFTb3VyY2Ug\nY3JlYXRlRGlzdHJpYnV0ZWREYXRhU3RvcmUoKSB7DQogICAgICAgIExpc3Q8\nRGF0YVNvdXJjZT4gZGF0YVNvdXJjZXMgPSBuZXcgQXJyYXlMaXN0PERhdGFT\nb3VyY2U+KCk7DQogICAgICAgIGJvb2xlYW4gaXNMZW5pZW50ID0gbGVuaWVu\ndFBsdWdpbi5nZXQoKTsNCiAgICAgICAgYm9vbGVhbiBpc1hBID0gdHJ1ZTsN\nCiAgICAgICAgZm9yIChTbGljZSBzbGljZSA6IF9zbGljZXMpIHsNCiAgICAg\nICAgICAgIEpEQkNDb25maWd1cmF0aW9uIGNvbmYgPSAoSkRCQ0NvbmZpZ3Vy\nYXRpb24pc2xpY2UuZ2V0Q29uZmlndXJhdGlvbigpOw0KICAgICAgICAgICAg\nTG9nIGxvZyA9IGNvbmYuZ2V0Q29uZmlndXJhdGlvbkxvZygpOw0KICAgICAg\nICAgICAgU3RyaW5nIHVybCA9IGdldENvbm5lY3Rpb25JbmZvKGNvbmYpOw0K\nICAgICAgICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVkKCkpDQogICAgICAg\nICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInNsaWNlLWNvbm5lY3QiLCBz\nbGljZSwgdXJsKSk7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nICAgIERhdGFTb3VyY2UgZHMgPSBEYXRhU291cmNlRmFjdG9yeS5uZXdEYXRh\nU291cmNlKGNvbmYsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICBEZWNvcmF0\naW5nRGF0YVNvdXJjZSBkZHMgPSBuZXcgRGVjb3JhdGluZ0RhdGFTb3VyY2Uo\nZHMpOw0KICAgICAgICAgICAgICAgIGRzID0gRGF0YVNvdXJjZUZhY3Rvcnku\naW5zdGFsbERCRGljdGlvbmFyeSgNCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKSwgZGRzLCBjb25mLCBm\nYWxzZSk7DQogICAgICAgICAgICAgICAgaWYgKHZlcmlmeURhdGFTb3VyY2Uo\nc2xpY2UsIGRzKSkgew0KICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNl\ncy5hZGQoZHMpOw0KICAgICAgICAgICAgICAgICAgICBpc1hBICY9IGlzWEFD\nb21wbGlhbnQoZHMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAg\nIH0gY2F0Y2ggKFRocm93YWJsZSBleCkgew0KICAgICAgICAgICAgICAgIGhh\nbmRsZUJhZENvbm5lY3Rpb24oaXNMZW5pZW50LCBzbGljZSwgZXgpOw0KICAg\nICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChkYXRhU291cmNl\ncy5pc0VtcHR5KCkpDQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tc2xpY2UiKSk7DQogICAgICAgIERpc3RyaWJ1\ndGVkRGF0YVNvdXJjZSByZXN1bHQgPSBuZXcgRGlzdHJpYnV0ZWREYXRhU291\ncmNlKGRhdGFTb3VyY2VzKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAg\nICB9DQoNCiAgICBTdHJpbmcgZ2V0Q29ubmVjdGlvbkluZm8oT3BlbkpQQUNv\nbmZpZ3VyYXRpb24gY29uZikgew0KICAgICAgICBTdHJpbmcgcmVzdWx0ID0g\nY29uZi5nZXRDb25uZWN0aW9uVVJMKCk7DQogICAgICAgIGlmIChyZXN1bHQg\nPT0gbnVsbCkgew0KICAgICAgICAgICAgcmVzdWx0ID0gY29uZi5nZXRDb25u\nZWN0aW9uRHJpdmVyTmFtZSgpOw0KICAgICAgICAgICAgU3RyaW5nIHByb3Bz\nID0gY29uZi5nZXRDb25uZWN0aW9uUHJvcGVydGllcygpOw0KICAgICAgICAg\nICAgaWYgKHByb3BzICE9IG51bGwpDQogICAgICAgICAgICAgICAgcmVzdWx0\nICs9ICIoIiArIHByb3BzICsgIikiOw0KICAgICAgICB9DQogICAgICAgIHJl\ndHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgYm9vbGVhbiBpc1hBQ29tcGxp\nYW50KERhdGFTb3VyY2UgZHMpIHsNCiAgICAgICAgaWYgKGRzIGluc3RhbmNl\nb2YgRGVsZWdhdGluZ0RhdGFTb3VyY2UpDQogICAgICAgICAgICByZXR1cm4g\nKChEZWxlZ2F0aW5nRGF0YVNvdXJjZSkgZHMpLmdldElubmVybW9zdERlbGVn\nYXRlKCkgDQogICAgICAgICAgICAgICBpbnN0YW5jZW9mIFhBRGF0YVNvdXJj\nZTsNCiAgICAgICAgcmV0dXJuIGRzIGluc3RhbmNlb2YgWEFEYXRhU291cmNl\nOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFZlcmlmeSB0aGF0IGEgY29u\nbmVjdGlvbiBjYW4gYmUgZXN0YWJsaXNoZWQgdG8gdGhlIGdpdmVuIHNsaWNl\nLiBJZg0KICAgICAqIGNvbm5lY3Rpb24gY2FuIG5vdCBiZSBlc3RhYmxpc2hl\nZCB0aGVuIHNsaWNlIGlzIHNldCB0byBJTkFDVElWRSBzdGF0ZS4NCiAgICAg\nKi8NCiAgICBwcml2YXRlIGJvb2xlYW4gdmVyaWZ5RGF0YVNvdXJjZShTbGlj\nZSBzbGljZSwgRGF0YVNvdXJjZSBkcykgew0KICAgICAgICBDb25uZWN0aW9u\nIGNvbiA9IG51bGw7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb24g\nPSBkcy5nZXRDb25uZWN0aW9uKCk7DQogICAgICAgICAgICBzbGljZS5zZXRT\ndGF0dXMoU2xpY2UuU3RhdHVzLkFDVElWRSk7DQogICAgICAgICAgICBpZiAo\nY29uID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICBzbGljZS5zZXRTdGF0\ndXMoU2xpY2UuU3RhdHVzLklOQUNUSVZFKTsNCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsNCiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGV4KSB7\nDQogICAgICAgICAgICBzbGljZS5zZXRTdGF0dXMoU2xpY2UuU3RhdHVzLklO\nQUNUSVZFKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAg\nfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGlmIChjb24gIT0gbnVsbCkNCiAg\nICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBjb24u\nY2xvc2UoKTsNCiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gZXgpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gaWdub3JlDQogICAg\nICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQog\nICAgICogRWl0aGVyIHRocm93IGEgdXNlciBleGNlcHRpb24gb3IgYWRkIHRo\nZSBjb25maWd1cmF0aW9uIHRvIHRoZSBnaXZlbiBsaXN0LA0KICAgICAqIGJh\nc2VkIG9uIDxjb2RlPmlzTGVuaWVudDwvY29kZT4uDQogICAgICovDQogICAg\ncHJpdmF0ZSB2b2lkIGhhbmRsZUJhZENvbm5lY3Rpb24oYm9vbGVhbiBpc0xl\nbmllbnQsIFNsaWNlIHNsaWNlLA0KICAgICAgICAgICAgVGhyb3dhYmxlIGV4\nKSB7DQogICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBzbGlj\nZS5nZXRDb25maWd1cmF0aW9uKCk7DQogICAgICAgIFN0cmluZyB1cmwgPSBj\nb25mLmdldENvbm5lY3Rpb25VUkwoKTsNCiAgICAgICAgTG9nIGxvZyA9IGdl\ndExvZyhMT0dfUlVOVElNRSk7DQogICAgICAgIGlmIChpc0xlbmllbnQpIHsN\nCiAgICAgICAgICAgIGlmIChleCAhPSBudWxsKSB7DQogICAgICAgICAgICAg\nICAgbG9nLndhcm4oX2xvYy5nZXQoInNsaWNlLWNvbm5lY3Qta25vd24td2Fy\nbiIsIHNsaWNlLCB1cmwsIGV4DQogICAgICAgICAgICAgICAgICAgICAgICAu\nZ2V0Q2F1c2UoKSkpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAg\nICAgICAgICBsb2cud2FybihfbG9jLmdldCgic2xpY2UtY29ubmVjdC13YXJu\nIiwgc2xpY2UsIHVybCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVs\nc2UgaWYgKGV4ICE9IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJzbGljZS1jb25uZWN0LWtub3duLWVy\ncm9yIiwNCiAgICAgICAgICAgICAgICAgICAgc2xpY2UsIHVybCwgZXgpLCBl\neC5nZXRDYXVzZSgpKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJzbGljZS1jb25u\nZWN0LWVycm9yIiwgc2xpY2UsIHVybCkpOw0KICAgICAgICB9DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogQ3JlYXRlIGluZGl2aWR1YWwgc2xpY2VzIHdp\ndGggY29uZmlndXJhdGlvbnMgZnJvbSB0aGUgZ2l2ZW4gcHJvcGVydGllcy4N\nCiAgICAgKi8NCiAgICB2b2lkIHNldFNsaWNlcyhNYXAgb3JpZ2luYWwpIHsN\nCiAgICAgICAgTGlzdDxTdHJpbmc+IHNsaWNlTmFtZXMgPSBmaW5kU2xpY2Vz\nKG9yaWdpbmFsKTsNCiAgICAgICAgTG9nIGxvZyA9IGdldENvbmZpZ3VyYXRp\nb25Mb2coKTsNCiAgICAgICAgaWYgKHNsaWNlTmFtZXMuaXNFbXB0eSgpKSB7\nDQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgic2xpY2Utbm9uZS1jb25maWd1cmVkIikpOw0KICAgICAgICB9IA0KICAg\nICAgICBTdHJpbmcgdW5pdCA9IGdldFBlcnNpc3RlbmNlVW5pdE5hbWUob3Jp\nZ2luYWwpOw0KICAgICAgICBmb3IgKFN0cmluZyBrZXkgOiBzbGljZU5hbWVz\nKSB7DQogICAgICAgICAgICBKREJDQ29uZmlndXJhdGlvbiBjaGlsZCA9IG5l\ndyBKREJDQ29uZmlndXJhdGlvbkltcGwoKTsNCiAgICAgICAgICAgIGNoaWxk\nLmZyb21Qcm9wZXJ0aWVzKGNyZWF0ZVNsaWNlUHJvcGVydGllcyhvcmlnaW5h\nbCwga2V5KSk7DQogICAgICAgICAgICBjaGlsZC5zZXRJZCh1bml0K0RPVCtr\nZXkpOw0KICAgICAgICAgICAgU2xpY2Ugc2xpY2UgPSBuZXcgU2xpY2Uoa2V5\nLCBjaGlsZCk7DQogICAgICAgICAgICBfc2xpY2VzLmFkZChzbGljZSk7DQog\nICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpDQogICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJzbGljZS1jb25maWd1cmF0\naW9uIiwga2V5LCBjaGlsZA0KICAgICAgICAgICAgICAgICAgICAgICAgLnRv\nUHJvcGVydGllcyhmYWxzZSkpKTsNCiAgICAgICAgfQ0KICAgICAgICBzZXRN\nYXN0ZXIob3JpZ2luYWwpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZp\nbmRzIHRoZSBzbGljZXMuIElmIDxjb2RlPm9wZW5qcGEuc2xpY2UuTmFtZXM8\nL2NvZGU+IHByb3BlcnR5IGlzIA0KICAgICAqIHNwZWNpZmllZCB0aGVuIHRo\nZSBzbGljZXMgYXJlIG9yZGVyZWQgaW4gdGhlIHdheSB0aGV5IGFyZSBsaXN0\nZWQuIA0KICAgICAqIE90aGVyd2lzZSBzY2FucyBhbGwgYXZhaWxhYmxlIHNs\naWNlcyBieSBsb29raW5nIGZvciBwcm9wZXJ0eSBvZiB0aGUgZm9ybQ0KICAg\nICAqIDxjb2RlPm9wZW5qcGEuc2xpY2UuWFlaLmFiYzwvY29kZT4gd2hlcmUg\nPGNvZGU+WFlaPC9jb2RlPiBpcyB0aGUgc2xpY2UNCiAgICAgKiBpZGVudGlm\naWVyIGFuZCA8Y29kZT5hYmM8L2NvZGU+IGlzIGFueSBvcGVuanBhIHByb3Bl\ncnR5IG5hbWUuIFRoZSBzbGljZXMNCiAgICAgKiBhcmUgdGhlbiBvcmRlcmVk\nIGFscGhhYmV0aWNhbGx5IGJ5IHRoZWlyIGlkZW50aWZpZXIuDQogICAgICov\nDQogICAgcHJpdmF0ZSBMaXN0PFN0cmluZz4gZmluZFNsaWNlcyhNYXAgcCkg\new0KICAgICAgICBMaXN0PFN0cmluZz4gc2xpY2VOYW1lcyA9IG5ldyBBcnJh\neUxpc3Q8U3RyaW5nPigpOw0KICAgICAgICANCiAgICAgICAgTG9nIGxvZyA9\nIGdldENvbmZpZ3VyYXRpb25Mb2coKTsNCiAgICAgICAgU3RyaW5nIGtleSA9\nIFBSRUZJWF9TTElDRSArIG5hbWVzUGx1Z2luLmdldFByb3BlcnR5KCk7DQog\nICAgICAgIGJvb2xlYW4gZXhwbGljaXQgPSBwLmNvbnRhaW5zS2V5KGtleSk7\nDQogICAgICAgIGlmIChleHBsaWNpdCkgew0KICAgICAgICAgICAgU3RyaW5n\nW10gdmFsdWVzID0gcC5nZXQoa2V5KS50b1N0cmluZygpLnNwbGl0KCJcXCwi\nKTsNCiAgICAgICAgICAgIGZvciAoU3RyaW5nIG5hbWU6dmFsdWVzKQ0KICAg\nICAgICAgICAgICAgIGlmICghc2xpY2VOYW1lcy5jb250YWlucyhuYW1lLnRy\naW0oKSkpDQogICAgICAgICAgICAgICAgICAgIHNsaWNlTmFtZXMuYWRkKG5h\nbWUudHJpbSgpKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlm\nIChsb2cuaXNXYXJuRW5hYmxlZCgpKQ0KICAgICAgICAgICAgICAgIGxvZy53\nYXJuKF9sb2MuZ2V0KCJuby1zbGljZS1uYW1lcyIsIGtleSkpOw0KICAgICAg\nICAgICAgc2xpY2VOYW1lcyA9IHNjYW5Gb3JTbGljZU5hbWVzKHApOw0KICAg\nICAgICAgICAgQ29sbGVjdGlvbnMuc29ydChzbGljZU5hbWVzKTsNCiAgICAg\nICAgfQ0KICAgICAgICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkgew0KICAg\nICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInNsaWNlLWF2YWlsYWJsZSIs\nIHNsaWNlTmFtZXMpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2xp\nY2VOYW1lczsNCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogU2NhbiB0\naGUgZ2l2ZW4gbWFwIGZvciBzbGljZS1zcGVjaWZpYyBwcm9wZXJ0eSBvZiB0\naGUgZm9ybSANCiAgICAgKiA8Y29kZT5vcGVuanBhLnNsaWNlLlhZWi5hYmM8\nL2NvZGU+ICh3aGlsZSBpZ25vcmluZyANCiAgICAgKiA8Y29kZT5vcGVuanBh\nLnNsaWNlLlhZWjwvY29kZT4gYXMgdGhleSByZWZlciB0byBzbGljZS13aWRl\nIHByb3BlcnR5KQ0KICAgICAqIHRvIGRldGVybWluZSB0aGUgbmFtZXMgb2Yg\nYWxsIGF2YWlsYWJsZSBzbGljZXMuDQogICAgICovDQogICAgcHJpdmF0ZSBM\naXN0PFN0cmluZz4gc2NhbkZvclNsaWNlTmFtZXMoTWFwIHApIHsNCiAgICAg\nICAgTGlzdDxTdHJpbmc+IHNsaWNlTmFtZXMgPSBuZXcgQXJyYXlMaXN0PFN0\ncmluZz4oKTsNCiAgICAgICAgZm9yIChPYmplY3QgbyA6IHAua2V5U2V0KCkp\nIHsNCiAgICAgICAgICAgIFN0cmluZyBrZXkgPSBvLnRvU3RyaW5nKCk7DQog\nICAgICAgICAgICBpZiAoa2V5LnN0YXJ0c1dpdGgoUFJFRklYX1NMSUNFKSAm\nJiBnZXRQYXJ0Q291bnQoa2V5KSA+IDMpIHsNCiAgICAgICAgICAgICAgICBT\ndHJpbmcgc2xpY2VOYW1lID0NCiAgICAgICAgICAgICAgICAgICAgY2hvcFRh\naWwoY2hvcEhlYWQoby50b1N0cmluZygpLCBQUkVGSVhfU0xJQ0UpLCBET1Qp\nOw0KICAgICAgICAgICAgICAgIGlmICghc2xpY2VOYW1lcy5jb250YWlucyhz\nbGljZU5hbWUpKQ0KICAgICAgICAgICAgICAgICAgICBzbGljZU5hbWVzLmFk\nZChzbGljZU5hbWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAg\nICAgIHJldHVybiBzbGljZU5hbWVzOw0KICAgIH0NCg0KICAgIHByaXZhdGUg\nc3RhdGljIGludCBnZXRQYXJ0Q291bnQoU3RyaW5nIHMpIHsNCiAgICAgICAg\ncmV0dXJuIChzID09IG51bGwpID8gMCA6IHMuc3BsaXQoUkVHRVhfRE9UKS5s\nZW5ndGg7DQogICAgfQ0KICAgIA0KICAgIHByaXZhdGUgc3RhdGljIFN0cmlu\nZyBjaG9wSGVhZChTdHJpbmcgcywgU3RyaW5nIGhlYWQpIHsNCiAgICAgICAg\naWYgKHMuc3RhcnRzV2l0aChoZWFkKSkNCiAgICAgICAgICAgIHJldHVybiBz\nLnN1YnN0cmluZyhoZWFkLmxlbmd0aCgpKTsNCiAgICAgICAgcmV0dXJuIHM7\nDQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGNob3BUYWls\nKFN0cmluZyBzLCBTdHJpbmcgdGFpbCkgew0KICAgICAgICBpbnQgaSA9IHMu\nbGFzdEluZGV4T2YodGFpbCk7DQogICAgICAgIGlmIChpID09IC0xKQ0KICAg\nICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIHJldHVybiBzLnN1YnN0cmlu\nZygwLCBpKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGdp\ndmVuIDxjb2RlPnNsaWNlPC9jb2RlPiBzcGVjaWZpYyBjb25maWd1cmF0aW9u\nIHByb3BlcnRpZXMgZnJvbQ0KICAgICAqIGdpdmVuIDxjb2RlPm9yaWdpbmFs\nPC9jb2RlPiBrZXktdmFsdWUgbWFwLiBUaGUgcnVsZXMgYXJlDQogICAgICog\nPExJPiBpZiBrZXkgYmVnaW5zIHdpdGggPGNvZGU+InNsaWNlLlhYWC4iPC9j\nb2RlPiB3aGVyZQ0KICAgICAqIDxjb2RlPlhYWDwvY29kZT4gaXMgdGhlIGdp\ndmVuIHNsaWNlIG5hbWUsIHRoZW4gcmVwbGFjZQ0KICAgICAqIDxjb2RlPiJz\nbGljZS5YWFguPC9jb2RlPiB3aXRoIDxjb2RlPm9wZW5qcGEuPC9jb2RlPi4N\nCiAgICAgKiA8TEk+aWYga2V5IGJlZ2lucyB3aXRoIDxjb2RlPiJzbGljZS4i\nPC9jb2RlPiBidXQgbm90IHdpdGgNCiAgICAgKiA8Y29kZT4ic2xpY2UuWFhY\nLiI8L2NvZGU+LCB0aGUgaWdub3JlIGkuZS4gYW55IHByb3BlcnR5IG9mIG90\naGVyDQogICAgICogc2xpY2VzIG9yIGdsb2JhbCBzbGljZSBwcm9wZXJ0eSBl\nLmcuDQogICAgICogPGNvZGU+c2xpY2UuRGlzdHJpYnV0aW9uUG9saWN5PC9j\nb2RlPg0KICAgICAqIDxjb2RlPmlmIGtleSBzdGFydHMgd2l0aCA8Y29kZT4i\nb3BlbmpwYS4iPC9jb2RlPiBhbmQgYSBjb3JyZXNwb25kaW5nDQogICAgICog\nPGNvZGU+InNsaWNlLlhYWC4iPC9jb2RlPiBwcm9wZXJ0eSBkb2VzIG5vdCBl\neGlzdCwgdGhlbiB1c2UgdGhpcyBhcw0KICAgICAqIGRlZmF1bHQgcHJvcGVy\ndHkNCiAgICAgKiA8Y29kZT5wcm9wZXJ0eSB3aXRoIGFueSBvdGhlciBwcmVm\naXggaXMgc2ltcGx5IGNvcGllZA0KICAgICAqDQogICAgICovDQogICAgTWFw\nIGNyZWF0ZVNsaWNlUHJvcGVydGllcyhNYXAgb3JpZ2luYWwsIFN0cmluZyBz\nbGljZSkgew0KICAgICAgICBNYXAgcmVzdWx0ID0gbmV3IFByb3BlcnRpZXMo\nKTsNCiAgICAgICAgU3RyaW5nIHByZWZpeCA9IFBSRUZJWF9TTElDRSArIHNs\naWNlICsgRE9UOw0KICAgICAgICBmb3IgKE9iamVjdCBvIDogb3JpZ2luYWwu\na2V5U2V0KCkpIHsNCiAgICAgICAgICAgIFN0cmluZyBrZXkgPSBvLnRvU3Ry\naW5nKCk7DQogICAgICAgICAgICBpZiAoa2V5LnN0YXJ0c1dpdGgocHJlZml4\nKSkgew0KICAgICAgICAgICAgICAgIFN0cmluZyBuZXdLZXkgPSBQUkVGSVhf\nT1BFTkpQQSArIGtleS5zdWJzdHJpbmcocHJlZml4Lmxlbmd0aCgpKTsNCiAg\nICAgICAgICAgICAgICByZXN1bHQucHV0KG5ld0tleSwgb3JpZ2luYWwuZ2V0\nKG8pKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5LnN0YXJ0c1dpdGgo\nUFJFRklYX1NMSUNFKSkgew0KICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBr\nZXlzIHRoYXQgYXJlIGluICdzbGljZS4nIG5hbWVzcGFjZSBidXQgbm90IHRo\naXMgc2xpY2UNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5LnN0YXJ0c1dp\ndGgoUFJFRklYX09QRU5KUEEpKSB7DQogICAgICAgICAgICAgICAgU3RyaW5n\nIG5ld0tleSA9IHByZWZpeCArIGtleS5zdWJzdHJpbmcoUFJFRklYX09QRU5K\nUEEubGVuZ3RoKCkpOw0KICAgICAgICAgICAgICAgIGlmICghb3JpZ2luYWwu\nY29udGFpbnNLZXkobmV3S2V5KSkNCiAgICAgICAgICAgICAgICAgICAgcmVz\ndWx0LnB1dChrZXksIG9yaWdpbmFsLmdldChvKSk7DQogICAgICAgICAgICB9\nIGVsc2UgeyAvLyBrZXlzIHRoYXQgYXJlIG5laXRoZXIgIm9wZW5qcGEiIG5v\nciAic2xpY2UiIG5hbWVzcGFjZQ0KICAgICAgICAgICAgICAgIHJlc3VsdC5w\ndXQoa2V5LCBvcmlnaW5hbC5nZXQobykpOw0KICAgICAgICAgICAgfQ0KICAg\nICAgICB9DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogRGV0ZXJtaW5lIHRoZSBtYXN0ZXIgc2xpY2UuDQogICAg\nICovDQogICAgcHJpdmF0ZSB2b2lkIHNldE1hc3RlcihNYXAgb3JpZ2luYWwp\nIHsNCiAgICAgICAgU3RyaW5nIGtleSA9IFBSRUZJWF9TTElDRSArIG1hc3Rl\nclBsdWdpbi5nZXRQcm9wZXJ0eSgpOw0KICAgICAgICBPYmplY3QgbWFzdGVy\nU2xpY2UgPSBvcmlnaW5hbC5nZXQoa2V5KTsNCiAgICAgICAgTG9nIGxvZyA9\nIGdldENvbmZpZ3VyYXRpb25Mb2coKTsNCiAgICAgICAgTGlzdDxTbGljZT4g\nYWN0aXZlU2xpY2VzID0gZ2V0U2xpY2VzKG51bGwpOw0KICAgICAgICBpZiAo\nbWFzdGVyU2xpY2UgPT0gbnVsbCkgew0KICAgICAgICAgICAgX21hc3RlciA9\nIGFjdGl2ZVNsaWNlcy5nZXQoMCk7DQogICAgICAgICAgICBpZiAobG9nLmlz\nV2FybkVuYWJsZWQoKSkNCiAgICAgICAgICAgICAgICBsb2cud2FybihfbG9j\nLmdldCgibm8tbWFzdGVyLXNsaWNlIiwga2V5LCBfbWFzdGVyKSk7DQogICAg\nICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgZm9yIChTbGlj\nZSBzbGljZTphY3RpdmVTbGljZXMpDQogICAgICAgICAgICBpZiAoc2xpY2Uu\nZ2V0TmFtZSgpLmVxdWFscyhtYXN0ZXJTbGljZSkpDQogICAgICAgICAgICAg\nICAgX21hc3RlciA9IHNsaWNlOw0KICAgICAgICBpZiAoX21hc3RlciA9PSBu\ndWxsKSB7DQogICAgICAgICAgICBfbWFzdGVyID0gYWN0aXZlU2xpY2VzLmdl\ndCgwKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICBwdWJsaWMgU3Ry\naW5nIGdldEV4ZWN1dG9yU2VydmljZSgpIHsNCiAgICAgICAgcmV0dXJuIGV4\nZWN1dG9yU2VydmljZVBsdWdpbi5nZXRTdHJpbmcoKTsNCiAgICB9DQoNCiAg\nICBwdWJsaWMgdm9pZCBzZXRFeGVjdXRvclNlcnZpY2UoRXhlY3V0b3JTZXJ2\naWNlIHR4bk1hbmFnZXIpIHsNCiAgICAgICAgZXhlY3V0b3JTZXJ2aWNlUGx1\nZ2luLnNldCh0eG5NYW5hZ2VyKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgRXhl\nY3V0b3JTZXJ2aWNlIGdldEV4ZWN1dG9yU2VydmljZUluc3RhbmNlKCkgew0K\nICAgICAgICBpZiAoZXhlY3V0b3JTZXJ2aWNlUGx1Z2luLmdldCgpID09IG51\nbGwpIHsNCiAgICAgICAgICAgIGV4ZWN1dG9yU2VydmljZVBsdWdpbi5pbnN0\nYW50aWF0ZShFeGVjdXRvclNlcnZpY2UuY2xhc3MsIHRoaXMpOw0KICAgICAg\nICB9DQogICAgICAgIHJldHVybiAoRXhlY3V0b3JTZXJ2aWNlKSBleGVjdXRv\nclNlcnZpY2VQbHVnaW4uZ2V0KCk7DQogICAgfSAgICANCn0NCg==\n","encoding":"base64"}

