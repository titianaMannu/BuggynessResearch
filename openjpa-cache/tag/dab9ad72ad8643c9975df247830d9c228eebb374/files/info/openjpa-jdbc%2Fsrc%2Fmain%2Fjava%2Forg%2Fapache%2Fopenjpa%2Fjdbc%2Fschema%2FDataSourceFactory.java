{"sha":"560c15dfd6a22a33727dda8f5a7f6b7c62184811","node_id":"MDQ6QmxvYjIwNjM2NDo1NjBjMTVkZmQ2YTIyYTMzNzI3ZGRhOGY1YTdmNmI3YzYyMTg0ODEx","size":11574,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/560c15dfd6a22a33727dda8f5a7f6b7c62184811","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2\nYS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRyaXZlcjsKaW1w\nb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2\nYS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9y\ndCBqYXZheC5zcWwuRGF0YVNvdXJjZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuREJEaWN0aW9uYXJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25zOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkNvbmZpZ3VyaW5n\nQ29ubmVjdGlvbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIuamRiYy5Db25uZWN0aW9uRGVjb3JhdG9yOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlY29yYXRpbmdEYXRhU291cmNlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlbGVnYXRpbmdE\nYXRhU291cmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJj\nLkpEQkNFdmVudENvbm5lY3Rpb25EZWNvcmF0b3I7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmpkYmMuSkRCQ0xpc3RlbmVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkxvZ2dpbmdDb25uZWN0aW9uRGVj\nb3JhdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9n\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2\nSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5P\ncHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhl\nbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdG9y\nZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVz\nZXJFeGNlcHRpb247CgovKioKICogRmFjdG9yeSBmb3Ige0BsaW5rIERhdGFT\nb3VyY2V9IG9iamVjdHMuIFRoZSBmYWN0b3J5IHVzZXMgdGhlIHN1cHBsaWVk\nCiAqIGNvbmZpZ3VyYXRpb24gdG8gb2J0YWluIGEgM3JkLXBhcnR5IGRhdGFz\nb3VyY2Ugb3IgdG8gY3JlYXRlIG9uZSwgYW5kCiAqIHRvIHNldHVwIHByZXBh\ncmVkIHN0YXRlbWVudCBjYWNoaW5nLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0\nZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRGF0YVNvdXJjZUZh\nY3RvcnkgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoRGF0YVNvdXJj\nZUZhY3RvcnkuY2xhc3MpOwoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgZGF0\nYXNvdXJjZSB1c2luZyB0aGUgZ2l2ZW4gY29uZmlndXJhdGlvbi4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBEYXRhU291cmNlIG5ld0RhdGFTb3VyY2Uo\nSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBib29sZWFuIGZhY3Rv\ncnkyKSB7CiAgICAgICAgU3RyaW5nIGRyaXZlciA9IChmYWN0b3J5MikgPyBj\nb25mLmdldENvbm5lY3Rpb24yRHJpdmVyTmFtZSgpCiAgICAgICAgICAgIDog\nY29uZi5nZXRDb25uZWN0aW9uRHJpdmVyTmFtZSgpOwogICAgICAgIGlmIChT\ndHJpbmdVdGlscy5pc0VtcHR5KGRyaXZlcikpCiAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1kcml2ZXIiLCBkcml2\nZXIpKS4KICAgICAgICAgICAgICAgIHNldEZhdGFsKHRydWUpOwoKICAgICAg\nICBDbGFzc0xvYWRlciBsb2FkZXIgPSBjb25mLmdldENsYXNzUmVzb2x2ZXJJ\nbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRDbGFzc0xvYWRlcihEYXRhU291\ncmNlRmFjdG9yeS5jbGFzcywgbnVsbCk7CiAgICAgICAgU3RyaW5nIHByb3Bz\nID0gKGZhY3RvcnkyKSA/IGNvbmYuZ2V0Q29ubmVjdGlvbjJQcm9wZXJ0aWVz\nKCkKICAgICAgICAgICAgOiBjb25mLmdldENvbm5lY3Rpb25Qcm9wZXJ0aWVz\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3MgZHJpdmVyQ2xh\nc3M7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkcml2ZXJD\nbGFzcyA9IENsYXNzLmZvck5hbWUoZHJpdmVyLCB0cnVlLCBsb2FkZXIpOwog\nICAgICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uIGNu\nZmUpIHsKICAgICAgICAgICAgICAgIC8vIHRyeSB3aXRoIHRoZSBjb3JlIGNs\nYXNzIGxvYWRlcgogICAgICAgICAgICAgICAgZHJpdmVyQ2xhc3MgPSBDbGFz\ncy5mb3JOYW1lKGRyaXZlcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChEcml2ZXIuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShkcml2ZXJDbGFz\ncykpIHsKICAgICAgICAgICAgICAgIERyaXZlckRhdGFTb3VyY2UgZHMgPSBj\nb25mLm5ld0RyaXZlckRhdGFTb3VyY2VJbnN0YW5jZSgpOwogICAgICAgICAg\nICAgICAgZHMuc2V0Q2xhc3NMb2FkZXIobG9hZGVyKTsKICAgICAgICAgICAg\nICAgIGRzLnNldENvbm5lY3Rpb25Ecml2ZXJOYW1lKGRyaXZlcik7CiAgICAg\nICAgICAgICAgICBkcy5zZXRDb25uZWN0aW9uUHJvcGVydGllcyhDb25maWd1\ncmF0aW9ucy4KICAgICAgICAgICAgICAgICAgICBwYXJzZVByb3BlcnRpZXMo\ncHJvcHMpKTsKCiAgICAgICAgICAgICAgICBpZiAoIWZhY3RvcnkyKSB7CiAg\nICAgICAgICAgICAgICAgICAgZHMuc2V0Q29ubmVjdGlvbkZhY3RvcnlQcm9w\nZXJ0aWVzKENvbmZpZ3VyYXRpb25zLgogICAgICAgICAgICAgICAgICAgICAg\nICBwYXJzZVByb3BlcnRpZXMoY29uZi5nZXRDb25uZWN0aW9uRmFjdG9yeVBy\nb3BlcnRpZXMoKSkpOwogICAgICAgICAgICAgICAgICAgIGRzLnNldENvbm5l\nY3Rpb25VUkwoY29uZi5nZXRDb25uZWN0aW9uVVJMKCkpOwogICAgICAgICAg\nICAgICAgICAgIGRzLnNldENvbm5lY3Rpb25Vc2VyTmFtZShjb25mLmdldENv\nbm5lY3Rpb25Vc2VyTmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICBkcy5z\nZXRDb25uZWN0aW9uUGFzc3dvcmQoY29uZi5nZXRDb25uZWN0aW9uUGFzc3dv\ncmQoKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgIGRzLnNldENvbm5lY3Rpb25GYWN0b3J5UHJvcGVydGllcwogICAg\nICAgICAgICAgICAgICAgICAgICAoQ29uZmlndXJhdGlvbnMucGFyc2VQcm9w\nZXJ0aWVzKGNvbmYuCiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvbm5l\nY3Rpb25GYWN0b3J5MlByb3BlcnRpZXMoKSkpOwogICAgICAgICAgICAgICAg\nICAgIGRzLnNldENvbm5lY3Rpb25VUkwoY29uZi5nZXRDb25uZWN0aW9uMlVS\nTCgpKTsKICAgICAgICAgICAgICAgICAgICBkcy5zZXRDb25uZWN0aW9uVXNl\nck5hbWUoY29uZi5nZXRDb25uZWN0aW9uMlVzZXJOYW1lKCkpOwogICAgICAg\nICAgICAgICAgICAgIGRzLnNldENvbm5lY3Rpb25QYXNzd29yZChjb25mLmdl\ndENvbm5lY3Rpb24yUGFzc3dvcmQoKSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICByZXR1cm4gZHM7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHNlZSBpZiB0aGVpciBkcml2ZXIgbmFtZSBpcyBhY3R1YWxs\neSBhIGRhdGEgc291cmNlCiAgICAgICAgICAgIGlmIChEYXRhU291cmNlLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20oZHJpdmVyQ2xhc3MpKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gKERhdGFTb3VyY2UpIENvbmZpZ3VyYXRpb25zLm5l\nd0luc3RhbmNlKGRyaXZlciwKICAgICAgICAgICAgICAgICAgICBjb25mLCBw\ncm9wcywgKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBEYXRhU291cmNlLmNsYXNzKSkpOyAKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24o\nZSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBub3Qg\nYSBkcml2ZXIgb3IgYSBkYXRhIHNvdXJjZTsgZGllCiAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1kcml2ZXIiLCBkcml2\nZXIpKS5zZXRGYXRhbCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIElu\nc3RhbGwgbGlzdGVuZXJzIGFuZCBiYXNlIGRlY29yYXRvcnMuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgRGVjb3JhdGluZ0RhdGFTb3VyY2UgZGVjb3Jh\ndGVEYXRhU291cmNlKERhdGFTb3VyY2UgZHMsCiAgICAgICAgSkRCQ0NvbmZp\nZ3VyYXRpb24gY29uZiwgYm9vbGVhbiBmYWN0b3J5MikgewogICAgICAgIE9w\ndGlvbnMgb3B0cyA9IENvbmZpZ3VyYXRpb25zLnBhcnNlUHJvcGVydGllcygo\nZmFjdG9yeTIpCiAgICAgICAgICAgID8gY29uZi5nZXRDb25uZWN0aW9uRmFj\ndG9yeTJQcm9wZXJ0aWVzKCkKICAgICAgICAgICAgOiBjb25mLmdldENvbm5l\nY3Rpb25GYWN0b3J5UHJvcGVydGllcygpKTsKICAgICAgICBMb2cgamRiY0xv\nZyA9IGNvbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsK\nICAgICAgICBMb2cgc3FsTG9nID0gY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3Vy\nYXRpb24uTE9HX1NRTCk7CgogICAgICAgIERlY29yYXRpbmdEYXRhU291cmNl\nIGRkcyA9IG5ldyBEZWNvcmF0aW5nRGF0YVNvdXJjZShkcyk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgLy8gYWRkIHVzZXItZGVmaW5lZCBkZWNvcmF0\nb3JzCiAgICAgICAgICAgIExpc3QgZGVjb3JhdG9ycyA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICAgICAgZGVjb3JhdG9ycy5hZGRBbGwoQXJyYXlzLmFz\nTGlzdChjb25mLgogICAgICAgICAgICAgICAgZ2V0Q29ubmVjdGlvbkRlY29y\nYXRvckluc3RhbmNlcygpKSk7CgogICAgICAgICAgICAvLyBhZGQgamRiYyBl\ndmVudHMgZGVjb3JhdG9yCiAgICAgICAgICAgIEpEQkNFdmVudENvbm5lY3Rp\nb25EZWNvcmF0b3IgZWNkID0KICAgICAgICAgICAgICAgIG5ldyBKREJDRXZl\nbnRDb25uZWN0aW9uRGVjb3JhdG9yKCk7CiAgICAgICAgICAgIENvbmZpZ3Vy\nYXRpb25zLmNvbmZpZ3VyZUluc3RhbmNlKGVjZCwgY29uZiwgb3B0cyk7CiAg\nICAgICAgICAgIEpEQkNMaXN0ZW5lcltdIGxpc3RlbmVycyA9IGNvbmYuZ2V0\nSkRCQ0xpc3RlbmVySW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgZWNkLmFkZExpc3RlbmVyKGxpc3RlbmVyc1tpXSk7CiAgICAgICAg\nICAgIGRlY29yYXRvcnMuYWRkKGVjZCk7CgogICAgICAgICAgICAvLyBhc2sg\ndGhlIERyaXZlckRhdGFTb3VyY2UgdG8gcHJvdmlkZSBhbnkgYWRkaXRpb25h\nbCBkZWNvcmF0b3JzCiAgICAgICAgICAgIGlmIChkcyBpbnN0YW5jZW9mIERy\naXZlckRhdGFTb3VyY2UpIHsKICAgICAgICAgICAgICAgIExpc3QgZGVjcyA9\nICgoRHJpdmVyRGF0YVNvdXJjZSkgZHMpLgogICAgICAgICAgICAgICAgICAg\nIGNyZWF0ZUNvbm5lY3Rpb25EZWNvcmF0b3JzKCk7CiAgICAgICAgICAgICAg\nICBpZiAoZGVjcyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGRlY29y\nYXRvcnMuYWRkQWxsKGRlY3MpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBsb2dnaW5nIGRlY29yYXRvcgogICAgICAgICAgICBMb2dnaW5nQ29u\nbmVjdGlvbkRlY29yYXRvciBsY2QgPSBuZXcgTG9nZ2luZ0Nvbm5lY3Rpb25E\nZWNvcmF0b3IoKTsKICAgICAgICAgICAgQ29uZmlndXJhdGlvbnMuY29uZmln\ndXJlSW5zdGFuY2UobGNkLCBjb25mLCBvcHRzKTsKICAgICAgICAgICAgbGNk\nLmdldExvZ3MoKS5zZXRKREJDTG9nKGpkYmNMb2cpOwogICAgICAgICAgICBs\nY2QuZ2V0TG9ncygpLnNldFNRTExvZyhzcWxMb2cpOwogICAgICAgICAgICBk\nZWNvcmF0b3JzLmFkZChsY2QpOwoKICAgICAgICAgICAgZGRzLmFkZERlY29y\nYXRvcnMoZGVjb3JhdG9ycyk7CiAgICAgICAgICAgIHJldHVybiBkZHM7CiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSkuc2V0\nRmF0YWwodHJ1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nSW5zdGFsbCB0aGluZ3MgZGVmZXJyZWQgdW50aWwgdGhlIERCRGljdGlvbmFy\neSBpbnN0YW5jZSBpcyBhdmFpbGFibGUuCiAgICAgKgogICAgICogQGF1dGhv\nciBTdGV2ZSBLaW0KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBEZWNvcmF0\naW5nRGF0YVNvdXJjZSBpbnN0YWxsREJEaWN0aW9uYXJ5KERCRGljdGlvbmFy\neSBkaWN0LAogICAgICAgIERlY29yYXRpbmdEYXRhU291cmNlIGRzLCBmaW5h\nbCBKREJDQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgIGJvb2xlYW4gZmFj\ndG9yeTIpIHsKICAgICAgICBEYXRhU291cmNlIGlubmVyID0gZHMuZ2V0SW5u\nZXJtb3N0RGVsZWdhdGUoKTsKICAgICAgICBpZiAoaW5uZXIgaW5zdGFuY2Vv\nZiBEcml2ZXJEYXRhU291cmNlKQogICAgICAgICAgICAoKERyaXZlckRhdGFT\nb3VyY2UpIGlubmVyKS5pbml0REJEaWN0aW9uYXJ5KGRpY3QpOwogICAgICAg\nIENvbm5lY3Rpb24gY29ubiA9IG51bGw7CgogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIC8vIGFkZCB0aGUgZGljdGlvbmFyeSBhcyBhIHdhcm5pbmcgaGFu\nZGxlciBvbiB0aGUgbG9nZ2luZwogICAgICAgICAgICAvLyBkZWNvcmF0b3IK\nICAgICAgICAgICAgQ29ubmVjdGlvbkRlY29yYXRvciBjZDsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBkcy5nZXREZWNvcmF0b3JzKCkuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGNk\nID0gKENvbm5lY3Rpb25EZWNvcmF0b3IpIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgICAgICBpZiAoY2QgaW5zdGFuY2VvZiBMb2dnaW5nQ29ubmVjdGlvbkRl\nY29yYXRvcikKICAgICAgICAgICAgICAgICAgICAoKExvZ2dpbmdDb25uZWN0\naW9uRGVjb3JhdG9yKSBjZCkuc2V0V2FybmluZ0hhbmRsZXIoZGljdCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1pc2MgY29uZmlndXJhdGlv\nbiBjb25uZWN0aW9uIGRlY29yYXRvciAoc3RhdGVtZW50IHRpbWVvdXRzLAog\nICAgICAgICAgICAvLyB0cmFuc2FjdGlvbiBpc29sYXRpb24sIGV0YykKICAg\nICAgICAgICAgQ29uZmlndXJpbmdDb25uZWN0aW9uRGVjb3JhdG9yIGNjZCA9\nCiAgICAgICAgICAgICAgICBuZXcgQ29uZmlndXJpbmdDb25uZWN0aW9uRGVj\nb3JhdG9yKCk7CiAgICAgICAgICAgIGNjZC5zZXRUcmFuc2FjdGlvbklzb2xh\ndGlvbihjb25mLmdldFRyYW5zYWN0aW9uSXNvbGF0aW9uQ29uc3RhbnQoKSk7\nCiAgICAgICAgICAgIGlmIChmYWN0b3J5MiB8fCAhY29uZi5pc0Nvbm5lY3Rp\nb25GYWN0b3J5TW9kZU1hbmFnZWQoKSkgewogICAgICAgICAgICAgICAgaWYg\nKCFkaWN0LnN1cHBvcnRzTXVsdGlwbGVOb250cmFuc2FjdGlvbmFsUmVzdWx0\nU2V0cykKICAgICAgICAgICAgICAgICAgICBjY2Quc2V0QXV0b0NvbW1pdChC\nb29sZWFuLkZBTFNFKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICBjY2Quc2V0QXV0b0NvbW1pdChCb29sZWFuLlRSVUUpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIE9wdGlvbnMgb3B0cyA9IENvbmZp\nZ3VyYXRpb25zLnBhcnNlUHJvcGVydGllcygoZmFjdG9yeTIpCiAgICAgICAg\nICAgICAgICA/IGNvbmYuZ2V0Q29ubmVjdGlvbkZhY3RvcnkyUHJvcGVydGll\ncygpCiAgICAgICAgICAgICAgICA6IGNvbmYuZ2V0Q29ubmVjdGlvbkZhY3Rv\ncnlQcm9wZXJ0aWVzKCkpOwogICAgICAgICAgICBDb25maWd1cmF0aW9ucy5j\nb25maWd1cmVJbnN0YW5jZShjY2QsIGNvbmYsIG9wdHMpOwogICAgICAgICAg\nICBkcy5hZGREZWNvcmF0b3IoY2NkKTsKCiAgICAgICAgICAgIC8vIGFsbG93\nIHRoZSBkYmRpY3Rpb25hcnkgdG8gZGVjb3JhdGUgdGhlIGNvbm5lY3Rpb24g\nZnVydGhlcgogICAgICAgICAgICBkcy5hZGREZWNvcmF0b3IoZGljdCk7CiAg\nICAgICAgICAgIAogICAgICAgICAgICAvLyBlbnN1cmUgZGJkaWN0aW9uYXJ5\nIHRvIHByb2Nlc3MgY29ubmVjdGVkQ29uZmlndXJhdGlvbigpCiAgICAgICAg\nICAgIGlmICghZmFjdG9yeTIpCiAgICAgICAgICAgICAgICBjb25uID0gZHMu\nZ2V0Q29ubmVjdGlvbihjb25mLmdldENvbm5lY3Rpb25Vc2VyTmFtZSgpLCBj\nb25mCiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb25uZWN0aW9uUGFz\nc3dvcmQoKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNv\nbm4gPSBkcy5nZXRDb25uZWN0aW9uKGNvbmYuZ2V0Q29ubmVjdGlvbjJVc2Vy\nTmFtZSgpLCBjb25mCiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb25u\nZWN0aW9uMlBhc3N3b3JkKCkpOwoKICAgICAgICAgICAgcmV0dXJuIGRzOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKS5zZXRGYXRhbCh0cnVlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoY29ubiAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBj\nb25uLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgYW55\nIGV4Y2VwdGlvbiBzaW5jZSB0aGUgY29ubmVjdGlvbiBpcyBub3QgZ29pbmcK\nICAgICAgICAgICAgICAgICAgICAvLyB0byBiZSB1c2VkIGFueXdheQogICAg\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBhIGRhdGEgc291cmNlIHdpdGggdGhlIGdpdmVuIHVzZXIgbmFt\nZSBhbmQgcGFzc3dvcmQKICAgICAqIHByZS1jb25maWd1cmVkIGFzIHRoZSBk\nZWZhdWx0cyB3aGVuIHtAbGluayBEYXRhU291cmNlI2dldENvbm5lY3Rpb259\nCiAgICAgKiBpcyBjYWxsZWQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nRGF0YVNvdXJjZSBkZWZhdWx0c0RhdGFTb3VyY2UoRGF0YVNvdXJjZSBkcywK\nICAgICAgICBTdHJpbmcgdXNlciwgU3RyaW5nIHBhc3MpIHsKICAgICAgICBp\nZiAodXNlciA9PSBudWxsICYmIHBhc3MgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGRzOwogICAgICAgIC8vIGFsc28gY2hlY2sgaWYgdGhleSBhcmUg\nYm90aCBibGFuayBzdHJpbmdzCiAgICAgICAgaWYgKCIiLmVxdWFscyh1c2Vy\nKSAmJiAiIi5lcXVhbHMocGFzcykpCiAgICAgICAgICAgIHJldHVybiBkczsK\nICAgICAgICByZXR1cm4gbmV3IERlZmF1bHRzRGF0YVNvdXJjZShkcywgdXNl\nciwgcGFzcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbG9zZSB0aGUgZ2l2\nZW4gZGF0YSBzb3VyY2UuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9p\nZCBjbG9zZURhdGFTb3VyY2UoRGF0YVNvdXJjZSBkcykgewogICAgICAgIGlm\nIChkcyBpbnN0YW5jZW9mIERlbGVnYXRpbmdEYXRhU291cmNlKQogICAgICAg\nICAgICBkcyA9ICgoRGVsZWdhdGluZ0RhdGFTb3VyY2UpIGRzKS5nZXRJbm5l\ncm1vc3REZWxlZ2F0ZSgpOwogICAgICAgIEltcGxIZWxwZXIuY2xvc2UoZHMp\nOwogICAgfQoKICAgIC8qKgogICAgICogQSBkYXRhIHNvdXJjZSB3aXRoIHBy\nZS1jb25maWd1cmVkIGRlZmF1bHQgdXNlciBuYW1lIGFuZCBwYXNzd29yZC4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgRGVmYXVsdHNEYXRh\nU291cmNlCiAgICAgICAgZXh0ZW5kcyBEZWxlZ2F0aW5nRGF0YVNvdXJjZSB7\nCgogICAgICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIF91c2VyOwogICAgICAg\nIHByaXZhdGUgZmluYWwgU3RyaW5nIF9wYXNzOwoKICAgICAgICBwdWJsaWMg\nRGVmYXVsdHNEYXRhU291cmNlKERhdGFTb3VyY2UgZHMsIFN0cmluZyB1c2Vy\nLCBTdHJpbmcgcGFzcykgewogICAgICAgICAgICBzdXBlcihkcyk7CiAgICAg\nICAgICAgIF91c2VyID0gdXNlcjsKICAgICAgICAgICAgX3Bhc3MgPSBwYXNz\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIENvbm5lY3Rpb24gZ2V0Q29u\nbmVjdGlvbigpCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0Q29ubmVjdGlvbihfdXNlciwg\nX3Bhc3MpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIENvbm5lY3Rpb24g\nZ2V0Q29ubmVjdGlvbihTdHJpbmcgdXNlciwgU3RyaW5nIHBhc3MpCiAgICAg\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1\ncm4gc3VwZXIuZ2V0Q29ubmVjdGlvbih1c2VyLCBwYXNzKTsKICAgICAgICB9\nCiAgICB9Cn0K\n","encoding":"base64"}

