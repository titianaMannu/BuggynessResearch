{"sha":"1e4b188be7bf8468d823c0d37e8d7ab0d64bfbf4","node_id":"MDQ6QmxvYjIwNjM2NDoxZTRiMTg4YmU3YmY4NDY4ZDgyM2MwZDM3ZThkN2FiMGQ2NGJmYmY0","size":33281,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1e4b188be7bf8468d823c0d37e8d7ab0d64bfbf4","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFi\nYXNlTWV0YURhdGE7CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuRXZlbnRPYmplY3Q7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1h\ncDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGls\nLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YXguc3FsLkRhdGFTb3VyY2U7\nCgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25m\naWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\nbG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5M\nb2NhbGl6ZXI7CgovKioKICogVGhlIFNjaGVtYUdlbmVyYXRvciBjcmVhdGVz\nIHtAbGluayBTY2hlbWF9cyBtYXRjaGluZyB0aGUgY3VycmVudAogKiBkYXRh\nYmFzZS4gQWxsIHNjaGVtYXMgYXJlIGFkZGVkIHRvIHRoZSBjdXJyZW50IHtA\nbGluayBTY2hlbWFHcm91cH0uCiAqICBOb3RlIHRoYXQgdGFibGVzIHdob3Nl\nIG5hbWUgc3RhcnRzIHdpdGggIk9QRU5KUEFfIiB3aWxsIGJlIG5vdCBiZSBh\nZGRlZAogKiB0byB0aGUgZGF0YWJhc2Ugc2NoZW1hLiBUaGlzIGVuYWJsZXMg\ndGhlIGNyZWF0aW9uIG9mIHNwZWNpYWwgdGFibGVzCiAqIHRoYXQgd2lsbCBu\nZXZlciBiZSBkcm9wcGVkIGJ5IHRoZSB7QGxpbmsgU2NoZW1hVG9vbH0uCiAq\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgU2NoZW1h\nR2VuZXJhdG9yIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6\nZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFNjaGVt\nYUdlbmVyYXRvci5jbGFzcyk7CgogICAgcHJpdmF0ZSBmaW5hbCBEYXRhU291\ncmNlIF9kczsKICAgIHByaXZhdGUgZmluYWwgREJEaWN0aW9uYXJ5IF9kaWN0\nOwogICAgcHJpdmF0ZSBmaW5hbCBMb2cgX2xvZzsKICAgIHByaXZhdGUgZmlu\nYWwgT2JqZWN0W11bXSBfYWxsb3dlZDsKICAgIHByaXZhdGUgYm9vbGVhbiBf\naW5kZXhlcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ZrcyA9IHRy\ndWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX3BrcyA9IHRydWU7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX3NlcXMgPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFu\nIF9vcGVuanBhVGFibGVzID0gdHJ1ZTsKICAgIHByaXZhdGUgU2NoZW1hR3Jv\ndXAgX2dyb3VwID0gbnVsbDsKCiAgICBwcml2YXRlIExpc3QgX2xpc3RlbmVy\ncyA9IG51bGw7CiAgICBwcml2YXRlIGludCBfc2NoZW1hT2JqZWN0cyA9IDA7\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAqCiAgICAgKiBA\ncGFyYW0gY29uZiBjb25maWd1cmF0aW9uIGZvciBjb25uZWN0aW5nIHRvIHRo\nZSBkYXRhIHN0b3JlCiAgICAgKi8KICAgIHB1YmxpYyBTY2hlbWFHZW5lcmF0\nb3IoSkRCQ0NvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIC8vIG5vdGU6\nIHdlIGNhbm5vdCBhc3NlcnQgZGV2ZWxvcGVyIGNhcGFiaWxpdGllcyBpbiB0\naGlzIHRvb2wgbGlrZQogICAgICAgIC8vIHdlIG5vcm1hbGx5IGRvIGJlY2F1\nc2UgdGhpcyBjbGFzcyBpcyBhbHNvIHVzZWQgYXQgcnVudGltZQoKICAgICAg\nICBfZHMgPSBjb25mLmdldERhdGFTb3VyY2UyKG51bGwpOwogICAgICAgIF9s\nb2cgPSBjb25mLmdldExvZyhKREJDQ29uZmlndXJhdGlvbi5MT0dfU0NIRU1B\nKTsKCiAgICAgICAgLy8gY2FjaGUgdGhpcyBub3cgc28gdGhhdCBpZiB0aGUg\nY29ubiBwb29sIG9ubHkgaGFzIDEgY29ubmVjdGlvbiB3ZQogICAgICAgIC8v\nIGRvbid0IGNvbmZsaWN0IGxhdGVyIHdpdGggdGhlIG9wZW4gZGF0YWJhc2Vt\nZXRhZGF0YSBjb25uZWN0aW9uCiAgICAgICAgX2RpY3QgPSBjb25mLmdldERC\nRGljdGlvbmFyeUluc3RhbmNlKCk7CgogICAgICAgIC8vIGNyZWF0ZSBhIHRh\nYmxlIG9mIGFsbG93ZWQgc2NoZW1hIGFuZCB0YWJsZXMgdG8gcmVmbGVjdCBv\nbgogICAgICAgIF9hbGxvd2VkID0gcGFyc2VTY2hlbWFzTGlzdChjb25mLmdl\ndFNjaGVtYXNMaXN0KCkpOwogICAgfQoKICAgIC8qKgogICAgICogR2l2ZW4g\nYSBsaXN0IG9mIHNjaGVtYSBuYW1lcyBhbmQgdGFibGUgbmFtZXMgKHdoZXJl\nIHRhYmxlIG5hbWVzCiAgICAgKiBhcmUgYWx3YXlzIG9mIHRoZSBmb3JtIHNj\naGVtYS50YWJsZSwgb3IganVzdCAudGFibGUgaWYgdGhlIHNjaGVtYSBpcwog\nICAgICogdW5rbm93biksIGNyZWF0ZXMgYSB0YWJsZSBtYXBwaW5nIHNjaGVt\nYSBuYW1lIHRvIHRhYmxlIGxpc3QuIFJldHVybnMKICAgICAqIG51bGwgaWYg\nbm8gYXJncyBhcmUgZ2l2ZW4uIElmIG5vIHRhYmxlcyBhcmUgZ2l2ZW4gZm9y\nIGEgcGFydGljdWxhcgogICAgICogc2NoZW1hLCBtYXBzIHRoZSBzY2hlbWEg\nbmFtZSB0byBudWxsLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmpl\nY3RbXVtdIHBhcnNlU2NoZW1hc0xpc3QoU3RyaW5nW10gYXJncykgewogICAg\nICAgIGlmIChhcmdzID09IG51bGwgfHwgYXJncy5sZW5ndGggPT0gMCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIE1hcCBzY2hlbWFzID0g\nbmV3IEhhc2hNYXAoKTsKICAgICAgICBTdHJpbmcgc2NoZW1hLCB0YWJsZTsK\nICAgICAgICBpbnQgZG90SWR4OwogICAgICAgIENvbGxlY3Rpb24gdGFibGVz\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBkb3RJZHggPSBhcmdzW2ldLmluZGV4T2YoJy4n\nKTsKICAgICAgICAgICAgaWYgKGRvdElkeCA9PSAtMSkgewogICAgICAgICAg\nICAgICAgc2NoZW1hID0gYXJnc1tpXTsKICAgICAgICAgICAgICAgIHRhYmxl\nID0gbnVsbDsKICAgICAgICAgICAgfSBlbHNlIGlmIChkb3RJZHggPT0gMCkg\newogICAgICAgICAgICAgICAgc2NoZW1hID0gbnVsbDsKICAgICAgICAgICAg\nICAgIHRhYmxlID0gYXJnc1tpXS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzY2hlbWEgPSBhcmdzW2ldLnN1\nYnN0cmluZygwLCBkb3RJZHgpOwogICAgICAgICAgICAgICAgdGFibGUgPSBh\ncmdzW2ldLnN1YnN0cmluZyhkb3RJZHggKyAxKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gaWYganVzdCBhIHNjaGVtYSBuYW1lLCBtYXAgc2No\nZW1hIHRvIG51bGwKICAgICAgICAgICAgaWYgKHRhYmxlID09IG51bGwgJiYg\nIXNjaGVtYXMuY29udGFpbnNLZXkoc2NoZW1hKSkKICAgICAgICAgICAgICAg\nIHNjaGVtYXMucHV0KHNjaGVtYSwgbnVsbCk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKHRhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHRhYmxlcyA9\nIChDb2xsZWN0aW9uKSBzY2hlbWFzLmdldChzY2hlbWEpOwogICAgICAgICAg\nICAgICAgaWYgKHRhYmxlcyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgdGFibGVzID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICAgICAgICAg\nICAgICBzY2hlbWFzLnB1dChzY2hlbWEsIHRhYmxlcyk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB0YWJsZXMuYWRkKHRhYmxlKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgT2JqZWN0W11bXSBwYXJz\nZWQgPSBuZXcgT2JqZWN0W3NjaGVtYXMuc2l6ZSgpXVsyXTsKICAgICAgICBN\nYXAuRW50cnkgZW50cnk7CiAgICAgICAgaW50IGlkeCA9IDA7CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBzY2hlbWFzLmVudHJ5U2V0KCkuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZW50cnkgPSAo\nTWFwLkVudHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAgICB0YWJsZXMgPSAo\nQ29sbGVjdGlvbikgZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAgIHBh\ncnNlZFtpZHhdWzBdID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgIGlm\nICh0YWJsZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHBhcnNlZFtpZHhd\nWzFdID0gdGFibGVzLnRvQXJyYXkobmV3IFN0cmluZ1t0YWJsZXMuc2l6ZSgp\nXSk7CiAgICAgICAgICAgIGlkeCsrOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gcGFyc2VkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRo\nZXIgaW5kZXhlcyBzaG91bGQgYmUgZ2VuZXJhdGVkLiBEZWZhdWx0cyB0byB0\ncnVlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRJbmRleGVzKCkg\newogICAgICAgIHJldHVybiBfaW5kZXhlczsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB3aGV0aGVyIGluZGV4ZXMgc2hvdWxkIGJlIGdlbmVyYXRlZC4g\nRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nSW5kZXhlcyhib29sZWFuIGluZGV4ZXMpIHsKICAgICAgICBfaW5kZXhlcyA9\nIGluZGV4ZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhl\nciBmb3JlaWduIGtleXMgc2hvdWxkIGJlIGdlbmVyYXRlZC4gRGVmYXVsdHMg\ndG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0Rm9yZWln\nbktleXMoKSB7CiAgICAgICAgcmV0dXJuIF9ma3M7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgd2hldGhlciBmb3JlaWduIGtleXMgc2hvdWxkIGJlIGdl\nbmVyYXRlZC4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0Rm9yZWlnbktleXMoYm9vbGVhbiBma3MpIHsKICAgICAgICBf\nZmtzID0gZmtzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRo\nZXIgcHJpbWFyeSBrZXlzIHNob3VsZCBiZSBnZW5lcmF0ZWQuIERlZmF1bHRz\nIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFByaW1h\ncnlLZXlzKCkgewogICAgICAgIHJldHVybiBfcGtzOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHdoZXRoZXIgcHJpbWFyeSBrZXlzIHNob3VsZCBiZSBn\nZW5lcmF0ZWQuIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFByaW1hcnlLZXlzKGJvb2xlYW4gcGtzKSB7CiAgICAgICAg\nX3BrcyA9IHBrczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0\naGVyIHNlcXVlbmNlcyBzaG91bGQgYmUgZ2VuZXJhdGVkLiBEZWZhdWx0cyB0\nbyB0cnVlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRTZXF1ZW5j\nZXMoKSB7CiAgICAgICAgcmV0dXJuIF9zZXFzOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0IHdoZXRoZXIgc2VxdWVuY2VzIHNob3VsZCBiZSBnZW5lcmF0\nZWQuIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFNlcXVlbmNlcyhib29sZWFuIHNlcXMpIHsKICAgICAgICBfc2VxcyA9\nIHNlcXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGdlbmVy\nYXRlIGluZm8gb24gc3BlY2lhbCB0YWJsZXMgdXNlZCBieSBPcGVuSlBBIGNv\nbXBvbmVudHMKICAgICAqIGZvciBib29ra2VlcGluZy4gRGVmYXVsdHMgdG8g\ndHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0T3BlbkpQQVRh\nYmxlcygpIHsKICAgICAgICByZXR1cm4gX29wZW5qcGFUYWJsZXM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIGluZm8gb24g\nc3BlY2lhbCB0YWJsZXMgdXNlZCBieSBPcGVuSlBBIGNvbXBvbmVudHMKICAg\nICAqIGZvciBib29ra2VlcGluZy4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0T3BlbkpQQVRhYmxlcyhib29sZWFuIG9w\nZW5qcGFUYWJsZXMpIHsKICAgICAgICBfb3BlbmpwYVRhYmxlcyA9IG9wZW5q\ncGFUYWJsZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGN1\ncnJlbnQgc2NoZW1hIGdyb3VwLgogICAgICovCiAgICBwdWJsaWMgU2NoZW1h\nR3JvdXAgZ2V0U2NoZW1hR3JvdXAoKSB7CiAgICAgICAgaWYgKF9ncm91cCA9\nPSBudWxsKQogICAgICAgICAgICBfZ3JvdXAgPSBuZXcgU2NoZW1hR3JvdXAo\nKTsKICAgICAgICByZXR1cm4gX2dyb3VwOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBzY2hlbWEgZ3JvdXAgdG8gYWRkIGdlbmVyYXRlZCBzY2hl\nbWFzIHRvLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTY2hlbWFHcm91\ncChTY2hlbWFHcm91cCBncm91cCkgewogICAgICAgIF9ncm91cCA9IGdyb3Vw\nOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgYWxsIHNjaGVtYXMg\nc2V0IGluIHRoZSBjb25maWd1cmF0aW9uLiBUaGlzIG1ldGhvZCBhbHNvCiAg\nICAgKiBjYWxscyB7QGxpbmsgI2dlbmVyYXRlSW5kZXhlc30sIHtAbGluayAj\nZ2VuZXJhdGVQcmltYXJ5S2V5c30sIGFuZAogICAgICoge0BsaW5rICNnZW5l\ncmF0ZUZvcmVpZ25LZXlzfSBhdXRvbWF0aWNhbGx5LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBnZW5lcmF0ZVNjaGVtYXMoKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGZpcmVHZW5lcmF0aW9uRXZlbnQoX2xv\nYy5nZXQoImdlbmVyYXRpbmctc2NoZW1hcyIpKTsKICAgICAgICBnZW5lcmF0\nZVNjaGVtYXMobnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0\nZSB0aGUgc2NoZW1hcyBhbmQvb3IgdGFibGVzIG5hbWVkIGluIHRoZSBnaXZl\nbiBzdHJpbmdzLgogICAgICogVGhpcyBtZXRob2QgY2FsbHMge0BsaW5rICNn\nZW5lcmF0ZUluZGV4ZXN9LAogICAgICoge0BsaW5rICNnZW5lcmF0ZVByaW1h\ncnlLZXlzfSwgYW5kIHtAbGluayAjZ2VuZXJhdGVGb3JlaWduS2V5c30KICAg\nICAqIGF1dG9tYXRpY2FsbHkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGdl\nbmVyYXRlU2NoZW1hcyhTdHJpbmdbXSBzY2hlbWFzQW5kVGFibGVzKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGZpcmVHZW5lcmF0\naW9uRXZlbnQoX2xvYy5nZXQoImdlbmVyYXRpbmctc2NoZW1hcyIpKTsKCiAg\nICAgICAgT2JqZWN0W11bXSBzY2hlbWFNYXA7CiAgICAgICAgaWYgKHNjaGVt\nYXNBbmRUYWJsZXMgPT0gbnVsbCB8fCBzY2hlbWFzQW5kVGFibGVzLmxlbmd0\naCA9PSAwKQogICAgICAgICAgICBzY2hlbWFNYXAgPSBfYWxsb3dlZDsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHNjaGVtYU1hcCA9IHBhcnNlU2NoZW1h\nc0xpc3Qoc2NoZW1hc0FuZFRhYmxlcyk7CgogICAgICAgIGlmIChzY2hlbWFN\nYXAgPT0gbnVsbCkgewogICAgICAgICAgICBnZW5lcmF0ZVNjaGVtYShudWxs\nLCBudWxsKTsKCiAgICAgICAgICAgIC8vIGVzdGltYXRlIHRoZSBudW1iZXIg\nb2Ygc2NoZW1hIG9iamVjdHMgd2Ugd2lsbCBuZWVkIHRvIHZpc2l0CiAgICAg\nICAgICAgIC8vIGluIG9yZGVyIHRvIGVzdGltYXRlIHByb2dyZXNzcyB0b3Rh\nbCBmb3IgYW55IGxpc3RlbmVycwogICAgICAgICAgICBpbnQgbnVtVGFibGVz\nID0gZ2V0VGFibGVzKG51bGwpLnNpemUoKTsKICAgICAgICAgICAgX3NjaGVt\nYU9iamVjdHMgKz0gbnVtVGFibGVzCiAgICAgICAgICAgICAgICArIChfcGtz\nID8gbnVtVGFibGVzIDogMCkKICAgICAgICAgICAgICAgICsgKF9pbmRleGVz\nID8gbnVtVGFibGVzIDogMCkKICAgICAgICAgICAgICAgICsgKF9ma3MgPyBu\ndW1UYWJsZXMgOiAwKTsKCiAgICAgICAgICAgIGlmIChfcGtzKQogICAgICAg\nICAgICAgICAgZ2VuZXJhdGVQcmltYXJ5S2V5cyhudWxsLCBudWxsKTsKICAg\nICAgICAgICAgaWYgKF9pbmRleGVzKQogICAgICAgICAgICAgICAgZ2VuZXJh\ndGVJbmRleGVzKG51bGwsIG51bGwpOwogICAgICAgICAgICBpZiAoX2ZrcykK\nICAgICAgICAgICAgICAgIGdlbmVyYXRlRm9yZWlnbktleXMobnVsbCwgbnVs\nbCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8v\nIGdlbmVyYXRlIGFsbCBzY2hlbWFzIGFuZCB0YWJsZXMKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHNjaGVtYU1hcC5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgZ2VuZXJhdGVTY2hlbWEoKFN0cmluZykgc2NoZW1hTWFwW2ldWzBd\nLAogICAgICAgICAgICAgICAgKFN0cmluZ1tdKSBzY2hlbWFNYXBbaV1bMV0p\nOwoKICAgICAgICAvLyBnZW5lcmF0ZSBwa3MsIGluZGV4ZXMsIGZrcwogICAg\nICAgIFN0cmluZyBzY2hlbWFOYW1lOwogICAgICAgIFN0cmluZ1tdIHRhYmxl\nTmFtZXM7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFNYXAu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IChTdHJp\nbmcpIHNjaGVtYU1hcFtpXVswXTsKICAgICAgICAgICAgdGFibGVOYW1lcyA9\nIChTdHJpbmdbXSkgc2NoZW1hTWFwW2ldWzFdOwoKICAgICAgICAgICAgLy8g\nZXN0aW1hdGUgdGhlIG51bWJlciBvZiBzY2hlbWEgb2JqZWN0cyB3ZSB3aWxs\nIG5lZWQgdG8gdmlzaXQKICAgICAgICAgICAgLy8gaW4gb3JkZXIgdG8gZXN0\naW1hdGUgcHJvZ3Jlc3NzIHRvdGFsIGZvciBhbnkgbGlzdGVuZXJzCiAgICAg\nICAgICAgIGludCBudW1UYWJsZXMgPSAodGFibGVOYW1lcyAhPSBudWxsKSA/\nIHRhYmxlTmFtZXMubGVuZ3RoCiAgICAgICAgICAgICAgICA6IGdldFRhYmxl\ncyhzY2hlbWFOYW1lKS5zaXplKCk7CiAgICAgICAgICAgIF9zY2hlbWFPYmpl\nY3RzICs9IG51bVRhYmxlcwogICAgICAgICAgICAgICAgKyAoX3BrcyA/IG51\nbVRhYmxlcyA6IDApCiAgICAgICAgICAgICAgICArIChfaW5kZXhlcyA/IG51\nbVRhYmxlcyA6IDApCiAgICAgICAgICAgICAgICArIChfZmtzID8gbnVtVGFi\nbGVzIDogMCk7CgogICAgICAgICAgICBpZiAoX3BrcykKICAgICAgICAgICAg\nICAgIGdlbmVyYXRlUHJpbWFyeUtleXMoc2NoZW1hTmFtZSwgdGFibGVOYW1l\ncyk7CiAgICAgICAgICAgIGlmIChfaW5kZXhlcykKICAgICAgICAgICAgICAg\nIGdlbmVyYXRlSW5kZXhlcyhzY2hlbWFOYW1lLCB0YWJsZU5hbWVzKTsKICAg\nICAgICAgICAgaWYgKF9ma3MpCiAgICAgICAgICAgICAgICBnZW5lcmF0ZUZv\ncmVpZ25LZXlzKHNjaGVtYU5hbWUsIHRhYmxlTmFtZXMpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIGZ1bGx5LWNvbnN0cnVjdGVk\nIHtAbGluayBTY2hlbWF9IG1hdGNoaW5nIHRoZSBnaXZlbiBkYXRhYmFzZQog\nICAgICogc2NoZW1hIHRvIHRoZSBjdXJyZW50IGdyb3VwLiBObyBmb3JlaWdu\nIGtleXMgYXJlIGdlbmVyYXRlZCBiZWNhdXNlCiAgICAgKiBzb21lIGtleXMg\nbWlnaHQgc3BhbiBzY2hlbWFzLiBZb3UgbXVzdCBjYWxsCiAgICAgKiB7QGxp\nbmsgI2dlbmVyYXRlUHJpbWFyeUtleXN9LCB7QGxpbmsgI2dlbmVyYXRlSW5k\nZXhlc30sIGFuZAogICAgICoge0BsaW5rICNnZW5lcmF0ZUZvcmVpZ25LZXlz\nfSBzZXBhcmF0ZWx5LgogICAgICoKICAgICAqIEBwYXJhbSBuYW1lIHRoZSBk\nYXRhYmFzZSBuYW1lIG9mIHRoZSBzY2hlbWEsIG9yIG51bGwgZm9yIGFsbCBz\nY2hlbWFzCiAgICAgKiBAcGFyYW0gdGFibGVOYW1lcyBhIGxpc3Qgb2YgdGFi\nbGVzIHRvIGdlbmVyYXRlIGluIHRoZSBzY2hlbWEsIG9yIG51bGwKICAgICAq\nIHRvIGdlbmVyYXRlIGFsbCB0YWJsZXMKICAgICAqLwogICAgcHVibGljIHZv\naWQgZ2VuZXJhdGVTY2hlbWEoU3RyaW5nIG5hbWUsIFN0cmluZ1tdIHRhYmxl\nTmFtZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nZmlyZUdlbmVyYXRpb25FdmVudChfbG9jLmdldCgiZ2VuZXJhdGluZy1zY2hl\nbWEiLCBuYW1lKSk7CgogICAgICAgIC8vIGdlbmVyYXRlIHRhYmxlcywgaW5j\nbHVkaW5nIGNvbHVtbnMgYW5kIHByaW1hcnkga2V5cwogICAgICAgIENvbm5l\nY3Rpb24gY29ubiA9IF9kcy5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgRGF0\nYWJhc2VNZXRhRGF0YSBtZXRhID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh0YWJsZU5hbWVzID09IG51bGwp\nCiAgICAgICAgICAgICAgICBnZW5lcmF0ZVRhYmxlcyhuYW1lLCBudWxsLCBj\nb25uLCBtZXRhKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCB0YWJsZU5hbWVzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlVGFibGVzKG5hbWUsIHRhYmxl\nTmFtZXNbaV0sIGNvbm4sIG1ldGEpOwoKICAgICAgICAgICAgaWYgKF9zZXFz\nKQogICAgICAgICAgICAgICAgZ2VuZXJhdGVTZXF1ZW5jZXMobmFtZSwgbnVs\nbCwgY29ubiwgbWV0YSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgLy8gc29tZSBkYXRhYmFzZXMgcmVxdWlyZSBhIGNvbW1pdCBhZnRlciBt\nZXRhZGF0YSB0byByZWxlYXNlIGxvY2tzCiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBjb25uLmNvbW1pdCgpOwogICAgICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgfQogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgY29ubi5jbG9zZSgpOwogICAg\nICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRl\nIHByaW1hcnkga2V5IGluZm9ybWF0aW9uIGZvciB0aGUgZ2l2ZW4gc2NoZW1h\nLiBUaGlzIG1ldGhvZAogICAgICogbXVzdCBiZSBjYWxsZWQgaW4gYWRkaXRp\nb24gdG8ge0BsaW5rICNnZW5lcmF0ZVNjaGVtYX0uIEl0IHNob3VsZAogICAg\nICogb25seSBiZSBjYWxsZWQgYWZ0ZXIgYWxsIHNjaGVtYXMgYXJlIGdlbmVy\nYXRlZC4gVGhlIHNjaGVtYSBuYW1lIGFuZAogICAgICogdGFibGVzIGFycmF5\nIGNhbiBiZSBudWxsIHRvIGluZGljYXRlIHRoYXQgaW5kZXhlcyBzaG91bGQg\nYmUgZ2VuZXJhdGVkCiAgICAgKiBmb3IgYWxsIHNjaGVtYXMgYW5kL29yIHRh\nYmxlcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgZ2VuZXJhdGVQcmltYXJ5\nS2V5cyhTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nW10gdGFibGVOYW1lcykK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBmaXJlR2Vu\nZXJhdGlvbkV2ZW50KF9sb2MuZ2V0KCJnZW5lcmF0aW5nLWFsbC1wcmltYXJp\nZXMiLCBzY2hlbWFOYW1lKSk7CgogICAgICAgIENvbm5lY3Rpb24gY29ubiA9\nIF9kcy5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgRGF0YWJhc2VNZXRhRGF0\nYSBtZXRhID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmICh0YWJsZU5hbWVzID09IG51bGwpCiAgICAgICAgICAg\nICAgICBnZW5lcmF0ZVByaW1hcnlLZXlzKHNjaGVtYU5hbWUsIG51bGwsIGNv\nbm4sIG1ldGEpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHRhYmxlTmFtZXMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVQcmltYXJ5S2V5cyhzY2hlbWFO\nYW1lLCB0YWJsZU5hbWVzW2ldLCBjb25uLCBtZXRhKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAvLyBzb21lIGRhdGFiYXNlcyByZXF1aXJl\nIGEgY29tbWl0IGFmdGVyIG1ldGFkYXRhIHRvIHJlbGVhc2UgbG9ja3MKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbm4uY29tbWl0KCk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBj\nb25uLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogR2VuZXJhdGUgaW5kZXggaW5mb3JtYXRpb24gZm9yIHRoZSBn\naXZlbiBzY2hlbWEuIFRoaXMgbWV0aG9kCiAgICAgKiBtdXN0IGJlIGNhbGxl\nZCBpbiBhZGRpdGlvbiB0byB7QGxpbmsgI2dlbmVyYXRlU2NoZW1hfS4gSXQg\nc2hvdWxkCiAgICAgKiBvbmx5IGJlIGNhbGxlZCBhZnRlciBhbGwgc2NoZW1h\ncyBhcmUgZ2VuZXJhdGVkLiBUaGUgc2NoZW1hIG5hbWUgYW5kCiAgICAgKiB0\nYWJsZXMgYXJyYXkgY2FuIGJlIG51bGwgdG8gaW5kaWNhdGUgdGhhdCBpbmRl\neGVzIHNob3VsZCBiZSBnZW5lcmF0ZWQKICAgICAqIGZvciBhbGwgc2NoZW1h\ncyBhbmQvb3IgdGFibGVzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBnZW5l\ncmF0ZUluZGV4ZXMoU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZ1tdIHRhYmxl\nTmFtZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nZmlyZUdlbmVyYXRpb25FdmVudChfbG9jLmdldCgiZ2VuZXJhdGluZy1hbGwt\naW5kZXhlcyIsIHNjaGVtYU5hbWUpKTsKCiAgICAgICAgQ29ubmVjdGlvbiBj\nb25uID0gX2RzLmdldENvbm5lY3Rpb24oKTsKICAgICAgICBEYXRhYmFzZU1l\ndGFEYXRhIG1ldGEgPSBjb25uLmdldE1ldGFEYXRhKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKHRhYmxlTmFtZXMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGdlbmVyYXRlSW5kZXhlcyhzY2hlbWFOYW1lLCBudWxsLCBj\nb25uLCBtZXRhKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCB0YWJsZU5hbWVzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlSW5kZXhlcyhzY2hlbWFOYW1l\nLCB0YWJsZU5hbWVzW2ldLCBjb25uLCBtZXRhKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAvLyBzb21lIGRhdGFiYXNlcyByZXF1aXJlIGEg\nY29tbWl0IGFmdGVyIG1ldGFkYXRhIHRvIHJlbGVhc2UgbG9ja3MKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbm4uY29tbWl0KCk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25u\nLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBz\nZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogR2VuZXJhdGUgZm9yZWlnbiBrZXkgaW5mb3JtYXRpb24gZm9yIHRo\nZSBnaXZlbiBzY2hlbWEuIFRoaXMgbWV0aG9kCiAgICAgKiBtdXN0IGJlIGNh\nbGxlZCBpbiBhZGRpdGlvbiB0byB7QGxpbmsgI2dlbmVyYXRlU2NoZW1hfS4g\nSXQgc2hvdWxkCiAgICAgKiBvbmx5IGJlIGNhbGxlZCBhZnRlciBhbGwgc2No\nZW1hcyBhcmUgZ2VuZXJhdGVkLiBUaGUgc2NoZW1hIG5hbWUgYW5kCiAgICAg\nKiB0YWJsZXMgYXJyYXkgY2FuIGJlIG51bGwgdG8gaW5kaWNhdGUgdGhhdCBp\nbmRleGVzIHNob3VsZCBiZSBnZW5lcmF0ZWQKICAgICAqIGZvciBhbGwgc2No\nZW1hcyBhbmQvb3IgdGFibGVzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBn\nZW5lcmF0ZUZvcmVpZ25LZXlzKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmdb\nXSB0YWJsZU5hbWVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGZpcmVHZW5lcmF0aW9uRXZlbnQoX2xvYy5nZXQoImdlbmVyYXRp\nbmctYWxsLWZvcmVpZ25zIiwgc2NoZW1hTmFtZSkpOwoKICAgICAgICBDb25u\nZWN0aW9uIGNvbm4gPSBfZHMuZ2V0Q29ubmVjdGlvbigpOwogICAgICAgIERh\ndGFiYXNlTWV0YURhdGEgbWV0YSA9IGNvbm4uZ2V0TWV0YURhdGEoKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAodGFibGVOYW1lcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgZ2VuZXJhdGVGb3JlaWduS2V5cyhzY2hlbWFO\nYW1lLCBudWxsLCBjb25uLCBtZXRhKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0YWJsZU5hbWVzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlRm9yZWln\nbktleXMoc2NoZW1hTmFtZSwgdGFibGVOYW1lc1tpXSwgY29ubiwgbWV0YSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgLy8gc29tZSBkYXRh\nYmFzZXMgcmVxdWlyZSBhIGNvbW1pdCBhZnRlciBtZXRhZGF0YSB0byByZWxl\nYXNlIGxvY2tzCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBj\nb25uLmNvbW1pdCgpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UpIHsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgY29ubi5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYWxsIHRhYmxlcyBtYXRjaGlu\nZyB0aGUgZ2l2ZW4gbmFtZSBwYXR0ZXJuIHRvIHRoZSBzY2hlbWEuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIGdlbmVyYXRlVGFibGVzKFN0cmluZyBzY2hl\nbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLAogICAgICAgIENvbm5lY3Rpb24g\nY29ubiwgRGF0YWJhc2VNZXRhRGF0YSBtZXRhKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGZpcmVHZW5lcmF0aW9uRXZlbnQoX2xv\nYy5nZXQoImdlbmVyYXRpbmctY29sdW1ucyIsIHNjaGVtYU5hbWUsCiAgICAg\nICAgICAgIHRhYmxlTmFtZSkpOwogICAgICAgIGlmIChfbG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImdl\nbi10YWJsZXMiLCBzY2hlbWFOYW1lLCB0YWJsZU5hbWUpKTsKCiAgICAgICAg\nQ29sdW1uW10gY29scyA9IF9kaWN0LmdldENvbHVtbnMobWV0YSwgY29ubi5n\nZXRDYXRhbG9nKCksIHNjaGVtYU5hbWUsCiAgICAgICAgICAgIHRhYmxlTmFt\nZSwgbnVsbCwgY29ubik7CgogICAgICAgIC8vIHdoZW4gd2Ugd2FudCB0byBn\nZXQgYWxsIHRoZSBjb2x1bW5zIGZvciBhbGwgdGFibGVzLCB3ZSBuZWVkIHRv\nIGJ1aWxkCiAgICAgICAgLy8gYSBsaXN0IG9mIHRhYmxlcyB0byB2ZXJpZnkg\nYmVjYXVzZSBzb21lIGRhdGFiYXNlcyAoZS5nLiwgUG9zdGdyZXMpCiAgICAg\nICAgLy8gd2lsbCBpbmNsdWRlIGluZGV4ZXMgaW4gdGhlIGxpc3Qgb2YgY29s\ndW1ucywgYW5kIHRoZXJlIGlzIG5vIHdheSB0bwogICAgICAgIC8vIGRpc3Rp\nbmd1aXNoIHRoZSBpbmRleGVzIGZyb20gcHJvcGVyIGNvbHVtbnMKICAgICAg\nICBTZXQgdGFibGVOYW1lcyA9IG51bGw7CiAgICAgICAgaWYgKHRhYmxlTmFt\nZSA9PSBudWxsIHx8ICIlIi5lcXVhbHModGFibGVOYW1lKSkgewogICAgICAg\nICAgICBUYWJsZVtdIHRhYmxlcyA9IF9kaWN0LmdldFRhYmxlcyhtZXRhLCBj\nb25uLmdldENhdGFsb2coKSwKICAgICAgICAgICAgICAgIHNjaGVtYU5hbWUs\nIHRhYmxlTmFtZSwgY29ubik7CiAgICAgICAgICAgIHRhYmxlTmFtZXMgPSBu\nZXcgSGFzaFNldCgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgdGFi\nbGVzICE9IG51bGwgJiYgaSA8IHRhYmxlcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICB0YWJsZU5hbWVzLmFkZCh0YWJsZXNbaV0uZ2V0TmFtZSgpKTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB0YWJsZU5h\nbWVzLmFkZCh0YWJsZXNbaV0uZ2V0TmFtZSgpLnRvVXBwZXJDYXNlKCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBkYXRhYmFz\nZSBjYW4ndCBoYW5kbGUgbnVsbCB0YWJsZSBuYW1lLCByZWN1cnNlIG9uIGVh\nY2gga25vd24gbmFtZQogICAgICAgIGlmIChjb2xzID09IG51bGwgJiYgdGFi\nbGVOYW1lID09IG51bGwpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSB0YWJsZU5hbWVzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQog\nICAgICAgICAgICAgICAgZ2VuZXJhdGVUYWJsZXMoc2NoZW1hTmFtZSwgKFN0\ncmluZykgaXRyLm5leHQoKSwgY29ubiwgbWV0YSk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CgogICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0g\nZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICBTY2hlbWEgc2NoZW1hOwogICAg\nICAgIFRhYmxlIHRhYmxlOwogICAgICAgIFN0cmluZyB0YWJsZVNjaGVtYTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgY29scyAhPSBudWxsICYmIGkgPCBj\nb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRhYmxlTmFtZSA9IGNv\nbHNbaV0uZ2V0VGFibGVOYW1lKCk7CiAgICAgICAgICAgIHRhYmxlU2NoZW1h\nID0gU3RyaW5nVXRpbHMudHJpbVRvTnVsbChjb2xzW2ldLmdldFNjaGVtYU5h\nbWUoKSk7CgogICAgICAgICAgICAvLyBpZ25vcmUgc3BlY2lhbCB0YWJsZXMK\nICAgICAgICAgICAgaWYgKCFfb3BlbmpwYVRhYmxlcyAmJgogICAgICAgICAg\nICAgICAgKHRhYmxlTmFtZS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIk9Q\nRU5KUEFfIikKICAgICAgICAgICAgICAgICAgICB8fCB0YWJsZU5hbWUudG9V\ncHBlckNhc2UoKS5zdGFydHNXaXRoKCJKRE9fIikpKSAvLyBsZWdhY3kKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoX2RpY3Qu\naXNTeXN0ZW1UYWJsZSh0YWJsZU5hbWUsIHRhYmxlU2NoZW1hLCBzY2hlbWFO\nYW1lICE9IG51bGwpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICAvLyBpZ25vcmUgdGFibGVzIG5vdCBpbiBsaXN0LCBvciBub3Qg\nYWxsb3dlZCBieSBzY2hlbWFzIHByb3BlcnR5CiAgICAgICAgICAgIGlmICh0\nYWJsZU5hbWVzICE9IG51bGwKICAgICAgICAgICAgICAgICYmICF0YWJsZU5h\nbWVzLmNvbnRhaW5zKHRhYmxlTmFtZS50b1VwcGVyQ2FzZSgpKSkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoIWlzQWxsb3dl\nZFRhYmxlKHRhYmxlU2NoZW1hLCB0YWJsZU5hbWUpKQogICAgICAgICAgICAg\nICAgY29udGludWU7CgogICAgICAgICAgICBzY2hlbWEgPSBncm91cC5nZXRT\nY2hlbWEodGFibGVTY2hlbWEpOwogICAgICAgICAgICBpZiAoc2NoZW1hID09\nIG51bGwpCiAgICAgICAgICAgICAgICBzY2hlbWEgPSBncm91cC5hZGRTY2hl\nbWEodGFibGVTY2hlbWEpOwoKICAgICAgICAgICAgdGFibGUgPSBzY2hlbWEu\nZ2V0VGFibGUodGFibGVOYW1lKTsKICAgICAgICAgICAgaWYgKHRhYmxlID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIHRhYmxlID0gc2NoZW1hLmFkZFRh\nYmxlKHRhYmxlTmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1Ry\nYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2Uo\nX2xvYy5nZXQoImNvbC10YWJsZSIsIHRhYmxlKSk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJnZW4tY29sdW1uIiwg\nY29sc1tpXS5nZXROYW1lKCksIHRhYmxlKSk7CgogICAgICAgICAgICBpZiAo\ndGFibGUuZ2V0Q29sdW1uKGNvbHNbaV0uZ2V0TmFtZSgpKSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgdGFibGUuaW1wb3J0Q29sdW1uKGNvbHNbaV0pOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoZSBnaXZlbiB0YWJsZSBpcyBhbGxvd2VkIGJ5IHRoZSB1c2VyJ3Mgc2No\nZW1hIGxpc3QuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0FsbG93\nZWRUYWJsZShTdHJpbmcgc2NoZW1hLCBTdHJpbmcgdGFibGUpIHsKICAgICAg\nICBpZiAoX2FsbG93ZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CgogICAgICAgIC8vIGRvIGNhc2UtaW5zZW5zaXRpdmUgY29tcGFyaXNv\nbiBvbiBhbGxvd2VkIHRhYmxlIGFuZCBzY2hlbWEgbmFtZXMKICAgICAgICBT\ndHJpbmdbXSB0YWJsZXM7CiAgICAgICAgU3RyaW5nW10gYW55U2NoZW1hVGFi\nbGVzID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9hbGxv\nd2VkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChfYWxsb3dlZFtp\nXVswXSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBhbnlTY2hlbWFUYWJs\nZXMgPSAoU3RyaW5nW10pIF9hbGxvd2VkW2ldWzFdOwogICAgICAgICAgICAg\nICAgaWYgKHNjaGVtYSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5lcXVhbHNJZ25vcmVDYXNl\nKHNjaGVtYSwgKFN0cmluZykgX2FsbG93ZWRbaV1bMF0pKQogICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICBpZiAodGFibGUgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB0\nYWJsZXMgPSAoU3RyaW5nW10pIF9hbGxvd2VkW2ldWzFdOwogICAgICAgICAg\nICBpZiAodGFibGVzID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJsZXMu\nbGVuZ3RoOyBqKyspCiAgICAgICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\nZXF1YWxzSWdub3JlQ2FzZSh0YWJsZSwgdGFibGVzW2pdKSkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlm\nIChhbnlTY2hlbWFUYWJsZXMgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAo\ndGFibGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFueVNjaGVtYVRhYmxl\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChTdHJpbmdVdGls\ncy5lcXVhbHNJZ25vcmVDYXNlKHRhYmxlLCBhbnlTY2hlbWFUYWJsZXNbaV0p\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBH\nZW5lcmF0ZXMgdGFibGUgcHJpbWFyeSBrZXlzLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBnZW5lcmF0ZVByaW1hcnlLZXlzKFN0cmluZyBzY2hlbWFOYW1l\nLCBTdHJpbmcgdGFibGVOYW1lLAogICAgICAgIENvbm5lY3Rpb24gY29ubiwg\nRGF0YWJhc2VNZXRhRGF0YSBtZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGZpcmVHZW5lcmF0aW9uRXZlbnQoX2xvYy5nZXQo\nImdlbmVyYXRpbmctcHJpbWFyeSIsCiAgICAgICAgICAgIHNjaGVtYU5hbWUs\nIHRhYmxlTmFtZSkpOwogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImdlbi1wa3Mi\nLCBzY2hlbWFOYW1lLCB0YWJsZU5hbWUpKTsKCiAgICAgICAgLy8gaWYgbG9v\na2luZyBmb3IgYSBub24tZXhpc3RhbnQgdGFibGUsIGp1c3QgcmV0dXJuCiAg\nICAgICAgU2NoZW1hR3JvdXAgZ3JvdXAgPSBnZXRTY2hlbWFHcm91cCgpOwog\nICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCAmJiBncm91cC5maW5kVGFi\nbGUodGFibGVOYW1lKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIC8vIGlmIHRoZSBkYXRhYmFzZSBjYW4ndCB1c2UgYSB0YWJsZSBu\nYW1lIHdpbGRjYXJkLCByZWN1cnNlIG9uIGVhY2gKICAgICAgICAvLyBjb25j\ncmV0ZSB0YWJsZSBpbiB0aGUgcmVxdWVzdGVkIHNjaGVtYShzKQogICAgICAg\nIFByaW1hcnlLZXlbXSBwa3MgPSBfZGljdC5nZXRQcmltYXJ5S2V5cyhtZXRh\nLCBjb25uLmdldENhdGFsb2coKSwKICAgICAgICAgICAgc2NoZW1hTmFtZSwg\ndGFibGVOYW1lLCBjb25uKTsKICAgICAgICBUYWJsZSB0YWJsZTsKICAgICAg\nICBpZiAocGtzID09IG51bGwgJiYgdGFibGVOYW1lID09IG51bGwpIHsKICAg\nICAgICAgICAgQ29sbGVjdGlvbiB0YWJsZXMgPSBnZXRUYWJsZXMoc2NoZW1h\nTmFtZSk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdGFibGVz\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAg\nICB0YWJsZSA9IChUYWJsZSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAg\nIGdlbmVyYXRlUHJpbWFyeUtleXModGFibGUuZ2V0U2NoZW1hTmFtZSgpLAog\nICAgICAgICAgICAgICAgICAgIHRhYmxlLmdldE5hbWUoKSwgY29ubiwgbWV0\nYSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgU2NoZW1hIHNjaGVtYTsKICAgICAgICBQcmltYXJ5S2V5\nIHBrOwogICAgICAgIFN0cmluZyBuYW1lOwogICAgICAgIFN0cmluZyBjb2xO\nYW1lOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBwa3MgIT0gbnVsbCAmJiBp\nIDwgcGtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHNjaGVtYU5hbWUg\nPSBTdHJpbmdVdGlscy50cmltVG9OdWxsKHBrc1tpXS5nZXRTY2hlbWFOYW1l\nKCkpOwogICAgICAgICAgICBzY2hlbWEgPSBncm91cC5nZXRTY2hlbWEoc2No\nZW1hTmFtZSk7CiAgICAgICAgICAgIGlmIChzY2hlbWEgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB0YWJsZSA9IHNj\naGVtYS5nZXRUYWJsZShwa3NbaV0uZ2V0VGFibGVOYW1lKCkpOwogICAgICAg\nICAgICBpZiAodGFibGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgY29sTmFtZSA9IHBrc1tpXS5nZXRDb2x1bW5O\nYW1lKCk7CiAgICAgICAgICAgIG5hbWUgPSBwa3NbaV0uZ2V0TmFtZSgpOwog\nICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZ2VuLXBrIiwgbmFtZSwg\ndGFibGUsIGNvbE5hbWUpKTsKCiAgICAgICAgICAgIHBrID0gdGFibGUuZ2V0\nUHJpbWFyeUtleSgpOwogICAgICAgICAgICBpZiAocGsgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHBrID0gdGFibGUuYWRkUHJpbWFyeUtleShuYW1lKTsK\nICAgICAgICAgICAgcGsuYWRkQ29sdW1uKHRhYmxlLmdldENvbHVtbihjb2xO\nYW1lKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJh\ndGVzIHRhYmxlIGluZGV4ZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGdl\nbmVyYXRlSW5kZXhlcyhTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxl\nTmFtZSwKICAgICAgICBDb25uZWN0aW9uIGNvbm4sIERhdGFiYXNlTWV0YURh\ndGEgbWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBmaXJlR2VuZXJhdGlvbkV2ZW50KF9sb2MuZ2V0KCJnZW5lcmF0aW5nLWlu\nZGV4ZXMiLAogICAgICAgICAgICBzY2hlbWFOYW1lLCB0YWJsZU5hbWUpKTsK\nICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJnZW4taW5kZXhlcyIsIHNjaGVtYU5h\nbWUsIHRhYmxlTmFtZSkpOwoKICAgICAgICAvLyBpZiBsb29raW5nIGZvciBh\nIG5vbi1leGlzdGFudCB0YWJsZSwganVzdCByZXR1cm4KICAgICAgICBTY2hl\nbWFHcm91cCBncm91cCA9IGdldFNjaGVtYUdyb3VwKCk7CiAgICAgICAgaWYg\nKHRhYmxlTmFtZSAhPSBudWxsICYmIGdyb3VwLmZpbmRUYWJsZSh0YWJsZU5h\nbWUpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\naWYgdGhlIGRhdGFiYXNlIGNhbid0IHVzZSBhIHRhYmxlIG5hbWUgd2lsZGNh\ncmQsIHJlY3Vyc2Ugb24gZWFjaAogICAgICAgIC8vIGNvbmNyZXRlIHRhYmxl\nIGluIHRoZSByZXF1ZXN0ZWQgc2NoZW1hKHMpCiAgICAgICAgSW5kZXhbXSBp\nZHhzID0gX2RpY3QuZ2V0SW5kZXhJbmZvKG1ldGEsIGNvbm4uZ2V0Q2F0YWxv\nZygpLAogICAgICAgICAgICBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsIGZhbHNl\nLCB0cnVlLCBjb25uKTsKICAgICAgICBUYWJsZSB0YWJsZTsKICAgICAgICBp\nZiAoaWR4cyA9PSBudWxsICYmIHRhYmxlTmFtZSA9PSBudWxsKSB7CiAgICAg\nICAgICAgIENvbGxlY3Rpb24gdGFibGVzID0gZ2V0VGFibGVzKHNjaGVtYU5h\nbWUpOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRhYmxlcy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\ndGFibGUgPSAoVGFibGUpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBn\nZW5lcmF0ZUluZGV4ZXModGFibGUuZ2V0U2NoZW1hTmFtZSgpLAogICAgICAg\nICAgICAgICAgICAgIHRhYmxlLmdldE5hbWUoKSwgY29ubiwgbWV0YSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgU2NoZW1hIHNjaGVtYTsKICAgICAgICBJbmRleCBpZHg7CiAgICAg\nICAgU3RyaW5nIG5hbWU7CiAgICAgICAgU3RyaW5nIGNvbE5hbWU7CiAgICAg\nICAgU3RyaW5nIHBrTmFtZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaWR4\ncyAhPSBudWxsICYmIGkgPCBpZHhzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIHNjaGVtYU5hbWUgPSBTdHJpbmdVdGlscy50cmltVG9OdWxsKGlkeHNb\naV0uZ2V0U2NoZW1hTmFtZSgpKTsKICAgICAgICAgICAgc2NoZW1hID0gZ3Jv\ndXAuZ2V0U2NoZW1hKHNjaGVtYU5hbWUpOwogICAgICAgICAgICBpZiAoc2No\nZW1hID09IG51bGwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgdGFibGUgPSBzY2hlbWEuZ2V0VGFibGUoaWR4c1tpXS5nZXRUYWJs\nZU5hbWUoKSk7CiAgICAgICAgICAgIGlmICh0YWJsZSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICBpZiAodGFibGUu\nZ2V0UHJpbWFyeUtleSgpICE9IG51bGwpCiAgICAgICAgICAgICAgICBwa05h\nbWUgPSB0YWJsZS5nZXRQcmltYXJ5S2V5KCkuZ2V0TmFtZSgpOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICBwa05hbWUgPSBudWxsOwoKICAg\nICAgICAgICAgLy8gc3RhdGlzdGljcyBkb24ndCBoYXZlIG5hbWVzOyBza2lw\nIHRoZW0KICAgICAgICAgICAgbmFtZSA9IGlkeHNbaV0uZ2V0TmFtZSgpOwog\nICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShuYW1lKQogICAg\nICAgICAgICAgICAgfHwgKHBrTmFtZSAhPSBudWxsICYmIG5hbWUuZXF1YWxz\nSWdub3JlQ2FzZShwa05hbWUpKQogICAgICAgICAgICAgICAgfHwgX2RpY3Qu\naXNTeXN0ZW1JbmRleChuYW1lLCB0YWJsZSkpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIGNvbE5hbWUgPSBpZHhzW2ldLmdldENv\nbHVtbk5hbWUoKTsKICAgICAgICAgICAgaWYgKHRhYmxlLmdldENvbHVtbihj\nb2xOYW1lKSA9PSBudWxsKQogICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZ2VuLWluZGV4IiwgbmFt\nZSwgdGFibGUsIGNvbE5hbWUpKTsKCiAgICAgICAgICAgIC8vIHNhbWUgaW5k\nZXggbWF5IGhhdmUgbXVsdGlwbGUgcm93cyBmb3IgbXVsdGlwbGUgY29scwog\nICAgICAgICAgICBpZHggPSB0YWJsZS5nZXRJbmRleChuYW1lKTsKICAgICAg\nICAgICAgaWYgKGlkeCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZHgg\nPSB0YWJsZS5hZGRJbmRleChuYW1lKTsKICAgICAgICAgICAgICAgIGlkeC5z\nZXRVbmlxdWUoaWR4c1tpXS5pc1VuaXF1ZSgpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBpZHguYWRkQ29sdW1uKHRhYmxlLmdldENvbHVtbihjb2xO\nYW1lKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJh\ndGVzIHRhYmxlIGZvcmVpZ24ga2V5cy4KICAgICAqLwogICAgcHVibGljIHZv\naWQgZ2VuZXJhdGVGb3JlaWduS2V5cyhTdHJpbmcgc2NoZW1hTmFtZSwgU3Ry\naW5nIHRhYmxlTmFtZSwKICAgICAgICBDb25uZWN0aW9uIGNvbm4sIERhdGFi\nYXNlTWV0YURhdGEgbWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBmaXJlR2VuZXJhdGlvbkV2ZW50KF9sb2MuZ2V0KCJnZW5l\ncmF0aW5nLWZvcmVpZ24iLAogICAgICAgICAgICBzY2hlbWFOYW1lLCB0YWJs\nZU5hbWUpKTsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJnZW4tZmtzIiwgc2No\nZW1hTmFtZSwgdGFibGVOYW1lKSk7CgogICAgICAgIC8vIGlmIGxvb2tpbmcg\nZm9yIGEgbm9uLWV4aXN0YW50IHRhYmxlLCBqdXN0IHJldHVybgogICAgICAg\nIFNjaGVtYUdyb3VwIGdyb3VwID0gZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAg\nICBpZiAodGFibGVOYW1lICE9IG51bGwgJiYgZ3JvdXAuZmluZFRhYmxlKHRh\nYmxlTmFtZSkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICAvLyBpZiB0aGUgZGF0YWJhc2UgY2FuJ3QgdXNlIGEgdGFibGUgbmFtZSB3\naWxkY2FyZCwgcmVjdXJzZSBvbiBlYWNoCiAgICAgICAgLy8gY29uY3JldGUg\ndGFibGUgaW4gdGhlIHJlcXVlc3RlZCBzY2hlbWEocykKICAgICAgICBGb3Jl\naWduS2V5W10gZmtzID0gX2RpY3QuZ2V0SW1wb3J0ZWRLZXlzKG1ldGEsIGNv\nbm4uZ2V0Q2F0YWxvZygpLAogICAgICAgICAgICBzY2hlbWFOYW1lLCB0YWJs\nZU5hbWUsIGNvbm4pOwogICAgICAgIFRhYmxlIHRhYmxlOwogICAgICAgIGlm\nIChma3MgPT0gbnVsbCAmJiB0YWJsZU5hbWUgPT0gbnVsbCkgewogICAgICAg\nICAgICBDb2xsZWN0aW9uIHRhYmxlcyA9IGdldFRhYmxlcyhzY2hlbWFOYW1l\nKTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB0YWJsZXMuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRh\nYmxlID0gKFRhYmxlKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgZ2Vu\nZXJhdGVGb3JlaWduS2V5cyh0YWJsZS5nZXRTY2hlbWFOYW1lKCksCiAgICAg\nICAgICAgICAgICAgICAgdGFibGUuZ2V0TmFtZSgpLCBjb25uLCBtZXRhKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICBTY2hlbWEgc2NoZW1hOwogICAgICAgIFRhYmxlIHBrVGFibGU7\nCiAgICAgICAgRm9yZWlnbktleSBmazsKICAgICAgICBTdHJpbmcgbmFtZTsK\nICAgICAgICBTdHJpbmcgcGtTY2hlbWFOYW1lOwogICAgICAgIFN0cmluZyBw\na1RhYmxlTmFtZTsKICAgICAgICBTdHJpbmcgcGtDb2xOYW1lOwogICAgICAg\nIFN0cmluZyBma0NvbE5hbWU7CiAgICAgICAgaW50IHNlcTsKICAgICAgICBi\nb29sZWFuIHNlcVdhczAgPSBmYWxzZTsgLy8gc29tZSBkcml2ZXJzIGluY29y\ncmVjdGx5IHN0YXJ0IGF0IDAKICAgICAgICBDb2xsZWN0aW9uIGludmFsaWRz\nID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgZmtzICE9IG51bGwg\nJiYgaSA8IGZrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzY2hlbWFO\nYW1lID0gU3RyaW5nVXRpbHMudHJpbVRvTnVsbChma3NbaV0uZ2V0U2NoZW1h\nTmFtZSgpKTsKICAgICAgICAgICAgc2NoZW1hID0gZ3JvdXAuZ2V0U2NoZW1h\nKHNjaGVtYU5hbWUpOwogICAgICAgICAgICBpZiAoc2NoZW1hID09IG51bGwp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgdGFibGUg\nPSBzY2hlbWEuZ2V0VGFibGUoZmtzW2ldLmdldFRhYmxlTmFtZSgpKTsKICAg\nICAgICAgICAgaWYgKHRhYmxlID09IG51bGwpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIG5hbWUgPSBma3NbaV0uZ2V0TmFtZSgp\nOwogICAgICAgICAgICBma0NvbE5hbWUgPSBma3NbaV0uZ2V0Q29sdW1uTmFt\nZSgpOwogICAgICAgICAgICBwa0NvbE5hbWUgPSBma3NbaV0uZ2V0UHJpbWFy\neUtleUNvbHVtbk5hbWUoKTsKICAgICAgICAgICAgc2VxID0gZmtzW2ldLmdl\ndEtleVNlcXVlbmNlKCk7CiAgICAgICAgICAgIGlmIChzZXEgPT0gMCkKICAg\nICAgICAgICAgICAgIHNlcVdhczAgPSB0cnVlOwogICAgICAgICAgICBpZiAo\nc2VxV2FzMCkKICAgICAgICAgICAgICAgIHNlcSsrOwoKICAgICAgICAgICAg\nLy8gZmluZCBwayB0YWJsZQogICAgICAgICAgICBwa1NjaGVtYU5hbWUgPSBm\na3NbaV0uZ2V0UHJpbWFyeUtleVNjaGVtYU5hbWUoKTsKICAgICAgICAgICAg\ncGtUYWJsZU5hbWUgPSBma3NbaV0uZ2V0UHJpbWFyeUtleVRhYmxlTmFtZSgp\nOwogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZ2VuLWZrIiwgbmV3\nIE9iamVjdFtdeyBuYW1lLCB0YWJsZSwKICAgICAgICAgICAgICAgICAgICBm\na0NvbE5hbWUsIHBrVGFibGVOYW1lLCBwa0NvbE5hbWUsIHNlcSArICIiIH0p\nKTsKCiAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShwa1Nj\naGVtYU5hbWUpKQogICAgICAgICAgICAgICAgcGtUYWJsZU5hbWUgPSBwa1Nj\naGVtYU5hbWUgKyAiLiIgKyBwa1RhYmxlTmFtZTsKICAgICAgICAgICAgcGtU\nYWJsZSA9IGdyb3VwLmZpbmRUYWJsZShwa1RhYmxlTmFtZSk7CiAgICAgICAg\nICAgIGlmIChwa1RhYmxlID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgU1FMRXhjZXB0aW9uKF9sb2MuZ2V0KCJnZW4tbm9ma3RhYmxlIiwK\nICAgICAgICAgICAgICAgICAgICB0YWJsZSwgcGtUYWJsZU5hbWUpLmdldE1l\nc3NhZ2UoKSk7CgogICAgICAgICAgICAvLyB0aGlzIHN1Y2tzLCBiZWNhdXNl\nIGl0IGlzICpub3QqIGd1YXJhbnRlZWQgdG8gd29yazsKICAgICAgICAgICAg\nLy8gdGhlIGZrIHJlc3VsdHNldCBpcyBvcmRlcmVkIGJ5IHByaW1hcnkga2V5\nIHRhYmxlLCB0aGVuCiAgICAgICAgICAgIC8vIHNlcXVlbmNlIG51bWJlciB3\naXRoaW4gdGhlIGZvcmVpZ24ga2V5IChzb21lIGRyaXZlcnMgZG9uJ3QKICAg\nICAgICAgICAgLy8gdXNlIHNlcXVlbmNlIG51bWJlcnMgY29ycmVjdGx5IGVp\ndGhlcik7IHNpbmNlIGZrIG5hbWVzCiAgICAgICAgICAgIC8vIGFyZSBhbGxv\nd2VkIHRvIGJlIG51bGwsIGFsbCB0aGlzIGFkZHMgdXAgdG8gdGhlIGZhY3QK\nICAgICAgICAgICAgLy8gdGhhdCB0aGVyZSBpcyBhYnNvbHV0ZWx5IG5vIHdh\neSB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuCiAgICAgICAgICAgIC8vIG11bHRp\ncGxlIG11bHRpLWNvbHVtbiBma3MgdG8gdGhlIHNhbWUgdGFibGU7IHdlJ3Jl\nIGdvaW5nCiAgICAgICAgICAgIC8vIHRvIHJlbHkgb24gZmsgbmFtZSBoZXJl\nIGFuZCBob3BlIGl0IHdvcmtzCiAgICAgICAgICAgIGZrID0gdGFibGUuZ2V0\nRm9yZWlnbktleShuYW1lKTsKCiAgICAgICAgICAgIC8vIHN0YXJ0IGEgbmV3\nIGZrPwogICAgICAgICAgICBpZiAoc2VxID09IDEgfHwgZmsgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgZmsgPSB0YWJsZS5hZGRGb3JlaWduS2V5KG5h\nbWUpOwogICAgICAgICAgICAgICAgZmsuc2V0RGVmZXJyZWQoZmtzW2ldLmlz\nRGVmZXJyZWQoKSk7CiAgICAgICAgICAgICAgICBmay5zZXREZWxldGVBY3Rp\nb24oZmtzW2ldLmdldERlbGV0ZUFjdGlvbigpKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgaWYgKGludmFsaWRzID09IG51bGwgfHwgIWludmFsaWRz\nLmNvbnRhaW5zKGZrKSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICBmay5qb2luKHRhYmxlLmdldENvbHVtbihma0NvbE5h\nbWUpLAogICAgICAgICAgICAgICAgICAgICAgICBwa1RhYmxlLmdldENvbHVt\nbihwa0NvbE5hbWUpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbiBpYWUpIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYmFkLWpvaW4iLCBpYWUudG9T\ndHJpbmcoKSkpOwogICAgICAgICAgICAgICAgICAgIGlmIChpbnZhbGlkcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBpbnZhbGlkcyA9IG5l\ndyBIYXNoU2V0KCk7CiAgICAgICAgICAgICAgICAgICAgaW52YWxpZHMuYWRk\nKGZrKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgLy8gcmVtb3ZlIGludmFsaWQgZmtzCiAgICAgICAgaWYg\nKGludmFsaWRzICE9IG51bGwpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBpbnZhbGlkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgZmsgPSAoRm9yZWlnbktleSkgaXRyLm5leHQo\nKTsKICAgICAgICAgICAgICAgIGZrLmdldFRhYmxlKCkucmVtb3ZlRm9yZWln\nbktleShmayk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIGFsbCBzZXF1ZW5jZXMgbWF0Y2hpbmcgdGhlIGdp\ndmVuIG5hbWUgcGF0dGVybiB0byB0aGUgc2NoZW1hLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBnZW5lcmF0ZVNlcXVlbmNlcyhTdHJpbmcgc2NoZW1hTmFt\nZSwgU3RyaW5nIHNlcXVlbmNlTmFtZSwKICAgICAgICBDb25uZWN0aW9uIGNv\nbm4sIERhdGFiYXNlTWV0YURhdGEgbWV0YSkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBmaXJlR2VuZXJhdGlvbkV2ZW50KF9sb2Mu\nZ2V0KCJnZW5lcmF0aW5nLXNlcXVlbmNlcyIsIHNjaGVtYU5hbWUpKTsKICAg\nICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBf\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJnZW4tc2VxcyIsIHNjaGVtYU5hbWUsIHNl\ncXVlbmNlTmFtZSkpOwoKICAgICAgICAvLyBzaW5jZSBhbGwgdGhlIHNlcXVl\nbmNlcyBhcmUgZ2VuZXJhdGVkIHVuZGVyIHRoZSBkZWZhdWx0IHNjaGVtYQog\nICAgICAgIC8vIHRoZXJlZm9yZSwgd2UgY2FuIHVzZSB0aGUgbnVsbCBzY2hl\nbWFuYW1lIHRvIHNlYXJjaAogICAgICAgIFNlcXVlbmNlW10gc2VxcyA9IF9k\naWN0LmdldFNlcXVlbmNlcyhtZXRhLCBjb25uLmdldENhdGFsb2coKSwKICAg\nICAgICAgICAgbnVsbCwgc2VxdWVuY2VOYW1lLCBjb25uKTsKCiAgICAgICAg\nU2NoZW1hR3JvdXAgZ3JvdXAgPSBnZXRTY2hlbWFHcm91cCgpOwogICAgICAg\nIFNjaGVtYSBzY2hlbWE7CiAgICAgICAgU3RyaW5nIHNlcXVlbmNlU2NoZW1h\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBzZXFzICE9IG51bGwgJiYgaSA8\nIHNlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc2VxdWVuY2VOYW1l\nID0gc2Vxc1tpXS5nZXROYW1lKCk7CiAgICAgICAgICAgIHNlcXVlbmNlU2No\nZW1hID0gU3RyaW5nVXRpbHMudHJpbVRvTnVsbChzZXFzW2ldLmdldFNjaGVt\nYU5hbWUoKSk7CgogICAgICAgICAgICAvLyBpZ25vcmUgc3BlY2lhbCB0YWJs\nZXMKICAgICAgICAgICAgaWYgKCFfb3BlbmpwYVRhYmxlcyAmJgogICAgICAg\nICAgICAgICAgKHNlcXVlbmNlTmFtZS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dp\ndGgoIk9QRU5KUEFfIikKICAgICAgICAgICAgICAgICAgICB8fCBzZXF1ZW5j\nZU5hbWUudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCJKRE9fIikpKSAvLyBs\nZWdhY3kKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBp\nZiAoX2RpY3QuaXNTeXN0ZW1TZXF1ZW5jZShzZXF1ZW5jZU5hbWUsIHNlcXVl\nbmNlU2NoZW1hLAogICAgICAgICAgICAgICAgc2NoZW1hTmFtZSAhPSBudWxs\nKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAo\nIWlzQWxsb3dlZFRhYmxlKHNlcXVlbmNlU2NoZW1hLCBudWxsKSkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgc2NoZW1hID0gZ3Jv\ndXAuZ2V0U2NoZW1hKHNlcXVlbmNlU2NoZW1hKTsKICAgICAgICAgICAgaWYg\nKHNjaGVtYSA9PSBudWxsKQogICAgICAgICAgICAgICAgc2NoZW1hID0gZ3Jv\ndXAuYWRkU2NoZW1hKHNlcXVlbmNlU2NoZW1hKTsKICAgICAgICAgICAgaWYg\nKHNjaGVtYS5nZXRTZXF1ZW5jZShzZXF1ZW5jZU5hbWUpID09IG51bGwpCiAg\nICAgICAgICAgICAgICBzY2hlbWEuYWRkU2VxdWVuY2Uoc2VxdWVuY2VOYW1l\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3RpZnkgYW55\nIGxpc3RlbmVycyB0aGF0IGEgc2NoZW1hIG9iamVjdCB3YXMgZ2VuZXJhdGVk\nLiBSZXR1cm5zCiAgICAgKiB0cnVlIGlmIGdlbmVyYXRpb24gc2hvdWxkIGNv\nbnRpbnVlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZmlyZUdlbmVyYXRp\nb25FdmVudChPYmplY3Qgc2NoZW1hT2JqZWN0KQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmIChzY2hlbWFPYmplY3QgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChfbGlzdGVuZXJz\nID09IG51bGwgfHwgX2xpc3RlbmVycy5zaXplKCkgPT0gMCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBFdmVudCBlID0gbmV3IEV2ZW50KHNjaGVt\nYU9iamVjdCwgX3NjaGVtYU9iamVjdHMpOwogICAgICAgIGZvciAoSXRlcmF0\nb3IgaSA9IF9saXN0ZW5lcnMuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIExpc3RlbmVyIGwgPSAoTGlzdGVuZXIpIGkubmV4dCgp\nOwogICAgICAgICAgICBpZiAoIWwuc2NoZW1hT2JqZWN0R2VuZXJhdGVkKGUp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlvbihfbG9j\nLmdldCgicmVmcmVzaC1jYW5jZWxsZWQiKQogICAgICAgICAgICAgICAgICAg\nIC5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZHMgYSBsaXN0ZW5lciBmb3Igc2NoZW1hIGdlbmVyYXRpb24gZXZl\nbnRzLgogICAgICoKICAgICAqIEBwYXJhbSBsIHRoZSBsaXN0ZW5lciB0byBh\nZGQKICAgICAqLwogICAgcHVibGljIHZvaWQgYWRkTGlzdGVuZXIoTGlzdGVu\nZXIgbCkgewogICAgICAgIGlmIChfbGlzdGVuZXJzID09IG51bGwpCiAgICAg\nICAgICAgIF9saXN0ZW5lcnMgPSBuZXcgTGlua2VkTGlzdCgpOwogICAgICAg\nIF9saXN0ZW5lcnMuYWRkKGwpOwogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlcyBhIHNjaGVtYSBnZW5lcmF0aW9uIGxpc3RlbmVyIGZvciBzY2hlbWEg\nZXZlbnRzLgogICAgICoKICAgICAqIEBwYXJhbSBsIHRoZSBsaXN0ZW5lciB0\nbyByZW1vdmUKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBpdCB3YXMgc3VjY2Vz\nc2Z1bGx5IHJlbW92ZWQKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVt\nb3ZlTGlzdGVuZXIoTGlzdGVuZXIgbCkgewogICAgICAgIHJldHVybiBfbGlz\ndGVuZXJzICE9IG51bGwgJiYgX2xpc3RlbmVycy5yZW1vdmUobCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIHRhYmxlcyBmb3IgdGhlIGdp\ndmVuIHNjaGVtYSBuYW1lLCBvciBhbGwgdGFibGVzIGluCiAgICAgKiB0aGUg\nc2NoZW1hIGdyb3VwIGlmIG51bGwgaXMgZ2l2ZW4uCiAgICAgKi8KICAgIHBy\naXZhdGUgQ29sbGVjdGlvbiBnZXRUYWJsZXMoU3RyaW5nIHNjaGVtYU5hbWUp\nIHsKICAgICAgICBTY2hlbWFHcm91cCBncm91cCA9IGdldFNjaGVtYUdyb3Vw\nKCk7CiAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkgewogICAgICAg\nICAgICBTY2hlbWEgc2NoZW1hID0gZ3JvdXAuZ2V0U2NoZW1hKHNjaGVtYU5h\nbWUpOwogICAgICAgICAgICBpZiAoc2NoZW1hID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKICAgICAg\nICAgICAgcmV0dXJuIEFycmF5cy5hc0xpc3Qoc2NoZW1hLmdldFRhYmxlcygp\nKTsKICAgICAgICB9CgogICAgICAgIFNjaGVtYVtdIHNjaGVtYXMgPSBncm91\ncC5nZXRTY2hlbWFzKCk7CiAgICAgICAgQ29sbGVjdGlvbiB0YWJsZXMgPSBu\nZXcgTGlua2VkTGlzdCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc2NoZW1hcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgdGFibGVzLmFkZEFs\nbChBcnJheXMuYXNMaXN0KHNjaGVtYXNbaV0uZ2V0VGFibGVzKCkpKTsKICAg\nICAgICByZXR1cm4gdGFibGVzOwogICAgfQoKICAgIC8qKgogICAgICogQSBs\naXN0ZW5lciBmb3IgYSBwb3RlbnRpYWxseSBsZW5ndGh5IHNjaGVtYSBnZW5l\ncmF0aW9uIHByb2Nlc3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgaW50\nZXJmYWNlIExpc3RlbmVyIHsKCiAgICAgICAgYm9vbGVhbiBzY2hlbWFPYmpl\nY3RHZW5lcmF0ZWQoRXZlbnQgZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nbiBldmVudCBjb3JyZXNwb25kaW5nIHRvIHRoZSBnZW5lcmF0aW9uIG9mIGEg\nc2NoZW1hIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIGNsYXNzIEV2ZW50\nCiAgICAgICAgZXh0ZW5kcyBFdmVudE9iamVjdCB7CgogICAgICAgIHByaXZh\ndGUgZmluYWwgaW50IF90b3RhbDsKCiAgICAgICAgcHVibGljIEV2ZW50KE9i\namVjdCBvYiwgaW50IHRvdGFsKSB7CiAgICAgICAgICAgIHN1cGVyKG9iKTsK\nICAgICAgICAgICAgX3RvdGFsID0gdG90YWw7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgaW50IGdldFRvdGFsKCkgewogICAgICAgICAgICByZXR1cm4g\nX3RvdGFsOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

