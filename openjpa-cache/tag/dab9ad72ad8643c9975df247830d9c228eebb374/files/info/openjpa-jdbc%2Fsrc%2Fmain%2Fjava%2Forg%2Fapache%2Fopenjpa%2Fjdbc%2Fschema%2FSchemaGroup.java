{"sha":"a5d7fd3f3deb485ad9caf1df1db0183492d8a3d6","node_id":"MDQ6QmxvYjIwNjM2NDphNWQ3ZmQzZjNkZWI0ODVhZDljYWYxZGYxZGIwMTgzNDkyZDhhM2Q2","size":15070,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a5d7fd3f3deb485ad9caf1df1db0183492d8a3d6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSGFz\naE1hcDsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKCi8qKgogKiBSZXByZXNlbnRzIGEgZ3JvdXBpbmcgb2Yg\nc2NoZW1hcyB1c2VkIGluIGEgZGF0YWJhc2UuCiAqCiAqIEBhdXRob3IgQWJl\nIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgU2NoZW1hR3JvdXAKICAgIGV4dGVu\nZHMgTmFtZVNldAogICAgaW1wbGVtZW50cyBDbG9uZWFibGUgewoKICAgIHBy\naXZhdGUgTWFwIF9zY2hlbWFNYXAgPSBudWxsOwoKICAgIC8vIGNhY2hlCiAg\nICBwcml2YXRlIFNjaGVtYVtdIF9zY2hlbWFzID0gbnVsbDsKCiAgICAvKioK\nICAgICAqIFJldHVybiBhbGwgc2NoZW1hcy4KICAgICAqLwogICAgcHVibGlj\nIFNjaGVtYVtdIGdldFNjaGVtYXMoKSB7CiAgICAgICAgaWYgKF9zY2hlbWFz\nID09IG51bGwpCiAgICAgICAgICAgIF9zY2hlbWFzID0gKF9zY2hlbWFNYXAg\nPT0gbnVsbCkgPyBuZXcgU2NoZW1hWzBdIDogKFNjaGVtYVtdKQogICAgICAg\nICAgICAgICAgX3NjaGVtYU1hcC52YWx1ZXMoKS50b0FycmF5KG5ldyBTY2hl\nbWFbX3NjaGVtYU1hcC5zaXplKCldKTsKICAgICAgICByZXR1cm4gX3NjaGVt\nYXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNjaGVtYSB3\naXRoIHRoZSBnaXZlbiBuYW1lLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8K\nICAgIHB1YmxpYyBTY2hlbWEgZ2V0U2NoZW1hKFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgaWYgKF9zY2hlbWFNYXAgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgbmFtZSA9IG5hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICByZXR1cm4g\nKFNjaGVtYSkgX3NjaGVtYU1hcC5nZXQobmFtZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgYSBzY2hlbWEgdG8gdGhlIGdyb3VwLgogICAgICovCiAg\nICBwdWJsaWMgU2NoZW1hIGFkZFNjaGVtYSgpIHsKICAgICAgICByZXR1cm4g\nYWRkU2NoZW1hKG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEg\nc2NoZW1hIHRvIHRoZSBncm91cC4KICAgICAqLwogICAgcHVibGljIFNjaGVt\nYSBhZGRTY2hlbWEoU3RyaW5nIG5hbWUpIHsKICAgICAgICBhZGROYW1lKG5h\nbWUsIGZhbHNlKTsKICAgICAgICBTY2hlbWEgc2NoZW1hID0gbmV3U2NoZW1h\nKG5hbWUpOwogICAgICAgIGlmIChuYW1lICE9IG51bGwpCiAgICAgICAgICAg\nIG5hbWUgPSBuYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgaWYgKF9zY2hl\nbWFNYXAgPT0gbnVsbCkKICAgICAgICAgICAgX3NjaGVtYU1hcCA9IG5ldyBI\nYXNoTWFwKCk7CiAgICAgICAgX3NjaGVtYU1hcC5wdXQobmFtZSwgc2NoZW1h\nKTsKICAgICAgICBfc2NoZW1hcyA9IG51bGw7CiAgICAgICAgcmV0dXJuIHNj\naGVtYTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4g\nc2NoZW1hIGZyb20gdGhlIGdyb3VwLgogICAgICoKICAgICAqIEByZXR1cm4g\ndHJ1ZSBpZiB0aGUgc2NoZW1hIHdhcyByZW1vdmVkLCBmYWxzZSBpZiBub3Qg\naW4gdGhlIGdyb3VwCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92\nZVNjaGVtYShTY2hlbWEgc2NoZW1hKSB7CiAgICAgICAgaWYgKHNjaGVtYSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIFN0\ncmluZyBuYW1lID0gc2NoZW1hLmdldE5hbWUoKTsKICAgICAgICBpZiAobmFt\nZSAhPSBudWxsKQogICAgICAgICAgICBuYW1lID0gbmFtZS50b1VwcGVyQ2Fz\nZSgpOwogICAgICAgIFNjaGVtYSByZW0gPSAoU2NoZW1hKSBfc2NoZW1hTWFw\nLmdldChuYW1lKTsKICAgICAgICBpZiAoc2NoZW1hLmVxdWFscyhyZW0pKSB7\nCiAgICAgICAgICAgIF9zY2hlbWFNYXAucmVtb3ZlKG5hbWUpOwogICAgICAg\nICAgICByZW1vdmVOYW1lKHNjaGVtYS5nZXROYW1lKCkpOwogICAgICAgICAg\nICBfc2NoZW1hcyA9IG51bGw7CiAgICAgICAgICAgIHNjaGVtYS5yZW1vdmUo\nKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEltcG9ydCBh\nIHNjaGVtYSBmcm9tIGFub3RoZXIgZ3JvdXAuIEZvcmVpZ24ga2V5cyBhcmUg\nbm90IGltcG9ydGVkLgogICAgICovCiAgICBwdWJsaWMgU2NoZW1hIGltcG9y\ndFNjaGVtYShTY2hlbWEgc2NoZW1hKSB7CiAgICAgICAgaWYgKHNjaGVtYSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU2No\nZW1hIGNvcHkgPSBhZGRTY2hlbWEoc2NoZW1hLmdldE5hbWUoKSk7CiAgICAg\nICAgU2VxdWVuY2VbXSBzZXFzID0gc2NoZW1hLmdldFNlcXVlbmNlcygpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2Vxcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgY29weS5pbXBvcnRTZXF1ZW5jZShzZXFzW2ldKTsKCiAg\nICAgICAgVGFibGVbXSB0YWJsZXMgPSBzY2hlbWEuZ2V0VGFibGVzKCk7CiAg\nICAgICAgSW5kZXhbXSBpZHhzOwogICAgICAgIFVuaXF1ZVtdIHVucXM7CiAg\nICAgICAgVGFibGUgdGFiOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\ndGFibGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRhYiA9IGNvcHku\naW1wb3J0VGFibGUodGFibGVzW2ldKTsKICAgICAgICAgICAgaWR4cyA9IHRh\nYmxlc1tpXS5nZXRJbmRleGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGog\nPSAwOyBqIDwgaWR4cy5sZW5ndGg7IGorKykKICAgICAgICAgICAgICAgIHRh\nYi5pbXBvcnRJbmRleChpZHhzW2pdKTsKICAgICAgICAgICAgdW5xcyA9IHRh\nYmxlc1tpXS5nZXRVbmlxdWVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGog\nPSAwOyBqIDwgdW5xcy5sZW5ndGg7IGorKykKICAgICAgICAgICAgICAgIHRh\nYi5pbXBvcnRVbmlxdWUodW5xc1tqXSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBjb3B5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUg\naWYgdGhlIGdpdmVuIHRhYmxlIGlzIGtub3duIHRvIGV4aXN0LiBXaGlsZQog\nICAgICoge0BsaW5rICNmaW5kVGFibGV9IG1heSBleGhpYml0IGR5bmFtaWMg\nYmVoYXZpb3IgaW4gc29tZSBzY2hlbWEgZ3JvdXAKICAgICAqIGltcGxlbWVu\ndGF0aW9ucywgdGhpcyBtZXRob2Qgb25seSByZXR1cm5zIHRydWUgaWYgdGhl\nIHRhYmxlIGhhcyBiZWVuCiAgICAgKiBhZGRlZCB0byB0aGlzIGdyb3VwIG9y\nIGlzIGtub3duIHRvIGV4aXN0IGluIHRoZSBkYXRhYmFzZS4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gaXNLbm93blRhYmxlKFRhYmxlIHRhYmxlKSB7\nCiAgICAgICAgcmV0dXJuIGZpbmRUYWJsZSh0YWJsZSkgIT0gbnVsbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiB0\nYWJsZSBpcyBrbm93biB0byBleGlzdC4gV2hpbGUKICAgICAqIHtAbGluayAj\nZmluZFRhYmxlfSBtYXkgZXhoaWJpdCBkeW5hbWljIGJlaGF2aW9yIGluIHNv\nbWUgc2NoZW1hIGdyb3VwCiAgICAgKiBpbXBsZW1lbnRhdGlvbnMsIHRoaXMg\nbWV0aG9kIG9ubHkgcmV0dXJucyB0cnVlIGlmIHRoZSB0YWJsZSBoYXMgYmVl\nbgogICAgICogYWRkZWQgdG8gdGhpcyBncm91cCBvciBpcyBrbm93biB0byBl\neGlzdCBpbiB0aGUgZGF0YWJhc2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGlzS25vd25UYWJsZShTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVy\nbiBmaW5kVGFibGUobmFtZSkgIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAg\nICAqIEZpbmQgdGhlIGVxdWl2YWxlbnQgb2YgdGhlIGdpdmVuIHRhYmxlIGlu\nIHRoaXMgc2NoZW1hIGdyb3VwLiBUaGUKICAgICAqIGdpdmVuIHRhYmxlIHRo\nYXQgbWF5IGhhdmUgY29tZSBmcm9tIGFub3RoZXIgc2NoZW1hIGdyb3VwLgog\nICAgICovCiAgICBwdWJsaWMgVGFibGUgZmluZFRhYmxlKFRhYmxlIHRhYmxl\nKSB7CiAgICAgICAgcmV0dXJuIGZpbmRUYWJsZSh0YWJsZS5nZXRGdWxsTmFt\nZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgdGhlIHRhYmxlIHdp\ndGggdGhlIGdpdmVuIG5hbWUgaW4gdGhlIGdyb3VwLCB1c2luZyAnLicgYXMg\ndGhlCiAgICAgKiBjYXRhbG9nIHNlcGFyYXRvci4gUmV0dXJucyBudWxsIGlm\nIG5vIHRhYmxlIGZvdW5kLgogICAgICovCiAgICBwdWJsaWMgVGFibGUgZmlu\nZFRhYmxlKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGludCBkb3RJ\nZHggPSBuYW1lLmluZGV4T2YoJy4nKTsKICAgICAgICBpZiAoZG90SWR4ICE9\nIC0xKSB7CiAgICAgICAgICAgIFN0cmluZyBzY2hlbWFOYW1lID0gbmFtZS5z\ndWJzdHJpbmcoMCwgZG90SWR4KTsKICAgICAgICAgICAgbmFtZSA9IG5hbWUu\nc3Vic3RyaW5nKGRvdElkeCArIDEpOwogICAgICAgICAgICBTY2hlbWEgc2No\nZW1hID0gZ2V0U2NoZW1hKHNjaGVtYU5hbWUpOwogICAgICAgICAgICBpZiAo\nc2NoZW1hICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gc2NoZW1h\nLmdldFRhYmxlKG5hbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIFNjaGVtYVtdIHNjaGVtYXMgPSBnZXRTY2hlbWFzKCk7CiAgICAgICAgICAg\nIFRhYmxlIHRhYjsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\nY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YWIgPSBz\nY2hlbWFzW2ldLmdldFRhYmxlKG5hbWUpOwogICAgICAgICAgICAgICAgaWYg\nKHRhYiAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0YWI7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIHRoZSB0YWJsZSB3aXRoIHRo\nZSBnaXZlbiBuYW1lIGluIHRoZSBncm91cCwgdXNpbmcgJy4nIGFzIHRoZSBj\nYXRhbG9nCiAgICAgKiBzZXBhcmF0b3IuIFJldHVybnMgbnVsbCBpZiBubyB0\nYWJsZSBmb3VuZC4KICAgICAqLwogICAgcHVibGljIFRhYmxlIGZpbmRUYWJs\nZShTY2hlbWEgaW5TY2hlbWEsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYg\nKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIGludCBkb3RJZHggPSBuYW1lLmluZGV4T2YoJy4nKTsKICAgICAgICBp\nZiAoZG90SWR4ICE9IC0xKSB7CiAgICAgICAgICAgIFN0cmluZyBzY2hlbWFO\nYW1lID0gbmFtZS5zdWJzdHJpbmcoMCwgZG90SWR4KTsKICAgICAgICAgICAg\nbmFtZSA9IG5hbWUuc3Vic3RyaW5nKGRvdElkeCArIDEpOwogICAgICAgICAg\nICBTY2hlbWEgc2NoZW1hID0gZ2V0U2NoZW1hKHNjaGVtYU5hbWUpOwogICAg\nICAgICAgICBpZiAoc2NoZW1hICE9IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gc2NoZW1hLmdldFRhYmxlKG5hbWUpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIFNjaGVtYVtdIHNjaGVtYXMgPSBnZXRTY2hlbWFzKCk7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgVGFibGUgdGFiID0gc2NoZW1h\nc1tpXS5nZXRUYWJsZShuYW1lKTsKICAgICAgICAgICAgICAgIC8vIGlmIGEg\ndGFibGUgaXMgZm91bmQgYW5kIGl0IGhhcyB0aGUgc2FtZSBzY2hlbWEKICAg\nICAgICAgICAgICAgIC8vIGFzIHRoZSBpbnB1dCBzY2hlbWEgLCBpdCBtZWFu\ncyB0aGF0IHRoZSB0YWJsZQogICAgICAgICAgICAgICAgLy8gZXhpc3RzLiBI\nb3dldmVyLCBpZiB0aGUgaW5wdXQgc2NoZW1hIGlzIG51bGwsCiAgICAgICAg\nICAgICAgICAvLyB0aGVuIHdlIGFzc3VtZSB0aGF0IHRoZXJlIGlzIG9ubHkg\nb25lIHRhYmxlIGZvciB0aGUKICAgICAgICAgICAgICAgIC8vIGRiIGRlZmF1\nbHQgc2NoZW1hLCBpbiB0aGlzIGNhc2UsIHRhYmxlIGV4aXN0cy4uCiAgICAg\nICAgICAgICAgICAvLyBXZSBjYW4ndCBoYW5kbGUgdGhlIGNhc2UgdGhhdCBv\nbmUgZW50aXR5IGhhcyBzY2hlbWEgbmFtZQogICAgICAgICAgICAgICAgLy8g\nYW5kIG90aGVyIGVudGl0eSBkb2VzIG5vdCBoYXZlIHNjaGVtYSBuYW1lIGJ1\ndCBib3RoIGVudGl0aWVzCiAgICAgICAgICAgICAgICAvLyBtYXAgdG8gdGhl\nIHNhbWUgdGFibGUuCiAgICAgICAgICAgICAgICBpZiAodGFiICE9IG51bGwK\nICAgICAgICAgICAgICAgICAgICAgICAgJiYgKHNjaGVtYXNbaV0gPT0gaW5T\nY2hlbWEgfHwgaW5TY2hlbWEuZ2V0TmFtZSgpID09IG51bGwpKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiB0YWI7CgogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIHNlcXVlbmNlIGlzIGtub3du\nIHRvIGV4aXN0LiBXaGlsZQogICAgICoge0BsaW5rICNmaW5kU2VxdWVuY2V9\nIG1heSBleGhpYml0IGR5bmFtaWMgYmVoYXZpb3IgaW4gc29tZSBzY2hlbWEg\nZ3JvdXAKICAgICAqIGltcGxlbWVudGF0aW9ucywgdGhpcyBtZXRob2Qgb25s\neSByZXR1cm5zIHRydWUgaWYgdGhlIHNlcXVlbmNlIGhhcyBiZWVuCiAgICAg\nKiBhZGRlZCB0byB0aGlzIGdyb3VwIG9yIGlzIGtub3duIHRvIGV4aXN0IGlu\nIHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNL\nbm93blNlcXVlbmNlKFNlcXVlbmNlIHNlcSkgewogICAgICAgIHJldHVybiBm\naW5kU2VxdWVuY2Uoc2VxKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIHNlcXVlbmNlIGlzIGtub3du\nIHRvIGV4aXN0LiBXaGlsZQogICAgICoge0BsaW5rICNmaW5kU2VxdWVuY2V9\nIG1heSBleGhpYml0IGR5bmFtaWMgYmVoYXZpb3IgaW4gc29tZSBzY2hlbWEg\nZ3JvdXAKICAgICAqIGltcGxlbWVudGF0aW9ucywgdGhpcyBtZXRob2Qgb25s\neSByZXR1cm5zIHRydWUgaWYgdGhlIHNlcXVlbmNlIGhhcyBiZWVuCiAgICAg\nKiBhZGRlZCB0byB0aGlzIGdyb3VwIG9yIGlzIGtub3duIHRvIGV4aXN0IGlu\nIHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNL\nbm93blNlcXVlbmNlKFN0cmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIGZp\nbmRTZXF1ZW5jZShuYW1lKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAg\nICogRmluZCB0aGUgZXF1aXZhbGVudCBvZiB0aGUgZ2l2ZW4gc2VxdWVuY2Ug\naW4gdGhpcyBzY2hlbWEgZ3JvdXAuIFRoZQogICAgICogZ2l2ZW4gc2VxdWVu\nY2UgdGhhdCBtYXkgaGF2ZSBjb21lIGZyb20gYW5vdGhlciBzY2hlbWEgZ3Jv\ndXAuCiAgICAgKi8KICAgIHB1YmxpYyBTZXF1ZW5jZSBmaW5kU2VxdWVuY2Uo\nU2VxdWVuY2Ugc2VxKSB7CiAgICAgICAgcmV0dXJuIGZpbmRTZXF1ZW5jZShz\nZXEuZ2V0RnVsbE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5k\nIHRoZSBzZXF1ZW5jZSB3aXRoIHRoZSBnaXZlbiBuYW1lIGluIHRoZSBncm91\ncCwgdXNpbmcgJy4nIGFzIHRoZQogICAgICogY2F0YWxvZyBzZXBhcmF0b3Iu\nIFJldHVybnMgbnVsbCBpZiBubyBzZXF1ZW5jZSBmb3VuZC4KICAgICAqLwog\nICAgcHVibGljIFNlcXVlbmNlIGZpbmRTZXF1ZW5jZShTdHJpbmcgbmFtZSkg\newogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBpbnQgZG90SWR4ID0gbmFtZS5pbmRleE9mKCcu\nJyk7CiAgICAgICAgaWYgKGRvdElkeCAhPSAtMSkgewogICAgICAgICAgICBT\ndHJpbmcgc2NoZW1hTmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIGRvdElkeCk7\nCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZyhkb3RJZHggKyAx\nKTsKICAgICAgICAgICAgU2NoZW1hIHNjaGVtYSA9IGdldFNjaGVtYShzY2hl\nbWFOYW1lKTsKICAgICAgICAgICAgaWYgKHNjaGVtYSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIHNjaGVtYS5nZXRTZXF1ZW5jZShuYW1lKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTY2hlbWFbXSBzY2hlbWFz\nID0gZ2V0U2NoZW1hcygpOwogICAgICAgICAgICBTZXF1ZW5jZSBzZXE7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgc2VxID0gc2NoZW1hc1tpXS5nZXRT\nZXF1ZW5jZShuYW1lKTsKICAgICAgICAgICAgICAgIGlmIChzZXEgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VxOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAg\nIC8qKgogICAgICogRmluZCB0aGUgc2VxdWVuY2Ugd2l0aCB0aGUgZ2l2ZW4g\nbmFtZSBpbiB0aGUgZ3JvdXAsIHVzaW5nICcuJyBhcyB0aGUKICAgICAqIGNh\ndGFsb2cgc2VwYXJhdG9yLiBSZXR1cm5zIG51bGwgaWYgbm8gc2VxdWVuY2Ug\nZm91bmQuCiAgICAgKi8KICAgIHB1YmxpYyBTZXF1ZW5jZSBmaW5kU2VxdWVu\nY2UoU2NoZW1hIGluU2NoZW1hLCBTdHJpbmcgbmFtZSkgewogICAgICAgIGlm\nIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBpbnQgZG90SWR4ID0gbmFtZS5pbmRleE9mKCcuJyk7CiAgICAgICAg\naWYgKGRvdElkeCAhPSAtMSkgewogICAgICAgICAgICBTdHJpbmcgc2NoZW1h\nTmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIGRvdElkeCk7CiAgICAgICAgICAg\nIG5hbWUgPSBuYW1lLnN1YnN0cmluZyhkb3RJZHggKyAxKTsKICAgICAgICAg\nICAgU2NoZW1hIHNjaGVtYSA9IGdldFNjaGVtYShzY2hlbWFOYW1lKTsKICAg\nICAgICAgICAgaWYgKHNjaGVtYSAhPSBudWxsKQogICAgICAgICAgICAgICAg\ncmV0dXJuIHNjaGVtYS5nZXRTZXF1ZW5jZShuYW1lKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBTY2hlbWFbXSBzY2hlbWFzID0gZ2V0U2NoZW1h\ncygpOwogICAgICAgICAgICBTZXF1ZW5jZSBzZXE7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgc2VxID0gc2NoZW1hc1tpXS5nZXRTZXF1ZW5jZShuYW1l\nKTsKICAgICAgICAgICAgICAgIGlmICgoc2VxICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgICYmIChzY2hlbWFzW2ldID09IGluU2NoZW1hIHx8\nIGluU2NoZW1hLmdldE5hbWUoKSA9PSBudWxsKSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gc2VxOwogICAgICAgICAgICB9CgogICAgICAgIH0KICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQg\nYWxsIGZvcmVpZ24ga2V5cyBleHBvcnRlZCBieSBhIGdpdmVuIHByaW1hcnkg\na2V5IChhbGwgZm9yZWlnbiBrZXlzCiAgICAgKiB0aGF0IGxpbmsgdG8gdGhl\nIHByaW1hcnkga2V5KS4KICAgICAqLwogICAgcHVibGljIEZvcmVpZ25LZXlb\nXSBmaW5kRXhwb3J0ZWRGb3JlaWduS2V5cyhQcmltYXJ5S2V5IHBrKSB7CiAg\nICAgICAgaWYgKHBrID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcg\nRm9yZWlnbktleVswXTsKCiAgICAgICAgU2NoZW1hW10gc2NoZW1hcyA9IGdl\ndFNjaGVtYXMoKTsKICAgICAgICBUYWJsZVtdIHRhYnM7CiAgICAgICAgRm9y\nZWlnbktleVtdIGZrczsKICAgICAgICBDb2xsZWN0aW9uIGV4cG9ydHMgPSBu\nZXcgTGlua2VkTGlzdCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0YWJzID0gc2No\nZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9\nIDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBm\na3MgPSB0YWJzW2pdLmdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAgICAgICAg\nICBmb3IgKGludCBrID0gMDsgayA8IGZrcy5sZW5ndGg7IGsrKykgewogICAg\nICAgICAgICAgICAgICAgIGlmIChma3Nba10uZ2V0UHJpbWFyeUtleVRhYmxl\nKCkgIT0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAmJiBway5lcXVh\nbHMoZmtzW2tdLmdldFByaW1hcnlLZXlUYWJsZSgpLgogICAgICAgICAgICAg\nICAgICAgICAgICBnZXRQcmltYXJ5S2V5KCkpKQogICAgICAgICAgICAgICAg\nICAgICAgICBleHBvcnRzLmFkZChma3Nba10pOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAoRm9y\nZWlnbktleVtdKSBleHBvcnRzLnRvQXJyYXkobmV3IEZvcmVpZ25LZXlbZXhw\nb3J0cy5zaXplKCldKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB1\nbnJlZmVyZW5jZWQgb3IgZW10cHkgY29tcG9uZW50cyBmcm9tIHRoZSBzY2hl\nbWEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlbW92ZVVudXNlZENvbXBv\nbmVudHMoKSB7CiAgICAgICAgU2NoZW1hW10gc2NoZW1hcyA9IGdldFNjaGVt\nYXMoKTsKICAgICAgICBUYWJsZVtdIHRhYnM7CiAgICAgICAgQ29sdW1uW10g\nY29sczsKICAgICAgICBTZXF1ZW5jZVtdIHNlcXM7CiAgICAgICAgUHJpbWFy\neUtleSBwazsKICAgICAgICBGb3JlaWduS2V5W10gZmtzOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBzZXFzID0gc2NoZW1hc1tpXS5nZXRTZXF1ZW5jZXMoKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBzZXFzLmxlbmd0aDsgaisr\nKQogICAgICAgICAgICAgICAgaWYgKHNlcXNbal0uZ2V0UmVmQ291bnQoKSA9\nPSAwKQogICAgICAgICAgICAgICAgICAgIHNjaGVtYXNbaV0ucmVtb3ZlU2Vx\ndWVuY2Uoc2Vxc1tqXSk7CgogICAgICAgICAgICB0YWJzID0gc2NoZW1hc1tp\nXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGog\nPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBwayA9IHRh\nYnNbal0uZ2V0UHJpbWFyeUtleSgpOwogICAgICAgICAgICAgICAgZmtzID0g\ndGFic1tqXS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgICAgICAgICAgY29s\ncyA9IHRhYnNbal0uZ2V0Q29sdW1ucygpOwoKICAgICAgICAgICAgICAgIGlm\nIChwayAhPSBudWxsICYmIHBrLmdldFJlZkNvdW50KCkgPT0gMCkKICAgICAg\nICAgICAgICAgICAgICB0YWJzW2pdLnJlbW92ZVByaW1hcnlLZXkoKTsKCiAg\nICAgICAgICAgICAgICBmb3IgKGludCBrID0gMDsgayA8IGZrcy5sZW5ndGg7\nIGsrKykKICAgICAgICAgICAgICAgICAgICBpZiAoZmtzW2tdLmdldFJlZkNv\ndW50KCkgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgdGFic1tqXS5y\nZW1vdmVGb3JlaWduS2V5KGZrc1trXSk7CgogICAgICAgICAgICAgICAgZm9y\nIChpbnQgayA9IDA7IGsgPCBjb2xzLmxlbmd0aDsgaysrKQogICAgICAgICAg\nICAgICAgICAgIGlmIChjb2xzW2tdLmdldFJlZkNvdW50KCkgPT0gMCkKICAg\nICAgICAgICAgICAgICAgICAgICAgdGFic1tqXS5yZW1vdmVDb2x1bW4oY29s\nc1trXSk7CgogICAgICAgICAgICAgICAgaWYgKHRhYnNbal0uZ2V0Q29sdW1u\ncygpLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgICAgIHNjaGVtYXNb\naV0ucmVtb3ZlVGFibGUodGFic1tqXSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGlmIChzY2hlbWFzW2ldLmdldFRhYmxlcygpLmxlbmd0aCA9PSAw\nKQogICAgICAgICAgICAgICAgcmVtb3ZlU2NoZW1hKHNjaGVtYXNbaV0pOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGNsb25lKCkgewog\nICAgICAgIFNjaGVtYUdyb3VwIGNsb25lID0gbmV3SW5zdGFuY2UoKTsKICAg\nICAgICBjbG9uZS5jb3B5KHRoaXMpOwogICAgICAgIHJldHVybiBjbG9uZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBv\nZiB0aGlzIGNsYXNzLgogICAgICovCiAgICBwcm90ZWN0ZWQgU2NoZW1hR3Jv\ndXAgbmV3SW5zdGFuY2UoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTY2hlbWFH\ncm91cCgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29weSBjbG9uZWFibGUg\nc3RhdGUgZnJvbSB0aGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIGNvcHkoU2NoZW1hR3JvdXAgZ3JvdXApIHsKICAgICAg\nICBTY2hlbWFbXSBzY2hlbWFzID0gZ3JvdXAuZ2V0U2NoZW1hcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgaW1wb3J0U2NoZW1hKHNjaGVtYXNbaV0pOwoKICAgICAg\nICAvLyBoYXZlIHRvIGRvIGZrcyBhZnRlciBhbGwgc2NoZW1hcyBhcmUgaW1w\nb3J0ZWQKICAgICAgICBUYWJsZVtdIHRhYnM7CiAgICAgICAgRm9yZWlnbktl\neVtdIGZrczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNbaV0u\nZ2V0VGFibGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwg\ndGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgZmtzID0gdGFi\nc1tqXS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgICAgICAgICAgZm9yIChp\nbnQgayA9IDA7IGsgPCBma3MubGVuZ3RoOyBrKyspCiAgICAgICAgICAgICAg\nICAgICAgZ2V0U2NoZW1hKHNjaGVtYXNbaV0uZ2V0TmFtZSgpKS5nZXRUYWJs\nZQogICAgICAgICAgICAgICAgICAgICAgICAodGFic1tqXS5nZXROYW1lKCkp\nLmltcG9ydEZvcmVpZ25LZXkoZmtzW2tdKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBzY2hl\nbWEgd2l0aCB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFNjaGVtYSBuZXdTY2hlbWEoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1\ncm4gbmV3IFNjaGVtYShuYW1lLCB0aGlzKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBhIG5ldyBzZXF1ZW5jZSB3aXRoIHRoZSBnaXZlbiBuYW1l\nIGFuZCBvd25lciBzY2hlbWEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTZXF1\nZW5jZSBuZXdTZXF1ZW5jZShTdHJpbmcgbmFtZSwgU2NoZW1hIHNjaGVtYSkg\newogICAgICAgIHJldHVybiBuZXcgU2VxdWVuY2UobmFtZSwgc2NoZW1hKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyB0YWJsZSB3aXRo\nIHRoZSBnaXZlbiBuYW1lIGFuZCBvd25lciBzY2hlbWEuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBUYWJsZSBuZXdUYWJsZShTdHJpbmcgbmFtZSwgU2NoZW1h\nIHNjaGVtYSkgewogICAgICAgIHJldHVybiBuZXcgVGFibGUobmFtZSwgc2No\nZW1hKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBjb2x1\nbW4gd2l0aCB0aGUgZ2l2ZW4gbmFtZSBhbmQgb3duZXIgdGFibGUuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBDb2x1bW4gbmV3Q29sdW1uKFN0cmluZyBuYW1l\nLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVybiBuZXcgQ29sdW1uKG5h\nbWUsIHRhYmxlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5l\ndyBwcmltYXJ5IGtleSB3aXRoIHRoZSBnaXZlbiBuYW1lIGFuZCBvd25lciB0\nYWJsZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFByaW1hcnlLZXkgbmV3UHJp\nbWFyeUtleShTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICBy\nZXR1cm4gbmV3IFByaW1hcnlLZXkobmFtZSwgdGFibGUpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgbmV3IGluZGV4IHdpdGggdGhlIGdpdmVu\nIG5hbWUgYW5kIG93bmVyIHRhYmxlLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nSW5kZXggbmV3SW5kZXgoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAg\nICAgICAgcmV0dXJuIG5ldyBJbmRleChuYW1lLCB0YWJsZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYSBuZXcgdW5pcXVlIGNvbnN0cmFpbnQg\nd2l0aCB0aGUgZ2l2ZW4gbmFtZSBhbmQgb3duZXIgdGFibGUuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBVbmlxdWUgbmV3VW5pcXVlKFN0cmluZyBuYW1lLCBU\nYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVybiBuZXcgVW5pcXVlKG5hbWUs\nIHRhYmxlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBm\nb3JlaWduIGtleSB3aXRoIHRoZSBnaXZlbiBuYW1lIGFuZCBvd25lciB0YWJs\nZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZvcmVpZ25LZXkgbmV3Rm9yZWln\nbktleShTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1\ncm4gbmV3IEZvcmVpZ25LZXkobmFtZSwgdGFibGUpOwogICAgfQp9Cg==\n","encoding":"base64"}

