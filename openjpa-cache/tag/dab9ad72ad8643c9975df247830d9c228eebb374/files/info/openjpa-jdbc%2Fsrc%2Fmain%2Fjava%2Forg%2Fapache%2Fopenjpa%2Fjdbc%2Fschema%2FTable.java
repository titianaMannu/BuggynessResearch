{"sha":"926cccf14a61a6e6f9c7b9439daa79be7eef6fbf","node_id":"MDQ6QmxvYjIwNjM2NDo5MjZjY2NmMTRhNjFhNmU2ZjljN2I5NDM5ZGFhNzliZTdlZWY2ZmJm","size":20132,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/926cccf14a61a6e6f9c7b9439daa79be7eef6fbf","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGls\nLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5UcmVlTWFwOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZEhhc2hNYXA7\nCgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuU291cmNlVHJh\nY2tlcjsKCi8qKgogKiBSZXByZXNlbnRzIGEgZGF0YWJhc2UgdGFibGUuCiAq\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgU3RlcGhlbiBLaW0K\nICovCnB1YmxpYyBjbGFzcyBUYWJsZQogICAgZXh0ZW5kcyBOYW1lU2V0CiAg\nICBpbXBsZW1lbnRzIENvbXBhcmFibGUsIFNvdXJjZVRyYWNrZXIgewoKICAg\nIHByaXZhdGUgU3RyaW5nIF9uYW1lID0gbnVsbDsKICAgIHByaXZhdGUgU3Ry\naW5nIF9zY2hlbWFOYW1lID0gbnVsbDsKICAgIHByaXZhdGUgTWFwIF9jb2xN\nYXAgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2lkeE1hcCA9IG51bGw7CiAg\nICBwcml2YXRlIENvbGxlY3Rpb24gX2ZrTGlzdCA9IG51bGw7CiAgICBwcml2\nYXRlIENvbGxlY3Rpb24gX3VucUxpc3QgPSBudWxsOwogICAgcHJpdmF0ZSBT\nY2hlbWEgX3NjaGVtYSA9IG51bGw7CiAgICBwcml2YXRlIFByaW1hcnlLZXkg\nX3BrID0gbnVsbDsKCiAgICAvLyBrZWVwIHRyYWNrIG9mIHNvdXJjZQogICAg\ncHJpdmF0ZSBGaWxlIF9zb3VyY2UgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQg\nX3NyY1R5cGUgPSBTUkNfT1RIRVI7CgogICAgLy8gY2FjaGUKICAgIHByaXZh\ndGUgU3RyaW5nIF9mdWxsTmFtZSA9IG51bGw7CiAgICBwcml2YXRlIENvbHVt\nbltdIF9jb2xzID0gbnVsbDsKICAgIHByaXZhdGUgQ29sdW1uW10gX2F1dG9B\nc3NpZ24gPSBudWxsOwogICAgcHJpdmF0ZSBDb2x1bW5bXSBfcmVscyA9IG51\nbGw7CiAgICBwcml2YXRlIEZvcmVpZ25LZXlbXSBfZmtzID0gbnVsbDsKICAg\nIHByaXZhdGUgSW5kZXhbXSBfaWR4cyA9IG51bGw7CiAgICBwcml2YXRlIFVu\naXF1ZVtdIF91bnFzID0gbnVsbDsKCiAgICAvKioKICAgICAqIERlZmF1bHQg\nY29uc3RydWN0b3IuCiAgICAgKi8KICAgIHB1YmxpYyBUYWJsZSgpIHsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLgogICAgICoKICAgICAq\nIEBwYXJhbSBuYW1lIHRoZSB0YWJsZSBuYW1lCiAgICAgKiBAcGFyYW0gc2No\nZW1hIHRoZSB0YWJsZSBzY2hlbWEKICAgICAqLwogICAgcHVibGljIFRhYmxl\nKFN0cmluZyBuYW1lLCBTY2hlbWEgc2NoZW1hKSB7CiAgICAgICAgc2V0TmFt\nZShuYW1lKTsKICAgICAgICBhZGROYW1lKG5hbWUsIHRydWUpOwogICAgICAg\nIGlmIChzY2hlbWEgIT0gbnVsbCkKICAgICAgICAgICAgc2V0U2NoZW1hTmFt\nZShzY2hlbWEuZ2V0TmFtZSgpKTsKICAgICAgICBfc2NoZW1hID0gc2NoZW1h\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsbGVkIHdoZW4gdGhlIHRhYmxl\nIGlzIHJlbW92ZWQgZnJvbSBpdHMgc2NoZW1hLiBSZW1vdmVzIGFsbCB0YWJs\nZQogICAgICogbWVtYmVycywgYW5kIGludmFsaWRhdGVzIHRoZSB0YWJsZS4K\nICAgICAqLwogICAgdm9pZCByZW1vdmUoKSB7CiAgICAgICAgRm9yZWlnbktl\neVtdIGZrcyA9IGdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBma3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHJlbW92\nZUZvcmVpZ25LZXkoZmtzW2ldKTsKICAgICAgICBJbmRleFtdIGlkeHMgPSBn\nZXRJbmRleGVzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpZHhz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICByZW1vdmVJbmRleChpZHhzW2ld\nKTsKICAgICAgICBVbmlxdWVbXSB1bnFzID0gZ2V0VW5pcXVlcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdW5xcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgcmVtb3ZlVW5pcXVlKHVucXNbaV0pOwogICAgICAgIHJlbW92\nZVByaW1hcnlLZXkoKTsKICAgICAgICBDb2x1bW5bXSBjb2xzID0gZ2V0Q29s\ndW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgcmVtb3ZlQ29sdW1uKGNvbHNbaV0pOwog\nICAgICAgIF9zY2hlbWEgPSBudWxsOwogICAgICAgIF9zY2hlbWFOYW1lID0g\nbnVsbDsKICAgICAgICBfZnVsbE5hbWUgPSBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBzY2hlbWEgZm9yIHRoZSB0YWJsZS4KICAg\nICAqLwogICAgcHVibGljIFNjaGVtYSBnZXRTY2hlbWEoKSB7CiAgICAgICAg\ncmV0dXJuIF9zY2hlbWE7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgdGFi\nbGUncyBzY2hlbWEgbmFtZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBn\nZXRTY2hlbWFOYW1lKCkgewogICAgICAgIHJldHVybiBfc2NoZW1hTmFtZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB0YWJsZSdzIHNjaGVtYSBuYW1l\nLiBZb3UgY2FuIG9ubHkgY2FsbCB0aGlzIG1ldGhvZCBvbiB0YWJsZXMKICAg\nICAqIHdob3NlIHNjaGVtYSBvYmplY3QgaXMgbm90IHNldC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0U2NoZW1hTmFtZShTdHJpbmcgbmFtZSkgewog\nICAgICAgIGlmIChnZXRTY2hlbWEoKSAhPSBudWxsKQogICAgICAgICAgICB0\naHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCk7CiAgICAgICAgX3Nj\naGVtYU5hbWUgPSBuYW1lOwogICAgICAgIF9mdWxsTmFtZSA9IG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIHRh\nYmxlLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldE5hbWUoKSB7CiAg\nICAgICAgcmV0dXJuIF9uYW1lOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBuYW1lIG9mIHRoZSB0YWJsZS4gVGhpcyBtZXRob2QgY2FuIG9ubHkg\nYmUgY2FsbGVkIG9uIHRhYmxlcwogICAgICogdGhhdCBhcmUgbm90IHBhcnQg\nb2YgYSBzY2hlbWEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE5hbWUo\nU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoZ2V0U2NoZW1hKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlv\nbigpOwogICAgICAgIF9uYW1lID0gbmFtZTsKICAgICAgICBfZnVsbE5hbWUg\nPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB0YWJs\nZSBuYW1lLCBpbmNsdWRpbmcgc2NoZW1hLCB1c2luZyAnLicgYXMgdGhlCiAg\nICAgKiBjYXRhbG9nIHNlcGFyYXRvci4KICAgICAqLwogICAgcHVibGljIFN0\ncmluZyBnZXRGdWxsTmFtZSgpIHsKICAgICAgICBpZiAoX2Z1bGxOYW1lID09\nIG51bGwpIHsKICAgICAgICAgICAgU2NoZW1hIHNjaGVtYSA9IGdldFNjaGVt\nYSgpOwogICAgICAgICAgICBpZiAoc2NoZW1hID09IG51bGwgfHwgc2NoZW1h\nLmdldE5hbWUoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgX2Z1bGxOYW1l\nID0gZ2V0TmFtZSgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBfZnVsbE5hbWUgPSBzY2hlbWEuZ2V0TmFtZSgpICsgIi4iICsgZ2V0TmFt\nZSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2Z1bGxOYW1lOwogICAg\nfQoKICAgIHB1YmxpYyBGaWxlIGdldFNvdXJjZUZpbGUoKSB7CiAgICAgICAg\ncmV0dXJuIF9zb3VyY2U7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRT\nb3VyY2VTY29wZSgpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IGdldFNvdXJjZVR5cGUoKSB7CiAgICAgICAgcmV0dXJu\nIF9zcmNUeXBlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFNvdXJjZShG\naWxlIHNvdXJjZSwgaW50IHNyY1R5cGUpIHsKICAgICAgICBfc291cmNlID0g\nc291cmNlOwogICAgICAgIF9zcmNUeXBlID0gc3JjVHlwZTsKICAgIH0KCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFJlc291cmNlTmFtZSgpIHsKICAgICAgICBy\nZXR1cm4gZ2V0RnVsbE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgdGFibGUncyBjb2x1bW5zLCBpbiBhbHBoYWJldGljYWwgb3Jk\nZXIuCiAgICAgKi8KICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRDb2x1bW5zKCkg\newogICAgICAgIGlmIChfY29scyA9PSBudWxsKSB7CiAgICAgICAgICAgIGlm\nIChfY29sTWFwID09IG51bGwpCiAgICAgICAgICAgICAgICBfY29scyA9IFNj\naGVtYXMuRU1QVFlfQ09MVU1OUzsKICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICBDb2x1bW5bXSBjb2xzID0gbmV3IENvbHVtbltfY29sTWFw\nLnNpemUoKV07CiAgICAgICAgICAgICAgICBJdGVyYXRvciBpdHIgPSBfY29s\nTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaXRyLmhhc05leHQoKTsgaSsrKSB7CiAgICAgICAgICAg\nICAgICAgICAgY29sc1tpXSA9IChDb2x1bW4pIGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgICAgICAgICAgY29sc1tpXS5zZXRJbmRleChpKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIF9jb2xzID0gY29sczsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2NvbHM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhpcyB0YWJsZSdzIGF1dG8tYXNz\naWduZWQgY29sdW1ucy4KICAgICAqLwogICAgcHVibGljIENvbHVtbltdIGdl\ndEF1dG9Bc3NpZ25lZENvbHVtbnMoKSB7CiAgICAgICAgaWYgKF9hdXRvQXNz\naWduID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9jb2xNYXAgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9hdXRvQXNzaWduID0gU2NoZW1hcy5FTVBU\nWV9DT0xVTU5TOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAg\nIENvbGxlY3Rpb24gYXV0b3MgPSBudWxsOwogICAgICAgICAgICAgICAgQ29s\ndW1uW10gY29scyA9IGdldENvbHVtbnMoKTsKICAgICAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgICAgIGlmIChjb2xzW2ldLmlzQXV0b0Fzc2lnbmVkKCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dG9zID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvcyA9IG5ldyBBcnJheUxp\nc3QoMyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9zLmFkZChjb2xz\nW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBfYXV0b0Fzc2lnbiA9IChhdXRvcyA9PSBudWxs\nKSA/IFNjaGVtYXMuRU1QVFlfQ09MVU1OUwogICAgICAgICAgICAgICAgICAg\nIDogKENvbHVtbltdKSBhdXRvcy50b0FycmF5KG5ldyBDb2x1bW5bYXV0b3Mu\nc2l6ZSgpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIF9hdXRvQXNzaWduOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoaXMgdGFibGUncyByZWxhdGlvbiBpZCBjb2x1bW5zLgogICAgICovCiAg\nICBwdWJsaWMgQ29sdW1uW10gZ2V0UmVsYXRpb25JZENvbHVtbnMoKSB7CiAg\nICAgICAgaWYgKF9yZWxzID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9j\nb2xNYXAgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9yZWxzID0gU2NoZW1h\ncy5FTVBUWV9DT0xVTU5TOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIENvbGxlY3Rpb24gcmVscyA9IG51bGw7CiAgICAgICAgICAgICAg\nICBDb2x1bW5bXSBjb2xzID0gZ2V0Q29sdW1ucygpOwogICAgICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGNvbHNbaV0uaXNSZWxhdGlvbklkKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlbHMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbHMgPSBuZXcgQXJyYXlM\naXN0KDMpOwogICAgICAgICAgICAgICAgICAgICAgICByZWxzLmFkZChjb2xz\nW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBfcmVscyA9IChyZWxzID09IG51bGwpID8gU2No\nZW1hcy5FTVBUWV9DT0xVTU5TCiAgICAgICAgICAgICAgICAgICAgOiAoQ29s\ndW1uW10pIHJlbHMudG9BcnJheShuZXcgQ29sdW1uW3JlbHMuc2l6ZSgpXSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9yZWxz\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb2x1bW4gd2l0\naCB0aGUgZ2l2ZW4gbmFtZSwgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAg\nICBwdWJsaWMgQ29sdW1uIGdldENvbHVtbihTdHJpbmcgbmFtZSkgewogICAg\nICAgIGlmIChuYW1lID09IG51bGwgfHwgX2NvbE1hcCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gKENvbHVtbikg\nX2NvbE1hcC5nZXQobmFtZS50b1VwcGVyQ2FzZSgpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCBhIGNvbHVtbiB0byB0aGUgdGFibGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBDb2x1bW4gYWRkQ29sdW1uKFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgYWRkTmFtZShuYW1lLCB0cnVlKTsKICAgICAgICBTY2hlbWEgc2No\nZW1hID0gZ2V0U2NoZW1hKCk7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAg\nICBpZiAoc2NoZW1hICE9IG51bGwgJiYgc2NoZW1hLmdldFNjaGVtYUdyb3Vw\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgY29sID0gc2NoZW1hLmdldFNjaGVt\nYUdyb3VwKCkubmV3Q29sdW1uKG5hbWUsIHRoaXMpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgY29sID0gbmV3IENvbHVtbihuYW1lLCB0aGlzKTsKICAg\nICAgICBpZiAoX2NvbE1hcCA9PSBudWxsKQogICAgICAgICAgICBfY29sTWFw\nID0gbmV3IExpbmtlZEhhc2hNYXAoKTsKICAgICAgICBfY29sTWFwLnB1dChu\nYW1lLnRvVXBwZXJDYXNlKCksIGNvbCk7CiAgICAgICAgX2NvbHMgPSBudWxs\nOwogICAgICAgIHJldHVybiBjb2w7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgdGhlIGdpdmVuIGNvbHVtbiBmcm9tIHRoZSB0YWJsZS4KICAgICAq\nCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGNvbHVtbiB3YXMgcmVtb3Zl\nZCwgZmFsc2UgaWYgbm90IGluIHRoZSB0YWJsZQogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiByZW1vdmVDb2x1bW4oQ29sdW1uIGNvbCkgewogICAgICAg\nIGlmIChjb2wgPT0gbnVsbCB8fCBfY29sTWFwID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgQ29sdW1uIGN1ciA9IChDb2x1\nbW4pIF9jb2xNYXAuZ2V0KGNvbC5nZXROYW1lKCkudG9VcHBlckNhc2UoKSk7\nCiAgICAgICAgaWYgKCFjb2wuZXF1YWxzKGN1cikpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKCiAgICAgICAgcmVtb3ZlTmFtZShjb2wuZ2V0TmFtZSgp\nKTsKICAgICAgICBfY29sTWFwLnJlbW92ZShjb2wuZ2V0TmFtZSgpLnRvVXBw\nZXJDYXNlKCkpOwogICAgICAgIF9jb2xzID0gbnVsbDsKICAgICAgICBpZiAo\nY29sLmlzQXV0b0Fzc2lnbmVkKCkpCiAgICAgICAgICAgIF9hdXRvQXNzaWdu\nID0gbnVsbDsKICAgICAgICBpZiAoY29sLmlzUmVsYXRpb25JZCgpKQogICAg\nICAgICAgICBfcmVscyA9IG51bGw7CiAgICAgICAgY29sLnJlbW92ZSgpOwog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogSW1w\nb3J0IGEgY29sdW1uIGZyb20gYW5vdGhlciB0YWJsZS4KICAgICAqLwogICAg\ncHVibGljIENvbHVtbiBpbXBvcnRDb2x1bW4oQ29sdW1uIGNvbCkgewogICAg\nICAgIGlmIChjb2wgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIENvbHVtbiBjb3B5ID0gYWRkQ29sdW1uKGNvbC5nZXROYW1l\nKCkpOwogICAgICAgIGNvcHkuc2V0VHlwZShjb2wuZ2V0VHlwZSgpKTsKICAg\nICAgICBjb3B5LnNldFR5cGVOYW1lKGNvbC5nZXRUeXBlTmFtZSgpKTsKICAg\nICAgICBjb3B5LnNldEphdmFUeXBlKGNvbC5nZXRKYXZhVHlwZSgpKTsKICAg\nICAgICBjb3B5LnNldE5vdE51bGwoY29sLmlzTm90TnVsbCgpKTsKICAgICAg\nICBjb3B5LnNldERlZmF1bHRTdHJpbmcoY29sLmdldERlZmF1bHRTdHJpbmco\nKSk7CiAgICAgICAgY29weS5zZXRTaXplKGNvbC5nZXRTaXplKCkpOwogICAg\nICAgIGNvcHkuc2V0RGVjaW1hbERpZ2l0cyhjb2wuZ2V0RGVjaW1hbERpZ2l0\ncygpKTsKICAgICAgICBjb3B5LnNldEF1dG9Bc3NpZ25lZChjb2wuaXNBdXRv\nQXNzaWduZWQoKSk7CiAgICAgICAgcmV0dXJuIGNvcHk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByaW1hcnkga2V5IGZvciB0aGUgdGFi\nbGUsIGlmIGFueS4KICAgICAqLwogICAgcHVibGljIFByaW1hcnlLZXkgZ2V0\nUHJpbWFyeUtleSgpIHsKICAgICAgICByZXR1cm4gX3BrOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSBwcmltYXJ5IGtleSBmb3IgdGhlIHRhYmxl\nLgogICAgICovCiAgICBwdWJsaWMgUHJpbWFyeUtleSBhZGRQcmltYXJ5S2V5\nKCkgewogICAgICAgIHJldHVybiBhZGRQcmltYXJ5S2V5KG51bGwpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBwcmltYXJ5IGtleSBmb3IgdGhl\nIHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgUHJpbWFyeUtleSBhZGRQcmlt\nYXJ5S2V5KFN0cmluZyBuYW1lKSB7CiAgICAgICAgU2NoZW1hIHNjaGVtYSA9\nIGdldFNjaGVtYSgpOwogICAgICAgIGlmIChzY2hlbWEgIT0gbnVsbCAmJiBz\nY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKSAhPSBudWxsKSB7CiAgICAgICAgICAg\nIHNjaGVtYS5nZXRTY2hlbWFHcm91cCgpLmFkZE5hbWUobmFtZSwgZmFsc2Up\nOwogICAgICAgICAgICBfcGsgPSBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKS5u\nZXdQcmltYXJ5S2V5KG5hbWUsIHRoaXMpOwogICAgICAgIH0gZWxzZQogICAg\nICAgICAgICBfcGsgPSBuZXcgUHJpbWFyeUtleShuYW1lLCB0aGlzKTsKICAg\nICAgICByZXR1cm4gX3BrOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3Zl\nIHRoZSBwcmltYXJ5IGtleSBmcm9tIHRoaXMgdGFibGUuCiAgICAgKgogICAg\nICogQHJldHVybiB0cnVlIGlmIHRoZXJlIHdhcyBhIHBrIHRvIHJlbW92ZSwg\nZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJl\nbW92ZVByaW1hcnlLZXkoKSB7CiAgICAgICAgYm9vbGVhbiByZW0gPSBfcGsg\nIT0gbnVsbDsKICAgICAgICBpZiAocmVtKSB7CiAgICAgICAgICAgIFNjaGVt\nYSBzY2hlbWEgPSBnZXRTY2hlbWEoKTsKICAgICAgICAgICAgaWYgKHNjaGVt\nYSAhPSBudWxsICYmIHNjaGVtYS5nZXRTY2hlbWFHcm91cCgpICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKS5yZW1v\ndmVOYW1lKF9way5nZXROYW1lKCkpOwogICAgICAgICAgICBfcGsucmVtb3Zl\nKCk7CiAgICAgICAgfQogICAgICAgIF9wayA9IG51bGw7CiAgICAgICAgcmV0\ndXJuIHJlbTsKICAgIH0KCiAgICAvKioKICAgICAqIEltcG9ydCBhIHByaW1h\ncnkga2V5OyBjb2x1bW4gbmFtZXMgbXVzdCBtYXRjaCBjb2x1bW5zIG9mIHRo\naXMgdGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBQcmltYXJ5S2V5IGltcG9y\ndFByaW1hcnlLZXkoUHJpbWFyeUtleSBwaykgewogICAgICAgIGlmIChwayA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgUHJp\nbWFyeUtleSBjb3B5ID0gYWRkUHJpbWFyeUtleShway5nZXROYW1lKCkpOwog\nICAgICAgIGNvcHkuc2V0TG9naWNhbChway5pc0xvZ2ljYWwoKSk7CiAgICAg\nICAgQ29sdW1uW10gY29scyA9IHBrLmdldENvbHVtbnMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgIGNvcHkuYWRkQ29sdW1uKGdldENvbHVtbihjb2xzW2ldLmdldE5hbWUo\nKSkpOwogICAgICAgIHJldHVybiBjb3B5OwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBmb3JlaWduIGtleSB3aXRoIHRoZSBnaXZlbiBuYW1l\nLiBJZiBtdWx0aXBsZSBmb3JlaWduIGtleXMKICAgICAqIGhhdmUgdGhlIG5h\nbWUsIHRoZSBmaXJzdCBtYXRjaCBpcyByZXR1cm5lZC4KICAgICAqLwogICAg\ncHVibGljIEZvcmVpZ25LZXkgZ2V0Rm9yZWlnbktleShTdHJpbmcgbmFtZSkg\newogICAgICAgIEZvcmVpZ25LZXlbXSBma3MgPSBnZXRGb3JlaWduS2V5cygp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmtzLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzSWdub3JlQ2Fz\nZShuYW1lLCBma3NbaV0uZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBma3NbaV07CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gYWxsIGZvcmVpZ24ga2V5cyBmb3IgdGhlIHRh\nYmxlLgogICAgICovCiAgICBwdWJsaWMgRm9yZWlnbktleVtdIGdldEZvcmVp\nZ25LZXlzKCkgewogICAgICAgIGlmIChfZmtzID09IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKF9ma0xpc3QgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9m\na3MgPSBTY2hlbWFzLkVNUFRZX0ZPUkVJR05fS0VZUzsKICAgICAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgICAgICBGb3JlaWduS2V5W10gZmtzID0gbmV3\nIEZvcmVpZ25LZXlbX2ZrTGlzdC5zaXplKCldOwogICAgICAgICAgICAgICAg\nSXRlcmF0b3IgaXRyID0gX2ZrTGlzdC5pdGVyYXRvcigpOwogICAgICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGl0ci5oYXNOZXh0KCk7IGkrKykgewog\nICAgICAgICAgICAgICAgICAgIGZrc1tpXSA9IChGb3JlaWduS2V5KSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGZrc1tpXS5zZXRJbmRleChp\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9ma3MgPSBm\na3M7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9m\na3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBmb3JlaWduIGtleSB0\nbyB0aGUgdGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBGb3JlaWduS2V5IGFk\nZEZvcmVpZ25LZXkoKSB7CiAgICAgICAgcmV0dXJuIGFkZEZvcmVpZ25LZXko\nbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBmb3JlaWduIGtl\neSB0byB0aGUgdGFibGUuIER1cGxpY2F0ZSBrZXkgbmFtZXMgYXJlIG5vdCBh\nbGxvd2VkLgogICAgICovCiAgICBwdWJsaWMgRm9yZWlnbktleSBhZGRGb3Jl\naWduS2V5KFN0cmluZyBuYW1lKSB7CiAgICAgICAgU2NoZW1hIHNjaGVtYSA9\nIGdldFNjaGVtYSgpOwogICAgICAgIEZvcmVpZ25LZXkgZms7CiAgICAgICAg\naWYgKHNjaGVtYSAhPSBudWxsICYmIHNjaGVtYS5nZXRTY2hlbWFHcm91cCgp\nICE9IG51bGwpIHsKICAgICAgICAgICAgc2NoZW1hLmdldFNjaGVtYUdyb3Vw\nKCkuYWRkTmFtZShuYW1lLCBmYWxzZSk7CiAgICAgICAgICAgIGZrID0gc2No\nZW1hLmdldFNjaGVtYUdyb3VwKCkubmV3Rm9yZWlnbktleShuYW1lLCB0aGlz\nKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgZmsgPSBuZXcgRm9yZWln\nbktleShuYW1lLCB0aGlzKTsKICAgICAgICBpZiAoX2ZrTGlzdCA9PSBudWxs\nKQogICAgICAgICAgICBfZmtMaXN0ID0gbmV3IEFycmF5TGlzdCgzKTsKICAg\nICAgICBfZmtMaXN0LmFkZChmayk7CiAgICAgICAgX2ZrcyA9IG51bGw7CiAg\nICAgICAgcmV0dXJuIGZrOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3Zl\nIHRoZSBnaXZlbiBmb3JlaWduIGtleSBmcm9tIHRoZSB0YWJsZS4KICAgICAq\nCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGtleSB3YXMgcmVtb3ZlZCwg\nZmFsc2UgaWYgbm90IGluIHRoZSB0YWJsZQogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiByZW1vdmVGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmspIHsKICAg\nICAgICBpZiAoZmsgPT0gbnVsbCB8fCBfZmtMaXN0ID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYgKCFfZmtMaXN0LnJl\nbW92ZShmaykpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAg\nU2NoZW1hIHNjaGVtYSA9IGdldFNjaGVtYSgpOwogICAgICAgIGlmIChzY2hl\nbWEgIT0gbnVsbCAmJiBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKSAhPSBudWxs\nKQogICAgICAgICAgICBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKS5yZW1vdmVO\nYW1lKGZrLmdldE5hbWUoKSk7CiAgICAgICAgX2ZrcyA9IG51bGw7CiAgICAg\nICAgZmsucmVtb3ZlKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbXBvcnQgYSBmb3JlaWduIGtleTsgY29sdW1uIG5h\nbWVzIG11c3QgbWF0Y2ggY29sdW1ucyBvZiB0aGlzIHRhYmxlLgogICAgICov\nCiAgICBwdWJsaWMgRm9yZWlnbktleSBpbXBvcnRGb3JlaWduS2V5KEZvcmVp\nZ25LZXkgZmspIHsKICAgICAgICBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIEZvcmVpZ25LZXkgY29weSA9IGFk\nZEZvcmVpZ25LZXkoZmsuZ2V0TmFtZSgpKTsKICAgICAgICBjb3B5LnNldERl\nbGV0ZUFjdGlvbihmay5nZXREZWxldGVBY3Rpb24oKSk7CgogICAgICAgIFNj\naGVtYSBzY2hlbWEgPSBnZXRTY2hlbWEoKTsKICAgICAgICBpZiAoc2NoZW1h\nICE9IG51bGwgJiYgc2NoZW1hLmdldFNjaGVtYUdyb3VwKCkgIT0gbnVsbCkg\newogICAgICAgICAgICBDb2x1bW5bXSBwa3MgPSBmay5nZXRQcmltYXJ5S2V5\nQ29sdW1ucygpOwogICAgICAgICAgICBUYWJsZSBqb2luZWQgPSBudWxsOwog\nICAgICAgICAgICBpZiAocGtzLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAg\nICBqb2luZWQgPSBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKS5maW5kVGFibGUo\ncGtzWzBdLmdldFRhYmxlKCkpOwoKICAgICAgICAgICAgQ29sdW1uW10gY29s\ncyA9IGZrLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgY29w\neS5qb2luKGdldENvbHVtbihjb2xzW2ldLmdldE5hbWUoKSksCiAgICAgICAg\nICAgICAgICAgICAgam9pbmVkLmdldENvbHVtbihwa3NbaV0uZ2V0TmFtZSgp\nKSk7CgogICAgICAgICAgICBjb2xzID0gZmsuZ2V0Q29uc3RhbnRDb2x1bW5z\nKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNvcHkuam9pbkNvbnN0YW50KGdl\ndENvbHVtbihjb2xzW2ldLmdldE5hbWUoKSksCiAgICAgICAgICAgICAgICAg\nICAgZmsuZ2V0UHJpbWFyeUtleUNvbnN0YW50KGNvbHNbaV0pKTsKCiAgICAg\nICAgICAgIHBrcyA9IGZrLmdldENvbnN0YW50UHJpbWFyeUtleUNvbHVtbnMo\nKTsKICAgICAgICAgICAgaWYgKGpvaW5lZCA9PSBudWxsICYmIHBrcy5sZW5n\ndGggPiAwKQogICAgICAgICAgICAgICAgam9pbmVkID0gc2NoZW1hLmdldFNj\naGVtYUdyb3VwKCkuZmluZFRhYmxlKHBrc1swXS5nZXRUYWJsZSgpKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwa3MubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgICAgICBjb3B5LmpvaW5Db25zdGFudChmay5nZXRDb25z\ndGFudChwa3NbaV0pLAogICAgICAgICAgICAgICAgICAgIGpvaW5lZC5nZXRD\nb2x1bW4ocGtzW2ldLmdldE5hbWUoKSkpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gY29weTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\ndGFibGUncyBpbmRleGVzLgogICAgICovCiAgICBwdWJsaWMgSW5kZXhbXSBn\nZXRJbmRleGVzKCkgewogICAgICAgIGlmIChfaWR4cyA9PSBudWxsIHx8IF9p\nZHhzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICBfaWR4cyA9IChfaWR4TWFw\nID09IG51bGwpID8gU2NoZW1hcy5FTVBUWV9JTkRFWEVTIDogKEluZGV4W10p\nCiAgICAgICAgICAgICAgICBfaWR4TWFwLnZhbHVlcygpLnRvQXJyYXkobmV3\nIEluZGV4W19pZHhNYXAuc2l6ZSgpXSk7CiAgICAgICAgcmV0dXJuIF9pZHhz\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBpbmRleCB3aXRo\nIHRoZSBnaXZlbiBuYW1lLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAg\nIHB1YmxpYyBJbmRleCBnZXRJbmRleChTdHJpbmcgbmFtZSkgewogICAgICAg\nIGlmIChuYW1lID09IG51bGwgfHwgX2lkeE1hcCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gKEluZGV4KSBfaWR4\nTWFwLmdldChuYW1lLnRvVXBwZXJDYXNlKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIGFuIGluZGV4IHRvIHRoZSB0YWJsZS4KICAgICAqLwogICAg\ncHVibGljIEluZGV4IGFkZEluZGV4KFN0cmluZyBuYW1lKSB7CiAgICAgICAg\nU2NoZW1hIHNjaGVtYSA9IGdldFNjaGVtYSgpOwogICAgICAgIEluZGV4IGlk\neDsKICAgICAgICBpZiAoc2NoZW1hICE9IG51bGwgJiYgc2NoZW1hLmdldFNj\naGVtYUdyb3VwKCkgIT0gbnVsbCkgewogICAgICAgICAgICBzY2hlbWEuZ2V0\nU2NoZW1hR3JvdXAoKS5hZGROYW1lKG5hbWUsIHRydWUpOwogICAgICAgICAg\nICBpZHggPSBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKS5uZXdJbmRleChuYW1l\nLCB0aGlzKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgaWR4ID0gbmV3\nIEluZGV4KG5hbWUsIHRoaXMpOwogICAgICAgIGlmIChfaWR4TWFwID09IG51\nbGwpCiAgICAgICAgICAgIF9pZHhNYXAgPSBuZXcgVHJlZU1hcCgpOwogICAg\nICAgIF9pZHhNYXAucHV0KG5hbWUudG9VcHBlckNhc2UoKSwgaWR4KTsKICAg\nICAgICBfaWR4cyA9IG51bGw7CiAgICAgICAgcmV0dXJuIGlkeDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gaW5kZXggZnJvbSB0\naGUgdGFibGUuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBp\nbmRleCB3YXMgcmVtb3ZlZCwgZmFsc2UgaWYgbm90IGluIHRoZSB0YWJsZQog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVJbmRleChJbmRleCBp\nZHgpIHsKICAgICAgICBpZiAoaWR4ID09IG51bGwgfHwgX2lkeE1hcCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIEluZGV4\nIGN1ciA9IChJbmRleCkgX2lkeE1hcC5nZXQoaWR4LmdldE5hbWUoKS50b1Vw\ncGVyQ2FzZSgpKTsKICAgICAgICBpZiAoIWlkeC5lcXVhbHMoY3VyKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBfaWR4TWFwLnJlbW92\nZShpZHguZ2V0TmFtZSgpLnRvVXBwZXJDYXNlKCkpOwogICAgICAgIFNjaGVt\nYSBzY2hlbWEgPSBnZXRTY2hlbWEoKTsKICAgICAgICBpZiAoc2NoZW1hICE9\nIG51bGwgJiYgc2NoZW1hLmdldFNjaGVtYUdyb3VwKCkgIT0gbnVsbCkKICAg\nICAgICAgICAgc2NoZW1hLmdldFNjaGVtYUdyb3VwKCkucmVtb3ZlTmFtZShp\nZHguZ2V0TmFtZSgpKTsKICAgICAgICBpZHgucmVtb3ZlKCk7CiAgICAgICAg\nX2lkeHMgPSBudWxsOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAg\nIC8qKgogICAgICogSW1wb3J0IGFuIGluZGV4OyBjb2x1bW4gbmFtZXMgbXVz\ndCBtYXRjaCBjb2x1bW5zIG9mIHRoaXMgdGFibGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBJbmRleCBpbXBvcnRJbmRleChJbmRleCBpZHgpIHsKICAgICAgICBp\nZiAoaWR4ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBJbmRleCBjb3B5ID0gYWRkSW5kZXgoaWR4LmdldE5hbWUoKSk7CiAg\nICAgICAgY29weS5zZXRVbmlxdWUoaWR4LmlzVW5pcXVlKCkpOwoKICAgICAg\nICBDb2x1bW5bXSBjb2xzID0gaWR4LmdldENvbHVtbnMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgIGNvcHkuYWRkQ29sdW1uKGdldENvbHVtbihjb2xzW2ldLmdldE5hbWUo\nKSkpOwogICAgICAgIHJldHVybiBjb3B5OwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSB0YWJsZSdzIHVuaXF1ZSBjb25zdHJhaW50cy4KICAg\nICAqLwogICAgcHVibGljIFVuaXF1ZVtdIGdldFVuaXF1ZXMoKSB7CiAgICAg\nICAgaWYgKF91bnFzID09IG51bGwpCiAgICAgICAgICAgIF91bnFzID0gKF91\nbnFMaXN0ID09IG51bGwpID8gU2NoZW1hcy5FTVBUWV9VTklRVUVTIDogKFVu\naXF1ZVtdKQogICAgICAgICAgICAgICAgX3VucUxpc3QudG9BcnJheShuZXcg\nVW5pcXVlW191bnFMaXN0LnNpemUoKV0pOwogICAgICAgIHJldHVybiBfdW5x\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdW5pcXVlIGNv\nbnN0cmFpbnQgd2l0aCB0aGUgZ2l2ZW4gbmFtZSwgb3IgbnVsbCBpZiBub25l\nLgogICAgICovCiAgICBwdWJsaWMgVW5pcXVlIGdldFVuaXF1ZShTdHJpbmcg\nbmFtZSkgewogICAgICAgIFVuaXF1ZVtdIHVucXMgPSBnZXRVbmlxdWVzKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB1bnFzLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzSWdub3JlQ2Fz\nZShuYW1lLCB1bnFzW2ldLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gdW5xc1tpXTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCBhIHVuaXF1ZSBjb25zdHJhaW50IHRvIHRoZSB0\nYWJsZS4KICAgICAqLwogICAgcHVibGljIFVuaXF1ZSBhZGRVbmlxdWUoU3Ry\naW5nIG5hbWUpIHsKICAgICAgICBTY2hlbWEgc2NoZW1hID0gZ2V0U2NoZW1h\nKCk7CiAgICAgICAgVW5pcXVlIHVucTsKICAgICAgICBpZiAoc2NoZW1hICE9\nIG51bGwgJiYgc2NoZW1hLmdldFNjaGVtYUdyb3VwKCkgIT0gbnVsbCkgewog\nICAgICAgICAgICBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKS5hZGROYW1lKG5h\nbWUsIGZhbHNlKTsKICAgICAgICAgICAgdW5xID0gc2NoZW1hLmdldFNjaGVt\nYUdyb3VwKCkubmV3VW5pcXVlKG5hbWUsIHRoaXMpOwogICAgICAgIH0gZWxz\nZQogICAgICAgICAgICB1bnEgPSBuZXcgVW5pcXVlKG5hbWUsIHRoaXMpOwog\nICAgICAgIGlmIChfdW5xTGlzdCA9PSBudWxsKQogICAgICAgICAgICBfdW5x\nTGlzdCA9IG5ldyBBcnJheUxpc3QoMyk7CiAgICAgICAgX3VucUxpc3QuYWRk\nKHVucSk7CiAgICAgICAgX3VucXMgPSBudWxsOwogICAgICAgIHJldHVybiB1\nbnE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIHVu\naXF1ZSBjb25zdHJhaW50IGZyb20gdGhlIHRhYmxlLgogICAgICoKICAgICAq\nIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY29uc3RyYWludCB3YXMgcmVtb3ZlZCwg\nZmFsc2UgaWYgbm90IGluIHRoZSB0YWJsZQogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiByZW1vdmVVbmlxdWUoVW5pcXVlIHVucSkgewogICAgICAgIGlm\nICh1bnEgPT0gbnVsbCB8fCBfdW5xTGlzdCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmICghX3VucUxpc3QucmVtb3Zl\nKHVucSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgU2No\nZW1hIHNjaGVtYSA9IGdldFNjaGVtYSgpOwogICAgICAgIGlmIChzY2hlbWEg\nIT0gbnVsbCAmJiBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKSAhPSBudWxsKQog\nICAgICAgICAgICBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKS5yZW1vdmVOYW1l\nKHVucS5nZXROYW1lKCkpOwogICAgICAgIF91bnFzID0gbnVsbDsKICAgICAg\nICB1bnEucmVtb3ZlKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbXBvcnQgYSBjb25zdHJhaW50OyBjb2x1bW4gbmFt\nZXMgbXVzdCBtYXRjaCBjb2x1bW5zIG9mIHRoaXMgdGFibGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBVbmlxdWUgaW1wb3J0VW5pcXVlKFVuaXF1ZSB1bnEpIHsK\nICAgICAgICBpZiAodW5xID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBVbmlxdWUgY29weSA9IGFkZFVuaXF1ZSh1bnEuZ2V0\nTmFtZSgpKTsKICAgICAgICBjb3B5LnNldERlZmVycmVkKHVucS5pc0RlZmVy\ncmVkKCkpOwoKICAgICAgICBDb2x1bW5bXSBjb2xzID0gdW5xLmdldENvbHVt\nbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgIGNvcHkuYWRkQ29sdW1uKGdldENvbHVtbihj\nb2xzW2ldLmdldE5hbWUoKSkpOwogICAgICAgIHJldHVybiBjb3B5OwogICAg\nfQoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IGNvbHVtbnMgdG8gZW5zdXJl\nIHRoYXQgYWxsIGNvbHVtbnMgYXJlIHByb3Blcmx5IGluZGV4ZWQKICAgICAq\nIGJlZm9yZSByZXR1cm5pbmcgdGhhdCBpbmZvcm1hdGlvbiB0byB0aGUgdXNl\nci4KICAgICAqLwogICAgdm9pZCBpbmRleENvbHVtbnMoKSB7CiAgICAgICAg\nZ2V0Q29sdW1ucygpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5\nIGZvcmVpZ24ga2V5cyB0byBlbnN1cmUgdGhhdCBhbGwgZmtzIGFyZSBwcm9w\nZXJseSBpbmRleGVkCiAgICAgKiBiZWZvcmUgcmV0dXJuaW5nIHRoYXQgaW5m\nb3JtYXRpb24gdG8gdGhlIHVzZXIuCiAgICAgKi8KICAgIHZvaWQgaW5kZXhG\nb3JlaWduS2V5cygpIHsKICAgICAgICBnZXRGb3JlaWduS2V5cygpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IGNvbHVtbnMgd2hlbiB0aGVp\nciBhdXRvIGluY3JlbWVudCBzdGF0dXMgY2hhbmdlcy4KICAgICAqLwogICAg\ndm9pZCBjaGFuZ2VBdXRvQXNzaWduZWQoQ29sdW1uIGNvbCkgewogICAgICAg\nIF9hdXRvQXNzaWduID0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENh\nbGxlZCBieSBjb2x1bW5zIHdoZW4gdGhlaXIgcmVsYXRpb24gaWQgc3RhdHVz\nIGNoYW5nZXMuCiAgICAgKi8KICAgIHZvaWQgY2hhbmdlUmVsYXRpb25JZChD\nb2x1bW4gY29sKSB7CiAgICAgICAgX3JlbHMgPSBudWxsOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgY29tcGFyZVRvKE9iamVjdCBvdGhlcikgewogICAgICAg\nIFN0cmluZyBuYW1lID0gZ2V0RnVsbE5hbWUoKTsKICAgICAgICBTdHJpbmcg\nb3RoZXJOYW1lID0gKChUYWJsZSkgb3RoZXIpLmdldEZ1bGxOYW1lKCk7CiAg\nICAgICAgaWYgKG5hbWUgPT0gbnVsbCAmJiBvdGhlck5hbWUgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYgKG90aGVyTmFt\nZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgcmV0\ndXJuIG5hbWUuY29tcGFyZVRvKG90aGVyTmFtZSk7CiAgICB9CgogICAgcHVi\nbGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4gZ2V0RnVs\nbE5hbWUoKTsKICAgIH0KfQo=\n","encoding":"base64"}

