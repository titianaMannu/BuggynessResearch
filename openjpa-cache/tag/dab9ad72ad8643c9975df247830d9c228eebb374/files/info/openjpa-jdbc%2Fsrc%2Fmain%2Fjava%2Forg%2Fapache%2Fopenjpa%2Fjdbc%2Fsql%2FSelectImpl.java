{"sha":"b55b6f7c67b5904768f1a65579037947edf4999a","node_id":"MDQ6QmxvYjIwNjM2NDpiNTViNmY3YzY3YjU5MDQ3NjhmMWE2NTU3OTAzNzk0N2VkZjQ5OTlh","size":93042,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b55b6f7c67b5904768f1a65579037947edf4999a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0\nOwppbXBvcnQgamF2YS51dGlsLlNvcnRlZE1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TdGFjazsKaW1wb3J0IGphdmEudXRpbC5UcmVlTWFwOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5pdGVyYXRvcnMuRW1wdHlJ\ndGVyYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5K\nREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5FYWdlckZldGNoTW9kZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDTG9j\na01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJu\nZWwuSkRCQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\na2VybmVsLkpEQkNTdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5Kb2luYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRl\neHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBv\ncnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogU3RhbmRhcmQge0BsaW5r\nIFNlbGVjdH0gaW1wbGVtZW50YXRpb24uIFVzYWdlIG5vdGU6IHRob3VnaCB0\naGlzIGNsYXNzCiAqIGltcGxlbWVudHMge0BsaW5rIEpvaW5zfSwgaXQgc2hv\ndWxkIG5vdCBiZSB1c2VkIGZvciBqb2luaW5nIGRpcmVjdGx5LgogKiBJbnN0\nZWFkLCB1c2UgdGhlIHJldHVybiB2YWx1ZSBvZiB7QGxpbmsgI25ld0pvaW5z\nfS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIFNlbGVjdEltcGwKICAgIGltcGxlbWVudHMgU2VsZWN0\nLCBQYXRoSm9pbnMgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBO\nT05BVVRPX0RJU1RJTkNUID0gMiA8PCAwOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IERJU1RJTkNUID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE5PVF9ESVNUSU5DVCA9IDIgPDwgMjsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBJTVBMSUNJVF9ESVNUSU5DVCA9IDIgPDwg\nMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBUT19NQU5ZID0gMiA8\nPCA0OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEFHR1JFR0FURSA9\nIDIgPDwgNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBMT0IgPSAy\nIDw8IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgT1VURVIgPSAy\nIDw8IDc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTFJTID0gMiA8\nPCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEVBR0VSX1RPX09O\nRSA9IDIgPDwgOTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBFQUdF\nUl9UT19NQU5ZID0gMiA8PCAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBSRUNPUkRfT1JERVJFRCA9IDIgPDwgMTE7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgR1JPVVBJTkcgPSAyIDw8IDEyOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZPUkNFX0NPVU5UID0gMiA8PCAxMzsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmdbXSBUQUJMRV9BTElBU0VT\nID0gbmV3IFN0cmluZ1sxNl07CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBT\ndHJpbmdbXSBPUkRFUl9BTElBU0VTID0gbmV3IFN0cmluZ1sxNl07CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3RbXSBOVUxMX0lEUyA9IG5ldyBP\nYmplY3RbMTZdOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10g\nUExBQ0VIT0xERVJTID0gbmV3IE9iamVjdFs1MF07CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZShTZWxlY3QuY2xhc3MpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBUQUJMRV9BTElBU0VTLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBUQUJMRV9BTElBU0VTW2ldID0gInQiICsgaTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IE9SREVSX0FMSUFTRVMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE9SREVSX0FMSUFTRVNbaV0gPSAibyIgKyBpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgTlVMTF9JRFMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE5VTExfSURTW2ldID0gbmV3IE51bGxJZCgpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgUExBQ0VIT0xERVJTLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBQTEFDRUhPTERFUlNbaV0gPSBuZXcgUGxh\nY2Vob2xkZXIoKTsKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIEpEQkNDb25m\naWd1cmF0aW9uIF9jb25mOwogICAgcHJpdmF0ZSBmaW5hbCBEQkRpY3Rpb25h\ncnkgX2RpY3Q7CgogICAgLy8gbWFwIG9mIHZhcmlhYmxlICsgcmVsYXRpb24g\ncGF0aCArIHRhYmxlIGtleXMgdG8gdGhlIGNvcnJlY3QgYWxpYXMgaW5kZXg6\nCiAgICAvLyBlYWNoIHJlbGF0aW9uIHBhdGgvdGFibGUgY29tYmluYXRpb24g\nc2hvdWxkIGhhdmUgYSB1bmlxdWUgYWxpYXMgYmVjYXVzZQogICAgLy8gaXQg\ncmVwcmVzZW50cyBhIHNlcGFyYXRlIG9iamVjdDsgZm9yIGV4YW1wbGUsIGlm\nIGEgUGVyc29uIGNsYXNzIGhhcyBhCiAgICAvLyAncGFyZW50JyBmaWVsZCBy\nZXByZXNlbnRpbmcgYW5vdGhlciBQZXJzb24gYW5kIGFsc28gaGFzIGFuICdh\nZGRyZXNzJwogICAgLy8gZmllbGQgb2YgdHlwZSBBZGRyZXNzOgogICAgLy8g\nJ2FkZHJlc3Muc3RyZWV0JyBzaG91bGQgbWFwIHRvIGEgZGlmZmVyZW50IHRh\nYmxlIGFsaWFzIHRoYW4KICAgIC8vICdwYXJlbnQuYWRkcmVzcy5zdHJlZXQn\nIGZvciB0aGUgcHVycG9zZXMgb2YgY29tcGFyaXNvbnMKICAgIHByaXZhdGUg\nTWFwIF9hbGlhc2VzID0gbnVsbDsKCiAgICAvLyBtYXAgb2YgaW5kZXhlcyB0\nbyB0YWJsZSBhbGlhc2VzIGxpa2UgJ1RBQkxFTkFNRSB0MCcKICAgIHByaXZh\ndGUgU29ydGVkTWFwIF90YWJsZXMgPSBudWxsOwoKICAgIC8vIGNvbWJpbmVk\nIGxpc3Qgb2Ygc2VsZWN0ZWQgaWRzIGFuZCBtYXAgb2YgZWFjaCBpZCB0byBp\ndHMgYWxpYXMKICAgIHByb3RlY3RlZCBmaW5hbCBTZWxlY3RzIF9zZWxlY3Rz\nID0gbmV3U2VsZWN0cygpOwogICAgcHJpdmF0ZSBMaXN0IF9vcmRlcmVkID0g\nbnVsbDsKICAgIHByaXZhdGUgTGlzdCBfZ3JvdXBlZCA9IG51bGw7CgogICAg\nLy8gZmxhZ3MKICAgIHByaXZhdGUgaW50IF9mbGFncyA9IDA7CiAgICBwcml2\nYXRlIGludCBfam9pblN5bnRheCA9IDA7CiAgICBwcml2YXRlIGxvbmcgX3N0\nYXJ0SWR4ID0gMDsKICAgIHByaXZhdGUgbG9uZyBfZW5kSWR4ID0gTG9uZy5N\nQVhfVkFMVUU7CiAgICBwcml2YXRlIGludCBfbnVsbElkcyA9IDA7CiAgICBw\ncml2YXRlIGludCBfb3JkZXJzID0gMDsKICAgIHByaXZhdGUgaW50IF9wbGFj\nZWhvbGRlcnMgPSAwOwogICAgcHJpdmF0ZSBpbnQgX2V4cGVjdGVkUmVzdWx0\nQ291bnQgPSAwOwoKICAgIC8vIHF1ZXJ5IGNsYXVzZXMKICAgIHByaXZhdGUg\nU1FMQnVmZmVyIF9vcmRlcmluZyA9IG51bGw7CiAgICBwcml2YXRlIFNRTEJ1\nZmZlciBfd2hlcmUgPSBudWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX2dy\nb3VwaW5nID0gbnVsbDsKICAgIHByaXZhdGUgU1FMQnVmZmVyIF9oYXZpbmcg\nPSBudWxsOwoKICAgIC8vIGpvaW5zIHRvIGFkZCB0byB0aGUgZW5kIG9mIG91\nciB3aGVyZSBjbGF1c2UsIGFuZCBqb2lucyB0byBwcmVwZW5kIHRvCiAgICAv\nLyBhbGwgc2VsZWN0cyAoc2VlIHNlbGVjdChjbGFzc21hcHBpbmcpIG1ldGhv\nZCkKICAgIHByaXZhdGUgU2VsZWN0Sm9pbnMgX2pvaW5zID0gbnVsbDsKICAg\nIHByaXZhdGUgU3RhY2sgX3ByZUpvaW5zID0gbnVsbDsKCiAgICAvLyBtYXAg\nb2Ygam9pbnMra2V5cyB0byBlYWdlciBzZWxlY3RzIGFuZCBnbG9iYWwgc2V0\nIG9mIGVhZ2VyIGtleXM7IHRoZQogICAgLy8gc2FtZSBrZXkgY2FuJ3QgYmUg\ndXNlZCBtb3JlIHRoYW4gb25jZQogICAgcHJpdmF0ZSBNYXAgX2VhZ2VyID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9lYWdlcktleXMgPSBudWxsOwoKICAg\nIC8vIHN1YnNlbGVjdCBzdXBwb3J0CiAgICBwcml2YXRlIExpc3QgX3N1YnNl\nbHMgPSBudWxsOwogICAgcHJpdmF0ZSBTZWxlY3RJbXBsIF9wYXJlbnQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX3N1YlBhdGggPSBudWxsOwoKICAg\nIC8vIGZyb20gc2VsZWN0IGlmIHRoaXMgc2VsZWN0IHNlbGVjdHMgZnJvbSBh\nIHRtcCB0YWJsZSBjcmVhdGVkIGJ5IGFub3RoZXIKICAgIHByaXZhdGUgU2Vs\nZWN0SW1wbCBfZnJvbSA9IG51bGw7CiAgICBwcm90ZWN0ZWQgU2VsZWN0SW1w\nbCBfb3V0ZXIgPSBudWxsOwogICAgCiAgICAvLyBiaXRTZXQgaW5kaWNhdGlu\nZyBpZiBhbiBhbGlhcyBpcyByZW1vdmVkIGZyb20gcGFyZW50IHNlbGVjdAog\nICAgLy8gYml0IDAgOiBjb3JyZXNwb25kIHRvIGFsaWFzIDAKICAgIC8vIGJp\ndCAxIDogY29ycmVzcG9uZCB0byBhbGlhcyAxLCBldGMuCiAgICAvLyBpZiB0\naGUgYml0IGlzIHNldCwgdGhlIGNvcnJlc3BvbmRpbmcgYWxpYXMgaGFzIGJl\nZW4gcmVtb3ZlZCBmcm9tIHBhcmVudAogICAgLy8gYW5kIHJlY29yZGVkIHVu\nZGVyIHN1YnNlbGVjdC4KICAgIHByaXZhdGUgQml0U2V0IF9yZW1vdmVkQWxp\nYXNGcm9tUGFyZW50ID0gbmV3IEJpdFNldCgxNik7CiAgICAgCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBwcm9wZXIgdGFi\nbGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBhbGlhcyBpbmRleC4KICAgICAqLwog\nICAgc3RhdGljIFN0cmluZyB0b0FsaWFzKGludCBpbmRleCkgewogICAgICAg\nIGlmIChpbmRleCA9PSAtMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgaWYgKGluZGV4IDwgVEFCTEVfQUxJQVNFUy5sZW5ndGgpCiAgICAg\nICAgICAgIHJldHVybiBUQUJMRV9BTElBU0VTW2luZGV4XTsKICAgICAgICBy\nZXR1cm4gInQiICsgaW5kZXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxw\nZXIgbWV0aG9kIHRvIHJldHVybiB0aGUgcHJvcGVyIG9yZGVyIGFsaWFzIGZv\nciB0aGUgZ2l2ZW4gb3JkZXIKICAgICAqIGNvbHVtbiBpbmRleC4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgdG9PcmRlckFsaWFzKGludCBp\nbmRleCkgewogICAgICAgIGlmIChpbmRleCA9PSAtMSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGluZGV4IDwgT1JERVJfQUxJQVNF\nUy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBPUkRFUl9BTElBU0VTW2lu\nZGV4XTsKICAgICAgICByZXR1cm4gIm8iICsgaW5kZXg7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24u\nCiAgICAgKi8KICAgIHB1YmxpYyBTZWxlY3RJbXBsKEpEQkNDb25maWd1cmF0\naW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2Rp\nY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAg\nIF9qb2luU3ludGF4ID0gX2RpY3Quam9pblN5bnRheDsKICAgICAgICBfc2Vs\nZWN0cy5fZGljdCA9IF9kaWN0OwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VsZWN0RXhlY3V0b3IgaW1w\nbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIHB1YmxpYyBKREJDQ29uZmlndXJhdGlvbiBnZXRDb25maWd1\ncmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBw\ndWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0KGJvb2xlYW4gZm9yVXBkYXRlLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJu\nIF9kaWN0LnRvU2VsZWN0KHRoaXMsIGZvclVwZGF0ZSwgZmV0Y2gpOwogICAg\nfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3RDb3VudCgpIHsKICAg\nICAgICByZXR1cm4gX2RpY3QudG9TZWxlY3RDb3VudCh0aGlzKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBdXRvRGlzdGluY3QoKSB7CiAgICAg\nICAgcmV0dXJuIChfZmxhZ3MgJiBOT05BVVRPX0RJU1RJTkNUKSA9PSAwOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEF1dG9EaXN0aW5jdChib29sZWFu\nIHZhbCkgewogICAgICAgIGlmICh2YWwpCiAgICAgICAgICAgIF9mbGFncyAm\nPSB+Tk9OQVVUT19ESVNUSU5DVDsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIF9mbGFncyB8PSBOT05BVVRPX0RJU1RJTkNUOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzRGlzdGluY3QoKSB7CiAgICAgICAgcmV0dXJuIChfZmxh\nZ3MgJiBOT1RfRElTVElOQ1QpID09IDAgJiYgKChfZmxhZ3MgJiBESVNUSU5D\nVCkgIT0gMAogICAgICAgICAgICB8fCAoKF9mbGFncyAmIE5PTkFVVE9fRElT\nVElOQ1QpID09IDAKICAgICAgICAgICAgJiYgKF9mbGFncyAmIElNUExJQ0lU\nX0RJU1RJTkNUKSAhPSAwKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nRGlzdGluY3QoYm9vbGVhbiBkaXN0aW5jdCkgewogICAgICAgIC8vIG5lZWQg\ndHdvIGZsYWdzIGluIGNhc2Ugc2V0IG5vdF9kaXN0aW5jdCwgdGhlbiBhIHRv\nLW1hbnkgam9pbiBoYXBwZW5zCiAgICAgICAgLy8gYW5kIGRpc3RpbmN0IGZs\nYWcgZ2V0cyBzZXQgYXV0b21hdGljYWxseQogICAgICAgIGlmIChkaXN0aW5j\ndCkgewogICAgICAgICAgICBfZmxhZ3MgfD0gRElTVElOQ1Q7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+Tk9UX0RJU1RJTkNUOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIF9mbGFncyB8PSBOT1RfRElTVElOQ1Q7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+RElTVElOQ1Q7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzTFJTKCkgewogICAgICAgIHJldHVybiAoX2Zs\nYWdzICYgTFJTKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExS\nUyhib29sZWFuIGxycykgewogICAgICAgIGlmIChscnMpCiAgICAgICAgICAg\nIF9mbGFncyB8PSBMUlM7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkxSUzsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEV4cGVjdGVk\nUmVzdWx0Q291bnQoKSB7CiAgICAgICAgLy8gaWYgdGhlIGNvdW50IGlzbid0\nIGZvcmNlZCBhbmQgd2UgaGF2ZSB0by1tYW55IGVhZ2VyIGpvaW5zIHRoYXQg\nY291bGQKICAgICAgICAvLyB0aHJvdyB0aGUgY291bnQgb2ZmLCBkb24ndCBw\nYXkgYXR0ZW50aW9uIHRvIGl0CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGT1JD\nRV9DT1VOVCkgPT0gMCAmJiBoYXNFYWdlckpvaW4odHJ1ZSkpCiAgICAgICAg\nICAgIHJldHVybiAwOwogICAgICAgIHJldHVybiBfZXhwZWN0ZWRSZXN1bHRD\nb3VudDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRFeHBlY3RlZFJlc3Vs\ndENvdW50KGludCBleHBlY3RlZFJlc3VsdENvdW50LCBib29sZWFuIGZvcmNl\nKSB7CiAgICAgICAgX2V4cGVjdGVkUmVzdWx0Q291bnQgPSBleHBlY3RlZFJl\nc3VsdENvdW50OwogICAgICAgIGlmIChmb3JjZSkKICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZPUkNFX0NPVU5UOwogICAgICAgIGVsc2UgCiAgICAgICAgICAg\nIF9mbGFncyAmPSB+Rk9SQ0VfQ09VTlQ7CiAgICB9CgogICAgcHVibGljIGlu\ndCBnZXRKb2luU3ludGF4KCkgewogICAgICAgIHJldHVybiBfam9pblN5bnRh\neDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRKb2luU3ludGF4KGludCBq\nb2luU3ludGF4KSB7CiAgICAgICAgX2pvaW5TeW50YXggPSBqb2luU3ludGF4\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmFuZG9tQWNj\nZXNzKGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0\nLnN1cHBvcnRzUmFuZG9tQWNjZXNzUmVzdWx0U2V0KHRoaXMsIGZvclVwZGF0\nZSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5n\nKCkgewogICAgICAgIHJldHVybiBfZGljdC5zdXBwb3J0c0xvY2tpbmcodGhp\ncyk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRDb3VudChKREJDU3RvcmUg\nc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nQ29ubmVjdGlvbiBjb25uID0gbnVsbDsKICAgICAgICBQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCA9IG51bGw7CiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBTUUxCdWZmZXIgc3FsID0g\ndG9TZWxlY3RDb3VudCgpOwogICAgICAgICAgICBjb25uID0gc3RvcmUuZ2V0\nQ29ubmVjdGlvbigpOwogICAgICAgICAgICBzdG1udCA9IHNxbC5wcmVwYXJl\nU3RhdGVtZW50KGNvbm4pOwogICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1\ndGVRdWVyeSgpOwogICAgICAgICAgICBycy5uZXh0KCk7CiAgICAgICAgICAg\nIHJldHVybiBycy5nZXRJbnQoMSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgaWYgKHJzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkg\neyBycy5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAg\nICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsgc3RtbnQuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7fQogICAgICAgICAgICBpZiAoY29ubiAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdHJ5IHsgY29ubi5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UpIHt9CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBSZXN1bHQg\nZXhlY3V0ZShKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZldGNoID0gc3Rv\ncmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgcmV0dXJuIGV4\nZWN1dGUoc3RvcmUuZ2V0Q29udGV4dCgpLCBzdG9yZSwgZmV0Y2gsCiAgICAg\nICAgICAgIGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKSk7CiAgICB9CgogICAg\ncHVibGljIFJlc3VsdCBleGVjdXRlKEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBpbnQgbG9ja0xldmVs\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChm\nZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IHN0b3JlLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIHJldHVybiBleGVjdXRlKHN0\nb3JlLmdldENvbnRleHQoKSwgc3RvcmUsIGZldGNoLCBsb2NrTGV2ZWwpOwog\nICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0ZSB0aGlzIHNlbGVjdCBpbiB0\naGUgY29udGV4dCBvZiB0aGUgZ2l2ZW4gc3RvcmUgbWFuYWdlci4gVGhlCiAg\nICAgKiBjb250ZXh0IGlzIHBhc3NlZCBpbiBzZXBhcmF0ZWx5IGZvciBwcm9m\naWxpbmcgcHVycG9zZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBSZXN1bHQg\nZXhlY3V0ZShTdG9yZUNvbnRleHQgY3R4LCBKREJDU3RvcmUgc3RvcmUsIAog\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBsb2Nr\nTGV2ZWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nYm9vbGVhbiBmb3JVcGRhdGUgPSBmYWxzZTsKICAgICAgICBpZiAoIWlzQWdn\ncmVnYXRlKCkgJiYgX2dyb3VwaW5nID09IG51bGwpIHsKICAgICAgICAgICAg\nSkRCQ0xvY2tNYW5hZ2VyIGxtID0gc3RvcmUuZ2V0TG9ja01hbmFnZXIoKTsK\nICAgICAgICAgICAgaWYgKGxtICE9IG51bGwpCiAgICAgICAgICAgICAgICBm\nb3JVcGRhdGUgPSBsbS5zZWxlY3RGb3JVcGRhdGUodGhpcywgbG9ja0xldmVs\nKTsKICAgICAgICB9CgogICAgICAgIFNRTEJ1ZmZlciBzcWwgPSB0b1NlbGVj\ndChmb3JVcGRhdGUsIGZldGNoKTsKICAgICAgICBpbnQgcnNUeXBlID0gKGlz\nTFJTKCkgJiYgc3VwcG9ydHNSYW5kb21BY2Nlc3MoZm9yVXBkYXRlKSkKICAg\nICAgICAgICAgPyAtMSA6IFJlc3VsdFNldC5UWVBFX0ZPUldBUkRfT05MWTsK\nICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBzdG9yZS5nZXRDb25uZWN0aW9u\nKCk7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwog\nICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKGlzTFJTKCkpCiAgICAgICAgICAgICAgICBzdG1udCA9\nIHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4sIGZldGNoLCByc1R5cGUsIC0x\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc3RtbnQgPSBz\ncWwucHJlcGFyZVN0YXRlbWVudChjb25uLCByc1R5cGUsIC0xKTsKCiAgICAg\nICAgICAgIC8vIGlmIHRoaXMgaXMgYSBsb2NraW5nIHNlbGVjdCBhbmQgdGhl\nIGxvY2sgdGltZW91dCBpcyBncmVhdGVyIHRoYW4KICAgICAgICAgICAgLy8g\ndGhlIGNvbmZpZ3VyZWQgcXVlcnkgdGltZW91dCwgdXNlIHRoZSBsb2NrIHRp\nbWVvdXQKICAgICAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiBfZGljdC5zdXBw\nb3J0c1F1ZXJ5VGltZW91dCAmJiBmZXRjaCAhPSBudWxsIAogICAgICAgICAg\nICAgICAgJiYgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSA+IHN0bW50LmdldFF1\nZXJ5VGltZW91dCgpICogMTAwMCkgewogICAgICAgICAgICAgICAgaW50IHRp\nbWVvdXQgPSBmZXRjaC5nZXRMb2NrVGltZW91dCgpOwogICAgICAgICAgICAg\nICAgaWYgKHRpbWVvdXQgPCAxMDAwKSB7CiAgICAgICAgICAgICAgICAgICAg\ndGltZW91dCA9IDEwMDA7IAogICAgICAgICAgICAgICAgICAgIExvZyBsb2cg\nPSBfY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3VyYXRpb24uTE9HX0pEQkMpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgibWls\nbGlzLXF1ZXJ5LXRpbWVvdXQiKSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBzdG1udC5zZXRRdWVyeVRpbWVvdXQoZmV0Y2guZ2V0TG9j\na1RpbWVvdXQoKSAvIDEwMDApOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIC8vIGNsZWFuIHVwIHN0\nYXRlbWVudAogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4\nY2VwdGlvbiBzZTIpIHt9CiAgICAgICAgICAgIHRyeSB7IGNvbm4uY2xvc2Uo\nKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlMikge30KICAgICAgICAgICAg\ndGhyb3cgc2U7CiAgICAgICAgfQoKICAgICAgICBTZWxlY3RSZXN1bHQgcmVz\nID0gbmV3IFNlbGVjdFJlc3VsdChjb25uLCBzdG1udCwgcnMsIF9kaWN0KTsK\nICAgICAgICByZXMuc2V0U2VsZWN0KHRoaXMpOwogICAgICAgIHJlcy5zZXRT\ndG9yZShzdG9yZSk7CiAgICAgICAgcmVzLnNldExvY2tpbmcoZm9yVXBkYXRl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhZGRFYWdlclJlc3VsdHMo\ncmVzLCB0aGlzLCBzdG9yZSwgZmV0Y2gpOwogICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICByZXMuY2xvc2UoKTsKICAg\nICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBy\nZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeGVjdXRlIG91ciBlYWdlciBz\nZWxlY3RzLCBhZGRpbmcgdGhlIHJlc3VsdHMgdW5kZXIgdGhlIHNhbWUga2V5\ncwogICAgICogdG8gdGhlIGdpdmVuIHJlc3VsdC4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgdm9pZCBhZGRFYWdlclJlc3VsdHMoU2VsZWN0UmVzdWx0\nIHJlcywgU2VsZWN0SW1wbCBzZWwsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3Jl\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChzZWwuX2VhZ2VyID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gZXhlY3V0ZSBl\nYWdlciBzZWxlY3RzCiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAg\nIFJlc3VsdCBlcmVzOwogICAgICAgIE1hcCBlYWdlcjsKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IHNlbC5fZWFnZXIuZW50cnlTZXQoKS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChN\nYXAuRW50cnkpIGl0ci5uZXh0KCk7CgogICAgICAgICAgICAvLyBzaW11bGF0\nZWQgYmF0Y2hlZCBzZWxlY3RzIGZvciBpbm5lci9vdXRlciBqb2luczsgZm9y\nIHNlcGFyYXRlCiAgICAgICAgICAgIC8vIHNlbGVjdHMsIGRvbid0IHBhc3Mg\nb24gbG9jayBsZXZlbCwgYmVjYXVzZSB0aGV5J3JlIHByb2JhYmx5CiAgICAg\nICAgICAgIC8vIGZvciByZWxhdGlvbnMgYW5kIHRoZXJlZm9yZSBzaG91bGQg\ndXNlIGRlZmF1bHQgbGV2ZWwKICAgICAgICAgICAgaWYgKGVudHJ5LmdldFZh\nbHVlKCkgPT0gc2VsKQogICAgICAgICAgICAgICAgZXJlcyA9IHJlczsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZXJlcyA9ICgoU2VsZWN0\nRXhlY3V0b3IpIGVudHJ5LmdldFZhbHVlKCkpLmV4ZWN1dGUoc3RvcmUsCiAg\nICAgICAgICAgICAgICAgICAgZmV0Y2gpOwoKICAgICAgICAgICAgZWFnZXIg\nPSByZXMuZ2V0RWFnZXJNYXAoZmFsc2UpOwogICAgICAgICAgICBpZiAoZWFn\nZXIgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZWFnZXIgPSBuZXcgSGFz\naE1hcCgpOwogICAgICAgICAgICAgICAgcmVzLnNldEVhZ2VyTWFwKGVhZ2Vy\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlYWdlci5wdXQoZW50cnku\nZ2V0S2V5KCksIGVyZXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTZWxlY3QgaW1wbGVtZW50YXRp\nb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMg\naW50IGluZGV4T2YoKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAg\ncHVibGljIExpc3QgZ2V0U3Vic2VsZWN0cygpIHsKICAgICAgICByZXR1cm4g\nKF9zdWJzZWxzID09IG51bGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfTElTVCA6\nIF9zdWJzZWxzOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3QgZ2V0UGFyZW50\nKCkgewogICAgICAgIHJldHVybiBfcGFyZW50OwogICAgfQoKICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0U3Vic2VsZWN0UGF0aCgpIHsKICAgICAgICByZXR1cm4g\nX3N1YlBhdGg7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UGFyZW50KFNl\nbGVjdCBwYXJlbnQsIFN0cmluZyBwYXRoKSB7CiAgICAgICAgaWYgKHBhdGgg\nIT0gbnVsbCkKICAgICAgICAgICAgX3N1YlBhdGggPSBwYXRoICsgJzonOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgX3N1YlBhdGggPSBudWxsOwoKICAg\nICAgICBpZiAocGFyZW50ID09IF9wYXJlbnQpCiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICBpZiAoX3BhcmVudCAhPSBudWxsKQogICAgICAgICAgICBf\ncGFyZW50Ll9zdWJzZWxzLnJlbW92ZSh0aGlzKTsKCiAgICAgICAgLy8jIyMg\ncmlnaHQgbm93IHdlIGNhbid0IHVzZSBzcWw5MiBqb2lucyB3aXRoIHN1YnNl\nbGVjdHMsIGNhdXNlCiAgICAgICAgLy8jIyMgSSBjYW4ndCBmaWd1cmUgb3V0\nIHdoYXQgdG8gZG8gd2hlbiB0aGUgc3Vic2VsZWN0IGhhcyBhIGpvaW4KICAg\nICAgICAvLyMjIyB3aXRoIGFuIGFsaWFzIGFsc28gcHJlc2VudCBpbiB0aGUg\nb3V0ZXIgc2VsZWN0Li4uIHlvdSBkb24ndCB3YW50CiAgICAgICAgLy8jIyMg\ndGhlIGpvaW4gdG8gYXBwZWFyIGluIHRoZSBGUk9NIGNsYXVzZSBvZiB0aGUg\nc3Vic2VsZWN0IGNhdXNlCiAgICAgICAgLy8jIyMgdGhlbiBpdCByZS1hbGlh\nc2VzIGJvdGggdGFibGVzIGluIHRoZSBzY29wZSBvZiB0aGUgc3Vic2VsZWN0\nCiAgICAgICAgLy8jIyMgYW5kIHRoZSBjb3JyZWxhdGlvbiB3aXRoIHRoZSBv\ndXRlciBzZWxlY3QgaXMgbG9zdAogICAgICAgIF9wYXJlbnQgPSAoU2VsZWN0\nSW1wbCkgcGFyZW50OwogICAgICAgIGlmIChfcGFyZW50ICE9IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKF9wYXJlbnQuX3N1YnNlbHMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9wYXJlbnQuX3N1YnNlbHMgPSBuZXcgQXJyYXlMaXN0\nKDIpOwogICAgICAgICAgICBfcGFyZW50Ll9zdWJzZWxzLmFkZCh0aGlzKTsK\nICAgICAgICAgICAgaWYgKF9wYXJlbnQuX2pvaW5TeW50YXggPT0gSm9pblN5\nbnRheGVzLlNZTlRBWF9TUUw5MikKICAgICAgICAgICAgICAgIF9qb2luU3lu\ndGF4ID0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTDsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2pvaW5TeW50YXggPSBfcGFy\nZW50Ll9qb2luU3ludGF4OwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nU2VsZWN0IGdldEZyb21TZWxlY3QoKSB7CiAgICAgICAgcmV0dXJuIF9mcm9t\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEZyb21TZWxlY3QoU2VsZWN0\nIHNlbCkgewogICAgICAgIF9mcm9tID0gKFNlbGVjdEltcGwpIHNlbDsKICAg\nICAgICBpZiAoX2Zyb20gIT0gbnVsbCkKICAgICAgICAgICAgX2Zyb20uX291\ndGVyID0gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNFYWdl\nckpvaW4oYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICBpZiAodG9NYW55KQog\nICAgICAgICAgICByZXR1cm4gKF9mbGFncyAmIEVBR0VSX1RPX01BTlkpICE9\nIDA7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBFQUdFUl9UT19PTkUpICE9\nIDA7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzSm9pbihib29sZWFu\nIHRvTWFueSkgewogICAgICAgIGlmICh0b01hbnkpCiAgICAgICAgICAgIHJl\ndHVybiAoX2ZsYWdzICYgVE9fTUFOWSkgIT0gMDsKICAgICAgICByZXR1cm4g\nX3RhYmxlcyAhPSBudWxsICYmIF90YWJsZXMuc2l6ZSgpID4gMTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc1NlbGVjdGVkKFRhYmxlIHRhYmxlKSB7\nCiAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMobnVsbCwgZmFsc2Up\nOwogICAgICAgIGlmIChfZnJvbSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gX2Zyb20uZ2V0VGFibGVJbmRleCh0YWJsZSwgcGosIGZhbHNlKSAhPSAt\nMTsKICAgICAgICByZXR1cm4gZ2V0VGFibGVJbmRleCh0YWJsZSwgcGosIGZh\nbHNlKSAhPSAtMTsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRU\nYWJsZUFsaWFzZXMoKSB7CiAgICAgICAgcmV0dXJuIChfdGFibGVzID09IG51\nbGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfU0VUIDogX3RhYmxlcy52YWx1ZXMo\nKTsKICAgIH0KCiAgICBwdWJsaWMgTGlzdCBnZXRTZWxlY3RBbGlhc2VzKCkg\newogICAgICAgIHJldHVybiBfc2VsZWN0cy5nZXRBbGlhc2VzKGZhbHNlLCBf\nb3V0ZXIgIT0gbnVsbCk7CiAgICB9CgogICAgcHVibGljIExpc3QgZ2V0SWRl\nbnRpZmllckFsaWFzZXMoKSB7CiAgICAgICAgcmV0dXJuIF9zZWxlY3RzLmdl\ndEFsaWFzZXModHJ1ZSwgX291dGVyICE9IG51bGwpOwogICAgfQoKICAgIHB1\nYmxpYyBTUUxCdWZmZXIgZ2V0T3JkZXJpbmcoKSB7CiAgICAgICAgcmV0dXJu\nIF9vcmRlcmluZzsKICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIGdldEdy\nb3VwaW5nKCkgewogICAgICAgIHJldHVybiBfZ3JvdXBpbmc7CiAgICB9Cgog\nICAgcHVibGljIFNRTEJ1ZmZlciBnZXRXaGVyZSgpIHsKICAgICAgICByZXR1\ncm4gX3doZXJlOwogICAgfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgZ2V0SGF2\naW5nKCkgewogICAgICAgIHJldHVybiBfaGF2aW5nOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGFkZEpvaW5DbGFzc0NvbmRpdGlvbnMoKSB7CiAgICAgICAg\naWYgKF9qb2lucyA9PSBudWxsIHx8IF9qb2lucy5qb2lucygpID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gam9pbiBzZXQgaXRl\ncmF0b3IgYWxsb3dzIGNvbmN1cnJlbnQgbW9kaWZpY2F0aW9uCiAgICAgICAg\nSm9pbiBqOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2pvaW5zLmpv\naW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgaiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoai5n\nZXRSZWxhdGlvblRhcmdldCgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGouZ2V0UmVsYXRpb25UYXJnZXQoKS5nZXREaXNjcmltaW5hdG9yKCkuYWRk\nQ2xhc3NDb25kaXRpb25zCiAgICAgICAgICAgICAgICAgICAgKHRoaXMsIGou\nZ2V0U3ViY2xhc3NlcygpID09IFNVQlNfSk9JTkFCTEUsIAogICAgICAgICAg\nICAgICAgICAgIGouZ2V0UmVsYXRpb25Kb2lucygpKTsKICAgICAgICAgICAg\nICAgIGouc2V0UmVsYXRpb24obnVsbCwgMCwgbnVsbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEpvaW5zIGdldEpvaW5z\nKCkgewogICAgICAgIHJldHVybiBfam9pbnM7CiAgICB9CgogICAgcHVibGlj\nIEl0ZXJhdG9yIGdldEpvaW5JdGVyYXRvcigpIHsKICAgICAgICBpZiAoX2pv\naW5zID09IG51bGwgfHwgX2pvaW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuIEVtcHR5SXRlcmF0b3IuSU5TVEFOQ0U7CiAgICAgICAgcmV0dXJu\nIF9qb2lucy5qb2lucygpLmpvaW5JdGVyYXRvcigpOwogICAgfQoKICAgIHB1\nYmxpYyBsb25nIGdldFN0YXJ0SW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9z\ndGFydElkeDsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBnZXRFbmRJbmRleCgp\nIHsKICAgICAgICByZXR1cm4gX2VuZElkeDsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRSYW5nZShsb25nIHN0YXJ0LCBsb25nIGVuZCkgewogICAgICAg\nIF9zdGFydElkeCA9IHN0YXJ0OwogICAgICAgIF9lbmRJZHggPSBlbmQ7CiAg\nICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhDb2x1bW4g\nY29sKSB7CiAgICAgICAgcmV0dXJuIGdldENvbHVtbkFsaWFzKGNvbCwgKEpv\naW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVt\nbkFsaWFzKENvbHVtbiBjb2wsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgcmV0\ndXJuIGdldENvbHVtbkFsaWFzKGNvbCwgZ2V0Sm9pbnMoam9pbnMsIGZhbHNl\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGFsaWFzIGZv\nciB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBwcml2YXRlIFN0cmlu\nZyBnZXRDb2x1bW5BbGlhcyhDb2x1bW4gY29sLCBQYXRoSm9pbnMgcGopIHsK\nICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29sLmdldE5hbWUoKSwg\nY29sLmdldFRhYmxlKCksIHBqKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5n\nIGdldENvbHVtbkFsaWFzKFN0cmluZyBjb2wsIFRhYmxlIHRhYmxlKSB7CiAg\nICAgICAgcmV0dXJuIGdldENvbHVtbkFsaWFzKGNvbCwgdGFibGUsIChKb2lu\ncykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb2x1bW5B\nbGlhcyhTdHJpbmcgY29sLCBUYWJsZSB0YWJsZSwgSm9pbnMgam9pbnMpIHsK\nICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29sLCB0YWJsZSwgZ2V0\nSm9pbnMoam9pbnMsIGZhbHNlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGFsaWFzIGZvciB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICov\nCiAgICBwcml2YXRlIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhTdHJpbmcgY29s\nLCBUYWJsZSB0YWJsZSwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgaWYgKF9m\ncm9tICE9IG51bGwpIHsKICAgICAgICAgICAgU3RyaW5nIGFsaWFzID0gdG9B\nbGlhcyhfZnJvbS5nZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgdHJ1ZSkpOwog\nICAgICAgICAgICBpZiAoX2RpY3QucmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVj\ndCkKICAgICAgICAgICAgICAgIHJldHVybiBGUk9NX1NFTEVDVF9BTElBUyAr\nICIuIiArIGFsaWFzICsgIl8iICsgY29sOwogICAgICAgICAgICByZXR1cm4g\nYWxpYXMgKyAiXyIgKyBjb2w7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0\nb0FsaWFzKGdldFRhYmxlSW5kZXgodGFibGUsIHBqLCB0cnVlKSkgKyAiLiIg\nKyBjb2w7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNBZ2dyZWdhdGUo\nKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBBR0dSRUdBVEUpICE9IDA7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QWdncmVnYXRlKGJvb2xlYW4g\nYWdnKSB7CiAgICAgICAgaWYgKGFnZykKICAgICAgICAgICAgX2ZsYWdzIHw9\nIEFHR1JFR0FURTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAm\nPSB+QUdHUkVHQVRFOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzTG9i\nKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgTE9CKSAhPSAwOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldExvYihib29sZWFuIGxvYikgewogICAg\nICAgIGlmIChsb2IpCiAgICAgICAgICAgIF9mbGFncyB8PSBMT0I7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBfZmxhZ3MgJj0gfkxPQjsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBjbGVhclNlbGVjdHMoKSB7CiAgICAgICAgX3NlbGVj\ndHMuY2xlYXIoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3Qo\nU1FMQnVmZmVyIHNxbCwgT2JqZWN0IGlkKSB7CiAgICAgICAgcmV0dXJuIHNl\nbGVjdChzcWwsIGlkLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBzZWxlY3QoU1FMQnVmZmVyIHNxbCwgT2JqZWN0IGlkLCBKb2lucyBqb2lu\ncykgewogICAgICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAgICAgICBy\nZXR1cm4gc2VsZWN0KChPYmplY3QpIHNxbCwgaWQsIGpvaW5zKTsKICAgICAg\nICBncm91cEJ5KHNxbCwgam9pbnMpOwogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlY29yZCB0aGUgc2VsZWN0IG9mIHRo\nZSBnaXZlbiBTUUwgYnVmZmVyIG9yIHN0cmluZy4KICAgICAqLwogICAgcHJp\ndmF0ZSBib29sZWFuIHNlbGVjdChPYmplY3Qgc3FsLCBPYmplY3QgaWQsIEpv\naW5zIGpvaW5zKSB7CiAgICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwog\nICAgICAgIGJvb2xlYW4gY29udGFpbnM7CiAgICAgICAgaWYgKGlkID09IG51\nbGwpIHsKICAgICAgICAgICAgaW50IGlkeCA9IF9zZWxlY3RzLmluZGV4T2ZB\nbGlhcyhzcWwpOwogICAgICAgICAgICBjb250YWlucyA9IGlkeCAhPSAtMTsK\nICAgICAgICAgICAgaWYgKGNvbnRhaW5zKQogICAgICAgICAgICAgICAgaWQg\nPSBfc2VsZWN0cy5nZXQoaWR4KTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgaWQgPSBudWxsSWQoKTsKICAgICAgICB9IGVsc2UKICAgICAg\nICAgICAgY29udGFpbnMgPSBfc2VsZWN0cy5jb250YWlucyhpZCk7CgogICAg\nICAgIGlmIChjb250YWlucykKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIF9zZWxlY3RzLnNldEFsaWFzKGlkLCBzcWwsIGZhbHNlKTsKICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbnMgYSB1bmlxdWUgaWQgZm9yIGEgU1FMIHN0cmluZyB3aG9zZSBnaXZlbiBp\nZCBpcyBudWxsLgogICAgICovCiAgICBwcml2YXRlIE9iamVjdCBudWxsSWQo\nKSB7CiAgICAgICAgaWYgKF9udWxsSWRzID49IE5VTExfSURTLmxlbmd0aCkK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBOdWxsSWQoKTsKICAgICAgICByZXR1\ncm4gTlVMTF9JRFNbX251bGxJZHMrK107CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gc2VsZWN0KFN0cmluZyBzcWwsIE9iamVjdCBpZCkgewogICAgICAg\nIHJldHVybiBzZWxlY3Qoc3FsLCBpZCwgbnVsbCk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gc2VsZWN0KFN0cmluZyBzcWwsIE9iamVjdCBpZCwgSm9p\nbnMgam9pbnMpIHsKICAgICAgICBpZiAoIWlzR3JvdXBpbmcoKSkKICAgICAg\nICAgICAgcmV0dXJuIHNlbGVjdCgoT2JqZWN0KSBzcWwsIGlkLCBqb2lucyk7\nCiAgICAgICAgZ3JvdXBCeShzcWwsIGpvaW5zKTsKICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RQbGFjZWhvbGRl\ncihTdHJpbmcgc3FsKSB7CiAgICAgICAgT2JqZWN0IGhvbGRlciA9IChfcGxh\nY2Vob2xkZXJzID49IFBMQUNFSE9MREVSUy5sZW5ndGgpCiAgICAgICAgICAg\nID8gbmV3IFBsYWNlaG9sZGVyKCkgOiBQTEFDRUhPTERFUlNbX3BsYWNlaG9s\nZGVycysrXTsKICAgICAgICBzZWxlY3Qoc3FsLCBob2xkZXIpOwogICAgfQoK\nICAgIC8qKgogICAgICogSW5zZXJ0IGEgcGxhY2Vob2xkZXIgYXQgdGhlIGdp\ndmVuIGluZGV4OyB1c2UgYSBuZWdhdGl2ZSBpbmRleAogICAgICogdG8gY291\nbnQgZnJvbSB0aGUgYmFjayBvZiB0aGUgc2VsZWN0IGxpc3QuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIGluc2VydFBsYWNlaG9sZGVyKFN0cmluZyBzcWws\nIGludCBwb3MpIHsKICAgICAgICBPYmplY3QgaG9sZGVyID0gKF9wbGFjZWhv\nbGRlcnMgPj0gUExBQ0VIT0xERVJTLmxlbmd0aCkKICAgICAgICAgICAgPyBu\nZXcgUGxhY2Vob2xkZXIoKSA6IFBMQUNFSE9MREVSU1tfcGxhY2Vob2xkZXJz\nKytdOwogICAgICAgIF9zZWxlY3RzLmluc2VydEFsaWFzKHBvcywgaG9sZGVy\nLCBzcWwpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgc2VsZWN0ZWQg\ncGxhY2Vob2xkZXJzLCBhbmQgcmV0dXJuIHJlbW92ZWQgc2VsZWN0IGluZGV4\nZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsZWFyUGxhY2Vob2xkZXJT\nZWxlY3RzKCkgewogICAgICAgIF9zZWxlY3RzLmNsZWFyUGxhY2Vob2xkZXJz\nKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0KENvbHVtbiBj\nb2wpIHsKICAgICAgICByZXR1cm4gc2VsZWN0KGNvbCwgKEpvaW5zKSBudWxs\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoQ29sdW1uIGNv\nbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoIWlzR3JvdXBpbmcoKSkK\nICAgICAgICAgICAgcmV0dXJuIHNlbGVjdChjb2wsIGdldEpvaW5zKGpvaW5z\nLCB0cnVlKSwgZmFsc2UpOwogICAgICAgIGdyb3VwQnkoY29sLCBqb2lucyk7\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nc2VsZWN0KENvbHVtbltdIGNvbHMpIHsKICAgICAgICByZXR1cm4gc2VsZWN0\nKGNvbHMsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0KENv\nbHVtbltdIGNvbHMsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKGNvbHMg\nPT0gbnVsbCB8fCBjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1\ncm4gMDsKICAgICAgICBpZiAoaXNHcm91cGluZygpKSB7CiAgICAgICAgICAg\nIGdyb3VwQnkoY29scywgam9pbnMpOwogICAgICAgICAgICByZXR1cm4gMDsK\nICAgICAgICB9CiAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9p\nbnMsIHRydWUpOwogICAgICAgIGludCBzZWxkID0gMDsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nIGlmIChzZWxlY3QoY29sc1tpXSwgcGosIGZhbHNlKSkKICAgICAgICAgICAg\nICAgIHNlbGQgfD0gMiA8PCBpOwogICAgICAgIHJldHVybiBzZWxkOwogICAg\nfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBnaXZlbiBjb2x1bW4gYWZ0\nZXIgbWFraW5nIHRoZSBnaXZlbiBqb2lucy4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIHNlbGVjdChDb2x1bW4gY29sLCBQYXRoSm9pbnMgcGosIGJv\nb2xlYW4gaWRlbnQpIHsKICAgICAgICAvLyB3ZSBjYWNoZSBvbiBjb2x1bW4g\nb2JqZWN0IGlmIHRoZXJlIGFyZSBubyBqb2lucyBzbyB0aGF0IHdoZW4KICAg\nICAgICAvLyBsb29raW5nIHVwIGNvbHVtbnMgaW4gdGhlIHJlc3VsdCB3ZSBk\nb24ndCBoYXZlIHRvIGNyZWF0ZSBhIHN0cmluZwogICAgICAgIC8vIGJ1ZmZl\nciBmb3IgdGhlIHRhYmxlICsgY29sdW1uIGFsaWFzOyBpZiB0aGVyZSBhcmUg\nam9pbnMsIHRoZW4KICAgICAgICAvLyB3ZSBrZXkgb24gdGhlIGFsaWFzCiAg\nICAgICAgU3RyaW5nIGFsaWFzID0gZ2V0Q29sdW1uQWxpYXMoY29sLCBwaik7\nCiAgICAgICAgT2JqZWN0IGlkOwogICAgICAgIGlmIChwaiA9PSBudWxsIHx8\nIHBqLnBhdGgoKSA9PSBudWxsKQogICAgICAgICAgICBpZCA9IGNvbDsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIGlkID0gYWxpYXM7CiAgICAgICAgaWYg\nKF9zZWxlY3RzLmNvbnRhaW5zKGlkKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICBpZiAoY29sLmdldFR5cGUoKSA9PSBUeXBlcy5CTE9C\nIHx8IGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMuQ0xPQikKICAgICAgICAgICAg\nc2V0TG9iKHRydWUpOwogICAgICAgIF9zZWxlY3RzLnNldEFsaWFzKGlkLCBh\nbGlhcywgaWRlbnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNlbGVjdChDbGFzc01hcHBpbmcgbWFwcGluZywgaW50\nIHN1YmNsYXNzZXMsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXIpIHsKICAgICAgICBz\nZWxlY3QobWFwcGluZywgc3ViY2xhc3Nlcywgc3RvcmUsIGZldGNoLCBlYWdl\nciwgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2VsZWN0KENsYXNz\nTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywKICAgICAgICBKREJD\nU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGlu\ndCBlYWdlciwKICAgICAgICBKb2lucyBqb2lucykgewogICAgICAgIHNlbGVj\ndCh0aGlzLCBtYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIGVh\nZ2VyLCBqb2lucywgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogU2Vs\nZWN0IHRoZSBnaXZlbiBtYXBwaW5nLgogICAgICovCiAgICB2b2lkIHNlbGVj\ndChTZWxlY3Qgd3JhcHBlciwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBz\ndWJjbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyLAogICAgICAgIEpvaW5z\nIGpvaW5zLCBib29sZWFuIGlkZW50KSB7CiAgICAgICAgLy8gbm90ZSB0aGF0\nIHRoaXMgaXMgb25lIGNhc2Ugd2hlcmUgd2UgZG9uJ3Qgd2FudCB0byB1c2Ug\ndGhlIHJlc3VsdAogICAgICAgIC8vIG9mIGdldEpvaW5zKCk7IGp1c3QgdXNl\nIHRoZSBnaXZlbiBqb2lucywgd2hpY2ggd2lsbCBlaXRoZXIgYmUgY2xlYW4K\nICAgICAgICAvLyBvciB0aGUgcmVzdWx0IG9mIHByZXZpb3VzIHByZS1qb2lu\ncy4gdGhpcyB3YXkgd2UgZG9uJ3QgcHVzaCBleHRyYQogICAgICAgIC8vIHN0\nYWNrIHN0dWZmIHdoZW4gbm8gYWN0dWFsIG5ldyBqb2lucyBoYXZlIGJlZW4g\nbWFkZSwgYW5kIHdlIGRvbid0CiAgICAgICAgLy8gdGhpbmsgdGhlIHVzZXIg\nd2FudHMgb3V0ZXIgam9pbnMgd2hlbiBhY3R1YWxseSBvbmx5IHRoZSBwcmV2\naW91cwogICAgICAgIC8vIGpvaW5zIHdlcmUgb3V0ZXIuICB3ZSBkbyBpbnZv\na2UgZ2V0Sm9pbnMoKSwgdGhvdWdoLCB0byBhZGQgdGhlc2UKICAgICAgICAv\nLyBqb2lucyAoaWYgYW55KSB0byBvdXIgdG9wLWxldmVsIGpvaW5zOyBvdGhl\ncndpc2UgaXQnZCBiZSBwb3NzaWJsZQogICAgICAgIC8vIGZvciB0aGUgdXNl\nciB0byBpbW1lZGlhdGVseSBkbyBhbm90aGVyIGpvaW4gYW5kIHNlbGVjdCBz\nb21ldGhpbmcsCiAgICAgICAgLy8gYW5kIGlmIHdlJ3JlIGluIG91dGVyIG1v\nZGUgYWxsIHRoZXNlIGpvaW5zIHdpbGwgZ2V0IHN3aXRjaGVkIHRvIG91dGVy\nCiAgICAgICAgLy8gam9pbnMuICBjYWNoaW5nIHRoZW0gYXMgdGhlaXIgb3Jp\nZ2luYWwgam9pbiB0eXBlIHByZXZlbnRzIHRoYXQKICAgICAgICBnZXRKb2lu\ncyhqb2lucywgdHJ1ZSk7CgogICAgICAgIFBhdGhKb2lucyBwaiA9IChQYXRo\nSm9pbnMpIGpvaW5zOwogICAgICAgIGJvb2xlYW4gaGFzSm9pbnMgPSBwaiAh\nPSBudWxsICYmIHBqLmlzRGlydHkoKTsKICAgICAgICBpZiAoaGFzSm9pbnMp\nIHsKICAgICAgICAgICAgaWYgKF9wcmVKb2lucyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgX3ByZUpvaW5zID0gbmV3IFN0YWNrKCk7CiAgICAgICAgICAg\nIF9wcmVKb2lucy5wdXNoKHBqKTsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIHRoZXkgYXJlIHNlbGVjdGluZyB0aGlzIG1hcHBpbmcgd2l0aCBvdXRlciBq\nb2lucywgdGhlbiBhbGwgam9pbnMKICAgICAgICAvLyBmcm9tIHRoaXMgbWFw\ncGluZyBzaG91bGQgYWxzbyBiZSBvdXRlcgogICAgICAgIGJvb2xlYW4gd2Fz\nT3V0ZXIgPSAoX2ZsYWdzICYgT1VURVIpICE9IDA7CiAgICAgICAgaWYgKGhh\nc0pvaW5zICYmICF3YXNPdXRlciAmJiBwai5pc091dGVyKCkpCiAgICAgICAg\nICAgIF9mbGFncyB8PSBPVVRFUjsKCiAgICAgICAgLy8gZGVsZWdhdGUgdG8g\nc3RvcmUgbWFuYWdlciB0byBzZWxlY3QgaW4gc2FtZSBvcmRlciBpdCBsb2Fk\ncyByZXN1bHQKICAgICAgICAoKEpEQkNTdG9yZU1hbmFnZXIpIHN0b3JlKS5z\nZWxlY3Qod3JhcHBlciwgbWFwcGluZywgc3ViY2xhc3NlcywgbnVsbCwKICAg\nICAgICAgICAgbnVsbCwgZmV0Y2gsIGVhZ2VyLCBpZGVudCwgKF9mbGFncyAm\nIE9VVEVSKSAhPSAwKTsKCiAgICAgICAgLy8gcmVzZXQKICAgICAgICBpZiAo\naGFzSm9pbnMpCiAgICAgICAgICAgIF9wcmVKb2lucy5wb3AoKTsKICAgICAg\nICBpZiAoIXdhc091dGVyICYmIChfZmxhZ3MgJiBPVVRFUikgIT0gMCkKICAg\nICAgICAgICAgX2ZsYWdzICY9IH5PVVRFUjsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBzZWxlY3RJZGVudGlmaWVyKENvbHVtbiBjb2wpIHsKICAgICAg\nICByZXR1cm4gc2VsZWN0SWRlbnRpZmllcihjb2wsIChKb2lucykgbnVsbCk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0SWRlbnRpZmllcihD\nb2x1bW4gY29sLCBKb2lucyBqb2lucykgewogICAgICAgIGlmICghaXNHcm91\ncGluZygpKQogICAgICAgICAgICByZXR1cm4gc2VsZWN0KGNvbCwgZ2V0Sm9p\nbnMoam9pbnMsIHRydWUpLCB0cnVlKTsKICAgICAgICBncm91cEJ5KGNvbCwg\nam9pbnMpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJs\naWMgaW50IHNlbGVjdElkZW50aWZpZXIoQ29sdW1uW10gY29scykgewogICAg\nICAgIHJldHVybiBzZWxlY3RJZGVudGlmaWVyKGNvbHMsIG51bGwpOwogICAg\nfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0SWRlbnRpZmllcihDb2x1bW5bXSBj\nb2xzLCBKb2lucyBqb2lucykgewogICAgICAgIGlmIChjb2xzID09IG51bGwg\nfHwgY29scy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAg\nICAgICAgaWYgKGlzR3JvdXBpbmcoKSkgewogICAgICAgICAgICBncm91cEJ5\nKGNvbHMsIGpvaW5zKTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAg\nfQogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zLCB0cnVl\nKTsKICAgICAgICBpbnQgc2VsZCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoc2Vs\nZWN0KGNvbHNbaV0sIHBqLCB0cnVlKSkKICAgICAgICAgICAgICAgIHNlbGQg\nfD0gMiA8PCBpOwogICAgICAgIHJldHVybiBzZWxkOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNlbGVjdElkZW50aWZpZXIoQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyKSB7CiAg\nICAgICAgc2VsZWN0SWRlbnRpZmllcihtYXBwaW5nLCBzdWJjbGFzc2VzLCBz\ndG9yZSwgZmV0Y2gsIGVhZ2VyLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZWxlY3RJZGVudGlmaWVyKENsYXNzTWFwcGluZyBtYXBwaW5nLCBp\nbnQgc3ViY2xhc3NlcywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlciwKICAgICAgICBK\nb2lucyBqb2lucykgewogICAgICAgIHNlbGVjdCh0aGlzLCBtYXBwaW5nLCBz\ndWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyLCBqb2lucywgdHJ1ZSk7\nCiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3RQcmltYXJ5S2V5KENsYXNz\nTWFwcGluZyBtYXBwaW5nKSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdFByaW1h\ncnlLZXkobWFwcGluZywgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGludCBz\nZWxlY3RQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5nLCBKb2lucyBq\nb2lucykgewogICAgICAgIHJldHVybiBwcmltYXJ5S2V5T3BlcmF0aW9uKG1h\ncHBpbmcsIHRydWUsIG51bGwsIGpvaW5zLCBmYWxzZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBPcGVyYXRlIG9uIHByaW1hcnkga2V5IGRhdGEuIFJldHVy\nbiBhIGJpdCBtYXNrIG9mIHNlbGVjdGVkIGNvbHVtbnMuCiAgICAgKi8KICAg\nIHByaXZhdGUgaW50IHByaW1hcnlLZXlPcGVyYXRpb24oQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIGJvb2xlYW4gc2VsLAogICAgICAgIEJvb2xlYW4gYXNjLCBK\nb2lucyBqb2lucywgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgaWYg\nKCFzZWwgJiYgYXNjID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiAwOwoK\nICAgICAgICAvLyBpZiB0aGlzIG1hcHBpbmcgY2FuJ3Qgc2VsZWN0IHRoZSBm\ndWxsIHBrIHZhbHVlcywgdGhlbiBqb2luIHRvCiAgICAgICAgLy8gc3VwZXIg\nYW5kIHJlY3Vyc2UKICAgICAgICBDbGFzc01hcHBpbmcgc3VwOwogICAgICAg\nIGlmICghbWFwcGluZy5pc1ByaW1hcnlLZXlPYmplY3RJZCh0cnVlKSkgewog\nICAgICAgICAgICBzdXAgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNs\nYXNzTWFwcGluZygpOwogICAgICAgICAgICBpZiAoam9pbnMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGpvaW5zID0gbmV3Sm9pbnMoKTsKICAgICAgICAg\nICAgam9pbnMgPSBtYXBwaW5nLmpvaW5TdXBlcmNsYXNzKGpvaW5zLCBmYWxz\nZSk7CiAgICAgICAgICAgIHJldHVybiBwcmltYXJ5S2V5T3BlcmF0aW9uKHN1\ncCwgc2VsLCBhc2MsIGpvaW5zLCBhbGlhc09yZGVyKTsKICAgICAgICB9Cgog\nICAgICAgIENvbHVtbltdIGNvbHMgPSBtYXBwaW5nLmdldFByaW1hcnlLZXlD\nb2x1bW5zKCk7CiAgICAgICAgaWYgKGlzR3JvdXBpbmcoKSkgewogICAgICAg\nICAgICBncm91cEJ5KGNvbHMsIGpvaW5zKTsKICAgICAgICAgICAgcmV0dXJu\nIDA7CiAgICAgICAgfQoKICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lu\ncyhqb2lucywgZmFsc2UpOwogICAgICAgIGludCBzZWxkID0gMDsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgIGlmIChjb2x1bW5PcGVyYXRpb24oY29sc1tpXSwgc2VsLCBhc2Ms\nIHBqLCBhbGlhc09yZGVyKSkKICAgICAgICAgICAgICAgIHNlbGQgfD0gMiA8\nPCBpOwoKICAgICAgICAvLyBpZiB0aGlzIG1hcHBpbmcgaGFzIG5vdCBiZWVu\nIHVzZWQgaW4gdGhlIHNlbGVjdCB5ZXQgKGFuZCB0aGVyZWZvcmUKICAgICAg\nICAvLyBpcyBub3Qgam9pbmVkIHRvIGFueXRoaW5nKSwgYnV0IGhhcyBhbiBv\ndGhlci10YWJsZSBzdXBlcmNsYXNzIHRoYXQKICAgICAgICAvLyBoYXMgYmVl\nbiB1c2VkLCBtYWtlIHN1cmUgdG8gam9pbiB0byBpdAogICAgICAgIGJvb2xl\nYW4gam9pbmVkID0gZmFsc2U7CiAgICAgICAgZm9yIChzdXAgPSBtYXBwaW5n\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOyBzdXAgIT0gbnVs\nbDsKICAgICAgICAgICAgbWFwcGluZyA9IHN1cCwgc3VwID0gbWFwcGluZy5n\nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSkgewogICAgICAgICAg\nICBpZiAoc3VwLmdldFRhYmxlKCkgPT0gbWFwcGluZy5nZXRUYWJsZSgpKQog\nICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICBpZiAobWFw\ncGluZy5nZXRUYWJsZSgpICE9IHN1cC5nZXRUYWJsZSgpCiAgICAgICAgICAg\nICAgICAmJiBnZXRUYWJsZUluZGV4KG1hcHBpbmcuZ2V0VGFibGUoKSwgcGos\nIGZhbHNlKSA9PSAtMQogICAgICAgICAgICAgICAgJiYgZ2V0VGFibGVJbmRl\neChzdXAuZ2V0VGFibGUoKSwgcGosIGZhbHNlKSAhPSAtMSkgewogICAgICAg\nICAgICAgICAgaWYgKHBqID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\ncGogPSAoUGF0aEpvaW5zKSBuZXdKb2lucygpOwogICAgICAgICAgICAgICAg\ncGogPSAoUGF0aEpvaW5zKSBtYXBwaW5nLmpvaW5TdXBlcmNsYXNzKHBqLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICBqb2luZWQgPSB0cnVlOwogICAgICAg\nICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0K\nICAgICAgICBpZiAoam9pbmVkKQogICAgICAgICAgICB3aGVyZShwaik7Cgog\nICAgICAgIHJldHVybiBzZWxkOwogICAgfQoKICAgIC8qKgogICAgICogUGVy\nZm9ybSBhbiBvcGVyYXRpb24gb24gYSBjb2x1bW4uCiAgICAgKi8KICAgIHBy\naXZhdGUgYm9vbGVhbiBjb2x1bW5PcGVyYXRpb24oQ29sdW1uIGNvbCwgYm9v\nbGVhbiBzZWwsIEJvb2xlYW4gYXNjLAogICAgICAgIFBhdGhKb2lucyBwaiwg\nYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgU3RyaW5nIGFzID0gbnVs\nbDsKICAgICAgICBpZiAoYXNjICE9IG51bGwgJiYgKGFsaWFzT3JkZXIgfHwg\nKF9mbGFncyAmIFJFQ09SRF9PUkRFUkVEKSAhPSAwKSkgewogICAgICAgICAg\nICBPYmplY3QgaWQ7CiAgICAgICAgICAgIGlmIChwaiA9PSBudWxsIHx8IHBq\nLnBhdGgoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgaWQgPSBjb2w7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlkID0gZ2V0Q29sdW1u\nQWxpYXMoY29sLCBwaik7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgUkVD\nT1JEX09SREVSRUQpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChfb3Jk\nZXJlZCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9vcmRlcmVkID0g\nbmV3IEFycmF5TGlzdCg1KTsKICAgICAgICAgICAgICAgIF9vcmRlcmVkLmFk\nZChpZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFsaWFzT3Jk\nZXIpIHsKICAgICAgICAgICAgICAgIGFzID0gdG9PcmRlckFsaWFzKF9vcmRl\ncnMrKyk7CiAgICAgICAgICAgICAgICBfc2VsZWN0cy5zZXRTZWxlY3RBcyhp\nZCwgYXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBib29s\nZWFuIHNlbGQgPSBzZWwgJiYgc2VsZWN0KGNvbCwgcGosIGZhbHNlKTsKICAg\nICAgICBpZiAoYXNjICE9IG51bGwpIHsKICAgICAgICAgICAgU3RyaW5nIGFs\naWFzID0gKGFzICE9IG51bGwpID8gYXMgOiBnZXRDb2x1bW5BbGlhcyhjb2ws\nIHBqKTsKICAgICAgICAgICAgYXBwZW5kT3JkZXJpbmcoYWxpYXMsIGFzYy5i\nb29sZWFuVmFsdWUoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxk\nOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIG9yZGVyaW5nIGluZm9y\nbWF0aW9uIHRvIG91ciBpbnRlcm5hbCBidWZmZXIuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhcHBlbmRPcmRlcmluZyhPYmplY3Qgb3JkZXJCeSwgYm9v\nbGVhbiBhc2MpIHsKICAgICAgICBpZiAoX29yZGVyaW5nID09IG51bGwpCiAg\nICAgICAgICAgIF9vcmRlcmluZyA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgX29yZGVyaW5nLmFwcGVuZCgiLCAi\nKTsKCiAgICAgICAgaWYgKG9yZGVyQnkgaW5zdGFuY2VvZiBTUUxCdWZmZXIp\nCiAgICAgICAgICAgIF9vcmRlcmluZy5hcHBlbmQoKFNRTEJ1ZmZlcikgb3Jk\nZXJCeSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfb3JkZXJpbmcuYXBw\nZW5kKChTdHJpbmcpIG9yZGVyQnkpOwogICAgICAgIGlmIChhc2MpCiAgICAg\nICAgICAgIF9vcmRlcmluZy5hcHBlbmQoIiBBU0MiKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIF9vcmRlcmluZy5hcHBlbmQoIiBERVNDIik7CiAgICB9\nCgogICAgcHVibGljIGludCBvcmRlckJ5UHJpbWFyeUtleShDbGFzc01hcHBp\nbmcgbWFwcGluZywgYm9vbGVhbiBhc2MsCiAgICAgICAgYm9vbGVhbiBzZWwp\nIHsKICAgICAgICByZXR1cm4gb3JkZXJCeVByaW1hcnlLZXkobWFwcGluZywg\nYXNjLCBudWxsLCBzZWwpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgb3JkZXJC\neVByaW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGJvb2xlYW4gYXNj\nLAogICAgICAgIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCkgewogICAgICAg\nIHJldHVybiBvcmRlckJ5UHJpbWFyeUtleShtYXBwaW5nLCBhc2MsIGpvaW5z\nLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHVu\naW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBjb2x1bW5zLgogICAgICov\nCiAgICBwdWJsaWMgaW50IG9yZGVyQnlQcmltYXJ5S2V5KENsYXNzTWFwcGlu\nZyBtYXBwaW5nLCBib29sZWFuIGFzYywKICAgICAgICBKb2lucyBqb2lucywg\nYm9vbGVhbiBzZWwsIGJvb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIHJl\ndHVybiBwcmltYXJ5S2V5T3BlcmF0aW9uKG1hcHBpbmcsIHNlbCwKICAgICAg\nICAgICAgKGFzYykgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFLCBq\nb2lucywgYWxpYXNPcmRlcik7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nb3JkZXJCeShDb2x1bW4gY29sLCBib29sZWFuIGFzYywgYm9vbGVhbiBzZWwp\nIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShjb2wsIGFzYywgbnVsbCwgc2Vs\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KENvbHVtbiBj\nb2wsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwpIHsK\nICAgICAgICByZXR1cm4gb3JkZXJCeShjb2wsIGFzYywgam9pbnMsIHNlbCwg\nZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRv\nIHNldCBhbGlhc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIGJv\nb2xlYW4gb3JkZXJCeShDb2x1bW4gY29sLCBib29sZWFuIGFzYywgSm9pbnMg\nam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJvb2xlYW4gYWxpYXNPcmRl\ncikgewogICAgICAgIHJldHVybiBjb2x1bW5PcGVyYXRpb24oY29sLCBzZWws\nIChhc2MpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRSwKICAgICAg\nICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpLCBhbGlhc09yZGVyKTsKICAg\nIH0KCiAgICBwdWJsaWMgaW50IG9yZGVyQnkoQ29sdW1uW10gY29scywgYm9v\nbGVhbiBhc2MsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVy\nQnkoY29scywgYXNjLCBudWxsLCBzZWwpOwogICAgfQoKICAgIHB1YmxpYyBp\nbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xzLCBib29sZWFuIGFzYywgSm9pbnMg\nam9pbnMsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnko\nY29scywgYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFsaWFzZXMgb24gb3JkZXIg\nY29sdW1ucy4KICAgICAqLwogICAgaW50IG9yZGVyQnkoQ29sdW1uW10gY29s\ncywgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwKICAg\nICAgICBib29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICBQYXRoSm9pbnMg\ncGogPSBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgaW50IHNlbGQg\nPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgaWYgKGNvbHVtbk9wZXJhdGlvbihjb2xzW2ld\nLCBzZWwsCiAgICAgICAgICAgICAgICAoYXNjKSA/IEJvb2xlYW4uVFJVRSA6\nIEJvb2xlYW4uRkFMU0UsIHBqLCBhbGlhc09yZGVyKSkKICAgICAgICAgICAg\nICAgIHNlbGQgfD0gMiA8PCBpOwogICAgICAgIHJldHVybiBzZWxkOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoU1FMQnVmZmVyIHNxbCwg\nYm9vbGVhbiBhc2MsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9y\nZGVyQnkoc3FsLCBhc2MsIChKb2lucykgbnVsbCwgc2VsKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KFNRTEJ1ZmZlciBzcWwsIGJvb2xl\nYW4gYXNjLCBKb2lucyBqb2lucywKICAgICAgICBib29sZWFuIHNlbCkgewog\nICAgICAgIHJldHVybiBvcmRlckJ5KHNxbCwgYXNjLCBqb2lucywgc2VsLCBm\nYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8g\nc2V0IGFsaWFzZXMgb24gb3JkZXIgY29sdW1ucy4KICAgICAqLwogICAgYm9v\nbGVhbiBvcmRlckJ5KFNRTEJ1ZmZlciBzcWwsIGJvb2xlYW4gYXNjLCBKb2lu\ncyBqb2lucywgYm9vbGVhbiBzZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09y\nZGVyKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnkoKE9iamVjdCkgc3FsLCBh\nc2MsIGpvaW5zLCBzZWwsIGFsaWFzT3JkZXIpOwogICAgfQoKICAgIC8qKgog\nICAgICogT3JkZXIgb24gYSBTUUwgYnVmZmVyIG9yIHN0cmluZy4KICAgICAq\nLwogICAgcHJpdmF0ZSBib29sZWFuIG9yZGVyQnkoT2JqZWN0IHNxbCwgYm9v\nbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwKICAgICAgICBi\nb29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICBPYmplY3Qgb3JkZXIgPSBz\ncWw7CiAgICAgICAgaWYgKGFsaWFzT3JkZXIpIHsKICAgICAgICAgICAgb3Jk\nZXIgPSB0b09yZGVyQWxpYXMoX29yZGVycysrKTsKICAgICAgICAgICAgX3Nl\nbGVjdHMuc2V0U2VsZWN0QXMoc3FsLCAoU3RyaW5nKSBvcmRlcik7CiAgICAg\nICAgfQogICAgICAgIGlmICgoX2ZsYWdzICYgUkVDT1JEX09SREVSRUQpICE9\nIDApIHsKICAgICAgICAgICAgaWYgKF9vcmRlcmVkID09IG51bGwpCiAgICAg\nICAgICAgICAgICBfb3JkZXJlZCA9IG5ldyBBcnJheUxpc3QoNSk7CiAgICAg\nICAgICAgIF9vcmRlcmVkLmFkZChzcWwpOwogICAgICAgIH0KCiAgICAgICAg\nZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAgIGFwcGVuZE9yZGVyaW5n\nKG9yZGVyLCBhc2MpOwogICAgICAgIGlmIChzZWwpIHsKICAgICAgICAgICAg\naW50IGlkeCA9IF9zZWxlY3RzLmluZGV4T2ZBbGlhcyhzcWwpOwogICAgICAg\nICAgICBpZiAoaWR4ID09IC0xKSB7CiAgICAgICAgICAgICAgICBfc2VsZWN0\ncy5zZXRBbGlhcyhudWxsSWQoKSwgc3FsLCBmYWxzZSk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nb3JkZXJCeShTdHJpbmcgc3FsLCBib29sZWFuIGFzYywgYm9vbGVhbiBzZWwp\nIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShzcWwsIGFzYywgbnVsbCwgc2Vs\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KFN0cmluZyBz\ncWwsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwpIHsK\nICAgICAgICByZXR1cm4gb3JkZXJCeShzcWwsIGFzYywgam9pbnMsIHNlbCwg\nZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRv\nIHNldCBhbGlhc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIGJv\nb2xlYW4gb3JkZXJCeShTdHJpbmcgc3FsLCBib29sZWFuIGFzYywgSm9pbnMg\nam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJvb2xlYW4gYWxpYXNPcmRl\ncikgewogICAgICAgIHJldHVybiBvcmRlckJ5KChPYmplY3QpIHNxbCwgYXNj\nLCBqb2lucywgc2VsLCBhbGlhc09yZGVyKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBjbGVhck9yZGVyaW5nKCkgewogICAgICAgIF9vcmRlcmluZyA9IG51\nbGw7CiAgICAgICAgX29yZGVycyA9IDA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBbGxvdyB1bmlvbnMgdG8gcmVjb3JkIHRoZSBzZWxlY3QgbGlzdCBpbmRl\neGVzIG9mIGl0ZW1zIHdlIG9yZGVyIGJ5LgogICAgICovCiAgICB2b2lkIHNl\ndFJlY29yZE9yZGVyZWRJbmRleGVzKGJvb2xlYW4gcmVjb3JkKSB7CiAgICAg\nICAgaWYgKHJlY29yZCkKICAgICAgICAgICAgX2ZsYWdzIHw9IFJFQ09SRF9P\nUkRFUkVEOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBfb3JkZXJlZCA9\nIG51bGw7CiAgICAgICAgICAgIF9mbGFncyAmPSB+UkVDT1JEX09SREVSRUQ7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBp\nbmRleGVzIGluIHRoZSBzZWxlY3QgbGlzdCBvZiBhbGwgaXRlbXMgd2UncmUg\nb3JkZXJpbmcKICAgICAqIGJ5LCBvciBudWxsIGlmIG5vbmUuIEZvciB1c2Ug\nd2l0aCB1bmlvbnMuCiAgICAgKi8KICAgIExpc3QgZ2V0T3JkZXJlZEluZGV4\nZXMoKSB7CiAgICAgICAgaWYgKF9vcmRlcmVkID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIExpc3QgaWR4cyA9IG5ldyBBcnJh\neUxpc3QoX29yZGVyZWQuc2l6ZSgpKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IF9vcmRlcmVkLnNpemUoKTsgaSsrKQogICAgICAgICAgICBpZHhz\nLmFkZChOdW1iZXJzLnZhbHVlT2YoX3NlbGVjdHMuaW5kZXhPZihfb3JkZXJl\nZC5nZXQoaSkpKSk7CiAgICAgICAgcmV0dXJuIGlkeHM7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgd2hlcmVQcmltYXJ5S2V5KE9iamVjdCBvaWQsIENsYXNz\nTWFwcGluZyBtYXBwaW5nLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSkgewog\nICAgICAgIHdoZXJlUHJpbWFyeUtleShvaWQsIG1hcHBpbmcsIG51bGwsIHN0\nb3JlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB3aGVyZSBjb25kaXRp\nb25zIHNldHRpbmcgdGhlIG1hcHBpbmcncyBwcmltYXJ5IGtleSB0byB0aGUg\nZ2l2ZW4KICAgICAqIG9pZCB2YWx1ZXMuIElmIHRoZSBnaXZlbiBtYXBwaW5n\nIGRvZXMgbm90IHVzZSBvaWQgdmFsdWVzIGZvciBpdHMKICAgICAqIHByaW1h\ncnkga2V5LCB3ZSB3aWxsIHJlY3Vyc2l2ZWx5IGpvaW4gdG8gaXRzIHN1cGVy\nY2xhc3MgdW50aWwgd2UgZmluZAogICAgICogYW4gYW5jZXN0b3IgdGhhdCBk\nb2VzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd2hlcmVQcmltYXJ5S2V5\nKE9iamVjdCBvaWQsIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKb2lucyBqb2lu\ncywKICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICAvLyBpZiB0\naGlzIG1hcHBpbmcncyBpZGVudGlmaWVycyBpbmNsdWRlIHNvbWV0aGluZyBv\ndGhlciB0aGFuCiAgICAgICAgLy8gdGhlIHBrIHZhbHVlcywgam9pbiB0byBz\ndXBlciBhbmQgcmVjdXJzZQogICAgICAgIGlmICghbWFwcGluZy5pc1ByaW1h\ncnlLZXlPYmplY3RJZChmYWxzZSkpIHsKICAgICAgICAgICAgQ2xhc3NNYXBw\naW5nIHN1cCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBw\naW5nKCk7CiAgICAgICAgICAgIGlmIChqb2lucyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgam9pbnMgPSBuZXdKb2lucygpOwogICAgICAgICAgICBqb2lu\ncyA9IG1hcHBpbmcuam9pblN1cGVyY2xhc3Moam9pbnMsIGZhbHNlKTsKICAg\nICAgICAgICAgd2hlcmVQcmltYXJ5S2V5KG9pZCwgc3VwLCBqb2lucywgc3Rv\ncmUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBD\nb2x1bW5bXSBjb2xzID0gbWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygp\nOwogICAgICAgIHdoZXJlKG9pZCwgbWFwcGluZywgY29scywgY29scywgbnVs\nbCwgbnVsbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpLAogICAgICAgICAgICBz\ndG9yZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVGb3JlaWduS2V5\nKEZvcmVpZ25LZXkgZmssIE9iamVjdCBvaWQsCiAgICAgICAgQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHdoZXJl\nRm9yZWlnbktleShmaywgb2lkLCBtYXBwaW5nLCBudWxsLCBzdG9yZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGQgd2hlcmUgY29uZGl0aW9ucyBzZXR0\naW5nIHRoZSBnaXZlbiBmb3JlaWduIGtleSB0byB0aGUgZ2l2ZW4KICAgICAq\nIG9pZCB2YWx1ZXMuCiAgICAgKgogICAgICogQHNlZSAjd2hlcmVQcmltYXJ5\nS2V5CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3aGVyZUZvcmVpZ25LZXko\nRm9yZWlnbktleSBmaywgT2JqZWN0IG9pZCwKICAgICAgICBDbGFzc01hcHBp\nbmcgbWFwcGluZywgSm9pbnMgam9pbnMsIEpEQkNTdG9yZSBzdG9yZSkgewog\nICAgICAgIC8vIGlmIHRoaXMgbWFwcGluZydzIGlkZW50aWZpZXJzIGluY2x1\nZGUgc29tZXRoaW5nIG90aGVyIHRoYW4KICAgICAgICAvLyB0aGUgcGsgdmFs\ndWVzLCBvciBpZiB0aGlzIGZvcmVpZ24ga2V5IGRvZXNuJ3QgbGluayB0byBv\nbmx5CiAgICAgICAgLy8gaWRlbnRpZmllcnMsIGpvaW4gdG8gdGFibGUgYW5k\nIGRvIGEgZ2V0UHJpbWFyeUtleQogICAgICAgIGlmICghbWFwcGluZy5pc1By\naW1hcnlLZXlPYmplY3RJZChmYWxzZSkgfHwgIWNvbnRhaW5zQWxsCiAgICAg\nICAgICAgIChtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCksIGZrLmdl\ndFByaW1hcnlLZXlDb2x1bW5zKCkpKSB7CiAgICAgICAgICAgIGlmIChqb2lu\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgam9pbnMgPSBuZXdKb2lucygp\nOwogICAgICAgICAgICAvLyB0cmF2ZXJzZSB0byBmb3JlaWduIGtleSB0YXJn\nZXQgbWFwcGluZwogICAgICAgICAgICB3aGlsZSAobWFwcGluZy5nZXRUYWJs\nZSgpICE9IGZrLmdldFByaW1hcnlLZXlUYWJsZSgpKSB7CiAgICAgICAgICAg\nICAgICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBq\nb2lucyA9IG5ld0pvaW5zKCk7CiAgICAgICAgICAgICAgICBqb2lucyA9IG1h\ncHBpbmcuam9pblN1cGVyY2xhc3Moam9pbnMsIGZhbHNlKTsKICAgICAgICAg\nICAgICAgIG1hcHBpbmcgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNs\nYXNzTWFwcGluZygpOwogICAgICAgICAgICAgICAgaWYgKG1hcHBpbmcgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxF\neGNlcHRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBqb2lucyA9\nIGpvaW5zLmpvaW4oZmssIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICAgIHdo\nZXJlUHJpbWFyeUtleShvaWQsIG1hcHBpbmcsIGpvaW5zLCBzdG9yZSk7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIENvbHVtbltd\nIGZyb21Db2xzID0gZmsuZ2V0Q29sdW1ucygpOwogICAgICAgIENvbHVtbltd\nIHRvQ29scyA9IGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAg\nQ29sdW1uW10gY29uc3RDb2xzID0gZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCk7\nCiAgICAgICAgT2JqZWN0W10gY29uc3RzID0gZmsuZ2V0Q29uc3RhbnRzKCk7\nCiAgICAgICAgd2hlcmUob2lkLCBtYXBwaW5nLCB0b0NvbHMsIGZyb21Db2xz\nLCBjb25zdHMsIGNvbnN0Q29scywKICAgICAgICAgICAgZ2V0Sm9pbnMoam9p\nbnMsIHRydWUpLCBzdG9yZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRl\ncm5hbCBtZXRob2QgdG8gZmx1c2ggdGhlIG9pZCB2YWx1ZXMgYXMgd2hlcmUg\nY29uZGl0aW9ucyB0byB0aGUKICAgICAqIGdpdmVuIGNvbHVtbnMuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCB3aGVyZShPYmplY3Qgb2lkLCBDbGFzc01h\ncHBpbmcgbWFwcGluZywgQ29sdW1uW10gdG9Db2xzLAogICAgICAgIENvbHVt\nbltdIGZyb21Db2xzLCBPYmplY3RbXSB2YWxzLCBDb2x1bW5bXSBjb25zdENv\nbHMsIFBhdGhKb2lucyBwaiwKICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsK\nICAgICAgICBWYWx1ZU1hcHBpbmcgZW1iZWQgPSBtYXBwaW5nLmdldEVtYmVk\nZGluZ01hcHBpbmcoKTsKICAgICAgICBpZiAoZW1iZWQgIT0gbnVsbCkgewog\nICAgICAgICAgICB3aGVyZShvaWQsIGVtYmVkLmdldEZpZWxkTWFwcGluZygp\nLmdldERlZmluaW5nTWFwcGluZygpLAogICAgICAgICAgICAgICAgdG9Db2xz\nLCBmcm9tQ29scywgdmFscywgY29uc3RDb2xzLCBwaiwgc3RvcmUpOwogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBvbmx5IGJv\ndGhlciB0byBwYWNrIHBrIHZhbHVlcyBpbnRvIGFycmF5IGlmIGFwcCBpZAog\nICAgICAgIE9iamVjdFtdIHBrcyA9IG51bGw7CiAgICAgICAgaWYgKG1hcHBp\nbmcuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX0FQUExJ\nQ0FUSU9OKQogICAgICAgICAgICBwa3MgPSBBcHBsaWNhdGlvbklkcy50b1BL\nVmFsdWVzKG9pZCwgbWFwcGluZyk7CgogICAgICAgIFNRTEJ1ZmZlciBidWYg\nPSBuZXcgU1FMQnVmZmVyKF9kaWN0KTsKICAgICAgICBKb2luYWJsZSBqb2lu\nOwogICAgICAgIE9iamVjdCB2YWw7CiAgICAgICAgaW50IGNvdW50ID0gMDsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRvQ29scy5sZW5ndGg7IGkr\nKywgY291bnQrKykgewogICAgICAgICAgICBpZiAocGtzID09IG51bGwpCiAg\nICAgICAgICAgICAgICB2YWwgPSAob2lkID09IG51bGwpID8gbnVsbCA6IE51\nbWJlcnMudmFsdWVPZigoKElkKSBvaWQpLmdldElkKCkpOwogICAgICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIG11c3QgYmUgYXBwIGlkZW50\naXR5OyB1c2UgcGsgaW5kZXggdG8gZ2V0IGNvcnJlY3QgcGsgdmFsdWUKICAg\nICAgICAgICAgICAgIGpvaW4gPSBtYXBwaW5nLmFzc2VydEpvaW5hYmxlKHRv\nQ29sc1tpXSk7CiAgICAgICAgICAgICAgICB2YWwgPSBwa3NbbWFwcGluZy5n\nZXRGaWVsZChqb2luLmdldEZpZWxkSW5kZXgoKSkuCiAgICAgICAgICAgICAg\nICAgICAgZ2V0UHJpbWFyeUtleUluZGV4KCldOwogICAgICAgICAgICAgICAg\ndmFsID0gam9pbi5nZXRKb2luVmFsdWUodmFsLCB0b0NvbHNbaV0sIHN0b3Jl\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNvdW50ID4gMCkK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoZ2V0Q29sdW1uQWxpYXMoZnJvbUNvbHNbaV0sIHBq\nKSk7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiBJUyAiKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiID0gIik7CiAgICAgICAgICAgIGJ1\nZi5hcHBlbmRWYWx1ZSh2YWwsIGZyb21Db2xzW2ldKTsKICAgICAgICB9Cgog\nICAgICAgIGlmIChjb25zdENvbHMgIT0gbnVsbCAmJiBjb25zdENvbHMubGVu\nZ3RoID4gMCkgewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNv\nbnN0Q29scy5sZW5ndGg7IGkrKywgY291bnQrKykgewogICAgICAgICAgICAg\nICAgaWYgKGNvdW50ID4gMCkKICAgICAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKCIgQU5EICIpOwogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChnZXRD\nb2x1bW5BbGlhcyhjb25zdENvbHNbaV0sIHBqKSk7CgogICAgICAgICAgICAg\nICAgaWYgKHZhbHNbaV0gPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgSVMgIik7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiID0gIik7CiAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kVmFsdWUodmFsc1tpXSwgY29uc3RDb2xzW2ldKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgd2hlcmUoYnVmLCBw\naik7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRvIHNlZSBpZiB0aGUg\nZ2l2ZW4gc2V0IG9mIGNvbHVtbnMgY29udGFpbnMgYWxsIHRoZQogICAgICog\nY29sdW1ucyBpbiB0aGUgZ2l2ZW4gcG90ZW50aWFsIHN1YnNldC4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBjb250YWluc0FsbChDb2x1\nbW5bXSBzZXQsIENvbHVtbltdIHN1YikgewogICAgICAgIGlmIChzdWIubGVu\nZ3RoID4gc2V0Lmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoK\nICAgICAgICAvLyB0aGlzIGlzIG9idmlvdXNseSBuXjIsIGJ1dCB0aGUgbnVt\nYmVyIG9mIGNvbHVtbnMgc2hvdWxkIGJlIGluCiAgICAgICAgLy8gdGhlIDEt\nMiByYW5nZSwgc28gbm8gYmlnZ2llCiAgICAgICAgYm9vbGVhbiBmb3VuZCA9\nIHRydWU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdWIubGVuZ3Ro\nICYmIGZvdW5kOyBpKyspIHsKICAgICAgICAgICAgZm91bmQgPSBmYWxzZTsK\nICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBzZXQubGVuZ3RoICYm\nICFmb3VuZDsgaisrKQogICAgICAgICAgICAgICAgZm91bmQgPSBzdWJbaV0g\nPT0gc2V0W2pdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZm91bmQ7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgd2hlcmUoSm9pbnMgam9pbnMpIHsKICAg\nICAgICBpZiAoam9pbnMgIT0gbnVsbCkKICAgICAgICAgICAgd2hlcmUoKFN0\ncmluZykgbnVsbCwgam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdo\nZXJlKFNRTEJ1ZmZlciBzcWwpIHsKICAgICAgICB3aGVyZShzcWwsIChKb2lu\ncykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmUoU1FMQnVm\nZmVyIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICB3aGVyZShzcWwsIGdl\ndEpvaW5zKGpvaW5zLCB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgdGhlIGdpdmVuIGNvbmRpdGlvbiB0byB0aGUgV0hFUkUgY2xhdXNlLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgd2hlcmUoU1FMQnVmZmVyIHNxbCwg\nUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgLy8gbm8gbmVlZCB0byB1c2Ugam9p\nbnMuLi4KICAgICAgICBpZiAoc3FsID09IG51bGwgfHwgc3FsLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX3doZXJlID09\nIG51bGwpCiAgICAgICAgICAgIF93aGVyZSA9IG5ldyBTUUxCdWZmZXIoX2Rp\nY3QpOwogICAgICAgIGVsc2UgaWYgKCFfd2hlcmUuaXNFbXB0eSgpKQogICAg\nICAgICAgICBfd2hlcmUuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIF93aGVy\nZS5hcHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZShT\ndHJpbmcgc3FsKSB7CiAgICAgICAgd2hlcmUoc3FsLCAoSm9pbnMpIG51bGwp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKFN0cmluZyBzcWwsIEpv\naW5zIGpvaW5zKSB7CiAgICAgICAgd2hlcmUoc3FsLCBnZXRKb2lucyhqb2lu\ncywgdHJ1ZSkpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZl\nbiBjb25kaXRpb24gdG8gdGhlIFdIRVJFIGNsYXVzZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHdoZXJlKFN0cmluZyBzcWwsIFBhdGhKb2lucyBwaikg\newogICAgICAgIC8vIG5vIG5lZWQgdG8gdXNlIGpvaW5zLi4uCiAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc3FsKSkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBpZiAoX3doZXJlID09IG51bGwpCiAgICAgICAgICAg\nIF93aGVyZSA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2Ug\naWYgKCFfd2hlcmUuaXNFbXB0eSgpKQogICAgICAgICAgICBfd2hlcmUuYXBw\nZW5kKCIgQU5EICIpOwogICAgICAgIF93aGVyZS5hcHBlbmQoc3FsKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBoYXZpbmcoU1FMQnVmZmVyIHNxbCkgewog\nICAgICAgIGhhdmluZyhzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgaGF2aW5nKFNRTEJ1ZmZlciBzcWwsIEpvaW5zIGpvaW5z\nKSB7CiAgICAgICAgaGF2aW5nKHNxbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY29uZGl0\naW9uIHRvIHRoZSBIQVZJTkcgY2xhdXNlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgaGF2aW5nKFNRTEJ1ZmZlciBzcWwsIFBhdGhKb2lucyBwaikgewog\nICAgICAgIC8vIG5vIG5lZWQgdG8gdXNlIGpvaW5zLi4uCiAgICAgICAgaWYg\nKHNxbCA9PSBudWxsIHx8IHNxbC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgaWYgKF9oYXZpbmcgPT0gbnVsbCkKICAgICAgICAg\nICAgX2hhdmluZyA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVs\nc2UgaWYgKCFfaGF2aW5nLmlzRW1wdHkoKSkKICAgICAgICAgICAgX2hhdmlu\nZy5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgX2hhdmluZy5hcHBlbmQoc3Fs\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBoYXZpbmcoU3RyaW5nIHNxbCkg\newogICAgICAgIGhhdmluZyhzcWwsIChKb2lucykgbnVsbCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgaGF2aW5nKFN0cmluZyBzcWwsIEpvaW5zIGpvaW5z\nKSB7CiAgICAgICAgaGF2aW5nKHNxbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY29uZGl0\naW9uIHRvIHRoZSBIQVZJTkcgY2xhdXNlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgaGF2aW5nKFN0cmluZyBzcWwsIFBhdGhKb2lucyBwaikgewogICAg\nICAgIC8vIG5vIG5lZWQgdG8gdXNlIGpvaW5zLi4uCiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkoc3FsKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBpZiAoX2hhdmluZyA9PSBudWxsKQogICAgICAgICAgICBfaGF2\naW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgZWxzZSBpZiAo\nIV9oYXZpbmcuaXNFbXB0eSgpKQogICAgICAgICAgICBfaGF2aW5nLmFwcGVu\nZCgiIEFORCAiKTsKICAgICAgICBfaGF2aW5nLmFwcGVuZChzcWwpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU1FMQnVmZmVyIHNxbCkgewog\nICAgICAgIGdyb3VwQnkoc3FsLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGdyb3VwQnkoU1FMQnVmZmVyIHNxbCwgSm9pbnMgam9p\nbnMpIHsKICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAg\nZ3JvdXBCeUFwcGVuZChzcWwuZ2V0U1FMKCkpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGdyb3VwQnkoU3RyaW5nIHNxbCkgewogICAgICAgIGdyb3VwQnko\nc3FsLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdy\nb3VwQnkoU3RyaW5nIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBnZXRK\nb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgZ3JvdXBCeUFwcGVuZChzcWwp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ29sdW1uIGNvbCkg\newogICAgICAgIGdyb3VwQnkoY29sLCBudWxsKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBncm91cEJ5KENvbHVtbiBjb2wsIEpvaW5zIGpvaW5zKSB7CiAg\nICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwog\nICAgICAgIGdyb3VwQnlBcHBlbmQoZ2V0Q29sdW1uQWxpYXMoY29sLCBwaikp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ29sdW1uW10gY29s\ncykgewogICAgICAgIGdyb3VwQnkoY29scywgbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW5bXSBjb2xzLCBKb2lucyBqb2lu\ncykgewogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zLCB0\ncnVlKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgZ3JvdXBCeUFwcGVuZChnZXRDb2x1bW5B\nbGlhcyhjb2xzW2ldLCBwaikpOwogICAgICAgIH0KICAgIH0KICAgIAogICAg\ncHJpdmF0ZSB2b2lkIGdyb3VwQnlBcHBlbmQoU3RyaW5nIHNxbCkgewogICAg\nICAgIGlmIChfZ3JvdXBlZCA9PSBudWxsIHx8ICFfZ3JvdXBlZC5jb250YWlu\ncyhzcWwpKSB7CiAgICAgICAgICAgIGlmIChfZ3JvdXBpbmcgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgX2dyb3VwaW5nID0gbmV3IFNRTEJ1ZmZlcihf\nZGljdCk7CiAgICAgICAgICAgICAgICBfZ3JvdXBlZCA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBfZ3Jv\ndXBpbmcuYXBwZW5kKCIsICIpOwoKICAgICAgICAgICAgX2dyb3VwaW5nLmFw\ncGVuZChzcWwpOwogICAgICAgICAgICBfZ3JvdXBlZC5hZGQoc3FsKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDbGFzc01h\ncHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMsIEpEQkNTdG9yZSBzdG9y\nZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAg\nICAgICAgZ3JvdXBCeShtYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0\nY2gsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLCBKREJDU3RvcmUg\nc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwg\nSm9pbnMgam9pbnMpIHsKICAgICAgICAvLyB3ZSBpbXBsZW1lbnQgdGhpcyBi\neSBwdXR0aW5nIG91cnNlbHZlcyBpbnRvIGdyb3VwaW5nIG1vZGUsIHdoZXJl\nCiAgICAgICAgLy8gYWxsIHNlbGVjdCBpbnZvY2F0aW9ucyBhcmUgcmUtcm91\ndGVkIHRvIGdyb3VwLWJ5IGludm9jYXRpb25zIGluc3RlYWQuCiAgICAgICAg\nLy8gdGhpcyBhbGxvd3MgdXMgdG8gdXRpbGl6ZSB0aGUgc2FtZSBzZWxlY3Qg\nQVBJcyBvZiB0aGUgc3RvcmUgbWFuYWdlcgogICAgICAgIC8vIGFuZCBhbGwg\ndGhlIG1hcHBpbmcgc3RyYXRlZ2llcywgcmF0aGVyIHRoYW4gaGF2aW5nIHRv\nIGNyZWF0ZSAKICAgICAgICAvLyBlcXVpdmFsZW50IEFQSXMgYW5kIGR1cGxp\nY2F0ZSBsb2dpYyBmb3IgZ3JvdXBpbmcKICAgICAgICBib29sZWFuIHdhc0dy\nb3VwaW5nID0gaXNHcm91cGluZygpOwogICAgICAgIF9mbGFncyB8PSBHUk9V\nUElORzsKICAgICAgICB0cnkgewogICAgICAgICAgICBzZWxlY3QobWFwcGlu\nZywgc3ViY2xhc3Nlcywgc3RvcmUsIGZldGNoLCAKICAgICAgICAgICAgICAg\nIEVhZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9OT05FLCBqb2lucyk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKCF3YXNHcm91cGluZykKICAg\nICAgICAgICAgICAgIF9mbGFncyAmPSB+R1JPVVBJTkc7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB3ZSdyZSBpbiBncm91cCBt\nb2RlLCB3aGVyZSBhbnkgc2VsZWN0IGlzIGNoYW5nZWQgdG8gYSBncm91cC1i\neQogICAgICogY2FsbC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlz\nR3JvdXBpbmcoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBHUk9VUElO\nRykgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgam9p\nbnMgdG8gdXNlIGZvciBjb2x1bW4gYWxpYXNlcywgZXRjLgogICAgICoKICAg\nICAqIEBwYXJhbSBqb2lucyBqb2lucyBnaXZlbiBieSB0aGUgdXNlcgogICAg\nICogQHJldHVybiB0aGUgam9pbnMgdG8gdXNlIGZvciBhbGlhc2VzLCBldGMK\nICAgICAqLwogICAgcHJpdmF0ZSBQYXRoSm9pbnMgZ2V0Sm9pbnMoSm9pbnMg\nam9pbnMsIGJvb2xlYW4gcmVjb3JkKSB7CiAgICAgICAgUGF0aEpvaW5zIHBq\nID0gKFBhdGhKb2lucykgam9pbnM7CiAgICAgICAgYm9vbGVhbiBwcmUgPSAo\ncGogPT0gbnVsbCB8fCAhcGouaXNEaXJ0eSgpKQogICAgICAgICAgICAmJiBf\ncHJlSm9pbnMgIT0gbnVsbCAmJiAhX3ByZUpvaW5zLmlzRW1wdHkoKTsKICAg\nICAgICBpZiAocHJlKQogICAgICAgICAgICBwaiA9IChQYXRoSm9pbnMpIF9w\ncmVKb2lucy5wZWVrKCk7CgogICAgICAgIGlmIChwaiA9PSBudWxsIHx8ICFw\nai5pc0RpcnR5KCkpCiAgICAgICAgICAgIHBqID0gX2pvaW5zOwogICAgICAg\nIGVsc2UgaWYgKCFwcmUpIHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBP\nVVRFUikgIT0gMCkKICAgICAgICAgICAgICAgIHBqID0gKFBhdGhKb2lucykg\nb3V0ZXIocGopOwogICAgICAgICAgICBpZiAocmVjb3JkKSB7CiAgICAgICAg\nICAgICAgICBpZiAoIXBqLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAg\nICByZW1vdmVQYXJlbnRKb2lucyhwaik7CiAgICAgICAgICAgICAgICBpZiAo\nIXBqLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZUpv\naW5zRnJvbVN1YnNlbGVjdHMocGopOwogICAgICAgICAgICAgICAgICAgIGlm\nIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX2pv\naW5zID0gbmV3IFNlbGVjdEpvaW5zKHRoaXMpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChfam9pbnMuam9pbnMoKSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICBfam9pbnMuc2V0Sm9pbnMobmV3IEpvaW5TZXQocGouam9p\nbnMoKSkpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICAgICAgX2pvaW5zLmpvaW5zKCkuYWRkQWxsKHBqLmpvaW5zKCkp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBwajsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92\nZSBhbnkgam9pbnMgYWxyZWFkeSBpbiBvdXIgcGFyZW50IHNlbGVjdCBmcm9t\nIHRoZSBnaXZlbiBub24tZW1wdHkKICAgICAqIGpvaW4gc2V0LgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcmVtb3ZlUGFyZW50Sm9pbnMoUGF0aEpvaW5z\nIHBqKSB7CiAgICAgICAgaWYgKF9wYXJlbnQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIGlmIChfcGFyZW50Ll9qb2lucyAhPSBudWxs\nICYmICFfcGFyZW50Ll9qb2lucy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAg\nYm9vbGVhbiByZW1vdmVkID0gZmFsc2U7CiAgICAgICAgICAgIGlmICghX3Jl\nbW92ZWRBbGlhc0Zyb21QYXJlbnQuaXNFbXB0eSgpKQogICAgICAgICAgICAg\nICAgcmVtb3ZlZCA9IF9wYXJlbnQuX2pvaW5zLmpvaW5zKCkucmVtb3ZlQWxs\nKHBqLmpvaW5zKCkpOwogICAgICAgICAgICBpZiAoIXJlbW92ZWQpCiAgICAg\nICAgICAgICAgICBwai5qb2lucygpLnJlbW92ZUFsbChfcGFyZW50Ll9qb2lu\ncy5qb2lucygpKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFwai5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIF9wYXJlbnQucmVtb3ZlUGFyZW50Sm9pbnMocGop\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBub24t\nZW1wdHkgam9pbnMgZnJvbSB0aGUgam9pbnMgb2Ygb3VyIHN1YnNlbGVjdHMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZW1vdmVKb2luc0Zyb21TdWJz\nZWxlY3RzKFBhdGhKb2lucyBwaikgewogICAgICAgIGlmIChfc3Vic2VscyA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgU2VsZWN0SW1w\nbCBzdWI7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfc3Vic2Vscy5z\naXplKCk7IGkrKykgewogICAgICAgICAgICBzdWIgPSAoU2VsZWN0SW1wbCkg\nX3N1YnNlbHMuZ2V0KGkpOwogICAgICAgICAgICBpZiAoc3ViLl9qb2lucyAh\nPSBudWxsICYmICFzdWIuX2pvaW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAg\nICAgIHN1Yi5fam9pbnMuam9pbnMoKS5yZW1vdmVBbGwocGouam9pbnMoKSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTZWxlY3RFeGVjdXRvciB3\naGVyZUNsb25lKGludCBzZWxzKSB7CiAgICAgICAgaWYgKHNlbHMgPCAxKQog\nICAgICAgICAgICBzZWxzID0gMTsKCiAgICAgICAgU2VsZWN0W10gY2xvbmVz\nID0gbnVsbDsKICAgICAgICBTZWxlY3RJbXBsIHNlbDsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHNlbHM7IGkrKykgewogICAgICAgICAgICBzZWwg\nPSAoU2VsZWN0SW1wbCkgX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCku\nbmV3U2VsZWN0KCk7CiAgICAgICAgICAgIHNlbC5fZmxhZ3MgPSBfZmxhZ3M7\nCiAgICAgICAgICAgIHNlbC5fZmxhZ3MgJj0gfkFHR1JFR0FURTsKICAgICAg\nICAgICAgc2VsLl9mbGFncyAmPSB+T1VURVI7CiAgICAgICAgICAgIHNlbC5f\nZmxhZ3MgJj0gfkxSUzsKICAgICAgICAgICAgc2VsLl9mbGFncyAmPSB+RUFH\nRVJfVE9fT05FOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9IH5FQUdFUl9U\nT19NQU5ZOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9IH5GT1JDRV9DT1VO\nVDsKICAgICAgICAgICAgc2VsLl9qb2luU3ludGF4ID0gX2pvaW5TeW50YXg7\nCiAgICAgICAgICAgIGlmIChfYWxpYXNlcyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgc2VsLl9hbGlhc2VzID0gbmV3IEhhc2hNYXAoX2FsaWFzZXMpOwog\nICAgICAgICAgICBpZiAoX3RhYmxlcyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgc2VsLl90YWJsZXMgPSBuZXcgVHJlZU1hcChfdGFibGVzKTsKICAgICAg\nICAgICAgaWYgKF9qb2lucyAhPSBudWxsKQogICAgICAgICAgICAgICAgc2Vs\nLl9qb2lucyA9IF9qb2lucy5jbG9uZShzZWwpOwogICAgICAgICAgICBpZiAo\nX3doZXJlICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX3doZXJlID0g\nbmV3IFNRTEJ1ZmZlcihfd2hlcmUpOwogICAgICAgICAgICBpZiAoX2Zyb20g\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VsLl9mcm9tID0gKFNlbGVj\ndEltcGwpIF9mcm9tLndoZXJlQ2xvbmUoMSk7CiAgICAgICAgICAgICAgICBz\nZWwuX2Zyb20uX291dGVyID0gc2VsOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChfc3Vic2VscyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBz\nZWwuX3N1YnNlbHMgPSBuZXcgQXJyYXlMaXN0KF9zdWJzZWxzLnNpemUoKSk7\nCiAgICAgICAgICAgICAgICBTZWxlY3RJbXBsIHN1Yiwgc2VsU3ViOwogICAg\nICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBfc3Vic2Vscy5zaXpl\nKCk7IGorKykgewogICAgICAgICAgICAgICAgICAgIHN1YiA9IChTZWxlY3RJ\nbXBsKSBfc3Vic2Vscy5nZXQoaik7CiAgICAgICAgICAgICAgICAgICAgc2Vs\nU3ViID0gKFNlbGVjdEltcGwpIHN1Yi5mdWxsQ2xvbmUoMSk7CiAgICAgICAg\nICAgICAgICAgICAgc2VsU3ViLl9wYXJlbnQgPSBzZWw7CiAgICAgICAgICAg\nICAgICAgICAgc2VsU3ViLl9zdWJQYXRoID0gc3ViLl9zdWJQYXRoOwogICAg\nICAgICAgICAgICAgICAgIHNlbC5fc3Vic2Vscy5hZGQoc2VsU3ViKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoc2VsLl93aGVyZSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICBzZWwuX3doZXJlLnJlcGxhY2Uoc3ViLCBz\nZWxTdWIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICBpZiAoc2VscyA9PSAxKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHNlbDsKICAgICAgICAgICAgaWYgKGNsb25lcyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgY2xvbmVzID0gbmV3IFNlbGVjdFtzZWxzXTsKICAgICAgICAg\nICAgY2xvbmVzW2ldID0gc2VsOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCkubmV3VW5pb24oY2xvbmVz\nKTsKICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0RXhlY3V0b3IgZnVsbENsb25l\nKGludCBzZWxzKSB7CiAgICAgICAgaWYgKHNlbHMgPCAxKQogICAgICAgICAg\nICBzZWxzID0gMTsKCiAgICAgICAgU2VsZWN0W10gY2xvbmVzID0gbnVsbDsK\nICAgICAgICBTZWxlY3RJbXBsIHNlbDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHNlbHM7IGkrKykgewogICAgICAgICAgICBzZWwgPSAoU2VsZWN0\nSW1wbCkgd2hlcmVDbG9uZSgxKTsKICAgICAgICAgICAgc2VsLl9mbGFncyA9\nIF9mbGFnczsKICAgICAgICAgICAgc2VsLl9leHBlY3RlZFJlc3VsdENvdW50\nID0gX2V4cGVjdGVkUmVzdWx0Q291bnQ7CiAgICAgICAgICAgIHNlbC5fc2Vs\nZWN0cy5hZGRBbGwoX3NlbGVjdHMpOwogICAgICAgICAgICBpZiAoX29yZGVy\naW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX29yZGVyaW5nID0g\nbmV3IFNRTEJ1ZmZlcihfb3JkZXJpbmcpOwogICAgICAgICAgICBzZWwuX29y\nZGVycyA9IF9vcmRlcnM7CiAgICAgICAgICAgIGlmIChfZ3JvdXBpbmcgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHNlbC5fZ3JvdXBpbmcgPSBuZXcgU1FM\nQnVmZmVyKF9ncm91cGluZyk7CiAgICAgICAgICAgIGlmIChfaGF2aW5nICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX2hhdmluZyA9IG5ldyBTUUxC\ndWZmZXIoX2hhdmluZyk7CiAgICAgICAgICAgIGlmIChfZnJvbSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBzZWwuX2Zyb20gPSAoU2VsZWN0SW1wbCkg\nX2Zyb20uZnVsbENsb25lKDEpOwogICAgICAgICAgICAgICAgc2VsLl9mcm9t\nLl9vdXRlciA9IHNlbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYg\nKHNlbHMgPT0gMSkKICAgICAgICAgICAgICAgIHJldHVybiBzZWw7CiAgICAg\nICAgICAgIGlmIChjbG9uZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNs\nb25lcyA9IG5ldyBTZWxlY3Rbc2Vsc107CiAgICAgICAgICAgIGNsb25lc1tp\nXSA9IHNlbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jb25mLmdldFNR\nTEZhY3RvcnlJbnN0YW5jZSgpLm5ld1VuaW9uKGNsb25lcyk7CiAgICB9Cgog\nICAgcHVibGljIFNlbGVjdEV4ZWN1dG9yIGVhZ2VyQ2xvbmUoRmllbGRNYXBw\naW5nIGtleSwgaW50IGVhZ2VyVHlwZSwKICAgICAgICBib29sZWFuIHRvTWFu\neSwgaW50IHNlbHMpIHsKICAgICAgICBpZiAoZWFnZXJUeXBlID09IEVBR0VS\nX09VVEVSCiAgICAgICAgICAgICYmIF9qb2luU3ludGF4ID09IEpvaW5TeW50\nYXhlcy5TWU5UQVhfVFJBRElUSU9OQUwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIGlmIChfZWFnZXJLZXlzICE9IG51bGwgJiYgX2VhZ2Vy\nS2V5cy5jb250YWlucyhrZXkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgLy8gZ2xvYmFsIHNldCBvZiBlYWdlciBrZXlzCiAgICAgICAg\naWYgKF9lYWdlcktleXMgPT0gbnVsbCkKICAgICAgICAgICAgX2VhZ2VyS2V5\ncyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgX2VhZ2VyS2V5cy5hZGQoa2V5\nKTsKCiAgICAgICAgU2VsZWN0RXhlY3V0b3Igc2VsOwogICAgICAgIGlmIChl\nYWdlclR5cGUgIT0gRUFHRVJfUEFSQUxMRUwpIHsKICAgICAgICAgICAgaWYg\nKHRvTWFueSkKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBFQUdFUl9UT19N\nQU5ZOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfZmxhZ3Mg\nfD0gRUFHRVJfVE9fT05FOwogICAgICAgICAgICBzZWwgPSB0aGlzOwogICAg\nICAgIH0gZWxzZSBpZiAoc2VscyA8IDIpCiAgICAgICAgICAgIHNlbCA9IHBh\ncmFsbGVsQ2xvbmUoKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgU2Vs\nZWN0W10gY2xvbmVzID0gbmV3IFNlbGVjdFtzZWxzXTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBjbG9uZXMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgICAgICBjbG9uZXNbaV0gPSBwYXJhbGxlbENsb25lKCk7CiAgICAg\nICAgICAgIHNlbCA9IF9jb25mLmdldFNRTEZhY3RvcnlJbnN0YW5jZSgpLm5l\nd1VuaW9uKGNsb25lcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoX2VhZ2Vy\nID09IG51bGwpCiAgICAgICAgICAgIF9lYWdlciA9IG5ldyBIYXNoTWFwKCk7\nCiAgICAgICAgX2VhZ2VyLnB1dCh0b0VhZ2VyS2V5KGtleSwgZ2V0Sm9pbnMo\nbnVsbCwgZmFsc2UpKSwgc2VsKTsKICAgICAgICByZXR1cm4gc2VsOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgY2xvbmUgb2YgdGhpcyBzZWxl\nY3QgZm9yIHVzZSBpbiBlYWdlciBwYXJhbGxlbCBzZWxlY3RzLgogICAgICov\nCiAgICBwcml2YXRlIFNlbGVjdEltcGwgcGFyYWxsZWxDbG9uZSgpIHsKICAg\nICAgICBTZWxlY3RJbXBsIHNlbCA9IChTZWxlY3RJbXBsKSB3aGVyZUNsb25l\nKDEpOwogICAgICAgIHNlbC5fZmxhZ3MgJj0gfk5PTkFVVE9fRElTVElOQ1Q7\nCiAgICAgICAgc2VsLl9lYWdlcktleXMgPSBfZWFnZXJLZXlzOwogICAgICAg\nIGlmIChfcHJlSm9pbnMgIT0gbnVsbCAmJiAhX3ByZUpvaW5zLmlzRW1wdHko\nKSkgewogICAgICAgICAgICBzZWwuX3ByZUpvaW5zID0gbmV3IFN0YWNrKCk7\nCiAgICAgICAgICAgIHNlbC5fcHJlSm9pbnMucHVzaCgoKFNlbGVjdEpvaW5z\nKSBfcHJlSm9pbnMucGVlaygpKS4KICAgICAgICAgICAgICAgIGNsb25lKHNl\nbCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHZpZXcgb2YgZWFnZXIgc2VsZWN0cy4gTWF5\nIGJlIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBNYXAgZ2V0RWFnZXJNYXAo\nKSB7CiAgICAgICAgcmV0dXJuIF9lYWdlcjsKICAgIH0KCiAgICBwdWJsaWMg\nU2VsZWN0RXhlY3V0b3IgZ2V0RWFnZXIoRmllbGRNYXBwaW5nIGtleSkgewog\nICAgICAgIGlmIChfZWFnZXIgPT0gbnVsbCB8fCAhX2VhZ2VyS2V5cy5jb250\nYWlucyhrZXkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBy\nZXR1cm4gKFNlbGVjdEV4ZWN1dG9yKSBfZWFnZXIuZ2V0KHRvRWFnZXJLZXko\na2V5LCBnZXRKb2lucyhudWxsLAogICAgICAgICAgICBmYWxzZSkpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZWFnZXIga2V5IHRvIHVz\nZSBmb3IgdGhlIHVzZXItZ2l2ZW4ga2V5LgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBPYmplY3QgdG9FYWdlcktleShGaWVsZE1hcHBpbmcga2V5LCBQ\nYXRoSm9pbnMgcGopIHsKICAgICAgICBpZiAocGogPT0gbnVsbCB8fCBwai5w\nYXRoKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAg\nICByZXR1cm4gbmV3IEtleShwai5wYXRoKCkudG9TdHJpbmcoKSwga2V5KTsK\nICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgbmV3Sm9pbnMoKSB7CiAgICAgICAg\naWYgKF9wcmVKb2lucyAhPSBudWxsICYmICFfcHJlSm9pbnMuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgIFNlbGVjdEpvaW5zIHNqID0gKFNlbGVjdEpvaW5z\nKSBfcHJlSm9pbnMucGVlaygpOwogICAgICAgICAgICByZXR1cm4gc2ouY2xv\nbmUodGhpcyk7CiAgICAgICAgfQogICAgICAgIC8vIHJldHVybiB0aGlzIGZv\nciBlZmZpY2llbmN5IGluIGNhc2Ugbm8gam9pbnMgZW5kIHVwIGJlaW5nIG1h\nZGUKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgSm9p\nbnMgbmV3T3V0ZXJKb2lucygpIHsKICAgICAgICByZXR1cm4gKChQYXRoSm9p\nbnMpIG5ld0pvaW5zKCkpLnNldE91dGVyKHRydWUpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGFwcGVuZChTUUxCdWZmZXIgYnVmLCBKb2lucyBqb2lucykg\newogICAgICAgIGlmIChqb2lucyA9PSBudWxsIHx8IGpvaW5zLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoIWJ1Zi5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CiAgICAg\nICAgSm9pbiBqb2luID0gbnVsbDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9ICgoUGF0aEpvaW5zKSBqb2lucykuam9pbnMoKS5qb2luSXRlcmF0b3Io\nKTsKICAgICAgICAgICAgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nam9pbiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAgICAgICBzd2l0Y2gg\nKF9qb2luU3ludGF4KSB7CiAgICAgICAgICAgICAgICBjYXNlIEpvaW5TeW50\nYXhlcy5TWU5UQVhfVFJBRElUSU9OQUw6CiAgICAgICAgICAgICAgICAgICAg\nYnVmLmFwcGVuZChfZGljdC50b1RyYWRpdGlvbmFsSm9pbihqb2luKSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEpvaW5TeW50YXhlcy5TWU5UQVhfREFUQUJBU0U6CiAgICAgICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZChfZGljdC50b05hdGl2ZUpvaW4oam9pbikpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxF\neGNlcHRpb24oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGl0\nci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5E\nICIpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgYW5kKEpv\naW5zIGpvaW5zMSwgSm9pbnMgam9pbnMyKSB7CiAgICAgICAgcmV0dXJuIGFu\nZCgoUGF0aEpvaW5zKSBqb2luczEsIChQYXRoSm9pbnMpIGpvaW5zMiwgdHJ1\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBq\nb2lucy4KICAgICAqLwogICAgcHJpdmF0ZSBTZWxlY3RKb2lucyBhbmQoUGF0\naEpvaW5zIGoxLCBQYXRoSm9pbnMgajIsIGJvb2xlYW4gbnVsbEpvaW5zKSB7\nCiAgICAgICAgaWYgKChqMSA9PSBudWxsIHx8IGoxLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgJiYgKGoyID09IG51bGwgfHwgajIuaXNFbXB0eSgpKSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFNlbGVjdEpvaW5zIHNq\nID0gbmV3IFNlbGVjdEpvaW5zKHRoaXMpOwogICAgICAgIGlmIChqMSA9PSBu\ndWxsIHx8IGoxLmlzRW1wdHkoKSkgewogICAgICAgICAgICBpZiAobnVsbEpv\naW5zKQogICAgICAgICAgICAgICAgc2ouc2V0Sm9pbnMoajIuam9pbnMoKSk7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNqLnNldEpvaW5z\nKG5ldyBKb2luU2V0KGoyLmpvaW5zKCkpKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBKb2luU2V0IHNldDsKICAgICAgICAgICAgaWYgKG51bGxK\nb2lucykKICAgICAgICAgICAgICAgIHNldCA9IGoxLmpvaW5zKCk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNldCA9IG5ldyBKb2luU2V0\nKGoxLmpvaW5zKCkpOwoKICAgICAgICAgICAgaWYgKGoyICE9IG51bGwgJiYg\nIWoyLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHNldC5hZGRBbGwoajIu\nam9pbnMoKSk7CiAgICAgICAgICAgIHNqLnNldEpvaW5zKHNldCk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBudWxsIHByZXZpb3VzIGpvaW5zOyBhbGwgYXJl\nIGNvbWJpbmVkIGludG8gdGhpcyBvbmUKICAgICAgICBpZiAobnVsbEpvaW5z\nICYmIGoxICE9IG51bGwpCiAgICAgICAgICAgIGoxLm51bGxKb2lucygpOwog\nICAgICAgIGlmIChudWxsSm9pbnMgJiYgajIgIT0gbnVsbCkKICAgICAgICAg\nICAgajIubnVsbEpvaW5zKCk7CgogICAgICAgIHJldHVybiBzajsKICAgIH0K\nCiAgICBwdWJsaWMgSm9pbnMgb3IoSm9pbnMgam9pbnMxLCBKb2lucyBqb2lu\nczIpIHsKICAgICAgICBQYXRoSm9pbnMgajEgPSAoUGF0aEpvaW5zKSBqb2lu\nczE7CiAgICAgICAgUGF0aEpvaW5zIGoyID0gKFBhdGhKb2lucykgam9pbnMy\nOwoKICAgICAgICAvLyBpZiBubyBjb21tb24gam9pbnMsIHJldHVybiBudWxs\nOyBpZiBvbmUgc2lkZSBvZiB0aGUgb3IgY2xhdXNlIGhhcwogICAgICAgIC8v\nIGRpZmZlcmVudCBqb2lucyB0aGFuIHRoZSBvdGhlciwgdGhlbiB3ZSBuZWVk\nIHRvIHVzZSBkaXN0aW5jdAogICAgICAgIGJvb2xlYW4gajFFbXB0eSA9IGox\nID09IG51bGwgfHwgajEuaXNFbXB0eSgpOwogICAgICAgIGJvb2xlYW4gajJF\nbXB0eSA9IGoyID09IG51bGwgfHwgajIuaXNFbXB0eSgpOwogICAgICAgIGlm\nIChqMUVtcHR5IHx8IGoyRW1wdHkpIHsKICAgICAgICAgICAgaWYgKGoxRW1w\ndHkgJiYgIWoyRW1wdHkpIHsKICAgICAgICAgICAgICAgIGNvbGxlY3RPdXRl\nckpvaW5zKGoyKTsKICAgICAgICAgICAgICAgIGlmICghajIuaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgICAgIF9mbGFncyB8PSBJTVBMSUNJVF9ESVNU\nSU5DVDsKICAgICAgICAgICAgfSBlbHNlIGlmIChqMkVtcHR5ICYmICFqMUVt\ncHR5KSB7CiAgICAgICAgICAgICAgICBjb2xsZWN0T3V0ZXJKb2lucyhqMSk7\nCiAgICAgICAgICAgICAgICBpZiAoIWoxLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgICAgICAgICBfZmxhZ3MgfD0gSU1QTElDSVRfRElTVElOQ1Q7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoK\nICAgICAgICAvLyBpZiBhbGwgY29tbW9uIGpvaW5zLCBtb3ZlIGFsbCBqb2lu\ncyB0byByZXR1cm5lZCBpbnN0YW5jZQogICAgICAgIFNlbGVjdEpvaW5zIHNq\nID0gbmV3IFNlbGVjdEpvaW5zKHRoaXMpOwogICAgICAgIGlmIChqMS5qb2lu\ncygpLmVxdWFscyhqMi5qb2lucygpKSkgewogICAgICAgICAgICBzai5zZXRK\nb2lucyhqMS5qb2lucygpKTsKICAgICAgICAgICAgajEubnVsbEpvaW5zKCk7\nCiAgICAgICAgICAgIGoyLm51bGxKb2lucygpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIEpvaW5TZXQgY29tbW9uSm9pbnMgPSBuZXcgSm9pblNl\ndChqMS5qb2lucygpKTsKICAgICAgICAgICAgY29tbW9uSm9pbnMucmV0YWlu\nQWxsKGoyLmpvaW5zKCkpOwogICAgICAgICAgICBpZiAoIWNvbW1vbkpvaW5z\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgLy8gcHV0IGNvbW1vbiBq\nb2lucyBpbiByZXR1cm5lZCBpbnN0YW5jZTsgcmVtb3ZlIHRoZW0gZnJvbQog\nICAgICAgICAgICAgICAgLy8gZWFjaCBnaXZlbiBpbnN0YW5jZQogICAgICAg\nICAgICAgICAgc2ouc2V0Sm9pbnMoY29tbW9uSm9pbnMpOwogICAgICAgICAg\nICAgICAgajEuam9pbnMoKS5yZW1vdmVBbGwoY29tbW9uSm9pbnMpOwogICAg\nICAgICAgICAgICAgajIuam9pbnMoKS5yZW1vdmVBbGwoY29tbW9uSm9pbnMp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbGxlY3RPdXRlckpvaW5z\nKGoxKTsKICAgICAgICAgICAgY29sbGVjdE91dGVySm9pbnMoajIpOwoKICAg\nICAgICAgICAgLy8gaWYgb25lIHNpZGUgb2YgdGhlIG9yIGNsYXVzZSBoYXMg\nZGlmZmVyZW50IGpvaW5zIHRoYW4gdGhlIG90aGVyLAogICAgICAgICAgICAv\nLyB0aGVuIHdlIG5lZWQgdG8gdXNlIGRpc3RpbmN0CiAgICAgICAgICAgIGlm\nICghajEuaXNFbXB0eSgpIHx8ICFqMi5pc0VtcHR5KCkpCiAgICAgICAgICAg\nICAgICBfZmxhZ3MgfD0gSU1QTElDSVRfRElTVElOQ1Q7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBzajsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgb3V0\nZXIoSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoX2pvaW5TeW50YXggPT0g\nSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTCB8fCBqb2lucyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gam9pbnM7CgogICAgICAgIC8vIHJl\nY29yZCB0aGF0IHRoaXMgaXMgYW4gb3V0ZXIgam9pbiBzZXQsIGV2ZW4gaWYg\naXQncyBlbXB0eQogICAgICAgIFBhdGhKb2lucyBwaiA9ICgoUGF0aEpvaW5z\nKSBqb2lucykuc2V0T3V0ZXIodHJ1ZSk7CiAgICAgICAgaWYgKHBqLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuIHBqOwoKICAgICAgICBKb2luIGpv\naW47CiAgICAgICAgSm9pbiByZWM7CiAgICAgICAgYm9vbGVhbiBoYXNKb2lu\ncyA9IF9qb2lucyAhPSBudWxsICYmIF9qb2lucy5qb2lucygpICE9IG51bGw7\nCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBwai5qb2lucygpLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGpvaW4gPSAo\nSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGpvaW4uZ2V0VHlw\nZSgpID09IEpvaW4uVFlQRV9JTk5FUikgewogICAgICAgICAgICAgICAgaWYg\nKCFoYXNKb2lucykKICAgICAgICAgICAgICAgICAgICBqb2luLnNldFR5cGUo\nSm9pbi5UWVBFX09VVEVSKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAg\nICAgICAgICAgICAgICAgIHJlYyA9IF9qb2lucy5qb2lucygpLmdldFJlY29y\nZGVkSm9pbihqb2luKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVjID09\nIG51bGwgfHwgcmVjLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfT1VURVIpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGpvaW4uc2V0VHlwZShKb2luLlRZUEVf\nT1VURVIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBqb2luczsKICAgIH0KCiAgICAvKioKICAg\nICAqIE1vdmVzIHRoZSBqb2lucyBmcm9tIHRoZSBnaXZlbiBpbnN0YW5jZSBp\nbnRvIG91ciBvdXRlciBqb2lucyBzZXQuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBjb2xsZWN0T3V0ZXJKb2lucyhQYXRoSm9pbnMgcGopIHsKICAgICAg\nICBpZiAoX2pvaW5TeW50YXggPT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFE\nSVRJT05BTCB8fCBwaiA9PSBudWxsCiAgICAgICAgICAgIHx8IHBqLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2pvaW5z\nID09IG51bGwpCiAgICAgICAgICAgIF9qb2lucyA9IG5ldyBTZWxlY3RKb2lu\ncyh0aGlzKTsKCiAgICAgICAgYm9vbGVhbiBhZGQgPSB0cnVlOwogICAgICAg\nIGlmIChfam9pbnMuam9pbnMoKSA9PSBudWxsKSB7CiAgICAgICAgICAgIF9q\nb2lucy5zZXRKb2lucyhwai5qb2lucygpKTsKICAgICAgICAgICAgYWRkID0g\nZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBKb2luIGpvaW47CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBwai5qb2lucygpLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGpvaW4gPSAoSm9pbikgaXRy\nLm5leHQoKTsKICAgICAgICAgICAgaWYgKGpvaW4uZ2V0VHlwZSgpID09IEpv\naW4uVFlQRV9JTk5FUikgewogICAgICAgICAgICAgICAgaWYgKGpvaW4uZ2V0\nRm9yZWlnbktleSgpICE9IG51bGwKICAgICAgICAgICAgICAgICAgICAmJiAh\nX2RpY3QuY2FuT3V0ZXJKb2luKF9qb2luU3ludGF4LCBqb2luLmdldEZvcmVp\nZ25LZXkoKSkpIHsKICAgICAgICAgICAgICAgICAgICBMb2cgbG9nID0gX2Nv\nbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImNhbnQtb3V0\nZXItZmsiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgam9pbi5nZXRG\nb3JlaWduS2V5KCkpKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAg\nICAgICAgICAgICAgIGpvaW4uc2V0VHlwZShKb2luLlRZUEVfT1VURVIpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhZGQpCiAgICAgICAgICAg\nICAgICBfam9pbnMuam9pbnMoKS5hZGQoam9pbik7CiAgICAgICAgfQogICAg\nICAgIHBqLm51bGxKb2lucygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBhbGlhcyBmb3IgdGhlIGdpdmVuIHRhYmxlIHVuZGVyIHRoZSBn\naXZlbiBqb2lucy4KICAgICAqIE5PVEU6IFdFIFJFTFkgT04gVEhFU0UgSU5E\nRVhFUyBCRUlORyBNT05PVE9OSUNBTExZIElOQ1JFQVNJTkcgRlJPTSAwCiAg\nICAgKi8KICAgIHByaXZhdGUgaW50IGdldFRhYmxlSW5kZXgoVGFibGUgdGFi\nbGUsIFBhdGhKb2lucyBwaiwgYm9vbGVhbiBjcmVhdGUpIHsKICAgICAgICAv\nLyBpZiB3ZSBoYXZlIGEgZnJvbSBzZWxlY3QsIHRoZW4gdGhlcmUgYXJlIG5v\nIHRhYmxlIGFsaWFzZXMKICAgICAgICBpZiAoX2Zyb20gIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAgICBPYmplY3Qga2V5ID0gdGFi\nbGUuZ2V0RnVsbE5hbWUoKTsKICAgICAgICBpZiAocGogIT0gbnVsbCAmJiBw\nai5wYXRoKCkgIT0gbnVsbCkKICAgICAgICAgICAga2V5ID0gbmV3IEtleShw\nai5wYXRoKCkudG9TdHJpbmcoKSwga2V5KTsKCiAgICAgICAgLy8gY2hlY2sg\nb3V0IGV4aXN0aW5nIGFsaWFzZXMKICAgICAgICBJbnRlZ2VyIGkgPSBmaW5k\nQWxpYXModGFibGUsIGtleSwgZmFsc2UsIG51bGwpOwogICAgICAgIGlmIChp\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBpLmludFZhbHVlKCk7CiAg\nICAgICAgaWYgKCFjcmVhdGUpCiAgICAgICAgICAgIHJldHVybiAtMTsKCiAg\nICAgICAgLy8gbm90IGZvdW5kOyBjcmVhdGUgYWxpYXMKICAgICAgICBpID0g\nTnVtYmVycy52YWx1ZU9mKGFsaWFzU2l6ZSgpKTsKICAgICAgICByZWNvcmRU\nYWJsZUFsaWFzKHRhYmxlLCBrZXksIGkpOwogICAgICAgIHJldHVybiBpLmlu\ndFZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBdHRlbXB0IHRvIGZp\nbmQgdGhlIGFsaWFzIGZvciB0aGUgZ2l2ZW4ga2V5LgogICAgICoKICAgICAq\nIEBwYXJhbSBmcm9tUGFyZW50IHdoZXRoZXIgYSBwYXJlbnQgaXMgY2hlY2tp\nbmcgaXRzIHN1YnNlbGVjdHMKICAgICAqIEBwYXJhbSBmcm9tU3ViIHRoZSBz\ndWJzZWxlY3QgY2hlY2tpbmcgaXRzIHBhcmVudAogICAgICovCiAgICBwcml2\nYXRlIEludGVnZXIgZmluZEFsaWFzKFRhYmxlIHRhYmxlLCBPYmplY3Qga2V5\nLCBib29sZWFuIGZyb21QYXJlbnQsCiAgICAgICAgU2VsZWN0SW1wbCBmcm9t\nU3ViKSB7CiAgICAgICAgSW50ZWdlciBhbGlhcyA9IG51bGw7CiAgICAgICAg\naWYgKF9hbGlhc2VzICE9IG51bGwpIHsKICAgICAgICAgICAgYWxpYXMgPSAo\nSW50ZWdlcikgKChmcm9tUGFyZW50KSA/IF9hbGlhc2VzLnJlbW92ZShrZXkp\nCiAgICAgICAgICAgICAgICA6IF9hbGlhc2VzLmdldChrZXkpKTsKICAgICAg\nICAgICAgaWYgKGFsaWFzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlm\nIChmcm9tUGFyZW50KQogICAgICAgICAgICAgICAgICAgIF90YWJsZXMucmVt\nb3ZlKGFsaWFzKTsKICAgICAgICAgICAgICAgIHJldHVybiBhbGlhczsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWZyb21QYXJlbnQg\nJiYgX3BhcmVudCAhPSBudWxsKSB7CiAgICAgICAgICAgIGJvb2xlYW4gcmVt\nb3ZlQWxpYXNGcm9tUGFyZW50ID0ga2V5LnRvU3RyaW5nKCkuaW5kZXhPZigi\nOiIpICE9IC0xOwogICAgICAgICAgICBhbGlhcyA9IF9wYXJlbnQuZmluZEFs\naWFzKHRhYmxlLCBrZXksIHJlbW92ZUFsaWFzRnJvbVBhcmVudCwgdGhpcyk7\nCiAgICAgICAgICAgIGlmIChhbGlhcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBpZiAocmVtb3ZlQWxpYXNGcm9tUGFyZW50KSB7CiAgICAgICAgICAg\nICAgICAgICAgcmVjb3JkVGFibGVBbGlhcyh0YWJsZSwga2V5LCBhbGlhcyk7\nCiAgICAgICAgICAgICAgICAgICAgX3JlbW92ZWRBbGlhc0Zyb21QYXJlbnQu\nc2V0KGFsaWFzLmludFZhbHVlKCkpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGlmIChfc3Vic2VscyAhPSBudWxsKSB7CiAgICAgICAg\nICAgIFNlbGVjdEltcGwgc3ViOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IF9zdWJzZWxzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBzdWIgPSAoU2VsZWN0SW1wbCkgX3N1YnNlbHMuZ2V0KGkpOwogICAgICAg\nICAgICAgICAgaWYgKHN1YiA9PSBmcm9tU3ViKQogICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKGFsaWFzICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3ViLl9hbGlhc2VzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHN1Yi5fYWxpYXNlcy5y\nZW1vdmUoa2V5KTsKICAgICAgICAgICAgICAgICAgICBpZiAoc3ViLl90YWJs\nZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgc3ViLl90YWJs\nZXMucmVtb3ZlKGFsaWFzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGtleSBpbnN0YW5jZW9mIFN0cmluZykg\newogICAgICAgICAgICAgICAgICAgICAgICBhbGlhcyA9IHN1Yi5maW5kQWxp\nYXModGFibGUsIGtleSwgdHJ1ZSwgbnVsbCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmICghZnJvbVBhcmVudCAmJiBhbGlhcyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkVGFibGVBbGlhcyh0YWJs\nZSwga2V5LCBhbGlhcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBhbGlhczsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY29yZCB0aGUg\nbWFwcGluZyBvZiB0aGUgZ2l2ZW4ga2V5IHRvIHRoZSBnaXZlbiBhbGlhcy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlY29yZFRhYmxlQWxpYXMoVGFi\nbGUgdGFibGUsIE9iamVjdCBrZXksIEludGVnZXIgYWxpYXMpIHsKICAgICAg\nICBpZiAoX2FsaWFzZXMgPT0gbnVsbCkKICAgICAgICAgICAgX2FsaWFzZXMg\nPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIF9hbGlhc2VzLnB1dChrZXksIGFs\naWFzKTsKCiAgICAgICAgU3RyaW5nIHRhYmxlU3RyaW5nID0gX2RpY3QuZ2V0\nRnVsbE5hbWUodGFibGUsIGZhbHNlKSArICIgIgogICAgICAgICAgICArIHRv\nQWxpYXMoYWxpYXMuaW50VmFsdWUoKSk7CiAgICAgICAgaWYgKF90YWJsZXMg\nPT0gbnVsbCkKICAgICAgICAgICAgX3RhYmxlcyA9IG5ldyBUcmVlTWFwKCk7\nCiAgICAgICAgX3RhYmxlcy5wdXQoYWxpYXMsIHRhYmxlU3RyaW5nKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0b3RhbCBudW1iZXIgb2Yg\nYWxpYXNlcy4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgYWxpYXNTaXplKCkg\newogICAgICAgIHJldHVybiBhbGlhc1NpemUoZmFsc2UsIG51bGwpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ2FsY3VsYXRlIHRvdGFsIG51bWJlciBvZiBh\nbGlhc2VzLgogICAgICoKICAgICAqIEBwYXJhbSBmcm9tUGFyZW50IHdoZXRo\nZXIgYSBwYXJlbnQgaXMgY2hlY2tpbmcgaXRzIHN1YnNlbGVjdHMKICAgICAq\nIEBwYXJhbSBmcm9tU3ViIHRoZSBzdWJzZWxlY3QgY2hlY2tpbmcgaXRzIHBh\ncmVudAogICAgICovCiAgICBwcml2YXRlIGludCBhbGlhc1NpemUoYm9vbGVh\nbiBmcm9tUGFyZW50LCBTZWxlY3RJbXBsIGZyb21TdWIpIHsKICAgICAgICBp\nbnQgYWxpYXNlcyA9IChmcm9tUGFyZW50IHx8IF9wYXJlbnQgPT0gbnVsbCkg\nPyAwCiAgICAgICAgICAgIDogX3BhcmVudC5hbGlhc1NpemUoZmFsc2UsIHRo\naXMpOwogICAgICAgIGFsaWFzZXMgKz0gKF9hbGlhc2VzID09IG51bGwpID8g\nMCA6IF9hbGlhc2VzLnNpemUoKTsKICAgICAgICBpZiAoX3N1YnNlbHMgIT0g\nbnVsbCkgewogICAgICAgICAgICBTZWxlY3RJbXBsIHN1YjsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfc3Vic2Vscy5zaXplKCk7IGkrKykg\newogICAgICAgICAgICAgICAgc3ViID0gKFNlbGVjdEltcGwpIF9zdWJzZWxz\nLmdldChpKTsKICAgICAgICAgICAgICAgIGlmIChzdWIgIT0gZnJvbVN1YikK\nICAgICAgICAgICAgICAgICAgICBhbGlhc2VzICs9IHN1Yi5hbGlhc1NpemUo\ndHJ1ZSwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGFsaWFzZXM7CiAgICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0\ncmluZygpIHsKICAgICAgICByZXR1cm4gdG9TZWxlY3QoZmFsc2UsIG51bGwp\nLmdldFNRTCgpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KICAgIC8vIFBhdGhKb2lucyBpbXBsZW1lbnRhdGlvbgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBib29sZWFu\nIGlzT3V0ZXIoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9vbGVhbiBvdXRlcikgewog\nICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcykuc2V0T3V0ZXIo\ndHJ1ZSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0eSgpIHsK\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZ0J1ZmZlciBwYXRoKCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoK\nICAgIHB1YmxpYyBKb2luU2V0IGpvaW5zKCkgewogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgam9pbkNvdW50KCkgewogICAg\nICAgIHJldHVybiAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIG51bGxKb2lu\ncygpIHsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5KCkgewog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBj\ncm9zc0pvaW4oVGFibGUgbG9jYWxUYWJsZSwgVGFibGUgZm9yZWlnblRhYmxl\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5jcm9z\nc0pvaW4obG9jYWxUYWJsZSwgZm9yZWlnblRhYmxlKTsKICAgIH0KCiAgICBw\ndWJsaWMgSm9pbnMgam9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVy\nc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxl\nY3RKb2lucyh0aGlzKS5qb2luKGZrLCBpbnZlcnNlLCB0b01hbnkpOwogICAg\nfQoKICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW4oRm9yZWlnbktleSBmaywg\nYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgIHJl\ndHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcykub3V0ZXJKb2luKGZrLCBpbnZl\ncnNlLCB0b01hbnkpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2luUmVs\nYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssIENsYXNzTWFwcGlu\nZyB0YXJnZXQsCiAgICAgICAgaW50IHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwg\nYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpv\naW5zKHRoaXMpLmpvaW5SZWxhdGlvbihuYW1lLCBmaywgdGFyZ2V0LCBzdWJz\nLCAKICAgICAgICAgICAgaW52ZXJzZSwgdG9NYW55KTsKICAgIH0KCiAgICBw\ndWJsaWMgSm9pbnMgb3V0ZXJKb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZv\ncmVpZ25LZXkgZmssIAogICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGlu\ndCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAg\nICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5vdXRlckpvaW5S\nZWxhdGlvbihuYW1lLCBmaywgdGFyZ2V0LCBzdWJzLCAKICAgICAgICAgICAg\naW52ZXJzZSwgdG9NYW55KTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgc2V0\nVmFyaWFibGUoU3RyaW5nIHZhcikgewogICAgICAgIGlmICh2YXIgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgcmV0dXJuIG5l\ndyBTZWxlY3RKb2lucyh0aGlzKS5zZXRWYXJpYWJsZSh2YXIpOwogICAgfQoK\nICAgIHB1YmxpYyBKb2lucyBzZXRTdWJzZWxlY3QoU3RyaW5nIGFsaWFzKSB7\nCiAgICAgICAgaWYgKGFsaWFzID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcyku\nc2V0U3Vic2VsZWN0KGFsaWFzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ncHJlc2VudHMgYSBTUUwgc3RyaW5nIHNlbGVjdGVkIHdpdGggbnVsbCBpZC4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgTnVsbElkIHsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgYSBwbGFjZWhvbGRlciBT\nUUwgc3RyaW5nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBQ\nbGFjZWhvbGRlciB7CiAgICB9CgogICAgLyoqCiAgICAgKiBLZXkgdHlwZSB1\nc2VkIGZvciBhbGlhc2VzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBj\nbGFzcyBLZXkgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBfcGF0\naDsKICAgICAgICBwcml2YXRlIGZpbmFsIE9iamVjdCBfa2V5OwoKICAgICAg\nICBwdWJsaWMgS2V5KFN0cmluZyBwYXRoLCBPYmplY3Qga2V5KSB7CiAgICAg\nICAgICAgIF9wYXRoID0gcGF0aDsKICAgICAgICAgICAgX2tleSA9IGtleTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAg\nICAgICAgICAgIHJldHVybiBfcGF0aC5oYXNoQ29kZSgpIF4gX2tleS5oYXNo\nQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1\nYWxzKE9iamVjdCBvdGhlcikgewogICAgICAgICAgICBpZiAob3RoZXIgPT0g\ndGhpcykKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAg\nICBpZiAob3RoZXIuZ2V0Q2xhc3MoKSAhPSBnZXRDbGFzcygpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBLZXkgayA9IChL\nZXkpIG90aGVyOwogICAgICAgICAgICByZXR1cm4gay5fcGF0aC5lcXVhbHMo\nX3BhdGgpICYmIGsuX2tleS5lcXVhbHMoX2tleSk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICBy\nZXR1cm4gX3BhdGggKyAifCIgKyBfa2V5OwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEEge0BsaW5rIFJlc3VsdH0gaW1wbGVtZW50YXRpb24g\nd3JhcHBlZCBhcm91bmQgdGhpcyBzZWxlY3QuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgY2xhc3MgU2VsZWN0UmVzdWx0CiAgICAgICAgZXh0ZW5kcyBS\nZXN1bHRTZXRSZXN1bHQKICAgICAgICBpbXBsZW1lbnRzIFBhdGhKb2lucyB7\nCgogICAgICAgIHByaXZhdGUgU2VsZWN0SW1wbCBfc2VsID0gbnVsbDsKCiAg\nICAgICAgLy8gcG9zaXRpb24gaW4gc2VsZWN0ZWQgY29sdW1ucyBsaXN0IHdo\nZXJlIHdlIGV4cGVjdCB0aGUgbmV4dCBsb2FkCiAgICAgICAgcHJpdmF0ZSBp\nbnQgX3BvcyA9IDA7CiAgICAgICAgcHJpdmF0ZSBTdGFjayBfcHJlSm9pbnMg\nPSBudWxsOwoKICAgICAgICAvKioKICAgICAgICAgKiBDb25zdHJ1Y3Rvci4K\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgU2VsZWN0UmVzdWx0KENvbm5l\nY3Rpb24gY29ubiwgU3RhdGVtZW50IHN0bW50LCBSZXN1bHRTZXQgcnMsCiAg\nICAgICAgICAgIERCRGljdGlvbmFyeSBkaWN0KSB7CiAgICAgICAgICAgIHN1\ncGVyKGNvbm4sIHN0bW50LCBycywgZGljdCk7CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBTZWxlY3QgZm9yIHRoaXMgcmVzdWx0LgogICAg\nICAgICAqLwogICAgICAgIHB1YmxpYyBTZWxlY3RJbXBsIGdldFNlbGVjdCgp\nIHsKICAgICAgICAgICAgcmV0dXJuIF9zZWw7CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBTZWxlY3QgZm9yIHRoaXMgcmVzdWx0LgogICAg\nICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHNldFNlbGVjdChTZWxlY3RJ\nbXBsIHNlbCkgewogICAgICAgICAgICBfc2VsID0gc2VsOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRFYWdlcihGaWVsZE1hcHBpbmcg\na2V5KSB7CiAgICAgICAgICAgIC8vIGRvbid0IGJvdGhlciBjcmVhdGluZyBr\nZXkgaWYgd2Uga25vdyB3ZSBkb24ndCBoYXZlIGFueQogICAgICAgICAgICAv\nLyBlYWdlciByZXN1bHRzCiAgICAgICAgICAgIGlmIChfc2VsLl9lYWdlciA9\nPSBudWxsIHx8ICFfc2VsLl9lYWdlcktleXMuY29udGFpbnMoa2V5KSkKICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBNYXAgbWFw\nID0gU2VsZWN0UmVzdWx0LnRoaXMuZ2V0RWFnZXJNYXAodHJ1ZSk7CiAgICAg\nICAgICAgIGlmIChtYXAgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgICAgICByZXR1cm4gbWFwLmdldChfc2VsLnRvRWFn\nZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsKSkpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgcHV0RWFnZXIoRmllbGRNYXBwaW5nIGtleSwgT2Jq\nZWN0IHJlcykgewogICAgICAgICAgICBNYXAgbWFwID0gU2VsZWN0UmVzdWx0\nLnRoaXMuZ2V0RWFnZXJNYXAodHJ1ZSk7CiAgICAgICAgICAgIGlmIChtYXAg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgbWFwID0gbmV3IEhhc2hNYXAo\nKTsKICAgICAgICAgICAgICAgIHNldEVhZ2VyTWFwKG1hcCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgbWFwLnB1dChfc2VsLnRvRWFnZXJLZXkoa2V5\nLCBnZXRKb2lucyhudWxsKSksIHJlcyk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgT2JqZWN0IGxvYWQoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpEQkNT\ndG9yZSBzdG9yZSwKICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgSm9pbnMgam9pbnMpCiAgICAgICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICBib29sZWFuIGhhc0pvaW5zID0gam9p\nbnMgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgKChQYXRoSm9pbnMpIGpv\naW5zKS5wYXRoKCkgIT0gbnVsbDsKICAgICAgICAgICAgaWYgKGhhc0pvaW5z\nKSB7CiAgICAgICAgICAgICAgICBpZiAoX3ByZUpvaW5zID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgX3ByZUpvaW5zID0gbmV3IFN0YWNrKCk7CiAg\nICAgICAgICAgICAgICBfcHJlSm9pbnMucHVzaChqb2lucyk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIE9iamVjdCBvYmogPSBzdXBlci5sb2FkKG1h\ncHBpbmcsIHN0b3JlLCBmZXRjaCwgam9pbnMpOwoKICAgICAgICAgICAgLy8g\ncmVzZXQKICAgICAgICAgICAgaWYgKGhhc0pvaW5zKQogICAgICAgICAgICAg\nICAgX3ByZUpvaW5zLnBvcCgpOwogICAgICAgICAgICByZXR1cm4gb2JqOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG5ld0pvaW5zKCkgewog\nICAgICAgICAgICBQYXRoSm9pbnMgcHJlID0gZ2V0UHJlSm9pbnMoKTsKICAg\nICAgICAgICAgaWYgKHByZSA9PSBudWxsIHx8IHByZS5wYXRoKCkgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwoKICAgICAgICAgICAg\nUGF0aEpvaW5zSW1wbCBwaiA9IG5ldyBQYXRoSm9pbnNJbXBsKCk7CiAgICAg\nICAgICAgIHBqLnBhdGggPSBuZXcgU3RyaW5nQnVmZmVyKHByZS5wYXRoKCku\ndG9TdHJpbmcoKSk7CiAgICAgICAgICAgIHJldHVybiBwajsKICAgICAgICB9\nCgogICAgICAgIHByb3RlY3RlZCBib29sZWFuIGNvbnRhaW5zSW50ZXJuYWwo\nT2JqZWN0IG9iaiwgSm9pbnMgam9pbnMpIHsKICAgICAgICAgICAgLy8gd2Ug\na2V5IGRpcmVjdGx5IG9uIG9ianMgYW5kIGpvaW4tbGVzcyBjb2xzLCBvciBv\nbiB0aGUgYWxpYXMKICAgICAgICAgICAgLy8gZm9yIGNvbHMgd2l0aCBqb2lu\ncwogICAgICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucyk7\nCiAgICAgICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBqLnBhdGgoKSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgb2JqID0gZ2V0Q29sdW1uQWxpYXMoKENv\nbHVtbikgb2JqLCBwaik7CiAgICAgICAgICAgIHJldHVybiBvYmogIT0gbnVs\nbCAmJiBfc2VsLl9zZWxlY3RzLmNvbnRhaW5zKG9iaik7CiAgICAgICAgfQoK\nICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjb250YWluc0FsbEludGVybmFs\nKE9iamVjdFtdIG9ianMsIEpvaW5zIGpvaW5zKQogICAgICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgUGF0aEpvaW5zIHBqID0g\nZ2V0Sm9pbnMoam9pbnMpOwogICAgICAgICAgICBPYmplY3Qgb2JqOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG9ianMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBqLnBhdGgo\nKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIG9iaiA9IGdldENvbHVt\nbkFsaWFzKChDb2x1bW4pIG9ianNbaV0sIHBqKTsKICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBvYmogPSBvYmpzW2ldOwogICAg\nICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsIHx8ICFfc2VsLl9zZWxlY3Rz\nLmNvbnRhaW5zKG9iaikpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcHVzaEJhY2soKQogICAg\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3Bv\ncyA9IDA7CiAgICAgICAgICAgIHN1cGVyLnB1c2hCYWNrKCk7CiAgICAgICAg\nfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBhYnNvbHV0ZUludGVybmFs\nKGludCByb3cpCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICBfcG9zID0gMDsKICAgICAgICAgICAgcmV0dXJuIHN1cGVy\nLmFic29sdXRlSW50ZXJuYWwocm93KTsKICAgICAgICB9CgogICAgICAgIHBy\nb3RlY3RlZCBib29sZWFuIG5leHRJbnRlcm5hbCgpCiAgICAgICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBfcG9zID0gMDsKICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLm5leHRJbnRlcm5hbCgpOwogICAgICAg\nIH0KCiAgICAgICAgcHJvdGVjdGVkIGludCBmaW5kT2JqZWN0KE9iamVjdCBv\nYmosIEpvaW5zIGpvaW5zKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgaWYgKF9wb3MgPT0gX3NlbC5fc2VsZWN0cy5z\naXplKCkpCiAgICAgICAgICAgICAgICBfcG9zID0gMDsKCiAgICAgICAgICAg\nIC8vIHdlIGtleSBkaXJlY3RseSBvbiBvYmpzIGFuZCBqb2luLWxlc3MgY29s\ncywgb3Igb24gdGhlIGFsaWFzCiAgICAgICAgICAgIC8vIGZvciBjb2xzIHdp\ndGggam9pbnMKICAgICAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMo\nam9pbnMpOwogICAgICAgICAgICBCb29sZWFuIHBrID0gbnVsbDsKICAgICAg\nICAgICAgaWYgKHBqICE9IG51bGwgJiYgcGoucGF0aCgpICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIENvbHVtbiBjb2wgPSAoQ29sdW1uKSBvYmo7CiAg\nICAgICAgICAgICAgICBwayA9IChjb2wuaXNQcmltYXJ5S2V5KCkpID8gQm9v\nbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgICAgIG9i\naiA9IGdldENvbHVtbkFsaWFzKGNvbCwgcGopOwogICAgICAgICAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBTUUxFeGNlcHRpb24oY29sLmdldFRhYmxlKCkgKyAiOiAiCiAgICAgICAg\nICAgICAgICAgICAgICAgICsgcGoucGF0aCgpICsgIiAoIiArIF9zZWwuX2Fs\naWFzZXMgKyAiKSIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB3\nZSBsb2FkIGluIHRoZSBzYW1lIG9yZGVyIHdlIHNlbGVjdCwgbW9yZSBvciBs\nZXNzLi4uCiAgICAgICAgICAgIGlmIChfc2VsLl9zZWxlY3RzLmdldChfcG9z\nKS5lcXVhbHMob2JqKSkKICAgICAgICAgICAgICAgIHJldHVybiArK19wb3M7\nCgogICAgICAgICAgICAvLyBpZiB3ZSdyZSBsb29raW5nIGZvciBhIHByaW1h\ncnkga2V5LCB0cnkgYmFjayBhIGNvdXBsZSBwbGFjZXMsCiAgICAgICAgICAg\nIC8vIHNpbmNlIHBrcyBtaWdodCBiZSBzZWxlY3RlZCBpbiBhIHNsaWdodGx5\nIGRpZmZlcmVudCBvcmRlciB0aGFuCiAgICAgICAgICAgIC8vIHRoZXkgYXJl\nIGxvYWRlZCBiYWNrOyBkb24ndCBjaGFuZ2UgdGhlIG1hcmtlciBwb3NpdGlv\nbgogICAgICAgICAgICBpZiAocGsgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHBrID0gKG9iaiBpbnN0YW5jZW9mIENvbHVtbiAmJiAoKENvbHVtbikgb2Jq\nKS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAgICAgICA/IEJvb2xl\nYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIGlmIChway5i\nb29sZWFuVmFsdWUoKSkgewogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIF9wb3MgLSAxOyBpID49IDAgJiYgaSA+PSBfcG9zIC0gMzsgaS0tKQogICAg\nICAgICAgICAgICAgICAgIGlmIChfc2VsLl9zZWxlY3RzLmdldChpKS5lcXVh\nbHMob2JqKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkgKyAx\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBzZWFyY2ggZm9yd2Fy\nZCBvbiB0aGUgYXNzdW1wdGlvbiB0aGF0IHdlIG1pZ2h0IGJlIHNraXBwaW5n\nCiAgICAgICAgICAgIC8vIHNlbGVjdHMgZm9yIHNpYmxpbmcgY2xhc3Nlczsg\nYWR2YW5jZSB0aGUgcG9zaXRpb24gaWYgd2UgZmluZAogICAgICAgICAgICAv\nLyBzb21ldGhpbmcgZm9yd2FyZAogICAgICAgICAgICBmb3IgKGludCBpID0g\nX3BvcyArIDE7IGkgPCBfc2VsLl9zZWxlY3RzLnNpemUoKTsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBpZiAoX3NlbC5fc2VsZWN0cy5nZXQoaSkuZXF1YWxz\nKG9iaikpIHsKICAgICAgICAgICAgICAgICAgICBfcG9zID0gaTsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gKytfcG9zOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBtYXliZSB0aGUgY29s\ndW1uIHdhcyBzZWxlY3RlZCBieSAyIGRpZmZlcmVudCBtYXBwaW5ncywgc28g\naXQncwogICAgICAgICAgICAvLyBzb21ld2hlcmUgcHJpb3IgdG8gdGhlIGN1\ncnJlbnQgcG9zaXRpb247IGluIHRoaXMgY2FzZSBsZWF2ZSB0aGUKICAgICAg\nICAgICAgLy8gcG9zaXRpb24gbWFya2VyIGF0IGl0cyBjdXJyZW50IHBsYWNl\nIGNhdXNlIHN1YnNlcXVlbnQgbG9hZHMgd2lsbAogICAgICAgICAgICAvLyBz\ndGlsbCBwcm9iYWJseSBzdGFydCBmcm9tIHRoZXJlCiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgX3BvczsgaSsrKQogICAgICAgICAgICAgICAg\naWYgKF9zZWwuX3NlbGVjdHMuZ2V0KGkpLmVxdWFscyhvYmopKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBpICsgMTsKCiAgICAgICAgICAgIC8vIHNv\nbWV0aGluZ3MncyB3cm9uZy4uLgogICAgICAgICAgICB0aHJvdyBuZXcgU1FM\nRXhjZXB0aW9uKG9iai50b1N0cmluZygpKTsKICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgam9pbnMgdG8gdXNlIHRvIGZp\nbmQgY29sdW1uIGRhdGEuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBQ\nYXRoSm9pbnMgZ2V0Sm9pbnMoSm9pbnMgam9pbnMpIHsKICAgICAgICAgICAg\nUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lucykgam9pbnM7CiAgICAgICAgICAg\nIGlmIChwaiAhPSBudWxsICYmIHBqLnBhdGgoKSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHBqOwogICAgICAgICAgICByZXR1cm4gZ2V0UHJl\nSm9pbnMoKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJl\ndHVybiB0aGUgcHJlIGpvaW5zIGZvciB0aGUgcmVzdWx0LCBvciBudWxsIGlm\nIG5vbmUuIE5vdGUgdGhhdAogICAgICAgICAqIHdlIGhhdmUgdG8gdGFrZSB0\naGUgU2VsZWN0J3MgcHJlIGpvaW5zIGludG8gYWNjb3VudCB0b28sIHNpbmNl\nCiAgICAgICAgICogYmF0Y2hlZCBzZWxlY3RzIGNhbiBoYXZlIGFkZGl0aW9u\nYWwgcHJlIGpvaW5zIG9uIHRoZSBzdGFjayBldmVuCiAgICAgICAgICogb24g\nZXhlY3V0aW9uLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgUGF0aEpv\naW5zIGdldFByZUpvaW5zKCkgewogICAgICAgICAgICBpZiAoX3ByZUpvaW5z\nICE9IG51bGwgJiYgIV9wcmVKb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gKFBhdGhKb2lucykgX3ByZUpvaW5zLnBlZWsoKTsKICAg\nICAgICAgICAgaWYgKF9zZWwuX3ByZUpvaW5zICE9IG51bGwgJiYgIV9zZWwu\nX3ByZUpvaW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiAo\nUGF0aEpvaW5zKSBfc2VsLl9wcmVKb2lucy5wZWVrKCk7CiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogUmV0dXJuIHRoZSBhbGlhcyB1c2VkIHRvIGtleSBvbiB0aGUgY29sdW1u\nIGRhdGEsIGNvbnNpZGVyaW5nIHRoZQogICAgICAgICAqIGdpdmVuIGpvaW5z\nLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgU3RyaW5nIGdldENvbHVt\nbkFsaWFzKENvbHVtbiBjb2wsIFBhdGhKb2lucyBwaikgewogICAgICAgICAg\nICBTdHJpbmcgYWxpYXM7CiAgICAgICAgICAgIGlmIChfc2VsLl9mcm9tICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGFsaWFzID0gX3NlbC50b0FsaWFz\nKF9zZWwuX2Zyb20uZ2V0VGFibGVJbmRleAogICAgICAgICAgICAgICAgICAg\nIChjb2wuZ2V0VGFibGUoKSwgcGosIGZhbHNlKSk7CiAgICAgICAgICAgICAg\nICBpZiAoYWxpYXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChfc2VsLl9kaWN0LnJlcXVp\ncmVzQWxpYXNGb3JTdWJzZWxlY3QpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIEZST01fU0VMRUNUX0FMSUFTICsgIi4iICsgYWxpYXMgKyAiXyIgKyBj\nb2w7CiAgICAgICAgICAgICAgICByZXR1cm4gYWxpYXMgKyAiXyIgKyBjb2w7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWxpYXMgPSBfc2VsLnRvQWxp\nYXMoX3NlbC5nZXRUYWJsZUluZGV4KGNvbC5nZXRUYWJsZSgpLCBwaiwgZmFs\nc2UpKTsKICAgICAgICAgICAgcmV0dXJuIChhbGlhcyA9PSBudWxsKSA/IG51\nbGwgOiBhbGlhcyArICIuIiArIGNvbDsKICAgICAgICB9CgogICAgICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBQYXRoSm9p\nbnMgaW1wbGVtZW50YXRpb24KICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzT3V0ZXIoKSB7\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9vbGVhbiBvdXRlcikgewog\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmdCdWZmZXIg\ncGF0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgSm9pblNldCBqb2lucygpIHsKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGpv\naW5Db3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCBudWxsSm9pbnMoKSB7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lu\ncyBjcm9zc0pvaW4oVGFibGUgbG9jYWxUYWJsZSwgVGFibGUgZm9yZWlnblRh\nYmxlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIEpvaW5zIGpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVh\nbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBvdXRl\nckpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFu\nIHRvTWFueSkgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oU3RyaW5nIG5h\nbWUsIEZvcmVpZ25LZXkgZmssIAogICAgICAgICAgICBDbGFzc01hcHBpbmcg\ndGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRv\nTWFueSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFBhdGhKb2luc0ltcGwo\nKS5qb2luUmVsYXRpb24obmFtZSwgZmssIHRhcmdldCwgc3VicywgCiAgICAg\nICAgICAgICAgICBpbnZlcnNlLCB0b01hbnkpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIEpvaW5zIG91dGVySm9pblJlbGF0aW9uKFN0cmluZyBuYW1l\nLCBGb3JlaWduS2V5IGZrLAogICAgICAgICAgICBDbGFzc01hcHBpbmcgdGFy\nZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFu\neSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFBhdGhKb2luc0ltcGwoKS5v\ndXRlckpvaW5SZWxhdGlvbihuYW1lLCBmaywgdGFyZ2V0LCBzdWJzLAogICAg\nICAgICAgICAgICAgaW52ZXJzZSwgdG9NYW55KTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBKb2lucyBzZXRWYXJpYWJsZShTdHJpbmcgdmFyKSB7CiAg\nICAgICAgICAgIGlmICh2YXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgICAgICByZXR1cm4gbmV3IFBhdGhKb2luc0lt\ncGwoKS5zZXRWYXJpYWJsZSh2YXIpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIEpvaW5zIHNldFN1YnNlbGVjdChTdHJpbmcgYWxpYXMpIHsKICAgICAg\nICAgICAgaWYgKGFsaWFzID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQYXRoSm9pbnNJbXBs\nKCkuc2V0U3Vic2VsZWN0KGFsaWFzKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBCYXNlIGpvaW5zIGltcGxlbWVudGF0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBQYXRoSm9pbnNJbXBsCiAgICAg\nICAgaW1wbGVtZW50cyBQYXRoSm9pbnMgewoKICAgICAgICBwcm90ZWN0ZWQg\nU3RyaW5nQnVmZmVyIHBhdGggPSBudWxsOwogICAgICAgIHByb3RlY3RlZCBT\ndHJpbmcgdmFyID0gbnVsbDsKCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNP\ndXRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIFBhdGhKb2lucyBzZXRPdXRlcihib29sZWFuIG91\ndGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0eSgpIHsKICAgICAgICAgICAg\ncmV0dXJuIHZhciAhPSBudWxsIHx8IHBhdGggIT0gbnVsbDsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBTdHJpbmdCdWZmZXIgcGF0aCgpIHsKICAgICAg\nICAgICAgcmV0dXJuIHBhdGg7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nSm9pblNldCBqb2lucygpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGpvaW5Db3VudCgpIHsKICAg\nICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\ndm9pZCBudWxsSm9pbnMoKSB7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nSm9pbnMgc2V0VmFyaWFibGUoU3RyaW5nIHZhcikgewogICAgICAgICAgICB0\naGlzLnZhciA9IHZhcjsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0U3Vic2VsZWN0KFN0cmlu\nZyBhbGlhcykgewogICAgICAgICAgICBpZiAoIWFsaWFzLmVuZHNXaXRoKCI6\nIikpCiAgICAgICAgICAgICAgICBhbGlhcyArPSAnOic7CiAgICAgICAgICAg\nIGFwcGVuZChhbGlhcyk7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgSm9pbnMgY3Jvc3NKb2luKFRhYmxlIGxvY2FsVGFibGUsIFRhYmxlIGZv\ncmVpZ25UYWJsZSkgewogICAgICAgICAgICBhcHBlbmQodmFyKTsKICAgICAg\nICAgICAgdmFyID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgam9pbihGb3JlaWduS2V5\nIGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAg\nICAgICAgIGFwcGVuZCh2YXIpOwogICAgICAgICAgICB2YXIgPSBudWxsOwog\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBKb2lucyBvdXRlckpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBp\nbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICBhcHBlbmQo\ndmFyKTsKICAgICAgICAgICAgdmFyID0gbnVsbDsKICAgICAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgam9p\nblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLCAKICAgICAg\nICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xlYW4g\naW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgYXBwZW5k\nKG5hbWUpOwogICAgICAgICAgICBhcHBlbmQodmFyKTsKICAgICAgICAgICAg\ndmFyID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luUmVsYXRpb24oU3Ry\naW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssCiAgICAgICAgICAgIENsYXNzTWFw\ncGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xl\nYW4gdG9NYW55KSB7CiAgICAgICAgICAgIGFwcGVuZChuYW1lKTsKICAgICAg\nICAgICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51bGw7CiAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHJv\ndGVjdGVkIHZvaWQgYXBwZW5kKFN0cmluZyBzdHIpIHsKICAgICAgICAgICAg\naWYgKHN0ciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAocGF0aCA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHBhdGggPSBuZXcgU3RyaW5n\nQnVmZmVyKHN0cik7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgcGF0aC5hcHBlbmQoJy4nKS5hcHBlbmQoc3RyKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0\ncmluZygpIHsKICAgICAgICAgICAgcmV0dXJuICJQYXRoSm9pbnNJbXBsPCIg\nKyBoYXNoQ29kZSgpICsgIj46ICIKICAgICAgICAgICAgICAgICsgU3RyaW5n\nLnZhbHVlT2YocGF0aCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogSm9pbnMgaW1wbGVtZW50YXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIFNlbGVjdEpvaW5zCiAgICAgICAgZXh0ZW5kcyBQYXRo\nSm9pbnNJbXBsIAogICAgICAgIGltcGxlbWVudHMgQ2xvbmVhYmxlIHsKCiAg\nICAgICAgcHJpdmF0ZSBmaW5hbCBTZWxlY3RJbXBsIF9zZWw7CiAgICAgICAg\ncHJpdmF0ZSBKb2luU2V0IF9qb2lucyA9IG51bGw7CiAgICAgICAgcHJpdmF0\nZSBib29sZWFuIF9vdXRlciA9IGZhbHNlOwogICAgICAgIHByaXZhdGUgaW50\nIF9jb3VudCA9IDA7CgogICAgICAgIHB1YmxpYyBTZWxlY3RKb2lucyhTZWxl\nY3RJbXBsIHNlbCkgewogICAgICAgICAgICBfc2VsID0gc2VsOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNPdXRlcigpIHsKICAgICAg\nICAgICAgcmV0dXJuIF9vdXRlcjsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9vbGVhbiBvdXRlcikgewogICAgICAg\nICAgICBfb3V0ZXIgPSBvdXRlcjsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkg\newogICAgICAgICAgICByZXR1cm4gc3VwZXIuaXNEaXJ0eSgpIHx8ICFpc0Vt\ncHR5KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pblNldCBqb2lu\ncygpIHsKICAgICAgICAgICAgcmV0dXJuIF9qb2luczsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHNldEpvaW5zKEpvaW5TZXQgam9pbnMpIHsK\nICAgICAgICAgICAgX2pvaW5zID0gam9pbnM7CiAgICAgICAgICAgIF9vdXRl\nciA9IGpvaW5zICE9IG51bGwgJiYgam9pbnMubGFzdCgpICE9IG51bGwKICAg\nICAgICAgICAgICAgICYmIGpvaW5zLmxhc3QoKS5nZXRUeXBlKCkgPT0gSm9p\nbi5UWVBFX09VVEVSOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBq\nb2luQ291bnQoKSB7CiAgICAgICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBfY291bnQ7CiAgICAgICAgICAgIHJl\ndHVybiBNYXRoLm1heChfY291bnQsIF9qb2lucy5zaXplKCkpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgbnVsbEpvaW5zKCkgewogICAgICAg\nICAgICBpZiAoX2pvaW5zICE9IG51bGwpCiAgICAgICAgICAgICAgICBfY291\nbnQgPSBNYXRoLm1heChfY291bnQsIF9qb2lucy5zaXplKCkpOwogICAgICAg\nICAgICBfam9pbnMgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9qb2lu\ncyA9PSBudWxsIHx8IF9qb2lucy5pc0VtcHR5KCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgSm9pbnMgY3Jvc3NKb2luKFRhYmxlIGxvY2FsVGFibGUs\nIFRhYmxlIGZvcmVpZ25UYWJsZSkgewogICAgICAgICAgICAvLyBjcm9zcyBq\nb2lucyBhcmUgZm9yIHVuYm91bmQgdmFyaWFibGVzOyB1bmZvcnR1bmF0ZWx5\nIHdlIGhhdmUKICAgICAgICAgICAgLy8gdG8gYWx3YXlzIGdvIERJU1RJTkNU\nIGZvciB1bmJvdW5kIHZhcnMgYmVjYXVzZSB0aGVyZSBhcmUgY2VydGFpbgog\nICAgICAgICAgICAvLyBjYXNlcyB0aGF0IHJlcXVpcmUgaXQsIGFuZCB3ZSBj\nYW4ndCBkaWZmZXJlbnRpYXRlIHRoZW0gZnJvbSB0aGUKICAgICAgICAgICAg\nLy8gY2FzZXMgdGhhdCBkb24ndAogICAgICAgICAgICBfc2VsLl9mbGFncyB8\nPSBJTVBMSUNJVF9ESVNUSU5DVDsKCiAgICAgICAgICAgIGlmIChfc2VsLmdl\ndEpvaW5TeW50YXgoKSAhPSBKb2luU3ludGF4ZXMuU1lOVEFYX1NRTDkyCiAg\nICAgICAgICAgICAgICB8fCBfc2VsLl9mcm9tICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIC8vIGRvbid0IG1ha2UgYW55IGpvaW5zLCBidXQgdXBkYXRl\nIHRoZSBwYXRoIGlmIGEgdmFyaWFibGUKICAgICAgICAgICAgICAgIC8vIGhh\ncyBiZWVuIHNldAogICAgICAgICAgICAgICAgdGhpcy5hcHBlbmQodGhpcy52\nYXIpOwogICAgICAgICAgICAgICAgdGhpcy52YXIgPSBudWxsOwogICAgICAg\nICAgICAgICAgX291dGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZG9uJ3Qg\nbGV0IHRoZSBnZXQgYWxpYXMgbWV0aG9kcyBzZWUgdGhhdCBhIHZhciBoYXMg\nYmVlbiBzZXQKICAgICAgICAgICAgLy8gdW50aWwgd2UgZ2V0IHBhc3QgdGhl\nIGxvY2FsIHRhYmxlCiAgICAgICAgICAgIFN0cmluZyB2YXIgPSB0aGlzLnZh\ncjsKICAgICAgICAgICAgdGhpcy52YXIgPSBudWxsOwoKICAgICAgICAgICAg\naW50IGFsaWFzMSA9IF9zZWwuZ2V0VGFibGVJbmRleChsb2NhbFRhYmxlLCB0\naGlzLCB0cnVlKTsKICAgICAgICAgICAgdGhpcy5hcHBlbmQodmFyKTsKICAg\nICAgICAgICAgaW50IGFsaWFzMiA9IF9zZWwuZ2V0VGFibGVJbmRleChmb3Jl\naWduVGFibGUsIHRoaXMsIHRydWUpOwogICAgICAgICAgICBKb2luIGogPSBu\nZXcgSm9pbihsb2NhbFRhYmxlLCBhbGlhczEsIGZvcmVpZ25UYWJsZSwgYWxp\nYXMyLAogICAgICAgICAgICAgICAgbnVsbCwgZmFsc2UpOwogICAgICAgICAg\nICBqLnNldFR5cGUoSm9pbi5UWVBFX0NST1NTKTsKCiAgICAgICAgICAgIGlm\nIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9qb2lucyA9IG5l\ndyBKb2luU2V0KCk7CiAgICAgICAgICAgIF9qb2lucy5hZGQoaik7CiAgICAg\nICAgICAgIF9vdXRlciA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBqb2luKEZvcmVp\nZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsK\nICAgICAgICAgICAgcmV0dXJuIGpvaW4obnVsbCwgZmssIG51bGwsIC0xLCBp\nbnZlcnNlLCB0b01hbnksIGZhbHNlKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBKb2lucyBvdXRlckpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBp\nbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICByZXR1cm4g\nam9pbihudWxsLCBmaywgbnVsbCwgLTEsIGludmVyc2UsIHRvTWFueSwgdHJ1\nZSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgam9pblJlbGF0\naW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLCAKICAgICAgICAgICAg\nQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xlYW4gaW52ZXJz\nZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIGpvaW4o\nbmFtZSwgZmssIHRhcmdldCwgc3VicywgaW52ZXJzZSwgdG9NYW55LCBmYWxz\nZSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2lu\nUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssCiAgICAgICAg\nICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGlu\ndmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiBq\nb2luKG5hbWUsIGZrLCB0YXJnZXQsIHN1YnMsIGludmVyc2UsIHRvTWFueSwg\ndHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIEpvaW5zIGpvaW4o\nU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssIENsYXNzTWFwcGluZyB0YXJn\nZXQsCiAgICAgICAgICAgIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJv\nb2xlYW4gdG9NYW55LCBib29sZWFuIG91dGVyKSB7CiAgICAgICAgICAgIC8v\nIGRvbid0IGxldCB0aGUgZ2V0IGFsaWFzIG1ldGhvZHMgc2VlIHRoYXQgYSB2\nYXIgaGFzIGJlZW4gc2V0CiAgICAgICAgICAgIC8vIHVudGlsIHdlIGdldCBw\nYXN0IHRoZSBsb2NhbCB0YWJsZQogICAgICAgICAgICBTdHJpbmcgdmFyID0g\ndGhpcy52YXI7CiAgICAgICAgICAgIHRoaXMudmFyID0gbnVsbDsKCiAgICAg\nICAgICAgIC8vIGdldCBmaXJzdCB0YWJsZSBhbGlhcyBiZWZvcmUgdXBkYXRp\nbmcgcGF0aDsgaWYgdGhlcmUgaXMgYSBmcm9tCiAgICAgICAgICAgIC8vIHNl\nbGVjdCB0aGVuIHdlIHNob3VsZG4ndCBhY3R1YWxseSBjcmVhdGUgYSBqb2lu\nIG9iamVjdCwgc2luY2UKICAgICAgICAgICAgLy8gdGhlIGpvaW5zIHdpbGwg\nYWxsIGJlIGRvbmUgaW4gdGhlIGZyb20gc2VsZWN0CiAgICAgICAgICAgIGJv\nb2xlYW4gY3JlYXRlSm9pbiA9IF9zZWwuX2Zyb20gPT0gbnVsbDsKICAgICAg\nICAgICAgVGFibGUgdGFibGUxID0gbnVsbDsKICAgICAgICAgICAgaW50IGFs\naWFzMSA9IC0xOwogICAgICAgICAgICBpZiAoY3JlYXRlSm9pbikgewogICAg\nICAgICAgICAgICAgdGFibGUxID0gKGludmVyc2UpID8gZmsuZ2V0UHJpbWFy\neUtleVRhYmxlKCkgOiBmay5nZXRUYWJsZSgpOwogICAgICAgICAgICAgICAg\nYWxpYXMxID0gX3NlbC5nZXRUYWJsZUluZGV4KHRhYmxlMSwgdGhpcywgdHJ1\nZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHVwZGF0ZSB0aGUg\ncGF0aCB3aXRoIHRoZSByZWxhdGlvbiBuYW1lIGJlZm9yZSBnZXR0aW5nIHBr\nIGFsaWFzCiAgICAgICAgICAgIHRoaXMuYXBwZW5kKG5hbWUpOwogICAgICAg\nICAgICB0aGlzLmFwcGVuZCh2YXIpOwogICAgICAgICAgICBpZiAodG9NYW55\nKSB7CiAgICAgICAgICAgICAgICBfc2VsLl9mbGFncyB8PSBJTVBMSUNJVF9E\nSVNUSU5DVDsKICAgICAgICAgICAgICAgIF9zZWwuX2ZsYWdzIHw9IFRPX01B\nTlk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX291dGVyID0gb3V0ZXI7\nCgogICAgICAgICAgICBpZiAoY3JlYXRlSm9pbikgewogICAgICAgICAgICAg\nICAgVGFibGUgdGFibGUyID0gKGludmVyc2UpID8gZmsuZ2V0VGFibGUoKSAK\nICAgICAgICAgICAgICAgICAgICA6IGZrLmdldFByaW1hcnlLZXlUYWJsZSgp\nOwogICAgICAgICAgICAgICAgaW50IGFsaWFzMiA9IF9zZWwuZ2V0VGFibGVJ\nbmRleCh0YWJsZTIsIHRoaXMsIHRydWUpOwogICAgICAgICAgICAgICAgSm9p\nbiBqID0gbmV3IEpvaW4odGFibGUxLCBhbGlhczEsIHRhYmxlMiwgYWxpYXMy\nLCBmaywgaW52ZXJzZSk7CiAgICAgICAgICAgICAgICBqLnNldFR5cGUoKG91\ndGVyKSA/IEpvaW4uVFlQRV9PVVRFUiA6IEpvaW4uVFlQRV9JTk5FUik7Cgog\nICAgICAgICAgICAgICAgaWYgKF9qb2lucyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIF9qb2lucyA9IG5ldyBKb2luU2V0KCk7CiAgICAgICAgICAg\nICAgICBpZiAoX2pvaW5zLmFkZChqKSAmJiAoc3VicyA9PSBTZWxlY3QuU1VC\nU19KT0lOQUJMRSAKICAgICAgICAgICAgICAgICAgICB8fCBzdWJzID09IFNl\nbGVjdC5TVUJTX05PTkUpKQogICAgICAgICAgICAgICAgICAgIGouc2V0UmVs\nYXRpb24odGFyZ2V0LCBzdWJzLCBjbG9uZShfc2VsKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgU2VsZWN0Sm9pbnMgY2xvbmUoU2VsZWN0SW1wbCBzZWwpIHsK\nICAgICAgICAgICAgU2VsZWN0Sm9pbnMgc2ogPSBuZXcgU2VsZWN0Sm9pbnMo\nc2VsKTsKICAgICAgICAgICAgc2oudmFyID0gdmFyOwogICAgICAgICAgICBp\nZiAocGF0aCAhPSBudWxsKQogICAgICAgICAgICAgICAgc2oucGF0aCA9IG5l\ndyBTdHJpbmdCdWZmZXIocGF0aC50b1N0cmluZygpKTsKICAgICAgICAgICAg\naWYgKF9qb2lucyAhPSBudWxsICYmICFfam9pbnMuaXNFbXB0eSgpKQogICAg\nICAgICAgICAgICAgc2ouX2pvaW5zID0gbmV3IEpvaW5TZXQoX2pvaW5zKTsK\nICAgICAgICAgICAgc2ouX291dGVyID0gX291dGVyOwogICAgICAgICAgICBy\nZXR1cm4gc2o7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRv\nU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gc3VwZXIudG9TdHJpbmco\nKSArICIgKCIgKyBfb3V0ZXIgKyAiKTogIiArIF9qb2luczsKICAgICAgICB9\nCiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBTZWxlY3RzIG5ld1NlbGVjdHMo\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBIZWxwZXIgY2xhc3MgdG8gdHJhY2sgc2VsZWN0ZWQgY29s\ndW1ucywgd2l0aCBmYXN0IGNvbnRhaW5zIG1ldGhvZC4KICAgICAqIEFjdHMg\nYXMgYSBsaXN0IG9mIHNlbGVjdCBpZHMsIHdpdGggYWRkaXRpb25hbCBtZXRo\nb2RzIHRvIG1hbmlwdWxhdGUKICAgICAqIHRoZSBhbGlhcyBvZiBlYWNoIHNl\nbGVjdGVkIGlkLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGNsYXNz\nIFNlbGVjdHMKICAgICAgICBleHRlbmRzIEFic3RyYWN0TGlzdCB7CgogICAg\nICAgIHByb3RlY3RlZCBMaXN0IF9pZHMgPSBudWxsOwogICAgICAgIHByb3Rl\nY3RlZCBMaXN0IF9pZGVudHMgPSBudWxsOwogICAgICAgIHByb3RlY3RlZCBN\nYXAgX2FsaWFzZXMgPSBudWxsOwogICAgICAgIHByb3RlY3RlZCBNYXAgX3Nl\nbGVjdEFzID0gbnVsbDsKICAgICAgICBwcm90ZWN0ZWQgREJEaWN0aW9uYXJ5\nIF9kaWN0ID0gbnVsbDsKCiAgICAgICAgLyoqCiAgICAgICAgICogQWRkIGFs\nbCBhbGlhc2VzIGZyb20gYW5vdGhlciBpbnN0YW5jZS4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgdm9pZCBhZGRBbGwoU2VsZWN0cyBzZWxzKSB7CiAg\nICAgICAgICAgIGlmIChfaWRzID09IG51bGwgJiYgc2Vscy5faWRzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBfaWRzID0gbmV3IEFycmF5TGlzdChzZWxz\nLl9pZHMpOwogICAgICAgICAgICBlbHNlIGlmIChzZWxzLl9pZHMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9pZHMuYWRkQWxsKHNlbHMuX2lkcyk7Cgog\nICAgICAgICAgICBpZiAoX2lkZW50cyA9PSBudWxsICYmIHNlbHMuX2lkZW50\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2lkZW50cyA9IG5ldyBBcnJh\neUxpc3Qoc2Vscy5faWRlbnRzKTsKICAgICAgICAgICAgZWxzZSBpZiAoc2Vs\ncy5faWRlbnRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfaWRlbnRzLmFk\nZEFsbChzZWxzLl9pZGVudHMpOwoKICAgICAgICAgICAgaWYgKF9hbGlhc2Vz\nID09IG51bGwgJiYgc2Vscy5fYWxpYXNlcyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX2FsaWFzZXMgPSBuZXcgSGFzaE1hcChzZWxzLl9hbGlhc2VzKTsK\nICAgICAgICAgICAgZWxzZSBpZiAoc2Vscy5fYWxpYXNlcyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX2FsaWFzZXMucHV0QWxsKHNlbHMuX2FsaWFzZXMp\nOwoKICAgICAgICAgICAgaWYgKF9zZWxlY3RBcyA9PSBudWxsICYmIHNlbHMu\nX3NlbGVjdEFzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfc2VsZWN0QXMg\nPSBuZXcgSGFzaE1hcChzZWxzLl9zZWxlY3RBcyk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKHNlbHMuX3NlbGVjdEFzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfc2VsZWN0QXMucHV0QWxsKHNlbHMuX3NlbGVjdEFzKTsKICAgICAgICB9\nCgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGFsaWFzIG9m\nIGEgZ2l2ZW4gaWQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIE9iamVj\ndCBnZXRBbGlhcyhPYmplY3QgaWQpIHsKICAgICAgICAgICAgcmV0dXJuIChf\nYWxpYXNlcyA9PSBudWxsKSA/IG51bGwgOiBfYWxpYXNlcy5nZXQoaWQpOwog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0IGFuIGFsaWFz\nIGZvciBhIGdpdmVuIGlkLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBp\nbnQgc2V0QWxpYXMoT2JqZWN0IGlkLCBPYmplY3QgYWxpYXMsIGJvb2xlYW4g\naWRlbnQpIHsKICAgICAgICAgICAgaWYgKF9pZHMgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgX2lkcyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAg\nICAgICAgIF9hbGlhc2VzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgaW50IGlkeDsKICAgICAgICAgICAgaWYgKF9hbGlh\nc2VzLnB1dChpZCwgYWxpYXMpICE9IG51bGwpCiAgICAgICAgICAgICAgICBp\nZHggPSBfaWRzLmluZGV4T2YoaWQpOwogICAgICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgICAgIF9pZHMuYWRkKGlkKTsKICAgICAgICAgICAgICAgIGlk\neCA9IF9pZHMuc2l6ZSgpIC0gMTsKCiAgICAgICAgICAgICAgICBpZiAoaWRl\nbnQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2lkZW50cyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICBfaWRlbnRzID0gbmV3IEFycmF5\nTGlzdCgzKTsKICAgICAgICAgICAgICAgICAgICBfaWRlbnRzLmFkZChpZCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIGlkeDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIFNldCBhbiBhbGlhcyBmb3IgYSBnaXZlbiBpbmRleC4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgdm9pZCBzZXRBbGlhcyhpbnQgaWR4LCBPYmplY3Qg\nYWxpYXMpIHsKICAgICAgICAgICAgT2JqZWN0IGlkID0gX2lkcy5nZXQoaWR4\nKTsKICAgICAgICAgICAgX2FsaWFzZXMucHV0KGlkLCBhbGlhcyk7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBJbnNlcnQgYW4gYWxpYXMg\nYmVmb3JlIHRoZSBnaXZlbiBpbmRleCwgdXNpbmcgbmVnYXRpdmUgaW5kZXhl\ncwogICAgICAgICAqIHRvIGNvdW50IGJhY2t3YXJkcy4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgdm9pZCBpbnNlcnRBbGlhcyhpbnQgaWR4LCBPYmpl\nY3QgaWQsIE9iamVjdCBhbGlhcykgewogICAgICAgICAgICBfYWxpYXNlcy5w\ndXQoaWQsIGFsaWFzKTsKICAgICAgICAgICAgaWYgKGlkeCA+PSAwKQogICAg\nICAgICAgICAgICAgX2lkcy5hZGQoaWR4LCBpZCk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIF9pZHMuYWRkKF9pZHMuc2l6ZSgpICsgaWR4\nLCBpZCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1\ncm4gdGhlIGluZGV4IG9mIHRoZSBnaXZlbiBhbGlhcy4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgaW50IGluZGV4T2ZBbGlhcyhPYmplY3QgYWxpYXMp\nIHsKICAgICAgICAgICAgaWYgKF9hbGlhc2VzID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgX2lkcy5zaXplKCk7IGkrKykKICAgICAgICAgICAgICAgIGlmIChh\nbGlhcy5lcXVhbHMoX2FsaWFzZXMuZ2V0KF9pZHMuZ2V0KGkpKSkpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgICAgIHJldHVybiAt\nMTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEEgbGlzdCBy\nZXByZXNlbnRhdGlvbiBvZiB0aGUgYWxpYXNlcywgaW4gc2VsZWN0IG9yZGVy\nLCB3aXRoCiAgICAgICAgICogQVMgYWxpYXNlcyBwcmVzZW50LgogICAgICAg\nICAqLwogICAgICAgIHB1YmxpYyBMaXN0IGdldEFsaWFzZXMoZmluYWwgYm9v\nbGVhbiBpZGVudCwgZmluYWwgYm9vbGVhbiBpbm5lcikgewogICAgICAgICAg\nICBpZiAoX2lkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIENv\nbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CgogICAgICAgICAgICByZXR1cm4gbmV3\nIEFic3RyYWN0TGlzdCgpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyBpbnQg\nc2l6ZSgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGlkZW50ICYm\nIF9pZGVudHMgIT0gbnVsbCkgPyBfaWRlbnRzLnNpemUoKQogICAgICAgICAg\nICAgICAgICAgICAgICA6IF9pZHMuc2l6ZSgpOwogICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0KGludCBpKSB7\nCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IGlkID0gKGlkZW50ICYmIF9p\nZGVudHMgIT0gbnVsbCkgPyBfaWRlbnRzLmdldChpKQogICAgICAgICAgICAg\nICAgICAgICAgICA6IF9pZHMuZ2V0KGkpOwogICAgICAgICAgICAgICAgICAg\nIE9iamVjdCBhbGlhcyA9IF9hbGlhc2VzLmdldChpZCk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGlkIGluc3RhbmNlb2YgQ29sdW1uICYmICgoQ29sdW1u\nKSBpZCkuaXNYTUwoKSkKICAgICAgICAgICAgICAgICAgICAgICAgYWxpYXMg\nPSBhbGlhcyArIF9kaWN0LmdldFN0cmluZ1ZhbDsKICAgICAgICAgICAgICAg\nICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIGFzID0gbnVs\nbDsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5uZXIpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGFzID0gKChTdHJpbmcpIGFsaWFzKS5yZXBsYWNlKCcu\nJywgJ18nKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChfc2VsZWN0\nQXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgYXMgPSAoU3Ry\naW5nKSBfc2VsZWN0QXMuZ2V0KGlkKTsKCiAgICAgICAgICAgICAgICAgICAg\naWYgKGFzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGlkZW50ICYmIF9pZGVudHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiBhczsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGFsaWFzIGluc3RhbmNlb2YgU1FMQnVmZmVyKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgYWxpYXMgPSBuZXcgU1FMQnVmZmVyKChTUUxCdWZm\nZXIpIGFsaWFzKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBh\ncHBlbmQoIiBBUyAiKS5hcHBlbmQoYXMpOwogICAgICAgICAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGlhcyA9\nIGFsaWFzICsgIiBBUyAiICsgYXM7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBhbGlhczsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIC8qKgog\nICAgICAgICAqIFNldCB0aGF0IGEgZ2l2ZW4gaWQncyBhbGlhcyBoYXMgYW4g\nQVMgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgc2V0\nU2VsZWN0QXMoT2JqZWN0IGlkLCBTdHJpbmcgYXMpIHsKICAgICAgICAgICAg\naWYgKF9zZWxlY3RBcyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3NlbGVj\ndEFzID0gbmV3IEhhc2hNYXAoKGludCkgKDUgKiAxLjMzICsgMSkpOwogICAg\nICAgICAgICBfc2VsZWN0QXMucHV0KGlkLCBhcyk7CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBDbGVhciBhbGwgcGxhY2Vob2xkZXJzIGFu\nZCBzZWxlY3QgQVMgY2xhdXNlcy4KICAgICAgICAgKi8KICAgICAgICBwdWJs\naWMgdm9pZCBjbGVhclBsYWNlaG9sZGVycygpIHsKICAgICAgICAgICAgaWYg\nKF9pZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgICAgIE9iamVjdCBpZDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBfaWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBpZCA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBp\nZiAoaWQgaW5zdGFuY2VvZiBQbGFjZWhvbGRlcikgewogICAgICAgICAgICAg\nICAgICAgIGl0ci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICBfYWxp\nYXNlcy5yZW1vdmUoaWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb250YWlu\ncyhPYmplY3QgaWQpIHsKICAgICAgICAgICAgcmV0dXJuIF9hbGlhc2VzICE9\nIG51bGwgJiYgX2FsaWFzZXMuY29udGFpbnNLZXkoaWQpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIE9iamVjdCBnZXQoaW50IGkpIHsKICAgICAgICAg\nICAgaWYgKF9pZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oKTsKICAgICAgICAg\nICAgcmV0dXJuIF9pZHMuZ2V0KGkpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGludCBzaXplKCkgewogICAgICAgICAgICByZXR1cm4gKF9pZHMgPT0g\nbnVsbCkgPyAwIDogX2lkcy5zaXplKCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICAgICAgX2lkcyA9IG51bGw7\nCiAgICAgICAgICAgIF9hbGlhc2VzID0gbnVsbDsKICAgICAgICAgICAgX3Nl\nbGVjdEFzID0gbnVsbDsKICAgICAgICAgICAgX2lkZW50cyA9IG51bGw7CiAg\nICAgICAgfQogICAgfQp9CgovKioKICogQ29tbW9uIGpvaW5zIGludGVyZmFj\nZSB1c2VkIGludGVybmFsbHkuIENhbm5vdCBiZSBtYWRlIGFuIGlubmVyIGNs\nYXNzCiAqIGJlY2F1c2UgdGhlIG91dGVyIGNsYXNzIChTZWxlY3QpIGhhcyB0\nbyBpbXBsZW1lbnQgaXQuCiAqLwppbnRlcmZhY2UgUGF0aEpvaW5zCiAgICBl\neHRlbmRzIEpvaW5zIHsKCiAgICAvKioKICAgICAqIE1hcmsgdGhpcyBhcyBh\nbiBvdXRlciBqb2lucyBzZXQuCiAgICAgKi8KICAgIHB1YmxpYyBQYXRoSm9p\nbnMgc2V0T3V0ZXIoYm9vbGVhbiBvdXRlcik7CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdHJ1ZSBpZiB0aGlzIGluc3RhbmNlIGhhcyBhIHBhdGgsIGFueSBq\nb2lucywgb3IgYSB2YXJpYWJsZS4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gaXNEaXJ0eSgpOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSByZWxh\ndGlvbiBwYXRoIHRyYXZlcnNlZCBieSB0aGVzZSBqb2lucywgb3IgbnVsbCBp\nZiBub25lLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nQnVmZmVyIHBhdGgo\nKTsKCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc2V0IG9mIHtAbGluayBK\nb2lufSBlbGVtZW50cywgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBw\ndWJsaWMgSm9pblNldCBqb2lucygpOwoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBtYXhpbXVtIG51bWJlciBvZiBqb2lucyBjb250YWluZWQgaW4gdGhp\ncyBpbnN0YW5jZSBhdCBhbnkKICAgICAqIHRpbWUuCiAgICAgKi8KICAgIHB1\nYmxpYyBpbnQgam9pbkNvdW50KCk7CgogICAgLyoqCiAgICAgKiBOdWxsIHRo\nZSBzZXQgb2Yge0BsaW5rIEpvaW59IGVsZW1lbnRzLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBudWxsSm9pbnMoKTsKfQoK\n","encoding":"base64"}

