{"sha":"976ccea7b1674ec57da02085e73e7ec219e74ee0","node_id":"MDQ6QmxvYjIwNjM2NDo5NzZjY2VhN2IxNjc0ZWM1N2RhMDIwODVlNzNlN2VjMjE5ZTc0ZWUw","size":173650,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/976ccea7b1674ec57da02085e73e7ec219e74ee0","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5s\nYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNv\nbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9u\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubWV0YS5DbGFzc0FyZ1BhcnNl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5CeXRlY29k\nZVdyaXRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5G\naWxlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRv\nUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5TZXJ2aWNlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5Mb2NhbGl6ZXIuTWVzc2FnZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQnl0ZUlkOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuQ2hhcklkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuRGF0ZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuRG91YmxlSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5JZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludElkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRmxvYXRJZDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkxvbmdJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLk9iamVjdElkOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuU2hvcnRJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlN0cmluZ0lkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgc2VycC5ieXRlY29kZS5C\nQ0NsYXNzOwppbXBvcnQgc2VycC5ieXRlY29kZS5CQ0ZpZWxkOwppbXBvcnQg\nc2VycC5ieXRlY29kZS5CQ01ldGhvZDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUu\nQ29kZTsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQ29uc3RhbnRzOwppbXBvcnQg\nc2VycC5ieXRlY29kZS5FeGNlcHRpb25zOwppbXBvcnQgc2VycC5ieXRlY29k\nZS5GaWVsZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5HZXRG\naWVsZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5JZkluc3Ry\ndWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5JbnN0cnVjdGlvbjsKaW1w\nb3J0IHNlcnAuYnl0ZWNvZGUuSnVtcEluc3RydWN0aW9uOwppbXBvcnQgc2Vy\ncC5ieXRlY29kZS5Mb2FkSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLk1ldGhvZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5Q\ncm9qZWN0OwppbXBvcnQgc2VycC5ieXRlY29kZS5UYWJsZVN3aXRjaEluc3Ry\ndWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5DbGFzc0luc3RydWN0aW9u\nOwppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CmltcG9ydCBzZXJwLnV0aWwu\nU3RyaW5nczsKCi8qKgogKiBCeXRlY29kZSBlbmhhbmNlciB1c2VkIHRvIGVu\naGFuY2UgcGVyc2lzdGVudCBjbGFzc2VzIGZyb20gbWV0YWRhdGEuIFRoZQog\nKiBlbmhhbmNlciBtdXN0IGJlIGludm9rZWQgb24gYWxsIHBlcnNpc3RlbmNl\nLWNhcGFibGUgYW5kIHBlcnNpc3RlbmNlIGF3YXJlCiAqIGNsYXNzZXMuCiAq\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgUENFbmhh\nbmNlciB7CiAgICAvLyBEZXNpZ25hdGVzIGEgdmVyc2lvbiBmb3IgbWFpbnRh\naW5pbmcgY29tcGF0YmlsaXR5IHdoZW4gUENFbmhhbmNlcgogICAgLy8gbW9k\naWZpZXMgZW5oYW5jZW1lbnQgdGhhdCBjYW4gYnJlYWsgc2VyaWFsaXphdGlv\nbiBvciBvdGhlciBjb250cmFjdHMKICAgIC8vIEVhY2ggZW5oYW5jZWQgY2xh\nc3Mgd2lsbCByZXR1cm4gdGhlIHZhbHVlIG9mIHRoaXMgZmllbGQgdmlhCiAg\nICAvLyBwdWJsaWMgaW50IGdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJzaW9u\nKCkKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFOQ0VSX1ZFUlNJ\nT04gPSAyOwoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFOQ0Vf\nTk9ORSA9IDA7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNF\nX0FXQVJFID0gMiA8PCAwOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nRU5IQU5DRV9JTlRFUkZBQ0UgPSAyIDw8IDE7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBFTkhBTkNFX1BDID0gMiA8PCAyOwoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIFN0cmluZyBQUkUgPSAicGMiOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgQ2xhc3MgUENUWVBFID0gUGVyc2lzdGVuY2VDYXBhYmxl\nLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFNNID0g\nUFJFICsgIlN0YXRlTWFuYWdlciI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBDbGFzcyBTTVRZUEUgPSBTdGF0ZU1hbmFnZXIuY2xhc3M7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgSU5IRVJJVCA9IFBSRSArICJJbmhl\ncml0ZWRGaWVsZENvdW50IjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0\ncmluZyBDT05URVhUTkFNRSA9ICJHZW5lcmljQ29udGV4dCI7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBVU0VSRVhDRVAgPSBVc2VyRXhjZXB0\naW9uLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgSU5U\nRVJORVhDRVAgPSBJbnRlcm5hbEV4Y2VwdGlvbi5jbGFzczsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIENsYXNzIEhFTFBFUlRZUEUgPSBQQ1JlZ2lzdHJ5\nLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFNVUEVS\nID0gUFJFICsgIlBDU3VwZXJjbGFzcyI7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBDbGFzcyBPSURGU1RZUEUgPSBGaWVsZFN1cHBsaWVyLmNsYXNzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgT0lERkNUWVBFID0gRmll\nbGRDb25zdW1lci5jbGFzczsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBM\nb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAg\nKFBDRW5oYW5jZXIuY2xhc3MpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nU3RyaW5nIFJFREVGSU5FRF9BVFRSSUJVVEUKICAgICAgICA9IFBDRW5oYW5j\nZXIuY2xhc3MuZ2V0TmFtZSgpICsgIiNyZWRlZmluZWQtdHlwZSI7CiAgICAK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIEF1eGlsaWFyeUVuaGFuY2VyW10g\nX2F1eEVuaGFuY2VyczsKICAgIHN0YXRpYyB7CiAgICAgICAgQ2xhc3NbXSBj\nbGFzc2VzID0gU2VydmljZXMuZ2V0SW1wbGVtZW50b3JDbGFzc2VzKAogICAg\nICAgICAgICBBdXhpbGlhcnlFbmhhbmNlci5jbGFzcywKICAgICAgICAgICAg\nKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVy\nQWN0aW9uKEF1eGlsaWFyeUVuaGFuY2VyLmNsYXNzKSkpOwogICAgICAgIExp\nc3QgYXV4RW5oYW5jZXJzID0gbmV3IEFycmF5TGlzdChjbGFzc2VzLmxlbmd0\naCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjbGFzc2VzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBh\ndXhFbmhhbmNlcnMuYWRkKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2Vk\nKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0luc3Rh\nbmNlQWN0aW9uKGNsYXNzZXNbaV0pKSk7CgkJICAgIH0gY2F0Y2ggKFRocm93\nYWJsZSB0KSB7CiAgICAgICAgICAgICAgICAvLyBhdXggZW5oYW5jZXIgbWF5\nIHJlbHkgb24gbm9uLWV4aXN0YW50IHNwZWMgY2xhc3NlcywgZXRjCgkJICAg\nIH0KCQl9CiAgICAJX2F1eEVuaGFuY2VycyA9IChBdXhpbGlhcnlFbmhhbmNl\ncltdKSBhdXhFbmhhbmNlcnMudG9BcnJheQogICAgICAgICAgICAobmV3IEF1\neGlsaWFyeUVuaGFuY2VyW2F1eEVuaGFuY2Vycy5zaXplKCldKTsKICAgIH0K\nCiAgICBwcml2YXRlIEJDQ2xhc3MgX3BjOwogICAgcHJpdmF0ZSBmaW5hbCBC\nQ0NsYXNzIF9tYW5hZ2VkVHlwZTsKICAgIHByaXZhdGUgZmluYWwgTWV0YURh\ndGFSZXBvc2l0b3J5IF9yZXBvczsKICAgIHByaXZhdGUgZmluYWwgQ2xhc3NN\nZXRhRGF0YSBfbWV0YTsKICAgIHByaXZhdGUgZmluYWwgTG9nIF9sb2c7CiAg\nICBwcml2YXRlIENvbGxlY3Rpb24gX29pZHMgPSBudWxsOwogICAgcHJpdmF0\nZSBib29sZWFuIF9kZWZDb25zID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfcmVkZWZpbmUgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfc3Vi\nY2xhc3MgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfZmFpbCA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBTZXQgX3Zpb2xhdGlvbnMgPSBudWxsOwogICAg\ncHJpdmF0ZSBGaWxlIF9kaXIgPSBudWxsOwogICAgcHJpdmF0ZSBCeXRlY29k\nZVdyaXRlciBfd3JpdGVyID0gbnVsbDsKICAgIHByaXZhdGUgTWFwIF9iYWNr\naW5nRmllbGRzID0gbnVsbDsgLy8gbWFwIG9mIHNldCAvIGdldCBuYW1lcyA9\nPiBmaWVsZCBuYW1lcwogICAgcHJpdmF0ZSBNYXAgX2F0dHJzVG9GaWVsZHMg\nPSBudWxsOyAvLyBtYXAgb2YgYXR0ciBuYW1lcyA9PiBmaWVsZCBuYW1lcwog\nICAgcHJpdmF0ZSBNYXAgX2ZpZWxkc1RvQXR0cnMgPSBudWxsOyAvLyBtYXAg\nb2YgZmllbGQgbmFtZXMgPT4gYXR0ciBuYW1lcwogICAgcHJpdmF0ZSBib29s\nZWFuIF9pc0FscmVhZHlSZWRlZmluZWQgPSBmYWxzZTsKICAgIHByaXZhdGUg\nYm9vbGVhbiBfaXNBbHJlYWR5U3ViY2xhc3NlZCA9IGZhbHNlOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9iY3NDb25maWd1cmVkID0gZmFsc2U7CgogICAgLyoq\nCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24gYW5k\nIHR5cGUgdG8gZW5oYW5jZS4KICAgICAqLwogICAgcHVibGljIFBDRW5oYW5j\nZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgQ2xhc3MgdHlwZSkgewog\nICAgICAgIHRoaXMoY29uZiwgKEJDQ2xhc3MpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgIC5sb2Fk\nUHJvamVjdENsYXNzQWN0aW9uKG5ldyBQcm9qZWN0KCksIHR5cGUpKSwKICAg\nICAgICAgICAgKE1ldGFEYXRhUmVwb3NpdG9yeSkgbnVsbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRp\nb24gYW5kIHR5cGUgdG8gZW5oYW5jZS4KICAgICAqLwogICAgcHVibGljIFBD\nRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgQ2xhc3NNZXRh\nRGF0YSB0eXBlKSB7CiAgICAgICAgdGhpcyhjb25mLCAoQkNDbGFzcykgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAg\nICAgICAgICAgLmxvYWRQcm9qZWN0Q2xhc3NBY3Rpb24obmV3IFByb2plY3Qo\nKSwgdHlwZS5nZXREZXNjcmliZWRUeXBlKCkpKSwKICAgICAgICAgICAgdHlw\nZS5nZXRSZXBvc2l0b3J5KCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\nc3RydWN0b3IuIFN1cHBseSBjb25maWd1cmF0aW9uLgogICAgICoKICAgICAq\nIEBwYXJhbSB0eXBlIHRoZSBieXRlY29kZSByZXByZXNlbnRhdGlvbiBmbyB0\naGUgdHlwZSB0bwogICAgICogZW5oYW5jZTsgdGhpcyBjYW4gYmUgY3JlYXRl\nZCBmcm9tIGFueSBzdHJlYW0gb3IgZmlsZQogICAgICogQHBhcmFtIHJlcG9z\nIGEgbWV0YWRhdGEgcmVwb3NpdG9yeSB0byB1c2UgZm9yIG1ldGFkYXRhIGFj\nY2VzcywKICAgICAqIG9yIG51bGwgdG8gY3JlYXRlIGEgbmV3IHJlcG9yaXRv\ncnk7IHRoZSByZXBvc2l0b3J5CiAgICAgKiBmcm9tIHRoZSBnaXZlbiBjb25m\naWd1cmF0aW9uIGlzbid0IHVzZWQgYnkgZGVmYXVsdAogICAgICogYmVjYXVz\nZSB0aGUgY29uZmlndXJhdGlvbiBtaWdodCBiZSBhbgogICAgICogaW1wbGVt\nZW50YXRpb24tc3BlY2lmaWMgc3ViY2xhc3Mgd2hvc2UgbWV0YWRhdGEKICAg\nICAqIHJlcXVpcmVkIG1vcmUgdGhhbiBqdXN0IGJhc2UgbWV0YWRhdGEgZmls\nZXMKICAgICAqIEBkZXByZWNhdGVkIHVzZSB7QGxpbmsgI1BDRW5oYW5jZXIo\nT3BlbkpQQUNvbmZpZ3VyYXRpb24sIEJDQ2xhc3MsCiAgICAgICAgTWV0YURh\ndGFSZXBvc2l0b3J5LCBDbGFzc0xvYWRlcil9IGluc3RlYWQuIAogICAgICov\nCiAgICBwdWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBj\nb25mLCBCQ0NsYXNzIHR5cGUsCiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5\nIHJlcG9zKSB7CiAgICAgICAgdGhpcyhjb25mLCB0eXBlLCByZXBvcywgbnVs\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5\nIGNvbmZpZ3VyYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIHR5cGUgdGhl\nIGJ5dGVjb2RlIHJlcHJlc2VudGF0aW9uIGZvIHRoZSB0eXBlIHRvCiAgICAg\nKiBlbmhhbmNlOyB0aGlzIGNhbiBiZSBjcmVhdGVkIGZyb20gYW55IHN0cmVh\nbSBvciBmaWxlCiAgICAgKiBAcGFyYW0gcmVwb3MgYSBtZXRhZGF0YSByZXBv\nc2l0b3J5IHRvIHVzZSBmb3IgbWV0YWRhdGEgYWNjZXNzLAogICAgICogb3Ig\nbnVsbCB0byBjcmVhdGUgYSBuZXcgcmVwb3JpdG9yeTsgdGhlIHJlcG9zaXRv\ncnkKICAgICAqIGZyb20gdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24gaXNuJ3Qg\ndXNlZCBieSBkZWZhdWx0CiAgICAgKiBiZWNhdXNlIHRoZSBjb25maWd1cmF0\naW9uIG1pZ2h0IGJlIGFuCiAgICAgKiBpbXBsZW1lbnRhdGlvbi1zcGVjaWZp\nYyBzdWJjbGFzcyB3aG9zZSBtZXRhZGF0YQogICAgICogcmVxdWlyZWQgbW9y\nZSB0aGFuIGp1c3QgYmFzZSBtZXRhZGF0YSBmaWxlcwogICAgICogQHBhcmFt\nIGxvYWRlciB0aGUgZW52aXJvbm1lbnQgY2xhc3Nsb2FkZXIgdG8gdXNlIGZv\nciBsb2FkaW5nCiAgICAgKiBjbGFzc2VzIGFuZCByZXNvdXJjZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9u\nIGNvbmYsIEJDQ2xhc3MgdHlwZSwKICAgICAgICBNZXRhRGF0YVJlcG9zaXRv\ncnkgcmVwb3MsIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIF9tYW5h\nZ2VkVHlwZSA9IHR5cGU7CiAgICAgICAgX3BjID0gdHlwZTsKCiAgICAgICAg\nX2xvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19F\nTkhBTkNFKTsKCiAgICAgICAgaWYgKHJlcG9zID09IG51bGwpIHsKICAgICAg\nICAgICAgX3JlcG9zID0gY29uZi5uZXdNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpOwogICAgICAgICAgICBfcmVwb3Muc2V0U291cmNlTW9kZShNZXRh\nRGF0YVJlcG9zaXRvcnkuTU9ERV9NRVRBKTsKICAgICAgICB9IGVsc2UKICAg\nICAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICAgICAgX21ldGEgPSBfcmVw\nb3MuZ2V0TWV0YURhdGEodHlwZS5nZXRUeXBlKCksIGxvYWRlciwgZmFsc2Up\nOwogICAgfQoKICAgIHN0YXRpYyBTdHJpbmcgdG9QQ1N1YmNsYXNzTmFtZShD\nbGFzcyBjbHMpIHsKICAgICAgICByZXR1cm4gU3RyaW5ncy5nZXRQYWNrYWdl\nTmFtZShQQ0VuaGFuY2VyLmNsYXNzKSArICIuIgogICAgICAgICAgICArIGNs\ncy5nZXROYW1lKCkucmVwbGFjZSgnLicsICckJykgKyAiJHBjc3ViY2xhc3Mi\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBj\nb25maWd1cmF0aW9uLCB0eXBlLCBhbmQgbWV0YWRhdGEuCiAgICAgKi8KICAg\nIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYs\nIEJDQ2xhc3MgdHlwZSwKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICB0aGlzKGNvbmYsIHR5cGUsIG1ldGEuZ2V0UmVwb3NpdG9yeSgp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYnl0ZWNvZGUg\ncmVwcmVzZW50YXRpb24gb2YgdGhlIHBlcnNpc3RlbmNlLWNhcGFibGUgY2xh\nc3MKICAgICAqIGJlaW5nIG1hbmlwdWxhdGVkLgogICAgICovCiAgICBwdWJs\naWMgQkNDbGFzcyBnZXRQQ0J5dGVjb2RlKCkgewogICAgICAgIHJldHVybiBf\ncGM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGJ5dGVjb2Rl\nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBtYW5hZ2VkIGNsYXNzIGJlaW5nCiAg\nICAgKiBtYW5pcHVsYXRlZC4gVGhpcyBpcyB1c3VhbGx5IHRoZSBzYW1lIGFz\nIHtAbGluayAjZ2V0UENCeXRlY29kZX0sCiAgICAgKiBleGNlcHQgd2hlbiBy\ndW5uaW5nIHRoZSBlbmhhbmNlciB0byByZWRlZmluZSBhbmQgc3ViY2xhc3MK\nICAgICAqIGV4aXN0aW5nIHBlcnNpc3RlbnQgdHlwZXMuCiAgICAgKi8KICAg\nIHB1YmxpYyBCQ0NsYXNzIGdldE1hbmFnZWRUeXBlQnl0ZWNvZGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9tYW5hZ2VkVHlwZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBjbGFzcyBiZWluZyBt\nYW5pcHVsYXRlZCwgb3IgbnVsbCBpZiBub3QKICAgICAqIGEgcGVyc2lzdGVu\ndCB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRN\nZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gX21ldGE7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBl\nbmhhbmNlciBzaG91bGQgYWRkIGEgbm8tYXJncwogICAgICogY29uc3RydWN0\nb3IgaWYgb25lIGlzIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNsYXNz\nLiBPcGVuSlBBCiAgICAgKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNvbnN0\ncnVjdG9yICh3aGV0aGVyIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAgICAg\nKiBvciBieSB0aGUgdXNlcikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBZGREZWZhdWx0Q29uc3RydWN0b3Io\nKSB7CiAgICAgICAgcmV0dXJuIF9kZWZDb25zOwogICAgfQoKICAgIC8qKgog\nICAgICogQSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgZW5oYW5j\nZXIgc2hvdWxkIGFkZCBhIG5vLWFyZ3MKICAgICAqIGNvbnN0cnVjdG9yIGlm\nIG9uZSBpcyBub3QgYWxyZWFkeSBwcmVzZW50IGluIHRoZSBjbGFzcy4gT3Bl\nbkpQQQogICAgICogcmVxdWlyZXMgdGhhdCBhIG5vLWFyZyBjb25zdHJ1Y3Rv\nciAod2hldGhlciBjcmVhdGVkIGJ5IHRoZSBjb21waWxlcgogICAgICogb3Ig\nYnkgdGhlIHVzZXIpIGJlIHByZXNlbnQgaW4gYSBQQy4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKGJvb2xlYW4g\nYWRkRGVmYXVsdENvbnN0cnVjdG9yKSB7CiAgICAgICAgX2RlZkNvbnMgPSBh\nZGREZWZhdWx0Q29uc3RydWN0b3I7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIHRoZSBlbmhhbmNlciBzaG91bGQgbXV0YXRlIGl0cyBhcmd1bWVu\ndHMsIG9yIGp1c3QgcnVuIHZhbGlkYXRpb24KICAgICAqIGFuZCBvcHRpb25h\nbCBzdWJjbGFzc2luZyBsb2dpYyBvbiB0aGVtLiBVc3VhbGx5IHVzZWQgaW4g\nY29uanVuY3Rpb24gd2l0aAogICAgICogPGNvZGU+c2V0Q3JlYXRlU3ViY2xh\nc3ModHJ1ZSk8L2NvZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZWRlZmluZSgpIHsKICAg\nICAgICByZXR1cm4gX3JlZGVmaW5lOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIG11dGF0ZSBpdHMgYXJndW1l\nbnRzLCBvciBqdXN0IHJ1biB2YWxpZGF0aW9uCiAgICAgKiBhbmQgb3B0aW9u\nYWwgc3ViY2xhc3NpbmcgbG9naWMgb24gdGhlbS4gVXN1YWxseSB1c2VkIGlu\nIGNvbmp1bmN0aW9uIHdpdGgKICAgICAqIDxjb2RlPnNldENyZWF0ZVN1YmNs\nYXNzKHRydWUpPC9jb2RlPi4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAK\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVkZWZpbmUoYm9vbGVhbiBy\nZWRlZmluZSkgewogICAgICAgIF9yZWRlZmluZSA9IHJlZGVmaW5lOwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSB0aGF0IHRoaXMg\naW5zdGFuY2UgaXMgZW5oYW5jaW5nIGhhcyBhbHJlYWR5IGJlZW4KICAgICAq\nIHJlZGVmaW5lZC4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gaXNBbHJlYWR5UmVkZWZpbmVkKCkgewog\nICAgICAgIHJldHVybiBfaXNBbHJlYWR5UmVkZWZpbmVkOwogICAgfQoKICAg\nIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSB0aGF0IHRoaXMgaW5zdGFu\nY2UgaXMgZW5oYW5jaW5nIGhhcyBhbHJlYWR5IGJlZW4KICAgICAqIHN1YmNs\nYXNzZWQgaW4gdGhpcyBpbnN0YW5jZSdzIGVudmlyb25tZW50IGNsYXNzbG9h\nZGVyLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0FscmVhZHlTdWJjbGFzc2VkKCkgewogICAgICAg\nIHJldHVybiBfaXNBbHJlYWR5U3ViY2xhc3NlZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBtYWtlIGl0cyBh\ncmd1bWVudHMgcGVyc2lzdGVuY2UtY2FwYWJsZSwKICAgICAqIG9yIGdlbmVy\nYXRlIGEgcGVyc2lzdGVuY2UtY2FwYWJsZSBzdWJjbGFzcy4KICAgICAqCiAg\nICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nZ2V0Q3JlYXRlU3ViY2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIF9zdWJjbGFz\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2Vy\nIHNob3VsZCBtYWtlIGl0cyBhcmd1bWVudHMgcGVyc2lzdGVuY2UtY2FwYWJs\nZSwKICAgICAqIG9yIGdlbmVyYXRlIGEgcGVyc2lzdGVuY2UtY2FwYWJsZSBz\ndWJjbGFzcy4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0Q3JlYXRlU3ViY2xhc3MoYm9vbGVhbiBzdWJj\nbGFzcykgewogICAgICAgIF9zdWJjbGFzcyA9IHN1YmNsYXNzOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB0byBmYWlsIGlmIHRoZSBwZXJzaXN0\nZW50IHR5cGUgdXNlcyBwcm9wZXJ0eSBhY2Nlc3MgYW5kCiAgICAgKiBieXRl\nY29kZSBhbmFseXNpcyBzaG93cyB0aGF0IGl0IG1heSBiZSB2aW9sYXRpbmcg\nT3BlbkpQQSdzIHByb3BlcnR5CiAgICAgKiBhY2Nlc3MgcmVzdHJpY3Rpb25z\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRFbmZvcmNlUHJvcGVy\ndHlSZXN0cmljdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIF9mYWlsOwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBmYWlsIGlmIHRoZSBwZXJz\naXN0ZW50IHR5cGUgdXNlcyBwcm9wZXJ0eSBhY2Nlc3MgYW5kCiAgICAgKiBi\neXRlY29kZSBhbmFseXNpcyBzaG93cyB0aGF0IGl0IG1heSBiZSB2aW9sYXRp\nbmcgT3BlbkpQQSdzIHByb3BlcnR5CiAgICAgKiBhY2Nlc3MgcmVzdHJpY3Rp\nb25zLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbmZvcmNlUHJvcGVy\ndHlSZXN0cmljdGlvbnMoYm9vbGVhbiBmYWlsKSB7CiAgICAgICAgX2ZhaWwg\nPSBmYWlsOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGJhc2UgYnVpbGQg\nZGlyZWN0b3J5IHRvIGdlbmVyYXRlIGNvZGUgdG8uIFRoZSBwcm9wZXIgcGFj\na2FnZQogICAgICogc3RydWN0dXJlIHdpbGwgYmUgY3JlYXRlZCBiZW5lYXRo\nIHRoaXMgZGlyZWN0b3J5LiBEZWZhdWx0cyB0bwogICAgICogb3ZlcndyaXRp\nbmcgdGhlIGV4aXN0aW5nIGNsYXNzIGZpbGUgaWYgbnVsbC4KICAgICAqLwog\nICAgcHVibGljIEZpbGUgZ2V0RGlyZWN0b3J5KCkgewogICAgICAgIHJldHVy\nbiBfZGlyOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGJhc2UgYnVpbGQg\nZGlyZWN0b3J5IHRvIGdlbmVyYXRlIGNvZGUgdG8uIFRoZSBwcm9wZXIgcGFj\na2FnZQogICAgICogc3RydWN0dXJlIHdpbGwgYmUgY3JlYWVkIGJlbmVhdGgg\ndGhpcyBkaXJlY3RvcnkuIERlZmF1bHRzIHRvCiAgICAgKiBvdmVyd3JpdGlu\nZyB0aGUgZXhpc3RpbmcgY2xhc3MgZmlsZSBpZiBudWxsLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXREaXJlY3RvcnkoRmlsZSBkaXIpIHsKICAgICAg\nICBfZGlyID0gZGlyOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBjdXJyZW50IHtAbGluayBCeXRlY29kZVdyaXRlcn0gdG8gd3JpdGUgdG8g\nb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgQnl0ZWNvZGVX\ncml0ZXIgZ2V0Qnl0ZWNvZGVXcml0ZXIoKSB7CiAgICAgICAgcmV0dXJuIF93\ncml0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHtAbGluayBC\neXRlY29kZVdyaXRlcn0gdG8gd3JpdGUgdGhlIGJ5dGVjb2RlIHRvIG9yIG51\nbGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Qnl0ZWNv\nZGVXcml0ZXIoQnl0ZWNvZGVXcml0ZXIgd3JpdGVyKSB7CiAgICAgICAgX3dy\naXRlciA9IHdyaXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0g\nYnl0ZWNvZGUgZW5oYW5jZW1lbnRzLgogICAgICoKICAgICAqIEByZXR1cm4g\nPGNvZGU+RU5IQU5DRV8qPC9jb2RlPiBjb25zdGFudAogICAgICovCiAgICBw\ndWJsaWMgaW50IHJ1bigpIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5h\nYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmhh\nbmNlLXN0YXJ0IiwgX21hbmFnZWRUeXBlLmdldFR5cGUoKSkpOwoKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBpZiBtYW5hZ2VkIGludGVyZmFjZSwg\nc2tpcAogICAgICAgICAgICBpZiAoX21hbmFnZWRUeXBlLmlzSW50ZXJmYWNl\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gRU5IQU5DRV9JTlRFUkZBQ0U7\nCgogICAgICAgICAgICAvLyBjaGVjayBpZiBhbHJlYWR5IGVuaGFuY2VkCiAg\nICAgICAgICAgIENsYXNzW10gaW50ZXJmYWNlcyA9IF9tYW5hZ2VkVHlwZS5n\nZXREZWNsYXJlZEludGVyZmFjZVR5cGVzKCk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgaW50ZXJmYWNlcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgaWYgKGludGVyZmFjZXNbaV0uZ2V0TmFtZSgpLmVxdWFs\ncyhQQ1RZUEUuZ2V0TmFtZSgpKSkgewogICAgICAgICAgICAgICAgICAgIGlm\nIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInBjLXR5cGUiLCBfbWFuYWdlZFR5\ncGUuZ2V0VHlwZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEVO\nSEFOQ0VfTk9ORTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgY29uZmlndXJlQkNzKCk7CgogICAgICAgICAgICAvLyB2\nYWxpZGF0ZSBwcm9wZXJ0aWVzIGJlZm9yZSByZXBsYWNpbmcgZmllbGQgYWNj\nZXNzIHNvIHRoYXQKICAgICAgICAgICAgLy8gd2UgYnVpbGQgdXAgYSByZWNv\ncmQgb2YgYmFja2luZyBmaWVsZHMsIGV0YwogICAgICAgICAgICBpZiAoX21l\ndGEgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgX21ldGEuZ2V0QWNjZXNz\nVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX1BST1BFUlRZKSB7CiAg\nICAgICAgICAgICAgICB2YWxpZGF0ZVByb3BlcnRpZXMoKTsKICAgICAgICAg\nICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICAg\nICAgICAgIGFkZEF0dHJpYnV0ZVRyYW5zbGF0aW9uKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3Mo\nKTsKICAgICAgICAgICAgcHJvY2Vzc1Zpb2xhdGlvbnMoKTsKCiAgICAgICAg\nICAgIGlmIChfbWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBlbmhh\nbmNlQ2xhc3MoKTsKICAgICAgICAgICAgICAgIGFkZEZpZWxkcygpOwogICAg\nICAgICAgICAgICAgYWRkU3RhdGljSW5pdGlhbGl6ZXIoKTsKICAgICAgICAg\nICAgICAgIGFkZFBDTWV0aG9kcygpOwogICAgICAgICAgICAgICAgYWRkQWNj\nZXNzb3JzKCk7CiAgICAgICAgICAgICAgICBhZGRBdHRhY2hEZXRhY2hDb2Rl\nKCk7CiAgICAgICAgICAgICAgICBhZGRTZXJpYWxpemF0aW9uQ29kZSgpOwog\nICAgICAgICAgICAgICAgYWRkQ2xvbmluZ0NvZGUoKTsKICAgICAgICAgICAg\nICAgIHJ1bkF1eGlsaWFyeUVuaGFuY2VycygpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIEVOSEFOQ0VfUEM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9s\nb2cud2FybihfbG9jLmdldCgicGVycy1hd2FyZSIsIF9tYW5hZ2VkVHlwZS5n\nZXRUeXBlKCkpKTsKICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0VfQVdBUkU7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihf\nbG9jLmdldCgiZW5oYW5jZS1lcnJvciIsCiAgICAgICAgICAgICAgICBfbWFu\nYWdlZFR5cGUuZ2V0VHlwZSgpLmdldE5hbWUoKSwgZS5nZXRNZXNzYWdlKCkp\nLCBlKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNvbmZp\nZ3VyZUJDcygpIHsKICAgICAgICBpZiAoIV9iY3NDb25maWd1cmVkKSB7CiAg\nICAgICAgICAgIGlmIChnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoX21hbmFnZWRUeXBlLmdldEF0dHJpYnV0ZShSRURFRklORURfQVRU\nUklCVVRFKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9tYW5hZ2Vk\nVHlwZS5hZGRBdHRyaWJ1dGUoUkVERUZJTkVEX0FUVFJJQlVURSk7CiAgICAg\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgX2lzQWxyZWFk\neVJlZGVmaW5lZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgICAgICBQ\nQ1N1YmNsYXNzVmFsaWRhdG9yIHZhbCA9IG5ldyBQQ1N1YmNsYXNzVmFsaWRh\ndG9yKAogICAgICAgICAgICAgICAgICAgIF9tZXRhLCBfbWFuYWdlZFR5cGUs\nIF9sb2csIF9mYWlsKTsKICAgICAgICAgICAgICAgIHZhbC5hc3NlcnRDYW5T\ndWJjbGFzcygpOwoKICAgICAgICAgICAgICAgIF9wYyA9IF9tYW5hZ2VkVHlw\nZS5nZXRQcm9qZWN0KCkubG9hZENsYXNzKAogICAgICAgICAgICAgICAgICAg\nIHRvUENTdWJjbGFzc05hbWUoX21hbmFnZWRUeXBlLmdldFR5cGUoKSkpOwog\nICAgICAgICAgICAgICAgaWYgKF9wYy5nZXRTdXBlcmNsYXNzQkMoKSAhPSBf\nbWFuYWdlZFR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBfcGMuc2V0U3Vw\nZXJjbGFzcyhfbWFuYWdlZFR5cGUpOwogICAgICAgICAgICAgICAgICAgIF9w\nYy5zZXRBYnN0cmFjdChfbWFuYWdlZFR5cGUuaXNBYnN0cmFjdCgpKTsKICAg\nICAgICAgICAgICAgICAgICBfcGMuZGVjbGFyZUludGVyZmFjZShEeW5hbWlj\nUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzKTsKICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX2lzQWxyZWFkeVN1YmNsYXNz\nZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgX3BjID0gX21hbmFnZWRUeXBlOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBfYmNzQ29uZmlndXJlZCA9IHRydWU7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIGdl\nbmVyYXRlZCBieXRlY29kZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgcmVj\nb3JkKCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlm\nIChfbWFuYWdlZFR5cGUgIT0gX3BjICYmIGdldFJlZGVmaW5lKCkpCiAgICAg\nICAgICAgIHJlY29yZChfbWFuYWdlZFR5cGUpOwogICAgICAgIHJlY29yZChf\ncGMpOwogICAgICAgIGlmIChfb2lkcyAhPSBudWxsKQogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IF9vaWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KQogICAgICAgICAgICAgICAgcmVjb3JkKChCQ0NsYXNzKSBpdHIu\nbmV4dCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIHRoZSBnaXZl\nbiBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlY29yZChCQ0Ns\nYXNzIGJjKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKF93cml0ZXIgIT0gbnVsbCkKICAgICAgICAgICAgX3dyaXRlci53cml0\nZShiYyk7CiAgICAgICAgZWxzZSBpZiAoX2RpciA9PSBudWxsKQogICAgICAg\nICAgICBiYy53cml0ZSgpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBG\naWxlIGRpciA9IEZpbGVzLmdldFBhY2thZ2VGaWxlKF9kaXIsIGJjLmdldFBh\nY2thZ2VOYW1lKCksIHRydWUpOwogICAgICAgICAgICBiYy53cml0ZShuZXcg\nRmlsZShkaXIsIGJjLmdldENsYXNzTmFtZSgpICsgIi5jbGFzcyIpKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSB0aGF0IHRo\nZSBtZXRob2RzIGluIHRoaXMgcHJvcGVydHktYWNjZXNzIGluc3RhbmNlIGFy\nZQogICAgICogd3JpdHRlbiBjb3JyZWN0bHkuIFRoaXMgbWV0aG9kIGFsc28g\nZ2F0aGVycyBpbmZvcm1hdGlvbiBvbiBlYWNoCiAgICAgKiBwcm9wZXJ0eSdz\nIGJhY2tpbmcgZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxp\nZGF0ZVByb3BlcnRpZXMoKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZt\nZHM7CiAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpCiAgICAgICAg\nICAgIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIGZtZHMgPSBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwog\nICAgICAgIE1ldGhvZCBtZXRoOwogICAgICAgIEJDTWV0aG9kIGdldHRlciwg\nc2V0dGVyOwogICAgICAgIEJDRmllbGQgcmV0dXJuZWQsIGFzc2lnbmVkID0g\nbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgaWYgKCEoZm1kc1tpXS5nZXRCYWNraW5n\nTWVtYmVyKCkgaW5zdGFuY2VvZiBNZXRob2QpKSB7CiAgICAgICAgICAgICAg\nICBhZGRWaW9sYXRpb24oInByb3BlcnR5LWJhZC1tZW1iZXIiLAogICAgICAg\nICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgZm1kc1tpXSwgZm1kc1tpXS5n\nZXRCYWNraW5nTWVtYmVyKCkgfSwKICAgICAgICAgICAgICAgICAgICB0cnVl\nKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBtZXRoID0gKE1ldGhvZCkgZm1kc1tpXS5nZXRCYWNraW5n\nTWVtYmVyKCk7CiAgICAgICAgICAgIC8vICMjIyMjIHRoaXMgd2lsbCBmYWls\nIGlmIHdlIG92ZXJyaWRlIGFuZCBkb24ndCBjYWxsIHN1cGVyLgogICAgICAg\nICAgICBCQ0NsYXNzIGRlY2xhcmluZ1R5cGUgPSBfbWFuYWdlZFR5cGUuZ2V0\nUHJvamVjdCgpCiAgICAgICAgICAgICAgICAubG9hZENsYXNzKGZtZHNbaV0u\nZ2V0RGVjbGFyaW5nVHlwZSgpKTsKICAgICAgICAgICAgZ2V0dGVyID0gZGVj\nbGFyaW5nVHlwZS5nZXREZWNsYXJlZE1ldGhvZChtZXRoLmdldE5hbWUoKSwK\nICAgICAgICAgICAgICAgIG1ldGguZ2V0UGFyYW1ldGVyVHlwZXMoKSk7CiAg\nICAgICAgICAgIGlmIChnZXR0ZXIgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1uby1nZXR0ZXIiLCBuZXcgT2Jq\nZWN0W117IGZtZHNbaV0gfSwKICAgICAgICAgICAgICAgICAgICB0cnVlKTsK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybmVkID0gZ2V0UmV0dXJuZWRGaWVsZChnZXR0ZXIpOwog\nICAgICAgICAgICBpZiAocmV0dXJuZWQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJlZ2lzdGVyQmFja2luZ0ZpZWxkSW5mbyhmbWRzW2ldLCBnZXR0ZXIs\nIHJldHVybmVkKTsKCiAgICAgICAgICAgIHNldHRlciA9IGRlY2xhcmluZ1R5\ncGUuZ2V0RGVjbGFyZWRNZXRob2QoZ2V0U2V0dGVyTmFtZShmbWRzW2ldKSwK\nICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBmbWRzW2ldLmdldERlY2xh\ncmVkVHlwZSgpIH0pOwogICAgICAgICAgICBpZiAoc2V0dGVyID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGlmIChyZXR1cm5lZCA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1uby1z\nZXR0ZXIiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117\nIGZtZHNbaV0gfSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFnZXRSZWRlZmluZSgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIHN5bnRoZXRpYyBz\nZXR0ZXIKICAgICAgICAgICAgICAgICAgICBzZXR0ZXIgPSBfbWFuYWdlZFR5\ncGUuZGVjbGFyZU1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZHNbaV0pLAogICAg\nICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsg\nZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICAgICAgICAg\nICAgICBzZXR0ZXIubWFrZVByaXZhdGUoKTsKICAgICAgICAgICAgICAgICAg\nICBDb2RlIGNvZGUgPSBzZXR0ZXIuZ2V0Q29kZSh0cnVlKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQocmV0dXJuZWQp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\nc2V0dGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBhc3NpZ25lZCA9IGdl\ndEFzc2lnbmVkRmllbGQoc2V0dGVyKTsKCiAgICAgICAgICAgIGlmIChhc3Np\nZ25lZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoc2V0dGVyICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJCYWNraW5nRmll\nbGRJbmZvKGZtZHNbaV0sIHNldHRlciwgYXNzaWduZWQpOwoKICAgICAgICAg\nICAgICAgIGlmIChhc3NpZ25lZCAhPSByZXR1cm5lZCkKICAgICAgICAgICAg\nICAgICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LXNldHRlci1nZXR0ZXIt\nbWlzbWF0Y2giLCBuZXcgT2JqZWN0W10KICAgICAgICAgICAgICAgICAgICAg\nICAgeyBmbWRzW2ldLCBhc3NpZ25lZC5nZXROYW1lKCksIChyZXR1cm5lZCA9\nPSBudWxsKSAKICAgICAgICAgICAgICAgICAgICAgICAgPyBudWxsIDogcmV0\ndXJuZWQuZ2V0TmFtZSgpIH0sIGZhbHNlKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcmVnaXN0ZXJCYWNraW5n\nRmllbGRJbmZvKEZpZWxkTWV0YURhdGEgZm1kLCBCQ01ldGhvZCBtZXRob2Qs\nCiAgICAgICAgQkNGaWVsZCBmaWVsZCkgewogICAgICAgIGlmIChfYmFja2lu\nZ0ZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICBfYmFja2luZ0ZpZWxkcyA9\nIG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2JhY2tpbmdGaWVsZHMucHV0KG1l\ndGhvZC5nZXROYW1lKCksIGZpZWxkLmdldE5hbWUoKSk7CgogICAgICAgIGlm\nIChfYXR0cnNUb0ZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICBfYXR0cnNU\nb0ZpZWxkcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2F0dHJzVG9GaWVs\nZHMucHV0KGZtZC5nZXROYW1lKCksIGZpZWxkLmdldE5hbWUoKSk7CgogICAg\nICAgIGlmIChfZmllbGRzVG9BdHRycyA9PSBudWxsKQogICAgICAgICAgICBf\nZmllbGRzVG9BdHRycyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2ZpZWxk\nc1RvQXR0cnMucHV0KGZpZWxkLmdldE5hbWUoKSwgZm1kLmdldE5hbWUoKSk7\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGFkZEF0dHJpYnV0ZVRyYW5zbGF0\naW9uKCkgewogICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNlKEF0dHJpYnV0\nZVRyYW5zbGF0b3IuY2xhc3MpOwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9\nIF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJBdHRyaWJ1dGVJbmRleFRvRmll\nbGROYW1lIiwKICAgICAgICAgICAgU3RyaW5nLmNsYXNzLCBuZXcgQ2xhc3Nb\nXSB7IGludC5jbGFzcyB9KTsKICAgICAgICBtZXRob2QubWFrZVB1YmxpYygp\nOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoK\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxk\ncygpOwoKICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAgICAgICBjb2RlLmls\nb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgVGFibGVTd2l0Y2hJbnN0cnVj\ndGlvbiB0YWJpbnMgPSBjb2RlLnRhYmxlc3dpdGNoKCk7CiAgICAgICAgdGFi\naW5zLnNldExvdygwKTsKICAgICAgICB0YWJpbnMuc2V0SGlnaChmbWRzLmxl\nbmd0aCAtIDEpOwoKICAgICAgICAvLyBjYXNlIGk6CiAgICAgICAgLy8gICAg\nIHJldHVybiA8X2F0dHJzVG9GaWVsZHMuZ2V0KGZtZHNbaV0uZ2V0TmFtZSgp\nKT4KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgdGFiaW5zLmFkZFRhcmdldChjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoCiAgICAgICAgICAgICAgICBfYXR0cnNUb0ZpZWxk\ncy5nZXQoZm1kc1tpXS5nZXROYW1lKCkpKSk7CiAgICAgICAgICAgIGNvZGUu\nYXJldHVybigpOwogICAgICAgIH0KCiAgICAgICAgLy8gZGVmYXVsdDogdGhy\nb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAgIHRh\nYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0aW9uCiAgICAgICAg\nICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpKTsK\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIHNldHRlciBtZXRob2QgZm9yIHRo\nZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgU3Ry\naW5nIGdldFNldHRlck5hbWUoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAg\nICByZXR1cm4gInNldCIgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZtZC5n\nZXROYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBm\naWVsZCByZXR1cm5lZCBieSB0aGUgZ2l2ZW4gbWV0aG9kLCBvciBudWxsIGlm\nIG5vbmUuCiAgICAgKiBQYWNrYWdlLXByb3RlY3RlZCBhbmQgc3RhdGljIGZv\nciB0ZXN0aW5nLgogICAgICovCiAgICBzdGF0aWMgQkNGaWVsZCBnZXRSZXR1\ncm5lZEZpZWxkKEJDTWV0aG9kIG1ldGgpIHsKICAgICAgICByZXR1cm4gZmlu\nZEZpZWxkKG1ldGgsICgoQ29kZSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rp\nb24oKSkpLnhyZXR1cm4oKQogICAgICAgICAgICAuc2V0VHlwZShtZXRoLmdl\ndFJldHVyblR5cGUoKSksIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgZmllbGQgYXNzaWduZWQgaW4gdGhlIGdpdmVuIG1ldGhv\nZCwgb3IgbnVsbCBpZiBub25lLgogICAgICogUGFja2FnZS1wcm90ZWN0ZWQg\nYW5kIHN0YXRpYyBmb3IgdGVzdGluZy4KICAgICAqLwogICAgc3RhdGljIEJD\nRmllbGQgZ2V0QXNzaWduZWRGaWVsZChCQ01ldGhvZCBtZXRoKSB7CiAgICAg\nICAgcmV0dXJuIGZpbmRGaWVsZChtZXRoLCAoKENvZGUpIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5uZXdDb2RlQWN0aW9uKCkpKS5wdXRmaWVsZCgpLCB0cnVlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZmllbGQgcmV0dXJuZWQgLyBh\nc3NpZ25lZCBieSA8Y29kZT5tZXRoPC9jb2RlPi4gUmV0dXJucwogICAgICog\nbnVsbCBpZiBub24tZmllbGRzIChtZXRob2RzLCBsaXRlcmFscywgcGFyYW1l\ndGVycywgdmFyaWFibGVzKSBhcmUKICAgICAqIHJldHVybmVkLCBvciBpZiBu\nb24tcGFyYW1ldGVycyBhcmUgYXNzaWduZWQgdG8gZmllbGRzLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBCQ0ZpZWxkIGZpbmRGaWVsZChCQ01ldGhv\nZCBtZXRoLCBJbnN0cnVjdGlvbiB0ZW1wbGF0ZSwKICAgICAgICBib29sZWFu\nIGZpbmRBY2Nlc3NlZCkgewogICAgICAgIC8vIGlnbm9yZSBhbnkgc3RhdGlj\nIG1ldGhvZHMuIE9wZW5KUEEgb25seSBjdXJyZW50bHkgc3VwcG9ydHMKICAg\nICAgICAvLyBub24tc3RhdGljIHNldHRlcnMgYW5kIGdldHRlcnMKICAgICAg\nICBpZiAobWV0aC5pc1N0YXRpYygpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKGZhbHNlKTsK\nICAgICAgICBpZiAoY29kZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIEJD\nRmllbGQgZmllbGQgPSBudWxsLCBjdXI7CiAgICAgICAgSW5zdHJ1Y3Rpb24g\ndGVtcGxhdGVJbnMsIHByZXZJbnMsIGVhcmxpZXJJbnM7CiAgICAgICAgd2hp\nbGUgKGNvZGUuc2VhcmNoRm9yd2FyZCh0ZW1wbGF0ZSkpIHsKICAgICAgICAg\nICAgaW50IGJhY2t1cENvdW50ID0gMzsKICAgICAgICAgICAgdGVtcGxhdGVJ\nbnMgPSBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAgICAgIGlmICghY29kZS5o\nYXNQcmV2aW91cygpKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgICAgIHByZXZJbnMgPSBjb2RlLnByZXZpb3VzKCk7CgogICAgICAg\nICAgICBpZiAocHJldklucyBpbnN0YW5jZW9mIENsYXNzSW5zdHJ1Y3Rpb24K\nICAgICAgICAgICAgICAgICYmIGNvZGUuaGFzUHJldmlvdXMoKSkgewogICAg\nICAgICAgICAgICAgcHJldklucyA9IGNvZGUucHJldmlvdXMoKTsKICAgICAg\nICAgICAgICAgIGJhY2t1cENvdW50Kys7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGlmICghY29kZS5oYXNQcmV2aW91cygpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGVhcmxpZXJJbnMgPSBjb2Rl\nLnByZXZpb3VzKCk7CgogICAgICAgICAgICAvLyBpZiB0aGUgb3Bjb2RlIHR3\nbyBiZWZvcmUgdGhlIHRlbXBsYXRlIHdhcyBhbiBhbG9hZF8wLCBjaGVjawog\nICAgICAgICAgICAvLyBhZ2FpbnN0IHRoZSBtaWRkbGUgaW5zdHJ1Y3Rpb24g\nYmFzZWQgb24gd2hhdCB0eXBlIG9mIGZpbmQKICAgICAgICAgICAgLy8gd2Un\ncmUgZG9pbmcKICAgICAgICAgICAgaWYgKCEoZWFybGllcklucyBpbnN0YW5j\nZW9mIExvYWRJbnN0cnVjdGlvbikKICAgICAgICAgICAgICAgIHx8ICEoKExv\nYWRJbnN0cnVjdGlvbikgZWFybGllcklucykuaXNUaGlzKCkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBt\naWRkbGUgaW5zdHJ1Y3Rpb24gd2FzIGEgZ2V0ZmllbGQsIHRoZW4gaXQncyB0\naGUKICAgICAgICAgICAgLy8gZmllbGQgdGhhdCdzIGJlaW5nIGFjY2Vzc2Vk\nCiAgICAgICAgICAgIGlmICghZmluZEFjY2Vzc2VkICYmIHByZXZJbnMgaW5z\ndGFuY2VvZiBHZXRGaWVsZEluc3RydWN0aW9uKSB7CiAgICAgICAgICAgICAg\nICBmaW5hbCBGaWVsZEluc3RydWN0aW9uIGZQcmV2SW5zID0gKEZpZWxkSW5z\ndHJ1Y3Rpb24pIHByZXZJbnM7CiAgICAgICAgICAgICAgICBjdXIgPSAoQkNG\naWVsZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RmllbGRJbnN0cnVjdGlv\nbkZpZWxkQWN0aW9uKGZQcmV2SW5zKSk7CiAgICAgICAgICAgICAgICAvLyBp\nZiB0aGUgbWlkZGxlIGluc3RydWN0aW9uIHdhcyBhbiB4bG9hZF8xLCB0aGVu\nIHRoZQogICAgICAgICAgICAgICAgLy8gbWF0Y2hlZCBpbnN0cnVjdGlvbiBp\ncyB0aGUgZmllbGQgdGhhdCdzIGJlaW5nIHNldC4KICAgICAgICAgICAgfSBl\nbHNlIGlmIChmaW5kQWNjZXNzZWQgJiYgcHJldklucyBpbnN0YW5jZW9mIExv\nYWRJbnN0cnVjdGlvbgogICAgICAgICAgICAgICAgJiYgKChMb2FkSW5zdHJ1\nY3Rpb24pIHByZXZJbnMpLmdldFBhcmFtKCkgPT0gMCkgewogICAgICAgICAg\nICAgICAgZmluYWwgRmllbGRJbnN0cnVjdGlvbiBmVGVtcGxhdGVJbnMgPQog\nICAgICAgICAgICAgICAgICAgIChGaWVsZEluc3RydWN0aW9uKSB0ZW1wbGF0\nZUluczsKICAgICAgICAgICAgICAgIGN1ciA9IChCQ0ZpZWxkKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAg\nICAgICAgICAgICAgIC5nZXRGaWVsZEluc3RydWN0aW9uRmllbGRBY3Rpb24o\nZlRlbXBsYXRlSW5zKSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICBpZiAoZmllbGQgIT0g\nbnVsbCAmJiBjdXIgIT0gZmllbGQpCiAgICAgICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICAgICAgZmllbGQgPSBjdXI7CgogICAgICAgICAgICAv\nLyByZWFkeSBmb3IgbmV4dCBzZWFyY2ggaXRlcmF0aW9uCiAgICAgICAgICAg\nIHdoaWxlIChiYWNrdXBDb3VudCA+IDApIHsKICAgICAgICAgICAgICAgIGNv\nZGUubmV4dCgpOwogICAgICAgICAgICAgICAgYmFja3VwQ291bnQtLTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmllbGQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgYSB2aW9sYXRpb24gb2YgdGhl\nIHByb3BlcnR5IGFjY2VzcyByZXN0cmljdGlvbnMuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRWaW9sYXRpb24oU3RyaW5nIGtleSwgT2JqZWN0W10g\nYXJncywgYm9vbGVhbiBmYXRhbCkgewogICAgICAgIGlmIChfdmlvbGF0aW9u\ncyA9PSBudWxsKQogICAgICAgICAgICBfdmlvbGF0aW9ucyA9IG5ldyBIYXNo\nU2V0KCk7CiAgICAgICAgX3Zpb2xhdGlvbnMuYWRkKF9sb2MuZ2V0KGtleSwg\nYXJncykpOwogICAgICAgIF9mYWlsIHw9IGZhdGFsOwogICAgfQoKICAgIC8q\nKgogICAgICogTG9nIC8gdGhyb3cgcmVjb3JkZWQgcHJvcGVydHkgYWNjZXNz\nIHZpb2xhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwcm9jZXNz\nVmlvbGF0aW9ucygpIHsKICAgICAgICBpZiAoX3Zpb2xhdGlvbnMgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBTdHJpbmcgc2VwID0g\nSjJEb1ByaXZIZWxwZXIuZ2V0TGluZVNlcGFyYXRvcigpOwogICAgICAgIFN0\ncmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBfdmlvbGF0aW9ucy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBidWYuYXBwZW5kKGl0ci5u\nZXh0KCkpOwogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoc2VwKTsKICAgICAgICB9CiAgICAgICAg\nTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgicHJvcGVydHktdmlvbGF0aW9ucyIs\nIGJ1Zik7CgogICAgICAgIGlmIChfZmFpbCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24obXNnKTsKICAgICAgICBpZiAoX2xvZy5pc1dh\ncm5FbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cud2Fybihtc2cpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVwbGFjZWQgYWxsIGRpcmVjdCBhY2Nlc3Mg\ndG8gbWFuYWdlZCBmaWVsZHMgd2l0aCB0aGUgYXBwcm9wcmlhdGUKICAgICAq\nIHBjR2V0L3BjU2V0IG1ldGhvZC4gTm90ZSB0aGF0IHRoaXMgaW5jbHVkZXMg\nYWNjZXNzIHRvIGZpZWxkcwogICAgICogb3duZWQgYnkgUGVyc2lzdGVuY2VD\nYXBhYmxlIGNsYXNzZXMgb3RoZXIgdGhhbiB0aGlzIG9uZS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNz\nKCkgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\nY3JlYXRlIHRlbXBsYXRlIHB1dGZpZWxkL2dldGZpZWxkIGluc3RydWN0aW9u\ncyB0byBzZWFyY2ggZm9yCiAgICAgICAgQ29kZSB0ZW1wbGF0ZSA9IChDb2Rl\nKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKTsKICAgICAgICBJbnN0\ncnVjdGlvbiBwdXQgPSB0ZW1wbGF0ZS5wdXRmaWVsZCgpOwogICAgICAgIElu\nc3RydWN0aW9uIGdldCA9IHRlbXBsYXRlLmdldGZpZWxkKCk7CiAgICAgICAg\nSW5zdHJ1Y3Rpb24gc3RhdCA9IHRlbXBsYXRlLmludm9rZXN0YXRpYygpOwoK\nICAgICAgICAvLyBsb29rIHRocm91Z2ggYWxsIG1ldGhvZHM7IHRoaXMgaXMg\nZG9uZSBiZWZvcmUgYW55IG1ldGhvZHMgYXJlIGFkZGVkCiAgICAgICAgLy8g\nc28gd2UgZG9uJ3QgbmVlZCB0byB3b3JyeSBhYm91dCBleGNsdWRpbmcgc3lu\ndGhldGljIG1ldGhvZHMuCiAgICAgICAgQkNNZXRob2RbXSBtZXRob2RzID0g\nX21hbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kcygpOwogICAgICAgIENv\nZGUgY29kZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1ldGhvZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29kZSA9IG1ldGhvZHNbaV0u\nZ2V0Q29kZShmYWxzZSk7CgogICAgICAgICAgICAvLyBkb24ndCBtb2RpZnkg\ndGhlIG1ldGhvZHMgc3BlY2lmaWVkIGJ5IHRoZSBhdXhpbGlhcnkgZW5oYW5j\nZXJzCiAgICAgICAgICAgIGlmIChjb2RlICE9IG51bGwgJiYgIXNraXBFbmhh\nbmNlKG1ldGhvZHNbaV0pKSB7CiAgICAgICAgICAgICAgICByZXBsYWNlQW5k\nVmFsaWRhdGVGaWVsZEFjY2Vzcyhjb2RlLCBnZXQsIHRydWUsIHN0YXQpOwog\nICAgICAgICAgICAgICAgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3Mo\nY29kZSwgcHV0LCBmYWxzZSwgc3RhdCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlcyBhbGwgaW5zdHJ1\nY3Rpb25zIG1hdGNoaW5nIHRoZSBnaXZlbiB0ZW1wbGF0ZSBpbiB0aGUgZ2l2\nZW4KICAgICAqIGNvZGUgYmxvY2sgd2l0aCBjYWxscyB0byB0aGUgYXBwcm9w\ncmlhdGUgZ2VuZXJhdGVkIGdldHRlci9zZXR0ZXIuCiAgICAgKgogICAgICog\nQHBhcmFtIGNvZGUgdGhlIGNvZGUgYmxvY2sgdG8gbW9kaWZ5OyB0aGUgY29k\nZSBpdGVyYXRvciB3aWxsCiAgICAgKiBiZSBwbGFjZWQgYmVmb3JlIHRoZSBm\naXJzdCBpbnN0cnVjdGlvbiBvbiBtZXRob2Qgc3RhcnQsCiAgICAgKiBhbmQg\nd2lsbCBiZSBhZnRlciB0aGUgbGFzdCBpbnN0cnVjdGlvbiBvbiBtZXRob2Qg\nY29tcGxldGlvbgogICAgICogQHBhcmFtIGlucyB0aGUgdGVtcGxhdGUgaW5z\ndHJ1Y3Rpb24gdG8gc2VhcmNoIGZvcjsgZWl0aGVyIGEKICAgICAqIGdldGZp\nZWxkIG9yIHB1dGZpZWxkIGluc3RydWN0aW9uCiAgICAgKiBAcGFyYW0gZ2V0\nIGJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGlzIGlzIGEgZ2V0IGluc3RydWN0\naW9uCiAgICAgKiBAcGFyYW0gc3RhdCB0ZW1wbGF0ZSBpbnZva2VzdGF0aWMg\naW5zdHJ1Y3Rpb24gdG8gcmVwbGFjZSB3aXRoCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2VzcyhDb2RlIGNv\nZGUsIEluc3RydWN0aW9uIGlucywKICAgICAgICBib29sZWFuIGdldCwgSW5z\ndHJ1Y3Rpb24gc3RhdCkgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwoKICAgICAgICBGaWVsZElu\nc3RydWN0aW9uIGZpOwogICAgICAgIE1ldGhvZEluc3RydWN0aW9uIG1pOwog\nICAgICAgIENsYXNzTWV0YURhdGEgb3duZXI7CiAgICAgICAgU3RyaW5nIG5h\nbWUsIHR5cGVOYW1lLCBtZXRob2ROYW1lOwogICAgICAgIHdoaWxlIChjb2Rl\nLnNlYXJjaEZvcndhcmQoaW5zKSkgewogICAgICAgICAgICAvLyBiYWNrIHVw\nIHRvIHRoZSBtYXRjaGVkIGluc3RydWN0aW9uCiAgICAgICAgICAgIGZpID0g\nKEZpZWxkSW5zdHJ1Y3Rpb24pIGNvZGUucHJldmlvdXMoKTsKICAgICAgICAg\nICAgbmFtZSA9IGZpLmdldEZpZWxkTmFtZSgpOwogICAgICAgICAgICB0eXBl\nTmFtZSA9IGZpLmdldEZpZWxkVHlwZU5hbWUoKTsKICAgICAgICAgICAgb3du\nZXIgPSBnZXRQZXJzaXN0ZW5jZUNhcGFibGVPd25lcihuYW1lLCBmaS5nZXRG\naWVsZERlY2xhcmVyVHlwZSgpKTsKCiAgICAgICAgICAgIGlmIChvd25lciAh\nPSBudWxsCiAgICAgICAgICAgICAgICAmJiBvd25lci5nZXRBY2Nlc3NUeXBl\nKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVSVFkpIHsKICAgICAg\nICAgICAgICAgIC8vIGlmIHdlJ3JlIGRpcmVjdGx5IGFjY2Vzc2luZyBhIGZp\nZWxkIGluIGFub3RoZXIgY2xhc3MKICAgICAgICAgICAgICAgIC8vIGhpZXJh\ncmNoeSB0aGF0IHVzZXMgcHJvcGVydHkgYWNjZXNzLCBzb21ldGhpbmcgaXMg\nd3JvbmcKICAgICAgICAgICAgICAgIGlmIChvd25lciAhPSBfbWV0YSAmJiBv\nd25lci5nZXREZWNsYXJlZEZpZWxkKG5hbWUpICE9IG51bGwgJiYKICAgICAg\nICAgICAgICAgICAgICBfbWV0YSAhPSBudWxsICYmICFvd25lci5nZXREZXNj\ncmliZWRUeXBlKCkKICAgICAgICAgICAgICAgICAgICAgICAgLmlzQXNzaWdu\nYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\ncHJvcGVydHktZmllbGQtYWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBfbWV0YSwgb3duZXIsIG5hbWUsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjb2RlLmdldE1ldGhvZCgpLmdldE5hbWUo\nKSB9KSk7CgogICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgZGlyZWN0bHkg\nYWNjZXNzaW5nIGEgcHJvcGVydHktYmFja2luZyBmaWVsZCBvdXRzaWRlCiAg\nICAgICAgICAgICAgICAvLyB0aGUgcHJvcGVydHkgaW4gb3VyIG93biBjbGFz\ncywgbm90aWZ5IHVzZXIKICAgICAgICAgICAgICAgIGlmIChpc0JhY2tpbmdG\naWVsZE9mQW5vdGhlclByb3BlcnR5KG5hbWUsIGNvZGUpKQogICAgICAgICAg\nICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktZmllbGQtYWNjZXNz\nIiwgbmV3IE9iamVjdFtdeyBfbWV0YSwKICAgICAgICAgICAgICAgICAgICAg\nICAgb3duZXIsIG5hbWUsIGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgpIH0s\nIGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG93bmVy\nID09IG51bGwgfHwKICAgICAgICAgICAgICAgIG93bmVyLmdldERlY2xhcmVk\nRmllbGQoZnJvbUJhY2tpbmdGaWVsZE5hbWUobmFtZSkpID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIC8vIG5vdCBwZXJzaXN0ZW50IGZpZWxkPwogICAg\nICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICghZ2V0UmVkZWZpbmUoKSAm\nJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKQogICAgICAgICAgICAgICAgJiYgb3du\nZXIuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJ\nRUxEKSB7CiAgICAgICAgICAgICAgICAvLyByZXBsYWNlIHRoZSBpbnN0cnVj\ndGlvbiB3aXRoIGEgY2FsbCB0byB0aGUgZ2VuZXJhdGVkIGFjY2VzcwogICAg\nICAgICAgICAgICAgLy8gbWV0aG9kCiAgICAgICAgICAgICAgICBtaSA9IChN\nZXRob2RJbnN0cnVjdGlvbikgY29kZS5zZXQoc3RhdCk7CgogICAgICAgICAg\nICAgICAgLy8gaW52b2tlIHRoZSBwcm9wZXIgYWNjZXNzIG1ldGhvZCwgd2hl\ndGhlciBnZXR0ZXIgb3Igc2V0dGVyCiAgICAgICAgICAgICAgICBTdHJpbmcg\ncHJlZml4ID0gKGdldCkgPyBQUkUgKyAiR2V0IiA6IFBSRSArICJTZXQiOwog\nICAgICAgICAgICAgICAgbWV0aG9kTmFtZSA9IHByZWZpeCArIG5hbWU7CiAg\nICAgICAgICAgICAgICBpZiAoZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAg\nbWkuc2V0TWV0aG9kKGdldFR5cGUob3duZXIpLmdldE5hbWUoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZSwgdHlwZU5hbWUsIG5ldyBT\ndHJpbmdbXQogICAgICAgICAgICAgICAgICAgICAgICB7IGdldFR5cGUob3du\nZXIpLmdldE5hbWUoKSB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICAgICAgbWkuc2V0TWV0aG9kKGdldFR5cGUob3duZXIp\nLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFt\nZSwgInZvaWQiLCBuZXcgU3RyaW5nW10KICAgICAgICAgICAgICAgICAgICAg\nICAgeyBnZXRUeXBlKG93bmVyKS5nZXROYW1lKCksIHR5cGVOYW1lIH0pOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2V0UmVkZWZpbmUoKSkgewogICAg\nICAgICAgICAgICAgbmFtZSA9IGZyb21CYWNraW5nRmllbGROYW1lKG5hbWUp\nOwogICAgICAgICAgICAgICAgaWYgKGdldCkgewogICAgICAgICAgICAgICAg\nICAgIGFkZE5vdGlmeUFjY2Vzcyhjb2RlLCBvd25lci5nZXRGaWVsZChuYW1l\nKSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIGluc2Vy\ndCB0aGUgc2V0IG9wZXJhdGlvbnMgYWZ0ZXIgdGhlIGZpZWxkIG11dGF0aW9u\nLCBidXQKICAgICAgICAgICAgICAgICAgICAvLyBmaXJzdCBsb2FkIHRoZSBv\nbGQgdmFsdWUgZm9yIHVzZSBpbiB0aGUKICAgICAgICAgICAgICAgICAgICAv\nLyBTdGF0ZU1hbmFnZXIuc2V0dGluZ1hYWCBtZXRob2QuCiAgICAgICAgICAg\nICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAg\nICAgICAgICAgICAgICAgICAgZmluYWwgRmllbGRJbnN0cnVjdGlvbiBmRmkg\nPSBmaTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoCiAgICAgICAgICAgICAgICAgICAgICAgIChCQ0ZpZWxkKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgLmdldEZpZWxkSW5zdHJ1Y3Rpb25G\naWVsZEFjdGlvbihmRmkpKSk7CiAgICAgICAgICAgICAgICAgICAgaW50IHZh\nbCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS54c3RvcmUoKS5zZXRMb2NhbCh2YWwpLnNldFR5cGUoZmku\nZ2V0RmllbGRUeXBlKCkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBtb3Zl\nIHBhc3QgdGhlIHB1dGZpZWxkCiAgICAgICAgICAgICAgICAgICAgY29kZS5u\nZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgYWRkTm90aWZ5TXV0YXRpb24o\nY29kZSwgb3duZXIuZ2V0RmllbGQobmFtZSksIHZhbCwgLTEpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIHZvaWQgYWRkTm90aWZ5QWNjZXNzKENvZGUgY29kZSwgRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgICAgICAvLyBQQ0hlbHBlci5hY2Nlc3NpbmdGaWVsZCh0\naGlzLCA8YWJzb2x1dGUtaW5kZXg+KTsKICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShm\nbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5z\nZXRNZXRob2QoUmVkZWZpbml0aW9uSGVscGVyLmNsYXNzLAogICAgICAgICAg\nICAiYWNjZXNzaW5nRmllbGQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBu\nZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgaW50LmNsYXNzIH0pOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhpcyBtdXN0IGJlIGNhbGxlZCBhZnRlciBz\nZXR0aW5nIHRoZSB2YWx1ZSBpbiB0aGUgb2JqZWN0LgogICAgICogCiAgICAg\nKiBAcGFyYW0gY29kZQogICAgICogQHBhcmFtIHZhbCB0aGUgcG9zaXRpb24g\naW4gdGhlIGxvY2FsIHZhcmlhYmxlIHRhYmxlIHdoZXJlIHRoZQogICAgICog\nb2xkIHZhbHVlIGlzIHN0b3JlZAogICAgICogQHBhcmFtIHBhcmFtIHRoZSBw\nYXJhbWV0ZXIgcG9zaXRpb24gY29udGFpbmluZyB0aGUgbmV3IHZhbHVlLCBv\ncgogICAgICogLTEgaWYgdGhlIG5ldyB2YWx1ZSBpcyB1bmF2YWlsYWJsZSBh\nbmQgc2hvdWxkIHRoZXJlZm9yZSBiZSBsb29rZWQKICAgICAqIHVwLgogICAg\nICogQHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZE5vdGlmeU11dGF0aW9uKENvZGUgY29kZSwgRmll\nbGRNZXRhRGF0YSBmbWQsIGludCB2YWwsCiAgICAgICAgaW50IHBhcmFtKQog\nICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAg\nIC8vIFBDSGVscGVyLnNldHRpbmdGaWVsZCh0aGlzLCA8YWJzb2x1dGUtaW5k\nZXg+LCBvbGQsIG5ldyk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMo\nKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kLmdldElu\nZGV4KCkpOwogICAgICAgIENsYXNzIHR5cGUgPSBmbWQuZ2V0RGVjbGFyZWRU\neXBlKCk7CiAgICAgICAgLy8gd2Ugb25seSBoYXZlIHNwZWNpYWwgc2lnbmF0\ndXJlcyBmb3IgcHJpbWl0aXZlcyBhbmQgU3RyaW5ncwogICAgICAgIGlmICgh\ndHlwZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0gU3RyaW5nLmNsYXNzKQog\nICAgICAgICAgICB0eXBlID0gT2JqZWN0LmNsYXNzOwogICAgICAgIGNvZGUu\neGxvYWQoKS5zZXRMb2NhbCh2YWwpLnNldFR5cGUodHlwZSk7CiAgICAgICAg\naWYgKHBhcmFtID09IC0xKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBhZGRHZXRNYW5hZ2Vk\nVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKHBhcmFtKS5zZXRUeXBlKHR5\ncGUpOwogICAgICAgIH0KICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChSZWRlZmluaXRpb25IZWxwZXIuY2xhc3MsICJzZXR0aW5nRmll\nbGQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7CiAg\nICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIGludC5jbGFzcywgdHlwZSwg\ndHlwZQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRydWUgaWYgdGhlIGdpdmVuIGluc3RydWN0aW9uIGFjY2Vzc2VzIGEgZmll\nbGQgdGhhdCBpcyBhIGJhY2tpbmcKICAgICAqIGZpZWxkIG9mIGFub3RoZXIg\ncHJvcGVydHkgaW4gdGhpcyBwcm9wZXJ0eS1hY2Nlc3MgY2xhc3MuCiAgICAg\nKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0JhY2tpbmdGaWVsZE9mQW5vdGhl\nclByb3BlcnR5KFN0cmluZyBuYW1lLCBDb2RlIGNvZGUpIHsKICAgICAgICBT\ndHJpbmcgbWV0aE5hbWUgPSBjb2RlLmdldE1ldGhvZCgpLmdldE5hbWUoKTsK\nICAgICAgICByZXR1cm4gISI8aW5pdD4iLmVxdWFscyhtZXRoTmFtZSkKICAg\nICAgICAgICAgJiYgX2JhY2tpbmdGaWVsZHMgIT0gbnVsbAogICAgICAgICAg\nICAmJiAhbmFtZS5lcXVhbHMoX2JhY2tpbmdGaWVsZHMuZ2V0KG1ldGhOYW1l\nKSkKICAgICAgICAgICAgJiYgX2JhY2tpbmdGaWVsZHMuY29udGFpbnNWYWx1\nZShuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2Qg\ndG8gcmV0dXJuIHRoZSBkZWNsYXJpbmcgUGVyc2lzdGVuY2VDYXBhYmxlIGNs\nYXNzIG9mCiAgICAgKiB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKgogICAgICog\nQHBhcmFtIGZpZWxkTmFtZSB0aGUgbmFtZSBvZiB0aGUgZmllbGQKICAgICAq\nIEBwYXJhbSBvd25lciB0aGUgbm9taW5hbCBvd25lciBvZiB0aGUgZmllbGQK\nICAgICAqIEByZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgUGVyc2lzdGVu\nY2VDYXBhYmxlIHR5cGUgdGhhdAogICAgICogZGVjbGFyZXMgdGhlIGZpZWxk\nIChhbmQgdGhlcmVmb3JlIGhhcyB0aGUgc3RhdGljIG1ldGhvZCksIG9yIG51\nbGwgaWYgbm9uZQogICAgICovCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEg\nZ2V0UGVyc2lzdGVuY2VDYXBhYmxlT3duZXIoU3RyaW5nIGZpZWxkTmFtZSwK\nICAgICAgICBDbGFzcyBvd25lcikgewogICAgICAgIC8vIGZpbmQgdGhlIGFj\ndHVhbCBhbmNlc3RvciBjbGFzcyB0aGF0IGRlY2xhcmVzIHRoZSBmaWVsZCwg\ndGhlbgogICAgICAgIC8vIGNoZWNrIGlmIHRoZSBjbGFzcyBpcyBwZXJzaXN0\nZW50LCBhbmQgaWYgdGhlIGZpZWxkIGlzIG1hbmFnZWQKICAgICAgICBGaWVs\nZCBmID0gUmVmbGVjdGlvbi5maW5kRmllbGQob3duZXIsIGZpZWxkTmFtZSwg\nZmFsc2UpOwogICAgICAgIGlmIChmID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICAvLyBtYW5hZ2VkIGludGVyZmFjZQogICAg\nICAgIGlmIChfbWV0YSAhPSBudWxsICYmIF9tZXRhLmdldERlc2NyaWJlZFR5\ncGUoKS5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICByZXR1cm4gX21ldGE7\nCgogICAgICAgIHJldHVybiBfcmVwb3MuZ2V0TWV0YURhdGEoZi5nZXREZWNs\nYXJpbmdDbGFzcygpLCBudWxsLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGRzIGFsbCBzeW50aGV0aWMgbWV0aG9kcyB0byB0aGUgYnl0ZWNv\nZGUgYnkgZGVsZWdhdGluZyB0bwogICAgICogdGhlIHZhcmlvdXMgYWRkWFhY\nTWV0aG9kcyAoKSBmdW5jdGlvbnMgaW4gdGhpcyBjbGFzcy4gSW5jbHVkZXMK\nICAgICAqIGFsbCBzdGF0aWMgZmllbGQgYWNjZXNzIG1ldGhvZHMuCiAgICAg\nKiBOb3RlIHRoYXQgdGhlICdzdG9jaycgbWV0aG9kcyBsaWtlIDxjb2RlPnBj\nSXNUcmFuc2FjdGlvbmFsPC9jb2RlPiwKICAgICAqIDxjb2RlPnBjRmV0Y2hP\nYmplY3RJZDwvY29kZT4sIGV0YyBhcmUgZGVmaW5lZCBvbmx5IGluIHRoZQog\nICAgICogbGVhc3QtZGVyaXZlZCBQZXJzaXN0ZW5jZUNhcGFibGUgdHlwZS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFBDTWV0aG9kcygpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgYWRk\nQ2xlYXJGaWVsZHNNZXRob2QoKTsKICAgICAgICBhZGROZXdJbnN0YW5jZU1l\ndGhvZCh0cnVlKTsKICAgICAgICBhZGROZXdJbnN0YW5jZU1ldGhvZChmYWxz\nZSk7CiAgICAgICAgYWRkTWFuYWdlZEZpZWxkQ291bnRNZXRob2QoKTsKICAg\nICAgICBhZGRSZXBsYWNlRmllbGRzTWV0aG9kcygpOwogICAgICAgIGFkZFBy\nb3ZpZGVGaWVsZHNNZXRob2RzKCk7CiAgICAgICAgYWRkQ29weUZpZWxkc01l\ndGhvZCgpOwoKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkg\nPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAg\nIGFkZFN0b2NrTWV0aG9kcygpOwogICAgICAgICAgICBhZGRHZXRWZXJzaW9u\nTWV0aG9kKCk7CiAgICAgICAgICAgIGFkZFJlcGxhY2VTdGF0ZU1hbmFnZXJN\nZXRob2QoKTsKCiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5\ncGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAg\nICAgICAgICAgYWRkTm9PcEFwcGxpY2F0aW9uSWRlbnRpdHlNZXRob2RzKCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgdGhlIGFwcCBpZCBtZXRob2Rz\nIHRvIGVhY2ggc3ViY2xhc3MgcmF0aGVyCiAgICAgICAgLy8gdGhhbiBqdXN0\nIHRoZSBzdXBlcmNsYXNzLCBzaW5jZSBpdCBpcyBwb3NzaWJsZSB0byBoYXZl\nCiAgICAgICAgLy8gYSBzdWJjbGFzcyB3aXRoIGFuIGFwcCBpZCBoaWVyYXJj\naHkgdGhhdCBtYXRjaGVzIHRoZQogICAgICAgIC8vIHBlcnNpc3RlbnQgY2xh\nc3MgaW5oZXJpdGFuY2UgaGllcmFyY2h5CiAgICAgICAgaWYgKF9tZXRhLmdl\ndElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJ\nT04KICAgICAgICAgICAgJiYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpID09\nIG51bGwgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSB8fAogICAgICAgICAgICAg\nICAgX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgIT0KICAgICAgICAgICAgICAg\nICAgICBfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldE9iamVj\ndElkVHlwZSgpKSkgewogICAgICAgICAgICBhZGRDb3B5S2V5RmllbGRzVG9P\nYmplY3RJZE1ldGhvZCh0cnVlKTsKICAgICAgICAgICAgYWRkQ29weUtleUZp\nZWxkc1RvT2JqZWN0SWRNZXRob2QoZmFsc2UpOwogICAgICAgICAgICBhZGRD\nb3B5S2V5RmllbGRzRnJvbU9iamVjdElkTWV0aG9kKHRydWUpOwogICAgICAg\nICAgICBhZGRDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkTWV0aG9kKGZhbHNl\nKTsKICAgICAgICAgICAgYWRkTmV3T2JqZWN0SWRJbnN0YW5jZU1ldGhvZCh0\ncnVlKTsKICAgICAgICAgICAgYWRkTmV3T2JqZWN0SWRJbnN0YW5jZU1ldGhv\nZChmYWxzZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRk\nIGEgbWV0aG9kIHRvIGNsZWFyIGFsbCBwZXJzaXN0ZW50IGZpZWxkczsgd2Un\nbGwgY2FsbCB0aGlzIGZyb20KICAgICAqIHRoZSBuZXcgaW5zdGFuY2UgbWV0\naG9kIHRvIGVuc3VyZSB0aGF0IHVubG9hZGVkIGZpZWxkcyBoYXZlCiAgICAg\nKiBkZWZhdWx0IHZhbHVlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZENsZWFyRmllbGRzTWV0aG9kKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwcm90ZWN0ZWQgdm9pZCBwY0Ns\nZWFyRmllbGRzICgpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRl\nY2xhcmVNZXRob2QoUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywK\nICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgbWV0aG9kLm1ha2VQcm90ZWN0\nZWQoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgLy8gc3VwZXIucGNDbGVhckZpZWxkcyAoKQogICAgICAg\nIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRD\ncmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRUaGlzKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNl\ndE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKSksIFBSRSArICJDbGVhckZpZWxkcyIsIHZv\naWQuY2xhc3MsCiAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICB9Cgog\nICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RGVjbGFy\nZWRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFu\nYWdlbWVudCgpICE9IEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBzd2l0\nY2ggKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5JTlQ6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nMCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBEKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZM\nT0FUOgogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZSgwRik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwTCk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7\nCiAgICAgICAgfQoKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhl\nIDxjb2RlPnBjTmV3SW5zdGFuY2U8L2NvZGU+IG1ldGhvZCB0byB0aGUgYnl0\nZWNvZGUuCiAgICAgKiBUaGVzZSBtZXRob2RzIGFyZSB1c2VkIGJ5IHRoZSBp\nbXBsIGhlbHBlciB0byBjcmVhdGUgbmV3CiAgICAgKiBtYW5hZ2VkIGluc3Rh\nbmNlcyBlZmZpY2llbnRseSB3aXRob3V0IHJlZmxlY3Rpb24uCiAgICAgKgog\nICAgICogQHBhcmFtIG9pZCBzZXQgdG8gdHJ1ZSB0byBtaW1pYyB0aGUgbWV0\naG9kIHZlcnNpb24gdGhhdCB0YWtlcwogICAgICogYW4gb2lkIHZhbHVlIGFz\nIHdlbGwgYXMgYSBzdGF0ZSBtYW5hZ2VyCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBhZGROZXdJbnN0YW5jZU1ldGhvZChib29sZWFuIG9pZCkgewogICAg\nICAgIC8vIHB1YmxpYyBQZXJzaXN0ZW5jZUNhcGFibGUgcGNOZXdJbnN0YW5j\nZSAoLi4uKQogICAgICAgIENsYXNzW10gYXJncyA9CiAgICAgICAgICAgIChv\naWQpID8gbmV3IENsYXNzW117IFNNVFlQRSwgT2JqZWN0LmNsYXNzLCBib29s\nZWFuLmNsYXNzIH0KICAgICAgICAgICAgICAgIDogbmV3IENsYXNzW117IFNN\nVFlQRSwgYm9vbGVhbi5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhv\nZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJOZXdJbnN0YW5jZSIsIFBD\nVFlQRSwgYXJncyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENv\nZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIHRoZSB0eXBlIGlzIGFic3RyYWN0\nLCB0aHJvdyBhIFVzZXJFeGNlcHRpb24KICAgICAgICBpZiAoX3BjLmlzQWJz\ndHJhY3QoKSkgewogICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBV\nU0VSRVhDRVApOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAg\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgLy8gWFhYIHBjID0gbmV3IFhYWCAoKTsK\nICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKF9wYyk7CiAgICAgICAgY29k\nZS5kdXAoKTsKICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2QoIjxpbml0PiIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIGludCBp\nbnN0ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2Rl\nLmFzdG9yZSgpLnNldExvY2FsKGluc3QpOwoKICAgICAgICAvLyBpZiAoY2xl\nYXIpCiAgICAgICAgLy8gICBwYy5wY0NsZWFyRmllbGRzICgpOwogICAgICAg\nIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgob2lkKSA/IDIgOiAxKTsKICAgICAg\nICBKdW1wSW5zdHJ1Y3Rpb24gbm9jbGVhciA9IGNvZGUuaWZlcSgpOwogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkNsZWFyRmllbGRz\nIiwgdm9pZC5jbGFzcywgbnVsbCk7CgogICAgICAgIC8vIHBjLnBjU3RhdGVN\nYW5hZ2VyID0gc207CiAgICAgICAgbm9jbGVhci5zZXRUYXJnZXQoY29kZS5h\nbG9hZCgpLnNldExvY2FsKGluc3QpKTsKICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxk\nKFNNLCBTTVRZUEUpOwoKICAgICAgICAvLyBjb3B5IGtleSBmaWVsZHMgZnJv\nbSBvaWQKICAgICAgICBpZiAob2lkKSB7CiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDEpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQi\nLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9i\namVjdC5jbGFzcyB9KTsKICAgICAgICB9CgogICAgICAgIC8vIHJldHVybiBw\nYzsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW5zdCk7CiAgICAg\nICAgY29kZS5hcmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+cHJvdGVjdGVk\nIHN0YXRpYyBpbnQgcGNHZXRNYW5hZ2VkRmllbGRDb3VudCAoKTwvY29kZT4K\nICAgICAqIG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUsIHJldHVybmluZyB0aGUg\naW5oZXJpdGVkIGZpZWxkIGNvdW50IGFkZGVkCiAgICAgKiB0byB0aGUgbnVt\nYmVyIG9mIG1hbmFnZWQgZmllbGRzIGluIHRoZSBjdXJyZW50IFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZE1hbmFnZWRGaWVsZENvdW50TWV0aG9kKCkgewogICAgICAgIC8vIHByb3Rl\nY3RlZCBzdGF0aWMgaW50IHBjR2V0TWFuYWdlZEZpZWxkQ291bnQgKCkKICAg\nICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUg\nKyAiR2V0TWFuYWdlZEZpZWxkQ291bnQiLAogICAgICAgICAgICBpbnQuY2xh\nc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5zZXRTdGF0aWModHJ1ZSk7CiAg\nICAgICAgbWV0aG9kLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICBDb2RlIGNv\nZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gcmV0dXJu\nIDxmaWVsZHM+ICsgcGNJbmhlcml0ZWRGaWVsZENvdW50CiAgICAgICAgLy8g\nYXdoaXRlOiB0aGUgYWJvdmUgc2hvdWxkIHdvcmssIGJ1dCBJJ20gc2VlaW5n\nIGEgbWVzc2VkIHVwIHNpdHVhdGlvbgogICAgICAgIC8vIGFsbCBvZiBhIHN1\nZGRlbiB3aGVyZSB3aGVuIGEgc3ViY2xhc3MgY2FsbHMgdGhpcyBtZXRob2Qs\nIGl0IHNvbWVob3cKICAgICAgICAvLyBoYXBwZW5zIGJlZm9yZSA8Y2xpbml0\nPiBpcyBldmVyIGludm9rZWQsIGFuZCBzbyBvdXIKICAgICAgICAvLyBwY0lu\naGVyaXRlZEZpZWxkQ291bnQgZmllbGQgaXNuJ3QgaW5pdGlhbGl6ZWQhICBz\nbyBpbnN0ZWFkLAogICAgICAgIC8vIHJldHVybiA8ZmllbGRzPiArIDxzdXBl\ncmNsYXNzPi5wY0dldE1hbmFnZWRGaWVsZENvdW50ICgpCiAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKF9tZXRhLmdldERlY2xhcmVkRmllbGRz\nKCkubGVuZ3RoKTsKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNz\nKCkgIT0gbnVsbCkgewogICAgICAgICAgICBDbGFzcyBzdXBlckNsYXNzID0g\nZ2V0VHlwZShfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKTsKICAg\nICAgICAgICAgU3RyaW5nIHN1cGVyTmFtZSA9IGdldENyZWF0ZVN1YmNsYXNz\nKCkgPwogICAgICAgICAgICAgICAgUENFbmhhbmNlci50b1BDU3ViY2xhc3NO\nYW1lKHN1cGVyQ2xhc3MpIDoKICAgICAgICAgICAgICAgIHN1cGVyQ2xhc3Mu\nZ2V0TmFtZSgpOwogICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChzdXBlck5hbWUsCiAgICAgICAgICAgICAgICBQUkUgKyAiR2V0\nTWFuYWdlZEZpZWxkQ291bnQiLCBpbnQuY2xhc3MuZ2V0TmFtZSgpLCBudWxs\nKTsKICAgICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgfQogICAgICAg\nIGNvZGUuaXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQ\nZXJzaXN0ZW5jZUNhcGFibGUjcGNQcm92aWRlRmllbGR9IGFuZAogICAgICog\ne0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1Byb3ZpZGVGaWVsZHN9IG1l\ndGhvZHMgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkUHJvdmlkZUZpZWxkc01ldGhvZHMoKQogICAgICAgIHRocm93cyBO\nb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2b2lk\nIHBjUHJvdmlkZUZpZWxkIChpbnQgZmllbGROdW1iZXIpCiAgICAgICAgQkNN\nZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlByb3Zp\nZGVGaWVsZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1td\neyBpbnQuY2xhc3MgfSk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdl\ndENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGFkZHMgZXZlcnl0aGluZyB0aHJv\ndWdoIHRoZSBzd2l0Y2ggKCkKICAgICAgICBpbnQgcmVsTG9jYWwgPSBiZWdp\nblN3aXRjaE1ldGhvZChQUkUgKyAiUHJvdmlkZUZpZWxkIiwgY29kZSk7Cgog\nICAgICAgIC8vIGlmIG5vIGZpZWxkcyBpbiB0aGlzIGluc3QsIGp1c3QgdGhy\nb3cgZXhjZXB0aW9uCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBn\nZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAg\nICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGlm\nIChmbWRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0aHJvd0V4Y2VwdGlv\nbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpOwogICAg\nICAgIGVsc2UgewogICAgICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAgICAg\nICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJlbExvY2FsKTsKICAgICAg\nICAgICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBjb2RlLnRh\nYmxlc3dpdGNoKCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRMb3coMCk7CiAg\nICAgICAgICAgIHRhYmlucy5zZXRIaWdoKGZtZHMubGVuZ3RoIC0gMSk7Cgog\nICAgICAgICAgICAvLyA8ZmllbGQ+ID0gcGNTdGF0ZU1hbmFnZXIucHJvdmlk\nZWQ8dHlwZT5GaWVsZAogICAgICAgICAgICAvLyAgICAgKHRoaXMsIGZpZWxk\nTnVtYmVyKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YWJpbnMuYWRkVGFy\nZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAg\nICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBF\nKTsKICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpOwogICAgICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVD\nb2RlKGNvZGUsIGZtZHNbaV0pOwogICAgICAgICAgICAgICAgY29kZS5pbnZv\na2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVNYW5hZ2VyTWV0aG9k\nCiAgICAgICAgICAgICAgICAgICAgKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBl\nKCksICJwcm92aWRlZCIsIGZhbHNlLCBmYWxzZSkpOwogICAgICAgICAgICAg\nICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIGRlZmF1bHQ6IHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24gKCkKICAgICAgICAgICAgdGFiaW5zLnNldERlZmF1bHRUYXJnZXQodGhy\nb3dFeGNlcHRpb24KICAgICAgICAgICAgICAgIChjb2RlLCBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24uY2xhc3MpKTsKICAgICAgICB9CgogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwoKICAgICAgICBhZGRNdWx0aXBsZUZpZWxkc01ldGhv\nZFZlcnNpb24obWV0aG9kKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMg\ndGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlRmllbGR9\nIGFuZAogICAgICoge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1JlcGxh\nY2VGaWVsZHN9IG1ldGhvZHMgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkUmVwbGFjZUZpZWxkc01ldGhvZHMoKQogICAg\nICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8v\nIHB1YmxpYyB2b2lkIHBjUmVwbGFjZUZpZWxkIChpbnQgZmllbGROdW1iZXIp\nCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2Qo\nUFJFICsgIlJlcGxhY2VGaWVsZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAg\nIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAgQ29kZSBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGFkZHMgZXZl\ncnl0aGluZyB0aHJvdWdoIHRoZSBzd2l0Y2ggKCkKICAgICAgICBpbnQgcmVs\nTG9jYWwgPSBiZWdpblN3aXRjaE1ldGhvZChQUkUgKyAiUmVwbGFjZUZpZWxk\nIiwgY29kZSk7CgogICAgICAgIC8vIGlmIG5vIGZpZWxkcyBpbiB0aGlzIGlu\nc3QsIGp1c3QgdGhyb3cgZXhjZXB0aW9uCiAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0Rmll\nbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygp\nOwogICAgICAgIGlmIChmbWRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0\naHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24u\nY2xhc3MpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBzd2l0Y2gg\nKHZhbCkKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJlbExv\nY2FsKTsKICAgICAgICAgICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJp\nbnMgPSBjb2RlLnRhYmxlc3dpdGNoKCk7CiAgICAgICAgICAgIHRhYmlucy5z\nZXRMb3coMCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRIaWdoKGZtZHMubGVu\nZ3RoIC0gMSk7CgogICAgICAgICAgICAvLyA8ZmllbGQ+ID0gcGNTdGF0ZU1h\nbmFnZXIucmVwbGFjZTx0eXBlPkZpZWxkCiAgICAgICAgICAgIC8vICAodGhp\ncywgZmllbGROdW1iZXIpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIC8vIGZv\nciB0aGUgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZSBjYWxsIGJlbG93LgogICAg\nICAgICAgICAgICAgdGFiaW5zLmFkZFRhcmdldChsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKSk7CgogICAgICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBjb2Rl\nLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKGdldFN0\nYXRlTWFuYWdlck1ldGhvZAogICAgICAgICAgICAgICAgICAgIChmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZSgpLCAicmVwbGFjZSIsIHRydWUsIGZhbHNlKSk7\nCiAgICAgICAgICAgICAgICBpZiAoIWZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBl\nKCkuaXNQcmltaXRpdmUoKSkKICAgICAgICAgICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7\nCgogICAgICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2Rl\nLCBmbWRzW2ldKTsKICAgICAgICAgICAgICAgIGNvZGUudnJldHVybigpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBkZWZhdWx0OiB0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAgICAgICAgICAgIHRh\nYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0aW9uCiAgICAgICAg\nICAgICAgICAoY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNz\nKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAg\nICAgYWRkTXVsdGlwbGVGaWVsZHNNZXRob2RWZXJzaW9uKG1ldGhvZCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVu\nY2VDYXBhYmxlI3BjQ29weUZpZWxkc30gbWV0aG9kIHRvIHRoZSBieXRlY29k\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENvcHlGaWVsZHNNZXRo\nb2QoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewog\nICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUZpZWxkIChPYmplY3QgcGMs\nIGludCBmaWVsZCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVj\nbGFyZU1ldGhvZChQUkUgKyAiQ29weUZpZWxkIiwKICAgICAgICAgICAgdm9p\nZC5jbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgIG5ldyBTdHJpbmdbXXsg\nX21hbmFnZWRUeXBlLmdldE5hbWUoKSwgaW50LmNsYXNzLmdldE5hbWUoKSB9\nKTsKICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgpOwogICAgICAgIENv\nZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBh\nZGRzIGV2ZXJ5dGhpbmcgdGhyb3VnaCB0aGUgc3dpdGNoICgpCiAgICAgICAg\naW50IHJlbExvY2FsID0gYmVnaW5Td2l0Y2hNZXRob2QoUFJFICsgIkNvcHlG\naWVsZCIsIGNvZGUpOwoKICAgICAgICAvLyBpZiBubyBmaWVsZHMgaW4gdGhp\ncyBpbnN0LCBqdXN0IHRocm93IGV4Y2VwdGlvbgogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/IF9tZXRhLmdl\ndEZpZWxkcygpCiAgICAgICAgICAgIDogX21ldGEuZ2V0RGVjbGFyZWRGaWVs\nZHMoKTsKICAgICAgICBpZiAoZm1kcy5sZW5ndGggPT0gMCkKICAgICAgICAg\nICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0\naW9uLmNsYXNzKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gc3dp\ndGNoICh2YWwpCiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChy\nZWxMb2NhbCk7CiAgICAgICAgICAgIFRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb24g\ndGFiaW5zID0gY29kZS50YWJsZXN3aXRjaCgpOwogICAgICAgICAgICB0YWJp\nbnMuc2V0TG93KDApOwogICAgICAgICAgICB0YWJpbnMuc2V0SGlnaChmbWRz\nLmxlbmd0aCAtIDEpOwoKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAvLyA8Zmll\nbGQ+ID0gb3RoZXIuPGZpZWxkPjsKICAgICAgICAgICAgICAgIC8vIG9yIHNl\ndDxmaWVsZD4gKG90aGVyLmdldDxmaWVsZD4pOwogICAgICAgICAgICAgICAg\ndGFiaW5zLmFkZFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKSk7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\nMCk7CiAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNv\nZGUsIGZtZHNbaV0sIGZhbHNlKTsKICAgICAgICAgICAgICAgIGFkZFNldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CgogICAgICAgICAgICAg\nICAgLy8gYnJlYWs7CiAgICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGVmYXVsdDogdGhyb3cg\nbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAgICAgICB0\nYWJpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlvbgogICAgICAg\nICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFz\ncykpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAg\nICAgIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihtZXRob2QpOwog\nICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBhZGQgdGhl\nIGNvZGUgY29tbW9uIHRvIHRoZSBiZWdpbm5pbmcgb2YgYm90aCB0aGUKICAg\nICAqIHBjUmVwbGFjZUZpZWxkIG1ldGhvZCBhbmQgdGhlIHBjUHJvdmlkZUZp\nZWxkIG1ldGhvZC4gVGhpcyBpbmNsdWRlcwogICAgICogY2FsY3VsYXRpbmcg\ndGhlIHJlbGF0aXZlIGZpZWxkIG51bWJlciBvZiB0aGUgZGVzaXJlZCBmaWVs\nZCBhbmQgY2FsbGluZwogICAgICogdGhlIHN1cGVyY2xhc3MgaWYgbmVjZXNz\nYXJ5LgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGluZGV4IGluIHdoaWNo\nIHRoZSBsb2NhbCB2YXJpYWJsZSBob2xkaW5nIHRoZSByZWxhdGl2ZQogICAg\nICogZmllbGQgbnVtYmVyIGlzIHN0b3JlZAogICAgICovCiAgICBwcml2YXRl\nIGludCBiZWdpblN3aXRjaE1ldGhvZChTdHJpbmcgbmFtZSwgQ29kZSBjb2Rl\nKSB7CiAgICAgICAgYm9vbGVhbiBjb3B5ID0gKFBSRSArICJDb3B5RmllbGQi\nKS5lcXVhbHMobmFtZSk7CiAgICAgICAgaW50IGZpZWxkTnVtYmVyID0gKGNv\ncHkpID8gMSA6IDA7CgogICAgICAgIGludCByZWxMb2NhbCA9IGNvZGUuZ2V0\nTmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNs\nYXNzKCkpIHsKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKGZp\nZWxkTnVtYmVyKTsKICAgICAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2Nh\nbChyZWxMb2NhbCk7CiAgICAgICAgICAgIHJldHVybiByZWxMb2NhbDsKICAg\nICAgICB9CgogICAgICAgIC8vIGludCByZWwgPSBmaWVsZE51bWJlciAtIHBj\nSW5oZXJpdGVkRmllbGRDb3VudAogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQ\nYXJhbShmaWVsZE51bWJlcik7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5z\nZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpOwogICAgICAgIGNvZGUuaXN1\nYigpOwogICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwocmVsTG9jYWwp\nOwogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChyZWxMb2NhbCk7Cgog\nICAgICAgIC8vIHN1cGVyOiBpZiAocmVsIDwgMCkgc3VwZXIucGNSZXBsYWNl\nRmllbGQgKGZpZWxkTnVtYmVyKTsgcmV0dXJuOwogICAgICAgIC8vIG5vIHN1\ncGVyOiBpZiAocmVsIDwgMCkgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbiAoKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBj\nb2RlLmlmZ2UoKTsKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNz\nKCkgIT0gbnVsbCkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgU3RyaW5nW10gYXJnczsKICAg\nICAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgICAgICAgIGFyZ3MgPSBu\nZXcgU3RyaW5nW117IGdldFR5cGUoX21ldGEuZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKSkuCiAgICAgICAgICAgICAgICAgICAgZ2V0TmFtZSgpLCBpbnQu\nY2xhc3MuZ2V0TmFtZSgpIH07CiAgICAgICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgYXJncyA9IG5ldyBTdHJpbmdbXXsgaW50LmNsYXNzLmdldE5hbWUo\nKSB9OwogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oZmllbGRO\ndW1iZXIpOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCkpLmdldE5hbWUoKSwgbmFtZSwgCiAgICAgICAg\nICAgICAgICB2b2lkLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7CiAgICAgICAg\nICAgIGNvZGUudnJldHVybigpOwogICAgICAgIH0gZWxzZQogICAgICAgICAg\nICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24uY2xhc3MpOwoKICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3Ao\nKSk7CiAgICAgICAgcmV0dXJuIHJlbExvY2FsOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhpcyBoZWxwZXIgbWV0aG9kLCBnaXZlbiB0aGUgcGNSZXBsYWNl\nRmllbGQgb3IgcGNQcm92aWRlRmllbGQKICAgICAqIG1ldGhvZCwgYWRkcyB0\naGUgYnl0ZWNvZGUgZm9yIHRoZSBjb3JyZXNwb25kaW5nICdwbHVyYWwnIHZl\ncnNpb24KICAgICAqIG9mIHRoZSBtZXRob2QgLS0gdGhlIHZlcnNpb24gdGhh\ndCB0YWtlcyBhbiBpbnRbXSBvZiBmaWVsZHMgdG8KICAgICAqIHRvIGFjY2Vz\ncyByYXRoZXIgdGhhbiBhIHNpbmdsZSBmaWVsZC4gVGhlIG11bHRpcGxlIGZp\nZWxkcyB2ZXJzaW9uCiAgICAgKiBzaW1wbHkgbG9vcHMgdGhyb3VnaCB0aGUg\ncHJvdmlkZWQgaW5kZXhlcyBhbmQgZGVsZWdhdGVzIHRvIHRoZQogICAgICog\nc2luZ3VsYXIgdmVyc2lvbiBmb3IgZWFjaCBvbmUuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRNdWx0aXBsZUZpZWxkc01ldGhvZFZlcnNpb24oQkNN\nZXRob2Qgc2luZ2xlKSB7CiAgICAgICAgYm9vbGVhbiBjb3B5ID0gKFBSRSAr\nICJDb3B5RmllbGQiKS5lcXVhbHMoc2luZ2xlLmdldE5hbWUoKSk7CgogICAg\nICAgIC8vIHB1YmxpYyB2b2lkIDxtZXRob2Q+cyAoaW50W10gZmllbGRzKQog\nICAgICAgIENsYXNzW10gYXJncyA9IChjb3B5KSA/IG5ldyBDbGFzc1tdeyBP\nYmplY3QuY2xhc3MsIGludFtdLmNsYXNzIH0KICAgICAgICAgICAgOiBuZXcg\nQ2xhc3NbXXsgaW50W10uY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRo\nb2QgPSBfcGMuZGVjbGFyZU1ldGhvZChzaW5nbGUuZ2V0TmFtZSgpICsgInMi\nLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBhcmdzKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgaW50IGZp\nZWxkTnVtYmVycyA9IDA7CiAgICAgICAgaW50IGluc3QgPSAwOwogICAgICAg\nIGlmIChjb3B5KSB7CiAgICAgICAgICAgIGZpZWxkTnVtYmVycyA9IDE7Cgog\nICAgICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAg\nICAgICAgICAgLy8gZ2V0IHRoZSBtYW5hZ2VkIGluc3RhbmNlIGludG8gdGhl\nIGxvY2FsIHZhcmlhYmxlIHRhYmxlCiAgICAgICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZXN0YXRpYygpLnNldE1ldGhvZChJbXBsSGVscGVyLmNsYXNzLAogICAgICAg\nICAgICAgICAgICAgICJnZXRNYW5hZ2VkSW5zdGFuY2UiLCBPYmplY3QuY2xh\nc3MsCiAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBPYmplY3Qu\nY2xhc3MgfSk7CiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUoX21hbmFnZWRUeXBlKTsKICAgICAgICAgICAgICAgIGluc3QgPSBj\nb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICAgICAgY29k\nZS5hc3RvcmUoKS5zZXRMb2NhbChpbnN0KTsKCiAgICAgICAgICAgICAgICAv\nLyB0aGVyZSBtaWdodCBiZSBhIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUgY2xh\nc3NlcyBvZiAndGhpcycKICAgICAgICAgICAgICAgIC8vIHZzICdvdGhlcicg\naW4gdGhpcyBjb250ZXh0OyB1c2UgdGhlIFBDIG1ldGhvZHMgdG8gZ2V0IHRo\nZSBTTQogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAg\nICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01U\nWVBFKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0\nTWV0aG9kKEltcGxIZWxwZXIuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAg\nInRvUGVyc2lzdGVuY2VDYXBhYmxlIiwgUGVyc2lzdGVuY2VDYXBhYmxlLmNs\nYXNzLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0\nLmNsYXNzLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgICAgICBjb2Rl\nLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChQZXJzaXN0ZW5jZUNhcGFi\nbGUuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgInBjR2V0U3RhdGVNYW5h\nZ2VyIiwgU3RhdGVNYW5hZ2VyLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFhYWCBvdGhlciA9IChYWFgp\nIHBjOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKF9w\nYyk7CiAgICAgICAgICAgICAgICBpbnN0ID0gY29kZS5nZXROZXh0TG9jYWxz\nSW5kZXgoKTsKICAgICAgICAgICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9j\nYWwoaW5zdCk7CgogICAgICAgICAgICAgICAgLy8gYWNjZXNzIHRoZSBvdGhl\ncidzIHNtIGZpZWxkIGRpcmVjdGx5CiAgICAgICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwoaW5zdCk7CiAgICAgICAgICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGlmIChvdGhlci5wY1N0YXRlTWFuYWdlciAhPSBw\nY1N0YXRlTWFuYWdlcikKICAgICAgICAgICAgLy8JdGhyb3cgbmV3IElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbgoKICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgSnVtcElu\nc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZmFjbXBlcSgpOwogICAgICAgICAg\nICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24uY2xhc3MpOwogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5u\nb3AoKSk7CgogICAgICAgICAgICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0g\nbnVsbCkKICAgICAgICAgICAgLy8gIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVF\neGNlcHRpb24KICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVs\nZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgaWZpbnMgPSBjb2RlLmlmbm9u\nbnVsbCgpOwogICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxl\nZ2FsU3RhdGVFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICBpZmlucy5z\nZXRUYXJnZXQoY29kZS5ub3AoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBm\nb3IgKGludCBpID0gMDsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoMCk7CiAgICAgICAgaW50IGlkeCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0lu\nZGV4KCk7CiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChpZHgpOwog\nICAgICAgIEp1bXBJbnN0cnVjdGlvbiB0ZXN0aW5zID0gY29kZS5nbzIoKTsK\nCiAgICAgICAgLy8gPG1ldGhvZD4gKGZpZWxkc1tpXSk7CiAgICAgICAgSW5z\ndHJ1Y3Rpb24gYm9keWlucyA9IGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpOwogICAgICAgIGlmIChjb3B5KQogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwoaW5zdCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKGZpZWxkTnVtYmVycyk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNl\ndExvY2FsKGlkeCk7CiAgICAgICAgY29kZS5pYWxvYWQoKTsKICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qoc2luZ2xlKTsKCiAgICAg\nICAgLy8gaSsrOwogICAgICAgIGNvZGUuaWluYygpLnNldEluY3JlbWVudCgx\nKS5zZXRMb2NhbChpZHgpOwoKICAgICAgICAvLyBpIDwgZmllbGRzLmxlbmd0\naAogICAgICAgIHRlc3RpbnMuc2V0VGFyZ2V0KGNvZGUuaWxvYWQoKS5zZXRM\nb2NhbChpZHgpKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oZmll\nbGROdW1iZXJzKTsKICAgICAgICBjb2RlLmFycmF5bGVuZ3RoKCk7CiAgICAg\nICAgY29kZS5pZmljbXBsdCgpLnNldFRhcmdldChib2R5aW5zKTsKICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhT\ndGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSAnc3RvY2snIG1ldGhvZHMg\ndG8gdGhlIGJ5dGVjb2RlOyB0aGVzZSBpbmNsdWRlIG1ldGhvZHMKICAgICAq\nIGxpa2Uge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0ZldGNoT2JqZWN0\nSWR9CiAgICAgKiBhbmQge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0lz\nVHJhbnNhY3Rpb25hbH0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRT\ndG9ja01ldGhvZHMoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHBjR2V0R2Vu\nZXJpY0NvbnRleHQKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFu\nYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIChNZXRob2QpIEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAg\nICAgICAgICAgICAgICAgICBTTVRZUEUsICJnZXQiICsgQ09OVEVYVE5BTUUs\nIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAv\nLyBwY0ZldGNoT2JqZWN0SWQKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0\nYXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIChNZXRob2QpIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAg\nICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAog\nICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJmZXRjaE9iamVjdElk\nIiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAgICAgICAgICAg\nIC8vIHBjSXNEZWxldGVkCiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0\nZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0aG9kKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAg\nICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAg\nICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAiaXNEZWxldGVkIiwgKENs\nYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAgICAgICAgICAgIC8vIHBj\nSXNEaXJ0eQogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2Vy\nTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAg\nICAgICAgICAgICAgIFNNVFlQRSwgImlzRGlydHkiLCAoQ2xhc3NbXSkgbnVs\nbCkpLCB0cnVlKTsKICAgIAogICAgICAgICAgICAvLyBwY0lzTmV3CiAgICAg\nICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAg\nICAgICAgICAgICAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRE\nZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nU01UWVBFLCAiaXNOZXciLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAg\nICAKICAgICAgICAgICAgLy8gcGNJc1BlcnNpc3RlbnQKICAgICAgICAgICAg\ndHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAg\nICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAog\nICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVk\nTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUs\nICJpc1BlcnNpc3RlbnQiLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAg\nICAKICAgICAgICAgICAgLy8gcGNJc1RyYW5zYWN0aW9uYWwKICAgICAgICAg\nICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAg\nICAgICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2Vk\nKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xh\ncmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZ\nUEUsICJpc1RyYW5zYWN0aW9uYWwiLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxz\nZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNTZXJpYWxpemluZwogICAgICAg\nICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAg\nICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVj\nbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNN\nVFlQRSwgInNlcmlhbGl6aW5nIiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2Up\nOwogICAgCiAgICAgICAgICAgIC8vIHBjRGlydHkKICAgICAgICAgICAgdHJh\nbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAg\nIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0\naG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJk\naXJ0eSIsIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSkpLCBmYWxzZSk7\nCiAgICAKICAgICAgICAgICAgLy8gcGNHZXRTdGF0ZU1hbmFnZXIKICAgICAg\nICAgICAgQkNNZXRob2QgbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nICJHZXRTdGF0ZU1hbmFnZXIiLAogICAgICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VyLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgQ29kZSBjb2RlID0gbWV0\naC5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTdGF0ZU1hbmFnZXIuY2xhc3MpOwogICAgICAgICAg\nICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgICAgIH0gY2F0Y2ggKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb24gcGFlKSB7CiAgICAgICAgICAgICB0aHJvdyAoTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uKSBwYWUuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBhZGQgYSBzdG9jayBt\nZXRob2QgdG8gdGhlIGJ5dGVjb2RlLiBFYWNoCiAgICAgKiBzdG9jayBtZXRo\nb2Qgc2ltcGx5IGRlbGVnYXRlcyB0byBhIGNvcnJlc3BvbmRpbmcgU3RhdGVN\nYW5hZ2VyIG1ldGhvZC4KICAgICAqIEdpdmVuIHRoZSBTdGF0ZU1hbmFnZXIg\nbWV0aG9kLCB0aGVuLCB0aGlzIGZ1bmN0aW9uIHRyYW5zbGF0ZXMgaXQgaW50\nbwogICAgICogdGhlIHdyYXBwZXIgbWV0aG9kIHRoYXQgc2hvdWxkIGJlIGFk\nZGVkIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoTWV0aG9kIG0sCiAg\nICAgICAgYm9vbGVhbiBpc0RpcnR5Q2hlY2tNZXRob2QpIHsKICAgICAgICAv\nLyBmb3JtIHRoZSBuYW1lIG9mIHRoZSBtZXRob2QgYnkgcHJlcGVuZGluZyAn\ncGMnIHRvIHRoZSBzbSBtZXRob2QKICAgICAgICBTdHJpbmcgbmFtZSA9IFBS\nRSArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUobS5nZXROYW1lKCkpOwogICAg\nICAgIENsYXNzW10gcGFyYW1zID0gbS5nZXRQYXJhbWV0ZXJUeXBlcygpOwog\nICAgICAgIENsYXNzIHJldHVyblR5cGUgPSBtLmdldFJldHVyblR5cGUoKTsK\nCiAgICAgICAgLy8gYWRkIHRoZSBtZXRob2QgdG8gdGhlIHBjCiAgICAgICAg\nQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QobmFtZSwgcmV0\ndXJuVHlwZSwgcGFyYW1zKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2Vy\nID09IG51bGwpIHJldHVybiA8ZGVmYXVsdD47CiAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgaWYgKHJl\ndHVyblR5cGUuZXF1YWxzKGJvb2xlYW4uY2xhc3MpKQogICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZmFsc2UpOwogICAgICAgIGVsc2Ug\naWYgKCFyZXR1cm5UeXBlLmVxdWFscyh2b2lkLmNsYXNzKSkKICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLnhy\nZXR1cm4oKS5zZXRUeXBlKHJldHVyblR5cGUpOwoKICAgICAgICAvLyBpZiB0\naGlzIGlzIHRoZSBkaXJ0eS1jaGVjayBtZXRob2QgYW5kIHdlJ3JlIHN1YmNs\nYXNzaW5nIGJ1dCBub3QKICAgICAgICAvLyByZWRlZmluaW5nLCBob29rIGlu\ndG8gUENIZWxwZXIgdG8gZG8gdGhlIGRpcnR5IGNoZWNrCiAgICAgICAgaWYg\nKGlzRGlydHlDaGVja01ldGhvZCAmJiAhZ2V0UmVkZWZpbmUoKSkgewogICAg\nICAgICAgICAvLyBSZWRlZmluaXRpb25IZWxwZXIuZGlydHlDaGVjayhzbSk7\nCiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQo\nKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgY29kZS5kdXAo\nKTsgLy8gZm9yIHRoZSByZXR1cm4gc3RhdGVtZW50IGJlbG93CiAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZGVmaW5pdGlv\nbkhlbHBlci5jbGFzcywgCiAgICAgICAgICAgICAgICAiZGlydHlDaGVjayIs\nIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgU01UWVBFIH0pOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAgIGNvZGUu\nZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgLy8gcmV0dXJuIHBjU3RhdGVNYW5hZ2VyLjxtZXRo\nb2Q+ICg8YXJncz4pOwogICAgICAgIC8vIG1hbmFnZWQgaW5zdGFuY2UgbG9h\nZGVkIGFib3ZlIGluIGlmLWVsc2UgYmxvY2sKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgY29k\nZS54bG9hZCgpLnNldFBhcmFtKGkpOwogICAgICAgIGNvZGUuaW52b2tlaW50\nZXJmYWNlKCkuc2V0TWV0aG9kKG0pOwogICAgICAgIGNvZGUueHJldHVybigp\nLnNldFR5cGUocmV0dXJuVHlwZSk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNp\nc3RlbmNlQ2FwYWJsZSNwY0dldFZlcnNpb259IG1ldGhvZCB0byB0aGUgYnl0\nZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRHZXRWZXJzaW9u\nTWV0aG9kKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiR2V0VmVyc2lvbiIsIE9iamVjdC5jbGFzcywKICAgICAgICAg\nICAgbnVsbCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CgogICAgICAgIC8vIGlmIChwY1N0YXRlTWFuYWdlciA9PSBudWxs\nKQogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVs\nbCgpOwogICAgICAgIEZpZWxkTWV0YURhdGEgdmVyc2lvbkZpZWxkID0gX21l\ndGEuZ2V0VmVyc2lvbkZpZWxkKCk7CgogICAgICAgIGlmICh2ZXJzaW9uRmll\nbGQgPT0gbnVsbCkKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51\nbGwoKTsgLy8gcmV0dXJuIG51bGw7CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIC8vIHJldHVybiA8dmVyc2lvbkZpZWxkPjsKICAgICAgICAgICAgQ2xh\nc3Mgd3JhcHBlciA9IHRvUHJpbWl0aXZlV3JhcHBlcih2ZXJzaW9uRmllbGQp\nOwogICAgICAgICAgICBpZiAod3JhcHBlciAhPSB2ZXJzaW9uRmllbGQuZ2V0\nRGVjbGFyZWRUeXBlKCkpIHsKICAgICAgICAgICAgICAgIGNvZGUuYW5ldygp\nLnNldFR5cGUod3JhcHBlcik7CiAgICAgICAgICAgICAgICBjb2RlLmR1cCgp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFs\ndWVDb2RlKGNvZGUsIHZlcnNpb25GaWVsZCk7CiAgICAgICAgICAgIGlmICh3\ncmFwcGVyICE9IHZlcnNpb25GaWVsZC5nZXREZWNsYXJlZFR5cGUoKSkKICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh3\ncmFwcGVyLCAiPGluaXQ+Iiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgdmVyc2lvbkZpZWxkLmdldERlY2xhcmVkVHlw\nZSgpIH0pOwogICAgICAgIH0KICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAg\nICAgICAgLy8gcmV0dXJuIHBjU3RhdGVNYW5hZ2VyLmdldFZlcnNpb24gKCk7\nCiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QoU01UWVBFLCAiZ2V0VmVyc2lvbiIsIE9iamVjdC5jbGFz\ncywKICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7\nCgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSB2ZXJzaW9uIGZpZWxkIHR5cGUgYXMgYSBwcmltaXRp\ndmUgd3JhcHBlciwgb3IgbnVsbCBpZgogICAgICogdGhlIHZlcnNpb24gZmll\nbGQgaXMgbm90IHByaW1pdGl2ZS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFz\ncyB0b1ByaW1pdGl2ZVdyYXBwZXIoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAg\nICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAg\nICAgIHJldHVybiBCb29sZWFuLmNsYXNzOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIEJ5dGUuY2xh\nc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAg\nICAgICAgICByZXR1cm4gQ2hhcmFjdGVyLmNsYXNzOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICByZXR1cm4g\nRG91YmxlLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9B\nVDoKICAgICAgICAgICAgICAgIHJldHVybiBGbG9hdC5jbGFzczsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgcmV0\ndXJuIEludGVnZXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkxPTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gTG9uZy5jbGFzczsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAg\nICByZXR1cm4gU2hvcnQuY2xhc3M7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjUmVwbGFj\nZVN0YXRlTWFuYWdlcn0KICAgICAqIG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRSZXBsYWNlU3RhdGVNYW5h\nZ2VyTWV0aG9kKCkgewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjUmVwbGFj\nZVN0YXRlTWFuYWdlciAoU3RhdGVNYW5hZ2VyIHNtKQogICAgICAgIEJDTWV0\naG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJSZXBsYWNl\nU3RhdGVNYW5hZ2VyIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENs\nYXNzW117IFNNVFlQRSB9KTsKICAgICAgICBtZXRob2Quc2V0U3luY2hyb25p\nemVkKHRydWUpOwogICAgICAgIG1ldGhvZC5nZXRFeGNlcHRpb25zKHRydWUp\nLmFkZEV4Y2VwdGlvbihTZWN1cml0eUV4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAg\nIC8vIGlmIChwY1N0YXRlTWFuYWdlciAhPSBudWxsKQogICAgICAgIC8vCXBj\nU3RhdGVNYW5hZ2VyID0gcGNTdGF0ZU1hbmFnZXIucmVwbGFjZVN0YXRlTWFu\nYWdlcihzbSk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUu\naWZudWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZ\nUEUpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJy\nZXBsYWNlU3RhdGVNYW5hZ2VyIiwKICAgICAgICAgICAgU01UWVBFLCBuZXcg\nQ2xhc3NbXXsgU01UWVBFIH0pOwogICAgICAgIGNvZGUucHV0ZmllbGQoKS5z\nZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nCiAgICAgICAgLy8gU2VjdXJpdHlNYW5hZ2VyIHNlYyA9IFN5c3RlbS5nZXRT\nZWN1cml0eU1hbmFnZXIgKCk7CiAgICAgICAgLy8gaWYgKHNlYyAhPSBudWxs\nKQogICAgICAgIC8vCQlzZWMuY2hlY2tQZXJtaXNzaW9uIChQZXJtaXNzaW9u\nLlNFVF9TVEFURV9NQU5BR0VSKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQo\nY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoU3lzdGVtLmNsYXNzLAog\nICAgICAgICAgICAiZ2V0U2VjdXJpdHlNYW5hZ2VyIiwgU2VjdXJpdHlNYW5h\nZ2VyLmNsYXNzLCBudWxsKSk7CgogICAgICAgIC8vIHBjU3RhdGVNYW5hZ2Vy\nID0gc207CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMg\ndGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBtZXRob2RzIGRlYWxpbmcgd2l0aCBh\ncHBsaWNhdGlvbgogICAgICogaWRlbnRpdHkgYW5kIGdpdmVzIHRoZW0gbm8t\nb3AgaW1wbGVtZW50YXRpb25zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkTm9PcEFwcGxpY2F0aW9uSWRlbnRpdHlNZXRob2RzKCkgewogICAgICAg\nIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc1RvT2JqZWN0SWQgKE9i\namVjdElkRmllbGRTdXBwbGllciBmcywKICAgICAgICAvLyAJT2JqZWN0IG9p\nZCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiQ29weUtleUZpZWxkc1RvT2JqZWN0SWQiLAogICAgICAgICAg\nICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT0lERlNUWVBFLCBPYmplY3Qu\nY2xhc3MgfSk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQg\ncGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0IG9pZCkKICAgICAg\nICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZp\nZWxkc1RvT2JqZWN0SWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcg\nQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICAvLyBw\ndWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQgKE9iamVj\ndElkRmllbGRDb25zdW1lciBmYywKICAgICAgICAvLwlPYmplY3Qgb2lkKQog\nICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5\nS2V5RmllbGRzRnJvbU9iamVjdElkIiwKICAgICAgICAgICAgdm9pZC5jbGFz\ncywgbmV3IENsYXNzW117IE9JREZDVFlQRSwgT2JqZWN0LmNsYXNzIH0pOwog\nICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwoKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNG\ncm9tT2JqZWN0SWQgKE9iamVjdCBvaWQpCiAgICAgICAgbWV0aG9kID0gX3Bj\nLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0\nSWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2Jq\nZWN0LmNsYXNzIH0pOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0\ncnVlKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICAvLyBwdWJsaWMgT2JqZWN0\nIHBjTmV3T2JqZWN0SWRJbnN0YW5jZSAoKQogICAgICAgIG1ldGhvZCA9IF9w\nYy5kZWNsYXJlTWV0aG9kKFBSRSArICJOZXdPYmplY3RJZEluc3RhbmNlIiwK\nICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gcHVibGljIE9iamVjdCBw\nY05ld09iamVjdElkSW5zdGFuY2UgKE9iamVjdCBvYmopCiAgICAgICAgbWV0\naG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIk5ld09iamVjdElkSW5z\ndGFuY2UiLAogICAgICAgICAgICBPYmplY3QuY2xhc3MsIG5ldyBDbGFzc1td\neyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7\nCiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5wY0Nv\ncHlLZXlGaWVsZHNUb09iamVjdElkPC9jb2RlPiBtZXRob2RzCiAgICAgKiB0\nbyBjbGFzc2VzIHVzaW5nIGFwcGxpY2F0aW9uIGlkZW50aXR5LgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkQ29weUtleUZpZWxkc1RvT2JqZWN0SWRN\nZXRob2QoYm9vbGVhbiBmaWVsZE1hbmFnZXIpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQg\ncGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0SWRGaWVsZFN1cHBs\naWVyIGZzLAogICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAgU3RyaW5n\nW10gYXJncyA9IChmaWVsZE1hbmFnZXIpID8KICAgICAgICAgICAgbmV3IFN0\ncmluZ1tdeyBPSURGU1RZUEUuZ2V0TmFtZSgpLCBPYmplY3QuY2xhc3MuZ2V0\nTmFtZSgpIH0KICAgICAgICAgICAgOiBuZXcgU3RyaW5nW117IE9iamVjdC5j\nbGFzcy5nZXROYW1lKCkgfTsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZpZWxkc1RvT2JqZWN0\nSWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7Cgog\nICAgICAgIC8vIHNpbmdsZSBmaWVsZCBpZGVudGl0eSBhbHdheXMgdGhyb3dz\nIGV4Y2VwdGlvbgogICAgICAgIGlmIChfbWV0YS5pc09wZW5KUEFJZGVudGl0\neSgpKSB7CiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElOVEVS\nTkVYQ0VQKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIC8vIGNhbGwgc3VwZXJjbGFzcyBtZXRob2QK\nICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVsbCAm\nJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKGkpOwogICAgICAgICAgICBjb2Rl\nLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAg\nICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLmdldE5h\nbWUoKSwKICAgICAgICAgICAgICAgIFBSRSArICJDb3B5S2V5RmllbGRzVG9P\nYmplY3RJZCIsIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAg\nICB9CgogICAgICAgIC8vIE9iamVjdCBpZCA9IG9pZDsKICAgICAgICBpZiAo\nZmllbGRNYW5hZ2VyKQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CgogICAgICAgIGlmIChfbWV0YS5pc09iamVjdElkVHlw\nZVNoYXJlZCgpKSB7CiAgICAgICAgICAgIC8vIG9pZCA9ICgoT2JqZWN0SWQp\nIGlkKS5nZXRJZCAoKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5z\nZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9iamVjdElkLmNsYXNzLCAiZ2V0SWQi\nLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAg\nICB9CgogICAgICAgIC8vIDxvaWQgdHlwZT4gaWQgPSAoPG9pZCB0eXBlPikg\nb2lkOwogICAgICAgIGludCBpZCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4\nKCk7CiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IF9tZXRhLmdldE9iamVjdElk\nVHlwZSgpOwogICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShvaWRU\neXBlKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKGlkKTsKCiAg\nICAgICAgLy8gaW50IGluaGVyaXRlZCA9IHBjSW5oZXJpdGVkRmllbGRDb3Vu\ndDsKICAgICAgICBpbnQgaW5oZXJpdGVkID0gMDsKICAgICAgICBpZiAoZmll\nbGRNYW5hZ2VyKSB7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0\nRmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAgaW5oZXJp\ndGVkID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAg\nY29kZS5pc3RvcmUoKS5zZXRMb2NhbChpbmhlcml0ZWQpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gaWQuPGZpZWxkPiA9IGZzLmZldGNoPHR5cGU+RmllbGQg\nKDxpbmRleD4pOyBvci4uLgogICAgICAgIC8vIGlkLjxmaWVsZD4gPSBwYy48\nZmllbGQ+OwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0Q3Jl\nYXRlU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygpCiAgICAgICAgICAg\nIDogX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBDbGFzcyB0\neXBlOwogICAgICAgIFN0cmluZyBuYW1lOwogICAgICAgIEZpZWxkIGZpZWxk\nOwogICAgICAgIE1ldGhvZCBzZXR0ZXI7CiAgICAgICAgYm9vbGVhbiByZWZs\nZWN0OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5\nKCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldExvY2FsKGlkKTsKCiAgICAgICAgICAgIG5hbWUgPSBm\nbWRzW2ldLmdldE5hbWUoKTsKICAgICAgICAgICAgdHlwZSA9IGZtZHNbaV0u\nZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKTsKICAgICAgICAgICAgaWYgKF9tZXRh\nLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVM\nRCkgewogICAgICAgICAgICAgICAgc2V0dGVyID0gbnVsbDsKICAgICAgICAg\nICAgICAgIGZpZWxkID0gUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwg\nbmFtZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICByZWZsZWN0ID0gIU1vZGlm\naWVyLmlzUHVibGljKGZpZWxkLmdldE1vZGlmaWVycygpKTsKICAgICAgICAg\nICAgICAgIGlmIChyZWZsZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mob2lkVHlwZSk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG5hbWUpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygp\nLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xhc3Nb\nXSB7IENsYXNzLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBTdHJp\nbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmaWVsZCA9\nIG51bGw7CiAgICAgICAgICAgICAgICBzZXR0ZXIgPSBSZWZsZWN0aW9uLmZp\nbmRTZXR0ZXIob2lkVHlwZSwgbmFtZSwgdHlwZSwgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICByZWZsZWN0ID0gIU1vZGlmaWVyLmlzUHVibGljKHNldHRlci5n\nZXRNb2RpZmllcnMoKSk7CiAgICAgICAgICAgICAgICBpZiAocmVmbGVjdCkg\newogICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNl\ndENsYXNzKG9pZFR5cGUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShuYW1lKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyh0eXBlKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRo\nb2QoUmVmbGVjdGlvbi5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAgICAg\nICJmaW5kU2V0dGVyIiwgTWV0aG9kLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IENs\nYXNzLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcuY2xh\nc3MsIENsYXNzLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmllbGRN\nYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoaSk7CiAgICAgICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwo\naW5oZXJpdGVkKTsKICAgICAgICAgICAgICAgIGNvZGUuaWFkZCgpOwogICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QK\nICAgICAgICAgICAgICAgICAgICAoZ2V0RmllbGRTdXBwbGllck1ldGhvZCh0\neXBlKSk7CgogICAgICAgICAgICAgICAgLy8gaWYgdGhlIHR5cGUgb2YgdGhp\ncyBmaWVsZCBtZXRhIGRhdGEgaXMKICAgICAgICAgICAgICAgIC8vIG5vbi1w\ncmltaXRpdmUgYW5kIG5vbi1zdHJpbmcsIGJlIHN1cmUgdG8gY2FzdAogICAg\nICAgICAgICAgICAgLy8gdG8gdGhlIGFwcHJvcHJpYXRlIHR5cGUuCiAgICAg\nICAgICAgICAgICBpZiAoIXJlZmxlY3QgJiYgIXR5cGUuaXNQcmltaXRpdmUo\nKQogICAgICAgICAgICAgICAgICAgICYmICF0eXBlLmdldE5hbWUoKS5lcXVh\nbHMoU3RyaW5nLmNsYXNzLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2Vk\nVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwoKICAgICAgICAgICAgICAgIC8v\nIGdldCBpZC9wayBmcm9tIHBjIGluc3RhbmNlCiAgICAgICAgICAgICAgICBp\nZiAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLlBDKQogICAgICAgICAgICAgICAgICAgIGFkZEV4dHJhY3RPYmplY3RJZEZp\nZWxkVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAocmVmbGVjdCAmJiBmaWVsZCAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChS\nZWZsZWN0aW9uLmNsYXNzLCAic2V0IiwgCiAgICAgICAgICAgICAgICAgICAg\ndm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3MsIEZpZWxk\nLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICh0eXBlLmlzUHJpbWl0aXZl\nKCkpID8gdHlwZSA6IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAgfSBl\nbHNlIGlmIChyZWZsZWN0KSB7IAogICAgICAgICAgICAgICAgY29kZS5pbnZv\na2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywgInNldCIs\nIAogICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\nIHsgT2JqZWN0LmNsYXNzLCBNZXRob2QuY2xhc3MsCiAgICAgICAgICAgICAg\nICAgICAgKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0eXBlIDogT2JqZWN0LmNs\nYXNzIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZpZWxkICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoZmll\nbGQpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qoc2V0dGVyKTsKICAgICAgICB9CiAg\nICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGNvZGUgdG8gZXh0cmFjdCB0\naGUgaWQgb2YgdGhlIGdpdmVuIHByaW1hcnkga2V5IHJlbGF0aW9uIGZpZWxk\nIGZvcgogICAgICogc2V0dGluZyBpbnRvIGFuIG9iamVjdGlkIGluc3RhbmNl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkRXh0cmFjdE9iamVjdElk\nRmllbGRWYWx1ZUNvZGUoQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIHBrKSB7\nCiAgICAgICAgLy8gaWYgKHZhbCAhPSBudWxsKSAKICAgICAgICAvLyAgdmFs\nID0gKChQZXJzaXN0ZW5jZUNhcGFibGUpIHZhbCkucGNGZXRjaE9iamVjdElk\nKCk7CiAgICAgICAgaW50IHBjID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgo\nKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKHBjKTsKICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwocGMpOwogICAgICAgIEp1bXBJbnN0\ncnVjdGlvbiBpZm51bGwxID0gY29kZS5pZm51bGwoKTsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwocGMpOwogICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MpOyAKICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChQZXJzaXN0ZW5j\nZUNhcGFibGUuY2xhc3MsCiAgICAgICAgICAgIFBSRSArICJGZXRjaE9iamVj\ndElkIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBpbnQgb2lkID0g\nY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmFzdG9y\nZSgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldExv\nY2FsKG9pZCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmbnVsbDIgPSBj\nb2RlLmlmbnVsbCgpOyAKCiAgICAgICAgLy8gZm9yIGRhdGFzdG9yZSAvIHNp\nbmdsZS1maWVsZCBpZGVudGl0eToKICAgICAgICAvLyBpZiAodmFsICE9IG51\nbGwpCiAgICAgICAgLy8gICB2YWwgPSAoKE9wZW5KUEFJZCkgdmFsKS5nZXRJ\nZCgpOwogICAgICAgIENsYXNzTWV0YURhdGEgcGttZXRhID0gcGsuZ2V0RGVj\nbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAgICBpbnQgcGtjb2RlID0gcGsu\nZ2V0T2JqZWN0SWRGaWVsZFR5cGVDb2RlKCk7CiAgICAgICAgQ2xhc3MgcGt0\neXBlID0gcGsuZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKTsKICAgICAgICBpZiAo\ncGttZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURf\nREFUQVNUT1JFIAogICAgICAgICAgICAmJiBwa2NvZGUgPT0gSmF2YVR5cGVz\nLkxPTkcpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9p\nZCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShJZC5j\nbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChJZC5jbGFzcywgImdldElkIiwgCiAgICAgICAgICAgICAgICBsb25n\nLmNsYXNzLCBudWxsKTsKICAgICAgICB9IGVsc2UgaWYgKHBrbWV0YS5nZXRJ\nZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRSkg\newogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICB9IGVsc2UgaWYgKHBrbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7\nCiAgICAgICAgICAgIHN3aXRjaCAocGtjb2RlKSB7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmFuZXcoKS5zZXRUeXBlKEJ5dGUuY2xhc3MpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8g\nbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9p\nZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKEJ5dGVJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEJ5dGVJZC5jbGFzcywgImdldElk\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZS5jbGFzcywgbnVsbCk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMu\nQllURV9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZChCeXRlLmNsYXNzLCAiPGluaXQ+IiwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFz\nc1tdIHtieXRlLmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKENoYXJhY3Rl\nci5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQ2hhcklkLmNsYXNzKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nQ2hhcklkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAg\nICBjaGFyLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\ncGtjb2RlID09IEphdmFUeXBlcy5DSEFSX09CSikKICAgICAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKENoYXJh\nY3Rlci5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPGlu\naXQ+Iiwgdm9pZC5jbGFzcywgbmV3IENsYXNzW10ge2NoYXIuY2xhc3N9KTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5hbmV3KCkuc2V0VHlwZShEb3VibGUuY2xhc3MpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8g\nbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJM\nRToKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwo\nb2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUoRG91YmxlSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChEb3VibGVJZC5jbGFzcywg\nImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgZG91YmxlLmNsYXNz\nLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEph\ndmFUeXBlcy5ET1VCTEVfT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoRG91YmxlLmNsYXNzLCAi\nPGluaXQ+IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNs\nYXNzLCBuZXcgQ2xhc3NbXXtkb3VibGUuY2xhc3N9KTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkZMT0FUX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5z\nZXRUeXBlKEZsb2F0LmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoRmxvYXRJZC5j\nbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKEZsb2F0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAg\nICAgICAgICAgICAgICAgIGZsb2F0LmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5GTE9BVF9PQkop\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZChGbG9hdC5jbGFzcywgIjxpbml0PiIsIAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117Zmxv\nYXQuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShJbnRlZ2VyLmNsYXNzKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAg\nICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5JTlQ6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKEludElkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoSW50SWQuY2xhc3Ms\nICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGludC5jbGFzcywg\nbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZh\nVHlwZXMuSU5UX09CSikKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKEludGVnZXIuY2xhc3MsICI8aW5p\ndD4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywg\nbmV3IENsYXNzW10ge2ludC5jbGFzc30pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19P\nQko6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShM\nb25nLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOwog\nICAgICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShMb25nSWQuY2xhc3MpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChMb25nSWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAg\nICAgIGxvbmcuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChwa2NvZGUgPT0gSmF2YVR5cGVzLkxPTkdfT0JKKQogICAgICAgICAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoTG9u\nZy5jbGFzcywgIjxpbml0PiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7bG9uZy5jbGFzc30pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUu\nYW5ldygpLnNldFR5cGUoU2hvcnQuY2xhc3MpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJl\nYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShT\naG9ydElkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoU2hvcnRJZC5jbGFzcywgImdldElkIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnQuY2xhc3MsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLlNI\nT1JUX09CSikKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKFNob3J0LmNsYXNzLCAiPGluaXQ+IiwgCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXXtzaG9ydC5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoRGF0\nZUlkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoRGF0ZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAg\nICAgICAgICAgICAgICAgICAgICBEYXRlLmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUoU3RyaW5nSWQuY2xhc3MpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChTdHJp\nbmdJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nU3RyaW5nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNz\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGVsc2UgaWYgKHBrbWV0YS5nZXRPYmplY3RJZFR5cGUo\nKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChvaWQpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUo\ncGt0eXBlKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGdv\nMiA9IGNvZGUuZ28yKCk7CgogICAgICAgIC8vIGlmICh2YWwgPT0gbnVsbCkK\nICAgICAgICAvLyAgIHZhbCA9IDxkZWZhdWx0PjsKICAgICAgICBJbnN0cnVj\ndGlvbiBkZWY7CiAgICAgICAgc3dpdGNoIChwa2NvZGUpIHsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgIGRl\nZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmYWxzZSk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllU\nRToKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZSgoYnl0ZSkgMCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGRl\nZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgoY2hhcikgMCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRE9VQkxFOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKDBEKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIGRl\nZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRik7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgog\nICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVl\nKDApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoMEwpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAg\nICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKChzaG9ydCkg\nMCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRO\ndWxsKCk7CiAgICAgICAgfQogICAgICAgIGlmbnVsbDEuc2V0VGFyZ2V0KGRl\nZik7CiAgICAgICAgaWZudWxsMi5zZXRUYXJnZXQoZGVmKTsKICAgICAgICBn\nbzIuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkcyB0aGUgPGNvZGU+cGNDb3B5S2V5RmllbGRzRnJvbU9iamVjdElk\nPC9jb2RlPiBtZXRob2RzCiAgICAgKiB0byBjbGFzc2VzIHVzaW5nIGFwcGxp\nY2F0aW9uIGlkZW50aXR5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRk\nQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZE1ldGhvZChib29sZWFuIGZpZWxk\nTWFuYWdlcikKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNGcm9t\nT2JqZWN0SWQgKE9iamVjdElkRmllbGRDb25zdW1lciBmYywKICAgICAgICAv\nLwlPYmplY3Qgb2lkKQogICAgICAgIFN0cmluZ1tdIGFyZ3MgPSAoZmllbGRN\nYW5hZ2VyKSAKICAgICAgICAgICAgPyAgbmV3IFN0cmluZ1tdeyBPSURGQ1RZ\nUEUuZ2V0TmFtZSgpLCBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpIH0KICAgICAg\nICAgICAgOiBuZXcgU3RyaW5nW117IE9iamVjdC5jbGFzcy5nZXROYW1lKCkg\nfTsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAg\nICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gY2Fs\nbCBzdXBlcmNsYXNzIG1ldGhvZAogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1\ncGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVTdWJjbGFzcygpKSB7\nCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFyZ3MubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\naSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhv\nZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgUFJF\nICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLCB2b2lkLmNsYXNzLmdl\ndE5hbWUoKSwgYXJncyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmllbGRN\nYW5hZ2VyKQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMCk7CgogICAgICAgIGlmICghX21ldGEuaXNPcGVuSlBBSWRlbnRpdHko\nKSAmJiBfbWV0YS5pc09iamVjdElkVHlwZVNoYXJlZCgpKSB7CiAgICAgICAg\nICAgIC8vIG9pZCA9ICgoT2JqZWN0SWQpIGlkKS5nZXRJZCAoKTsKICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNz\nKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKE9iamVjdElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgT2Jq\nZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIC8vIDxvaWQg\ndHlwZT4gY2FzdCA9ICg8b2lkIHR5cGU+KSBvaWQ7CiAgICAgICAgaW50IGlk\nID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBDbGFzcyBv\naWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgY29k\nZS5jaGVja2Nhc3QoKS5zZXRUeXBlKG9pZFR5cGUpOwogICAgICAgIGNvZGUu\nYXN0b3JlKCkuc2V0TG9jYWwoaWQpOwoKICAgICAgICAvLyBmcy5zdG9yZTx0\neXBlPkZpZWxkICg8aW5kZXg+LCBpZC48ZmllbGQ+KTsgb3IuLi4KICAgICAg\nICAvLyB0aGlzLjxmaWVsZD4gPSBpZC48ZmllbGQ+CiAgICAgICAgLy8gb3Ig\nZm9yIHNpbmdsZSBmaWVsZCBpZGVudGl0eTogaWQuZ2V0SWQgKCkKICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1YmNsYXNzKCkg\nPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9tZXRhLmdldERl\nY2xhcmVkRmllbGRzKCk7CiAgICAgICAgU3RyaW5nIG5hbWU7CiAgICAgICAg\nQ2xhc3MgdHlwZTsKICAgICAgICBDbGFzcyB1bndyYXBwZWQ7CiAgICAgICAg\nRmllbGQgZmllbGQ7CiAgICAgICAgTWV0aG9kIGdldHRlcjsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKCFmbWRzW2ldLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICBuYW1lID0gZm1kc1tpXS5n\nZXROYW1lKCk7CiAgICAgICAgICAgIHR5cGUgPSBmbWRzW2ldLmdldE9iamVj\ndElkRmllbGRUeXBlKCk7CiAgICAgICAgICAgIGlmICghZmllbGRNYW5hZ2Vy\nIAogICAgICAgICAgICAgICAgJiYgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkgPT0gSmF2YVR5cGVzLlBDKSB7CiAgICAgICAgICAgICAgICAvLyBz\nbS5nZXRQQ1ByaW1hcnlLZXkob2lkLCBpICsgcGNJbmhlcml0ZWRGaWVsZENv\ndW50KTsgCiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7IC8vIGxl\nYXZlIG9yaWcgb24gc3RhY2sgdG8gc2V0IHZhbHVlIGludG8KICAgICAgICAg\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpZCk7CiAg\nICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAg\nICAgICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVS\nSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAgICAgICBjb2RlLmlhZGQoKTsK\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0\naG9kKFN0YXRlTWFuYWdlci5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAg\nImdldFBDUHJpbWFyeUtleSIsIE9iamVjdC5jbGFzcywgCiAgICAgICAgICAg\nICAgICAgICAgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3MsIGludC5jbGFz\ncyB9KTsKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAgICAgfSBl\nbHNlIHsgCiAgICAgICAgICAgICAgICB1bndyYXBwZWQgPSAoZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKSAKICAgICAg\nICAgICAgICAgICAgICA/IHR5cGUgOiB1bndyYXBTaW5nbGVGaWVsZElkZW50\naXR5KGZtZHNbaV0pOwogICAgICAgICAgICAgICAgaWYgKGZpZWxkTWFuYWdl\ncikgewogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoaSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CgogICAgICAgICAgICAgICAgaWYgKHVud3JhcHBlZCAhPSB0eXBl\nKSB7CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh0\neXBlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExv\nY2FsKGlkKTsKICAgICAgICAgICAgICAgIGlmIChfbWV0YS5pc09wZW5KUEFJ\nZGVudGl0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9pZFR5cGUg\nPT0gT2JqZWN0SWQuY2xhc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUsICJnZXRJ\nZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3Ms\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZpZWxkTWFu\nYWdlciAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAgICAgICAgICAgICB9IGVs\nc2UgaWYgKG9pZFR5cGUgPT0gRGF0ZUlkLmNsYXNzKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChv\naWRUeXBlLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nRGF0ZS5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nICghZmllbGRNYW5hZ2VyICYmIHR5cGUgIT0gRGF0ZS5jbGFzcykKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qob2lkVHlwZSwgImdldElkIiwgCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB1bndyYXBwZWQsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAodW53cmFwcGVkICE9IHR5cGUp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QodHlwZSwgIjxpbml0PiIsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IHVu\nd3JhcHBlZCB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9IGVsc2UgaWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFz\nc01ldGFEYXRhLkFDQ0VTU19GSUVMRCl7CiAgICAgICAgICAgICAgICAgICAg\nZmllbGQgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCBuYW1lLCB0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNQdWJs\naWMoZmllbGQuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICAgICAgICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoZmllbGQpOwogICAgICAg\nICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAv\nLyBSZWZsZWN0aW9uLmdldFhYWChvaWQsIFJlZmxlY3Rpb24uZmluZEZpZWxk\nKC4uLikpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNsYXNzY29u\nc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG5hbWUpOwogICAgICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGlj\nKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAiZmluZEZpZWxkIiwgRmllbGQuY2xhc3MsIG5ldyBD\nbGFzc1tdIHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDbGFzcy5j\nbGFzcywgU3RyaW5nLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAg\nICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhv\nZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGdldFJlZmxlY3Rpb25H\nZXR0ZXJNZXRob2QodHlwZSwgRmllbGQuY2xhc3MpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAh\nPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICBnZXR0ZXIgPSBSZWZsZWN0aW9uLmZpbmRHZXR0ZXIob2lkVHlw\nZSwgbmFtZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKE1vZGlm\naWVyLmlzUHVibGljKGdldHRlci5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChnZXR0ZXIpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBSZWZsZWN0aW9uLmdldFhYWChvaWQsIFJl\nZmxlY3Rpb24uZmluZEdldHRlciguLi4pKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mob2lkVHlwZSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZShuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNs\nYXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImZpbmRHZXR0ZXIi\nLCBNZXRob2QuY2xhc3MsIG5ldyBDbGFzc1tdIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3MsIGJvb2xl\nYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3RhdGljKCkuc2V0TWV0aG9kCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAoZ2V0UmVmbGVjdGlvbkdldHRlck1ldGhvZCh0eXBlLCBNZXRob2Qu\nY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0eXBlLmlz\nUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUo\ndHlwZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmllbGRNYW5hZ2Vy\nKQogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRN\nZXRob2QoZ2V0RmllbGRDb25zdW1lck1ldGhvZCh0eXBlKSk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNv\nZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAgfQogICAgICAgIGNvZGUudnJl\ndHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBpZiB0aGUgY2xhc3MgdXNlcyB0aGUgQ2xhc3Mv\nU3RyaW5nIGNvbnN0cnVjdG9yCiAgICAgKiBpbnN0ZWFkIG9mIGp1c3QgU3Ry\naW5nLgogICAgICovCiAgICBwcml2YXRlIEJvb2xlYW4gdXNlc0NsYXNzU3Ry\naW5nSWRDb25zdHJ1Y3RvcigpIHsKICAgICAgICBpZiAoX21ldGEuZ2V0SWRl\nbnRpdHlUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikK\nICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CgogICAgICAgIGlm\nIChfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAgIGlm\nIChfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSA9PSBPYmplY3RJZC5jbGFzcykK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1\ncm4gQm9vbGVhbi5UUlVFOwogICAgICAgIH0KCiAgICAgICAgQ2xhc3Mgb2lk\nVHlwZSA9IF9tZXRhLmdldE9iamVjdElkVHlwZSgpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIG9pZFR5cGUuZ2V0Q29uc3RydWN0b3IobmV3IENsYXNz\nW117IENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3MgfSk7CiAgICAgICAgICAg\nIHJldHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dh\nYmxlIHQpIHsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nb2lkVHlwZS5nZXRDb25zdHJ1Y3RvcihuZXcgQ2xhc3NbXXsgU3RyaW5nLmNs\nYXNzIH0pOwogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAg\nICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgIH0KICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRoZSBn\naXZlbiBmaWVsZCBpcyBhIHdyYXBwZXItdHlwZSBzaW5nbGUgZmllbGQgaWRl\nbnRpdHkgcHJpbWFyeSBrZXksCiAgICAgKiByZXR1cm4gaXRzIGNvcnJlc3Bv\nbmRpbmcgcHJpbWl0aXZlIGNsYXNzLiBFbHNlIHJldHVybiB0aGUgZmllbGQg\ndHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzcyB1bndyYXBTaW5nbGVG\naWVsZElkZW50aXR5KEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaWYg\nKCFmbWQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLmlzT3BlbkpQQUlkZW50aXR5\nKCkpCiAgICAgICAgICAgIHJldHVybiBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7\nCgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkg\newogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAg\nICAgICAgICAgIHJldHVybiBieXRlLmNsYXNzOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBj\naGFyLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVf\nT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGRvdWJsZS5jbGFzczsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZsb2F0LmNsYXNzOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGludC5j\nbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgog\nICAgICAgICAgICAgICAgcmV0dXJuIHNob3J0LmNsYXNzOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAgIHJl\ndHVybiBsb25nLmNsYXNzOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByb3BlciBn\nZXR0ZXIgbWV0aG9kIG9mIHRoZSB7QGxpbmsgUmVmbGVjdGlvbn0gaGVscGVy\nIGZvcgogICAgICogYSBmaWVsZCBvciBnZXR0ZXIgbWV0aG9kIG9mIHRoZSBn\naXZlbiB0eXBlLgogICAgICovCiAgICBwcml2YXRlIE1ldGhvZCBnZXRSZWZs\nZWN0aW9uR2V0dGVyTWV0aG9kKENsYXNzIHR5cGUsIENsYXNzIGFyZ1R5cGUp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgU3RyaW5nIG5hbWUgPSAiZ2V0IjsKICAgICAgICBpZiAodHlwZS5pc1By\naW1pdGl2ZSgpKQogICAgICAgICAgICBuYW1lICs9IFN0cmluZ1V0aWxzLmNh\ncGl0YWxpemUodHlwZS5nZXROYW1lKCkpOwogICAgICAgIHJldHVybiBSZWZs\nZWN0aW9uLmNsYXNzLmdldE1ldGhvZChuYW1lLCBuZXcgQ2xhc3NbXSB7IE9i\namVjdC5jbGFzcywgCiAgICAgICAgICAgIGFyZ1R5cGUgfSk7IAogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcm9wZXIgZmV0Y2ggbWV0aG9k\nIG9mIHRoZSBPYmplY3RJZEZpZWxkU3VwcGxpZXIgZm9yCiAgICAgKiBhIGZp\nZWxkIG9mIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBwcml2YXRlIE1l\ndGhvZCBnZXRGaWVsZFN1cHBsaWVyTWV0aG9kKENsYXNzIHR5cGUpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIGdldE1ldGhvZChPSURGU1RZUEUsIHR5cGUsICJmZXRjaCIsIHRydWUs\nIGZhbHNlLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIHByb3BlciBmZXRjaCBtZXRob2Qgb2YgdGhlIE9iamVjdElkRmllbGRD\nb25zdW1lciBmb3IKICAgICAqIGEgZmllbGQgb2YgdGhlIGdpdmVuIHR5cGUu\nCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldEZpZWxkQ29uc3VtZXJN\nZXRob2QoQ2xhc3MgdHlwZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0TWV0aG9kKE9JREZDVFlQ\nRSwgdHlwZSwgInN0b3JlIiwgZmFsc2UsIGZhbHNlLCBmYWxzZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBwY05ld09iamVjdElkSW5zdGFu\nY2UgbWV0aG9kIHRvIGNsYXNzZXMgdXNpbmcKICAgICAqIGFwcGxpY2F0aW9u\nIGlkZW50aXR5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkTmV3T2Jq\nZWN0SWRJbnN0YW5jZU1ldGhvZChib29sZWFuIG9iaikKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMg\nT2JqZWN0IHBjTmV3T2JqZWN0SWRJbnN0YW5jZSAoKQogICAgICAgIENsYXNz\nW10gYXJncyA9IChvYmopID8gbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9\nIDogbnVsbDsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFy\nZU1ldGhvZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIsCiAgICAgICAg\nICAgIE9iamVjdC5jbGFzcywgYXJncyk7CiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIEJvb2xlYW4gdXNlc0Ns\nc1N0cmluZyA9IHVzZXNDbGFzc1N0cmluZ0lkQ29uc3RydWN0b3IoKTsKICAg\nICAgICBDbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7\nCiAgICAgICAgaWYgKG9iaiAmJiB1c2VzQ2xzU3RyaW5nID09IG51bGwpIHsK\nICAgICAgICAgICAgLy8gdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbiAoLi4uKTsKICAgICAgICAgICAgU3RyaW5nIG1zZyA9IF9sb2MuZ2V0\nKCJzdHItY29ucyIsIG9pZFR5cGUsCiAgICAgICAgICAgICAgICBfbWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkpLmdldE1lc3NhZ2UoKTsKICAgICAgICAgICAg\nY29kZS5hbmV3KCkuc2V0VHlwZShJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24u\nY2xhc3MpOwogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobXNnKTsKICAgICAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICI8aW5pdD4iLCB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNzIH0pOwogICAgICAg\nICAgICBjb2RlLmF0aHJvdygpOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4o\nKTsKCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFfbWV0YS5pc09w\nZW5KUEFJZGVudGl0eSgpICYmIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVk\nKCkpIHsKICAgICAgICAgICAgLy8gbmV3IE9iamVjdElkIChjbHMsIG9pZCkK\nICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShPYmplY3RJZC5jbGFz\ncyk7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUu\nY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGdldFR5cGUoX21ldGEpKTsKICAg\nICAgICB9CgogICAgICAgIC8vIG5ldyA8b2lkIGNsYXNzPiAoKTsKICAgICAg\nICBjb2RlLmFuZXcoKS5zZXRUeXBlKG9pZFR5cGUpOwogICAgICAgIGNvZGUu\nZHVwKCk7CiAgICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkg\nfHwgKG9iaiAmJiB1c2VzQ2xzU3RyaW5nID09IEJvb2xlYW4uVFJVRSkpCiAg\nICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGdldFR5\ncGUoX21ldGEpKTsKICAgICAgICBpZiAob2JqKSB7CiAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVj\na2Nhc3QoKS5zZXRUeXBlKFN0cmluZy5jbGFzcyk7CiAgICAgICAgICAgIGlm\nICh1c2VzQ2xzU3RyaW5nID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAg\nICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIFN0cmluZy5j\nbGFzcyB9OwogICAgICAgICAgICBlbHNlIGlmICh1c2VzQ2xzU3RyaW5nID09\nIEJvb2xlYW4uRkFMU0UpCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IENs\nYXNzW117IFN0cmluZy5jbGFzcyB9OwogICAgICAgIH0gZWxzZSBpZiAoX21l\ndGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewogICAgICAgICAgICAvLyBuZXcg\nPHR5cGU+SWRlbnRpdHkgKFhYWC5jbGFzcywgPHBrPik7CiAgICAgICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAg\nICBGaWVsZE1ldGFEYXRhIHBrID0gX21ldGEuZ2V0UHJpbWFyeUtleUZpZWxk\ncygpWzBdOwogICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNv\nZGUsIHBrKTsKICAgICAgICAgICAgaWYgKHBrLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICBhZGRFeHRy\nYWN0T2JqZWN0SWRGaWVsZFZhbHVlQ29kZShjb2RlLCBwayk7CiAgICAgICAg\nICAgIGlmIChfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSA9PSBPYmplY3RJZC5j\nbGFzcykKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgQ2xh\nc3MuY2xhc3MsIE9iamVjdC5jbGFzcyB9OwogICAgICAgICAgICBlbHNlIGlm\nIChfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSA9PSBEYXRlLmNsYXNzKQogICAg\nICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywg\nRGF0ZS5jbGFzcyB9OwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBhcmdzID0gbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBway5nZXRPYmpl\nY3RJZEZpZWxkVHlwZSgpIH07CiAgICAgICAgfQoKICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qob2lkVHlwZSwgIjxpbml0PiIsIHZv\naWQuY2xhc3MsIGFyZ3MpOwogICAgICAgIGlmICghX21ldGEuaXNPcGVuSlBB\nSWRlbnRpdHkoKSAmJiBfbWV0YS5pc09iamVjdElkVHlwZVNoYXJlZCgpKQog\nICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoT2Jq\nZWN0SWQuY2xhc3MsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgdm9pZC5j\nbGFzcywgbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBPYmplY3QuY2xhc3Mg\nfSk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogV2hlbiBjb21tdW5pY2F0\naW5nIHdpdGggdGhlIFN0YXRlTWFuYWdlciwgbWFueSBtZXRob2RzIGFyZSB1\nc2VkCiAgICAgKiBkZXBlbmRpbmcgb24gdGhlIGNsYXNzIG9mIHN0YXRlIGJl\naW5nIHBhc3NlZC4gVGhpcyBtZXRob2QsCiAgICAgKiBnaXZlbiB0aGUgdHlw\nZSBvZiBpbmZvcm1hdGlvbiBiZWluZyBwYXNzZWQgYW5kIHRoZSBwcmVmaXgK\nICAgICAqICgncHJvdmlkZWQnLCAncmVwbGFjZScsIGV0Yykgb2YgdGhlIG1l\ndGhvZCB0bwogICAgICogY2FsbCwgcmV0dXJucyB0aGUgU3RhdGVNYW5hZ2Vy\nIG1ldGhvZCB0aGF0IHNob3VsZCBiZSB1c2VkLgogICAgICoKICAgICAqIEBw\nYXJhbSB0eXBlIHRoZSB0eXBlIG9mIHN0YXRlIGJlaW5nIHBhc3NlZAogICAg\nICogQHBhcmFtIHByZWZpeCB0aGUgcHJlZml4IG9mIHRoZSBtZXRob2QgdG8g\nY2FsbDsgYWxsIG1ldGhvZHMKICAgICAqIGVuZCBpbiAnW3N0YXRlIHR5cGVd\nRmllbGQnOyBvbmx5IHRoZSBwcmVmaXggdmFyaWVzCiAgICAgKiBAcGFyYW0g\nZ2V0IHRydWUgaWYgcmVjZWl2aW5nIGluZm9ybWF0aW9uIGZyb20gdGhlCiAg\nICAgKiBTdGF0ZU1hbmFnZXIsIGZhbHNlIGlmIHBhc3NpbmcgaXQgdG8gdGhl\nIFNNCiAgICAgKiBAcGFyYW0gY3VyVmFsdWUgdHJ1ZSBpZiB0aGUgY3VycmVu\ndCBzdGF0ZSB2YWx1ZSBpcyBwYXNzZWQgdG8KICAgICAqIHRoZSBTdGF0ZU1h\nbmFnZXIgYXMgYW4gZXh0cmEgYXJndW1lbnQKICAgICAqLwogICAgcHJpdmF0\nZSBNZXRob2QgZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kKENsYXNzIHR5cGUsIFN0\ncmluZyBwcmVmaXgsCiAgICAgICAgYm9vbGVhbiBnZXQsIGJvb2xlYW4gY3Vy\nVmFsdWUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIGdldE1ldGhvZChTTVRZUEUsIHR5cGUsIHByZWZp\neCwgZ2V0LCB0cnVlLCBjdXJWYWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIG1ldGhvZCBvZiB0aGUgZ2l2ZW4gb3duZXIgdHlwZSBt\nYXRjaGluZyB0aGUgZ2l2ZW4gY3JpdGVyaWEuCiAgICAgKgogICAgICogQHBh\ncmFtIHR5cGUgdGhlIHR5cGUgb2Ygc3RhdGUgYmVpbmcgcGFzc2VkCiAgICAg\nKiBAcGFyYW0gcHJlZml4IHRoZSBwcmVmaXggb2YgdGhlIG1ldGhvZCB0byBj\nYWxsOyBhbGwgbWV0aG9kcwogICAgICogZW5kIGluICdbc3RhdGUgdHlwZV1G\naWVsZCc7IG9ubHkgdGhlIHByZWZpeCB2YXJpZXMKICAgICAqIEBwYXJhbSBn\nZXQgdHJ1ZSBpZiByZWNlaXZpbmcgaW5mb3JtYXRpb24gZnJvbSB0aGUKICAg\nICAqIG93bmVyLCBmYWxzZSBpZiBwYXNzaW5nIGl0IHRvIHRoZSBvd25lcgog\nICAgICogQHBhcmFtIGhhc3BjIHRydWUgaWYgdGhlIHBjIGlzIHBhc3NlZCBh\ncyBhbiBleHRyYSBhcmd1bWVudAogICAgICogQHBhcmFtIGN1clZhbHVlIHRy\ndWUgaWYgdGhlIGN1cnJlbnQgc3RhdGUgdmFsdWUgaXMgcGFzc2VkIHRvCiAg\nICAgKiB0aGUgb3duZXIgYXMgYW4gZXh0cmEgYXJndW1lbnQKICAgICAqLwog\nICAgcHJpdmF0ZSBNZXRob2QgZ2V0TWV0aG9kKENsYXNzIG93bmVyLCBDbGFz\ncyB0eXBlLCBTdHJpbmcgcHJlZml4LAogICAgICAgIGJvb2xlYW4gZ2V0LCBi\nb29sZWFuIGhhc3BjLCBib29sZWFuIGN1clZhbHVlKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIGFsbCBtZXRo\nb2RzIGVuZCBpbiBbZmllbGQgdHlwZV1GaWVsZCwgd2hlcmUgdGhlIGZpZWxk\nIHR5cGUKICAgICAgICAvLyBjYW4gYmUgYW55IG9mIHRoZSBwcmltaXR2ZSB0\neXBlcyAoYnV0IGNhcGl0YWxpemVkKSwgJ1N0cmluZycsCiAgICAgICAgLy8g\nb3IgJ09iamVjdCc7IGZpZ3VyZSBvdXQgd2hhdCB0eXBlIHRvIHVzZQogICAg\nICAgIFN0cmluZyB0eXBlTmFtZSA9IHR5cGUuZ2V0TmFtZSgpOwogICAgICAg\nIGlmICh0eXBlLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgIHR5cGVOYW1l\nID0gdHlwZU5hbWUuc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJDYXNlKCkKICAg\nICAgICAgICAgICAgICsgdHlwZU5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAg\nIGVsc2UgaWYgKHR5cGUuZXF1YWxzKFN0cmluZy5jbGFzcykpCiAgICAgICAg\nICAgIHR5cGVOYW1lID0gIlN0cmluZyI7CiAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgIHR5cGVOYW1lID0gIk9iamVjdCI7CiAgICAgICAgICAgIHR5cGUg\nPSBPYmplY3QuY2xhc3M7CiAgICAgICAgfQoKICAgICAgICAvLyB0aGUgZmll\nbGQgaW5kZXggaXMgYWx3YXlzIHBhc3NlZCBhcyBhbiBhcmc7IHRoZSBwYyBp\nbnN0YW5jZSBhbmQKICAgICAgICAvLyB0aGUgY3VycmVudCB2YWx1ZSBtYXkg\nYmUgcGFzc2VkOyBpZiBzZXR0aW5nIHRoZSBuZXcgdmFsdWUgaXMKICAgICAg\nICAvLyBhbHNvIHBhc3NlZAogICAgICAgIExpc3QgcGxpc3QgPSBuZXcgQXJy\nYXlMaXN0KDQpOwogICAgICAgIGlmIChoYXNwYykKICAgICAgICAgICAgcGxp\nc3QuYWRkKFBDVFlQRSk7CiAgICAgICAgcGxpc3QuYWRkKGludC5jbGFzcyk7\nCiAgICAgICAgaWYgKCFnZXQgfHwgY3VyVmFsdWUpCiAgICAgICAgICAgIHBs\naXN0LmFkZCh0eXBlKTsKICAgICAgICBpZiAoIWdldCAmJiBjdXJWYWx1ZSkg\newogICAgICAgICAgICBwbGlzdC5hZGQodHlwZSk7CiAgICAgICAgICAgIHBs\naXN0LmFkZChpbnQuY2xhc3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gdXNl\nIHJlZmxlY3Rpb24gdG8gcmV0dXJuIHRoZSByaWdodCBtZXRob2QKICAgICAg\nICBTdHJpbmcgbmFtZSA9IHByZWZpeCArIHR5cGVOYW1lICsgIkZpZWxkIjsK\nICAgICAgICBDbGFzc1tdIHBhcmFtcyA9IChDbGFzc1tdKSBwbGlzdC50b0Fy\ncmF5KG5ldyBDbGFzc1twbGlzdC5zaXplKCldKTsKICAgICAgICAKICAgICAg\nICB0cnkgewogICAgICAgICAgICByZXR1cm4gKE1ldGhvZCkgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbihvd25lciwgbmFtZSwg\ncGFyYW1zKSk7CiAgICAgICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFjdGlvbkV4\nY2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAgIHRocm93IChOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24pIHBhZS5nZXRFeGNlcHRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCB0aGUg\nY29kZSBuZWNlc3NhcnkgdG8gdGhyb3cgdGhlIGdpdmVuCiAgICAgKiBleGNl\ncHRpb24gdHlwZSwgc2FucyBtZXNzYWdlLgogICAgICovCiAgICBwcml2YXRl\nIEluc3RydWN0aW9uIHRocm93RXhjZXB0aW9uKENvZGUgY29kZSwgQ2xhc3Mg\ndHlwZSkgewogICAgICAgIEluc3RydWN0aW9uIGlucyA9IGNvZGUuYW5ldygp\nLnNldFR5cGUodHlwZSk7CiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBj\nb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QodHlwZSwgIjxpbml0PiIs\nIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIGNvZGUuYXRocm93KCk7CiAg\nICAgICAgcmV0dXJuIGluczsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMg\ndGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRlcmZhY2UgdG8gdGhlIGNsYXNz\nIGJlaW5nCiAgICAgKiBlbmhhbmNlZCwgYW5kIGFkZHMgYSBkZWZhdWx0IGNv\nbnN0cnVjdG9yIGZvciB1c2UgYnkgT3BlbkpQQQogICAgICogaWYgaXQgaXMg\nbm90IGFscmVhZHkgcHJlc2VudC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGVuaGFuY2VDbGFzcygpIHsKICAgICAgICAvLyBtYWtlIHRoZSBjbGFzcyBp\nbXBsZW1lbnQgUGVyc2lzdGVuY2VDYXBhYmxlCiAgICAgICAgX3BjLmRlY2xh\ncmVJbnRlcmZhY2UoUENUWVBFKTsKCiAgICAgICAgLy8gYWRkIGEgdmVyc2lv\nbiBzdGFtcAogICAgICAgIGFkZEdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJz\naW9uTWV0aG9kKCk7CgogICAgICAgIC8vIGZpbmQgdGhlIGRlZmF1bHQgY29u\nc3RydWN0b3IKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZ2V0RGVj\nbGFyZWRNZXRob2QoIjxpbml0PiIsIChTdHJpbmdbXSkgbnVsbCk7CgogICAg\nICAgIC8vIGEgZGVmYXVsdCBjb25zdHJ1Y3RvciBpcyByZXF1aXJlZAogICAg\nICAgIGlmIChtZXRob2QgPT0gbnVsbCkgewogICAgICAgICAgICBTdHJpbmcg\nbmFtZSA9IF9wYy5nZXROYW1lKCk7CiAgICAgICAgICAgIGlmICghX2RlZkNv\nbnMpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgiZW5oYW5jZS1kZWZhdWx0Y29uc3QiLCBuYW1lKSk7CgogICAg\nICAgICAgICBtZXRob2QgPSBfcGMuYWRkRGVmYXVsdENvbnN0cnVjdG9yKCk7\nCiAgICAgICAgICAgIFN0cmluZyBhY2Nlc3M7CiAgICAgICAgICAgIGlmIChf\nbWV0YS5pc0RldGFjaGFibGUoKSkgewogICAgICAgICAgICAgICAgLy8gZXh0\nZXJuYWxpemFibGUgcmVxdWlyZXMgdGhhdCB0aGUgY29uc3RydWN0b3IKICAg\nICAgICAgICAgICAgIC8vIGJlIHB1YmxpYywgc28gbWFrZSB0aGUgYWRkZWQg\nY29uc3RydWN0b3IgcHVibGljCiAgICAgICAgICAgICAgICBtZXRob2QubWFr\nZVB1YmxpYygpOwogICAgICAgICAgICAgICAgYWNjZXNzID0gInB1YmxpYyI7\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3BjLmlzRmluYWwoKSkgewogICAg\nICAgICAgICAgICAgbWV0aG9kLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAg\nICAgICBhY2Nlc3MgPSAicHJpdmF0ZSI7CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgpOwogICAg\nICAgICAgICAgICAgYWNjZXNzID0gInByb3RlY3RlZCI7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgaWYgKCEoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nLmlzSW50ZXJmYWNlKCkgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSkKICAgICAg\nICAgICAgICAgICYmIF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhhbmNlLWFkZGRlZmF1bHRj\nb25zdCIsIG5hbWUsIGFjY2VzcykpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZHMgdGhlIGZvbGxvd2luZyBmaWVsZHMgdG8gdGhlIFBl\ncnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZToKICAgICAqIDx1bD4KICAgICAq\nIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBpbnQgcGNJbmhlcml0ZWRGaWVs\nZENvdW50PC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBz\ndGF0aWMgQ2xhc3MgcGNQQ1N1cGVyY2xhc3M8L2NvZGU+CiAgICAgKiA8L2xp\nPgogICAgICogPGxpPjxjb2RlPnByaXZhdGUgc3RhdGljIFN0cmluZ1tdIHBj\nRmllbGROYW1lczwvY29kZT48L2xpPgogICAgICogPGxpPjxjb2RlPnByaXZh\ndGUgc3RhdGljIENsYXNzW10gcGNGaWVsZFR5cGVzPC9jb2RlPjwvbGk+CiAg\nICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgYnl0ZVtdIHBjRmllbGRG\nbGFnczwvY29kZT48L2xpPgogICAgICogPGxpPjxjb2RlPnByb3RlY3RlZCB0\ncmFuc2llbnQgU3RhdGVNYW5hZ2VyIHBjU3RhdGVNYW5hZ2VyPC9jb2RlPgog\nICAgICogaWYgbm8gUGVyc2lzdGVuY2VDYXBhYmxlIHN1cGVyY2xhc3MgcHJl\nc2VudCk8L2xpPgogICAgICogPC91bD4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZEZpZWxkcygpIHsKICAgICAgICBfcGMuZGVjbGFyZUZpZWxkKElO\nSEVSSVQsIGludC5jbGFzcykuc2V0U3RhdGljKHRydWUpOwogICAgICAgIF9w\nYy5kZWNsYXJlRmllbGQoUFJFICsgIkZpZWxkTmFtZXMiLCBTdHJpbmdbXS5j\nbGFzcykuc2V0U3RhdGljKHRydWUpOwogICAgICAgIF9wYy5kZWNsYXJlRmll\nbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNzKS5zZXRTdGF0\naWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVsZChQUkUgKyAiRmll\nbGRGbGFncyIsIGJ5dGVbXS5jbGFzcykuc2V0U3RhdGljKHRydWUpOwogICAg\nICAgIF9wYy5kZWNsYXJlRmllbGQoU1VQRVIsIENsYXNzLmNsYXNzKS5zZXRT\ndGF0aWModHJ1ZSk7CgogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xh\nc3MoKSA9PSBudWxsIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAg\nICAgICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5kZWNsYXJlRmllbGQoU00sIFNN\nVFlQRSk7CiAgICAgICAgICAgIGZpZWxkLm1ha2VQcm90ZWN0ZWQoKTsKICAg\nICAgICAgICAgZmllbGQuc2V0VHJhbnNpZW50KHRydWUpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIE1vZGlmaWVzIHRoZSBjbGFzcyBpbml0\naWFsaXphdGlvbiBtZXRob2QgKGNyZWF0aW5nIG9uZSBpZiBuZWNlc3Nhcnkp\nCiAgICAgKiB0byBpbml0aWFsaXplIHRoZSBzdGF0aWMgZmllbGRzIG9mIHRo\nZSBQZXJzaXN0ZW5jZUNhcGFibGUgaW5zdGFuY2UgYW5kCiAgICAgKiB0byBy\nZWdpc3RlciBpdCB3aXRoIHRoZSBpbXBsIGhlbHBlci4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZFN0YXRpY0luaXRpYWxpemVyKCkgewogICAgICAg\nIENvZGUgY29kZSA9IGdldE9yQ3JlYXRlQ2xhc3NJbml0Q29kZSh0cnVlKTsK\nICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVsbCkg\newogICAgICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAg\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDApOwogICAg\nICAgICAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklU\nLCBpbnQuY2xhc3MpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgLy8gcGNJbmhlcml0ZWRGaWVsZENvdW50ID0gPHN1cGVyQ2xhc3M+\nLnBjR2V0TWFuYWdlZEZpZWxkQ291bnQoKQogICAgICAgICAgICAgICAgY29k\nZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAg\nICAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS5n\nZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgUFJFICsgIkdldE1hbmFn\nZWRGaWVsZENvdW50IiwgaW50LmNsYXNzLmdldE5hbWUoKSwgbnVsbCk7CiAg\nICAgICAgICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKElOSEVS\nSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIHBjUENTdXBlcmNsYXNzID0gPHN1cGVyQ2xhc3M+OwogICAgICAgICAgICBj\nb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhnZXRUeXBlKF9tZXRhLgog\nICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkpOwog\nICAgICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKFNVUEVSLCBD\nbGFzcy5jbGFzcyk7CiAgICAgICAgfQoKICAgICAgICAvLyBwY0ZpZWxkTmFt\nZXMgPSBuZXcgU3RyaW5nW10geyAiPG5hbWUxPiIsICI8bmFtZTI+IiwgLi4u\nIH07CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRE\nZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZShmbWRzLmxlbmd0aCk7CiAgICAgICAgY29kZS5hbmV3YXJyYXkoKS5z\nZXRUeXBlKFN0cmluZy5jbGFzcyk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvZGUuZHVw\nKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsK\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZHNbaV0u\nZ2V0TmFtZSgpKTsKICAgICAgICAgICAgY29kZS5hYXN0b3JlKCk7CiAgICAg\nICAgfQogICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoUFJFICsg\nIkZpZWxkTmFtZXMiLCBTdHJpbmdbXS5jbGFzcyk7CgogICAgICAgIC8vIHBj\nRmllbGRUeXBlcyA9IG5ldyBDbGFzc1tdIHsgPHR5cGUxPi5jbGFzcywgPHR5\ncGUyPi5jbGFzcywgLi4uIH07CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGZtZHMubGVuZ3RoKTsKICAgICAgICBjb2RlLmFuZXdhcnJheSgp\nLnNldFR5cGUoQ2xhc3MuY2xhc3MpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb2RlLmR1\ncCgpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7\nCiAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGZt\nZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICBjb2RlLmFh\nc3RvcmUoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5z\nZXRGaWVsZChQUkUgKyAiRmllbGRUeXBlcyIsIENsYXNzW10uY2xhc3MpOwoK\nICAgICAgICAvLyBwY0ZpZWxkRmxhZ3MgPSBuZXcgYnl0ZVtdIHsgPGZsYWcx\nPiwgPGZsYWcyPiwgLi4uIH07CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGZtZHMubGVuZ3RoKTsKICAgICAgICBjb2RlLm5ld2FycmF5KCku\nc2V0VHlwZShieXRlLmNsYXNzKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29kZS5kdXAo\nKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwog\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZ2V0RmllbGRG\nbGFnKGZtZHNbaV0pKTsKICAgICAgICAgICAgY29kZS5iYXN0b3JlKCk7CiAg\nICAgICAgfQogICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoUFJF\nICsgIkZpZWxkRmxhZ3MiLCBieXRlW10uY2xhc3MpOwoKICAgICAgICAvLyBQ\nQ1JlZ2lzdHJ5LnJlZ2lzdGVyIChjbHMsCiAgICAgICAgLy8JcGNGaWVsZE5h\nbWVzLCBwY0ZpZWxkVHlwZXMsIHBjRmllbGRGbGFncywKICAgICAgICAvLyAg\ncGNQQ1N1cGVyY2xhc3MsIGFsaWFzLCBuZXcgWFhYICgpKTsKICAgICAgICBj\nb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhfbWFuYWdlZFR5cGUpOwog\nICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoUFJFICsgIkZpZWxk\nTmFtZXMiLCBTdHJpbmdbXS5jbGFzcyk7CiAgICAgICAgY29kZS5nZXRzdGF0\naWMoKS5zZXRGaWVsZChQUkUgKyAiRmllbGRUeXBlcyIsIENsYXNzW10uY2xh\nc3MpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoUFJFICsg\nIkZpZWxkRmxhZ3MiLCBieXRlW10uY2xhc3MpOwogICAgICAgIGNvZGUuZ2V0\nc3RhdGljKCkuc2V0RmllbGQoU1VQRVIsIENsYXNzLmNsYXNzKTsKICAgICAg\nICAKICAgICAgICBpZiAoX21ldGEuaXNNYXBwZWQoKSkKICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKF9tZXRhLmdldFR5cGVBbGlhcygp\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXROdWxsKCk7CgogICAgICAgIGlmIChfcGMuaXNBYnN0cmFjdCgpKQogICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGVs\nc2UgewogICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKF9wYyk7CiAg\nICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVs\nbCk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChIRUxQRVJUWVBFLCAicmVnaXN0ZXIiLCB2b2lkLmNsYXNzLAog\nICAgICAgICAgICBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIFN0cmluZ1td\nLmNsYXNzLCBDbGFzc1tdLmNsYXNzLAogICAgICAgICAgICAgICAgYnl0ZVtd\nLmNsYXNzLCBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBQQ1RZUEUgfSk7\nCgogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgZmxhZyBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBieXRlIGdldEZpZWxkRmxhZyhGaWVsZE1ldGFEYXRhIGZt\nZCkgewogICAgICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpID09IEZpZWxk\nTWV0YURhdGEuTUFOQUdFX05PTkUpCiAgICAgICAgICAgIHJldHVybiAtMTsK\nCiAgICAgICAgYnl0ZSBmbGFncyA9IDA7CiAgICAgICAgaWYgKGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKS5pc1ByaW1pdGl2ZSgpCiAgICAgICAgICAgIHx8IFNl\ncmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSkpCiAgICAgICAgICAgIGZsYWdzID0gUGVyc2lzdGVuY2VD\nYXBhYmxlLlNFUklBTElaQUJMRTsKCiAgICAgICAgaWYgKGZtZC5nZXRNYW5h\nZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfVFJBTlNBQ1RJT05B\nTCkKICAgICAgICAgICAgZmxhZ3MgfD0gUGVyc2lzdGVuY2VDYXBhYmxlLkNI\nRUNLX1dSSVRFOwogICAgICAgIGVsc2UgaWYgKCFmbWQuaXNQcmltYXJ5S2V5\nKCkgJiYgIWZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAg\nICAgZmxhZ3MgfD0gUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNLX1dSSVRFCiAg\nICAgICAgICAgICAgICB8IFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19SRUFE\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZmxhZ3MgfD0gUGVyc2lzdGVu\nY2VDYXBhYmxlLk1FRElBVEVfV1JJVEUKICAgICAgICAgICAgICAgIHwgUGVy\nc2lzdGVuY2VDYXBhYmxlLk1FRElBVEVfUkVBRDsKICAgICAgICByZXR1cm4g\nZmxhZ3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBjb2RlIHRv\nIHByb3Blcmx5IGhhbmRsZSBQZXJzaXN0ZW5jZUNhcGFibGUgc2VyaWFsaXph\ndGlvbgogICAgICogdG8gdGhlIGJ5dGVjb2RlLiBUaGlzIGluY2x1ZGVzIGNy\nZWF0aW5nIGFuZCBpbml0aWFsaXppbmcgdGhlCiAgICAgKiBzdGF0aWMgPGNv\nZGU+c2VyaWFsVmVyc2lvblVJRDwvY29kZT4gY29uc3RhbnQgaWYgbm90IGFs\ncmVhZHkgZGVmaW5lZCwKICAgICAqIGFzIHdlbGwgYXMgY3JlYXRpbmcgYSBj\ndXN0b20gPGNvZGU+d3JpdGVPYmplY3Q8L2NvZGU+IG1ldGhvZCBpZiB0aGUK\nICAgICAqIGNsYXNzIGlzIFNlcmlhbGl6YWJsZSBhbmQgZG9lcyBub3QgZGVm\naW5lIHRoZW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTZXJpYWxp\nemF0aW9uQ29kZSgpIHsKICAgICAgICBpZiAoZXh0ZXJuYWxpemVEZXRhY2hl\nZCgpCiAgICAgICAgICAgIHx8ICFTZXJpYWxpemFibGUuY2xhc3MuaXNBc3Np\nZ25hYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygp\nKSB7CiAgICAgICAgICAgIGlmICghRXh0ZXJuYWxpemFibGUuY2xhc3MuaXNB\nc3NpZ25hYmxlRnJvbSgKICAgICAgICAgICAgICAgIF9tZXRhLmdldERlc2Ny\naWJlZFR5cGUoKSkpCiAgICAgICAgICAgICAgICBhZGRTdWJjbGFzc1Nlcmlh\nbGl6YXRpb25Db2RlKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIC8vIGlmIG5vdCBhbHJlYWR5IHByZXNlbnQsIGFkZCBhIHNl\ncmlhbFZlcnNpb25VSUQgZmllbGQ7IGlmIHRoZSBpbnN0YW5jZQogICAgICAg\nIC8vIGlzIGRldGFjaGFibGUgYW5kIHVzZXMgZGV0YWNoZWQgc3RhdGUgd2l0\naG91dCBhIGRlY2xhcmVkIGZpZWxkLAogICAgICAgIC8vIGNhbid0IGFkZCBh\nIHNlcmlhbCB2ZXJzaW9uIFVJRCBiZWNhdXNlIHdlJ2xsIGJlIGFkZGluZyBl\neHRyYSBmaWVsZHMKICAgICAgICAvLyB0byB0aGUgZW5oYW5jZWQgdmVyc2lv\nbgogICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMuZ2V0RGVjbGFyZWRGaWVs\nZCgic2VyaWFsVmVyc2lvblVJRCIpOwogICAgICAgIGlmIChmaWVsZCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIExvbmcgdWlkID0gbnVsbDsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIHVpZCA9IE51bWJlcnMudmFsdWVP\nZihPYmplY3RTdHJlYW1DbGFzcy5sb29rdXAKICAgICAgICAgICAgICAgICAg\nICAoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKS5nZXRTZXJpYWxWZXJzaW9u\nVUlEKCkpOwogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewog\nICAgICAgICAgICAgICAgLy8gbGFzdC1jaGFuY2UgY2F0Y2ggZm9yIGJ1ZyAj\nMjgzICh3aGljaCBjYW4gaGFwcGVuCiAgICAgICAgICAgICAgICAvLyBpbiBh\nIHZhcmlldHkgb2YgQ2xhc3NMb2FkaW5nIGVudmlyb25tZW50cykKICAgICAg\nICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhhbmNlLXVpZC1h\nY2Nlc3MiLCBfbWV0YSksIHQpOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZW5oYW5jZS11\naWQtYWNjZXNzIiwgX21ldGEpKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gaWYgd2UgY291bGRuJ3QgYWNjZXNzIHRoZSBzZXJpYWxWZXJzaW9u\nVUlELCB3ZSB3aWxsIGhhdmUgdG8KICAgICAgICAgICAgLy8gc2tpcCB0aGUg\nb3ZlcnJpZGUgb2YgdGhhdCBmaWVsZCBhbmQgbm90IGJlIHNlcmlhbGl6YXRp\nb24KICAgICAgICAgICAgLy8gY29tcGF0aWJsZSB3aXRoIG5vbi1lbmhhbmNl\nZCBjbGFzc2VzCiAgICAgICAgICAgIGlmICh1aWQgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxkKCJzZXJpYWxW\nZXJzaW9uVUlEIiwgbG9uZy5jbGFzcyk7CiAgICAgICAgICAgICAgICBmaWVs\nZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICAgICAgZmllbGQuc2V0U3Rh\ndGljKHRydWUpOwogICAgICAgICAgICAgICAgZmllbGQuc2V0RmluYWwodHJ1\nZSk7CgogICAgICAgICAgICAgICAgQ29kZSBjb2RlID0gZ2V0T3JDcmVhdGVD\nbGFzc0luaXRDb2RlKGZhbHNlKTsKICAgICAgICAgICAgICAgIGNvZGUuYmVm\nb3JlRmlyc3QoKTsKICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZSh1aWQubG9uZ1ZhbHVlKCkpOwogICAgICAgICAgICAgICAgY29k\nZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChmaWVsZCk7CgogICAgICAgICAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyBhZGQgd3JpdGUgb2JqZWN0IG1ldGhvZAog\nICAgICAgIEJDTWV0aG9kIHdyaXRlID0gX3BjLmdldERlY2xhcmVkTWV0aG9k\nKCJ3cml0ZU9iamVjdCIsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBPYmpl\nY3RPdXRwdXRTdHJlYW0uY2xhc3MgfSk7CiAgICAgICAgYm9vbGVhbiBmdWxs\nID0gd3JpdGUgPT0gbnVsbDsKICAgICAgICBpZiAoZnVsbCkgewogICAgICAg\nICAgICAvLyBwcml2YXRlIHZvaWQgd3JpdGVPYmplY3QgKE9iamVjdE91dHB1\ndFN0cmVhbSBvdXQpCiAgICAgICAgICAgIHdyaXRlID0gX3BjLmRlY2xhcmVN\nZXRob2QoIndyaXRlT2JqZWN0Iiwgdm9pZC5jbGFzcywKICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdeyBPYmplY3RPdXRwdXRTdHJlYW0uY2xhc3MgfSk7\nCiAgICAgICAgICAgIHdyaXRlLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhj\nZXB0aW9uKElPRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAgICAgd3JpdGUu\nbWFrZVByaXZhdGUoKTsKICAgICAgICB9CiAgICAgICAgbW9kaWZ5V3JpdGVP\nYmplY3RNZXRob2Qod3JpdGUsIGZ1bGwpOwoKICAgICAgICAvLyBhbmQgcmVh\nZCBvYmplY3QKICAgICAgICBCQ01ldGhvZCByZWFkID0gX3BjLmdldERlY2xh\ncmVkTWV0aG9kKCJyZWFkT2JqZWN0IiwKICAgICAgICAgICAgbmV3IENsYXNz\nW117IE9iamVjdElucHV0U3RyZWFtLmNsYXNzIH0pOwogICAgICAgIGZ1bGwg\nPSByZWFkID09IG51bGw7CiAgICAgICAgaWYgKGZ1bGwpIHsKICAgICAgICAg\nICAgLy8gcHJpdmF0ZSB2b2lkIHJlYWRPYmplY3QgKE9iamVjdElucHV0U3Ry\nZWFtIGluKQogICAgICAgICAgICByZWFkID0gX3BjLmRlY2xhcmVNZXRob2Qo\nInJlYWRPYmplY3QiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3\nIENsYXNzW117IE9iamVjdElucHV0U3RyZWFtLmNsYXNzIH0pOwogICAgICAg\nICAgICByZWFkLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uKElP\nRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAgICAgcmVhZC5nZXRFeGNlcHRp\nb25zKHRydWUpLmFkZEV4Y2VwdGlvbgogICAgICAgICAgICAgICAgKENsYXNz\nTm90Rm91bmRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICByZWFkLm1h\na2VQcml2YXRlKCk7CiAgICAgICAgfQogICAgICAgIG1vZGlmeVJlYWRPYmpl\nY3RNZXRob2QocmVhZCwgZnVsbCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIGFkZFN1YmNsYXNzU2VyaWFsaXphdGlvbkNvZGUoKSB7CiAgICAgICAgLy8g\nZm9yIGdlbmVyYXRlZCBzdWJjbGFzc2VzLCBzZXJpYWxpemF0aW9uIG11c3Qg\nd3JpdGUgYW4gaW5zdGFuY2Ugb2YKICAgICAgICAvLyB0aGUgc3VwZXJjbGFz\ncyBpbnN0ZWFkIG9mIHRoZSBzdWJjbGFzcywgc28gdGhhdCB0aGUgY2xpZW50\nIFZNIGNhbgogICAgICAgIC8vIGRlc2VyaWFsaXplIHN1Y2Nlc3NmdWxseS4K\nCiAgICAgICAgLy8gcHJpdmF0ZSBPYmplY3Qgd3JpdGVSZXBsYWNlKCkgdGhy\nb3dzIE9iamVjdFN0cmVhbUV4Y2VwdGlvbgogICAgICAgIEJDTWV0aG9kIG1l\ndGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKCJ3cml0ZVJlcGxhY2UiLCBPYmpl\nY3QuY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5nZXRFeGNlcHRpb25z\nKHRydWUpLmFkZEV4Y2VwdGlvbihPYmplY3RTdHJlYW1FeGNlcHRpb24uY2xh\nc3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUp\nOwoKICAgICAgICAvLyBPYmplY3QgbyA9IG5ldyA8bWFuYWdlZC10eXBlPigp\nCiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShfbWFuYWdlZFR5cGUpOyAv\nLyBmb3IgcmV0dXJuCiAgICAgICAgY29kZS5kdXAoKTsgLy8gZm9yIHBvc3Qt\nPGluaXQ+IHdvcmsKICAgICAgICBjb2RlLmR1cCgpOyAvLyBmb3IgPGluaXQ+\nCiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9tYW5h\nZ2VkVHlwZS5nZXRUeXBlKCksICI8aW5pdD4iLAogICAgICAgICAgICB2b2lk\nLmNsYXNzLCBudWxsKTsKCiAgICAgICAgLy8gY29weSBhbGwgdGhlIGZpZWxk\ncy4KICAgICAgICAvLyAjIyMjIyBsaW1pdGluZyB0byBKUEEgQFRyYW5zaWVu\ndCBsaW1pdGF0aW9ucwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0g\nX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChmbWRzW2ld\nLmlzVHJhbnNpZW50KCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgLy8gby48ZmllbGQ+ID0gdGhpcy48ZmllbGQ+IChvciByZWZs\nZWN0aXZlIGFuYWxvZykKICAgICAgICAgICAgY29kZS5kdXAoKTsgLy8gZm9y\nIHB1dGZpZWxkCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7\nIC8vIGZvciBnZXRmaWVsZAogICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBf\nbWFuYWdlZFR5cGUsIGZtZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAg\ncHV0ZmllbGQoY29kZSwgX21hbmFnZWRUeXBlLCBmbWRzW2ldLmdldE5hbWUo\nKSwKICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkp\nOwogICAgICAgIH0KCiAgICAgICAgY29kZS5hcmV0dXJuKCkuc2V0VHlwZShP\nYmplY3QuY2xhc3MpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGNsYXNzIGJlaW5nIGVuaGFu\nY2VkIHNob3VsZCBleHRlcm5hbGl6ZSB0byBhIGRldGFjaGVkCiAgICAgKiBp\nbnN0YW5jZSByYXRoZXIgdGhhbiBzZXJpYWxpemUuCiAgICAgKi8KICAgIHBy\naXZhdGUgYm9vbGVhbiBleHRlcm5hbGl6ZURldGFjaGVkKCkgewogICAgICAg\nIHJldHVybiBDbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVhbHMoX21ldGEu\nZ2V0RGV0YWNoZWRTdGF0ZSgpKQogICAgICAgICAgICAmJiBTZXJpYWxpemFi\nbGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRU\neXBlKCkpCiAgICAgICAgICAgICYmICFfcmVwb3MuZ2V0Q29uZmlndXJhdGlv\nbigpLmdldERldGFjaFN0YXRlSW5zdGFuY2UoKS4KICAgICAgICAgICAgaXNE\nZXRhY2hlZFN0YXRlVHJhbnNpZW50KCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIGEgY3VzdG9tIHdyaXRlT2JqZWN0IG1ldGhvZCB0aGF0IGRlbGVn\nYXRlcyB0byB0aGUKICAgICAqIHtAbGluayBPYmplY3RPdXRwdXRTdHJlYW0j\nZGVmYXVsdFdyaXRlT2JqZWN0fSBtZXRob2QsCiAgICAgKiBidXQgb25seSBh\nZnRlciBjYWxsaW5nIHRoZSBpbnRlcm5hbCA8Y29kZT5wY1NlcmlhbGl6aW5n\nPC9jb2RlPiBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBtb2Rp\nZnlXcml0ZU9iamVjdE1ldGhvZChCQ01ldGhvZCBtZXRob2QsIGJvb2xlYW4g\nZnVsbCkgewogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRy\ndWUpOwogICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAgICAgICAgLy8g\nYm9vbCBjbGVhciA9IHBjU2VyaWFsaXppbmcgKCk7CiAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJTZXJpYWxpemluZyIsCiAg\nICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG51bGwpOwogICAgICAgIGludCBj\nbGVhciA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29k\nZS5pc3RvcmUoKS5zZXRMb2NhbChjbGVhcik7CgogICAgICAgIGlmIChmdWxs\nKSB7CiAgICAgICAgICAgIC8vIG91dC5kZWZhdWx0V3JpdGVPYmplY3QgKCk7\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9iamVjdE91\ndHB1dFN0cmVhbS5jbGFzcywKICAgICAgICAgICAgICAgICJkZWZhdWx0V3Jp\ndGVPYmplY3QiLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29k\nZS52cmV0dXJuKCk7CiAgICAgICAgfQoKICAgICAgICBJbnN0cnVjdGlvbiB0\nbXBsYXRlID0gKChDb2RlKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigp\nKSkudnJldHVybigpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiB0b3JldDsK\nICAgICAgICBJbnN0cnVjdGlvbiByZXQ7CiAgICAgICAgY29kZS5iZWZvcmVG\naXJzdCgpOwogICAgICAgIHdoaWxlIChjb2RlLnNlYXJjaEZvcndhcmQodG1w\nbGF0ZSkpIHsKICAgICAgICAgICAgcmV0ID0gY29kZS5wcmV2aW91cygpOwog\nICAgICAgICAgICAvLyBpZiAoY2xlYXIpIHBjU2V0RGV0YWNoZWRTdGF0ZSAo\nbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChjbGVh\ncik7CiAgICAgICAgICAgIHRvcmV0ID0gY29kZS5pZmVxKCk7CiAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIlNldERldGFj\naGVkU3RhdGUiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENs\nYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAgdG9yZXQuc2V0\nVGFyZ2V0KHJldCk7CiAgICAgICAgICAgIGNvZGUubmV4dCgpOyAvLyBqdW1w\nIG92ZXIgcmV0dXJuCiAgICAgICAgfQogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIGN1c3RvbSByZWFkT2Jq\nZWN0IG1ldGhvZCB0aGF0IGRlbGVnYXRlcyB0byB0aGUKICAgICAqIHtAbGlu\nayBPYmplY3RJbnB1dFN0cmVhbSNyZWFkT2JqZWN0fSBtZXRob2QuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBtb2RpZnlSZWFkT2JqZWN0TWV0aG9kKEJD\nTWV0aG9kIG1ldGhvZCwgYm9vbGVhbiBmdWxsKSB7CiAgICAgICAgQ29kZSBj\nb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5iZWZv\ncmVGaXJzdCgpOwoKICAgICAgICAvLyBpZiB0aGlzIGluc3RhbmNlIHVzZXMg\nc3ludGhldGljIGRldGFjaGVkIHN0YXRlLCBub3RlIHRoYXQgaXQgaGFzCiAg\nICAgICAgLy8gYmVlbiBkZXNlcmlhbGl6ZWQKICAgICAgICBpZiAoQ2xhc3NN\nZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKF9tZXRhLmdldERldGFjaGVkU3Rh\ndGUoKSkpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0Rmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLAogICAgICAgICAgICAgICAg\nIkRFU0VSSUFMSVpFRCIsIE9iamVjdC5jbGFzcyk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiU2V0RGV0YWNo\nZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYg\nKGZ1bGwpIHsKICAgICAgICAgICAgLy8gaW4uZGVmYXVsdFJlYWRPYmplY3Qg\nKCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9iamVj\ndElucHV0U3RyZWFtLmNsYXNzLAogICAgICAgICAgICAgICAgImRlZmF1bHRS\nZWFkT2JqZWN0Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNv\nZGUudnJldHVybigpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBwY0lzRGV0\nYWNoZWQoKSBtZXRob2QgdG8gZGV0ZXJtaW5lIGlmIGFuIGluc3RhbmNlCiAg\nICAgKiBpcyBkZXRhY2hlZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZElzRGV0YWNoZWRNZXRob2QoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyBib29sZWFuIHBjSXNE\nZXRhY2hlZCAoKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArICJJc0RldGFjaGVkIiwKICAgICAgICAgICAgQm9v\nbGVhbi5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9kLm1ha2VQdWJsaWMo\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nICAgICAgICB3cml0ZUlzRGV0YWNoZWRNZXRob2QoY29kZSk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVz\nIHRoZSBib2R5IG9mIHRoZSBwY0lzRGV0YWNoZWQoKSBtZXRob2QgdG8gZGV0\nZXJtaW5lIGlmIGFuCiAgICAgKiBpbnN0YW5jZSBpcyBkZXRhY2hlZC4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHdyaXRlSXNEZXRhY2hlZE1ldGhvZChD\nb2RlIGNvZGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gbm90IGRldGFjaGFibGU6IHJldHVybiBCb29sZWFu\nLkZBTFNFCiAgICAgICAgaWYgKCFfbWV0YS5pc0RldGFjaGFibGUoKSkgewog\nICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4u\nY2xhc3MsICJGQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBj\nb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nCiAgICAgICAgLy8gaWYgKHNtICE9IG51bGwpCiAgICAgICAgLy8JCXJldHVy\nbiAoc20uaXNEZXRhY2hlZCAoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFu\nLkZBTFNFOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01U\nWVBFKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlm\nbnVsbCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01U\nWVBFKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhv\nZChTTVRZUEUsICJpc0RldGFjaGVkIiwKICAgICAgICAgICAgYm9vbGVhbi5j\nbGFzcywgbnVsbCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmZmFsc2Ug\nPSBjb2RlLmlmZXEoKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZp\nZWxkKEJvb2xlYW4uY2xhc3MsICJUUlVFIiwgQm9vbGVhbi5jbGFzcyk7CiAg\nICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgaWZmYWxzZS5zZXRUYXJn\nZXQoY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAi\nRkFMU0UiLAogICAgICAgICAgICBCb29sZWFuLmNsYXNzKSk7CiAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CgogICAgICAgIC8vIGlmIHdlIHVzZSBkZXRhY2hl\nZCBzdGF0ZToKICAgICAgICAvLyBpZiAocGNHZXREZXRhY2hlZFN0YXRlICgp\nICE9IG51bGwKICAgICAgICAvLyAgICAgJiYgcGNHZXREZXRhY2hlZFN0YXRl\nICE9IERFU0VSSUFMSVpFRCkKICAgICAgICAvLyAgICAgcmV0dXJuIEJvb2xl\nYW4uVFJVRTsKICAgICAgICBCb29sZWFuIHN0YXRlID0gX21ldGEudXNlc0Rl\ndGFjaGVkU3RhdGUoKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gbm90ZGVz\nZXIgPSBudWxsOwogICAgICAgIEluc3RydWN0aW9uIHRhcmdldDsKICAgICAg\nICBpZiAoc3RhdGUgIT0gQm9vbGVhbi5GQUxTRSkgewogICAgICAgICAgICBp\nZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSkpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAg\nT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgaWZpbnMgPSBjb2Rl\nLmlmbnVsbCgpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAg\nICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUu\nZ2V0c3RhdGljKCkuc2V0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNz\nLAogICAgICAgICAgICAgICAgIkRFU0VSSUFMSVpFRCIsIE9iamVjdC5jbGFz\ncyk7CiAgICAgICAgICAgIG5vdGRlc2VyID0gY29kZS5pZmFjbXBlcSgpOwog\nICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4u\nY2xhc3MsICJUUlVFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNv\nZGUuYXJldHVybigpOwoKICAgICAgICAgICAgaWYgKHN0YXRlID09IEJvb2xl\nYW4uVFJVRSkgewogICAgICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSB0byB1\nc2UgZGV0YWNoZWQgc3RhdGU6CiAgICAgICAgICAgICAgICAvLyByZXR1cm4g\nQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgICAgIHRhcmdldCA9IGNvZGUu\nZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwK\nICAgICAgICAgICAgICAgICAgICBCb29sZWFuLmNsYXNzKTsKICAgICAgICAg\nICAgICAgIGlmaW5zLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAgICAgICAg\nICAgbm90ZGVzZXIuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAgICAg\nICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY3JlYXRlIGFydGlm\naWNpYWwgdGFyZ2V0IHRvIHNpbXBsaWZ5CiAgICAgICAgdGFyZ2V0ID0gY29k\nZS5ub3AoKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAg\nICAgICBpZiAobm90ZGVzZXIgIT0gbnVsbCkKICAgICAgICAgICAgbm90ZGVz\nZXIuc2V0VGFyZ2V0KHRhcmdldCk7CgogICAgICAgIC8vIGFsbG93IHVzZXJz\nIHdpdGggdmVyc2lvbiBmaWVsZHMgdG8gbWFudWFsbHkgY29uc3RydWN0IGEg\nImRldGFjaGVkIgogICAgICAgIC8vIGluc3RhbmNlLCBzbyBjaGVjayB2ZXJz\naW9uIGJlZm9yZSB0YWtpbmcgaW50byBhY2NvdW50IG5vbi1leGlzdGVudAog\nICAgICAgIC8vIGRldGFjaGVkIHN0YXRlCgogICAgICAgIC8vIGNvbnNpZGVy\nIGRldGFjaGVkIGlmIHZlcnNpb24gaXMgbm9uLWRlZmF1bHQKICAgICAgICBG\naWVsZE1ldGFEYXRhIHZlcnNpb24gPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQo\nKTsKICAgICAgICBpZiAoc3RhdGUgIT0gQm9vbGVhbi5UUlVFICYmIHZlcnNp\nb24gIT0gbnVsbCkgewogICAgICAgICAgICAvLyBpZiAoPHZlcnNpb24+ICE9\nIDxkZWZhdWx0PikKICAgICAgICAgICAgLy8JCXJldHVybiB0cnVlOwogICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCB2ZXJzaW9u\nKTsKICAgICAgICAgICAgaWZpbnMgPSBpZkRlZmF1bHRWYWx1ZShjb2RlLCB2\nZXJzaW9uKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVs\nZChCb29sZWFuLmNsYXNzLCAiVFJVRSIsIEJvb2xlYW4uY2xhc3MpOwogICAg\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgaWZpbnMuc2V0\nVGFyZ2V0KGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFz\ncywgIkZBTFNFIiwKICAgICAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MpKTsK\nICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CgogICAgICAgIC8vIG5vIGRldGFjaGVkIHN0YXRlOiBp\nZiBpbnN0YW5jZSB1c2VzIGRldGFjaGVkIHN0YXRlIGFuZCBpdCdzIG5vdAog\nICAgICAgIC8vIHN5bnRoZXRpYyBvciB0aGUgaW5zdGFuY2UgaXMgbm90IHNl\ncmlhbGl6YWJsZSBvciB0aGUgc3RhdGUgaXNuJ3QKICAgICAgICAvLyB0cmFu\nc2llbnQsIG11c3Qgbm90IGJlIGRldGFjaGVkCiAgICAgICAgaWYgKHN0YXRl\nID09IG51bGwKICAgICAgICAgICAgJiYgKCFDbGFzc01ldGFEYXRhLlNZTlRI\nRVRJQy5lcXVhbHMoX21ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgpKQogICAgICAg\nICAgICB8fCAhU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20o\nX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKQogICAgICAgICAgICB8fCAhX3Jl\ncG9zLmdldENvbmZpZ3VyYXRpb24oKS5nZXREZXRhY2hTdGF0ZUluc3RhbmNl\nKCkuCiAgICAgICAgICAgIGlzRGV0YWNoZWRTdGF0ZVRyYW5zaWVudCgpKSkg\newogICAgICAgICAgICAvLyByZXR1cm4gQm9vbGVhbi5GQUxTRQogICAgICAg\nICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3Ms\nICJGQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFy\nZXR1cm4oKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgLy8gbm8gZGV0YWNoZWQgc3RhdGU6IGlmIGluc3RhbmNlIHVzZXMgZGV0\nYWNoZWQgc3RhdGUgKGFuZCBtdXN0IGJlCiAgICAgICAgLy8gc3ludGhldGlj\nIGFuZCB0cmFuc2llbnQgaW4gc2VyaWFsaXphYmxlIGluc3RhbmNlIGF0IHRo\naXMgcG9pbnQpLAogICAgICAgIC8vIG5vdCBkZXRhY2hlZCBpZiBzdGF0ZSBu\nb3Qgc2V0IHRvIERFU0VSSUFMSVpFRAogICAgICAgIGlmIChzdGF0ZSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIC8vIGlmIChwY0dldERldGFjaGVkU3RhdGUg\nKCkgPT0gbnVsbCkgLy8gaW5zdGVhZCBvZiBERVNFUklBTElaRUQKICAgICAg\nICAgICAgLy8gICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJHZXRE\nZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywg\nbnVsbCk7CiAgICAgICAgICAgIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsK\nICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFu\nLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChj\nb2RlLm5vcCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIGNvbnNpZGVyIGRl\ndGFjaGVkIGlmIGF1dG8tZ2VubmVkIHByaW1hcnkga2V5cyBhcmUgbm9uLWRl\nZmF1bHQKICAgICAgICBpZmlucyA9IG51bGw7CiAgICAgICAgSnVtcEluc3Ry\ndWN0aW9uIGlmaW5zMiA9IG51bGw7CiAgICAgICAgaWYgKHN0YXRlICE9IEJv\nb2xlYW4uVFJVRQogICAgICAgICAgICAmJiBfbWV0YS5nZXRJZGVudGl0eVR5\ncGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKSB7CiAgICAg\nICAgICAgIC8vIGZvciBlYWNoIHBrIGZpZWxkOgogICAgICAgICAgICAvLyBp\nZiAoPHBrPiAhPSA8ZGVmYXVsdD4gWyYmICEiIi5lcXVhbHMgKDxwaz4pXSkK\nICAgICAgICAgICAgLy8JCXJldHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBfbWV0YS5nZXRQcmltYXJ5S2V5\nRmllbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGtz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocGtzW2ldLmdl\ndFZhbHVlU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICB0\nYXJnZXQgPSBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgICAgIGlmIChpZmlucyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIGlmaW5zLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAgICAgICAg\nICAgaWYgKGlmaW5zMiAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGlm\naW5zMi5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICAgICAgICAgIGlmaW5z\nMiA9IG51bGw7CgogICAgICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVl\nQ29kZShjb2RlLCBwa3NbaV0pOwogICAgICAgICAgICAgICAgaWZpbnMgPSBp\nZkRlZmF1bHRWYWx1ZShjb2RlLCBwa3NbaV0pOwogICAgICAgICAgICAgICAg\naWYgKHBrc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLlNUUklORykgewogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZSgiIik7CiAgICAgICAgICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAg\nYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBwa3NbaV0pOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChT\ndHJpbmcuY2xhc3MsICJlcXVhbHMiLAogICAgICAgICAgICAgICAgICAgICAg\nICBib29sZWFuLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0p\nOwogICAgICAgICAgICAgICAgICAgIGlmaW5zMiA9IGNvZGUuaWZuZSgpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29kZS5nZXRzdGF0\naWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiVFJVRSIsCiAgICAgICAg\nICAgICAgICAgICAgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgICAgICBj\nb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLy8gZ2l2ZSB1cDsgd2UganVzdCBkb24ndCBrbm93CiAgICAgICAgdGFy\nZ2V0ID0gY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBpZiAo\naWZpbnMgIT0gbnVsbCkKICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRh\ncmdldCk7CiAgICAgICAgaWYgKGlmaW5zMiAhPSBudWxsKQogICAgICAgICAg\nICBpZmluczIuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgY29kZS5hcmV0\ndXJuKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21wYXJlIHRoZSBnaXZl\nbiBmaWVsZCB0byBpdHMgSmF2YSBkZWZhdWx0LCByZXR1cm5pbmcgdGhlCiAg\nICAgKiBjb21wYXJpc29uIGluc3RydWN0aW9uLiBUaGUgZmllbGQgdmFsdWUg\nd2lsbCBhbHJlYWR5IGJlIG9uIHRoZSBzdGFjay4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgSnVtcEluc3RydWN0aW9uIGlmRGVmYXVsdFZhbHVlKENv\nZGUgY29kZSwKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAg\nIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nSEFSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGNvZGUuaWZlcSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5E\nT1VCTEU6CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoMEQpOwogICAgICAgICAgICAgICAgY29kZS5kY21wbCgpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGNvZGUuaWZlcSgpOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZSgwRik7CiAgICAgICAgICAgICAgICBjb2RlLmZjbXBs\nKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEwpOwogICAgICAgICAgICAgICAg\nY29kZS5sY21wKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZmVx\nKCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gY29kZS5pZm51bGwoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBIZWxwZXIgbWV0aG9kIHRvIGdldCB0aGUgY29kZSBmb3IgdGhlIGNs\nYXNzIGluaXRpYWxpemVyIG1ldGhvZCwKICAgICAqIGNyZWF0aW5nIHRoZSBt\nZXRob2QgaWYgaXQgZG9lcyBub3QgYWxyZWFkeSBleGlzdC4KICAgICAqLwog\nICAgcHJpdmF0ZSBDb2RlIGdldE9yQ3JlYXRlQ2xhc3NJbml0Q29kZShib29s\nZWFuIHJlcGxhY2VMYXN0KSB7CiAgICAgICAgQkNNZXRob2QgY2xpbml0ID0g\nX3BjLmdldERlY2xhcmVkTWV0aG9kKCI8Y2xpbml0PiIpOwogICAgICAgIENv\nZGUgY29kZTsKICAgICAgICBpZiAoY2xpbml0ICE9IG51bGwpIHsKICAgICAg\nICAgICAgY29kZSA9IGNsaW5pdC5nZXRDb2RlKHRydWUpOwogICAgICAgICAg\nICBpZiAocmVwbGFjZUxhc3QpIHsKICAgICAgICAgICAgICAgIENvZGUgdGVt\ncGxhdGUgPSAoQ29kZSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFj\ndGlvbigpKTsKICAgICAgICAgICAgICAgIGNvZGUuc2VhcmNoRm9yd2FyZCh0\nZW1wbGF0ZS52cmV0dXJuKCkpOwogICAgICAgICAgICAgICAgY29kZS5wcmV2\naW91cygpOwogICAgICAgICAgICAgICAgY29kZS5zZXQodGVtcGxhdGUubm9w\nKCkpOwogICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuIGNvZGU7CiAgICAgICAgfQoKICAgICAg\nICAvLyBhZGQgc3RhdGljIGluaXRpYWxpemVyIG1ldGhvZCBpZiBub24gZXhp\nc3RzCiAgICAgICAgY2xpbml0ID0gX3BjLmRlY2xhcmVNZXRob2QoIjxjbGlu\naXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgY2xpbml0Lm1ha2VQ\nYWNrYWdlKCk7CiAgICAgICAgY2xpbml0LnNldFN0YXRpYyh0cnVlKTsKICAg\nICAgICBjbGluaXQuc2V0RmluYWwodHJ1ZSk7CgogICAgICAgIGNvZGUgPSBj\nbGluaXQuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBpZiAoIXJlcGxhY2VMYXN0\nKSB7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgICAgICBj\nb2RlLnByZXZpb3VzKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb2Rl\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBieXRlY29kZSBtb2RpZnlp\nbmcgdGhlIGNsb25pbmcgYmVoYXZpb3Igb2YgdGhlIGNsYXNzIGJlaW5nCiAg\nICAgKiBlbmhhbmNlZCB0byBjb3JyZWN0bHkgcmVwbGFjZSB0aGUgPGNvZGU+\ncGNTdGF0ZU1hbmFnZXI8L2NvZGU+IAogICAgICogaW5zdGFuY2UgZmllbGRz\nIG9mIGFueSBjbG9uZSBjcmVhdGVkIHdpdGggdGhlaXIgZGVmYXVsdCB2YWx1\nZXMuIAogICAgICogQWxzbywgaWYgdGhpcyBjbGFzcyBpcyB0aGUgYmFzZSBQ\nQyB0eXBlIGFuZCBkb2VzIG5vdCBkZWNsYXJlZCAKICAgICAqIGEgY2xvbmUg\nbWV0aG9kLCBvbmUgd2lsbCBiZSBhZGRlZC4gQWxzbywgaWYgX3BjIGlzIGEg\nc3ludGhldGljCiAgICAgKiBzdWJjbGFzcywgY3JlYXRlIHRoZSBjbG9uZSgp\nIG1ldGhvZCB0aGF0IGNsZWFycyB0aGUgc3RhdGUgbWFuYWdlcgogICAgICog\ndGhhdCBtYXkgaGF2ZSBiZWVuIGluaXRpYWxpemVkIGluIGEgc3VwZXIncyBj\nbG9uZSgpIG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENs\nb25pbmdDb2RlKCkgewogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xh\nc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIC8vIGFkZCB0aGUgY2xvbmUgbWV0aG9k\nIGlmIG5lY2Vzc2FyeQogICAgICAgIEJDTWV0aG9kIGNsb25lID0gX3BjLmdl\ndERlY2xhcmVkTWV0aG9kKCJjbG9uZSIsIAogICAgICAgICAgICAoU3RyaW5n\nW10pIG51bGwpOwogICAgICAgIFN0cmluZyBzdXBlck5hbWUgPSBfbWFuYWdl\nZFR5cGUuZ2V0U3VwZXJjbGFzc05hbWUoKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBudWxsOwogICAgICAgIGlmIChjbG9uZSA9PSBudWxsKSB7CiAgICAgICAg\nICAgIC8vIGFkZCBjbG9uZSBzdXBwb3J0IGZvciBiYXNlIGNsYXNzZXMKICAg\nICAgICAgICAgLy8gd2hpY2ggYWxzbyBpbXBsZW1lbnQgY2xvbmVhYmxlCiAg\nICAgICAgICAgIGJvb2xlYW4gaXNDbG9uZWFibGUgPSBDbG9uZWFibGUuY2xh\nc3MuaXNBc3NpZ25hYmxlRnJvbSgKICAgICAgICAgICAgICAgIF9tYW5hZ2Vk\nVHlwZS5nZXRUeXBlKCkpOwogICAgICAgICAgICBib29sZWFuIGV4dGVuZHNP\nYmplY3QgPQogICAgICAgICAgICAgICAgc3VwZXJOYW1lLmVxdWFscyhPYmpl\nY3QuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgaWYgKCFpc0Nsb25l\nYWJsZSB8fCAoIWV4dGVuZHNPYmplY3QgJiYgIWdldENyZWF0ZVN1YmNsYXNz\nKCkpKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgaWYg\nKCFnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICAgICAgaWYgKF9s\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9n\nLnRyYWNlKAogICAgICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgiZW5o\nYW5jZS1jbG9uZWFibGUiLCBfbWFuYWdlZFR5cGUuZ2V0TmFtZSgpKSk7Cgog\nICAgICAgICAgICAvLyBhZGQgY2xvbmUgbWV0aG9kCiAgICAgICAgICAgIC8v\nIHByb3RlY3RlZCBPYmplY3QgY2xvbmUgKCkgdGhyb3dzIENsb25lTm90U3Vw\ncG9ydGVkRXhjZXB0aW9uCiAgICAgICAgICAgIGNsb25lID0gX3BjLmRlY2xh\ncmVNZXRob2QoImNsb25lIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgaWYgKCFzZXRWaXNpYmlsaXR5VG9TdXBlck1ldGhvZChjbG9uZSkp\nCiAgICAgICAgICAgICAgICBjbG9uZS5tYWtlUHJvdGVjdGVkKCk7CiAgICAg\nICAgICAgIGNsb25lLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9u\nCiAgICAgICAgICAgICAgICAoQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24u\nY2xhc3MpOwogICAgICAgICAgICBjb2RlID0gY2xvbmUuZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgICAgIC8vIHJldHVybiBzdXBlci5jbG9uZSAoKTsKICAg\nICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChzdXBl\nck5hbWUsICJjbG9uZSIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3Mu\nZ2V0TmFtZSgpLCBudWxsKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gZ2V0IHRoZSBjbG9u\nZSBtZXRob2QgY29kZQogICAgICAgICAgICBjb2RlID0gY2xvbmUuZ2V0Q29k\nZShmYWxzZSk7CiAgICAgICAgICAgIGlmIChjb2RlID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVh\ndGUgdGVtcGxhdGUgc3VwZXIuY2xvbmUgKCkgaW5zdHJ1Y3Rpb24gdG8gbWF0\nY2ggYWdhaW5zdAogICAgICAgIEluc3RydWN0aW9uIHRlbXBsYXRlID0gKChD\nb2RlKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAg\nICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKSkuaW52b2tlc3Bl\nY2lhbCgpCiAgICAgICAgICAgIC5zZXRNZXRob2Qoc3VwZXJOYW1lLCAiY2xv\nbmUiLCBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKCiAgICAgICAg\nLy8gZmluZCBjYWxscyB0byB0aGUgdGVtcGxhdGUgaW5zdHJ1Y3Rpb247IG9u\nIG1hdGNoCiAgICAgICAgLy8gY2xvbmUgd2lsbCBiZSBvbiBzdGFjawogICAg\nICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKICAgICAgICBpZiAoY29kZS5zZWFy\nY2hGb3J3YXJkKHRlbXBsYXRlKSkgewogICAgICAgICAgICAvLyAoKDx0eXBl\nPikgY2xvbmUpLnBjU3RhdGVNYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAg\nY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKF9wYyk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxs\nKCk7CiAgICAgICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChTTSwg\nU01UWVBFKTsKCiAgICAgICAgICAgIC8vIGlmIG1vZGlmaWVkLCBpbmNyZWFz\nZSBzdGFjawogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2V0cyB0aGUgYXV4aWxpYXJ5\nIGVuaGFuY2VycyByZWdpc3RlcmVkIGFzIHtAbGluayBTZXJ2aWNlcyBzZXJ2\naWNlc30uCiAgICAgKi8KICAgIHB1YmxpYyBBdXhpbGlhcnlFbmhhbmNlcltd\nIGdldEF1eGlsaWFyeUVuaGFuY2VycygpIHsKCQlyZXR1cm4gX2F1eEVuaGFu\nY2VyczsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBbGxvdyBhbnkgcmVn\naXN0ZXJlZCBhdXhpbGlhcnkgY29kZSBnZW5lcmF0b3JzIHRvIHJ1bi4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHJ1bkF1eGlsaWFyeUVuaGFuY2Vycygp\nIHsKICAgIAlmb3IgKGludCBpID0gMDsgaSA8IF9hdXhFbmhhbmNlcnMubGVu\nZ3RoOyBpKyspCiAgICAJCV9hdXhFbmhhbmNlcnNbaV0ucnVuKF9wYywgX21l\ndGEpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhl\nIGdpdmVuIG1ldGhvZCBiZSBza2lwcGVkLgogICAgICogCiAgICAgKiBAcGFy\nYW0gbWV0aG9kIG1ldGhvZCB0byBiZSBza2lwcGVkIG9yIG5vdAogICAgICog\nQHJldHVybiB0cnVlIGlmIGFueSBvZiB0aGUgYXV4aWxpYXJ5IGVuaGFuY2Vy\ncyBza2lwcyB0aGUgZ2l2ZW4gbWV0aG9kLAogICAgICogb3IgaWYgdGhlIG1l\ndGhvZCBpcyBhIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiBza2lwRW5oYW5jZShCQ01ldGhvZCBtZXRob2QpIHsKICAgICAgICBp\nZiAoIjxpbml0PiIuZXF1YWxzKG1ldGhvZC5nZXROYW1lKCkpKQogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IF9hdXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAgICAJCWlm\nIChfYXV4RW5oYW5jZXJzW2ldLnNraXBFbmhhbmNlKG1ldGhvZCkpCiAgICAJ\nCQlyZXR1cm4gdHJ1ZTsKICAgICAgICAKICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHN5bnRoZXRpYyBmaWVsZCBh\nY2Nlc3MgbWV0aG9kcyB0aGF0IHdpbGwgcmVwbGFjZSBhbGwgZGlyZWN0CiAg\nICAgKiBmaWVsZCBhY2Nlc3Nlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZEFjY2Vzc29ycygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRD\ncmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAg\nICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICAgICAg\naWYgKCFnZXRSZWRlZmluZSgpCiAgICAgICAgICAgICAgICAgICAgJiYgX21l\ndGEuZ2V0QWNjZXNzVHlwZSgpICE9IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJ\nRUxEKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkU3ViY2xhc3NTZXRNZXRo\nb2QoZm1kc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgYWRkU3ViY2xhc3NH\nZXRNZXRob2QoZm1kc1tpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhZGRHZXRNZXRob2QoaSwg\nZm1kc1tpXSk7CiAgICAgICAgICAgICAgICBhZGRTZXRNZXRob2QoaSwgZm1k\nc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGRzIGEgbm9uLXN0YXRpYyBzZXR0ZXIgdGhhdCBkZWxlZ2F0\nZXMgdG8gdGhlIHN1cGVyIG1ldGhvZHMsIGFuZAogICAgICogcGVyZm9ybXMg\nYW55IG5lY2Vzc2FyeSBmaWVsZCB0cmFja2luZy4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZFN1YmNsYXNzU2V0TWV0aG9kKEZpZWxkTWV0YURhdGEg\nZm1kKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewog\nICAgICAgIENsYXNzIHByb3BUeXBlID0gZm1kLmdldERlY2xhcmVkVHlwZSgp\nOwogICAgICAgIFN0cmluZyBzZXR0ZXJOYW1lID0gZ2V0U2V0dGVyTmFtZShm\nbWQpOwogICAgICAgIEJDTWV0aG9kIHNldHRlciA9IF9wYy5kZWNsYXJlTWV0\naG9kKHNldHRlck5hbWUsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBD\nbGFzc1tdIHsgcHJvcFR5cGUgfSk7CiAgICAgICAgc2V0VmlzaWJpbGl0eVRv\nU3VwZXJNZXRob2Qoc2V0dGVyKTsKICAgICAgICBDb2RlIGNvZGUgPSBzZXR0\nZXIuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gbm90IG5lY2Vzc2FyeSBp\nZiB3ZSdyZSBhbHJlYWR5IHRyYWNraW5nIGFjY2VzcyB2aWEgcmVkZWZpbml0\naW9uCiAgICAgICAgaWYgKCFnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAg\nIC8vIGdldCB0aGUgb3JpZyB2YWx1ZSBvbnRvIHN0YWNrCiAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgIGFkZEdldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAgaW50IHZh\nbCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAgIGNv\nZGUueHN0b3JlKCkuc2V0TG9jYWwodmFsKS5zZXRUeXBlKGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSk7CiAgICAgICAgICAgIGFkZE5vdGlmeU11dGF0aW9uKGNv\nZGUsIGZtZCwgdmFsLCAwKTsKICAgICAgICB9CgogICAgICAgIC8vICMjIyMj\nIHRlc3QgY2FzZTogQiBleHRlbmRzIEEuIE1ldGhvZHMgZGVmaW5lZCBpbiBB\nLiBXaGF0CiAgICAgICAgLy8gIyMjIyMgaGFwcGVucz8KICAgICAgICAvLyBz\ndXBlci5zZXRYWFgoLi4uKQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlz\nKCk7CiAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKDApLnNldFR5cGUo\ncHJvcFR5cGUpOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1l\ndGhvZChfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpLAogICAgICAgICAgICBzZXR0\nZXJOYW1lLCB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IHByb3BUeXBlIH0p\nOwoKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heExvY2FscygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gc2V0VmlzaWJpbGl0\neVRvU3VwZXJNZXRob2QoQkNNZXRob2QgbWV0aG9kKSB7CiAgICAgICAgQkNN\nZXRob2RbXSBtZXRob2RzID0gX21hbmFnZWRUeXBlLmdldE1ldGhvZHMobWV0\naG9kLmdldE5hbWUoKSwKICAgICAgICAgICAgbWV0aG9kLmdldFBhcmFtVHlw\nZXMoKSk7CiAgICAgICAgaWYgKG1ldGhvZHMubGVuZ3RoID09IDApCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1h\nY2Nlc3NvciIsCiAgICAgICAgICAgICAgICBfbWFuYWdlZFR5cGUuZ2V0TmFt\nZSgpLCBtZXRob2QuZ2V0TmFtZSgpKSk7CiAgICAgICAgQkNNZXRob2Qgc3Vw\nZXJNZXRoID0gbWV0aG9kc1swXTsKICAgICAgICBpZiAoc3VwZXJNZXRoLmlz\nUHJpdmF0ZSgpKSB7CiAgICAgICAgICAgIG1ldGhvZC5tYWtlUHJpdmF0ZSgp\nOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYg\nKHN1cGVyTWV0aC5pc1BhY2thZ2UoKSkgewogICAgICAgICAgICBtZXRob2Qu\nbWFrZVBhY2thZ2UoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgfSBlbHNlIGlmIChzdXBlck1ldGguaXNQcm90ZWN0ZWQoKSkgewogICAg\nICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgpOwogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHN1cGVyTWV0aC5pc1B1\nYmxpYygpKSB7CiAgICAgICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgbm9uLXN0\nYXRpYyBnZXR0ZXIgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlIHN1cGVyIG1ldGhv\nZHMsIGFuZAogICAgICogcGVyZm9ybXMgYW55IG5lY2Vzc2FyeSBmaWVsZCB0\ncmFja2luZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN1YmNsYXNz\nR2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgU3RyaW5n\nIG1ldGhOYW1lID0gImdldCIgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZt\nZC5nZXROYW1lKCkpOwogICAgICAgIGlmIChfbWFuYWdlZFR5cGUuZ2V0TWV0\naG9kcyhtZXRoTmFtZSwgbmV3IENsYXNzWzBdKS5sZW5ndGggPT0gMCkKICAg\nICAgICAgICAgbWV0aE5hbWUgPSAiaXMiICsgU3RyaW5nVXRpbHMuY2FwaXRh\nbGl6ZShmbWQuZ2V0TmFtZSgpKTsKICAgICAgICBCQ01ldGhvZCBnZXR0ZXIg\nPSBfcGMuZGVjbGFyZU1ldGhvZChtZXRoTmFtZSwgZm1kLmdldERlY2xhcmVk\nVHlwZSgpLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBzZXRWaXNpYmls\naXR5VG9TdXBlck1ldGhvZChnZXR0ZXIpOwogICAgICAgIGdldHRlci5tYWtl\nUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gZ2V0dGVyLmdldENvZGUo\ndHJ1ZSk7CgogICAgICAgIC8vIGlmIHdlJ3JlIG5vdCBhbHJlYWR5IHRyYWNr\naW5nIGZpZWxkIGFjY2VzcyB2aWEgcmVmbGVjdGlvbiwgdGhlbiB3ZQogICAg\nICAgIC8vIG11c3QgbWFrZSB0aGUgZ2V0dGVyIGhvb2sgaW4gbGF6eSBsb2Fk\naW5nIGJlZm9yZSBhY2Nlc3NpbmcgdGhlIHN1cGVyCiAgICAgICAgLy8gbWV0\naG9kLgogICAgICAgIGlmICghZ2V0UmVkZWZpbmUoKSkKICAgICAgICAgICAg\nYWRkTm90aWZ5QWNjZXNzKGNvZGUsIGZtZCk7CgogICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCksIG1ldGhOYW1lLAog\nICAgICAgICAgICBmbWQuZ2V0RGVjbGFyZWRUeXBlKCksIG51bGwpOwogICAg\nICAgIGNvZGUueHJldHVybigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlw\nZSgpKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgYSBzdGF0aWMgZ2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdp\ndmVuIGZpZWxkLgogICAgICogVGhlIGdlbmVyYXRlZCBtZXRob2QgaW50ZXJh\nY3RzIHdpdGggdGhlIGluc3RhbmNlIHN0YXRlIGFuZCB0aGUKICAgICAqIFN0\nYXRlTWFuYWdlciB0byBnZXQgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZC4KICAg\nICAqCiAgICAgKiBAcGFyYW0gaW5kZXggdGhlIHJlbGF0aXZlIG51bWJlciBv\nZiB0aGUgZmllbGQKICAgICAqIEBwYXJhbSBmbWQgbWV0YWRhdGEgYWJvdXQg\ndGhlIGZpZWxkIHRvIGdldAogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRk\nR2V0TWV0aG9kKGludCBpbmRleCwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNN\nZXRob2QgbWV0aG9kID0gY3JlYXRlR2V0TWV0aG9kKGZtZCk7CiAgICAgICAg\nQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8v\nIGlmIHJlYWRzIGFyZSBub3QgY2hlY2tlZCwganVzdCByZXR1cm4gdGhlIHZh\nbHVlCiAgICAgICAgYnl0ZSBmaWVsZEZsYWcgPSBnZXRGaWVsZEZsYWcoZm1k\nKTsKICAgICAgICBpZiAoKGZpZWxkRmxhZyAmIFBlcnNpc3RlbmNlQ2FwYWJs\nZS5DSEVDS19SRUFEKSA9PSAwCiAgICAgICAgICAgICYmIChmaWVsZEZsYWcg\nJiBQZXJzaXN0ZW5jZUNhcGFibGUuTUVESUFURV9SRUFEKSA9PSAwKSB7CiAg\nICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAg\nICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsK\nICAgICAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVj\nbGFyZWRUeXBlKCkpOwoKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhT\ndGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBp\nZiAoaW5zdC5wY1N0YXRlTWFuYWdlciA9PSBudWxsKSByZXR1cm4gaW5zdC48\nZmllbGQ+OwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1\nZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZ\nUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZu\nb25udWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0\ncnVlKTsKICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZt\nZCk7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVj\nbGFyZWRUeXBlKCkpOwoKICAgICAgICAvLyBpbnQgZmllbGQgPSBwY0luaGVy\naXRlZEZpZWxkQ291bnQgKyA8ZmllbGRpbmRleD47CiAgICAgICAgaW50IGZp\nZWxkTG9jYWwgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAg\nIGlmaW5zLnNldFRhcmdldChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElO\nSEVSSVQsIGludC5jbGFzcykpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZShpbmRleCk7CiAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAg\nY29kZS5pc3RvcmUoKS5zZXRMb2NhbChmaWVsZExvY2FsKTsKCiAgICAgICAg\nLy8gaW5zdC5wY1N0YXRlTWFuYWdlci5hY2Nlc3NpbmdGaWVsZCAoZmllbGQp\nOwogICAgICAgIC8vIHJldHVybiBpbnN0LjxmaWVsZD47CiAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5p\nbG9hZCgpLnNldExvY2FsKGZpZWxkTG9jYWwpOwogICAgICAgIGNvZGUuaW52\nb2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwgImFjY2Vzc2luZ0Zp\nZWxkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IGlu\ndC5jbGFzcyB9KTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIHRydWUpOwogICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwg\nZm1kKTsKICAgICAgICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyBhIHN0YXRpYyBzZXR0ZXIgbWV0aG9k\nIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKiBUaGUgZ2VuZXJhdGVkIG1l\ndGhvZCBpbnRlcmFjdHMgd2l0aCB0aGUgaW5zdGFuY2Ugc3RhdGUgYW5kIHRo\nZQogICAgICogU3RhdGVNYW5hZ2VyIHRvIHNldCB0aGUgdmFsdWUgb2YgdGhl\nIGZpZWxkLgogICAgICoKICAgICAqIEBwYXJhbSBpbmRleCB0aGUgcmVsYXRp\ndmUgbnVtYmVyIG9mIHRoZSBmaWVsZAogICAgICogQHBhcmFtIGZtZCBtZXRh\nZGF0YSBhYm91dCB0aGUgZmllbGQgdG8gc2V0CiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRTZXRNZXRob2QoaW50IGluZGV4LCBGaWVsZE1ldGFEYXRh\nIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBjcmVhdGVTZXRNZXRob2QoZm1k\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nCiAgICAgICAgLy8gUENFbmhhbmNlciB1c2VzIHN0YXRpYyBtZXRob2RzOyBQ\nQ1N1YmNsYXNzZXIgZG9lcyBub3QuCiAgICAgICAgaW50IGZpcnN0UGFyYW1P\nZmZzZXQgPSBnZXRBY2Nlc3NvclBhcmFtZXRlck9mZnNldCgpOwoKICAgICAg\nICAvLyBpZiAoaW5zdC5wY1N0YXRlTWFuYWdlciA9PSBudWxsKSBpbnN0Ljxm\naWVsZD4gPSB2YWx1ZTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIHRydWUpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChT\nTSwgU01UWVBFKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBj\nb2RlLmlmbm9ubnVsbCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgdHJ1ZSk7CiAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGZp\ncnN0UGFyYW1PZmZzZXQpOwogICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNv\nZGUoY29kZSwgZm1kKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAg\nICAgLy8gaW5zdC5wY1N0YXRlTWFuYWdlci5zZXR0aW5nPGZpZWxkVHlwZT5G\naWVsZCAoaW5zdCwKICAgICAgICAvLyAgICAgcGNJbmhlcml0ZWRGaWVsZENv\ndW50ICsgPGluZGV4PiwgaW5zdC48ZmllbGQ+LCB2YWx1ZSwgMCk7CiAgICAg\nICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\ndHJ1ZSkpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwg\nU01UWVBFKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRy\ndWUpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJ\nVCwgaW50LmNsYXNzKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoaW5kZXgpOwogICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgYWRkR2V0TWFu\nYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgIGNvZGUueGxvYWQo\nKS5zZXRQYXJhbShmaXJzdFBhcmFtT2Zmc2V0KTsKICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAgY29kZS5pbnZva2VpbnRl\ncmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kCiAgICAg\nICAgICAgIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCksICJzZXR0aW5nIiwgZmFs\nc2UsIHRydWUpKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1p\nbmVzIHdoaWNoIGF0dGFjaCAvIGRldGFjaCBtZXRob2RzIHRvIHVzZS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEF0dGFjaERldGFjaENvZGUoKQog\nICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAg\nIC8vIHNlZSBpZiBhbnkgc3VwZXJjbGFzc2VzIGFyZSBkZXRhY2hhYmxlCiAg\nICAgICAgYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlID0gZmFsc2U7CiAgICAg\nICAgZm9yIChDbGFzc01ldGFEYXRhIHBhcmVudCA9IF9tZXRhLmdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIHBhcmVudCAhPSBudWxs\nOyBwYXJlbnQgPSBwYXJlbnQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkg\newogICAgICAgICAgICBpZiAocGFyZW50LmlzRGV0YWNoYWJsZSgpKSB7CiAg\nICAgICAgICAgICAgICBwYXJlbnREZXRhY2hhYmxlID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyBpZiBwYXJlbnQgbm90IGRldGFjaGFibGUsIHdlIG5lZWQgdG8g\nYWRkIHRoZSBkZXRhY2ggc3RhdGUgZmllbGRzIGFuZAogICAgICAgIC8vIGFj\nY2Vzc29yIG1ldGhvZHMKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNs\nYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJjbGFzcygpCiAgICAgICAg\nICAgIHx8IHBhcmVudERldGFjaGFibGUgIT0gX21ldGEuaXNEZXRhY2hhYmxl\nKCkpIHsKICAgICAgICAgICAgYWRkSXNEZXRhY2hlZE1ldGhvZCgpOwogICAg\nICAgICAgICBhZGREZXRhY2hlZFN0YXRlTWV0aG9kcyhfbWV0YS51c2VzRGV0\nYWNoZWRTdGF0ZSgpCiAgICAgICAgICAgICAgICAhPSBCb29sZWFuLkZBTFNF\nKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHdlIGRldGFjaCBvbiBzZXJp\nYWxpemUsIHdlIGFsc28gbmVlZCB0byBpbXBsZW1lbnQgdGhlCiAgICAgICAg\nLy8gZXh0ZXJuYWxpemFibGUgaW50ZXJmYWNlIHRvIHdyaXRlIGp1c3QgdGhl\nIHN0YXRlIGZvciB0aGUgZmllbGRzCiAgICAgICAgLy8gYmVpbmcgZGV0YWNo\nZWQKICAgICAgICBpZiAoZXh0ZXJuYWxpemVEZXRhY2hlZCgpKSB7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhZGREZXRhY2hFeHRlcm5h\nbGl6ZShwYXJlbnREZXRhY2hhYmxlLAogICAgICAgICAgICAgICAgICAgIF9t\nZXRhLnVzZXNEZXRhY2hlZFN0YXRlKCkgIT0gQm9vbGVhbi5GQUxTRSk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiBuc21l\nKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihuc21lKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCB0aGUgZmllbGRzIHRvIGhvbGQgZGV0YWNoZWQgc3Rh\ndGUgYW5kIHRoZWlyIGFjY2Vzc29yIG1ldGhvZHMuCiAgICAgKgogICAgICog\nQHBhcmFtIGltcGwgd2hldGhlciB0byBmdWxseSBpbXBsZW1lbnQgZGV0YWNo\nIHN0YXRlIGZ1bmN0aW9uYWxpdHkKICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZERldGFjaGVkU3RhdGVNZXRob2RzKGJvb2xlYW4gaW1wbCkgewogICAg\nICAgIEZpZWxkIGRldGFjaEZpZWxkID0gX21ldGEuZ2V0RGV0YWNoZWRTdGF0\nZUZpZWxkKCk7CiAgICAgICAgU3RyaW5nIG5hbWUgPSBudWxsOwogICAgICAg\nIFN0cmluZyBkZWNsYXJlciA9IG51bGw7CiAgICAgICAgaWYgKGltcGwgJiYg\nZGV0YWNoRmllbGQgPT0gbnVsbCkgewogICAgICAgICAgICBuYW1lID0gUFJF\nICsgIkRldGFjaGVkU3RhdGUiOwogICAgICAgICAgICBkZWNsYXJlciA9IF9w\nYy5nZXROYW1lKCk7CiAgICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMu\nZGVjbGFyZUZpZWxkKG5hbWUsIE9iamVjdC5jbGFzcyk7CiAgICAgICAgICAg\nIGZpZWxkLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAgIGZpZWxkLnNldFRy\nYW5zaWVudCh0cnVlKTsKICAgICAgICB9IGVsc2UgaWYgKGltcGwpIHsKICAg\nICAgICAgICAgbmFtZSA9IGRldGFjaEZpZWxkLmdldE5hbWUoKTsKICAgICAg\nICAgICAgZGVjbGFyZXIgPSBkZXRhY2hGaWVsZC5nZXREZWNsYXJpbmdDbGFz\ncygpLmdldE5hbWUoKTsKICAgICAgICB9CgogICAgICAgIC8vIHB1YmxpYyBP\nYmplY3QgcGNHZXREZXRhY2hlZFN0YXRlICgpCiAgICAgICAgQkNNZXRob2Qg\nbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldERldGFjaGVk\nU3RhdGUiLAogICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAg\nICAgIG1ldGhvZC5zZXRTdGF0aWMoZmFsc2UpOwogICAgICAgIG1ldGhvZC5t\nYWtlUHVibGljKCk7CiAgICAgICAgaW50IGFjY2VzcyA9IG1ldGhvZC5nZXRB\nY2Nlc3NGbGFncygpOwoKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICBpZiAoaW1wbCkgewogICAgICAgICAgICAv\nLyByZXR1cm4gcGNEZXRhY2hlZFN0YXRlOwogICAgICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgZ2V0Zmll\nbGQoY29kZSwgX21hbmFnZWRUeXBlLmdldFByb2plY3QoKS5sb2FkQ2xhc3Mo\nZGVjbGFyZXIpLAogICAgICAgICAgICAgICAgbmFtZSk7CiAgICAgICAgfSBl\nbHNlCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAg\nICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjU2V0RGV0YWNoZWRTdGF0ZSAo\nT2JqZWN0IHN0YXRlKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0\naG9kKFBSRSArICJTZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgdm9p\nZC5jbGFzcywgbmV3IENsYXNzIFtdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAg\nICAgbWV0aG9kLnNldEFjY2Vzc0ZsYWdzKGFjY2Vzcyk7CiAgICAgICAgY29k\nZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGlmIChpbXBsKSB7\nCiAgICAgICAgICAgIC8vIHBjRGV0YWNoZWRTdGF0ZSA9IHN0YXRlOwogICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAg\nICBwdXRmaWVsZChjb2RlLCBfbWFuYWdlZFR5cGUuZ2V0UHJvamVjdCgpLmxv\nYWRDbGFzcyhkZWNsYXJlciksCiAgICAgICAgICAgICAgICBuYW1lLCBPYmpl\nY3QuY2xhc3MpOwogICAgICAgIH0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZHMgdG8gPGNvZGU+Y29kZTwvY29kZT4gdGhlIGluc3RydWN0aW9ucyB0\nbyBnZXQgZmllbGQKICAgICAqIDxjb2RlPmF0dHJOYW1lPC9jb2RlPiBkZWNs\nYXJlZCBpbiB0eXBlIDxjb2RlPmRlY2xhcmVyPC9jb2RlPgogICAgICogb250\nbyB0aGUgdG9wIG9mIHRoZSBzdGFjay4KICAgICAqCiAgICAgKiBUaGUgaW5z\ndGFuY2UgdG8gYWNjZXNzIG11c3QgYWxyZWFkeSBiZSBvbiB0aGUgdG9wIG9m\nIHRoZQogICAgICogc3RhY2sgd2hlbiB0aGlzIGlzIGludm9rZWQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBnZXRmaWVsZChDb2RlIGNvZGUsIEJDQ2xh\nc3MgZGVjbGFyZXIsIFN0cmluZyBhdHRyTmFtZSkgewogICAgICAgIGlmIChk\nZWNsYXJlciA9PSBudWxsKQogICAgICAgICAgICBkZWNsYXJlciA9IF9tYW5h\nZ2VkVHlwZTsKCiAgICAgICAgLy8gZmlyc3QsIHNlZSBpZiB3ZSBjYW4gY29u\ndmVydCB0aGUgYXR0cmlidXRlIG5hbWUgdG8gYSBmaWVsZCBuYW1lCiAgICAg\nICAgU3RyaW5nIGZpZWxkTmFtZSA9IHRvQmFja2luZ0ZpZWxkTmFtZShhdHRy\nTmFtZSk7CgogICAgICAgIC8vIG5leHQsIGZpbmQgdGhlIGZpZWxkIGluIHRo\nZSBtYW5hZ2VkIHR5cGUuCiAgICAgICAgQkNGaWVsZFtdIGZpZWxkcyA9IChC\nQ0ZpZWxkW10pIEFjY2Vzc0NvbnRyb2xsZXIKICAgICAgICAgICAgLmRvUHJp\ndmlsZWdlZChKMkRvUHJpdkhlbHBlci5nZXRCQ0NsYXNzRmllbGRzQWN0aW9u\nKF9tYW5hZ2VkVHlwZSwKICAgICAgICAgICAgICAgIGZpZWxkTmFtZSkpOyAK\nICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gbnVsbDsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBmaWVsZCA9IGZpZWxkc1tpXTsKICAgICAgICAgICAgLy8gaWYgd2UgcmVh\nY2ggYSBmaWVsZCBkZWNsYXJlZCBpbiB0aGlzIHR5cGUsIHRoZW4gdGhpcyBp\ncyB0aGUKICAgICAgICAgICAgLy8gbW9zdC1tYXNraW5nIGZpZWxkLCBhbmQg\naXMgdGhlIG9uZSB0aGF0IHdlIHdhbnQuCiAgICAgICAgICAgIC8vICMjIyMj\nIHByb2JhYmx5IHNob3VsZCB3YWxrIHVwIHRoZSBoaWVyYXJjaHksIG9yIGNo\nZWNrIHRoYXQKICAgICAgICAgICAgLy8gIyMjIyMgc2VycCBkb2VzIHRoYXQu\nCiAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uZ2V0RGVjbGFyZXIoKSA9PSBk\nZWNsYXJlcikgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygp\nICYmIGNvZGUuZ2V0TWV0aG9kKCkuZ2V0RGVjbGFyZXIoKSA9PSBfcGMKICAg\nICAgICAgICAgJiYgKGZpZWxkID09IG51bGwgfHwgIWZpZWxkLmlzUHVibGlj\nKCkpKSB7CiAgICAgICAgICAgIC8vIHdlJ3JlIGNyZWF0aW5nIHRoZSBzdWJj\nbGFzcywgbm90IHJlZGVmaW5pbmcgdGhlIHVzZXIgdHlwZS4KCiAgICAgICAg\nICAgIC8vIFJlZmxlY3Rpb24uZ2V0WFhYKHRoaXMsIFJlZmxlY3Rpb24uZmlu\nZEZpZWxkKC4uLikpOwogICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQo\nKS5zZXRDbGFzcyhkZWNsYXJlcik7CiAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZShmaWVsZE5hbWUpOwogICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsCiAgICAg\nICAgICAgICAgICAiZmluZEZpZWxkIiwgRmllbGQuY2xhc3MsIG5ldyBDbGFz\nc1tdIHsKICAgICAgICAgICAgICAgIENsYXNzLmNsYXNzLCBTdHJpbmcuY2xh\nc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgIENsYXNzIHR5cGUg\nPSBfbWV0YS5nZXRGaWVsZChhdHRyTmFtZSkuZ2V0RGVjbGFyZWRUeXBlKCk7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZXN0YXRpYygpLnNldE1ldGhvZCgKICAgICAgICAgICAgICAgICAgICBnZXRS\nZWZsZWN0aW9uR2V0dGVyTWV0aG9kKHR5cGUsIEZpZWxkLmNsYXNzKSk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICAvLyBzaG91bGQgbmV2ZXIgaGFwcGVuCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oZSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZl\nKCkgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKGRlY2xh\ncmVyLmdldE5hbWUoKSwgZmllbGROYW1lLAogICAgICAgICAgICAgICAgZmll\nbGQuZ2V0VHlwZSgpLmdldE5hbWUoKSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQWRkcyB0byA8Y29kZT5jb2RlPC9jb2RlPiB0aGUgaW5z\ndHJ1Y3Rpb25zIHRvIHNldCBmaWVsZAogICAgICogPGNvZGU+YXR0ck5hbWU8\nL2NvZGU+IGRlY2xhcmVkIGluIHR5cGUgPGNvZGU+ZGVjbGFyZXI8L2NvZGU+\nCiAgICAgKiB0byB0aGUgdmFsdWUgb2YgdHlwZSA8Y29kZT5maWVsZFR5cGU8\nL2NvZGU+IG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrLgogICAgICoKICAgICAq\nIFdoZW4gdGhpcyBtZXRob2QgaXMgaW52b2tlZCwgdGhlIHZhbHVlIHRvIGxv\nYWQgbXVzdAogICAgICogYWxyZWFkeSBiZSBvbiB0aGUgdG9wIG9mIHRoZSBz\ndGFjayBpbiA8Y29kZT5jb2RlPC9jb2RlPiwKICAgICAqIGFuZCB0aGUgaW5z\ndGFuY2UgdG8gbG9hZCBpbnRvIG11c3QgYmUgc2Vjb25kLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcHV0ZmllbGQoQ29kZSBjb2RlLCBCQ0NsYXNzIGRl\nY2xhcmVyLCBTdHJpbmcgYXR0ck5hbWUsCiAgICAgICAgQ2xhc3MgZmllbGRU\neXBlKSB7CiAgICAgICAgaWYgKGRlY2xhcmVyID09IG51bGwpCiAgICAgICAg\nICAgIGRlY2xhcmVyID0gX21hbmFnZWRUeXBlOwoKICAgICAgICBTdHJpbmcg\nZmllbGROYW1lID0gdG9CYWNraW5nRmllbGROYW1lKGF0dHJOYW1lKTsKCiAg\nICAgICAgaWYgKGdldFJlZGVmaW5lKCkgfHwgZ2V0Q3JlYXRlU3ViY2xhc3Mo\nKSkgewogICAgICAgICAgICAvLyBSZWZsZWN0aW9uLnNldCh0aGlzLCBSZWZs\nZWN0aW9uLmZpbmRGaWVsZCguLi4pLCB2YWx1ZSk7CiAgICAgICAgICAgIGNv\nZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGRlY2xhcmVyKTsKICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZpZWxkTmFtZSk7CiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVj\ndGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICJmaW5kRmllbGQiLCBGaWVs\nZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAgICAgICAgICAgQ2xhc3Mu\nY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAg\nICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVjdGlv\nbi5jbGFzcywgInNldCIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLAog\nICAgICAgICAgICAgICAgbmV3IENsYXNzW10gewogICAgICAgICAgICAgICAg\nICAgIE9iamVjdC5jbGFzcywKICAgICAgICAgICAgICAgICAgICBmaWVsZFR5\ncGUuaXNQcmltaXRpdmUoKSA/IGZpZWxkVHlwZSA6IE9iamVjdC5jbGFzcywg\nCiAgICAgICAgICAgICAgICAgICAgRmllbGQuY2xhc3MgfSk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgY29kZS5wdXRmaWVsZCgpCiAgICAgICAg\nICAgICAgICAuc2V0RmllbGQoZGVjbGFyZXIuZ2V0TmFtZSgpLCBmaWVsZE5h\nbWUsIGZpZWxkVHlwZS5nZXROYW1lKCkpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIElmIHVzaW5nIHByb3BlcnR5IGFjY2Vzcywgc2VlIGlm\nIHRoZXJlIGlzIGEgZGlmZmVyZW50IGJhY2tpbmcgZmllbGQKICAgICAqIG5h\nbWUgZm9yIHRoZSBwZXJzaXN0ZW50IGF0dHJpYnV0ZSA8Y29kZT5uYW1lPC9j\nb2RlPi4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgdG9CYWNraW5nRmll\nbGROYW1lKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKF9tZXRhLmdldEFj\nY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19QUk9QRVJUWQog\nICAgICAgICAgICAmJiBfYXR0cnNUb0ZpZWxkcy5jb250YWluc0tleShuYW1l\nKSkKICAgICAgICAgICAgbmFtZSA9IChTdHJpbmcpIF9hdHRyc1RvRmllbGRz\nLmdldChuYW1lKTsKICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIElmIHVzaW5nIHByb3BlcnR5IGFjY2Vzcywgc2VlIGlmIHRo\nZXJlIGlzIGEgZGlmZmVyZW50IHBlcnNpc3RlbnQKICAgICAqIGF0dHJpYnV0\nZSBuYW1lIGZvciB0aGUgYmFja2luZyBmaWVsZCA8Y29kZT5uYW1lPC9jb2Rl\nPi4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZnJvbUJhY2tpbmdGaWVs\nZE5hbWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICAvLyBtZXRhIGlzIG51bGwg\nd2hlbiBkb2luZyBwZXJzaXN0ZW5jZS1hd2FyZSBlbmhhbmNlbWVudAogICAg\nICAgIGlmIChfbWV0YSAhPSBudWxsCiAgICAgICAgICAgICYmIF9tZXRhLmdl\ndEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19QUk9QRVJU\nWQogICAgICAgICAgICAmJiBfZmllbGRzVG9BdHRycy5jb250YWluc0tleShu\nYW1lKSkKICAgICAgICAgICAgcmV0dXJuIChTdHJpbmcpIF9maWVsZHNUb0F0\ndHJzLmdldChuYW1lKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVy\nbiBuYW1lOwogICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50IHRoZSBl\neHRlcm5hbGl6YWJsZSBpbnRlcmZhY2UgdG8gZGV0YWNoIG9uIHNlcmlhbGl6\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZERldGFjaEV4dGVybmFs\naXplKGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSwKICAgICAgICBib29sZWFu\nIGRldGFjaGVkU3RhdGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlIGRlY2xhcmVk\nIGRlZmF1bHQgY29uc3RydWN0b3IgaXMgcHVibGljIAogICAgICAgIC8vIGZv\nciBleHRlcm5hbGl6YXRpb24KICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3Bj\nLmdldERlY2xhcmVkTWV0aG9kKCI8aW5pdD4iLCAoU3RyaW5nW10pIG51bGwp\nOwogICAgICAgIGlmICghbWV0aC5pc1B1YmxpYygpKSB7CiAgICAgICAgICAg\nIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9s\nb2cud2FybihfbG9jLmdldCgiZW5oYW5jZS1kZWZjb25zLWV4dGVybiIsIAog\nICAgICAgICAgICAgICAgICBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKTsK\nICAgICAgICAgICAgbWV0aC5tYWtlUHVibGljKCk7CiAgICAgICAgfQogICAg\nICAgIC8vIGRlY2xhcmUgZXh0ZXJuYWxpemFibGUgaW50ZXJmYWNlCiAgICAg\nICAgaWYgKCFFeHRlcm5hbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9t\nKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpCiAgICAgICAgICAgIF9wYy5k\nZWNsYXJlSW50ZXJmYWNlKEV4dGVybmFsaXphYmxlLmNsYXNzKTsKCiAgICAg\nICAgLy8gbWFrZSBzdXJlIHRoZSB1c2VyIGRvZXNuJ3QgYWxyZWFkeSBoYXZl\nIGN1c3RvbSBleHRlcm5hbGl6YXRpb24gb3IKICAgICAgICAvLyBzZXJpYWxp\nemF0aW9uIG1ldGhvZHMKICAgICAgICBDbGFzc1tdIGlucHV0ID0gbmV3IENs\nYXNzW117IE9iamVjdElucHV0U3RyZWFtLmNsYXNzIH07CiAgICAgICAgQ2xh\nc3NbXSBvdXRwdXQgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0T3V0cHV0U3RyZWFt\nLmNsYXNzIH07CiAgICAgICAgaWYgKF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJl\nZE1ldGhvZCgicmVhZE9iamVjdCIsIGlucHV0KSAhPSBudWxsCiAgICAgICAg\nICAgIHx8IF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJlZE1ldGhvZCgid3JpdGVP\nYmplY3QiLCBvdXRwdXQpICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJkZXRhY2gtY3VzdG9tLXNlciIs\nIF9tZXRhKSk7CiAgICAgICAgaW5wdXRbMF0gPSBPYmplY3RJbnB1dC5jbGFz\nczsKICAgICAgICBvdXRwdXRbMF0gPSBPYmplY3RPdXRwdXQuY2xhc3M7CiAg\nICAgICAgaWYgKF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJlZE1ldGhvZCgicmVh\nZEV4dGVybmFsIiwgaW5wdXQpICE9IG51bGwKICAgICAgICAgICAgfHwgX21h\nbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kKCJ3cml0ZUV4dGVybmFsIiwg\nb3V0cHV0KSAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgiZGV0YWNoLWN1c3RvbS1leHRlcm4iLCBfbWV0\nYSkpOwoKICAgICAgICAvLyBjcmVhdGUgbGlzdCBvZiBhbGwgdW5tYW5hZ2Vk\nIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkW10gZmllbGRz\nID0gX21hbmFnZWRUeXBlLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAg\nQ29sbGVjdGlvbiB1bm1nZCA9IG5ldyBBcnJheUxpc3QoZmllbGRzLmxlbmd0\naCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFmaWVsZHNbaV0uaXNUcmFuc2ll\nbnQoKSAmJiAhZmllbGRzW2ldLmlzU3RhdGljKCkKICAgICAgICAgICAgICAg\nICYmICFmaWVsZHNbaV0uaXNGaW5hbCgpCiAgICAgICAgICAgICAgICAmJiAh\nZmllbGRzW2ldLmdldE5hbWUoKS5zdGFydHNXaXRoKFBSRSkKICAgICAgICAg\nICAgICAgICYmIF9tZXRhLmdldERlY2xhcmVkRmllbGQoZmllbGRzW2ldLmdl\ndE5hbWUoKSkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHVubWdkLmFkZChm\naWVsZHNbaV0pOwogICAgICAgIH0KCiAgICAgICAgYWRkUmVhZEV4dGVybmFs\nKHBhcmVudERldGFjaGFibGUsIGRldGFjaGVkU3RhdGUpOwogICAgICAgIGFk\nZFJlYWRVbm1hbmFnZWQodW5tZ2QsIHBhcmVudERldGFjaGFibGUpOwogICAg\nICAgIGFkZFdyaXRlRXh0ZXJuYWwocGFyZW50RGV0YWNoYWJsZSwgZGV0YWNo\nZWRTdGF0ZSk7CiAgICAgICAgYWRkV3JpdGVVbm1hbmFnZWQodW5tZ2QsIHBh\ncmVudERldGFjaGFibGUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGN1\nc3RvbSByZWFkRXh0ZXJuYWwgbWV0aG9kLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkUmVhZEV4dGVybmFsKGJvb2xlYW4gcGFyZW50RGV0YWNoYWJs\nZSwKICAgICAgICBib29sZWFuIGRldGFjaGVkU3RhdGUpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NbXSBp\nbmFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXQuY2xhc3MgfTsKICAg\nICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRob2QoInJlYWRF\neHRlcm5hbCIsIHZvaWQuY2xhc3MsIGluYXJncyk7CiAgICAgICAgRXhjZXB0\naW9ucyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAg\nICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAg\nICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihDbGFzc05vdEZvdW5kRXhjZXB0\naW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUo\ndHJ1ZSk7CgogICAgICAgIC8vIHN1cGVyLnJlYWRFeHRlcm5hbCAoaW4pOwog\nICAgICAgIENsYXNzIHN1cCA9IF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKS5n\nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgaWYgKCFwYXJlbnREZXRhY2hhYmxl\nICYmIEV4dGVybmFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oc3Vw\nKSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qoc3Vw\nLCAicmVhZEV4dGVybmFsIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3Ms\nIGluYXJncyk7CiAgICAgICAgfQoKICAgICAgICAvLyByZWFkVW5tYW5hZ2Vk\nIChpbik7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRh\nKSwKICAgICAgICAgICAgUFJFICsgIlJlYWRVbm1hbmFnZWQiLCB2b2lkLmNs\nYXNzLCBpbmFyZ3MpOwoKICAgICAgICBpZiAoZGV0YWNoZWRTdGF0ZSkgewog\nICAgICAgICAgICAvLyBwY1NldERldGFjaGVkU3RhdGUgKGluLnJlYWRPYmpl\nY3QgKCkpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhv\nZChPYmplY3RJbnB1dC5jbGFzcywgInJlYWRPYmplY3QiLAogICAgICAgICAg\nICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0\nYXRlIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\neyBPYmplY3QuY2xhc3MgfSk7CgogICAgICAgICAgICAvLyBwY1JlcGxhY2VT\ndGF0ZU1hbmFnZXIgKChTdGF0ZU1hbmFnZXIpIGluLnJlYWRPYmplY3QgKCkp\nOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmpl\nY3RJbnB1dC5jbGFzcywgInJlYWRPYmplY3QiLAogICAgICAgICAgICAgICAg\nT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKFN0YXRlTWFuYWdlci5jbGFzcyk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiUmVwbGFj\nZVN0YXRlTWFuYWdlciIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBu\nZXcgQ2xhc3NbXXsgU3RhdGVNYW5hZ2VyLmNsYXNzIH0pOwogICAgICAgIH0K\nCiAgICAgICAgLy8gcmVhZCBtYW5hZ2VkIGZpZWxkcwogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBpZiAoIWZtZHNbaV0uaXNUcmFuc2llbnQoKSkKICAgICAgICAgICAg\nICAgIHJlYWRFeHRlcm5hbChjb2RlLCBmbWRzW2ldLmdldE5hbWUoKSwKICAg\nICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCBm\nbWRzW2ldKTsKCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFkIHVubWFu\nYWdlZCBmaWVsZHMgZnJvbSB0aGUgc3RyZWFtIChwY1JlYWRVbm1hbmFnZWQp\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUmVhZFVubWFuYWdlZChD\nb2xsZWN0aW9uIHVubWdkLCBib29sZWFuIHBhcmVudERldGFjaGFibGUpCiAg\nICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAg\nQ2xhc3NbXSBpbmFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXQuY2xh\nc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIlJlYWRVbm1hbmFnZWQiLCB2b2lkLmNsYXNzLAogICAgICAg\nICAgICBpbmFyZ3MpOwogICAgICAgIG1ldGgubWFrZVByb3RlY3RlZCgpOwog\nICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gbWV0aC5nZXRFeGNlcHRpb25z\nKHRydWUpOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNlcHRpb24oSU9FeGNlcHRp\nb24uY2xhc3MpOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNlcHRpb24oQ2xhc3NO\nb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzdXBlci5yZWFkVW5t\nYW5hZ2VkIChpbik7CiAgICAgICAgaWYgKHBhcmVudERldGFjaGFibGUpIHsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5cGUo\nX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpKSwgUFJFICsgIlJlYWRVbm1hbmFnZWQiLCB2b2lkLmNsYXNzLCAKICAg\nICAgICAgICAgICAgIGluYXJncyk7CiAgICAgICAgfQoKICAgICAgICAvLyBy\nZWFkIGRlY2xhcmVkIHVubWFuYWdlZCBzZXJpYWxpemFibGUgZmllbGRzCiAg\nICAgICAgQkNGaWVsZCBmaWVsZDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IHVubWdkLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgIGZpZWxkID0gKEJDRmllbGQpIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIHJlYWRFeHRlcm5hbChjb2RlLCBmaWVsZC5nZXROYW1lKCksIGZpZWxk\nLmdldFR5cGUoKSwgbnVsbCk7CiAgICAgICAgfQogICAgICAgIGNvZGUudnJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8q\nKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZWFkIGEgZmllbGQgZnJvbSBh\nbiBleHRlcm5hbGl6YXRpb24gaW5wdXQgc3RyZWFtLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcmVhZEV4dGVybmFsKENvZGUgY29kZSwgU3RyaW5nIGZp\nZWxkTmFtZSwgQ2xhc3MgdHlwZSwKICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAg\nICAgICBTdHJpbmcgbWV0aE5hbWU7CiAgICAgICAgaWYgKHR5cGUuaXNQcmlt\naXRpdmUoKSkgewogICAgICAgICAgICBtZXRoTmFtZSA9IHR5cGUuZ2V0TmFt\nZSgpOwogICAgICAgICAgICBtZXRoTmFtZSA9IENoYXJhY3Rlci50b1VwcGVy\nQ2FzZShtZXRoTmFtZS5jaGFyQXQoMCkpCiAgICAgICAgICAgICAgICArIG1l\ndGhOYW1lLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgbWV0aE5hbWUgPSAi\ncmVhZCIgKyBtZXRoTmFtZTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nbWV0aE5hbWUgPSAicmVhZE9iamVjdCI7CgogICAgICAgIC8vIDxmaWVsZD4g\nPSBpbi5yZWFkPHR5cGU+ICgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICBDbGFzcyByZXQgPSAodHlwZS5pc1ByaW1pdGl2ZSgp\nKSA/IHR5cGUgOiBPYmplY3QuY2xhc3M7CiAgICAgICAgY29kZS5pbnZva2Vp\nbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0SW5wdXQuY2xhc3MsIG1ldGhO\nYW1lLAogICAgICAgICAgICByZXQsIG51bGwpOwogICAgICAgIGlmICghdHlw\nZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAg\nICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICBwdXRmaWVsZChjb2Rl\nLCBudWxsLCBmaWVsZE5hbWUsIHR5cGUpOwogICAgICAgIGVsc2UgewogICAg\nICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAg\nICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkg\newogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNBTEVOREFSOgogICAgICAgICAgICAgICAgICAgIC8vIGlmIChzbSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIC8vICAgc20ucHJveHlEZXRhY2hl\nZERlc2VyaWFsaXplZCAoPGluZGV4Pik7CiAgICAgICAgICAgICAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUp\nOwogICAgICAgICAgICAgICAgICAgIElmSW5zdHJ1Y3Rpb24gaWZpbnMgPSBj\nb2RlLmlmbnVsbCgpOwogICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kLmdldElu\nZGV4KCkpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwKICAgICAgICAgICAgICAgICAgICAg\nICAgInByb3h5RGV0YWNoZWREZXNlcmlhbGl6ZWQiLCB2b2lkLmNsYXNzLAog\nICAgICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNz\nIH0pOwogICAgICAgICAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2Rl\nLm5vcCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCBjdXN0b20gd3JpdGVFeHRlcm5hbCBtZXRob2QuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRXcml0ZUV4dGVybmFsKGJvb2xl\nYW4gcGFyZW50RGV0YWNoYWJsZSwKICAgICAgICBib29sZWFuIGRldGFjaGVk\nU3RhdGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgQ2xhc3NbXSBvdXRhcmdzID0gbmV3IENsYXNzW117IE9iamVj\ndE91dHB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMu\nZGVjbGFyZU1ldGhvZCgid3JpdGVFeHRlcm5hbCIsIHZvaWQuY2xhc3MsIG91\ndGFyZ3MpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gbWV0aC5nZXRF\neGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNlcHRpb24o\nSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGgu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3VwZXIud3JpdGVFeHRlcm5h\nbCAob3V0KTsKICAgICAgICBDbGFzcyBzdXAgPSBnZXRUeXBlKF9tZXRhKS5n\nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgaWYgKCFwYXJlbnREZXRhY2hhYmxl\nICYmIEV4dGVybmFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oc3Vw\nKSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qoc3Vw\nLCAid3JpdGVFeHRlcm5hbCIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNz\nLCBvdXRhcmdzKTsKICAgICAgICB9CgogICAgICAgIC8vIHdyaXRlVW5tYW5h\nZ2VkIChvdXQpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoZ2V0VHlwZShf\nbWV0YSksCiAgICAgICAgICAgIFBSRSArICJXcml0ZVVubWFuYWdlZCIsIHZv\naWQuY2xhc3MsIG91dGFyZ3MpOwoKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24g\nZ28yID0gbnVsbDsKICAgICAgICBpZiAoZGV0YWNoZWRTdGF0ZSkgewogICAg\nICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgLy8gICBp\nZiAoc20ud3JpdGVEZXRhY2hlZCAob3V0KSkKICAgICAgICAgICAgLy8gICAg\nICByZXR1cm47CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIElmSW5zdHJ1Y3Rpb24gaWZu\ndWxsID0gY29kZS5pZm51bGwoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZWlu\ndGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJ3cml0ZURldGFjaGVkIiwK\nICAgICAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG91dGFyZ3MpOwogICAg\nICAgICAgICBnbzIgPSBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgY29kZS52\ncmV0dXJuKCk7CgogICAgICAgICAgICAvLyBlbHNlCiAgICAgICAgICAgIC8v\nICAgb3V0LndyaXRlT2JqZWN0IChwY0dldERldGFjaGVkU3RhdGUgKCkpOwog\nICAgICAgICAgICBDbGFzc1tdIG9iamFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2Jq\nZWN0LmNsYXNzIH07CiAgICAgICAgICAgIGlmbnVsbC5zZXRUYXJnZXQoY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApKTsKICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0\nZSIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmpl\nY3RPdXRwdXQuY2xhc3MsCiAgICAgICAgICAgICAgICAid3JpdGVPYmplY3Qi\nLCB2b2lkLmNsYXNzLCBvYmphcmdzKTsKICAgICAgICAgICAgLy8gICAgb3V0\nLndyaXRlT2JqZWN0IChudWxsKSAvLyBTdGF0ZU1hbmFnZXIKICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoKE9iamVjdCkgbnVsbCk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdE91\ndHB1dC5jbGFzcywKICAgICAgICAgICAgICAgICJ3cml0ZU9iamVjdCIsIHZv\naWQuY2xhc3MsIG9iamFyZ3MpOwogICAgICAgIH0KICAgICAgICBpZiAoZ28y\nICE9IG51bGwpCiAgICAgICAgICAgIGdvMi5zZXRUYXJnZXQoY29kZS5ub3Ao\nKSk7CgogICAgICAgIC8vIHdyaXRlIG1hbmFnZWQgZmllbGRzCiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgIGlmICghZm1kc1tpXS5pc1RyYW5zaWVudCgpKQogICAgICAg\nICAgICAgICAgd3JpdGVFeHRlcm5hbChjb2RlLCBmbWRzW2ldLmdldE5hbWUo\nKSwKICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZSgpLCBmbWRzW2ldKTsKCiAgICAgICAgLy8gcmV0dXJuCiAgICAgICAgY29k\nZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXcml0ZSB1bm1hbmFnZWQgZmllbGRzIHRvIHRoZSBz\ndHJlYW0gKHBjV3JpdGVVbm1hbmFnZWQpLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkV3JpdGVVbm1hbmFnZWQoQ29sbGVjdGlvbiB1bm1nZCwgYm9v\nbGVhbiBwYXJlbnREZXRhY2hhYmxlKQogICAgICAgIHRocm93cyBOb1N1Y2hN\nZXRob2RFeGNlcHRpb24gewogICAgICAgIENsYXNzW10gb3V0YXJncyA9IG5l\ndyBDbGFzc1tdeyBPYmplY3RPdXRwdXQuY2xhc3MgfTsKICAgICAgICBCQ01l\ndGhvZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIldyaXRlVW5t\nYW5hZ2VkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgb3V0YXJncyk7CiAg\nICAgICAgbWV0aC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgRXhjZXB0aW9u\ncyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAgICAg\nZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAv\nLyBzdXBlci53cml0ZVVubWFuYWdlZCAob3V0KTsKICAgICAgICBpZiAocGFy\nZW50RGV0YWNoYWJsZSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5z\nZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiV3JpdGVVbm1hbmFnZWQi\nLCB2b2lkLmNsYXNzLCAKICAgICAgICAgICAgICAgIG91dGFyZ3MpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gd3JpdGUgZGVjbGFyZWQgdW5tYW5hZ2VkIHNl\ncmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkIGZpZWxkOwogICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdW5tZ2QuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZmllbGQgPSAoQkNGaWVsZCkg\naXRyLm5leHQoKTsKICAgICAgICAgICAgd3JpdGVFeHRlcm5hbChjb2RlLCBm\naWVsZC5nZXROYW1lKCksIGZpZWxkLmdldFR5cGUoKSwgbnVsbCk7CiAgICAg\nICAgfQogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0\nbyB3cml0ZSBhIGZpZWxkIHRvIGFuIGV4dGVybmFsaXphdGlvbiBvdXRwdXQg\nc3RyZWFtLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd3JpdGVFeHRlcm5h\nbChDb2RlIGNvZGUsIFN0cmluZyBmaWVsZE5hbWUsIENsYXNzIHR5cGUsCiAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3Vj\naE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG1ldGhOYW1lOwog\nICAgICAgIGlmICh0eXBlLmlzUHJpbWl0aXZlKCkpIHsKICAgICAgICAgICAg\nbWV0aE5hbWUgPSB0eXBlLmdldE5hbWUoKTsKICAgICAgICAgICAgbWV0aE5h\nbWUgPSBDaGFyYWN0ZXIudG9VcHBlckNhc2UobWV0aE5hbWUuY2hhckF0KDAp\nKQogICAgICAgICAgICAgICAgKyBtZXRoTmFtZS5zdWJzdHJpbmcoMSk7CiAg\nICAgICAgICAgIG1ldGhOYW1lID0gIndyaXRlIiArIG1ldGhOYW1lOwogICAg\nICAgIH0gZWxzZQogICAgICAgICAgICBtZXRoTmFtZSA9ICJ3cml0ZU9iamVj\ndCI7CgogICAgICAgIC8vIG91dC53cml0ZTx0eXBlPiAoPGZpZWxkPik7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGlmIChmbWQg\nPT0gbnVsbCkKICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgbnVsbCwgZmll\nbGROYW1lKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFkZEdldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBDbGFzc1tdIGFyZ3Mg\nPSBuZXcgQ2xhc3NbXXsgdHlwZSB9OwogICAgICAgIGlmICh0eXBlID09IGJ5\ndGUuY2xhc3MgfHwgdHlwZSA9PSBjaGFyLmNsYXNzIHx8IHR5cGUgPT0gc2hv\ncnQuY2xhc3MpCiAgICAgICAgICAgIGFyZ3NbMF0gPSBpbnQuY2xhc3M7CiAg\nICAgICAgZWxzZSBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSkKICAgICAgICAg\nICAgYXJnc1swXSA9IE9iamVjdC5jbGFzczsKICAgICAgICBjb2RlLmludm9r\nZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQuY2xhc3MsIG1l\ndGhOYW1lLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBhcmdzKTsKICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShDb2Rl\nIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIGFkZEdldE1hbmFnZWRWYWx1\nZUNvZGUoY29kZSwgZm1kLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIExvYWQgdGhlIGZpZWxkIHZhbHVlIHNwZWNpZmllZCBieSA8Y29kZT5mbWQ8\nL2NvZGU+IG9udG8gdGhlIHN0YWNrLgogICAgICogQmVmb3JlIHRoaXMgbWV0\naG9kIGlzIGNhbGxlZCwgdGhlIG9iamVjdCB0aGF0IHRoZSBkYXRhIHNob3Vs\nZCBiZSBsb2FkZWQKICAgICAqIGZyb20gd2lsbCBiZSBvbiB0aGUgdG9wIG9m\nIHRoZSBzdGFjay4KICAgICAqCiAgICAgKiBAcGFyYW0gZnJvbVNhbWVDbGFz\ncyBpZiA8Y29kZT50cnVlPC9jb2RlPiwgdGhlbiA8Y29kZT5mbWQ8L2NvZGU+\nIGlzCiAgICAgKiBiZWluZyBsb2FkZWQgZnJvbSBhbiBpbnN0YW5jZSBvZiB0\naGUgc2FtZSBjbGFzcyBhcyB0aGUgY3VycmVudCBleGVjdXRpb24KICAgICAq\nIGNvbnRleHQuIElmIDxjb2RlPmZhbHNlPC9jb2RlPiwgdGhlbiB0aGUgaW5z\ndGFuY2Ugb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sKICAgICAqIG1pZ2h0IGJl\nIGEgc3VwZXJjbGFzcyBvZiB0aGUgY3VycmVudCBleGVjdXRpb24gY29udGV4\ndCdzICd0aGlzJyBpbnN0YW5jZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoQ29kZSBjb2RlLCBGaWVsZE1ldGFE\nYXRhIGZtZCwKICAgICAgICBib29sZWFuIGZyb21TYW1lQ2xhc3MpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\naWYgcmVkZWZpbmluZywgdGhlbiB3ZSBtdXN0IGFsd2F5cyByZWZsZWN0IChv\nciBhY2Nlc3MgdGhlIGZpZWxkCiAgICAgICAgLy8gZGlyZWN0bHkgaWYgYWNj\nZXNzaWJsZSksIHNpbmNlIHRoZSByZWRlZmluZWQgbWV0aG9kcyB3aWxsIGFs\nd2F5cwogICAgICAgIC8vIHRyaWdnZXIgbWV0aG9kIGNhbGxzIHRvIFN0YXRl\nTWFuYWdlciwgZXZlbiBmcm9tIGludGVybmFsIGRpcmVjdC0KICAgICAgICAv\nLyBhY2Nlc3MgdXNhZ2UuIFdlIGNvdWxkIHdvcmsgYXJvdW5kIHRoaXMgYnkg\nbm90IHJlZGVmaW5pbmcsIGFuZAogICAgICAgIC8vIGp1c3QgZG8gYSBzdWJj\nbGFzcyBhcHByb2FjaCBpbnN0ZWFkLiBCdXQgdGhpcyBpcyBub3QgYSBnb29k\nIG9wdGlvbiwKICAgICAgICAvLyBzaW5jZSBpdCB3b3VsZCBzYWNyaWZpY2Ug\nbGF6eSBsb2FkaW5nIGFuZCBlZmZpY2llbnQgZGlydHkgdHJhY2tpbmcuCgog\nICAgICAgIGlmIChnZXRSZWRlZmluZSgpCiAgICAgICAgICAgIHx8IF9tZXRh\nLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVM\nRCkgewogICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBudWxsLCBmbWQuZ2V0\nTmFtZSgpKTsKICAgICAgICB9IGVsc2UgaWYgKGdldENyZWF0ZVN1YmNsYXNz\nKCkpIHsKICAgICAgICAgICAgLy8gcHJvcGVydHkgYWNjZXNzLCBhbmQgd2Un\ncmUgbm90IHJlZGVmaW5pbmcuIElmIHdlJ3JlIG9wZXJhdGluZwogICAgICAg\nICAgICAvLyBvbiBhbiBpbnN0YW5jZSB0aGF0IGlzIGRlZmluaXRlbHkgdGhl\nIHNhbWUgdHlwZSBhcyAndGhpcycsIHRoZW4KICAgICAgICAgICAgLy8gY2Fs\nbCBzdXBlcmNsYXNzIG1ldGhvZCB0byBieXBhc3MgdHJhY2tpbmcuIE90aGVy\nd2lzZSwgcmVmbGVjdAogICAgICAgICAgICAvLyB0byBib3RoIGJ5cGFzcyB0\ncmFja2luZyBhbmQgYXZvaWQgY2xhc3MgdmVyaWZpY2F0aW9uIGVycm9ycy4K\nICAgICAgICAgICAgaWYgKGZyb21TYW1lQ2xhc3MpIHsKICAgICAgICAgICAg\nICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgZm1kLmdldEJhY2tpbmdNZW1i\nZXIoKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNl\ndE1ldGhvZChtZXRoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIGdldGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1lKCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g\ncmVndWxhciBlbmhhbmNlbWVudCArIHByb3BlcnR5IGFjY2VzcwogICAgICAg\nICAgICBNZXRob2QgbWV0aCA9IChNZXRob2QpIGZtZC5nZXRCYWNraW5nTWVt\nYmVyKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChQUkUgKyBtZXRoLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIG1l\ndGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSB2\nYWx1ZSBhdCB0aGUgdG9wIG9mIHRoZSBzdGFjayBpbnRvIHRoZSBmaWVsZCB2\nYWx1ZSBzcGVjaWZpZWQKICAgICAqIGJ5IDxjb2RlPmZtZDwvY29kZT4uIEJl\nZm9yZSB0aGlzIG1ldGhvZCBpcyBjYWxsZWQsIHRoZSBkYXRhIHRvIGxvYWQg\nd2lsbAogICAgICogYmUgb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sgYW5kIHRo\nZSBvYmplY3QgdGhhdCB0aGUgZGF0YSBzaG91bGQgYmUgbG9hZGVkCiAgICAg\nKiBpbnRvIHdpbGwgYmUgc2Vjb25kIGluIHRoZSBzdGFjay4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoQ29kZSBj\nb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiByZWRlZmluaW5nLCB0\naGVuIHdlIG11c3QgYWx3YXlzIHJlZmxlY3QgKG9yIGFjY2VzcyB0aGUgZmll\nbGQKICAgICAgICAvLyBkaXJlY3RseSBpZiBhY2Nlc3NpYmxlKSwgc2luY2Ug\ndGhlIHJlZGVmaW5lZCBtZXRob2RzIHdpbGwgYWx3YXlzCiAgICAgICAgLy8g\ndHJpZ2dlciBtZXRob2QgY2FsbHMgdG8gU3RhdGVNYW5hZ2VyLCBldmVuIGZy\nb20gaW50ZXJuYWwgZGlyZWN0LQogICAgICAgIC8vIGFjY2VzcyB1c2FnZS4g\nV2UgY291bGQgd29yayBhcm91bmQgdGhpcyBieSBub3QgcmVkZWZpbmluZywg\nYW5kCiAgICAgICAgLy8ganVzdCBkbyBhIHN1YmNsYXNzIGFwcHJvYWNoIGlu\nc3RlYWQuIEJ1dCB0aGlzIGlzIG5vdCBhIGdvb2Qgb3B0aW9uLAogICAgICAg\nIC8vIHNpbmNlIGl0IHdvdWxkIHNhY3JpZmljZSBsYXp5IGxvYWRpbmcgYW5k\nIGVmZmljaWVudCBkaXJ0eSB0cmFja2luZy4KCiAgICAgICAgaWYgKGdldFJl\nZGVmaW5lKCkKICAgICAgICAgICAgfHwgX21ldGEuZ2V0QWNjZXNzVHlwZSgp\nID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAg\nIHB1dGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1lKCksIGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgfSBlbHNlIGlmIChnZXRDcmVhdGVT\ndWJjbGFzcygpKSB7CiAgICAgICAgICAgIC8vIHByb3BlcnR5IGFjY2Vzcywg\nYW5kIHdlJ3JlIG5vdCByZWRlZmluaW5nLiBpbnZva2UgdGhlCiAgICAgICAg\nICAgIC8vIHN1cGVyY2xhc3MgbWV0aG9kIHRvIGJ5cGFzcyB0cmFja2luZy4K\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9t\nYW5hZ2VkVHlwZS5nZXRUeXBlKCksCiAgICAgICAgICAgICAgICBnZXRTZXR0\nZXJOYW1lKGZtZCksIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcg\nQ2xhc3NbXSB7IGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAvLyByZWd1bGFyIGVuaGFuY2VtZW50ICsg\ncHJvcGVydHkgYWNjZXNzCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVh\nbCgpLnNldE1ldGhvZChQUkUgKyBnZXRTZXR0ZXJOYW1lKGZtZCksCiAgICAg\nICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIG9mZnNldCB0aGF0IHRoZSBmaXJzdCBtZWFuaW5n\nZnVsIGFjY2Vzc29yIHBhcmFtZXRlciBpcyBhdC4KICAgICAqLwogICAgcHJp\ndmF0ZSBpbnQgZ2V0QWNjZXNzb3JQYXJhbWV0ZXJPZmZzZXQoKSB7CiAgICAg\nICAgcmV0dXJuIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5BQ0NFU1NfRklFTEQpID8gMSA6IDA7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgdGhlIHtAbGluayBJbnN0cnVjdGlvbn1zIHRvIGxvYWQgdGhl\nIGluc3RhbmNlIHRvIG1vZGlmeSBvbnRvIHRoZQogICAgICogc3RhY2ssIGFu\nZCByZXR1cm4gaXQuIElmIDxjb2RlPmZvclN0YXRpYzwvY29kZT4gaXMgc2V0\nLCB0aGVuCiAgICAgKiA8Y29kZT5jb2RlPC9jb2RlPiBpcyBpbiBhbiBhY2Nl\nc3NvciBtZXRob2Qgb3IgYW5vdGhlciBzdGF0aWMgbWV0aG9kOwogICAgICog\nb3RoZXJ3aXNlLCBpdCBpcyBpbiBvbmUgb2YgdGhlIFBDLXNwZWNpZmllZCBt\nZXRob2RzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpcnN0IGluc3Ry\ndWN0aW9uIGFkZGVkIHRvIDxjb2RlPmNvZGU8L2NvZGU+LgogICAgICovCiAg\nICBwcml2YXRlIEluc3RydWN0aW9uIGxvYWRNYW5hZ2VkSW5zdGFuY2UoQ29k\nZSBjb2RlLCBib29sZWFuIGZvclN0YXRpYykgewogICAgICAgIGlmIChfbWV0\nYS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklF\nTEQgJiYgZm9yU3RhdGljKQogICAgICAgICAgICByZXR1cm4gY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgIHJldHVybiBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBn\nZW5lcmF0ZWQgZ2V0dGVyIHtAbGluayBCQ01ldGhvZH0gZm9yIDxjb2RlPmZt\nZDwvY29kZT4uIFRoZQogICAgICogY2FsbGluZyBlbnZpcm9ubWVudCB3aWxs\nIHRoZW4gcG9wdWxhdGUgdGhpcyBtZXRob2QncyBjb2RlIGJsb2NrLgogICAg\nICovCiAgICBwcml2YXRlIEJDTWV0aG9kIGNyZWF0ZUdldE1ldGhvZChGaWVs\nZE1ldGFEYXRhIGZtZCkgewogICAgICAgIEJDTWV0aG9kIGdldHRlcjsKICAg\nICAgICBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURh\ndGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgIC8vIHN0YXRpYyA8Zmll\nbGR0eXBlPiBwY0dldDxmaWVsZD4gKFhYWCBpbnN0KQogICAgICAgICAgICBC\nQ0ZpZWxkIGZpZWxkID0gX3BjLmdldERlY2xhcmVkRmllbGQoZm1kLmdldE5h\nbWUoKSk7CiAgICAgICAgICAgIGdldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9k\nKFBSRSArICJHZXQiICsgZm1kLmdldE5hbWUoKSwgZm1kLgogICAgICAgICAg\nICAgICAgZ2V0RGVjbGFyZWRUeXBlKCkuZ2V0TmFtZSgpLCBuZXcgU3RyaW5n\nW117IF9wYy5nZXROYW1lKCkgfSk7CiAgICAgICAgICAgIGdldHRlci5zZXRB\nY2Nlc3NGbGFncyhmaWVsZC5nZXRBY2Nlc3NGbGFncygpCiAgICAgICAgICAg\nICAgICAmIH5Db25zdGFudHMuQUNDRVNTX1RSQU5TSUVOVCAmIH5Db25zdGFu\ndHMuQUNDRVNTX1ZPTEFUSUxFKTsKICAgICAgICAgICAgZ2V0dGVyLnNldFN0\nYXRpYyh0cnVlKTsKICAgICAgICAgICAgZ2V0dGVyLnNldEZpbmFsKHRydWUp\nOwogICAgICAgICAgICByZXR1cm4gZ2V0dGVyOwogICAgICAgIH0KCiAgICAg\nICAgLy8gcHJvcGVydHkgYWNjZXNzOgogICAgICAgIC8vIGNvcHkgdGhlIHVz\nZXIncyBnZXR0ZXIgbWV0aG9kIHRvIGEgbmV3IG5hbWU7IHdlIGNhbid0IGp1\nc3QgcmVzZXQKICAgICAgICAvLyB0aGUgbmFtZSwgYmVjYXVzZSB0aGF0IHdp\nbGwgYWxzbyByZXNldCBhbGwgY2FsbHMgdG8gdGhlIG1ldGhvZAogICAgICAg\nIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgZm1kLmdldEJhY2tpbmdNZW1iZXIo\nKTsKICAgICAgICBnZXR0ZXIgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QobWV0\naC5nZXROYW1lKCksCiAgICAgICAgICAgIG1ldGguZ2V0UGFyYW1ldGVyVHlw\nZXMoKSk7CiAgICAgICAgQkNNZXRob2QgbmV3Z2V0dGVyID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgbWV0aC5nZXROYW1lKCksCiAgICAgICAgICAgIG1l\ndGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkp\nOwogICAgICAgIG5ld2dldHRlci5zZXRBY2Nlc3NGbGFncyhnZXR0ZXIuZ2V0\nQWNjZXNzRmxhZ3MoKSk7CiAgICAgICAgbmV3Z2V0dGVyLm1ha2VQcm90ZWN0\nZWQoKTsgCiAgICAgICAgdHJhbnNmZXJDb2RlQXR0cmlidXRlcyhnZXR0ZXIs\nIG5ld2dldHRlcik7CiAgICAgICAgcmV0dXJuIGdldHRlcjsKICAgIH0KCiAg\nICAvKioKICAgICAqIENyZWF0ZSB0aGUgZ2VuZXJhdGVkIHNldHRlciB7QGxp\nbmsgQkNNZXRob2R9IGZvciA8Y29kZT5mbWQ8L2NvZGU+LiBUaGUKICAgICAq\nIGNhbGxpbmcgZW52aXJvbm1lbnQgd2lsbCB0aGVuIHBvcHVsYXRlIHRoaXMg\nbWV0aG9kJ3MgY29kZSBibG9jay4KICAgICAqLwogICAgcHJpdmF0ZSBCQ01l\ndGhvZCBjcmVhdGVTZXRNZXRob2QoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAg\nICAgICBCQ01ldGhvZCBzZXR0ZXI7CiAgICAgICAgaWYgKF9tZXRhLmdldEFj\nY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkgewog\nICAgICAgICAgICAvLyBzdGF0aWMgdm9pZCBwY1NldDxmaWVsZD4gKFhYWCBp\nbnN0LCA8ZmllbGR0eXBlPiB2YWx1ZSkKICAgICAgICAgICAgQkNGaWVsZCBm\naWVsZCA9IF9wYy5nZXREZWNsYXJlZEZpZWxkKGZtZC5nZXROYW1lKCkpOwog\nICAgICAgICAgICBzZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAi\nU2V0IiArIGZtZC5nZXROYW1lKCksIHZvaWQuY2xhc3MsCiAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgZ2V0VHlwZShfbWV0YSksIGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSB9KTsKICAgICAgICAgICAgc2V0dGVyLnNldEFjY2Vzc0Zs\nYWdzKGZpZWxkLmdldEFjY2Vzc0ZsYWdzKCkKICAgICAgICAgICAgICAgICYg\nfkNvbnN0YW50cy5BQ0NFU1NfVFJBTlNJRU5UICYgfkNvbnN0YW50cy5BQ0NF\nU1NfVk9MQVRJTEUpOwogICAgICAgICAgICBzZXR0ZXIuc2V0U3RhdGljKHRy\ndWUpOwogICAgICAgICAgICBzZXR0ZXIuc2V0RmluYWwodHJ1ZSk7CiAgICAg\nICAgICAgIHJldHVybiBzZXR0ZXI7CiAgICAgICAgfQoKICAgICAgICAvLyBw\ncm9wZXJ0eSBhY2Nlc3M6CiAgICAgICAgLy8gY29weSB0aGUgdXNlcidzIGdl\ndHRlciBtZXRob2QgdG8gYSBuZXcgbmFtZTsgd2UgY2FuJ3QganVzdCByZXNl\ndAogICAgICAgIC8vIHRoZSBuYW1lLCBiZWNhdXNlIHRoYXQgd2lsbCBhbHNv\nIHJlc2V0IGFsbCBjYWxscyB0byB0aGUgbWV0aG9kCiAgICAgICAgc2V0dGVy\nID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKGdldFNldHRlck5hbWUoZm1kKSwK\nICAgICAgICAgICAgbmV3IENsYXNzW117IGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSB9KTsKICAgICAgICBCQ01ldGhvZCBuZXdzZXR0ZXIgPSBfcGMuZGVjbGFy\nZU1ldGhvZChQUkUgKyBzZXR0ZXIuZ2V0TmFtZSgpLAogICAgICAgICAgICBz\nZXR0ZXIuZ2V0UmV0dXJuTmFtZSgpLCBzZXR0ZXIuZ2V0UGFyYW1OYW1lcygp\nKTsKICAgICAgICBuZXdzZXR0ZXIuc2V0QWNjZXNzRmxhZ3Moc2V0dGVyLmdl\ndEFjY2Vzc0ZsYWdzKCkpOwogICAgICAgIG5ld3NldHRlci5tYWtlUHJvdGVj\ndGVkKCk7CiAgICAgICAgdHJhbnNmZXJDb2RlQXR0cmlidXRlcyhzZXR0ZXIs\nIG5ld3NldHRlcik7CiAgICAgICAgcmV0dXJuIHNldHRlcjsKICAgIH0KCiAg\nICBwcml2YXRlIHZvaWQgYWRkR2V0RW5oYW5jZW1lbnRDb250cmFjdFZlcnNp\nb25NZXRob2QoKSB7CiAgICAgICAgLy8gcHVibGljIGludCBnZXRFbmhhbmNl\nbWVudENvbnRyYWN0VmVyc2lvbigpCiAgICAgICAgQkNNZXRob2QgbWV0aG9k\nID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgCiAgICAgICAgICAgICAgICAi\nR2V0RW5oYW5jZW1lbnRDb250cmFjdFZlcnNpb24iLCBpbnQuY2xhc3MsIG51\nbGwpOwogICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgQ29k\nZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKEVOSEFOQ0VSX1ZFUlNJT04pOwogICAgICAg\nIGNvZGUuaXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb25jcmV0ZSB0eXBlIGZv\nciB0aGUgZ2l2ZW4gY2xhc3MsIGkuZS4gaW1wbCBmb3IgbWFuYWdlZAogICAg\nICogaW50ZXJmYWNlcwogICAgICovCiAgICBwdWJsaWMgQ2xhc3MgZ2V0VHlw\nZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5nZXRJ\nbnRlcmZhY2VJbXBsKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG1l\ndGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAgICAgIHJldHVybiBtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1vdmUg\nY29kZS1yZWxhdGVkIGF0dHJpYnV0ZXMgZnJvbSBvbmUgbWV0aG9kIHRvIGFu\nb3RoZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgdHJhbnNm\nZXJDb2RlQXR0cmlidXRlcyhCQ01ldGhvZCBmcm9tLCBCQ01ldGhvZCB0bykg\newogICAgICAgIENvZGUgY29kZSA9IGZyb20uZ2V0Q29kZShmYWxzZSk7CiAg\nICAgICAgaWYgKGNvZGUgIT0gbnVsbCkgewogICAgICAgICAgICB0by5hZGRB\ndHRyaWJ1dGUoY29kZSk7CiAgICAgICAgICAgIGZyb20ucmVtb3ZlQ29kZSgp\nOwogICAgICAgIH0KCiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMgPSBmcm9t\nLmdldEV4Y2VwdGlvbnMoZmFsc2UpOwogICAgICAgIGlmIChleGNlcHMgIT0g\nbnVsbCkKICAgICAgICAgICAgdG8uYWRkQXR0cmlidXRlKGV4Y2Vwcyk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBVc2FnZTogamF2YSBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QQ0VuaGFuY2VyIFtvcHRpb25dKgogICAgICogJmx0\nO2NsYXNzIG5hbWUgfCAuamF2YSBmaWxlIHwgLmNsYXNzIGZpbGUgfCAuamRv\nIGZpbGUmZ3Q7KwogICAgICogIFdoZXJlIHRoZSBmb2xsb3dpbmcgb3B0aW9u\ncyBhcmUgcmVjb2duaXplZC4KICAgICAqIDx1bD4KICAgICAqIDxsaT48aT4t\ncHJvcGVydGllcy8tcCAmbHQ7cHJvcGVydGllcyBmaWxlJmd0OzwvaT46IFRo\nZSBwYXRoIHRvIGEgT3BlbkpQQQogICAgICogcHJvcGVydGllcyBmaWxlIGNv\nbnRhaW5pbmcgaW5mb3JtYXRpb24gYXMgb3V0bGluZWQgaW4KICAgICAqIHtA\nbGluayBDb25maWd1cmF0aW9ufTsgb3B0aW9uYWwuPC9saT4KICAgICAqIDxs\naT48aT4tJmx0O3Byb3BlcnR5IG5hbWUmZ3Q7ICZsdDtwcm9wZXJ0eSB2YWx1\nZSZndDs8L2k+OiBBbGwgYmVhbgogICAgICogcHJvcGVydGllcyBvZiB0aGUg\nc3RhbmRhcmQgT3BlbkpQQSB7QGxpbmsgT3BlbkpQQUNvbmZpZ3VyYXRpb259\nIGNhbiBiZQogICAgICogc2V0IGJ5IHVzaW5nIHRoZWlyIG5hbWVzIGFuZCBz\ndXBwbHlpbmcgYSB2YWx1ZTsgZm9yIGV4YW1wbGU6CiAgICAgKiA8bGk+PGk+\nLWRpcmVjdG9yeS8tZCAmbHQ7YnVpbGQgZGlyZWN0b3J5Jmd0OzwvaT46IFRo\nZSBwYXRoIHRvIHRoZSBiYXNlCiAgICAgKiBkaXJlY3Rvcnkgd2hlcmUgZW5o\nYW5jZWQgY2xhc3NlcyBhcmUgc3RvcmVkLiBCeSBkZWZhdWx0LCB0aGUKICAg\nICAqIGVuaGFuY2VyIG92ZXJ3cml0ZXMgdGhlIG9yaWdpbmFsIC5jbGFzcyBm\naWxlIHdpdGggdGhlIGVuaGFuY2VkCiAgICAgKiB2ZXJzaW9uLiBVc2UgdGhp\ncyBvcHRpb24gdG8gc3RvcmUgdGhlIGdlbmVyYXRlZCAuY2xhc3MgZmlsZSBp\nbgogICAgICogYW5vdGhlciBkaXJlY3RvcnkuIFRoZSBwYWNrYWdlIHN0cnVj\ndHVyZSB3aWxsIGJlIGNyZWF0ZWQgYmVuZWF0aAogICAgICogdGhlIGdpdmVu\nIGRpcmVjdG9yeS48L2xpPgogICAgICogPGxpPjxpPi1hZGREZWZhdWx0Q29u\nc3RydWN0b3IvLWFkYyBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+OiBXaGV0aGVy\nIHRvCiAgICAgKiBhZGQgYSBkZWZhdWx0IGNvbnN0cnVjdG9yIHRvIHBlcnNp\nc3RlbnQgY2xhc3NlcyBtaXNzaW5nIG9uZSwgYXMKICAgICAqIG9wcG9zZWQg\ndG8gdGhyb3dpbmcgYW4gZXhjZXB0aW9uLiBEZWZhdWx0cyB0byB0cnVlLjwv\nbGk+CiAgICAgKiA8bGk+PGk+LXRtcENsYXNzTG9hZGVyLy10Y2wgW3RydWUv\ndCB8IGZhbHNlL2ZdPC9pPjogV2hldGhlciB0bwogICAgICogbG9hZCB0aGUg\ncHJlLWVuaGFuY2VkIGNsYXNzZXMgdXNpbmcgYSB0ZW1wb3JhcnkgY2xhc3Mg\nbG9hZGVyLgogICAgICogRGVmYXVsdHMgdG8gdHJ1ZS4gU2V0IHRoaXMgdG8g\nZmFsc2Ugd2hlbiBhdHRlbXB0aW5nIHRvIGRlYnVnCiAgICAgKiBjbGFzcyBs\nb2FkaW5nIGVycm9ycy48L2xpPgogICAgICogPGxpPjxpPi1lbmZvcmNlUHJv\ncGVydHlSZXN0cmljdGlvbnMvLWVwciBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+\nOgogICAgICogV2hldGhlciB0byB0aHJvdyBhbiBleGNlcHRpb24gaWYgYSBQ\nUk9QRVJUWSBhY2Nlc3MgZW50aXR5IGFwcGVhcnMKICAgICAqIHRvIGJlIHZp\nb2xhdGluZyBzdGFuZGFyZCBwcm9wZXJ0eSByZXN0cmljdGlvbnMuIERlZmF1\nbHRzIHRvIGZhbHNlLjwvbGk+CiAgICAgKiA8L3VsPgogICAgICogIEVhY2gg\nYWRkaXRpb25hbCBhcmd1bWVudCBjYW4gYmUgZWl0aGVyIHRoZSBmdWxsIGNs\nYXNzIG5hbWUgb2YgdGhlCiAgICAgKiB0eXBlIHRvIGVuaGFuY2UsIHRoZSBw\nYXRoIHRvIHRoZSAuamF2YSBmaWxlIGZvciB0aGUgdHlwZSwgdGhlIHBhdGgg\ndG8KICAgICAqIHRoZSAuY2xhc3MgZmlsZSBmb3IgdGhlIHR5cGUsIG9yIHRo\nZSBwYXRoIHRvIGEgLmpkbyBmaWxlIGxpc3Rpbmcgb25lCiAgICAgKiBvciBt\nb3JlIHR5cGVzIHRvIGVuaGFuY2UuCiAgICAgKiBJZiB0aGUgdHlwZSBiZWlu\nZyBlbmhhbmNlZCBoYXMgbWV0YWRhdGEsIGl0IHdpbGwgYmUgZW5oYW5jZWQg\nYXMgYQogICAgICogcGVyc2lzdGVuY2UgY2FwYWJsZSBjbGFzcy4gSWYgbm90\nLCBpdCB3aWxsIGJlIGNvbnNpZGVyZWQgYSBwZXJzaXN0ZW5jZQogICAgICog\nYXdhcmUgY2xhc3MsIGFuZCBhbGwgYWNjZXNzIHRvIGZpZWxkcyBvZiBwZXJz\naXN0ZW5jZSBjYXBhYmxlIGNsYXNzZXMKICAgICAqIHdpbGwgYmUgcmVwbGFj\nZWQgYnkgdGhlIGFwcHJvcHJpYXRlCWdldC9zZXQgbWV0aG9kLiBJZiB0aGUg\ndHlwZQogICAgICogZXhwbGljaXRseSBkZWNsYXJlcyB0aGUgcGVyc2lzdGVu\nY2UtY2FwYWJsZSBpbnRlcmZhY2UsIGl0IHdpbGwKICAgICAqIG5vdCBiZSBl\nbmhhbmNlZC4gVGh1cywgaXQgaXMgc2FmZSB0byBpbnZva2UgdGhlIGVuaGFu\nY2VyIG9uIGNsYXNzZXMKICAgICAqIHRoYXQgYXJlIGFscmVhZHkgZW5oYW5j\nZWQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmlu\nZ1tdIGFyZ3MpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICBPcHRpb25zIG9wdHMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgIGFyZ3Mg\nPSBvcHRzLnNldEZyb21DbWRMaW5lKGFyZ3MpOwogICAgICAgIE9wZW5KUEFD\nb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgT3BlbkpQQUNvbmZpZ3VyYXRpb25J\nbXBsKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFydW4oY29u\nZiwgYXJncywgb3B0cykpCiAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnBy\naW50bG4oX2xvYy5nZXQoImVuaGFuY2UtdXNhZ2UiKSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgY29uZi5jbG9zZSgpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJ1biB0aGUgdG9vbC4gUmV0dXJucyBm\nYWxzZSBpZiBpbnZhbGlkIG9wdGlvbnMgZ2l2ZW4uCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgYm9vbGVhbiBydW4oT3BlbkpQQUNvbmZpZ3VyYXRpb24g\nY29uZiwgU3RyaW5nW10gYXJncywKICAgICAgICBPcHRpb25zIG9wdHMpCiAg\nICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAob3B0cy5j\nb250YWluc0tleSgiaGVscCIpIHx8IG9wdHMuY29udGFpbnNLZXkoIi1oZWxw\nIikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgRmxhZ3Mg\nZmxhZ3MgPSBuZXcgRmxhZ3MoKTsKICAgICAgICBmbGFncy5kaXJlY3Rvcnkg\nPSBGaWxlcy5nZXRGaWxlKG9wdHMucmVtb3ZlUHJvcGVydHkoImRpcmVjdG9y\neSIsICJkIiwKICAgICAgICAgICAgbnVsbCksIG51bGwpOwogICAgICAgIGZs\nYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3RvciA9IG9wdHMucmVtb3ZlQm9vbGVh\nblByb3BlcnR5CiAgICAgICAgICAgICgiYWRkRGVmYXVsdENvbnN0cnVjdG9y\nIiwgImFkYyIsIGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAg\nICAgZmxhZ3MudG1wQ2xhc3NMb2FkZXIgPSBvcHRzLnJlbW92ZUJvb2xlYW5Q\ncm9wZXJ0eQogICAgICAgICAgICAoInRtcENsYXNzTG9hZGVyIiwgInRjbCIs\nIGZsYWdzLnRtcENsYXNzTG9hZGVyKTsKICAgICAgICBmbGFncy5lbmZvcmNl\nUHJvcGVydHlSZXN0cmljdGlvbnMgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9w\nZXJ0eQogICAgICAgICAgICAoImVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9u\ncyIsICJlcHIiLAogICAgICAgICAgICAgICAgZmxhZ3MuZW5mb3JjZVByb3Bl\ncnR5UmVzdHJpY3Rpb25zKTsKCiAgICAgICAgQ29uZmlndXJhdGlvbnMucG9w\ndWxhdGVDb25maWd1cmF0aW9uKGNvbmYsIG9wdHMpOwogICAgICAgIHJldHVy\nbiBydW4oY29uZiwgYXJncywgZmxhZ3MsIG51bGwsIG51bGwsIG51bGwpOwog\nICAgfQoKICAgIC8qKgogICAgICogRW5oYW5jZSB0aGUgZ2l2ZW4gY2xhc3Nl\ncy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIHJ1bihPcGVu\nSlBBQ29uZmlndXJhdGlvbiBjb25mLCBTdHJpbmdbXSBhcmdzLAogICAgICAg\nIEZsYWdzIGZsYWdzLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MsIEJ5dGVj\nb2RlV3JpdGVyIHdyaXRlciwKICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIp\nCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAobG9h\nZGVyID09IG51bGwpCiAgICAgICAgICAgIGxvYWRlciA9IGNvbmYuZ2V0Q2xh\nc3NSZXNvbHZlckluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRDbGFz\nc0xvYWRlcihQQ0VuaGFuY2VyLmNsYXNzLCBudWxsKTsKICAgICAgICBpZiAo\nZmxhZ3MudG1wQ2xhc3NMb2FkZXIpCiAgICAgICAgICAgIGxvYWRlciA9IChD\nbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJE\nb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAgIC5uZXdUZW1wb3JhcnlDbGFz\nc0xvYWRlckFjdGlvbihsb2FkZXIpKTsKCiAgICAgICAgaWYgKHJlcG9zID09\nIG51bGwpIHsKICAgICAgICAgICAgcmVwb3MgPSBjb25mLm5ld01ldGFEYXRh\nUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAgIHJlcG9zLnNldFNv\ndXJjZU1vZGUoTWV0YURhdGFSZXBvc2l0b3J5Lk1PREVfTUVUQSk7CiAgICAg\nICAgfQoKICAgICAgICBMb2cgbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNv\nbmZpZ3VyYXRpb24uTE9HX1RPT0wpOwogICAgICAgIENvbGxlY3Rpb24gY2xh\nc3NlczsKICAgICAgICBpZiAoYXJncy5sZW5ndGggPT0gMCkgewogICAgICAg\nICAgICBsb2cuaW5mbyhfbG9jLmdldCgicnVubmluZy1hbGwtY2xhc3NlcyIp\nKTsKICAgICAgICAgICAgY2xhc3NlcyA9IHJlcG9zLmdldFBlcnNpc3RlbnRU\neXBlTmFtZXModHJ1ZSwgbG9hZGVyKTsKICAgICAgICAgICAgaWYgKGNsYXNz\nZXMgPT0gbnVsbCkgewogICAgICAgICAgICAJbG9nLndhcm4oX2xvYy5nZXQo\nIm5vLWNsYXNzLXRvLWVuaGFuY2UiKSk7CiAgICAgICAgICAgIAlyZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBDbGFzc0FyZ1BhcnNlciBjYXAgPSBjb25mLmdldE1ldGFEYXRhUmVw\nb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0\nYUZhY3RvcnkoKS5uZXdDbGFzc0FyZ1BhcnNlcigpOwogICAgICAgICAgICBj\nYXAuc2V0Q2xhc3NMb2FkZXIobG9hZGVyKTsKICAgICAgICAgICAgY2xhc3Nl\ncyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgYXJncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNsYXNz\nZXMuYWRkQWxsKEFycmF5cy5hc0xpc3QoY2FwLnBhcnNlVHlwZXMoYXJnc1tp\nXSkpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgUHJvamVjdCBwcm9q\nZWN0ID0gbmV3IFByb2plY3QoKTsKICAgICAgICBCQ0NsYXNzIGJjOwogICAg\nICAgIFBDRW5oYW5jZXIgZW5oYW5jZXI7CiAgICAgICAgaW50IHN0YXR1czsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNsYXNzZXMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgT2JqZWN0IG8gPSBp\ndHIubmV4dCgpOwogICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImVuaGFu\nY2UtcnVubmluZyIsIG8pKTsKCiAgICAgICAgICAgIGlmIChvIGluc3RhbmNl\nb2YgU3RyaW5nKQogICAgICAgICAgICAgICAgYmMgPSBwcm9qZWN0LmxvYWRD\nbGFzcygoU3RyaW5nKSBvLCBsb2FkZXIpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBiYyA9IHByb2plY3QubG9hZENsYXNzKChDbGFzcykg\nbyk7CiAgICAgICAgICAgIGVuaGFuY2VyID0gbmV3IFBDRW5oYW5jZXIoY29u\nZiwgYmMsIHJlcG9zLCBsb2FkZXIpOwogICAgICAgICAgICBpZiAod3JpdGVy\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBlbmhhbmNlci5zZXRCeXRlY29k\nZVdyaXRlcih3cml0ZXIpOwogICAgICAgICAgICBlbmhhbmNlci5zZXREaXJl\nY3RvcnkoZmxhZ3MuZGlyZWN0b3J5KTsKICAgICAgICAgICAgZW5oYW5jZXIu\nc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKGZsYWdzLmFkZERlZmF1bHRDb25z\ndHJ1Y3Rvcik7CiAgICAgICAgICAgIHN0YXR1cyA9IGVuaGFuY2VyLnJ1bigp\nOwogICAgICAgICAgICBpZiAoc3RhdHVzID09IEVOSEFOQ0VfTk9ORSkgewog\nICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiZW5oYW5jZS1u\nb3J1biIpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT0gRU5I\nQU5DRV9JTlRFUkZBQ0UpIHsKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2Uo\nX2xvYy5nZXQoImVuaGFuY2UtaW50ZXJmYWNlIikpOwogICAgICAgICAgICB9\nIGVsc2UgaWYgKHN0YXR1cyA9PSBFTkhBTkNFX0FXQVJFKSB7CiAgICAgICAg\nICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmhhbmNlLWF3YXJlIikp\nOwogICAgICAgICAgICAgICAgZW5oYW5jZXIucmVjb3JkKCk7CiAgICAgICAg\nICAgIH0gZWxzZQogICAgICAgICAgICAgICAgZW5oYW5jZXIucmVjb3JkKCk7\nCiAgICAgICAgICAgIHByb2plY3QuY2xlYXIoKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSdW4gZmxh\nZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgRmxhZ3MgewoK\nICAgICAgICBwdWJsaWMgRmlsZSBkaXJlY3RvcnkgPSBudWxsOwogICAgICAg\nIHB1YmxpYyBib29sZWFuIGFkZERlZmF1bHRDb25zdHJ1Y3RvciA9IHRydWU7\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gdG1wQ2xhc3NMb2FkZXIgPSB0cnVl\nOwoJCXB1YmxpYyBib29sZWFuIGVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9u\ncyA9IGZhbHNlOwoJfQoKCS8qKgogCSAqIFBsdWdpbiBpbnRlcmZhY2UgZm9y\nIGFkZGl0aW9uYWwgZW5oYW5jZW1lbnQuCgkgKi8KCXB1YmxpYyBzdGF0aWMg\naW50ZXJmYWNlIEF1eGlsaWFyeUVuaGFuY2VyCgl7CgkJcHVibGljIHZvaWQg\ncnVuIChCQ0NsYXNzIGJjLCBDbGFzc01ldGFEYXRhIG1ldGEpOwoJCXB1Ymxp\nYyBib29sZWFuIHNraXBFbmhhbmNlKEJDTWV0aG9kIG0pOwoJfQp9Cg==\n","encoding":"base64"}

