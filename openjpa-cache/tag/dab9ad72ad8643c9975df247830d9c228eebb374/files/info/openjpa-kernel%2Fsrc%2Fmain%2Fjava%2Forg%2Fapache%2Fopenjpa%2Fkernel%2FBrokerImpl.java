{"sha":"3a924b45b033a19f43aea702f43d0b2586a1f8a6","node_id":"MDQ6QmxvYjIwNjM2NDozYTkyNGI0NWIwMzNhMTlmNDNhZWE3MDJmNDNkMGIyNTg2YTFmOGE2","size":166305,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3a924b45b033a19f43aea702f43d0b2586a1f8a6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nTW9kaWZpZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xs\nZXI7CmltcG9ydCBqYXZhLnV0aWwuQWJzdHJhY3RDb2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGph\ndmEudXRpbC5TZXQ7CmltcG9ydCBqYXZheC50cmFuc2FjdGlvbi5TdGF0dXM7\nCmltcG9ydCBqYXZheC50cmFuc2FjdGlvbi5TeW5jaHJvbml6YXRpb247Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLml0ZXJhdG9y\ncy5JdGVyYXRvckNoYWluOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNv\nbGxlY3Rpb25zLm1hcC5JZGVudGl0eU1hcDsKaW1wb3J0IG9yZy5hcGFjaGUu\nY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3Jn\nLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLnNldC5NYXBCYWNrZWRTZXQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5Db21wYXRpYmlsaXR5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZp\nZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hl\nLkRhdGFDYWNoZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lZS5NYW5h\nZ2VkUnVudGltZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNl\nLlBDUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmV2ZW50LlJlbW90ZUNvbW1pdEV2ZW50TWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5UcmFuc2FjdGlv\nbkV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LlRyYW5z\nYWN0aW9uRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5leHBzLkV4cHJlc3Npb25QYXJzZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLlJlZmVyZW5jZUhhc2hNYXA7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlSGFzaFNl\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5SZWZlcmVu\nY2VNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuY29u\nY3VycmVudC5SZWVudHJhbnRMb2NrOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5TZXF1ZW5jZU1ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2FsbGJhY2tFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRT\ndGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk5vVHJhbnNhY3Rpb25FeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5PYmplY3RFeGlzdHNFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0aWNFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5SdW50aW1l\nRXhjZXB0aW9uVHJhbnNsYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlN0b3JlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAqIENvbmNy\nZXRlIHtAbGluayBCcm9rZXJ9LiBUaGUgYnJva2VyIGhhbmRsZXMgb2JqZWN0\nLWxldmVsIGJlaGF2aW9yLAogKiBidXQgbGVhdmVzIGFsbCBpbnRlcmFjdGlv\nbiB3aXRoIHRoZSBkYXRhIHN0b3JlIHRvIGEge0BsaW5rIFN0b3JlTWFuYWdl\ncn0KICogdGhhdCBtdXN0IGJlIHN1cHBsaWVkIGF0IGluaXRpYWxpemF0aW9u\nLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIEJy\nb2tlckltcGwKICAgIGltcGxlbWVudHMgQnJva2VyLCBGaW5kQ2FsbGJhY2tz\nLCBDbG9uZWFibGUgewoKICAgIC8qKgogICAgICogSW5jcmVtZW50YWwgZmx1\nc2guCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IEZM\nVVNIX0lOQyA9IDA7CgogICAgLyoqCiAgICAgKiBGbHVzaCBpbiBwcmVwYXJh\ndGlvbiBvZiBjb21taXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMg\nZmluYWwgaW50IEZMVVNIX0NPTU1JVCA9IDE7CgogICAgLyoqCiAgICAgKiBG\nbHVzaCB0byBjaGVjayBjb25zaXN0ZW5jeSBvZiBjYWNoZSwgdGhlbiBpbW1l\nZGlhdGVseSByb2xsYmFjayBjaGFuZ2VzLgogICAgICovCiAgICBwcm90ZWN0\nZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9ST0xMQkFDSyA9IDI7CgogICAg\nLyoqCiAgICAgKiBSdW4gcGVyc2lzdGVuY2UtYnktcmVhY2hhYmlsaXR5IGFu\nZCBvdGhlciBmbHVzaC10aW1lIG9wZXJhdGlvbnMgd2l0aG91dAogICAgICog\nYWNjZXNzaW5nIHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfTE9HSUNBTCA9IDM7CgogICAgc3Rh\ndGljIGZpbmFsIGludCBTVEFUVVNfSU5JVCA9IDA7CiAgICBzdGF0aWMgZmlu\nYWwgaW50IFNUQVRVU19UUkFOU0lFTlQgPSAxOwogICAgc3RhdGljIGZpbmFs\nIGludCBTVEFUVVNfT0lEX0FTU0lHTiA9IDI7CiAgICBzdGF0aWMgZmluYWwg\naW50IFNUQVRVU19DT01NSVRfTkVXID0gMzsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19BQ1RJVkUgPSAyIDw8IDA7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19TVE9SRV9BQ1RJVkUgPSAyIDw8IDE7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19DTE9TRV9JTlZP\nS0VEID0gMiA8PCAyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfUFJFU1RPUklORyA9IDIgPDwgMzsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX0RFUkVGREVMRVRJTkcgPSAyIDw8IDQ7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVTSElORyA9IDIgPDwgNTsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1NUT1JFX0ZMVVNI\nSU5HID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfRkxVU0hFRCA9IDIgPDwgNzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBGTEFHX0ZMVVNIX1JFUVVJUkVEID0gMiA8PCA4OwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUkVNT1RFX0xJU1RFTkVSID0gMiA8\nPCA5OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUkVUQUlO\nRURfQ09OTiA9IDIgPDwgMTA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgRkxBR19UUkFOU19FTkRJTkcgPSAyIDw8IDExOwoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0KICAgICAgICBMb2NhbGl6\nZXIuZm9yUGFja2FnZShCcm9rZXJJbXBsLmNsYXNzKTsKCiAgICAvLwl0aGUg\nc3RvcmUgbWFuYWdlciBpbiB1c2U7IHRoaXMgbWF5IGJlIGEgZGVjb3JhdG9y\nIHN1Y2ggYXMgYQogICAgLy8JZGF0YSBjYWNoZSBzdG9yZSBtYW5hZ2VyIGFy\nb3VuZCB0aGUgbmF0aXZlIHN0b3JlIG1hbmFnZXIKICAgIHByaXZhdGUgRGVs\nZWdhdGluZ1N0b3JlTWFuYWdlciBfc3RvcmUgPSBudWxsOwoKICAgIC8vIHJl\nZiB0byBwcm9kdWNpbmcgZmFjdG9yeSBhbmQgY29uZmlndXJhdGlvbgogICAg\ncHJpdmF0ZSBBYnN0cmFjdEJyb2tlckZhY3RvcnkgX2ZhY3RvcnkgPSBudWxs\nOwogICAgcHJpdmF0ZSBPcGVuSlBBQ29uZmlndXJhdGlvbiBfY29uZiA9IG51\nbGw7CiAgICBwcml2YXRlIENvbXBhdGliaWxpdHkgX2NvbXBhdCA9IG51bGw7\nCiAgICBwcml2YXRlIEZldGNoQ29uZmlndXJhdGlvbiBfZmMgPSBudWxsOwog\nICAgcHJpdmF0ZSBMb2cgX2xvZyA9IG51bGw7CiAgICBwcml2YXRlIFN0cmlu\nZyBfdXNlciA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfcGFzcyA9IG51\nbGw7CiAgICBwcml2YXRlIE1hbmFnZWRSdW50aW1lIF9ydW50aW1lID0gbnVs\nbDsKICAgIHByaXZhdGUgTG9ja01hbmFnZXIgX2xtID0gbnVsbDsKICAgIHBy\naXZhdGUgSW52ZXJzZU1hbmFnZXIgX2ltID0gbnVsbDsKICAgIHByaXZhdGUg\nUmVlbnRyYW50TG9jayBfbG9jayA9IG51bGw7CiAgICBwcml2YXRlIE9wQ2Fs\nbGJhY2tzIF9jYWxsID0gbnVsbDsKICAgIHByaXZhdGUgUnVudGltZUV4Y2Vw\ndGlvblRyYW5zbGF0b3IgX2V4dHJhbnMgPSBudWxsOwoKICAgIC8vIGNhY2hl\nIGNsYXNzIGxvYWRlciBhc3NvY2lhdGVkIHdpdGggdGhlIGJyb2tlcgogICAg\ncHJpdmF0ZSBDbGFzc0xvYWRlciBfbG9hZGVyID0gbnVsbDsKCiAgICAvLyB1\nc2VyIHN0YXRlCiAgICBwcml2YXRlIFN5bmNocm9uaXphdGlvbiBfc3luYyA9\nIG51bGw7CiAgICBwcml2YXRlIE1hcCBfdXNlck9iamVjdHMgPSBudWxsOwoK\nICAgIC8vIG1hbmFnZWQgb2JqZWN0IGNhY2hlcwogICAgcHJpdmF0ZSBNYW5h\nZ2VkQ2FjaGUgX2NhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgVHJhbnNhY3Rp\nb25hbENhY2hlIF90cmFuc0NhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgU2V0\nIF90cmFuc0FkZGl0aW9ucyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVy\nZWZDYWNoZSA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVyZWZBZGRpdGlv\nbnMgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2xvYWRpbmcgPSBudWxsOwog\nICAgcHJpdmF0ZSBTZXQgX29wZXJhdGluZyA9IG51bGw7CiAgICBwcml2YXRl\nIFNldCBfcGVyc2lzdGVkQ2xzcyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBf\ndXBkYXRlZENsc3MgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQgX2RlbGV0ZWRD\nbHNzID0gbnVsbDsKICAgIHByaXZhdGUgU2V0IF9wZW5kaW5nID0gbnVsbDsK\nICAgIHByaXZhdGUgaW50IGZpbmRBbGxEZXB0aCA9IDA7CgogICAgLy8gdHJh\nY2sgaW5zdGFuY2VzIHRoYXQgYmVjb21lIHRyYW5zYWN0aW9uYWwgYWZ0ZXIg\ndGhlIGZpcnN0IHNhdmVwb2ludAogICAgLy8gKHRoZSBmaXJzdCB1c2VzIHRo\nZSB0cmFuc2FjdGlvbmFsIGNhY2hlKQogICAgcHJpdmF0ZSBTZXQgX3NhdmVw\nb2ludENhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgTGlua2VkTWFwIF9zYXZl\ncG9pbnRzID0gbnVsbDsKICAgIHByaXZhdGUgU2F2ZXBvaW50TWFuYWdlciBf\nc3BtID0gbnVsbDsKCiAgICAvLyB0cmFjayBvcGVuIHF1ZXJpZXMgYW5kIGV4\ndGVudHMgc28gd2UgY2FuIGZyZWUgdGhlaXIgcmVzb3VyY2VzIG9uIGNsb3Nl\nCiAgICBwcml2YXRlIFJlZmVyZW5jZUhhc2hTZXQgX3F1ZXJpZXMgPSBudWxs\nOwogICAgcHJpdmF0ZSBSZWZlcmVuY2VIYXNoU2V0IF9leHRlbnRzID0gbnVs\nbDsKCiAgICAvLyB0cmFjayBvcGVyYXRpb24gc3RhY2sgZGVwdGgKICAgIHBy\naXZhdGUgaW50IF9vcGVyYXRpb25Db3VudCA9IDA7CgogICAgLy8gb3B0aW9u\ncwogICAgcHJpdmF0ZSBib29sZWFuIF9ub250cmFuc1JlYWQgPSBmYWxzZTsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfbm9udHJhbnNXcml0ZSA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9yZXRhaW5TdGF0ZSA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBpbnQgX2F1dG9DbGVhciA9IENMRUFSX0RBVEFTVE9SRTsKICAg\nIHByaXZhdGUgaW50IF9yZXN0b3JlU3RhdGUgPSBSRVNUT1JFX0lNTVVUQUJM\nRTsKICAgIHByaXZhdGUgYm9vbGVhbiBfb3B0aW1pc3RpYyA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9pZ25vcmVDaGFuZ2VzID0gZmFsc2U7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX211bHRpdGhyZWFkZWQgPSBmYWxzZTsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfbWFuYWdlZCA9IGZhbHNlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9zeW5jTWFuYWdlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBp\nbnQgX2Nvbm5SZXRhaW5Nb2RlID0gQ09OTl9SRVRBSU5fREVNQU5EOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9ldmljdERhdGFDYWNoZSA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9wb3B1bGF0ZURhdGFDYWNoZSA9IHRydWU7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2xhcmdlVHJhbnNhY3Rpb24gPSBmYWxzZTsK\nICAgIHByaXZhdGUgaW50IF9hdXRvRGV0YWNoID0gMDsKICAgIHByaXZhdGUg\naW50IF9kZXRhY2hTdGF0ZSA9IERFVEFDSF9MT0FERUQ7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2RldGFjaGVkTmV3ID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfb3JkZXJEaXJ0eSA9IGZhbHNlOwoKICAgIC8vIHN0YXR1cwogICAg\ncHJpdmF0ZSBpbnQgX2ZsYWdzID0gMDsKICAgIHByaXZhdGUgYm9vbGVhbiBf\nY2xvc2VkID0gZmFsc2U7CiAgICBwcml2YXRlIFJ1bnRpbWVFeGNlcHRpb24g\nX2Nsb3NlZEV4Y2VwdGlvbiA9IG51bGw7CgogICAgLy8gZXZlbnQgbWFuYWdl\ncnMKICAgIHByaXZhdGUgVHJhbnNhY3Rpb25FdmVudE1hbmFnZXIgX3RyYW5z\nRXZlbnRNYW5hZ2VyID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF90cmFuc0Nh\nbGxiYWNrTW9kZSA9IDA7CiAgICBwcml2YXRlIExpZmVjeWNsZUV2ZW50TWFu\nYWdlciBfbGlmZUV2ZW50TWFuYWdlciA9IG51bGw7CiAgICBwcml2YXRlIGlu\ndCBfbGlmZUNhbGxiYWNrTW9kZSA9IDA7CgogICAgcHJpdmF0ZSBib29sZWFu\nIF9pbml0aWFsaXplV2FzSW52b2tlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgT2JqZWN0W10gRU1QVFlfT0JKRUNUUyA9IG5ldyBPYmpl\nY3RbMF07CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHBlcnNpc3RlbmNlIG1h\nbmFnZXIncyBhdXRoZW50aWNhdGlvbi4gVGhpcyBpcyB0aGUgZmlyc3QKICAg\nICAqIG1ldGhvZCBjYWxsZWQgYWZ0ZXIgY29uc3RydWN0aW9uLgogICAgICoK\nICAgICAqIEBwYXJhbSB1c2VyIHRoZSB1c2VybmFtZSB0aGlzIGJyb2tlciBy\nZXByZXNlbnRzOyB1c2VkIHdoZW4gcG9vbGluZwogICAgICogYnJva2VycyB0\nbyBtYWtlIHN1cmUgdGhhdCBhIHJlcXVlc3QgdG8gdGhlIGZhY3RvcnkgZm9y\nCiAgICAgKiBhIGNvbm5lY3Rpb24gd2l0aCBhbiBleHBsaWNpdCB1c2VyIGlz\nIGRlbGVnYXRlZCB0byBhIHN1aXRhYmxlIGJyb2tlcgogICAgICogQHBhcmFt\nIHBhc3MgdGhlIHBhc3N3b3JkIGZvciB0aGUgYWJvdmUgdXNlcgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRoZW50aWNhdGlvbihTdHJpbmcgdXNl\nciwgU3RyaW5nIHBhc3MpIHsKICAgICAgICBfdXNlciA9IHVzZXI7CiAgICAg\nICAgX3Bhc3MgPSBwYXNzOwogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlh\nbGl6ZSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlci4gVGhpcyBtZXRob2QgaXMg\nY2FsbGVkCiAgICAgKiBhdXRvbWF0aWNhbGx5IGJ5IHRoZSBmYWN0b3J5IGJl\nZm9yZSB1c2UuCiAgICAgKgogICAgICogQHBhcmFtIGZhY3RvcnkgdGhlIGZh\nY3RvcnkgdXNlZCB0byBjcmVhdGUgdGhpcyBicm9rZXIKICAgICAqIEBwYXJh\nbSBzbSBhIGNvbmNyZXRlIFN0b3JlTWFuYWdlciBpbXBsZW1lbnRhdGlvbiB0\nbwogICAgICogaGFuZGxlIGludGVyYWN0aW9uIHdpdGggdGhlIGRhdGEgc3Rv\ncmUKICAgICAqIEBwYXJhbSBtYW5hZ2VkIHRoZSB0cmFuc2FjdGlvbiBtb2Rl\nCiAgICAgKiBAcGFyYW0gY29ubk1vZGUgdGhlIGNvbm5lY3Rpb24gcmV0YWlu\nIG1vZGUKICAgICAqLwogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZShBYnN0\ncmFjdEJyb2tlckZhY3RvcnkgZmFjdG9yeSwKICAgICAgICBEZWxlZ2F0aW5n\nU3RvcmVNYW5hZ2VyIHNtLCBib29sZWFuIG1hbmFnZWQsIGludCBjb25uTW9k\nZSkgewogICAgICAgIF9pbml0aWFsaXplV2FzSW52b2tlZCA9IHRydWU7CiAg\nICAgICAgX2xvYWRlciA9IChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdl\ndENvbnRleHRDbGFzc0xvYWRlckFjdGlvbigpKTsKICAgICAgICBfY29uZiA9\nIGZhY3RvcnkuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgIF9jb21wYXQg\nPSBfY29uZi5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKTsKICAgICAgICBf\nZmFjdG9yeSA9IGZhY3Rvcnk7CiAgICAgICAgX2xvZyA9IF9jb25mLmdldExv\nZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfUlVOVElNRSk7CiAgICAgICAg\nX2NhY2hlID0gbmV3IE1hbmFnZWRDYWNoZShuZXdNYW5hZ2VkT2JqZWN0Q2Fj\naGUoKSk7CiAgICAgICAgX29wZXJhdGluZyA9IE1hcEJhY2tlZFNldC5kZWNv\ncmF0ZShuZXcgSWRlbnRpdHlNYXAoKSk7CiAgICAgICAgX2Nvbm5SZXRhaW5N\nb2RlID0gY29ubk1vZGU7CiAgICAgICAgX21hbmFnZWQgPSBtYW5hZ2VkOwog\nICAgICAgIGlmIChtYW5hZ2VkKQogICAgICAgICAgICBfcnVudGltZSA9IF9j\nb25mLmdldE1hbmFnZWRSdW50aW1lSW5zdGFuY2UoKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIF9ydW50aW1lID0gbmV3IExvY2FsTWFuYWdlZFJ1bnRp\nbWUodGhpcyk7CgogICAgICAgIF9saWZlRXZlbnRNYW5hZ2VyID0gbmV3IExp\nZmVjeWNsZUV2ZW50TWFuYWdlcigpOwogICAgICAgIF90cmFuc0V2ZW50TWFu\nYWdlciA9IG5ldyBUcmFuc2FjdGlvbkV2ZW50TWFuYWdlcigpOwogICAgICAg\nIGludCBjbW9kZSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3Rh\nbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLmdldERl\nZmF1bHRzKCkuZ2V0Q2FsbGJhY2tNb2RlKCk7CiAgICAgICAgc2V0TGlmZWN5\nY2xlTGlzdGVuZXJDYWxsYmFja01vZGUoY21vZGUpOwogICAgICAgIHNldFRy\nYW5zYWN0aW9uTGlzdGVuZXJDYWxsYmFja01vZGUoY21vZGUpOwoKICAgICAg\nICAvLyBzZXR1cCBkZWZhdWx0IG9wdGlvbnMKICAgICAgICBfZmFjdG9yeS5j\nb25maWd1cmVCcm9rZXIodGhpcyk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0\nbyBkbyB0aGlzIGFmdGVyIGNvbmZpZ3VyaW5nIGJyb2tlciBzbyB0aGF0IHN0\nb3JlIG1hbmFnZXIKICAgICAgICAvLyBjYW4gbG9vayB0byBicm9rZXIgY29u\nZmlndXJhdGlvbjsgd2Ugc2V0IGJvdGggc3RvcmUgYW5kIGxvY2sgbWFuYWdl\ncnMKICAgICAgICAvLyBiZWZvcmUgaW5pdGlhbGl6aW5nIHRoZW0gYmVjYXVz\nZSB0aGV5IG1heSBlYWNoIHRyeSB0byBhY2Nlc3MgdGhlCiAgICAgICAgLy8g\nb3RoZXIgaW4gdGhpZXIgaW5pdGlhbGl6YXRpb24KICAgICAgICBfc3RvcmUg\nPSBzbTsKICAgICAgICBfbG0gPSBfY29uZi5uZXdMb2NrTWFuYWdlckluc3Rh\nbmNlKCk7CiAgICAgICAgX2ltID0gX2NvbmYubmV3SW52ZXJzZU1hbmFnZXJJ\nbnN0YW5jZSgpOwogICAgICAgIF9zcG0gPSBfY29uZi5nZXRTYXZlcG9pbnRN\nYW5hZ2VySW5zdGFuY2UoKTsKICAgICAgICBfc3RvcmUuc2V0Q29udGV4dCh0\naGlzKTsKICAgICAgICBfbG0uc2V0Q29udGV4dCh0aGlzKTsKCiAgICAgICAg\naWYgKF9jb25uUmV0YWluTW9kZSA9PSBDT05OX1JFVEFJTl9BTFdBWVMpCiAg\nICAgICAgICAgIHJldGFpbkNvbm5lY3Rpb24oKTsKICAgICAgICBfZmMgPSBf\nc3RvcmUubmV3RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgX2ZjLnNl\ndENvbnRleHQodGhpcyk7CgogICAgICAgIC8vIHN5bmNoIHdpdGggdGhlIGds\nb2JhbCB0cmFuc2FjdGlvbiBpbiBwcm9ncmVzcywgaWYgYW55CiAgICAgICAg\naWYgKF9mYWN0b3J5LnN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKHRoaXMs\nIGZhbHNlKSkKICAgICAgICAgICAgYmVnaW5JbnRlcm5hbCgpOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoKQogICAgICAgIHRocm93cyBDbG9u\nZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9pbml0aWFs\naXplV2FzSW52b2tlZCkKICAgICAgICAgICAgdGhyb3cgbmV3IENsb25lTm90\nU3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIHJldHVybiBzdXBlci5jbG9uZSgpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIENyZWF0ZSBhIHtAbGluayBNYXB9IHRvIGJlIHVzZWQg\nZm9yIHRoZSBwcmltYXJ5IG1hbmFnZWQgb2JqZWN0IGNhY2hlLgogICAgICog\nTWFwcyBvaWRzIHRvIHN0YXRlIG1hbmFnZXJzLiBCeSBkZWZhdWx0LCB0aGlz\nIGNyZWF0ZXMgYQogICAgICoge0BsaW5rIFJlZmVyZW5jZU1hcH0gd2l0aCBz\nb2Z0IHZhbHVlcy4KICAgICAqLwogICAgcHJvdGVjdGVkIE1hcCBuZXdNYW5h\nZ2VkT2JqZWN0Q2FjaGUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBSZWZlcmVu\nY2VIYXNoTWFwKFJlZmVyZW5jZU1hcC5IQVJELCBSZWZlcmVuY2VNYXAuU09G\nVCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgU3RvcmVDb250ZXh0CiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVi\nbGljIEJyb2tlciBnZXRCcm9rZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8KICAgIC8vIFByb3BlcnRpZXMK\nICAgIC8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgc2V0SW1wbGlj\naXRCZWhhdmlvcihPcENhbGxiYWNrcyBjYWxsLAogICAgICAgIFJ1bnRpbWVF\neGNlcHRpb25UcmFuc2xhdG9yIGV4KSB7CiAgICAgICAgaWYgKF9jYWxsID09\nIG51bGwpCiAgICAgICAgICAgIF9jYWxsID0gY2FsbDsKICAgICAgICBpZiAo\nX2V4dHJhbnMgPT0gbnVsbCkKICAgICAgICAgICAgX2V4dHJhbnMgPSBleDsK\nICAgIH0KCiAgICBSdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvciBnZXRJbnN0\nYW5jZUV4Y2VwdGlvblRyYW5zbGF0b3IoKSB7CiAgICAgICAgcmV0dXJuIChf\nb3BlcmF0aW9uQ291bnQgPT0gMCkgPyBfZXh0cmFucyA6IG51bGw7CiAgICB9\nCgogICAgcHVibGljIEJyb2tlckZhY3RvcnkgZ2V0QnJva2VyRmFjdG9yeSgp\nIHsKICAgICAgICByZXR1cm4gX2ZhY3Rvcnk7CiAgICB9CgogICAgcHVibGlj\nIE9wZW5KUEFDb25maWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAg\nICAgICAgcmV0dXJuIF9jb25mOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENv\nbmZpZ3VyYXRpb24gZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAg\nIHJldHVybiBfZmM7CiAgICB9CgogICAgcHVibGljIGludCBnZXRDb25uZWN0\naW9uUmV0YWluTW9kZSgpIHsKICAgICAgICByZXR1cm4gX2Nvbm5SZXRhaW5N\nb2RlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzTWFuYWdlZCgpIHsK\nICAgICAgICByZXR1cm4gX21hbmFnZWQ7CiAgICB9CgogICAgcHVibGljIE1h\nbmFnZWRSdW50aW1lIGdldE1hbmFnZWRSdW50aW1lKCkgewogICAgICAgIHJl\ndHVybiBfcnVudGltZTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIg\nZ2V0Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkZXI7CiAg\nICB9CgogICAgcHVibGljIERlbGVnYXRpbmdTdG9yZU1hbmFnZXIgZ2V0U3Rv\ncmVNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfc3RvcmU7CiAgICB9Cgog\nICAgcHVibGljIExvY2tNYW5hZ2VyIGdldExvY2tNYW5hZ2VyKCkgewogICAg\nICAgIHJldHVybiBfbG07CiAgICB9CgogICAgcHVibGljIEludmVyc2VNYW5h\nZ2VyIGdldEludmVyc2VNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfaW07\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb25uZWN0aW9uVXNlck5h\nbWUoKSB7CiAgICAgICAgcmV0dXJuIF91c2VyOwogICAgfQoKICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0Q29ubmVjdGlvblBhc3N3b3JkKCkgewogICAgICAgIHJl\ndHVybiBfcGFzczsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRNdWx0\naXRocmVhZGVkKCkgewogICAgICAgIHJldHVybiBfbXVsdGl0aHJlYWRlZDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRNdWx0aXRocmVhZGVkKGJvb2xl\nYW4gbXVsdGl0aHJlYWRlZCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICBfbXVsdGl0aHJlYWRlZCA9IG11bHRpdGhyZWFkZWQ7CiAgICAgICAg\naWYgKG11bHRpdGhyZWFkZWQgJiYgX2xvY2sgPT0gbnVsbCkKICAgICAgICAg\nICAgX2xvY2sgPSBuZXcgUmVlbnRyYW50TG9jaygpOwogICAgICAgIGVsc2Ug\naWYgKCFtdWx0aXRocmVhZGVkKQogICAgICAgICAgICBfbG9jayA9IG51bGw7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0SWdub3JlQ2hhbmdlcygp\nIHsKICAgICAgICByZXR1cm4gX2lnbm9yZUNoYW5nZXM7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0SWdub3JlQ2hhbmdlcyhib29sZWFuIHZhbCkgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfaWdub3JlQ2hhbmdlcyA9\nIHZhbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXROb250cmFuc2Fj\ndGlvbmFsUmVhZCgpIHsKICAgICAgICByZXR1cm4gX25vbnRyYW5zUmVhZDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROb250cmFuc2FjdGlvbmFsUmVh\nZChib29sZWFuIHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICBpZiAoKF9mbGFncyAmIEZMQUdfUFJFU1RPUklORykgIT0gMCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImlsbGVn\nYWwtb3AtaW4tcHJlc3RvcmUiKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0\naGUgcnVudGltZSBzdXBwb3J0cyBpdAogICAgICAgIGlmICh2YWwgJiYgIV9j\nb25mLnN1cHBvcnRlZE9wdGlvbnMoKS5jb250YWlucwogICAgICAgICAgICAo\nX2NvbmYuT1BUSU9OX05PTlRSQU5TX1JFQUQpKQogICAgICAgICAgICB0aHJv\ndyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAg\nICAgICAgICgibm9udHJhbnMtcmVhZC1ub3Qtc3VwcG9ydGVkIikpOwoKICAg\nICAgICBfbm9udHJhbnNSZWFkID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGdldE5vbnRyYW5zYWN0aW9uYWxXcml0ZSgpIHsKICAgICAgICBy\nZXR1cm4gX25vbnRyYW5zV3JpdGU7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0Tm9udHJhbnNhY3Rpb25hbFdyaXRlKGJvb2xlYW4gdmFsKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19Q\nUkVTVE9SSU5HKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsK\nCiAgICAgICAgX25vbnRyYW5zV3JpdGUgPSB2YWw7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0T3B0aW1pc3RpYygpIHsKICAgICAgICByZXR1cm4g\nX29wdGltaXN0aWM7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0T3B0aW1p\nc3RpYyhib29sZWFuIHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJ0cmFucy1hY3RpdmUiLAogICAgICAgICAgICAgICAgIk9wdGltaXN0aWMi\nKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBzdXBwb3J0\ncyBpdAogICAgICAgIGlmICh2YWwgJiYgIV9jb25mLnN1cHBvcnRlZE9wdGlv\nbnMoKS5jb250YWlucyhfY29uZi5PUFRJT05fT1BUSU1JU1RJQykpCiAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdl\ndAogICAgICAgICAgICAgICAgKCJvcHRpbWlzdGljLW5vdC1zdXBwb3J0ZWQi\nKSk7CgogICAgICAgIF9vcHRpbWlzdGljID0gdmFsOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgZ2V0UmVzdG9yZVN0YXRlKCkgewogICAgICAgIHJldHVybiBf\ncmVzdG9yZVN0YXRlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJlc3Rv\ncmVTdGF0ZShpbnQgdmFsKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAg\nICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nInRyYW5zLWFjdGl2ZSIsCiAgICAgICAgICAgICAgICAiUmVzdG9yZSIpKTsK\nCiAgICAgICAgX3Jlc3RvcmVTdGF0ZSA9IHZhbDsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBnZXRSZXRhaW5TdGF0ZSgpIHsKICAgICAgICByZXR1cm4g\nX3JldGFpblN0YXRlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJldGFp\nblN0YXRlKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwog\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVTVE9SSU5HKSAhPSAwKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\naWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsKICAgICAgICBfcmV0YWluU3Rh\ndGUgPSB2YWw7CiAgICB9CgogICAgcHVibGljIGludCBnZXRBdXRvQ2xlYXIo\nKSB7CiAgICAgICAgcmV0dXJuIF9hdXRvQ2xlYXI7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0QXV0b0NsZWFyKGludCB2YWwpIHsKICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgX2F1dG9DbGVhciA9IHZhbDsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IGdldEF1dG9EZXRhY2goKSB7CiAgICAgICAgcmV0dXJu\nIF9hdXRvRGV0YWNoOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEF1dG9E\nZXRhY2goaW50IGRldGFjaEZsYWdzKSB7CiAgICAgICAgYXNzZXJ0T3Blbigp\nOwogICAgICAgIF9hdXRvRGV0YWNoID0gZGV0YWNoRmxhZ3M7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0QXV0b0RldGFjaChpbnQgZGV0YWNoRmxhZywg\nYm9vbGVhbiBvbikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBp\nZiAob24pCiAgICAgICAgICAgIF9hdXRvRGV0YWNoIHw9IGRldGFjaEZsYWc7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBfYXV0b0RldGFjaCAmPSB+ZGV0\nYWNoRmxhZzsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldERldGFjaFN0YXRl\nKCkgewogICAgICAgIHJldHVybiBfZGV0YWNoU3RhdGU7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0RGV0YWNoU3RhdGUoaW50IG1vZGUpIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2RldGFjaFN0YXRlID0gbW9kZTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RldGFjaGVkTmV3KCkgewog\nICAgICAgIHJldHVybiBfZGV0YWNoZWROZXc7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0RGV0YWNoZWROZXcoYm9vbGVhbiBpc05ldykgewogICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICBfZGV0YWNoZWROZXcgPSBpc05ldzsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRTeW5jV2l0aE1hbmFnZWRU\ncmFuc2FjdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIF9zeW5jTWFuYWdlZDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTeW5jV2l0aE1hbmFnZWRUcmFu\nc2FjdGlvbnMoYm9vbGVhbiBzeW5jKSB7CiAgICAgICAgYXNzZXJ0T3Blbigp\nOwogICAgICAgIF9zeW5jTWFuYWdlZCA9IHN5bmM7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0RXZpY3RGcm9tRGF0YUNhY2hlKCkgewogICAgICAg\nIHJldHVybiBfZXZpY3REYXRhQ2FjaGU7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0RXZpY3RGcm9tRGF0YUNhY2hlKGJvb2xlYW4gZXZpY3QpIHsKICAg\nICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2V2aWN0RGF0YUNhY2hlID0g\nZXZpY3Q7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0UG9wdWxhdGVE\nYXRhQ2FjaGUoKSB7CiAgICAgICAgcmV0dXJuIF9wb3B1bGF0ZURhdGFDYWNo\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRQb3B1bGF0ZURhdGFDYWNo\nZShib29sZWFuIGNhY2hlKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAg\nICAgIF9wb3B1bGF0ZURhdGFDYWNoZSA9IGNhY2hlOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzVHJhY2tDaGFuZ2VzQnlUeXBlKCkgewogICAgICAg\nIHJldHVybiBfbGFyZ2VUcmFuc2FjdGlvbjsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRUcmFja0NoYW5nZXNCeVR5cGUoYm9vbGVhbiBsYXJnZVRyYW5z\nYWN0aW9uKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9sYXJn\nZVRyYW5zYWN0aW9uID0gbGFyZ2VUcmFuc2FjdGlvbjsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGdldFVzZXJPYmplY3QoT2JqZWN0IGtleSkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gKF91c2VyT2JqZWN0cyA9PSBudWxsKSA/IG51bGwg\nOiBfdXNlck9iamVjdHMuZ2V0KGtleSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgcHV0VXNlck9iamVjdChPYmplY3Qga2V5LCBP\nYmplY3QgdmFsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiAoX3VzZXJPYmplY3RzID09IG51bGwpID8g\nbnVsbCA6IF91c2VyT2JqZWN0cy5yZW1vdmUoa2V5KTsKCiAgICAgICAgICAg\nIGlmIChfdXNlck9iamVjdHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF91\nc2VyT2JqZWN0cyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIHJldHVy\nbiBfdXNlck9iamVjdHMucHV0KGtleSwgdmFsKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLy8vLy8vLy8vLwogICAgLy8gRXZlbnRzCiAgICAvLy8vLy8v\nLy8vCgogICAgcHVibGljIHZvaWQgYWRkTGlmZWN5Y2xlTGlzdGVuZXIoT2Jq\nZWN0IGxpc3RlbmVyLCBDbGFzc1tdIGNsYXNzZXMpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nX2xpZmVFdmVudE1hbmFnZXIuYWRkTGlzdGVuZXIobGlzdGVuZXIsIGNsYXNz\nZXMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZW1v\ndmVMaWZlY3ljbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgX2xpZmVFdmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIobGlzdGVu\nZXIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50IGdldExp\nZmVjeWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKCkgewogICAgICAgIHJldHVy\nbiBfbGlmZUNhbGxiYWNrTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRMaWZlY3ljbGVMaXN0ZW5lckNhbGxiYWNrTW9kZShpbnQgbW9kZSkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBfbGlmZUNhbGxiYWNrTW9kZSA9IG1vZGU7CiAgICAgICAg\nICAgIF9saWZlRXZlbnRNYW5hZ2VyLnNldEZhaWxGYXN0KChtb2RlICYgQ0FM\nTEJBQ0tfRkFJTF9GQVNUKSAhPSAwKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBHaXZlIHN0YXRlIG1hbmFnZXJzIGFjY2VzcyB0byB0\naGUgbGlmZWN5Y2xlIGV2ZW50IG1hbmFnZXIuCiAgICAgKi8KICAgIHB1Ymxp\nYyBMaWZlY3ljbGVFdmVudE1hbmFnZXIgZ2V0TGlmZWN5Y2xlRXZlbnRNYW5h\nZ2VyKCkgewogICAgICAgIHJldHVybiBfbGlmZUV2ZW50TWFuYWdlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIEZpcmUgZ2l2ZW4gbGlmZWN5Y2xlIGV2ZW50\nLCBoYW5kbGluZyBhbnkgZXhjZXB0aW9ucyBhcHByb3ByaWF0ZWx5LgogICAg\nICoKICAgICAqIEByZXR1cm4gd2hldGhlciBldmVudHMgYXJlIGJlaW5nIHBy\nb2Nlc3NlZCBhdCB0aGlzIHRpbWUKICAgICAqLwogICAgYm9vbGVhbiBmaXJl\nTGlmZWN5Y2xlRXZlbnQoT2JqZWN0IHNyYywgT2JqZWN0IHJlbGF0ZWQsIENs\nYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBpbnQgZXZlbnRUeXBlKSB7CiAg\nICAgICAgaWYgKF9saWZlRXZlbnRNYW5hZ2VyID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBoYW5kbGVDYWxsYmFja0V4Y2Vw\ndGlvbnMoX2xpZmVFdmVudE1hbmFnZXIuZmlyZUV2ZW50KHNyYywgcmVsYXRl\nZCwgCiAgICAgICAgICAgIG1ldGEsIGV2ZW50VHlwZSksIF9saWZlQ2FsbGJh\nY2tNb2RlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRha2UgYWN0aW9ucyBvbiBjYWxsYmFjayBleGNlcHRpb25zIGRl\ncGVuZGluZyBvbiBjYWxsYmFjayBtb2RlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgaGFuZGxlQ2FsbGJhY2tFeGNlcHRpb25zKEV4Y2VwdGlvbltdIGV4\nY2VwcywgaW50IG1vZGUpIHsKICAgICAgICBpZiAoZXhjZXBzLmxlbmd0aCA9\nPSAwIHx8IChtb2RlICYgQ0FMTEJBQ0tfSUdOT1JFKSAhPSAwKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIE9wZW5KUEFFeGNlcHRpb24gY2U7CiAg\nICAgICAgaWYgKGV4Y2Vwcy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgY2Ug\nPSBuZXcgQ2FsbGJhY2tFeGNlcHRpb24oZXhjZXBzWzBdKTsKICAgICAgICBl\nbHNlIAogICAgICAgICAgICBjZSA9IG5ldyBDYWxsYmFja0V4Y2VwdGlvbihf\nbG9jLmdldCgiY2FsbGJhY2stZXJyIikpLgogICAgICAgICAgICAgICAgc2V0\nTmVzdGVkVGhyb3dhYmxlcyhleGNlcHMpOwogICAgICAgIGlmICgobW9kZSAm\nIENBTExCQUNLX1JPTExCQUNLKSAhPSAwICYmIChfZmxhZ3MgJiBGTEFHX0FD\nVElWRSkgIT0gMCkgewogICAgICAgICAgICBjZS5zZXRGYXRhbCh0cnVlKTsK\nICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwoY2UpOwogICAg\nICAgIH0KICAgICAgICBpZiAoKG1vZGUgJiBDQUxMQkFDS19MT0cpICE9IDAg\nJiYgX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cud2Fy\nbihjZSk7CiAgICAgICAgaWYgKChtb2RlICYgQ0FMTEJBQ0tfUkVUSFJPVykg\nIT0gMCkKICAgICAgICAgICAgdGhyb3cgY2U7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgYWRkVHJhbnNhY3Rpb25MaXN0ZW5lcihPYmplY3QgdGwpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyLmFkZExpc3RlbmVyKHRsKTsK\nICAgICAgICAgICAgaWYgKHRsIGluc3RhbmNlb2YgUmVtb3RlQ29tbWl0RXZl\nbnRNYW5hZ2VyKQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVN\nT1RFX0xJU1RFTkVSOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCByZW1vdmVUcmFuc2FjdGlvbkxpc3RlbmVyKE9iamVjdCB0bCkgewog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLnJlbW92ZUxpc3Rl\nbmVyKHRsKQogICAgICAgICAgICAgICAgJiYgKHRsIGluc3RhbmNlb2YgUmVt\nb3RlQ29tbWl0RXZlbnRNYW5hZ2VyKSkKICAgICAgICAgICAgICAgIF9mbGFn\ncyAmPSB+RkxBR19SRU1PVEVfTElTVEVORVI7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBpbnQgZ2V0VHJhbnNhY3Rpb25MaXN0ZW5lckNhbGxi\nYWNrTW9kZSgpIHsKICAgICAgICByZXR1cm4gX3RyYW5zQ2FsbGJhY2tNb2Rl\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFRyYW5zYWN0aW9uTGlzdGVu\nZXJDYWxsYmFja01vZGUoaW50IG1vZGUpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3RyYW5z\nQ2FsbGJhY2tNb2RlID0gbW9kZTsKICAgICAgICAgICAgX3RyYW5zRXZlbnRN\nYW5hZ2VyLnNldEZhaWxGYXN0KChtb2RlICYgQ0FMTEJBQ0tfRkFJTF9GQVNU\nKSAhPSAwKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBG\naXJlIGdpdmVuIHRyYW5zYWN0aW9uIGV2ZW50LCBoYW5kbGluZyBhbnkgZXhj\nZXB0aW9ucyBhcHByb3ByaWF0ZWx5LgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgZmlyZVRyYW5zYWN0aW9uRXZlbnQoVHJhbnNhY3Rpb25FdmVudCB0cmFu\ncykgewogICAgICAgIGlmIChfdHJhbnNFdmVudE1hbmFnZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgaGFuZGxlQ2FsbGJhY2tFeGNlcHRpb25zKF90cmFuc0V2\nZW50TWFuYWdlci5maXJlRXZlbnQodHJhbnMpLAogICAgICAgICAgICAgICAg\nX3RyYW5zQ2FsbGJhY2tNb2RlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLwog\nICAgLy8gTG9va3VwcwogICAgLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgT2Jq\nZWN0IGZpbmQoT2JqZWN0IG9pZCwgYm9vbGVhbiB2YWxpZGF0ZSwgRmluZENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaW50IGZsYWdzID0gT0lEX0NPUFkg\nfCBPSURfQUxMT1dfTkVXIHwgT0lEX05PREVMRVRFRDsKICAgICAgICBpZiAo\nIXZhbGlkYXRlKQogICAgICAgICAgICBmbGFncyB8PSBPSURfTk9WQUxJREFU\nRTsKICAgICAgICByZXR1cm4gZmluZChvaWQsIF9mYywgbnVsbCwgbnVsbCwg\nZmxhZ3MsIGNhbGwpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmluZChP\nYmplY3Qgb2lkLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEJpdFNldCBl\neGNsdWRlLAogICAgICAgIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzKSB7CiAg\nICAgICAgcmV0dXJuIGZpbmQob2lkLCBmZXRjaCwgZXhjbHVkZSwgZWRhdGEs\nIGZsYWdzLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFs\nIGZpbmRlci4KICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCBmaW5kKE9i\namVjdCBvaWQsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgQml0U2V0IGV4\nY2x1ZGUsCiAgICAgICAgT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3MsIEZpbmRD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChjYWxsID09IG51bGwpCiAg\nICAgICAgICAgIGNhbGwgPSB0aGlzOwogICAgICAgIG9pZCA9IGNhbGwucHJv\nY2Vzc0FyZ3VtZW50KG9pZCk7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKSB7\nCiAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgPT0g\nMCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbihfbG9jLmdldCgibnVsbC1vaWQiKSk7CiAgICAgICAgICAgIHJl\ndHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZldGNo\nID0gX2ZjOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVh\nZCgpOwoKICAgICAgICAgICAgLy8gY2FjaGVkIGluc3RhbmNlPwogICAgICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1w\nbEJ5SWQob2lkLAogICAgICAgICAgICAgICAgKGZsYWdzICYgT0lEX0FMTE9X\nX05FVykgIT0gMCB8fCAoX2ZsYWdzICYgRkxBR19GTFVTSEVEKSAhPSAwKTsK\nICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGlmICghcmVxdWlyZXNMb2FkKHNtLCB0cnVlLCBmZXRjaCwgZWRhdGEsIGZs\nYWdzKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNz\nUmV0dXJuKG9pZCwgc20pOwoKICAgICAgICAgICAgICAgIGlmICghc20uaXNM\nb2FkaW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUg\nYWxsIHRoZSBjb25maWd1cmVkIGZpZWxkcyBhcmUgbG9hZGVkOyBkbyB0aGlz\nCiAgICAgICAgICAgICAgICAgICAgLy8gYWZ0ZXIgbWFraW5nIGluc3RhbmNl\nIHRyYW5zYWN0aW9uYWwgZm9yIGxvY2tpbmcKICAgICAgICAgICAgICAgICAg\nICBpZiAoIXNtLmlzVHJhbnNhY3Rpb25hbCgpICYmIHVzZVRyYW5zYWN0aW9u\nYWxTdGF0ZShmZXRjaCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnRy\nYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgICAgICBib29sZWFuIGxv\nYWRlZDsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICBsb2FkZWQgPSBzbS5sb2FkKGZldGNoLCBTdGF0ZU1hbmFn\nZXJJbXBsLkxPQURfRkdTLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGV4Y2x1ZGUsIGVkYXRhLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAg\nfSBjYXRjaCAoT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gb25mZSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PREVMRVRF\nRCkgIT0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgKGZsYWdz\nICYgT0lEX05PVkFMSURBVEUpICE9IDApCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBvbmZlOwogICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBpZiBubyBk\nYXRhIG5lZWRlZCB0byBiZSBsb2FkZWQgYW5kIHRoZSB1c2VyIHdhbnRzIHRv\nCiAgICAgICAgICAgICAgICAgICAgLy8gdmFsaWRhdGUsIGp1c3QgbWFrZSBz\ndXJlIHRoZSBvYmplY3QgZXhpc3RzCiAgICAgICAgICAgICAgICAgICAgaWYg\nKCFsb2FkZWQgJiYgKGZsYWdzICYgT0lEX05PVkFMSURBVEUpID09IDAKICAg\nICAgICAgICAgICAgICAgICAgICAgJiYgX2NvbXBhdC5nZXRWYWxpZGF0ZVRy\ndWVDaGVja3NTdG9yZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICYmICFz\nbS5pc1RyYW5zYWN0aW9uYWwoKQogICAgICAgICAgICAgICAgICAgICAgICAm\nJiAhX3N0b3JlLmV4aXN0cyhzbSwgZWRhdGEpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9ERUxFVEVEKSA9PSAwKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vz\nc1JldHVybihvaWQsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oX2xvYy5nZXQKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICgiZGVsLWluc3RhbmNlIiwgc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCksIG9pZCkpLgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFnZWRJbnN0\nYW5jZSgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgLy8gc2luY2UgdGhlIG9iamVjdCB3YXMg\nY2FjaGVkLCB3ZSBtYXkgbmVlZCB0byB1cGdyYWRlIGxvY2sKICAgICAgICAg\nICAgICAgIC8vIGlmIGN1cnJlbnQgbGV2ZWwgaXMgaGlnaGVyIHRoYW4gbGV2\nZWwgb2YgaW5pdGlhbCBsb2FkCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAg\naW50IGxldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpOwogICAgICAg\nICAgICAgICAgICAgIF9sbS5sb2NrKHNtLCBsZXZlbCwgZmV0Y2guZ2V0TG9j\na1RpbWVvdXQoKSwgZWRhdGEpOwogICAgICAgICAgICAgICAgICAgIHNtLnJl\nYWRMb2NrZWQobGV2ZWwsIGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCkpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwu\ncHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gaWYgdGhlcmUncyBubyBjYWNoZWQgc20gZm9yIGEgbmV3L3Ry\nYW5zaWVudCBpZCB0eXBlLCB3ZQogICAgICAgICAgICAvLyBpdCBkZWZpbml0\nZWx5IGRvZXNuJ3QgZXhpc3QKICAgICAgICAgICAgaWYgKG9pZCBpbnN0YW5j\nZW9mIFN0YXRlTWFuYWdlcklkKQogICAgICAgICAgICAgICAgcmV0dXJuIGNh\nbGwucHJvY2Vzc1JldHVybihvaWQsIG51bGwpOwoKICAgICAgICAgICAgLy8g\naW5pdGlhbGl6ZSBhIG5ldyBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZGF0YXN0\nb3JlIGluc3RhbmNlCiAgICAgICAgICAgIHNtID0gbmV3U3RhdGVNYW5hZ2Vy\nSW1wbChvaWQsIChmbGFncyAmIE9JRF9DT1BZKSAhPSAwKTsKICAgICAgICAg\nICAgYm9vbGVhbiBsb2FkID0gcmVxdWlyZXNMb2FkKHNtLCBmYWxzZSwgZmV0\nY2gsIGVkYXRhLCBmbGFncyk7CiAgICAgICAgICAgIHNtID0gaW5pdGlhbGl6\nZShzbSwgbG9hZCwgZmV0Y2gsIGVkYXRhKTsKICAgICAgICAgICAgaWYgKHNt\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURf\nTk9WQUxJREFURSkgIT0gMCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24ob2lkKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGFsbCBjb25m\naWd1cmVkIGZpZWxkcyB3ZXJlIGxvYWRlZAogICAgICAgICAgICBpZiAobG9h\nZCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBzbS5sb2FkKGZldGNoLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBl\neGNsdWRlLAogICAgICAgICAgICAgICAgICAgICAgICBlZGF0YSwgZmFsc2Up\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoT2JqZWN0Tm90Rm91bmRFeGNl\ncHRpb24gb25mZSkgewogICAgICAgICAgICAgICAgICAgIGlmICgoZmxhZ3Mg\nJiBPSURfTk9ERUxFVEVEKSAhPSAwCiAgICAgICAgICAgICAgICAgICAgICAg\nIHx8IChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBvbmZlOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\nY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOwogICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7\nCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBhIG5l\nd2x5LWNvbnN0cnVjdGVkIHN0YXRlIG1hbmFnZXIuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIGluaXRpYWxpemUoU3RhdGVNYW5h\nZ2VySW1wbCBzbSwgYm9vbGVhbiBsb2FkLAogICAgICAgIEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGVkYXRhKSB7CiAgICAgICAgaWYgKCFs\nb2FkKSB7CiAgICAgICAgICAgIHNtLmluaXRpYWxpemUoc20uZ2V0TWV0YURh\ndGEoKS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICBQQ1N0\nYXRlLkhPTExPVyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgUENT\ndGF0ZSBzdGF0ZSA9ICh1c2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpKQog\nICAgICAgICAgICAgICAgPyBQQ1N0YXRlLlBDTEVBTiA6IFBDU3RhdGUuUE5P\nTlRSQU5TOwogICAgICAgICAgICBzbS5zZXRMb2FkaW5nKHRydWUpOwogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKCFfc3RvcmUuaW5p\ndGlhbGl6ZShzbSwgc3RhdGUsIGZldGNoLCBlZGF0YSkpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICBzbS5zZXRMb2FkaW5nKGZhbHNlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc207CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVjdGlvbiBvaWRzLCBi\nb29sZWFuIHZhbGlkYXRlLAogICAgICAgIEZpbmRDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIGludCBmbGFncyA9IE9JRF9DT1BZIHwgT0lEX0FMTE9XX05F\nVyB8IE9JRF9OT0RFTEVURUQ7CiAgICAgICAgaWYgKCF2YWxpZGF0ZSkKICAg\nICAgICAgICAgZmxhZ3MgfD0gT0lEX05PVkFMSURBVEU7CiAgICAgICAgcmV0\ndXJuIGZpbmRBbGwob2lkcywgX2ZjLCBudWxsLCBudWxsLCBmbGFncywgY2Fs\nbCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVj\ndGlvbiBvaWRzLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAg\nQml0U2V0IGV4Y2x1ZGUsIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzKSB7CiAg\nICAgICAgcmV0dXJuIGZpbmRBbGwob2lkcywgZmV0Y2gsIGV4Y2x1ZGUsIGVk\nYXRhLCBmbGFncywgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRl\ncm5hbCBmaW5kZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3RbXSBm\naW5kQWxsKENvbGxlY3Rpb24gb2lkcywgRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIEJpdFNldCBleGNsdWRlLCBPYmplY3QgZWRhdGEsIGlu\ndCBmbGFncywgRmluZENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgZmluZEFs\nbERlcHRoICsrOwoKICAgICAgICAvLyB0aHJvdyBhbnkgZXhjZXB0aW9ucyBm\nb3IgbnVsbCBvaWRzIHVwIGltbWVkaWF0ZWx5CiAgICAgICAgaWYgKG9pZHMg\nPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhj\nZXB0aW9uKCJvaWRzID09IG51bGwiKTsKICAgICAgICBpZiAoKGZsYWdzICYg\nT0lEX05PVkFMSURBVEUpICE9IDAgJiYgb2lkcy5jb250YWlucyhudWxsKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nIm51bGwtb2lkcyIpKTsKCiAgICAgICAgLy8gd2UgaGF2ZSB0byB1c2UgYSBt\nYXAgb2Ygb2lkLT5zbSByYXRoZXIgdGhhbiBhIHNpbXBsZQogICAgICAgIC8v\nIGFycmF5LCBzbyB0aGF0IHdlIG1ha2Ugc3VyZSBub3QgdG8gY3JlYXRlIG11\nbHRpcGxlIHNtcyBmb3IgZXF1aXZhbGVudAogICAgICAgIC8vIG9pZHMgaWYg\ndGhlIHVzZXIgaGFzIGR1cGxpY2F0ZXMgaW4gdGhlIGdpdmVuIGFycmF5CiAg\nICAgICAgaWYgKF9sb2FkaW5nID09IG51bGwpCiAgICAgICAgICAgIF9sb2Fk\naW5nID0gbmV3IEhhc2hNYXAoKGludCkgKG9pZHMuc2l6ZSgpICogMS4zMyAr\nIDEpKTsKCiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAg\nY2FsbCA9IHRoaXM7CiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAg\nICAgICAgIGZldGNoID0gX2ZjOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250cmFu\nc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgLy8gY29sbGVjdGlvbiBv\nZiBzdGF0ZSBtYW5hZ2VycyB0byBwYXNzIHRvIHN0b3JlIG1hbmFnZXIKICAg\nICAgICAgICAgTGlzdCBsb2FkID0gbnVsbDsKICAgICAgICAgICAgU3RhdGVN\nYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgYm9vbGVhbiBpbml0aWFsaXpl\nZDsKICAgICAgICAgICAgYm9vbGVhbiB0cmFuc1N0YXRlID0gdXNlVHJhbnNh\nY3Rpb25hbFN0YXRlKGZldGNoKTsKICAgICAgICAgICAgT2JqZWN0IG9iaiwg\nb2lkOwogICAgICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBvaWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7IGlkeCsrKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB3ZSd2ZSBhbHJl\nYWR5IHNlZW4gdGhpcyBvaWQsIHNraXAgcmVwZWF0cwogICAgICAgICAgICAg\nICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIG9pZCA9IGNh\nbGwucHJvY2Vzc0FyZ3VtZW50KG9iaik7CiAgICAgICAgICAgICAgICBpZiAo\nb2lkID09IG51bGwgfHwgX2xvYWRpbmcuY29udGFpbnNLZXkob2JqKSkKICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAv\nLyBpZiB3ZSBkb24ndCBoYXZlIGEgY2FjaGVkIGluc3RhbmNlIG9yIGl0IGlz\nIG5vdCB0cmFuc2FjdGlvbmFsCiAgICAgICAgICAgICAgICAvLyBhbmQgaXMg\naG9sbG93IG9yIHdlIG5lZWQgdG8gdmFsaWRhdGUsIGxvYWQgaXQKICAgICAg\nICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQob2lkLCAo\nZmxhZ3MgJiBPSURfQUxMT1dfTkVXKSAhPSAwCiAgICAgICAgICAgICAgICAg\nICAgfHwgKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0gMCk7CiAgICAgICAg\nICAgICAgICBpbml0aWFsaXplZCA9IHNtICE9IG51bGw7CiAgICAgICAgICAg\nICAgICBpZiAoIWluaXRpYWxpemVkKQogICAgICAgICAgICAgICAgICAgIHNt\nID0gbmV3U3RhdGVNYW5hZ2VySW1wbChvaWQsIChmbGFncyAmIE9JRF9DT1BZ\nKSAhPSAwKTsKCiAgICAgICAgICAgICAgICBfbG9hZGluZy5wdXQob2JqLCBz\nbSk7CiAgICAgICAgICAgICAgICBpZiAocmVxdWlyZXNMb2FkKHNtLCBpbml0\naWFsaXplZCwgZmV0Y2gsIGVkYXRhLCBmbGFncykpIHsKICAgICAgICAgICAg\nICAgICAgICB0cmFuc1N0YXRlID0gdHJhbnNTdGF0ZSB8fCB1c2VUcmFuc2Fj\ndGlvbmFsU3RhdGUoZmV0Y2gpOwogICAgICAgICAgICAgICAgICAgIGlmIChp\nbml0aWFsaXplZCAmJiAhc20uaXNUcmFuc2FjdGlvbmFsKCkgJiYgdHJhbnNT\ndGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgc20udHJhbnNhY3Rpb25h\nbCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChsb2FkID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGxvYWQgPSBuZXcgQXJyYXlMaXN0KG9p\nZHMuc2l6ZSgpIC0gaWR4KTsKICAgICAgICAgICAgICAgICAgICBsb2FkLmFk\nZChzbSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFpbml0aWFsaXpl\nZCkKICAgICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAg\nICAgICAgICBQQ1N0YXRlLkhPTExPVyk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHBhc3MgYWxsIHN0YXRlIG1hbmFnZXJzIGluIG5lZWQgb2Yg\nbG9hZGluZyBvciB2YWxpZGF0aW9uIHRvIHRoZQogICAgICAgICAgICAvLyBz\ndG9yZSBtYW5hZ2VyCiAgICAgICAgICAgIGlmIChsb2FkICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIFBDU3RhdGUgc3RhdGUgPSAodHJhbnNTdGF0ZSkg\nPyBQQ1N0YXRlLlBDTEVBTgogICAgICAgICAgICAgICAgICAgIDogUENTdGF0\nZS5QTk9OVFJBTlM7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIGZhaWxl\nZCA9IF9zdG9yZS5sb2FkQWxsKGxvYWQsIHN0YXRlLAogICAgICAgICAgICAg\nICAgICAgIFN0b3JlTWFuYWdlci5GT1JDRV9MT0FEX05PTkUsIGZldGNoLCBl\nZGF0YSk7CgogICAgICAgICAgICAgICAgLy8gc2V0IGZhaWxlZCBpbnN0YW5j\nZXMgdG8gbnVsbAogICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxs\nICYmICFmYWlsZWQuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlv\nbihmYWlsZWQpOwogICAgICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gZmFpbGVkLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAg\nICAgICAgICAgICAgICAgICAgICBfbG9hZGluZy5wdXQoaXRyLm5leHQoKSwg\nbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIGNyZWF0ZSByZXN1bHRzIGFycmF5OyBtYWtlIHN1cmUgYWxs\nIGNvbmZpZ3VyZWQgZmllbGRzIGFyZQogICAgICAgICAgICAvLyBsb2FkZWQg\naW4gZWFjaCBpbnN0YW5jZQogICAgICAgICAgICBPYmplY3RbXSByZXN1bHRz\nID0gbmV3IE9iamVjdFtvaWRzLnNpemUoKV07CiAgICAgICAgICAgIGJvb2xl\nYW4gYWN0aXZlID0gKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwOwogICAg\nICAgICAgICBpbnQgbGV2ZWwgPSBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCk7\nCiAgICAgICAgICAgIGlkeCA9IDA7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gb2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOyBpZHgr\nKykgewogICAgICAgICAgICAgICAgb2lkID0gaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIF9sb2FkaW5nLmdl\ndChvaWQpOwogICAgICAgICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgcmVx\ndWlyZXNMb2FkKHNtLCB0cnVlLCBmZXRjaCwgZWRhdGEsIGZsYWdzKSkgewog\nICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHNtLmxvYWQoZmV0Y2gsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1Ms\nCiAgICAgICAgICAgICAgICAgICAgICAgIAlleGNsdWRlLCBlZGF0YSwgZmFs\nc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBfbG0ubG9jayhzbSwgbGV2ZWws\nIGZldGNoLmdldExvY2tUaW1lb3V0KCksIGVkYXRhKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLnJlYWRMb2NrZWQobGV2ZWwsIGZldGNoLmdl\ndFdyaXRlTG9ja0xldmVsKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNh\ndGNoIChPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbiBvbmZlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9ERUxFVEVEKSAh\nPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCAoZmxhZ3MgJiBP\nSURfTk9WQUxJREFURSkgIT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHRocm93IG9uZmU7CiAgICAgICAgICAgICAgICAgICAgICAgIHNtID0g\nbnVsbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICByZXN1bHRzW2lkeF0gPSBjYWxsLnByb2Nlc3NS\nZXR1cm4ob2lkLCBzbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIHJlc3VsdHM7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBmaW5kQWxsRGVwdGgtLTsKICAgICAgICAgICAgaWYgKGZp\nbmRBbGxEZXB0aCA9PSAwKQogICAgICAgICAgICAgICAgX2xvYWRpbmcgPSBu\ndWxsOwogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4g\naW5zdGFuY2UgbmVlZHMgbG9hZGluZyBiZWZvcmUgYmVpbmcgcmV0dXJuZWQK\nICAgICAqIHRvIHRoZSB1c2VyLgogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gcmVxdWlyZXNMb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIGJvb2xl\nYW4gaW5pdGlhbGl6ZWQsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLCBPYmplY3QgZWRhdGEsIGludCBmbGFncykgewogICAgICAgIGlmICgh\nZmV0Y2gucmVxdWlyZXNMb2FkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUpID09IDAp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChlZGF0YSAh\nPSBudWxsKSAvLyB0YWtlIGFkdmFudGFnZSBvZiBleGlzdGluZyByZXN1bHQK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGluaXRpYWxp\nemVkICYmIHNtLmdldFBDU3RhdGUoKSAhPSBQQ1N0YXRlLkhPTExPVykKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghaW5pdGlhbGl6\nZWQgJiYgc20uZ2V0TWV0YURhdGEoKS5nZXRQQ1N1YmNsYXNzZXMoKS5sZW5n\ndGggPiAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1\ncm4gIV9jb21wYXQuZ2V0VmFsaWRhdGVGYWxzZVJldHVybnNIb2xsb3coKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRvIHVzZSBh\nIHRyYW5zYWN0aW9uYWwgc3RhdGUuCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiB1c2VUcmFuc2FjdGlvbmFsU3RhdGUoRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0FDVElW\nRSkgIT0gMCAmJiAoIV9vcHRpbWlzdGljCiAgICAgICAgICAgIHx8IF9hdXRv\nQ2xlYXIgPT0gQ0xFQVJfQUxMCiAgICAgICAgICAgIHx8IGZldGNoLmdldFJl\nYWRMb2NrTGV2ZWwoKSAhPSBMT0NLX05PTkUpOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZmluZENhY2hlZChPYmplY3Qgb2lkLCBGaW5kQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAg\nICBjYWxsID0gdGhpczsKICAgICAgICBvaWQgPSBjYWxsLnByb2Nlc3NBcmd1\nbWVudChvaWQpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51bGwpOwoKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2Vy\nSW1wbEJ5SWQob2lkLCB0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIGNhbGwu\ncHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIENsYXNzIGdldE9iamVjdElkVHlwZShDbGFzcyBjbHMpIHsK\nICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2NvbmYu\nZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAg\nICAgIGdldE1ldGFEYXRhKGNscywgX2xvYWRlciwgZmFsc2UpOwogICAgICAg\nICAgICBpZiAobWV0YSA9PSBudWxsCiAgICAgICAgICAgICAgICB8fCBtZXRh\nLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfVU5LTk9X\nTikKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBp\nZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklE\nX0FQUExJQ0FUSU9OKQogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGEuZ2V0\nT2JqZWN0SWRUeXBlKCk7CgogICAgICAgICAgICByZXR1cm4gX3N0b3JlLmdl\ndERhdGFTdG9yZUlkVHlwZShtZXRhKTsKICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IG5ld09iamVjdElkKENsYXNz\nIGNscywgT2JqZWN0IHZhbCkgewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzc01l\ndGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoY2xzLCBfbG9h\nZGVyLCB0cnVlKTsKICAgICAgICAgICAgc3dpdGNoIChtZXRhLmdldElkZW50\naXR5VHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2UgQ2xhc3NNZXRhRGF0YS5J\nRF9EQVRBU1RPUkU6CiAgICAgICAgICAgICAgICAvLyBkZWxlZ2F0ZSB0byBz\ndG9yZSBtYW5hZ2VyIGZvciBkYXRhc3RvcmUgaWRzCiAgICAgICAgICAgICAg\nICBpZiAodmFsIGluc3RhbmNlb2YgU3RyaW5nCiAgICAgICAgICAgICAgICAg\nICAgJiYgKChTdHJpbmcpIHZhbCkuc3RhcnRzV2l0aChTdGF0ZU1hbmFnZXJJ\nZC5TVFJJTkdfUFJFRklYKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IFN0YXRlTWFuYWdlcklkKChTdHJpbmcpIHZhbCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gX3N0b3JlLm5ld0RhdGFTdG9yZUlkKHZhbCwgbWV0YSk7\nCiAgICAgICAgICAgIGNhc2UgQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElP\nTjoKICAgICAgICAgICAgICAgIGlmIChJbXBsSGVscGVyLmlzQXNzaWduYWJs\nZShtZXRhLmdldE9iamVjdElkVHlwZSgpLCAKICAgICAgICAgICAgICAgICAg\nICB2YWwuZ2V0Q2xhc3MoKSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\nIW1ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSAKICAgICAgICAgICAgICAgICAg\nICAgICAgJiYgbWV0YS5pc09iamVjdElkVHlwZVNoYXJlZCgpKQogICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdElkKGNscywgdmFs\nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHN0cmluZ2lmaWVkIGFwcCBp\nZD8KICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcg\nCiAgICAgICAgICAgICAgICAgICAgJiYgIV9jb25mLmdldENvbXBhdGliaWxp\ndHlJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgICAgICAgICBnZXRTdHJp\nY3RJZGVudGl0eVZhbHVlcygpCiAgICAgICAgICAgICAgICAgICAgJiYgIU1v\nZGlmaWVyLmlzQWJzdHJhY3QoY2xzLmdldE1vZGlmaWVycygpKSkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gUENSZWdpc3RyeS5uZXdPYmplY3RJZChj\nbHMsIChTdHJpbmcpIHZhbCk7CgogICAgICAgICAgICAgICAgT2JqZWN0W10g\nYXJyID0gKHZhbCBpbnN0YW5jZW9mIE9iamVjdFtdKSA/IChPYmplY3RbXSkg\ndmFsCiAgICAgICAgICAgICAgICAgICAgOiBuZXcgT2JqZWN0W117IHZhbCB9\nOwogICAgICAgICAgICAgICAgcmV0dXJuIEFwcGxpY2F0aW9uSWRzLmZyb21Q\nS1ZhbHVlcyhhcnIsIG1ldGEpOwogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nIm1ldGEtdW5rbm93bmlkIiwgY2xzKSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKENsYXNzQ2FzdEV4Y2VwdGlv\nbiBjY2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1pZC12YWx1ZSIsIHZhbCwKICAgICAgICAgICAgICAg\nIHZhbC5nZXRDbGFzcygpLmdldE5hbWUoKSwgY2xzKSkuc2V0Q2F1c2UoY2Nl\nKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\nc3RhdGUgbWFuYWdlciBmb3IgdGhlIGdpdmVuIG9pZC4KICAgICAqLwogICAg\ncHJpdmF0ZSBTdGF0ZU1hbmFnZXJJbXBsIG5ld1N0YXRlTWFuYWdlckltcGwo\nT2JqZWN0IG9pZCwgYm9vbGVhbiBjb3B5KSB7CiAgICAgICAgLy8gc2VlIGlm\nIHdlJ3JlIGluIHRoZSBwcm9jZXNzIG9mIGxvYWRpbmcgdGhpcyBvaWQgaW4g\nYSBsb2FkQWxsIGNhbGwKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwog\nICAgICAgIGlmIChfbG9hZGluZyAhPSBudWxsKSB7CiAgICAgICAgICAgIHNt\nID0gKFN0YXRlTWFuYWdlckltcGwpIF9sb2FkaW5nLmdldChvaWQpOwogICAg\nICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiBzbS5nZXRQZXJzaXN0ZW5jZUNh\ncGFibGUoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHNtOwog\nICAgICAgIH0KCiAgICAgICAgLy8gZmluZCBtZXRhZGF0YSBmb3IgdGhlIG9p\nZAogICAgICAgIENsYXNzIHBjVHlwZSA9IF9zdG9yZS5nZXRNYW5hZ2VkVHlw\nZShvaWQpOwogICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9j\nb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgICAgIGlmIChwY1R5cGUgIT0gbnVs\nbCkKICAgICAgICAgICAgbWV0YSA9IHJlcG9zLmdldE1ldGFEYXRhKHBjVHlw\nZSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBt\nZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEob2lkLCBfbG9hZGVyLCB0cnVlKTsK\nCiAgICAgICAgLy8gY29weSB0aGUgb2lkIGlmIG5lZWRlZAogICAgICAgIGlm\nIChjb3B5ICYmIF9jb21wYXQuZ2V0Q29weU9iamVjdElkcygpKSB7CiAgICAg\nICAgICAgIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0\nYURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgICAgICBvaWQgPSBB\ncHBsaWNhdGlvbklkcy5jb3B5KG9pZCwgbWV0YSk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0\nYS5JRF9VTktOT1dOKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93bmlkIiwgbWV0YSkpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBvaWQgPSBfc3RvcmUu\nY29weURhdGFTdG9yZUlkKG9pZCwgbWV0YSk7CiAgICAgICAgfQoKICAgICAg\nICBzbSA9IG5ld1N0YXRlTWFuYWdlckltcGwob2lkLCBtZXRhKTsKICAgICAg\nICBzbS5zZXRPYmplY3RJZChvaWQpOwogICAgICAgIHJldHVybiBzbTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIHN0YXRlIG1hbmFnZXIgZm9y\nIHRoZSBnaXZlbiBvaWQgYW5kIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90\nZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbCBuZXdTdGF0ZU1hbmFnZXJJbXBsKE9i\namVjdCBvaWQsCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgbWV0YSwgdGhp\ncyk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBUcmFuc2Fj\ndGlvbgogICAgLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgYmVn\naW4oKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkg\nIT0gMCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oX2xvYy5nZXQoImFjdGl2ZSIpKTsKICAgICAgICAgICAgX2Zh\nY3Rvcnkuc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24odGhpcywgdHJ1ZSk7\nCiAgICAgICAgICAgIGJlZ2luSW50ZXJuYWwoKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBOb3RpZnkgdGhlIHN0b3JlIG1hbmFnZXIg\nb2YgYSB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGJl\nZ2luSW50ZXJuYWwoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYmVn\naW5TdG9yZU1hbmFnZXJUcmFuc2FjdGlvbihfb3B0aW1pc3RpYyk7CiAgICAg\nICAgICAgIF9mbGFncyB8PSBGTEFHX0FDVElWRTsKCiAgICAgICAgICAgIC8v\nIHN0YXJ0IGxvY2tpbmcKICAgICAgICAgICAgaWYgKCFfb3B0aW1pc3RpYykg\newogICAgICAgICAgICAgICAgX2ZjLnNldFJlYWRMb2NrTGV2ZWwoX2NvbmYu\nZ2V0UmVhZExvY2tMZXZlbENvbnN0YW50KCkpOwogICAgICAgICAgICAgICAg\nX2ZjLnNldFdyaXRlTG9ja0xldmVsKF9jb25mLmdldFdyaXRlTG9ja0xldmVs\nQ29uc3RhbnQoKSk7CiAgICAgICAgICAgICAgICBfZmMuc2V0TG9ja1RpbWVv\ndXQoX2NvbmYuZ2V0TG9ja1RpbWVvdXQoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgX2xtLmJlZ2luVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAg\nIGlmIChfdHJhbnNFdmVudE1hbmFnZXIuaGFzQmVnaW5MaXN0ZW5lcnMoKSkK\nICAgICAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFu\nc2FjdGlvbkV2ZW50KHRoaXMsCiAgICAgICAgICAgICAgICAgICAgVHJhbnNh\nY3Rpb25FdmVudC5BRlRFUl9CRUdJTiwgbnVsbCwgbnVsbCwgbnVsbCwgbnVs\nbCkpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgLy8gaWYgd2UgYWxyZWFkeSBzdGFydGVkIHRoZSB0cmFu\nc2FjdGlvbiwgZG9uJ3QgbGV0IGl0IGNvbW1pdAogICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAg\nc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwoa2UpOwogICAgICAgICAgICB0aHJv\ndyBrZS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIC8vIGlmIHdlIGFscmVhZHkg\nc3RhcnRlZCB0aGUgdHJhbnNhY3Rpb24sIGRvbid0IGxldCBpdCBjb21taXQK\nICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkK\nICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKHJlKTsK\nICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHJlKS5zZXRG\nYXRhbCh0cnVlKTsKICAgICAgICB9CgogICAgICAgIGlmIChfcGVuZGluZyAh\nPSBudWxsKSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXQgPSBfcGVuZGluZy5pdGVyYXRv\ncigpOyBpdC5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBzbSA9IChT\ndGF0ZU1hbmFnZXJJbXBsKSBpdC5uZXh0KCk7CiAgICAgICAgICAgICAgICBz\nbS50cmFuc2FjdGlvbmFsKCk7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNE\naXJ0eSgpKQogICAgICAgICAgICAgICAgICAgIHNldERpcnR5KHNtLCB0cnVl\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfcGVuZGluZyA9IG51bGw7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGJlZ2luU3RvcmUo\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKTsK\nICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JFX0FDVElWRSkg\nPT0gMCkKICAgICAgICAgICAgICAgIGJlZ2luU3RvcmVNYW5hZ2VyVHJhbnNh\nY3Rpb24oZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEJlZ2luIGEgc3RvcmUgbWFuYWdlciB0cmFuc2FjdGlv\nbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGJlZ2luU3RvcmVNYW5hZ2Vy\nVHJhbnNhY3Rpb24oYm9vbGVhbiBvcHRpbWlzdGljKSB7CiAgICAgICAgaWYg\nKCFvcHRpbWlzdGljKSB7CiAgICAgICAgICAgIHJldGFpbkNvbm5lY3Rpb24o\nKTsKICAgICAgICAgICAgX3N0b3JlLmJlZ2luKCk7CiAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX1NUT1JFX0FDVElWRTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBpZiAoX2Nvbm5SZXRhaW5Nb2RlID09IENPTk5fUkVUQUlO\nX1RSQU5TKQogICAgICAgICAgICAgICAgcmV0YWluQ29ubmVjdGlvbigpOwog\nICAgICAgICAgICBfc3RvcmUuYmVnaW5PcHRpbWlzdGljKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogRW5kIHRoZSBjdXJyZW50IHN0b3Jl\nIG1hbmFnZXIgdHJhbnNhY3Rpb24uIFRocm93cyBhbgogICAgICogZXhjZXB0\naW9uIHRvIHNpZ25hbCBhIGZvcmNlZCByb2xsYmFjayBhZnRlciBmYWlsZWQg\nY29tbWl0LCBvdGhlcndpc2UKICAgICAqIHJldHVybnMgYW55IGV4Y2VwdGlv\nbiBlbmNvdW50ZXJlZCBkdXJpbmcgdGhlIGVuZCBwcm9jZXNzLgogICAgICov\nCiAgICBwcml2YXRlIFJ1bnRpbWVFeGNlcHRpb24gZW5kU3RvcmVNYW5hZ2Vy\nVHJhbnNhY3Rpb24oYm9vbGVhbiByb2xsYmFjaykgewogICAgICAgIGJvb2xl\nYW4gZm9yY2VkUm9sbGJhY2sgPSBmYWxzZTsKICAgICAgICBib29sZWFuIHJl\nbGVhc2VDb25uID0gZmFsc2U7CiAgICAgICAgUnVudGltZUV4Y2VwdGlvbiBl\ncnIgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpICE9IDApIHsKICAgICAgICAgICAg\nICAgIHJlbGVhc2VDb25uID0gX2Nvbm5SZXRhaW5Nb2RlICE9IENPTk5fUkVU\nQUlOX0FMV0FZUzsKICAgICAgICAgICAgICAgIGlmIChyb2xsYmFjaykKICAg\nICAgICAgICAgICAgICAgICBfc3RvcmUucm9sbGJhY2soKTsKICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBfc3RvcmUuY29tbWl0\nKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZWxl\nYXNlQ29ubiA9IF9jb25uUmV0YWluTW9kZSA9PSBDT05OX1JFVEFJTl9UUkFO\nUzsKICAgICAgICAgICAgICAgIF9zdG9yZS5yb2xsYmFja09wdGltaXN0aWMo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICBpZiAoIXJvbGxiYWNr\nKSB7CiAgICAgICAgICAgICAgICBmb3JjZWRSb2xsYmFjayA9IHRydWU7CiAg\nICAgICAgICAgICAgICB0cnkgeyBfc3RvcmUucm9sbGJhY2soKTsgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZTIpIHt9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgZXJyID0gcmU7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5GTEFHX1NUT1JFX0FDVElWRTsKICAgICAgICB9\nCgogICAgICAgIGlmIChyZWxlYXNlQ29ubikgewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgcmVsZWFzZUNvbm5lY3Rpb24oKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICAgICAgaWYgKGVyciA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIGVyciA9IHJlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBp\nZiAoZm9yY2VkUm9sbGJhY2spCiAgICAgICAgICAgIHRocm93IGVycjsKICAg\nICAgICByZXR1cm4gZXJyOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbW1p\ndCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24o\nKTsKCiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9u\nIHRyYW5zID0KICAgICAgICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0\naW9uTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlm\nICh0cmFucyA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC10cmFucyIpKTsK\nCiAgICAgICAgICAgIC8vIHRoaXMgY29tbWl0IG9uIHRoZSB0cmFuc2FjdGlv\nbiB3aWxsIGNhdXNlIG91cgogICAgICAgICAgICAvLyBiZWZvcmVDb21wbGV0\naW9uIG1ldGhvZCB0byBiZSBpbnZva2VkCiAgICAgICAgICAgIHRyYW5zLmNv\nbW1pdCgpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1l\ncnJvciIpLCBrZSk7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwgZSk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgcm9sbGJhY2soKSB7CiAgICAgICAgYmVnaW5P\ncGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7CgogICAgICAgICAgICBqYXZh\neC50cmFuc2FjdGlvbi5UcmFuc2FjdGlvbiB0cmFucyA9CiAgICAgICAgICAg\nICAgICBfcnVudGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRUcmFu\nc2FjdGlvbigpOwogICAgICAgICAgICBpZiAodHJhbnMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRyYW5zLnJvbGxiYWNrKCk7CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBpZiAoX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFj\nZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIGtlKTsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJv\nciIpLCBlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9u\nKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBz\neW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbigpIHsKICAgICAgICBhc3NlcnRP\ncGVuKCk7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKCFfbWFuYWdl\nZCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoInRyYW5zLW5vdC1tYW5hZ2VkIikpOwogICAgICAg\nICAgICBpZiAoX2ZhY3Rvcnkuc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24o\ndGhpcywgZmFsc2UpKSB7CiAgICAgICAgICAgICAgICBiZWdpbkludGVybmFs\nKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGNvbW1pdEFuZFJlc3VtZSgpIHsKICAgICAgICBlbmRB\nbmRSZXN1bWUodHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJh\nY2tBbmRSZXN1bWUoKSB7CiAgICAgICAgZW5kQW5kUmVzdW1lKGZhbHNlKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZW5kQW5kUmVzdW1lKGJvb2xlYW4g\nY29tbWl0KSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChjb21taXQpCiAgICAgICAgICAg\nICAgICBjb21taXQoKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgcm9sbGJhY2soKTsKICAgICAgICAgICAgYmVnaW4oKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0Um9sbGJhY2tPbmx5\nKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09\nIDApCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAg\nICBqYXZheC50cmFuc2FjdGlvbi5UcmFuc2FjdGlvbiB0cmFucyA9CiAgICAg\nICAgICAgICAgICBfcnVudGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5n\nZXRUcmFuc2FjdGlvbigpOwogICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\ncmV0dXJuIHRyYW5zLmdldFN0YXR1cygpID09IFN0YXR1cy5TVEFUVVNfTUFS\nS0VEX1JPTExCQUNLOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBUaHJvd2FibGUgZ2V0Um9sbGJhY2tDYXVzZSgpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICBqYXZheC50cmFuc2FjdGlv\nbi5UcmFuc2FjdGlvbiB0cmFucyA9CiAgICAgICAgICAgICAgICBfcnVudGlt\nZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRUcmFuc2FjdGlvbigpOwog\nICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAodHJhbnMuZ2V0U3RhdHVz\nKCkgPT0gU3RhdHVzLlNUQVRVU19NQVJLRURfUk9MTEJBQ0spCiAgICAgICAg\nICAgICAgICByZXR1cm4gX3J1bnRpbWUuZ2V0Um9sbGJhY2tDYXVzZSgpOwoK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0Um9sbGJhY2tPbmx5KCkgewogICAgICAg\nIHNldFJvbGxiYWNrT25seShuZXcgVXNlckV4Y2VwdGlvbigpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRSb2xsYmFja09ubHkoVGhyb3dhYmxlIGNh\ndXNlKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24o\nKTsKICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwoY2F1c2Up\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1hcmsgdGhl\nIGN1cnJlbnQgdHJhbnNhY3Rpb24gYXMgcm9sbGJhY2stb25seS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHNldFJvbGxiYWNrT25seUludGVybmFsKFRo\ncm93YWJsZSBjYXVzZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGph\ndmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAgICAg\nICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRy\nYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFucyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlv\nbihfbG9jLmdldCgibnVsbC10cmFucyIpKTsKICAgICAgICAgICAgLy8gZW5z\ndXJlIHRyYW4gaXMgaW4gYSB2YWxpZCBzdGF0ZSB0byBhY2NlcHQgdGhlIHNl\ndFJvbGxiYWNrT25seQogICAgICAgICAgICBpbnQgdHJhblN0YXR1cyA9IHRy\nYW5zLmdldFN0YXR1cygpOwogICAgICAgICAgICBpZiAoKHRyYW5TdGF0dXMg\nIT0gU3RhdHVzLlNUQVRVU19OT19UUkFOU0FDVElPTikKICAgICAgICAgICAg\nICAgICAgICAmJiAodHJhblN0YXR1cyAhPSBTdGF0dXMuU1RBVFVTX1JPTExF\nREJBQ0spCiAgICAgICAgICAgICAgICAgICAgJiYgKHRyYW5TdGF0dXMgIT0g\nU3RhdHVzLlNUQVRVU19DT01NSVRURUQpKQogICAgICAgICAgICAgICAgX3J1\nbnRpbWUuc2V0Um9sbGJhY2tPbmx5KGNhdXNlKTsKICAgICAgICAgICAgZWxz\nZSBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nX2xvZy50cmFjZShfbG9jLmdldCgiaW52YWxpZC10cmFuLXN0YXR1cyIsIG5l\ndyBJbnRlZ2VyKAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuU3RhdHVz\nKSwgInNldFJvbGxiYWNrT25seSIpKTsKICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRTYXZlcG9pbnQoU3RyaW5nIG5hbWUpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwogICAgICAgICAg\nICBpZiAoX3NhdmVwb2ludHMgIT0gbnVsbCAmJiBfc2F2ZXBvaW50cy5jb250\nYWluc0tleShuYW1lKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJzYXZlcG9pbnQtZXhpc3RzIiwgbmFtZSkp\nOwoKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0ZMVVNIRUQpICE9\nIDAKICAgICAgICAgICAgICAgICYmICFfc3BtLnN1cHBvcnRzSW5jcmVtZW50\nYWxGbHVzaCgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9y\ndGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJz\nYXZlcG9pbnQtZmx1c2gtbm90LXN1cHBvcnRlZCIpKTsKCiAgICAgICAgICAg\nIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZSA9IF9zcG0ubmV3U2F2ZXBvaW50KG5h\nbWUsIHRoaXMpOwogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMgPT0gbnVs\nbCB8fCBfc2F2ZXBvaW50cy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAg\nIHNhdmUuc2F2ZShnZXRUcmFuc2FjdGlvbmFsU3RhdGVzKCkpOwogICAgICAg\nICAgICAgICAgX3NhdmVwb2ludHMgPSBuZXcgTGlua2VkTWFwKCk7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoX3NhdmVwb2lu\ndENhY2hlID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgc2F2ZS5zYXZl\nKENvbGxlY3Rpb25zLkVNUFRZX0xJU1QpOwogICAgICAgICAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgc2F2ZS5zYXZlKF9zYXZlcG9pbnRD\nYWNoZSk7CiAgICAgICAgICAgICAgICAgICAgX3NhdmVwb2ludENhY2hlLmNs\nZWFyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgX3NhdmVwb2ludHMucHV0KG5hbWUsIHNhdmUpOwogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbGVhc2VTYXZlcG9pbnQo\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyA9PSBudWxsIHx8IF9z\nYXZlcG9pbnRzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1sYXN0c2F2ZXBvaW50Iikp\nOwogICAgICAgICAgICByZWxlYXNlU2F2ZXBvaW50KChTdHJpbmcpIF9zYXZl\ncG9pbnRzLmdldAogICAgICAgICAgICAgICAgKF9zYXZlcG9pbnRzLnNpemUo\nKSAtIDEpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncmVsZWFzZVNhdmVwb2ludChTdHJpbmcgc2F2ZXBvaW50KSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CgogICAgICAgICAgICBp\nbnQgaW5kZXggPSAoX3NhdmVwb2ludHMgPT0gbnVsbCkgPyAtMQogICAgICAg\nICAgICAgICAgOiBfc2F2ZXBvaW50cy5pbmRleE9mKHNhdmVwb2ludCk7CiAg\nICAgICAgICAgIGlmIChpbmRleCA8IDApCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2F2ZXBvaW50Iiwg\nc2F2ZXBvaW50KSk7CgogICAgICAgICAgICAvLyBjbGVhciBvbGQgaW4gcmV2\nZXJzZQogICAgICAgICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAgICAg\nICAgICAgIHdoaWxlIChfc2F2ZXBvaW50cy5zaXplKCkgPiBpbmRleCArIDEp\nIHsKICAgICAgICAgICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVwb2ludCkg\nX3NhdmVwb2ludHMucmVtb3ZlCiAgICAgICAgICAgICAgICAgICAgKF9zYXZl\ncG9pbnRzLnNpemUoKSAtIDEpOwogICAgICAgICAgICAgICAgc2F2ZS5yZWxl\nYXNlKGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2F2ZSA9\nIChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoaW5kZXgp\nOwogICAgICAgICAgICBzYXZlLnJlbGVhc2UodHJ1ZSk7CiAgICAgICAgICAg\nIGlmIChfc2F2ZXBvaW50Q2FjaGUgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9zYXZlcG9pbnRDYWNoZS5jbGVhcigpOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrVG9TYXZlcG9pbnQoKSB7CiAg\nICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyA9PSBudWxsIHx8IF9zYXZlcG9p\nbnRzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1sYXN0c2F2ZXBvaW50IikpOwogICAg\nICAgICAgICByb2xsYmFja1RvU2F2ZXBvaW50KChTdHJpbmcpIF9zYXZlcG9p\nbnRzLmdldAogICAgICAgICAgICAgICAgKF9zYXZlcG9pbnRzLnNpemUoKSAt\nIDEpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9s\nbGJhY2tUb1NhdmVwb2ludChTdHJpbmcgc2F2ZXBvaW50KSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CgogICAgICAgICAgICBp\nbnQgaW5kZXggPSAoX3NhdmVwb2ludHMgPT0gbnVsbCkgPyAtMQogICAgICAg\nICAgICAgICAgOiBfc2F2ZXBvaW50cy5pbmRleE9mKHNhdmVwb2ludCk7CiAg\nICAgICAgICAgIGlmIChpbmRleCA8IDApCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2F2ZXBvaW50Iiwg\nc2F2ZXBvaW50KSk7CgogICAgICAgICAgICAvLyBjbGVhciBvbGQgaW4gcmV2\nZXJzZQogICAgICAgICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAgICAg\nICAgICAgIHdoaWxlIChfc2F2ZXBvaW50cy5zaXplKCkgPiBpbmRleCArIDEp\nIHsKICAgICAgICAgICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVwb2ludCkg\nX3NhdmVwb2ludHMucmVtb3ZlCiAgICAgICAgICAgICAgICAgICAgKF9zYXZl\ncG9pbnRzLnNpemUoKSAtIDEpOwogICAgICAgICAgICAgICAgc2F2ZS5yZWxl\nYXNlKGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2F2ZSA9\nIChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoaW5kZXgp\nOwogICAgICAgICAgICBDb2xsZWN0aW9uIHNhdmVkID0gc2F2ZS5yb2xsYmFj\nayhfc2F2ZXBvaW50cy52YWx1ZXMoKSk7CiAgICAgICAgICAgIGlmIChfc2F2\nZXBvaW50Q2FjaGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zYXZlcG9p\nbnRDYWNoZS5jbGVhcigpOwogICAgICAgICAgICBpZiAoaGFzVHJhbnNhY3Rp\nb25hbE9iamVjdHMoKSkgewogICAgICAgICAgICAgICAgLy8gYnVpbGQgdXAg\nYSBuZXcgY29sbGVjdGlvbiBvZiBzdGF0ZXMKICAgICAgICAgICAgICAgIFRy\nYW5zYWN0aW9uYWxDYWNoZSBvbGRUcmFuc0NhY2hlID0gX3RyYW5zQ2FjaGU7\nCiAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbmFsQ2FjaGUgbmV3VHJhbnND\nYWNoZSA9IG5ldyBUcmFuc2FjdGlvbmFsQ2FjaGUKICAgICAgICAgICAgICAg\nICAgICAoX29yZGVyRGlydHkpOwogICAgICAgICAgICAgICAgX3RyYW5zQ2Fj\naGUgPSBudWxsOwoKICAgICAgICAgICAgICAgIC8vIGN1cnJlbnRseSB0aGVy\nZSBpcyB0aGUgYXNzdW1wdGlvbiB0aGF0IGluY3JlbWVudGFsCiAgICAgICAg\nICAgICAgICAvLyBmbHVzaCBpcyBlaXRoZXIgYSkgbm90IGFsbG93ZWQsIG9y\nIGIpIHJlcXVpcmVkCiAgICAgICAgICAgICAgICAvLyBwcmUtc2F2ZXBvaW50\nLiAgdGhpcyBzb2x2ZXMgYSBudW1iZXIgb2YgaXNzdWVzIGluY2x1ZGluZwog\nICAgICAgICAgICAgICAgLy8gc3RvcmluZyBmbHVzaGVkIHN0YXRlcyBhcyB3\nZWxsIGFzIE9JRCBoYW5kbGluZy4KICAgICAgICAgICAgICAgIC8vIGlmIGZ1\ndHVyZSBwbHVnaW5zIGRvIG5vdCBmb2xsb3cgdGhpcywgd2UgbmVlZCB0byBj\nYWNoZQogICAgICAgICAgICAgICAgLy8gbW9yZSBpbmZvIHBlciBzdGF0ZQog\nICAgICAgICAgICAgICAgU2F2ZXBvaW50RmllbGRNYW5hZ2VyIGZtOwogICAg\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc2F2ZWQuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBmbSA9IChTYXZl\ncG9pbnRGaWVsZE1hbmFnZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAg\nICAgICAgc20gPSBmbS5nZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAg\nICAgICAgICBzbS5yb2xsYmFja1RvU2F2ZXBvaW50KGZtKTsKICAgICAgICAg\nICAgICAgICAgICBvbGRUcmFuc0NhY2hlLnJlbW92ZShzbSk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHNtLmlzRGlydHkoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgbmV3VHJhbnNDYWNoZS5hZGREaXJ0eShzbSk7CiAgICAgICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBuZXdU\ncmFuc0NhY2hlLmFkZENsZWFuKHNtKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2xkVHJhbnNDYWNo\nZS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICAgICAgc20ucm9sbGJhY2soKTsKICAgICAgICAgICAg\nICAgICAgICByZW1vdmVGcm9tVHJhbnNhY3Rpb24oc20pOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgb2xkVHJhbnNDYWNoZS5jbGVhcigp\nOwogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSBuZXdUcmFuc0NhY2hl\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBmbHVzaCgpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyByZXR1\ncm4gc2lsZW50bHkgaWYgbm8gdHJhbnMgaXMgYWN0aXZlLCBvciBpZiB0aGlz\nIGlzIGEgcmVlbnRyYW50CiAgICAgICAgICAgIC8vIGNhbGwsIHdoaWNoIGNh\nbiBoYXBwZW4gaWYgdGhlIHN0b3JlIG1hbmFnZXIgdHJpZXMgdG8gZ2V0IGFu\nCiAgICAgICAgICAgIC8vIGF1dG8taW5jIG9pZCBkdXJpbmcgZmx1c2gKICAg\nICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMAogICAg\nICAgICAgICAgICAgfHwgKF9mbGFncyAmIEZMQUdfU1RPUkVfRkxVU0hJTkcp\nICE9IDApCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAv\nLyBtYWtlIHN1cmUgdGhlIHJ1bnRpbWUgc3VwcG9ydHMgaXQKICAgICAgICAg\nICAgaWYgKCFfY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29udGFpbnMoX2Nv\nbmYuT1BUSU9OX0lOQ19GTFVTSCkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAg\nICAgICAgICAoImluY3JlbWVudGFsLWZsdXNoLW5vdC1zdXBwb3J0ZWQiKSk7\nCiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYmICFfc2F2\nZXBvaW50cy5pc0VtcHR5KCkKICAgICAgICAgICAgICAgICYmICFfc3BtLnN1\ncHBvcnRzSW5jcmVtZW50YWxGbHVzaCgpKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAg\nICAgICAgICAgICAgKCJzYXZlcG9pbnQtZmx1c2gtbm90LXN1cHBvcnRlZCIp\nKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmbHVzaFNh\nZmUoRkxVU0hfSU5DKTsKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFH\nX0ZMVVNIRUQ7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgICAgIC8vIHJvbGxiYWNrIG9uIGZsdXNo\nIGVycm9yOyBvYmplY3RzIG1heSBiZSBpbiBpbmNvbnNpc3RlbnQgc3RhdGUK\nICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seShrZSk7CiAgICAgICAg\nICAgICAgICB0aHJvdyBrZS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAg\nICAgLy8gcm9sbGJhY2sgb24gZmx1c2ggZXJyb3I7IG9iamVjdHMgbWF5IGJl\nIGluIGluY29uc2lzdGVudCBzdGF0ZQogICAgICAgICAgICAgICAgc2V0Um9s\nbGJhY2tPbmx5KHJlKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTdG9y\nZUV4Y2VwdGlvbihyZSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBw\ncmVGbHVzaCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNU\nSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZMVVNIX0xP\nR0lDQUwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCB2\nYWxpZGF0ZUNoYW5nZXMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgbm8gdHJhbnMs\nIGp1c3QgcmV0dXJuOyBpZiBhY3RpdmUgZGF0YXN0b3JlIHRyYW5zLCBmbHVz\naAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAw\nKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAgICAg\nICAgICBmbHVzaCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHJ1bnRpbWUg\nc3VwcG9ydHMgaW5jIGZsdXNoCiAgICAgICAgICAgIGlmICghX2NvbmYuc3Vw\ncG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zKF9jb25mLk9QVElPTl9JTkNfRkxV\nU0gpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJpbmNyZW1l\nbnRhbC1mbHVzaC1ub3Qtc3VwcG9ydGVkIikpOwoKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGZsdXNoU2FmZShGTFVTSF9ST0xMQkFDSyk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgU3RvcmVFeGNlcHRpb24ocmUpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNB\nY3RpdmUoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0FD\nVElWRSkgIT0gMDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaXNTdG9yZUFjdGl2ZSgpIHsKICAgICAgICAvLyB3ZSBuZWVkIHRv\nIGxvY2sgaGVyZSwgYmVjYXVzZSB3ZSBtaWdodCBiZSBpbiB0aGUgbWlkZGxl\nIG9mIGFuCiAgICAgICAgLy8gYXRvbWljIHRyYW5zYWN0aW9uIHByb2Nlc3Mg\nKGUuZy4sIGNvbW1pdEFuZFJlc3VtZSkKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBjdXJy\nZW50IHRyYW5zYWN0aW9uIGlzIGVuZGluZywgaS5lLiBpbiB0aGUgMm5kIHBo\nYXNlCiAgICAgKiBvZiBhIGNvbW1pdCBvciByb2xsYmFjawogICAgICovCiAg\nICBib29sZWFuIGlzVHJhbnNhY3Rpb25FbmRpbmcoKSB7CiAgICAgICAgcmV0\ndXJuIChfZmxhZ3MgJiBGTEFHX1RSQU5TX0VORElORykgIT0gMDsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBiZWdpbk9wZXJhdGlvbihib29sZWFuIHN5\nbmNUcmFucykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAgICAgICBpZiAoc3luY1Ry\nYW5zICYmIF9vcGVyYXRpb25Db3VudCA9PSAwICYmIF9zeW5jTWFuYWdlZAog\nICAgICAgICAgICAgICAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAw\nKQogICAgICAgICAgICAgICAgc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24o\nKTsKICAgICAgICAgICAgcmV0dXJuIF9vcGVyYXRpb25Db3VudCsrID09IDE7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNl\ncHRpb24ocmUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1h\ncmsgdGhlIG9wZXJhdGlvbiBvdmVyLiBJZiBvdXRlcm1vc3QgY2FsbGVyIG9m\nIHN0YWNrLCByZXR1cm5zIHRydWUKICAgICAqIGFuZCB3aWxsIGRldGFjaCBt\nYW5hZ2VkIGluc3RhbmNlcyBpZiBuZWNlc3NhcnkuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGVuZE9wZXJhdGlvbigpIHsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50ID09IDEgJiYgKF9hdXRv\nRGV0YWNoICYgREVUQUNIX05PTlRYUkVBRCkgIT0gMAogICAgICAgICAgICAg\nICAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKSB7CiAgICAgICAg\nICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChudWxsKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50IDwgMSkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihfbG9jLmdl\ndCgibXVsdGktdGhyZWFkZWQtYWNjZXNzIikpOwogICAgICAgICAgICByZXR1\ncm4gX29wZXJhdGlvbkNvdW50ID09IDE7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBfb3BlcmF0aW9uQ291bnQtLTsKICAg\nICAgICAgICAgaWYgKF9vcGVyYXRpb25Db3VudCA9PSAwKQogICAgICAgICAg\nICAgICAgX29wZXJhdGluZy5jbGVhcigpOwogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN5bmNocm9uaXphdGlv\nbiBnZXRTeW5jaHJvbml6YXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9zeW5j\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFN5bmNocm9uaXphdGlvbihT\neW5jaHJvbml6YXRpb24gc3luYykgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICBfc3luYyA9IHN5bmM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIElt\ncGxlbWVudGF0aW9uIG9mIFN5bmNocm9uaXphdGlvbiBpbnRlcmZhY2UKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCgogICAgcHVibGljIHZvaWQgYmVmb3JlQ29tcGxldGlvbigpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgLy8gdXNlci1zdXBwbGllZCBzeW5jaHJvbml6YXRpb24KICAg\nICAgICAgICAgaWYgKF9zeW5jICE9IG51bGwpCiAgICAgICAgICAgICAgICBf\nc3luYy5iZWZvcmVDb21wbGV0aW9uKCk7CgogICAgICAgICAgICBmbHVzaFNh\nZmUoRkxVU0hfQ09NTUlUKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJl\nbmQtdHJhbnMtZXJyb3IiKSwga2UpOwogICAgICAgICAgICB0aHJvdyB0cmFu\nc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlvbihrZSk7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICBp\nZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIHJlKTsKICAg\nICAgICAgICAgdGhyb3cgdHJhbnNsYXRlTWFuYWdlZENvbXBsZXRpb25FeGNl\ncHRpb24obmV3IFN0b3JlRXhjZXB0aW9uKHJlKSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFmdGVyQ29tcGxldGlvbihpbnQgc3Rh\ndHVzKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7\nCgogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19UUkFOU19FTkRJTkc7CiAg\nICAgICAgICAgIGVuZFRyYW5zYWN0aW9uKHN0YXR1cyk7CiAgICAgICAgICAg\nIGlmIChfc3luYyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3N5bmMuYWZ0\nZXJDb21wbGV0aW9uKHN0YXR1cyk7CgogICAgICAgICAgICBpZiAoKF9hdXRv\nRGV0YWNoICYgREVUQUNIX0NPTU1JVCkgIT0gMCkKICAgICAgICAgICAgICAg\nIGRldGFjaEFsbEludGVybmFsKG51bGwpOwogICAgICAgICAgICBlbHNlIGlm\nIChzdGF0dXMgPT0gU3RhdHVzLlNUQVRVU19ST0xMRURCQUNLIAogICAgICAg\nICAgICAgICAgJiYgKF9hdXRvRGV0YWNoICYgREVUQUNIX1JPTExCQUNLKSAh\nPSAwKSB7CiAgICAgICAgICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChudWxs\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaW4gYW4gZWUgY29u\ndGV4dCwgaXQncyBwb3NzaWJsZSB0aGF0IHRoZSB1c2VyIHRyaWVkIHRvIGNs\nb3NlCiAgICAgICAgICAgIC8vIHVzIGJ1dCB3ZSBkaWRuJ3QgYWN0dWFsbHkg\nY2xvc2UgYmVjYXVzZSB3ZSB3ZXJlIHdhaXRpbmcgb24gdGhpcwogICAgICAg\nICAgICAvLyB0cmFuc2FjdGlvbjsgaWYgdGhhdCdzIHRydWUsIHRoZW4gY2xv\nc2Ugbm93CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19DTE9TRV9J\nTlZPS0VEKSAhPSAwCiAgICAgICAgICAgICAgICAmJiBfY29tcGF0LmdldENs\nb3NlT25NYW5hZ2VkQ29tbWl0KCkpCiAgICAgICAgICAgICAgICBmcmVlKCk7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiks\nIGtlKTsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlTWFuYWdlZENvbXBs\nZXRpb25FeGNlcHRpb24oa2UpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQo\nImVuZC10cmFucy1lcnJvciIpLCByZSk7CiAgICAgICAgICAgIHRocm93IHRy\nYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9uKG5ldyBTdG9yZUV4\nY2VwdGlvbihyZSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIF9mbGFncyAmPSB+RkxBR19BQ1RJVkU7CiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19GTFVTSEVEOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nVFJBTlNfRU5ESU5HOwoKICAgICAgICAgICAgLy8gZXZlbnQgbWFuYWdlciBu\ndWxsZWQgaWYgZnJlZWQgYnJva2VyCiAgICAgICAgICAgIGlmIChfdHJhbnNF\ndmVudE1hbmFnZXIgIT0gbnVsbCAKICAgICAgICAgICAgICAgICYmIF90cmFu\nc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkgewogICAgICAgICAg\nICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZl\nbnQodGhpcywKICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPT0gU3RhdHVz\nLlNUQVRVU19DT01NSVRURUQKICAgICAgICAgICAgICAgICAgICAgICAgPyBU\ncmFuc2FjdGlvbkV2ZW50LkFGVEVSX0NPTU1JVF9DT01QTEVURQogICAgICAg\nICAgICAgICAgICAgICAgICA6IFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfUk9M\nTEJBQ0tfQ09NUExFVEUsCiAgICAgICAgICAgICAgICAgICAgbnVsbCwgbnVs\nbCwgbnVsbCwgbnVsbCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJZiB3ZSdyZSBpbiBhIG1hbmFnZWQgdHJhbnNhY3Rpb24sIHVzZSBvdXIg\naW1wbGljaXQgYmVoYXZpb3IgZXhjZXB0aW9uCiAgICAgKiB0cmFuc2xhdG9y\nIHRvIHRyYW5zbGF0ZSBiZWZvcmUvYWZ0ZXJDb21wbGV0aW9uIGNhbGxiYWNr\nIGVycm9ycy4KICAgICAqLwogICAgcHJpdmF0ZSBSdW50aW1lRXhjZXB0aW9u\nIHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9uCiAgICAgICAg\nKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICByZXR1cm4gKCFfbWFu\nYWdlZCB8fCBfZXh0cmFucyA9PSBudWxsKSA/IHJlIDogX2V4dHJhbnMudHJh\nbnNsYXRlKHJlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIHNhZmVs\neSwgY2F0Y2hpbmcgcmVlbnRyYW50IGNhbGxzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgZmx1c2hTYWZlKGludCByZWFzb24pIHsKICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfRkxVU0hJTkcpICE9IDApCiAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInJlZW50\ncmFudC1mbHVzaCIpKTsKCiAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hJ\nTkc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmx1c2gocmVhc29uKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZM\nQUdfRkxVU0hJTkc7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nRmx1c2ggdGhlIHRyYW5zYWN0aW9uYWwgc3RhdGUgdG8gdGhlIGRhdGEgc3Rv\ncmUuIFN1YmNsYXNzZXMgdGhhdAogICAgICogY3VzdG9taXplIGNvbW1pdCBi\nZWhhdmlvciBzaG91bGQgb3ZlcnJpZGUgdGhpcyBtZXRob2QuIFRoZSBtZXRo\nb2QKICAgICAqIGFzc3VtZXMgdGhhdCB0aGUgcGVyc2lzdGVuY2UgbWFuYWdl\nciBpcyBsb2NrZWQsIGlzIG5vdCBjbG9zZWQsCiAgICAgKiBhbmQgaGFzIGFu\nIGFjdGl2ZSB0cmFuc2FjdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gcmVh\nc29uIG9uZSBvZiB7QGxpbmsgI0ZMVVNIX0lOQ30sIHtAbGluayAjRkxVU0hf\nQ09NTUlUfSwKICAgICAqIHtAbGluayAjRkxVU0hfUk9MTEJBQ0t9LCBvciB7\nQGxpbmsgI0ZMVVNIX0xPR0lDQUx9CiAgICAgKiBAc2luY2UgMC4yLjUKICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgZmx1c2goaW50IHJlYXNvbikgewog\nICAgICAgIC8vIHRoaXMgd2lsbCBlbmxpc3QgcHJveGllZCBzdGF0ZXMgYXMg\nbmVjZXNzYXJ5IHNvIHdlIGtub3cgd2hldGhlciB3ZQogICAgICAgIC8vIGhh\ndmUgYW55dGhpbmcgdG8gZmx1c2gKICAgICAgICBDb2xsZWN0aW9uIHRyYW5z\nYWN0aW9uYWwgPSBnZXRUcmFuc2FjdGlvbmFsU3RhdGVzKCk7CgogICAgICAg\nIC8vIGRvIHdlIGFjdHVhbGx5IGhhdmUgdG8gZmx1c2g/ICBvbmx5IGlmIG91\nciBmbGFncyBzYXkgc28sIG9yIGlmCiAgICAgICAgLy8gd2UgaGF2ZSB0cmFu\nc2FjdGlvbiBsaXN0ZW5lcnMgdGhhdCBuZWVkIHRvIGJlIGludm9rZWQgZm9y\nIGNvbW1pdAogICAgICAgIC8vIChubyBuZWVkIHRvIGludm9rZSB0aGVtIG9u\nIGluYyBmbHVzaCBpZiBub3RoaW5nIGlzIGRpcnR5KS4gIHdlCiAgICAgICAg\nLy8gc3BlY2lhbCBjYXNlIHRoZSByZW1vdGUgY29tbWl0IGxpc3RlbmVyIHVz\nZWQgYnkgdGhlIGRhdGFjYWNoZSBjYXVzZQogICAgICAgIC8vIHdlIGtub3cg\naXQgZG9lc24ndCByZXF1aXJlIHRoZSBjb21taXQgZXZlbnQgd2hlbiBub3Ro\naW5nIGNoYW5nZXMKICAgICAgICBib29sZWFuIGZsdXNoID0gKF9mbGFncyAm\nIEZMQUdfRkxVU0hfUkVRVUlSRUQpICE9IDA7CiAgICAgICAgYm9vbGVhbiBs\naXN0ZW5lcnMgPSAoX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlzdGVu\nZXJzKCkKICAgICAgICAgICAgfHwgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0Vu\nZExpc3RlbmVycygpKQogICAgICAgICAgICAmJiAoKF9mbGFncyAmIEZMQUdf\nUkVNT1RFX0xJU1RFTkVSKSA9PSAwCiAgICAgICAgICAgIHx8IF90cmFuc0V2\nZW50TWFuYWdlci5nZXRMaXN0ZW5lcnMoKS5zaXplKCkgPiAxKTsKICAgICAg\nICBpZiAoIWZsdXNoICYmIChyZWFzb24gIT0gRkxVU0hfQ09NTUlUIHx8ICFs\naXN0ZW5lcnMpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIENvbGxl\nY3Rpb24gbW9ianMgPSBudWxsOwogICAgICAgIF9mbGFncyB8PSBGTEFHX1BS\nRVNUT1JJTkc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGZsdXNo\nKSB7CiAgICAgICAgICAgICAgICAvLyBjYWxsIHByZSBzdG9yZSBvbiBhbGwg\nY3VycmVudGx5IHRyYW5zYWN0aW9uYWwgb2JqcwogICAgICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSB0cmFuc2FjdGlvbmFsLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgICAgICgoU3RhdGVN\nYW5hZ2VySW1wbCkgaXRyLm5leHQoKSkuYmVmb3JlRmx1c2gocmVhc29uLCBf\nY2FsbCk7CiAgICAgICAgICAgICAgICBmbHVzaEFkZGl0aW9ucyh0cmFuc2Fj\ndGlvbmFsLCByZWFzb24pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBob3BlZnVsbHkgbm93IGFsbCBkZXBlbmRlbnQgaW5zdGFuY2VzIHRoYXQg\nYXJlIGdvaW5nIHRvIGVuZAogICAgICAgICAgICAvLyB1cCByZWZlcmVuY2Vk\nIGhhdmUgYmVlbiBtYXJrZWQgYXMgc3VjaDsgZGVsZXRlIHVucmVmZWQKICAg\nICAgICAgICAgLy8gZGVwZW5kZW50cwogICAgICAgICAgICBfZmxhZ3MgfD0g\nRkxBR19ERVJFRkRFTEVUSU5HOwogICAgICAgICAgICBpZiAoZmx1c2ggJiYg\nX2RlcmVmQ2FjaGUgIT0gbnVsbCAmJiAhX2RlcmVmQ2FjaGUuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9kZXJl\nZkNhY2hlLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAg\nICAgICAgICAgIGRlbGV0ZURlcmVmKChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIu\nbmV4dCgpKTsKICAgICAgICAgICAgICAgIGZsdXNoQWRkaXRpb25zKHRyYW5z\nYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChyZWFzb24gIT0gRkxVU0hfTE9HSUNBTCkgewogICAgICAgICAgICAg\nICAgLy8gaWYgbm8gZGF0YXN0b3JlIHRyYW5zYWN0aW9uLCBzdGFydCBvbmU7\nIGV2ZW4gaWYgd2UgZG9uJ3QKICAgICAgICAgICAgICAgIC8vIHRoaW5rIHdl\nJ2xsIG5lZWQgdG8gZmx1c2ggYXQgdGhpcyBwb2ludCwgb3VyIHRyYW5zYWN0\naW9uCiAgICAgICAgICAgICAgICAvLyBsaXN0ZW5lcnMgbWlnaHQgaW50cm9k\ndWNlIHNvbWUgZGlydHkgb2JqZWN0cyBvciBpbnRlcmFjdAogICAgICAgICAg\nICAgICAgLy8gZGlyZWN0bHkgd2l0aCB0aGUgZGF0YWJhc2UKICAgICAgICAg\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpID09IDAp\nCiAgICAgICAgICAgICAgICAgICAgYmVnaW5TdG9yZU1hbmFnZXJUcmFuc2Fj\ndGlvbihmYWxzZSk7CgogICAgICAgICAgICAgICAgaWYgKChfdHJhbnNFdmVu\ndE1hbmFnZXIuaGFzRmx1c2hMaXN0ZW5lcnMoKQogICAgICAgICAgICAgICAg\nICAgIHx8IF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkK\nICAgICAgICAgICAgICAgICAgICAmJiAoZmx1c2ggfHwgcmVhc29uID09IEZM\nVVNIX0NPTU1JVCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBmaXJlIGV2\nZW50cwogICAgICAgICAgICAgICAgICAgIG1vYmpzID0gbmV3IE1hbmFnZWRP\nYmplY3RDb2xsZWN0aW9uKHRyYW5zYWN0aW9uYWwpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChyZWFzb24gPT0gRkxVU0hfQ09NTUlUCiAgICAgICAgICAg\nICAgICAgICAgICAgICYmIF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0\nZW5lcnMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmaXJlVHJhbnNh\nY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlzLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uRXZlbnQuQkVGT1JF\nX0NPTU1JVCwgbW9ianMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBf\ncGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVsZXRlZENsc3MpKTsK\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNoQWRkaXRpb25zKHRyYW5z\nYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGZs\ndXNoID0gKF9mbGFncyAmIEZMQUdfRkxVU0hfUkVRVUlSRUQpICE9IDA7CiAg\nICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAo\nZmx1c2ggJiYgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlzdGVuZXJz\nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9u\nRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkJFRk9SRV9GTFVT\nSCwgbW9ianMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcGVyc2lz\ndGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVsZXRlZENsc3MpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgZmx1c2hBZGRpdGlvbnModHJhbnNhY3Rpb25h\nbCwgcmVhc29uKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxs\neSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19QUkVTVE9SSU5HOwog\nICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfREVSRUZERUxFVElORzsKICAg\nICAgICAgICAgX3RyYW5zQWRkaXRpb25zID0gbnVsbDsKICAgICAgICAgICAg\nX2RlcmVmQWRkaXRpb25zID0gbnVsbDsKCiAgICAgICAgICAgIC8vIGFsc28g\nY2xlYXIgZGVyZWZlZCBzZXQ7IHRoZSBkZWxldGVzIGhhdmUgYmVlbiByZWNv\ncmRlZAogICAgICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9kZXJlZkNhY2hlLmNsZWFyKCk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBmbHVzaCB0byBzdG9yZSBtYW5hZ2VyCiAgICAgICAgTGlz\ndCBleGNlcHMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChmbHVzaCAmJiByZWFzb24gIT0gRkxVU0hfTE9HSUNBTCkgewogICAgICAg\nICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfU1RPUkVfRkxVU0hJTkc7CiAgICAg\nICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLAogICAgICAgICAgICAg\nICAgICAgIG5ld0ZsdXNoRXhjZXB0aW9uKF9zdG9yZS5mbHVzaCh0cmFuc2Fj\ndGlvbmFsKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1NUT1JFX0ZMVVNISU5HOwoK\nICAgICAgICAgICAgaWYgKHJlYXNvbiA9PSBGTFVTSF9ST0xMQkFDSykKICAg\nICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGVuZFN0b3JlTWFu\nYWdlclRyYW5zYWN0aW9uKHRydWUpKTsKICAgICAgICAgICAgZWxzZSBpZiAo\ncmVhc29uICE9IEZMVVNIX0xPR0lDQUwpCiAgICAgICAgICAgICAgICBfZmxh\nZ3MgJj0gfkZMQUdfRkxVU0hfUkVRVUlSRUQ7CgogICAgICAgICAgICAvLyBt\nYXJrIHN0YXRlcyBhcyBmbHVzaGVkCiAgICAgICAgICAgIGlmIChmbHVzaCkg\newogICAgICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdHJhbnNhY3Rpb25hbC5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gdGhlIHN0YXRlIG1heSBoYXZlIGJlY29tZSB0cmFuc2llbnQsIHN1Y2gg\nYXMgaWYKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXQgaXMgZW1iZWRk\nZWQgYW5kIHRoZSBvd25lciBoYXMgYmVlbiBkZWxldGVkIGR1cmluZwogICAg\nICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGZsdXNoIHByb2Nlc3M7IGJ1\nZyAjMTEwMAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20uZ2V0UENT\ndGF0ZSgpID09IFBDU3RhdGUuVFJBTlNJRU5UKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgICAg\nICBzbS5hZnRlckZsdXNoKHJlYXNvbik7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChyZWFzb24gPT0gRkxVU0hfSU5DKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAvLyBpZiBub3QgYWJvdXQgdG8gY2xlYXIgdHJhbnMg\nY2FjaGUgZm9yIGNvbW1pdCAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGFueXdheSwgcmUtY2FjaGUgZGlydHkgb2JqZWN0cyB3aXRoIGRlZmF1\nbHQgc29mdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVmczsg\nd2UgZG9uJ3QgbmVlZCBoYXJkIHJlZnMgbm93IHRoYXQgdGhlIAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gY2hhbmdlcyBoYXZlIGJlZW4gZmx1\nc2hlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20ucHJveHlGaWVs\nZHModHJ1ZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nX3RyYW5zQ2FjaGUuZmx1c2hlZChzbSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLCBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHRocm93\nIGFueSBleGNlcHRpb25zIHRvIHNob3J0Y3V0IGxpc3RlbmVycyBvbiBmYWls\nCiAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgdHJ1ZSk7\nCgogICAgICAgIGlmIChmbHVzaCAmJiByZWFzb24gIT0gRkxVU0hfUk9MTEJB\nQ0sgJiYgcmVhc29uICE9IEZMVVNIX0xPR0lDQUwKICAgICAgICAgICAgJiYg\nX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlzdGVuZXJzKCkpIHsKICAg\nICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9u\nRXZlbnQodGhpcywKICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uRXZlbnQu\nQUZURVJfRkxVU0gsIG1vYmpzLCBfcGVyc2lzdGVkQ2xzcywKICAgICAgICAg\nICAgICAgIF91cGRhdGVkQ2xzcywgX2RlbGV0ZWRDbHNzKSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogRmx1c2ggbmV3bHktdHJhbnNhY3Rp\nb25hbCBvYmplY3RzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZmx1c2hB\nZGRpdGlvbnMoQ29sbGVjdGlvbiB0cmFuc2FjdGlvbmFsLCBpbnQgcmVhc29u\nKSB7CiAgICAgICAgYm9vbGVhbiBsb29wOwogICAgICAgIGRvIHsKICAgICAg\nICAgICAgLy8gZmx1c2ggbmV3IHRyYW5zYWN0aW9uYWwgaW5zdGFuY2VzOyBu\nb3RlIGxvZ2ljYWwgb3IKICAgICAgICAgICAgbG9vcCA9IGZsdXNoVHJhbnNB\nZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKQogICAgICAgICAgICAg\nICAgfCBkZWxldGVEZXJlZkFkZGl0aW9ucyhfZGVyZWZDYWNoZSk7CiAgICAg\nICAgfSB3aGlsZSAobG9vcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVz\naCB0cmFuc2FjdGlvbmFsIGFkZGl0aW9ucy4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIGZsdXNoVHJhbnNBZGRpdGlvbnMoQ29sbGVjdGlvbiB0cmFu\nc2FjdGlvbmFsLCBpbnQgcmVhc29uKSB7CiAgICAgICAgaWYgKF90cmFuc0Fk\nZGl0aW9ucyA9PSBudWxsIHx8IF90cmFuc0FkZGl0aW9ucy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8ga2VlcCBs\nb2NhbCB0cmFuc2FjdGlvbmFsIGxpc3QgY29weSB1cCB0byBkYXRlCiAgICAg\nICAgdHJhbnNhY3Rpb25hbC5hZGRBbGwoX3RyYW5zQWRkaXRpb25zKTsKCiAg\nICAgICAgLy8gY29weSB0aGUgY2hhbmdlIHNldCwgdGhlbiBjbGVhciBpdCBm\nb3IgdGhlIG5leHQgaXRlcmF0aW9uCiAgICAgICAgU3RhdGVNYW5hZ2VySW1w\nbFtdIHN0YXRlcyA9IChTdGF0ZU1hbmFnZXJJbXBsW10pIF90cmFuc0FkZGl0\naW9ucy4KICAgICAgICAgICAgdG9BcnJheShuZXcgU3RhdGVNYW5hZ2VySW1w\nbFtfdHJhbnNBZGRpdGlvbnMuc2l6ZSgpXSk7CiAgICAgICAgX3RyYW5zQWRk\naXRpb25zLmNsZWFyKCk7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc3RhdGVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBzdGF0ZXNbaV0uYmVm\nb3JlRmx1c2gocmVhc29uLCBfY2FsbCk7CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUgbmV3IGRlcmVmZXJlbmNl\nZCBvYmplY3RzLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gZGVsZXRl\nRGVyZWZBZGRpdGlvbnMoQ29sbGVjdGlvbiBkZXJlZnMpIHsKICAgICAgICBp\nZiAoX2RlcmVmQWRkaXRpb25zID09IG51bGwgfHwgX2RlcmVmQWRkaXRpb25z\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICAvLyByZW1lbWJlciB0aGVzZSBhZGRpdGlvbnMgaW4gY2FzZSBvbmUgYmVj\nb21lcyBkZXJlZmVkIGFnYWluIGxhdGVyCiAgICAgICAgZGVyZWZzLmFkZEFs\nbChfZGVyZWZBZGRpdGlvbnMpOwoKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nW10gc3RhdGVzID0gKFN0YXRlTWFuYWdlckltcGxbXSkgX2RlcmVmQWRkaXRp\nb25zLgogICAgICAgICAgICB0b0FycmF5KG5ldyBTdGF0ZU1hbmFnZXJJbXBs\nW19kZXJlZkFkZGl0aW9ucy5zaXplKCldKTsKICAgICAgICBfZGVyZWZBZGRp\ndGlvbnMuY2xlYXIoKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\ndGF0ZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGRlbGV0ZURlcmVmKHN0\nYXRlc1tpXSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBEZWxldGUgYSBkZXJlZmVyZW5jZWQgZGVwZW5kZW50LgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgZGVsZXRlRGVyZWYoU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSkgewogICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1l\nbnQoT3BDYWxsYmFja3MuT1BfREVMRVRFLAogICAgICAgICAgICBzbS5nZXRN\nYW5hZ2VkSW5zdGFuY2UoKSwgc20sIG51bGwpOwogICAgICAgIGlmICgoYWN0\naW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgIT0gMCkKICAgICAgICAgICAg\nc20uZGVsZXRlKCk7CiAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNr\ncy5BQ1RfQ0FTQ0FERSkgIT0gMCkKICAgICAgICAgICAgc20uY2FzY2FkZURl\nbGV0ZShfY2FsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUg\ndGhlIGFjdGlvbiB0byB0YWtlIGJhc2VkIG9uIHRoZSB1c2VyJ3MgZ2l2ZW4g\nY2FsbGJhY2tzIGFuZAogICAgICogb3VyIGltcGxpY2l0IGJlaGF2aW9yLgog\nICAgICovCiAgICBwcml2YXRlIGludCBwcm9jZXNzQXJndW1lbnQoaW50IG9w\nLCBPYmplY3Qgb2JqLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAg\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoY2FsbCAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzQXJndW1lbnQob3As\nIG9iaiwgc20pOwogICAgICAgIGlmIChfY2FsbCAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gX2NhbGwucHJvY2Vzc0FyZ3VtZW50KG9wLCBvYmosIHNt\nKTsKICAgICAgICByZXR1cm4gT3BDYWxsYmFja3MuQUNUX1JVTiB8IE9wQ2Fs\nbGJhY2tzLkFDVF9DQVNDQURFOwogICAgfQoKICAgIC8qKgogICAgICogVGhy\nb3cgdGhlIHByb3BlciBleGNlcHRpb24gYmFzZWQgb24gdGhlIGdpdmVuIHNl\ndCBvZiBmbHVzaCBlcnJvcnMsIG9yCiAgICAgKiBkbyBub3RoaW5nIGlmIG5v\nIGVycm9ycyBvY2N1cnJlZC4KICAgICAqLwogICAgcHJpdmF0ZSBPcGVuSlBB\nRXhjZXB0aW9uIG5ld0ZsdXNoRXhjZXB0aW9uKENvbGxlY3Rpb24gZXhjZXBz\nKSB7CiAgICAgICAgaWYgKGV4Y2VwcyA9PSBudWxsIHx8IGV4Y2Vwcy5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBUaHJv\nd2FibGVbXSB0ID0gKFRocm93YWJsZVtdKSBleGNlcHMudG9BcnJheQogICAg\nICAgICAgICAobmV3IFRocm93YWJsZVtleGNlcHMuc2l6ZSgpXSk7CiAgICAg\nICAgTGlzdCBmYWlsZWQgPSBuZXcgQXJyYXlMaXN0KHQubGVuZ3RoKTsKCiAg\nICAgICAgLy8gY3JlYXRlIGZhdGFsIGV4Y2VwdGlvbiB3aXRoIG5lc3RlZCBl\neGNlcHRpb25zIGZvciBhbGwgdGhlIGZhaWxlZAogICAgICAgIC8vIG9iamVj\ndHM7IGlmIGFsbCBPTCBleGNlcHRpb25zLCB0aHJvdyBhIHRvcC1sZXZlbCBP\nTCBleGNlcHRpb24KICAgICAgICBib29sZWFuIG9wdCA9IHRydWU7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IG9wdCAmJiBpIDwgdC5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBvcHQgPSB0W2ldIGluc3RhbmNlb2YgT3B0aW1pc3Rp\nY0V4Y2VwdGlvbjsKICAgICAgICAgICAgaWYgKG9wdCkgewogICAgICAgICAg\nICAgICAgT2JqZWN0IGYgPSAoKE9wdGltaXN0aWNFeGNlcHRpb24pIHRbaV0p\nLmdldEZhaWxlZE9iamVjdCgpOwogICAgICAgICAgICAgICAgaWYgKGYgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBmYWlsZWQuYWRkKGYpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChvcHQgJiYgIWZhaWxl\nZC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBuZXcgT3B0aW1pc3Rp\nY0V4Y2VwdGlvbihmYWlsZWQsIHQpOwogICAgICAgIGlmIChvcHQpCiAgICAg\nICAgICAgIHJldHVybiBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbih0KTsKICAg\nICAgICByZXR1cm4gbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJyb2xs\nZWQtYmFjayIpKS4KICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcyh0\nKS5zZXRGYXRhbCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuZCB0\naGUgY3VycmVudCB0cmFuc2FjdGlvbiwgbWFraW5nIGFwcHJvcHJpYXRlIHN0\nYXRlIHRyYW5zaXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBl\nbmRUcmFuc2FjdGlvbihpbnQgc3RhdHVzKSB7CiAgICAgICAgLy8gaWYgYSBk\nYXRhIHN0b3JlIHRyYW5zYWN0aW9uIHdhcyBpbiBwcm9ncmVzcywgZG8gdGhl\nCiAgICAgICAgLy8gYXBwcm9wcmlhdGUgdHJhbnNhY3Rpb24gY2hhbmdlCiAg\nICAgICAgYm9vbGVhbiByb2xsYmFjayA9IHN0YXR1cyAhPSBTdGF0dXMuU1RB\nVFVTX0NPTU1JVFRFRDsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7Cgog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMs\nIGVuZFN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKHJvbGxiYWNrKSk7CiAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICByb2xsYmFjayA9IHRydWU7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChl\neGNlcHMsIHJlKTsKICAgICAgICB9CgogICAgICAgIC8vIGdvIGJhY2sgdG8g\nZGVmYXVsdCBub25lIGxvY2sgbGV2ZWwKICAgICAgICBfZmMuc2V0UmVhZExv\nY2tMZXZlbChMT0NLX05PTkUpOwogICAgICAgIF9mYy5zZXRXcml0ZUxvY2tM\nZXZlbChMT0NLX05PTkUpOwogICAgICAgIF9mYy5zZXRMb2NrVGltZW91dCgt\nMSk7CgogICAgICAgIENvbGxlY3Rpb24gdHJhbnNTdGF0ZXM7CiAgICAgICAg\naWYgKGhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkpCiAgICAgICAgICAgIHRy\nYW5zU3RhdGVzID0gX3RyYW5zQ2FjaGU7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICB0cmFuc1N0YXRlcyA9IENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7Cgog\nICAgICAgIC8vIGZpcmUgYWZ0ZXIgcm9sbGJhY2svY29tbWl0IGV2ZW50CiAg\nICAgICAgQ29sbGVjdGlvbiBtb2JqcyA9IG51bGw7CiAgICAgICAgaWYgKF90\ncmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkgewogICAgICAg\nICAgICBtb2JqcyA9IG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbih0cmFu\nc1N0YXRlcyk7CiAgICAgICAgICAgIGludCBldmVudFR5cGUgPSAocm9sbGJh\nY2spID8gVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9ST0xMQkFDSwogICAgICAg\nICAgICAgICAgOiBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0NPTU1JVDsKICAg\nICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9u\nRXZlbnQodGhpcywgZXZlbnRUeXBlLCBtb2JqcywgCiAgICAgICAgICAgICAg\nICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVsZXRlZENsc3Mp\nKTsKICAgICAgICB9CgogICAgICAgIC8vIG51bGwgdHJhbnNhY3Rpb25hbCBj\nYWNoZXMgbm93IHNvIHRoYXQgYWxsIHRoZSByZW1vdmVGcm9tVHJhbnNhY3Rp\nb24KICAgICAgICAvLyBjYWxscyBhcyB3ZSB0cmFuc2l0aW9uIGVhY2ggb2Jq\nZWN0IGRvbid0IGhhdmUgdG8gZG8gYW55IHdvcms7IGRvbid0CiAgICAgICAg\nLy8gY2xlYXIgdHJhbnMgY2FjaGUgb2JqZWN0IGJlY2F1c2Ugd2Ugc3RpbGwg\nbmVlZCB0aGUgdHJhbnNTdGF0ZXMKICAgICAgICAvLyByZWZlcmVuY2UgdG8g\naXQgYmVsb3cKICAgICAgICBfdHJhbnNDYWNoZSA9IG51bGw7CiAgICAgICAg\naWYgKF9wZXJzaXN0ZWRDbHNzICE9IG51bGwpCiAgICAgICAgICAgIF9wZXJz\naXN0ZWRDbHNzLmNsZWFyKCk7CiAgICAgICAgaWYgKF91cGRhdGVkQ2xzcyAh\nPSBudWxsKQogICAgICAgICAgICBfdXBkYXRlZENsc3MuY2xlYXIoKTsKICAg\nICAgICBpZiAoX2RlbGV0ZWRDbHNzICE9IG51bGwpCiAgICAgICAgICAgIF9k\nZWxldGVkQ2xzcy5jbGVhcigpOwoKICAgICAgICAvLyBuZXcgY2FjaGUgd291\nbGQgZ2V0IGNsZWFyZWQgYW55d2F5IGR1cmluZyB0cmFuc2l0aW9ucywgYnV0\nIGRvaW5nIHNvCiAgICAgICAgLy8gaW1tZWRpYXRlbHkgc2F2ZXMgdXMgc29t\nZSBsb29rdXBzCiAgICAgICAgX2NhY2hlLmNsZWFyTmV3KCk7CgogICAgICAg\nIC8vIHRlbGwgYWxsIGRlcmVmZWQgaW5zdGFuY2VzIHRoZXkncmUgbm8gbG9u\nZ2VyIGRlcmVmZWQ7IHdlIGNhbid0CiAgICAgICAgLy8gcmVseSBvbiByb2xs\nYmFjayBhbmQgY29tbWl0IGNhbGxzIGJlbG93IGNhdXNlIHNvbWUgaW5zdGFu\nY2VzIG1pZ2h0CiAgICAgICAgLy8gbm90IGJlIHRyYW5zYWN0aW9uYWwKICAg\nICAgICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCAmJiAhX2RlcmVmQ2FjaGUu\naXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nX2RlcmVmQ2FjaGUuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAg\nICAgICAgICAgICAoKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCkpLnNl\ndERlcmVmZXJlbmNlZERlcGVuZGVudAogICAgICAgICAgICAgICAgICAgIChm\nYWxzZSwgZmFsc2UpOwogICAgICAgICAgICBfZGVyZWZDYWNoZS5jbGVhcigp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gcGVmb3JtIGNvbW1pdCBvciByb2xs\nYmFjayBzdGF0ZSB0cmFuc2l0aW9ucyBvbiBlYWNoIGluc3RhbmNlCiAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IHRyYW5zU3RhdGVzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAo\ncm9sbGJhY2spIHsKICAgICAgICAgICAgICAgICAgICAvLyB0ZWxsIG9iamVj\ndHMgdGhhdCBtYXkgaGF2ZSBiZWVuIGRlcmVmZWQgdGhlbiBmbHVzaGVkCiAg\nICAgICAgICAgICAgICAgICAgLy8gKGFuZCB0aGVyZWZvcmUgZGVsZXRlZCkg\ndG8gdW4tZGVyZWYKICAgICAgICAgICAgICAgICAgICBzbS5zZXREZXJlZmVy\nZW5jZWREZXBlbmRlbnQoZmFsc2UsIGZhbHNlKTsKICAgICAgICAgICAgICAg\nICAgICBzbS5yb2xsYmFjaygpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgc20uY29tbWl0KCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAg\nIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJlKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgLy8gbm90aWZ5IHRoZSBsb2NrIG1hbmFnZXIgdG8g\nY2xlYW4gdXAgYW5kIHJlbGVhc2UgcmVtYWluaW5nIGxvY2tzCiAgICAgICAg\nX2xtLmVuZFRyYW5zYWN0aW9uKCk7CgogICAgICAgIC8vIGNsZWFyIG9sZCBz\nYXZlcG9pbnRzIGluIHJldmVyc2UKICAgICAgICBPcGVuSlBBU2F2ZXBvaW50\nIHNhdmU7CiAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzICE9IG51bGwgJiYg\nX3NhdmVwb2ludHMuc2l6ZSgpID4gMCkgewogICAgICAgICAgICBzYXZlID0K\nICAgICAgICAgICAgICAgIChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50\ncy5yZW1vdmUoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAg\nIHNhdmUucmVsZWFzZShmYWxzZSk7CiAgICAgICAgfQogICAgICAgIF9zYXZl\ncG9pbnRzID0gbnVsbDsKICAgICAgICBfc2F2ZXBvaW50Q2FjaGUgPSBudWxs\nOwoKICAgICAgICAvLyBmaXJlIGFmdGVyIHN0YXRlIGNoYW5nZSBldmVudAog\nICAgICAgIGlmIChfdHJhbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJz\nKCkpCiAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFu\nc2FjdGlvbkV2ZW50KHRoaXMsIFRyYW5zYWN0aW9uRXZlbnQuCiAgICAgICAg\nICAgICAgICBBRlRFUl9TVEFURV9UUkFOU0lUSU9OUywgbW9ianMsIG51bGws\nIG51bGwsIG51bGwpKTsKCiAgICAgICAgLy8gbm93IGNsZWFyIHRyYW5zIGNh\nY2hlOyBrZWVwIGNsZWFyZWQgdmVyc2lvbiByYXRoZXIgdGhhbgogICAgICAg\nIC8vIG51bGwgdG8gYXZvaWQgaGF2aW5nIHRvIHJlLWNyZWF0ZSB0aGUgc2V0\nIGxhdGVyOyBtb3JlIGVmZmljaWVudAogICAgICAgIGlmICh0cmFuc1N0YXRl\ncyAhPSBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUKSB7CiAgICAgICAgICAgIF90\ncmFuc0NhY2hlID0gKFRyYW5zYWN0aW9uYWxDYWNoZSkgdHJhbnNTdGF0ZXM7\nCiAgICAgICAgICAgIF90cmFuc0NhY2hlLmNsZWFyKCk7CiAgICAgICAgfQoK\nICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCB0cnVlKTsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gT2JqZWN0\nIGxpZmVjeWNsZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJs\naWMgdm9pZCBwZXJzaXN0KE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBwZXJzaXN0KG9iaiwgbnVsbCwgdHJ1ZSwgY2FsbCk7CiAg\nICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgcGVyc2lzdChP\nYmplY3Qgb2JqLCBPYmplY3QgaWQsCiAgICAgICAgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIHJldHVybiBwZXJzaXN0KG9iaiwgaWQsIHRydWUsIGNh\nbGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBlcnNpc3RBbGwoQ29sbGVj\ndGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgcGVyc2lz\ndEFsbChvYmpzLCB0cnVlLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBlcnNpc3QgdGhlIGdpdmVuIG9iamVjdHMuICBJbmRpY2F0ZSB3aGV0aGVy\nIHRoaXMgd2FzIGFuIGV4cGxpY2l0IHBlcnNpc3QKICAgICAqIChQTkVXKSBv\nciBhIHByb3Zpc29uYWwgcGVyc2lzdCAoUE5FV1BST1ZJU0lPTkFMKS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgcGVyc2lzdEFsbChDb2xsZWN0aW9uIG9i\nanMsIGJvb2xlYW4gZXhwbGljaXQsIAogICAgICAgIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAg\nICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7CgogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgcGVyc2lzdChpdHIubmV4dCgpLCBleHBsaWNpdCwgY2FsbCk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAg\nICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIElmIHRoZSBnaXZlbiBlbGVtZW50IGlzIG5v\ndCBudWxsLCBhZGQgaXQgdG8gdGhlIGdpdmVuIGxpc3QsCiAgICAgKiBjcmVh\ndGluZyB0aGUgbGlzdCBpZiBuZWNlc3NhcnkuCiAgICAgKi8KICAgIHByaXZh\ndGUgTGlzdCBhZGQoTGlzdCBsLCBPYmplY3QgbykgewogICAgICAgIGlmIChv\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBsOwogICAgICAgIGlmIChs\nID09IG51bGwpCiAgICAgICAgICAgIGwgPSBuZXcgTGlua2VkTGlzdCgpOwog\nICAgICAgIGwuYWRkKG8pOwogICAgICAgIHJldHVybiBsOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhyb3cgYW4gZXhjZXB0aW9uIHdyYXBwaW5nIHRoZSBn\naXZlbiBuZXN0ZWQgZXhjZXB0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHRocm93TmVzdGVkRXhjZXB0aW9ucyhMaXN0IGV4Y2VwcywgYm9vbGVh\nbiBkYXRhc3RvcmUpIHsKICAgICAgICBpZiAoZXhjZXBzID09IG51bGwgfHwg\nZXhjZXBzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIGlmIChkYXRhc3RvcmUgJiYgZXhjZXBzLnNpemUoKSA9PSAxKQogICAgICAg\nICAgICB0aHJvdyAoUnVudGltZUV4Y2VwdGlvbikgZXhjZXBzLmdldCgwKTsK\nCiAgICAgICAgYm9vbGVhbiBmYXRhbCA9IGZhbHNlOwogICAgICAgIFRocm93\nYWJsZVtdIHQgPSAoVGhyb3dhYmxlW10pIGV4Y2Vwcy50b0FycmF5CiAgICAg\nICAgICAgIChuZXcgVGhyb3dhYmxlW2V4Y2Vwcy5zaXplKCldKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHQubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKHRbaV0gaW5zdGFuY2VvZiBPcGVuSlBBRXhjZXB0aW9uCiAg\nICAgICAgICAgICAgICAmJiAoKE9wZW5KUEFFeGNlcHRpb24pIHRbaV0pLmlz\nRmF0YWwoKSkKICAgICAgICAgICAgICAgIGZhdGFsID0gdHJ1ZTsKICAgICAg\nICB9CiAgICAgICAgT3BlbkpQQUV4Y2VwdGlvbiBlcnI7CiAgICAgICAgaWYg\nKGRhdGFzdG9yZSkKICAgICAgICAgICAgZXJyID0gbmV3IFN0b3JlRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuZXN0ZWQtZXhjZXBzIikpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgZXJyID0gbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nIm5lc3RlZC1leGNlcHMiKSk7CiAgICAgICAgdGhyb3cgZXJyLnNldE5lc3Rl\nZFRocm93YWJsZXModCkuc2V0RmF0YWwoZmF0YWwpOwogICAgfQoKICAgIC8q\nKgogICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2JqZWN0LiAgSW5kaWNhdGUg\nd2hldGhlciB0aGlzIHdhcyBhbiBleHBsaWNpdCBwZXJzaXN0CiAgICAgKiAo\nUE5FVykgb3IgYSBwcm92aXNvbmFsIHBlcnNpc3QgKFBORVdQUk9WSVNJT05B\nTCkKICAgICAqLwogICAgcHVibGljIHZvaWQgcGVyc2lzdChPYmplY3Qgb2Jq\nLCBib29sZWFuIGV4cGxpY2l0LCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgcGVyc2lzdChvYmosIG51bGwsIGV4cGxpY2l0LCBjYWxsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFBlcnNpc3QgdGhlIGdpdmVuIG9iamVjdC4gIElu\nZGljYXRlIHdoZXRoZXIgdGhpcyB3YXMgYW4gZXhwbGljaXQgcGVyc2lzdAog\nICAgICogKFBORVcpIG9yIGEgcHJvdmlzb25hbCBwZXJzaXN0IChQTkVXUFJP\nVklTSU9OQUwpLgogICAgICogU2VlIHtAbGluayBCcm9rZXJ9IGZvciBkZXRh\naWxzIG9uIHRoaXMgbWV0aG9kLgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBwZXJzaXN0KE9iamVjdCBvYmosIE9iamVjdCBpZCwg\nYm9vbGVhbiBleHBsaWNpdCwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsKCiAg\nICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFn\nZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICghX29wZXJhdGlu\nZy5hZGQob2JqKSkKICAgICAgICAgICAgICAgIHJldHVybiBzbTsKCiAgICAg\nICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFj\na3MuT1BfUEVSU0lTVCwgb2JqLCBzbSwgY2FsbCk7CiAgICAgICAgICAgIGlm\nIChhY3Rpb24gPT0gT3BDYWxsYmFja3MuQUNUX05PTkUpCiAgICAgICAgICAg\nICAgICByZXR1cm4gc207CgogICAgICAgICAgICAvLyBBQ1RfQ0FTQ0FERQog\nICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4p\nID09IDApIHsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwpOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGNhc2NhZGVU\ncmFuc2llbnQoT3BDYWxsYmFja3MuT1BfUEVSU0lTVCwgb2JqLCBjYWxsLAog\nICAgICAgICAgICAgICAgICAgICAgICAicGVyc2lzdCIpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHNtOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBBQ1RfUlVOCiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYzsK\nICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlvbihfbG9jLmdldAogICAgICAg\nICAgICAgICAgICAgICAgICAoInBlcnNpc3QtZGV0YWNoZWQiLCBFeGNlcHRp\nb25zLnRvU3RyaW5nKG9iaikpKS4KICAgICAgICAgICAgICAgICAgICAgICAg\nc2V0RmFpbGVkT2JqZWN0KG9iaik7CgogICAgICAgICAgICAgICAgaWYgKCFz\nbS5pc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBzbS5wZXJz\naXN0KCk7CiAgICAgICAgICAgICAgICAgICAgX2NhY2hlLnBlcnNpc3Qoc20p\nOwogICAgICAgICAgICAgICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFj\na3MuQUNUX0NBU0NBREUpICE9IDApCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwpOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBzbTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICAvLyBhbiBlbWJlZGRlZCBmaWVsZDsgbm90aWZ5IHRoZSBvd25lciB0aGF0\nIHRoZSB2YWx1ZSBoYXMKICAgICAgICAgICAgICAgIC8vIGNoYW5nZWQgYnkg\nYmVjb21pbmcgaW5kZXBlbmRlbnRseSBwZXJzaXN0ZW50CiAgICAgICAgICAg\nICAgICBzbS5nZXRPd25lcigpLmRpcnR5KHNtLmdldE93bmVyTWV0YURhdGEo\nKS4KICAgICAgICAgICAgICAgICAgICBnZXRGaWVsZE1ldGFEYXRhKCkuZ2V0\nSW5kZXgoKSk7CiAgICAgICAgICAgICAgICBfY2FjaGUucGVyc2lzdChzbSk7\nCiAgICAgICAgICAgICAgICBwYyA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJs\nZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcGMg\nPSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKTsKICAgICAgICAgICAg\nICAgIGlmIChwYy5wY0lzRGV0YWNoZWQoKSA9PSBCb29sZWFuLlRSVUUpCiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2Vw\ndGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAoInBlcnNp\nc3QtZGV0YWNoZWQiLCBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS4KICAg\nICAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9\nIF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAg\nICAgICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0Q2xhc3MoKSwgX2xvYWRl\nciwgdHJ1ZSk7CiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChvYmos\nIG51bGwsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkJFRk9SRV9QRVJTSVNUKTsK\nCiAgICAgICAgICAgIC8vIGNyZWF0ZSBpZCBmb3IgaW5zdGFuY2UKICAgICAg\nICAgICAgaWYgKGlkID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICht\nZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQ\nTElDQVRJT04pCiAgICAgICAgICAgICAgICAgICAgaWQgPSBBcHBsaWNhdGlv\nbklkcy5jcmVhdGUocGMsIG1ldGEpOwogICAgICAgICAgICAgICAgZWxzZSBp\nZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklE\nX1VOS05PV04pCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93bmlkIiwgbWV0YSkpOwog\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGlkID0g\nU3RhdGVNYW5hZ2VySWQubmV3SW5zdGFuY2UodGhpcyk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBkb24ndCBhbHJlYWR5\nIGhhdmUgdGhlIGluc3RhbmNlIGNhY2hlZAogICAgICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIG90aGVyID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQoaWQs\nIGZhbHNlKTsKICAgICAgICAgICAgaWYgKG90aGVyICE9IG51bGwgJiYgIW90\naGVyLmlzRGVsZXRlZCgpICYmICFvdGhlci5pc05ldygpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlvbihfbG9jLmdl\ndCgiY2FjaGUtZXhpc3RzIiwKICAgICAgICAgICAgICAgICAgICBvYmouZ2V0\nQ2xhc3MoKS5nZXROYW1lKCksIGlkKSkuc2V0RmFpbGVkT2JqZWN0KG9iaik7\nCgogICAgICAgICAgICAvLyBpZiBoYWQgZW1iZWRkZWQgc20sIG51bGwgaXQK\nICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgICAgICBw\nYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIobnVsbCk7CgogICAgICAgICAgICAv\nLyBjcmVhdGUgbmV3IHNtCiAgICAgICAgICAgIHNtID0gbmV3IFN0YXRlTWFu\nYWdlckltcGwoaWQsIG1ldGEsIHRoaXMpOwogICAgICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBp\nZiAoZXhwbGljaXQpCiAgICAgICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6\nZShwYywgUENTdGF0ZS5QTkVXKTsKICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRlLlBO\nRVdQUk9WSVNJT05BTCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5QTk9OVFJBTlNORVcp\nOwogICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9D\nQVNDQURFKSAhPSAwKQogICAgICAgICAgICAgICAgc20uY2FzY2FkZVBlcnNp\nc3QoY2FsbCk7CiAgICAgICAgICAgIHJldHVybiBzbTsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93\nIGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlbXBvcmFyaWx5\nIG1hbmFnZSB0aGUgZ2l2ZW4gaW5zdGFuY2UgaW4gb3JkZXIgdG8gY2FzY2Fk\nZSB0aGUgZ2l2ZW4KICAgICAqIG9wZXJhdGlvbiB0aHJvdWdoIGl0LgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgY2FzY2FkZVRyYW5zaWVudChpbnQgb3As\nIE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwsCiAgICAgICAgU3RyaW5n\nIGVyck9wKSB7CiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gYXNz\nZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaik7CgogICAgICAgIC8vIGlmIHVz\naW5nIGRldGFjaGVkIHN0YXRlIG1hbmFnZXIsIGRvbid0IHJlcGxhY2UKICAg\nICAgICBpZiAocGMucGNHZXRTdGF0ZU1hbmFnZXIoKSAhPSBudWxsKQogICAg\nICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosIGVyck9w\nKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0\nYURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0TWV0\nYURhdGEob2JqLmdldENsYXNzKCksIF9sb2FkZXIsIHRydWUpOwogICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChT\ndGF0ZU1hbmFnZXJJZC4KICAgICAgICAgICAgbmV3SW5zdGFuY2UodGhpcyks\nIG1ldGEsIHRoaXMpOwogICAgICAgIHNtLmluaXRpYWxpemUocGMsIFBDU3Rh\ndGUuVExPQURFRCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3dpdGNo\nIChvcCkgewogICAgICAgICAgICAgICAgY2FzZSBPcENhbGxiYWNrcy5PUF9Q\nRVJTSVNUOgogICAgICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0\nKGNhbGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBPcENhbGxiYWNrcy5PUF9ERUxFVEU6CiAgICAgICAgICAg\nICAgICAgICAgc20uY2FzY2FkZURlbGV0ZShjYWxsKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgT3BDYWxsYmFj\na3MuT1BfUkVGUkVTSDoKICAgICAgICAgICAgICAgICAgICBzbS5nYXRoZXJD\nYXNjYWRlUmVmcmVzaChjYWxsKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKFN0cmluZy52YWx1ZU9m\nKG9wKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxs\neSB7CiAgICAgICAgICAgIHNtLnJlbGVhc2UodHJ1ZSk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGRlbGV0ZUFsbChDb2xsZWN0aW9uIG9i\nanMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRXcml0\nZU9wZXJhdGlvbigpOwoKICAgICAgICAgICAgTGlzdCBleGNlcHMgPSBudWxs\nOwogICAgICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAob2Jq\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZShvYmos\nIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKSwgY2FsbCk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAg\nICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93\nTmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsZXRlKE9iamVjdCBvYmosIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVy\nYXRpb24oKTsKICAgICAgICAgICAgZGVsZXRlKG9iaiwgZ2V0U3RhdGVNYW5h\nZ2VySW1wbChvYmosIHRydWUpLCBjYWxsKTsKICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwog\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIGRlbGV0ZS4K\nICAgICAqLwogICAgdm9pZCBkZWxldGUoT2JqZWN0IG9iaiwgU3RhdGVNYW5h\nZ2VySW1wbCBzbSwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmICgh\nX29wZXJhdGluZy5hZGQob2JqKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tz\nLk9QX0RFTEVURSwgb2JqLCBzbSwgY2FsbCk7CiAgICAgICAgaWYgKGFjdGlv\nbiA9PSBPcENhbGxiYWNrcy5BQ1RfTk9ORSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAvLyBBQ1RfQ0FTQ0FERQogICAgICAgIGlmICgoYWN0aW9u\nICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkgewogICAgICAgICAgICBp\nZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVEZWxl\ndGUoY2FsbCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNh\nc2NhZGVUcmFuc2llbnQoT3BDYWxsYmFja3MuT1BfREVMRVRFLCBvYmosIGNh\nbGwsICJkZWxldGUiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nCiAgICAgICAgLy8gQUNUX1JVTgogICAgICAgIGlmIChzbSAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJkZWxldGUi\nKTsKICAgICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1Rf\nQ0FTQ0FERSkgIT0gMCkKICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVEZWxl\ndGUoY2FsbCk7CiAgICAgICAgICAgIHNtLmRlbGV0ZSgpOwogICAgICAgIH0g\nZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaikucGNJc0Rl\ndGFjaGVkKCkgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICB0aHJvdyBu\nZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJkZWxldGUiKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRocm93IGFuIGV4Y2VwdGlvbiBpbmRpY2F0aW5nIHRo\nYXQgdGhlIGN1cnJlbnQgYWN0aW9uIGNhbid0IGJlCiAgICAgKiBwZXJmb3Jt\nZWQgb24gYSBkZXRhY2hlZCBvYmplY3QuCiAgICAgKi8KICAgIHByaXZhdGUg\nT3BlbkpQQUV4Y2VwdGlvbiBuZXdEZXRhY2hlZEV4Y2VwdGlvbihPYmplY3Qg\nb2JqLAogICAgICAgIFN0cmluZyBvcGVyYXRpb24pIHsKICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWRldGFjaGVkLW9w\nIiwgb3BlcmF0aW9uLAogICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5n\nKG9iaikpKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCByZWxlYXNlQWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICByZWxlYXNlKGl0ci5uZXh0KCksIGNhbGwpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewog\nICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0\naHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbGVhc2UoT2JqZWN0IG9i\naiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlv\nbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsK\nICAgICAgICAgICAgaW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChPcENh\nbGxiYWNrcy5PUF9SRUxFQVNFLCBvYmosIHNtLCBjYWxsKTsKCiAgICAgICAg\nICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4p\nICE9IDAgJiYgc20uaXNQZXJzaXN0ZW50KCkpIHsKICAgICAgICAgICAgICAg\nIGJvb2xlYW4gcGVuZGluZyA9IHNtLmlzUGVuZGluZ1RyYW5zYWN0aW9uYWwo\nKTsKICAgICAgICAgICAgICAgIHNtLnJlbGVhc2UodHJ1ZSk7CiAgICAgICAg\nICAgICAgICBpZiAocGVuZGluZykKICAgICAgICAgICAgICAgICAgICByZW1v\ndmVGcm9tUGVuZGluZ1RyYW5zYWN0aW9uKHNtKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZW1iZWQoT2JqZWN0IG9iaiwgT2Jq\nZWN0IGlkLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb3duZXIsIFZh\nbHVlTWV0YURhdGEgb3duZXJNZXRhKSB7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBvcmlnID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUp\nOwogICAgICAgICAgICBpZiAob3JpZyAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAvLyBpZiBhbHJlYWR5IGVtYmVkZGVkLCBub3RoaW5nIHRvIGRvCiAg\nICAgICAgICAgICAgICBpZiAob3JpZy5nZXRPd25lcigpID09IG93bmVyICYm\nIG9yaWcuZ2V0TWV0YURhdGEoKS4KICAgICAgICAgICAgICAgICAgICBnZXRF\nbWJlZGRpbmdNZXRhRGF0YSgpID09IG93bmVyTWV0YSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gb3JpZzsKCiAgICAgICAgICAgICAgICAvLyBvdGhl\ncndpc2UgbWFrZSBzdXJlIHBjIGlzIGZ1bGx5IGxvYWRlZCBmb3Igd2hlbiB3\nZSBjb3B5IGl0cwogICAgICAgICAgICAgICAgLy8gZGF0YSBiZWxvdwogICAg\nICAgICAgICAgICAgb3JpZy5sb2FkKF9mYywgU3RhdGVNYW5hZ2VySW1wbC5M\nT0FEX0FMTCwgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBjcmVhdGUgbmV3IHN0YXRlIG1hbmFnZXIgd2l0aCBl\nbWJlZGRlZCBtZXRhZGF0YQogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGEgPSBvd25lck1ldGEuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpOwogICAgICAg\nICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZW1iZWQiLCBv\nd25lck1ldGEpKTsKCiAgICAgICAgICAgIGlmIChpZCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgaWQgPSBTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0\naGlzKTsKCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBuZXcg\nU3RhdGVNYW5hZ2VySW1wbChpZCwgbWV0YSwgdGhpcyk7CiAgICAgICAgICAg\nIHNtLnNldE93bmVyKChTdGF0ZU1hbmFnZXJJbXBsKSBvd25lciwgb3duZXJN\nZXRhKTsKCiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBjb3B5Owog\nICAgICAgICAgICBQQ1N0YXRlIHN0YXRlOwogICAgICAgICAgICBDbGFzcyB0\neXBlID0gbWV0YS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAgICAgIGlm\nICh0eXBlLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAgICAgICB0eXBlID0g\nbWV0YS5nZXRJbnRlcmZhY2VJbXBsKCk7CiAgICAgICAgICAgIGlmIChvYmog\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gZ2l2ZSBjb3B5IGFuZCB0\naGUgb3JpZ2luYWwgaW5zdGFuY2UgdGhlIHNhbWUgc3RhdGUgbWFuYWdlcgog\nICAgICAgICAgICAgICAgLy8gc28gdGhhdCB3ZSBjYW4gY29weSBmaWVsZHMg\nZnJvbSBvbmUgdG8gdGhlIG90aGVyCiAgICAgICAgICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIGNvcHlTTTsKICAgICAgICAgICAgICAgIFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYzsKICAgICAgICAgICAgICAgIGlmIChvcmlnID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICBjb3B5U00gPSBzbTsKICAgICAgICAg\nICAgICAgICAgICBwYyA9IGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmop\nOwogICAgICAgICAgICAgICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdl\ncihzbSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgIGNvcHlTTSA9IG9yaWc7CiAgICAgICAgICAgICAgICAgICAgcGMg\nPSBvcmlnLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgLy8gY29weSB0aGUgaW5zdGFuY2UuICB3ZSBkbyB0aGlzIGV2ZW4gaWYg\naXQgZG9lc24ndCBhbHJlYWR5CiAgICAgICAgICAgICAgICAgICAgLy8gaGF2\nZSBhIHN0YXRlIG1hbmFnZXIgaW4gY2FzZSBpdCBpcyBsYXRlciBhc3NpZ25l\nZCB0byBhCiAgICAgICAgICAgICAgICAgICAgLy8gUEMgZmllbGQ7IGF0IHRo\nYXQgcG9pbnQgaXQncyB0b28gbGF0ZSB0byBjb3B5CiAgICAgICAgICAgICAg\nICAgICAgY29weSA9IFBDUmVnaXN0cnkubmV3SW5zdGFuY2UodHlwZSwgY29w\neVNNLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgaW50W10gZmllbGRz\nID0gbmV3IGludFttZXRhLmdldEZpZWxkcygpLmxlbmd0aF07CiAgICAgICAg\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkc1tpXSA9IGk7\nCiAgICAgICAgICAgICAgICAgICAgY29weS5wY0NvcHlGaWVsZHMocGMsIGZp\nZWxkcyk7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBQQ1N0YXRlLkVD\nT1BZOwogICAgICAgICAgICAgICAgICAgIGNvcHkucGNSZXBsYWNlU3RhdGVN\nYW5hZ2VyKG51bGwpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgaW5zdGFuY2UgZGlkbid0IGhh\ndmUgYSBzdGF0ZSBtYW5hZ2VyIHRvIHN0YXJ0LAogICAgICAgICAgICAgICAg\nICAgIC8vIHJldmVydCBpdCB0byBiZWluZyB0cmFuc2llbnQKICAgICAgICAg\nICAgICAgICAgICBpZiAob3JpZyA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIobnVsbCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICBjb3B5ID0gUENSZWdpc3RyeS5uZXdJbnN0YW5jZSh0eXBlLCBzbSwg\nZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FD\nVElWRSkgIT0gMCAmJiAhX29wdGltaXN0aWMpCiAgICAgICAgICAgICAgICAg\nICAgc3RhdGUgPSBQQ1N0YXRlLkVDTEVBTjsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IFBDU3RhdGUuRU5PTlRS\nQU5TOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzbS5pbml0aWFsaXpl\nKGNvcHksIHN0YXRlKTsKICAgICAgICAgICAgcmV0dXJuIHNtOwogICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\ndGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihy\nZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYgbm90\nIGFscmVhZHkgY2FjaGVkLCBjcmVhdGUgYW4gZW1wdHkgY29weSBvZiB0aGUg\nZ2l2ZW4gc3RhdGUKICAgICAqIG1hbmFnZXIgaW4gdGhlIGdpdmVuIHN0YXRl\nLgogICAgICovCiAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIGNvcHkoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBjb3B5LCBQQ1N0YXRlIHN0YXRlKSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBPYmplY3Qgb2lkID0gY29w\neS5mZXRjaE9iamVjdElkKCk7CiAgICAgICAgICAgIENsYXNzIHR5cGUgPSBj\nb3B5LmdldE1hbmFnZWRJbnN0YW5jZSgpLmdldENsYXNzKCk7CiAgICAgICAg\nICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICAvLyBjYWNoZWQg\naW5zdGFuY2U/CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBu\ndWxsOwogICAgICAgICAgICBpZiAoIWNvcHkuaXNFbWJlZGRlZCgpKQogICAg\nICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChvaWQs\nIHRydWUpOwogICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zID0gX2NvbmYuCiAg\nICAgICAgICAgICAgICAgICAgZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFu\nY2UoKTsKICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IHJl\ncG9zLmdldE1ldGFEYXRhKHR5cGUsIF9sb2FkZXIsIHRydWUpOwogICAgICAg\nICAgICAgICAgLy8gY29uc3RydWN0IGEgbmV3IHN0YXRlIG1hbmFnZXIgd2l0\naCBhbGwgaW5mbyBrbm93bgogICAgICAgICAgICAgICAgc20gPSBuZXcgU3Rh\ndGVNYW5hZ2VySW1wbChvaWQsIG1ldGEsIHRoaXMpOwogICAgICAgICAgICAg\nICAgc20uc2V0T2JqZWN0SWQob2lkKTsKICAgICAgICAgICAgICAgIHNtLmlu\naXRpYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCks\nIHN0YXRlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc207\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlZnJlc2hB\nbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICBnYXRoZXJDYXNjYWRl\nUmVmcmVzaChpdHIubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAgaWYgKF9v\ncGVyYXRpbmcuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICBpZiAoX29wZXJhdGluZy5zaXplKCkgPT0gMSkKICAgICAg\nICAgICAgICAgIHJlZnJlc2hJbnRlcm5hbChfb3BlcmF0aW5nLml0ZXJhdG9y\nKCkubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgcmVmcmVzaEludGVybmFsKF9vcGVyYXRpbmcsIGNhbGwpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWZyZXNoKE9iamVj\ndCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nTm9udHJhbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAgICAgICAgIGdhdGhlckNh\nc2NhZGVSZWZyZXNoKG9iaiwgY2FsbCk7CiAgICAgICAgICAgIGlmIChfb3Bl\ncmF0aW5nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgaWYgKF9vcGVyYXRpbmcuc2l6ZSgpID09IDEpCiAgICAgICAg\nICAgICAgICByZWZyZXNoSW50ZXJuYWwoX29wZXJhdGluZy5pdGVyYXRvcigp\nLm5leHQoKSwgY2FsbCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIHJlZnJlc2hJbnRlcm5hbChfb3BlcmF0aW5nLCBjYWxsKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHYXRoZXJzIGFsbCBvYmpl\nY3RzIHJlYWNoYWJsZSB0aHJvdWdoIGNhc2NhZGUtcmVmcmVzaCByZWxhdGlv\nbnMKICAgICAqIGludG8gdGhlIG9wZXJhdGluZyBzZXQuCiAgICAgKi8KICAg\nIHZvaWQgZ2F0aGVyQ2FzY2FkZVJlZnJlc2goT2JqZWN0IG9iaiwgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIGlmICghX29wZXJhdGluZy5hZGQob2Jq\nKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBTdGF0ZU1hbmFnZXJJ\nbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIGZhbHNlKTsKICAg\nICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tz\nLk9QX1JFRlJFU0gsIG9iaiwgc20sIGNhbGwpOwogICAgICAgIGlmICgoYWN0\naW9uICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUpID09IDApCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgaWYgKHNtICE9IG51bGwpCiAgICAgICAg\nICAgIHNtLmdhdGhlckNhc2NhZGVSZWZyZXNoKGNhbGwpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgY2FzY2FkZVRyYW5zaWVudChPcENhbGxiYWNrcy5P\nUF9SRUZSRVNILCBvYmosIGNhbGwsICJyZWZyZXNoIik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2l0aCB0aGUgZnVs\nbCBzZXQgb2Ygb2JqZWN0cyByZWFjaGFibGUgdmlhCiAgICAgKiBjYXNjYWRl\nLXJlZnJlc2ggcmVsYXRpb25zIGZyb20gdGhlIHVzZXItZ2l2ZW4gaW5zdGFu\nY2VzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZWZyZXNoSW50ZXJu\nYWwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIGNvbGxlY3QgaW5zdGFuY2VzIHRoYXQgbmVlZCBhIHJlZnJlc2gK\nICAgICAgICAgICAgQ29sbGVjdGlvbiBsb2FkID0gbnVsbDsKICAgICAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgT2JqZWN0IG9i\najsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBvYmog\nPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1h\nbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfUkVGUkVTSCwgb2Jq\nLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICAgICAgICAgJiBPcENhbGxi\nYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHNtICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFj\naGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2giKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgZWxzZSBpZiAoc20uYmVmb3JlUmVmcmVzaCh0cnVlKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWQgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkID0gbmV3IEFy\ncmF5TGlzdChvYmpzLnNpemUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBsb2FkLmFkZChzbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFzc2VydFBlcnNpc3Rl\nbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRhY2hlZCgpCiAgICAgICAgICAgICAg\nICAgICAgICAgID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmVmcmVz\naCIpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNl\ncHMsIGtlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gcmVmcmVzaCBhbGwKICAgICAgICAgICAgaWYgKGxvYWQg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgQ29sbGVjdGlvbiBmYWlsZWQg\nPSBfc3RvcmUubG9hZEFsbChsb2FkLCBudWxsLAogICAgICAgICAgICAgICAg\nICAgIFN0b3JlTWFuYWdlci5GT1JDRV9MT0FEX1JFRlJFU0gsIF9mYywgbnVs\nbCk7CiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZh\naWxlZC5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0g\nYWRkKGV4Y2VwcywgbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFpbGVk\nKSk7CgogICAgICAgICAgICAgICAgLy8gcGVyZm9ybSBwb3N0LXJlZnJlc2gg\ndHJhbnNpdGlvbnMgYW5kIG1ha2Ugc3VyZSBhbGwgZmV0Y2gKICAgICAgICAg\nICAgICAgIC8vIGdyb3VwIGZpZWxkcyBhcmUgbG9hZGVkCiAgICAgICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGxvYWQuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBzbSA9IChTdGF0\nZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChmYWlsZWQgIT0gbnVsbCAmJiBmYWlsZWQuY29udGFpbnMoc20uZ2V0\nSWQoKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAg\nICBzbS5hZnRlclJlZnJlc2goKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nc20ubG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIG51bGws\nIG51bGwsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UpOwog\nICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4\nY2Vwcywga2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbm93IGludm9r\nZSBwb3N0UmVmcmVzaCBvbiBhbGwgdGhlIGluc3RhbmNlcwogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKGl0ci5uZXh0KCks\nIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxsICYm\nICFzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZp\ncmVMaWZlY3ljbGVFdmVudChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgbnVs\nbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtLmdldE1ldGFEYXRh\nKCksIExpZmVjeWNsZUV2ZW50LkFGVEVSX1JFRlJFU0gpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGtlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAg\nfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIE9wdGltaXphdGlvbiBmb3Igc2lu\nZ2xlLW9iamVjdCByZWZyZXNoLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCByZWZyZXNoSW50ZXJuYWwoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAg\nICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JF\nRlJFU0gsIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2Fs\nbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47\nCgogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZyZXNoIik7CiAg\nICAgICAgICAgICAgICBlbHNlIGlmIChzbS5iZWZvcmVSZWZyZXNoKGZhbHNl\nKSkgewogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBTdGF0ZU1h\nbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICAgICAgc20uYWZ0ZXJSZWZyZXNoKCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCksIG51bGwsCiAgICAgICAgICAgICAgICAg\nICAgc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQuQUZURVJfUkVG\nUkVTSCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVu\nY2VDYXBhYmxlKG9iaikucGNJc0RldGFjaGVkKCkKICAgICAgICAgICAgICAg\nID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgIHRocm93IG5ld0Rl\ndGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2giKTsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93\nIGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZXRyaWV2ZUFsbChD\nb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gZGZnT25seSwKICAgICAgICBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKG9ianMuc2l6ZSgpID09\nIDEpIHsKICAgICAgICAgICAgcmV0cmlldmUob2Jqcy5pdGVyYXRvcigpLm5l\neHQoKSwgZGZnT25seSwgY2FsbCk7CiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CgogICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICBi\nZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0\naW9uYWxSZWFkKCk7CgogICAgICAgICAgICAvLyBjb2xsZWN0IGFsbCBob2xs\nb3cgaW5zdGFuY2VzIGZvciBsb2FkCiAgICAgICAgICAgIE9iamVjdCBvYmo7\nCiAgICAgICAgICAgIENvbGxlY3Rpb24gbG9hZCA9IG51bGw7CiAgICAgICAg\nICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAgIENvbGxlY3Rp\nb24gc21zID0gbmV3IEFycmF5TGlzdChvYmpzLnNpemUoKSk7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgb2JqID0gaXRyLm5leHQo\nKTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChv\nYmosIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmICgocHJvY2Vzc0Fy\nZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFVFJJRVZFLCBvYmosIHNtLCBjYWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9S\nVU4pID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRp\nb24ob2JqLCAicmV0cmlldmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKHNtLmlzUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBzbXMuYWRkKHNtKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xMT1cpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2Fk\nID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxvYWQuYWRkKHNtKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9i\naikucGNJc0RldGFjaGVkKCkKICAgICAgICAgICAgICAgICAgICAgICAgPT0g\nQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZXRyaWV2ZSIpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAgICAg\nICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbG9h\nZCBhbGwgaG9sbG93IGluc3RhbmNlcwogICAgICAgICAgICBDb2xsZWN0aW9u\nIGZhaWxlZCA9IG51bGw7CiAgICAgICAgICAgIGlmIChsb2FkICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGludCBtb2RlID0gKGRmZ09ubHkpID8gX3N0\nb3JlLkZPUkNFX0xPQURfREZHCiAgICAgICAgICAgICAgICAgICAgOiBfc3Rv\ncmUuRk9SQ0VfTE9BRF9BTEw7CiAgICAgICAgICAgICAgICBmYWlsZWQgPSBf\nc3RvcmUubG9hZEFsbChsb2FkLCBudWxsLCBtb2RlLCBfZmMsIG51bGwpOwog\nICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmICFmYWlsZWQu\naXNFbXB0eSgpKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChl\neGNlcHMsIG5ld09iamVjdE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCkpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyByZXRyaWV2ZSBhbGwgbm9u\nLWZhaWxlZCBpbnN0YW5jZXMKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBzbXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgZmFpbGVk\nLmNvbnRhaW5zKHNtLmdldElkKCkpKQogICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgICAgIGludCBtb2RlID0gKGRmZ09ubHkp\nID8gU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUwogICAgICAgICAgICAgICAg\nICAgIDogU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0FMTDsKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc20uYmVmb3JlUmVhZCgt\nMSk7CiAgICAgICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIG1vZGUsIG51\nbGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAgICAgICBleGNl\ncHMgPSBhZGQoZXhjZXBzLCBrZSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdl\nbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgICAgICB0aHJv\nd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgcmV0cmlldmUoT2JqZWN0IG9iaiwgYm9vbGVhbiBkZmdP\nbmx5LCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQo\nKTsKCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0\nZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJv\nY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFVFJJRVZFLCBvYmosIHNt\nLCBjYWxsKQogICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVO\nKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAg\naWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChzbS5pc0Rl\ndGFjaGVkKCkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNo\nZWRFeGNlcHRpb24ob2JqLCAicmV0cmlldmUiKTsKICAgICAgICAgICAgICAg\nIGlmIChzbS5pc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICAgICAgICAg\nIGludCBtb2RlID0gKGRmZ09ubHkpID8gU3RhdGVNYW5hZ2VySW1wbC5MT0FE\nX0ZHUwogICAgICAgICAgICAgICAgICAgICAgICA6IFN0YXRlTWFuYWdlcklt\ncGwuTE9BRF9BTEw7CiAgICAgICAgICAgICAgICAgICAgc20uYmVmb3JlUmVh\nZCgtMSk7CiAgICAgICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIG1vZGUs\nIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSBlbHNlIGlmIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2Jq\nKS5wY0lzRGV0YWNoZWQoKQogICAgICAgICAgICAgICAgPT0gQm9vbGVhbi5U\nUlVFKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRp\nb24ob2JqLCAicmV0cmlldmUiKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBldmljdEFsbChPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIGV2aWN0IGFsbCBQQ2xlYW4gYW5kIFBO\nb25UcmFucyBvYmplY3RzCiAgICAgICAgICAgIENvbGxlY3Rpb24gYyA9IGdl\ndE1hbmFnZWRTdGF0ZXMoKTsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1w\nbCBzbTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBjLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBzbSA9\nIChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICAg\nICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpICYmICFzbS5pc0RpcnR5KCkpCiAg\nICAgICAgICAgICAgICAgICAgZXZpY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNl\nKCksIGNhbGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgZXZpY3RBbGwoQ29sbGVjdGlvbiBv\nYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgTGlzdCBleGNlcHMg\nPSBudWxsOwogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZXZpY3QoaXRyLm5leHQoKSwg\nY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9u\nIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vw\ncywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMs\nIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBldmljdEFsbChFeHRl\nbnQgZXh0ZW50LCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKGV4\ndGVudCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICAvLyBldmljdCBhbGwgUENsZWFuIGFuZCBQTm9uVHJhbnMgb2JqZWN0cyBp\nbiBleHRlbnQKICAgICAgICAgICAgQ29sbGVjdGlvbiBjID0gZ2V0TWFuYWdl\nZFN0YXRlcygpOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwog\nICAgICAgICAgICBDbGFzcyBjbHM7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gYy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQo\nKTsKICAgICAgICAgICAgICAgIGlmIChzbS5pc1BlcnNpc3RlbnQoKSAmJiAh\nc20uaXNEaXJ0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAgY2xzID0gc20u\nZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGNscyA9PSBleHRlbnQuZ2V0RWxlbWVudFR5cGUoKQog\nICAgICAgICAgICAgICAgICAgICAgICB8fCAoZXh0ZW50Lmhhc1N1YmNsYXNz\nZXMoKQogICAgICAgICAgICAgICAgICAgICAgICAmJiBleHRlbnQuZ2V0RWxl\nbWVudFR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tKGNscykpKQogICAgICAgICAg\nICAgICAgICAgICAgICBldmljdChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwg\nY2FsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZXZpY3QoT2JqZWN0IG9i\naiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlv\nbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsK\nICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3Mu\nT1BfRVZJQ1QsIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9w\nQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICAgICAgc20uZXZpY3QoKTsKICAgICAgICAg\nICAgaWYgKF9ldmljdERhdGFDYWNoZSAmJiBzbS5nZXRPYmplY3RJZCgpICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIERhdGFDYWNoZSBjYWNoZSA9IHNt\nLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgICAgICAg\nICBpZiAoY2FjaGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjYWNo\nZS5yZW1vdmUoc20uZ2V0T2JqZWN0SWQoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZGV0YWNoKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIGlmIChjYWxsID09IG51bGwpCiAgICAgICAgICAg\nIGNhbGwgPSBfY2FsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBEZXRhY2hN\nYW5hZ2VyKHRoaXMsIGZhbHNlLCBjYWxsKS5kZXRhY2gob2JqKTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10g\nZGV0YWNoQWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIGlmIChvYmpzID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIGlmIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgcmV0dXJuIEVNUFRZX09CSkVDVFM7CiAgICAgICAgaWYgKGNhbGwgPT0g\nbnVsbCkKICAgICAgICAgICAgY2FsbCA9IF9jYWxsOwoKICAgICAgICBiZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nZXR1cm4gbmV3IERldGFjaE1hbmFnZXIodGhpcywgZmFsc2UsIGNhbGwpLmRl\ndGFjaEFsbChvYmpzKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBkZXRhY2hBbGwoT3BDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIGRldGFjaEFsbChjYWxsLCB0cnVlKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBkZXRhY2hBbGwoT3BDYWxsYmFja3MgY2FsbCwgYm9vbGVh\nbiBmbHVzaCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIElmIGEgZmx1c2ggaXMgZGVzaXJl\nZCAoYmFzZWQgb24gaW5wdXQgcGFybSksIHRoZW4gY2hlY2sgaWYgdGhlCiAg\nICAgICAgICAgIC8vICAgImRpcnR5IiBmbGFnIGlzIHNldCBiZWZvcmUgY2Fs\nbGluZyBmbHVzaCgpLgogICAgICAgICAgICBpZiAoKGZsdXNoKSAmJiAoKF9m\nbGFncyAmIEZMQUdfRkxVU0hfUkVRVUlSRUQpICE9IDApKQogICAgICAgICAg\nICAgICAgZmx1c2goKTsKICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwo\nY2FsbCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIGRldGFjaEFsbEludGVybmFsKE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBDb2xsZWN0aW9uIHN0YXRlcyA9IGdldE1hbmFnZWRTdGF0\nZXMoKTsKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gc3RhdGVzLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwp\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmICghc20uaXNQZXJzaXN0ZW50\nKCkpCiAgICAgICAgICAgICAgICBpdHIucmVtb3ZlKCk7CiAgICAgICAgICAg\nIGVsc2UgaWYgKCFzbS5nZXRNZXRhRGF0YSgpLmlzRGV0YWNoYWJsZSgpKSB7\nCiAgICAgICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOwogICAgICAgICAg\nICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGlmIChzdGF0ZXMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGlmIChjYWxsID09IG51bGwpCiAgICAgICAgICAgIGNh\nbGwgPSBfY2FsbDsKICAgICAgICBuZXcgRGV0YWNoTWFuYWdlcih0aGlzLCB0\ncnVlLCBjYWxsKS5kZXRhY2hBbGwKICAgICAgICAgICAgKG5ldyBNYW5hZ2Vk\nT2JqZWN0Q29sbGVjdGlvbihzdGF0ZXMpKTsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGF0dGFjaChPYmplY3Qgb2JqLCBib29sZWFuIGNvcHlOZXcsIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgbm90IHRvIHRyeSB0byBzZXQgcm9sbGJhY2sgb25seSBpZiB0aGlzIGZh\naWxzCiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEF0dGFj\naE1hbmFnZXIodGhpcywgY29weU5ldywgY2FsbCkuYXR0YWNoKG9iaik7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKE9wdGltaXN0aWNFeGNlcHRpb24gb2UpIHsK\nICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seShvZSk7CiAgICAgICAg\nICAgICAgICB0aHJvdyBvZS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3RbXSBhdHRhY2hBbGwoQ29s\nbGVjdGlvbiBvYmpzLCBib29sZWFuIGNvcHlOZXcsCiAgICAgICAgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChvYmpzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX09CSkVDVFM7CgogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIG1ha2Ugc3VyZSBub3QgdG8gdHJ5IHRvIHNldCByb2xsYmFjayBv\nbmx5IGlmIHRoaXMgZmFpbHMKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVy\nYXRpb24oKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgQXR0YWNoTWFuYWdlcih0aGlzLCBjb3B5TmV3LCBjYWxsKS5h\ndHRhY2hBbGwob2Jqcyk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wdGltaXN0\naWNFeGNlcHRpb24gb2UpIHsKICAgICAgICAgICAgICAgIHNldFJvbGxiYWNr\nT25seShvZSk7CiAgICAgICAgICAgICAgICB0aHJvdyBvZS5zZXRGYXRhbCh0\ncnVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIG5vbnRyYW5zYWN0aW9uYWxBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgbm9udHJhbnNhY3Rpb25hbChpdHIubmV4dCgp\nLCBjYWxsKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRp\nb24gdWUpIHsKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLCB1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2Up\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBub250cmFu\nc2FjdGlvbmFsKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAg\nICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdl\nckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJn\ndW1lbnQoT3BDYWxsYmFja3MuT1BfTk9OVFJBTlNBQ1RJT05BTCwgb2JqLCBz\nbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JV\nTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\naWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgICAgICBzbS5ub250cmFuc2Fj\ndGlvbmFsKCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBH\nZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBNYWtlIHRoZSBnaXZlbiBpbnN0YW5jZXMgdHJhbnNhY3Rp\nb25hbC4KICAgICAqLwogICAgcHVibGljIHZvaWQgdHJhbnNhY3Rpb25hbEFs\nbChDb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gdXBkYXRlVmVyc2lvbiwKICAg\nICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKG9ianMu\nc2l6ZSgpID09IDEpIHsKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbChvYmpz\nLml0ZXJhdG9yKCkubmV4dCgpLCB1cGRhdGVWZXJzaW9uLCBjYWxsKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY29s\nbGVjdCBhbGwgaG9sbG93IGluc3RhbmNlcyBmb3IgbG9hZCwgYW5kIG1ha2Ug\ndW5tYW5hbmdlZAogICAgICAgICAgICAvLyBpbnN0YW5jZXMgdHJhbnNpZW50\nLXRyYW5zYWN0aW9uYWwKICAgICAgICAgICAgQ29sbGVjdGlvbiBsb2FkID0g\nbnVsbDsKICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhOwogICAgICAgICAgICBDb2xsZWN0aW9uIHNtcyA9IG5ldyBBcnJheUxp\nc3Qob2Jqcy5zaXplKCkpOwogICAgICAgICAgICBMaXN0IGV4Y2VwcyA9IG51\nbGw7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgb2Jq\nID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVN\nYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlm\nICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1RSQU5TQUNUSU9O\nQUwsIG9iaiwgc20sCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGwpICYg\nT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIGlmIChzbSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1hbmFnZSB0\ncmFuc2llbnQgaW5zdGFuY2UKICAgICAgICAgICAgICAgICAgICAgICAgbWV0\nYSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0\nQ2xhc3MoKSwgX2xvYWRlciwgdHJ1ZSk7CgogICAgICAgICAgICAgICAgICAg\nICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAoU3RhdGVNYW5hZ2VySWQubmV3SW5zdGFuY2UodGhp\ncyksIG1ldGEsIHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICBzbS5p\nbml0aWFsaXplKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgUENTdGF0ZS5UQ0xFQU4pOwogICAg\nICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc20uaXNQZXJzaXN0ZW50KCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNh\nY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgc21zLmFkZChzbSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzbS5nZXRQQ1N0YXRlKCkg\nPT0gUENTdGF0ZS5IT0xMT1cpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChsb2FkID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbG9hZCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGxvYWQuYWRkKHNtKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0Q2hl\nY2tWZXJzaW9uKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\ndXBkYXRlVmVyc2lvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNt\nLnNldFVwZGF0ZVZlcnNpb24odHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIF9mbGFncyB8PSBGTEFHX0ZMVVNIX1JFUVVJUkVEOyAvLyB2ZXJzaW9u\nIGNoZWNrL3VwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUp\nIHsKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1\nZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIGxvYWQgYWxsIGhvbGxvdyBpbnN0YW5jZXMKICAgICAgICAgICAg\nQ29sbGVjdGlvbiBmYWlsZWQgPSBudWxsOwogICAgICAgICAgICBpZiAobG9h\nZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmYWlsZWQgPSBfc3RvcmUu\nbG9hZEFsbChsb2FkLCBudWxsLCBfc3RvcmUuRk9SQ0VfTE9BRF9OT05FLAog\nICAgICAgICAgICAgICAgICAgIF9mYywgbnVsbCk7CiAgICAgICAgICAgICAg\nICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkpCiAg\nICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywKICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRpb24o\nZmFpbGVkKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRyYW5zYWN0\naW9uYWxTdGF0ZXNBbGwoc21zLCBmYWlsZWQsIGV4Y2Vwcyk7CiAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0\naHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJl\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHRo\nZSBnaXZlbiBpbnN0YW5jZXMgdHJhbnNhY3Rpb25hbC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgdHJhbnNhY3Rpb25hbChPYmplY3Qgb2JqLCBib29sZWFu\nIHVwZGF0ZVZlcnNpb24sCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewog\nICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5h\nZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAoKHByb2Nlc3NB\ncmd1bWVudChPcENhbGxiYWNrcy5PUF9UUkFOU0FDVElPTkFMLCBvYmosIHNt\nLCBjYWxsKQogICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVO\nKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAg\naWYgKHNtICE9IG51bGwgJiYgc20uaXNQZXJzaXN0ZW50KCkpIHsKICAgICAg\nICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CiAgICAgICAg\nICAgICAgICBzbS50cmFuc2FjdGlvbmFsKCk7CiAgICAgICAgICAgICAgICBz\nbS5sb2FkKF9mYywgU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUywgbnVsbCwg\nbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgc20uc2V0Q2hlY2tWZXJz\naW9uKHRydWUpOwogICAgICAgICAgICAgICAgaWYgKHVwZGF0ZVZlcnNpb24p\nCiAgICAgICAgICAgICAgICAgICAgc20uc2V0VXBkYXRlVmVyc2lvbih0cnVl\nKTsKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0ZMVVNIX1JFUVVJ\nUkVEOyAvLyB2ZXJzaW9uIGNoZWNrL3VwCiAgICAgICAgICAgIH0gZWxzZSBp\nZiAoc20gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gbWFuYWdlIHRy\nYW5zaWVudCBpbnN0YW5jZQogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2Uo\nKS4KICAgICAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0Q2xh\nc3MoKSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBPYmplY3Qg\naWQgPSBTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0aGlzKTsKICAgICAg\nICAgICAgICAgIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwoaWQsIG1ldGEs\nIHRoaXMpOwogICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShhc3NlcnRQ\nZXJzaXN0ZW5jZUNhcGFibGUob2JqKSwKICAgICAgICAgICAgICAgICAgICBQ\nQ1N0YXRlLlRDTEVBTik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\ndGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihy\nZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNp\ndGlvbiB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlcnMgdG8gdHJhbnNhY3Rpb25h\nbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHRyYW5zYWN0aW9uYWxTdGF0\nZXNBbGwoQ29sbGVjdGlvbiBzbXMsIENvbGxlY3Rpb24gZmFpbGVkLAogICAg\nICAgIExpc3QgZXhjZXBzKSB7CiAgICAgICAgLy8gbWFrZSBpbnN0YW5jZXMg\ndHJhbnNhY3Rpb25hbCBhbmQgbWFrZSBzdXJlIHRoZXkgYXJlIGxvYWRlZAog\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBzbXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQo\nKTsKICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmIGZhaWxlZC5j\nb250YWlucyhzbS5nZXRJZCgpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHNtLnRyYW5z\nYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBTdGF0\nZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBudWxsLCBmYWxzZSk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGtlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlv\nbnMoZXhjZXBzLCBmYWxzZSk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8KICAgIC8vIEV4dGVudCwgUXVlcnkKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nCgogICAgcHVibGljIEV4dGVudCBuZXdFeHRlbnQoQ2xhc3MgdHlwZSwgYm9v\nbGVhbiBzdWJjbGFzc2VzKSB7CiAgICAgICAgcmV0dXJuIG5ld0V4dGVudCh0\neXBlLCBzdWJjbGFzc2VzLCBudWxsKTsKICAgIH0KCiAgICBwcml2YXRlIEV4\ndGVudCBuZXdFeHRlbnQoQ2xhc3MgdHlwZSwgYm9vbGVhbiBzdWJjbGFzc2Vz\nLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIEV4dGVudEltcGwgZXh0ZW50ID0gbmV3IEV4dGVudEltcGwodGhpcywg\ndHlwZSwgc3ViY2xhc3NlcywgZmV0Y2gpOwogICAgICAgICAgICBpZiAoX2V4\ndGVudHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9leHRlbnRzID0gbmV3\nIFJlZmVyZW5jZUhhc2hTZXQoUmVmZXJlbmNlSGFzaFNldC5XRUFLKTsKICAg\nICAgICAgICAgX2V4dGVudHMuYWRkKGV4dGVudCk7CgogICAgICAgICAgICBy\nZXR1cm4gZXh0ZW50OwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBJdGVyYXRvciBleHRlbnRJdGVyYXRvcihDbGFzcyB0eXBl\nLCBib29sZWFuIHN1YmNsYXNzZXMsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLCBib29sZWFuIGlnbm9yZUNoYW5nZXMpIHsKICAgICAgICBF\neHRlbnQgZXh0ZW50ID0gbmV3RXh0ZW50KHR5cGUsIHN1YmNsYXNzZXMsIGZl\ndGNoKTsKICAgICAgICBleHRlbnQuc2V0SWdub3JlQ2hhbmdlcyhpZ25vcmVD\naGFuZ2VzKTsKICAgICAgICByZXR1cm4gZXh0ZW50Lml0ZXJhdG9yKCk7CiAg\nICB9CgogICAgcHVibGljIFF1ZXJ5IG5ld1F1ZXJ5KFN0cmluZyBsYW5nLCBD\nbGFzcyBjbHMsIE9iamVjdCBxdWVyeSkgewogICAgICAgIFF1ZXJ5IHEgPSBu\nZXdRdWVyeShsYW5nLCBxdWVyeSk7CiAgICAgICAgcS5zZXRDYW5kaWRhdGVU\neXBlKGNscywgdHJ1ZSk7CiAgICAgICAgcmV0dXJuIHE7CiAgICB9CgogICAg\ncHVibGljIFF1ZXJ5IG5ld1F1ZXJ5KFN0cmluZyBsYW5nLCBPYmplY3QgcXVl\ncnkpIHsKICAgICAgICAvLyBjb21tb24gbWlzdGFrZXMKICAgICAgICBpZiAo\ncXVlcnkgaW5zdGFuY2VvZiBFeHRlbnQgfHwgcXVlcnkgaW5zdGFuY2VvZiBD\nbGFzcykKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoImJhZC1uZXctcXVlcnkiKSk7CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdG9yZVF1\nZXJ5IHNxID0gX3N0b3JlLm5ld1F1ZXJ5KGxhbmcpOwogICAgICAgICAgICBp\nZiAoc3EgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgRXhwcmVzc2lvblBh\ncnNlciBlcCA9IFF1ZXJ5TGFuZ3VhZ2VzLnBhcnNlckZvckxhbmd1YWdlKGxh\nbmcpOwogICAgICAgICAgICAgICAgaWYgKGVwICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgc3EgPSBuZXcgRXhwcmVzc2lvblN0b3JlUXVlcnkoZXAp\nOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoUXVlcnlMYW5ndWFnZXMuTEFO\nR19NRVRIT0RRTC5lcXVhbHMobGFuZykpCiAgICAgICAgICAgICAgICAgICAg\nc3EgPSBuZXcgTWV0aG9kU3RvcmVRdWVyeSgpOwogICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRl\nZEV4Y2VwdGlvbihsYW5nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nUXVlcnkgcSA9IG5ld1F1ZXJ5SW1wbChsYW5nLCBzcSk7CiAgICAgICAgICAg\nIHEuc2V0SWdub3JlQ2hhbmdlcyhfaWdub3JlQ2hhbmdlcyk7CiAgICAgICAg\nICAgIGlmIChxdWVyeSAhPSBudWxsKQogICAgICAgICAgICAgICAgcS5zZXRR\ndWVyeShxdWVyeSk7CgogICAgICAgICAgICAvLyB0cmFjayBxdWVyaWVzCiAg\nICAgICAgICAgIGlmIChfcXVlcmllcyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgX3F1ZXJpZXMgPSBuZXcgUmVmZXJlbmNlSGFzaFNldChSZWZlcmVuY2VI\nYXNoU2V0LldFQUspOwogICAgICAgICAgICBfcXVlcmllcy5hZGQocSk7CiAg\nICAgICAgICAgIHJldHVybiBxOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHF1ZXJ5LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgUXVlcnlJbXBsIG5ld1F1ZXJ5SW1wbChTdHJp\nbmcgbGFuZywgU3RvcmVRdWVyeSBzcSkgewogICAgICAgIHJldHVybiBuZXcg\nUXVlcnlJbXBsKHRoaXMsIGxhbmcsIHNxKTsKICAgIH0KCiAgICBwdWJsaWMg\nU2VxIGdldElkZW50aXR5U2VxdWVuY2UoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgcmV0dXJuIGdldFNlcXVlbmNlKG1ldGEsIG51bGwp\nOwogICAgfQoKICAgIHB1YmxpYyBTZXEgZ2V0VmFsdWVTZXF1ZW5jZShGaWVs\nZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGdldFNlcXVl\nbmNlKGZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCksIGZtZCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXF1ZW5jZSBmb3IgdGhlIGdpdmVu\nIGNsYXNzIGFuZCBvcHRpb25hbCBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0\nZSBTZXEgZ2V0U2VxdWVuY2UoQ2xhc3NNZXRhRGF0YSBtZXRhLCBGaWVsZE1l\ndGFEYXRhIGZtZCkgewogICAgICAgIC8vIGdldCBzZXF1ZW5jZSBzdHJhdGVn\neSBmcm9tIG1ldGFkYXRhCiAgICAgICAgaW50IHN0cmF0ZWd5OwogICAgICAg\nIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgc3RyYXRlZ3kgPSBtZXRh\nLmdldElkZW50aXR5U3RyYXRlZ3koKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHN0cmF0ZWd5ID0gZm1kLmdldFZhbHVlU3RyYXRlZ3koKTsKCiAgICAg\nICAgLy8gd2UgY2FuIGhhbmRsZSBub24tbmF0aXZlIHN0cmF0ZWdpZXMgd2l0\naG91dCB0aGUgc3RvcmUgbWFuYWdlcgogICAgICAgIHN3aXRjaCAoc3RyYXRl\nZ3kpIHsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMuVVVJRF9I\nRVg6CiAgICAgICAgICAgICAgICByZXR1cm4gVVVJREhleFNlcS5nZXRJbnN0\nYW5jZSgpOwogICAgICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlE\nX1NUUklORzoKICAgICAgICAgICAgICAgIHJldHVybiBVVUlEU3RyaW5nU2Vx\nLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNhc2UgVmFsdWVTdHJhdGVn\naWVzLlNFUVVFTkNFOgogICAgICAgICAgICAgICAgU2VxdWVuY2VNZXRhRGF0\nYSBzbWQgPSAoZm1kID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgPyBt\nZXRhLmdldElkZW50aXR5U2VxdWVuY2VNZXRhRGF0YSgpCiAgICAgICAgICAg\nICAgICAgICAgOiBmbWQuZ2V0VmFsdWVTZXF1ZW5jZU1ldGFEYXRhKCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gc21kLmdldEluc3RhbmNlKF9sb2FkZXIp\nOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gdXNl\nIHN0b3JlIG1hbmFnZXIgZm9yIG5hdGl2ZSBzZXF1ZW5jZQogICAgICAgICAg\nICAgICAgaWYgKGZtZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nLy8gdGhpcyB3aWxsIHJldHVybiBhIHNlcXVlbmNlIGV2ZW4gZm9yIGFwcCBp\nZCBjbGFzc2VzLAogICAgICAgICAgICAgICAgICAgIC8vIHdoaWNoIGlzIHdo\nYXQgd2Ugd2FudCBmb3IgYmFja3dhcmRzLWNvbXBhdGliaWxpdHkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gX3N0b3JlLmdldERhdGFTdG9yZUlkU2Vx\ndWVuY2UobWV0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICByZXR1cm4gX3N0b3JlLmdldFZhbHVlU2VxdWVuY2UoZm1kKTsKICAgICAg\nICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8KICAgIC8vIExvY2tpbmcKICAg\nIC8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgbG9jayhPYmplY3Qgb2Jq\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOyAvLyBoYXZlIHRvIHN5bmMgb3IgbG9jayBsZXZlbCBhbHdheXMg\nTk9ORQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxvY2sob2JqLCBfZmMu\nZ2V0V3JpdGVMb2NrTGV2ZWwoKSwgX2ZjLmdldExvY2tUaW1lb3V0KCksIGNh\nbGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2Nr\nKE9iamVjdCBvYmosIGludCBsZXZlbCwgaW50IHRpbWVvdXQsIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rp\nb24oKTsKCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRT\ndGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgo\ncHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX0xPQ0ssIG9iaiwgc20s\nIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4p\nID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlm\nIChzbSA9PSBudWxsIHx8ICFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIF9sbS5sb2NrKHNtLCBsZXZl\nbCwgdGltZW91dCwgbnVsbCk7CiAgICAgICAgICAgIHNtLnJlYWRMb2NrZWQo\nbGV2ZWwsIGxldmVsKTsgLy8gdXNlIHNhbWUgbGV2ZWwgZm9yIGZ1dHVyZSB3\ncml0ZQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGxvY2tBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOyAvLyBo\nYXZlIHRvIHN5bmMgb3IgbG9jayBsZXZlbCBhbHdheXMgTk9ORQogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGxvY2tBbGwob2JqcywgX2ZjLmdldFdyaXRl\nTG9ja0xldmVsKCksIF9mYy5nZXRMb2NrVGltZW91dCgpLAogICAgICAgICAg\nICAgICAgY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGxvY2tBbGwoQ29sbGVjdGlvbiBvYmpzLCBpbnQgbGV2ZWwsIGludCB0\naW1lb3V0LAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBp\nZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICBpZiAob2Jqcy5zaXplKCkgPT0gMSkgewogICAgICAgICAgICBsb2NrKG9i\nanMuaXRlcmF0b3IoKS5uZXh0KCksIGxldmVsLCB0aW1lb3V0LCBjYWxsKTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNz\nZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIENvbGxlY3Rp\nb24gc21zID0gbmV3IEFycmF5TGlzdChvYmpzLnNpemUoKSk7CiAgICAgICAg\nICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc207CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgb2Jq\nID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAg\nICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAg\nICAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tz\nLk9QX0xPQ0ssIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAgICAg\nJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKHNtICE9IG51bGwg\nJiYgc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgICAgICAgICAgc21z\nLmFkZChzbSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9sbS5sb2Nr\nQWxsKHNtcywgbGV2ZWwsIHRpbWVvdXQsIG51bGwpOwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykKICAgICAgICAgICAgICAgICgoU3RhdGVNYW5hZ2VySW1wbCkgaXRy\nLm5leHQoKSkucmVhZExvY2tlZChsZXZlbCwgbGV2ZWwpOwogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vCiAgICAv\nLyBDb25uZWN0aW9uCiAgICAvLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBi\nb29sZWFuIGNhbmNlbEFsbCgpIHsKICAgICAgICAvLyB0aGlzIG1ldGhvZCBk\nb2VzIG5vdCBsb2NrLCBzaW5jZSB3ZSB3YW50IHRvIGFsbG93IGEgZGlmZmVy\nZW50CiAgICAgICAgLy8gdGhyZWFkIHRvIGJlIGFibGUgdG8gY2FuY2VsIG9u\nIGEgbG9ja2VkLXVwIHBlcnNpc3RlbmNlIG1hbmFnZXIKCiAgICAgICAgYXNz\nZXJ0T3BlbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIHdl\nJ3JlIGZsdXNoaW5nLCBoYXZlIHRvIHNldCByb2xsYmFjayBvbmx5IC0tIGRv\nIHRoaXMgYmVmb3JlIHdlCiAgICAgICAgICAgIC8vIGF0dGVtcHQgdG8gY2Fu\nY2VsLCBiZWNhdXNlIG90aGVyd2lzZSB0aGUgY2FuY2VsIG1pZ2h0IGNhc2Ug\ndGhlCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9uIHRvIGNvbXBsZXRlIGJl\nZm9yZSB3ZSBoYXZlIGEgY2hhbmNlIHRvIHNldCB0aGUKICAgICAgICAgICAg\nLy8gcm9sbGJhY2sgb25seSBmbGFnCiAgICAgICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19TVE9SRV9GTFVTSElORykgIT0gMCkKICAgICAgICAgICAgICAg\nIHNldFJvbGxiYWNrT25seUludGVybmFsKG5ldyBVc2VyRXhjZXB0aW9uKCkp\nOwogICAgICAgICAgICByZXR1cm4gX3N0b3JlLmNhbmNlbEFsbCgpOwogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldENv\nbm5lY3Rpb24oKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlm\nICghX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zCiAgICAgICAg\nICAgIChfY29uZi5PUFRJT05fREFUQVNUT1JFX0NPTk5FQ1RJT04pKQogICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5n\nZXQoImNvbm4tbm90LXN1cHBvcnRlZCIpKTsKCiAgICAgICAgcmV0dXJuIF9z\ndG9yZS5nZXRDbGllbnRDb25uZWN0aW9uKCk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaGFzQ29ubmVjdGlvbigpIHsKICAgICAgICBhc3NlcnRPcGVu\nKCk7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX1JFVEFJTkVEX0NP\nTk4pICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZWxsIHN0b3JlIHRv\nIHJldGFpbiBjb25uZWN0aW9uIGlmIHdlIGhhdmVuJ3QgYWxyZWFkeS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHJldGFpbkNvbm5lY3Rpb24oKSB7CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1JFVEFJTkVEX0NPTk4pID09IDAp\nIHsKICAgICAgICAgICAgX3N0b3JlLnJldGFpbkNvbm5lY3Rpb24oKTsKICAg\nICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVUQUlORURfQ09OTjsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZWxsIHN0b3JlIHRvIHJlbGVh\nc2UgY29ubmVjdGlvbiBpZiB3ZSBoYXZlIHJldGFpbmVkIG9uZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHJlbGVhc2VDb25uZWN0aW9uKCkgewogICAg\nICAgIGlmICgoX2ZsYWdzICYgRkxBR19SRVRBSU5FRF9DT05OKSAhPSAwKSB7\nCiAgICAgICAgICAgIF9zdG9yZS5yZWxlYXNlQ29ubmVjdGlvbigpOwogICAg\nICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfUkVUQUlORURfQ09OTjsKICAgICAg\nICB9CiAgICB9CgogICAgLy8vLy8vLy8vCiAgICAvLyBDYWNoZQogICAgLy8v\nLy8vLy8vCgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0TWFuYWdlZE9iamVj\ndHMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWFuYWdlZE9iamVjdENv\nbGxlY3Rpb24oZ2V0TWFuYWdlZFN0YXRlcygpKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0VHJhbnNhY3Rpb25hbE9i\namVjdHMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWFuYWdlZE9iamVj\ndENvbGxlY3Rpb24oZ2V0VHJhbnNhY3Rpb25hbFN0YXRlcygpKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0UGVuZGlu\nZ1RyYW5zYWN0aW9uYWxPYmplY3RzKCkgewogICAgICAgIGJlZ2luT3BlcmF0\naW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uCiAgICAgICAgICAgICAgICAo\nZ2V0UGVuZGluZ1RyYW5zYWN0aW9uYWxTdGF0ZXMoKSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldERpcnR5T2JqZWN0\ncygpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBNYW5hZ2VkT2JqZWN0Q29s\nbGVjdGlvbihnZXREaXJ0eVN0YXRlcygpKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gZ2V0T3JkZXJEaXJ0eU9iamVjdHMoKSB7\nCiAgICAgICAgcmV0dXJuIF9vcmRlckRpcnR5OwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldE9yZGVyRGlydHlPYmplY3RzKGJvb2xlYW4gb3JkZXIpIHsK\nICAgICAgICBfb3JkZXJEaXJ0eSA9IG9yZGVyOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgbWFuYWdlZCBzdGF0ZSBtYW5h\nZ2Vycy4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gZ2V0TWFu\nYWdlZFN0YXRlcygpIHsKICAgICAgICByZXR1cm4gX2NhY2hlLmNvcHkoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIHRy\nYW5zYWN0aW9uYWwgc3RhdGUgbWFuYWdlcnMuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBDb2xsZWN0aW9uIGdldFRyYW5zYWN0aW9uYWxTdGF0ZXMoKSB7CiAg\nICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQogICAgICAg\nICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKICAgICAgICBy\nZXR1cm4gX3RyYW5zQ2FjaGUuY29weSgpOwogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciBvciBub3QgdGhlcmUgYXJlIGFueSB0cmFuc2FjdGlvbmFs\nIG9iamVjdHMgaW4gdGhlIGN1cnJlbnQKICAgICAqIHBlcnNpc3RlbmNlIGNv\nbnRleHQuIElmIHRoZXJlIGFyZSBhbnkgaW5zdGFuY2VzIHdpdGggdW50cmFj\na2VkIHN0YXRlLAogICAgICogdGhpcyBtZXRob2Qgd2lsbCBjYXVzZSB0aG9z\nZSBpbnN0YW5jZXMgdG8gYmUgc2Nhbm5lZC4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIGhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkgewogICAgICAg\nIF9jYWNoZS5kaXJ0eUNoZWNrKCk7CiAgICAgICAgcmV0dXJuIF90cmFuc0Nh\nY2hlICE9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBj\nb3B5IG9mIGFsbCBkaXJ0eSBzdGF0ZSBtYW5hZ2Vycy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIENvbGxlY3Rpb24gZ2V0RGlydHlTdGF0ZXMoKSB7CiAgICAg\nICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQogICAgICAgICAg\nICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKCiAgICAgICAgcmV0\ndXJuIF90cmFuc0NhY2hlLmNvcHlEaXJ0eSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgc3RhdGUgbWFuYWdlcnMgd2hp\nY2ggd2lsbCBiZWNvbWUKICAgICAqIHRyYW5zYWN0aW9uYWwgdXBvbiB0aGUg\nbmV4dCB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxl\nY3Rpb24gZ2V0UGVuZGluZ1RyYW5zYWN0aW9uYWxTdGF0ZXMoKSB7CiAgICAg\nICAgaWYgKF9wZW5kaW5nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBD\nb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwogICAgICAgIHJldHVybiBuZXcgQXJy\nYXlMaXN0KF9wZW5kaW5nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgY2FjaGVkIFN0YXRlTWFuYWdlciBmb3IgdGhlIGluc3RhbmNlIHRoYXQg\naGFkIHRoZSBnaXZlbiBvaWQuCiAgICAgKiBUaGlzIG1ldGhvZCBtdXN0IG5v\ndCBiZSBjYWxsZWQgbXVsdGlwbGUgdGltZXMgZm9yIG5ldyBpbnN0YW5jZXMu\nCiAgICAgKgogICAgICogQHBhcmFtIGlkIHRoZSBpZCBwcmV2aW91c2x5IHVz\nZWQgYnkgdGhlIGluc3RhbmNlCiAgICAgKiBAcGFyYW0gc20gdGhlIHN0YXRl\nIG1hbmFnZXIgZm9yIHRoZSBpbnN0YW5jZTsgaWYgdGhlIHN0YXRlCiAgICAg\nKiBtYW5hZ2VyIGlzIHRyYW5zaWVudCwgd2UnbGwgc3RvcCBtYW5hZ2luZyB0\naGUgaW5zdGFuY2U7CiAgICAgKiBpZiBpdCBoYXMgdXBkYXRlZCBpdHMgb2lk\nLCB3ZSdsbCByZS1jYWNoZSB1bmRlciB0aGUgbmV3IG9pZAogICAgICogQHBh\ncmFtIHN0YXR1cyBvbmUgb2Ygb3VyIFNUQVRVUyBjb25zdGFudHMgZGVzY3Jp\nYmluZyB3aHkgd2UncmUKICAgICAqIHNldHRpbmcgdGhlIHN0YXRlIG1hbmFn\nZXIKICAgICAqLwogICAgdm9pZCBzZXRTdGF0ZU1hbmFnZXIoT2JqZWN0IGlk\nLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLCBpbnQgc3RhdHVzKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN3aXRjaCAoc3Rh\ndHVzKSB7CiAgICAgICAgICAgICAgICBjYXNlIFNUQVRVU19JTklUOgogICAg\nICAgICAgICAgICAgICAgIF9jYWNoZS5hZGQoc20pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTVEFUVVNfVFJB\nTlNJRU5UOgogICAgICAgICAgICAgICAgICAgIF9jYWNoZS5yZW1vdmUoaWQs\nIHNtKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgU1RBVFVTX09JRF9BU1NJR046CiAgICAgICAgICAgICAgICAg\nICAgX2NhY2hlLmFzc2lnbk9iamVjdElkKGlkLCBzbSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNUQVRVU19D\nT01NSVRfTkVXOgogICAgICAgICAgICAgICAgICAgIF9jYWNoZS5jb21taXRO\nZXcoaWQsIHNtKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE5vdGlmeSB0aGUgYnJv\na2VyIHRoYXQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkCiAgICAg\nKiBiZSBhZGRlZCB0byB0aGUgc2V0IG9mIGluc3RhbmNlcyBpbnZvbHZlZCBp\nbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgdm9pZCBh\nZGRUb1RyYW5zYWN0aW9uKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAg\nICAvLyB3ZSBvbmx5IGFkZCBjbGVhbiBpbnN0YW5jZXMgbm93OyBkaXJ0eSBp\nbnN0YW5jZXMgYXJlIGFkZGVkIGluCiAgICAgICAgLy8gdGhlIHNldERpcnR5\nIGNhbGxiYWNrCiAgICAgICAgaWYgKHNtLmlzRGlydHkoKSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQogICAg\nICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSBuZXcgVHJhbnNhY3Rpb25hbENh\nY2hlKF9vcmRlckRpcnR5KTsKICAgICAgICAgICAgX3RyYW5zQ2FjaGUuYWRk\nQ2xlYW4oc20pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE5vdGlm\neSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlciB0aGF0IHRoZSBnaXZlbiBzdGF0\nZSBtYW5hZ2VyIHNob3VsZAogICAgICogYmUgcmVtb3ZlZCBmcm9tIHRoZSBz\nZXQgb2YgaW5zdGFuY2VzIGludm9sdmVkIGluIHRoZSBjdXJyZW50IHRyYW5z\nYWN0aW9uLgogICAgICovCiAgICB2b2lkIHJlbW92ZUZyb21UcmFuc2FjdGlv\nbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfdHJhbnNDYWNoZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgLy8gaW50ZW50aW9uYWwgZGlyZWN0IGFjY2Vz\nczsgd2UgZG9uJ3Qgd2FudCB0byByZWNvbXB1dGUKICAgICAgICAgICAgICAg\nIC8vIGRpcnRpbmVzcyB3aGlsZSByZW1vdmluZyBpbnN0YW5jZXMgZnJvbSB0\naGUgdHJhbnNhY3Rpb24KICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlLnJl\nbW92ZShzbSk7CiAgICAgICAgICAgIGlmIChfZGVyZWZDYWNoZSAhPSBudWxs\nICYmICFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgICAgIF9kZXJl\nZkNhY2hlLnJlbW92ZShzbSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogTm90aWZpY2F0aW9uIHRoYXQgdGhlIGdpdmVuIGluc3RhbmNlIGhhcyBi\nZWVuIGRpcnRpZWQuIFRoaXMKICAgICAqIG5vdGlmaWNhdGlvbiBpcyBnaXZl\nbiB3aGVuIGFuIG9iamVjdCBmaXJzdCB0cmFuc2l0aW9ucyB0byBhIGRpcnR5\nIHN0YXRlLAogICAgICogYW5kIGV2ZXJ5IHRpbWUgdGhlIG9iamVjdCBpcyBt\nb2RpZmllZCBieSB0aGUgdXNlciB0aGVyZWFmdGVyLgogICAgICovCiAgICB2\nb2lkIHNldERpcnR5KFN0YXRlTWFuYWdlckltcGwgc20sIGJvb2xlYW4gZmly\nc3REaXJ0eSkgewogICAgICAgIGlmIChzbS5pc1BlcnNpc3RlbnQoKSkKICAg\nICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7CgogICAg\nICAgIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYmICFfc2F2ZXBvaW50cy5p\nc0VtcHR5KCkpIHsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRDYWNoZSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX3NhdmVwb2ludENhY2hlID0gbmV3\nIEhhc2hTZXQoKTsKICAgICAgICAgICAgX3NhdmVwb2ludENhY2hlLmFkZChz\nbSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmlyc3REaXJ0eSAmJiBzbS5p\nc1RyYW5zYWN0aW9uYWwoKSkgewogICAgICAgICAgICBsb2NrKCk7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBjYWNoZSBkaXJ0eSBp\nbnN0YW5jZQogICAgICAgICAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFs\nT2JqZWN0cygpKQogICAgICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlID0g\nbmV3IFRyYW5zYWN0aW9uYWxDYWNoZShfb3JkZXJEaXJ0eSk7CiAgICAgICAg\nICAgICAgICBfdHJhbnNDYWNoZS5hZGREaXJ0eShzbSk7CgogICAgICAgICAg\nICAgICAgLy8gYWxzbyByZWNvcmQgdGhhdCB0aGUgY2xhc3MgaXMgZGlydHkK\nICAgICAgICAgICAgICAgIGlmIChzbS5pc05ldygpKSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKF9wZXJzaXN0ZWRDbHNzID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzID0gbmV3IEhhc2hTZXQo\nKTsKICAgICAgICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcy5hZGQoc20u\nZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAg\nICAgICAgfSBlbHNlIGlmIChzbS5pc0RlbGV0ZWQoKSkgewogICAgICAgICAg\nICAgICAgICAgIGlmIChfZGVsZXRlZENsc3MgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgX2RlbGV0ZWRDbHNzID0gbmV3IEhhc2hTZXQoKTsK\nICAgICAgICAgICAgICAgICAgICBfZGVsZXRlZENsc3MuYWRkKHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF91cGRhdGVkQ2xz\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBfdXBkYXRlZENs\nc3MgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICAgICAgICAgIF91cGRh\ndGVkQ2xzcy5hZGQoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBl\nKCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGlm\nIHRyYWNraW5nIGNoYW5nZXMgYW5kIHRoaXMgaW5zdGFuY2Ugd2Fzbid0IGFs\ncmVhZHkgZGlydHksCiAgICAgICAgICAgICAgICAvLyBhZGQgdG8gY2hhbmdl\nZCBzZXQ7IHdlIHVzZSB0aGlzIGZvciBkZXRlY3RpbmcgaW5zdGFuY2VzIHRo\nYXQKICAgICAgICAgICAgICAgIC8vIGVudGVyIHRoZSB0cmFuc2FjdGlvbiBk\ndXJpbmcgcHJlIHN0b3JlCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfUFJFU1RPUklORykgIT0gMCkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChfdHJhbnNBZGRpdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgX3RyYW5zQWRkaXRpb25zID0gbmV3IEhhc2hTZXQoKTsKICAg\nICAgICAgICAgICAgICAgICBfdHJhbnNBZGRpdGlvbnMuYWRkKHNtKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogTm90aWZ5IHRoZSBicm9rZXIgdGhhdCB0\naGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBzaG91bGQKICAgICAqIGJlIGFkZGVk\nIHRvIHRoZSBzZXQgb2YgaW5zdGFuY2VzIHRoYXQgd2lsbCBiZWNvbWUgdHJh\nbnNhY3Rpb25hbAogICAgICogb24gdGhlIG5leHQgdHJhbnNhY3Rpb24KICAg\nICAqLwogICAgdm9pZCBhZGRUb1BlbmRpbmdUcmFuc2FjdGlvbihTdGF0ZU1h\nbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmIChfcGVuZGluZyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgX3BlbmRpbmcgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICBf\ncGVuZGluZy5hZGQoc20pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIE5vdGlmeSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlciB0aGF0IHRoZSBnaXZl\nbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAogICAgICogYmUgcmVtb3ZlZCBmcm9t\nIHRoZSBzZXQgb2YgaW5zdGFuY2VzIGludm9sdmVkIGluIHRoZSBuZXh0IHRy\nYW5zYWN0aW9uLgogICAgICovCiAgICB2b2lkIHJlbW92ZUZyb21QZW5kaW5n\nVHJhbnNhY3Rpb24oU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3BlbmRpbmcg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wZW5kaW5nLnJlbW92ZShzbSk7\nCiAgICAgICAgICAgIGlmIChfZGVyZWZDYWNoZSAhPSBudWxsICYmICFzbS5p\nc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgICAgIF9kZXJlZkNhY2hlLnJl\nbW92ZShzbSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEg\nZGVyZWZlcmVuY2VkIGRlcGVuZGVudCBvYmplY3QgdG8gdGhlIHBlcnNpc3Rl\nbmNlIG1hbmFnZXIncyBjYWNoZS4KICAgICAqIE9uIGZsdXNoLCB0aGVzZSBv\nYmplY3RzIHdpbGwgYmUgZGVsZXRlZC4KICAgICAqLwogICAgdm9pZCBhZGRE\nZXJlZmVyZW5jZWREZXBlbmRlbnQoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBp\nZiB3ZSdyZSBpbiB0aGUgbWlkZGxlIG9mIGZsdXNoIGFuZCBpbnRyb2R1Y2lu\nZyBtb3JlIGRlcmVmcwogICAgICAgICAgICAvLyB2aWEgaW5zdGFuY2UgY2Fs\nbGJhY2tzLCBhZGQgdGhlbSB0byB0aGUgc3BlY2lhbCBhZGRpdGlvbnMgc2V0\nCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19ERVJFRkRFTEVUSU5H\nKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoX2RlcmVmQWRkaXRpb25z\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2RlcmVmQWRkaXRpb25z\nID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgIF9kZXJlZkFkZGl0\naW9ucy5hZGQoc20pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgaWYgKF9kZXJlZkNhY2hlID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgX2RlcmVmQ2FjaGUgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAg\nICAgICAgX2RlcmVmQ2FjaGUuYWRkKHNtKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBn\naXZlbiBwcmV2aW91c2x5IGRlcmVmZXJlbmNlZCBkZXBlbmRlbnQgb2JqZWN0\nIGZyb20gdGhlCiAgICAgKiBjYWNoZS4gSXQgaXMgbm93IHJlZmVyZW5jZWQu\nCiAgICAgKi8KICAgIHZvaWQgcmVtb3ZlRGVyZWZlcmVuY2VkRGVwZW5kZW50\nKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYm9vbGVhbiByZW1vdmVkID0gZmFsc2U7\nCiAgICAgICAgICAgIGlmIChfZGVyZWZBZGRpdGlvbnMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJlbW92ZWQgPSBfZGVyZWZBZGRpdGlvbnMucmVtb3Zl\nKHNtKTsKICAgICAgICAgICAgaWYgKCFyZW1vdmVkICYmIChfZGVyZWZDYWNo\nZSA9PSBudWxsIHx8ICFfZGVyZWZDYWNoZS5yZW1vdmUoc20pKSkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vdC1kZXJlZmVkIiwKICAgICAgICAgICAgICAgICAgICBFeGNl\ncHRpb25zLnRvU3RyaW5nKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKSkpLgog\nICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChzbS5nZXRNYW5h\nZ2VkSW5zdGFuY2UoKSkuCiAgICAgICAgICAgICAgICAgICAgc2V0RmF0YWwo\ndHJ1ZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRpcnR5VHlw\nZShDbGFzcyBjbHMpIHsKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2Up\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfdXBkYXRlZENsc3Mg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIF91cGRhdGVkQ2xzcyA9IG5ldyBI\nYXNoU2V0KCk7CiAgICAgICAgICAgIF91cGRhdGVkQ2xzcy5hZGQoY2xzKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0\nUGVyc2lzdGVkVHlwZXMoKSB7CiAgICAgICAgaWYgKF9wZXJzaXN0ZWRDbHNz\nID09IG51bGwgfHwgX3BlcnNpc3RlZENsc3MuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKICAgICAgICBy\nZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlQ29sbGVjdGlvbihfcGVy\nc2lzdGVkQ2xzcyk7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0\nVXBkYXRlZFR5cGVzKCkgewogICAgICAgIGlmIChfdXBkYXRlZENsc3MgPT0g\nbnVsbCB8fCBfdXBkYXRlZENsc3MuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKICAgICAgICByZXR1cm4g\nQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlQ29sbGVjdGlvbihfdXBkYXRlZENs\nc3MpOwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldERlbGV0ZWRU\neXBlcygpIHsKICAgICAgICBpZiAoX2RlbGV0ZWRDbHNzID09IG51bGwgfHwg\nX2RlbGV0ZWRDbHNzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIENv\nbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAgcmV0dXJuIENvbGxlY3Rp\nb25zLnVubW9kaWZpYWJsZUNvbGxlY3Rpb24oX2RlbGV0ZWRDbHNzKTsKICAg\nIH0KCiAgICAvLy8vLy8vLy8vLwogICAgLy8gQ2xvc2luZwogICAgLy8vLy8v\nLy8vLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Nsb3NlZCgpIHsKICAgICAg\nICByZXR1cm4gX2Nsb3NlZDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0Nsb3NlSW52b2tlZCgpIHsKICAgICAgICByZXR1cm4gX2Nsb3NlZCB8fCAo\nX2ZsYWdzICYgRkxBR19DTE9TRV9JTlZPS0VEKSAhPSAwOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB0aHJvdyBh\nbiBleGNlcHRpb24gaWYgY2xvc2luZyBpbiBhbiBhY3RpdmUgbG9jYWwgdHJh\nbnMKICAgICAgICAgICAgaWYgKCFfbWFuYWdlZCAmJiAoX2ZsYWdzICYgRkxB\nR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52\nYWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJhY3RpdmUiKSk7CgogICAg\nICAgICAgICAvLyBvbmx5IGNsb3NlIGlmIG5vdCBhY3RpdmU7IGlmIGFjdGl2\nZSBtYW5hZ2VkIHRyYW5zIHdhaXQKICAgICAgICAgICAgLy8gZm9yIGNvbXBs\nZXRpb24KICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfQ0xPU0VfSU5WT0tF\nRDsKCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09\nIDApCiAgICAgICAgICAgICAgICBmcmVlKCk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogRnJlZSB0aGUgcmVzb3VyY2VzIHVzZWQgYnkg\ndGhpcyBwZXJzaXN0ZW5jZSBtYW5hZ2VyLgogICAgICovCiAgICBwcm90ZWN0\nZWQgdm9pZCBmcmVlKCkgewogICAgICAgIFJ1bnRpbWVFeGNlcHRpb24gZXJy\nID0gbnVsbDsKICAgICAgICBpZiAoKF9hdXRvRGV0YWNoICYgREVUQUNIX0NM\nT1NFKSAhPSAwKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBkZXRhY2hBbGxJbnRlcm5hbChfY2FsbCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIGVy\nciA9IHJlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfc3lu\nYyA9IG51bGw7CiAgICAgICAgX3VzZXJPYmplY3RzID0gbnVsbDsKICAgICAg\nICBfY2FjaGUuY2xlYXIoKTsKICAgICAgICBfdHJhbnNDYWNoZSA9IG51bGw7\nCiAgICAgICAgX3BlcnNpc3RlZENsc3MgPSBudWxsOwogICAgICAgIF91cGRh\ndGVkQ2xzcyA9IG51bGw7CiAgICAgICAgX2RlbGV0ZWRDbHNzID0gbnVsbDsK\nICAgICAgICBfZGVyZWZDYWNoZSA9IG51bGw7CiAgICAgICAgX3BlbmRpbmcg\nPSBudWxsOwogICAgICAgIF9sb2FkZXIgPSBudWxsOwogICAgICAgIF90cmFu\nc0V2ZW50TWFuYWdlciA9IG51bGw7CiAgICAgICAgX2xpZmVFdmVudE1hbmFn\nZXIgPSBudWxsOwoKICAgICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAg\nICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzICE9IG51bGwgJiYgIV9zYXZlcG9p\nbnRzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBzYXZlID0KICAgICAgICAg\nICAgICAgIChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUo\nX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAgIHNhdmUucmVs\nZWFzZShmYWxzZSk7CiAgICAgICAgfQogICAgICAgIF9zYXZlcG9pbnRzID0g\nbnVsbDsKICAgICAgICBfc2F2ZXBvaW50Q2FjaGUgPSBudWxsOwoKICAgICAg\nICBpZiAoX3F1ZXJpZXMgIT0gbnVsbCkgewogICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IF9xdWVyaWVzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgICgoUXVlcnkpIGl0ci5uZXh0KCkpLmNsb3NlUmVzb3VyY2VzKCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nX3F1ZXJpZXMgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9leHRl\nbnRzICE9IG51bGwpIHsKICAgICAgICAgICAgRXh0ZW50IGU7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2V4dGVudHMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGUgPSAoRXh0ZW50\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBlLmNsb3NlQWxsKCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2V4dGVudHMgPSBudWxsOwog\nICAgICAgIH0KCiAgICAgICAgdHJ5IHsgcmVsZWFzZUNvbm5lY3Rpb24oKTsg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkge30KCiAgICAgICAgX2xt\nLmNsb3NlKCk7CiAgICAgICAgX3N0b3JlLmNsb3NlKCk7CiAgICAgICAgX2Zs\nYWdzID0gMDsKICAgICAgICBfY2xvc2VkID0gdHJ1ZTsKICAgICAgICBpZiAo\nX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBfY2xvc2VkRXhj\nZXB0aW9uID0gbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigpOwoKICAgICAg\nICBpZiAoZXJyICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IGVycjsKICAg\nIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTeW5jaHJvbml6\nYXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9p\nZCBsb2NrKCkgewogICAgICAgIGlmIChfbG9jayAhPSBudWxsKQogICAgICAg\nICAgICBfbG9jay5sb2NrKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdW5s\nb2NrKCkgewogICAgICAgIGlmIChfbG9jayAhPSBudWxsKQogICAgICAgICAg\nICBfbG9jay51bmxvY2soKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gU3RhdGUgbWFuYWdlbWVudAogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KCiAgICBwdWJsaWMgT2JqZWN0IG5ld0luc3RhbmNlKENsYXNz\nIGNscykgewogICAgICAgIGFzc2VydE9wZW4oKTsKCiAgICAgICAgaWYgKGNs\ncy5pc0ludGVyZmFjZSgpKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCku\nCiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YShjbHMsIF9sb2FkZXIsIHRy\ndWUpOwogICAgICAgICAgICBjbHMgPSBtZXRhLmdldEludGVyZmFjZUltcGwo\nKTsKICAgICAgICB9IGVsc2UgaWYgKE1vZGlmaWVyLmlzQWJzdHJhY3QoY2xz\nLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAg\nICAgICAoIm5ldy1hYnN0cmFjdCIsIGNscykuZ2V0TWVzc2FnZSgpKTsKCiAg\nICAgICAgLy8gMS41IGRvZXNuJ3QgaW5pdGlhbGl6ZSBjbGFzc2VzIHdpdGhv\ndXQgYSB0cnVlIENsYXNzLmZvck5hbWUKICAgICAgICBpZiAoIVBDUmVnaXN0\ncnkuaXNSZWdpc3RlcmVkKGNscykpIHsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xzLmdldE5hbWUoKSwgdHJ1\nZSwgCiAgICAgICAgICAgICAgICAgICAgKENsYXNzTG9hZGVyKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICAg\nICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY2xzKSkp\nOwogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBQQ1JlZ2lzdHJ5Lm5l\nd0luc3RhbmNlKGNscywgbnVsbCwgZmFsc2UpOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0T2JqZWN0SWQoT2JqZWN0IG9iaikgewogICAgICAgIGFz\nc2VydE9wZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFi\nbGUob2JqKSkKICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVy\nc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKQogICAgICAgICAgICAgICAg\nLnBjRmV0Y2hPYmplY3RJZCgpOwogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIHB1YmxpYyBpbnQgZ2V0TG9ja0xldmVsKE9iamVjdCBvKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChvID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBMb2NrTGV2ZWxzLkxPQ0tfTk9ORTsKCiAgICAg\nICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IGdldFN0YXRlTWFuYWdlcihv\nKTsKICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIExvY2tMZXZlbHMuTE9DS19OT05FOwogICAgICAgIHJldHVybiBnZXRMb2Nr\nTWFuYWdlcigpLmdldExvY2tMZXZlbChzbSk7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBnZXRWZXJzaW9uKE9iamVjdCBvYmopIHsKICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxl\nKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBlci50b1BlcnNp\nc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkucGNHZXRWZXJzaW9uKCk7CiAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naXNEaXJ0eShPYmplY3Qgb2JqKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwog\nICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKSB7CiAg\nICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IEltcGxIZWxwZXIu\ndG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZik7CiAgICAgICAgICAg\nIHJldHVybiBwYy5wY0lzRGlydHkoKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzVHJhbnNh\nY3Rpb25hbChPYmplY3Qgb2JqKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwog\nICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKQogICAg\nICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFi\nbGUob2JqLCBfY29uZikpCiAgICAgICAgICAgICAgICAucGNJc1RyYW5zYWN0\naW9uYWwoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNQZXJzaXN0ZW50KE9iamVjdCBvYmopIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5h\nZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBlci50\nb1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkucGNJc1BlcnNpc3Rl\nbnQoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNOZXcoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2Jq\nKSkKICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVyc2lzdGVu\nY2VDYXBhYmxlKG9iaiwgX2NvbmYpKS5wY0lzTmV3KCk7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGVsZXRl\nZChPYmplY3Qgb2JqKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAg\nIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKQogICAgICAgICAg\nICByZXR1cm4gKEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2Jq\nLCBfY29uZikpLnBjSXNEZWxldGVkKCk7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGV0YWNoZWQoT2JqZWN0\nIG9iaikgewogICAgICAgIGlmICghKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxl\nKG9iaikpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYyA9IEltcGxIZWxwZXIudG9QZXJzaXN0ZW5j\nZUNhcGFibGUob2JqLCBfY29uZik7CiAgICAgICAgQm9vbGVhbiBkZXRhY2hl\nZCA9IHBjLnBjSXNEZXRhY2hlZCgpOwogICAgICAgIGlmIChkZXRhY2hlZCAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZGV0YWNoZWQuYm9vbGVhblZh\nbHVlKCk7CgogICAgICAgIC8vIGxhc3QgcmVzb3J0OiBpbnN0YW5jZSBpcyBk\nZXRhY2hlZCBpZiBpdCBoYXMgYSBzdG9yZSByZWNvcmQKICAgICAgICBDbGFz\nc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJ\nbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRNZXRhRGF0YShJbXBsSGVscGVy\nLmdldE1hbmFnZWRJbnN0YW5jZShwYykuZ2V0Q2xhc3MoKSwKICAgICAgICAg\nICAgICAgIF9sb2FkZXIsIHRydWUpOwogICAgICAgIE9iamVjdCBvaWQgPSBB\ncHBsaWNhdGlvbklkcy5jcmVhdGUocGMsIG1ldGEpOwogICAgICAgIGlmIChv\naWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIHJldHVybiBmaW5kKG9pZCwgbnVsbCwgRVhDTFVERV9BTEwsIG51bGwsIDAp\nICE9IG51bGw7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgZ2V0U3RhdGVNYW5hZ2VyKE9iamVjdCBvYmopIHsKICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIGdldFN0YXRlTWFuYWdlckltcGwo\nb2JqLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBnaXZlbiBpbnN0YW5jZSwgb3IgbnVs\nbC4KICAgICAqCiAgICAgKiBAcGFyYW0gYXNzZXJ0VGhpc0NvbnRleHQgaWYg\ndHJ1ZSwgdGhvdyBhbiBleGNlcHRpb24gaWYgdGhlIGdpdmVuCiAgICAgKiBv\nYmplY3QgaXMgbWFuYWdlZCBieSBhbm90aGVyIGJyb2tlcgogICAgICovCiAg\nICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbCBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKE9iamVjdCBvYmosCiAgICAgICAgYm9vbGVhbiBhc3NlcnRUaGlzQ29u\ndGV4dCkgewogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShv\nYmopKSB7CiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IElt\ncGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZik7CiAg\nICAgICAgICAgIGlmIChwYy5wY0dldEdlbmVyaWNDb250ZXh0KCkgPT0gdGhp\ncykKICAgICAgICAgICAgICAgIHJldHVybiAoU3RhdGVNYW5hZ2VySW1wbCkg\ncGMucGNHZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAgaWYgKGFzc2Vy\ndFRoaXNDb250ZXh0ICYmIHBjLnBjR2V0R2VuZXJpY0NvbnRleHQoKSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vdC1tYW5hZ2VkIiwKICAgICAgICAgICAgICAgICAgICBF\neGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS5zZXRGYWlsZWRPYmplY3Qob2Jq\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBn\naXZlbiBvaWQuCiAgICAgKgogICAgICogQHBhcmFtIGFsbG93TmV3IGlmIHRy\ndWUsIG9iamVjdHMgbWFkZSBwZXJzaXN0ZW50IGluIHRoZSBjdXJyZW50CiAg\nICAgKiB0cmFuc2FjdGlvbiB3aWxsIGJlIGluY2x1ZGVkIGluIHRoZSBzZWFy\nY2g7IGlmCiAgICAgKiBtdWx0aXBsZSBuZXcgb2JqZWN0cyBtYXRjaCB0aGUg\nZ2l2ZW4gb2lkLCBpdCBpcwogICAgICogdW5kZWZpbmVkIHdoaWNoIHdpbGwg\nYmUgcmV0dXJuZWQKICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdl\nckltcGwgZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQoT2JqZWN0IG9pZCwKICAg\nICAgICBib29sZWFuIGFsbG93TmV3KSB7CiAgICAgICAgcmV0dXJuIF9jYWNo\nZS5nZXRCeUlkKG9pZCwgYWxsb3dOZXcpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBnaXZlbiBpbnN0YW5jZSBhcyBhIHtAbGluayBQZXJz\naXN0ZW5jZUNhcGFibGV9LgogICAgICogSWYgdGhlIGluc3RhbmNlIGlzIG5v\ndCBtYW5hZ2VhYmxlIHRocm93IHRoZSBwcm9wZXIgZXhjZXB0aW9uLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgUGVyc2lzdGVuY2VDYXBhYmxlIGFzc2VydFBl\ncnNpc3RlbmNlQ2FwYWJsZShPYmplY3Qgb2JqKSB7CiAgICAgICAgaWYgKG9i\naiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBp\nZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkKICAgICAgICAgICAg\ncmV0dXJuIEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBf\nY29uZik7CgogICAgICAgIC8vIGNoZWNrIGZvciBkaWZmZXJlbnQgaW5zdGFu\nY2VzIG9mIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUgaW50ZXJmYWNlCiAgICAg\nICAgLy8gYW5kIHRocm93IGEgYmV0dGVyIGVycm9yIHRoYXQgbWVudGlvbnMg\ndGhlIGNsYXNzIGxvYWRlcnMKICAgICAgICBDbGFzc1tdIGludGZzID0gb2Jq\nLmdldENsYXNzKCkuZ2V0SW50ZXJmYWNlcygpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpbnRmcyAhPSBudWxsICYmIGkgPCBpbnRmcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBpZiAoaW50ZnNbaV0uZ2V0TmFtZSgpLmVxdWFs\ncyhQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MuZ2V0TmFtZSgpKSkgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nInBjLWxvYWRlci1kaWZmZXJlbnQiLAogICAgICAgICAgICAgICAgICAgIEV4\nY2VwdGlvbnMudG9TdHJpbmcob2JqKSwKICAgICAgICAgICAgICAgICAgICAo\nQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAog\nICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFz\nc0xvYWRlckFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBl\ncnNpc3RlbmNlQ2FwYWJsZS5jbGFzcykpLAogICAgICAgICAgICAgICAgICAg\nIChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENs\nYXNzTG9hZGVyQWN0aW9uKGludGZzW2ldKSkpKQogICAgICAgICAgICAgICAg\nICAgIC5zZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgLy8gbm90IGVuaGFuY2VkCiAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInBjLWNhc3QiLAogICAgICAg\nICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS5zZXRGYWlsZWRPYmpl\nY3Qob2JqKTsKICAgIH0KCiAgICAvLy8vLy8vLy8KICAgIC8vIFV0aWxzCiAg\nICAvLy8vLy8vLy8KICAgIC8qKgogICAgICogVGhyb3cgYW4gZXhjZXB0aW9u\nIGlmIHRoZSBjb250ZXh0IGlzIGNsb3NlZC4gIFRoZSBleGFjdCBtZXNzYWdl\nIGFuZAogICAgICogY29udGVudCBvZiB0aGUgZXhjZXB0aW9uIHZhcmllcyB3\naGV0aGVyIFRSQUNFIGlzIGVuYWJsZWQgb3Igbm90LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBhc3NlcnRPcGVuKCkgewogICAgICAgIGlmIChfY2xvc2Vk\nKSB7CiAgICAgICAgICAgIGlmIChfY2xvc2VkRXhjZXB0aW9uID09IG51bGwp\nICAvLyBUUkFDRSBub3QgZW5hYmxlZAogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiY2xvc2VkLW5v\ndHJhY2UiKSkKICAgICAgICAgICAgICAgICAgICAgICAgLnNldEZhdGFsKHRy\ndWUpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJjbG9zZWQiKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgX2Nsb3NlZEV4Y2VwdGlvbikuc2V0\nRmF0YWwodHJ1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCkgewogICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgIHRocm93IG5l\ndyBOb1RyYW5zYWN0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtYWN0aXZl\nIikpOwogICAgfQoKICAgIC8qKgogICAgICogVGhyb3cgZXhjZXB0aW9uIGlm\nIGEgdHJhbnNhY3Rpb24tcmVsYXRlZCBvcGVyYXRpb24gaXMgYXR0ZW1wdGVk\nIGFuZAogICAgICogbm8gdHJhbnNhY3Rpb24gaXMgYWN0aXZlLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24o\nKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgibm90LWFjdGl2ZSIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpIHsKICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwICYmICFfbm9udHJhbnNSZWFk\nKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJub24tdHJhbnMtcmVhZCIpKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBhc3NlcnRXcml0ZU9wZXJhdGlvbigpIHsKICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwICYmICghX25vbnRyYW5zV3Jp\ndGUKICAgICAgICAgICAgfHwgKF9hdXRvRGV0YWNoICYgREVUQUNIX05PTlRY\nUkVBRCkgIT0gMCkpCiAgICAgICAgICAgIHRocm93IG5ldyBOb1RyYW5zYWN0\naW9uRXhjZXB0aW9uKF9sb2MuZ2V0KCJ3cml0ZS1vcGVyYXRpb24iKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW4gb2JqZWN0IG5vdCBmb3Vu\nZCBleGNlcHRpb24gY29udGFpbmluZyBuZXN0ZWQgZXhjZXB0aW9ucwogICAg\nICogZm9yIGFsbCBvZiB0aGUgZ2l2ZW4gZmFpbGVkIG9iamVjdHMuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdE5vdEZvdW5kRXhjZXB0aW9u\nIG5ld09iamVjdE5vdEZvdW5kRXhjZXB0aW9uCiAgICAgICAgKENvbGxlY3Rp\nb24gZmFpbGVkKSB7CiAgICAgICAgVGhyb3dhYmxlW10gdCA9IG5ldyBUaHJv\nd2FibGVbZmFpbGVkLnNpemUoKV07CiAgICAgICAgaW50IGlkeCA9IDA7CiAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBmYWlsZWQuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTsgaWR4KyspCiAgICAgICAgICAgIHRbaWR4XSA9IG5l\ndyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihpdHIubmV4dCgpKTsKICAgICAg\nICByZXR1cm4gbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCwg\ndCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KICAgIC8vIEZpbmRDYWxsYmFja3MgaW1wbGVtZW50YXRpb24KICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIE9i\namVjdCBwcm9jZXNzQXJndW1lbnQoT2JqZWN0IG9pZCkgewogICAgICAgIHJl\ndHVybiBvaWQ7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBwcm9jZXNzUmV0\ndXJuKE9iamVjdCBvaWQsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAg\nICAgICByZXR1cm4gKHNtID09IG51bGwpID8gbnVsbCA6IHNtLmdldE1hbmFn\nZWRJbnN0YW5jZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FjaGUgb2Yg\nbWFuYWdlZCBvYmplY3RzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBj\nbGFzcyBNYW5hZ2VkQ2FjaGUgewoKICAgICAgICBwcml2YXRlIGZpbmFsIE1h\ncCBfbWFpbjsgLy8gb2lkIC0+IHNtCiAgICAgICAgcHJpdmF0ZSBNYXAgX2Nv\nbmZsaWN0cyA9IG51bGw7IC8vIGNvbmZsaWN0IG9pZCAtPiBuZXcgc20KICAg\nICAgICBwcml2YXRlIE1hcCBfbmV3cyA9IG51bGw7IC8vIHRtcCBpZCAtPiBu\nZXcgc20KICAgICAgICBwcml2YXRlIENvbGxlY3Rpb24gX2VtYmVkcyA9IG51\nbGw7IC8vIGVtYmVkZGVkL25vbi1wZXJzaXN0ZW50IHNtcwogICAgICAgIHBy\naXZhdGUgQ29sbGVjdGlvbiBfdW50cmFja2VkID0gbnVsbDsgLy8gaGFyZCBy\nZWZzIHRvIHVudHJhY2tlZCBzbXMKCiAgICAgICAgLyoqCiAgICAgICAgICog\nQ29uc3RydWN0b3I7IHN1cHBseSBwcmltYXJ5IGNhY2hlIG1hcC4KICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgTWFuYWdlZENhY2hlKE1hcCBjYWNoZSkg\newogICAgICAgICAgICBfbWFpbiA9IGNhY2hlOwogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBpbnN0YW5jZSBmb3IgdGhl\nIGdpdmVuIG9pZCwgb3B0aW9uYWxseSBhbGxvd2luZwogICAgICAgICAqIG5l\ndyBpbnN0YW5jZXMuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIFN0YXRl\nTWFuYWdlckltcGwgZ2V0QnlJZChPYmplY3Qgb2lkLCBib29sZWFuIGFsbG93\nTmV3KSB7CiAgICAgICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgLy8gY2hlY2sgbWFp\nbiBjYWNoZSBmb3Igb2lkCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgX21haW4uZ2V0KG9pZCk7CiAgICAg\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20yOwogICAgICAgICAgICBpZiAo\nc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gaWYgaXQncyBhIG5l\ndyBpbnN0YW5jZSwgd2Uga25vdyBpdCdzIHRoZSBvbmx5IG1hdGNoLCBiZWNh\ndXNlCiAgICAgICAgICAgICAgICAvLyBvdGhlciBwZXJzIGluc3RhbmNlcyBv\ndmVycmlkZSBuZXcgaW5zdGFuY2VzIGluIF9jYWNoZQogICAgICAgICAgICAg\nICAgaWYgKHNtLmlzTmV3KCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIChhbGxvd05ldykgPyBzbSA6IG51bGw7CiAgICAgICAgICAgICAgICBpZiAo\nIWFsbG93TmV3IHx8ICFzbS5pc0RlbGV0ZWQoKSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gc207CgogICAgICAgICAgICAgICAgLy8gc20gaXMgZGVs\nZXRlZDsgY2hlY2sgY29uZmxpY3QgY2FjaGUKICAgICAgICAgICAgICAgIGlm\nIChfY29uZmxpY3RzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBz\nbTIgPSAoU3RhdGVNYW5hZ2VySW1wbCkgX2NvbmZsaWN0cy5nZXQob2lkKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoc20yICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybiBzbTI7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGF0IHRoaXMgcG9pbnQg\nc20gaXMgbnVsbCBvciBkZWxldGVkOyBjaGVjayB0aGUgbmV3IGNhY2hlIGZv\ncgogICAgICAgICAgICAvLyBhbnkgbWF0Y2hlcy4gdGhpcyBhbGxvd3MgdXMg\ndG8gbWF0Y2ggYXBwIGlkIG9iamVjdHMgdG8gbmV3CiAgICAgICAgICAgIC8v\nIGluc3RhbmNlcyB3aXRob3V0IHBlcm1hbmFudCBvaWRzCiAgICAgICAgICAg\nIGlmIChhbGxvd05ldyAmJiBfbmV3cyAhPSBudWxsICYmICFfbmV3cy5pc0Vt\ncHR5KCkpIHsKICAgICAgICAgICAgICAgIHNtMiA9IChTdGF0ZU1hbmFnZXJJ\nbXBsKSBfbmV3cy5nZXQob2lkKTsKICAgICAgICAgICAgICAgIGlmIChzbTIg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc20yOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzbTsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIENhbGwgdGhpcyBtZXRob2Qgd2hlbiBh\nIG5ldyBzdGF0ZSBtYW5hZ2VyIGluaXRpYWxpemVzIGl0c2VsZi4KICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBhZGQoU3RhdGVNYW5hZ2VySW1w\nbCBzbSkgewogICAgICAgICAgICBpZiAoIXNtLmlzSW50ZXJjZXB0aW5nKCkp\nIHsKICAgICAgICAgICAgICAgIGlmIChfdW50cmFja2VkID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgX3VudHJhY2tlZCA9IG5ldyBIYXNoU2V0KCk7\nCiAgICAgICAgICAgICAgICBfdW50cmFja2VkLmFkZChzbSk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGlmICghc20uaXNQZXJzaXN0ZW50KCkgfHwg\nc20uaXNFbWJlZGRlZCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoX2VtYmVk\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9lbWJlZHMgPSBuZXcg\nUmVmZXJlbmNlSGFzaFNldChSZWZlcmVuY2VIYXNoU2V0LldFQUspOwogICAg\nICAgICAgICAgICAgX2VtYmVkcy5hZGQoc20pOwogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpbml0aWFs\naXppbmcgbmV3IGluc3RhbmNlOyBwdXQgaW4gbmV3IGNhY2hlIGJlY2F1c2Ug\nd29uJ3QgaGF2ZQogICAgICAgICAgICAvLyBwZXJtYW5lbnQgb2lkIHlldAog\nICAgICAgICAgICBpZiAoc20uaXNOZXcoKSkgewogICAgICAgICAgICAgICAg\naWYgKF9uZXdzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX25ld3Mg\nPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICAgICAgX25ld3MucHV0KHNt\nLmdldElkKCksIHNtKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gaW5pdGlhbGl6aW5nIHBlcnNpc3Rl\nbnQgaW5zdGFuY2U7IHB1dCBpbiBtYWluIGNhY2hlCiAgICAgICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgb3JpZyA9IChTdGF0ZU1hbmFnZXJJbXBsKSBfbWFp\nbi5wdXQKICAgICAgICAgICAgICAgIChzbS5nZXRPYmplY3RJZCgpLCBzbSk7\nCiAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIF9tYWluLnB1dChzbS5nZXRPYmplY3RJZCgpLCBvcmlnKTsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJk\ndXAtbG9hZCIsCiAgICAgICAgICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQo\nKSwgRXhjZXB0aW9ucy50b1N0cmluZwogICAgICAgICAgICAgICAgICAgIChv\ncmlnLmdldE1hbmFnZWRJbnN0YW5jZSgpKSkpLgogICAgICAgICAgICAgICAg\nICAgIHNldEZhaWxlZE9iamVjdChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIFJlbW92ZSB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBmcm9tIHRoZSBj\nYWNoZSB3aGVuIGl0IHRyYW5zaXRpb25zCiAgICAgICAgICogdG8gdHJhbnNp\nZW50LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHJlbW92ZShP\nYmplY3QgaWQsIFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAg\nLy8gaWYgaXQgaGFzIGEgcGVybWFuZW50IG9pZCwgcmVtb3ZlIGZyb20gbWFp\nbiAvIGNvbmZsaWN0IGNhY2hlLAogICAgICAgICAgICAvLyBlbHNlIHJlbW92\nZSBmcm9tIGVtYmVkZGVkL25vbnRyYW5zIGNhY2hlLCBhbmQgaWYgbm90IHRo\nZXJlCiAgICAgICAgICAgIC8vIHJlbW92ZSBmcm9tIG5ldyBjYWNoZQogICAg\nICAgICAgICBPYmplY3Qgb3JpZzsKICAgICAgICAgICAgaWYgKHNtLmdldE9i\namVjdElkKCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgb3JpZyA9IF9t\nYWluLnJlbW92ZShpZCk7CiAgICAgICAgICAgICAgICBpZiAob3JpZyAhPSBz\nbSkgewogICAgICAgICAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9tYWluLnB1dChpZCwgb3JpZyk7IC8v\nIHB1dCBiYWNrCiAgICAgICAgICAgICAgICAgICAgaWYgKF9jb25mbGljdHMg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBvcmlnID0gX2Nv\nbmZsaWN0cy5yZW1vdmUoaWQpOwogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAob3JpZyAhPSBudWxsICYmIG9yaWcgIT0gc20pCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBfY29uZmxpY3RzLnB1dChpZCwgb3JpZyk7IC8vIHB1\ndCBiYWNrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9IGVsc2UgaWYgKChfZW1iZWRzID09IG51bGwgfHwg\nIV9lbWJlZHMucmVtb3ZlKHNtKSkKICAgICAgICAgICAgICAgICYmIF9uZXdz\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIG9yaWcgPSBfbmV3cy5yZW1v\ndmUoaWQpOwogICAgICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCAmJiBv\ncmlnICE9IHNtKQogICAgICAgICAgICAgICAgICAgIF9uZXdzLnB1dChpZCwg\nb3JpZyk7IC8vIHB1dCBiYWNrCiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChfdW50cmFja2VkICE9IG51bGwpCiAgICAgICAgICAgICAgICBfdW50\ncmFja2VkLnJlbW92ZShzbSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBBbiBlbWJlZGRlZCBvciBub25wZXJzaXN0ZW50IG1hbmFnZWQg\naW5zdGFuY2UgaGFzIGJlZW4gcGVyc2lzdGVkLgogICAgICAgICAqLwogICAg\nICAgIHB1YmxpYyB2b2lkIHBlcnNpc3QoU3RhdGVNYW5hZ2VySW1wbCBzbSkg\newogICAgICAgICAgICBpZiAoX2VtYmVkcyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX2VtYmVkcy5yZW1vdmUoc20pOwogICAgICAgIH0KCiAgICAgICAg\nLyoqCiAgICAgICAgICogQSBuZXcgaW5zdGFuY2UgaGFzIGp1c3QgYmVlbiBh\nc3NpZ25lZCBhIHBlcm1hbmVudCBvaWQuCiAgICAgICAgICovCiAgICAgICAg\ncHVibGljIHZvaWQgYXNzaWduT2JqZWN0SWQoT2JqZWN0IGlkLCBTdGF0ZU1h\nbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIC8vIGlmIGFzc2lnbmluZyBv\naWQsIHJlbW92ZSBmcm9tIG5ldyBjYWNoZSBhbmQgcHV0IGluIHByaW1hcnk7\nIG1heQogICAgICAgICAgICAvLyBub3QgYmUgaW4gbmV3IGNhY2hlIGlmIGFu\nb3RoZXIgbmV3IGluc3RhbmNlIGhhZCBzYW1lIGlkCiAgICAgICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgb3JpZyA9IChTdGF0ZU1hbmFnZXJJbXBsKSBfbmV3\ncy5yZW1vdmUoaWQpOwogICAgICAgICAgICBpZiAob3JpZyAhPSBudWxsICYm\nIG9yaWcgIT0gc20pCiAgICAgICAgICAgICAgICBfbmV3cy5wdXQoaWQsIG9y\naWcpOyAvLyBwdXQgYmFjawoKICAgICAgICAgICAgLy8gcHV0IGluIG1haW4g\nY2FjaGUsIGJ1dCBtYWtlIHN1cmUgd2UgZG9uJ3QgcmVwbGFjZSBhbm90aGVy\nCiAgICAgICAgICAgIC8vIGluc3RhbmNlIHdpdGggdGhlIHNhbWUgb2lkCiAg\nICAgICAgICAgIG9yaWcgPSAoU3RhdGVNYW5hZ2VySW1wbCkgX21haW4ucHV0\nKHNtLmdldE9iamVjdElkKCksIHNtKTsKICAgICAgICAgICAgaWYgKG9yaWcg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX21haW4ucHV0KHNtLmdldE9i\namVjdElkKCksIG9yaWcpOwogICAgICAgICAgICAgICAgaWYgKCFvcmlnLmlz\nRGVsZXRlZCgpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJkdXAtb2lkLWFzc2lnbiIsCiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLmdldE9iamVjdElkKCksIEV4Y2VwdGlvbnMu\ndG9TdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgKHNtLmdldE1hbmFn\nZWRJbnN0YW5jZSgpKSkpLgogICAgICAgICAgICAgICAgICAgICAgICBzZXRG\nYWlsZWRPYmplY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwoKICAgICAg\nICAgICAgICAgIC8vIHNhbWUgb2lkIGFzIGRlbGV0ZWQgaW5zdGFuY2U7IHB1\ndCBpbiBjb25mbGljdCBjYWNoZQogICAgICAgICAgICAgICAgaWYgKF9jb25m\nbGljdHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfY29uZmxpY3Rz\nID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIF9jb25mbGljdHMu\ncHV0KHNtLmdldE9iamVjdElkKCksIHNtKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQSBuZXcgaW5zdGFuY2Ug\naGFzIGNvbW1pdHRlZDsgcmVjYWNoZSB1bmRlciBwZXJtYW5lbnQgb2lkLgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGNvbW1pdE5ldyhPYmpl\nY3QgaWQsIFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAgLy8g\naWYgdGhlIGlkIGRpZG4ndCBjaGFuZ2UsIHRoZSBpbnN0YW5jZSB3YXMgYWxy\nZWFkeSBhc3NpZ25lZCBhbgogICAgICAgICAgICAvLyBpZCwgYnV0IGl0IGNv\ndWxkIGhhdmUgYmVlbiBpbiBjb25mbGljdCBjYWNoZQogICAgICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIG9yaWc7CiAgICAgICAgICAgIGlmIChzbS5nZXRP\nYmplY3RJZCgpID09IGlkKSB7CiAgICAgICAgICAgICAgICBvcmlnID0gKF9j\nb25mbGljdHMgPT0gbnVsbCkgPyBudWxsCiAgICAgICAgICAgICAgICAgICAg\nOiAoU3RhdGVNYW5hZ2VySW1wbCkgX2NvbmZsaWN0cy5yZW1vdmUoaWQpOwog\nICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0gc20pIHsKICAgICAgICAgICAg\nICAgICAgICBvcmlnID0gKFN0YXRlTWFuYWdlckltcGwpIF9tYWluLnB1dChp\nZCwgc20pOwogICAgICAgICAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwg\nJiYgIW9yaWcuaXNEZWxldGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCksIG9yaWcpOwogICAgICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgiZHVwLW9pZC1hc3NpZ24iLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgc20uZ2V0T2JqZWN0SWQoKSwgRXhjZXB0aW9ucy50b1N0cmluZwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNtLmdldE1hbmFnZWRJbnN0\nYW5jZSgpKSkpLnNldEZhaWxlZE9iamVjdAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKS5zZXRGYXRhbCh0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIG9pZCBjaGFuZ2VkLCBzbyBpdCBtdXN0IHByZXZpb3VzbHkg\naGF2ZSBiZWVuIGEgbmV3IGluc3RhbmNlCiAgICAgICAgICAgIC8vIHdpdGhv\ndXQgYW4gYXNzaWduZWQgb2lkLiAgcmVtb3ZlIGl0IGZyb20gdGhlIG5ldyBj\nYWNoZTsgb2sgaWYKICAgICAgICAgICAgLy8gd2UgZW5kIHVwIHJlbW92aW5n\nIGFub3RoZXIgaW5zdGFuY2Ugd2l0aCBzYW1lIGlkCiAgICAgICAgICAgIGlm\nIChfbmV3cyAhPSBudWxsKQogICAgICAgICAgICAgICAgX25ld3MucmVtb3Zl\nKGlkKTsKCiAgICAgICAgICAgIC8vIGFuZCBwdXQgaW50byBtYWluIGNhY2hl\nIG5vdyB0aGF0IGlkIGlzIGFzc3NpZ25lZAogICAgICAgICAgICBvcmlnID0g\nKFN0YXRlTWFuYWdlckltcGwpIF9tYWluLnB1dChzbS5nZXRPYmplY3RJZCgp\nLCBzbSk7CiAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwgJiYgb3JpZyAh\nPSBzbSAmJiAhb3JpZy5pc0RlbGV0ZWQoKSkgewogICAgICAgICAgICAgICAg\nLy8gcHV0IGJhY2sgb3JpZyBhbmQgdGhyb3cgZXJyb3IKICAgICAgICAgICAg\nICAgIF9tYWluLnB1dChzbS5nZXRPYmplY3RJZCgpLCBvcmlnKTsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJk\ndXAtb2lkLWFzc2lnbiIsCiAgICAgICAgICAgICAgICAgICAgc20uZ2V0T2Jq\nZWN0SWQoKSwgRXhjZXB0aW9ucy50b1N0cmluZwogICAgICAgICAgICAgICAg\nICAgIChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpKS5zZXRGYWlsZWRPYmpl\nY3QKICAgICAgICAgICAgICAgICAgICAoc20uZ2V0TWFuYWdlZEluc3RhbmNl\nKCkpLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCBj\nYWNoZWQgcGVyc2lzdGVudCBvYmplY3RzLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyBDb2xsZWN0aW9uIGNvcHkoKSB7CiAgICAgICAgICAgIC8vIHBy\nb3hpZXMgbm90IGluY2x1ZGVkIGhlcmUgYmVjYXVzZSB0aGUgc3RhdGUgbWFu\nYWdlciBpcyBhbHdheXMKICAgICAgICAgICAgLy8gcHJlc2VudCBpbiBvdGhl\nciBjYWNoZXMgdG9vCgogICAgICAgICAgICBpbnQgc2l6ZSA9IF9tYWluLnNp\nemUoKTsKICAgICAgICAgICAgaWYgKF9jb25mbGljdHMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHNpemUgKz0gX2NvbmZsaWN0cy5zaXplKCk7CiAgICAg\nICAgICAgIGlmIChfbmV3cyAhPSBudWxsKQogICAgICAgICAgICAgICAgc2l6\nZSArPSBfbmV3cy5zaXplKCk7CiAgICAgICAgICAgIGlmIChfZW1iZWRzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBzaXplICs9IF9lbWJlZHMuc2l6ZSgp\nOwogICAgICAgICAgICBpZiAoc2l6ZSA9PSAwKQogICAgICAgICAgICAgICAg\ncmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CgogICAgICAgICAgICBM\naXN0IGNvcHkgPSBuZXcgQXJyYXlMaXN0KHNpemUpOwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IF9tYWluLnZhbHVlcygpLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgY29weS5hZGQoaXRy\nLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChfY29uZmxpY3RzICE9IG51bGwg\nJiYgIV9jb25mbGljdHMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBfY29uZmxpY3RzLnZhbHVlcygpLml0ZXJhdG9y\nKCk7CiAgICAgICAgICAgICAgICAgICAgaXRyLmhhc05leHQoKTspCiAgICAg\nICAgICAgICAgICAgICAgY29weS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAg\nICAgIGlmIChfbmV3cyAhPSBudWxsICYmICFfbmV3cy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9uZXdzLnZhbHVl\ncygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAg\nICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOwogICAgICAgICAgICBpZiAo\nX2VtYmVkcyAhPSBudWxsICYmICFfZW1iZWRzLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2VtYmVkcy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICBjb3B5\nLmFkZChpdHIubmV4dCgpKTsKICAgICAgICAgICAgcmV0dXJuIGNvcHk7CiAg\nICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDbGVhciB0aGUgY2Fj\naGUuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgY2xlYXIoKSB7\nCiAgICAgICAgICAgIF9tYWluLmNsZWFyKCk7CiAgICAgICAgICAgIGlmIChf\nY29uZmxpY3RzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfY29uZmxpY3Rz\nLmNsZWFyKCk7CiAgICAgICAgICAgIGlmIChfbmV3cyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX25ld3MuY2xlYXIoKTsKICAgICAgICAgICAgaWYgKF9l\nbWJlZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9lbWJlZHMuY2xlYXIo\nKTsKICAgICAgICAgICAgaWYgKF91bnRyYWNrZWQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF91bnRyYWNrZWQuY2xlYXIoKTsKICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIENsZWFyIG5ldyBpbnN0YW5jZXMgd2l0aG91\ndCBwZXJtYW5lbnQgb2lkcy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMg\ndm9pZCBjbGVhck5ldygpIHsKICAgICAgICAgICAgaWYgKF9uZXdzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBfbmV3cy5jbGVhcigpOwogICAgICAgIH0K\nCiAgICAgICAgcHJpdmF0ZSB2b2lkIGRpcnR5Q2hlY2soKSB7CiAgICAgICAg\nICAgIGlmIChfdW50cmFja2VkID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBfdW50\ncmFja2VkLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOyApCiAgICAgICAg\nICAgICAgICAoKFN0YXRlTWFuYWdlckltcGwpIGl0ZXIubmV4dCgpKS5kaXJ0\neUNoZWNrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVHJh\nbnNhY3Rpb25hbCBjYWNoZSB0aGF0IGhvbGRzIHNvZnQgcmVmcyB0byBjbGVh\nbiBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNz\nIFRyYW5zYWN0aW9uYWxDYWNoZQogICAgICAgIGltcGxlbWVudHMgU2V0IHsK\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9vcmRlckRpcnR5Owog\nICAgICAgIHByaXZhdGUgU2V0IF9kaXJ0eSA9IG51bGw7CiAgICAgICAgcHJp\ndmF0ZSBTZXQgX2NsZWFuID0gbnVsbDsKCiAgICAgICAgcHVibGljIFRyYW5z\nYWN0aW9uYWxDYWNoZShib29sZWFuIG9yZGVyRGlydHkpIHsKICAgICAgICAg\nICAgX29yZGVyRGlydHkgPSBvcmRlckRpcnR5OwogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgdHJhbnNh\nY3Rpb25hbCBzdGF0ZSBtYW5hZ2Vycy4KICAgICAgICAgKi8KICAgICAgICBw\ndWJsaWMgQ29sbGVjdGlvbiBjb3B5KCkgewogICAgICAgICAgICBpZiAoaXNF\nbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVN\nUFRZX0xJU1Q7CgogICAgICAgICAgICAvLyBzaXplIG1heSBub3QgYmUgZW50\naXJlbHkgYWNjdXJhdGUgZHVlIHRvIHJlZnMgZXhwaXJpbmcsIHNvCiAgICAg\nICAgICAgIC8vIG1hbnVhbGx5IGNvcHkgZWFjaCBvYmplY3Q7IGRvZXNuJ3Qg\nbWF0dGVyIHRoaXMgd2F5IGlmIHNpemUgdG9vCiAgICAgICAgICAgIC8vIGJp\nZyBieSBzb21lCiAgICAgICAgICAgIExpc3QgY29weSA9IG5ldyBBcnJheUxp\nc3Qoc2l6ZSgpKTsKICAgICAgICAgICAgaWYgKF9kaXJ0eSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZGlydHkuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAg\nY29weS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChfY2xlYW4g\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nX2NsZWFuLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAg\nICAgICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOwogICAgICAgICAgICBy\nZXR1cm4gY29weTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIFJldHVybiBhIGNvcHkgb2YgYWxsIGRpcnR5IHN0YXRlIG1hbmFnZXJzLgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyBDb2xsZWN0aW9uIGNvcHlEaXJ0\neSgpIHsKICAgICAgICAgICAgaWYgKF9kaXJ0eSA9PSBudWxsIHx8IF9kaXJ0\neS5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlv\nbnMuRU1QVFlfTElTVDsKICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheUxp\nc3QoX2RpcnR5KTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIFRyYW5zZmVyIHRoZSBnaXZlbiBpbnN0YW5jZSBmcm9tIHRoZSBkaXJ0eSBj\nYWNoZSB0byB0aGUgY2xlYW4gY2FjaGUuCiAgICAgICAgICovCiAgICAgICAg\ncHVibGljIHZvaWQgZmx1c2hlZChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAg\nICAgICAgICAgIGlmIChzbS5pc0RpcnR5KCkgJiYgX2RpcnR5ICE9IG51bGwg\nJiYgX2RpcnR5LnJlbW92ZShzbSkpCiAgICAgICAgICAgICAgICBhZGRDbGVh\nbkludGVybmFsKHNtKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIEFkZCB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhlIGNsZWFuIGNhY2hl\nLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFkZENsZWFuKFN0\nYXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAgaWYgKGFkZENsZWFu\nSW50ZXJuYWwoc20pICYmIF9kaXJ0eSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX2RpcnR5LnJlbW92ZShzbSk7CiAgICAgICAgfQoKICAgICAgICBwcml2\nYXRlIGJvb2xlYW4gYWRkQ2xlYW5JbnRlcm5hbChTdGF0ZU1hbmFnZXJJbXBs\nIHNtKSB7CiAgICAgICAgICAgIGlmIChfY2xlYW4gPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9jbGVhbiA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJlZmVy\nZW5jZUhhc2hTZXQuU09GVCk7CiAgICAgICAgICAgIHJldHVybiBfY2xlYW4u\nYWRkKHNtKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEFk\nZCB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhlIGRpcnR5IGNhY2hlLgogICAg\nICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFkZERpcnR5KFN0YXRlTWFu\nYWdlckltcGwgc20pIHsKICAgICAgICAgICAgaWYgKF9kaXJ0eSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBpZiAoX29yZGVyRGlydHkpCiAgICAgICAg\nICAgICAgICAgICAgX2RpcnR5ID0gTWFwQmFja2VkU2V0LmRlY29yYXRlKG5l\ndyBMaW5rZWRNYXAoKSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgX2RpcnR5ID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBpZiAoX2RpcnR5LmFkZChzbSkpCiAgICAgICAg\nICAgICAgICByZW1vdmVDbGVhbkludGVybmFsKHNtKTsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gaW5zdGFu\nY2UgZnJvbSB0aGUgY2FjaGUuCiAgICAgICAgICovCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gcmVtb3ZlKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAg\nICAgICAgcmV0dXJuIHJlbW92ZUNsZWFuSW50ZXJuYWwoc20pCiAgICAgICAg\nICAgICAgICB8fCAoX2RpcnR5ICE9IG51bGwgJiYgX2RpcnR5LnJlbW92ZShz\nbSkpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIHJlbW92\nZUNsZWFuSW50ZXJuYWwoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAg\nICAgICByZXR1cm4gX2NsZWFuICE9IG51bGwgJiYgX2NsZWFuLnJlbW92ZShz\nbSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSXRlcmF0b3IgaXRlcmF0\nb3IoKSB7CiAgICAgICAgICAgIEl0ZXJhdG9yQ2hhaW4gY2hhaW4gPSBuZXcg\nSXRlcmF0b3JDaGFpbigpOwogICAgICAgICAgICBpZiAoX2RpcnR5ICE9IG51\nbGwgJiYgIV9kaXJ0eS5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBjaGFp\nbi5hZGRJdGVyYXRvcihfZGlydHkuaXRlcmF0b3IoKSk7CiAgICAgICAgICAg\nIGlmIChfY2xlYW4gIT0gbnVsbCAmJiAhX2NsZWFuLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgICAgIGNoYWluLmFkZEl0ZXJhdG9yKF9jbGVhbi5pdGVyYXRv\ncigpKTsKICAgICAgICAgICAgcmV0dXJuIGNoYWluOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnMoT2JqZWN0IG9iaikgewog\nICAgICAgICAgICByZXR1cm4gKF9kaXJ0eSAhPSBudWxsICYmIF9kaXJ0eS5j\nb250YWlucyhvYmopKQogICAgICAgICAgICAgICAgfHwgKF9jbGVhbiAhPSBu\ndWxsICYmIF9jbGVhbi5jb250YWlucyhvYmopKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zQWxsKENvbGxlY3Rpb24gY29s\nbCkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNvbGwuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICBpZiAo\nIWNvbnRhaW5zKGl0ci5uZXh0KCkpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICAgICAg\naWYgKF9kaXJ0eSAhPSBudWxsKQogICAgICAgICAgICAgICAgX2RpcnR5LmNs\nZWFyKCk7CiAgICAgICAgICAgIGlmIChfY2xlYW4gIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9jbGVhbi5jbGVhcigpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIChfZGlydHkgPT0gbnVsbCB8fCBfZGlydHkuaXNFbXB0eSgpKQogICAgICAg\nICAgICAgICAgJiYgKF9jbGVhbiA9PSBudWxsIHx8IF9jbGVhbi5pc0VtcHR5\nKCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBzaXplKCkgewog\nICAgICAgICAgICBpbnQgc2l6ZSA9IDA7CiAgICAgICAgICAgIGlmIChfZGly\ndHkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNpemUgKz0gX2RpcnR5LnNp\nemUoKTsKICAgICAgICAgICAgaWYgKF9jbGVhbiAhPSBudWxsKQogICAgICAg\nICAgICAgICAgc2l6ZSArPSBfY2xlYW4uc2l6ZSgpOwogICAgICAgICAgICBy\nZXR1cm4gc2l6ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFu\nIGFkZChPYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1\ncHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gYWRkQWxsKENvbGxlY3Rpb24gY29sbCkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNl\ncHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIHJl\nbW92ZShPYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1\ncHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlQWxsKENvbGxlY3Rpb24gY29sbCkg\newogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25F\neGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFu\nIHJldGFpbkFsbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheSgpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9u\nKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJh\neShPYmplY3RbXSBhcnIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVW5pcXVlIGlkIGZvciBzdGF0ZSBtYW5hZ2VycyBv\nZiBuZXcgZGF0YXN0b3JlIGluc3RhbmNlcyB3aXRob3V0IGFzc2lnbmVkCiAg\nICAgKiBvYmplY3QgaWRzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBj\nbGFzcyBTdGF0ZU1hbmFnZXJJZAogICAgICAgIGltcGxlbWVudHMgU2VyaWFs\naXphYmxlIHsKCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nU1RSSU5HX1BSRUZJWCA9ICJvcGVuanBhc206IjsKCiAgICAgICAgcHJpdmF0\nZSBzdGF0aWMgbG9uZyBfZ2VuZXJhdG9yID0gMDsKCiAgICAgICAgcHJpdmF0\nZSBmaW5hbCBpbnQgX2JoYXNoOwogICAgICAgIHByaXZhdGUgZmluYWwgbG9u\nZyBfaWQ7CgogICAgICAgIHB1YmxpYyBzdGF0aWMgU3RhdGVNYW5hZ2VySWQg\nbmV3SW5zdGFuY2UoQnJva2VyIGIpIHsKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBTdGF0ZU1hbmFnZXJJZChTeXN0ZW0uaWRlbnRpdHlIYXNoQ29kZShiKSwg\nX2dlbmVyYXRvcisrKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgU3Rh\ndGVNYW5hZ2VySWQoaW50IGJoYXNoLCBsb25nIGlkKSB7CiAgICAgICAgICAg\nIF9iaGFzaCA9IGJoYXNoOwogICAgICAgICAgICBfaWQgPSBpZDsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBTdGF0ZU1hbmFnZXJJZChTdHJpbmcgc3Ry\nKSB7CiAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoU1RSSU5HX1BS\nRUZJWC5sZW5ndGgoKSk7CiAgICAgICAgICAgIGludCBpZHggPSBzdHIuaW5k\nZXhPZignOicpOwogICAgICAgICAgICBfYmhhc2ggPSBJbnRlZ2VyLnBhcnNl\nSW50KHN0ci5zdWJzdHJpbmcoMCwgaWR4KSk7CiAgICAgICAgICAgIF9pZCA9\nIExvbmcucGFyc2VMb25nKHN0ci5zdWJzdHJpbmcoaWR4ICsgMSkpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBv\ndGhlcikgewogICAgICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoIShvdGhl\nciBpbnN0YW5jZW9mIFN0YXRlTWFuYWdlcklkKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySWQgc2lk\nID0gKFN0YXRlTWFuYWdlcklkKSBvdGhlcjsKICAgICAgICAgICAgcmV0dXJu\nIF9iaGFzaCA9PSBzaWQuX2JoYXNoICYmIF9pZCA9PSBzaWQuX2lkOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAg\nICAgICAgcmV0dXJuIChpbnQpIChfaWQgXiAoX2lkID4+PiAzMikpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICAgICAgcmV0dXJuIFNUUklOR19QUkVGSVggKyBfYmhhc2ggKyAiOiIg\nKyBfaWQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29sbGVj\ndGlvbiB0eXBlIHRoYXQgaG9sZHMgc3RhdGUgbWFuYWdlcnMgYnV0IHdob3Nl\nIGludGVyZmFjZSBkZWFscwogICAgICogd2l0aCB0aGUgY29ycmVzcG9uZGlu\nZyBtYW5hZ2VkIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uCiAgICAgICAgZXh0ZW5k\ncyBBYnN0cmFjdENvbGxlY3Rpb24gewoKICAgICAgICBwcml2YXRlIGZpbmFs\nIENvbGxlY3Rpb24gX3N0YXRlczsKCiAgICAgICAgcHVibGljIE1hbmFnZWRP\nYmplY3RDb2xsZWN0aW9uKENvbGxlY3Rpb24gc3RhdGVzKSB7CiAgICAgICAg\nICAgIF9zdGF0ZXMgPSBzdGF0ZXM7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgQ29sbGVjdGlvbiBnZXRTdGF0ZU1hbmFnZXJzKCkgewogICAgICAgICAg\nICByZXR1cm4gX3N0YXRlczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBp\nbnQgc2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdGF0ZXMuc2l6ZSgp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEl0ZXJhdG9yIGl0ZXJhdG9y\nKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEl0ZXJhdG9yKCkgewogICAg\nICAgICAgICAgICAgcHJpdmF0ZSBmaW5hbCBJdGVyYXRvciBfaXRyID0gX3N0\nYXRlcy5pdGVyYXRvcigpOwoKICAgICAgICAgICAgICAgIHB1YmxpYyBib29s\nZWFuIGhhc05leHQoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9p\ndHIuaGFzTmV4dCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgIHB1YmxpYyBPYmplY3QgbmV4dCgpIHsKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gKChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBfaXRyLm5leHQoKSku\nCiAgICAgICAgICAgICAgICAgICAgICAgIGdldE1hbmFnZWRJbnN0YW5jZSgp\nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHJlbW92ZSgpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

