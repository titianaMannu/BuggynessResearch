{"sha":"f868bb5f6761ca3c9629d7b63c61bfeb11c5fdc7","node_id":"MDQ6QmxvYjIwNjM2NDpmODY4YmI1ZjY3NjFjYTNjOTYyOWQ3YjYzYzYxYmZlYjExYzVmZGM3","size":29529,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f868bb5f6761ca3c9629d7b63c61bfeb11c5fdc7","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0\nIGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkRhdGU7\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVj\ndGlvbnMubWFwLklkZW50aXR5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuRGV0YWNoT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5ldmVudC5DYWxsYmFja01vZGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2FsbGJhY2tFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlByb3h5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveHlNYW5hZ2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlv\nbjsKCi8qKgogKiBIYW5kbGVzIGRldGFjaGluZyBpbnN0YW5jZXMuCiAqCiAq\nIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAqIEBub2phdmFkb2MKICov\nCnB1YmxpYyBjbGFzcyBEZXRhY2hNYW5hZ2VyCiAgICBpbXBsZW1lbnRzIERl\ndGFjaFN0YXRlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKERldGFjaE1hbmFnZXIuY2xhc3Mp\nOwoKICAgIHByaXZhdGUgZmluYWwgQnJva2VySW1wbCBfYnJva2VyOwogICAg\ncHJpdmF0ZSBmaW5hbCBib29sZWFuIF9jb3B5OwogICAgcHJpdmF0ZSBmaW5h\nbCBib29sZWFuIF9mdWxsOwogICAgcHJpdmF0ZSBmaW5hbCBQcm94eU1hbmFn\nZXIgX3Byb3h5OwogICAgcHJpdmF0ZSBmaW5hbCBEZXRhY2hPcHRpb25zIF9v\ncHRzOwogICAgcHJpdmF0ZSBmaW5hbCBPcENhbGxiYWNrcyBfY2FsbDsKICAg\nIHByaXZhdGUgZmluYWwgYm9vbGVhbiBfZmFpbEZhc3Q7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2ZsdXNoZWQgPSBmYWxzZTsKCiAgICAvLyBpZiB3ZSdyZSBu\nb3QgZGV0YWNoaW5nIGZ1bGwsIHdlIG5lZWQgdG8gdHJhY2sgYWxsIGRldGFj\naGVkIG9iamVjdHM7CiAgICAvLyBpZiB3ZSBhcmUsIHRoZW4gd2UgdXNlIGEg\nc3BlY2lhbCBmaWVsZCBtYW5hZ2VyIGZvciBtb3JlIGVmZmljaWVudAogICAg\nLy8gZGV0YWNobWVudCB0aGFuIHRoZSBzdGFuZGFyZCBvbmUKICAgIHByaXZh\ndGUgZmluYWwgSWRlbnRpdHlNYXAgX2RldGFjaGVkOwogICAgcHJpdmF0ZSBm\naW5hbCBEZXRhY2hGaWVsZE1hbmFnZXIgX2Z1bGxGTTsKCiAgICAvKioKICAg\nICAqIFVzZWQgdG8gcHJlcGFyZSBhIGRldGFjaGFibGUgaW5zdGFuY2UgdGhh\ndCBkb2VzIG5vdCBleHRlcm5hbGl6ZQogICAgICogZGV0YWNoZWQgc3RhdGUu\nCiAgICAgKi8KICAgIHN0YXRpYyBib29sZWFuIHByZVNlcmlhbGl6ZShTdGF0\nZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgaWYgKCFzbS5pc1BlcnNpc3Rl\nbnQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBmbHVz\naERpcnR5KHNtKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gc20u\nZ2V0TWV0YURhdGEoKTsKICAgICAgICBib29sZWFuIHNldFN0YXRlID0gbWV0\nYS5nZXREZXRhY2hlZFN0YXRlKCkgIT0gbnVsbAogICAgICAgICAgICAmJiAh\nQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKG1ldGEuZ2V0RGV0YWNo\nZWRTdGF0ZSgpKTsKICAgICAgICBCaXRTZXQgaWR4cyA9IChzZXRTdGF0ZSkg\nPyBuZXcgQml0U2V0KG1ldGEuZ2V0RmllbGRzKCkubGVuZ3RoKSA6IG51bGw7\nCiAgICAgICAgcHJlRGV0YWNoKHNtLmdldEJyb2tlcigpLCBzbSwgaWR4cyk7\nCgogICAgICAgIGlmIChzZXRTdGF0ZSkgewogICAgICAgICAgICBzbS5nZXRQ\nZXJzaXN0ZW5jZUNhcGFibGUoKS5wY1NldERldGFjaGVkU3RhdGUoZ2V0RGV0\nYWNoZWRTdGF0ZQogICAgICAgICAgICAgICAgKHNtLCBpZHhzKSk7CiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsgLy8gZG9uJ3QgbnVsbCBzdGF0ZQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFVzZWQgYnkgY2xhc3NlcyB0aGF0IGV4dGVybmFsaXplIGRldGFjaGVk\nIHN0YXRlLgogICAgICoKICAgICAqIEByZXR1cm4gd2hldGhlciB0byB1c2Ug\nYSBkZXRhY2hlZCBzdGF0ZSBtYW5hZ2VyCiAgICAgKi8KICAgIHN0YXRpYyBi\nb29sZWFuIHdyaXRlRGV0YWNoZWRTdGF0ZShTdGF0ZU1hbmFnZXJJbXBsIHNt\nLCBPYmplY3RPdXRwdXQgb3V0LAogICAgICAgIEJpdFNldCBpZHhzKQogICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFzbS5pc1Bl\ncnNpc3RlbnQoKSkgewogICAgICAgICAgICBvdXQud3JpdGVPYmplY3QobnVs\nbCk7IC8vIHN0YXRlCiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChudWxs\nKTsgLy8gc20KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nCiAgICAgICAgLy8gZGlydHkgc3RhdGUgY2F1c2VzIGZsdXNoCiAgICAgICAg\nZmx1c2hEaXJ0eShzbSk7CgogICAgICAgIEJyb2tlciBicm9rZXIgPSBzbS5n\nZXRCcm9rZXIoKTsKICAgICAgICBwcmVEZXRhY2goYnJva2VyLCBzbSwgaWR4\ncyk7CgogICAgICAgIC8vIHdyaXRlIGRldGFjaGVkIHN0YXRlIG9iamVjdCBh\nbmQgc3RhdGUgbWFuYWdlcgogICAgICAgIERldGFjaE9wdGlvbnMgb3B0cyA9\nIGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldERl\ndGFjaFN0YXRlSW5zdGFuY2UoKTsKICAgICAgICBpZiAoIW9wdHMuZ2V0RGV0\nYWNoZWRTdGF0ZU1hbmFnZXIoKQogICAgICAgICAgICB8fCAhdXNlRGV0YWNo\nZWRTdGF0ZU1hbmFnZXIoc20sIG9wdHMpKSB7CiAgICAgICAgICAgIG91dC53\ncml0ZU9iamVjdChnZXREZXRhY2hlZFN0YXRlKHNtLCBpZHhzKSk7CiAgICAg\nICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBvdXQud3JpdGVPYmplY3Qo\nbnVsbCk7CiAgICAgICAgb3V0LndyaXRlT2JqZWN0KG5ldyBEZXRhY2hlZFN0\nYXRlTWFuYWdlcihzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSwKICAgICAg\nICAgICAgc20sIGlkeHMsIG9wdHMuZ2V0QWNjZXNzVW5sb2FkZWQoKSwgYnJv\na2VyLmdldE11bHRpdGhyZWFkZWQoKSkpOwogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZHkgdGhlIG9iamVjdCBmb3Ig\nZGV0YWNobWVudCwgaW5jbHVkaW5nIGxvYWRpbmcgdGhlIGZpZWxkcyB0byBi\nZQogICAgICogZGV0YWNoZWQgYW5kIHVwZGF0aW5nIHZlcnNpb24gaW5mb3Jt\nYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGlkeHMgdGhlIGluZGV4ZXMg\nb2YgZmllbGRzIHRvIGRldGFjaCB3aWxsIGJlIHNldCBhcyBhIHNpZGUKICAg\nICAqIGVmZmVjdCBvZiB0aGlzIG1ldGhvZAogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyB2b2lkIHByZURldGFjaChCcm9rZXIgYnJva2VyLCBTdGF0ZU1h\nbmFnZXJJbXBsIHNtLAogICAgICAgIEJpdFNldCBpZHhzKSB7CiAgICAgICAg\nLy8gbWFrZSBzdXJlIHRoZSBleGlzdGluZyBvYmplY3QgaGFzIHRoZSByaWdo\ndCBmaWVsZHMgZmV0Y2hlZDsgY2FsbAogICAgICAgIC8vIGV2ZW4gaWYgdXNp\nbmcgY3VycmVudGx5LWxvYWRlZCBmaWVsZHMgZm9yIGRldGFjaCB0byBtYWtl\nIHN1cmUKICAgICAgICAvLyB2ZXJzaW9uIGlzIHNldAogICAgICAgIGludCBk\nZXRhY2hNb2RlID0gYnJva2VyLmdldERldGFjaFN0YXRlKCk7CiAgICAgICAg\naW50IGxvYWRNb2RlID0gU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUzsKICAg\nICAgICBCaXRTZXQgZXhjbHVkZSA9IG51bGw7CiAgICAgICAgaWYgKGRldGFj\naE1vZGUgPT0gREVUQUNIX0xPQURFRCkKICAgICAgICAgICAgZXhjbHVkZSA9\nIFN0b3JlQ29udGV4dC5FWENMVURFX0FMTDsKICAgICAgICBlbHNlIGlmIChk\nZXRhY2hNb2RlID09IERFVEFDSF9BTEwpCiAgICAgICAgICAgIGxvYWRNb2Rl\nID0gU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0FMTDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBzbS5sb2FkKGJyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRp\nb24oKSwgbG9hZE1vZGUsIGV4Y2x1ZGUsIG51bGwsIAogICAgICAgICAgICAg\nICAgZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhj\nZXB0aW9uIG9uZmUpIHsKICAgICAgICAgICAgLy8gY29uc3VtZSB0aGUgZXhj\nZXB0aW9uCiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgYml0c2V0IG9m\nIGZpZWxkcyB0byBkZXRhY2g7IGlmIG1vZGUgaXMgYWxsIHdlIGNhbiB1c2UK\nICAgICAgICAvLyBjdXJyZW50bHkgbG9hZGVkIGJpdHNldCBjbG9uZSwgc2lu\nY2Ugd2Uga25vdyBhbGwgZmllbGRzIGFyZSBsb2FkZWQKICAgICAgICBpZiAo\naWR4cyAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChkZXRhY2hNb2RlID09\nIERFVEFDSF9GRVRDSF9HUk9VUFMpCiAgICAgICAgICAgICAgICBzZXRGZXRj\naEdyb3VwRmllbGRzKGJyb2tlciwgc20sIGlkeHMpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBpZHhzLm9yKHNtLmdldExvYWRlZCgpKTsK\nCiAgICAgICAgICAgIC8vIGNsZWFyIGxycyBmaWVsZHMKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBzbS5nZXRNZXRhRGF0YSgpLmdldEZp\nZWxkcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5pc0xS\nUygpKQogICAgICAgICAgICAgICAgICAgIGlkeHMuY2xlYXIoaSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgdGhlIGRldGFj\naGVkIHN0YXRlIGZvciB0aGUgZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIE9iamVjdCBnZXREZXRhY2hlZFN0YXRlKFN0YXRl\nTWFuYWdlckltcGwgc20sIEJpdFNldCBmaWVsZHMpIHsKICAgICAgICAvLyBp\nZiBkYXRhc3RvcmUsIHN0b3JlIGlkIGluIGZpcnN0IGVsZW1lbnQKICAgICAg\nICBpbnQgb2Zmc2V0ID0gKHNtLmdldE1ldGFEYXRhKCkuZ2V0SWRlbnRpdHlU\neXBlKCkgPT0KICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RP\nUkUpID8gMSA6IDA7CgogICAgICAgIC8vIG1ha2UgdmVyc2lvbiBzdGF0ZSBh\ncnJheSBvbmUgbGFyZ2VyIGZvciBuZXcgaW5zdGFuY2VzOyBtYXJrcyBuZXcK\nICAgICAgICAvLyBpbnN0YW5jZXMgd2l0aG91dCBhZmZlY3Rpbmcgc2VyaWFs\naXphdGlvbiBzaXplIG11Y2gKICAgICAgICBPYmplY3RbXSBzdGF0ZTsKICAg\nICAgICBpZiAoc20uaXNOZXcoKSkKICAgICAgICAgICAgc3RhdGUgPSBuZXcg\nT2JqZWN0WzMgKyBvZmZzZXRdOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc3RhdGUgPSBuZXcgT2JqZWN0WzIgKyBvZmZzZXRdOwoKICAgICAgICBpZiAo\nb2Zmc2V0ID4gMCkgewogICAgICAgICAgICBPYmplY3QgaWQ7CiAgICAgICAg\nICAgIGlmIChzbS5pc0VtYmVkZGVkKCkgfHwgc20uZ2V0T2JqZWN0SWQoKSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgaWQgPSBzbS5nZXRJZCgpOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBpZCA9IHNtLmdldE9iamVj\ndElkKCk7CiAgICAgICAgICAgIHN0YXRlWzBdID0gaWQudG9TdHJpbmcoKTsK\nICAgICAgICB9CiAgICAgICAgc3RhdGVbb2Zmc2V0XSA9IHNtLmdldFZlcnNp\nb24oKTsKICAgICAgICBzdGF0ZVtvZmZzZXQgKyAxXSA9IGZpZWxkczsKICAg\nICAgICByZXR1cm4gc3RhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVz\naCBvciBpbnZva2UgcHJlLXN0b3JlIGNhbGxiYWNrcyBvbiB0aGUgZ2l2ZW4g\nYnJva2VyIGlmCiAgICAgKiBuZWVkZWQuIFJldHVybiB0cnVlIGlmIGZsdXNo\nZWQvc3RvcmVkLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGJvb2xlYW4gZmx1c2hEaXJ0eShTdGF0ZU1hbmFnZXJJbXBs\nIHNtKSB7CiAgICAgICAgaWYgKCFzbS5pc0RpcnR5KCkgfHwgIXNtLmdldEJy\nb2tlcigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgLy8gb25seSBmbHVzaCBpZiB0aGVyZSBhcmUgYWN0dWFsbHkg\nYW55IGRpcnR5IG5vbi1mbHVzaGVkIGZpZWxkcwogICAgICAgIEJpdFNldCBk\naXJ0eUZpZWxkcyA9IHNtLmdldERpcnR5KCk7CiAgICAgICAgQml0U2V0IGZs\ndXNoZWRGaWVsZHMgPSBzbS5nZXRGbHVzaGVkKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBkaXJ0eUZpZWxkcy5zaXplKCk7IGkrKykgewogICAg\nICAgICAgICBpZiAoZGlydHlGaWVsZHMuZ2V0KGkpICYmICFmbHVzaGVkRmll\nbGRzLmdldChpKSkgewogICAgICAgICAgICAgICAgaWYgKHNtLmdldEJyb2tl\ncigpLmdldFJvbGxiYWNrT25seSgpKQogICAgICAgICAgICAgICAgICAgIHNt\nLmdldEJyb2tlcigpLnByZUZsdXNoKCk7CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgc20uZ2V0QnJva2VyKCkuZmx1c2goKTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSBhIGJpdCBzZXQgZm9yIHRoZSBmaWVsZHMgaW4gdGhl\nIGN1cnJlbnQgZmV0Y2ggZ3JvdXBzLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyB2b2lkIHNldEZldGNoR3JvdXBGaWVsZHMoQnJva2VyIGJyb2tlciwK\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtLCBCaXRTZXQgaWR4cykgewog\nICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9IGJyb2tlci5nZXRG\nZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChmbWRzW2ldLmlzUHJpbWFyeUtleSgpIHx8IGZldGNoLnJl\ncXVpcmVzRmV0Y2goZm1kc1tpXSkKICAgICAgICAgICAgICAgICE9IEZldGNo\nQ29uZmlndXJhdGlvbi5GRVRDSF9OT05FKQogICAgICAgICAgICAgICAgaWR4\ncy5zZXQoaSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29u\nc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGJyb2tlciBvd25pbmcg\nYnJva2VyCiAgICAgKiBAcGFyYW0gZnVsbCB3aGV0aGVyIHRoZSBlbnRpcmUg\nYnJva2VyIGNhY2hlIGlzIGJlaW5nIGRldGFjaGVkOyBpZgogICAgICogdGhp\ncyBpcyB0aGUgY2FzZSwgd2UgYXNzdW1lIHRoZSBicm9rZXIgaGFzIGFscmVh\nZHkKICAgICAqIGZsdXNoZWQgaWYgbmVlZGVkLCBhbmQgdGhhdCB3ZSdyZSBk\nZXRhY2hpbmcgaW4tcGxhY2UKICAgICAqLwogICAgcHVibGljIERldGFjaE1h\nbmFnZXIoQnJva2VySW1wbCBicm9rZXIsIGJvb2xlYW4gZnVsbCwgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIF9icm9rZXIgPSBicm9rZXI7CiAgICAg\nICAgX3Byb3h5ID0gYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRQcm94\neU1hbmFnZXJJbnN0YW5jZSgpOwogICAgICAgIF9vcHRzID0gYnJva2VyLmdl\ndENvbmZpZ3VyYXRpb24oKS5nZXREZXRhY2hTdGF0ZUluc3RhbmNlKCk7CiAg\nICAgICAgX2NvcHkgPSAhZnVsbDsKICAgICAgICBfZmx1c2hlZCA9IGZ1bGw7\nCiAgICAgICAgX2NhbGwgPSBjYWxsOwogICAgICAgIF9mYWlsRmFzdCA9IChi\ncm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldE1ldGFEYXRhUmVwb3NpdG9y\neUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgp\nLmdldERlZmF1bHRzKCkuZ2V0Q2FsbGJhY2tNb2RlKCkKICAgICAgICAgICAg\nJiBDYWxsYmFja01vZGVzLkNBTExCQUNLX0ZBSUxfRkFTVCkgIT0gMDsKCiAg\nICAgICAgLy8gd2UgY2FuIG9ubHkgcmVseSBvbiBvdXIgImFsbCIgc2hvcnRj\ndXRzIGlmIHdlIGtub3cgd2Ugd29uJ3QgYmUKICAgICAgICAvLyBsb2FkaW5n\nIGFueSBtb3JlIGRhdGEKICAgICAgICBfZnVsbCA9IGZ1bGwgJiYgYnJva2Vy\nLmdldERldGFjaFN0YXRlKCkgPT0gRGV0YWNoU3RhdGUuREVUQUNIX0xPQURF\nRDsKICAgICAgICBpZiAoX2Z1bGwpIHsKICAgICAgICAgICAgX2RldGFjaGVk\nID0gbnVsbDsKICAgICAgICAgICAgX2Z1bGxGTSA9IG5ldyBEZXRhY2hGaWVs\nZE1hbmFnZXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfZGV0\nYWNoZWQgPSBuZXcgSWRlbnRpdHlNYXAoKTsKICAgICAgICAgICAgX2Z1bGxG\nTSA9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGEgZGV0YWNoZWQgdmVyc2lvbiBvZiB0aGUgZ2l2ZW4gaW5zdGFuY2Uu\nCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZGV0YWNoKE9iamVjdCB0b0Rl\ndGFjaCkgewogICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZXR1cm4gZGV0YWNoSW50ZXJuYWwodG9EZXRh\nY2gpOwogICAgICAgIH0gY2F0Y2ggKENhbGxiYWNrRXhjZXB0aW9uIGNlKSB7\nCiAgICAgICAgICAgIGV4Y2VwcyA9IG5ldyBBcnJheUxpc3QoMSk7CiAgICAg\nICAgICAgIGV4Y2Vwcy5hZGQoY2UpOwogICAgICAgICAgICByZXR1cm4gbnVs\nbDsgLy8gd29uJ3QgYmUgcmVhY2hlZCBhcyBleGNlcHRpb24gd2lsbCBiZSBy\nZXRocm93bgogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChl\neGNlcHMgPT0gbnVsbCB8fCAhX2ZhaWxGYXN0KQogICAgICAgICAgICAgICAg\nZXhjZXBzID0gaW52b2tlQWZ0ZXJEZXRhY2goQ29sbGVjdGlvbnMuc2luZ2xl\ndG9uKHRvRGV0YWNoKSwKICAgICAgICAgICAgICAgICAgICBleGNlcHMpOwog\nICAgICAgICAgICBpZiAoX2RldGFjaGVkICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfZGV0YWNoZWQuY2xlYXIoKTsKICAgICAgICAgICAgdGhyb3dFeGNl\ncHRpb25zKGV4Y2Vwcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGRldGFjaGVkIHZlcnNpb25zIG9mIGFsbCB0aGUgZ2l2ZW4g\naW5zdGFuY2VzLiBJZiBub3QgY29weWluZywKICAgICAqIG51bGwgd2lsbCBi\nZSByZXR1cm5lZC4KICAgICAqLwogICAgcHVibGljIE9iamVjdFtdIGRldGFj\naEFsbChDb2xsZWN0aW9uIGluc3RhbmNlcykgewogICAgICAgIExpc3QgZXhj\nZXBzID0gbnVsbDsKICAgICAgICBMaXN0IGRldGFjaGVkID0gbnVsbDsKICAg\nICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAgIGRldGFjaGVkID0gbmV3IEFy\ncmF5TGlzdChpbnN0YW5jZXMuc2l6ZSgpKTsKCiAgICAgICAgYm9vbGVhbiBm\nYWlsRmFzdCA9IGZhbHNlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIE9i\namVjdCBkZXRhY2g7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\naW5zdGFuY2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBkZXRhY2ggPSBkZXRhY2hJbnRlcm5hbChpdHIubmV4dCgp\nKTsKICAgICAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAg\nICAgICBkZXRhY2hlZC5hZGQoZGV0YWNoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICBpZiAocmUgaW5zdGFuY2VvZiBDYWxsYmFja0V4Y2VwdGlv\nbiAmJiBfZmFpbEZhc3QpCiAgICAgICAgICAgICAgICBmYWlsRmFzdCA9IHRy\ndWU7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoIWZhaWxGYXN0KQog\nICAgICAgICAgICAgICAgZXhjZXBzID0gaW52b2tlQWZ0ZXJEZXRhY2goaW5z\ndGFuY2VzLCBleGNlcHMpOwogICAgICAgICAgICBpZiAoX2RldGFjaGVkICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfZGV0YWNoZWQuY2xlYXIoKTsKICAg\nICAgICB9CiAgICAgICAgdGhyb3dFeGNlcHRpb25zKGV4Y2Vwcyk7CgogICAg\nICAgIGlmIChfY29weSkKICAgICAgICAgICAgcmV0dXJuIGRldGFjaGVkLnRv\nQXJyYXkoKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIEludm9rZSBwb3N0RGV0YWNoKCkgb24gYW55IGRldGFjaGVkIGlu\nc3RhbmNlcyB0aGF0IGltcGxlbWVudAogICAgICogUG9zdERldGFjaENhbGxi\nYWNrLiBUaGlzIHdpbGwgYmUgZG9uZSBhZnRlciB0aGUgZW50aXJlIGdyYXBo\nIGhhcwogICAgICogYmVlbiBkZXRhY2hlZC4gVGhpcyBtZXRob2QgaGFzIHRo\nZSBzaWRlLWVmZmVjdCBvZiBhbHNvIGNsZWFyaW5nCiAgICAgKiBvdXQgdGhl\nIG1hcCBvZiBhbGwgZGV0YWNoZWQgaW5zdGFuY2VzLgogICAgICovCiAgICBw\ncml2YXRlIExpc3QgaW52b2tlQWZ0ZXJEZXRhY2goQ29sbGVjdGlvbiBvYmpz\nLCBMaXN0IGV4Y2VwcykgewogICAgICAgIEl0ZXJhdG9yIGl0ciA9IChfZnVs\nbCkgPyBvYmpzLml0ZXJhdG9yKCkKICAgICAgICAgICAgOiBfZGV0YWNoZWQu\nZW50cnlTZXQoKS5pdGVyYXRvcigpOwoKICAgICAgICBPYmplY3Qgb3JpZywg\nZGV0YWNoZWQ7CiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIHdo\naWxlIChpdHIuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgIGlmIChfZnVsbCkg\newogICAgICAgICAgICAgICAgb3JpZyA9IGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgICAgICBkZXRhY2hlZCA9IG9yaWc7CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0\nKCk7CiAgICAgICAgICAgICAgICBvcmlnID0gZW50cnkuZ2V0S2V5KCk7CiAg\nICAgICAgICAgICAgICBkZXRhY2hlZCA9IGVudHJ5LmdldFZhbHVlKCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20g\nPSBfYnJva2VyLmdldFN0YXRlTWFuYWdlckltcGwob3JpZywgdHJ1ZSk7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBfYnJva2VyLmZpcmVMaWZlY3ljbGVF\ndmVudChkZXRhY2hlZCwgb3JpZywKICAgICAgICAgICAgICAgICAgICAgICAg\nc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQuQUZURVJfREVUQUNI\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoQ2FsbGJhY2tFeGNlcHRpb24gY2Up\nIHsKICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGNlKTsK\nICAgICAgICAgICAgICAgIGlmIChfZmFpbEZhc3QpCiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7IC8vIGRvbid0IGNvbnRpbnVlIHByb2Nlc3NpbmcKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhjZXBzOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGV4Y2VwdGlvbiB0byB0aGUg\nbGlzdC4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0IGFkZChMaXN0IGV4Y2Vw\ncywgUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgIGlmIChleGNlcHMg\nPT0gbnVsbCkKICAgICAgICAgICAgZXhjZXBzID0gbmV3IExpbmtlZExpc3Qo\nKTsKICAgICAgICBleGNlcHMuYWRkKHJlKTsKICAgICAgICByZXR1cm4gZXhj\nZXBzOwogICAgfQoKICAgIC8qKgogICAgICogVGhyb3cgYWxsIGdhdGhlcmVk\nIGV4Y2VwdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB0aHJvd0V4\nY2VwdGlvbnMoTGlzdCBleGNlcHMpIHsKICAgICAgICBpZiAoZXhjZXBzID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGV4Y2Vw\ncy5zaXplKCkgPT0gMSkKICAgICAgICAgICAgdGhyb3cgKFJ1bnRpbWVFeGNl\ncHRpb24pIGV4Y2Vwcy5nZXQoMCk7CiAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm5lc3RlZC1leGNlcHMiKSkuCiAgICAgICAg\nICAgIHNldE5lc3RlZFRocm93YWJsZXMoKFRocm93YWJsZVtdKSBleGNlcHMu\ndG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBUaHJvd2FibGVbZXhjZXBz\nLnNpemUoKV0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGFjaC4KICAg\nICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZGV0YWNoSW50ZXJuYWwoT2JqZWN0\nIHRvRGV0YWNoKSB7CiAgICAgICAgaWYgKHRvRGV0YWNoID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBhbHJlYWR5IGRl\ndGFjaGVkPwogICAgICAgIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkgewogICAg\nICAgICAgICBPYmplY3QgZGV0YWNoZWQgPSBfZGV0YWNoZWQuZ2V0KHRvRGV0\nYWNoKTsKICAgICAgICAgICAgaWYgKGRldGFjaGVkICE9IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gZGV0YWNoZWQ7CiAgICAgICAgfQoKICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gX2Jyb2tlci5nZXRTdGF0ZU1hbmFn\nZXJJbXBsKHRvRGV0YWNoLCB0cnVlKTsKICAgICAgICBpZiAoX2NhbGwgIT0g\nbnVsbCAmJiAoX2NhbGwucHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9Q\nX0RFVEFDSCwKICAgICAgICAgICAgdG9EZXRhY2gsIHNtKSAmIE9wQ2FsbGJh\nY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgIHJldHVybiB0b0RldGFj\naDsKICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIHRvRGV0YWNoOwoKICAgICAgICAvLyBDYWxsIFByZURldGFjaCBmaXJzdCBh\ncyB3ZSBjYW4ndCB0ZWxsIGlmIHRoZSBuZXcgc3lzdGVtCiAgICAgICAgLy8g\nZmlyZWQgYW4gZXZlbnQgb3IganVzdCBkaWQgbm90IGZhaWwuCiAgICAgICAg\nX2Jyb2tlci5maXJlTGlmZWN5Y2xlRXZlbnQodG9EZXRhY2gsIG51bGwsIHNt\nLmdldE1ldGFEYXRhKCksCiAgICAgICAgICAgIExpZmVjeWNsZUV2ZW50LkJF\nRk9SRV9ERVRBQ0gpOwoKICAgICAgICAvLyBhbnkgZGlydHkgaW5zdGFuY2Vz\nIGNhdXNlIGEgZmx1c2ggdG8gb2NjdXIKICAgICAgICBfZmx1c2hlZCA9IF9m\nbHVzaGVkIHx8IGZsdXNoRGlydHkoc20pOwogICAgICAgIEJpdFNldCBmaWVs\nZHMgPSBuZXcgQml0U2V0KCk7CiAgICAgICAgcHJlRGV0YWNoKF9icm9rZXIs\nIHNtLCBmaWVsZHMpOwoKICAgICAgICAvLyBjcmVhdGUgYW5kIHN0b3JlIG5l\ndyBvYmplY3QgYmVmb3JlIGNvcHkgdG8gYXZvaWQgZW5kbGVzcyByZWN1cnNp\nb24KICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBzbS5nZXRQZXJz\naXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUg\nZGV0YWNoZWRQQzsKICAgICAgICBpZiAoX2NvcHkpCiAgICAgICAgICAgIGRl\ndGFjaGVkUEMgPSBwYy5wY05ld0luc3RhbmNlKG51bGwsIHRydWUpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgZGV0YWNoZWRQQyA9IHBjOwogICAgICAg\nIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAgX2RldGFjaGVk\nLnB1dCh0b0RldGFjaCwgZGV0YWNoZWRQQyk7CgogICAgICAgIC8vIGRldGFj\naCBmaWVsZHMgYW5kIHNldCBkZXRhY2hlZCB2YXJpYWJsZXMKICAgICAgICBE\nZXRhY2hlZFN0YXRlTWFuYWdlciBkZXRTTSA9IG51bGw7CiAgICAgICAgaWYg\nKF9vcHRzLmdldERldGFjaGVkU3RhdGVNYW5hZ2VyKCkKICAgICAgICAgICAg\nJiYgdXNlRGV0YWNoZWRTdGF0ZU1hbmFnZXIoc20sIF9vcHRzKSkKICAgICAg\nICAgICAgZGV0U00gPSBuZXcgRGV0YWNoZWRTdGF0ZU1hbmFnZXIoZGV0YWNo\nZWRQQywgc20sIGZpZWxkcywKICAgICAgICAgICAgICAgIF9vcHRzLmdldEFj\nY2Vzc1VubG9hZGVkKCksIF9icm9rZXIuZ2V0TXVsdGl0aHJlYWRlZCgpKTsK\nICAgICAgICBpZiAoX2Z1bGwpIHsKICAgICAgICAgICAgX2Z1bGxGTS5zZXRT\ndGF0ZU1hbmFnZXIoc20pOwogICAgICAgICAgICBfZnVsbEZNLmRldGFjaFZl\ncnNpb24oKTsKICAgICAgICAgICAgX2Z1bGxGTS5yZXByb3h5KGRldFNNKTsK\nICAgICAgICAgICAgX2Z1bGxGTS5zZXRTdGF0ZU1hbmFnZXIobnVsbCk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgSW5zdGFuY2VEZXRhY2hGaWVs\nZE1hbmFnZXIgZm0gPSBuZXcgSW5zdGFuY2VEZXRhY2hGaWVsZE1hbmFnZXIK\nICAgICAgICAgICAgICAgIChkZXRhY2hlZFBDLCBkZXRTTSk7CiAgICAgICAg\nICAgIGZtLnNldFN0YXRlTWFuYWdlcihzbSk7CiAgICAgICAgICAgIGZtLmRl\ndGFjaEZpZWxkcyhmaWVsZHMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFC\nb29sZWFuLkZBTFNFLmVxdWFscyhzbS5nZXRNZXRhRGF0YSgpLnVzZXNEZXRh\nY2hlZFN0YXRlKCkpKQogICAgICAgICAgICBkZXRhY2hlZFBDLnBjU2V0RGV0\nYWNoZWRTdGF0ZShnZXREZXRhY2hlZFN0YXRlKHNtLCBmaWVsZHMpKTsKICAg\nICAgICBpZiAoIV9jb3B5KQogICAgICAgICAgICBzbS5yZWxlYXNlKGZhbHNl\nLCAhX2NvcHkpOwogICAgICAgIGlmIChkZXRTTSAhPSBudWxsKQogICAgICAg\nICAgICBkZXRhY2hlZFBDLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihkZXRTTSk7\nCiAgICAgICAgcmV0dXJuIGRldGFjaGVkUEM7CiAgICB9CgogICAgcHJpdmF0\nZSBzdGF0aWMgYm9vbGVhbiB1c2VEZXRhY2hlZFN0YXRlTWFuYWdlcihTdGF0\nZU1hbmFnZXJJbXBsIHNtLAogICAgICAgIERldGFjaE9wdGlvbnMgb3B0cykg\newogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRh\nKCk7CiAgICAgICAgcmV0dXJuICFCb29sZWFuLkZBTFNFLmVxdWFscyhtZXRh\nLnVzZXNEZXRhY2hlZFN0YXRlKCkpICYmCiAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEuU1lOVEhFVElDLmVxdWFscyhtZXRhLmdldERldGFjaGVkU3RhdGUo\nKSkgJiYKICAgICAgICAgICAgb3B0cy5nZXREZXRhY2hlZFN0YXRlTWFuYWdl\ncigpOwogICAgfQoKICAgIC8qKgogICAgICogQmFzZSBkZXRhY2ggZmllbGQg\nbWFuYWdlci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgRGV0\nYWNoRmllbGRNYW5hZ2VyCiAgICAgICAgZXh0ZW5kcyBUcmFuc2ZlckZpZWxk\nTWFuYWdlciB7CgogICAgICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJbXBs\nIHNtOwoKICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhlIHNvdXJjZSBz\ndGF0ZSBtYW5hZ2VyLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIHNldFN0YXRlTWFuYWdlcihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAg\nICAgICAgIHRoaXMuc20gPSBzbTsKICAgICAgICB9CgogICAgICAgIC8qKgog\nICAgICAgICAqIFRyYW5zZmVyIHRoZSBjdXJyZW50IHZlcnNpb24gb2JqZWN0\nIGZyb20gdGhlIHN0YXRlIG1hbmFnZXIgdG8gdGhlCiAgICAgICAgICogZGV0\nYWNoZWQgaW5zdGFuY2UuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZv\naWQgZGV0YWNoVmVyc2lvbigpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYSBmbWQgPSBzbS5nZXRNZXRhRGF0YSgpLmdldFZlcnNpb25GaWVsZCgpOwog\nICAgICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgICAgICBPYmplY3QgdmFsID0gSmF2YVR5cGVzLmNv\nbnZlcnQoc20uZ2V0VmVyc2lvbigpLAogICAgICAgICAgICAgICAgZm1kLmdl\ndFR5cGVDb2RlKCkpOwogICAgICAgICAgICB2YWwgPSBmbWQuZ2V0RmllbGRW\nYWx1ZSh2YWwsIHNtLmdldEJyb2tlcigpKTsKICAgICAgICAgICAgc3dpdGNo\nIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNIT1JUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBs\nb25ndmFsID0gKHZhbCA9PSBudWxsKSA/IDBMIDogKChOdW1iZXIpIHZhbCku\nbG9uZ1ZhbHVlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIGRibHZhbCA9ICh2YWwg\nPT0gbnVsbCkgPyAwRCA6ICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZhbHVlKCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgIG9ianZhbCA9IHZhbDsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoZ2V0RGV0YWNoZWRQZXJzaXN0\nZW5jZUNhcGFibGUoKSwgdGhpcywKICAgICAgICAgICAgICAgIGZtZC5nZXRJ\nbmRleCgpKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFVu\ncHJveGllcyBzZWNvbmQgY2xhc3Mgb2JqZWN0IGZpZWxkcy4KICAgICAgICAg\nKi8KICAgICAgICBwdWJsaWMgdm9pZCByZXByb3h5KERldGFjaGVkU3RhdGVN\nYW5hZ2VyIGRzbSkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgc3dpdGNoIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVD\nVElPTjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAg\nICAgICAgICAgICAgICAgICAvLyBscnMgcHJveGllcyBub3QgZGV0YWNoZWQK\nICAgICAgICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5pc0xSUygpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIG9ianZhbCA9IG51bGw7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChnZXREZXRhY2hlZFBl\ncnNpc3RlbmNlQ2FwYWJsZSgpLCAKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHRoaXMsIGkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8g\nbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVO\nREFSOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAg\nICAgICAgICAgICBzbS5wcm92aWRlRmllbGQoZ2V0RGV0YWNoZWRQZXJzaXN0\nZW5jZUNhcGFibGUoKSwgdGhpcywgaSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKG9ianZhbCBpbnN0YW5jZW9mIFByb3h5KSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIFByb3h5IHByb3h5ID0gKFByb3h5KSBvYmp2YWw7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChwcm94eS5nZXRDaGFuZ2VUcmFja2Vy\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5\nLmdldENoYW5nZVRyYWNrZXIoKS5zdG9wVHJhY2tpbmcoKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgcHJveHkuc2V0T3duZXIoZHNtLCAoZHNtID09IG51\nbGwpID8gLTEgOiBpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xlYXIoKTsK\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUg\naW5zdGFuY2UgYmVpbmcgZGV0YWNoZWQuCiAgICAgICAgICovCiAgICAgICAg\ncHJvdGVjdGVkIFBlcnNpc3RlbmNlQ2FwYWJsZSBnZXREZXRhY2hlZFBlcnNp\nc3RlbmNlQ2FwYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHNtLmdldFBl\ncnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEZpZWxkTWFuYWdlciB0aGF0IGNhbiBjb3B5IGFsbCB0aGUgZmll\nbGRzIGZyb20gb25lCiAgICAgKiBQZXJzaXN0ZW5jZUNhcGFibGUgaW5zdGFu\nY2UgdG8gYW5vdGhlci4gT25lIG9mIHRoZQogICAgICogaW5zdGFuY2VzIG11\nc3QgYmUgbWFuYWdlZCBieSBhIFN0YXRlTWFuYWdlciwgYW5kIHRoZQogICAg\nICogb3RoZXIgbXVzdCBiZSB1bm1hbmFnZWQuCiAgICAgKgogICAgICogQGF1\ndGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICAgICAqLwogICAgcHJpdmF0ZSBj\nbGFzcyBJbnN0YW5jZURldGFjaEZpZWxkTWFuYWdlcgogICAgICAgIGV4dGVu\nZHMgRGV0YWNoRmllbGRNYW5hZ2VyIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBQZXJzaXN0ZW5jZUNhcGFibGUgX3RvOwogICAgICAgIHByaXZhdGUgZmlu\nYWwgRGV0YWNoZWRTdGF0ZU1hbmFnZXIgX2RldFNNOwoKICAgICAgICAvKioK\nICAgICAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGluc3RhbmNlIHRvIHRv\nIGNvcHkgdG8uCiAgICAgICAgICovCiAgICAgICAgcHVibGljIEluc3RhbmNl\nRGV0YWNoRmllbGRNYW5hZ2VyKFBlcnNpc3RlbmNlQ2FwYWJsZSB0bywKICAg\nICAgICAgICAgRGV0YWNoZWRTdGF0ZU1hbmFnZXIgZGV0U00pIHsKICAgICAg\nICAgICAgX3RvID0gdG87CiAgICAgICAgICAgIF9kZXRTTSA9IGRldFNNOwog\nICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFBlcnNpc3RlbmNlQ2FwYWJs\nZSBnZXREZXRhY2hlZFBlcnNpc3RlbmNlQ2FwYWJsZSgpIHsKICAgICAgICAg\nICAgcmV0dXJuIF90bzsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIERldGFjaCB0aGUgZmllbGRzIG9mIHRoZSBzdGF0ZSBtYW5hZ2VyIGdp\ndmVuIG9uIGNvbnN0cnVjdGlvbiB0bwogICAgICAgICAqIHRoZSBwZXJzaXN0\nZW5jZSBjYXBhYmxlIGdpdmVuIG9uIGNvbnN0cnVjdGlvbi4KICAgICAgICAg\nKiBPbmx5IHRoZSBmaWVsZHMgaW4gdGhlIGdpdmVuIGJpdCBzZXQgd2lsbCBi\nZSBjb3BpZWQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgZGV0\nYWNoRmllbGRzKEJpdFNldCBmZ2ZpZWxkcykgewogICAgICAgICAgICBQZXJz\naXN0ZW5jZUNhcGFibGUgZnJvbSA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJs\nZSgpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gcGtzID0gc20uZ2V0\nTWV0YURhdGEoKS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gc20uZ2V0TWV0YURhdGEoKS5nZXRG\naWVsZHMoKTsKCiAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAg\nICAgIF90by5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIoc20pOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgLy8gd2Ugc3RhcnQgd2l0aCBwayBm\naWVsZHM6IG9iamVjdHMgbWlnaHQgcmVseSBvbiBwayBmaWVsZHMgZm9yCiAg\nICAgICAgICAgICAgICAvLyBlcXVhbHMgYW5kIGhhc2hDb2RlIG1ldGhvZHMs\nIGFuZCB0aGlzIGVuc3VyZXMgdGhhdCBwayBmaWVsZHMKICAgICAgICAgICAg\nICAgIC8vIGFyZSBzZXQgcHJvcGVybHkgaWYgd2UgcmV0dXJuIGFueSBwYXJ0\naWFsbHktZGV0YWNoZWQgb2JqZWN0cwogICAgICAgICAgICAgICAgLy8gZHVl\nIHRvIHJlZW50cmFudCBjYWxscyB3aGVuIHRyYXZlcnNpbmcgcmVsYXRpb25z\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBrcy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBkZXRhY2hGaWVsZChmcm9t\nLCBwa3NbaV0uZ2V0SW5kZXgoKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBk\nZXRhY2hWZXJzaW9uKCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAg\naWYgKCFmbWRzW2ldLmlzUHJpbWFyeUtleSgpICYmICFmbWRzW2ldLmlzVmVy\nc2lvbigpKSAKICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWNoRmllbGQo\nZnJvbSwgaSwgZmdmaWVsZHMuZ2V0KGkpKTsKICAgICAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgIC8vIGNsZWFyIHRoZSBTdGF0ZU1hbmFn\nZXIgZnJvbSB0aGUgdGFyZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgaWYg\nKF9jb3B5KQogICAgICAgICAgICAgICAgICAgIF90by5wY1JlcGxhY2VTdGF0\nZU1hbmFnZXIobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIERldGFjaCAob3IgY2xlYXIpIHRoZSBnaXZl\nbiBmaWVsZCBpbmRleC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZv\naWQgZGV0YWNoRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIGZyb20sIGludCBp\nLCBib29sZWFuIGZnKSB7CiAgICAgICAgICAgIC8vIHRlbGwgdGhlIHN0YXRl\nIG1hbmFnZXIgdG8gcHJvdmlkZSB0aGUgZmllbGRzIGZyb20gdGhlIHNvdXJj\nZSB0bwogICAgICAgICAgICAvLyB0aGlzIGZpZWxkIG1hbmFnZXIsIHdoaWNo\nIHdpbGwgdGhlbiByZXBsYWNlIHRoZSBmaWVsZCB3aXRoIGEKICAgICAgICAg\nICAgLy8gZGV0YWNoZWQgdmVyc2lvbgogICAgICAgICAgICBpZiAoZmcpCiAg\nICAgICAgICAgICAgICBzbS5wcm92aWRlRmllbGQoZnJvbSwgdGhpcywgaSk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKCFfY29weSkgewogICAgICAgICAgICAg\nICAgLy8gaWYgbm90IGNvcHlpbmcgYW5kIGZpZWxkIHNob3VsZCBub3QgYmUg\nZGV0YWNoZWQsIGNsZWFyIGl0CiAgICAgICAgICAgICAgICBjbGVhcigpOwog\nICAgICAgICAgICAgICAgc20ucmVwbGFjZUZpZWxkKF90bywgdGhpcywgaSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIHN0b3JlQm9vbGVhbkZpZWxkKGludCBmaWVsZCwgYm9vbGVhbiBjdXJWYWwp\nIHsKICAgICAgICAgICAgc3VwZXIuc3RvcmVCb29sZWFuRmllbGQoZmllbGQs\nIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRo\naXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0\nb3JlQnl0ZUZpZWxkKGludCBmaWVsZCwgYnl0ZSBjdXJWYWwpIHsKICAgICAg\nICAgICAgc3VwZXIuc3RvcmVCeXRlRmllbGQoZmllbGQsIGN1clZhbCk7CiAg\nICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hhckZpZWxk\nKGludCBmaWVsZCwgY2hhciBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIu\nc3RvcmVDaGFyRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNt\nLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlRG91YmxlRmllbGQoaW50IGZpZWxk\nLCBkb3VibGUgY3VyVmFsKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3JlRG91\nYmxlRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxh\nY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIHN0b3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZsb2F0\nIGN1clZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZUZsb2F0RmllbGQo\nZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChf\ndG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIHN0b3JlSW50RmllbGQoaW50IGZpZWxkLCBpbnQgY3VyVmFsKSB7CiAg\nICAgICAgICAgIHN1cGVyLnN0b3JlSW50RmllbGQoZmllbGQsIGN1clZhbCk7\nCiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxk\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlTG9uZ0Zp\nZWxkKGludCBmaWVsZCwgbG9uZyBjdXJWYWwpIHsKICAgICAgICAgICAgc3Vw\nZXIuc3RvcmVMb25nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAg\nIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlU2hvcnRGaWVsZChpbnQgZmll\nbGQsIHNob3J0IGN1clZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZVNo\nb3J0RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxh\nY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIHN0b3JlU3RyaW5nRmllbGQoaW50IGZpZWxkLCBTdHJp\nbmcgY3VyVmFsKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3JlU3RyaW5nRmll\nbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVs\nZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIHN0b3JlT2JqZWN0RmllbGQoaW50IGZpZWxkLCBPYmplY3QgY3Vy\nVmFsKSB7CiAgICAgICAgICAgIHN1cGVyLnN0b3JlT2JqZWN0RmllbGQoZmll\nbGQsIGRldGFjaEZpZWxkKGN1clZhbCwgZmllbGQpKTsKICAgICAgICAgICAg\nc20ucmVwbGFjZUZpZWxkKF90bywgdGhpcywgZmllbGQpOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0IHRoZSBvd25lciBvZiB0aGUg\nZmllbGQncyBwcm94eSB0byB0aGUgZGV0YWNoZWQgc3RhdGUgbWFuYWdlci4K\nICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIE9iamVjdCByZXByb3h5KE9i\namVjdCBvYmosIGludCBmaWVsZCkgewogICAgICAgICAgICBpZiAob2JqICE9\nIG51bGwgJiYgX2RldFNNICE9IG51bGwgJiYgb2JqIGluc3RhbmNlb2YgUHJv\neHkpCiAgICAgICAgICAgICAgICAoKFByb3h5KSBvYmopLnNldE93bmVyKF9k\nZXRTTSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogRGV0YWNoIHRoZSBnaXZlbiB2\nYWx1ZSBpZiBuZWVkZWQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBP\nYmplY3QgZGV0YWNoRmllbGQoT2JqZWN0IGN1clZhbCwgaW50IGZpZWxkKSB7\nCiAgICAgICAgICAgIGlmIChjdXJWYWwgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAg\nICAgICAgT2JqZWN0IG5ld1ZhbCA9IG51bGw7CiAgICAgICAgICAgIHN3aXRj\naCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGlmIChfY29w\neSkKICAgICAgICAgICAgICAgICAgICBuZXdWYWwgPSBfcHJveHkuY29weUFy\ncmF5KGN1clZhbCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgbmV3VmFsID0gY3VyVmFsOwogICAgICAgICAgICAgICAgZGV0\nYWNoQXJyYXkobmV3VmFsLCBmbWQpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIG5ld1ZhbDsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElP\nTjoKICAgICAgICAgICAgICAgIGlmIChfY29weSkgewogICAgICAgICAgICAg\nICAgICAgIGlmIChfZGV0U00gIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgICAgICBuZXdWYWwgPSBfcHJveHkubmV3Q29sbGVjdGlvblByb3h5KGZt\nZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSBpbnN0\nYW5jZW9mIENvbXBhcmF0b3IgPwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKENvbXBhcmF0b3IpIGZtZC5nZXRJbml0aWFsaXplcigpIDogbnVsbCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICgoQ29sbGVjdGlvbikgbmV3VmFs\nKS5hZGRBbGwoKENvbGxlY3Rpb24pIGN1clZhbCk7CiAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9\nIF9wcm94eS5jb3B5Q29sbGVjdGlvbigoQ29sbGVjdGlvbikgY3VyVmFsKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIG5l\nd1ZhbCA9IGN1clZhbDsKICAgICAgICAgICAgICAgIGRldGFjaENvbGxlY3Rp\nb24oKENvbGxlY3Rpb24pIG5ld1ZhbCwgKENvbGxlY3Rpb24pIGN1clZhbCwg\nZm1kKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXByb3h5KG5ld1ZhbCwg\nZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAg\nICAgICAgICAgICBpZiAoX2NvcHkpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoX2RldFNNICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nbmV3VmFsID0gX3Byb3h5Lm5ld01hcFByb3h5KGZtZC5nZXRQcm94eVR5cGUo\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5n\nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSBpbnN0\nYW5jZW9mIENvbXBhcmF0b3IgPwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIChDb21wYXJhdG9yKSBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSA6IG51\nbGwpOwogICAgICAgICAgICAgICAgICAgICAgICAoKE1hcCkgbmV3VmFsKS5w\ndXRBbGwoKE1hcCkgY3VyVmFsKTsKICAgICAgICAgICAgICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgICAgICAgICAgICAgbmV3VmFsID0gX3Byb3h5LmNv\ncHlNYXAoKE1hcCkgY3VyVmFsKTsKICAgICAgICAgICAgICAgIH0gZWxzZQog\nICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9IGN1clZhbDsKICAgICAgICAg\nICAgICAgIGRldGFjaE1hcCgoTWFwKSBuZXdWYWwsIChNYXApIGN1clZhbCwg\nZm1kKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXByb3h5KG5ld1ZhbCwg\nZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoK\nICAgICAgICAgICAgICAgIG5ld1ZhbCA9IChfY29weSkgPyBfcHJveHkuY29w\neUNhbGVuZGFyKChDYWxlbmRhcikgY3VyVmFsKSA6CiAgICAgICAgICAgICAg\nICAgICAgY3VyVmFsOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlcHJveHko\nbmV3VmFsLCBmaWVsZCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRB\nVEU6CiAgICAgICAgICAgICAgICBuZXdWYWwgPSAoX2NvcHkpID8gX3Byb3h5\nLmNvcHlEYXRlKChEYXRlKSBjdXJWYWwpIDogY3VyVmFsOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHJlcHJveHkobmV3VmFsLCBmaWVsZCk7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIGlm\nIChfY29weSkKICAgICAgICAgICAgICAgICAgICBuZXdWYWwgPSBfcHJveHku\nY29weUN1c3RvbShjdXJWYWwpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJl\ncHJveHkoKG5ld1ZhbCA9PSBudWxsKSA/IGN1clZhbCA6IG5ld1ZhbCwgZmll\nbGQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAg\nIHJldHVybiBkZXRhY2hJbnRlcm5hbChjdXJWYWwpOwogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGN1clZhbDsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogTWFr\nZSBzdXJlIGFsbCB0aGUgdmFsdWVzIGluIHRoZSBnaXZlbiBhcnJheSBhcmUg\nZGV0YWNoZWQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIGRl\ndGFjaEFycmF5KE9iamVjdCBhcnJheSwgRmllbGRNZXRhRGF0YSBmbWQpIHsK\nICAgICAgICAgICAgaWYgKCFmbWQuZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRU\neXBlUEMoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAg\nIGludCBsZW4gPSBBcnJheS5nZXRMZW5ndGgoYXJyYXkpOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGxlbjsgaSsrKQogICAgICAgICAgICAg\nICAgQXJyYXkuc2V0KGFycmF5LCBpLCBkZXRhY2hJbnRlcm5hbChBcnJheS5n\nZXQoYXJyYXksIGkpKSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBNYWtlIHN1cmUgYWxsIHRoZSB2YWx1ZXMgaW4gdGhlIGdpdmVuIGNv\nbGxlY3Rpb24gYXJlIGRldGFjaGVkLgogICAgICAgICAqLwogICAgICAgIHBy\naXZhdGUgdm9pZCBkZXRhY2hDb2xsZWN0aW9uKENvbGxlY3Rpb24gY29sbCwg\nQ29sbGVjdGlvbiBvcmlnLAogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCkgewogICAgICAgICAgICAvLyBjb2xsIGNhbiBiZSBudWxsIGlmIG5vdCBj\nb3B5YWJsZQogICAgICAgICAgICBpZiAoX2NvcHkgJiYgY29sbCA9PSBudWxs\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vdC1jb3B5YWJsZSIsIGZtZCkpOwogICAgICAgICAgICBpZiAo\nIWZtZC5nZXRFbGVtZW50KCkuaXNEZWNsYXJlZFR5cGVQQygpKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgLy8gdW5mb3J0dW5hdGVs\neSB3ZSBoYXZlIHRvIGNsZWFyIHRoZSBvcmlnaW5hbCBhbmQgcmUtYWRkIHRv\nIGNvcHkKICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAgICAgICAgICAg\nY29sbC5jbGVhcigpOwogICAgICAgICAgICBPYmplY3QgZGV0YWNoZWQ7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb3JpZy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgZGV0YWNoZWQg\nPSBkZXRhY2hJbnRlcm5hbChpdHIubmV4dCgpKTsKICAgICAgICAgICAgICAg\nIGlmIChfY29weSkKICAgICAgICAgICAgICAgICAgICBjb2xsLmFkZChkZXRh\nY2hlZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgog\nICAgICAgICAqIE1ha2Ugc3VyZSBhbGwgdGhlIHZhbHVlcyBpbiB0aGUgZ2l2\nZW4gbWFwIGFyZSBkZXRhY2hlZC4KICAgICAgICAgKi8KICAgICAgICBwcml2\nYXRlIHZvaWQgZGV0YWNoTWFwKE1hcCBtYXAsIE1hcCBvcmlnLCBGaWVsZE1l\ndGFEYXRhIGZtZCkgewogICAgICAgICAgICAvLyBtYXAgY2FuIGJlIG51bGwg\naWYgbm90IGNvcHlhYmxlCiAgICAgICAgICAgIGlmIChfY29weSAmJiBtYXAg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJub3QtY29weWFibGUiLCBmbWQpKTsKICAgICAgICAg\nICAgYm9vbGVhbiBrZXlQQyA9IGZtZC5nZXRLZXkoKS5pc0RlY2xhcmVkVHlw\nZVBDKCk7CiAgICAgICAgICAgIGJvb2xlYW4gdmFsUEMgPSBmbWQuZ2V0RWxl\nbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKTsKICAgICAgICAgICAgaWYgKCFr\nZXlQQyAmJiAhdmFsUEMpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAg\nICAgICAgICAvLyBpZiB3ZSBoYXZlIHRvIGNvcHkga2V5cywganVzdCBjbGVh\nciBhbmQgcmUtYWRkOyBvdGhlcndpc2UKICAgICAgICAgICAgLy8gd2UgY2Fu\nIHVzZSB0aGUgZW50cnkgc2V0IHRvIHJlc2V0IHRoZSB2YWx1ZXMgb25seQog\nICAgICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgICAgIGlmICgh\nX2NvcHkgfHwga2V5UEMpIHsKICAgICAgICAgICAgICAgIGlmIChfY29weSkK\nICAgICAgICAgICAgICAgICAgICBtYXAuY2xlYXIoKTsKICAgICAgICAgICAg\nICAgIE9iamVjdCBrZXksIHZhbDsKICAgICAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gb3JpZy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KXsKICAgICAgICAgICAgICAgICAgICBlbnRyeSA9IChNYXAu\nRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAga2V5ID0g\nZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGtleVBD\nKQogICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSBkZXRhY2hJbnRlcm5h\nbChrZXkpOwogICAgICAgICAgICAgICAgICAgIHZhbCA9IGVudHJ5LmdldFZh\nbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbFBDKQogICAgICAg\nICAgICAgICAgICAgICAgICB2YWwgPSBkZXRhY2hJbnRlcm5hbCh2YWwpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgICAg\nICAgICAgICAgbWFwLnB1dChrZXksIHZhbCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgZW50cnkgPSAoTWFw\nLkVudHJ5KSBpdHIubmV4dCAoKTsKCQkJCQllbnRyeS5zZXRWYWx1ZSAoZGV0\nYWNoSW50ZXJuYWwgKGVudHJ5LmdldFZhbHVlICgpKSk7CgkJCQl9CgkJCX0K\nCQl9Cgl9Cn0K\n","encoding":"base64"}

