{"sha":"0975f875fc421a89060c0069d27e40ba051c7a11","node_id":"MDQ6QmxvYjIwNjM2NDowOTc1Zjg3NWZjNDIxYTg5MDYwYzAwNjlkMjdlNDBiYTA1MWM3YTEx","size":21814,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0975f875fc421a89060c0069d27e40ba051c7a11","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwu\nQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0\naWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQ\nQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnJvcC5FYWdlclJlc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnJvcC5MaXN0UmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5SZXN1bHRMaXN0OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0UHJvdmlk\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5TaW1wbGVS\nZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3Au\nV2luZG93UmVzdWx0TGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmV0Y2hHcm91cDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Ob1RyYW5zYWN0aW9uRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBBbGxvd3Mg\nY29uZmlndXJhdGlvbiBhbmQgb3B0aW1pemF0aW9uIG9mIGhvdyBvYmplY3Rz\nIGFyZSBsb2FkZWQgZnJvbQogKiB0aGUgZGF0YSBzdG9yZS4KICoKICogQHNp\nbmNlIDAuMy4wCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgUGlu\nYWtpIFBvZGRhcgogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRmV0\nY2hDb25maWd1cmF0aW9uSW1wbAogICAgaW1wbGVtZW50cyBGZXRjaENvbmZp\nZ3VyYXRpb24sIENsb25lYWJsZSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAg\nICAgIChGZXRjaENvbmZpZ3VyYXRpb25JbXBsLmNsYXNzKTsKCiAgICAvKioK\nICAgICAqIENvbmZpZ3VyYWJsZSBzdGF0ZSBzaGFyZWQgdGhyb3VnaG91dCBh\nIHRyYXZlcnNhbCBjaGFpbi4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRp\nYyBjbGFzcyBDb25maWd1cmF0aW9uU3RhdGUKICAgICAgICBpbXBsZW1lbnRz\nIFNlcmlhbGl6YWJsZQogICAgewogICAgICAgIHB1YmxpYyB0cmFuc2llbnQg\nU3RvcmVDb250ZXh0IGN0eCA9IG51bGw7CiAgICAgICAgcHVibGljIGludCBm\nZXRjaEJhdGNoU2l6ZSA9IDA7CiAgICAgICAgcHVibGljIGludCBtYXhGZXRj\naERlcHRoID0gMTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBxdWVyeUNhY2hl\nID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgaW50IGZsdXNoUXVlcnkgPSAwOwog\nICAgICAgIHB1YmxpYyBpbnQgbG9ja1RpbWVvdXQgPSAtMTsKICAgICAgICBw\ndWJsaWMgaW50IHJlYWRMb2NrTGV2ZWwgPSBMT0NLX05PTkU7CiAgICAgICAg\ncHVibGljIGludCB3cml0ZUxvY2tMZXZlbCA9IExPQ0tfTk9ORTsKICAgICAg\nICBwdWJsaWMgU2V0IGZldGNoR3JvdXBzID0gbnVsbDsKICAgICAgICBwdWJs\naWMgU2V0IGZpZWxkcyA9IG51bGw7CiAgICAgICAgcHVibGljIFNldCByb290\nQ2xhc3NlczsKICAgICAgICBwdWJsaWMgU2V0IHJvb3RJbnN0YW5jZXM7CiAg\nICAgICAgcHVibGljIE1hcCBoaW50cyA9IG51bGw7CiAgICB9CgogICAgcHJp\ndmF0ZSBmaW5hbCBDb25maWd1cmF0aW9uU3RhdGUgX3N0YXRlOwogICAgcHJp\ndmF0ZSBGZXRjaENvbmZpZ3VyYXRpb25JbXBsIF9wYXJlbnQ7CiAgICBwcml2\nYXRlIFN0cmluZyBfZnJvbUZpZWxkOwogICAgcHJpdmF0ZSBDbGFzcyBfZnJv\nbVR5cGU7CiAgICBwcml2YXRlIFN0cmluZyBfZGlyZWN0UmVsYXRpb25Pd25l\ncjsKICAgIHByaXZhdGUgYm9vbGVhbiBfbG9hZCA9IHRydWU7CiAgICBwcml2\nYXRlIGludCBfYXZhaWxhYmxlUmVjdXJzaW9uOwogICAgcHJpdmF0ZSBpbnQg\nX2F2YWlsYWJsZURlcHRoOwoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRp\nb25JbXBsKCkgewogICAgICAgIHRoaXMobnVsbCk7CiAgICB9CgogICAgcHJv\ndGVjdGVkIEZldGNoQ29uZmlndXJhdGlvbkltcGwoQ29uZmlndXJhdGlvblN0\nYXRlIHN0YXRlKSB7CiAgICAgICAgX3N0YXRlID0gKHN0YXRlID09IG51bGwp\nID8gbmV3IENvbmZpZ3VyYXRpb25TdGF0ZSgpIDogc3RhdGU7CiAgICAgICAg\nX2F2YWlsYWJsZURlcHRoID0gX3N0YXRlLm1heEZldGNoRGVwdGg7CiAgICB9\nIAoKICAgIHB1YmxpYyBTdG9yZUNvbnRleHQgZ2V0Q29udGV4dCgpIHsKICAg\nICAgICByZXR1cm4gX3N0YXRlLmN0eDsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRDb250ZXh0KFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICAvLyBj\nYW4ndCByZXNldCBub24tbnVsbCBjb250ZXh0IHRvIGFub3RoZXIgY29udGV4\ndAogICAgICAgIGlmIChjdHggIT0gbnVsbCAmJiBfc3RhdGUuY3R4ICE9IG51\nbGwgJiYgY3R4ICE9IF9zdGF0ZS5jdHgpCiAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIF9zdGF0ZS5jdHggPSBj\ndHg7CiAgICAgICAgaWYgKGN0eCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIC8vIGluaXRpYWxpemUgdG8gY29uZiBpbmZvCiAgICAg\nICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiA9IGN0eC5nZXRDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgc2V0RmV0Y2hCYXRjaFNpemUoY29uZi5nZXRG\nZXRjaEJhdGNoU2l6ZSgpKTsKICAgICAgICBzZXRGbHVzaEJlZm9yZVF1ZXJp\nZXMoY29uZi5nZXRGbHVzaEJlZm9yZVF1ZXJpZXNDb25zdGFudCgpKTsKICAg\nICAgICBjbGVhckZldGNoR3JvdXBzKCk7CiAgICAgICAgYWRkRmV0Y2hHcm91\ncHMoQXJyYXlzLmFzTGlzdChjb25mLmdldEZldGNoR3JvdXBzTGlzdCgpKSk7\nCiAgICAgICAgc2V0TWF4RmV0Y2hEZXB0aChjb25mLmdldE1heEZldGNoRGVw\ndGgoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbG9uZSB0aGlzIGluc3Rh\nbmNlLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGNsb25lKCkgewogICAg\nICAgIEZldGNoQ29uZmlndXJhdGlvbkltcGwgY2xvbmUgPSBuZXdJbnN0YW5j\nZShudWxsKTsKICAgICAgICBjbG9uZS5fc3RhdGUuY3R4ID0gX3N0YXRlLmN0\neDsKICAgICAgICBjbG9uZS5fcGFyZW50ID0gX3BhcmVudDsKICAgICAgICBj\nbG9uZS5fZnJvbUZpZWxkID0gX2Zyb21GaWVsZDsKICAgICAgICBjbG9uZS5f\nZnJvbVR5cGUgPSBfZnJvbVR5cGU7CiAgICAgICAgY2xvbmUuX2RpcmVjdFJl\nbGF0aW9uT3duZXIgPSBfZGlyZWN0UmVsYXRpb25Pd25lcjsKICAgICAgICBj\nbG9uZS5fbG9hZCA9IF9sb2FkOwogICAgICAgIGNsb25lLl9hdmFpbGFibGVS\nZWN1cnNpb24gPSBfYXZhaWxhYmxlUmVjdXJzaW9uOwogICAgICAgIGNsb25l\nLl9hdmFpbGFibGVEZXB0aCA9IF9hdmFpbGFibGVEZXB0aDsKICAgICAgICBj\nbG9uZS5jb3B5KHRoaXMpOwogICAgICAgIHJldHVybiBjbG9uZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBob2xsb3cgaW5zdGFuY2Uu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBGZXRjaENvbmZpZ3VyYXRpb25JbXBs\nIG5ld0luc3RhbmNlKENvbmZpZ3VyYXRpb25TdGF0ZSBzdGF0ZSkgewogICAg\nICAgIHJldHVybiBuZXcgRmV0Y2hDb25maWd1cmF0aW9uSW1wbChzdGF0ZSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgY29weShGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpIHsKICAgICAgICBzZXRGZXRjaEJhdGNoU2l6ZShmZXRjaC5n\nZXRGZXRjaEJhdGNoU2l6ZSgpKTsKICAgICAgICBzZXRNYXhGZXRjaERlcHRo\nKGZldGNoLmdldE1heEZldGNoRGVwdGgoKSk7CiAgICAgICAgc2V0UXVlcnlD\nYWNoZUVuYWJsZWQoZmV0Y2guZ2V0UXVlcnlDYWNoZUVuYWJsZWQoKSk7CiAg\nICAgICAgc2V0Rmx1c2hCZWZvcmVRdWVyaWVzKGZldGNoLmdldEZsdXNoQmVm\nb3JlUXVlcmllcygpKTsKICAgICAgICBzZXRMb2NrVGltZW91dChmZXRjaC5n\nZXRMb2NrVGltZW91dCgpKTsKICAgICAgICBjbGVhckZldGNoR3JvdXBzKCk7\nCiAgICAgICAgYWRkRmV0Y2hHcm91cHMoZmV0Y2guZ2V0RmV0Y2hHcm91cHMo\nKSk7CiAgICAgICAgY2xlYXJGaWVsZHMoKTsKICAgICAgICBhZGRGaWVsZHMo\nZmV0Y2guZ2V0RmllbGRzKCkpOwoKICAgICAgICAvLyBkb24ndCB1c2Ugc2V0\ndGVycyBiZWNhdXNlIHJlcXVpcmUgYWN0aXZlIHRyYW5zYWN0aW9uCiAgICAg\nICAgX3N0YXRlLnJlYWRMb2NrTGV2ZWwgPSBmZXRjaC5nZXRSZWFkTG9ja0xl\ndmVsKCk7CiAgICAgICAgX3N0YXRlLndyaXRlTG9ja0xldmVsID0gZmV0Y2gu\nZ2V0V3JpdGVMb2NrTGV2ZWwoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdl\ndEZldGNoQmF0Y2hTaXplKCkgewogICAgICAgIHJldHVybiBfc3RhdGUuZmV0\nY2hCYXRjaFNpemU7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJh\ndGlvbiBzZXRGZXRjaEJhdGNoU2l6ZShpbnQgZmV0Y2hCYXRjaFNpemUpIHsK\nICAgICAgICBpZiAoZmV0Y2hCYXRjaFNpemUgPT0gREVGQVVMVCAmJiBfc3Rh\ndGUuY3R4ICE9IG51bGwpCiAgICAgICAgICAgIGZldGNoQmF0Y2hTaXplID0g\nX3N0YXRlLmN0eC5nZXRDb25maWd1cmF0aW9uKCkuZ2V0RmV0Y2hCYXRjaFNp\nemUoKTsKICAgICAgICBpZiAoZmV0Y2hCYXRjaFNpemUgIT0gREVGQVVMVCkK\nICAgICAgICAgICAgX3N0YXRlLmZldGNoQmF0Y2hTaXplID0gZmV0Y2hCYXRj\naFNpemU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGlj\nIGludCBnZXRNYXhGZXRjaERlcHRoKCkgewogICAgICAgIHJldHVybiBfc3Rh\ndGUubWF4RmV0Y2hEZXB0aDsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25m\naWd1cmF0aW9uIHNldE1heEZldGNoRGVwdGgoaW50IGRlcHRoKSB7CiAgICAg\nICAgaWYgKGRlcHRoID09IERFRkFVTFQgJiYgX3N0YXRlLmN0eCAhPSBudWxs\nKQogICAgICAgICAgICBkZXB0aCA9IF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJh\ndGlvbigpLmdldE1heEZldGNoRGVwdGgoKTsKICAgICAgICBpZiAoZGVwdGgg\nIT0gREVGQVVMVCkKICAgICAgICB7CiAgICAgICAgICAgIF9zdGF0ZS5tYXhG\nZXRjaERlcHRoID0gZGVwdGg7CiAgICAgICAgICAgIGlmIChfcGFyZW50ID09\nIG51bGwpCiAgICAgICAgICAgICAgICBfYXZhaWxhYmxlRGVwdGggPSBkZXB0\naDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gZ2V0UXVlcnlDYWNoZUVuYWJsZWQoKSB7CiAgICAg\nICAgcmV0dXJuIF9zdGF0ZS5xdWVyeUNhY2hlOwogICAgfQoKICAgIHB1Ymxp\nYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0UXVlcnlDYWNoZUVuYWJsZWQoYm9v\nbGVhbiBjYWNoZSkgewogICAgICAgIF9zdGF0ZS5xdWVyeUNhY2hlID0gY2Fj\naGU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIGlu\ndCBnZXRGbHVzaEJlZm9yZVF1ZXJpZXMoKSB7CiAgICAgICAgcmV0dXJuIF9z\ndGF0ZS5mbHVzaFF1ZXJ5OwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZp\nZ3VyYXRpb24gc2V0Rmx1c2hCZWZvcmVRdWVyaWVzKGludCBmbHVzaCkgewog\nICAgICAgIGlmIChmbHVzaCA9PSBERUZBVUxUICYmIF9zdGF0ZS5jdHggIT0g\nbnVsbCkKICAgICAgICAgICAgX3N0YXRlLmZsdXNoUXVlcnkgPSBfc3RhdGUu\nY3R4LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgICAgIGdldEZs\ndXNoQmVmb3JlUXVlcmllc0NvbnN0YW50KCk7CiAgICAgICAgZWxzZSBpZiAo\nZmx1c2ggIT0gREVGQVVMVCkKICAgICAgICAgICAgX3N0YXRlLmZsdXNoUXVl\ncnkgPSBmbHVzaDsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBw\ndWJsaWMgU2V0IGdldEZldGNoR3JvdXBzKCkgewogICAgICAgIHJldHVybiAo\nX3N0YXRlLmZldGNoR3JvdXBzID09IG51bGwpID8gQ29sbGVjdGlvbnMuRU1Q\nVFlfU0VUIAogICAgICAgICAgICA6IF9zdGF0ZS5mZXRjaEdyb3VwczsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNGZXRjaEdyb3VwKFN0cmluZyBn\ncm91cCkgewogICAgICAgIHJldHVybiBfc3RhdGUuZmV0Y2hHcm91cHMgIT0g\nbnVsbAogICAgICAgICAgICAmJiAoX3N0YXRlLmZldGNoR3JvdXBzLmNvbnRh\naW5zKGdyb3VwKQogICAgICAgICAgICB8fCBfc3RhdGUuZmV0Y2hHcm91cHMu\nY29udGFpbnMoRmV0Y2hHcm91cC5OQU1FX0FMTCkpOwogICAgfQoKICAgIHB1\nYmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gYWRkRmV0Y2hHcm91cChTdHJpbmcg\nbmFtZSkgewogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgibnVsbC1mZyIpKTsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmIChfc3RhdGUuZmV0Y2hHcm91cHMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIF9zdGF0ZS5mZXRjaEdyb3VwcyA9IG5ldyBIYXNo\nU2V0KCk7CiAgICAgICAgICAgIF9zdGF0ZS5mZXRjaEdyb3Vwcy5hZGQobmFt\nZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1\nYmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gYWRkRmV0Y2hHcm91cHMoQ29sbGVj\ndGlvbiBncm91cHMpIHsKICAgICAgICBpZiAoZ3JvdXBzID09IG51bGwgfHwg\nZ3JvdXBzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBncm91cHMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspCiAgICAgICAgICAgIGFkZEZldGNoR3JvdXAoKFN0\ncmluZykgaXRyLm5leHQoKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9\nCgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiByZW1vdmVGZXRjaEdy\nb3VwKFN0cmluZyBncm91cCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoX3N0YXRlLmZldGNoR3JvdXBzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBfc3RhdGUuZmV0Y2hHcm91cHMucmVtb3Zl\nKGdyb3VwKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9Cgog\nICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiByZW1vdmVGZXRjaEdyb3Vw\ncyhDb2xsZWN0aW9uIGdyb3VwcykgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAoX3N0YXRlLmZldGNoR3JvdXBzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfc3RhdGUuZmV0Y2hHcm91cHMucmVt\nb3ZlQWxsKGdyb3Vwcyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwog\nICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gY2xlYXJGZXRj\naEdyb3VwcygpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKF9zdGF0ZS5mZXRjaEdyb3VwcyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX3N0YXRlLmZldGNoR3JvdXBzLmNsZWFyKCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBGZXRj\naENvbmZpZ3VyYXRpb24gcmVzZXRGZXRjaEdyb3VwcygpIHsKICAgICAgICBj\nbGVhckZldGNoR3JvdXBzKCk7CiAgICAgICAgaWYgKF9zdGF0ZS5jdHggIT0g\nbnVsbCkKICAgICAgICAgICAgYWRkRmV0Y2hHcm91cHMoQXJyYXlzLmFzTGlz\ndChfc3RhdGUuY3R4LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAg\nICAgIGdldEZldGNoR3JvdXBzTGlzdCgpKSk7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICB9CgogICAgcHVibGljIFNldCBnZXRGaWVsZHMoKSB7CiAgICAg\nICAgcmV0dXJuIChfc3RhdGUuZmllbGRzID09IG51bGwpID8gQ29sbGVjdGlv\nbnMuRU1QVFlfU0VUIDogX3N0YXRlLmZpZWxkczsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBoYXNGaWVsZChTdHJpbmcgZmllbGQpIHsKICAgICAgICBy\nZXR1cm4gX3N0YXRlLmZpZWxkcyAhPSBudWxsICYmIF9zdGF0ZS5maWVsZHMu\nY29udGFpbnMoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZp\nZ3VyYXRpb24gYWRkRmllbGQoU3RyaW5nIGZpZWxkKSB7CiAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmlzRW1wdHkoZmllbGQpKQogICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC1maWVsZCIpKTsK\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChfc3RhdGUuZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAgICBfc3Rh\ndGUuZmllbGRzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgX3N0YXRl\nLmZpZWxkcy5hZGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhp\nczsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIGFkZEZp\nZWxkcyhDb2xsZWN0aW9uIGZpZWxkcykgewogICAgICAgIGlmIChmaWVsZHMg\nPT0gbnVsbCB8fCBmaWVsZHMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1\ncm4gdGhpczsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmIChfc3RhdGUuZmllbGRzID09IG51bGwpCiAgICAgICAgICAg\nICAgICBfc3RhdGUuZmllbGRzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAg\nICAgX3N0YXRlLmZpZWxkcy5hZGRBbGwoZmllbGRzKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmln\ndXJhdGlvbiByZW1vdmVGaWVsZChTdHJpbmcgZmllbGQpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5m\naWVsZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5maWVsZHMu\ncmVtb3ZlKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiByZW1vdmVGaWVs\nZHMoQ29sbGVjdGlvbiBmaWVsZHMpIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5maWVsZHMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5maWVsZHMucmVtb3ZlQWxsKGZp\nZWxkcyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAg\nIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gY2xlYXJGaWVsZHMoKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChf\nc3RhdGUuZmllbGRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfc3RhdGUu\nZmllbGRzLmNsZWFyKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwog\nICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TG9ja1RpbWVvdXQoKSB7CiAgICAg\nICAgcmV0dXJuIF9zdGF0ZS5sb2NrVGltZW91dDsKICAgIH0KCiAgICBwdWJs\naWMgRmV0Y2hDb25maWd1cmF0aW9uIHNldExvY2tUaW1lb3V0KGludCB0aW1l\nb3V0KSB7CiAgICAgICAgaWYgKHRpbWVvdXQgPT0gREVGQVVMVCAmJiBfc3Rh\ndGUuY3R4ICE9IG51bGwpCiAgICAgICAgICAgIF9zdGF0ZS5sb2NrVGltZW91\ndCA9IF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJhdGlvbigpLmdldExvY2tUaW1l\nb3V0KCk7CiAgICAgICAgZWxzZSBpZiAodGltZW91dCAhPSBERUZBVUxUKQog\nICAgICAgICAgICBfc3RhdGUubG9ja1RpbWVvdXQgPSB0aW1lb3V0OwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0UmVh\nZExvY2tMZXZlbCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLnJlYWRMb2Nr\nTGV2ZWw7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBz\nZXRSZWFkTG9ja0xldmVsKGludCBsZXZlbCkgewogICAgICAgIGlmIChfc3Rh\ndGUuY3R4ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwoKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nQWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKGxldmVsID09\nIERFRkFVTFQpCiAgICAgICAgICAgICAgICBfc3RhdGUucmVhZExvY2tMZXZl\nbCA9IF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAg\nICAgICAgICAgIGdldFJlYWRMb2NrTGV2ZWxDb25zdGFudCgpOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICBfc3RhdGUucmVhZExvY2tMZXZl\nbCA9IGxldmVsOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IGdldFdyaXRlTG9ja0xldmVsKCkgewogICAgICAg\nIHJldHVybiBfc3RhdGUud3JpdGVMb2NrTGV2ZWw7CiAgICB9CgogICAgcHVi\nbGljIEZldGNoQ29uZmlndXJhdGlvbiBzZXRXcml0ZUxvY2tMZXZlbChpbnQg\nbGV2ZWwpIHsKICAgICAgICBpZiAoX3N0YXRlLmN0eCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gdGhpczsKCiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7\nCiAgICAgICAgICAgIGlmIChsZXZlbCA9PSBERUZBVUxUKQogICAgICAgICAg\nICAgICAgX3N0YXRlLndyaXRlTG9ja0xldmVsID0gX3N0YXRlLmN0eC5nZXRD\nb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0V3JpdGVM\nb2NrTGV2ZWxDb25zdGFudCgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBfc3RhdGUud3JpdGVMb2NrTGV2ZWwgPSBsZXZlbDsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFJlc3Vs\ndExpc3QgbmV3UmVzdWx0TGlzdChSZXN1bHRPYmplY3RQcm92aWRlciByb3Ap\nIHsKICAgICAgICBpZiAocm9wIGluc3RhbmNlb2YgTGlzdFJlc3VsdE9iamVj\ndFByb3ZpZGVyKQogICAgICAgICAgICByZXR1cm4gbmV3IFNpbXBsZVJlc3Vs\ndExpc3Qocm9wKTsKICAgICAgICBpZiAoX3N0YXRlLmZldGNoQmF0Y2hTaXpl\nIDwgMCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBFYWdlclJlc3VsdExpc3Qo\ncm9wKTsKICAgICAgICBpZiAocm9wLnN1cHBvcnRzUmFuZG9tQWNjZXNzKCkp\nCiAgICAgICAgICAgIHJldHVybiBuZXcgU2ltcGxlUmVzdWx0TGlzdChyb3Ap\nOwogICAgICAgIHJldHVybiBuZXcgV2luZG93UmVzdWx0TGlzdChyb3ApOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhyb3cgYW4gZXhjZXB0aW9uIGlmIG5v\nIHRyYW5zYWN0aW9uIGlzIGFjdGl2ZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCkgewogICAgICAgIGlmIChf\nc3RhdGUuY3R4ICE9IG51bGwgJiYgIV9zdGF0ZS5jdHguaXNBY3RpdmUoKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE5vVHJhbnNhY3Rpb25FeGNlcHRpb24o\nX2xvYy5nZXQoIm5vdC1hY3RpdmUiKSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0SGludChTdHJpbmcgbmFtZSwgT2JqZWN0IHZhbHVlKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc3Rh\ndGUuaGludHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5oaW50\ncyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIF9zdGF0ZS5oaW50cy5w\ndXQobmFtZSwgdmFsdWUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGdldEhpbnQoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gKF9z\ndGF0ZS5oaW50cyA9PSBudWxsKSA/IG51bGwgOiBfc3RhdGUuaGludHMuZ2V0\nKG5hbWUpOwogICAgfQoKICAgIHB1YmxpYyBTZXQgZ2V0Um9vdENsYXNzZXMo\nKSB7CiAgICAgICAgcmV0dXJuIChfc3RhdGUucm9vdENsYXNzZXMgPT0gbnVs\nbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQgCiAgICAgICAgICAgIDogX3N0\nYXRlLnJvb3RDbGFzc2VzOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZp\nZ3VyYXRpb24gc2V0Um9vdENsYXNzZXMoQ29sbGVjdGlvbiBjbGFzc2VzKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChfc3RhdGUucm9vdENsYXNzZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9zdGF0ZS5yb290Q2xhc3Nlcy5jbGVhcigpOwogICAgICAgICAgICBpZiAo\nY2xhc3NlcyAhPSBudWxsICYmICFjbGFzc2VzLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICAgICAgaWYgKF9zdGF0ZS5yb290Q2xhc3NlcyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIF9zdGF0ZS5yb290Q2xhc3NlcyA9IG5ldyBI\nYXNoU2V0KGNsYXNzZXMpOwogICAgICAgICAgICAgICAgZWxzZSAKICAgICAg\nICAgICAgICAgICAgICBfc3RhdGUucm9vdENsYXNzZXMuYWRkQWxsKGNsYXNz\nZXMpOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlz\nOwogICAgfQoKICAgIHB1YmxpYyBTZXQgZ2V0Um9vdEluc3RhbmNlcygpIHsK\nICAgICAgICByZXR1cm4gKF9zdGF0ZS5yb290SW5zdGFuY2VzID09IG51bGwp\nID8gQ29sbGVjdGlvbnMuRU1QVFlfU0VUIAogICAgICAgICAgICA6IF9zdGF0\nZS5yb290SW5zdGFuY2VzOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZp\nZ3VyYXRpb24gc2V0Um9vdEluc3RhbmNlcyhDb2xsZWN0aW9uIGluc3RhbmNl\ncykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoX3N0YXRlLnJvb3RJbnN0YW5jZXMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9zdGF0ZS5yb290SW5zdGFuY2VzLmNsZWFyKCk7CiAgICAgICAg\nICAgIGlmIChpbnN0YW5jZXMgIT0gbnVsbCAmJiAhaW5zdGFuY2VzLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICAgICAgaWYgKF9zdGF0ZS5yb290SW5zdGFu\nY2VzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3N0YXRlLnJvb3RJ\nbnN0YW5jZXMgPSBuZXcgSGFzaFNldChpbnN0YW5jZXMpOwogICAgICAgICAg\nICAgICAgZWxzZSAKICAgICAgICAgICAgICAgICAgICBfc3RhdGUucm9vdElu\nc3RhbmNlcy5hZGRBbGwoaW5zdGFuY2VzKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBsb2NrKCkgewogICAgICAgIGlmIChfc3RhdGUuY3R4ICE9IG51bGwpCiAg\nICAgICAgICAgIF9zdGF0ZS5jdHgubG9jaygpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHVubG9jaygpIHsKICAgICAgICBpZiAoX3N0YXRlLmN0eCAhPSBu\ndWxsKQogICAgICAgICAgICBfc3RhdGUuY3R4LnVubG9jaygpOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8KICAgIC8vIFRyYXZlcnNhbAogICAgLy8vLy8v\nLy8vLy8vLwogICAgCiAgICBwdWJsaWMgaW50IHJlcXVpcmVzRmV0Y2goRmll\nbGRNZXRhRGF0YSBmbSkgewogICAgICAgIGlmICghaW5jbHVkZXMoZm0pKQog\nICAgICAgICAgICByZXR1cm4gRkVUQ0hfTk9ORTsKICAgICAgICAKICAgICAg\nICBDbGFzcyB0eXBlID0gZ2V0UmVsYXRpb25UeXBlKGZtKTsKICAgICAgICBp\nZiAodHlwZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gRkVUQ0hfTE9B\nRDsKICAgICAgICBpZiAoX2F2YWlsYWJsZURlcHRoID09IDApCiAgICAgICAg\nICAgIHJldHVybiBGRVRDSF9OT05FOwoKICAgICAgICAvLyB3ZSBjYW4gc2tp\ncCBjYWxjdWxhdGluZyByZWN1cnNpb24gZGVwdGggaWYgdGhpcyBpcyBhIHRv\ncC1sZXZlbCBjb25mOgogICAgICAgIC8vIHRoZSBmaWVsZCBpcyBpbiBvdXIg\nZmV0Y2ggZ3JvdXBzLCBzbyBjYW4ndCBwb3NzaWJseSBub3Qgc2VsZWN0CiAg\nICAgICAgaWYgKF9wYXJlbnQgPT0gbnVsbCkgCiAgICAgICAgICAgIHJldHVy\nbiBGRVRDSF9MT0FEOwoKICAgICAgICBpbnQgcmRlcHRoID0gZ2V0QXZhaWxh\nYmxlUmVjdXJzaW9uRGVwdGgoZm0sIHR5cGUsIGZhbHNlKTsKICAgICAgICBp\nZiAocmRlcHRoICE9IEZldGNoR3JvdXAuREVQVEhfSU5GSU5JVEUgJiYgcmRl\ncHRoIDw9IDApCiAgICAgICAgICAgIHJldHVybiBGRVRDSF9OT05FOwoKICAg\nICAgICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzKF9kaXJlY3RSZWxhdGlvbk93\nbmVyLCBmbS5nZXRGdWxsTmFtZSgpKSkKICAgICAgICAgICAgcmV0dXJuIEZF\nVENIX1JFRjsKICAgICAgICByZXR1cm4gRkVUQ0hfTE9BRDsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc0xvYWQoKSB7CiAgICAgICAgcmV0\ndXJuIF9sb2FkOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRp\nb24gdHJhdmVyc2UoRmllbGRNZXRhRGF0YSBmbSkgewogICAgICAgIENsYXNz\nIHR5cGUgPSBnZXRSZWxhdGlvblR5cGUoZm0pOwogICAgICAgIGlmICh0eXBl\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwoKICAgICAgICBG\nZXRjaENvbmZpZ3VyYXRpb25JbXBsIGNsb25lID0gbmV3SW5zdGFuY2UoX3N0\nYXRlKTsKICAgICAgICBjbG9uZS5fcGFyZW50ID0gdGhpczsKICAgICAgICBj\nbG9uZS5fYXZhaWxhYmxlRGVwdGggPSByZWR1Y2UoX2F2YWlsYWJsZURlcHRo\nKTsKICAgICAgICBjbG9uZS5fZnJvbUZpZWxkID0gZm0uZ2V0RnVsbE5hbWUo\nZmFsc2UpOwogICAgICAgIGNsb25lLl9mcm9tVHlwZSA9IHR5cGU7CiAgICAg\nICAgY2xvbmUuX2F2YWlsYWJsZVJlY3Vyc2lvbiA9IGdldEF2YWlsYWJsZVJl\nY3Vyc2lvbkRlcHRoKGZtLCB0eXBlLCB0cnVlKTsKICAgICAgICBpZiAoU3Ry\naW5nVXRpbHMuZXF1YWxzKF9kaXJlY3RSZWxhdGlvbk93bmVyLCBmbS5nZXRG\ndWxsTmFtZSgpKSkKICAgICAgICAgICAgY2xvbmUuX2xvYWQgPSBmYWxzZTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIGNsb25lLl9sb2FkID0gX2xvYWQ7\nCgogICAgICAgIEZpZWxkTWV0YURhdGEgb3duZXIgPSBmbS5nZXRNYXBwZWRC\neU1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG93bmVyICE9IG51bGwgJiYgb3du\nZXIuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAg\nIGNsb25lLl9kaXJlY3RSZWxhdGlvbk93bmVyID0gb3duZXIuZ2V0RnVsbE5h\nbWUoKTsKICAgICAgICAKICAgICAgICByZXR1cm4gY2xvbmU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIG91ciBjb25maWd1cmF0aW9uIHN0YXRl\nIGluY2x1ZGVzIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIGluY2x1ZGVzKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAg\nICAgaWYgKChmbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAgICAgICAg\nICAgICYmIGhhc0ZldGNoR3JvdXAoRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQp\nKQogICAgICAgICAgICB8fCBoYXNGZXRjaEdyb3VwKEZldGNoR3JvdXAuTkFN\nRV9BTEwpCiAgICAgICAgICAgIHx8IGhhc0ZpZWxkKGZtZC5nZXRGdWxsTmFt\nZShmYWxzZSkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBT\ndHJpbmdbXSBmZ3MgPSBmbWQuZ2V0Q3VzdG9tRmV0Y2hHcm91cHMoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZncy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgaWYgKGhhc0ZldGNoR3JvdXAoZmdzW2ldKSkKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsgCiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGF2YWlsYWJsZSByZWN1\ncnNpb24gZGVwdGggdmlhIHRoZSBnaXZlbiBmaWVsZCBmb3IgdGhlCiAgICAg\nKiBnaXZlbiB0eXBlLgogICAgICoKICAgICAqIEBwYXJhbSB0cmF2ZXJzZSB3\naGV0aGVyIHdlJ3JlIHRyYXZlcnNpbmcgdGhlIGZpZWxkCiAgICAgKi8KICAg\nIHByaXZhdGUgaW50IGdldEF2YWlsYWJsZVJlY3Vyc2lvbkRlcHRoKEZpZWxk\nTWV0YURhdGEgZm0sIENsYXNzIHR5cGUsIAogICAgICAgIGJvb2xlYW4gdHJh\ndmVyc2UpIHsKICAgICAgICAvLyBzZWUgaWYgdGhlcmUncyBhIHByZXZpb3Vz\nIGxpbWl0CiAgICAgICAgaW50IGF2YWlsID0gSW50ZWdlci5NSU5fVkFMVUU7\nCiAgICAgICAgZm9yIChGZXRjaENvbmZpZ3VyYXRpb25JbXBsIGYgPSB0aGlz\nOyBmICE9IG51bGw7IGYgPSBmLl9wYXJlbnQpIHsKICAgICAgICAgICAgaWYg\nKEltcGxIZWxwZXIuaXNBc3NpZ25hYmxlKGYuX2Zyb21UeXBlLCB0eXBlKSkg\newogICAgICAgICAgICAgICAgYXZhaWwgPSBmLl9hdmFpbGFibGVSZWN1cnNp\nb247CiAgICAgICAgICAgICAgICBpZiAodHJhdmVyc2UpCiAgICAgICAgICAg\nICAgICAgICAgYXZhaWwgPSByZWR1Y2UoYXZhaWwpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKGF2YWlsID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIAog\nICAgICAgIC8vIGNhbGN1bGF0ZSBmZXRjaCBncm91cHMgbWF4CiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhID0gZm0uZ2V0RGVmaW5pbmdNZXRhRGF0YSgp\nOwogICAgICAgIGludCBtYXggPSBJbnRlZ2VyLk1JTl9WQUxVRTsKICAgICAg\nICBpZiAoZm0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAg\nIG1heCA9IG1ldGEuZ2V0RmV0Y2hHcm91cChGZXRjaEdyb3VwLk5BTUVfREVG\nQVVMVCkuCiAgICAgICAgICAgICAgICBnZXRSZWN1cnNpb25EZXB0aChmbSk7\nCiAgICAgICAgU3RyaW5nW10gZ3JvdXBzID0gZm0uZ2V0Q3VzdG9tRmV0Y2hH\ncm91cHMoKTsKICAgICAgICBpbnQgY3VyOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBtYXggIT0gRmV0Y2hHcm91cC5ERVBUSF9JTkZJTklURSAKICAgICAg\nICAgICAgJiYgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAvLyBpZ25vcmUgY3VzdG9tIGdyb3VwcyB0aGF0IGFyZSBpbmFjdGl2ZSBp\nbiB0aGlzIGNvbmZpZ3VyYXRpb24KICAgICAgICAgICAgaWYgKCF0aGlzLmhh\nc0ZldGNoR3JvdXAoZ3JvdXBzW2ldKSkgY29udGludWU7CiAgICAgICAgICAg\nIGN1ciA9IG1ldGEuZ2V0RmV0Y2hHcm91cChncm91cHNbaV0pLmdldFJlY3Vy\nc2lvbkRlcHRoKGZtKTsKICAgICAgICAgICAgaWYgKGN1ciA9PSBGZXRjaEdy\nb3VwLkRFUFRIX0lORklOSVRFIHx8IGN1ciA+IG1heCkgCiAgICAgICAgICAg\nICAgICBtYXggPSBjdXI7CiAgICAgICAgfQogICAgICAgIC8vIHJlZHVjZSBt\nYXggaWYgd2UncmUgdHJhdmVyc2luZyBhIHNlbGYtdHlwZSByZWxhdGlvbgog\nICAgICAgIGlmICh0cmF2ZXJzZSAmJiBtYXggIT0gSW50ZWdlci5NSU5fVkFM\nVUUKICAgICAgICAgICAgJiYgSW1wbEhlbHBlci5pc0Fzc2lnbmFibGUobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksIHR5cGUpKQogICAgICAgICAgICBtYXgg\nPSByZWR1Y2UobWF4KTsKCiAgICAgICAgLy8gdGFrZSBtaW4vZGVmaW5lZCBv\nZiBwcmV2aW91cyBhdmFpbCBhbmQgZmV0Y2ggZ3JvdXAgbWF4CiAgICAgICAg\naWYgKGF2YWlsID09IEludGVnZXIuTUlOX1ZBTFVFICYmIG1heCA9PSBJbnRl\nZ2VyLk1JTl9WQUxVRSkgewogICAgICAgICAgICBpbnQgZGVmID0gRmV0Y2hH\ncm91cC5SRUNVUlNJT05fREVQVEhfREVGQVVMVDsKICAgICAgICAgICAgcmV0\ndXJuICh0cmF2ZXJzZSAmJiBJbXBsSGVscGVyLmlzQXNzaWduYWJsZSgKICAg\nICAgICAgICAgICAgICAgICBtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgdHlw\nZSkpID8gZGVmIC0gMSA6IGRlZjsKICAgICAgICB9CiAgICAgICAgaWYgKGF2\nYWlsID09IEludGVnZXIuTUlOX1ZBTFVFIHx8IGF2YWlsID09IEZldGNoR3Jv\ndXAuREVQVEhfSU5GSU5JVEUpCiAgICAgICAgICAgIHJldHVybiBtYXg7CiAg\nICAgICAgaWYgKG1heCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSB8fCBtYXggPT0g\nRmV0Y2hHcm91cC5ERVBUSF9JTkZJTklURSkKICAgICAgICAgICAgcmV0dXJu\nIGF2YWlsOwogICAgICAgIHJldHVybiBNYXRoLm1pbihtYXgsIGF2YWlsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcmVsYXRpb24gdHlw\nZSBvZiB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIENsYXNzIGdldFJlbGF0aW9uVHlwZShGaWVsZE1ldGFEYXRhIGZtKSB7\nCiAgICAgICAgaWYgKGZtLmlzRGVjbGFyZWRUeXBlUEMoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZtLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIGlmIChm\nbS5nZXRFbGVtZW50KCkuaXNEZWNsYXJlZFR5cGVQQygpKQogICAgICAgICAg\nICByZXR1cm4gZm0uZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpOwog\nICAgICAgIGlmIChmbS5nZXRLZXkoKS5pc0RlY2xhcmVkVHlwZVBDKCkpCiAg\nICAgICAgICAgIHJldHVybiBmbS5nZXRLZXkoKS5nZXREZWNsYXJlZFR5cGUo\nKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlZHVjZSB0aGUgZ2l2ZW4gbG9naWNhbCBkZXB0aCBieSAxLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBpbnQgcmVkdWNlKGludCBkKSB7CiAgICAg\nICAgaWYgKGQgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAg\naWYgKGQgIT0gRmV0Y2hHcm91cC5ERVBUSF9JTkZJTklURSkKICAgICAgICAg\nICAgZC0tOwogICAgICAgIHJldHVybiBkOwogICAgfQoKICAgIC8vLy8vLy8v\nLy8vLy8vLy8vCiAgICAvLyBEZWJ1ZyBtZXRob2RzCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLwoKICAgIEZldGNoQ29uZmlndXJhdGlvbiBnZXRQYXJlbnQoKSB7\nCiAgICAgICAgcmV0dXJuIF9wYXJlbnQ7CiAgICB9CiAgICAKICAgIGJvb2xl\nYW4gaXNSb290KCkgewogICAgICAgIHJldHVybiBfcGFyZW50ID09IG51bGw7\nCiAgICB9CiAgICAKICAgIEZldGNoQ29uZmlndXJhdGlvbiBnZXRSb290KCkg\newogICAgICAgIHJldHVybiAoaXNSb290KCkpID8gdGhpcyA6IF9wYXJlbnQu\nZ2V0Um9vdCgpOwogICAgfQoKICAgIGludCBnZXRBdmFpbGFibGVGZXRjaERl\ncHRoKCkgewogICAgICAgIHJldHVybiBfYXZhaWxhYmxlRGVwdGg7CiAgICB9\nCgogICAgaW50IGdldEF2YWlsYWJsZVJlY3Vyc2lvbkRlcHRoKCkgewogICAg\nICAgIHJldHVybiBfYXZhaWxhYmxlUmVjdXJzaW9uOwogICAgfQoKICAgIFN0\ncmluZyBnZXRUcmF2ZXJzZWRGcm9tRmllbGQoKSB7CiAgICAgICAgcmV0dXJu\nIF9mcm9tRmllbGQ7CiAgICB9CgogICAgQ2xhc3MgZ2V0VHJhdmVyc2VkRnJv\nbVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF9mcm9tVHlwZTsKICAgIH0KCiAg\nICBMaXN0IGdldFBhdGgoKSB7CiAgICAgICAgaWYgKGlzUm9vdCgpKQogICAg\nICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKICAgICAg\nICByZXR1cm4gdHJhY2tQYXRoKG5ldyBBcnJheUxpc3QoKSk7CiAgICB9CiAg\nICAKICAgIExpc3QgdHJhY2tQYXRoKExpc3QgcGF0aCkgewogICAgICAgIGlm\nIChfcGFyZW50ICE9IG51bGwpCiAgICAgICAgICAgIF9wYXJlbnQudHJhY2tQ\nYXRoKHBhdGgpOwogICAgICAgIHBhdGguYWRkKHRoaXMpOwogICAgICAgIHJl\ndHVybiBwYXRoOwogICAgfQogICAgICAgCiAgICBwdWJsaWMgU3RyaW5nIHRv\nU3RyaW5nKCkgewogICAgICAgIHJldHVybiAiRmV0Y2hDb25maWd1cmF0aW9u\nQCIgKyBTeXN0ZW0uaWRlbnRpdHlIYXNoQ29kZSh0aGlzKSAKICAgICAgICAg\nICAgKyAiICgiICsgX2F2YWlsYWJsZURlcHRoICsgIikiICsgZ2V0UGF0aFN0\ncmluZygpOwogICAgfQogICAgCiAgICBwcml2YXRlIFN0cmluZyBnZXRQYXRo\nU3RyaW5nKCkKICAgIHsKICAgICAgICBMaXN0IHBhdGggPSBnZXRQYXRoKCk7\nCiAgICAgICAgaWYgKHBhdGguaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1\ncm4gIiI7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdC\ndWZmZXIoKS5hcHBlbmQgKCI6ICIpOwogICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gcGF0aC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICBidWYuYXBwZW5kKCgoRmV0Y2hDb25maWd1cmF0aW9uSW1wbCkg\naXRyLm5leHQoKSkuCiAgICAgICAgICAgICAgICBnZXRUcmF2ZXJzZWRGcm9t\nRmllbGQoKSk7CiAgICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiLT4iKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQp9Cg==\n","encoding":"base64"}

