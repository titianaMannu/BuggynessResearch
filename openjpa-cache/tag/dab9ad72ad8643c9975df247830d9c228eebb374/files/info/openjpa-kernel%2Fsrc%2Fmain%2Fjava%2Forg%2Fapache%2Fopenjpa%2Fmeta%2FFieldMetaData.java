{"sha":"bda0f63f442fb91262f560a6e97526cd7bdb39e3","node_id":"MDQ6QmxvYjIwNjM2NDpiZGEwZjYzZjQ0MmZiOTEyNjJmNTYwYTZlOTc1MjZjZDdiZGIzOWUz","size":66858,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/bda0f63f442fb91262f560a6e97526cd7bdb39e3","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlv\nLk9iamVjdE91dHB1dDsKaW1wb3J0IGphdmEuaW8uU2VyaWFsaXphYmxlOwpp\nbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBq\nYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZs\nZWN0Lkludm9jYXRpb25UYXJnZXRFeGNlcHRpb247CmltcG9ydCBqYXZhLmxh\nbmcucmVmbGVjdC5NZW1iZXI7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5N\nZXRob2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1w\nb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGph\ndmEuc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5k\nYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwu\nSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGph\ndmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGph\ndmEudXRpbC5Qcm9wZXJ0aWVzOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1w\nb3J0IGphdmEudXRpbC5UaW1lWm9uZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMuY29sbGVjdGlvbnMuY29tcGFyYXRvcnMuQ29tcGFyYXRvckNoYWlu\nOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3Bl\nbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkphdmFWZXJzaW9uczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIueG1sLkNvbW1lbnRhYmxlOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuRXhjZXB0aW9uczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVs\ncGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2Vw\ndGlvbjsKCmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBNZXRh\nZGF0YSBmb3IgYSBtYW5hZ2VkIGNsYXNzIGZpZWxkLgogKgogKiBAYXV0aG9y\nIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIEZpZWxkTWV0YURhdGEKICAg\nIGV4dGVuZHMgRXh0ZW5zaW9ucwogICAgaW1wbGVtZW50cyBWYWx1ZU1ldGFE\nYXRhLCBNZXRhRGF0YUNvbnRleHQsIE1ldGFEYXRhTW9kZXMsIENvbW1lbnRh\nYmxlIHsKICAgIAogICAgLyoqCiAgICAgKiBDb25zdGFudCBzcGVjaWZ5aW5n\nIHRoYXQgbm8gbnVsbC12YWx1ZSB3YXMgZ2l2ZW4uCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IE5VTExfVU5TRVQgPSAtMTsKCiAgICAv\nKioKICAgICAqIENvbnN0YW50IHNwZWNpZnlpbmcgdG8gdXNlIGEgZGF0YXN0\nb3JlIG51bGwgdG8gcGVyc2lzdCBudWxsIHZhbHVlcwogICAgICogaW4gb2Jq\nZWN0IGZpZWxkcy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgTlVMTF9OT05FID0gMDsKCiAgICAvKioKICAgICAqIENvbnN0YW50IHNw\nZWNpZnlpbmcgdG8gdXNlIGEgZGF0YXN0b3JlIGRlZmF1bHQgdmFsdWUgdG8g\ncGVyc2lzdCBudWxsCiAgICAgKiB2YWx1ZXMgaW4gb2JqZWN0IGZpZWxkcy4K\nICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTlVMTF9ERUZB\nVUxUID0gMTsKCiAgICAvKioKICAgICAqIENvbnN0YW50IHNwZWNpZnlpbmcg\ndG8gdGhyb3cgYW4gZXhjZXB0aW9uIHdoZW4gYXR0ZW1wdGluZyB0byBwZXJz\naXN0CiAgICAgKiBudWxsIHZhbHVlcyBpbiBvYmplY3QgZmllbGRzLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBOVUxMX0VYQ0VQVElP\nTiA9IDI7CgogICAgLyoqCiAgICAgKiBDb25zdGFudCBzcGVjaWZ5aW5nIHRo\nZSBtYW5hZ2VtZW50IGxldmVsIG9mIGEgZmllbGQuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IE1BTkFHRV9QRVJTSVNURU5UID0gMzsK\nCiAgICAvKioKICAgICAqIENvbnN0YW50IHNwZWNpZnlpbmcgdGhlIG1hbmFn\nZW1lbnQgbGV2ZWwgb2YgYSBmaWVsZC4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBpbnQgTUFOQUdFX1RSQU5TQUNUSU9OQUwgPSAxOwoKICAg\nIC8qKgogICAgICogQ29uc3RhbnQgc3BlY2lmeWluZyB0aGUgbWFuYWdlbWVu\ndCBsZXZlbCBvZiBhIGZpZWxkLgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBNQU5BR0VfTk9ORSA9IDA7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2Fn\nZQogICAgICAgIChGaWVsZE1ldGFEYXRhLmNsYXNzKTsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgREZHX0ZBTFNFID0gMTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBERkdfVFJVRSA9IDI7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgREZHX0VYUExJQ0lUID0gNDsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBNZXRob2QgREVGQVVMVF9NRVRIT0Q7CiAgICBzdGF0\naWMgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIERFRkFVTFRfTUVUSE9E\nID0gT2JqZWN0LmNsYXNzLmdldE1ldGhvZCgid2FpdCIsIChDbGFzc1tdKSBu\ndWxsKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAvLyBzaG91bGRuJ3QgZXZlciBoYXBwZW4KICAgICAgICAgICAgdGhy\nb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvLyBuYW1lIGFuZCB0eXBlCiAgICBwcml2YXRlIGZpbmFsIFZhbHVl\nTWV0YURhdGEgX3ZhbDsKICAgIHByaXZhdGUgZmluYWwgVmFsdWVNZXRhRGF0\nYSBfa2V5OwogICAgcHJpdmF0ZSBmaW5hbCBWYWx1ZU1ldGFEYXRhIF9lbGVt\nOwogICAgcHJpdmF0ZSBmaW5hbCBDbGFzc01ldGFEYXRhIF9vd25lcjsKICAg\nIHByaXZhdGUgZmluYWwgU3RyaW5nIF9uYW1lOwogICAgcHJpdmF0ZSBDbGFz\ncyBfZGVjID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBfZGVj\nTWV0YSA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfZnVsbE5hbWUgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX2VtYmVkRnVsbE5hbWUgPSBudWxs\nOwogICAgcHJpdmF0ZSBpbnQgX3Jlc01vZGUgPSBNT0RFX05PTkU7CgogICAg\nLy8gbG9hZC9zdG9yZSBpbmZvCiAgICBwcml2YXRlIFN0cmluZ1tdIF9jb21t\nZW50cyA9IG51bGw7CiAgICBwcml2YXRlIGludCBfbGlzdEluZGV4ID0gLTE7\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE5vdGU6IGlm\nIHlvdSBhZGQgYWRkaXRpb25hbCBzdGF0ZSwgbWFrZSBzdXJlIHRvIGFkZCBp\ndCB0byBjb3B5KCkKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\nLy8gbWlzYyBpbmZvCiAgICBwcml2YXRlIENsYXNzIF9wcm94eUNsYXNzID0g\nbnVsbDsKICAgIHByaXZhdGUgT2JqZWN0IF9pbml0aWFsaXplciA9IG51bGw7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX3RyYW5zaWVudCA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9wcmltS2V5ID0gZmFsc2U7CiAgICBwcml2YXRl\nIEJvb2xlYW4gX3ZlcnNpb24gPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX251\nbGxWYWx1ZSA9IE5VTExfVU5TRVQ7CiAgICBwcml2YXRlIGludCBfbWFuYWdl\nID0gTUFOQUdFX1BFUlNJU1RFTlQ7CiAgICBwcml2YXRlIGludCBfaW5kZXgg\nPSAtMTsKICAgIHByaXZhdGUgaW50IF9kZWNJbmRleCA9IC0xOwogICAgcHJp\ndmF0ZSBpbnQgX3BrSW5kZXggPSAtMTsKICAgIHByaXZhdGUgYm9vbGVhbiBf\nZXhwbGljaXQgPSBmYWxzZTsKICAgIHByaXZhdGUgaW50IF9kZmcgPSAwOwog\nICAgcHJpdmF0ZSBTZXQgX2ZnU2V0ID0gbnVsbDsKICAgIHByaXZhdGUgU3Ry\naW5nW10gX2ZncyA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyAgIF9sZmcg\nPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9scnMgPSBudWxsOwogICAg\ncHJpdmF0ZSBTdHJpbmcgX2V4dE5hbWUgPSBudWxsOwogICAgcHJpdmF0ZSBT\ndHJpbmcgX2ZhY3ROYW1lID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9l\neHRTdHJpbmcgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2V4dFZhbHVlcyA9\nIENvbGxlY3Rpb25zLkVNUFRZX01BUDsKICAgIHByaXZhdGUgTWFwIF9maWVs\nZFZhbHVlcyA9IENvbGxlY3Rpb25zLkVNUFRZX01BUDsKICAgIHByaXZhdGUg\nQm9vbGVhbiBfZW51bUZpZWxkID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVh\nbiBfbG9iRmllbGQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9zZXJp\nYWxpemFibGVGaWVsZCA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2dl\nbmVyYXRlZCA9IGZhbHNlOwoKICAgIC8vIE1lbWJlcnMgYXJlbid0IHNlcmlh\nbGl6YWJsZS4gVXNlIGEgcHJveHkgdGhhdCBjYW4gcHJvdmlkZSBhIE1lbWJl\ncgogICAgLy8gdG8gYXZvaWQgd3JpdGluZyB0aGUgZnVsbCBFeHRlcm5hbGl6\nYWJsZSBpbXBsZW1lbnRhdGlvbi4KICAgIHByaXZhdGUgdHJhbnNpZW50IE1l\nbWJlclByb3ZpZGVyIF9iYWNraW5nTWVtYmVyID0gbnVsbDsKICAgIHByaXZh\ndGUgU3RyaW5nIF9iYWNraW5nRmllbGROYW1lID0gbnVsbDsKICAgIAogICAg\nLy8gTWVtYmVycyBhcmVuJ3Qgc2VyaWFsaXphYmxlLiBJbml0aWFsaXppbmcg\nX2V4dE1ldGhvZCBhbmQgX2ZhY3RNZXRob2QgdG8KICAgIC8vIERFRkFVTFRf\nTUVUSE9EIGlzIHN1ZmZpY2llbnQgdG8gdHJpZ2dlciBsYXp5IHBvcHVsYXRp\nb24gb2YgdGhlc2UgZmllbGRzLgogICAgcHJpdmF0ZSB0cmFuc2llbnQgTWV0\naG9kIF9leHRNZXRob2QgPSBERUZBVUxUX01FVEhPRDsKICAgIHByaXZhdGUg\ndHJhbnNpZW50IE1lbWJlciBfZmFjdE1ldGhvZCA9IERFRkFVTFRfTUVUSE9E\nOwoKICAgIC8vIGludGVybWVkaWF0ZSBhbmQgaW1wbCBkYXRhCiAgICBwcml2\nYXRlIGJvb2xlYW4gX2ludGVybWVkaWF0ZSA9IHRydWU7CiAgICBwcml2YXRl\nIEJvb2xlYW4gX2ltcGxEYXRhID0gQm9vbGVhbi5UUlVFOwoKICAgIC8vIHZh\nbHVlIGdlbmVyYXRpb24KICAgIHByaXZhdGUgaW50IF92YWxTdHJhdGVneSA9\nIC0xOwogICAgcHJpdmF0ZSBpbnQgX3VwU3RyYXRlZ3kgPSAtMTsKICAgIHBy\naXZhdGUgU3RyaW5nIF9zZXFOYW1lID0gQ2xhc3NNZXRhRGF0YS5ERUZBVUxU\nX1NUUklORzsKICAgIHByaXZhdGUgU2VxdWVuY2VNZXRhRGF0YSBfc2VxTWV0\nYSA9IG51bGw7CgogICAgLy8gaW52ZXJzZXMKICAgIHByaXZhdGUgU3RyaW5n\nIF9tYXBwZWRCeSA9IG51bGw7CiAgICBwcml2YXRlIEZpZWxkTWV0YURhdGEg\nX21hcHBlZEJ5TWV0YSA9IG51bGw7CiAgICBwcml2YXRlIEZpZWxkTWV0YURh\ndGFbXSBfaW52ZXJzZXMgPSBudWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX2lu\ndmVyc2UgPSBDbGFzc01ldGFEYXRhLkRFRkFVTFRfU1RSSU5HOwoKICAgIC8v\nIG9yZGVyaW5nIG9uIGxvYWQKICAgIHByaXZhdGUgT3JkZXJbXSBfb3JkZXJz\nID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9vcmRlckRlYyA9IG51bGw7\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAqCiAgICAgKiBA\ncGFyYW0gbmFtZSB0aGUgZmllbGQgbmFtZQogICAgICogQHBhcmFtIHR5cGUg\ndGhlIGZpZWxkIHR5cGUKICAgICAqIEBwYXJhbSBvd25lciB0aGUgb3duaW5n\nIGNsYXNzIG1ldGFkYXRhCiAgICAgKi8KICAgIHByb3RlY3RlZCBGaWVsZE1l\ndGFEYXRhKFN0cmluZyBuYW1lLCBDbGFzcyB0eXBlLCBDbGFzc01ldGFEYXRh\nIG93bmVyKSB7CiAgICAgICAgX25hbWUgPSBuYW1lOwogICAgICAgIF9vd25l\nciA9IG93bmVyOwogICAgICAgIF9kZWMgPSBudWxsOwogICAgICAgIF9kZWNN\nZXRhID0gbnVsbDsKICAgICAgICBfdmFsID0gb3duZXIuZ2V0UmVwb3NpdG9y\neSgpLm5ld1ZhbHVlTWV0YURhdGEodGhpcyk7CiAgICAgICAgX2tleSA9IG93\nbmVyLmdldFJlcG9zaXRvcnkoKS5uZXdWYWx1ZU1ldGFEYXRhKHRoaXMpOwog\nICAgICAgIF9lbGVtID0gb3duZXIuZ2V0UmVwb3NpdG9yeSgpLm5ld1ZhbHVl\nTWV0YURhdGEodGhpcyk7CgogICAgICAgIHNldERlY2xhcmVkVHlwZSh0eXBl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN1cHBseSB0aGUgYmFja2luZyBt\nZW1iZXIgb2JqZWN0OyB0aGlzIGFsbG93cyB1cyB0byB1dGlsaXplCiAgICAg\nKiBwYXJhbWV0ZXJpemVkIHR5cGUgaW5mb3JtYXRpb24gaWYgYXZhaWxhYmxl\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBiYWNraW5nTWVtYmVyKE1lbWJl\nciBtZW1iZXIpIHsKICAgICAgICBpZiAobWVtYmVyID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICBpZiAoTW9kaWZpZXIuaXNUcmFuc2ll\nbnQobWVtYmVyLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgX3RyYW5z\naWVudCA9IHRydWU7CgogICAgICAgIF9iYWNraW5nTWVtYmVyID0gbmV3IE1l\nbWJlclByb3ZpZGVyKG1lbWJlcik7CgogICAgICAgIENsYXNzIHR5cGU7CiAg\nICAgICAgQ2xhc3NbXSB0eXBlczsKICAgICAgICBpZiAobWVtYmVyIGluc3Rh\nbmNlb2YgRmllbGQpIHsKICAgICAgICAgICAgRmllbGQgZiA9IChGaWVsZCkg\nbWVtYmVyOwogICAgICAgICAgICB0eXBlID0gZi5nZXRUeXBlKCk7CiAgICAg\nICAgICAgIHR5cGVzID0gSmF2YVZlcnNpb25zLmdldFBhcmFtZXRlcml6ZWRU\neXBlcyhmKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBNZXRob2Qg\nbWV0aCA9IChNZXRob2QpIG1lbWJlcjsKICAgICAgICAgICAgdHlwZSA9IG1l\ndGguZ2V0UmV0dXJuVHlwZSgpOwogICAgICAgICAgICB0eXBlcyA9IEphdmFW\nZXJzaW9ucy5nZXRQYXJhbWV0ZXJpemVkVHlwZXMobWV0aCk7CiAgICAgICAg\nfQoKICAgICAgICBzZXREZWNsYXJlZFR5cGUodHlwZSk7CiAgICAgICAgaWYg\nKENvbGxlY3Rpb24uY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKQogICAg\nICAgICAgICAmJiBfZWxlbS5nZXREZWNsYXJlZFR5cGUoKSA9PSBPYmplY3Qu\nY2xhc3MKICAgICAgICAgICAgJiYgdHlwZXMubGVuZ3RoID09IDEpIHsKICAg\nICAgICAgICAgX2VsZW0uc2V0RGVjbGFyZWRUeXBlKHR5cGVzWzBdKTsKICAg\nICAgICB9IGVsc2UgaWYgKE1hcC5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5\ncGUpCiAgICAgICAgICAgICYmIHR5cGVzLmxlbmd0aCA9PSAyKSB7CiAgICAg\nICAgICAgIGlmIChfa2V5LmdldERlY2xhcmVkVHlwZSgpID09IE9iamVjdC5j\nbGFzcykKICAgICAgICAgICAgICAgIF9rZXkuc2V0RGVjbGFyZWRUeXBlKHR5\ncGVzWzBdKTsKICAgICAgICAgICAgaWYgKF9lbGVtLmdldERlY2xhcmVkVHlw\nZSgpID09IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAgIF9lbGVtLnNl\ndERlY2xhcmVkVHlwZSh0eXBlc1sxXSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBiYWNraW5nIG1lbWJlciBzdXBwbGll\nZCBpbiB7QGxpbmsgI2JhY2tpbmdNZW1iZXJ9LgogICAgICovCiAgICBwdWJs\naWMgTWVtYmVyIGdldEJhY2tpbmdNZW1iZXIoKSB7CiAgICAgICAgcmV0dXJu\nIChfYmFja2luZ01lbWJlciA9PSBudWxsKSA/IG51bGwgOiBfYmFja2luZ01l\nbWJlci5nZXRNZW1iZXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBt\nZXRhZGF0YSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgTWV0YURh\ndGFSZXBvc2l0b3J5IGdldFJlcG9zaXRvcnkoKSB7CiAgICAgICAgcmV0dXJu\nIF9vd25lci5nZXRSZXBvc2l0b3J5KCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgY2xhc3MgdGhhdCBkZWZpbmVzIHRoZSBtZXRhZGF0YSBmb3IgdGhp\ncyBmaWVsZC4KICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0\nRGVmaW5pbmdNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gX293bmVyOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIGRlY2xhcmluZyBjbGFzcy4KICAg\nICAqLwogICAgcHVibGljIENsYXNzIGdldERlY2xhcmluZ1R5cGUoKSB7CiAg\nICAgICAgcmV0dXJuIChfZGVjID09IG51bGwpID8gX293bmVyLmdldERlc2Ny\naWJlZFR5cGUoKSA6IF9kZWM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\nZGVjbGFyaW5nIGNsYXNzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRE\nZWNsYXJpbmdUeXBlKENsYXNzIGNscykgewogICAgICAgIF9kZWMgPSBjbHM7\nCiAgICAgICAgX2RlY01ldGEgPSBudWxsOwogICAgICAgIF9mdWxsTmFtZSA9\nIG51bGw7CiAgICAgICAgX2VtYmVkRnVsbE5hbWUgPSBudWxsOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIGRlY2xhcmluZyBjbGFzcy4KICAgICAqLwog\nICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0RGVjbGFyaW5nTWV0YURhdGEo\nKSB7CiAgICAgICAgaWYgKF9kZWMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIF9vd25lcjsKICAgICAgICBpZiAoX2RlY01ldGEgPT0gbnVsbCkKICAg\nICAgICAgICAgX2RlY01ldGEgPSBnZXRSZXBvc2l0b3J5KCkuZ2V0TWV0YURh\ndGEoX2RlYywKICAgICAgICAgICAgICAgIF9vd25lci5nZXRFbnZDbGFzc0xv\nYWRlcigpLCB0cnVlKTsKICAgICAgICByZXR1cm4gX2RlY01ldGE7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgZmllbGQgbmFtZS4KICAgICAqLwogICAg\ncHVibGljIFN0cmluZyBnZXROYW1lKCkgewogICAgICAgIHJldHVybiBfbmFt\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBmaWVsZCBuYW1lLCBxdWFs\naWZpZWQgYnkgdGhlIG93bmluZyBjbGFzcy4KICAgICAqIEBkZXByZWNhdGVk\nIFVzZSBnZXRGdWxsTmFtZShib29sZWFuKSBpbnN0ZWFkLgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldEZ1bGxOYW1lKCkgewogICAgICAgIHJldHVy\nbiBnZXRGdWxsTmFtZShmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgZmllbGQgbmFtZSwgcXVhbGlmaWVkIGJ5IHRoZSBvd25pbmcgY2xhc3Mg\nYW5kIG9wdGlvbmFsbHkgdGhlCiAgICAgKiBlbWJlZGRpbmcgb3duZXIncyBu\nYW1lIChpZiBhbnkpLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldEZ1\nbGxOYW1lKGJvb2xlYW4gZW1iZWRPd25lcikgewogICAgICAgIGlmIChfZnVs\nbE5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgX2Z1bGxOYW1lID0gZ2V0RGVj\nbGFyaW5nVHlwZSgpLmdldE5hbWUoKSArICIuIiArIF9uYW1lOwogICAgICAg\nIGlmIChlbWJlZE93bmVyICYmIF9lbWJlZEZ1bGxOYW1lID09IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKF9vd25lci5nZXRFbWJlZGRpbmdNZXRhRGF0YSgp\nID09IG51bGwpCiAgICAgICAgICAgICAgICBfZW1iZWRGdWxsTmFtZSA9IF9m\ndWxsTmFtZTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2Vt\nYmVkRnVsbE5hbWUgPSBfb3duZXIuZ2V0RW1iZWRkaW5nTWV0YURhdGEoKS4K\nICAgICAgICAgICAgICAgICAgICBnZXRGaWVsZE1ldGFEYXRhKCkuZ2V0RnVs\nbE5hbWUodHJ1ZSkgKyAiLiIgKyBfZnVsbE5hbWU7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiAoZW1iZWRPd25lcikgPyBfZW1iZWRGdWxsTmFtZSA6IF9m\ndWxsTmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ldGFEYXRhIGFib3V0\nIHRoZSBmaWVsZCB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFZhbHVlTWV0\nYURhdGEgZ2V0VmFsdWUoKSB7CiAgICAgICAgcmV0dXJuIF92YWw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBNZXRhZGF0YSBhYm91dCB0aGUga2V5IHZhbHVl\nLgogICAgICovCiAgICBwdWJsaWMgVmFsdWVNZXRhRGF0YSBnZXRLZXkoKSB7\nCiAgICAgICAgcmV0dXJuIF9rZXk7CiAgICB9CgogICAgLyoqCiAgICAgKiBN\nZXRhZGF0YSBhYm91dCB0aGUgZWxlbWVudCB2YWx1ZS4KICAgICAqLwogICAg\ncHVibGljIFZhbHVlTWV0YURhdGEgZ2V0RWxlbWVudCgpIHsKICAgICAgICBy\nZXR1cm4gX2VsZW07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hl\ndGhlciB0aGlzIGZpZWxkIGlzIG1hcHBlZCB0byB0aGUgZGF0YXN0b3JlLiBC\neSBkZWZhdWx0LAogICAgICogcmV0dXJucyB0cnVlIGZvciBhbGwgcGVyc2lz\ndGVudCBmaWVsZHMgd2hvc2UgZGVmaW5pbmcgY2xhc3MgaXMgbWFwcGVkLgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc01hcHBlZCgpIHsKICAgICAg\nICByZXR1cm4gX21hbmFnZSA9PSBNQU5BR0VfUEVSU0lTVEVOVCAmJiBfb3du\nZXIuaXNNYXBwZWQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB0eXBl\nIHRoaXMgZmllbGQgd2FzIGluaXRpYWxpemVkIHdpdGgsIGFuZCB0aGVyZWZv\ncmUgdGhlCiAgICAgKiB0eXBlIHRvIHVzZSBmb3IgcHJveGllcyB3aGVuIGxv\nYWRpbmcgZGF0YSBpbnRvIHRoaXMgZmllbGQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBDbGFzcyBnZXRQcm94eVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIChfcHJv\neHlDbGFzcyA9PSBudWxsKSA/IGdldERlY2xhcmVkVHlwZSgpIDogX3Byb3h5\nQ2xhc3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSB0aGlzIGZp\nZWxkIHdhcyBpbml0aWFsaXplZCB3aXRoLCBhbmQgdGhlcmVmb3JlIHRoZQog\nICAgICogdHlwZSB0byB1c2UgZm9yIHByb3hpZXMgd2hlbiBsb2FkaW5nIGRh\ndGEgaW50byB0aGlzIGZpZWxkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRQcm94eVR5cGUoQ2xhc3MgdHlwZSkgewogICAgICAgIF9wcm94eUNsYXNz\nID0gdHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBpbml0aWFsaXpl\nciB1c2VkIGJ5IHRoZSBmaWVsZCwgb3IgbnVsbCBpZiBub25lLiBUaGlzCiAg\nICAgKiBpcyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGZvciBpbml0aWFsaXpp\nbmcgdGhlIGZpZWxkLCBzdWNoIGFzCiAgICAgKiBhIGN1c3RvbSB7QGxpbmsg\nQ29tcGFyYXRvcn0gdXNlZCBieSBhIHtAbGluayBTZXR9IG9yCiAgICAgKiBh\nIHtAbGluayBUaW1lWm9uZX0gdXNlZCBieSBhIHtAbGluayBDYWxlbmRhcn0u\nCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0SW5pdGlhbGl6ZXIoKSB7\nCiAgICAgICAgcmV0dXJuIF9pbml0aWFsaXplcjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoZSBpbml0aWFsaXplciB1c2VkIGJ5IHRoZSBmaWVsZCwgb3Ig\nbnVsbCBpZiBub25lLiBUaGlzCiAgICAgKiBpcyBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uIGZvciBpbml0aWFsaXppbmcgdGhlIGZpZWxkLCBzdWNoIGFzCiAg\nICAgKiBhIGN1c3RvbSB7QGxpbmsgQ29tcGFyYXRvcn0gdXNlZCBieSBhIHtA\nbGluayBTZXR9IG9yCiAgICAgKiBhIHtAbGluayBUaW1lWm9uZX0gdXNlZCBi\neSBhIHtAbGluayBDYWxlbmRhcn0uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEluaXRpYWxpemVyKE9iamVjdCBpbml0aWFsaXplcikgewogICAgICAg\nIF9pbml0aWFsaXplciA9IGluaXRpYWxpemVyOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHdoZXRoZXIgdGhpcyBpcyBhIHRyYW5zaWVudCBmaWVs\nZC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNUcmFuc2llbnQoKSB7\nCiAgICAgICAgcmV0dXJuIF90cmFuc2llbnQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gd2hldGhlciB0aGlzIGlzIGEgdHJhbnNpZW50IGZpZWxk\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUcmFuc2llbnQoYm9vbGVh\nbiB0cmFucykgewogICAgICAgIF90cmFuc2llbnQgPSB0cmFuczsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBhYnNvbHV0ZSBpbmRleCBvZiB0aGlzIHBl\ncnNpc3RlbnQvdHJhbnNhY3Rpb25hbCBmaWVsZC4KICAgICAqLwogICAgcHVi\nbGljIGludCBnZXRJbmRleCgpIHsKICAgICAgICByZXR1cm4gX2luZGV4Owog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIGFic29sdXRlIGluZGV4IG9mIHRo\naXMgcGVyc2lzdGVudC90cmFuc2FjdGlvbmFsIGZpZWxkLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRJbmRleChpbnQgaW5kZXgpIHsKICAgICAgICBf\naW5kZXggPSBpbmRleDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSByZWxh\ndGl2ZSBpbmRleCBvZiB0aGlzIHBlcnNpc3RlbnQvdHJhbnNhY3Rpb25hbCBm\naWVsZC4KICAgICAqLwogICAgcHVibGljIGludCBnZXREZWNsYXJlZEluZGV4\nKCkgewogICAgICAgIHJldHVybiBfZGVjSW5kZXg7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgcmVsYXRpdmUgaW5kZXggb2YgdGhpcyBwZXJzaXN0ZW50\nL3RyYW5zYWN0aW9uYWwgZmllbGQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldERlY2xhcmVkSW5kZXgoaW50IGluZGV4KSB7CiAgICAgICAgX2RlY0lu\nZGV4ID0gaW5kZXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXgg\naW4gd2hpY2ggdGhpcyBmaWVsZCB3YXMgbGlzdGVkIGluIHRoZSBtZXRhZGF0\nYS4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPi0xPC9jb2RlPiBpZiB0aGlz\nIGZpZWxkIHdhcyBub3QgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4KICAgICAq\nLwogICAgcHVibGljIGludCBnZXRMaXN0aW5nSW5kZXgoKSB7CiAgICAgICAg\ncmV0dXJuIF9saXN0SW5kZXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\naW5kZXggaW4gd2hpY2ggdGhpcyBmaWVsZCB3YXMgbGlzdGVkIGluIHRoZSBt\nZXRhZGF0YS4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPi0xPC9jb2RlPiBp\nZiB0aGlzIGZpZWxkIHdhcyBub3QgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TGlzdGluZ0luZGV4KGludCBp\nbmRleCkgewogICAgICAgIF9saXN0SW5kZXggPSBpbmRleDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBhYnNvbHV0ZSBwcmltYXJ5IGtleSBpbmRleCBm\nb3IgdGhpcyBmaWVsZCwgb3IgLTEgaWYgbm90IGEgcHJpbWFyeQogICAgICog\na2V5LiBUaGUgZmlyc3QgcHJpbWFyeSBrZXkgZmllbGQgaGFzIGluZGV4IDAs\nIHRoZSBzZWNvbmQgaW5kZXggMSwgZXRjLgogICAgICovCiAgICBwdWJsaWMg\naW50IGdldFByaW1hcnlLZXlJbmRleCgpIHsKICAgICAgICByZXR1cm4gX3Br\nSW5kZXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYWJzb2x1dGUgcHJp\nbWFyeSBrZXkgaW5kZXggZm9yIHRoaXMgZmllbGQsIG9yIC0xIGlmIG5vdCBh\nIHByaW1hcnkKICAgICAqIGtleS4gVGhlIGZpcnN0IHByaW1hcnkga2V5IGZp\nZWxkIGhhcyBpbmRleCAwLCB0aGUgc2Vjb25kIGluZGV4IDEsIGV0Yy4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0UHJpbWFyeUtleUluZGV4KGludCBp\nbmRleCkgewogICAgICAgIF9wa0luZGV4ID0gaW5kZXg7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1hbmFnZW1lbnQgbGV2ZWwgZm9yIHRo\nZSBmaWVsZC4gV2lsbCBiZSBvbmUgb2Y6CiAgICAgKiA8dWw+CiAgICAgKiA8\nbGk+e0BsaW5rICNNQU5BR0VfUEVSU0lTVEVOVH06IHRoZSBmaWVsZCBpcyBw\nZXJzaXN0ZW50PC9saT4KICAgICAqIDxsaT57QGxpbmsgI01BTkFHRV9UUkFO\nU0FDVElPTkFMfTogdGhlIGZpZWxkIGlzIHRyYW5zYWN0aW9uYWwgYnV0IG5v\ndAogICAgICogcGVyc2lzdGVudDwvbGk+CiAgICAgKiA8bGk+e0BsaW5rICNN\nQU5BR0VfTk9ORX06IHRoZSBmaWVsZCBpcyBub3QgbWFuYWdlZDwvbGk+CiAg\nICAgKiA8L3VsPiBEZWZhdWx0cyB0byB7QGxpbmsgI01BTkFHRV9QRVJTSVNU\nRU5UfS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRNYW5hZ2VtZW50KCkg\newogICAgICAgIHJldHVybiBfbWFuYWdlOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBtYW5hZ2VtZW50IGxldmVsIGZvciB0aGUgZmllbGQu\nIFdpbGwgYmUgb25lIG9mOgogICAgICogPHVsPgogICAgICogPGxpPntAbGlu\nayAjTUFOQUdFX1BFUlNJU1RFTlR9OiB0aGUgZmllbGQgaXMgcGVyc2lzdGVu\ndDwvbGk+CiAgICAgKiA8bGk+e0BsaW5rICNNQU5BR0VfVFJBTlNBQ1RJT05B\nTH06IHRoZSBmaWVsZCBpcyB0cmFuc2FjdGlvbmFsIGJ1dCBub3QKICAgICAq\nIHBlcnNpc3RlbnQ8L2xpPgogICAgICogPGxpPntAbGluayAjTUFOQUdFX05P\nTkV9OiB0aGUgZmllbGQgaXMgbm90IG1hbmFnZWQ8L2xpPgogICAgICogPC91\nbD4gCiAgICAgKiBEZWZhdWx0cyB0byB7QGxpbmsgI01BTkFHRV9QRVJTSVNU\nRU5UfS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TWFuYWdlbWVudChp\nbnQgbWFuYWdlKSB7CiAgICAgICAgaWYgKChfbWFuYWdlID09IE1BTkFHRV9O\nT05FKSAhPSAobWFuYWdlID09IE1BTkFHRV9OT05FKSkKICAgICAgICAgICAg\nX293bmVyLmNsZWFyRmllbGRDYWNoZSgpOwogICAgICAgIF9tYW5hZ2UgPSBt\nYW5hZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgaXMg\nYSBwcmltYXJ5IGtleSBmaWVsZC4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gaXNQcmltYXJ5S2V5KCkgewogICAgICAgIHJldHVybiBfcHJpbUtleTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyBpcyBhIHByaW1h\ncnkga2V5IGZpZWxkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQcmlt\nYXJ5S2V5KGJvb2xlYW4gcHJpbUtleSkgewogICAgICAgIF9wcmltS2V5ID0g\ncHJpbUtleTsKICAgIH0KCiAgICAvKioKICAgICAqIEZvciBhIHByaW1hcnkg\na2V5IGZpZWxkLCByZXR1cm4gdGhlIHR5cGUgb2YgdGhlIGNvcnJlc3BvbmRp\nbmcgb2JqZWN0IGlkIAogICAgICogY2xhc3MgZmllbGQuCiAgICAgKi8KICAg\nIHB1YmxpYyBpbnQgZ2V0T2JqZWN0SWRGaWVsZFR5cGVDb2RlKCkgewogICAg\nICAgIENsYXNzTWV0YURhdGEgcmVsbWV0YSA9IGdldERlY2xhcmVkVHlwZU1l\ndGFEYXRhKCk7CiAgICAgICAgaWYgKHJlbG1ldGEgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGdldERlY2xhcmVkVHlwZUNvZGUoKTsKICAgICAgICBp\nZiAocmVsbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRh\nLklEX0RBVEFTVE9SRSkgewogICAgICAgICAgICBib29sZWFuIHVud3JhcCA9\nIGdldFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZh\ndWx0cygpLgogICAgICAgICAgICAgICAgaXNEYXRhU3RvcmVPYmplY3RJZEZp\nZWxkVW53cmFwcGVkKCk7CiAgICAgICAgICAgIHJldHVybiAodW53cmFwKSA/\nIEphdmFUeXBlcy5MT05HIDogSmF2YVR5cGVzLk9CSkVDVDsKICAgICAgICB9\nCiAgICAgICAgaWYgKHJlbG1ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuIHJlbG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygp\nWzBdLmdldE9iamVjdElkRmllbGRUeXBlQ29kZSgpOwogICAgICAgIHJldHVy\nbiBKYXZhVHlwZXMuT0JKRUNUOwogICAgfQoKICAgIC8qKgogICAgICogRm9y\nIGEgcHJpbWFyeSBrZXkgZmllbGQsIHJldHVybiB0aGUgdHlwZSBvZiB0aGUg\nY29ycmVzcG9uZGluZyBvYmplY3QgaWQgCiAgICAgKiBjbGFzcyBmaWVsZC4K\nICAgICAqLwogICAgcHVibGljIENsYXNzIGdldE9iamVjdElkRmllbGRUeXBl\nKCkgewogICAgICAgIENsYXNzTWV0YURhdGEgcmVsbWV0YSA9IGdldERlY2xh\ncmVkVHlwZU1ldGFEYXRhKCk7CiAgICAgICAgaWYgKHJlbG1ldGEgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIGdldERlY2xhcmVkVHlwZSgpOwogICAg\nICAgIHN3aXRjaCAocmVsbWV0YS5nZXRJZGVudGl0eVR5cGUoKSkgewogICAg\nICAgICAgICBjYXNlIENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFOgogICAg\nICAgICAgICAgICAgYm9vbGVhbiB1bndyYXAgPSBnZXRSZXBvc2l0b3J5KCku\nZ2V0TWV0YURhdGFGYWN0b3J5KCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nRGVmYXVsdHMoKS5pc0RhdGFTdG9yZU9iamVjdElkRmllbGRVbndyYXBwZWQo\nKTsKICAgICAgICAgICAgICAgIHJldHVybiAodW53cmFwKSA/IGxvbmcuY2xh\nc3MgOiBPYmplY3QuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgQ2xhc3NNZXRh\nRGF0YS5JRF9BUFBMSUNBVElPTjoKICAgICAgICAgICAgICAgIGlmIChyZWxt\nZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIHJlbG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpWzBdLgogICAg\nICAgICAgICAgICAgICAgICAgICBnZXRPYmplY3RJZEZpZWxkVHlwZSgpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIChyZWxtZXRhLmdldE9iamVjdElkVHlw\nZSgpID09IG51bGwpID8gT2JqZWN0LmNsYXNzCiAgICAgICAgICAgICAgICAg\nICAgOiByZWxtZXRhLmdldE9iamVjdElkVHlwZSgpOwogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5jbGFzczsK\nICAgICAgICB9IAogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGlz\nIGZpZWxkIGhvbGRzIG9wdGltaXN0aWMgdmVyc2lvbiBpbmZvcm1hdGlvbi4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNWZXJzaW9uKCkgewogICAg\nICAgIHJldHVybiBfdmVyc2lvbiA9PSBCb29sZWFuLlRSVUU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgZmllbGQgaG9sZHMgb3B0aW1p\nc3RpYyB2ZXJzaW9uIGluZm9ybWF0aW9uLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRWZXJzaW9uKGJvb2xlYW4gdmVyc2lvbikgewogICAgICAgIF92\nZXJzaW9uID0gKHZlcnNpb24pID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyBmaWVs\nZCBpcyBpbiB0aGUgZGVmYXVsdCBmZXRjaCBncm91cC4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgewogICAg\nICAgIGlmIChfZGZnID09IDApIHsKICAgICAgICAgICAgaWYgKF9tYW5hZ2Ug\nIT0gTUFOQUdFX1BFUlNJU1RFTlQgfHwgaXNQcmltYXJ5S2V5KCkgfHwgaXNW\nZXJzaW9uKCkpCiAgICAgICAgICAgICAgICBfZGZnID0gREZHX0ZBTFNFOwog\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGZpZWxkIGxl\nZnQgYXMgZGVmYXVsdDsgZGZnIHNldHRpbmcgZGVwZW5kcyBvbiB0eXBlCiAg\nICAgICAgICAgICAgICBzd2l0Y2ggKGdldFR5cGVDb2RlKCkpIHsKICAgICAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChpc1NlcmlhbGl6YWJsZSgpIHx8IGlzRW51\nbSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2RmZyA9IERGR19U\nUlVFOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBfZGZnID0gREZHX0ZBTFNFOwogICAgICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGlzTG9iQXJyYXkoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9k\nZmcgPSBERkdfVFJVRTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgX2RmZyA9IERGR19GQUxTRTsK\nICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgICAgICAg\nICAgX2RmZyA9IERGR19GQUxTRTsKICAgICAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgICAgICAgICAgX2RmZyA9IERGR19UUlVFOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAo\nX2RmZyAmIERGR19UUlVFKSA+IDA7CiAgICB9CgogICAgcHJpdmF0ZSBib29s\nZWFuIGlzRW51bSgpIHsKICAgICAgICBpZiAoX2VudW1GaWVsZCA9PSBudWxs\nKSB7CiAgICAgICAgICAgIENsYXNzIGR0ID0gZ2V0RGVjbGFyZWRUeXBlKCk7\nCiAgICAgICAgICAgIF9lbnVtRmllbGQgPSBKYXZhVmVyc2lvbnMuaXNFbnVt\nZXJhdGlvbihkdCkKICAgICAgICAgICAgICAgID8gQm9vbGVhbi5UUlVFIDog\nQm9vbGVhbi5GQUxTRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9lbnVt\nRmllbGQuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgcHJpdmF0ZSBib29s\nZWFuIGlzU2VyaWFsaXphYmxlKCkgewogICAgICAgIGlmIChfc2VyaWFsaXph\nYmxlRmllbGQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzcyBkdCA9IGdl\ndERlY2xhcmVkVHlwZSgpOwogICAgICAgICAgICBpZiAoU2VyaWFsaXphYmxl\nLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oZHQpKQogICAgICAgICAgICAgICAg\nX3NlcmlhbGl6YWJsZUZpZWxkID0gQm9vbGVhbi5UUlVFOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICBfc2VyaWFsaXphYmxlRmllbGQgPSBC\nb29sZWFuLkZBTFNFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3Nlcmlh\nbGl6YWJsZUZpZWxkLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIHByaXZh\ndGUgYm9vbGVhbiBpc0xvYkFycmF5KCkgewogICAgICAgIC8vIGNoZWNrIGZv\nciBieXRlW10sIEJ5dGVbXSwgY2hhcltdLCBDaGFyYWN0ZXJbXQogICAgICAg\nIGlmIChfbG9iRmllbGQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzcyBk\ndCA9IGdldERlY2xhcmVkVHlwZSgpOwogICAgICAgICAgICBpZiAoZHQgPT0g\nYnl0ZVtdLmNsYXNzIHx8IGR0ID09IEJ5dGVbXS5jbGFzcyB8fAogICAgICAg\nICAgICAgICAgZHQgPT0gY2hhcltdLmNsYXNzIHx8IGR0ID09IENoYXJhY3Rl\ncltdLmNsYXNzKQogICAgICAgICAgICAgICAgX2xvYkZpZWxkID0gQm9vbGVh\nbi5UUlVFOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfbG9i\nRmllbGQgPSBCb29sZWFuLkZBTFNFOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2xvYkZpZWxkLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciB0aGlzIGZpZWxkIGlzIGluIHRoZSBkZWZhdWx0IGZl\ndGNoIGdyb3VwLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbkRlZmF1\nbHRGZXRjaEdyb3VwKGJvb2xlYW4gZGZnKSB7CiAgICAgICAgaWYgKGRmZykK\nICAgICAgICAgICAgX2RmZyA9IERGR19UUlVFOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgX2RmZyA9IERGR19GQUxTRTsKICAgICAgICBfZGZnIHw9IERG\nR19FWFBMSUNJVDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhl\nIGRlZmF1bHQgZmV0Y2ggZ3JvdXAgc2V0dGluZyBpcyBleHBsaWNpdC4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNEZWZhdWx0RmV0Y2hHcm91cEV4\ncGxpY2l0KCkgewogICAgICAgIHJldHVybiAoX2RmZyAmIERGR19FWFBMSUNJ\nVCkgPiAwOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgZGVm\nYXVsdCBmZXRjaCBncm91cCBzZXR0aW5nIGlzIGV4cGxpY2l0LiBBbGxvdyBz\nZXR0aW5nCiAgICAgKiBmb3IgdGVzdGluZy4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0RGVmYXVsdEZldGNoR3JvdXBFeHBsaWNpdChib29sZWFuIGV4\ncGxpY2l0KSB7CiAgICAgICAgaWYgKGV4cGxpY2l0KQogICAgICAgICAgICBf\nZGZnIHw9IERGR19FWFBMSUNJVDsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIF9kZmcgJj0gfkRGR19FWFBMSUNJVDsKICAgIH0KCiAgICAvKioKICAgICAq\nIEdldHMgdGhlIG5hbWUgb2YgdGhlIGN1c3RvbSBmZXRjaCBncm91cHMgdGhv\nc2UgYXJlIGFzc29jaWF0ZWQgdG8gdGhpcyAKICAgICAqIHJlY2VpdmVyLiAg\nVGhpcyBkb2VzIG5vdCBpbmNsdWRlIHRoZSAiZGVmYXVsdCIgYW5kICJhbGwi\nIGZldGNoIGdyb3Vwcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBzZXQg\nb2YgZmV0Y2ggZ3JvdXAgbmFtZXMsIG5vdCBpbmNsdWRpbmcgdGhlIGRlZmF1\nbHQgYW5kCiAgICAgKiBhbGwgZmV0Y2ggZ3JvdXBzLgogICAgICovCiAgICBw\ndWJsaWMgU3RyaW5nW10gZ2V0Q3VzdG9tRmV0Y2hHcm91cHMoKSB7CiAgICAg\nICAgaWYgKF9mZ3MgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX2ZnU2V0\nID09IG51bGwgfHwgX21hbmFnZSAhPSBNQU5BR0VfUEVSU0lTVEVOVCAKICAg\nICAgICAgICAgICAgIHx8IGlzUHJpbWFyeUtleSgpIHx8IGlzVmVyc2lvbigp\nKQogICAgICAgICAgICAgICAgX2ZncyA9IG5ldyBTdHJpbmdbMF07CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9mZ3MgPSAoU3RyaW5nW10p\nIF9mZ1NldC50b0FycmF5KG5ldyBTdHJpbmdbX2ZnU2V0LnNpemUoKV0pOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2ZnczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoZSBmZXRjaCBncm91cCB0aGF0IGlzIHRvIGJlIGxvYWRlZCB3\naGVuIHRoaXMgcmVjZWl2ZXIgaXMgbG9hZGVkLCBvcgogICAgICogbnVsbCBp\nZiBub25lIHNldC4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRMb2Fk\nRmV0Y2hHcm91cCAoKSB7CiAgICAJcmV0dXJuIF9sZmc7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogVGhlIGZldGNoIGdyb3VwIHRoYXQgaXMgdG8gYmUg\nbG9hZGVkIHdoZW4gdGhpcyByZWNlaXZlciBpcyBsb2FkZWQsIG9yCiAgICAg\nKiBudWxsIGlmIG5vbmUgc2V0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRMb2FkRmV0Y2hHcm91cCAoU3RyaW5nIGxmZykgewogICAgICAgIGlmICgi\nIi5lcXVhbHMobGZnKSkKICAgICAgICAgICAgbGZnID0gbnVsbDsKICAgIAlf\nbGZnID0gbGZnOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGlz\nIGZpZWxkIGlzIGluIHRoZSBnaXZlbiBmZXRjaCBncm91cC4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gaXNJbkZldGNoR3JvdXAoU3RyaW5nIGZnKSB7\nCiAgICAgICAgaWYgKF9tYW5hZ2UgIT0gTUFOQUdFX1BFUlNJU1RFTlQgfHwg\naXNQcmltYXJ5S2V5KCkgfHwgaXNWZXJzaW9uKCkpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICBpZiAoRmV0Y2hHcm91cC5OQU1FX0FMTC5l\ncXVhbHMoZmcpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBp\nZiAoRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQuZXF1YWxzKGZnKSkKICAgICAg\nICAgICAgcmV0dXJuIGlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpOwogICAgICAg\nIHJldHVybiBfZmdTZXQgIT0gbnVsbCAmJiBfZmdTZXQuY29udGFpbnMoZmcp\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHdoZXRoZXIgdGhpcyBmaWVs\nZCBpcyBpbiB0aGUgZ2l2ZW4gZmV0Y2ggZ3JvdXAuCiAgICAgKgogICAgICog\nQHBhcmFtIGZnIGlzIHRoZSBuYW1lIG9mIGEgZmV0Y2ggZ3JvdXAgdGhhdCBt\ndXN0IGJlIHByZXNlbnQgaW4gdGhlCiAgICAgKiBjbGFzcyB0aGF0IGRlY2xh\ncmVkIHRoaXMgZmllbGQgb3IgYW55IG9mIGl0cyBwZXJzaXN0ZW50IHN1cGVy\nY2xhc3Nlcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW5GZXRjaEdy\nb3VwKFN0cmluZyBmZywgYm9vbGVhbiBpbikgewogICAgICAgIGlmIChTdHJp\nbmdVdGlscy5pc0VtcHR5KGZnKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbXB0eS1mZy1uYW1lIiwgdGhp\ncykpOwogICAgICAgIGlmIChmZy5lcXVhbHMoRmV0Y2hHcm91cC5OQU1FX0FM\nTCkpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoZmcuZXF1YWxz\nKEZldGNoR3JvdXAuTkFNRV9ERUZBVUxUKSkgewogICAgICAgICAgICBzZXRJ\nbkRlZmF1bHRGZXRjaEdyb3VwKGluKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KICAgICAgICBpZiAoX293bmVyLmdldEZldGNoR3JvdXAoZmcp\nID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgidW5rbm93bi1mZyIsIGZnLCB0aGlzKSk7CiAgICAg\nICAgaWYgKGluICYmIF9mZ1NldCA9PSBudWxsKQogICAgICAgICAgICBfZmdT\nZXQgPSBuZXcgSGFzaFNldCgpOwogICAgICAgIGlmICgoaW4gJiYgX2ZnU2V0\nLmFkZChmZykpCiAgICAgICAgICAgIHx8ICghaW4gJiYgX2ZnU2V0ICE9IG51\nbGwgJiYgX2ZnU2V0LnJlbW92ZShmZykpKQogICAgICAgICAgICBfZmdzID0g\nbnVsbDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBIb3cgdGhlIGRhdGEg\nc3RvcmUgc2hvdWxkIHRyZWF0IG51bGwgdmFsdWVzIGZvciB0aGlzIGZpZWxk\nOgogICAgICogPHVsPgogICAgICogPGxpPntAbGluayAjTlVMTF9VTlNFVH06\nIG5vIHZhbHVlIHN1cHBsaWVkPC9saT4KICAgICAqIDxsaT57QGxpbmsgI05V\nTExfTk9ORX06IGxlYXZlIG51bGwgdmFsdWVzIGFzIG51bGwgaW4gdGhlIGRh\ndGEgc3RvcmU8L2xpPgogICAgICogPGxpPntAbGluayAjTlVMTF9FWENFUFRJ\nT059OiB0aHJvdyBhbiBleGNlcHRpb24gaWYgdGhpcyBmaWVsZCBpcyBudWxs\nCiAgICAgKiBhdCBjb21taXQ8L2xpPgogICAgICogPGxpPntAbGluayAjTlVM\nTF9ERUZBVUxUfTogdXNlIHRoZSBkYXRhYmFzZSBkZWZhdWx0IGlmIHRoaXMg\nZmllbGQgaXMKICAgICAqIG51bGwgYXQgY29tbWl0PC9saT4KICAgICAqIDwv\ndWw+IERlZmF1bHRzIHRvIHtAbGluayAjTlVMTF9VTlNFVH0uCiAgICAgKi8K\nICAgIHB1YmxpYyBpbnQgZ2V0TnVsbFZhbHVlKCkgewogICAgICAgIHJldHVy\nbiBfbnVsbFZhbHVlOwogICAgfQoKICAgIC8qKgogICAgICogSG93IHRoZSBk\nYXRhIHN0b3JlIHNob3VsZCB0cmVhdCBudWxsIHZhbHVlcyBmb3IgdGhpcyBm\naWVsZDoKICAgICAqIDx1bD4KICAgICAqIDxsaT57QGxpbmsgI05VTExfVU5T\nRVR9OiBubyB2YWx1ZSBzdXBwbGllZDwvbGk+CiAgICAgKiA8bGk+e0BsaW5r\nICNOVUxMX05PTkV9OiBsZWF2ZSBudWxsIHZhbHVlcyBhcyBudWxsIGluIHRo\nZSBkYXRhIHN0b3JlPC9saT4KICAgICAqIDxsaT57QGxpbmsgI05VTExfRVhD\nRVBUSU9OfTogdGhyb3cgYW4gZXhjZXB0aW9uIGlmIHRoaXMgZmllbGQgaXMg\nbnVsbAogICAgICogYXQgY29tbWl0PC9saT4KICAgICAqIDxsaT57QGxpbmsg\nI05VTExfREVGQVVMVH06IHVzZSB0aGUgZGF0YWJhc2UgZGVmYXVsdCBpZiB0\naGlzIGZpZWxkIGlzCiAgICAgKiBudWxsIGF0IGNvbW1pdDwvbGk+CiAgICAg\nKiA8L3VsPiBEZWZhdWx0cyB0byB7QGxpbmsgI05VTExfVU5TRVR9LgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXROdWxsVmFsdWUoaW50IG51bGxWYWx1\nZSkgewogICAgICAgIF9udWxsVmFsdWUgPSBudWxsVmFsdWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgZmllbGQgaXMgZXhwbGljaXRs\neSBkZWNsYXJlZCBpbiB0aGUgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGlzRXhwbGljaXQoKSB7CiAgICAgICAgcmV0dXJuIF9leHBs\naWNpdDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyBmaWVs\nZCBpcyBleHBsaWNpdGx5IGRlY2xhcmVkIGluIHRoZSBtZXRhZGF0YS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0RXhwbGljaXQoYm9vbGVhbiBleHBs\naWNpdCkgewogICAgICAgIF9leHBsaWNpdCA9IGV4cGxpY2l0OwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIGZpZWxkIHRoYXQgdGhpcyBmaWVsZCBzaGFy\nZXMgYSBtYXBwaW5nIHdpdGguCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0TWFwcGVkQnkoKSB7CiAgICAgICAgcmV0dXJuIF9tYXBwZWRCeTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBmaWVsZCB0aGF0IHRoaXMgZmllbGQg\nc2hhcmVzIGEgbWFwcGluZyB3aXRoLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRNYXBwZWRCeShTdHJpbmcgbWFwcGVkKSB7CiAgICAgICAgX21hcHBl\nZEJ5ID0gbWFwcGVkOwogICAgICAgIF9tYXBwZWRCeU1ldGEgPSBudWxsOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIGZpZWxkIHRoYXQgdGhpcyBmaWVs\nZCBzaGFyZXMgYSBtYXBwaW5nIHdpdGguCiAgICAgKi8KICAgIHB1YmxpYyBG\naWVsZE1ldGFEYXRhIGdldE1hcHBlZEJ5TWV0YURhdGEoKSB7CiAgICAgICAg\naWYgKF9tYXBwZWRCeSAhPSBudWxsICYmIF9tYXBwZWRCeU1ldGEgPT0gbnVs\nbCkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBudWxsOwog\nICAgICAgICAgICBzd2l0Y2ggKGdldFR5cGVDb2RlKCkpIHsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgICAg\nIG1ldGEgPSBnZXRUeXBlTWV0YURhdGEoKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZ\nOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAg\nICAgICAgICAgICBtZXRhID0gX2VsZW0uZ2V0VHlwZU1ldGFEYXRhKCk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIEZpZWxkTWV0YURhdGEgZmllbGQgPSAobWV0YSA9PSBudWxsKSA/\nIG51bGwKICAgICAgICAgICAgICAgIDogbWV0YS5nZXRGaWVsZChfbWFwcGVk\nQnkpOwogICAgICAgICAgICBpZiAoZmllbGQgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm8tbWFwcGVkLWJ5IiwgdGhpcywKICAgICAgICAgICAgICAgICAgICBfbWFw\ncGVkQnkpKTsKICAgICAgICAgICAgaWYgKGZpZWxkLmdldE1hcHBlZEJ5KCkg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiY2lyYy1tYXBwZWQtYnkiLCB0aGlzLAogICAg\nICAgICAgICAgICAgICAgIF9tYXBwZWRCeSkpOwogICAgICAgICAgICBfbWFw\ncGVkQnlNZXRhID0gZmllbGQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nbWFwcGVkQnlNZXRhOwogICAgfQoKICAgIC8qKgogICAgICogTG9naWNhbCBp\nbnZlcnNlIGZpZWxkLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldElu\ndmVyc2UoKSB7CiAgICAgICAgaWYgKENsYXNzTWV0YURhdGEuREVGQVVMVF9T\nVFJJTkcuZXF1YWxzKF9pbnZlcnNlKSkKICAgICAgICAgICAgX2ludmVyc2Ug\nPSBudWxsOwogICAgICAgIHJldHVybiBfaW52ZXJzZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIExvZ2ljYWwgaW52ZXJzZSBmaWVsZC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0SW52ZXJzZShTdHJpbmcgaW52ZXJzZSkgewogICAg\nICAgIF9pbnZlcnNlcyA9IG51bGw7CiAgICAgICAgX2ludmVyc2UgPSBpbnZl\ncnNlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBpbnZlcnNl\ncyBvZiB0aGlzIGZpZWxkLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRh\nRGF0YVtdIGdldEludmVyc2VNZXRhRGF0YXMoKSB7CiAgICAgICAgaWYgKF9p\nbnZlcnNlcyA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGNhbid0IGRlY2xh\ncmUgYm90aCBhbiBpbnZlcnNlIG93bmVyIGFuZCBhIGxvZ2ljYWwgaW52ZXJz\nZQogICAgICAgICAgICBTdHJpbmcgaW52ID0gZ2V0SW52ZXJzZSgpOwogICAg\nICAgICAgICBpZiAoX21hcHBlZEJ5ICE9IG51bGwgJiYgaW52ICE9IG51bGwg\nJiYgIV9tYXBwZWRCeS5lcXVhbHMoaW52KSkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibWFwcGVkLW5v\ndC1pbnZlcnNlIiwKICAgICAgICAgICAgICAgICAgICB0aGlzKSk7CgogICAg\nICAgICAgICAvLyBnZXQgdGhlIG1ldGFkYXRhIGZvciB0aGUgdHlwZSBvbiB0\naGUgb3RoZXIgc2lkZSBvZiB0aGlzIHJlbGF0aW9uCiAgICAgICAgICAgIENs\nYXNzTWV0YURhdGEgbWV0YSA9IG51bGw7CiAgICAgICAgICAgIHN3aXRjaCAo\nZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuUEM6CiAgICAgICAgICAgICAgICAgICAgbWV0YSA9IGdldFR5cGVNZXRh\nRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgICAg\nIG1ldGEgPSBfZWxlbS5nZXRUeXBlTWV0YURhdGEoKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQ29s\nbGVjdGlvbiBpbnZlcnNlcyA9IG51bGw7CiAgICAgICAgICAgIGlmIChtZXRh\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGFkZCBtYXBwZWQgYnkg\nYW5kIG5hbWVkIGludmVyc2UsIGlmIGFueQogICAgICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YSBmaWVsZCA9IGdldE1hcHBlZEJ5TWV0YURhdGEoKTsKICAg\nICAgICAgICAgICAgIGlmIChmaWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgLy8gbWFwcGVkIGJ5IGZpZWxkIGlzbid0IG5lY2Vzc2FyaWx5\nIGEgcGMgdHlwZSwgYnV0IGFsbAogICAgICAgICAgICAgICAgICAgIC8vIGlu\ndmVyc2VzIG11c3QgYmUKICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQu\nZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMKICAgICAgICAgICAgICAg\nICAgICAgICAgfHwgZmllbGQuZ2V0RWxlbWVudCgpLmdldFR5cGVDb2RlKCkg\nPT0gSmF2YVR5cGVzLlBDKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlu\ndmVyc2VzID0gbmV3IEFycmF5TGlzdCgzKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgaW52ZXJzZXMuYWRkKGZpZWxkKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGludiAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBtZXRhLmdldEZpZWxkKGlu\ndik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8taW52ZXJzZSIsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB0aGlzLCBpbnYpKTsKICAgICAgICAgICAgICAgICAgICBp\nbnZlcnNlcyA9IG5ldyBBcnJheUxpc3QoMyk7CiAgICAgICAgICAgICAgICAg\nICAgaW52ZXJzZXMuYWRkKGZpZWxkKTsKICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgICAgICAvLyBzY2FuIHJlbCB0eXBlIGZvciBmaWVsZHMgdGhh\ndCBuYW1lIHRoaXMgZmllbGQgYXMgYW4gaW52ZXJzZQogICAgICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IG1ldGEuZ2V0RmllbGRzKCk7\nCiAgICAgICAgICAgICAgICBDbGFzcyB0eXBlID0gZ2V0RGVjbGFyaW5nTWV0\nYURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgICAgIC8vIHNraXAgZmllbGRzIHRoYXQgYXJlbid0IGNv\nbXBhdGlibGUgd2l0aCBvdXIgb3duaW5nIGNsYXNzCiAgICAgICAgICAgICAg\nICAgICAgc3dpdGNoIChmaWVsZHNbaV0uZ2V0VHlwZUNvZGUoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmICghdHlwZS5pc0Fzc2lnbmFibGVG\ncm9tKGZpZWxkc1tpXS5nZXRUeXBlKCkpKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKCF0eXBlLmlzQXNzaWduYWJsZUZyb20oZmllbGRzW2ldLgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEVsZW1lbnQoKS5nZXRU\neXBlKCkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBmaWVsZCBkZWNsYXJlcyB1\ncyBhcyBpdHMgaW52ZXJzZSBhbmQgd2UgaGF2ZW4ndAogICAgICAgICAgICAg\nICAgICAgIC8vIGFscmVhZHkgYWRkZWQgaXQgKHdlIG1pZ2h0IGhhdmUgaWYg\nd2UgYWxzbyBkZWNsYXJlZCBpdAogICAgICAgICAgICAgICAgICAgIC8vIGFz\nIG91ciBpbnZlcnNlKSwgYWRkIGl0IG5vdwogICAgICAgICAgICAgICAgICAg\nIGlmIChfbmFtZS5lcXVhbHMoZmllbGRzW2ldLmdldE1hcHBlZEJ5KCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHx8IF9uYW1lLmVxdWFscyhmaWVsZHNb\naV0uZ2V0SW52ZXJzZSgpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoaW52ZXJzZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGludmVyc2VzID0gbmV3IEFycmF5TGlzdCgzKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKCFpbnZlcnNlcy5jb250YWlucyhmaWVsZHNbaV0p\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW52ZXJzZXMuYWRkKGZp\nZWxkc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBNZXRhRGF0YVJlcG9z\naXRvcnkgcmVwb3MgPSBnZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgICAgIGlm\nIChpbnZlcnNlcyA9PSBudWxsKQogICAgICAgICAgICAgICAgX2ludmVyc2Vz\nID0gcmVwb3MuRU1QVFlfRklFTERTOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBfaW52ZXJzZXMgPSAoRmllbGRNZXRhRGF0YVtdKSBpbnZl\ncnNlcy50b0FycmF5CiAgICAgICAgICAgICAgICAgICAgKHJlcG9zLm5ld0Zp\nZWxkTWV0YURhdGFBcnJheShpbnZlcnNlcy5zaXplKCkpKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIF9pbnZlcnNlczsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBzdHJhdGVneSB0byB1c2UgZm9yIGluc2VydCB2YWx1ZSBnZW5l\ncmF0aW9uLgogICAgICogT25lIG9mIHRoZSBjb25zdGFudHMgZnJvbSB7QGxp\nbmsgVmFsdWVTdHJhdGVnaWVzfS4KICAgICAqLwogICAgcHVibGljIGludCBn\nZXRWYWx1ZVN0cmF0ZWd5KCkgewogICAgICAgIGlmIChfdmFsU3RyYXRlZ3kg\nPT0gLTEpCiAgICAgICAgICAgIF92YWxTdHJhdGVneSA9IFZhbHVlU3RyYXRl\nZ2llcy5OT05FOwogICAgICAgIHJldHVybiBfdmFsU3RyYXRlZ3k7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgc3RyYXRlZ3kgdG8gdXNlIGZvciBpbnNl\ncnQgdmFsdWUgZ2VuZXJhdGlvbi4KICAgICAqIE9uZSBvZiB0aGUgY29uc3Rh\nbnRzIGZyb20ge0BsaW5rIFZhbHVlU3RyYXRlZ2llc30uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldFZhbHVlU3RyYXRlZ3koaW50IHN0cmF0ZWd5KSB7\nCiAgICAgICAgX3ZhbFN0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAgICAgICAgaWYg\nKHN0cmF0ZWd5ICE9IFZhbHVlU3RyYXRlZ2llcy5TRVFVRU5DRSkKICAgICAg\nICAgICAgc2V0VmFsdWVTZXF1ZW5jZU5hbWUobnVsbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgdmFsdWUgc2VxdWVuY2UgbmFtZSwgb3IgbnVsbCBm\nb3Igbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWx1ZVNl\ncXVlbmNlTmFtZSgpIHsKICAgICAgICBpZiAoQ2xhc3NNZXRhRGF0YS5ERUZB\nVUxUX1NUUklORy5lcXVhbHMoX3NlcU5hbWUpKQogICAgICAgICAgICBfc2Vx\nTmFtZSA9IG51bGw7CiAgICAgICAgcmV0dXJuIF9zZXFOYW1lOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHZhbHVlIHNlcXVlbmNlIG5hbWUsIG9yIG51\nbGwgZm9yIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFZhbHVl\nU2VxdWVuY2VOYW1lKFN0cmluZyBzZXFOYW1lKSB7CiAgICAgICAgX3NlcU5h\nbWUgPSBzZXFOYW1lOwogICAgICAgIF9zZXFNZXRhID0gbnVsbDsKICAgICAg\nICBpZiAoc2VxTmFtZSAhPSBudWxsKQogICAgICAgICAgICBzZXRWYWx1ZVN0\ncmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5TRVFVRU5DRSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBNZXRhZGF0YSBmb3IgdGhlIHZhbHVlIHNlcXVlbmNlLgog\nICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VNZXRhRGF0YSBnZXRWYWx1ZVNl\ncXVlbmNlTWV0YURhdGEoKSB7CiAgICAgICAgaWYgKF9zZXFNZXRhID09IG51\nbGwgJiYgZ2V0VmFsdWVTZXF1ZW5jZU5hbWUoKSAhPSBudWxsKQogICAgICAg\nICAgICBfc2VxTWV0YSA9IGdldFJlcG9zaXRvcnkoKS5nZXRTZXF1ZW5jZU1l\ndGFEYXRhKF9vd25lciwKICAgICAgICAgICAgICAgIGdldFZhbHVlU2VxdWVu\nY2VOYW1lKCksIHRydWUpOwogICAgICAgIHJldHVybiBfc2VxTWV0YTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBzdHJhdGVneSB0byB1c2Ugd2hlbiB1\ncGRhdGluZyB0aGUgZmllbGQuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0\nVXBkYXRlU3RyYXRlZ3koKSB7CiAgICAgICAgaWYgKGlzVmVyc2lvbigpKQog\nICAgICAgICAgICByZXR1cm4gVXBkYXRlU3RyYXRlZ2llcy5SRVNUUklDVDsK\nICAgICAgICBpZiAoX3VwU3RyYXRlZ3kgPT0gLTEpCiAgICAgICAgICAgIF91\ncFN0cmF0ZWd5ID0gVXBkYXRlU3RyYXRlZ2llcy5OT05FOwogICAgICAgIHJl\ndHVybiBfdXBTdHJhdGVneTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgdXBkYXRlIHN0cmF0ZWd5LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRVcGRhdGVTdHJhdGVneShpbnQgc3RyYXRlZ3kpIHsKICAgICAgICBfdXBT\ndHJhdGVneSA9IHN0cmF0ZWd5OwogICAgfQoKICAgIC8qKgogICAgICogV2hl\ndGhlciB0aGlzIGZpZWxkIGlzIGJhY2tlZCBieSBhIGxhcmdlIHJlc3VsdCBz\nZXQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzTFJTKCkgewogICAg\nICAgIHJldHVybiBfbHJzID09IEJvb2xlYW4uVFJVRSAmJiBfbWFuYWdlID09\nIE1BTkFHRV9QRVJTSVNURU5UOwogICAgfQoKICAgIC8qKgogICAgICogV2hl\ndGhlciB0aGlzIGZpZWxkIGlzIGJhY2tlZCBieSBhIGxhcmdlIHJlc3VsdCBz\nZXQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldExSUyhib29sZWFuIGxy\ncykgewogICAgICAgIF9scnMgPSAobHJzKSA/IEJvb2xlYW4uVFJVRSA6IEJv\nb2xlYW4uRkFMU0U7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRo\naXMgZmllbGQgdXNlcyBpbnRlcm1lZGlhdGUgZGF0YSB3aGVuIGxvYWRpbmcv\nc3RvcmluZwogICAgICogaW5mb3JtYXRpb24gdGhyb3VnaCBhIHtAbGluayBP\ncGVuSlBBU3RhdGVNYW5hZ2VyfS4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAq\nCiAgICAgKiBAc2VlIE9wZW5KUEFTdGF0ZU1hbmFnZXIjc2V0SW50ZXJtZWRp\nYXRlKGludCxPYmplY3QpCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHVz\nZXNJbnRlcm1lZGlhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9pbnRlcm1lZGlh\ndGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgZmllbGQg\ndXNlcyBpbnRlcm1lZGlhdGUgZGF0YSB3aGVuIGxvYWRpbmcvc3RvcmluZwog\nICAgICogaW5mb3JtYXRpb24gdGhyb3VnaCBhIHtAbGluayBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyfS4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqCiAgICAgKiBA\nc2VlIE9wZW5KUEFTdGF0ZU1hbmFnZXIjc2V0SW50ZXJtZWRpYXRlKGludCxP\nYmplY3QpCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFVzZXNJbnRlcm1l\nZGlhdGUoYm9vbGVhbiBpbnRlcm1lZGlhdGUpIHsKICAgICAgICBfaW50ZXJt\nZWRpYXRlID0gaW50ZXJtZWRpYXRlOwogICAgICAgIF9vd25lci5jbGVhckV4\ndHJhRmllbGREYXRhVGFibGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgdGhpcyBmaWVsZCB1c2VzIGltcGwgZGF0YSBpbiBjb25qdW5jdGlv\nbiB3aXRoIHN0YW5kYXJkCiAgICAgKiBmaWVsZCBkYXRhIHdoZW4gYWN0aW5n\nIG9uIGEge0BsaW5rIE9wZW5KUEFTdGF0ZU1hbmFnZXJ9LgogICAgICogRGVm\nYXVsdHMgdG8ge0BsaW5rIEJvb2xlYW4jVFJVRX0gKG5vbi1jYWNoYWJsZSBp\nbXBsIGRhdGEpLgogICAgICoKICAgICAqIEByZXR1cm4ge0BsaW5rIEJvb2xl\nYW4jRkFMU0V9IGlmIHRoaXMgZmllbGQgZG9lcyBub3QgdXNlIGltcGwgZGF0\nYSwKICAgICAqIHtAbGluayBCb29sZWFuI1RSVUV9IGlmIHRoaXMgZmllbGQg\ndXNlcyBub24tY2FjaGFibGUgaW1wbAogICAgICogZGF0YSwgb3IgPGNvZGU+\nbnVsbDwvY29kZT4gaWYgdGhpcyBmaWVsZCB1c2VzIGltcGwgZGF0YSB0aGF0\nCiAgICAgKiBzaG91bGQgYmUgY2FjaGVkIGFjcm9zcyBpbnN0YW5jZXMKICAg\nICAqIEBzZWUgT3BlbkpQQVN0YXRlTWFuYWdlciNzZXRJbXBsRGF0YShpbnQs\nT2JqZWN0KQogICAgICovCiAgICBwdWJsaWMgQm9vbGVhbiB1c2VzSW1wbERh\ndGEoKSB7CiAgICAgICAgcmV0dXJuIF9pbXBsRGF0YTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgdGhpcyBmaWVsZCB1c2VzIGltcGwgZGF0YSBp\nbiBjb25qdW5jdGlvbiB3aXRoIHN0YW5kYXJkCiAgICAgKiBmaWVsZCBkYXRh\nIHdoZW4gYWN0aW5nIG9uIGEge0BsaW5rIE9wZW5KUEFTdGF0ZU1hbmFnZXJ9\nLgogICAgICoKICAgICAqIEBzZWUgT3BlbkpQQVN0YXRlTWFuYWdlciNzZXRJ\nbXBsRGF0YShpbnQsT2JqZWN0KQogICAgICogQHNlZSAjdXNlc0ltcGxEYXRh\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFVzZXNJbXBsRGF0YShCb29s\nZWFuIGltcGxEYXRhKSB7CiAgICAgICAgX2ltcGxEYXRhID0gaW1wbERhdGE7\nCiAgICAgICAgX293bmVyLmNsZWFyRXh0cmFGaWVsZERhdGFUYWJsZSgpOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIG9yZGVyaW5ncyBmb3IgdGhpcyBm\naWVsZCB0byBiZSBhcHBsaWVkIG9uIGxvYWQsIG9yIGVtcHR5IGFycmF5Lgog\nICAgICovCiAgICBwdWJsaWMgT3JkZXJbXSBnZXRPcmRlcnMoKSB7CiAgICAg\nICAgaWYgKF9vcmRlcnMgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX29y\nZGVyRGVjID09IG51bGwpCiAgICAgICAgICAgICAgICBfb3JkZXJzID0gZ2V0\nUmVwb3NpdG9yeSgpLkVNUFRZX09SREVSUzsKICAgICAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgICAgICBTdHJpbmdbXSBkZWNzID0gU3RyaW5ncy5zcGxp\ndChfb3JkZXJEZWMsICIsIiwgMCk7CiAgICAgICAgICAgICAgICBPcmRlcltd\nIG9yZGVycyA9IGdldFJlcG9zaXRvcnkoKS5uZXdPcmRlckFycmF5KGRlY3Mu\nbGVuZ3RoKTsKICAgICAgICAgICAgICAgIGludCBzcGM7CiAgICAgICAgICAg\nICAgICBib29sZWFuIGFzYzsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZGVjcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\nICAgIGRlY3NbaV0gPSBkZWNzW2ldLnRyaW0oKTsKICAgICAgICAgICAgICAg\nICAgICBzcGMgPSBkZWNzW2ldLmluZGV4T2YoJyAnKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAoc3BjID09IC0xKQogICAgICAgICAgICAgICAgICAgICAg\nICBhc2MgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAg\nICAgICAgICAgICAgICAgICAgICBhc2MgPSBkZWNzW2ldLnN1YnN0cmluZyhz\ncGMgKyAxKS50cmltKCkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0\nb0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoImFzYyIpOwogICAgICAgICAgICAg\nICAgICAgICAgICBkZWNzW2ldID0gZGVjc1tpXS5zdWJzdHJpbmcoMCwgc3Bj\nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nb3JkZXJzW2ldID0gZ2V0UmVwb3NpdG9yeSgpLm5ld09yZGVyKHRoaXMsIGRl\nY3NbaV0sIGFzYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBfb3JkZXJzID0gb3JkZXJzOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBfb3JkZXJzOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIG9yZGVyaW5ncyBmb3IgdGhpcyBmaWVsZCB0byBiZSBhcHBsaWVkIG9u\nIGxvYWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE9yZGVycyhPcmRl\ncltdIG9yZGVycykgewogICAgICAgIF9vcmRlckRlYyA9IG51bGw7CiAgICAg\nICAgX29yZGVycyA9IG9yZGVyczsKICAgIH0KCiAgICAvKioKICAgICAqIFN0\ncmluZyBkZWNsYXJpbmcgdGhlIG9yZGVyaW5ncyBmb3IgdGhpcyBmaWVsZCB0\nbyBiZSBhcHBsaWVkIG9uIGxvYWQsCiAgICAgKiBvciBudWxsLiBUaGUgc3Ry\naW5nIGlzIG9mIHRoZSBmb3JtOjxiciAvPgogICAgICogPGNvZGU+b3JkZXJh\nYmxlWyBhc2N8ZGVzY11bLCAuLi5dPC9jb2RlPjxiciAvPgogICAgICogVGhl\nIG9yZGVyYWJsZSA8Y29kZT4jZWxlbWVudDwvY29kZT4gaXMgdXNlZCB0byBk\nZW5vdGUgdGhlIHZhbHVlIG9mCiAgICAgKiB0aGUgZmllbGQncyBlbGVtZW50\ncy4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRPcmRlckRlY2xhcmF0\naW9uKCkgewogICAgICAgIGlmIChfb3JkZXJEZWMgPT0gbnVsbCAmJiBfb3Jk\nZXJzICE9IG51bGwpIHsKICAgICAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9\nIG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBfb3JkZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAoaSA+IDApCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nLCAiKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX29yZGVyc1tpXS5n\nZXROYW1lKCkpLmFwcGVuZCgiICIpOwogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZCgoX29yZGVyc1tpXS5pc0FzY2VuZGluZygpKSA/ICJhc2MiIDogImRl\nc2MiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfb3JkZXJEZWMgPSBi\ndWYudG9TdHJpbmcoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9vcmRl\nckRlYzsKICAgIH0KCiAgICAvKioKICAgICAqIFN0cmluZyBkZWNsYXJpbmcg\ndGhlIG9yZGVyaW5ncyBmb3IgdGhpcyBmaWVsZCB0byBiZSBhcHBsaWVkIG9u\nIGxvYWQsCiAgICAgKiBvciBudWxsLiBUaGUgc3RyaW5nIGlzIG9mIHRoZSBm\nb3JtOjxiciAvPgogICAgICogPGNvZGU+b3JkZXJhYmxlWyBhc2N8ZGVzY11b\nLCAuLi5dPC9jb2RlPjxiciAvPgogICAgICogVGhlIG9yZGVyYWJsZSA8Y29k\nZT4jZWxlbWVudDwvY29kZT4gaXMgdXNlZCB0byBkZW5vdGUgdGhlIHZhbHVl\nIG9mCiAgICAgKiB0aGUgZmllbGQncyBlbGVtZW50cy4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0T3JkZXJEZWNsYXJhdGlvbihTdHJpbmcgZGVjKSB7\nCiAgICAgICAgX29yZGVyRGVjID0gU3RyaW5nVXRpbHMudHJpbVRvTnVsbChk\nZWMpOwogICAgICAgIF9vcmRlcnMgPSBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogT3JkZXIgdGhpcyBmaWVsZCB2YWx1ZSB3aGVuIGl0IGlzIGxvYWRl\nZC4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBvcmRlcihPYmplY3QgdmFs\nKSB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgT3JkZXJbXSBvcmRlcnMgPSBnZXRPcmRlcnMo\nKTsKICAgICAgICBpZiAob3JkZXJzLmxlbmd0aCA9PSAwKQogICAgICAgICAg\nICByZXR1cm4gdmFsOwoKICAgICAgICAvLyBjcmVhdGUgYSBjb21wYXJhdG9y\nIGZvciB0aGUgZWxlbWVudHMgb2YgdGhlIHZhbHVlCiAgICAgICAgQ29tcGFy\nYXRvciBjb21wOwogICAgICAgIGlmIChvcmRlcnMubGVuZ3RoID09IDEpCiAg\nICAgICAgICAgIGNvbXAgPSBvcmRlcnNbMF0uZ2V0Q29tcGFyYXRvcigpOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICBMaXN0IGNvbXBzID0gbnVsbDsK\nICAgICAgICAgICAgQ29tcGFyYXRvciBjdXJDb21wOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IG9yZGVycy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgY3VyQ29tcCA9IG9yZGVyc1tpXS5nZXRDb21wYXJhdG9y\nKCk7CiAgICAgICAgICAgICAgICBpZiAoY3VyQ29tcCAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGNvbXBzID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbXBzID0gbmV3IEFycmF5TGlzdChvcmRlcnMu\nbGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaSAhPSBjb21wcy5z\naXplKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKCJtaXhlZC1pbm1lbS1vcmRlcmluZyIsIHRoaXMpKTsKICAgICAg\nICAgICAgICAgICAgICBjb21wcy5hZGQoY3VyQ29tcCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvbXBzID09\nIG51bGwpCiAgICAgICAgICAgICAgICBjb21wID0gbnVsbDsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgY29tcCA9IG5ldyBDb21wYXJhdG9y\nQ2hhaW4oY29tcHMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbXAgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHZhbDsKCiAgICAgICAgLy8gc29y\ndAogICAgICAgIHN3aXRjaCAoZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIExpc3Qg\nbCA9IEphdmFUeXBlcy50b0xpc3QodmFsLCBfZWxlbS5nZXRUeXBlKCksIHRy\ndWUpOwogICAgICAgICAgICAgICAgQ29sbGVjdGlvbnMuc29ydChsLCBjb21w\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBKYXZhVHlwZXMudG9BcnJheShs\nLCBfZWxlbS5nZXRUeXBlKCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5j\nZW9mIExpc3QpCiAgICAgICAgICAgICAgICAgICAgQ29sbGVjdGlvbnMuc29y\ndCgoTGlzdCkgdmFsLCBjb21wKTsKICAgICAgICAgICAgICAgIHJldHVybiB2\nYWw7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImNhbnQtb3JkZXIi\nLCB0aGlzKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hl\ndGhlciB0aGUgZmllbGQgaXMgZXh0ZXJuYWxpemVkLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0V4dGVybmFsaXplZCgpIHsKICAgICAgICByZXR1\ncm4gZ2V0RXh0ZXJuYWxpemVyTWV0aG9kKCkgIT0gbnVsbAogICAgICAgICAg\nICB8fCBnZXRFeHRlcm5hbFZhbHVlTWFwKCkgIT0gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIGdpdmVuIGZpZWxkIHZhbHVlIHRv\nIGl0cyBleHRlcm5hbCB2YWx1ZSB0aHJvdWdoIHRoZQogICAgICogcHJvdmlk\nZWQgZXh0ZXJuYWxpemVyLCBvciByZXR1cm4gdGhlIHZhbHVlIGFzLWlzIGlm\nIG5vIGV4dGVybmFsaXplci4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBn\nZXRFeHRlcm5hbFZhbHVlKE9iamVjdCB2YWwsIFN0b3JlQ29udGV4dCBjdHgp\nIHsKICAgICAgICBNYXAgZXh0VmFsdWVzID0gZ2V0RXh0ZXJuYWxWYWx1ZU1h\ncCgpOwogICAgICAgIGlmIChleHRWYWx1ZXMgIT0gbnVsbCkgewogICAgICAg\nICAgICBPYmplY3QgZm91bmRWYWwgPSBleHRWYWx1ZXMuZ2V0KHZhbCk7CiAg\nICAgICAgICAgIGlmIChmb3VuZFZhbCA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWV4\ndGVybmFsaXplZC12YWx1ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5l\ndyBPYmplY3RbXSB7IHZhbCwgZXh0VmFsdWVzLmtleVNldCgpLCB0aGlzIH0p\nKQogICAgICAgICAgICAgICAgICAgICAgICAuc2V0RmF0YWwodHJ1ZSkuc2V0\nRmFpbGVkT2JqZWN0KHZhbCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gZm91bmRWYWw7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIE1ldGhvZCBleHRlcm5hbGl6ZXIgPSBnZXRFeHRl\ncm5hbGl6ZXJNZXRob2QoKTsKICAgICAgICBpZiAoZXh0ZXJuYWxpemVyID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiB2YWw7CgogICAgICAgIC8vIHNw\nZWNpYWwgY2FzZSBmb3IgcXVlcmllczogYWxsb3cgdGhlIGdpdmVuIHZhbHVl\nIHRvIHBhc3MgdGhyb3VnaAogICAgICAgIC8vIGFzLWlzIGlmIGl0IGlzIGFs\ncmVhZHkgaW4gZXh0ZXJuYWxpemVkIGZvcm0KICAgICAgICBpZiAodmFsICE9\nIG51bGwgJiYgZ2V0VHlwZSgpLmlzSW5zdGFuY2UodmFsKQogICAgICAgICAg\nICAmJiAoIWdldERlY2xhcmVkVHlwZSgpLmlzSW5zdGFuY2UodmFsKQogICAg\nICAgICAgICB8fCBnZXREZWNsYXJlZFR5cGUoKSA9PSBPYmplY3QuY2xhc3Mp\nKQogICAgICAgICAgICByZXR1cm4gdmFsOwoKICAgICAgICB0cnkgewogICAg\nICAgICAgICAvLyBlaXRoZXIgaW52b2tlIHRoZSBzdGF0aWMgdG9FeHRlcm5h\nbCh2YWxbLCBjdHhdKSBtZXRob2QsIG9yIHRoZQogICAgICAgICAgICAvLyBu\nb24tc3RhdGljIHZhbC50b0V4dGVybmFsKFtjdHhdKSBtZXRob2QKICAgICAg\nICAgICAgaWYgKE1vZGlmaWVyLmlzU3RhdGljKGV4dGVybmFsaXplci5nZXRN\nb2RpZmllcnMoKSkpIHsKICAgICAgICAgICAgICAgIGlmIChleHRlcm5hbGl6\nZXIuZ2V0UGFyYW1ldGVyVHlwZXMoKS5sZW5ndGggPT0gMSkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gZXh0ZXJuYWxpemVyLmludm9rZShudWxsLCBu\nZXcgT2JqZWN0W117IHZhbCB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBl\neHRlcm5hbGl6ZXIuaW52b2tlKG51bGwsIG5ldyBPYmplY3RbXXsgdmFsLCBj\ndHggfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHZhbCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAg\nIGlmIChleHRlcm5hbGl6ZXIuZ2V0UGFyYW1ldGVyVHlwZXMoKS5sZW5ndGgg\nPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBleHRlcm5hbGl6ZXIuaW52\nb2tlKHZhbCwgKE9iamVjdFtdKSBudWxsKTsKICAgICAgICAgICAgcmV0dXJu\nIGV4dGVybmFsaXplci5pbnZva2UodmFsLCBuZXcgT2JqZWN0W117IGN0eCB9\nKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiZXh0ZXJuYWxpemVyLWVyciIsIHRoaXMsCiAgICAgICAg\nICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKHZhbCksIGUudG9TdHJpbmco\nKSkpLnNldENhdXNlKGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgcmVzdWx0IG9mIHBhc3NpbmcgdGhlIGdpdmVuIGV4\ndGVybmFsIHZhbHVlIHRocm91Z2ggdGhlCiAgICAgKiBmYWN0b3J5IHRvIGdl\ndCB0aGUgZmllbGQgdmFsdWUuIElmIG5vIGZhY3RvcnkgaXMgcHJlc2VudCwK\nICAgICAqIHRoZSBnaXZlbiB2YWx1ZSBpcyByZXR1cm5lZCBhcy1pcy4KICAg\nICAqLwogICAgcHVibGljIE9iamVjdCBnZXRGaWVsZFZhbHVlKE9iamVjdCB2\nYWwsIFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBNYXAgZmllbGRWYWx1\nZXMgPSBnZXRGaWVsZFZhbHVlTWFwKCk7CiAgICAgICAgaWYgKGZpZWxkVmFs\ndWVzICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmaWVsZFZhbHVlcy5n\nZXQodmFsKTsKCiAgICAgICAgTWVtYmVyIGZhY3RvcnkgPSBnZXRGYWN0b3J5\nTWV0aG9kKCk7CiAgICAgICAgaWYgKGZhY3RvcnkgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIHZhbDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKHZhbCA9PSBudWxsICYmIGdldE51bGxWYWx1ZSgpID09IE5VTExfREVG\nQVVMVCkKICAgICAgICAgICAgICAgIHJldHVybiBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhl\nbHBlci5uZXdJbnN0YW5jZUFjdGlvbihnZXREZWNsYXJlZFR5cGUoKSkpOyAK\nCiAgICAgICAgICAgIC8vIGludm9rZSBlaXRoZXIgdGhlIGNvbnN0cnVjdG9y\nIGZvciB0aGUgZmllbGQgdHlwZSwKICAgICAgICAgICAgLy8gb3IgdGhlIHN0\nYXRpYyB0eXBlLnRvRmllbGQodmFsWywgY3R4XSkgbWV0aG9kCiAgICAgICAg\nICAgIGlmIChmYWN0b3J5IGluc3RhbmNlb2YgQ29uc3RydWN0b3IpIHsKICAg\nICAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIHJldHVybiAoKENv\nbnN0cnVjdG9yKSBmYWN0b3J5KS5uZXdJbnN0YW5jZQogICAgICAgICAgICAg\nICAgICAgIChuZXcgT2JqZWN0W117IHZhbCB9KTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgTWV0aG9kIG1ldGggPSAoTWV0aG9kKSBmYWN0b3J5Owog\nICAgICAgICAgICBpZiAobWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpLmxlbmd0\naCA9PSAxKQogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGguaW52b2tlKG51\nbGwsIG5ldyBPYmplY3RbXXsgdmFsIH0pOwogICAgICAgICAgICByZXR1cm4g\nbWV0aC5pbnZva2UobnVsbCwgbmV3IE9iamVjdFtdeyB2YWwsIGN0eCB9KTsK\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAv\nLyB1bndyYXAgY2F1c2UKICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBJ\nbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICBU\naHJvd2FibGUgdCA9ICgoSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbikgZSku\nCiAgICAgICAgICAgICAgICAgICAgZ2V0VGFyZ2V0RXhjZXB0aW9uKCk7CiAg\nICAgICAgICAgICAgICBpZiAodCBpbnN0YW5jZW9mIEVycm9yKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IChFcnJvcikgdDsKICAgICAgICAgICAgICAg\nIGUgPSAoRXhjZXB0aW9uKSB0OwoKICAgICAgICAgICAgICAgIC8vIGFsbG93\nIG51bGwgdmFsdWVzIHRvIGNhdXNlIE5QRXMgYW5kIGlsbGVnYWwgYXJnIGV4\nY2VwdGlvbnMKICAgICAgICAgICAgICAgIC8vIHdpdGhvdXQgZXJyb3IKICAg\nICAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCAmJiAoZSBpbnN0YW5jZW9m\nIE51bGxQb2ludGVyRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAgICAgfHwg\nZSBpbnN0YW5jZW9mIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbikpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgT3BlbkpQQUV4Y2VwdGlvbikK\nICAgICAgICAgICAgICAgIHRocm93IChPcGVuSlBBRXhjZXB0aW9uKSBlOwog\nICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFByaXZpbGVnZWRBY3Rpb25F\neGNlcHRpb24pCiAgICAgICAgICAgICAgICBlID0gKChQcml2aWxlZ2VkQWN0\naW9uRXhjZXB0aW9uKSBlKS5nZXRFeGNlcHRpb24oKTsKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJmYWN0b3J5\nLWVyciIsIHRoaXMsCiAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3Ry\naW5nKHZhbCksIGUudG9TdHJpbmcoKSkpLnNldENhdXNlKGUpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRoaXMgZmll\nbGQncyBleHRlcm5hbGl6ZXIsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwog\nICAgcHVibGljIFN0cmluZyBnZXRFeHRlcm5hbGl6ZXIoKSB7CiAgICAgICAg\ncmV0dXJuIF9leHROYW1lOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG5h\nbWUgb2YgdGhpcyBmaWVsZCdzIGV4dGVybmFsaXplciwgb3IgbnVsbCBpZiBu\nb25lLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFeHRlcm5hbGl6ZXIo\nU3RyaW5nIGV4dGVybmFsaXplcikgewogICAgICAgIF9leHROYW1lID0gZXh0\nZXJuYWxpemVyOwogICAgICAgIF9leHRNZXRob2QgPSBERUZBVUxUX01FVEhP\nRDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRoaXMgZmll\nbGQncyBmYWN0b3J5LCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0RmFjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX2Zh\nY3ROYW1lOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG5hbWUgb2YgdGhp\ncyBmaWVsZCdzIGZhY3RvcnksIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0RmFjdG9yeShTdHJpbmcgZmFjdG9yeSkgewog\nICAgICAgIF9mYWN0TmFtZSA9IGZhY3Rvcnk7CiAgICAgICAgX2ZhY3RNZXRo\nb2QgPSBERUZBVUxUX01FVEhPRDsKICAgIH0KCiAgICAvKioKICAgICAqIFBy\nb3BlcnRpZXMgc3RyaW5nIG1hcHBpbmcgZmllbGQgdmFsdWVzIHRvIGV4dGVy\nbmFsIHZhbHVlcy4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRFeHRl\ncm5hbFZhbHVlcygpIHsKICAgICAgICByZXR1cm4gX2V4dFN0cmluZzsKICAg\nIH0KCiAgICAvKioKICAgICAqIFByb3BlcnRpZXMgc3RyaW5nIG1hcHBpbmcg\nZmllbGQgdmFsdWVzIHRvIGV4dGVybmFsIHZhbHVlcy4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0RXh0ZXJuYWxWYWx1ZXMoU3RyaW5nIHZhbHVlcykg\newogICAgICAgIF9leHRTdHJpbmcgPSB2YWx1ZXM7CiAgICAgICAgX2V4dFZh\nbHVlcyA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIG1hcHBpbmcgb2YgZmllbGQgdmFsdWVzIHRvIGV4dGVybmFsIHZhbHVlcy4K\nICAgICAqLwogICAgcHVibGljIE1hcCBnZXRFeHRlcm5hbFZhbHVlTWFwKCkg\newogICAgICAgIHBhcnNlRXh0ZXJuYWxWYWx1ZXMoKTsKICAgICAgICByZXR1\ncm4gX2V4dFZhbHVlczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgbWFwcGluZyBvZiBleHRlcm5hbCB2YWx1ZXMgdG8gZmllbGQgdmFsdWVz\nLgogICAgICovCiAgICBwdWJsaWMgTWFwIGdldEZpZWxkVmFsdWVNYXAoKSB7\nCiAgICAgICAgcGFyc2VFeHRlcm5hbFZhbHVlcygpOwogICAgICAgIHJldHVy\nbiBfZmllbGRWYWx1ZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBl\neHRlcm5hbCB2YWx1ZXMgaW50byBtYXBzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcGFyc2VFeHRlcm5hbFZhbHVlcygpIHsKICAgICAgICBpZiAoX2V4\ndFZhbHVlcyAhPSBDb2xsZWN0aW9ucy5FTVBUWV9NQVAKICAgICAgICAgICAg\nJiYgX2ZpZWxkVmFsdWVzICE9IENvbGxlY3Rpb25zLkVNUFRZX01BUCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2V4dFN0cmluZyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIF9leHRWYWx1ZXMgPSBudWxsOwogICAgICAg\nICAgICBfZmllbGRWYWx1ZXMgPSBudWxsOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQoKICAgICAgICAvLyBwYXJzZSBzdHJpbmcgaW50byBvcHRp\nb25zOyB0aGlzIHRha2VzIGNhcmUgb2YgcHJvcGVyIHRyaW1taW5nIGV0Ywog\nICAgICAgIE9wdGlvbnMgdmFsdWVzID0gQ29uZmlndXJhdGlvbnMucGFyc2VQ\ncm9wZXJ0aWVzKF9leHRTdHJpbmcpOwogICAgICAgIGlmICh2YWx1ZXMuaXNF\nbXB0eSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vLWV4dGVybmFsLXZhbHVlcyIsIHRoaXMsCiAgICAg\nICAgICAgICAgICBfZXh0U3RyaW5nKSk7CgogICAgICAgIE1hcCBleHRWYWx1\nZXMgPSBuZXcgSGFzaE1hcCgoaW50KSAodmFsdWVzLnNpemUoKSAqIDEuMzMg\nKyAxKSk7CiAgICAgICAgTWFwIGZpZWxkVmFsdWVzID0gbmV3IEhhc2hNYXAo\nKGludCkgKHZhbHVlcy5zaXplKCkgKiAxLjMzICsgMSkpOwogICAgICAgIE1h\ncC5FbnRyeSBlbnRyeTsKICAgICAgICBPYmplY3QgZXh0VmFsdWUsIGZpZWxk\nVmFsdWU7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB2YWx1ZXMuZW50\ncnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIGZpZWxkVmFsdWUgPSB0cmFuc2Zvcm0oKFN0cmluZykgZW50cnkuZ2V0\nS2V5KCksCiAgICAgICAgICAgICAgICBnZXREZWNsYXJlZFR5cGVDb2RlKCkp\nOwogICAgICAgICAgICBleHRWYWx1ZSA9IHRyYW5zZm9ybSgoU3RyaW5nKSBl\nbnRyeS5nZXRWYWx1ZSgpLCBnZXRUeXBlQ29kZSgpKTsKCiAgICAgICAgICAg\nIGV4dFZhbHVlcy5wdXQoZmllbGRWYWx1ZSwgZXh0VmFsdWUpOwogICAgICAg\nICAgICBmaWVsZFZhbHVlcy5wdXQoZXh0VmFsdWUsIGZpZWxkVmFsdWUpOwog\nICAgICAgIH0KCiAgICAgICAgX2V4dFZhbHVlcyA9IGV4dFZhbHVlczsKICAg\nICAgICBfZmllbGRWYWx1ZXMgPSBmaWVsZFZhbHVlczsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgc3RyaW5nIHZhbHVlIGNvbnZlcnRlZCB0\nbyB0aGUgZ2l2ZW4gdHlwZSBjb2RlLiBUaGUgc3RyaW5nCiAgICAgKiBtdXN0\nIGJlIG5vbi1udWxsIGFuZCB0cmltbWVkLgogICAgICovCiAgICBwcml2YXRl\nIE9iamVjdCB0cmFuc2Zvcm0oU3RyaW5nIHZhbCwgaW50IHR5cGVDb2RlKSB7\nCiAgICAgICAgaWYgKCJudWxsIi5lcXVhbHModmFsKSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIHN3aXRjaCAodHlwZUNvZGUpIHsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQk9PTEVBTl9PQko6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gQm9vbGVhbi52YWx1ZU9mKHZhbCk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZ\nVEVfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIEJ5dGUudmFsdWVPZih2\nYWwpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gSW50ZWdlci52YWx1ZU9mKHZhbCk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxP\nTkdfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIExvbmcudmFsdWVPZih2\nYWwpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAg\nICAgcmV0dXJuIFNob3J0LnZhbHVlT2YodmFsKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5ET1VCTEVfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIERvdWJsZS52\nYWx1ZU9mKHZhbCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FU\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAg\nICAgICAgICAgICByZXR1cm4gRmxvYXQudmFsdWVPZih2YWwpOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcg\nQ2hhcmFjdGVyKHZhbC5jaGFyQXQoMCkpOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwog\nICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1leHRlcm5hbC10eXBlIiwgdGhpcykpOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIGV4dGVybmFsaXplciBtZXRob2QuCiAgICAg\nKi8KICAgIHB1YmxpYyBNZXRob2QgZ2V0RXh0ZXJuYWxpemVyTWV0aG9kKCkg\newogICAgICAgIGlmIChfbWFuYWdlICE9IE1BTkFHRV9QRVJTSVNURU5UKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoX2V4dE1ldGhv\nZCA9PSBERUZBVUxUX01FVEhPRCkgewogICAgICAgICAgICBpZiAoX2V4dE5h\nbWUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2V4dE1ldGhvZCA9IGZp\nbmRNZXRob2QoX2V4dE5hbWUpOwogICAgICAgICAgICAgICAgaWYgKF9leHRN\nZXRob2QgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1leHRlcm5hbGl6ZXIi\nLAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLCBfZXh0TmFtZSkpOwog\nICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIF9leHRNZXRob2Qg\nPSBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2V4dE1ldGhvZDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBmYWN0b3J5IG1ldGhvZCBvciBj\nb25zdHJ1Y3Rvci4KICAgICAqLwogICAgcHVibGljIE1lbWJlciBnZXRGYWN0\nb3J5TWV0aG9kKCkgewogICAgICAgIGlmIChfbWFuYWdlICE9IE1BTkFHRV9Q\nRVJTSVNURU5UKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBp\nZiAoX2ZhY3RNZXRob2QgPT0gREVGQVVMVF9NRVRIT0QpIHsKICAgICAgICAg\nICAgaWYgKGdldEV4dGVybmFsaXplck1ldGhvZCgpID09IG51bGwpCiAgICAg\nICAgICAgICAgICBfZmFjdE1ldGhvZCA9IG51bGw7CiAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoX2ZhY3ROYW1lID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIF9mYWN0TWV0aG9kID0gZ2V0RGVjbGFyZWRUeXBlKCkuZ2V0Q29uc3Ry\ndWN0b3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuZXcgQ2xhc3Nb\nXXsgZ2V0VHlwZSgpIH0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAgICAgX2ZhY3RNZXRob2QgPSBmaW5kTWV0aG9k\nKF9mYWN0TmFtZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cga2U7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghKF9mYWN0TWV0\naG9kIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpCiAgICAgICAgICAgICAgICAg\nICAgJiYgIShfZmFjdE1ldGhvZCBpbnN0YW5jZW9mIE1ldGhvZCkpCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJiYWQtZmFjdG9yeSIsIHRoaXMpKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2ZhY3RNZXRob2Q7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBGaW5kIHRoZSBtZXRob2QgZm9yIHRoZSBzcGVjaWZp\nZWQgbmFtZS4gUG9zc2libGUgZm9ybXMgYXJlOgogICAgICogPHVsPgogICAg\nICogPGxpPnRvRXh0ZXJuYWxTdHJpbmc8L2xpPgogICAgICogPGxpPk15RmFj\ndG9yeUNsYXNzLnRvRXh0ZXJuYWxTdHJpbmc8L2xpPgogICAgICogPGxpPmNv\nbS5jb21wYW55Lk15RmFjdG9yeUNsYXNzLnRvRXh0ZXJuYWxTdHJpbmc8L2xp\nPgogICAgICogPC91bD4KICAgICAqCiAgICAgKiBAcGFyYW0gbWV0aG9kIHRo\nZSBuYW1lIG9mIHRoZSBtZXRob2QgdG8gbG9jYXRlCiAgICAgKiBAcmV0dXJu\nIHRoZSBtZXRob2QgZm9yIGludm9jYXRpb24KICAgICAqLwogICAgcHJpdmF0\nZSBNZXRob2QgZmluZE1ldGhvZChTdHJpbmcgbWV0aG9kKSB7CiAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkobWV0aG9kKSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIC8vIGdldCBjbGFzcyBuYW1lIGFuZCBn\nZXQgcGFja2FnZSBuYW1lIGRpdmlkZSBvbiB0aGUgbGFzdCAnLicsIHNvIHRo\nZQogICAgICAgIC8vIG5hbWVzIGRvbid0IGFwcGx5IGluIHRoaXMgY2FzZSwg\nYnV0IHRoZSBtZXRob2RzIGRvIHdoYXQgd2Ugd2FudAogICAgICAgIFN0cmlu\nZyBtZXRob2ROYW1lID0gU3RyaW5ncy5nZXRDbGFzc05hbWUobWV0aG9kKTsK\nICAgICAgICBTdHJpbmcgY2xzTmFtZSA9IFN0cmluZ3MuZ2V0UGFja2FnZU5h\nbWUobWV0aG9kKTsKCiAgICAgICAgQ2xhc3MgY2xzID0gbnVsbDsKICAgICAg\nICBDbGFzcyBvd25lciA9IF9vd25lci5nZXREZXNjcmliZWRUeXBlKCk7Cgog\nICAgICAgIGlmIChjbHNOYW1lLmxlbmd0aCgpID09IDApCiAgICAgICAgICAg\nIGNscyA9IGdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIGVsc2UgaWYgKGNs\nc05hbWUuZXF1YWxzKG93bmVyLmdldE5hbWUoKSkKICAgICAgICAgICAgfHwg\nY2xzTmFtZS5lcXVhbHMoU3RyaW5ncy5nZXRDbGFzc05hbWUob3duZXIpKSkK\nICAgICAgICAgICAgY2xzID0gb3duZXI7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBjbHMgPSBKYXZhVHlwZXMuY2xhc3NGb3JOYW1lKGNsc05hbWUsIHRo\naXMpOwoKICAgICAgICAvLyBmaW5kIHRoZSBuYW1lZCBtZXRob2QKICAgICAg\nICBNZXRob2RbXSBtZXRob2RzID0gY2xzLmdldE1ldGhvZHMoKTsKICAgICAg\nICBDbGFzc1tdIHBhcmFtczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIG1ldGhvZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKG1ldGhv\nZHNbaV0uZ2V0TmFtZSgpLmVxdWFscyhtZXRob2ROYW1lKSkgewogICAgICAg\nICAgICAgICAgcGFyYW1zID0gbWV0aG9kc1tpXS5nZXRQYXJhbWV0ZXJUeXBl\ncygpOwoKICAgICAgICAgICAgICAgIC8vIHN0YXRpYyBmYWN0b3J5IG1ldGhv\nZHMgcmVxdWlyZSBvbmUgYXJndW1lbnQgb3Igb25lIGFyZ3VtZW50CiAgICAg\nICAgICAgICAgICAvLyBwbHVzIGEgY3R4OyBub24tc3RhdGljIG1ldGhvZHMg\ncmVxdWlyZSB6ZXJvIGFyZ3VtZW50cyBvcgogICAgICAgICAgICAgICAgLy8g\nanVzdCBhIGN0eAogICAgICAgICAgICAgICAgaWYgKE1vZGlmaWVyLmlzU3Rh\ndGljKG1ldGhvZHNbaV0uZ2V0TW9kaWZpZXJzKCkpCiAgICAgICAgICAgICAg\nICAgICAgJiYgKHBhcmFtcy5sZW5ndGggPT0gMSB8fCAocGFyYW1zLmxlbmd0\naCA9PSAyCiAgICAgICAgICAgICAgICAgICAgJiYgaXNTdG9yZUNvbnRleHRQ\nYXJhbWV0ZXIocGFyYW1zWzFdKSkpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBtZXRob2RzW2ldOwogICAgICAgICAgICAgICAgaWYgKCFNb2RpZmll\nci5pc1N0YXRpYyhtZXRob2RzW2ldLmdldE1vZGlmaWVycygpKQogICAgICAg\nICAgICAgICAgICAgICYmIChwYXJhbXMubGVuZ3RoID09IDAgfHwgKHBhcmFt\ncy5sZW5ndGggPT0gMQogICAgICAgICAgICAgICAgICAgICYmIGlzU3RvcmVD\nb250ZXh0UGFyYW1ldGVyKHBhcmFtc1swXSkpKSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbWV0aG9kc1tpXTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gdHlwZSBpcyBhIHN0b3JlIGNv\nbnRleHQgdHlwZTsgd2UgY2FuJ3QKICAgICAqIHVzZSB0aGUgc3RhbmRhcmQg\nPGNvZGU+aXNBc3NpZ25hYmxlRnJvbTwvY29kZT4gYmVjYXVzZSBvZiBjbGFz\nc2xvYWRlcgogICAgICogb2RkbmVzcy4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgYm9vbGVhbiBpc1N0b3JlQ29udGV4dFBhcmFtZXRlcihDbGFzcyB0\neXBlKSB7CiAgICAgICAgcmV0dXJuIFN0b3JlQ29udGV4dC5jbGFzcy5nZXRO\nYW1lKCkuZXF1YWxzKHR5cGUuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgaWYg\nKG90aGVyID09IHRoaXMpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIGlmICghKG90aGVyIGluc3RhbmNlb2YgRmllbGRNZXRhRGF0YSkpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gZ2V0RnVs\nbE5hbWUodHJ1ZSkuZXF1YWxzKCgoRmllbGRNZXRhRGF0YSkgb3RoZXIpLgog\nICAgICAgICAgICBnZXRGdWxsTmFtZSh0cnVlKSk7CiAgICB9CgogICAgcHVi\nbGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICByZXR1cm4gZ2V0RnVsbE5h\nbWUodHJ1ZSkuaGFzaENvZGUoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGNv\nbXBhcmVUbyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgcmV0dXJuIGdl\ndEZ1bGxOYW1lKHRydWUpLmNvbXBhcmVUbygoKEZpZWxkTWV0YURhdGEpIG90\naGVyKS4KICAgICAgICAgICAgZ2V0RnVsbE5hbWUodHJ1ZSkpOwogICAgfQoK\nICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJu\nIGdldEZ1bGxOYW1lKHRydWUpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gUmVzb2x2ZSBhbmQgdmFsaWRhdGUKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogUmVzb2x2\nZSBtb2RlIGZvciB0aGlzIGZpZWxkLgogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldFJlc29sdmUoKSB7CiAgICAgICAgcmV0dXJuIF9yZXNNb2RlOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBtb2RlIGZvciB0aGlzIGZpZWxk\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGludCBtb2Rl\nKSB7CiAgICAgICAgX3Jlc01vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVzb2x2ZSBtb2RlIGZvciB0aGlzIGZpZWxkLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGludCBtb2RlLCBib29sZWFuIG9u\nKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAg\nICBfcmVzTW9kZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAg\nICAgICAgIF9yZXNNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBfcmVzTW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlc29sdmUgYW5kIHZhbGlkYXRlIG1ldGFkYXRhLiBSZXR1cm4gdHJ1ZSBp\nZiBhbHJlYWR5IHJlc29sdmVkLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiByZXNvbHZlKGludCBtb2RlKSB7CiAgICAgICAgaWYgKChfcmVzTW9kZSAm\nIG1vZGUpID09IG1vZGUpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIGludCBjdXIgPSBfcmVzTW9kZTsKICAgICAgICBfcmVzTW9kZSB8PSBt\nb2RlOwoKICAgICAgICBMb2cgbG9nID0gZ2V0UmVwb3NpdG9yeSgpLmdldExv\nZygpOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJyZXNvbHZlLWZpZWxkIiwgX293\nbmVyICsgIkAiCiAgICAgICAgICAgICAgICArIFN5c3RlbS5pZGVudGl0eUhh\nc2hDb2RlKF9vd25lcikgKyAiLiIgKyBfbmFtZSkpOwoKICAgICAgICAvLyB3\nZSBvbmx5IHBlcmZvcm0gYWN0aW9ucyBmb3IgbWV0YWRhdGEgbW9kZQogICAg\nICAgIGlmICgobW9kZSAmIE1PREVfTUVUQSkgPT0gMCB8fCAoY3VyICYgTU9E\nRV9NRVRBKSAhPSAwKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAg\nICAgIE1ldGhvZCBleHRlcm5hbGl6ZXIgPSBnZXRFeHRlcm5hbGl6ZXJNZXRo\nb2QoKTsKICAgICAgICBpZiAoZXh0ZXJuYWxpemVyICE9IG51bGwpCiAgICAg\nICAgICAgIHNldFR5cGUoZXh0ZXJuYWxpemVyLmdldFJldHVyblR5cGUoKSk7\nCgogICAgICAgIC8vIG9ubHkgcGFzcyBvbiBtZXRhZGF0YSByZXNvbHZlIG1v\nZGUgc28gdGhhdCBtZXRhZGF0YSBpcyBhbHdheXMKICAgICAgICAvLyByZXNv\nbHZlZCBiZWZvcmUgYW55IG90aGVyIHJlc29sdmUgbW9kZXMgb3VyIHN1YmNs\nYXNzZXMgcGFzcyBhbG9uZwogICAgICAgIF92YWwucmVzb2x2ZShNT0RFX01F\nVEEpOwogICAgICAgIF9rZXkucmVzb2x2ZShNT0RFX01FVEEpOwogICAgICAg\nIF9lbGVtLnJlc29sdmUoTU9ERV9NRVRBKTsKCiAgICAgICAgTWV0YURhdGFS\nZXBvc2l0b3J5IHJlcG9zID0gZ2V0UmVwb3NpdG9yeSgpOwogICAgICAgIGlu\ndCB2YWxpZGF0ZSA9IHJlcG9zLmdldFZhbGlkYXRlKCk7CiAgICAgICAgaWYg\nKCh2YWxpZGF0ZSAmIE1ldGFEYXRhUmVwb3NpdG9yeS5WQUxJREFURV9NRVRB\nKSAhPSAwCiAgICAgICAgICAgICYmICghSW1wbEhlbHBlci5pc01hbmFnZWRU\neXBlKHJlcG9zLmdldENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAg\nIF9vd25lci5nZXREZXNjcmliZWRUeXBlKCkpCiAgICAgICAgICAgIHx8ICh2\nYWxpZGF0ZSAmIE1ldGFEYXRhUmVwb3NpdG9yeS5WQUxJREFURV9VTkVOSEFO\nQ0VEKSA9PSAwKSkgewogICAgICAgICAgICB2YWxpZGF0ZUxSUygpOwogICAg\nICAgICAgICBpZiAoKHZhbGlkYXRlICYgcmVwb3MuVkFMSURBVEVfUlVOVElN\nRSkgPT0gMCkKICAgICAgICAgICAgICAgIHZhbGlkYXRlU3VwcG9ydGVkVHlw\nZSgpOwogICAgICAgICAgICB2YWxpZGF0ZVZhbHVlKCk7CiAgICAgICAgICAg\nIHZhbGlkYXRlRXh0ZW5zaW9uS2V5cygpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSB0\naGF0IHRoaXMgZmllbGQgY2FuIGJlIHVzZWQgZm9yIExSUy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlTFJTKCkgewogICAgICAgIGlmICgh\naXNMUlMoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBjYW4n\ndCB1c2UgbHJzIGZvciBhcnJheXMKICAgICAgICBpZiAoZ2V0VHlwZUNvZGUo\nKSA9PSBKYXZhVHlwZXMuQVJSQVkpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWxycy1hcnJheSIsIHRo\naXMpKTsKCiAgICAgICAgLy8gY2FuJ3QgdXNlIGxycyBmb3IgZXh0cmFuYWxp\nemVkIHZhbHMKICAgICAgICBpZiAoZ2V0RXh0ZXJuYWxpemVyTWV0aG9kKCkg\nIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtbHJzLWV4dGVybiIsIHRoaXMpKTsKCiAgICAg\nICAgLy8gY2FuJ3QgdXNlIGxycyBmb3IgY29uY3JldGUgdHlwZXMKICAgICAg\nICBpZiAoZ2V0VHlwZSgpICE9IENvbGxlY3Rpb24uY2xhc3MgJiYgZ2V0VHlw\nZSgpICE9IE1hcC5jbGFzcwogICAgICAgICAgICAmJiBnZXRUeXBlKCkgIT0g\nU2V0LmNsYXNzKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoImJhZC1scnMtY29uY3JldGUiLCB0aGlzKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSB0aGF0IHRoaXMgZmllbGQg\naXMgc3VwcG9ydGVkIGJ5IHRoZSBydW50aW1lLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgdmFsaWRhdGVTdXBwb3J0ZWRUeXBlKCkgewogICAgICAgIC8v\nIGxvZyB3YXJuaW5ncyBhYm91dCB0aGluZ3Mgd2UgZG9uJ3QgaGFuZGxlCiAg\nICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiA9IGdldFJlcG9zaXRv\ncnkoKS5nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgQ29sbGVjdGlvbiBv\ncHRzID0gY29uZi5zdXBwb3J0ZWRPcHRpb25zKCk7CiAgICAgICAgTG9nIGxv\nZyA9IGNvbmYuZ2V0TG9nKGNvbmYuTE9HX01FVEFEQVRBKTsKICAgICAgICBz\nd2l0Y2ggKGdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuUEM6CiAgICAgICAgICAgICAgICBpZiAoaXNFbWJlZGRlZCgpICYm\nCiAgICAgICAgICAgICAgICAgICAgIW9wdHMuY29udGFpbnMoY29uZi5PUFRJ\nT05fRU1CRURERURfUkVMQVRJT04pKSB7CiAgICAgICAgICAgICAgICAgICAg\nc2V0RW1iZWRkZWQoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGlmIChs\nb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBs\nb2cud2FybihfbG9jLmdldCgiY2FudC1lbWJlZCIsIHRoaXMpKTsKICAgICAg\nICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgaWYgKGlzRW1iZWRk\nZWQoKSAmJiBnZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLlBD\nKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0RW1iZWRkZWQoZmFsc2UpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgiY2Fu\ndC1lbWJlZC1leHRlcm4iLCB0aGlzKSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIGlmICghb3B0cy5jb250\nYWlucyhjb25mLk9QVElPTl9UWVBFX0NPTExFQ1RJT04pKQogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigKICAg\nICAgICAgICAgICAgICAgICAgICAgX2xvYy5nZXQoInR5cGUtbm90LXN1cHBv\ncnRlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ29sbGVjdGlv\nbiIsIHRoaXMpKTsKICAgICAgICAgICAgICAgIGlmIChfZWxlbS5pc0VtYmVk\nZGVkUEMoKQogICAgICAgICAgICAgICAgICAgICYmICFvcHRzLmNvbnRhaW5z\nKGNvbmYuT1BUSU9OX0VNQkVEREVEX0NPTExFQ1RJT05fUkVMQVRJT04pKQog\nICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIF9lbGVtLnNl\ndEVtYmVkZGVkKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9n\nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9n\nLndhcm4oX2xvYy5nZXQoImNhbnQtZW1iZWQtZWxlbWVudCIsIHRoaXMpKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAg\nIGlmICghb3B0cy5jb250YWlucyhjb25mLk9QVElPTl9UWVBFX0FSUkFZKSkK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNl\ncHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJ0eXBl\nLW5vdC1zdXBwb3J0ZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIkFycmF5IiwgdGhpcykpOwogICAgICAgICAgICAgICAgaWYgKF9lbGVtLmlz\nRW1iZWRkZWRQQygpCiAgICAgICAgICAgICAgICAgICAgJiYgIW9wdHMuY29u\ndGFpbnMoY29uZi5PUFRJT05fRU1CRURERURfQ09MTEVDVElPTl9SRUxBVElP\nTikpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgX2Vs\nZW0uc2V0RW1iZWRkZWQoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAg\nICBsb2cud2FybihfbG9jLmdldCgiY2FudC1lbWJlZC1lbGVtZW50IiwgdGhp\ncykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAg\nICAgIGlmICghb3B0cy5jb250YWlucyhjb25mLk9QVElPTl9UWVBFX01BUCkp\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgidHlw\nZS1ub3Qtc3VwcG9ydGVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICJNYXAiLCB0aGlzKSk7CiAgICAgICAgICAgICAgICBpZiAoX2VsZW0uaXNF\nbWJlZGRlZFBDKCkKICAgICAgICAgICAgICAgICAgICAmJiAhb3B0cy5jb250\nYWlucyhjb25mLk9QVElPTl9FTUJFRERFRF9NQVBfUkVMQVRJT04pKSB7CiAg\nICAgICAgICAgICAgICAgICAgX2VsZW0uc2V0RW1iZWRkZWQoZmFsc2UpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgiY2Fu\ndC1lbWJlZC1lbGVtZW50IiwgdGhpcykpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgaWYgKF9rZXkuaXNFbWJlZGRlZFBDKCkKICAgICAg\nICAgICAgICAgICAgICAmJiAhb3B0cy5jb250YWlucyhjb25mLk9QVElPTl9F\nTUJFRERFRF9NQVBfUkVMQVRJT04pKSB7CiAgICAgICAgICAgICAgICAgICAg\nX2tleS5zZXRFbWJlZGRlZChmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJjYW50LWVtYmVkLWtleSIsIHRoaXMp\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIG91ciB2\nYWx1ZSBzdHJhdGVneS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlk\nYXRlVmFsdWUoKSB7CiAgICAgICAgaWYgKGdldEV4dGVybmFsaXplck1ldGhv\nZCgpICE9IG51bGwgJiYgZ2V0RXh0ZXJuYWxWYWx1ZU1hcCgpICE9IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiZXh0ZXJuLWV4dGVybnZhbHVlcyIsIHRoaXMpKTsKICAgICAgICBp\nZiAoZ2V0VmFsdWVTdHJhdGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5TRVFV\nRU5DRQogICAgICAgICAgICAmJiBnZXRWYWx1ZVNlcXVlbmNlTmFtZSgpID09\nIG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tc2VxLW5hbWUiLCB0aGlzKSk7CiAgICAgICAgVmFs\ndWVTdHJhdGVnaWVzLmFzc2VydFN1cHBvcnRlZChnZXRWYWx1ZVN0cmF0ZWd5\nKCksIHRoaXMsCiAgICAgICAgICAgICJ2YWx1ZSBzdHJhdGVneSIpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29weSBzdGF0ZSBmcm9tIHRoZSBnaXZlbiBm\naWVsZCB0byB0aGlzIG9uZS4gRG8gbm90IGNvcHkgbWFwcGluZwogICAgICog\naW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNvcHkoRmll\nbGRNZXRhRGF0YSBmaWVsZCkgewogICAgICAgIHN1cGVyLmNvcHkoZmllbGQp\nOwoKICAgICAgICBfaW50ZXJtZWRpYXRlID0gZmllbGQudXNlc0ludGVybWVk\naWF0ZSgpOwogICAgICAgIF9pbXBsRGF0YSA9IGZpZWxkLnVzZXNJbXBsRGF0\nYSgpOwoKICAgICAgICAvLyBjb3B5IGZpZWxkLWxldmVsIGluZm87IHVzZSBn\nZXQgbWV0aG9kcyB0byBmb3JjZSByZXNvbHV0aW9uIG9mCiAgICAgICAgLy8g\nbGF6eSBkYXRhCiAgICAgICAgX3Byb3h5Q2xhc3MgPSBmaWVsZC5nZXRQcm94\neVR5cGUoKTsKICAgICAgICBfaW5pdGlhbGl6ZXIgPSBmaWVsZC5nZXRJbml0\naWFsaXplcigpOwogICAgICAgIF90cmFuc2llbnQgPSBmaWVsZC5pc1RyYW5z\naWVudCgpOwogICAgICAgIF9udWxsVmFsdWUgPSBmaWVsZC5nZXROdWxsVmFs\ndWUoKTsKICAgICAgICBfbWFuYWdlID0gZmllbGQuZ2V0TWFuYWdlbWVudCgp\nOwogICAgICAgIF9leHBsaWNpdCA9IGZpZWxkLmlzRXhwbGljaXQoKTsKICAg\nICAgICBfZXh0TmFtZSA9IGZpZWxkLmdldEV4dGVybmFsaXplcigpOwogICAg\nICAgIF9leHRNZXRob2QgPSBERUZBVUxUX01FVEhPRDsKICAgICAgICBfZmFj\ndE5hbWUgPSBmaWVsZC5nZXRGYWN0b3J5KCk7CiAgICAgICAgX2ZhY3RNZXRo\nb2QgPSBERUZBVUxUX01FVEhPRDsKICAgICAgICBfZXh0U3RyaW5nID0gZmll\nbGQuZ2V0RXh0ZXJuYWxWYWx1ZXMoKTsKICAgICAgICBfZXh0VmFsdWVzID0g\nQ29sbGVjdGlvbnMuRU1QVFlfTUFQOwogICAgICAgIF9maWVsZFZhbHVlcyA9\nIENvbGxlY3Rpb25zLkVNUFRZX01BUDsKICAgICAgICBfcHJpbUtleSA9IGZp\nZWxkLmlzUHJpbWFyeUtleSgpOwogICAgICAgIF9iYWNraW5nTWVtYmVyID0g\nZmllbGQuX2JhY2tpbmdNZW1iZXI7CiAgICAgICAgX2VudW1GaWVsZCA9IGZp\nZWxkLl9lbnVtRmllbGQ7CiAgICAgICAgX2xvYkZpZWxkID0gZmllbGQuX2xv\nYkZpZWxkOwogICAgICAgIF9zZXJpYWxpemFibGVGaWVsZCA9IGZpZWxkLl9z\nZXJpYWxpemFibGVGaWVsZDsKICAgICAgICBfZ2VuZXJhdGVkID0gZmllbGQu\nX2dlbmVyYXRlZDsKCiAgICAgICAgLy8gZW1iZWRkZWQgZmllbGRzIGNhbid0\nIGJlIHZlcnNpb25zCiAgICAgICAgaWYgKF9vd25lci5nZXRFbWJlZGRpbmdN\nZXRhRGF0YSgpID09IG51bGwgJiYgX3ZlcnNpb24gPT0gbnVsbCkKICAgICAg\nICAgICAgX3ZlcnNpb24gPSAoZmllbGQuaXNWZXJzaW9uKCkpID8gQm9vbGVh\nbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKCiAgICAgICAgLy8gb25seSBjb3B5\nIHRoaXMgZGF0YSBpZiBub3QgYWxyZWFkeSBzZXQgZXhwbGljaXRseSBpbiB0\naGlzIGluc3RhbmNlCiAgICAgICAgaWYgKF9kZmcgPT0gMCkgewogICAgICAg\nICAgICBfZGZnID0gKGZpZWxkLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKSA/\nIERGR19UUlVFIDogREZHX0ZBTFNFOwogICAgICAgICAgICBpZiAoZmllbGQu\naXNEZWZhdWx0RmV0Y2hHcm91cEV4cGxpY2l0KCkpCiAgICAgICAgICAgICAg\nICBfZGZnIHw9IERGR19FWFBMSUNJVDsKICAgICAgICB9CiAgICAgICAgaWYg\nKF9mZ1NldCA9PSBudWxsICYmIGZpZWxkLl9mZ1NldCAhPSBudWxsKQogICAg\nICAgICAgICBfZmdTZXQgPSBuZXcgSGFzaFNldChmaWVsZC5fZmdTZXQpOwog\nICAgICAgIGlmIChfbGZnID09IG51bGwpCiAgICAgICAgICAgIF9sZmcgPSBm\naWVsZC5nZXRMb2FkRmV0Y2hHcm91cCgpOwogICAgICAgIGlmIChfbHJzID09\nIG51bGwpCiAgICAgICAgICAgIF9scnMgPSAoZmllbGQuaXNMUlMoKSkgPyBC\nb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgIGlmIChfdmFs\nU3RyYXRlZ3kgPT0gLTEpCiAgICAgICAgICAgIF92YWxTdHJhdGVneSA9IGZp\nZWxkLmdldFZhbHVlU3RyYXRlZ3koKTsKICAgICAgICBpZiAoX3VwU3RyYXRl\nZ3kgPT0gLTEpCiAgICAgICAgICAgIF91cFN0cmF0ZWd5ID0gZmllbGQuZ2V0\nVXBkYXRlU3RyYXRlZ3koKTsKICAgICAgICBpZiAoQ2xhc3NNZXRhRGF0YS5E\nRUZBVUxUX1NUUklORy5lcXVhbHMoX3NlcU5hbWUpKSB7CiAgICAgICAgICAg\nIF9zZXFOYW1lID0gZmllbGQuZ2V0VmFsdWVTZXF1ZW5jZU5hbWUoKTsKICAg\nICAgICAgICAgX3NlcU1ldGEgPSBudWxsOwogICAgICAgIH0KICAgICAgICBp\nZiAoQ2xhc3NNZXRhRGF0YS5ERUZBVUxUX1NUUklORy5lcXVhbHMoX2ludmVy\nc2UpKQogICAgICAgICAgICBfaW52ZXJzZSA9IGZpZWxkLmdldEludmVyc2Uo\nKTsKCiAgICAgICAgLy8gY29weSB2YWx1ZSBtZXRhZGF0YQogICAgICAgIF92\nYWwuY29weShmaWVsZCk7CiAgICAgICAgX2tleS5jb3B5KGZpZWxkLmdldEtl\neSgpKTsKICAgICAgICBfZWxlbS5jb3B5KGZpZWxkLmdldEVsZW1lbnQoKSk7\nCiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgYWRkRXh0ZW5zaW9uS2V5cyhD\nb2xsZWN0aW9uIGV4dHMpIHsKICAgICAgICBnZXRSZXBvc2l0b3J5KCkuZ2V0\nTWV0YURhdGFGYWN0b3J5KCkuYWRkRmllbGRFeHRlbnNpb25LZXlzKGV4dHMp\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29tbWVudGFi\nbGUKICAgIC8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBTdHJpbmdbXSBn\nZXRDb21tZW50cygpIHsKICAgICAgICByZXR1cm4gKF9jb21tZW50cyA9PSBu\ndWxsKSA/IEVNUFRZX0NPTU1FTlRTIDogX2NvbW1lbnRzOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldENvbW1lbnRzKFN0cmluZ1tdIGNvbW1lbnRzKSB7\nCiAgICAgICAgX2NvbW1lbnRzID0gY29tbWVudHM7CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFZhbHVlTWV0\nYURhdGEgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCgogICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0Rmll\nbGRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAg\nICBwdWJsaWMgQ2xhc3MgZ2V0VHlwZSgpIHsKICAgICAgICByZXR1cm4gX3Zh\nbC5nZXRUeXBlKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VHlwZShD\nbGFzcyB0eXBlKSB7CiAgICAgICAgX3ZhbC5zZXRUeXBlKHR5cGUpOwogICAg\nICAgIGlmICh0eXBlLmlzQXJyYXkoKSkKICAgICAgICAgICAgX2VsZW0uc2V0\nVHlwZSh0eXBlLmdldENvbXBvbmVudFR5cGUoKSk7CiAgICAgICAgZWxzZSBp\nZiAodHlwZSA9PSBQcm9wZXJ0aWVzLmNsYXNzKSB7CiAgICAgICAgICAgIF9r\nZXkuc2V0VHlwZShTdHJpbmcuY2xhc3MpOwogICAgICAgICAgICBfZWxlbS5z\nZXRUeXBlKFN0cmluZy5jbGFzcyk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBpbnQgZ2V0VHlwZUNvZGUoKSB7CiAgICAgICAgcmV0dXJuIF92YWwu\nZ2V0VHlwZUNvZGUoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBl\nQ29kZShpbnQgY29kZSkgewogICAgICAgIF92YWwuc2V0VHlwZUNvZGUoY29k\nZSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNUeXBlUEMoKSB7CiAg\nICAgICAgcmV0dXJuIF92YWwuaXNUeXBlUEMoKTsKICAgIH0KCiAgICBwdWJs\naWMgQ2xhc3NNZXRhRGF0YSBnZXRUeXBlTWV0YURhdGEoKSB7CiAgICAgICAg\ncmV0dXJuIF92YWwuZ2V0VHlwZU1ldGFEYXRhKCk7CiAgICB9CgogICAgcHVi\nbGljIENsYXNzIGdldERlY2xhcmVkVHlwZSgpIHsKICAgICAgICByZXR1cm4g\nX3ZhbC5nZXREZWNsYXJlZFR5cGUoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXREZWNsYXJlZFR5cGUoQ2xhc3MgdHlwZSkgewogICAgICAgIF92YWwu\nc2V0RGVjbGFyZWRUeXBlKHR5cGUpOwogICAgICAgIGlmICh0eXBlLmlzQXJy\nYXkoKSkKICAgICAgICAgICAgX2VsZW0uc2V0RGVjbGFyZWRUeXBlKHR5cGUu\nZ2V0Q29tcG9uZW50VHlwZSgpKTsKICAgICAgICBlbHNlIGlmICh0eXBlID09\nIFByb3BlcnRpZXMuY2xhc3MpIHsKICAgICAgICAgICAgX2tleS5zZXREZWNs\nYXJlZFR5cGUoU3RyaW5nLmNsYXNzKTsKICAgICAgICAgICAgX2VsZW0uc2V0\nRGVjbGFyZWRUeXBlKFN0cmluZy5jbGFzcyk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBpbnQgZ2V0RGVjbGFyZWRUeXBlQ29kZSgpIHsKICAgICAg\nICByZXR1cm4gX3ZhbC5nZXREZWNsYXJlZFR5cGVDb2RlKCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0RGVjbGFyZWRUeXBlQ29kZShpbnQgdHlwZSkg\newogICAgICAgIF92YWwuc2V0RGVjbGFyZWRUeXBlQ29kZSh0eXBlKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RlY2xhcmVkVHlwZVBDKCkgewog\nICAgICAgIHJldHVybiBfdmFsLmlzRGVjbGFyZWRUeXBlUEMoKTsKICAgIH0K\nCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXREZWNsYXJlZFR5cGVNZXRh\nRGF0YSgpIHsKICAgICAgICByZXR1cm4gX3ZhbC5nZXREZWNsYXJlZFR5cGVN\nZXRhRGF0YSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRW1iZWRk\nZWQoKSB7CiAgICAgICAgcmV0dXJuIF92YWwuaXNFbWJlZGRlZCgpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldEVtYmVkZGVkKGJvb2xlYW4gZW1iZWRk\nZWQpIHsKICAgICAgICBfdmFsLnNldEVtYmVkZGVkKGVtYmVkZGVkKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0VtYmVkZGVkUEMoKSB7CiAgICAg\nICAgcmV0dXJuIF92YWwuaXNFbWJlZGRlZFBDKCk7CiAgICB9CgogICAgcHVi\nbGljIENsYXNzTWV0YURhdGEgZ2V0RW1iZWRkZWRNZXRhRGF0YSgpIHsKICAg\nICAgICByZXR1cm4gX3ZhbC5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICB9\nCgogICAgcHVibGljIENsYXNzTWV0YURhdGEgYWRkRW1iZWRkZWRNZXRhRGF0\nYSgpIHsKICAgICAgICByZXR1cm4gX3ZhbC5hZGRFbWJlZGRlZE1ldGFEYXRh\nKCk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRDYXNjYWRlRGVsZXRlKCkg\newogICAgICAgIHJldHVybiBfdmFsLmdldENhc2NhZGVEZWxldGUoKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDYXNjYWRlRGVsZXRlKGludCBkZWxl\ndGUpIHsKICAgICAgICBfdmFsLnNldENhc2NhZGVEZWxldGUoZGVsZXRlKTsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IGdldENhc2NhZGVQZXJzaXN0KCkgewog\nICAgICAgIHJldHVybiBfdmFsLmdldENhc2NhZGVQZXJzaXN0KCk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0Q2FzY2FkZVBlcnNpc3QoaW50IHBlcnNp\nc3QpIHsKICAgICAgICBfdmFsLnNldENhc2NhZGVQZXJzaXN0KHBlcnNpc3Qp\nOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0Q2FzY2FkZUF0dGFjaCgpIHsK\nICAgICAgICByZXR1cm4gX3ZhbC5nZXRDYXNjYWRlQXR0YWNoKCk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0Q2FzY2FkZUF0dGFjaChpbnQgYXR0YWNo\nKSB7CiAgICAgICAgX3ZhbC5zZXRDYXNjYWRlQXR0YWNoKGF0dGFjaCk7CiAg\nICB9CgogICAgcHVibGljIGludCBnZXRDYXNjYWRlUmVmcmVzaCgpIHsKICAg\nICAgICByZXR1cm4gX3ZhbC5nZXRDYXNjYWRlUmVmcmVzaCgpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldENhc2NhZGVSZWZyZXNoKGludCByZWZyZXNo\nKSB7CiAgICAgICAgX3ZhbC5zZXRDYXNjYWRlUmVmcmVzaChyZWZyZXNoKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1NlcmlhbGl6ZWQoKSB7CiAg\nICAgICAgcmV0dXJuIF92YWwuaXNTZXJpYWxpemVkKCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0U2VyaWFsaXplZChib29sZWFuIHNlcmlhbGl6ZWQp\nIHsKICAgICAgICBfdmFsLnNldFNlcmlhbGl6ZWQoc2VyaWFsaXplZCk7CiAg\nICB9CgogICAgcHVibGljIFN0cmluZyBnZXRWYWx1ZU1hcHBlZEJ5KCkgewog\nICAgICAgIHJldHVybiBfdmFsLmdldFZhbHVlTWFwcGVkQnkoKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRWYWx1ZU1hcHBlZEJ5KFN0cmluZyBtYXBw\nZWQpIHsKICAgICAgICBfdmFsLnNldFZhbHVlTWFwcGVkQnkobWFwcGVkKTsK\nICAgIH0KCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXRWYWx1ZU1hcHBl\nZEJ5TWV0YURhdGEgKCkKCXsKCQlyZXR1cm4gX3ZhbC5nZXRWYWx1ZU1hcHBl\nZEJ5TWV0YURhdGEgKCk7Cgl9CgoJcHVibGljIENsYXNzIGdldFR5cGVPdmVy\ncmlkZSAoKQoJewoJCXJldHVybiBfdmFsLmdldFR5cGVPdmVycmlkZSAoKTsK\nCX0KCglwdWJsaWMgdm9pZCBzZXRUeXBlT3ZlcnJpZGUgKENsYXNzIHR5cGUp\nCgl7CgkJX3ZhbC5zZXRUeXBlT3ZlcnJpZGUgKHR5cGUpOwoJfQoKCXB1Ymxp\nYyB2b2lkIGNvcHkgKFZhbHVlTWV0YURhdGEgdm1kKQoJewoJCV92YWwuY29w\neSAodm1kKTsKCX0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6YWJsZSB3cmFw\ncGVyIGFyb3VuZCBhIHtAbGluayBNZXRob2R9IG9yIHtAbGluayBGaWVsZH0u\nIEZvciAKICAgICAqIHNwYWNlIGNvbnNpZGVyYXRpb25zLCB0aGlzIGRvZXMg\nbm90IHN1cHBvcnQge0BsaW5rIENvbnN0cnVjdG9yfXMuCiAgICAgKi8KCXBy\naXZhdGUgc3RhdGljIGNsYXNzIE1lbWJlclByb3ZpZGVyIAogICAgICAgIGlt\ncGxlbWVudHMgRXh0ZXJuYWxpemFibGUgewoKICAgICAgICBwcml2YXRlIHRy\nYW5zaWVudCBNZW1iZXIgX21lbWJlcjsKICAgICAgICAKICAgICAgICBwcml2\nYXRlIE1lbWJlclByb3ZpZGVyKE1lbWJlciBtZW1iZXIpIHsKICAgICAgICAg\nICAgaWYgKG1lbWJlciBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigp\nOwoKICAgICAgICAgICAgX21lbWJlciA9IG1lbWJlcjsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgcHVibGljIE1lbWJlciBnZXRNZW1iZXIoKSB7CiAg\nICAgICAgICAgIHJldHVybiBfbWVtYmVyOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgcmVhZEV4dGVybmFsKE9iamVjdElucHV0IGluKQogICAg\nICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNl\ncHRpb24gewogICAgICAgICAgICBib29sZWFuIGlzRmllbGQgPSBpbi5yZWFk\nQm9vbGVhbigpOwogICAgICAgICAgICBDbGFzcyBjbHMgPSBfbWVtYmVyLmdl\ndERlY2xhcmluZ0NsYXNzKCk7CiAgICAgICAgICAgIFN0cmluZyBtZW1iZXJO\nYW1lID0gKFN0cmluZykgaW4ucmVhZE9iamVjdCgpOwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgaWYgKGlzRmllbGQpCiAgICAgICAgICAg\nICAgICAgICAgX21lbWJlciA9IChGaWVsZCkgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2\nSGVscGVyLmdldERlY2xhcmVkRmllbGRBY3Rpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBjbHMsbWVtYmVyTmFtZSkpOyAKICAgICAgICAgICAg\nICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIENsYXNzW10gcGFyYW1l\ndGVyVHlwZXMgPSAoQ2xhc3NbXSkgaW4ucmVhZE9iamVjdCgpOwogICAgICAg\nICAgICAgICAgICAgIF9tZW1iZXIgPSAoTWV0aG9kKSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjbHMsIG1lbWJlck5hbWUsIHBhcmFtZXRl\nclR5cGVzKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0\nY2ggKFNlY3VyaXR5RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIElP\nRXhjZXB0aW9uIGlvZSA9IG5ldyBJT0V4Y2VwdGlvbihlLmdldE1lc3NhZ2Uo\nKSk7CiAgICAgICAgICAgICAgICBpb2UuaW5pdENhdXNlKGUpOwogICAgICAg\nICAgICAgICAgdGhyb3cgaW9lOwogICAgICAgICAgICB9IGNhdGNoIChQcml2\naWxlZ2VkQWN0aW9uRXhjZXB0aW9uIHBhZSkgewogICAgICAgICAgICAgICAg\nSU9FeGNlcHRpb24gaW9lID0gbmV3IElPRXhjZXB0aW9uKAogICAgICAgICAg\nICAgICAgICAgIHBhZS5nZXRFeGNlcHRpb24oKS5nZXRNZXNzYWdlKCkpOwog\nICAgICAgICAgICAgICAgaW9lLmluaXRDYXVzZShwYWUpOwogICAgICAgICAg\nICAgICAgdGhyb3cgaW9lOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCB3cml0ZUV4dGVybmFsKE9iamVjdE91dHB1dCBv\ndXQpCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIGJvb2xlYW4gaXNGaWVsZCA9IF9tZW1iZXIgaW5zdGFuY2VvZiBGaWVs\nZDsKICAgICAgICAgICAgb3V0LndyaXRlQm9vbGVhbihpc0ZpZWxkKTsKICAg\nICAgICAgICAgb3V0LndyaXRlT2JqZWN0KF9tZW1iZXIuZ2V0RGVjbGFyaW5n\nQ2xhc3MoKSk7CiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChfbWVtYmVy\nLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGlmICghaXNGaWVsZCkKICAgICAg\nICAgICAgICAgIG91dC53cml0ZU9iamVjdCgoKE1ldGhvZCkgX21lbWJlciku\nZ2V0UGFyYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzVmFsdWVHZW5lcmF0ZWQoKSB7CiAgICAgICAgcmV0\ndXJuIF9nZW5lcmF0ZWQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VmFs\ndWVHZW5lcmF0ZWQoYm9vbGVhbiBnZW5lcmF0ZWQpIHsKICAgICAgICB0aGlz\nLl9nZW5lcmF0ZWQgPSBnZW5lcmF0ZWQ7CiAgICB9Cn0K\n","encoding":"base64"}

