{"sha":"48fcad7513a707da93ea1ebf7fbaf377ae117d5d","node_id":"MDQ6QmxvYjIwNjM2NDo0OGZjYWQ3NTEzYTcwN2RhOTNlYTFlYmY3ZmJhZjM3N2FlMTE3ZDVk","size":61950,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/48fcad7513a707da93ea1ebf7fbaf377ae117d5d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQg\namF2YS5pby5PYmplY3RTdHJlYW1FeGNlcHRpb247CmltcG9ydCBqYXZhLmxh\nbmcucmVmbGVjdC5BcnJheTsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkNv\nbnN0cnVjdG9yOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwpp\nbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBqYXZh\nLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7CmltcG9ydCBqYXZhLnNlY3Vy\naXR5LlByaXZpbGVnZWRBY3Rpb247CmltcG9ydCBqYXZhLnNlY3VyaXR5LlBy\naXZpbGVnZWRBY3Rpb25FeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5UaW1l\nc3RhbXA7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5DYWxlbmRhcjsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNv\nbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEu\ndXRpbC5HcmVnb3JpYW5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQg\namF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBq\nYXZhLnV0aWwuU29ydGVkTWFwOwppbXBvcnQgamF2YS51dGlsLlNvcnRlZFNl\ndDsKaW1wb3J0IGphdmEudXRpbC5UaW1lWm9uZTsKaW1wb3J0IGphdmEudXRp\nbC5UcmVlTWFwOwppbXBvcnQgamF2YS51dGlsLlRyZWVTZXQ7CgppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuRmlsZXM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxw\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSmF2YVZl\ncnNpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5P\ncHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLmNv\nbmN1cnJlbnQuQ29uY3VycmVudEhhc2hNYXA7CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkJDQ2xhc3M7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDRmllbGQ7Cmlt\ncG9ydCBzZXJwLmJ5dGVjb2RlLkJDTWV0aG9kOwppbXBvcnQgc2VycC5ieXRl\nY29kZS5Db2RlOwppbXBvcnQgc2VycC5ieXRlY29kZS5KdW1wSW5zdHJ1Y3Rp\nb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLlByb2plY3Q7CmltcG9ydCBzZXJw\nLnV0aWwuU3RyaW5nczsKCi8qKgogKiBEZWZhdWx0IGltcGxlbWVudGF0aW9u\nIG9mIHRoZSB7QGxpbmsgUHJveHlNYW5hZ2VyfSBpbnRlcmZhY2UuCiAqCiAq\nIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgUHJveHlNYW5h\nZ2VySW1wbAogICAgaW1wbGVtZW50cyBQcm94eU1hbmFnZXIgewoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBQUk9YWV9TVUZGSVggPSAiJHBy\nb3h5IjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFByb3h5TWFuYWdl\nckltcGwuY2xhc3MpOwoKICAgIHByaXZhdGUgc3RhdGljIGxvbmcgX3Byb3h5\nSWQgPSAwTDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE1hcCBfc3RkQ29s\nbGVjdGlvbnMgPSBuZXcgSGFzaE1hcCgpOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgTWFwIF9zdGRNYXBzID0gbmV3IEhhc2hNYXAoKTsKICAgIHN0YXRp\nYyB7CiAgICAgICAgX3N0ZENvbGxlY3Rpb25zLnB1dChDb2xsZWN0aW9uLmNs\nYXNzLCBBcnJheUxpc3QuY2xhc3MpOwogICAgICAgIF9zdGRDb2xsZWN0aW9u\ncy5wdXQoU2V0LmNsYXNzLCBIYXNoU2V0LmNsYXNzKTsKICAgICAgICBfc3Rk\nQ29sbGVjdGlvbnMucHV0KFNvcnRlZFNldC5jbGFzcywgVHJlZVNldC5jbGFz\ncyk7CiAgICAgICAgX3N0ZENvbGxlY3Rpb25zLnB1dChMaXN0LmNsYXNzLCBB\ncnJheUxpc3QuY2xhc3MpOwogICAgICAgIGlmIChKYXZhVmVyc2lvbnMuVkVS\nU0lPTiA+PSA1KSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBDbGFzcyBxdWV1ZSA9IChDbGFzcykgQWNjZXNzQ29udHJvbGxlcgogICAg\nICAgICAgICAgICAgICAgIC5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIu\nZ2V0Rm9yTmFtZUFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgImph\ndmEudXRpbC5RdWV1ZSIsIGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAg\nICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q2xhc3NMb2Fk\nZXJBY3Rpb24oQ29sbGVjdGlvbi5jbGFzcykpKSk7CiAgICAgICAgICAgICAg\nICBfc3RkQ29sbGVjdGlvbnMucHV0KHF1ZXVlLCBMaW5rZWRMaXN0LmNsYXNz\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAg\nICAgICAgICAgIC8vIG5vdCByZWFsbHkgamF2YSA1IGFmdGVyIGFsbD8KICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3N0ZE1hcHMucHV0KE1h\ncC5jbGFzcywgSGFzaE1hcC5jbGFzcyk7CiAgICAgICAgX3N0ZE1hcHMucHV0\nKFNvcnRlZE1hcC5jbGFzcywgVHJlZU1hcC5jbGFzcyk7CiAgICB9CgogICAg\ncHJpdmF0ZSBmaW5hbCBTZXQgX3VucHJveHlhYmxlID0gbmV3IEhhc2hTZXQo\nKTsKICAgIHByaXZhdGUgZmluYWwgTWFwIF9wcm94aWVzID0gbmV3IENvbmN1\ncnJlbnRIYXNoTWFwKCk7CiAgICBwcml2YXRlIGJvb2xlYW4gX3RyYWNrQ2hh\nbmdlcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Fzc2VydFR5cGUg\nPSBmYWxzZTsKCiAgICBwdWJsaWMgUHJveHlNYW5hZ2VySW1wbCgpIHsKICAg\nICAgICBfdW5wcm94eWFibGUuYWRkKFRpbWVab25lLmNsYXNzLmdldE5hbWUo\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHByb3hpZXMgcHJv\nZHVjZWQgYnkgdGhpcyBmYWN0b3J5IHdpbGwgdXNlIHtAbGluayBDaGFuZ2VU\ncmFja2VyfXMKICAgICAqIHRvIHRyeSB0byBjdXQgZG93biBvbiBkYXRhIHN0\nb3JlIG9wZXJhdGlvbnMgYXQgdGhlIGNvc3Qgb2Ygc29tZSBleHRyYQogICAg\nICogYm9va2tlZXBpbmcgb3ZlcmhlYWQuIERlZmF1bHRzIHRvIHRydWUuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFRyYWNrQ2hhbmdlcygpIHsK\nICAgICAgICByZXR1cm4gX3RyYWNrQ2hhbmdlczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgcHJveGllcyBwcm9kdWNlZCBieSB0aGlzIGZhY3Rv\ncnkgd2lsbCB1c2Uge0BsaW5rIENoYW5nZVRyYWNrZXJ9cwogICAgICogdG8g\ndHJ5IHRvIGN1dCBkb3duIG9uIGRhdGEgc3RvcmUgb3BlcmF0aW9ucyBhdCB0\naGUgY29zdCBvZiBzb21lIGV4dHJhCiAgICAgKiBib29ra2VlcGluZyBvdmVy\naGVhZC4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0VHJhY2tDaGFuZ2VzKGJvb2xlYW4gdHJhY2spIHsKICAgICAgICBf\ndHJhY2tDaGFuZ2VzID0gdHJhY2s7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIHRvIHBlcmZvcm0gcnVudGltZSBjaGVja3MgdG8gZW5zdXJlIHRo\nYXQgYWxsIGVsZW1lbnRzCiAgICAgKiBhZGRlZCB0byBjb2xsZWN0aW9uIGFu\nZCBtYXAgcHJveGllcyBhcmUgdGhlIHByb3BlciBlbGVtZW50L2tleS92YWx1\nZQogICAgICogdHlwZSBhcyBkZWZpbmVkIGJ5IHRoZSBtZXRhZGF0YS4gRGVm\nYXVsdHMgdG8gZmFsc2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdl\ndEFzc2VydEFsbG93ZWRUeXBlKCkgewogICAgICAgIHJldHVybiBfYXNzZXJ0\nVHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcGVyZm9y\nbSBydW50aW1lIGNoZWNrcyB0byBlbnN1cmUgdGhhdCBhbGwgZWxlbWVudHMK\nICAgICAqIGFkZGVkIHRvIGNvbGxlY3Rpb24gYW5kIG1hcCBwcm94aWVzIGFy\nZSB0aGUgcHJvcGVyIGVsZW1lbnQva2V5L3ZhbHVlCiAgICAgKiB0eXBlIGFz\nIGRlZmluZWQgYnkgdGhlIG1ldGFkYXRhLiBEZWZhdWx0cyB0byBmYWxzZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QXNzZXJ0QWxsb3dlZFR5cGUo\nYm9vbGVhbiBhc3NlcnRUeXBlKSB7CiAgICAgICAgX2Fzc2VydFR5cGUgPSBh\nc3NlcnRUeXBlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbXV0\nYWJsZSB2aWV3IG9mIGNsYXNzIG5hbWVzIHdlIGtub3cgY2Fubm90IGJlIHBy\nb3hpZWQgIAogICAgICogY29ycmVjdGx5IGJ5IHRoaXMgbWFuYWdlci4KICAg\nICAqLwogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0VW5wcm94eWFibGUoKSB7\nCiAgICAgICAgcmV0dXJuIF91bnByb3h5YWJsZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFByb3ZpZGVkIGZvciBhdXRvLWNvbmZpZ3VyYXRpb24uICBBZGQg\ndGhlIGdpdmVuIHNlbWljb2xvbi1zZXBhcmF0ZWQKICAgICAqIGNsYXNzIG5h\nbWVzIHRvIHRoZSBzZXQgb2YgY2xhc3MgbmFtZXMgd2Uga25vdyBjYW5ub3Qg\nYmUgcHJveGllZCBjb3JyZWN0bHkKICAgICAqIGJ5IHRoaXMgbWFuYWdlci4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VW5wcm94eWFibGUoU3RyaW5n\nIGNsc05hbWVzKSB7CiAgICAgICAgaWYgKGNsc05hbWVzICE9IG51bGwpCiAg\nICAgICAgICAgIF91bnByb3h5YWJsZS5hZGRBbGwoQXJyYXlzLmFzTGlzdChT\ndHJpbmdzLnNwbGl0KGNsc05hbWVzLCAiOyIsIDApKSk7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBjb3B5QXJyYXkoT2JqZWN0IG9yaWcpIHsKICAgICAg\nICBpZiAob3JpZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGxlbmd0aCA9IEFycmF5\nLmdldExlbmd0aChvcmlnKTsKICAgICAgICAgICAgT2JqZWN0IGFycmF5ID0g\nQXJyYXkubmV3SW5zdGFuY2Uob3JpZy5nZXRDbGFzcygpLgogICAgICAgICAg\nICAgICAgZ2V0Q29tcG9uZW50VHlwZSgpLCBsZW5ndGgpOwoKICAgICAgICAg\nICAgU3lzdGVtLmFycmF5Y29weShvcmlnLCAwLCBhcnJheSwgMCwgbGVuZ3Ro\nKTsKICAgICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWFycmF5IiwKICAgICAgICAg\nICAgICAgIGUuZ2V0TWVzc2FnZSgpKSwgZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBDb2xsZWN0aW9uIGNvcHlDb2xsZWN0aW9uKENvbGxlY3Rp\nb24gb3JpZykgewogICAgICAgIGlmIChvcmlnID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChvcmlnIGluc3RhbmNlb2Yg\nUHJveHkpCiAgICAgICAgICAgIHJldHVybiAoQ29sbGVjdGlvbikgKChQcm94\neSkgb3JpZykuY29weShvcmlnKTsKCiAgICAgICAgUHJveHlDb2xsZWN0aW9u\nIHByb3h5ID0gZ2V0RmFjdG9yeVByb3h5Q29sbGVjdGlvbihvcmlnLmdldENs\nYXNzKCkpOwogICAgICAgIHJldHVybiAoQ29sbGVjdGlvbikgcHJveHkuY29w\neShvcmlnKTsKICAgIH0KCiAgICBwdWJsaWMgUHJveHkgbmV3Q29sbGVjdGlv\nblByb3h5KENsYXNzIHR5cGUsIENsYXNzIGVsZW1lbnRUeXBlLAogICAgICAg\nIENvbXBhcmF0b3IgY29tcGFyZSkgewogICAgICAgIHR5cGUgPSB0b1Byb3h5\nYWJsZUNvbGxlY3Rpb25UeXBlKHR5cGUpOwogICAgICAgIFByb3h5Q29sbGVj\ndGlvbiBwcm94eSA9IGdldEZhY3RvcnlQcm94eUNvbGxlY3Rpb24odHlwZSk7\nCiAgICAgICAgcmV0dXJuIHByb3h5Lm5ld0luc3RhbmNlKChfYXNzZXJ0VHlw\nZSkgPyBlbGVtZW50VHlwZSA6IG51bGwsIGNvbXBhcmUsCiAgICAgICAgICAg\nIF90cmFja0NoYW5nZXMpOwogICAgfQoKICAgIHB1YmxpYyBNYXAgY29weU1h\ncChNYXAgb3JpZykgewogICAgICAgIGlmIChvcmlnID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChvcmlnIGluc3RhbmNl\nb2YgUHJveHkpCiAgICAgICAgICAgIHJldHVybiAoTWFwKSAoKFByb3h5KSBv\ncmlnKS5jb3B5KG9yaWcpOwoKICAgICAgICBQcm94eU1hcCBwcm94eSA9IGdl\ndEZhY3RvcnlQcm94eU1hcChvcmlnLmdldENsYXNzKCkpOwogICAgICAgIHJl\ndHVybiAoTWFwKSBwcm94eS5jb3B5KG9yaWcpOwogICAgfQoKICAgIHB1Ymxp\nYyBQcm94eSBuZXdNYXBQcm94eShDbGFzcyB0eXBlLCBDbGFzcyBrZXlUeXBl\nLCAKICAgICAgICBDbGFzcyBlbGVtZW50VHlwZSwgQ29tcGFyYXRvciBjb21w\nYXJlKSB7CiAgICAgICAgdHlwZSA9IHRvUHJveHlhYmxlTWFwVHlwZSh0eXBl\nKTsKICAgICAgICBQcm94eU1hcCBwcm94eSA9IGdldEZhY3RvcnlQcm94eU1h\ncCh0eXBlKTsKICAgICAgICByZXR1cm4gcHJveHkubmV3SW5zdGFuY2UoKF9h\nc3NlcnRUeXBlKSA/IGtleVR5cGUgOiBudWxsLCAKICAgICAgICAgICAgKF9h\nc3NlcnRUeXBlKSA/IGVsZW1lbnRUeXBlIDogbnVsbCwgY29tcGFyZSwgX3Ry\nYWNrQ2hhbmdlcyk7CiAgICB9CgogICAgcHVibGljIERhdGUgY29weURhdGUo\nRGF0ZSBvcmlnKSB7CiAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2Vv\nZiBQcm94eSkKICAgICAgICAgICAgcmV0dXJuIChEYXRlKSAoKFByb3h5KSBv\ncmlnKS5jb3B5KG9yaWcpOwoKICAgICAgICBQcm94eURhdGUgcHJveHkgPSBn\nZXRGYWN0b3J5UHJveHlEYXRlKG9yaWcuZ2V0Q2xhc3MoKSk7CiAgICAgICAg\ncmV0dXJuIChEYXRlKSBwcm94eS5jb3B5KG9yaWcpOwogICAgfQoKICAgIHB1\nYmxpYyBQcm94eSBuZXdEYXRlUHJveHkoQ2xhc3MgdHlwZSkgewogICAgICAg\nIFByb3h5RGF0ZSBwcm94eSA9IGdldEZhY3RvcnlQcm94eURhdGUodHlwZSk7\nCiAgICAgICAgcmV0dXJuIHByb3h5Lm5ld0luc3RhbmNlKCk7CiAgICB9Cgog\nICAgcHVibGljIENhbGVuZGFyIGNvcHlDYWxlbmRhcihDYWxlbmRhciBvcmln\nKSB7CiAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBQcm94eSkK\nICAgICAgICAgICAgcmV0dXJuIChDYWxlbmRhcikgKChQcm94eSkgb3JpZyku\nY29weShvcmlnKTsKCiAgICAgICAgUHJveHlDYWxlbmRhciBwcm94eSA9IGdl\ndEZhY3RvcnlQcm94eUNhbGVuZGFyKG9yaWcuZ2V0Q2xhc3MoKSk7CiAgICAg\nICAgcmV0dXJuIChDYWxlbmRhcikgcHJveHkuY29weShvcmlnKTsKICAgIH0K\nCiAgICBwdWJsaWMgUHJveHkgbmV3Q2FsZW5kYXJQcm94eShDbGFzcyB0eXBl\nLCBUaW1lWm9uZSB6b25lKSB7CiAgICAgICAgaWYgKHR5cGUgPT0gQ2FsZW5k\nYXIuY2xhc3MpCiAgICAgICAgICAgIHR5cGUgPSBHcmVnb3JpYW5DYWxlbmRh\nci5jbGFzczsKICAgICAgICBQcm94eUNhbGVuZGFyIHByb3h5ID0gZ2V0RmFj\ndG9yeVByb3h5Q2FsZW5kYXIodHlwZSk7CiAgICAgICAgUHJveHlDYWxlbmRh\nciBjYWwgPSBwcm94eS5uZXdJbnN0YW5jZSgpOwogICAgICAgIGlmICh6b25l\nICE9IG51bGwpCiAgICAgICAgICAgICgoQ2FsZW5kYXIpIGNhbCkuc2V0VGlt\nZVpvbmUoem9uZSk7CiAgICAgICAgcmV0dXJuIGNhbDsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGNvcHlDdXN0b20oT2JqZWN0IG9yaWcpIHsKICAgICAg\nICBpZiAob3JpZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9mIFByb3h5KQogICAgICAgICAg\nICByZXR1cm4gKChQcm94eSkgb3JpZykuY29weShvcmlnKTsKICAgICAgICBp\nZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob3JpZykpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGlmIChvcmlnIGluc3RhbmNlb2YgQ29s\nbGVjdGlvbikKICAgICAgICAgICAgcmV0dXJuIGNvcHlDb2xsZWN0aW9uKChD\nb2xsZWN0aW9uKSBvcmlnKTsKICAgICAgICBpZiAob3JpZyBpbnN0YW5jZW9m\nIE1hcCkKICAgICAgICAgICAgcmV0dXJuIGNvcHlNYXAoKE1hcCkgb3JpZyk7\nCiAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBEYXRlKQogICAgICAgICAg\nICByZXR1cm4gY29weURhdGUoKERhdGUpIG9yaWcpOwogICAgICAgIGlmIChv\ncmlnIGluc3RhbmNlb2YgQ2FsZW5kYXIpCiAgICAgICAgICAgIHJldHVybiBj\nb3B5Q2FsZW5kYXIoKENhbGVuZGFyKSBvcmlnKTsKICAgICAgICBQcm94eUJl\nYW4gcHJveHkgPSBnZXRGYWN0b3J5UHJveHlCZWFuKG9yaWcpOwogICAgICAg\nIHJldHVybiAocHJveHkgPT0gbnVsbCkgPyBudWxsIDogcHJveHkuY29weShv\ncmlnKTsgCiAgICB9CgogICAgcHVibGljIFByb3h5IG5ld0N1c3RvbVByb3h5\nKE9iamVjdCBvcmlnKSB7CiAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKG9yaWcgaW5zdGFu\nY2VvZiBQcm94eSkKICAgICAgICAgICAgcmV0dXJuIChQcm94eSkgb3JpZzsK\nICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob3JpZykpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChvcmlnIGluc3Rh\nbmNlb2YgQ29sbGVjdGlvbikgewogICAgICAgICAgICBDb21wYXJhdG9yIGNv\nbXAgPSAob3JpZyBpbnN0YW5jZW9mIFNvcnRlZFNldCkgCiAgICAgICAgICAg\nICAgICA/ICgoU29ydGVkU2V0KSBvcmlnKS5jb21wYXJhdG9yKCkgOiBudWxs\nOwogICAgICAgICAgICBDb2xsZWN0aW9uIGMgPSAoQ29sbGVjdGlvbikgbmV3\nQ29sbGVjdGlvblByb3h5KG9yaWcuZ2V0Q2xhc3MoKSwgCiAgICAgICAgICAg\nICAgICBudWxsLCBjb21wKTsgCiAgICAgICAgICAgIGMuYWRkQWxsKChDb2xs\nZWN0aW9uKSBvcmlnKTsKICAgICAgICAgICAgcmV0dXJuIChQcm94eSkgYzsK\nICAgICAgICB9CiAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBNYXApIHsK\nICAgICAgICAgICAgQ29tcGFyYXRvciBjb21wID0gKG9yaWcgaW5zdGFuY2Vv\nZiBTb3J0ZWRNYXApIAogICAgICAgICAgICAgICAgPyAoKFNvcnRlZE1hcCkg\nb3JpZykuY29tcGFyYXRvcigpIDogbnVsbDsKICAgICAgICAgICAgTWFwIG0g\nPSAoTWFwKSBuZXdNYXBQcm94eShvcmlnLmdldENsYXNzKCksIG51bGwsIG51\nbGwsIGNvbXApOwogICAgICAgICAgICBtLnB1dEFsbCgoTWFwKSBvcmlnKTsK\nICAgICAgICAgICAgcmV0dXJuIChQcm94eSkgbTsKICAgICAgICB9CiAgICAg\nICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgICAgIERh\ndGUgZCA9IChEYXRlKSBuZXdEYXRlUHJveHkob3JpZy5nZXRDbGFzcygpKTsK\nICAgICAgICAgICAgZC5zZXRUaW1lKCgoRGF0ZSkgb3JpZykuZ2V0VGltZSgp\nKTsKICAgICAgICAgICAgaWYgKG9yaWcgaW5zdGFuY2VvZiBUaW1lc3RhbXAp\nCiAgICAgICAgICAgICAgICAoKFRpbWVzdGFtcCkgZCkuc2V0TmFub3MoKChU\naW1lc3RhbXApIG9yaWcpLmdldE5hbm9zKCkpOwogICAgICAgICAgICByZXR1\ncm4gKFByb3h5KSBkOwogICAgICAgIH0KICAgICAgICBpZiAob3JpZyBpbnN0\nYW5jZW9mIENhbGVuZGFyKSB7CiAgICAgICAgICAgIENhbGVuZGFyIGMgPSAo\nQ2FsZW5kYXIpIG5ld0NhbGVuZGFyUHJveHkob3JpZy5nZXRDbGFzcygpLAog\nICAgICAgICAgICAgICAgKChDYWxlbmRhcikgb3JpZykuZ2V0VGltZVpvbmUo\nKSk7CiAgICAgICAgICAgIGMuc2V0VGltZUluTWlsbGlzKCgoQ2FsZW5kYXIp\nIG9yaWcpLmdldFRpbWVJbk1pbGxpcygpKTsKICAgICAgICAgICAgcmV0dXJu\nIChQcm94eSkgYzsKICAgICAgICB9CgogICAgICAgIFByb3h5QmVhbiBwcm94\neSA9IGdldEZhY3RvcnlQcm94eUJlYW4ob3JpZyk7CiAgICAgICAgcmV0dXJu\nIChwcm94eSA9PSBudWxsKSA/IG51bGwgOiBwcm94eS5uZXdJbnN0YW5jZShv\ncmlnKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29uY3Jl\ndGUgdHlwZSBmb3IgcHJveHlpbmcuCiAgICAgKi8KICAgIHByb3RlY3RlZCBD\nbGFzcyB0b1Byb3h5YWJsZUNvbGxlY3Rpb25UeXBlKENsYXNzIHR5cGUpIHsK\nICAgICAgICBpZiAodHlwZS5nZXROYW1lKCkuZW5kc1dpdGgoUFJPWFlfU1VG\nRklYKSkKICAgICAgICAgICAgdHlwZSA9IHR5cGUuZ2V0U3VwZXJjbGFzcygp\nOwogICAgICAgIGVsc2UgaWYgKHR5cGUuaXNJbnRlcmZhY2UoKSkgewogICAg\nICAgICAgICB0eXBlID0gdG9Db25jcmV0ZVR5cGUodHlwZSwgX3N0ZENvbGxl\nY3Rpb25zKTsKICAgICAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9j\nLmdldCgibm8tcHJveHktaW50ZiIsIHR5cGUpKTsKICAgICAgICB9IGVsc2Ug\naWYgKE1vZGlmaWVyLmlzQWJzdHJhY3QodHlwZS5nZXRNb2RpZmllcnMoKSkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tcHJveHktYWJzdHJhY3QiLCB0eXBlKSk7CiAgICAgICAg\ncmV0dXJuIHR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGNvbmNyZXRlIHR5cGUgZm9yIHByb3h5aW5nLgogICAgICovCiAgICBwcm90\nZWN0ZWQgQ2xhc3MgdG9Qcm94eWFibGVNYXBUeXBlKENsYXNzIHR5cGUpIHsK\nICAgICAgICBpZiAodHlwZS5nZXROYW1lKCkuZW5kc1dpdGgoUFJPWFlfU1VG\nRklYKSkKICAgICAgICAgICAgdHlwZSA9IHR5cGUuZ2V0U3VwZXJjbGFzcygp\nOwogICAgICAgIGVsc2UgaWYgKHR5cGUuaXNJbnRlcmZhY2UoKSkgewogICAg\nICAgICAgICB0eXBlID0gdG9Db25jcmV0ZVR5cGUodHlwZSwgX3N0ZE1hcHMp\nOwogICAgICAgICAgICBpZiAodHlwZSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1wcm94eS1pbnRmIiwgdHlwZSkpOwogICAgICAgIH0gZWxzZSBpZiAoTW9k\naWZpZXIuaXNBYnN0cmFjdCh0eXBlLmdldE1vZGlmaWVycygpKSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJuby1wcm94eS1hYnN0cmFjdCIsIHR5cGUpKTsKICAgICAgICByZXR1cm4g\ndHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIExvY2F0ZSBhIGNvbmNyZXRl\nIHR5cGUgdG8gcHJveHkgZm9yIHRoZSBnaXZlbiBjb2xsZWN0aW9uIGludGVy\nZmFjZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ2xhc3MgdG9Db25j\ncmV0ZVR5cGUoQ2xhc3MgaW50ZiwgTWFwIGNvbmNyZXRlcykgewogICAgICAg\nIENsYXNzIGNvbmNyZXRlID0gKENsYXNzKSBjb25jcmV0ZXMuZ2V0KGludGYp\nOwogICAgICAgIGlmIChjb25jcmV0ZSAhPSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gY29uY3JldGU7CiAgICAgICAgQ2xhc3NbXSBpbnRmcyA9IGludGYu\nZ2V0SW50ZXJmYWNlcygpOyAgICAgICAgIAogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgaW50ZnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29u\nY3JldGUgPSB0b0NvbmNyZXRlVHlwZShpbnRmc1tpXSwgY29uY3JldGVzKTsK\nICAgICAgICAgICAgaWYgKGNvbmNyZXRlICE9IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gY29uY3JldGU7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBudWxsOyAKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2Fj\naGVkIGZhY3RvcnkgcHJveHkgZm9yIHRoZSBnaXZlbiBjb2xsZWN0aW9uIHR5\ncGUuCiAgICAgKi8KICAgIHByaXZhdGUgUHJveHlDb2xsZWN0aW9uIGdldEZh\nY3RvcnlQcm94eUNvbGxlY3Rpb24oQ2xhc3MgdHlwZSkgewogICAgICAgIC8v\nIHdlIGRvbid0IGxvY2sgaGVyZTsgb2sgaWYgdHdvIHByb3hpZXMgZ2V0IGdl\nbmVyYXRlZCBmb3Igc2FtZSB0eXBlCiAgICAgICAgUHJveHlDb2xsZWN0aW9u\nIHByb3h5ID0gKFByb3h5Q29sbGVjdGlvbikgX3Byb3hpZXMuZ2V0KHR5cGUp\nOwogICAgICAgIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAgICAgIENs\nYXNzTG9hZGVyIGwgPSBHZW5lcmF0ZWRDbGFzc2VzLmdldE1vc3REZXJpdmVk\nTG9hZGVyKHR5cGUsCiAgICAgICAgICAgICAgICBQcm94eUNvbGxlY3Rpb24u\nY2xhc3MpOwogICAgICAgICAgICBDbGFzcyBwY2xzID0gbG9hZEJ1aWxkVGlt\nZVByb3h5KHR5cGUsIGwpOwogICAgICAgICAgICBpZiAocGNscyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcGNscyA9IEdlbmVyYXRlZENsYXNzZXMubG9h\nZEJDQ2xhc3MoCiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVQcm94eUNv\nbGxlY3Rpb25CeXRlY29kZSh0eXBlLCB0cnVlKSwgbCk7CiAgICAgICAgICAg\nIHByb3h5ID0gKFByb3h5Q29sbGVjdGlvbikgaW5zdGFudGlhdGVQcm94eShw\nY2xzLCBudWxsLCBudWxsKTsKICAgICAgICAgICAgX3Byb3hpZXMucHV0KHR5\ncGUsIHByb3h5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByb3h5Owog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjYWNoZWQgZmFjdG9y\neSBwcm94eSBmb3IgdGhlIGdpdmVuIG1hcCB0eXBlLgogICAgICovCiAgICBw\ncml2YXRlIFByb3h5TWFwIGdldEZhY3RvcnlQcm94eU1hcChDbGFzcyB0eXBl\nKSB7CiAgICAgICAgLy8gd2UgZG9uJ3QgbG9jayBoZXJlOyBvayBpZiB0d28g\ncHJveGllcyBnZXQgZ2VuZXJhdGVkIGZvciBzYW1lIHR5cGUKICAgICAgICBQ\ncm94eU1hcCBwcm94eSA9IChQcm94eU1hcCkgX3Byb3hpZXMuZ2V0KHR5cGUp\nOwogICAgICAgIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAgICAgIENs\nYXNzTG9hZGVyIGwgPSBHZW5lcmF0ZWRDbGFzc2VzLmdldE1vc3REZXJpdmVk\nTG9hZGVyKHR5cGUsCiAgICAgICAgICAgICAgICBQcm94eU1hcC5jbGFzcyk7\nCiAgICAgICAgICAgIENsYXNzIHBjbHMgPSBsb2FkQnVpbGRUaW1lUHJveHko\ndHlwZSwgbCk7CiAgICAgICAgICAgIGlmIChwY2xzID09IG51bGwpCiAgICAg\nICAgICAgICAgICBwY2xzID0gR2VuZXJhdGVkQ2xhc3Nlcy5sb2FkQkNDbGFz\ncygKICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZVByb3h5TWFwQnl0ZWNv\nZGUodHlwZSwgdHJ1ZSksIGwpOwogICAgICAgICAgICBwcm94eSA9IChQcm94\neU1hcCkgaW5zdGFudGlhdGVQcm94eShwY2xzLCBudWxsLCBudWxsKTsKICAg\nICAgICAgICAgX3Byb3hpZXMucHV0KHR5cGUsIHByb3h5KTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHByb3h5OwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBjYWNoZWQgZmFjdG9yeSBwcm94eSBmb3IgdGhlIGdpdmVu\nIGRhdGUgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBQcm94eURhdGUgZ2V0\nRmFjdG9yeVByb3h5RGF0ZShDbGFzcyB0eXBlKSB7CiAgICAgICAgLy8gd2Ug\nZG9uJ3QgbG9jayBoZXJlOyBvayBpZiB0d28gcHJveGllcyBnZXQgZ2VuZXJh\ndGVkIGZvciBzYW1lIHR5cGUKICAgICAgICBQcm94eURhdGUgcHJveHkgPSAo\nUHJveHlEYXRlKSBfcHJveGllcy5nZXQodHlwZSk7CiAgICAgICAgaWYgKHBy\nb3h5ID09IG51bGwpIHsKICAgICAgICAgICAgQ2xhc3NMb2FkZXIgbCA9IEdl\nbmVyYXRlZENsYXNzZXMuZ2V0TW9zdERlcml2ZWRMb2FkZXIodHlwZSwKICAg\nICAgICAgICAgICAgIFByb3h5RGF0ZS5jbGFzcyk7CiAgICAgICAgICAgIENs\nYXNzIHBjbHMgPSBsb2FkQnVpbGRUaW1lUHJveHkodHlwZSwgbCk7CiAgICAg\nICAgICAgIGlmIChwY2xzID09IG51bGwpCiAgICAgICAgICAgICAgICBwY2xz\nID0gR2VuZXJhdGVkQ2xhc3Nlcy5sb2FkQkNDbGFzcygKICAgICAgICAgICAg\nICAgICAgICBnZW5lcmF0ZVByb3h5RGF0ZUJ5dGVjb2RlKHR5cGUsIHRydWUp\nLCBsKTsKICAgICAgICAgICAgcHJveHkgPSAoUHJveHlEYXRlKSBpbnN0YW50\naWF0ZVByb3h5KHBjbHMsIG51bGwsIG51bGwpOwogICAgICAgICAgICBfcHJv\neGllcy5wdXQodHlwZSwgcHJveHkpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gcHJveHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNh\nY2hlZCBmYWN0b3J5IHByb3h5IGZvciB0aGUgZ2l2ZW4gY2FsZW5kYXIgdHlw\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBQcm94eUNhbGVuZGFyIGdldEZhY3Rv\ncnlQcm94eUNhbGVuZGFyKENsYXNzIHR5cGUpIHsKICAgICAgICAvLyB3ZSBk\nb24ndCBsb2NrIGhlcmU7IG9rIGlmIHR3byBwcm94aWVzIGdldCBnZW5lcmF0\nZWQgZm9yIHNhbWUgdHlwZQogICAgICAgIFByb3h5Q2FsZW5kYXIgcHJveHkg\nPSAoUHJveHlDYWxlbmRhcikgX3Byb3hpZXMuZ2V0KHR5cGUpOwogICAgICAg\nIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzTG9hZGVy\nIGwgPSBHZW5lcmF0ZWRDbGFzc2VzLmdldE1vc3REZXJpdmVkTG9hZGVyKHR5\ncGUsCiAgICAgICAgICAgICAgICBQcm94eUNhbGVuZGFyLmNsYXNzKTsKICAg\nICAgICAgICAgQ2xhc3MgcGNscyA9IGxvYWRCdWlsZFRpbWVQcm94eSh0eXBl\nLCBsKTsKICAgICAgICAgICAgaWYgKHBjbHMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHBjbHMgPSBHZW5lcmF0ZWRDbGFzc2VzLmxvYWRCQ0NsYXNzKAog\nICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlUHJveHlDYWxlbmRhckJ5dGVj\nb2RlKHR5cGUsIHRydWUpLCBsKTsKICAgICAgICAgICAgcHJveHkgPSAoUHJv\neHlDYWxlbmRhcikgaW5zdGFudGlhdGVQcm94eShwY2xzLCBudWxsLCBudWxs\nKTsKICAgICAgICAgICAgX3Byb3hpZXMucHV0KHR5cGUsIHByb3h5KTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHByb3h5OwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBjYWNoZWQgZmFjdG9yeSBwcm94eSBmb3IgdGhl\nIGdpdmVuIGJlYW4gdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBQcm94eUJl\nYW4gZ2V0RmFjdG9yeVByb3h5QmVhbihPYmplY3Qgb3JpZykgewogICAgICAg\nIGZpbmFsIENsYXNzIHR5cGUgPSBvcmlnLmdldENsYXNzKCk7CiAgICAgICAg\naWYgKGlzVW5wcm94eWFibGUodHlwZSkpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICAvLyB3ZSBkb24ndCBsb2NrIGhlcmU7IG9rIGlmIHR3\nbyBwcm94aWVzIGdldCBnZW5lcmF0ZWQgZm9yIHNhbWUgdHlwZQogICAgICAg\nIFByb3h5QmVhbiBwcm94eSA9IChQcm94eUJlYW4pIF9wcm94aWVzLmdldCh0\neXBlKTsKICAgICAgICBpZiAocHJveHkgPT0gbnVsbCAmJiAhX3Byb3hpZXMu\nY29udGFpbnNLZXkodHlwZSkpIHsKICAgICAgICAgICAgQ2xhc3NMb2FkZXIg\nbCA9IEdlbmVyYXRlZENsYXNzZXMuZ2V0TW9zdERlcml2ZWRMb2FkZXIodHlw\nZSwKICAgICAgICAgICAgICAgIFByb3h5QmVhbi5jbGFzcyk7CiAgICAgICAg\nICAgIENsYXNzIHBjbHMgPSBsb2FkQnVpbGRUaW1lUHJveHkodHlwZSwgbCk7\nCiAgICAgICAgICAgIGlmIChwY2xzID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIEJDQ2xhc3MgYmMgPSAoQkNDbGFzcykgQWNjZXNzQ29udHJvbGxlcgog\nICAgICAgICAgICAgICAgICAgIC5kb1ByaXZpbGVnZWQobmV3IFByaXZpbGVn\nZWRBY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyBP\nYmplY3QgcnVuKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGdlbmVyYXRlUHJveHlCZWFuQnl0ZWNvZGUodHlwZSwgdHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9\nKTsKICAgICAgICAgICAgICAgIGlmIChiYyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIHBjbHMgPSBHZW5lcmF0ZWRDbGFzc2VzLmxvYWRCQ0NsYXNz\nKGJjLCBsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGNscyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgcHJveHkgPSAoUHJveHlCZWFuKSBp\nbnN0YW50aWF0ZVByb3h5KHBjbHMsCiAgICAgICAgICAgICAgICAgICAgZmlu\nZENvcHlDb25zdHJ1Y3Rvcih0eXBlKSwgbmV3IE9iamVjdFtdIHtvcmlnfSk7\nCiAgICAgICAgICAgIF9wcm94aWVzLnB1dCh0eXBlLCBwcm94eSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBwcm94eTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiB0eXBlIGlzIGtub3duIHRv\nIGJlIHVucHJveHlhYmxlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBpc1VucHJveHlhYmxlKENsYXNzIHR5cGUpIHsKICAgICAgICBmb3IgKDsg\ndHlwZSAhPSBudWxsICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNzOyAKICAgICAg\nICAgICAgdHlwZSA9IHR5cGUuZ2V0U3VwZXJjbGFzcygpKSB7CiAgICAgICAg\nICAgIGlmIChfdW5wcm94eWFibGUuY29udGFpbnModHlwZS5nZXROYW1lKCkp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWQg\ndGhlIHByb3h5IGNsYXNzIGdlbmVyYXRlZCBhdCBidWlsZCB0aW1lIGZvciB0\naGUgZ2l2ZW4gdHlwZSwKICAgICAqIHJldHVybmluZyBudWxsIGlmIG5vbmUg\nZXhpc3RzLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3MgbG9hZEJ1aWxk\nVGltZVByb3h5KENsYXNzIHR5cGUsIENsYXNzTG9hZGVyIGxvYWRlcikgewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBDbGFzcy5mb3JOYW1l\nKGdldFByb3h5Q2xhc3NOYW1lKHR5cGUsIGZhbHNlKSwgdHJ1ZSwgbG9hZGVy\nKTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gcHJveHkgY2xhc3MuCiAgICAgKi8K\nICAgIHByaXZhdGUgUHJveHkgaW5zdGFudGlhdGVQcm94eShDbGFzcyBjbHMs\nIENvbnN0cnVjdG9yIGNvbnMsIE9iamVjdFtdIGFyZ3MpIHsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoY29ucyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIChQcm94eSkgY2xzLmdldENvbnN0cnVjdG9yKGNvbnMu\nZ2V0UGFyYW1ldGVyVHlwZXMoKSkuCiAgICAgICAgICAgICAgICAgICAgbmV3\nSW5zdGFuY2UoYXJncyk7CiAgICAgICAgICAgIHJldHVybiAoUHJveHkpIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24oY2xzKSk7CiAgICAg\nICAgfSBjYXRjaCAoSW5zdGFudGlhdGlvbkV4Y2VwdGlvbiBpZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5n\nZXQoImNhbnQtbmV3aW5zdGFuY2UiLAogICAgICAgICAgICAgICAgY2xzLmdl\ndFN1cGVyY2xhc3MoKS5nZXROYW1lKCkpKTsKICAgICAgICB9IGNhdGNoIChQ\ncml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uIHBhZSkgewogICAgICAgICAgICBF\neGNlcHRpb24gZSA9IHBhZS5nZXRFeGNlcHRpb24oKTsKICAgICAgICAgICAg\naWYgKGUgaW5zdGFuY2VvZiBJbnN0YW50aWF0aW9uRXhjZXB0aW9uKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJjYW50LW5ld2luc3RhbmNlIiwKICAgICAgICAgICAgICAgICAg\nICBjbHMuZ2V0U3VwZXJjbGFzcygpLmdldE5hbWUoKSkpOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihjbHMuZ2V0TmFtZSgpKS5zZXRDYXVzZShlKTsKICAgICAgICB9IGNh\ndGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihjbHMuZ2V0TmFtZSgpKS5zZXRDYXVzZSh0KTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSB0aGUgYnl0\nZWNvZGUgZm9yIGEgY29sbGVjdGlvbiBwcm94eSBmb3IgdGhlIGdpdmVuIHR5\ncGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBCQ0NsYXNzIGdlbmVyYXRlUHJv\neHlDb2xsZWN0aW9uQnl0ZWNvZGUoQ2xhc3MgdHlwZSwgCiAgICAgICAgYm9v\nbGVhbiBydW50aW1lKSB7CiAgICAgICAgYXNzZXJ0Tm90RmluYWwodHlwZSk7\nCiAgICAgICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFByb2plY3QoKTsgCiAg\nICAgICAgQkNDbGFzcyBiYyA9IChCQ0NsYXNzKSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAubG9h\nZFByb2plY3RDbGFzc0FjdGlvbihwcm9qZWN0LCBnZXRQcm94eUNsYXNzTmFt\nZSh0eXBlLCBydW50aW1lKSkpOyAKICAgICAgICBiYy5zZXRTdXBlcmNsYXNz\nKHR5cGUpOwogICAgICAgIGJjLmRlY2xhcmVJbnRlcmZhY2UoUHJveHlDb2xs\nZWN0aW9uLmNsYXNzKTsKIAogICAgICAgIGRlbGVnYXRlQ29uc3RydWN0b3Jz\nKGJjLCB0eXBlKTsKICAgICAgICBhZGRQcm94eU1ldGhvZHMoYmMsIGZhbHNl\nKTsKICAgICAgICBhZGRQcm94eUNvbGxlY3Rpb25NZXRob2RzKGJjLCB0eXBl\nKTsKICAgICAgICBwcm94eVJlY29nbml6ZWRNZXRob2RzKGJjLCB0eXBlLCBQ\ncm94eUNvbGxlY3Rpb25zLmNsYXNzLCAKICAgICAgICAgICAgUHJveHlDb2xs\nZWN0aW9uLmNsYXNzKTsKICAgICAgICBwcm94eVNldHRlcnMoYmMsIHR5cGUp\nOwogICAgICAgIGFkZFdyaXRlUmVwbGFjZU1ldGhvZChiYywgcnVudGltZSk7\nCiAgICAgICAgcmV0dXJuIGJjOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBuYW1lIG9mIHRoZSBwcm94eSBjbGFzcyB0byBnZW5lcmF0ZSBm\nb3IgdGhlIGdpdmVuIHR5cGUuICAgCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIFN0cmluZyBnZXRQcm94eUNsYXNzTmFtZShDbGFzcyB0eXBlLCBib29s\nZWFuIHJ1bnRpbWUpIHsKICAgICAgICBTdHJpbmcgaWQgPSAocnVudGltZSkg\nPyAiJCIgKyBuZXh0UHJveHlJZCgpIDogIiI7CiAgICAgICAgcmV0dXJuIFN0\ncmluZ3MuZ2V0UGFja2FnZU5hbWUoUHJveHlNYW5hZ2VySW1wbC5jbGFzcykg\nKyAiLiIgCiAgICAgICAgICAgICsgdHlwZS5nZXROYW1lKCkucmVwbGFjZSgn\nLicsICckJykgKyBpZCArIFBST1hZX1NVRkZJWDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRocm93IGFwcHJvcHJpYXRlIGV4Y2VwdGlvbiBpZiB0aGUgZ2l2\nZW4gdHlwZSBpcyBmaW5hbC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\ndm9pZCBhc3NlcnROb3RGaW5hbChDbGFzcyB0eXBlKSB7CiAgICAgICAgaWYg\nKE1vZGlmaWVyLmlzRmluYWwodHlwZS5nZXRNb2RpZmllcnMoKSkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tcHJveHktZmluYWwiLCB0eXBlKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBHZW5lcmF0ZSB0aGUgYnl0ZWNvZGUgZm9yIGEgbWFwIHByb3h5IGZv\nciB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEJDQ2xh\nc3MgZ2VuZXJhdGVQcm94eU1hcEJ5dGVjb2RlKENsYXNzIHR5cGUsIGJvb2xl\nYW4gcnVudGltZSkgewogICAgICAgIGFzc2VydE5vdEZpbmFsKHR5cGUpOwog\nICAgICAgIFByb2plY3QgcHJvamVjdCA9IG5ldyBQcm9qZWN0KCk7IAogICAg\nICAgIEJDQ2xhc3MgYmMgPSAoQkNDbGFzcykgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgLmxvYWRQ\ncm9qZWN0Q2xhc3NBY3Rpb24ocHJvamVjdCwgZ2V0UHJveHlDbGFzc05hbWUo\ndHlwZSwgcnVudGltZSkpKTsgCiAgICAgICAgYmMuc2V0U3VwZXJjbGFzcyh0\neXBlKTsKICAgICAgICBiYy5kZWNsYXJlSW50ZXJmYWNlKFByb3h5TWFwLmNs\nYXNzKTsKIAogICAgICAgIGRlbGVnYXRlQ29uc3RydWN0b3JzKGJjLCB0eXBl\nKTsKICAgICAgICBhZGRQcm94eU1ldGhvZHMoYmMsIGZhbHNlKTsKICAgICAg\nICBhZGRQcm94eU1hcE1ldGhvZHMoYmMsIHR5cGUpOwogICAgICAgIHByb3h5\nUmVjb2duaXplZE1ldGhvZHMoYmMsIHR5cGUsIFByb3h5TWFwcy5jbGFzcywg\nUHJveHlNYXAuY2xhc3MpOwogICAgICAgIHByb3h5U2V0dGVycyhiYywgdHlw\nZSk7CiAgICAgICAgYWRkV3JpdGVSZXBsYWNlTWV0aG9kKGJjLCBydW50aW1l\nKTsKICAgICAgICByZXR1cm4gYmM7CiAgICB9CgogICAgLyoqCiAgICAgKiBH\nZW5lcmF0ZSB0aGUgYnl0ZWNvZGUgZm9yIGEgZGF0ZSBwcm94eSBmb3IgdGhl\nIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBCQ0NsYXNzIGdl\nbmVyYXRlUHJveHlEYXRlQnl0ZWNvZGUoQ2xhc3MgdHlwZSwgYm9vbGVhbiBy\ndW50aW1lKSB7CiAgICAgICAgYXNzZXJ0Tm90RmluYWwodHlwZSk7CiAgICAg\nICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFByb2plY3QoKTsgCiAgICAgICAg\nQkNDbGFzcyBiYyA9IChCQ0NsYXNzKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAubG9hZFByb2pl\nY3RDbGFzc0FjdGlvbihwcm9qZWN0LCBnZXRQcm94eUNsYXNzTmFtZSh0eXBl\nLCBydW50aW1lKSkpOyAKICAgICAgICBiYy5zZXRTdXBlcmNsYXNzKHR5cGUp\nOwogICAgICAgIGJjLmRlY2xhcmVJbnRlcmZhY2UoUHJveHlEYXRlLmNsYXNz\nKTsKIAogICAgICAgIGRlbGVnYXRlQ29uc3RydWN0b3JzKGJjLCB0eXBlKTsK\nICAgICAgICBhZGRQcm94eU1ldGhvZHMoYmMsIHRydWUpOwogICAgICAgIGFk\nZFByb3h5RGF0ZU1ldGhvZHMoYmMsIHR5cGUpOwogICAgICAgIHByb3h5U2V0\ndGVycyhiYywgdHlwZSk7CiAgICAgICAgYWRkV3JpdGVSZXBsYWNlTWV0aG9k\nKGJjLCBydW50aW1lKTsKICAgICAgICByZXR1cm4gYmM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBHZW5lcmF0ZSB0aGUgYnl0ZWNvZGUgZm9yIGEgY2FsZW5k\nYXIgcHJveHkgZm9yIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBwcm90\nZWN0ZWQgQkNDbGFzcyBnZW5lcmF0ZVByb3h5Q2FsZW5kYXJCeXRlY29kZShD\nbGFzcyB0eXBlLCAKICAgICAgICBib29sZWFuIHJ1bnRpbWUpIHsKICAgICAg\nICBhc3NlcnROb3RGaW5hbCh0eXBlKTsKICAgICAgICBQcm9qZWN0IHByb2pl\nY3QgPSBuZXcgUHJvamVjdCgpOyAKICAgICAgICBCQ0NsYXNzIGJjID0gKEJD\nQ2xhc3MpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2\nSGVscGVyCiAgICAgICAgICAgIC5sb2FkUHJvamVjdENsYXNzQWN0aW9uKHBy\nb2plY3QsIGdldFByb3h5Q2xhc3NOYW1lKHR5cGUsIHJ1bnRpbWUpKSk7IAog\nICAgICAgIGJjLnNldFN1cGVyY2xhc3ModHlwZSk7CiAgICAgICAgYmMuZGVj\nbGFyZUludGVyZmFjZShQcm94eUNhbGVuZGFyLmNsYXNzKTsKIAogICAgICAg\nIGRlbGVnYXRlQ29uc3RydWN0b3JzKGJjLCB0eXBlKTsKICAgICAgICBhZGRQ\ncm94eU1ldGhvZHMoYmMsIHRydWUpOwogICAgICAgIGFkZFByb3h5Q2FsZW5k\nYXJNZXRob2RzKGJjLCB0eXBlKTsKICAgICAgICBwcm94eVNldHRlcnMoYmMs\nIHR5cGUpOwogICAgICAgIGFkZFdyaXRlUmVwbGFjZU1ldGhvZChiYywgcnVu\ndGltZSk7CiAgICAgICAgcmV0dXJuIGJjOwogICAgfQoKICAgIC8qKgogICAg\nICogR2VuZXJhdGUgdGhlIGJ5dGVjb2RlIGZvciBhIGJlYW4gcHJveHkgZm9y\nIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBwcm90ZWN0ZWQgQkNDbGFz\ncyBnZW5lcmF0ZVByb3h5QmVhbkJ5dGVjb2RlKENsYXNzIHR5cGUsIGJvb2xl\nYW4gcnVudGltZSkgewogICAgICAgIGlmIChNb2RpZmllci5pc0ZpbmFsKHR5\ncGUuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWRUeXBlKG51bGwsIHR5\ncGUpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gd2Ug\nY2FuIG9ubHkgZ2VuZXJhdGUgYSB2YWxpZCBwcm94eSBpZiB0aGVyZSBpcyBh\nIGNvcHkgY29uc3RydWN0b3IKICAgICAgICAvLyBvciBhIGRlZmF1bHQgY29u\nc3RydWN0b3IKICAgICAgICBDb25zdHJ1Y3RvciBjb25zID0gZmluZENvcHlD\nb25zdHJ1Y3Rvcih0eXBlKTsKICAgICAgICBpZiAoY29ucyA9PSBudWxsKSB7\nCiAgICAgICAgICAgIENvbnN0cnVjdG9yW10gY3MgPSB0eXBlLmdldENvbnN0\ncnVjdG9ycygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgY29ucyA9\nPSBudWxsICYmIGkgPCBjcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAg\naWYgKGNzW2ldLmdldFBhcmFtZXRlclR5cGVzKCkubGVuZ3RoID09IDApCiAg\nICAgICAgICAgICAgICAgICAgY29ucyA9IGNzW2ldOyAKICAgICAgICAgICAg\naWYgKGNvbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIH0KCiAgICAgICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFBy\nb2plY3QoKTsgCiAgICAgICAgQkNDbGFzcyBiYyA9IChCQ0NsYXNzKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAg\nICAgICAgICAubG9hZFByb2plY3RDbGFzc0FjdGlvbihwcm9qZWN0LCBnZXRQ\ncm94eUNsYXNzTmFtZSh0eXBlLCBydW50aW1lKSkpOyAKICAgICAgICBiYy5z\nZXRTdXBlcmNsYXNzKHR5cGUpOwogICAgICAgIGJjLmRlY2xhcmVJbnRlcmZh\nY2UoUHJveHlCZWFuLmNsYXNzKTsKIAogICAgICAgIGRlbGVnYXRlQ29uc3Ry\ndWN0b3JzKGJjLCB0eXBlKTsKICAgICAgICBhZGRQcm94eU1ldGhvZHMoYmMs\nIHRydWUpOwogICAgICAgIGFkZFByb3h5QmVhbk1ldGhvZHMoYmMsIHR5cGUs\nIGNvbnMpOwogICAgICAgIGlmICghcHJveHlTZXR0ZXJzKGJjLCB0eXBlKSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgYWRkV3JpdGVSZXBs\nYWNlTWV0aG9kKGJjLCBydW50aW1lKTsKICAgICAgICByZXR1cm4gYmM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgcGFzcy10aHJvdWdoIGNvbnN0\ncnVjdG9ycyB0byBiYXNlIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBkZWxlZ2F0ZUNvbnN0cnVjdG9ycyhCQ0NsYXNzIGJjLCBDbGFzcyB0eXBl\nKSB7CiAgICAgICAgQ29uc3RydWN0b3JbXSBjb25zID0gdHlwZS5nZXRDb25z\ndHJ1Y3RvcnMoKTsKICAgICAgICBDbGFzc1tdIHBhcmFtczsKICAgICAgICBC\nQ01ldGhvZCBtOwogICAgICAgIENvZGUgY29kZTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGNvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\ncGFyYW1zID0gY29uc1tpXS5nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAg\nICAgICBtID0gYmMuZGVjbGFyZU1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFz\ncywgcGFyYW1zKTsgCiAgICAgICAgICAgIG0ubWFrZVB1YmxpYygpOwoKICAg\nICAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgZm9yIChpbnQg\naiA9IDA7IGogPCBwYXJhbXMubGVuZ3RoOyBqKyspCiAgICAgICAgICAgICAg\nICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oaikuc2V0VHlwZShwYXJhbXNbal0p\nOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qo\nY29uc1tpXSk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogSW1wbGVtZW50IHRoZSBtZXRob2RzIGluIHRoZSB7QGxp\nbmsgUHJveHl9IGludGVyZmFjZSwgd2l0aCB0aGUgZXhjZXB0aW9uCiAgICAg\nKiBvZiB7QGxpbmsgUHJveHkjY29weX0uCiAgICAgKgogICAgICogQHBhcmFt\nIGNoYW5nZVRyYWNrZXIgd2hldGhlciB0byBpbXBsZW1lbnQgYSBudWxsIGNo\nYW5nZSB0cmFja2VyOyBpZiBmYWxzZQogICAgICogdGhlIGNoYW5nZSB0cmFj\na2VyIG1ldGhvZCBpcyBsZWZ0IHVuaW1wbGVtZW50ZWQKICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZFByb3h5TWV0aG9kcyhCQ0NsYXNzIGJjLCBib29s\nZWFuIGNoYW5nZVRyYWNrZXIpIHsKICAgICAgICBCQ0ZpZWxkIHNtID0gYmMu\nZGVjbGFyZUZpZWxkKCJzbSIsIE9wZW5KUEFTdGF0ZU1hbmFnZXIuY2xhc3Mp\nOwogICAgICAgIHNtLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICBCQ0Zp\nZWxkIGZpZWxkID0gYmMuZGVjbGFyZUZpZWxkKCJmaWVsZCIsIGludC5jbGFz\ncyk7CiAgICAgICAgZmllbGQuc2V0VHJhbnNpZW50KHRydWUpOwoKICAgICAg\nICBCQ01ldGhvZCBtID0gYmMuZGVjbGFyZU1ldGhvZCgic2V0T3duZXIiLCB2\nb2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIuY2xhc3MsIGludC5jbGFzcyB9KTsKICAgICAgICBtLm1h\na2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5wdXRmaWVs\nZCgpLnNldEZpZWxkKHNtKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhp\ncygpOwogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAg\nICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoZmllbGQpOwogICAgICAgIGNv\nZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAg\nICBtID0gYmMuZGVjbGFyZU1ldGhvZCgiZ2V0T3duZXIiLCBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyLmNsYXNzLCBudWxsKTsKICAgICAgICBtLm1ha2VQdWJsaWMo\nKTsKICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKHNtKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRo\nb2QoImdldE93bmVyRmllbGQiLCBpbnQuY2xhc3MsIG51bGwpOwogICAgICAg\nIG0ubWFrZVB1YmxpYygpOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoZmllbGQpOwogICAgICAgIGNvZGUu\naXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICAv\nKiAKICAgICAgICAgKiBjbG9uZSAocmV0dXJuIGRldGFjaGVkIHByb3h5IG9i\namVjdCkKICAgICAgICAgKiBOb3RlOiAgVGhpcyBtZXRob2QgaXMgb25seSBi\nZWluZyBwcm92aWRlZCB0byBzYXRpc2Z5IGEgcXVpcmsgd2l0aAogICAgICAg\nICAqIHRoZSBJQk0gSkRLIC0tIHdoaWxlIGNvbXBhcmluZyBDYWxlbmRhciBv\nYmplY3RzLCB0aGUgY2xvbmUoKSBtZXRob2QKICAgICAgICAgKiB3YXMgaW52\nb2tlZC4gIFNvLCB3ZSBhcmUgbm93IG92ZXJyaWRpbmcgdGhlIGNsb25lKCkg\nbWV0aG9kIHNvIGFzIHRvCiAgICAgICAgICogcHJvdmlkZSBhIGRldGFjaGVk\nIHByb3h5IG9iamVjdCAobnVsbCBvdXQgdGhlIFN0YXRlTWFuYWdlcikuCiAg\nICAgICAgICovCiAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRob2QoImNsb25l\nIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBtLm1ha2VQdWJsaWMo\nKTsKICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKGJjLmdldFN1cGVyY2xhc3NUeXBlKCksICJjbG9u\nZSIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOyAgCiAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFByb3h5LmNsYXNzKTsg\nIAogICAgICAgIGludCBvdGhlciA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4\nKCk7CiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChvdGhlcik7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG90aGVyKTsKICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFj\nZSgpLnNldE1ldGhvZChQcm94eS5jbGFzcywgInNldE93bmVyIiwgdm9pZC5j\nbGFzcywKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgT3BlbkpQQVN0\nYXRlTWFuYWdlci5jbGFzcywgaW50LmNsYXNzIH0pOwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRMb2NhbChvdGhlcik7CiAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgCiAgICAgICAg\naWYgKGNoYW5nZVRyYWNrZXIpIHsKICAgICAgICAgICAgbSA9IGJjLmRlY2xh\ncmVNZXRob2QoImdldENoYW5nZVRyYWNrZXIiLCBDaGFuZ2VUcmFja2VyLmNs\nYXNzLCBudWxsKTsKICAgICAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAg\nICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgICAgIGNvZGUuYXJl\ndHVybigpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50IHRoZSBtZXRo\nb2RzIGluIHRoZSB7QGxpbmsgUHJveHlDb2xsZWN0aW9ufSBpbnRlcmZhY2Uu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQcm94eUNvbGxlY3Rpb25N\nZXRob2RzKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUpIHsKICAgICAgICAvLyBj\naGFuZ2UgdHJhY2tlcgogICAgICAgIEJDRmllbGQgY2hhbmdlVHJhY2tlciA9\nIGJjLmRlY2xhcmVGaWVsZCgiY2hhbmdlVHJhY2tlciIsIAogICAgICAgICAg\nICBDb2xsZWN0aW9uQ2hhbmdlVHJhY2tlci5jbGFzcyk7CiAgICAgICAgY2hh\nbmdlVHJhY2tlci5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAgQkNNZXRo\nb2QgbSA9IGJjLmRlY2xhcmVNZXRob2QoImdldENoYW5nZVRyYWNrZXIiLCBD\naGFuZ2VUcmFja2VyLmNsYXNzLCAKICAgICAgICAgICAgbnVsbCk7CiAgICAg\nICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbS5nZXRD\nb2RlKHRydWUpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKGNoYW5nZVRyYWNrZXIp\nOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwoKICAgICAgICAvLyBjb2xsZWN0aW9uIGNvcHkKICAgICAgICBDb25z\ndHJ1Y3RvciBjb25zID0gZmluZENvcHlDb25zdHJ1Y3Rvcih0eXBlKTsKICAg\nICAgICBpZiAoY29ucyA9PSBudWxsICYmIFNvcnRlZFNldC5jbGFzcy5pc0Fz\nc2lnbmFibGVGcm9tKHR5cGUpKQogICAgICAgICAgICBjb25zID0gZmluZENv\nbXBhcmF0b3JDb25zdHJ1Y3Rvcih0eXBlKTsKICAgICAgICBDbGFzc1tdIHBh\ncmFtcyA9IChjb25zID09IG51bGwpID8gbmV3IENsYXNzWzBdIAogICAgICAg\nICAgICA6IGNvbnMuZ2V0UGFyYW1ldGVyVHlwZXMoKTsKCiAgICAgICAgbSA9\nIGJjLmRlY2xhcmVNZXRob2QoImNvcHkiLCBPYmplY3QuY2xhc3MsIG5ldyBD\nbGFzc1tdIHtPYmplY3QuY2xhc3N9KTsKICAgICAgICBtLm1ha2VQdWJsaWMo\nKTsKICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwoKICAgICAgICBj\nb2RlLmFuZXcoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIGNvZGUuZHVwKCk7\nCiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMSkgewogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGlmIChw\nYXJhbXNbMF0gPT0gQ29tcGFyYXRvci5jbGFzcykgewogICAgICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFNvcnRlZFNldC5jbGFzcyk7\nCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1l\ndGhvZChTb3J0ZWRTZXQuY2xhc3MsICJjb21wYXJhdG9yIiwgCiAgICAgICAg\nICAgICAgICAgICAgQ29tcGFyYXRvci5jbGFzcywgbnVsbCk7CiAgICAgICAg\nICAgIH0gZWxzZQogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5z\nZXRUeXBlKHBhcmFtc1swXSk7CiAgICAgICAgfQogICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+Iiwgdm9pZC5j\nbGFzcywgcGFyYW1zKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA9PSAw\nIHx8IHBhcmFtc1swXSA9PSBDb21wYXJhdG9yLmNsYXNzKSB7CiAgICAgICAg\nICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKENvbGxlY3Rpb24uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QodHlwZSwgImFkZEFsbCIsIGJvb2xlYW4uY2xh\nc3MsIAogICAgICAgICAgICAgICAgbmV3IENsYXNzW10geyBDb2xsZWN0aW9u\nLmNsYXNzIH0pOwogICAgICAgICAgICBjb2RlLnBvcCgpOwogICAgICAgIH0K\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKCiAgICAgICAgLy8gZWxlbWVudCB0eXBlCiAgICAgICAgQkNGaWVsZCBl\nbGVtZW50VHlwZSA9IGJjLmRlY2xhcmVGaWVsZCgiZWxlbWVudFR5cGUiLCBD\nbGFzcy5jbGFzcyk7CiAgICAgICAgZWxlbWVudFR5cGUuc2V0VHJhbnNpZW50\nKHRydWUpOwogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJnZXRFbGVt\nZW50VHlwZSIsIENsYXNzLmNsYXNzLCBudWxsKTsKICAgICAgICBtLm1ha2VQ\ndWJsaWMoKTsKICAgICAgICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwogICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5nZXRm\naWVsZCgpLnNldEZpZWxkKGVsZW1lbnRUeXBlKTsKICAgICAgICBjb2RlLmFy\nZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8g\nbmV3IGluc3RhbmNlIGZhY3RvcnkKICAgICAgICBtID0gYmMuZGVjbGFyZU1l\ndGhvZCgibmV3SW5zdGFuY2UiLCBQcm94eUNvbGxlY3Rpb24uY2xhc3MsIAog\nICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IENsYXNzLmNsYXNzLCBDb21wYXJh\ndG9yLmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgIG0ubWFrZVB1\nYmxpYygpOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CgogICAg\nICAgIGNvZGUuYW5ldygpLnNldFR5cGUoYmMpOyAKICAgICAgICBjb2RlLmR1\ncCgpOwogICAgICAgIGNvbnMgPSBmaW5kQ29tcGFyYXRvckNvbnN0cnVjdG9y\nKHR5cGUpOwogICAgICAgIHBhcmFtcyA9IChjb25zID09IG51bGwpID8gbmV3\nIENsYXNzWzBdIDogY29ucy5nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAg\nIGlmIChwYXJhbXMubGVuZ3RoID09IDEpCiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgxKTsKICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwo\nKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3MsIHBhcmFtcyk7CiAg\nICAgICAgaW50IHJldCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAg\nICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChyZXQpOwoKICAgICAgICAv\nLyBzZXQgZWxlbWVudCB0eXBlCiAgICAgICAgY29kZS5hbG9hZCgpLnNldExv\nY2FsKHJldCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChlbGVtZW50VHlwZSk7\nCgogICAgICAgIC8vIGNyZWF0ZSBjaGFuZ2UgdHJhY2tlciBhbmQgc2V0IGl0\nCiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKDIpOwogICAgICAgIEp1\nbXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZlcSgpOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChyZXQpOwogICAgICAgIGNvZGUuYW5ldygp\nLnNldFR5cGUoQ29sbGVjdGlvbkNoYW5nZVRyYWNrZXJJbXBsLmNsYXNzKTsK\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChyZXQpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShh\nbGxvd3NEdXBsaWNhdGVzKHR5cGUpKTsKICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoaXNPcmRlcmVkKHR5cGUpKTsKICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoQ29sbGVjdGlvbkNoYW5nZVRyYWNr\nZXJJbXBsLmNsYXNzLCAKICAgICAgICAgICAgIjxpbml0PiIsIHZvaWQuY2xh\nc3MsIG5ldyBDbGFzc1tdIHsgQ29sbGVjdGlvbi5jbGFzcywgCiAgICAgICAg\nICAgIGJvb2xlYW4uY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAg\nY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKGNoYW5nZVRyYWNrZXIpOwoKICAg\nICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNldExvY2FsKHJl\ndCkpOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIg\ndGhlIGdpdmVuIGNvbGxlY3Rpb24gdHlwZSBhbGxvd3MgZHVwbGljYXRlcy4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gYWxsb3dzRHVwbGljYXRl\ncyhDbGFzcyB0eXBlKSB7CiAgICAgICAgcmV0dXJuICFTZXQuY2xhc3MuaXNB\nc3NpZ25hYmxlRnJvbSh0eXBlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB3aGV0aGVyIHRoZSBnaXZlbiBjb2xsZWN0aW9uIHR5cGUgbWFpbnRh\naW5zIGFuIGFydGlmaWNpYWwgCiAgICAgKiBvcmRlcmluZy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNPcmRlcmVkKENsYXNzIHR5cGUpIHsK\nICAgICAgICByZXR1cm4gTGlzdC5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5\ncGUpCiAgICAgICAgICAgIHx8ICJqYXZhLnV0aWwuTGlua2VkSGFzaFNldCIu\nZXF1YWxzKHR5cGUuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEltcGxlbWVudCB0aGUgbWV0aG9kcyBpbiB0aGUge0BsaW5rIFByb3h5TWFw\nfSBpbnRlcmZhY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQcm94\neU1hcE1ldGhvZHMoQkNDbGFzcyBiYywgQ2xhc3MgdHlwZSkgewogICAgICAg\nIC8vIGNoYW5nZSB0cmFja2VyCiAgICAgICAgQkNGaWVsZCBjaGFuZ2VUcmFj\na2VyID0gYmMuZGVjbGFyZUZpZWxkKCJjaGFuZ2VUcmFja2VyIiwgCiAgICAg\nICAgICAgIE1hcENoYW5nZVRyYWNrZXIuY2xhc3MpOwogICAgICAgIGNoYW5n\nZVRyYWNrZXIuc2V0VHJhbnNpZW50KHRydWUpOwogICAgICAgIEJDTWV0aG9k\nIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJnZXRDaGFuZ2VUcmFja2VyIiwgQ2hh\nbmdlVHJhY2tlci5jbGFzcywgCiAgICAgICAgICAgIG51bGwpOwogICAgICAg\nIG0ubWFrZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG0uZ2V0Q29k\nZSh0cnVlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChjaGFuZ2VUcmFja2VyKTsK\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKCiAgICAgICAgLy8gbWFwIGNvcHkKICAgICAgICBDb25zdHJ1Y3RvciBj\nb25zID0gZmluZENvcHlDb25zdHJ1Y3Rvcih0eXBlKTsKICAgICAgICBpZiAo\nY29ucyA9PSBudWxsICYmIFNvcnRlZE1hcC5jbGFzcy5pc0Fzc2lnbmFibGVG\ncm9tKHR5cGUpKQogICAgICAgICAgICBjb25zID0gZmluZENvbXBhcmF0b3JD\nb25zdHJ1Y3Rvcih0eXBlKTsKICAgICAgICBDbGFzc1tdIHBhcmFtcyA9IChj\nb25zID09IG51bGwpID8gbmV3IENsYXNzWzBdIAogICAgICAgICAgICA6IGNv\nbnMuZ2V0UGFyYW1ldGVyVHlwZXMoKTsKCiAgICAgICAgbSA9IGJjLmRlY2xh\ncmVNZXRob2QoImNvcHkiLCBPYmplY3QuY2xhc3MsIG5ldyBDbGFzc1tdIHtP\nYmplY3QuY2xhc3N9KTsKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAg\nICBjb2RlID0gbS5nZXRDb2RlKHRydWUpOwoKICAgICAgICBjb2RlLmFuZXco\nKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAg\naWYgKHBhcmFtcy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGlmIChwYXJhbXNbMF0g\nPT0gQ29tcGFyYXRvci5jbGFzcykgewogICAgICAgICAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKFNvcnRlZE1hcC5jbGFzcyk7CiAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTb3J0\nZWRNYXAuY2xhc3MsICJjb21wYXJhdG9yIiwgCiAgICAgICAgICAgICAgICAg\nICAgQ29tcGFyYXRvci5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIH0gZWxz\nZSAKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShw\nYXJhbXNbMF0pOwogICAgICAgIH0KICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QodHlwZSwgIjxpbml0PiIsIHZvaWQuY2xhc3MsIHBh\ncmFtcyk7CiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMCB8fCBwYXJh\nbXNbMF0gPT0gQ29tcGFyYXRvci5jbGFzcykgewogICAgICAgICAgICBjb2Rl\nLmR1cCgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShNYXAuY2xh\nc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QodHlwZSwgInB1dEFsbCIsIHZvaWQuY2xhc3MsIAogICAgICAgICAgICAg\nICAgbmV3IENsYXNzW10geyBNYXAuY2xhc3MgfSk7CiAgICAgICAgfQogICAg\nICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoK\nICAgICAgICAvLyBrZXkgdHlwZQogICAgICAgIEJDRmllbGQga2V5VHlwZSA9\nIGJjLmRlY2xhcmVGaWVsZCgia2V5VHlwZSIsIENsYXNzLmNsYXNzKTsKICAg\nICAgICBrZXlUeXBlLnNldFRyYW5zaWVudCh0cnVlKTsKICAgICAgICBtID0g\nYmMuZGVjbGFyZU1ldGhvZCgiZ2V0S2V5VHlwZSIsIENsYXNzLmNsYXNzLCBu\ndWxsKTsKICAgICAgICBtLm1ha2VQdWJsaWMoKTsKICAgICAgICBjb2RlID0g\nbS5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlz\nKCk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKGtleVR5cGUp\nOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwoKICAgICAgICAvLyB2YWx1ZSB0eXBlCiAgICAgICAgQkNGaWVsZCB2\nYWx1ZVR5cGUgPSBiYy5kZWNsYXJlRmllbGQoInZhbHVlVHlwZSIsIENsYXNz\nLmNsYXNzKTsKICAgICAgICB2YWx1ZVR5cGUuc2V0VHJhbnNpZW50KHRydWUp\nOwogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJnZXRWYWx1ZVR5cGUi\nLCBDbGFzcy5jbGFzcywgbnVsbCk7CiAgICAgICAgbS5tYWtlUHVibGljKCk7\nCiAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZCh2YWx1ZVR5cGUpOwogICAgICAgIGNvZGUuYXJldHVybigpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICAvLyBuZXcgaW5zdGFu\nY2UgZmFjdG9yeQogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0aG9kKCJuZXdJ\nbnN0YW5jZSIsIFByb3h5TWFwLmNsYXNzLCAKICAgICAgICAgICAgbmV3IENs\nYXNzW10geyBDbGFzcy5jbGFzcywgQ2xhc3MuY2xhc3MsIENvbXBhcmF0b3Iu\nY2xhc3MsIAogICAgICAgICAgICBib29sZWFuLmNsYXNzIH0pOwogICAgICAg\nIG0ubWFrZVB1YmxpYygpOwogICAgICAgIGNvZGUgPSBtLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoYmMpOyAKICAgICAg\nICBjb2RlLmR1cCgpOwogICAgICAgIGNvbnMgPSBmaW5kQ29tcGFyYXRvckNv\nbnN0cnVjdG9yKHR5cGUpOwogICAgICAgIHBhcmFtcyA9IChjb25zID09IG51\nbGwpID8gbmV3IENsYXNzWzBdIDogY29ucy5nZXRQYXJhbWV0ZXJUeXBlcygp\nOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDEpCiAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgyKTsKICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3MsIHBh\ncmFtcyk7CiAgICAgICAgaW50IHJldCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0lu\nZGV4KCk7CiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChyZXQpOwoK\nICAgICAgICAvLyBzZXQga2V5IGFuZCB2YWx1ZSB0eXBlcwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChyZXQpOwogICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0Rmll\nbGQoa2V5VHlwZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKHJl\ndCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDEpOwogICAgICAg\nIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZCh2YWx1ZVR5cGUpOwoKICAgICAg\nICAvLyBjcmVhdGUgY2hhbmdlIHRyYWNrZXIgYW5kIHNldCBpdAogICAgICAg\nIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgzKTsKICAgICAgICBKdW1wSW5zdHJ1\nY3Rpb24gaWZpbnMgPSBjb2RlLmlmZXEoKTsKICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0TG9jYWwocmV0KTsKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBl\nKE1hcENoYW5nZVRyYWNrZXJJbXBsLmNsYXNzKTsKICAgICAgICBjb2RlLmR1\ncCgpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChyZXQpOwogICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChNYXBDaGFuZ2VU\ncmFja2VySW1wbC5jbGFzcywgCiAgICAgICAgICAgICI8aW5pdD4iLCB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IE1hcC5jbGFzcyB9KTsKICAgICAgICBj\nb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoY2hhbmdlVHJhY2tlcik7CgogICAg\nICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0TG9jYWwocmV0\nKSk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1lbnQgdGhlIG1l\ndGhvZHMgaW4gdGhlIHtAbGluayBQcm94eURhdGV9IGludGVyZmFjZS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFByb3h5RGF0ZU1ldGhvZHMoQkND\nbGFzcyBiYywgQ2xhc3MgdHlwZSkgewogICAgICAgIGJvb2xlYW4gaGFzRGVm\nYXVsdENvbnMgPSBiYy5nZXREZWNsYXJlZE1ldGhvZCgiPGluaXQ+IiwgCiAg\nICAgICAgICAgIChDbGFzc1tdKSBudWxsKSAhPSBudWxsOwogICAgICAgIGJv\nb2xlYW4gaGFzTWlsbGlzQ29ucyA9IGJjLmdldERlY2xhcmVkTWV0aG9kKCI8\naW5pdD4iLCAKICAgICAgICAgICAgbmV3IENsYXNzW10geyBsb25nLmNsYXNz\nIH0pICE9IG51bGw7CiAgICAgICAgaWYgKCFoYXNEZWZhdWx0Q29ucyAmJiAh\naGFzTWlsbGlzQ29ucykKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9y\ndGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1kYXRlLWNvbnMiLCB0eXBlKSk7\nCgogICAgICAgIC8vIGFkZCBhIGRlZmF1bHQgY29uc3RydWN0b3IgdGhhdCBk\nZWxlZ2F0ZXMgdG8gdGhlIG1pbGxpcyBjb25zdHJ1Y3RvcgogICAgICAgIEJD\nTWV0aG9kIG07CiAgICAgICAgQ29kZSBjb2RlOwogICAgICAgIGlmICghaGFz\nRGVmYXVsdENvbnMpIHsKICAgICAgICAgICAgbSA9IGJjLmRlY2xhcmVNZXRo\nb2QoIjxpbml0PiIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBt\nLm1ha2VQdWJsaWMoKTsKICAgICAgICAgICAgY29kZSA9IG0uZ2V0Q29kZSh0\ncnVlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoU3lzdGVt\nLmNsYXNzLCAiY3VycmVudFRpbWVNaWxsaXMiLAogICAgICAgICAgICAgICAg\nbG9uZy5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+Iiwgdm9pZC5jbGFzcywK\nICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgbG9uZy5jbGFzcyB9KTsK\nICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsgICAgICAgICAgIAogICAgICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gZGF0ZSBjb3B5CiAgICAgICAgQ29uc3RydWN0b3IgY29ucyA9IGZpbmRD\nb3B5Q29uc3RydWN0b3IodHlwZSk7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXM7\nCiAgICAgICAgaWYgKGNvbnMgIT0gbnVsbCkKICAgICAgICAgICAgcGFyYW1z\nID0gY29ucy5nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAgIGVsc2UgaWYg\nKGhhc01pbGxpc0NvbnMpCiAgICAgICAgICAgIHBhcmFtcyA9IG5ldyBDbGFz\nc1tdIHsgbG9uZy5jbGFzcyB9OwogICAgICAgIGVsc2UKICAgICAgICAgICAg\ncGFyYW1zID0gbmV3IENsYXNzWzBdOwoKICAgICAgICBtID0gYmMuZGVjbGFy\nZU1ldGhvZCgiY29weSIsIE9iamVjdC5jbGFzcywgbmV3IENsYXNzW10ge09i\namVjdC5jbGFzc30pOwogICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAg\nIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CgogICAgICAgIGNvZGUuYW5ldygp\nLnNldFR5cGUodHlwZSk7CiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBp\nZiAocGFyYW1zLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgIGlmIChwYXJh\nbXNbMF0gPT0gbG9uZy5jbGFzcykgewogICAgICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgY29kZS5jaGVj\na2Nhc3QoKS5zZXRUeXBlKERhdGUuY2xhc3MpOwogICAgICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKERhdGUuY2xhc3MsICJn\nZXRUaW1lIiwgCiAgICAgICAgICAgICAgICAgICAgbG9uZy5jbGFzcywgbnVs\nbCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUocGFyYW1zWzBdKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2QodHlwZSwgIjxpbml0PiIsIHZvaWQuY2xhc3MsIHBhcmFtcyk7CiAgICAg\nICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICBjb2Rl\nLmR1cCgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEYXRlLmNs\nYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKERhdGUuY2xhc3MsICJnZXRUaW1lIiwgbG9uZy5jbGFzcywgCiAgICAg\nICAgICAgICAgICBudWxsKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKHR5cGUsICJzZXRUaW1lIiwgdm9pZC5jbGFzcywK\nICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgbG9uZy5jbGFzcyB9KTsK\nICAgICAgICB9CiAgICAgICAgaWYgKChwYXJhbXMubGVuZ3RoID09IDAgfHwg\ncGFyYW1zWzBdID09IGxvbmcuY2xhc3MpIAogICAgICAgICAgICAmJiBUaW1l\nc3RhbXAuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkgewogICAgICAg\nICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShUaW1lc3RhbXAuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoVGltZXN0YW1wLmNsYXNzLCAiZ2V0TmFub3Mi\nLCAKICAgICAgICAgICAgICAgIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBlLCAic2V0\nTmFub3MiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNz\nW10geyBpbnQuY2xhc3MgfSk7CiAgICAgICAgfQogICAgICAgIGNvZGUuYXJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICAvLyBu\nZXcgaW5zdGFuY2UgZmFjdG9yeQogICAgICAgIG0gPSBiYy5kZWNsYXJlTWV0\naG9kKCJuZXdJbnN0YW5jZSIsIFByb3h5RGF0ZS5jbGFzcywgbnVsbCk7IAog\nICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAgIGNvZGUgPSBtLmdldENv\nZGUodHJ1ZSk7CiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShiYyk7IAog\nICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFs\nKCkuc2V0TWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBudWxsKTsKICAg\nICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEltcGxlbWVudCB0aGUgbWV0aG9kcyBp\nbiB0aGUge0BsaW5rIFByb3h5Q2FsZW5kYXJ9IGludGVyZmFjZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZFByb3h5Q2FsZW5kYXJNZXRob2RzKEJD\nQ2xhc3MgYmMsIENsYXNzIHR5cGUpIHsKICAgICAgICAvLyBjYWxlbmRhciBj\nb3B5CiAgICAgICAgQ29uc3RydWN0b3IgY29ucyA9IGZpbmRDb3B5Q29uc3Ry\ndWN0b3IodHlwZSk7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXMgPSAoY29ucyA9\nPSBudWxsKSA/IG5ldyBDbGFzc1swXSAKICAgICAgICAgICAgOiBjb25zLmdl\ndFBhcmFtZXRlclR5cGVzKCk7CgogICAgICAgIEJDTWV0aG9kIG0gPSBiYy5k\nZWNsYXJlTWV0aG9kKCJjb3B5IiwgT2JqZWN0LmNsYXNzLCAKICAgICAgICAg\nICAgbmV3IENsYXNzW10ge09iamVjdC5jbGFzc30pOwogICAgICAgIG0ubWFr\nZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG0uZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh0eXBlKTsKICAgICAg\nICBjb2RlLmR1cCgpOwogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDEp\nIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUocGFyYW1zWzBdKTsK\nICAgICAgICB9CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKHR5cGUsICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBwYXJhbXMpOwogICAg\nICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgY29k\nZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDAp\nOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQ2FsZW5k\nYXIuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoQ2FsZW5kYXIuY2xhc3MsICJnZXRUaW1lSW5NaWxsaXMiLCAK\nICAgICAgICAgICAgICAgIGxvbmcuY2xhc3MsIG51bGwpOwogICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QodHlwZSwgInNldFRp\nbWVJbk1pbGxpcyIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcg\nQ2xhc3NbXSB7IGxvbmcuY2xhc3MgfSk7CgogICAgICAgICAgICBjb2RlLmR1\ncCgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAg\nICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShDYWxlbmRhci5j\nbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChDYWxlbmRhci5jbGFzcywgImlzTGVuaWVudCIsIAogICAgICAgICAg\nICAgICAgYm9vbGVhbi5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZCh0eXBlLCAic2V0TGVuaWVudCIs\nIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IGJv\nb2xlYW4uY2xhc3MgfSk7CgogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShDYWxlbmRhci5jbGFzcyk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChDYWxl\nbmRhci5jbGFzcywgImdldEZpcnN0RGF5T2ZXZWVrIiwgCiAgICAgICAgICAg\nICAgICBpbnQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QodHlwZSwgInNldEZpcnN0RGF5T2ZXZWVr\nIiwgCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7\nIGludC5jbGFzcyB9KTsKCiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKENhbGVuZGFyLmNsYXNzKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKENhbGVu\nZGFyLmNsYXNzLCAKICAgICAgICAgICAgICAgICJnZXRNaW5pbWFsRGF5c0lu\nRmlyc3RXZWVrIiwgaW50LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29k\nZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHR5cGUsICJzZXRNaW5pbWFs\nRGF5c0luRmlyc3RXZWVrIiwgCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNz\nLCBuZXcgQ2xhc3NbXSB7IGludC5jbGFzcyB9KTsKCiAgICAgICAgICAgIGNv\nZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgw\nKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKENhbGVu\nZGFyLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKENhbGVuZGFyLmNsYXNzLCAiZ2V0VGltZVpvbmUiLCAKICAg\nICAgICAgICAgICAgIFRpbWVab25lLmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHR5cGUsICJzZXRU\naW1lWm9uZSIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xh\nc3NbXSB7IFRpbWVab25lLmNsYXNzIH0pOwogICAgICAgIH0KICAgICAgICBj\nb2RlLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAg\nICAgLy8gbmV3IGluc3RhbmNlIGZhY3RvcnkKICAgICAgICBtID0gYmMuZGVj\nbGFyZU1ldGhvZCgibmV3SW5zdGFuY2UiLCBQcm94eUNhbGVuZGFyLmNsYXNz\nLCBudWxsKTsgCiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgY29k\nZSA9IG0uZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmFuZXcoKS5zZXRU\neXBlKGJjKTsgCiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3Ms\nIG51bGwpOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwoKICAgICAgICAvLyBwcm94eSB0aGUgcHJvdGVjdGVkIGNv\nbXB1dGVGaWVsZHMgbWV0aG9kIGIvYyBpdCBpcyBjYWxsZWQgb24KICAgICAg\nICAvLyBtdXRhdGUsIGFuZCBzb21lIHNldHRlcnMgYXJlIGZpbmFsIGFuZCB0\naGVyZWZvcmUgbm90IHByb3h5YWJsZQogICAgICAgIG0gPSBiYy5kZWNsYXJl\nTWV0aG9kKCJjb21wdXRlRmllbGRzIiwgdm9pZC5jbGFzcywgbnVsbCk7CiAg\nICAgICAgbS5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgY29kZSA9IG0uZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwog\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAg\nICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChQcm94aWVzLmNsYXNz\nLCAiZGlydHkiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3Nb\nXSB7IFByb3h5LmNsYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKHR5cGUsICJjb21wdXRlRmllbGRzIiwgdm9pZC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1l\nbnQgdGhlIG1ldGhvZHMgaW4gdGhlIHtAbGluayBQcm94eUJlYW59IGludGVy\nZmFjZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFByb3h5QmVhbk1l\ndGhvZHMoQkNDbGFzcyBiYywgQ2xhc3MgdHlwZSwgQ29uc3RydWN0b3IgY29u\ncykgewogICAgICAgIC8vIGJlYW4gY29weQogICAgICAgIEJDTWV0aG9kIG0g\nPSBiYy5kZWNsYXJlTWV0aG9kKCJjb3B5IiwgT2JqZWN0LmNsYXNzLCAKICAg\nICAgICAgICAgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3MgfSk7CiAgICAg\nICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbS5nZXRD\nb2RlKHRydWUpOwoKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKHR5cGUp\nOwogICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXMg\nPSBjb25zLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgaWYgKHBhcmFt\ncy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShwYXJhbXNbMF0pOwogICAgICAgIH0KICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2QoY29ucyk7CiAgICAgICAgaWYgKHBhcmFtcy5s\nZW5ndGggPT0gMCkKICAgICAgICAgICAgY29weVByb3BlcnRpZXModHlwZSwg\nY29kZSk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CgogICAgICAgIC8vIG5ldyBpbnN0YW5jZSBmYWN0b3J5CiAg\nICAgICAgbSA9IGJjLmRlY2xhcmVNZXRob2QoIm5ld0luc3RhbmNlIiwgUHJv\neHlCZWFuLmNsYXNzLCAKICAgICAgICAgICAgbmV3IENsYXNzW10geyBPYmpl\nY3QuY2xhc3MgfSk7IAogICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAg\nIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5hbmV3KCku\nc2V0VHlwZShiYyk7IAogICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgaWYg\nKHBhcmFtcy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZShwYXJhbXNbMF0pOwogICAgICAgIH0KICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3Ms\nIHBhcmFtcyk7CiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT0gMCkKICAg\nICAgICAgICAgY29weVByb3BlcnRpZXModHlwZSwgY29kZSk7CiAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb3B5IGJlYW4gcHJvcGVydGllcy4gIENhbGxl\nZCB3aXRoIHRoZSBjb3B5IG9iamVjdCBvbiB0aGUgc3RhY2suICBNdXN0CiAg\nICAgKiByZXR1cm4gd2l0aCB0aGUgY29weSBvYmplY3Qgb24gdGhlIHN0YWNr\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY29weVByb3BlcnRpZXMoQ2xh\nc3MgdHlwZSwgQ29kZSBjb2RlKSB7CiAgICAgICAgaW50IGNvcHkgPSBjb2Rl\nLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCku\nc2V0TG9jYWwoY29weSk7CiAgICAgICAgCiAgICAgICAgTWV0aG9kW10gbWV0\naHMgPSB0eXBlLmdldE1ldGhvZHMoKTsKICAgICAgICBNZXRob2QgZ2V0dGVy\nOwogICAgICAgIGludCBtb2RzOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgbWV0aHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbW9kcyA9IG1l\ndGhzW2ldLmdldE1vZGlmaWVycygpOyAKICAgICAgICAgICAgaWYgKCFNb2Rp\nZmllci5pc1B1YmxpYyhtb2RzKSB8fCBNb2RpZmllci5pc1N0YXRpYyhtb2Rz\nKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAo\nIXN0YXJ0c1dpdGgobWV0aHNbaV0uZ2V0TmFtZSgpLCAic2V0IikKICAgICAg\nICAgICAgICAgIHx8IG1ldGhzW2ldLmdldFBhcmFtZXRlclR5cGVzKCkubGVu\nZ3RoICE9IDEpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgZ2V0dGVyID0gZmluZEdldHRlcih0eXBlLCBtZXRoc1tpXSk7CiAgICAg\nICAgICAgIGlmIChnZXR0ZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgLy8gY29weS5zZXRYWFgob3JpZy5nZXRY\nWFgoKSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChjb3B5\nKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChnZXR0ZXIp\nOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nbWV0aHNbaV0pOwogICAgICAgIH0KICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwoY29weSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm94eSByZWNv\nZ25pemVkIG1ldGhvZHMgdG8gaW52b2tlIGhlbHBlcnMgaW4gZ2l2ZW4gaGVs\ncGVyIGNsYXNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJveHlSZWNv\nZ25pemVkTWV0aG9kcyhCQ0NsYXNzIGJjLCBDbGFzcyB0eXBlLCBDbGFzcyBo\nZWxwZXIsCiAgICAgICAgQ2xhc3MgcHJveHlUeXBlKSB7CiAgICAgICAgTWV0\naG9kW10gbWV0aHMgPSB0eXBlLmdldE1ldGhvZHMoKTsKICAgICAgICBDbGFz\nc1tdIHBhcmFtczsKICAgICAgICBDbGFzc1tdIGFmdGVyUGFyYW1zOwogICAg\nICAgIE1ldGhvZCBtYXRjaDsKICAgICAgICBNZXRob2QgYWZ0ZXI7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtZXRocy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBwYXJhbXMgPSB0b0hlbHBlclBhcmFtZXRlcnMobWV0aHNb\naV0uZ2V0UGFyYW1ldGVyVHlwZXMoKSwgCiAgICAgICAgICAgICAgICBwcm94\neVR5cGUpOwoKICAgICAgICAgICAgLy8gZmlyc3QgY2hlY2sgZm9yIG92ZXJy\naWRpbmcgbWV0aG9kIAogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgbWF0Y2ggPSBoZWxwZXIuZ2V0TWV0aG9kKG1ldGhzW2ldLmdldE5hbWUo\nKSwgcGFyYW1zKTsgCiAgICAgICAgICAgICAgICBwcm94eU92ZXJyaWRlTWV0\naG9kKGJjLCBtZXRoc1tpXSwgbWF0Y2gsIHBhcmFtcyk7CiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBjYXRjaCAoTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIG5zbWUpIHsKICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBj\naGVjayBmb3IgYmVmb3JlIGFuZCBhZnRlciBtZXRob2RzLCBlaXRoZXIgb2Yg\nd2hpY2ggbWF5IG5vdAogICAgICAgICAgICAvLyBleGlzdAogICAgICAgICAg\nICBtYXRjaCA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBtYXRjaCA9IGhlbHBlci5nZXRNZXRob2QoImJlZm9yZSIgCiAgICAg\nICAgICAgICAgICAgICAgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKG1ldGhz\nW2ldLmdldE5hbWUoKSksIHBhcmFtcyk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBhZnRlciA9IG51bGw7CiAgICAgICAgICAgIGFmdGVyUGFyYW1zID0g\nbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGFmdGVy\nUGFyYW1zID0gdG9IZWxwZXJBZnRlclBhcmFtZXRlcnMocGFyYW1zLCAKICAg\nICAgICAgICAgICAgICAgICBtZXRoc1tpXS5nZXRSZXR1cm5UeXBlKCksICht\nYXRjaCA9PSBudWxsKSAKICAgICAgICAgICAgICAgICAgICA/IHZvaWQuY2xh\nc3MgOiBtYXRjaC5nZXRSZXR1cm5UeXBlKCkpOwogICAgICAgICAgICAgICAg\nYWZ0ZXIgPSBoZWxwZXIuZ2V0TWV0aG9kKCJhZnRlciIgCiAgICAgICAgICAg\nICAgICAgICAgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKG1ldGhzW2ldLmdl\ndE5hbWUoKSksIGFmdGVyUGFyYW1zKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIG5zbWUpIHsKICAgICAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChtYXRjaCAhPSBudWxsIHx8IGFmdGVyICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBwcm94eUJlZm9yZUFmdGVyTWV0aG9kKGJjLCB0eXBlLCBt\nZXRoc1tpXSwgbWF0Y2gsIHBhcmFtcywgYWZ0ZXIsCiAgICAgICAgICAgICAg\nICAgICAgYWZ0ZXJQYXJhbXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgcGFyYW1ldGVyIHR5cGVzIHRvIHRoZSBjb3Jy\nZXNwb25kaW5nIGhlbHBlciBjbGFzcyBtZXRob2QuCiAgICAgKi8gCiAgICBw\ncml2YXRlIHN0YXRpYyBDbGFzc1tdIHRvSGVscGVyUGFyYW1ldGVycyhDbGFz\nc1tdIGNscywgQ2xhc3MgaGVscGVyKSB7CiAgICAgICAgQ2xhc3NbXSBwYXJh\nbXMgPSBuZXcgQ2xhc3NbY2xzLmxlbmd0aCArIDFdOwogICAgICAgIHBhcmFt\nc1swXSA9IGhlbHBlcjsKICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGNscywg\nMCwgcGFyYW1zLCAxLCBjbHMubGVuZ3RoKTsgCiAgICAgICAgcmV0dXJuIHBh\ncmFtczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcGFyYW1l\ndGVyIHR5cGVzIHRvIHRoZSBjb3JyZXNwb25kaW5nIGhlbHBlciBjbGFzcyAi\nYWZ0ZXIiICAgICAKICAgICAqIG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgQ2xhc3NbXSB0b0hlbHBlckFmdGVyUGFyYW1ldGVycyhDbGFz\nc1tdIGNscywgQ2xhc3MgcmV0LAogICAgICAgIENsYXNzIGJlZm9yZVJldCkg\newogICAgICAgIGlmIChyZXQgPT0gdm9pZC5jbGFzcyAmJiBiZWZvcmVSZXQg\nPT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIGNsczsKICAgICAg\nICBpbnQgbGVuID0gY2xzLmxlbmd0aDsKICAgICAgICBpZiAocmV0ICE9IHZv\naWQuY2xhc3MpCiAgICAgICAgICAgIGxlbisrOwogICAgICAgIGlmIChiZWZv\ncmVSZXQgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgbGVuKys7CiAgICAg\nICAgQ2xhc3NbXSBwYXJhbXMgPSBuZXcgQ2xhc3NbbGVuXTsKICAgICAgICBT\neXN0ZW0uYXJyYXljb3B5KGNscywgMCwgcGFyYW1zLCAwLCBjbHMubGVuZ3Ro\nKTsKICAgICAgICBpbnQgcG9zID0gY2xzLmxlbmd0aDsKICAgICAgICBpZiAo\ncmV0ICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIHBhcmFtc1twb3MrK10g\nPSByZXQ7CiAgICAgICAgaWYgKGJlZm9yZVJldCAhPSB2b2lkLmNsYXNzKQog\nICAgICAgICAgICBwYXJhbXNbcG9zKytdID0gYmVmb3JlUmV0OwogICAgICAg\nIHJldHVybiBwYXJhbXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm94eSBz\nZXR0ZXIgbWV0aG9kcyBvZiB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqIAogICAg\nICogQHJldHVybiB0cnVlIGlmIHdlIGZpbmQgYW55IHNldHRlcnMsIGZhbHNl\nIG90aGVyd2lzZQogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gcHJveHlT\nZXR0ZXJzKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUpIHsKICAgICAgICBNZXRo\nb2RbXSBtZXRocyA9IHR5cGUuZ2V0TWV0aG9kcygpOwogICAgICAgIGludCBz\nZXR0ZXJzID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1ldGhz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpc1NldHRlcihtZXRo\nc1tpXSkgJiYgIU1vZGlmaWVyLmlzRmluYWwobWV0aHNbaV0uZ2V0TW9kaWZp\nZXJzKCkpCiAgICAgICAgICAgICAgICAmJiBiYy5nZXREZWNsYXJlZE1ldGhv\nZChtZXRoc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBtZXRoc1tp\nXS5nZXRQYXJhbWV0ZXJUeXBlcygpKSA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBzZXR0ZXJzKys7CiAgICAgICAgICAgICAgICBwcm94eVNldHRlcihi\nYywgdHlwZSwgbWV0aHNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfSAK\nICAgICAgICByZXR1cm4gc2V0dGVycyA+IDA7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQcm94eSB0aGUgZ2l2ZW4gbWV0aG9kIHdpdGggb25lIHRoYXQgb3Zl\ncnJpZGVzIGl0IGJ5IGNhbGxpbmcgaW50byB0aGUKICAgICAqIGdpdmVuIGhl\nbHBlci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByb3h5T3ZlcnJpZGVN\nZXRob2QoQkNDbGFzcyBiYywgTWV0aG9kIG1ldGgsIAogICAgICAgIE1ldGhv\nZCBoZWxwZXIsIENsYXNzW10gcGFyYW1zKSB7CiAgICAgICAgQkNNZXRob2Qg\nbSA9IGJjLmRlY2xhcmVNZXRob2QobWV0aC5nZXROYW1lKCksIG1ldGguZ2V0\nUmV0dXJuVHlwZSgpLAogICAgICAgICAgICBtZXRoLmdldFBhcmFtZXRlclR5\ncGVzKCkpOwogICAgICAgIG0ubWFrZVB1YmxpYygpOwogICAgICAgIENvZGUg\nY29kZSA9IG0uZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFRoaXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IHBhcmFt\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgY29kZS54bG9hZCgpLnNldFBh\ncmFtKGkgLSAxKS5zZXRUeXBlKHBhcmFtc1tpXSk7CiAgICAgICAgY29kZS5p\nbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoaGVscGVyKTsKICAgICAgICBjb2Rl\nLnhyZXR1cm4oKS5zZXRUeXBlKG1ldGguZ2V0UmV0dXJuVHlwZSgpKTsKCiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\ncm94eSB0aGUgZ2l2ZW4gbWV0aG9kIHdpdGggb25lIHRoYXQgb3ZlcnJpZGVz\nIGl0IGJ5IGNhbGxpbmcgaW50byB0aGUKICAgICAqIGdpdmVuIGhlbHBlci4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByb3h5QmVmb3JlQWZ0ZXJNZXRo\nb2QoQkNDbGFzcyBiYywgQ2xhc3MgdHlwZSwgTWV0aG9kIG1ldGgsIAogICAg\nICAgIE1ldGhvZCBiZWZvcmUsIENsYXNzW10gcGFyYW1zLCBNZXRob2QgYWZ0\nZXIsIENsYXNzW10gYWZ0ZXJQYXJhbXMpIHsKICAgICAgICBCQ01ldGhvZCBt\nID0gYmMuZGVjbGFyZU1ldGhvZChtZXRoLmdldE5hbWUoKSwgbWV0aC5nZXRS\nZXR1cm5UeXBlKCksCiAgICAgICAgICAgIG1ldGguZ2V0UGFyYW1ldGVyVHlw\nZXMoKSk7CiAgICAgICAgbS5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBj\nb2RlID0gbS5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBpbnZva2UgYmVm\nb3JlCiAgICAgICAgaW50IGJlZm9yZVJldCA9IC0xOwogICAgICAgIGlmIChi\nZWZvcmUgIT0gbnVsbCkgewogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nVGhpcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IHBhcmFt\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNvZGUueGxvYWQoKS5z\nZXRQYXJhbShpIC0gMSkuc2V0VHlwZShwYXJhbXNbaV0pOwogICAgICAgICAg\nICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChiZWZvcmUpOwogICAg\nICAgICAgICBpZiAoYWZ0ZXIgIT0gbnVsbCAmJiBiZWZvcmUuZ2V0UmV0dXJu\nVHlwZSgpICE9IHZvaWQuY2xhc3MpIHsKICAgICAgICAgICAgICAgIGJlZm9y\nZVJldCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAg\nICAgICBjb2RlLnhzdG9yZSgpLnNldExvY2FsKGJlZm9yZVJldCkuCiAgICAg\nICAgICAgICAgICAgICAgc2V0VHlwZShiZWZvcmUuZ2V0UmV0dXJuVHlwZSgp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaW52b2tl\nIHN1cGVyCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAg\nICBmb3IgKGludCBpID0gMTsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGkgLSAxKS5zZXRUeXBl\nKHBhcmFtc1tpXSk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0\nTWV0aG9kKHR5cGUsIG1ldGguZ2V0TmFtZSgpLCAKICAgICAgICAgICAgbWV0\naC5nZXRSZXR1cm5UeXBlKCksIG1ldGguZ2V0UGFyYW1ldGVyVHlwZXMoKSk7\nCgogICAgICAgIC8vIGludm9rZSBhZnRlciAKICAgICAgICBpZiAoYWZ0ZXIg\nIT0gbnVsbCkgewogICAgICAgICAgICBpbnQgcmV0ID0gLTE7CiAgICAgICAg\nICAgIGlmIChtZXRoLmdldFJldHVyblR5cGUoKSAhPSB2b2lkLmNsYXNzKSB7\nCiAgICAgICAgICAgICAgICByZXQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRl\neCgpOwogICAgICAgICAgICAgICAgY29kZS54c3RvcmUoKS5zZXRMb2NhbChy\nZXQpLnNldFR5cGUobWV0aC5nZXRSZXR1cm5UeXBlKCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAxOyBpIDwgcGFyYW1zLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGkgLSAx\nKS5zZXRUeXBlKHBhcmFtc1tpXSk7CiAgICAgICAgICAgIGlmIChyZXQgIT0g\nLTEpCiAgICAgICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0TG9jYWwocmV0\nKS5zZXRUeXBlKG1ldGguZ2V0UmV0dXJuVHlwZSgpKTsKICAgICAgICAgICAg\naWYgKGJlZm9yZVJldCAhPSAtMSkKICAgICAgICAgICAgICAgIGNvZGUueGxv\nYWQoKS5zZXRMb2NhbChiZWZvcmVSZXQpLgogICAgICAgICAgICAgICAgICAg\nIHNldFR5cGUoYmVmb3JlLmdldFJldHVyblR5cGUoKSk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKGFmdGVyKTsKICAgICAg\nICB9CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShtZXRoLmdldFJl\ndHVyblR5cGUoKSk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIG1ldGhv\nZCBpcyBhIHNldHRlci4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4g\naXNTZXR0ZXIoTWV0aG9kIG1ldGgpIHsKICAgICAgICByZXR1cm4gc3RhcnRz\nV2l0aChtZXRoLmdldE5hbWUoKSwgInNldCIpCiAgICAgICAgICAgIHx8IHN0\nYXJ0c1dpdGgobWV0aC5nZXROYW1lKCksICJhZGQiKQogICAgICAgICAgICB8\nfCBzdGFydHNXaXRoKG1ldGguZ2V0TmFtZSgpLCAicmVtb3ZlIikKICAgICAg\nICAgICAgfHwgc3RhcnRzV2l0aChtZXRoLmdldE5hbWUoKSwgImluc2VydCIp\nCiAgICAgICAgICAgIHx8IHN0YXJ0c1dpdGgobWV0aC5nZXROYW1lKCksICJj\nbGVhciIpCiAgICAgICAgICAgIHx8IHN0YXJ0c1dpdGgobWV0aC5nZXROYW1l\nKCksICJyb2xsIik7IC8vIHVzZWQgYnkgQ2FsZW5kYXIKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgZ2V0dGVyIGNvcnJlc3BvbmRpbmcgdG8g\ndGhlIGdpdmVuIHNldHRlciwgb3IgbnVsbC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIE1ldGhvZCBmaW5kR2V0dGVyKENsYXNzIHR5cGUsIE1ldGhvZCBzZXR0\nZXIpIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IHNldHRlci5nZXROYW1lKCku\nc3Vic3RyaW5nKDMpOwogICAgICAgIENsYXNzIHBhcmFtID0gc2V0dGVyLmdl\ndFBhcmFtZXRlclR5cGVzKClbMF07CiAgICAgICAgTWV0aG9kIGdldHRlcjsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBnZXR0ZXIgPSB0eXBlLmdldE1l\ndGhvZCgiZ2V0IiArIG5hbWUsIChDbGFzc1tdKSBudWxsKTsgICAKICAgICAg\nICAgICAgaWYgKGdldHRlci5nZXRSZXR1cm5UeXBlKCkuaXNBc3NpZ25hYmxl\nRnJvbShwYXJhbSkKICAgICAgICAgICAgICAgIHx8IHBhcmFtLmlzQXNzaWdu\nYWJsZUZyb20oZ2V0dGVyLmdldFJldHVyblR5cGUoKSkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0dGVyOwogICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24oZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocGFyYW0gPT0gYm9vbGVh\nbi5jbGFzcyB8fCBwYXJhbSA9PSBCb29sZWFuLmNsYXNzKSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBnZXR0ZXIgPSB0eXBlLmdldE1l\ndGhvZCgiaXMiICsgbmFtZSwgKENsYXNzW10pIG51bGwpOyAgIAogICAgICAg\nICAgICAgICAgaWYgKGdldHRlci5nZXRSZXR1cm5UeXBlKCkuaXNBc3NpZ25h\nYmxlRnJvbShwYXJhbSkKICAgICAgICAgICAgICAgICAgICB8fCBwYXJhbS5p\nc0Fzc2lnbmFibGVGcm9tKGdldHRlci5nZXRSZXR1cm5UeXBlKCkpKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBnZXR0ZXI7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSB0YXJnZXQgc3RyaW5nIHN0YXJz\nIHdpdGggdGhlIGdpdmVuIHRva2VuLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBib29sZWFuIHN0YXJ0c1dpdGgoU3RyaW5nIHN0ciwgU3RyaW5nIHRv\na2VuKSB7CiAgICAgICAgcmV0dXJuIHN0ci5zdGFydHNXaXRoKHRva2VuKQog\nICAgICAgICAgICAmJiAoc3RyLmxlbmd0aCgpID09IHRva2VuLmxlbmd0aCgp\nIAogICAgICAgICAgICB8fCBDaGFyYWN0ZXIuaXNVcHBlckNhc2Uoc3RyLmNo\nYXJBdCh0b2tlbi5sZW5ndGgoKSkpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFByb3h5IHRoZSBnaXZlbiBzZXR0ZXIgbWV0aG9kIHRvIGRpcnR5IHRoZSBw\ncm94eSBvd25lci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByb3h5U2V0\ndGVyKEJDQ2xhc3MgYmMsIENsYXNzIHR5cGUsIE1ldGhvZCBtZXRoKSB7CiAg\nICAgICAgQ2xhc3NbXSBwYXJhbXMgPSBtZXRoLmdldFBhcmFtZXRlclR5cGVz\nKCk7CiAgICAgICAgQ2xhc3MgcmV0ID0gbWV0aC5nZXRSZXR1cm5UeXBlKCk7\nCiAgICAgICAgQkNNZXRob2QgbSA9IGJjLmRlY2xhcmVNZXRob2QobWV0aC5n\nZXROYW1lKCksIHJldCwgcGFyYW1zKTsKICAgICAgICBtLm1ha2VQdWJsaWMo\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtLmdldENvZGUodHJ1ZSk7CiAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QoUHJveGllcy5jbGFzcywgImRpcnR5Iiwgdm9pZC5j\nbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW10geyBQcm94eS5jbGFzcywg\nYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhp\ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFyYW1zLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oaSku\nc2V0VHlwZShwYXJhbXNbaV0pOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZCh0eXBlLCBtZXRoLmdldE5hbWUoKSwgcmV0LCBwYXJh\nbXMpOwogICAgICAgIGNvZGUueHJldHVybigpLnNldFR5cGUocmV0KTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCBhIHdyaXRlUmVwbGFjZSBpbXBsZW1lbnRhdGlvbiB0aGF0IHNlcmlhbGl6\nZXMgdG8gYSBub24tcHJveHkgdHlwZQogICAgICogdW5sZXNzIGRldGFjaGVk\nIGFuZCB0aGlzIGlzIGEgYnVpbGQtdGltZSBnZW5lcmF0ZWQgY2xhc3MuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRXcml0ZVJlcGxhY2VNZXRob2Qo\nQkNDbGFzcyBiYywgYm9vbGVhbiBydW50aW1lKSB7CiAgICAgICAgQkNNZXRo\nb2QgbSA9IGJjLmRlY2xhcmVNZXRob2QoIndyaXRlUmVwbGFjZSIsIE9iamVj\ndC5jbGFzcywgbnVsbCk7CiAgICAgICAgbS5tYWtlUHJvdGVjdGVkKCk7CiAg\nICAgICAgbS5nZXRFeGNlcHRpb25zKHRydWUpLmFkZEV4Y2VwdGlvbihPYmpl\nY3RTdHJlYW1FeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENvZGUgY29kZSA9\nIG0uZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhp\ncygpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSghcnVudGlt\nZSk7CiAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUHJv\neGllcy5jbGFzcywgIndyaXRlUmVwbGFjZSIsIAogICAgICAgICAgICBPYmpl\nY3QuY2xhc3MsIG5ldyBDbGFzc1tdIHsgUHJveHkuY2xhc3MsIGJvb2xlYW4u\nY2xhc3MgfSk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSB1\nbmlxdWUgaWQgdG8gYXZvaWQgcHJveHkgY2xhc3MgbmFtZSBjb25mbGljdHMu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHN5bmNocm9uaXplZCBsb25n\nIG5leHRQcm94eUlkKCkgewogICAgICAgIHJldHVybiBfcHJveHlJZCsrOwog\nICAgfQoKICAgIC8qKgogICAgICogRmluZCBhbiBhcHByb3ByaWF0ZSBjb3B5\nIGNvbnN0cnVjdG9yIGZvciB0aGUgZ2l2ZW4gdHlwZSwgb3IgcmV0dXJuIG51\nbGwKICAgICAqIGlmIG5vbmUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDb25z\ndHJ1Y3RvciBmaW5kQ29weUNvbnN0cnVjdG9yKENsYXNzIGNscykgewogICAg\nICAgIENvbnN0cnVjdG9yW10gY29ucyA9IGNscy5nZXRDb25zdHJ1Y3RvcnMo\nKTsKICAgICAgICBDb25zdHJ1Y3RvciBtYXRjaCA9IG51bGw7CiAgICAgICAg\nQ2xhc3MgbWF0Y2hQYXJhbSA9IG51bGw7CiAgICAgICAgQ2xhc3NbXSBwYXJh\nbXM7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb25zLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIHBhcmFtcyA9IGNvbnNbaV0uZ2V0UGFyYW1l\ndGVyVHlwZXMoKTsKICAgICAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggIT0g\nMSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8g\ncXVpdCBpbW1lZGlhdGVseSBvbiBleGFjdCBtYXRjaAogICAgICAgICAgICBp\nZiAocGFyYW1zWzBdID09IGNscykKICAgICAgICAgICAgICAgIHJldHVybiBj\nb25zW2ldOwoKICAgICAgICAgICAgaWYgKHBhcmFtc1swXS5pc0Fzc2lnbmFi\nbGVGcm9tKGNscykgJiYgKG1hdGNoUGFyYW0gPT0gbnVsbAogICAgICAgICAg\nICAgICAgfHwgbWF0Y2hQYXJhbS5pc0Fzc2lnbmFibGVGcm9tKHBhcmFtc1sw\nXSkpKSB7CiAgICAgICAgICAgICAgICAgLy8gdHJhY2sgbW9zdCBkZXJpdmVk\nIGNvbGxlY3Rpb24gY29uc3RydWN0b3IKICAgICAgICAgICAgICAgIG1hdGNo\nID0gY29uc1tpXTsKICAgICAgICAgICAgICAgIG1hdGNoUGFyYW0gPSBwYXJh\nbXNbMF07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIG1hdGNoOyAKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29u\nc3RydWN0b3IgdGhhdCB0YWtlcyBhIGNvbXBhcmF0b3IgZm9yIHRoZSBnaXZl\nbiB0eXBlLCBvcgogICAgICogbnVsbCBpZiBub25lLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBDb25zdHJ1Y3RvciBmaW5kQ29tcGFyYXRvckNvbnN0\ncnVjdG9yKENsYXNzIGNscykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJldHVybiBjbHMuZ2V0Q29uc3RydWN0b3IobmV3IENsYXNzW10geyBDb21w\nYXJhdG9yLmNsYXNzIH0pOwogICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFVzYWdlOiBqYXZhIG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLnByb3h5LlByb3h5TWFuYWdlckltcGwgW29wdGlvbl0qCiAgICAg\nKiAmbHQ7Y2xhc3MgbmFtZSZndDsrPGJyIC8+CiAgICAgKiBXaGVyZSB0aGUg\nZm9sbG93aW5nIG9wdGlvbnMgYXJlIHJlY29nbml6ZWQ6CiAgICAgKiA8dWw+\nIAogICAgICogPGxpPjxpPi11dGlscy8tdSAmbHQ7bnVtYmVyJmd0OzwvaT46\nIEdlbmVyYXRlIHByb3hpZXMgZm9yIHRoZSBzdGFuZGFyZAogICAgICogamF2\nYS51dGlsIGNvbGxlY3Rpb24sIG1hcCwgZGF0ZSwgYW5kIGNhbGVuZGFyIGNs\nYXNzZXMgb2YgdGhlIGdpdmVuIEphdmEKICAgICAqIHZlcnNpb24uICBVc2Ug\nNCBmb3IgSmF2YSAxLjQsIDUgZm9yIEphdmEgNSwgZXRjLjwvbGk+CiAgICAg\nKiA8L3VsPgogICAgICoKICAgICAqIFRoZSBtYWluIG1ldGhvZCBnZW5lcmF0\nZXMgLmNsYXNzIGZpbGVzIGZvciB0aGUgcHJveGllcyB0byB0aGUgY2xhc3Nl\ncyAgICAKICAgICAqIGdpdmVuIG9uIHRoZSBjb21tYW5kIGxpbmUuICBJdCB3\ncml0ZXMgdGhlIGdlbmVyYXRlZCBjbGFzc2VzIHRvIGJlc2lkZSB0aGUKICAg\nICAqIFByb3h5TWFuYWdlckltcGwuY2xhc3MgZmlsZSBpZiBwb3NzaWJsZTsg\nb3RoZXJ3aXNlIGl0IHdyaXRlcyB0byB0aGUgCiAgICAgKiBjdXJyZW50IGRp\ncmVjdG9yeS4gIFRoZSBwcm94eSBtYW5hZ2VyIGxvb2tzIGZvciB0aGVzZSBj\nbGFzc2VzIAogICAgICogYmVmb3JlIGdlbmVyYXRpbmcgaXRzIG93biBwcm94\naWVzIGF0IHJ1bnRpbWUuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9p\nZCBtYWluKFN0cmluZ1tdIGFyZ3MpIAogICAgICAgIHRocm93cyBDbGFzc05v\ndEZvdW5kRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBk\naXIgPSBGaWxlcy5nZXRDbGFzc0ZpbGUoUHJveHlNYW5hZ2VySW1wbC5jbGFz\ncyk7CiAgICAgICAgZGlyID0gKGRpciA9PSBudWxsKSA/IG5ldyBGaWxlKChT\ndHJpbmcpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5nZXRQcm9wZXJ0eUFjdGlvbigidXNlci5k\naXIiKSkpCiAgICAgICAgICAgIDogZGlyLmdldFBhcmVudEZpbGUoKTsKCiAg\nICAgICAgT3B0aW9ucyBvcHRzID0gbmV3IE9wdGlvbnMoKTsKICAgICAgICBh\ncmdzID0gb3B0cy5zZXRGcm9tQ21kTGluZShhcmdzKTsKCiAgICAgICAgTGlz\ndCB0eXBlcyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICB0eXBlcy5hZGRB\nbGwoQXJyYXlzLmFzTGlzdChhcmdzKSk7CiAgICAgICAgaW50IHV0aWxzID0g\nb3B0cy5yZW1vdmVJbnRQcm9wZXJ0eSgidXRpbHMiLCAidSIsIDApOwogICAg\nICAgIGlmICh1dGlscyA+PSA0KSB7CiAgICAgICAgICAgIHR5cGVzLmFkZEFs\nbChBcnJheXMuYXNMaXN0KG5ldyBTdHJpbmdbXSB7CiAgICAgICAgICAgICAg\nICBqYXZhLnNxbC5EYXRlLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAg\nICAgIGphdmEuc3FsLlRpbWUuY2xhc3MuZ2V0TmFtZSgpLAogICAgICAgICAg\nICAgICAgamF2YS5zcWwuVGltZXN0YW1wLmNsYXNzLmdldE5hbWUoKSwKICAg\nICAgICAgICAgICAgIGphdmEudXRpbC5BcnJheUxpc3QuY2xhc3MuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgamF2YS51dGlsLkRhdGUuY2xhc3MuZ2V0\nTmFtZSgpLAogICAgICAgICAgICAgICAgamF2YS51dGlsLkdyZWdvcmlhbkNh\nbGVuZGFyLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGphdmEu\ndXRpbC5IYXNoTWFwLmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAgICAgICAg\nIGphdmEudXRpbC5IYXNoU2V0LmNsYXNzLmdldE5hbWUoKSwKICAgICAgICAg\nICAgICAgIGphdmEudXRpbC5IYXNodGFibGUuY2xhc3MuZ2V0TmFtZSgpLAog\nICAgICAgICAgICAgICAgamF2YS51dGlsLkxpbmtlZExpc3QuY2xhc3MuZ2V0\nTmFtZSgpLAogICAgICAgICAgICAgICAgamF2YS51dGlsLlByb3BlcnRpZXMu\nY2xhc3MuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgamF2YS51dGlsLlRy\nZWVNYXAuY2xhc3MuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgamF2YS51\ndGlsLlRyZWVTZXQuY2xhc3MuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAg\namF2YS51dGlsLlZlY3Rvci5jbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAg\nIH0pKTsgCiAgICAgICAgfQogICAgICAgIGlmICh1dGlscyA+PSA1KSB7CiAg\nICAgICAgICAgIHR5cGVzLmFkZEFsbChBcnJheXMuYXNMaXN0KG5ldyBTdHJp\nbmdbXSB7CiAgICAgICAgICAgICAgICAiamF2YS51dGlsLkVudW1NYXAiLAog\nICAgICAgICAgICAgICAgImphdmEudXRpbC5JZGVudGl0eUhhc2hNYXAiLAog\nICAgICAgICAgICAgICAgImphdmEudXRpbC5MaW5rZWRIYXNoTWFwIiwKICAg\nICAgICAgICAgICAgICJqYXZhLnV0aWwuTGlua2VkSGFzaFNldCIsCiAgICAg\nICAgICAgICAgICAiamF2YS51dGlsLlByaW9yaXR5UXVldWUiLAogICAgICAg\nICAgICB9KSk7IAogICAgICAgIH0KCiAgICAgICAgZmluYWwgUHJveHlNYW5h\nZ2VySW1wbCBtZ3IgPSBuZXcgUHJveHlNYW5hZ2VySW1wbCgpOwogICAgICAg\nIENsYXNzIGNsczsKICAgICAgICBCQ0NsYXNzIGJjOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgdHlwZXMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAg\nICAgY2xzID0gQ2xhc3MuZm9yTmFtZSgoU3RyaW5nKSB0eXBlcy5nZXQoaSkp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKENsYXNz\nLmZvck5hbWUoZ2V0UHJveHlDbGFzc05hbWUoY2xzLCBmYWxzZSksIHRydWUs\nCiAgICAgICAgICAgICAgICAgICAgR2VuZXJhdGVkQ2xhc3Nlcy5nZXRNb3N0\nRGVyaXZlZExvYWRlcihjbHMsIFByb3h5LmNsYXNzKSkKICAgICAgICAgICAg\nICAgICAgICAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAg\nICAgICAgICAgLy8gZXhwZWN0ZWQgaWYgdGhlIGNsYXNzIGhhc24ndCBiZWVu\nIGdlbmVyYXRlZAogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoQ29s\nbGVjdGlvbi5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGNscykpCiAgICAgICAg\nICAgICAgICBiYyA9IG1nci5nZW5lcmF0ZVByb3h5Q29sbGVjdGlvbkJ5dGVj\nb2RlKGNscywgZmFsc2UpOyAgICAgICAgIAogICAgICAgICAgICBlbHNlIGlm\nIChNYXAuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQogICAgICAgICAg\nICAgICAgYmMgPSBtZ3IuZ2VuZXJhdGVQcm94eU1hcEJ5dGVjb2RlKGNscywg\nZmFsc2UpOyAgICAgICAgIAogICAgICAgICAgICBlbHNlIGlmIChEYXRlLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkKICAgICAgICAgICAgICAgIGJj\nID0gbWdyLmdlbmVyYXRlUHJveHlEYXRlQnl0ZWNvZGUoY2xzLCBmYWxzZSk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKENhbGVuZGFyLmNsYXNzLmlzQXNzaWdu\nYWJsZUZyb20oY2xzKSkKICAgICAgICAgICAgICAgIGJjID0gbWdyLmdlbmVy\nYXRlUHJveHlDYWxlbmRhckJ5dGVjb2RlKGNscywgZmFsc2UpOwogICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGZpbmFsIENsYXNzIGZDbHMg\nPSBjbHM7CiAgICAgICAgICAgICAgICBiYyA9IChCQ0NsYXNzKSBBY2Nlc3ND\nb250cm9sbGVyCiAgICAgICAgICAgICAgICAgICAgLmRvUHJpdmlsZWdlZChu\nZXcgUHJpdmlsZWdlZEFjdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgcHVibGljIE9iamVjdCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbWdyLmdlbmVyYXRlUHJveHlCZWFuQnl0ZWNvZGUo\nZkNscywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIFN5c3RlbS5vdXQucHJpbnRsbihiYy5nZXROYW1lKCkpOwogICAgICAgICAg\nICBiYy53cml0ZShuZXcgRmlsZShkaXIsIGJjLmdldENsYXNzTmFtZSgpICsg\nIi5jbGFzcyIpKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

