{"sha":"d0365e201ff16c07458ef23a353c3a4d011ab39a","node_id":"MDQ6QmxvYjIwNjM2NDpkMDM2NWUyMDFmZjE2YzA3NDU4ZWYyM2EzNTNjM2E0ZDAxMWFiMzlh","size":11993,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d0365e201ff16c07458ef23a353c3a4d011ab39a","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLg0KICovDQpwYWNrYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhh\nbmNlOw0KDQppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsNCmltcG9ydCBq\nYXZhLnV0aWwuQXJyYXlMaXN0Ow0KaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0\naW9uOw0KaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsNCmltcG9ydCBq\nYXZhLnV0aWwuSGFzaE1hcDsNCmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsN\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7DQppbXBvcnQgamF2YS51dGls\nLkxpc3Q7DQppbXBvcnQgamF2YS51dGlsLk1hcDsNCmltcG9ydCBqYXZhLnV0\naWwuU2V0Ow0KDQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3Bl\nbkpQQUNvbmZpZ3VyYXRpb247DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5sb2cuTG9nOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5CeXRlY29kZVdyaXRlcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuSmF2YVZlcnNpb25zOw0KaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7DQppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdlOw0KaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7DQppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsNCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7DQppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJhdGVkQ2xhc3NlczsN\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOw0K\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0\naW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNl\ncHRpb247DQppbXBvcnQgc2VycC5ieXRlY29kZS5CQ0NsYXNzOw0KDQovKioN\nCiAqIFJlZGVmaW5lcyB0aGUgbWV0aG9kIGJvZGllcyBvZiBleGlzdGluZyB1\nbmVuaGFuY2VkIGNsYXNzZXMgdG8gbWFrZSB0aGVtDQogKiBub3RpZnkgc3Rh\ndGUgbWFuYWdlcnMgb2YgbXV0YXRpb25zLg0KICoNCiAqIEBzaW5jZSAxLjAu\nMA0KICovDQpwdWJsaWMgY2xhc3MgTWFuYWdlZENsYXNzU3ViY2xhc3NlciB7\nDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZSgNCiAgICAgICAgTWFuYWdlZENsYXNzU3Vi\nY2xhc3Nlci5jbGFzcyk7DQoNCiAgICAvKioNCiAgICAgKiBGb3IgZWFjaCBl\nbGVtZW50IGluIDxjb2RlPmNsYXNzZXM8L2NvZGU+LCBjcmVhdGVzIGFuZCBy\nZWdpc3RlcnMgYQ0KICAgICAqIG5ldyBzdWJjbGFzcyB0aGF0IGltcGxlbWVu\ndHMge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZX0sIGFuZCBwcmVwYXJlcw0K\nICAgICAqIE9wZW5KUEEgdG8gaGFuZGxlIG5ldyBpbnN0YW5jZXMgb2YgdGhl\nIHVuZW5oYW5jZWQgdHlwZS4gSWYgdGhpcyBpcw0KICAgICAqIGludm9rZWQg\naW4gYSBKYXZhIDYgZW52aXJvbm1lbnQsIHRoaXMgbWV0aG9kIHdpbGwgcmVk\nZWZpbmUgdGhlIG1ldGhvZHMNCiAgICAgKiBmb3IgZWFjaCBjbGFzcyBpbiB0\naGUgYXJndW1lbnQgbGlzdCBzdWNoIHRoYXQgZmllbGQgYWNjZXNzZXMgYXJl\nDQogICAgICogaW50ZXJjZXB0ZWQgaW4tbGluZS4gSWYgaW52b2tlZCBpbiBh\nIEphdmEgNSBlbnZpcm9ubWVudCwgdGhpcw0KICAgICAqIHJlZGVmaW5pdGlv\nbiBpcyBub3QgcG9zc2libGU7IGluIHRoZXNlIGNvbnRleHRzLCB3aGVuIHVz\naW5nIGZpZWxkDQogICAgICogYWNjZXNzLCBPcGVuSlBBIHdpbGwgbmVlZCB0\nbyBkbyBzdGF0ZSBjb21wYXJpc29ucyB0byBkZXRlY3QgYW55IGNoYW5nZQ0K\nICAgICAqIHRvIGFueSBpbnN0YW5jZSBhdCBhbnkgdGltZSwgYW5kIHdoZW4g\ndXNpbmcgcHJvcGVydHkgYWNjZXNzLCBPcGVuSlBBDQogICAgICogd2lsbCBu\nZWVkIHRvIGRvIHN0YXRlIGNvbXBhcmlzb25zIHRvIGRldGVjdCBjaGFuZ2Vz\nIHRvIG5ld2x5IGluc2VydGVkDQogICAgICogaW5zdGFuY2VzIGFmdGVyIGEg\nZmx1c2ggaGFzIGJlZW4gY2FsbGVkLg0KICAgICAqDQogICAgICogQHJldHVy\nbiB0aGUgbmV3IHN1YmNsYXNzZXMsIG9yIDxjb2RlPm51bGw8L2NvZGU+IGlm\nIDxjb2RlPmNsYXNzZXM8L2NvZGU+DQogICAgICogaXMgPGNvZGU+bnVsbDwv\nY29kZT4uDQogICAgICogQHRocm93cyBVc2VyRXhjZXB0aW9uIGlmIDxjb2Rl\nPmNvbmY8L2NvZGU+IHJlcXVpcmVzIGJ1aWxkLXRpbWUNCiAgICAgKiBlbmhh\nbmNlbWVudCBhbmQgPGNvZGU+Y2xhc3NlczwvY29kZT4gaW5jbHVkZXMgdW5l\nbmhhbmNlZCB0eXBlcy4NCiAgICAgKg0KICAgICAqIEBzaW5jZSAxLjAuMA0K\nICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxDbGFzcz4gcHJlcGFy\nZVVuZW5oYW5jZWRDbGFzc2VzKA0KICAgICAgICBmaW5hbCBPcGVuSlBBQ29u\nZmlndXJhdGlvbiBjb25mLA0KICAgICAgICBmaW5hbCBDb2xsZWN0aW9uPD8g\nZXh0ZW5kcyBDbGFzcz4gY2xhc3NlcywNCiAgICAgICAgZmluYWwgQ2xhc3NM\nb2FkZXIgZW52TG9hZGVyKSB7DQogICAgICAgIGlmIChjbGFzc2VzID09IG51\nbGwpDQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgaWYgKGNs\nYXNzZXMuc2l6ZSgpID09IDApDQogICAgICAgICAgICByZXR1cm4gQ29sbGVj\ndGlvbnMuRU1QVFlfTElTVDsNCg0KICAgICAgICBMb2cgbG9nID0gY29uZi5n\nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0UpOw0KICAg\nICAgICBpZiAoY29uZi5nZXRSdW50aW1lVW5lbmhhbmNlZENsYXNzZXNDb25z\ndGFudCgpDQogICAgICAgICAgICAhPSBSdW50aW1lVW5lbmhhbmNlZENsYXNz\nc2VzTW9kZXMuU1VQUE9SVEVEKSB7DQogICAgICAgICAgICBDb2xsZWN0aW9u\nIHVuZW5oYW5jZWQgPSBuZXcgQXJyYXlMaXN0KCk7DQogICAgICAgICAgICBm\nb3IgKENsYXNzIGNscyA6IGNsYXNzZXMpDQogICAgICAgICAgICAgICAgaWYg\nKCFQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShj\nbHMpKQ0KICAgICAgICAgICAgICAgICAgICB1bmVuaGFuY2VkLmFkZChjbHMp\nOw0KICAgICAgICAgICAgaWYgKHVuZW5oYW5jZWQuc2l6ZSgpID4gMCkgew0K\nICAgICAgICAgICAgICAgIE1lc3NhZ2UgbXNnID0gX2xvYy5nZXQoInJ1bnRp\nbWUtb3B0aW1pemF0aW9uLWRpc2FibGVkIiwNCiAgICAgICAgICAgICAgICAg\nICAgdW5lbmhhbmNlZCk7DQogICAgICAgICAgICAgICAgaWYgKGNvbmYuZ2V0\nUnVudGltZVVuZW5oYW5jZWRDbGFzc2VzQ29uc3RhbnQoKQ0KICAgICAgICAg\nICAgICAgICAgICA9PSBSdW50aW1lVW5lbmhhbmNlZENsYXNzc2VzTW9kZXMu\nV0FSTikNCiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4obXNnKTsNCiAg\nICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKG1zZyk7DQogICAgICAgICAgICB9DQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIGJv\nb2xlYW4gcmVkZWZpbmUgPSBDbGFzc1JlZGVmaW5lci5jYW5SZWRlZmluZUNs\nYXNzZXMoKTsNCiAgICAgICAgaWYgKHJlZGVmaW5lKQ0KICAgICAgICAgICAg\nbG9nLmluZm8oX2xvYy5nZXQoImVuaGFuY2UtYW5kLXN1YmNsYXNzLWFuZC1y\nZWRlZi1zdGFydCIsDQogICAgICAgICAgICAgICAgY2xhc3NlcykpOw0KICAg\nICAgICBlbHNlDQogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgiZW5o\nYW5jZS1hbmQtc3ViY2xhc3Mtbm8tcmVkZWYtc3RhcnQiLA0KICAgICAgICAg\nICAgICAgIGNsYXNzZXMpKTsNCg0KICAgICAgICBmaW5hbCBNYXA8Q2xhc3Ms\nIGJ5dGVbXT4gbWFwID0gbmV3IEhhc2hNYXA8Q2xhc3MsIGJ5dGVbXT4oKTsN\nCiAgICAgICAgZmluYWwgTGlzdCBzdWJzID0gbmV3IEFycmF5TGlzdChjbGFz\nc2VzLnNpemUoKSk7DQogICAgICAgIGZpbmFsIExpc3QgaW50cyA9IG5ldyBB\ncnJheUxpc3QoY2xhc3Nlcy5zaXplKCkpOw0KICAgICAgICBTZXQ8Q2xhc3M+\nIHVuc3BlY2lmaWVkID0gbnVsbDsNCiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndGVyID0gY2xhc3Nlcy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsgKSB7\nDQogICAgICAgICAgICBmaW5hbCBDbGFzcyBjbHMgPSAoQ2xhc3MpIGl0ZXIu\nbmV4dCgpOw0KICAgICAgICAgICAgZmluYWwgUENFbmhhbmNlciBlbmhhbmNl\nciA9IG5ldyBQQ0VuaGFuY2VyKGNvbmYsIGNscyk7DQoNCiAgICAgICAgICAg\nIGVuaGFuY2VyLnNldEJ5dGVjb2RlV3JpdGVyKG5ldyBCeXRlY29kZVdyaXRl\ncigpIHsNCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCB3cml0ZShCQ0Ns\nYXNzIGJjKSB0aHJvd3MgSU9FeGNlcHRpb24gew0KICAgICAgICAgICAgICAg\nICAgICBNYW5hZ2VkQ2xhc3NTdWJjbGFzc2VyLndyaXRlKGJjLCBlbmhhbmNl\nciwgbWFwLA0KICAgICAgICAgICAgICAgICAgICAgICAgY2xzLCBzdWJzLCBp\nbnRzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAg\nICAgICAgICAgIGlmIChyZWRlZmluZSkNCiAgICAgICAgICAgICAgICBlbmhh\nbmNlci5zZXRSZWRlZmluZSh0cnVlKTsNCiAgICAgICAgICAgIGVuaGFuY2Vy\nLnNldENyZWF0ZVN1YmNsYXNzKHRydWUpOw0KICAgICAgICAgICAgZW5oYW5j\nZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKHRydWUpOw0KDQogICAgICAg\nICAgICAvLyBzZXQgdGhpcyBiZWZvcmUgZW5oYW5jZW1lbnQgYXMgd2VsbCBh\ncyBhZnRlciBzaW5jZSBlbmhhbmNlbWVudA0KICAgICAgICAgICAgLy8gdXNl\ncyBhIGRpZmZlcmVudCBtZXRhZGF0YSByZXBvc2l0b3J5LCBhbmQgdGhlIG1l\ndGFkYXRhIGNvbmZpZw0KICAgICAgICAgICAgLy8gbWF0dGVycyBpbiB0aGUg\nZW5oYW5jZW1lbnQgY29udHJhY3QuIERvbid0IGRvIGFueSB3YXJuaW5nIGhl\ncmUsDQogICAgICAgICAgICAvLyBzaW5jZSB3ZSdsbCBpc3N1ZSB3YXJuaW5n\ncyB3aGVuIHdlIGRvIHRoZSBmaW5hbCBtZXRhZGF0YQ0KICAgICAgICAgICAg\nLy8gcmVjb25maWd1cmF0aW9uIGF0IHRoZSBlbmQgb2YgdGhpcyBtZXRob2Qu\nDQogICAgICAgICAgICBjb25maWd1cmVNZXRhRGF0YShlbmhhbmNlci5nZXRN\nZXRhRGF0YSgpLCBjb25mLCByZWRlZmluZSwgZmFsc2UpOw0KDQogICAgICAg\nICAgICB1bnNwZWNpZmllZCA9IGNvbGxlY3RSZWxhdGVkVW5zcGVjaWZpZWRU\neXBlcyhlbmhhbmNlci5nZXRNZXRhRGF0YSgpLA0KICAgICAgICAgICAgICAg\nIGNsYXNzZXMsIHVuc3BlY2lmaWVkKTsNCg0KICAgICAgICAgICAgaW50IHJ1\nblJlc3VsdCA9IGVuaGFuY2VyLnJ1bigpOw0KICAgICAgICAgICAgaWYgKHJ1\nblJlc3VsdCA9PSBQQ0VuaGFuY2VyLkVOSEFOQ0VfUEMpIHsNCiAgICAgICAg\nICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBlbmhhbmNlci5y\nZWNvcmQoKTsNCiAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBlKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIG91ciBpbXBsIG9mIEJ5\ndGVjb2RlV3JpdGVyIGRvZXNuJ3QgdGhyb3cgSU9FeGNlcHRpb24NCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKGUp\nOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAg\nfQ0KDQogICAgICAgIGlmICh1bnNwZWNpZmllZCAhPSBudWxsICYmICF1bnNw\nZWNpZmllZC5pc0VtcHR5KCkpDQogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgidW5zcGVjaWZpZWQtdW5lbmhhbmNlZC10\neXBlcyIsDQogICAgICAgICAgICAgICAgY2xhc3NlcywgdW5zcGVjaWZpZWQp\nKTsNCg0KICAgICAgICBDbGFzc1JlZGVmaW5lci5yZWRlZmluZUNsYXNzZXMo\nY29uZiwgbWFwKTsNCiAgICAgICAgZm9yIChDbGFzcyBjbHMgOiBtYXAua2V5\nU2V0KCkpIHsNCiAgICAgICAgICAgIHNldEludGVyY2VwdGluZyhjb25mLCBl\nbnZMb2FkZXIsIGNscyk7DQogICAgICAgICAgICBjb25maWd1cmVNZXRhRGF0\nYShjb25mLCBlbnZMb2FkZXIsIGNscywgcmVkZWZpbmUpOw0KICAgICAgICB9\nDQogICAgICAgIGZvciAoQ2xhc3MgY2xzIDogKENvbGxlY3Rpb248Q2xhc3M+\nKSBzdWJzKQ0KICAgICAgICAgICAgY29uZmlndXJlTWV0YURhdGEoY29uZiwg\nZW52TG9hZGVyLCBjbHMsIHJlZGVmaW5lKTsNCiAgICAgICAgZm9yIChDbGFz\ncyBjbHMgOiAoQ29sbGVjdGlvbjxDbGFzcz4pIGludHMpDQogICAgICAgICAg\nICBzZXRJbnRlcmNlcHRpbmcoY29uZiwgZW52TG9hZGVyLCBjbHMpOw0KDQog\nICAgICAgIHJldHVybiBzdWJzOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3Rh\ndGljIFNldDxDbGFzcz4gY29sbGVjdFJlbGF0ZWRVbnNwZWNpZmllZFR5cGVz\nKENsYXNzTWV0YURhdGEgbWV0YSwNCiAgICAgICAgQ29sbGVjdGlvbjw/IGV4\ndGVuZHMgQ2xhc3M+IGNsYXNzZXMsIFNldDxDbGFzcz4gdW5zcGVjaWZpZWQp\nIHsNCiAgICAgICAgdW5zcGVjaWZpZWQgPSBjb2xsZWN0VW5zcGVjaWZpZWRU\neXBlKG1ldGEuZ2V0UENTdXBlcmNsYXNzKCksIGNsYXNzZXMsDQogICAgICAg\nICAgICB1bnNwZWNpZmllZCk7DQoNCiAgICAgICAgZm9yIChGaWVsZE1ldGFE\nYXRhIGZtZCA6IG1ldGEuZ2V0RmllbGRzKCkpIHsNCiAgICAgICAgICAgIGlm\nIChmbWQuaXNUcmFuc2llbnQoKSkNCiAgICAgICAgICAgICAgICBjb250aW51\nZTsNCiAgICAgICAgICAgIGlmIChmbWQuaXNUeXBlUEMoKSkNCiAgICAgICAg\nICAgICAgICB1bnNwZWNpZmllZCA9IGNvbGxlY3RVbnNwZWNpZmllZFR5cGUo\nZm1kLmdldFR5cGUoKSwgY2xhc3NlcywNCiAgICAgICAgICAgICAgICAgICAg\ndW5zcGVjaWZpZWQpOw0KICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50\nKCkgIT0gbnVsbCAmJiBmbWQuZ2V0RWxlbWVudCgpLmlzVHlwZVBDKCkpDQog\nICAgICAgICAgICAgICAgdW5zcGVjaWZpZWQgPSBjb2xsZWN0VW5zcGVjaWZp\nZWRUeXBlKGZtZC5nZXRFbGVtZW50KCkuZ2V0VHlwZSgpLA0KICAgICAgICAg\nICAgICAgICAgICBjbGFzc2VzLCB1bnNwZWNpZmllZCk7DQogICAgICAgICAg\nICBpZiAoZm1kLmdldEtleSgpICE9IG51bGwgJiYgZm1kLmdldEtleSgpLmlz\nVHlwZVBDKCkpDQogICAgICAgICAgICAgICAgdW5zcGVjaWZpZWQgPSBjb2xs\nZWN0VW5zcGVjaWZpZWRUeXBlKGZtZC5nZXRLZXkoKS5nZXRUeXBlKCksDQog\nICAgICAgICAgICAgICAgICAgIGNsYXNzZXMsIHVuc3BlY2lmaWVkKTsNCiAg\nICAgICAgICAgIGlmIChmbWQuZ2V0VmFsdWUoKSAhPSBudWxsICYmIGZtZC5n\nZXRWYWx1ZSgpLmlzVHlwZVBDKCkpDQogICAgICAgICAgICAgICAgdW5zcGVj\naWZpZWQgPSBjb2xsZWN0VW5zcGVjaWZpZWRUeXBlKGZtZC5nZXRWYWx1ZSgp\nLmdldFR5cGUoKSwNCiAgICAgICAgICAgICAgICAgICAgY2xhc3NlcywgdW5z\ncGVjaWZpZWQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB1bnNwZWNp\nZmllZDsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBTZXQ8Q2xhc3M+\nIGNvbGxlY3RVbnNwZWNpZmllZFR5cGUoQ2xhc3MgY2xzLA0KICAgICAgICBD\nb2xsZWN0aW9uPD8gZXh0ZW5kcyBDbGFzcz4gY2xhc3NlcywgU2V0PENsYXNz\nPiB1bnNwZWNpZmllZCkgew0KICAgICAgICBpZiAoY2xzICE9IG51bGwgJiYg\nIWNsYXNzZXMuY29udGFpbnMoY2xzKQ0KICAgICAgICAgICAgJiYgIUltcGxI\nZWxwZXIuaXNNYW5hZ2VkVHlwZShudWxsLCBjbHMpKSB7DQogICAgICAgICAg\nICBpZiAodW5zcGVjaWZpZWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB1\nbnNwZWNpZmllZCA9IG5ldyBIYXNoU2V0PENsYXNzPigpOw0KICAgICAgICAg\nICAgdW5zcGVjaWZpZWQuYWRkKGNscyk7DQogICAgICAgIH0NCiAgICAgICAg\ncmV0dXJuIHVuc3BlY2lmaWVkOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3Rh\ndGljIHZvaWQgY29uZmlndXJlTWV0YURhdGEoT3BlbkpQQUNvbmZpZ3VyYXRp\nb24gY29uZiwNCiAgICAgICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBDbGFz\ncyBjbHMsIGJvb2xlYW4gcmVkZWZpbmVBdmFpbGFibGUpIHsNCiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhID0gY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRv\ncnlJbnN0YW5jZSgpDQogICAgICAgICAgICAuZ2V0TWV0YURhdGEoY2xzLCBl\nbnZMb2FkZXIsIHRydWUpOw0KICAgICAgICBjb25maWd1cmVNZXRhRGF0YSht\nZXRhLCBjb25mLCByZWRlZmluZUF2YWlsYWJsZSwgdHJ1ZSk7DQogICAgfQ0K\nDQogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBjb25maWd1cmVNZXRhRGF0YShD\nbGFzc01ldGFEYXRhIG1ldGEsDQogICAgICAgIE9wZW5KUEFDb25maWd1cmF0\naW9uIGNvbmYsIGJvb2xlYW4gcmVkZWZpbmVBdmFpbGFibGUsIGJvb2xlYW4g\nd2Fybikgew0KDQogICAgICAgIHNldERldGFjaGVkU3RhdGUobWV0YSk7DQoN\nCiAgICAgICAgaWYgKHdhcm4gJiYgbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0g\nQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQNCiAgICAgICAgICAgICYmICFy\nZWRlZmluZUF2YWlsYWJsZSkgew0KICAgICAgICAgICAgLy8gb25seSB3YXJu\nIGFib3V0IGRlY2xhcmVkIGZpZWxkczsgc3VwZXJjbGFzcyBmaWVsZHMgd2ls\nbCBiZQ0KICAgICAgICAgICAgLy8gd2FybmVkIGFib3V0IHdoZW4gdGhlIHN1\ncGVyY2xhc3MgaXMgaGFuZGxlZA0KICAgICAgICAgICAgZm9yIChGaWVsZE1l\ndGFEYXRhIGZtZCA6IG1ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKSkgew0KICAg\nICAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldFR5cGVDb2RlKCkpIHsNCiAg\nICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoN\nCiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOg0KICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gd2UgY2FuIGxhemlseSBsb2FkIHRo\nZXNlLCBzaW5jZSB3ZSBvd24gdGhlDQogICAgICAgICAgICAgICAgICAgICAg\nICAvLyByZWxhdGlvbnNoaXAgY29udGFpbmVyDQogICAgICAgICAgICAgICAg\nICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoN\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZm1kLmlzSW5EZWZhdWx0\nRmV0Y2hHcm91cCgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYg\nIShmbWQuaXNWZXJzaW9uKCkgfHwgZm1kLmlzUHJpbWFyeUtleSgpKSkgew0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyBsb2cgPSBjb25mLmdl\ndExvZygNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0UpOw0KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJzdWJjbGFzc2VyLWZl\ndGNoLWdyb3VwLW92ZXJyaWRlIiwNCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpLA0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0TmFtZSgp\nKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldEluRGVm\nYXVsdEZldGNoR3JvdXAodHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgICAg\nICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCB3cml0ZShC\nQ0NsYXNzIGJjLCBQQ0VuaGFuY2VyIGVuaGFuY2VyLA0KICAgICAgICBNYXA8\nQ2xhc3MsIGJ5dGVbXT4gbWFwLCBDbGFzcyBjbHMsIExpc3Qgc3VicywgTGlz\ndCBpbnRzKQ0KICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gew0KDQogICAg\nICAgIGlmIChiYyA9PSBlbmhhbmNlci5nZXRNYW5hZ2VkVHlwZUJ5dGVjb2Rl\nKCkpIHsNCiAgICAgICAgICAgIC8vIGlmIGl0IHdhcyBhbHJlYWR5IGRlZmlu\nZWQsIGRvbid0IHB1dCBpdCBpbiB0aGUgbWFwLA0KICAgICAgICAgICAgLy8g\nYnV0IGRvIHNldCB0aGUgbWV0YWRhdGEgYWNjb3JkaW5nbHkuDQogICAgICAg\nICAgICBpZiAoZW5oYW5jZXIuaXNBbHJlYWR5UmVkZWZpbmVkKCkpDQogICAg\nICAgICAgICAgICAgaW50cy5hZGQoYmMuZ2V0VHlwZSgpKTsNCiAgICAgICAg\nICAgIGVsc2UgaWYgKEphdmFWZXJzaW9ucy5WRVJTSU9OID49IDUpDQogICAg\nICAgICAgICAgICAgbWFwLnB1dChiYy5nZXRUeXBlKCksIGJjLnRvQnl0ZUFy\ncmF5KCkpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKCFl\nbmhhbmNlci5pc0FscmVhZHlTdWJjbGFzc2VkKCkpIHsNCiAgICAgICAgICAg\nICAgICAvLyB0aGlzIGlzIHRoZSBuZXcgc3ViY2xhc3MNCiAgICAgICAgICAg\nICAgICBDbGFzc0xvYWRlciBsb2FkZXIgPSBHZW5lcmF0ZWRDbGFzc2VzLmdl\ndE1vc3REZXJpdmVkTG9hZGVyKA0KICAgICAgICAgICAgICAgICAgICBjbHMs\nIFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcyk7DQogICAgICAgICAgICAgICAg\nc3Vicy5hZGQoR2VuZXJhdGVkQ2xhc3Nlcy5sb2FkQkNDbGFzcyhiYywgbG9h\nZGVyKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAg\nICBwcml2YXRlIHN0YXRpYyB2b2lkIHNldEludGVyY2VwdGluZyhPcGVuSlBB\nQ29uZmlndXJhdGlvbiBjb25mLA0KICAgICAgICBDbGFzc0xvYWRlciBlbnZM\nb2FkZXIsIENsYXNzIGNscykgew0KICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGEgPSBjb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkNCiAg\nICAgICAgICAgIC5nZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgdHJ1ZSk7\nDQogICAgICAgIG1ldGEuc2V0SW50ZXJjZXB0aW5nKHRydWUpOw0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIElmIHRoZSBtZXRhZGF0YSBpcyBjb25maWd1\ncmVkIHRvIHVzZSBhIHN5bnRoZXRpYw0KICAgICAqIGRldGFjaGVkIHN0YXRl\nLCByZXNldCBpdCB0byBub3QgdXNlIGEgZGV0YWNoZWQNCiAgICAgKiBzdGF0\nZSBmaWVsZCwgc2luY2Ugd2UgY2FuJ3QgYWRkIGZpZWxkcyB3aGVuIHJlZGVm\naW5pbmcuDQogICAgICovDQogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBzZXRE\nZXRhY2hlZFN0YXRlKENsYXNzTWV0YURhdGEgbWV0YSkgew0KICAgICAgICBp\nZiAoQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKG1ldGEuZ2V0RGV0\nYWNoZWRTdGF0ZSgpKSkNCiAgICAgICAgICAgIG1ldGEuc2V0RGV0YWNoZWRT\ndGF0ZShudWxsKTsNCiAgICB9DQp9DQo=\n","encoding":"base64"}

