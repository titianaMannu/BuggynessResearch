{"sha":"5e17ef96b0aa9f5dc21b639544a4d763552281ae","node_id":"MDQ6QmxvYjIwNjM2NDo1ZTE3ZWY5NmIwYWE5ZjVkYzIxYjYzOTU0NGE0ZDc2MzU1MjI4MWFl","size":24032,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5e17ef96b0aa9f5dc21b639544a4d763552281ae","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmY7CgppbXBvcnQg\namF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250\ncm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Qcml2aWxlZ2VkQWN0aW9u\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5NaXNz\naW5nUmVzb3VyY2VFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuUHJvcGVy\ndGllczsKaW1wb3J0IGphdmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IGphdmF4\nLm5hbWluZy5Db250ZXh0OwppbXBvcnQgamF2YXgubmFtaW5nLkluaXRpYWxD\nb250ZXh0OwppbXBvcnQgamF2YXgubmFtaW5nLk5hbWluZ0V4Y2VwdGlvbjsK\nCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsK\naW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLmV4Y2VwdGlvbi5OZXN0\nYWJsZVJ1bnRpbWVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuUGFyc2VFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuU3RyaW5nRGlzdGFuY2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50\nSGFzaE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5j\nb25jdXJyZW50LkNvbmN1cnJlbnRSZWZlcmVuY2VIYXNoTWFwOwoKaW1wb3J0\nIHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIFV0aWxpdHkgbWV0aG9kcyBk\nZWFsaW5nIHdpdGggY29uZmlndXJhdGlvbi4KICoKICogQGF1dGhvciBBYmUg\nV2hpdGUKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIENvbmZpZ3Vy\nYXRpb25zIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIg\nX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKENvbmZpZ3Vy\nYXRpb25zLmNsYXNzKTsKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgQ29uY3Vy\ncmVudFJlZmVyZW5jZUhhc2hNYXAgX2xvYWRlcnMgPSBuZXcgCiAgICAgICAg\nQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAoQ29uY3VycmVudFJlZmVyZW5j\nZUhhc2hNYXAuV0VBSywgCiAgICAgICAgICAgICAgICBDb25jdXJyZW50UmVm\nZXJlbmNlSGFzaE1hcC5IQVJEKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBPYmplY3QgTlVMTF9MT0FERVIgPSAibnVsbC1sb2FkZXIiOwoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBjbGFzcyBuYW1lIGZyb20gdGhlIGdpdmVu\nIHBsdWdpbiBzdHJpbmcsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBTdHJpbmcgZ2V0Q2xhc3NOYW1lKFN0cmluZyBwbHVn\naW4pIHsKICAgICAgICByZXR1cm4gZ2V0UGx1Z2luQ29tcG9uZW50KHBsdWdp\nbiwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBy\nb3BlcnRpZXMgcGFydCBvZiB0aGUgZ2l2ZW4gcGx1Z2luIHN0cmluZywgb3Ig\nbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmlu\nZyBnZXRQcm9wZXJ0aWVzKFN0cmluZyBwbHVnaW4pIHsKICAgICAgICByZXR1\ncm4gZ2V0UGx1Z2luQ29tcG9uZW50KHBsdWdpbiwgZmFsc2UpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGVpdGhlciB0aGUgY2xhc3MgbmFtZSBv\nciBwcm9wZXJ0aWVzIHN0cmluZyBmcm9tIGEgcGx1Z2luIHN0cmluZy4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGdldFBsdWdpbkNvbXBv\nbmVudChTdHJpbmcgcGx1Z2luLCBib29sZWFuIGNsc05hbWUpIHsKICAgICAg\nICBpZiAocGx1Z2luICE9IG51bGwpCiAgICAgICAgICAgIHBsdWdpbiA9IHBs\ndWdpbi50cmltKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHko\ncGx1Z2luKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGlu\ndCBvcGVuUGFyZW4gPSAtMTsKICAgICAgICBpZiAocGx1Z2luLmNoYXJBdChw\nbHVnaW4ubGVuZ3RoKCkgLSAxKSA9PSAnKScpCiAgICAgICAgICAgIG9wZW5Q\nYXJlbiA9IHBsdWdpbi5pbmRleE9mKCcoJyk7CiAgICAgICAgaWYgKG9wZW5Q\nYXJlbiA9PSAtMSkgewogICAgICAgICAgICBpbnQgZXEgPSBwbHVnaW4uaW5k\nZXhPZignPScpOwogICAgICAgICAgICBpZiAoZXEgPT0gLTEpCiAgICAgICAg\nICAgICAgICByZXR1cm4gKGNsc05hbWUpID8gcGx1Z2luIDogbnVsbDsKICAg\nICAgICAgICAgcmV0dXJuIChjbHNOYW1lKSA/IG51bGwgOiBwbHVnaW47CiAg\nICAgICAgfQoKICAgICAgICAvLyBjbHNOYW1lKHByb3BzKSBmb3JtCiAgICAg\nICAgaWYgKGNsc05hbWUpCiAgICAgICAgICAgIHJldHVybiBwbHVnaW4uc3Vi\nc3RyaW5nKDAsIG9wZW5QYXJlbikudHJpbSgpOwogICAgICAgIFN0cmluZyBw\ncm9wID0gcGx1Z2luLnN1YnN0cmluZyhvcGVuUGFyZW4gKyAxLAogICAgICAg\nICAgICBwbHVnaW4ubGVuZ3RoKCkgLSAxKS50cmltKCk7CiAgICAgICAgcmV0\ndXJuIChwcm9wLmxlbmd0aCgpID09IDApID8gbnVsbCA6IHByb3A7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBjbGFzcyBuYW1l\nIGFuZCBwcm9wZXJ0aWVzIGludG8gYSBwbHVnaW4gc3RyaW5nLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBnZXRQbHVnaW4oU3RyaW5nIGNs\nc05hbWUsIFN0cmluZyBwcm9wcykgewogICAgICAgIGlmIChTdHJpbmdVdGls\ncy5pc0VtcHR5KGNsc05hbWUpKQogICAgICAgICAgICByZXR1cm4gcHJvcHM7\nCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocHJvcHMpKQogICAg\nICAgICAgICByZXR1cm4gY2xzTmFtZTsKICAgICAgICByZXR1cm4gY2xzTmFt\nZSArICIoIiArIHByb3BzICsgIikiOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGEgcGx1Z2luIHN0cmluZyB0aGF0IGNvbWJpbmVzIHRoZSBwcm9w\nZXJ0aWVzIG9mIHRoZSBnaXZlbiBwbHVnaW4KICAgICAqIHN0cmluZ3MsIHdo\nZXJlIHByb3BlcnRpZXMgb2YgPGNvZGU+b3ZlcnJpZGU8L2NvZGU+IHdpbGwg\nb3ZlcnJpZGUgdGhlCiAgICAgKiBzYW1lIHByb3BlcnRpZXMgb2YgPGNvZGU+\nb3JpZzwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5n\nIGNvbWJpbmVQbHVnaW5zKFN0cmluZyBvcmlnLCBTdHJpbmcgb3ZlcnJpZGUp\nIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShvcmlnKSkKICAg\nICAgICAgICAgcmV0dXJuIG92ZXJyaWRlOwogICAgICAgIGlmIChTdHJpbmdV\ndGlscy5pc0VtcHR5KG92ZXJyaWRlKSkKICAgICAgICAgICAgcmV0dXJuIG9y\naWc7CgogICAgICAgIFN0cmluZyBvcmlnQ2xzID0gZ2V0Q2xhc3NOYW1lKG9y\naWcpOwogICAgICAgIFN0cmluZyBvdmVycmlkZUNscyA9IGdldENsYXNzTmFt\nZShvdmVycmlkZSk7CiAgICAgICAgU3RyaW5nIGNsczsKICAgICAgICBpZiAo\nU3RyaW5nVXRpbHMuaXNFbXB0eShvcmlnQ2xzKSkKICAgICAgICAgICAgY2xz\nID0gb3ZlcnJpZGVDbHM7CiAgICAgICAgZWxzZSBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShvdmVycmlkZUNscykpCiAgICAgICAgICAgIGNscyA9IG9yaWdD\nbHM7CiAgICAgICAgZWxzZSBpZiAoIW9yaWdDbHMuZXF1YWxzKG92ZXJyaWRl\nQ2xzKSkKICAgICAgICAgICAgcmV0dXJuIG92ZXJyaWRlOyAvLyBjb21wbGV0\nZWx5IGRpZmZlcmVudCBwbHVnaW4KICAgICAgICBlbHNlCiAgICAgICAgICAg\nIGNscyA9IG9yaWdDbHM7CgogICAgICAgIFN0cmluZyBvcmlnUHJvcHMgPSBn\nZXRQcm9wZXJ0aWVzKG9yaWcpOwogICAgICAgIFN0cmluZyBvdmVycmlkZVBy\nb3BzID0gZ2V0UHJvcGVydGllcyhvdmVycmlkZSk7CiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkob3JpZ1Byb3BzKSkKICAgICAgICAgICAgcmV0\ndXJuIGdldFBsdWdpbihjbHMsIG92ZXJyaWRlUHJvcHMpOwogICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KG92ZXJyaWRlUHJvcHMpKQogICAgICAg\nICAgICByZXR1cm4gZ2V0UGx1Z2luKGNscywgb3JpZ1Byb3BzKTsKCiAgICAg\nICAgUHJvcGVydGllcyBwcm9wcyA9IHBhcnNlUHJvcGVydGllcyhvcmlnUHJv\ncHMpOwogICAgICAgIHByb3BzLnB1dEFsbChwYXJzZVByb3BlcnRpZXMob3Zl\ncnJpZGVQcm9wcykpOwogICAgICAgIHJldHVybiBnZXRQbHVnaW4oY2xzLCBz\nZXJpYWxpemVQcm9wZXJ0aWVzKHByb3BzKSk7IAogICAgfQoKICAgIC8qKgog\nICAgICogQ3JlYXRlIHRoZSBpbnN0YW5jZSB3aXRoIHRoZSBnaXZlbiBjbGFz\ncyBuYW1lLCB1c2luZyB0aGUgZ2l2ZW4KICAgICAqIGNsYXNzIGxvYWRlci4g\nTm8gY29uZmlndXJhdGlvbiBvZiB0aGUgaW5zdGFuY2UgaXMgcGVyZm9ybWVk\nIGJ5CiAgICAgKiB0aGlzIG1ldGhvZC4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBPYmplY3QgbmV3SW5zdGFuY2UoU3RyaW5nIGNsc05hbWUsIENsYXNz\nTG9hZGVyIGxvYWRlcikgewogICAgICAgIHJldHVybiBuZXdJbnN0YW5jZShj\nbHNOYW1lLCBudWxsLCBudWxsLCBsb2FkZXIsIHRydWUpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlIGFuZCBjb25maWd1cmUgYW4gaW5zdGFuY2Ug\nd2l0aCB0aGUgZ2l2ZW4gY2xhc3MgbmFtZSBhbmQKICAgICAqIHByb3BlcnRp\nZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IG5ld0luc3Rh\nbmNlKFN0cmluZyBjbHNOYW1lLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAg\nICAgU3RyaW5nIHByb3BzLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAg\nICBPYmplY3Qgb2JqID0gbmV3SW5zdGFuY2UoY2xzTmFtZSwgbnVsbCwgY29u\nZiwgbG9hZGVyLCB0cnVlKTsKICAgICAgICBjb25maWd1cmVJbnN0YW5jZShv\nYmosIGNvbmYsIHByb3BzKTsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQoK\nICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB1c2VkIGJ5IG1lbWJlcnMg\nb2YgdGhpcyBwYWNrYWdlIHRvIGluc3RhbnRpYXRlIHBsdWdpbgogICAgICog\ndmFsdWVzLgogICAgICovCiAgICBzdGF0aWMgT2JqZWN0IG5ld0luc3RhbmNl\nKFN0cmluZyBjbHNOYW1lLCBWYWx1ZSB2YWwsIENvbmZpZ3VyYXRpb24gY29u\nZiwKICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIsIGJvb2xlYW4gZmF0YWwp\nIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShjbHNOYW1lKSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzIGNscyA9\nIG51bGw7IAoKICAgICAgICB3aGlsZSAoY2xzID09IG51bGwpIHsKICAgICAg\nICAgICAgLy8gY2FuJ3QgaGF2ZSBhIG51bGwgcmVmZXJlbmNlIGluIHRoZSBt\nYXAsIHNvIHVzZSBzeW1ib2xpYwogICAgICAgICAgICAvLyBjb25zdGFudCBh\ncyBrZXkKICAgICAgICAgICAgT2JqZWN0IGtleSA9IGxvYWRlciA9PSBudWxs\nID8gTlVMTF9MT0FERVIgOiBsb2FkZXI7CiAgICAgICAgICAgIE1hcCBsb2Fk\nZXJDYWNoZSA9IChNYXApIF9sb2FkZXJzLmdldChrZXkpOwogICAgICAgICAg\nICBpZiAobG9hZGVyQ2FjaGUgPT0gbnVsbCkgeyAvLyBXZSBkb24ndCBoYXZl\nIGEgY2FjaGUgZm9yIHRoaXMgbG9hZGVyLgogICAgICAgICAgICAgICAgbG9h\nZGVyQ2FjaGUgPSBuZXcgQ29uY3VycmVudEhhc2hNYXAoKTsKICAgICAgICAg\nICAgICAgIF9sb2FkZXJzLnB1dChrZXksIGxvYWRlckNhY2hlKTsKICAgICAg\nICAgICAgfSBlbHNlIHsgIC8vIFdlIGhhdmUgYSBjYWNoZSBmb3IgdGhpcyBs\nb2FkZXIuCiAgICAgICAgICAgICAgICBjbHMgPSAoQ2xhc3MpIGxvYWRlckNh\nY2hlLmdldChjbHNOYW1lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKGNscyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIGNscyA9IFN0cmluZ3MudG9DbGFzcyhjbHNOYW1l\nLCBmaW5kRGVyaXZlZExvYWRlcihjb25mLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbG9hZGVyKSk7CiAgICAgICAgICAgICAgICAgICAgbG9hZGVy\nQ2FjaGUucHV0KGNsc05hbWUsIGNscyk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGxvYWRlciAhPSBudWxsKSAgLy8gVHJ5IG9uZSBtb3JlIHRpbWUg\nd2l0aCBsb2FkZXI9bnVsbAogICAgICAgICAgICAgICAgICAgICAgICBsb2Fk\nZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZSA9IGdldENyZWF0ZUV4Y2VwdGlvbihjbHNO\nYW1lLCB2YWwsIHJlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZh\ndGFsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgcmU7CiAg\nICAgICAgICAgICAgICAgICAgICAgIExvZyBsb2cgPSAoY29uZiA9PSBudWxs\nKSA/IG51bGwgOiBjb25mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLmdldENvbmZpZ3VyYXRpb25Mb2coKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGxvZyAhPSBudWxsICYmIGxvZy5pc0Vycm9yRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmVycm9yKF9sb2MK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldCgicGx1\nZ2luLWNyZWF0aW9uLWV4Y2VwdGlvbiIsIHZhbCksIHJlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihjbHMpKTsKICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAoZSBpbnN0YW5j\nZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pIHsKICAgICAgICAgICAg\nICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pIGUpLmdldEV4\nY2VwdGlvbigpOyAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIFJ1bnRp\nbWVFeGNlcHRpb24gcmUgPSBuZXcgTmVzdGFibGVSdW50aW1lRXhjZXB0aW9u\nKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAoIm9iai1jcmVhdGUiLCBjbHMp\nLmdldE1lc3NhZ2UoKSwgZSk7CiAgICAgICAgICAgIGlmIChmYXRhbCkKICAg\nICAgICAgICAgICAgIHRocm93IHJlOwogICAgICAgICAgICBMb2cgbG9nID0g\nKGNvbmYgPT0gbnVsbCkgPyBudWxsIDogY29uZi5nZXRDb25maWd1cmF0aW9u\nTG9nKCk7CiAgICAgICAgICAgIGlmIChsb2cgIT0gbnVsbCAmJiBsb2cuaXNF\ncnJvckVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy5lcnJvcihfbG9j\nLmdldCgicGx1Z2luLWNyZWF0aW9uLWV4Y2VwdGlvbiIsIHZhbCksIHJlKTsK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQXR0ZW1wdCB0byBmaW5kIGEgZGVyaXZlZCBsb2FkZXIg\ndGhhdCBkZWxlZ2F0ZXMgdG8gb3VyIHRhcmdldCBsb2FkZXIuCiAgICAgKiBU\naGlzIGFsbG93cyBhcHBsaWNhdGlvbiBsb2FkZXJzIHRoYXQgZGVsZWdhdGUg\nYXBwcm9wcmlhdGVseSBmb3Iga25vd24KICAgICAqIGNsYXNzZXMgZmlyc3Qg\nY3JhY2sgYXQgY2xhc3MgbmFtZXMuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIENsYXNzTG9hZGVyIGZpbmREZXJpdmVkTG9hZGVyKENvbmZpZ3VyYXRp\nb24gY29uZiwKICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAg\nICAvLyB3ZSBhbHdheXMgcHJlZmVyIHRoZSB0aHJlYWQgbG9hZGVyLCBiZWNh\ndXNlIGl0J3MgdGhlIG9ubHkgdGhpbmcgd2UKICAgICAgICAvLyBjYW4gYWNj\nZXNzIHRoYXQgaXNuJ3QgYm91bmQgdG8gdGhlIE9wZW5KUEEgY2xhc3Nsb2Fk\nZXIsIHVubGVzcwogICAgICAgIC8vIHRoZSBjb25mIG9iamVjdCBpcyBvZiBh\nIGN1c3RvbSBjbGFzcwogICAgICAgIENsYXNzTG9hZGVyIGN0eExvYWRlciA9\nIChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENvbnRleHRDbGFzc0xv\nYWRlckFjdGlvbigpKTsKICAgICAgICBpZiAobG9hZGVyID09IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKGN0eExvYWRlciAhPSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGN0eExvYWRlcjsKICAgICAgICAgICAgaWYgKGNvbmYg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAoQ2xhc3NMb2FkZXIp\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAg\nICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGNv\nbmYuZ2V0Q2xhc3MoKSkpOyAKICAgICAgICAgICAgcmV0dXJuIENvbmZpZ3Vy\nYXRpb25zLmNsYXNzLmdldENsYXNzTG9hZGVyKCk7CiAgICAgICAgfQoKICAg\nICAgICBmb3IgKENsYXNzTG9hZGVyIHBhcmVudCA9IGN0eExvYWRlcjsgcGFy\nZW50ICE9IG51bGw7IAogICAgICAgICAgICBwYXJlbnQgPSAoQ2xhc3NMb2Fk\nZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0UGFyZW50QWN0aW9uKHBhcmVudCkp\nKSB7CiAgICAgICAgICAgIGlmIChwYXJlbnQgPT0gbG9hZGVyKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGN0eExvYWRlcjsKICAgICAgICB9CiAgICAgICAg\naWYgKGNvbmYgIT0gbnVsbCkgewogICAgICAgICAgICBmb3IgKENsYXNzTG9h\nZGVyIHBhcmVudCA9IChDbGFzc0xvYWRlcikKICAgICAgICAgICAgICAgIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAg\nICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGNvbmYu\nZ2V0Q2xhc3MoKSkpOyAKICAgICAgICAgICAgICAgIHBhcmVudCAhPSBudWxs\nOyAKICAgICAgICAgICAgICAgIHBhcmVudCA9IChDbGFzc0xvYWRlcikgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAg\nICAgSjJEb1ByaXZIZWxwZXIuZ2V0UGFyZW50QWN0aW9uKHBhcmVudCkpKSB7\nCiAgICAgICAgICAgICAgICBpZiAocGFyZW50ID09IGxvYWRlcikKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250\ncm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY29uZi5nZXRD\nbGFzcygpKSk7IAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBsb2FkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdp\ndmVuIHtAbGluayBDb25maWd1cmF0aW9ufSBpbnN0YW5jZSBmcm9tIHRoZSBj\nb21tYW5kIGxpbmUKICAgICAqIG9wdGlvbnMgcHJvdmlkZWQuIEFsbCBwcm9w\nZXJ0eSBuYW1lcyBvZiB0aGUgZ2l2ZW4gY29uZmlndXJhdGlvbiBhcmUKICAg\nICAqIHJlY29nbml6ZWQ7IGFkZGl0aW9uYWxseSwgaWYgYSA8Y29kZT5wcm9w\nZXJ0aWVzPC9jb2RlPiBvcgogICAgICogPGNvZGU+cDwvY29kZT4gYXJndW1l\nbnQgZXhpc3RzLCB0aGUgcmVzb3VyY2UgaXQKICAgICAqIHBvaW50cyB0byB3\naWxsIGJlIGxvYWRlZCBhbmQgc2V0IGludG8gdGhlIGdpdmVuIGNvbmZpZ3Vy\nYXRpb24gaW5zdGFuY2UuCiAgICAgKiBJdCBjYW4gcG9pbnQgdG8gZWl0aGVy\nIGEgZmlsZSBvciBhIHJlc291cmNlIG5hbWUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgdm9pZCBwb3B1bGF0ZUNvbmZpZ3VyYXRpb24oQ29uZmlndXJh\ndGlvbiBjb25mLCBPcHRpb25zIG9wdHMpIHsKICAgICAgICBTdHJpbmcgcHJv\ncHMgPSBvcHRzLnJlbW92ZVByb3BlcnR5KCJwcm9wZXJ0aWVzIiwgInAiLCBu\ndWxsKTsKICAgICAgICBDb25maWd1cmF0aW9uUHJvdmlkZXIgcHJvdmlkZXI7\nCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KHByb3BzKSkgewog\nICAgICAgICAgICBTdHJpbmcgcGF0aCA9IHByb3BzOwogICAgICAgICAgICBT\ndHJpbmcgYW5jaG9yID0gbnVsbDsKICAgICAgICAgICAgaW50IGlkeCA9IHBh\ndGgubGFzdEluZGV4T2YoJyMnKTsKICAgICAgICAgICAgaWYgKGlkeCAhPSAt\nMSkgewogICAgICAgICAgICAgICAgaWYgKGlkeCA8IHBhdGgubGVuZ3RoKCkg\nLSAxKQogICAgICAgICAgICAgICAgICAgIGFuY2hvciA9IHBhdGguc3Vic3Ry\naW5nKGlkeCArIDEpOwogICAgICAgICAgICAgICAgcGF0aCA9IHBhdGguc3Vi\nc3RyaW5nKDAsIGlkeCk7CiAgICAgICAgICAgICAgICBpZiAocGF0aC5sZW5n\ndGgoKSA9PSAwKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNaXNz\naW5nUmVzb3VyY2VFeGNlcHRpb24oX2xvYy5nZXQoImFuY2hvci1vbmx5IiwK\nICAgICAgICAgICAgICAgICAgICAgICAgcHJvcHMpLmdldE1lc3NhZ2UoKSwg\nQ29uZmlndXJhdGlvbnMuY2xhc3MuZ2V0TmFtZSgpLCAKICAgICAgICAgICAg\nICAgICAgICAgICAgcHJvcHMpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBGaWxlIGZpbGUgPSBuZXcgRmlsZShwYXRoKTsKICAgICAgICAgICAgaWYg\nKCgoQm9vbGVhbikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJE\nb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAgIC5pc0ZpbGVBY3Rpb24oZmls\nZSkpKS5ib29sZWFuVmFsdWUoKSkKICAgICAgICAgICAgICAgIHByb3ZpZGVy\nID0gUHJvZHVjdERlcml2YXRpb25zLmxvYWQoZmlsZSwgYW5jaG9yLCBudWxs\nKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBmaWxlID0g\nbmV3IEZpbGUoIk1FVEEtSU5GIiArIEZpbGUuc2VwYXJhdG9yQ2hhciArIHBh\ndGgpOwogICAgICAgICAgICAgICAgaWYgKCgoQm9vbGVhbikgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAg\nICAgICAgICAgICAuaXNGaWxlQWN0aW9uKGZpbGUpKSkuYm9vbGVhblZhbHVl\nKCkpCiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXIgPSBQcm9kdWN0RGVy\naXZhdGlvbnMubG9hZChmaWxlLCBhbmNob3IsIG51bGwpOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyID0gUHJv\nZHVjdERlcml2YXRpb25zLmxvYWQocGF0aCwgYW5jaG9yLCBudWxsKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAocHJvdmlkZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHByb3ZpZGVyLnNldEludG8oY29uZik7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNaXNzaW5n\nUmVzb3VyY2VFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXByb3ZpZGVyIiwKICAg\nICAgICAgICAgICAgICAgICBwcm9wcykuZ2V0TWVzc2FnZSgpLCBDb25maWd1\ncmF0aW9ucy5jbGFzcy5nZXROYW1lKCksIAogICAgICAgICAgICAgICAgICAg\nIHByb3BzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcm92aWRl\nciA9IFByb2R1Y3REZXJpdmF0aW9ucy5sb2FkRGVmYXVsdHMobnVsbCk7CiAg\nICAgICAgICAgIGlmIChwcm92aWRlciAhPSBudWxsKQogICAgICAgICAgICAg\nICAgcHJvdmlkZXIuc2V0SW50byhjb25mKTsKICAgICAgICB9CiAgICAgICAg\nb3B0cy5zZXRJbnRvKGNvbmYpOwogICAgfQoKICAgIC8qKgogICAgICogSGVs\ncGVyIG1ldGhvZCB0byB0aHJvdyBhbiBpbmZvcm1hdGl2ZSBkZXNjcmlwdGlv\nbiBvbiBpbnN0YW50aWF0aW9uIGVycm9yLgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBSdW50aW1lRXhjZXB0aW9uIGdldENyZWF0ZUV4Y2VwdGlvbihT\ndHJpbmcgY2xzTmFtZSwKICAgICAgICBWYWx1ZSB2YWwsIEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgLy8gcmUtdGhyb3cgdGhlIGV4Y2VwdGlvbiB3aXRoIHNv\nbWUgYmV0dGVyIGluZm9ybWF0aW9uCiAgICAgICAgZmluYWwgU3RyaW5nIG1z\nZzsKICAgICAgICBmaW5hbCBPYmplY3RbXSBwYXJhbXM7CgogICAgICAgIFN0\ncmluZyBhbGlhcyA9IHZhbC5hbGlhcyhjbHNOYW1lKTsKICAgICAgICBTdHJp\nbmdbXSBhbGlhc2VzID0gdmFsLmdldEFsaWFzZXMoKTsKICAgICAgICBTdHJp\nbmdbXSBrZXlzOwogICAgICAgIGlmIChhbGlhc2VzLmxlbmd0aCA9PSAwKQog\nICAgICAgICAgICBrZXlzID0gYWxpYXNlczsKICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAga2V5cyA9IG5ldyBTdHJpbmdbYWxpYXNlcy5sZW5ndGggLyAy\nXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhbGlhc2VzLmxl\nbmd0aDsgaSArPSAyKQogICAgICAgICAgICAgICAga2V5c1tpIC8gMl0gPSBh\nbGlhc2VzW2ldOwogICAgICAgIH0KCiAgICAgICAgU3RyaW5nIGNsb3Nlc3Q7\nCiAgICAgICAgaWYgKGtleXMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAg\nbXNnID0gImludmFsaWQtcGx1Z2luIjsKICAgICAgICAgICAgcGFyYW1zID0g\nbmV3IE9iamVjdFtdeyB2YWwuZ2V0UHJvcGVydHkoKSwgYWxpYXMsIGUudG9T\ndHJpbmcoKSwgfTsKICAgICAgICB9IGVsc2UgaWYgKChjbG9zZXN0ID0gU3Ry\naW5nRGlzdGFuY2UuZ2V0Q2xvc2VzdExldmVuc2h0ZWluRGlzdGFuY2UKICAg\nICAgICAgICAgKGFsaWFzLCBrZXlzLCAwLjVmKSkgPT0gbnVsbCkgewogICAg\nICAgICAgICBtc2cgPSAiaW52YWxpZC1wbHVnaW4tYWxpYXNlcyI7CiAgICAg\nICAgICAgIHBhcmFtcyA9IG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAg\nIHZhbC5nZXRQcm9wZXJ0eSgpLCBhbGlhcywgZS50b1N0cmluZygpLAogICAg\nICAgICAgICAgICAgbmV3IFRyZWVTZXQoQXJyYXlzLmFzTGlzdChrZXlzKSks\nIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbXNnID0gImludmFs\naWQtcGx1Z2luLWFsaWFzZXMtaGludCI7CiAgICAgICAgICAgIHBhcmFtcyA9\nIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAgIHZhbC5nZXRQcm9wZXJ0\neSgpLCBhbGlhcywgZS50b1N0cmluZygpLAogICAgICAgICAgICAgICAgbmV3\nIFRyZWVTZXQoQXJyYXlzLmFzTGlzdChrZXlzKSksIGNsb3Nlc3QsIH07CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBuZXcgUGFyc2VFeGNlcHRpb24oX2xv\nYy5nZXQobXNnLCBwYXJhbXMpLCBlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENvbmZpZ3VyZXMgdGhlIGdpdmVuIG9iamVjdCB3aXRoIHRoZSBnaXZlbiBw\ncm9wZXJ0aWVzIGJ5CiAgICAgKiBtYXRjaGluZyB0aGUgcHJvcGVydGllcyBz\ndHJpbmcgdG8gdGhlIG9iamVjdCdzIHNldHRlcgogICAgICogbWV0aG9kcy4g\nVGhlIHByb3BlcnRpZXMgc3RyaW5nIHNob3VsZCBiZSBpbiB0aGUgZm9ybQog\nICAgICogInByb3AxPXZhbDEsIHByb3AyPXZhbDIgLi4uIi4gRG9lcyBub3Qg\ndmFsaWRhdGUgdGhhdCBzZXR0ZXIKICAgICAqIG1ldGhvZHMgZXhpc3QgZm9y\nIHRoZSBwcm9wZXJ0aWVzLgogICAgICoKICAgICAqIEB0aHJvd3MgUnVudGlt\nZUV4Y2VwdGlvbiBvbiBjb25maWd1cmF0aW9uIGVycm9yCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgdm9pZCBjb25maWd1cmVJbnN0YW5jZShPYmplY3Qg\nb2JqLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAgU3RyaW5nIHByb3Bl\ncnRpZXMpIHsKICAgICAgICBjb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYs\nIHByb3BlcnRpZXMsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\nZmlndXJlcyB0aGUgZ2l2ZW4gb2JqZWN0IHdpdGggdGhlIGdpdmVuIHByb3Bl\ncnRpZXMgYnkKICAgICAqIG1hdGNoaW5nIHRoZSBwcm9wZXJ0aWVzIHN0cmlu\nZyB0byB0aGUgb2JqZWN0J3Mgc2V0dGVyCiAgICAgKiBtZXRob2RzLiBUaGUg\ncHJvcGVydGllcyBzdHJpbmcgc2hvdWxkIGJlIGluIHRoZSBmb3JtCiAgICAg\nKiAicHJvcDE9dmFsMSwgcHJvcDI9dmFsMiAuLi4iLiBWYWxpZGF0ZXMgdGhh\ndCBzZXR0ZXIgbWV0aG9kcwogICAgICogZXhpc3QgZm9yIHRoZSBwcm9wZXJ0\naWVzLgogICAgICoKICAgICAqIEB0aHJvd3MgUnVudGltZUV4Y2VwdGlvbiBv\nbiBjb25maWd1cmF0aW9uIGVycm9yCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgdm9pZCBjb25maWd1cmVJbnN0YW5jZShPYmplY3Qgb2JqLCBDb25maWd1\ncmF0aW9uIGNvbmYsCiAgICAgICAgU3RyaW5nIHByb3BlcnRpZXMsIFN0cmlu\nZyBjb25maWd1cmF0aW9uTmFtZSkgewogICAgICAgIGlmIChvYmogPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBQcm9wZXJ0aWVzIHBy\nb3BzID0gbnVsbDsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHko\ncHJvcGVydGllcykpCiAgICAgICAgICAgIHByb3BzID0gcGFyc2VQcm9wZXJ0\naWVzKHByb3BlcnRpZXMpOwogICAgICAgIGNvbmZpZ3VyZUluc3RhbmNlKG9i\naiwgY29uZiwgcHJvcHMsIGNvbmZpZ3VyYXRpb25OYW1lKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbmZpZ3VyZXMgdGhlIGdpdmVuIG9iamVjdCB3aXRo\nIHRoZSBnaXZlbiBwcm9wZXJ0aWVzIGJ5CiAgICAgKiBtYXRjaGluZyB0aGUg\ncHJvcGVydGllcyBzdHJpbmcgdG8gdGhlIG9iamVjdCdzIHNldHRlcgogICAg\nICogbWV0aG9kcy4gRG9lcyBub3QgdmFsaWRhdGUgdGhhdCBzZXR0ZXIgbWV0\naG9kcyBleGlzdCBmb3IgdGhlIHByb3BlcnRpZXMuCiAgICAgKgogICAgICog\nQHRocm93cyBSdW50aW1lRXhjZXB0aW9uIG9uIGNvbmZpZ3VyYXRpb24gZXJy\nb3IKICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIGNvbmZpZ3VyZUlu\nc3RhbmNlKE9iamVjdCBvYmosIENvbmZpZ3VyYXRpb24gY29uZiwKICAgICAg\nICBQcm9wZXJ0aWVzIHByb3BlcnRpZXMpIHsKICAgICAgICBjb25maWd1cmVJ\nbnN0YW5jZShvYmosIGNvbmYsIHByb3BlcnRpZXMsIG51bGwpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29uZmlndXJlcyB0aGUgZ2l2ZW4gb2JqZWN0IHdp\ndGggdGhlIGdpdmVuIHByb3BlcnRpZXMgYnkKICAgICAqIG1hdGNoaW5nIHRo\nZSBwcm9wZXJ0aWVzIHN0cmluZyB0byB0aGUgb2JqZWN0J3Mgc2V0dGVyCiAg\nICAgKiBtZXRob2RzLiBJZiA8Y29kZT5jb25maWd1cmF0aW9uTmFtZTwvY29k\nZT4gaXMKICAgICAqIG5vbi08Y29kZT5udWxsPC9jb2RlPiwgdmFsaWRhdGVz\nIHRoYXQgc2V0dGVyIG1ldGhvZHMgZXhpc3QgZm9yCiAgICAgKiB0aGUgcHJv\ncGVydGllcy4KICAgICAqCiAgICAgKiBAdGhyb3dzIFJ1bnRpbWVFeGNlcHRp\nb24gb24gY29uZmlndXJhdGlvbiBlcnJvcgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIHZvaWQgY29uZmlndXJlSW5zdGFuY2UoT2JqZWN0IG9iaiwgQ29u\nZmlndXJhdGlvbiBjb25mLAogICAgICAgIFByb3BlcnRpZXMgcHJvcGVydGll\ncywgU3RyaW5nIGNvbmZpZ3VyYXRpb25OYW1lKSB7CiAgICAgICAgaWYgKG9i\naiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE9wdGlv\nbnMgb3B0czsKICAgICAgICBpZiAocHJvcGVydGllcyBpbnN0YW5jZW9mIE9w\ndGlvbnMpCiAgICAgICAgICAgIG9wdHMgPSAoT3B0aW9ucykgcHJvcGVydGll\nczsKICAgICAgICBlbHNlIHsgCiAgICAgICAgICAgIG9wdHMgPSBuZXcgT3B0\naW9ucygpOwogICAgICAgICAgICBpZiAocHJvcGVydGllcyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgb3B0cy5wdXRBbGwocHJvcGVydGllcyk7CiAgICAg\nICAgfQoKICAgICAgICBDb25maWd1cmFibGUgY29uZmlndXJhYmxlID0gbnVs\nbDsKICAgICAgICBpZiAoY29uZiAhPSBudWxsICYmIG9iaiBpbnN0YW5jZW9m\nIENvbmZpZ3VyYWJsZSkKICAgICAgICAgICAgY29uZmlndXJhYmxlID0gKENv\nbmZpZ3VyYWJsZSkgb2JqOwoKICAgICAgICBpZiAoY29uZmlndXJhYmxlICE9\nIG51bGwpIHsKICAgICAgICAgICAgY29uZmlndXJhYmxlLnNldENvbmZpZ3Vy\nYXRpb24oY29uZik7CiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZS5zdGFydENv\nbmZpZ3VyYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgT3B0aW9ucyBpbnZh\nbGlkRW50cmllcyA9IG9wdHMuc2V0SW50byhvYmopOwogICAgICAgIGlmIChv\nYmogaW5zdGFuY2VvZiBHZW5lcmljQ29uZmlndXJhYmxlKQogICAgICAgICAg\nICAoKEdlbmVyaWNDb25maWd1cmFibGUpIG9iaikuc2V0SW50byhpbnZhbGlk\nRW50cmllcyk7CgoJCWlmICghaW52YWxpZEVudHJpZXMuaXNFbXB0eSgpICYm\nIGNvbmZpZ3VyYXRpb25OYW1lICE9IG51bGwpIHsKCQkJTG9jYWxpemVyLk1l\nc3NhZ2UgbXNnID0gbnVsbDsKCQkJU3RyaW5nIGZpcnN0ID0gKFN0cmluZykg\naW52YWxpZEVudHJpZXMua2V5U2V0KCkuaXRlcmF0b3IoKS5uZXh0KCk7CgkJ\nCWlmIChpbnZhbGlkRW50cmllcy5rZXlTZXQoKS5zaXplKCkgPT0gMSAmJgoJ\nCQkJZmlyc3QuaW5kZXhPZignLicpID09IC0xKSB7CgkJCQkvLyBpZiB0aGVy\nZSdzIGp1c3Qgb25lIG1pc3NwZWxsaW5nIGFuZCB0aGlzIGlzIG5vdCBhCgkJ\nCQkvLyBwYXRoIHRyYXZlcnNhbCwgY2hlY2sgZm9yIG5lYXIgbWlzc2VzLgoJ\nCQkJQ29sbGVjdGlvbiBvcHRpb25zID0gZmluZE9wdGlvbnNGb3Iob2JqLmdl\ndENsYXNzKCkpOwoJCQkJU3RyaW5nIGNsb3NlID0gU3RyaW5nRGlzdGFuY2Uu\nZ2V0Q2xvc2VzdExldmVuc2h0ZWluRGlzdGFuY2UKCQkJCQkoZmlyc3QsIG9w\ndGlvbnMsIDAuNzVmKTsKCQkJCWlmIChjbG9zZSAhPSBudWxsKQoJCQkJCW1z\nZyA9IF9sb2MuZ2V0KCJpbnZhbGlkLWNvbmZpZy1wYXJhbS1oaW50IiwgbmV3\nIE9iamVjdFtdewoJCQkJCQljb25maWd1cmF0aW9uTmFtZSwgb2JqLmdldENs\nYXNzKCksIGZpcnN0LCBjbG9zZSwKCQkJCQkJb3B0aW9ucywgfSk7CgkJCX0K\nCiAgICAgICAgICAgIGlmIChtc2cgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgbXNnID0gX2xvYy5nZXQoImludmFsaWQtY29uZmlnLXBhcmFtcyIsIG5l\ndyBTdHJpbmdbXXsKICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9u\nTmFtZSwgb2JqLmdldENsYXNzKCkuZ2V0TmFtZSgpLAogICAgICAgICAgICAg\nICAgICAgIGludmFsaWRFbnRyaWVzLmtleVNldCgpLnRvU3RyaW5nKCksCiAg\nICAgICAgICAgICAgICAgICAgZmluZE9wdGlvbnNGb3Iob2JqLmdldENsYXNz\nKCkpLnRvU3RyaW5nKCksIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHRocm93IG5ldyBQYXJzZUV4Y2VwdGlvbihtc2cpOwogICAgICAgIH0KICAg\nICAgICBpZiAoY29uZmlndXJhYmxlICE9IG51bGwpCiAgICAgICAgICAgIGNv\nbmZpZ3VyYWJsZS5lbmRDb25maWd1cmF0aW9uKCk7CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgQ29sbGVjdGlvbiBmaW5kT3B0aW9uc0ZvcihDbGFzcyBj\nbHMpIHsKICAgICAgICBDb2xsZWN0aW9uIGMgPSBPcHRpb25zLmZpbmRPcHRp\nb25zRm9yKGNscyk7CiAgICAgICAgCiAgICAgICAgLy8gcmVtb3ZlIENvbmZp\nZ3VyYWJsZS5zZXRDb25maWd1cmF0aW9uKCkgYW5kIAogICAgICAgIC8vIEdl\nbmVyaWNDb25maWd1cmFibGUuc2V0SW50bygpIGZyb20gdGhlIHNldCwgaWYg\nYXBwbGljYWJsZS4KICAgICAgICBpZiAoQ29uZmlndXJhYmxlLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oY2xzKSkKICAgICAgICAgICAgYy5yZW1vdmUoIkNv\nbmZpZ3VyYXRpb24iKTsKICAgICAgICBpZiAoR2VuZXJpY0NvbmZpZ3VyYWJs\nZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGNscykpCiAgICAgICAgICAgIGMu\ncmVtb3ZlKCJJbnRvIik7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUdXJuIGEgc2V0IG9mIHByb3BlcnRpZXMg\naW50byBhIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmcuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgU3RyaW5nIHNlcmlhbGl6ZVByb3BlcnRpZXMoTWFwIG1h\ncCkgewogICAgICAgIGlmIChtYXAgPT0gbnVsbCB8fCBtYXAuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5nQnVm\nZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBNYXAuRW50\ncnkgZW50cnk7CiAgICAgICAgU3RyaW5nIHZhbDsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkg\naXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGJ1Zi5sZW5ndGgoKSA+IDAp\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAgICAg\nICBidWYuYXBwZW5kKGVudHJ5LmdldEtleSgpKS5hcHBlbmQoJz0nKTsKICAg\nICAgICAgICAgdmFsID0gU3RyaW5nLnZhbHVlT2YoZW50cnkuZ2V0VmFsdWUo\nKSk7CiAgICAgICAgICAgIGlmICh2YWwuaW5kZXhPZignLCcpICE9IC0xKQog\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgnIicpLmFwcGVuZCh2YWwpLmFw\ncGVuZCgnIicpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBi\ndWYuYXBwZW5kKHZhbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWYu\ndG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGEgc2V0\nIG9mIHByb3BlcnRpZXMgZnJvbSBhIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmcu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT3B0aW9ucyBwYXJzZVByb3Bl\ncnRpZXMoU3RyaW5nIHByb3BlcnRpZXMpIHsKICAgICAgICBPcHRpb25zIG9w\ndHMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgIHByb3BlcnRpZXMgPSBTdHJp\nbmdVdGlscy50cmltVG9OdWxsKHByb3BlcnRpZXMpOwogICAgICAgIGlmIChw\ncm9wZXJ0aWVzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBvcHRzOwoK\nICAgICAgICB0cnkgewogICAgICAgICAgICBTdHJpbmdbXSBwcm9wcyA9IFN0\ncmluZ3Muc3BsaXQocHJvcGVydGllcywgIiwiLCAwKTsKICAgICAgICAgICAg\naW50IGlkeDsKICAgICAgICAgICAgY2hhciBxdW90ZTsKICAgICAgICAgICAg\nU3RyaW5nIHByb3A7CiAgICAgICAgICAgIFN0cmluZyB2YWw7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIGlkeCA9IHByb3BzW2ldLmluZGV4T2YoJz0nKTsK\nICAgICAgICAgICAgICAgIGlmIChpZHggPT0gLTEpIHsKICAgICAgICAgICAg\nICAgICAgICAvLyBpZiB0aGUga2V5IGlzIG5vdCBhc3NpZ25lZCB0byBhbnkg\ndmFsdWUsIHNldCB0aGUKICAgICAgICAgICAgICAgICAgICAvLyB2YWx1ZSB0\nbyB0aGUgc2FtZSB0aGluZyBhcyB0aGUga2V5LCBhbmQgY29udGludWUuCiAg\nICAgICAgICAgICAgICAgICAgLy8gVGhpcyBwZXJtaXRzIEdlbmVyaWNDb25m\naWd1cmFibGUgaW5zdGFuY2VzIHRvCiAgICAgICAgICAgICAgICAgICAgLy8g\nYmVoYXZlIG1lYW5pbmdmdWxseS4gV2UgbWlnaHQgY29uc2lkZXIgc2V0dGlu\nZyB0aGUKICAgICAgICAgICAgICAgICAgICAvLyB2YWx1ZSB0byBzb21lIHdl\nbGwta25vd24gInZhbHVlIHdhcyBub3Qgc2V0LCBidXQKICAgICAgICAgICAg\nICAgICAgICAvLyBrZXkgaXMgcHJlc2VudCIgc3RyaW5nIHNvIHRoYXQgaW5z\ndGFuY2VzIGdldHRpbmcKICAgICAgICAgICAgICAgICAgICAvLyB2YWx1ZXMg\naW5qZWN0ZWQgY2FuIGRpZmZlcmVudGlhdGUgYmV0d2VlbiBhIG1lbnRpb25l\nZAogICAgICAgICAgICAgICAgICAgIC8vIHByb3BlcnR5IGFuZCBvbmUgc2V0\nIHRvIGEgcGFydGljdWxhciB2YWx1ZS4KICAgICAgICAgICAgICAgICAgICBw\ncm9wID0gcHJvcHNbaV07CiAgICAgICAgICAgICAgICAgICAgdmFsID0gcHJv\ncDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgcHJvcCA9IHByb3BzW2ldLnN1YnN0cmluZygwLCBpZHgpLnRyaW0oKTsK\nICAgICAgICAgICAgICAgICAgICB2YWwgPSBwcm9wc1tpXS5zdWJzdHJpbmco\naWR4ICsgMSkudHJpbSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgIC8vIGlmIHRoZSB2YWx1ZSBpcyBxdW90ZWQsIHJlYWQgdW50aWwg\ndGhlIGVuZCBxdW90ZQogICAgICAgICAgICAgICAgaWYgKCgodmFsLnN0YXJ0\nc1dpdGgoIlwiIikgJiYgdmFsLmVuZHNXaXRoKCJcIiIpKQogICAgICAgICAg\nICAgICAgICAgIHx8ICh2YWwuc3RhcnRzV2l0aCgiJyIpICYmIHZhbC5lbmRz\nV2l0aCgiJyIpKSkKICAgICAgICAgICAgICAgICAgICAmJiB2YWwubGVuZ3Ro\nKCkgPiAxKQogICAgICAgICAgICAgICAgICAgIHZhbCA9IHZhbC5zdWJzdHJp\nbmcoMSwgdmFsLmxlbmd0aCgpIC0gMSk7CiAgICAgICAgICAgICAgICBlbHNl\nIGlmICh2YWwuc3RhcnRzV2l0aCgiXCIiKSB8fCB2YWwuc3RhcnRzV2l0aCgi\nJyIpKSB7CiAgICAgICAgICAgICAgICAgICAgcXVvdGUgPSB2YWwuY2hhckF0\nKDApOwogICAgICAgICAgICAgICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBu\nZXcgU3RyaW5nQnVmZmVyKHZhbC5zdWJzdHJpbmcoMSkpOwogICAgICAgICAg\nICAgICAgICAgIGludCBxdW90SWR4OwogICAgICAgICAgICAgICAgICAgIHdo\naWxlICgrK2kgPCBwcm9wcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiLCIpOwoKICAgICAgICAgICAgICAgICAgICAg\nICAgcXVvdElkeCA9IHByb3BzW2ldLmluZGV4T2YocXVvdGUpOwogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAocXVvdElkeCAhPSAtMSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChwcm9wc1tpXS5zdWJz\ndHJpbmcoMCwgcXVvdElkeCkpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKHF1b3RJZHggKyAxIDwgcHJvcHNbaV0ubGVuZ3RoKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChwcm9wc1tp\nXS5zdWJzdHJpbmcocXVvdElkeCArIDEpKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQocHJv\ncHNbaV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICB2YWwgPSBidWYudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIG9wdHMucHV0KHByb3AsIHZhbCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIG9wdHM7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgUGFyc2VFeGNlcHRpb24oX2xvYy5nZXQoInByb3AtcGFyc2UiLCBwcm9w\nZXJ0aWVzKSwgcmUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIExvb2tzIHVwIHRoZSBnaXZlbiBuYW1lIGluIEpOREkuIElmIHRoZSBuYW1l\nIGlzIG51bGwsIG51bGwgaXMgcmV0dXJuZWQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgT2JqZWN0IGxvb2t1cChTdHJpbmcgbmFtZSkgewogICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgQ29udGV4dCBjdHggPSBudWxsOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGN0eCA9IG5ldyBJbml0aWFsQ29udGV4\ndCgpOwogICAgICAgICAgICByZXR1cm4gY3R4Lmxvb2t1cChuYW1lKTsKICAg\nICAgICB9IGNhdGNoIChOYW1pbmdFeGNlcHRpb24gbmUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IE5lc3RhYmxlUnVudGltZUV4Y2VwdGlvbigKICAgICAg\nICAgICAgICAgIF9sb2MuZ2V0KCJuYW1pbmctZXJyIiwgbmFtZSkuZ2V0TWVz\nc2FnZSgpLCBuZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\naWYgKGN0eCAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgY3R4LmNs\nb3NlKCk7IH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7fQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFRlc3Qgd2hldGhlciB0aGUgbWFwIGNvbnRh\naW5zIHRoZSBnaXZlbiBwYXJ0aWFsIGtleSwgcHJlZml4ZWQgd2l0aCBhbnkK\nICAgICAqIHBvc3NpYmxlIGNvbmZpZ3VyYXRpb24gcHJlZml4LgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gY29udGFpbnNQcm9wZXJ0eShT\ndHJpbmcgcGFydGlhbEtleSwgTWFwIHByb3BzKSB7CiAgICAgICAgaWYgKHBh\ncnRpYWxLZXkgPT0gbnVsbCB8fCBwcm9wcyA9PSBudWxsIHx8IHByb3BzLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgcmV0dXJuIHByb3BzLmNvbnRhaW5zS2V5KAogICAg\nICAgICAgICAgICAgUHJvZHVjdERlcml2YXRpb25zLmdldENvbmZpZ3VyYXRp\nb25LZXkocGFydGlhbEtleSwgcHJvcHMpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEdldCB0aGUgcHJvcGVydHkgdW5kZXIgdGhlIGdpdmVuIHBhcnRpYWwg\na2V5LCBwcmVmaXhlZCB3aXRoIGFueSBwb3NzaWJsZQogICAgICogY29uZmln\ndXJhdGlvbiBwcmVmaXguCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2Jq\nZWN0IGdldFByb3BlcnR5KFN0cmluZyBwYXJ0aWFsS2V5LCBNYXAgbSkgewog\nICAgICAgIGlmIChwYXJ0aWFsS2V5ID09IG51bGwgfHwgbSA9PSBudWxsIHx8\nIG0uaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBlbHNlIAogICAgICAgICAgICByZXR1cm4gbS5nZXQoUHJvZHVjdERlcml2\nYXRpb25zLmdldENvbmZpZ3VyYXRpb25LZXkocGFydGlhbEtleSwgbSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBwcm9wZXJ0eSB1bmRl\nciB0aGUgZ2l2ZW4gcGFydGlhbCBrZXksIHByZWZpeGVkIHdpdGggYW55CiAg\nICAgKiBwb3NzaWJsZSBjb25maWd1cmF0aW9uIHByZWZpeC4KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBPYmplY3QgcmVtb3ZlUHJvcGVydHkoU3RyaW5n\nIHBhcnRpYWxLZXksIE1hcCBwcm9wcykgewogICAgICAgIGlmIChwYXJ0aWFs\nS2V5ID09IG51bGwgfHwgcHJvcHMgPT0gbnVsbCB8fCBwcm9wcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBw\ncm9wcy5yZW1vdmUoUHJvZHVjdERlcml2YXRpb25zLmdldENvbmZpZ3VyYXRp\nb25LZXkocGFydGlhbEtleSwKICAgICAgICAgICAgcHJvcHMpKTsKICAgIH0K\nfQo=\n","encoding":"base64"}

