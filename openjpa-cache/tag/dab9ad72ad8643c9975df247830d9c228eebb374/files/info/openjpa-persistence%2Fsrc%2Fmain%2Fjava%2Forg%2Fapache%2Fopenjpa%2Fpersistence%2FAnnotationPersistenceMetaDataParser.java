{"sha":"e188fc2f6b5be90d2d404510e84106d1d24f3512","node_id":"MDQ6QmxvYjIwNjM2NDplMTg4ZmMyZjZiNWJlOTBkMmQ0MDQ1MTBlODQxMDZkMWQyNGYzNTEy","size":62785,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e188fc2f6b5be90d2d404510e84106d1d24f3512","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTWVtYmVyOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9k\nOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBq\nYXZhLm5ldC5VUklTeW50YXhFeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5V\nUkw7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLk1h\ncDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuVHJl\nZVNldDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkJhc2ljOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuQ2FzY2FkZVR5cGU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5FbWJlZGRhYmxlOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuRW1iZWRkZWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRl\nZElkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50aXR5OwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuRW50aXR5TGlzdGVuZXJzOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuRXhjbHVkZURlZmF1bHRMaXN0ZW5lcnM7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5FeGNsdWRlU3VwZXJjbGFzc0xpc3RlbmVy\nczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZldGNoVHlwZTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLkZsdXNoTW9kZVR5cGU7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5HZW5lcmF0ZWRWYWx1ZTsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlOwppbXBvcnQgc3RhdGljIGphdmF4\nLnBlcnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlLkFVVE87CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5JZDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLklk\nQ2xhc3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Mb2I7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5NYW55VG9NYW55OwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuTWFueVRvT25lOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nTWFwS2V5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFwcGVkU3VwZXJj\nbGFzczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0aXZlUXVl\ncmllczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0aXZlUXVl\ncnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJpZXM7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJ5OwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuT25lVG9NYW55OwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5PcmRl\nckJ5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdExvYWQ7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5Qb3N0UGVyc2lzdDsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLlBvc3RSZW1vdmU7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5Qb3N0VXBkYXRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJl\nUGVyc2lzdDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVJlbW92ZTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVVwZGF0ZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLlF1ZXJ5SGludDsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLlNlcXVlbmNlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuVmVyc2lvbjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25m\nLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmV2ZW50LkJlYW5MaWZlY3ljbGVDYWxsYmFja3M7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlQ2FsbGJhY2tzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50Lk1ldGhvZExpZmVjeWNs\nZUNhbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLmpwcWwuSlBRTFBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIuY29uZi5Db25maWd1cmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5KMkRvUHJpdjVIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLkRlbGVnYXRpbmdNZXRhRGF0YUZhY3Rvcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTGlmZWN5Y2xlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUZhY3Rv\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YU1v\nZGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFS\nZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuT3Jk\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlVwZGF0\nZVN0cmF0ZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5W\nYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuTWV0YURhdGFEZWZhdWx0czsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hl\nLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuKjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhj\nZXB0aW9uOwoKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2Vy\ncC51dGlsLlN0cmluZ3M7CgovKioKICogUGVyc2lzdGVuY2UgYW5ub3RhdGlv\nbiBtZXRhZGF0YSBwYXJzZXIuIEN1cnJlbnRseSBkb2VzIG5vdCBwYXJzZQog\nKiBkZXBsb3ltZW50IGRlc2NyaXB0b3JzLgogKgogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpw\ndWJsaWMgY2xhc3MgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJz\nZXIKICAgIGltcGxlbWVudHMgTWV0YURhdGFNb2RlcyB7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9y\nUGFja2FnZQogICAgICAgIChBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0\nYVBhcnNlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFw\nPENsYXNzLCBNZXRhRGF0YVRhZz4gX3RhZ3MgPQogICAgICAgIG5ldyBIYXNo\nTWFwPENsYXNzLCBNZXRhRGF0YVRhZz4oKTsKCiAgICBzdGF0aWMgewogICAg\nICAgIF90YWdzLnB1dChFbWJlZGRlZElkLmNsYXNzLCBFTUJFRERFRF9JRCk7\nCiAgICAgICAgX3RhZ3MucHV0KEVudGl0eUxpc3RlbmVycy5jbGFzcywgRU5U\nSVRZX0xJU1RFTkVSUyk7CiAgICAgICAgX3RhZ3MucHV0KEV4Y2x1ZGVEZWZh\ndWx0TGlzdGVuZXJzLmNsYXNzLCBFWENMVURFX0RFRkFVTFRfTElTVEVORVJT\nKTsKICAgICAgICBfdGFncy5wdXQoRXhjbHVkZVN1cGVyY2xhc3NMaXN0ZW5l\ncnMuY2xhc3MsCiAgICAgICAgICAgIEVYQ0xVREVfU1VQRVJDTEFTU19MSVNU\nRU5FUlMpOwogICAgICAgIF90YWdzLnB1dChGbHVzaE1vZGVUeXBlLmNsYXNz\nLCBGTFVTSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQoR2VuZXJhdGVkVmFs\ndWUuY2xhc3MsIEdFTkVSQVRFRF9WQUxVRSk7CiAgICAgICAgX3RhZ3MucHV0\nKElkLmNsYXNzLCBJRCk7CiAgICAgICAgX3RhZ3MucHV0KElkQ2xhc3MuY2xh\nc3MsIElEX0NMQVNTKTsKICAgICAgICBfdGFncy5wdXQoTWFwS2V5LmNsYXNz\nLCBNQVBfS0VZKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWROYXRpdmVRdWVy\naWVzLmNsYXNzLCBOQVRJVkVfUVVFUklFUyk7CiAgICAgICAgX3RhZ3MucHV0\nKE5hbWVkTmF0aXZlUXVlcnkuY2xhc3MsIE5BVElWRV9RVUVSWSk7CiAgICAg\nICAgX3RhZ3MucHV0KE5hbWVkUXVlcmllcy5jbGFzcywgUVVFUklFUyk7CiAg\nICAgICAgX3RhZ3MucHV0KE5hbWVkUXVlcnkuY2xhc3MsIFFVRVJZKTsKICAg\nICAgICBfdGFncy5wdXQoT3JkZXJCeS5jbGFzcywgT1JERVJfQlkpOwogICAg\nICAgIF90YWdzLnB1dChQb3N0TG9hZC5jbGFzcywgUE9TVF9MT0FEKTsKICAg\nICAgICBfdGFncy5wdXQoUG9zdFBlcnNpc3QuY2xhc3MsIFBPU1RfUEVSU0lT\nVCk7CiAgICAgICAgX3RhZ3MucHV0KFBvc3RSZW1vdmUuY2xhc3MsIFBPU1Rf\nUkVNT1ZFKTsKICAgICAgICBfdGFncy5wdXQoUG9zdFVwZGF0ZS5jbGFzcywg\nUE9TVF9VUERBVEUpOwogICAgICAgIF90YWdzLnB1dChQcmVQZXJzaXN0LmNs\nYXNzLCBQUkVfUEVSU0lTVCk7CiAgICAgICAgX3RhZ3MucHV0KFByZVJlbW92\nZS5jbGFzcywgUFJFX1JFTU9WRSk7CiAgICAgICAgX3RhZ3MucHV0KFByZVVw\nZGF0ZS5jbGFzcywgUFJFX1VQREFURSk7CiAgICAgICAgX3RhZ3MucHV0KFNl\ncXVlbmNlR2VuZXJhdG9yLmNsYXNzLCBTRVFfR0VORVJBVE9SKTsKICAgICAg\nICBfdGFncy5wdXQoVmVyc2lvbi5jbGFzcywgVkVSU0lPTik7CiAgICAgICAg\nX3RhZ3MucHV0KERhdGFDYWNoZS5jbGFzcywgREFUQV9DQUNIRSk7CiAgICAg\nICAgX3RhZ3MucHV0KERhdGFTdG9yZUlkLmNsYXNzLCBEQVRBU1RPUkVfSUQp\nOwogICAgICAgIF90YWdzLnB1dChEZXBlbmRlbnQuY2xhc3MsIERFUEVOREVO\nVCk7CiAgICAgICAgX3RhZ3MucHV0KERldGFjaGVkU3RhdGUuY2xhc3MsIERF\nVEFDSEVEX1NUQVRFKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudERlcGVu\nZGVudC5jbGFzcywgRUxFTV9ERVBFTkRFTlQpOwogICAgICAgIF90YWdzLnB1\ndChFbGVtZW50VHlwZS5jbGFzcywgRUxFTV9UWVBFKTsKICAgICAgICBfdGFn\ncy5wdXQoRXh0ZXJuYWxWYWx1ZXMuY2xhc3MsIEVYVEVSTkFMX1ZBTFMpOwog\nICAgICAgIF90YWdzLnB1dChFeHRlcm5hbGl6ZXIuY2xhc3MsIEVYVEVSTkFM\nSVpFUik7CiAgICAgICAgX3RhZ3MucHV0KEZhY3RvcnkuY2xhc3MsIEZBQ1RP\nUlkpOwogICAgICAgIF90YWdzLnB1dChGZXRjaEdyb3VwLmNsYXNzLCBGRVRD\nSF9HUk9VUCk7CiAgICAgICAgX3RhZ3MucHV0KEZldGNoR3JvdXBzLmNsYXNz\nLCBGRVRDSF9HUk9VUFMpOwogICAgICAgIF90YWdzLnB1dChJbnZlcnNlTG9n\naWNhbC5jbGFzcywgSU5WRVJTRV9MT0dJQ0FMKTsKICAgICAgICBfdGFncy5w\ndXQoS2V5RGVwZW5kZW50LmNsYXNzLCBLRVlfREVQRU5ERU5UKTsKICAgICAg\nICBfdGFncy5wdXQoS2V5VHlwZS5jbGFzcywgS0VZX1RZUEUpOwogICAgICAg\nIF90YWdzLnB1dChMb2FkRmV0Y2hHcm91cC5jbGFzcywgTE9BRF9GRVRDSF9H\nUk9VUCk7CiAgICAgICAgX3RhZ3MucHV0KExSUy5jbGFzcywgTFJTKTsKICAg\nICAgICBfdGFncy5wdXQoUmVhZE9ubHkuY2xhc3MsIFJFQURfT05MWSk7CiAg\nICAgICAgX3RhZ3MucHV0KFR5cGUuY2xhc3MsIFRZUEUpOwogICAgfQoKICAg\nIHByaXZhdGUgZmluYWwgT3BlbkpQQUNvbmZpZ3VyYXRpb24gX2NvbmY7CiAg\nICBwcml2YXRlIGZpbmFsIExvZyBfbG9nOwogICAgcHJpdmF0ZSBNZXRhRGF0\nYVJlcG9zaXRvcnkgX3JlcG9zID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NM\nb2FkZXIgX2VudkxvYWRlciA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4g\nX292ZXJyaWRlID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfbW9kZSA9IE1P\nREVfTk9ORTsKCiAgICAvLyBwYWNrYWdlcyBhbmQgdGhlaXIgcGFyc2UgbW9k\nZXMKICAgIHByaXZhdGUgZmluYWwgTWFwPFBhY2thZ2UsIEludGVnZXI+IF9w\na2dzID0gbmV3IEhhc2hNYXA8UGFja2FnZSwgSW50ZWdlcj4oKTsKCiAgICAv\nLyB0aGUgY2xhc3Mgd2Ugd2VyZSBpbnZva2VkIHRvIHBhcnNlCiAgICBwcml2\nYXRlIENsYXNzIF9jbHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWxlIF9maWxl\nID0gbnVsbDsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBzdXBwbHkg\nY29uZmlndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIEFubm90YXRpb25Q\nZXJzaXN0ZW5jZU1ldGFEYXRhUGFyc2VyKE9wZW5KUEFDb25maWd1cmF0aW9u\nIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2xvZyA9\nIGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19NRVRBREFU\nQSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25maWd1cmF0aW9uIHN1cHBs\naWVkIG9uIGNvbnN0cnVjdGlvbi4KICAgICAqLwogICAgcHVibGljIE9wZW5K\nUEFDb25maWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAg\ncmV0dXJuIF9jb25mOwogICAgfQoKICAgIC8qKgogICAgICogTWV0YWRhdGEg\nbG9nLgogICAgICovCiAgICBwdWJsaWMgTG9nIGdldExvZygpIHsKICAgICAg\nICByZXR1cm4gX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMg\ndGhlIHJlcG9zaXRvcnkgZm9yIHRoaXMgcGFyc2VyLiBJZiBub25lIGhhcyBi\nZWVuIHNldCwKICAgICAqIGNyZWF0ZSBhIG5ldyByZXBvc2l0b3J5IGFuZCBz\nZXRzIGl0LgogICAgICovCiAgICBwdWJsaWMgTWV0YURhdGFSZXBvc2l0b3J5\nIGdldFJlcG9zaXRvcnkoKSB7CiAgICAgICAgaWYgKF9yZXBvcyA9PSBudWxs\nKSB7CiAgICAgICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9j\nb25mLm5ld01ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAg\nICAgIE1ldGFEYXRhRmFjdG9yeSBtZGYgPSByZXBvcy5nZXRNZXRhRGF0YUZh\nY3RvcnkoKTsKICAgICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9mIERlbGVn\nYXRpbmdNZXRhRGF0YUZhY3RvcnkpCiAgICAgICAgICAgICAgICBtZGYgPSAo\nKERlbGVnYXRpbmdNZXRhRGF0YUZhY3RvcnkpIG1kZikuZ2V0SW5uZXJtb3N0\nRGVsZWdhdGUoKTsKICAgICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9mIFBl\ncnNpc3RlbmNlTWV0YURhdGFGYWN0b3J5KQogICAgICAgICAgICAgICAgKChQ\nZXJzaXN0ZW5jZU1ldGFEYXRhRmFjdG9yeSkgbWRmKS5zZXRBbm5vdGF0aW9u\nUGFyc2VyKHRoaXMpOwogICAgICAgICAgICBfcmVwb3MgPSByZXBvczsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIF9yZXBvczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgbWV0YWRhdGEgcmVwb3NpdG9yeSBmb3IgdGhpcyBw\nYXJzZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlcG9zaXRvcnko\nTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgX3JlcG9zID0g\ncmVwb3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGVudmly\nb25tZW50YWwgY2xhc3MgbG9hZGVyIHRvIHBhc3Mgb24gdG8gcGFyc2VkCiAg\nICAgKiBtZXRhZGF0YSBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHB1YmxpYyBD\nbGFzc0xvYWRlciBnZXRFbnZDbGFzc0xvYWRlcigpIHsKICAgICAgICByZXR1\ncm4gX2VudkxvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\nZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIgdG8gcGFzcyBvbiB0byBwYXJz\nZWQKICAgICAqIG1ldGFkYXRhIGluc3RhbmNlcy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0RW52Q2xhc3NMb2FkZXIoQ2xhc3NMb2FkZXIgbG9hZGVy\nKSB7CiAgICAgICAgX2VudkxvYWRlciA9IGxvYWRlcjsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgdG8gYWxsb3cgbGF0ZXIgcGFyc2VzIG9mIG1h\ncHBpbmcgaW5mb3JtYXRpb24gdG8gb3ZlcnJpZGUKICAgICAqIGVhcmxpZXIg\naW5mb3JtYXRpb24gZm9yIHRoZSBzYW1lIGNsYXNzLiBEZWZhdWx0cyB0byBm\nYWxzZS4gVXNlZnVsCiAgICAgKiB3aGVuIGEgdG9vbCBpcyBtYXBwaW5nIGEg\nY2xhc3MsIHNvIHRoYXQgYW5ub3RhdGlvbiBwYXJ0aWFsIG1hcHBpbmcKICAg\nICAqIGluZm9ybWF0aW9uIGNhbiBiZSB1c2VkIGV2ZW4gd2hlbiBtYXBwaW5n\ncyBhcmUgc3RvcmVkIGluIGFub3RoZXIKICAgICAqIGxvY2F0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRNYXBwaW5nT3ZlcnJpZGUoKSB7\nCiAgICAgICAgcmV0dXJuIF9vdmVycmlkZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgdG8gYWxsb3cgbGF0ZXIgcGFyc2VzIG9mIG1hcHBpbmcg\naW5mb3JtYXRpb24gdG8gb3ZlcnJpZGUKICAgICAqIGVhcmxpZXIgaW5mb3Jt\nYXRpb24gZm9yIHRoZSBzYW1lIGNsYXNzLiBEZWZhdWx0cyB0byBmYWxzZS4g\nVXNlZnVsCiAgICAgKiB3aGVuIGEgdG9vbCBpcyBtYXBwaW5nIGEgY2xhc3Ms\nIHNvIHRoYXQgYW5ub3RhdGlvbiBwYXJ0aWFsIG1hcHBpbmcKICAgICAqIGlu\nZm9ybWF0aW9uIGNhbiBiZSB1c2VkIGV2ZW4gd2hlbiBtYXBwaW5ncyBhcmUg\nc3RvcmVkIGluIGFub3RoZXIKICAgICAqIGxvY2F0aW9uLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRNYXBwaW5nT3ZlcnJpZGUoYm9vbGVhbiBvdmVy\ncmlkZSkgewogICAgICAgIF9vdmVycmlkZSA9IG92ZXJyaWRlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHBhcnNlIG1vZGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBpbnQgZ2V0TW9kZSgpIHsKICAgICAgICByZXR1cm4gX21vZGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgcGFyc2UgbW9kZS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0TW9kZShpbnQgbW9kZSwgYm9vbGVhbiBvbikg\newogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAgICAgICAgICAg\nX21vZGUgPSBNT0RFX05PTkU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAg\nICAgICAgIF9tb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfbW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBw\nYXJzZSBtb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNb2RlKGlu\ndCBtb2RlKSB7CiAgICAgICAgX21vZGUgPSBtb2RlOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBpbnRlcnByZXRpbmcg\ne0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xl\nYW4gaXNNZXRhRGF0YU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIChfbW9kZSAm\nIE1PREVfTUVUQSkgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZl\nbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0TW9k\nZX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzUXVlcnlNb2Rl\nKCkgewogICAgICAgIHJldHVybiAoX21vZGUgJiBNT0RFX1FVRVJZKSAhPSAw\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZv\nciBpbnRlcnByZXRpbmcge0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIGJvb2xlYW4gaXNNYXBwaW5nTW9kZSgpIHsKICAgICAgICBy\nZXR1cm4gKF9tb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHdlJ3JlIGluIG1hcHBpbmcg\nbW9kZSBvciBpbiBtZXRhZGF0YSBtb2RlIHdpdGgKICAgICAqIG1hcHBpbmcg\nb3ZlcmlkZSBlbmFibGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBpc01hcHBpbmdPdmVycmlkZU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIGlz\nTWFwcGluZ01vZGUoKSB8fCAoX292ZXJyaWRlICYmIGlzTWV0YURhdGFNb2Rl\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgY2FjaGVzLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICBfY2xzID0g\nbnVsbDsKICAgICAgICBfZmlsZSA9IG51bGw7CiAgICAgICAgX3BrZ3MuY2xl\nYXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHBlcnNpc3RlbmNl\nIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHBhcnNlKENsYXNzIGNscykgewogICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xv\nYy5nZXQoInBhcnNlLWNsYXNzIiwgY2xzLmdldE5hbWUoKSkpOwoKICAgICAg\nICBfY2xzID0gY2xzOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBhcnNl\nUGFja2FnZUFubm90YXRpb25zKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURh\ndGEgbWV0YSA9IHBhcnNlQ2xhc3NBbm5vdGF0aW9ucygpOwogICAgICAgICAg\nICB1cGRhdGVTb3VyY2VNb2RlKG1ldGEpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIF9jbHMgPSBudWxsOwogICAgICAgICAgICBfZmlsZSA9\nIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRl\nIHRoZSBzb3VyY2UgbW9kZSB0byB0aGUgY2xhc3MgcGFja2FnZSBhbmQgY2xh\nc3MgdG8gaW5kaWNhdGUgdGhhdAogICAgICogd2UndmUgZnVsbHkgcGFyc2Vk\nIHRoZW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB1cGRhdGVTb3VyY2VN\nb2RlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChfY2xzLmdl\ndFBhY2thZ2UoKSAhPSBudWxsKQogICAgICAgICAgICBhZGRTb3VyY2VNb2Rl\nKF9jbHMuZ2V0UGFja2FnZSgpLCBfbW9kZSk7CiAgICAgICAgaWYgKG1ldGEg\nIT0gbnVsbCkKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKF9tb2Rl\nLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGluZm9ybWF0\naW9uIGluIHBhY2thZ2UtbGV2ZWwgY2xhc3MgYW5ub3RhdGlvbnMuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVBhY2thZ2VBbm5vdGF0aW9ucygp\nIHsKICAgICAgICBQYWNrYWdlIHBrZyA9IF9jbHMuZ2V0UGFja2FnZSgpOwog\nICAgICAgIGlmIChwa2cgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBpbnQgcGtnTW9kZSA9IGdldFNvdXJjZU1vZGUocGtnKTsKICAg\nICAgICBpZiAocGtnTW9kZSA9PSAwICYmIF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGFyc2UtcGFj\na2FnZSIsIF9jbHMuZ2V0TmFtZSgpKSk7CiAgICAgICAgaWYgKChwa2dNb2Rl\nICYgX21vZGUpID09IF9tb2RlKSAvLyBhbHJlYWR5IHZpc2l0ZWQKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBNZXRhRGF0YVRhZyB0YWc7CiAgICAg\nICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBwa2cuZ2V0RGVjbGFyZWRBbm5v\ndGF0aW9ucygpKSB7CiAgICAgICAgICAgIHRhZyA9IF90YWdzLmdldChhbm5v\nLmFubm90YXRpb25UeXBlKCkpOwogICAgICAgICAgICBpZiAodGFnID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGhhbmRsZVVua25vd25QYWNrYWdlQW5u\nb3RhdGlvbihwa2csIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAg\nICAgICAgICAgICAgICBjYXNlIE5BVElWRV9RVUVSSUVTOgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChwa2dNb2RlICYgTU9E\nRV9RVUVSWSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VO\nYW1lZE5hdGl2ZVF1ZXJpZXMocGtnLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKChOYW1lZE5hdGl2ZVF1ZXJpZXMpIGFubm8pLnZhbHVlKCkpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBOQVRJVkVfUVVFUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVl\ncnlNb2RlKCkgJiYgKHBrZ01vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAg\nICAgICAgICAgICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZlUXVlcmllcyhw\na2csIChOYW1lZE5hdGl2ZVF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUklFUzoKICAg\nICAgICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAocGtnTW9k\nZSAmIE1PREVfUVVFUlkpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAg\nIHBhcnNlTmFtZWRRdWVyaWVzKHBrZywgKChOYW1lZFF1ZXJpZXMpIGFubm8p\nLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBRVUVSWToKICAgICAgICAgICAgICAgICAgICBpZiAo\naXNRdWVyeU1vZGUoKSAmJiAocGtnTW9kZSAmIE1PREVfUVVFUlkpID09IDAp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKHBr\nZywgKE5hbWVkUXVlcnkpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTRVFfR0VORVJBVE9SOgogICAg\nICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSAm\nJgogICAgICAgICAgICAgICAgICAgICAgICAocGtnTW9kZSAmIE1PREVfTUFQ\nUElORykgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VTZXF1\nZW5jZUdlbmVyYXRvcihwa2csIChTZXF1ZW5jZUdlbmVyYXRvcikgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBwa2csCiAg\nICAgICAgICAgICAgICAgICAgICAgIGFubm8udG9TdHJpbmcoKSkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBhbHdheXMgcGFyc2Ug\nbWFwcGluZyBzdHVmZiBhZnRlciBtZXRhZGF0YSBzdHVmZiwgaW4gY2FzZSB0\naGVyZSBhcmUKICAgICAgICAvLyBkZXBlbmRlbmNpZXMgb24gbWV0YWRhdGEK\nICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgKHBrZ01v\nZGUgJiBNT0RFX01BUFBJTkcpID09IDApCiAgICAgICAgICAgIHBhcnNlUGFj\na2FnZU1hcHBpbmdBbm5vdGF0aW9ucyhwa2cpOwogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2UgcGFja2FnZSBtYXBwaW5nIGFubm90YXRpb25zLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZVBhY2thZ2VNYXBwaW5nQW5u\nb3RhdGlvbnMoUGFja2FnZSBwa2cpIHsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFsbG93IHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVua25vd24gYW5ub3RhdGlv\nbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhhbmRsZVVua25v\nd25QYWNrYWdlQW5ub3RhdGlvbihQYWNrYWdlIHBrZywKICAgICAgICBBbm5v\ndGF0aW9uIGFubm8pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZm9yIHRoZSBnaXZlbiBw\nYWNrYWdlLgogICAgICovCiAgICBwcml2YXRlIGludCBnZXRTb3VyY2VNb2Rl\nKFBhY2thZ2UgcGtnKSB7CiAgICAgICAgTnVtYmVyIG51bSA9IF9wa2dzLmdl\ndChwa2cpOwogICAgICAgIHJldHVybiAobnVtID09IG51bGwpID8gMCA6IG51\nbS5pbnRWYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRvIHRo\nZSBzb3VyY2UgbW9kZSBmb3IgdGhlIGdpdmVuIHBhY2thZ2UuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRTb3VyY2VNb2RlKFBhY2thZ2UgcGtnLCBp\nbnQgbW9kZSkgewogICAgICAgIEludGVnZXIgbnVtID0gX3BrZ3MuZ2V0KHBr\nZyk7CiAgICAgICAgaWYgKG51bSA9PSBudWxsKQogICAgICAgICAgICBudW0g\nPSBOdW1iZXJzLnZhbHVlT2YobW9kZSk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBudW0gPSBOdW1iZXJzLnZhbHVlT2YobnVtLmludFZhbHVlKCkgfCBt\nb2RlKTsKICAgICAgICBfcGtncy5wdXQocGtnLCBudW0pOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVhZCBhbm5vdGF0aW9ucyBmb3IgdGhlIGN1cnJlbnQg\ndHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIHBhcnNl\nQ2xhc3NBbm5vdGF0aW9ucygpIHsKICAgICAgICAvLyBjaGVjayBpbW1lZGlh\ndGVseSB3aGV0aGVyIHRoZSB1c2VyIGlzIHVzaW5nIGFueSBhbm5vdGF0aW9u\ncywKICAgICAgICAvLyByZWdhcmRsZXNzIG9mIG1vZGUuICB0aGlzIHByZXZl\nbnRzIGFkZGluZyBub24tZW50aXR5IGNsYXNzZXMgdG8KICAgICAgICAvLyBy\nZXBvc2l0b3J5IGlmIHdlJ3JlIGlnbm9yaW5nIHRoZXNlIGFubm90YXRpb25z\nIGluIG1hcHBpbmcgbW9kZQogICAgICAgIGlmICghKChCb29sZWFuKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdjVIZWxwZXIKICAg\nICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNlbnRBY3Rpb24oX2NscywgRW50\naXR5LmNsYXNzKSkpLmJvb2xlYW5WYWx1ZSgpCiAgICAgICAgICAgICYmICEo\nKEJvb2xlYW4pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Q\ncml2NUhlbHBlcgogICAgICAgICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNl\nbnRBY3Rpb24oX2NscywgRW1iZWRkYWJsZS5jbGFzcykpKQogICAgICAgICAg\nICAgICAgLmJvb2xlYW5WYWx1ZSgpCiAgICAgICAgICAgICYmICEoKEJvb2xl\nYW4pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2NUhl\nbHBlcgogICAgICAgICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNlbnRBY3Rp\nb24oX2NscywgTWFwcGVkU3VwZXJjbGFzcy5jbGFzcykpKQogICAgICAgICAg\nICAgICAgLmJvb2xlYW5WYWx1ZSgpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgLy8gZmluZCAvIGNyZWF0ZSBtZXRhZGF0YQogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IGdldE1ldGFEYXRhKCk7CiAgICAgICAg\naWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIEVudGl0eSBlbnRpdHkgPSAoRW50aXR5KSBfY2xzLmdldEFubm90\nYXRpb24oRW50aXR5LmNsYXNzKTsKICAgICAgICBpZiAoaXNNZXRhRGF0YU1v\nZGUoKSkgewogICAgICAgICAgICAvLyB3aGlsZSB0aGUgc3BlYyBvbmx5IHBy\nb3ZpZGVzIGZvciBlbWJlZGRlZCBleGNsdXNpdmUsIGl0IGRvZXNuJ3QKICAg\nICAgICAgICAgLy8gc2VlbSBoYXJkIHRvIHN1cHBvcnQgb3RoZXJ3aXNlCiAg\nICAgICAgICAgIGlmIChlbnRpdHkgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIG1ldGEuc2V0RW1iZWRkZWRPbmx5KHRydWUpOwogICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgIG1ldGEuc2V0RW1iZWRkZWRPbmx5KGZhbHNl\nKTsKICAgICAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShl\nbnRpdHkubmFtZSgpKSkKICAgICAgICAgICAgICAgICAgICBtZXRhLnNldFR5\ncGVBbGlhcyhlbnRpdHkubmFtZSgpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgLy8gdHJhY2sgZmV0Y2ggZ3JvdXBzIHRvIHBhcnNlIHRo\nZW0gYWZ0ZXIgZmllbGRzLCBzaW5jZSB0aGV5CiAgICAgICAgLy8gcmVseSBv\nbiBmaWVsZCBtZXRhZGF0YQogICAgICAgIEZldGNoR3JvdXBbXSBmZ3MgPSBu\ndWxsOwogICAgICAgIERldGFjaGVkU3RhdGUgZGV0YWNoZWQgPSBudWxsOwoK\nICAgICAgICAvLyB0cmFjayBsaXN0ZW5lcnMgc2luY2Ugd2UgbmVlZCB0byBt\nZXJnZSB0aGVtIHdpdGggZW50aXR5IGNhbGxiYWNrcwogICAgICAgIENvbGxl\nY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdIGxpc3RlbmVycyA9IG51bGw7\nCiAgICAgICAgTWV0YURhdGFUYWcgdGFnOwogICAgICAgIGZvciAoQW5ub3Rh\ndGlvbiBhbm5vIDogX2Nscy5nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsK\nICAgICAgICAgICAgdGFnID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5\ncGUoKSk7CiAgICAgICAgICAgIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaGFuZGxlVW5rbm93bkNsYXNzQW5ub3RhdGlvbihtZXRhLCBh\nbm5vKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAg\nY2FzZSBFTlRJVFlfTElTVEVORVJTOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBs\naXN0ZW5lcnMgPSBwYXJzZUVudGl0eUxpc3RlbmVycyhtZXRhLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKEVudGl0eUxpc3RlbmVycykgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEVYQ0xVREVfREVGQVVMVF9MSVNURU5FUlM6CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIG1ldGEuZ2V0TGlmZWN5Y2xlTWV0YURhdGEoKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgLnNldElnbm9yZVN5c3RlbUxpc3RlbmVycyh0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgRVhDTFVERV9TVVBFUkNMQVNTX0xJU1RFTkVSUzoKICAgICAg\nICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgbWV0YS5nZXRMaWZlY3ljbGVNZXRhRGF0YSgpLnNl\ndElnbm9yZVN1cGVyY2xhc3NDYWxsYmFja3MKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIChMaWZlY3ljbGVNZXRhRGF0YS5JR05PUkVfSElHSCk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEZMVVNIX01PREU6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURh\ndGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5GbHVzaE1v\nZGUobWV0YSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIElEX0NMQVNTOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBt\nZXRhLnNldE9iamVjdElkVHlwZSgoKElkQ2xhc3MpIGFubm8pLnZhbHVlKCks\nIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBOQVRJVkVfUVVFUklFUzoKICAgICAgICAgICAgICAgICAg\nICBpZiAoaXNRdWVyeU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\ncGFyc2VOYW1lZE5hdGl2ZVF1ZXJpZXMoX2NscywKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICgoTmFtZWROYXRpdmVRdWVyaWVzKSBhbm5vKS52YWx1\nZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgTkFUSVZFX1FVRVJZOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc1F1ZXJ5TW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJz\nZU5hbWVkTmF0aXZlUXVlcmllcyhfY2xzLCAoTmFtZWROYXRpdmVRdWVyeSkg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIFFVRVJJRVM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlz\nUXVlcnlNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFt\nZWRRdWVyaWVzKF9jbHMsICgoTmFtZWRRdWVyaWVzKSBhbm5vKS52YWx1ZSgp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgUVVFUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlN\nb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVy\naWVzKF9jbHMsIChOYW1lZFF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU0VRX0dFTkVSQVRP\nUjoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVN\nb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlU2VxdWVuY2VH\nZW5lcmF0b3IoX2NscywgKFNlcXVlbmNlR2VuZXJhdG9yKSBhbm5vKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nREFUQV9DQUNIRToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0\nYU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VEYXRhQ2Fj\naGUobWV0YSwgKERhdGFDYWNoZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIERBVEFTVE9SRV9JRDoK\nICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgcGFyc2VEYXRhU3RvcmVJZChtZXRhLCAo\nRGF0YVN0b3JlSWQpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBERVRBQ0hFRF9TVEFURToKICAgICAg\nICAgICAgICAgICAgICBkZXRhY2hlZCA9IChEZXRhY2hlZFN0YXRlKSBhbm5v\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBGRVRDSF9HUk9VUDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZmdzID0g\nbmV3IEZldGNoR3JvdXBbXXsgKEZldGNoR3JvdXApIGFubm8gfTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkVU\nQ0hfR1JPVVBTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmZ3MgPSAoKEZldGNo\nR3JvdXBzKSBhbm5vKS52YWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQo\nInVuc3VwcG9ydGVkIiwgX2NscywKICAgICAgICAgICAgICAgICAgICAgICAg\nYW5uby50b1N0cmluZygpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKSB7CiAgICAgICAgICAgIHBh\ncnNlRGV0YWNoZWRTdGF0ZShtZXRhLCBkZXRhY2hlZCk7CgogICAgICAgICAg\nICAvLyBtZXJnZSBjYWxsYmFjayBtZXRob2RzIHdpdGggZGVjbGFyZWQgbGlz\ndGVuZXJzCiAgICAgICAgICAgIGludFtdIGhpZ2hzID0gbnVsbDsKICAgICAg\nICAgICAgaWYgKGxpc3RlbmVycyAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBoaWdocyA9IG5ldyBpbnRbbGlzdGVuZXJzLmxlbmd0aF07CiAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXJzW2ldICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hzW2ldID0gbGlz\ndGVuZXJzW2ldLnNpemUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZWNvcmRDYWxsYmFja3MobWV0YSwgcGFyc2VDYWxsYmFja01ldGhvZHMoX2Ns\ncywgbGlzdGVuZXJzLCBmYWxzZSwKICAgICAgICAgICAgICAgIGZhbHNlLCBn\nZXRSZXBvc2l0b3J5KCkpLCBoaWdocywgZmFsc2UpOwoKICAgICAgICAgICAg\nLy8gc2NhbiBwb3NzaWJseSBub24tUEMgaGllcmFyY2h5IGZvciBjYWxsYmFj\na3MuCiAgICAgICAgICAgIC8vIHJlZHVuZGFudCBmb3IgUEMgc3VwZXJjbGFz\ncyBidXQgd2UgZG9uJ3Qga25vdyB0aGF0IHlldAogICAgICAgICAgICAvLyBz\nbyBsZXQgTGlmZWN5Y2xlTWV0YURhdGEgZGV0ZXJtaW5lIHRoYXQKICAgICAg\nICAgICAgaWYgKCFPYmplY3QuY2xhc3MuZXF1YWxzKF9jbHMuZ2V0U3VwZXJj\nbGFzcygpKSkgewogICAgICAgICAgICAgICAgcmVjb3JkQ2FsbGJhY2tzKG1l\ndGEsIHBhcnNlQ2FsbGJhY2tNZXRob2RzKF9jbHMuZ2V0U3VwZXJjbGFzcygp\nLAogICAgICAgICAgICAgICAgICAgIG51bGwsIHRydWUsIGZhbHNlLCBnZXRS\nZXBvc2l0b3J5KCkpLCBudWxsLCB0cnVlKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IG1ldGEu\nZ2V0RGVjbGFyZWRGaWVsZHMoKSkKICAgICAgICAgICAgaWYgKGZtZC5nZXRN\nYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVO\nVCkKICAgICAgICAgICAgICAgIHBhcnNlTWVtYmVyQW5ub3RhdGlvbnMoZm1k\nKTsKICAgICAgICAvLyBwYXJzZSBmZXRjaCBncm91cHMgYWZ0ZXIgZmllbGRz\nCiAgICAgICAgaWYgKGZncyAhPSBudWxsKQogICAgICAgICAgICBwYXJzZUZl\ndGNoR3JvdXBzKG1ldGEsIGZncyk7CgogICAgICAgIC8vIGFsd2F5cyBwYXJz\nZSBtYXBwaW5nIGFmdGVyIG1ldGFkYXRhIGluIGNhc2UgdGhlcmUgYXJlIGRl\ncGVuZGVuY2llcwogICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUo\nKSkgewogICAgICAgICAgICBwYXJzZUNsYXNzTWFwcGluZ0Fubm90YXRpb25z\nKG1ldGEpOwogICAgICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDog\nbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpKQogICAgICAgICAgICAgICAgaWYg\nKGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0Vf\nUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgICAgICBwYXJzZU1lbWJlck1h\ncHBpbmdBbm5vdGF0aW9ucyhmbWQpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGNsYXNzIG1h\ncHBpbmcgYW5ub3RhdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIHBhcnNlQ2xhc3NNYXBwaW5nQW5ub3RhdGlvbnMoQ2xhc3NNZXRhRGF0YSBt\nZXRhKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFzc2Vz\nIHRvIGhhbmRsZSB1bmtub3duIGFubm90YXRpb25zLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgYm9vbGVhbiBoYW5kbGVVbmtub3duQ2xhc3NBbm5vdGF0aW9u\nKENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBBbm5vdGF0aW9uIGFubm8p\nIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBGaW5kIG9yIGNyZWF0ZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIHR5cGUu\nIE1heSByZXR1cm4gbnVsbCBpZgogICAgICogdGhpcyBjbGFzcyBoYXMgYWxy\nZWFkeSBiZWVuIHBhcnNlZCBmdWxseS4KICAgICAqLwogICAgcHJpdmF0ZSBD\nbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhKCkgewogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5nZXRDYWNoZWRNZXRhRGF0\nYShfY2xzKTsKICAgICAgICBpZiAobWV0YSAhPSBudWxsICYmCiAgICAgICAg\nICAgICgoaXNNZXRhRGF0YU1vZGUoKSAmJiAobWV0YS5nZXRTb3VyY2VNb2Rl\nKCkgJiBNT0RFX01FVEEpICE9IDApIHx8CiAgICAgICAgICAgICAgICAoaXNN\nYXBwaW5nTW9kZSgpICYmCiAgICAgICAgICAgICAgICAgICAgKG1ldGEuZ2V0\nU291cmNlTW9kZSgpICYgTU9ERV9NQVBQSU5HKSAhPSAwKSkpIHsKICAgICAg\nICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkdXAtbWV0YWRhdGEiLCBfY2xzLmdl\ndE5hbWUoKSkpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9\nCgogICAgICAgIGlmIChtZXRhID09IG51bGwpIHsKICAgICAgICAgICAgbWV0\nYSA9IGdldFJlcG9zaXRvcnkoKS5hZGRNZXRhRGF0YShfY2xzKTsKICAgICAg\nICAgICAgbWV0YS5zZXRFbnZDbGFzc0xvYWRlcihfZW52TG9hZGVyKTsKICAg\nICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfTk9ORSk7CiAgICAg\nICAgICAgIG1ldGEuc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgbWV0YS5T\nUkNfQU5OT1RBVElPTlMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0\nYTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0aGUgc291cmNl\nIGZpbGUgd2UncmUgcGFyc2luZy4KICAgICAqLwogICAgcHJvdGVjdGVkIEZp\nbGUgZ2V0U291cmNlRmlsZSgpIHsKICAgICAgICBpZiAoX2ZpbGUgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIF9maWxlOwoKICAgICAgICBDbGFzcyBj\nbHMgPSBfY2xzOwogICAgICAgIHdoaWxlIChjbHMuZ2V0RW5jbG9zaW5nQ2xh\nc3MoKSAhPSBudWxsKQogICAgICAgICAgICBjbHMgPSBjbHMuZ2V0RW5jbG9z\naW5nQ2xhc3MoKTsKCiAgICAgICAgU3RyaW5nIHJzcmMgPSBTdHJpbmdVdGls\ncy5yZXBsYWNlKGNscy5nZXROYW1lKCksICIuIiwgIi8iKTsKICAgICAgICBD\nbGFzc0xvYWRlciBsb2FkZXIgPSAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdjVIZWxw\nZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY2xzKSk7IAogICAgICAgIGlmIChs\nb2FkZXIgPT0gbnVsbCkKICAgICAgICAgICAgbG9hZGVyID0gKENsYXNzTG9h\nZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAg\nICAgICAgIEoyRG9Qcml2NUhlbHBlci5nZXRTeXN0ZW1DbGFzc0xvYWRlckFj\ndGlvbigpKTsgCiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBVUkwgdXJsID0gKFVSTCkgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Q\ncml2NUhlbHBlci5nZXRSZXNvdXJjZUFjdGlvbihsb2FkZXIsIHJzcmMgKyAi\nLmphdmEiKSk7IAogICAgICAgIGlmICh1cmwgPT0gbnVsbCkgewogICAgICAg\nICAgICB1cmwgPSAoVVJMKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2NUhlbHBlci5nZXRSZXNvdXJj\nZUFjdGlvbihsb2FkZXIsIHJzcmMgKyAiLmNsYXNzIikpOyAKICAgICAgICAg\nICAgaWYgKHVybCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9maWxl\nID0gbmV3IEZpbGUodXJsLnRvVVJJKCkpOwogICAgICAgIH0gY2F0Y2ggKFVS\nSVN5bnRheEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgfSBjYXRjaCAoSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uIGlhZSkgewogICAgICAgICAgICAvLyB0aGlz\nIGlzIHRocm93biB3aGVuIHRoZSBVUkkgaXMgbm9uLWhpZXJhcmNoaWNhbCAo\nYWthIEpCb3NzKQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2ZpbGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARGF0YVN0b3JlSWQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZURhdGFTdG9yZUlkKENsYXNzTWV0\nYURhdGEgbWV0YSwgRGF0YVN0b3JlSWQgaWQpIHsKICAgICAgICBtZXRhLnNl\ndElkZW50aXR5VHlwZShDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRSk7Cgog\nICAgICAgIGludCBzdHJhdCA9IGdldEdlbmVyYXRlZFZhbHVlU3RyYXRlZ3ko\nbWV0YSwgaWQuc3RyYXRlZ3koKSwKICAgICAgICAgICAgaWQuZ2VuZXJhdG9y\nKCkpOwogICAgICAgIGlmIChzdHJhdCAhPSAtMSkKICAgICAgICAgICAgbWV0\nYS5zZXRJZGVudGl0eVN0cmF0ZWd5KHN0cmF0KTsKICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgc3dpdGNoIChpZC5zdHJhdGVneSgpKSB7CiAgICAgICAg\nICAgICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgICAgICAgY2FzZSBTRVFV\nRU5DRToKICAgICAgICAgICAgICAgICAgICAvLyB0ZWNobmljYWxseSB3ZSBz\naG91bGQgaGF2ZSBzZXBhcmF0ZSBzeXN0ZW0gdGFibGUgYW5kCiAgICAgICAg\nICAgICAgICAgICAgLy8gc2VxdWVuY2UgZ2VuZXJhdG9ycywgYnV0IGl0J3Mg\nZWFzaWVyIHRvIGp1c3QgcmVseSBvbgogICAgICAgICAgICAgICAgICAgIC8v\nIHRoZSBzeXN0ZW0gb3JnLmFwYWNoZS5vcGVuanBhLlNlcXVlbmNlIHNldHRp\nbmcgZm9yIGJvdGgKICAgICAgICAgICAgICAgICAgICBpZiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShpZC5nZW5lcmF0b3IoKSkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIG1ldGEuc2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhLk5BTUVfU1lT\nVEVNKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgICAgIG1ldGEuc2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoaWQuZ2Vu\nZXJhdG9yKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBBVVRPOgogICAgICAgICAgICAgICAgICAgIG1ldGEu\nc2V0SWRlbnRpdHlTdHJhdGVneShWYWx1ZVN0cmF0ZWdpZXMuTkFUSVZFKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgSURFTlRJVFk6CiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVu\ndGl0eVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5BVVRPQVNTSUdOKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVk\nRXhjZXB0aW9uKGlkLnN0cmF0ZWd5KCkudG9TdHJpbmcoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXYXJuIHRo\nYXQgQEZsdXNoTW9kZSBpcyBub3Qgc3VwcG9ydGVkLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgd2FybkZsdXNoTW9kZShPYmplY3QgY29udGV4dCkgewog\nICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAg\nX2xvZy53YXJuKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsICJGbHVzaE1vZGUi\nLCBjb250ZXh0KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARGF0\nYUNhY2hlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VEYXRhQ2Fj\naGUoQ2xhc3NNZXRhRGF0YSBtZXRhLCBEYXRhQ2FjaGUgY2FjaGUpIHsKICAg\nICAgICBpZiAoY2FjaGUudGltZW91dCgpICE9IEludGVnZXIuTUlOX1ZBTFVF\nKQogICAgICAgICAgICBtZXRhLnNldERhdGFDYWNoZVRpbWVvdXQoY2FjaGUu\ndGltZW91dCgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHko\nY2FjaGUubmFtZSgpKSkKICAgICAgICAgICAgbWV0YS5zZXREYXRhQ2FjaGVO\nYW1lKGNhY2hlLm5hbWUoKSk7CiAgICAgICAgZWxzZSBpZiAoY2FjaGUuZW5h\nYmxlZCgpKQogICAgICAgICAgICBtZXRhLnNldERhdGFDYWNoZU5hbWUoCiAg\nICAgICAgICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlLkRh\ndGFDYWNoZS5OQU1FX0RFRkFVTFQpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgbWV0YS5zZXREYXRhQ2FjaGVOYW1lKG51bGwpOwogICAgfQoKICAgIC8q\nKgogICAgICogUGFyc2UgQERldGFjaGVkU3RhdGUuIFRoZSBhbm5vdGF0aW9u\nIG1heSBiZSBudWxsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VE\nZXRhY2hlZFN0YXRlKENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBEZXRh\nY2hlZFN0YXRlIGRldGFjaGVkKSB7CiAgICAgICAgaWYgKGRldGFjaGVkICE9\nIG51bGwpIHsKICAgICAgICAgICAgaWYgKCFkZXRhY2hlZC5lbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBtZXRhLnNldERldGFjaGVkU3RhdGUobnVsbCk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoZGV0\nYWNoZWQuZmllbGROYW1lKCkpKQogICAgICAgICAgICAgICAgbWV0YS5zZXRE\nZXRhY2hlZFN0YXRlKENsYXNzTWV0YURhdGEuU1lOVEhFVElDKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgbWV0YS5zZXREZXRhY2hlZFN0\nYXRlKGRldGFjaGVkLmZpZWxkTmFtZSgpKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBGaWVsZFtdIGZpZWxkcyA9IChGaWVsZFtdKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Q\ncml2NUhlbHBlci5nZXREZWNsYXJlZEZpZWxkc0FjdGlvbigKICAgICAgICAg\nICAgICAgICAgICBtZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpOyAKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgICAgICBpZiAoKChCb29sZWFuKSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdjVIZWxwZXIKICAgICAgICAgICAg\nICAgICAgICAuaXNBbm5vdGF0aW9uUHJlc2VudEFjdGlvbihmaWVsZHNbaV0s\nIERldGFjaGVkU3RhdGUuY2xhc3MpKSkKICAgICAgICAgICAgICAgICAgICAu\nYm9vbGVhblZhbHVlKCkpCiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRE\nZXRhY2hlZFN0YXRlKGZpZWxkc1tpXS5nZXROYW1lKCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBFbnRpdHlMaXN0ZW5lcnMK\nICAgICAqLwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxi\nYWNrcz5bXSBwYXJzZUVudGl0eUxpc3RlbmVycwogICAgICAgIChDbGFzc01l\ndGFEYXRhIG1ldGEsIEVudGl0eUxpc3RlbmVycyBsaXN0ZW5lcnMpIHsKICAg\nICAgICBDbGFzc1tdIGNsYXNzZXMgPSBsaXN0ZW5lcnMudmFsdWUoKTsKICAg\nICAgICBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxiYWNrcz5bXSBwYXJzZWQg\nPSBudWxsOwogICAgICAgIGZvciAoQ2xhc3MgY2xzIDogY2xhc3NlcykKICAg\nICAgICAgICAgcGFyc2VkID0gcGFyc2VDYWxsYmFja01ldGhvZHMoY2xzLCBw\nYXJzZWQsIHRydWUsIHRydWUsIAogICAgICAgICAgICAgICAgZ2V0UmVwb3Np\ndG9yeSgpKTsKICAgICAgICByZXR1cm4gcGFyc2VkOwogICAgfQoKICAgIC8q\nKgogICAgICogUGFyc2UgY2FsbGJhY2sgbWV0aG9kcyBpbnRvIHRoZSBnaXZl\nbiBhcnJheSwgYW5kIHJldHVybiB0aGF0IGFycmF5LAogICAgICogY3JlYXRp\nbmcgb25lIGlmIG51bGwuIEVhY2ggaW5kZXggaW50byB0aGUgYXJyYXkgaXMg\nYSBjb2xsZWN0aW9uIG9mCiAgICAgKiBjYWxsYmFjayBhZGFwdGVycyBmb3Ig\ndGhhdCBudW1lcmljIGV2ZW50IHR5cGUuCiAgICAgKgogICAgICogQHBhcmFt\nIHN1cHMgd2hldGhlciB0byBzY2FuIHN1cGVyY2xhc3NlcwogICAgICogQHBh\ncmFtIGxpc3RlbmVyIHdoZXRoZXIgdGhpcyBpcyBhIGxpc3RlbmVyIG9yIG5v\ndAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIENvbGxlY3Rpb248TGlmZWN5\nY2xlQ2FsbGJhY2tzPltdIHBhcnNlQ2FsbGJhY2tNZXRob2RzCiAgICAgICAg\nKENsYXNzIGNscywgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10g\nY2FsbGJhY2tzLCBib29sZWFuIHN1cHMsCiAgICAgICAgYm9vbGVhbiBsaXN0\nZW5lciwgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgLy8g\nZmlyc3Qgc29ydCAvIGZpbHRlciBiYXNlZCBvbiBpbmhlcml0YW5jZQogICAg\nICAgIFNldDxNZXRob2Q+IG1ldGhvZHMgPSBuZXcgVHJlZVNldDxNZXRob2Q+\nKE1ldGhvZENvbXBhcmF0b3IuCiAgICAgICAgICAgIGdldEluc3RhbmNlKCkp\nOwoKICAgICAgICBpbnQgbW9kczsKICAgICAgICBDbGFzcyBzdXAgPSBjbHM7\nCiAgICAgICAgTWV0aG9kS2V5IGtleTsKICAgICAgICBTZXQ8TWV0aG9kS2V5\nPiBzZWVuID0gbmV3IEhhc2hTZXQ8TWV0aG9kS2V5PigpOwogICAgICAgIGRv\nIHsKICAgICAgICAgICAgZm9yIChNZXRob2QgbSA6IChNZXRob2RbXSkgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBK\nMkRvUHJpdjVIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RzQWN0aW9uKHN1cCkp\nKSB7CiAgICAgICAgICAgICAgICBtb2RzID0gbS5nZXRNb2RpZmllcnMoKTsK\nICAgICAgICAgICAgICAgIGlmIChNb2RpZmllci5pc1N0YXRpYyhtb2RzKSB8\nfCBNb2RpZmllci5pc0ZpbmFsKG1vZHMpIHx8CiAgICAgICAgICAgICAgICAg\nICAgT2JqZWN0LmNsYXNzLmVxdWFscyhtLmdldERlY2xhcmluZ0NsYXNzKCkp\nKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nICAgIGtleSA9IG5ldyBNZXRob2RLZXkobSk7CiAgICAgICAgICAgICAgICBp\nZiAoIXNlZW4uY29udGFpbnMoa2V5KSkgewogICAgICAgICAgICAgICAgICAg\nIG1ldGhvZHMuYWRkKG0pOwogICAgICAgICAgICAgICAgICAgIHNlZW4uYWRk\nKGtleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgc3VwID0gc3VwLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICB9IHdo\naWxlIChzdXBzICYmICFPYmplY3QuY2xhc3MuZXF1YWxzKHN1cCkpOwoKICAg\nICAgICBNZXRhRGF0YURlZmF1bHRzIGRlZiA9IHJlcG9zLmdldE1ldGFEYXRh\nRmFjdG9yeSgpLmdldERlZmF1bHRzKCk7CiAgICAgICAgZm9yIChNZXRob2Qg\nbSA6IG1ldGhvZHMpIHsKICAgICAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFu\nbm8gOiAoQW5ub3RhdGlvbltdKSBBY2Nlc3NDb250cm9sbGVyCiAgICAgICAg\nICAgICAgICAuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2NUhlbHBlcgogICAgICAg\nICAgICAgICAgICAgIC5nZXREZWNsYXJlZEFubm90YXRpb25zQWN0aW9uKG0p\nKSkgewogICAgICAgICAgICAgICAgTWV0YURhdGFUYWcgdGFnID0gX3RhZ3Mu\nZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgICAgICAgICBp\nZiAodGFnID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgICAgICBpbnRbXSBldmVudHMgPSBNZXRhRGF0YVBhcnNl\ncnMuZ2V0RXZlbnRUeXBlcyh0YWcpOwogICAgICAgICAgICAgICAgaWYgKGV2\nZW50cyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgICAgIGlmIChjYWxsYmFja3MgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBjYWxsYmFja3MgPSAoQ29sbGVjdGlvbjxMaWZlY3lj\nbGVDYWxsYmFja3M+W10pCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBD\nb2xsZWN0aW9uW0xpZmVjeWNsZUV2ZW50LkFMTF9FVkVOVFMubGVuZ3RoXTsK\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGV2ZW50cy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGludCBlID0gZXZl\nbnRzW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFja3NbZV0g\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2Vd\nID0gbmV3IEFycmF5TGlzdCgzKTsKICAgICAgICAgICAgICAgICAgICBNZXRh\nRGF0YVBhcnNlcnMudmFsaWRhdGVNZXRob2RzRm9yU2FtZUNhbGxiYWNrKGNs\ncywgCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrc1tlXSwgbSwg\ndGFnLCBkZWYsIHJlcG9zLmdldExvZygpKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAobGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2Fs\nbGJhY2tzW2VdLmFkZChuZXcgQmVhbkxpZmVjeWNsZUNhbGxiYWNrcyhjbHMs\nIG0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSkpOwogICAg\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNhbGxiYWNrc1tlXS5hZGQobmV3IE1ldGhvZExpZmVjeWNsZUNhbGxi\nYWNrcyhtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UpKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNhbGxiYWNrczsK\nICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBTdG9yZSBsaWZlY3ljbGUgbWV0\nYWRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWNvcmRDYWxsYmFj\na3MoQ2xhc3NNZXRhRGF0YSBjbHMsCiAgICAgICAgQ29sbGVjdGlvbjxMaWZl\nY3ljbGVDYWxsYmFja3M+W10gY2FsbGJhY2tzLCBpbnRbXSBoaWdocywKICAg\nICAgICBib29sZWFuIHN1cGVyQ2xhc3MpIHsKICAgICAgICBpZiAoY2FsbGJh\nY2tzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBMaWZl\nY3ljbGVNZXRhRGF0YSBtZXRhID0gY2xzLmdldExpZmVjeWNsZU1ldGFEYXRh\nKCk7CiAgICAgICAgTGlmZWN5Y2xlQ2FsbGJhY2tzW10gYXJyYXk7CiAgICAg\nICAgZm9yIChpbnQgZXZlbnQgOiBMaWZlY3ljbGVFdmVudC5BTExfRVZFTlRT\nKSB7CiAgICAgICAgICAgIGlmIChjYWxsYmFja3NbZXZlbnRdID09IG51bGwp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgYXJyYXkg\nPSBjYWxsYmFja3NbZXZlbnRdLnRvQXJyYXkKICAgICAgICAgICAgICAgIChu\nZXcgTGlmZWN5Y2xlQ2FsbGJhY2tzW2NhbGxiYWNrc1tldmVudF0uc2l6ZSgp\nXSk7CgogICAgICAgICAgICBpZiAoc3VwZXJDbGFzcykgewogICAgICAgICAg\nICAgICAgbWV0YS5zZXROb25QQ1N1cGVyY2xhc3NDYWxsYmFja3MoZXZlbnQs\nIGFycmF5LAogICAgICAgICAgICAgICAgICAgIChoaWdocyA9PSBudWxsKSA/\nIDAgOiBoaWdoc1tldmVudF0pOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgbWV0YS5zZXREZWNsYXJlZENhbGxiYWNrcyhldmVudCwg\nYXJyYXksCiAgICAgICAgICAgICAgICAgICAgKGhpZ2hzID09IG51bGwpID8g\nMCA6IGhpZ2hzW2V2ZW50XSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgZmV0Y2ggZ3JvdXBzLgogICAg\nICogSWYgRmV0Y2hHcm91cCBBIGluY2x1ZGVzIEZldGNoR3JvdXAgQiwgdGhl\nbiBhIGJpLWxpbmsgaXMgc2V0IGJldHdlZW4KICAgICAqIEEgYW5kIEIuIEJv\ndGggQSBhbmQgQiBtdXN0IGJlIGRlY2xhcmVkIGluIHRoZSBzYW1lIENsYXNz\nLiAKICAgICAqIDxicj4KICAgICAqIENhbGwge0BsaW5rICNwYXJzZUZldGNo\nQXR0cmlidXRlKENsYXNzTWV0YURhdGEsIAogICAgICogb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuRmV0Y2hHcm91cCwgRmV0Y2hBdHRyaWJ1dGUpIG9ubHkg\nYWZ0ZXIgdGhlCiAgICAgKiBiaS1saW5rcyBoYXZlIGJlZW4gZXN0YWJsaXNo\nZWQsIGJlY2F1c2UgYSBmaWVsZCBmIHdpbGwgbm90IG9ubHkgYWRkIHRoZQog\nICAgICogZmV0Y2ggZ3JvdXAgQSB3aGljaCBleHBsaWN0bHkgaW5jbHVkZXMg\nZiB0byBpdHMgY3VzdG9tIGZldGNoIGdyb3VwcyBidXQgCiAgICAgKiBhbHNv\nIHdpbGwgYWxzbyBhZGQgYW55IGZldGNoIGdyb3VwIEIgdGhhdCBpbmNsdWRl\ncyBBLiAgCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUZldGNoR3Jv\ndXBzKENsYXNzTWV0YURhdGEgbWV0YSwgRmV0Y2hHcm91cC4uLiBncm91cHMp\nIHsKICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3Vw\nIGZnOwogICAgICAgIGZvciAoRmV0Y2hHcm91cCBncm91cCA6IGdyb3Vwcykg\newogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShncm91cC5u\nYW1lKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJ1bm5hbWVkLWZnIiwgbWV0YSkpOwoKICAgICAg\nICAgICAgZmcgPSBtZXRhLmFkZERlY2xhcmVkRmV0Y2hHcm91cChncm91cC5u\nYW1lKCkpOwogICAgICAgICAgICBpZiAoZ3JvdXAucG9zdExvYWQoKSkKICAg\nICAgICAgICAgICAgIGZnLnNldFBvc3RMb2FkKHRydWUpOyAKICAgICAgICAg\nICAgZm9yIChTdHJpbmcgcyA6IGdyb3VwLmZldGNoR3JvdXBzKCkpIHsKICAg\nICAgICAgICAgICAgIGZnLmFkZERlY2xhcmVkSW5jbHVkZShzKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBBZGQgdGhlIHBhcmVudC1j\naGlsZCBzdHlsZSBiaS1saW5rcyBiZXR3ZWVuIGZldGNoIGdyb3VwcyBpbiBh\nIAogICAgICAgIC8vIHNlcGFyYXRlIHBhc3MuIAogICAgICAgIGZvciAoRmV0\nY2hHcm91cCBncm91cDpncm91cHMpIHsKICAgICAgICAJZmcgPSBtZXRhLmdl\ndEZldGNoR3JvdXAoZ3JvdXAubmFtZSgpKTsKICAgICAgICAJU3RyaW5nW10g\naW5jbHVkZWRGZXRjaEdyb3BOYW1lcyA9IGZnLmdldERlY2xhcmVkSW5jbHVk\nZXMoKTsKICAgICAgICAJZm9yIChTdHJpbmcgaW5jbHVkZWRGZWN0Y2hHcm91\ncE5hbWU6aW5jbHVkZWRGZXRjaEdyb3BOYW1lcykgewogICAgICAgIAkJb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuRmV0Y2hHcm91cCBjaGlsZCA9CiAgICAg\nICAgCSAgICBtZXRhLmdldEZldGNoR3JvdXAoaW5jbHVkZWRGZWN0Y2hHcm91\ncE5hbWUpOwogICAgICAgIAkJaWYgKGNoaWxkID09IG51bGwpIAogICAgICAg\nIAkJCXRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtaXNzaW5n\nLWluY2x1ZGVkLWZnIiwgCiAgICAgICAgCQkJCW1ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpLmdldE5hbWUoKSwgZmcuZ2V0TmFtZSgpLAogICAgICAgIAkJCQlp\nbmNsdWRlZEZlY3RjaEdyb3VwTmFtZSkpOwogICAgICAgIAkJY2hpbGQuYWRk\nQ29udGFpbmVkQnkoZmcpOwogICAgICAgIAl9CiAgICAgICAgfQogICAgICAg\nIAogICAgICAgIGZvciAoRmV0Y2hHcm91cCBncm91cCA6IGdyb3Vwcykgewog\nICAgICAgICAgICBmZyA9IG1ldGEuZ2V0RmV0Y2hHcm91cChncm91cC5uYW1l\nKCkpOwogICAgICAgICAgICBmb3IgKEZldGNoQXR0cmlidXRlIGF0dHIgOiBn\ncm91cC5hdHRyaWJ1dGVzKCkpCiAgICAgICAgICAgICAgICBwYXJzZUZldGNo\nQXR0cmlidXRlKG1ldGEsIGZnLCBhdHRyKTsKICAgICAgICB9CiAgICB9CiAg\nICAKCiAgICAvKioKICAgICAqIFNldCBhIGZpZWxkJ3MgZmV0Y2ggZ3JvdXAu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUZldGNoQXR0cmlidXRl\nKENsYXNzTWV0YURhdGEgbWV0YSwgCiAgICAgICAgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuRmV0Y2hHcm91cCBmZywgRmV0Y2hBdHRyaWJ1dGUgYXR0cikg\newogICAgICAgIEZpZWxkTWV0YURhdGEgZmllbGQgPSBtZXRhLmdldERlY2xh\ncmVkRmllbGQoYXR0ci5uYW1lKCkpOwogICAgICAgIGlmIChmaWVsZCA9PSBu\ndWxsCiAgICAgICAgICAgIHx8IGZpZWxkLmdldE1hbmFnZW1lbnQoKSAhPSBG\naWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1mZy1m\naWVsZCIsIGZnLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIG1ldGEsIGF0\ndHIubmFtZSgpKSk7CgogICAgICAgIGZpZWxkLnNldEluRmV0Y2hHcm91cChm\nZy5nZXROYW1lKCksIHRydWUpOwogICAgICAgIFNldCBwYXJlbnRGZXRjaEdy\nb3VwcyA9IGZnLmdldENvbnRhaW5lZEJ5KCk7CiAgICAgICAgZm9yIChPYmpl\nY3QgcGFyZW50RmV0Y2hHcm91cDpwYXJlbnRGZXRjaEdyb3VwcykKICAgICAg\nICAJZmllbGQuc2V0SW5GZXRjaEdyb3VwKHBhcmVudEZldGNoR3JvdXAudG9T\ndHJpbmcoKSwgdHJ1ZSk7CiAgICAgICAgaWYgKGF0dHIucmVjdXJzaW9uRGVw\ndGgoKSAhPSBJbnRlZ2VyLk1JTl9WQUxVRSkKICAgICAgICAgICAgZmcuc2V0\nUmVjdXJzaW9uRGVwdGgoZmllbGQsIGF0dHIucmVjdXJzaW9uRGVwdGgoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFkIGFubm90YXRpb25zIGZvciB0\naGUgZ2l2ZW4gbWVtYmVyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFy\nc2VNZW1iZXJBbm5vdGF0aW9ucyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAg\nICAgIC8vIGxvb2sgZm9yIHBlcnNpc3RlbmNlIHN0cmF0ZWd5IGluIGFubm90\nYXRpb24gdGFibGUKICAgICAgICBNZW1iZXIgbWVtYmVyID0gZ2V0UmVwb3Np\ndG9yeSgpLmdldE1ldGFEYXRhRmFjdG9yeSgpLmdldERlZmF1bHRzKCkuCiAg\nICAgICAgICAgIGdldEJhY2tpbmdNZW1iZXIoZm1kKTsKICAgICAgICBQZXJz\naXN0ZW5jZVN0cmF0ZWd5IHBzdHJhdCA9IFBlcnNpc3RlbmNlTWV0YURhdGFE\nZWZhdWx0cy4KICAgICAgICAgICAgZ2V0UGVyc2lzdGVuY2VTdHJhdGVneShm\nbWQsIG1lbWJlcik7CiAgICAgICAgaWYgKHBzdHJhdCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgZm1kLnNldEV4cGxpY2l0KHRydWUp\nOwoKICAgICAgICBBbm5vdGF0ZWRFbGVtZW50IGVsID0gKEFubm90YXRlZEVs\nZW1lbnQpIG1lbWJlcjsKICAgICAgICBib29sZWFuIGxvYiA9ICgoQm9vbGVh\nbikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXY1SGVs\ncGVyCiAgICAgICAgICAgIC5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKGVs\nLCBMb2IuY2xhc3MpKSkuYm9vbGVhblZhbHVlKCk7CiAgICAgICAgaWYgKGlz\nTWV0YURhdGFNb2RlKCkpIHsKICAgICAgICAgICAgc3dpdGNoIChwc3RyYXQp\nIHsKICAgICAgICAgICAgICAgIGNhc2UgQkFTSUM6CiAgICAgICAgICAgICAg\nICAgICAgcGFyc2VCYXNpYyhmbWQsIChCYXNpYykgZWwuZ2V0QW5ub3RhdGlv\nbihCYXNpYy5jbGFzcyksIGxvYik7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIE1BTllfT05FOgogICAgICAgICAg\nICAgICAgICAgIHBhcnNlTWFueVRvT25lKGZtZCwgKE1hbnlUb09uZSkgZWwu\nZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAoTWFueVRv\nT25lLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIE9ORV9PTkU6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VPbmVUb09uZShmbWQsIChPbmVUb09uZSkgZWwuZ2V0QW5ub3RhdGlv\nbgogICAgICAgICAgICAgICAgICAgICAgICAoT25lVG9PbmUuY2xhc3MpKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgRU1CRURERUQ6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VFbWJlZGRl\nZChmbWQsIChFbWJlZGRlZCkgZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAg\nICAgICAgICAgICAgICAoRW1iZWRkZWQuY2xhc3MpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgT05FX01BTlk6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VPbmVUb01hbnkoZm1kLCAoT25l\nVG9NYW55KSBlbC5nZXRBbm5vdGF0aW9uCiAgICAgICAgICAgICAgICAgICAg\nICAgIChPbmVUb01hbnkuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFOWV9NQU5ZOgogICAgICAg\nICAgICAgICAgICAgIHBhcnNlTWFueVRvTWFueShmbWQsIChNYW55VG9NYW55\nKSBlbC5nZXRBbm5vdGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChN\nYW55VG9NYW55LmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIFBFUlM6CiAgICAgICAgICAgICAgICAg\nICAgcGFyc2VQZXJzaXN0ZW50KGZtZCwgKFBlcnNpc3RlbnQpIGVsLmdldEFu\nbm90YXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgKFBlcnNpc3RlbnQu\nY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgUEVSU19DT0xMOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlUGVyc2lzdGVudENvbGxlY3Rpb24oZm1kLCAoUGVyc2lzdGVudENvbGxl\nY3Rpb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmdldEFubm90YXRp\nb24oUGVyc2lzdGVudENvbGxlY3Rpb24uY2xhc3MpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEVSU19NQVA6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VQZXJzaXN0ZW50TWFwKGZtZCwg\nKFBlcnNpc3RlbnRNYXApCiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmdl\ndEFubm90YXRpb24oUGVyc2lzdGVudE1hcC5jbGFzcykpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBUUkFOU0lF\nTlQ6CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRl\ncm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgbG9iKQogICAg\nICAgICAgICBwYXJzZUxvYk1hcHBpbmcoZm1kKTsKCiAgICAgICAgLy8gZXh0\nZW5zaW9ucwogICAgICAgIE1ldGFEYXRhVGFnIHRhZzsKICAgICAgICBmb3Ig\nKEFubm90YXRpb24gYW5ubyA6IGVsLmdldERlY2xhcmVkQW5ub3RhdGlvbnMo\nKSkgewogICAgICAgICAgICB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0\naW9uVHlwZSgpKTsKICAgICAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBoYW5kbGVVbmtub3duTWVtYmVyQW5ub3RhdGlvbihm\nbWQsIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAg\nICAgICBjYXNlIEZMVVNIX01PREU6CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHdh\ncm5GbHVzaE1vZGUoZm1kKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgR0VORVJBVEVEX1ZBTFVFOgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgcGFyc2VHZW5lcmF0ZWRWYWx1ZShmbWQs\nIChHZW5lcmF0ZWRWYWx1ZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElEOgogICAgICAgICAgICAg\nICAgY2FzZSBFTUJFRERFRF9JRDoKICAgICAgICAgICAgICAgICAgICBmbWQu\nc2V0UHJpbWFyeUtleSh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQX0tFWToKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHBhcnNlTWFwS2V5KGZtZCwgKE1hcEtleSkgYW5u\nbyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIE9SREVSX0JZOgogICAgICAgICAgICAgICAgICAgIHBhcnNlT3Jk\nZXJCeShmbWQsCiAgICAgICAgICAgICAgICAgICAgICAgIChPcmRlckJ5KSBl\nbC5nZXRBbm5vdGF0aW9uKE9yZGVyQnkuY2xhc3MpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU0VRX0dFTkVS\nQVRPUjoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJp\nZGVNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlU2VxdWVu\nY2VHZW5lcmF0b3IoZWwsIChTZXF1ZW5jZUdlbmVyYXRvcikgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFZFUlNJT046CiAgICAgICAgICAgICAgICAgICAgZm1kLnNldFZlcnNpb24o\ndHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIERFUEVOREVOVDoKICAgICAgICAgICAgICAgICAgICBpZiAo\naXNNZXRhRGF0YU1vZGUoKSAmJiAoKERlcGVuZGVudCkgYW5ubykudmFsdWUo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldENhc2NhZGVEZWxl\ndGUoVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTEVNX0RFUEVO\nREVOVDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSAmJiAoKEVsZW1lbnREZXBlbmRlbnQpIGFubm8pLnZhbHVlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0Q2FzY2Fk\nZURlbGV0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKFZhbHVlTWV0\nYURhdGEuQ0FTQ0FERV9BVVRPKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9UWVBFOgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAg\nICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNldFR5cGVPdmVycmlkZSh0\nb092ZXJyaWRlVHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKCgo\nRWxlbWVudFR5cGUpIGFubm8pLnZhbHVlKCkpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRVhURVJOQUxfVkFM\nUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldEV4dGVybmFsVmFsdWVz\nKFN0cmluZ3Muam9pbigoKEV4dGVybmFsVmFsdWVzKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgYW5ubykudmFsdWUoKSwgIiwiKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVYVEVS\nTkFMSVpFUjoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1v\nZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldEV4dGVybmFs\naXplcigoKEV4dGVybmFsaXplcikgYW5ubykudmFsdWUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZBQ1RP\nUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRGYWN0b3J5KCgoRmFj\ndG9yeSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIElOVkVSU0VfTE9HSUNBTDoKICAg\nICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgZm1kLnNldEludmVyc2UoKChJbnZlcnNlTG9n\naWNhbCkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEtFWV9ERVBFTkRFTlQ6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkgJiYgKChLZXlE\nZXBlbmRlbnQpIGFubm8pLnZhbHVlKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZtZC5nZXRLZXkoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLnNldENhc2NhZGVEZWxldGUoVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBLRVlfVFlQRToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRh\nRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLmdldEtl\neSgpLnNldFR5cGVPdmVycmlkZSh0b092ZXJyaWRlVHlwZSgoKEtleVR5cGUp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbm5vKS52YWx1ZSgpKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIExPQURfRkVUQ0hfR1JPVVA6CiAgICAgICAgICAgICAgICAJaWYgKGlz\nTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAJCWZtZC5zZXRMb2Fk\nRmV0Y2hHcm91cCgoKExvYWRGZXRjaEdyb3VwKSBhbm5vKS52YWx1ZSgpKTsK\nICAgICAgICAgICAgICAgIAlicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nTFJTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgp\nKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0TFJTKCgoTFJTKSBh\nbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgUkVBRF9PTkxZOgogICAgICAgICAgICAgICAg\nICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAg\nICAgICBwYXJzZVJlYWRPbmx5KGZtZCwgKFJlYWRPbmx5KSBhbm5vKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nVFlQRToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldFR5cGVPdmVycmlk\nZSh0b092ZXJyaWRlVHlwZSgoKFR5cGUpIGFubm8pLgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgdmFsdWUoKSkpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5n\nZXQoInVuc3VwcG9ydGVkIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICAg\nICBhbm5vLnRvU3RyaW5nKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIG1lbWJlciBtYXBwaW5nIGNv\nbXBvbmVudHMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlTWVt\nYmVyTWFwcGluZ0Fubm90YXRpb25zKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRvIGhhbmRs\nZSB1bmtub3duIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiBoYW5kbGVVbmtub3duTWVtYmVyQW5ub3RhdGlvbihGaWVsZE1l\ndGFEYXRhIGZtZCwKICAgICAgICBBbm5vdGF0aW9uIGFubm8pIHsKICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0\nIHRoZSBnaXZlbiBjbGFzcyB0byBpdHMgT3BlbkpQQSB0eXBlIG92ZXJyaWRl\nIGVxdWl2YWxlbnQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENsYXNz\nIHRvT3ZlcnJpZGVUeXBlKENsYXNzIGNscykgewogICAgICAgIHJldHVybiAo\nY2xzID09IEVudGl0eS5jbGFzcykKICAgICAgICAgICAgPyBvcmcuYXBhY2hl\nLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MgOiBj\nbHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAUmVhZE9ubHkuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVJlYWRPbmx5KEZpZWxkTWV0\nYURhdGEgZm1kLCBSZWFkT25seSBybykgewogICAgICAgIGlmIChyby52YWx1\nZSgpID09IFVwZGF0ZUFjdGlvbi5SRVNUUklDVCkKICAgICAgICAgICAgZm1k\nLnNldFVwZGF0ZVN0cmF0ZWd5KFVwZGF0ZVN0cmF0ZWdpZXMuUkVTVFJJQ1Qp\nOwogICAgICAgIGVsc2UgaWYgKHJvLnZhbHVlKCkgPT0gVXBkYXRlQWN0aW9u\nLklHTk9SRSkKICAgICAgICAgICAgZm1kLnNldFVwZGF0ZVN0cmF0ZWd5KFVw\nZGF0ZVN0cmF0ZWdpZXMuSUdOT1JFKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0cyB2YWx1ZSBnZW5lcmF0aW9uIGluZm9ybWF0aW9u\nIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZUdlbmVyYXRlZFZhbHVlKEZpZWxkTWV0YURhdGEgZm1kLCBHZW5l\ncmF0ZWRWYWx1ZSBnZW4pIHsKICAgICAgICBHZW5lcmF0aW9uVHlwZSBzdHJh\ndGVneSA9IGdlbi5zdHJhdGVneSgpOwogICAgICAgIFN0cmluZyBnZW5lcmF0\nb3IgPSBnZW4uZ2VuZXJhdG9yKCk7CiAgICAgICAgcGFyc2VHZW5lcmF0ZWRW\nYWx1ZShmbWQsIHN0cmF0ZWd5LCBnZW5lcmF0b3IpOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0cyB2YWx1ZSBnZW5lcmF0aW9uIGluZm9ybWF0aW9uIGZv\nciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHN0YXRpYyB2b2lkIHBh\ncnNlR2VuZXJhdGVkVmFsdWUoRmllbGRNZXRhRGF0YSBmbWQsIEdlbmVyYXRp\nb25UeXBlIHN0cmF0ZWd5LAogICAgICAgIFN0cmluZyBnZW5lcmF0b3IpIHsK\nICAgICAgICBpbnQgc3RyYXQgPSBnZXRHZW5lcmF0ZWRWYWx1ZVN0cmF0ZWd5\nKGZtZCwgc3RyYXRlZ3ksIGdlbmVyYXRvcik7CiAgICAgICAgaWYgKHN0cmF0\nICE9IC0xKQogICAgICAgICAgICBmbWQuc2V0VmFsdWVTdHJhdGVneShzdHJh\ndCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHN3aXRjaCAoc3RyYXRl\nZ3kpIHsKICAgICAgICAgICAgICAgIGNhc2UgVEFCTEU6CiAgICAgICAgICAg\nICAgICBjYXNlIFNFUVVFTkNFOgogICAgICAgICAgICAgICAgICAgIC8vIHRl\nY2huaWNhbGx5IHdlIHNob3VsZCBoYXZlIHNlcGFyYXRlIHN5c3RlbSB0YWJs\nZSBhbmQKICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBnZW5lcmF0\nb3JzLCBidXQgaXQncyBlYXNpZXIgdG8ganVzdCByZWx5IG9uCiAgICAgICAg\nICAgICAgICAgICAgLy8gdGhlIHN5c3RlbSBvcmcuYXBhY2hlLm9wZW5qcGEu\nU2VxdWVuY2Ugc2V0dGluZyBmb3IgYm90aAogICAgICAgICAgICAgICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGdlbmVyYXRvcikpCiAgICAgICAg\nICAgICAgICAgICAgICAgIGZtZC5zZXRWYWx1ZVNlcXVlbmNlTmFtZShTZXF1\nZW5jZU1ldGFEYXRhLk5BTUVfU1lTVEVNKTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRWYWx1ZVNl\ncXVlbmNlTmFtZShnZW5lcmF0b3IpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBBVVRPOgogICAgICAgICAgICAg\nICAgICAgIGZtZC5zZXRWYWx1ZVNlcXVlbmNlTmFtZShTZXF1ZW5jZU1ldGFE\nYXRhLk5BTUVfU1lTVEVNKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgSURFTlRJVFk6CiAgICAgICAgICAgICAg\nICAgICAgZm1kLnNldFZhbHVlU3RyYXRlZ3koVmFsdWVTdHJhdGVnaWVzLkFV\nVE9BU1NJR04pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oc3RyYXRlZ3kudG9TdHJpbmcoKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHZhbHVlIHN0cmF0ZWd5IGZvciB0aGUgZ2l2ZW4gZ2Vu\nZXJhdG9yLCBvciAtMSBpZiB0aGUKICAgICAqIHN0cmF0ZWd5IGRlcGVuZHMg\nb24gdGhlIDxjb2RlPkdlbmVyYXRpb25UeXBlPC9jb2RlPiByYXRoZXIgdGhh\nbiB0aGUKICAgICAqIGdlbmVyYXRvciBuYW1lLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBpbnQgZ2V0R2VuZXJhdGVkVmFsdWVTdHJhdGVneShPYmpl\nY3QgY29udGV4dCwKICAgICAgICBHZW5lcmF0aW9uVHlwZSBzdHJhdGVneSwg\nU3RyaW5nIGdlbmVyYXRvcikgewogICAgICAgIGlmIChzdHJhdGVneSAhPSBB\nVVRPIHx8IFN0cmluZ1V0aWxzLmlzRW1wdHkoZ2VuZXJhdG9yKSkKICAgICAg\nICAgICAgcmV0dXJuIC0xOwoKICAgICAgICBpZiAoR2VuZXJhdG9yLlVVSURf\nSEVYLmVxdWFscyhnZW5lcmF0b3IpKQogICAgICAgICAgICByZXR1cm4gVmFs\ndWVTdHJhdGVnaWVzLlVVSURfSEVYOwogICAgICAgIGlmIChHZW5lcmF0b3Iu\nVVVJRF9TVFJJTkcuZXF1YWxzKGdlbmVyYXRvcikpCiAgICAgICAgICAgIHJl\ndHVybiBWYWx1ZVN0cmF0ZWdpZXMuVVVJRF9TVFJJTkc7CiAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJnZW5lcmF0b3It\nYmFkLXN0cmF0ZWd5IiwKICAgICAgICAgICAgY29udGV4dCwgZ2VuZXJhdG9y\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAQmFzaWMuIEdpdmVu\nIGFubm90YXRpb24gbWF5IGJlIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBwYXJzZUJhc2ljKEZpZWxkTWV0YURhdGEgZm1kLCBCYXNpYyBhbm5v\nLCBib29sZWFuIGxvYikgewogICAgICAgIENsYXNzIHR5cGUgPSBmbWQuZ2V0\nRGVjbGFyZWRUeXBlKCk7CiAgICAgICAgaWYgKGxvYiAmJiB0eXBlICE9IFN0\ncmluZy5jbGFzcwogICAgICAgICAgICAmJiB0eXBlICE9IGNoYXJbXS5jbGFz\ncyAmJiB0eXBlICE9IENoYXJhY3RlcltdLmNsYXNzCiAgICAgICAgICAgICYm\nIHR5cGUgIT0gYnl0ZVtdLmNsYXNzICYmIHR5cGUgIT0gQnl0ZVtdLmNsYXNz\nKQogICAgICAgICAgICBmbWQuc2V0U2VyaWFsaXplZCh0cnVlKTsKICAgICAg\nICBlbHNlIGlmICghbG9iKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgICAgIGlmIChFbnVt\nLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIC8vIGVsc2Ug\nbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExF\nQ1RJT046CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAg\nICAgICAgaWYgKFNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9t\nKHR5cGUpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0U2VyaWFs\naXplZCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmbWQsICJCYXNpYyIpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgog\nICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09IGNoYXJbXS5jbGFzcyB8\nfCB0eXBlID09IENoYXJhY3RlcltdLmNsYXNzCiAgICAgICAgICAgICAgICAg\nICAgICAgIHx8IHR5cGUgPT0gYnl0ZVtdLmNsYXNzIHx8IHR5cGUgPT0gQnl0\nZVtdLmNsYXNzKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgICAgICBpZiAoU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNz\naWduYWJsZUZyb20KICAgICAgICAgICAgICAgICAgICAgICAgKHR5cGUuZ2V0\nQ29tcG9uZW50VHlwZSgpKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1k\nLnNldFNlcmlhbGl6ZWQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZm1kLCAiQmFzaWMiKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIGlmIChhbm5vID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkg\nPT0gRmV0Y2hUeXBlLkVBR0VSKTsKICAgICAgICBpZiAoIWFubm8ub3B0aW9u\nYWwoKSkKICAgICAgICAgICAgZm1kLnNldE51bGxWYWx1ZShGaWVsZE1ldGFE\nYXRhLk5VTExfRVhDRVBUSU9OKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIEBNYW55VG9PbmUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZU1hbnlUb09uZShGaWVsZE1ldGFEYXRhIGZtZCwgTWFueVRvT25lIGFubm8p\nIHsKICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRWYWx1\nZSgpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAg\nICAgIk1hbnlUb09uZSIpKTsKCiAgICAgICAgLy8gZG9uJ3Qgc3BlY2lmaWNh\nbGx5IGV4Y2x1ZGUgcmVsYXRpb24gZnJvbSBERkcgYi9jIHRoYXQgd2lsbCBw\ncmV2ZW50CiAgICAgICAgLy8gdXMgZnJvbSBldmVuIHJlYWRpbmcgdGhlIGZr\nIHdoZW4gcmVhZGluZyBmcm9tIHRoZSBwcmltYXJ5IHRhYmxlLAogICAgICAg\nIC8vIHdoaWNoIGlzIG5vdCB3aGF0IG1vc3QgdXNlcnMgd2lsbCB3YW50CiAg\nICAgICAgaWYgKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpCiAg\nICAgICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKHRydWUpOwog\nICAgICAgIGlmICghYW5uby5vcHRpb25hbCgpKQogICAgICAgICAgICBmbWQu\nc2V0TnVsbFZhbHVlKEZpZWxkTWV0YURhdGEuTlVMTF9FWENFUFRJT04pOwog\nICAgICAgIGlmIChhbm5vLnRhcmdldEVudGl0eSgpICE9IHZvaWQuY2xhc3Mp\nCiAgICAgICAgICAgIGZtZC5zZXRUeXBlT3ZlcnJpZGUoYW5uby50YXJnZXRF\nbnRpdHkoKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLCBhbm5vLmNhc2Nh\nZGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAT25lVG9PbmUu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU9uZVRvT25lKEZpZWxk\nTWV0YURhdGEgZm1kLCBPbmVUb09uZSBhbm5vKSB7CiAgICAgICAgaWYgKCFK\nYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1l\ndGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICJPbmVUb09uZSIpKTsK\nCiAgICAgICAgLy8gZG9uJ3Qgc3BlY2lmaWNhbGx5IGV4Y2x1ZGUgcmVsYXRp\nb24gZnJvbSBERkcgYi9jIHRoYXQgd2lsbCBwcmV2ZW50CiAgICAgICAgLy8g\ndXMgZnJvbSBldmVuIHJlYWRpbmcgdGhlIGZrIHdoZW4gcmVhZGluZyBmcm9t\nIHRoZSBwcmltYXJ5IHRhYmxlLAogICAgICAgIC8vIHdoaWNoIGlzIG5vdCB3\naGF0IG1vc3QgdXNlcnMgd2lsbCB3YW50CiAgICAgICAgaWYgKGFubm8uZmV0\nY2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpCiAgICAgICAgICAgIGZtZC5zZXRJ\nbkRlZmF1bHRGZXRjaEdyb3VwKHRydWUpOwogICAgICAgIGlmICghYW5uby5v\ncHRpb25hbCgpKQogICAgICAgICAgICBmbWQuc2V0TnVsbFZhbHVlKEZpZWxk\nTWV0YURhdGEuTlVMTF9FWENFUFRJT04pOwoKICAgICAgICBpZiAoaXNNYXBw\naW5nT3ZlcnJpZGVNb2RlKCkgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5u\nby5tYXBwZWRCeSgpKSkKICAgICAgICAgICAgZm1kLnNldE1hcHBlZEJ5KGFu\nbm8ubWFwcGVkQnkoKSk7CiAgICAgICAgaWYgKGFubm8udGFyZ2V0RW50aXR5\nKCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLnNldFR5cGVPdmVy\ncmlkZShhbm5vLnRhcmdldEVudGl0eSgpKTsKICAgICAgICBzZXRDYXNjYWRl\ncyhmbWQsIGFubm8uY2FzY2FkZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIEBFbWJlZGRlZC4gR2l2ZW4gYW5ub3RhdGlvbiBtYXkgYmUgbnVs\nbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRW1iZWRkZWQoRmll\nbGRNZXRhRGF0YSBmbWQsIEVtYmVkZGVkIGFubm8pIHsKICAgICAgICBpZiAo\nIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRWYWx1ZSgpKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQt\nbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgIkVtYmVkZGVkIikp\nOwoKICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cCh0cnVlKTsK\nICAgICAgICBmbWQuc2V0RW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgaWYgKGZt\nZC5nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAg\nZm1kLmFkZEVtYmVkZGVkTWV0YURhdGEoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBPbmVUb01hbnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZU9uZVRvTWFueShGaWVsZE1ldGFEYXRhIGZtZCwgT25lVG9NYW55\nIGFubm8pIHsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGlmIChK\nYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0RWxlbWVudCgpKSkKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFr\nCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8i\nLCBmbWQsCiAgICAgICAgICAgICAgICAgICAgIk9uZVRvTWFueSIpKTsKICAg\nICAgICB9CgogICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFu\nbm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGlmIChp\nc01hcHBpbmdPdmVycmlkZU1vZGUoKSAmJiAhU3RyaW5nVXRpbHMuaXNFbXB0\neShhbm5vLm1hcHBlZEJ5KCkpKQogICAgICAgICAgICBmbWQuc2V0TWFwcGVk\nQnkoYW5uby5tYXBwZWRCeSgpKTsKICAgICAgICBpZiAoYW5uby50YXJnZXRF\nbnRpdHkoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0RWxl\nbWVudCgpLnNldERlY2xhcmVkVHlwZShhbm5vLnRhcmdldEVudGl0eSgpKTsK\nICAgICAgICBzZXRDYXNjYWRlcyhmbWQuZ2V0RWxlbWVudCgpLCBhbm5vLmNh\nc2NhZGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBATWFueVRv\nTWFueS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFueVRvTWFu\neShGaWVsZE1ldGFEYXRhIGZtZCwgTWFueVRvTWFueSBhbm5vKSB7CiAgICAg\nICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5NQVA6CiAgICAgICAgICAgICAgICBpZiAoSmF2YVR5cGVzLm1heWJl\nUEMoZm1kLmdldEVsZW1lbnQoKSkpCiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAg\nICAgICAgICAgICAgICJPbmVUb01hbnkiKSk7CiAgICAgICAgfQoKICAgICAg\nICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0g\nRmV0Y2hUeXBlLkVBR0VSKTsKICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJp\nZGVNb2RlKCkgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRC\neSgpKSkKICAgICAgICAgICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVk\nQnkoKSk7CiAgICAgICAgaWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9p\nZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXREZWNs\nYXJlZFR5cGUoYW5uby50YXJnZXRFbnRpdHkoKSk7CiAgICAgICAgc2V0Q2Fz\nY2FkZXMoZm1kLmdldEVsZW1lbnQoKSwgYW5uby5jYXNjYWRlKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUGFyc2UgQE1hcEtleS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlTWFwS2V5KEZpZWxkTWV0YURhdGEgZm1kLCBN\nYXBLZXkgYW5ubykgewogICAgICAgIFN0cmluZyBuYW1lID0gYW5uby5uYW1l\nKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAg\nICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXRWYWx1ZU1hcHBlZEJ5KFZhbHVl\nTWV0YURhdGEuTUFQUEVEX0JZX1BLKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIGZtZC5nZXRLZXkoKS5zZXRWYWx1ZU1hcHBlZEJ5KG5hbWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0dXAgdGhlIGZpZWxkIGFzIGEgTE9CIG1h\ncHBpbmcuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlTG9iTWFw\ncGluZyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgQE9yZGVyQnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZU9yZGVyQnkoRmllbGRNZXRhRGF0YSBmbWQsIE9yZGVyQnkgYW5ubykg\newogICAgICAgIFN0cmluZyBkZWMgPSBhbm5vLnZhbHVlKCk7CiAgICAgICAg\naWYgKGRlYy5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICBkZWMgPSBPcmRl\nci5FTEVNRU5UICsgIiBhc2MiOwogICAgICAgIGZtZC5zZXRPcmRlckRlY2xh\ncmF0aW9uKGRlYyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAUGVy\nc2lzdGVudC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGVyc2lz\ndGVudChGaWVsZE1ldGFEYXRhIGZtZCwgUGVyc2lzdGVudCBhbm5vKSB7CiAg\nICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAg\nICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBieXRlW10uY2xhc3MK\nICAgICAgICAgICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkg\nPT0gQnl0ZVtdLmNsYXNzCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kLmdl\ndERlY2xhcmVkVHlwZSgpID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICAg\nICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBDaGFyYWN0ZXJb\nXS5jbGFzcykKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAg\nICAgICAiUGVyc2lzdGVudCIpKTsKICAgICAgICB9CgogICAgICAgIGlmICgh\nU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm1hcHBlZEJ5KCkpKQogICAgICAg\nICAgICBmbWQuc2V0TWFwcGVkQnkoYW5uby5tYXBwZWRCeSgpKTsKICAgICAg\nICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0g\nRmV0Y2hUeXBlLkVBR0VSKTsKICAgICAgICBpZiAoIWFubm8ub3B0aW9uYWwo\nKSkKICAgICAgICAgICAgZm1kLnNldE51bGxWYWx1ZShGaWVsZE1ldGFEYXRh\nLk5VTExfRVhDRVBUSU9OKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFu\nbm8uY2FzY2FkZSgpKTsKICAgICAgICBpZiAoYW5uby5lbWJlZGRlZCgpKSB7\nCiAgICAgICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZh\nbHVlKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAg\nICAgICAgICAgICAgICJQZXJzaXN0ZW50KGVtYmVkZGVkPXRydWUpIikpOwog\nICAgICAgICAgICBmbWQuc2V0RW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgICAg\nIGlmIChmbWQuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAg\nICAgICAgICAgICBmbWQuYWRkRW1iZWRkZWRNZXRhRGF0YSgpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBQZXJzaXN0ZW50Q29s\nbGVjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGVyc2lz\ndGVudENvbGxlY3Rpb24oRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgUGVy\nc2lzdGVudENvbGxlY3Rpb24gYW5ubykgewogICAgICAgIGlmIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5BUlJBWQogICAgICAg\nICAgICAmJiBmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBl\ncy5DT0xMRUNUSU9OKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAg\nICAgICAgICAgICAiUGVyc2lzdGVudENvbGxlY3Rpb24iKSk7CgogICAgICAg\nIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm1hcHBlZEJ5KCkpKQog\nICAgICAgICAgICBmbWQuc2V0TWFwcGVkQnkoYW5uby5tYXBwZWRCeSgpKTsK\nICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNo\nKCkgPT0gRmV0Y2hUeXBlLkVBR0VSKTsKICAgICAgICBpZiAoYW5uby5lbGVt\nZW50VHlwZSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5nZXRF\nbGVtZW50KCkuc2V0RGVjbGFyZWRUeXBlKGFubm8uZWxlbWVudFR5cGUoKSk7\nCiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLmdldEVsZW1lbnQoKSwgYW5uby5l\nbGVtZW50Q2FzY2FkZSgpKTsKICAgICAgICBpZiAoYW5uby5lbGVtZW50RW1i\nZWRkZWQoKSkgewogICAgICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXliZVBD\nKGZtZC5nZXRFbGVtZW50KCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwg\nZm1kLAogICAgICAgICAgICAgICAgICAgICJQZXJzaXN0ZW50Q29sbGVjdGlv\nbihlbWJlZGRlZEVsZW1lbnQ9dHJ1ZSkiKSk7CiAgICAgICAgICAgIGZtZC5n\nZXRFbGVtZW50KCkuc2V0RW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgICAgIGlm\nIChmbWQuZ2V0RWxlbWVudCgpLmdldEVtYmVkZGVkTWV0YURhdGEoKSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5hZGRFbWJl\nZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgQFBlcnNpc3RlbnRNYXAuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBwYXJzZVBlcnNpc3RlbnRNYXAoRmllbGRNZXRhRGF0YSBmbWQsIFBl\ncnNpc3RlbnRNYXAgYW5ubykgewogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5NQVApCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEt\nYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICJQZXJzaXN0ZW50TWFwIikp\nOwoKICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZl\ndGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VSKTsKICAgICAgICBpZiAoYW5uby5r\nZXlUeXBlKCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEtl\neSgpLnNldERlY2xhcmVkVHlwZShhbm5vLmtleVR5cGUoKSk7CiAgICAgICAg\naWYgKGFubm8uZWxlbWVudFR5cGUoKSAhPSB2b2lkLmNsYXNzKQogICAgICAg\nICAgICBmbWQuZ2V0RWxlbWVudCgpLnNldERlY2xhcmVkVHlwZShhbm5vLmVs\nZW1lbnRUeXBlKCkpOwogICAgICAgIHNldENhc2NhZGVzKGZtZC5nZXRLZXko\nKSwgYW5uby5rZXlDYXNjYWRlKCkpOwogICAgICAgIHNldENhc2NhZGVzKGZt\nZC5nZXRFbGVtZW50KCksIGFubm8uZWxlbWVudENhc2NhZGUoKSk7CiAgICAg\nICAgaWYgKGFubm8ua2V5RW1iZWRkZWQoKSkgewogICAgICAgICAgICBpZiAo\nIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRLZXkoKSkpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJh\nZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAgICAgIlBlcnNp\nc3RlbnRNYXAoZW1iZWRkZWRLZXk9dHJ1ZSkiKSk7CiAgICAgICAgICAgIGZt\nZC5nZXRLZXkoKS5zZXRFbWJlZGRlZCh0cnVlKTsKICAgICAgICAgICAgaWYg\nKGZtZC5nZXRLZXkoKS5nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5hZGRFbWJlZGRlZE1ldGFE\nYXRhKCk7CiAgICAgICAgfQogICAgICAgIGlmIChhbm5vLmVsZW1lbnRFbWJl\nZGRlZCgpKSB7CiAgICAgICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMo\nZm1kLmdldEVsZW1lbnQoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBm\nbWQsCiAgICAgICAgICAgICAgICAgICAgIlBlcnNpc3RlbnRNYXAoZW1iZWRk\nZWRWYWx1ZT10cnVlKSIpKTsKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQo\nKS5zZXRFbWJlZGRlZCh0cnVlKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRF\nbGVtZW50KCkuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAg\nICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLmFkZEVtYmVkZGVkTWV0YURh\ndGEoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgY2Fz\nY2FkZXMgb24gcmVsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBz\nZXRDYXNjYWRlcyhWYWx1ZU1ldGFEYXRhIHZtZCwgQ2FzY2FkZVR5cGVbXSBj\nYXNjYWRlcykgewogICAgICAgIGZvciAoQ2FzY2FkZVR5cGUgY2FzY2FkZSA6\nIGNhc2NhZGVzKSB7CiAgICAgICAgICAgIGlmIChjYXNjYWRlID09IENhc2Nh\nZGVUeXBlLkFMTCB8fCBjYXNjYWRlID09IENhc2NhZGVUeXBlLlJFTU9WRSkK\nICAgICAgICAgICAgICAgIHZtZC5zZXRDYXNjYWRlRGVsZXRlKFZhbHVlTWV0\nYURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpOwogICAgICAgICAgICBpZiAoY2Fz\nY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwgY2FzY2FkZSA9PSBDYXNjYWRl\nVHlwZS5QRVJTSVNUKQogICAgICAgICAgICAgICAgdm1kLnNldENhc2NhZGVQ\nZXJzaXN0KFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpOwogICAg\nICAgICAgICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwgY2Fz\nY2FkZSA9PSBDYXNjYWRlVHlwZS5NRVJHRSkKICAgICAgICAgICAgICAgIHZt\nZC5zZXRDYXNjYWRlQXR0YWNoKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1F\nRElBVEUpOwogICAgICAgICAgICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlw\nZS5BTEwgfHwgY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5SRUZSRVNIKQogICAg\nICAgICAgICAgICAgdm1kLnNldENhc2NhZGVSZWZyZXNoKFZhbHVlTWV0YURh\ndGEuQ0FTQ0FERV9JTU1FRElBVEUpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIEBTZXF1ZW5jZUdlbmVyYXRvci4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlU2VxdWVuY2VHZW5lcmF0b3IoQW5ub3Rh\ndGVkRWxlbWVudCBlbCwKICAgICAgICBTZXF1ZW5jZUdlbmVyYXRvciBnZW4p\nIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGdlbi5uYW1lKCk7CiAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2VxLW5h\nbWUiLCBlbCkpOwoKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYXJzZS1zZXF1\nZW5jZSIsIG5hbWUpKTsKCiAgICAgICAgU2VxdWVuY2VNZXRhRGF0YSBtZXRh\nID0gZ2V0UmVwb3NpdG9yeSgpLmdldENhY2hlZFNlcXVlbmNlTWV0YURhdGEK\nICAgICAgICAgICAgKG5hbWUpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwp\nIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkdXAtc2VxdWVuY2Ui\nLCBuYW1lLCBlbCkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICAvLyBjcmVhdGUgbmV3IHNlcXVlbmNlCiAgICAgICAgbWV0YSA9\nIGdldFJlcG9zaXRvcnkoKS5hZGRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUpOwog\nICAgICAgIFN0cmluZyBzZXEgPSBnZW4uc2VxdWVuY2VOYW1lKCk7CiAgICAg\nICAgaW50IGluaXRpYWwgPSBnZW4uaW5pdGlhbFZhbHVlKCk7CiAgICAgICAg\naW50IGFsbG9jYXRlID0gZ2VuLmFsbG9jYXRpb25TaXplKCk7CiAgICAgICAg\nLy8gZG9uJ3QgYWxsb3cgaW5pdGlhbCBvZiAwIGIvYyBsb29rcyBsaWtlIGRl\nZiB2YWx1ZQogICAgICAgIGlmIChpbml0aWFsID09IDApCiAgICAgICAgICAg\nIGluaXRpYWwgPSAxOwoKICAgICAgICAvLyBjcmVhdGUgcGx1Z2luIHN0cmlu\nZyBmcm9tIGluZm8KICAgICAgICBTdHJpbmcgY2xzTmFtZSwgcHJvcHM7CiAg\nICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc2VxKSkgewogICAgICAg\nICAgICBjbHNOYW1lID0gU2VxdWVuY2VNZXRhRGF0YS5JTVBMX05BVElWRTsK\nICAgICAgICAgICAgcHJvcHMgPSBudWxsOwogICAgICAgIH0gZWxzZSBpZiAo\nc2VxLmluZGV4T2YoJygnKSAhPSAtMSkgLy8gcGx1Z2luCiAgICAgICAgewog\nICAgICAgICAgICBjbHNOYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NO\nYW1lKHNlcSk7CiAgICAgICAgICAgIHByb3BzID0gQ29uZmlndXJhdGlvbnMu\nZ2V0UHJvcGVydGllcyhzZXEpOwogICAgICAgICAgICBzZXEgPSBudWxsOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNsc05hbWUgPSBTZXF1ZW5j\nZU1ldGFEYXRhLklNUExfTkFUSVZFOwogICAgICAgICAgICBwcm9wcyA9IG51\nbGw7CiAgICAgICAgfQoKICAgICAgICBtZXRhLnNldFNlcXVlbmNlUGx1Z2lu\nKENvbmZpZ3VyYXRpb25zLmdldFBsdWdpbihjbHNOYW1lLCBwcm9wcykpOwog\nICAgICAgIG1ldGEuc2V0U2VxdWVuY2Uoc2VxKTsKICAgICAgICBtZXRhLnNl\ndEluaXRpYWxWYWx1ZShpbml0aWFsKTsKICAgICAgICBtZXRhLnNldEFsbG9j\nYXRlKGFsbG9jYXRlKTsKICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3Vy\nY2VGaWxlKCksIChlbCBpbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwK\nICAgICAgICAgICAgbWV0YS5TUkNfQU5OT1RBVElPTlMpOwogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgQE5hbWVkUXVlcnkuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBwYXJzZU5hbWVkUXVlcmllcyhBbm5vdGF0ZWRFbGVtZW50\nIGVsLCBOYW1lZFF1ZXJ5Li4uIHF1ZXJpZXMpIHsKICAgICAgICBRdWVyeU1l\ndGFEYXRhIG1ldGE7CiAgICAgICAgZm9yIChOYW1lZFF1ZXJ5IHF1ZXJ5IDog\ncXVlcmllcykgewogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShxdWVyeS5uYW1lKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1xdWVyeS1uYW1lIiwgZWwp\nKTsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnku\ncXVlcnkoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLXF1ZXJ5LXN0cmluZyIsCiAgICAgICAg\nICAgICAgICAgICAgcXVlcnkubmFtZSgpLCBlbCkpOwoKICAgICAgICAgICAg\naWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9s\nb2cudHJhY2UoX2xvYy5nZXQoInBhcnNlLXF1ZXJ5IiwgcXVlcnkubmFtZSgp\nKSk7CgogICAgICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmdldENh\nY2hlZFF1ZXJ5TWV0YURhdGEobnVsbCwgcXVlcnkubmFtZSgpKTsKICAgICAg\nICAgICAgaWYgKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYg\nKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9s\nb2cud2FybihfbG9jLmdldCgiZHVwLXF1ZXJ5IiwgcXVlcnkubmFtZSgpLCBl\nbCkpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmFkZFF1ZXJ5TWV0\nYURhdGEobnVsbCwgcXVlcnkubmFtZSgpKTsKICAgICAgICAgICAgbWV0YS5z\nZXRRdWVyeVN0cmluZyhxdWVyeS5xdWVyeSgpKTsKICAgICAgICAgICAgbWV0\nYS5zZXRMYW5ndWFnZShKUFFMUGFyc2VyLkxBTkdfSlBRTCk7CiAgICAgICAg\nICAgIGZvciAoUXVlcnlIaW50IGhpbnQgOiBxdWVyeS5oaW50cygpKQogICAg\nICAgICAgICAgICAgbWV0YS5hZGRIaW50KGhpbnQubmFtZSgpLCBoaW50LnZh\nbHVlKCkpOwoKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2UoZ2V0U291cmNl\nRmlsZSgpLCAoZWwgaW5zdGFuY2VvZiBDbGFzcykgPyBlbCA6IG51bGwsCiAg\nICAgICAgICAgICAgICBtZXRhLlNSQ19BTk5PVEFUSU9OUyk7CiAgICAgICAg\nICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgbWV0\nYS5zZXRTb3VyY2VNb2RlKE1PREVfTUVUQSk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0\nU291cmNlTW9kZShNT0RFX01BUFBJTkcpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9RVUVSWSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE5hbWVk\nTmF0aXZlUXVlcnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU5h\nbWVkTmF0aXZlUXVlcmllcyhBbm5vdGF0ZWRFbGVtZW50IGVsLAogICAgICAg\nIE5hbWVkTmF0aXZlUXVlcnkuLi4gcXVlcmllcykgewogICAgICAgIFF1ZXJ5\nTWV0YURhdGEgbWV0YTsKICAgICAgICBmb3IgKE5hbWVkTmF0aXZlUXVlcnkg\ncXVlcnkgOiBxdWVyaWVzKSB7CiAgICAgICAgICAgIGlmIChTdHJpbmdVdGls\ncy5pc0VtcHR5KHF1ZXJ5Lm5hbWUoKSkpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW5hdGl2ZS1x\ndWVyeS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICBlbCkpOwogICAgICAg\nICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShxdWVyeS5xdWVyeSgpKSkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tbmF0aXZlLXF1ZXJ5LXN0cmluZyIsCiAgICAgICAgICAg\nICAgICAgICAgcXVlcnkubmFtZSgpLCBlbCkpOwoKICAgICAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cu\ndHJhY2UoX2xvYy5nZXQoInBhcnNlLW5hdGl2ZS1xdWVyeSIsIHF1ZXJ5Lm5h\nbWUoKSkpOwoKICAgICAgICAgICAgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5n\nZXRDYWNoZWRRdWVyeU1ldGFEYXRhKG51bGwsIHF1ZXJ5Lm5hbWUoKSk7CiAg\nICAgICAgICAgIGlmIChtZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBfbG9nLndhcm4oX2xvYy5nZXQoImR1cC1xdWVyeSIsIHF1ZXJ5Lm5hbWUo\nKSwgZWwpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5hZGRRdWVy\neU1ldGFEYXRhKG51bGwsIHF1ZXJ5Lm5hbWUoKSk7CiAgICAgICAgICAgIG1l\ndGEuc2V0UXVlcnlTdHJpbmcocXVlcnkucXVlcnkoKSk7CiAgICAgICAgICAg\nIG1ldGEuc2V0TGFuZ3VhZ2UoUXVlcnlMYW5ndWFnZXMuTEFOR19TUUwpOwog\nICAgICAgICAgICBDbGFzcyByZXMgPSBxdWVyeS5yZXN1bHRDbGFzcygpOwog\nICAgICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWRUeXBlKGdldENv\nbmZpZ3VyYXRpb24oKSwgcmVzKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0\nQ2FuZGlkYXRlVHlwZShyZXMpOwogICAgICAgICAgICBlbHNlIGlmICghdm9p\nZC5jbGFzcy5lcXVhbHMocmVzKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0\nUmVzdWx0VHlwZShyZXMpOwoKICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KHF1ZXJ5LnJlc3VsdFNldE1hcHBpbmcoKSkpCiAgICAgICAg\nICAgICAgICBtZXRhLnNldFJlc3VsdFNldE1hcHBpbmdOYW1lKHF1ZXJ5LnJl\nc3VsdFNldE1hcHBpbmcoKSk7CgogICAgICAgICAgICBtZXRhLnNldFNvdXJj\nZShnZXRTb3VyY2VGaWxlKCksIChlbCBpbnN0YW5jZW9mIENsYXNzKSA/IGVs\nIDogbnVsbCwKICAgICAgICAgICAgICAgIG1ldGEuU1JDX0FOTk9UQVRJT05T\nKTsKICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAg\nICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NRVRBKTsKICAgICAg\nICAgICAgZWxzZSBpZiAoaXNNYXBwaW5nTW9kZSgpKQogICAgICAgICAgICAg\nICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfTUFQUElORyk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShN\nT0RFX1FVRVJZKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0\naWMgY2xhc3MgTWV0aG9kS2V5IHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBN\nZXRob2QgX21ldGhvZDsKCiAgICAgICAgcHVibGljIE1ldGhvZEtleShNZXRo\nb2QgbSkgewogICAgICAgICAgICBfbWV0aG9kID0gbTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIGlu\ndCBjb2RlID0gNDYgKiAxMiArIF9tZXRob2QuZ2V0TmFtZSgpLmhhc2hDb2Rl\nKCk7CiAgICAgICAgICAgIGZvciAoQ2xhc3MgcGFyYW0gOiBfbWV0aG9kLmdl\ndFBhcmFtZXRlclR5cGVzKCkpCiAgICAgICAgICAgICAgICBjb2RlID0gNDYg\nKiBjb2RlICsgcGFyYW0uaGFzaENvZGUoKTsKICAgICAgICAgICAgcmV0dXJu\nIGNvZGU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVh\nbHMoT2JqZWN0IG8pIHsKICAgICAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9m\nIE1ldGhvZEtleSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIE1ldGhvZCBvdGhlciA9ICgoTWV0aG9kS2V5KSBvKS5fbWV0\naG9kOwogICAgICAgICAgICBpZiAoIV9tZXRob2QuZ2V0TmFtZSgpLmVxdWFs\ncyhvdGhlci5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmVxdWFscyhfbWV0aG9k\nLmdldFBhcmFtZXRlclR5cGVzKCksCiAgICAgICAgICAgICAgICBvdGhlci5n\nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgY2xhc3MgTWV0aG9kQ29tcGFyYXRvciBpbXBsZW1lbnRz\nIENvbXBhcmF0b3IgewoKICAgICAgICBwcml2YXRlIHN0YXRpYyBNZXRob2RD\nb21wYXJhdG9yIElOU1RBTkNFID0gbnVsbDsKCiAgICAgICAgcHVibGljIHN0\nYXRpYyBNZXRob2RDb21wYXJhdG9yIGdldEluc3RhbmNlKCkgewogICAgICAg\nICAgICBpZiAoSU5TVEFOQ0UgPT0gbnVsbCkKICAgICAgICAgICAgICAgIElO\nU1RBTkNFID0gbmV3IE1ldGhvZENvbXBhcmF0b3IoKTsKICAgICAgICAgICAg\ncmV0dXJuIElOU1RBTkNFOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGlu\ndCBjb21wYXJlKE9iamVjdCBvMSwgT2JqZWN0IG8yKSB7CiAgICAgICAgICAg\nIE1ldGhvZCBtMSA9IChNZXRob2QpIG8xOwogICAgICAgICAgICBNZXRob2Qg\nbTIgPSAoTWV0aG9kKSBvMjsKCiAgICAgICAgICAgIENsYXNzIGMxID0gbTEu\nZ2V0RGVjbGFyaW5nQ2xhc3MoKTsKICAgICAgICAgICAgQ2xhc3MgYzIgPSBt\nMi5nZXREZWNsYXJpbmdDbGFzcygpOwogICAgICAgICAgICBpZiAoIWMxLmVx\ndWFscyhjMikpIHsKICAgICAgICAgICAgICAgIGlmIChjMS5pc0Fzc2lnbmFi\nbGVGcm9tKGMyKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAg\nICAgICAgICAgICAgICBlbHNlCgkJCQkJcmV0dXJuIDE7CgkJCX0KCQkJaW50\nIGNvbXBhcmUgPSBtMS5nZXROYW1lICgpLmNvbXBhcmVUbyAobTIuZ2V0TmFt\nZSAoKSk7CgkJCWlmIChjb21wYXJlID09IDApCgkJCQlyZXR1cm4gbTEuaGFz\naENvZGUgKCkgLSBtMi5oYXNoQ29kZSAoKTsKCQkJcmV0dXJuIGNvbXBhcmU7\nCgkJfQoJfQp9Cg==\n","encoding":"base64"}

