{"sha":"f9e0c00fdeac8a806e2c596c37178b8a954e5497","node_id":"MDQ6QmxvYjIwNjM2NDpmOWUwYzAwZmRlYWM4YTgwNmUyYzU5NmMzNzE3OGI4YTk1NGU1NDk3","size":11548,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f9e0c00fdeac8a806e2c596c37178b8a954e5497","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTWVtYmVyOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9k\nOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250cm9sbGVyOwoKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXY1SGVs\ncGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2Fs\naXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkRlbGVnYXRp\nbmdNZXRhRGF0YUZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuTWV0YURhdGFGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuWE1MRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLlhNTE1ldGFEYXRhOwoKLyoqCiAqIEpBWEIg\neG1sIGFubm90YXRpb24gbWV0YWRhdGEgcGFyc2VyLgogKgogKiBAYXV0aG9y\nIENhdGFsaW5hIFdlaQogKiBAc2luY2UgMS4wLjAKICogQG5vamF2YWRvYwog\nKi8KcHVibGljIGNsYXNzIEFubm90YXRpb25QZXJzaXN0ZW5jZVhNTE1ldGFE\nYXRhUGFyc2VyIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6\nZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEFubm90\nYXRpb25QZXJzaXN0ZW5jZVhNTE1ldGFEYXRhUGFyc2VyLmNsYXNzKTsKCiAg\nICBwcml2YXRlIGZpbmFsIE9wZW5KUEFDb25maWd1cmF0aW9uIF9jb25mOwog\nICAgcHJpdmF0ZSBmaW5hbCBMb2cgX2xvZzsKICAgIHByaXZhdGUgTWV0YURh\ndGFSZXBvc2l0b3J5IF9yZXBvcyA9IG51bGw7CgogICAgLy8gdGhlIGNsYXNz\nIHdlIHdlcmUgaW52b2tlZCB0byBwYXJzZQogICAgcHJpdmF0ZSBDbGFzcyBf\nY2xzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YSBfZm1kID0g\nbnVsbDsKICAgIAogICAgLy8gY2FjaGUgdGhlIEpBWEIgWG1sLi4uIGNsYXNz\nZXMgaWYgdGhleSBhcmUgcHJlc2VudCBzbyB3ZSBkbyBub3QKICAgIC8vIGhh\ndmUgYSBoYXJkLXdpcmVkIGRlcGVuZGVuY3kgb24gSkFYQiBoZXJlCiAgICBw\ncml2YXRlIENsYXNzIHhtbFR5cGVDbGFzcyA9IG51bGw7CiAgICBwcml2YXRl\nIENsYXNzIHhtbFJvb3RFbGVtZW50Q2xhc3MgPSBudWxsOwogICAgcHJpdmF0\nZSBDbGFzcyB4bWxBY2Nlc3NvclR5cGVDbGFzcyA9IG51bGw7CiAgICBwcml2\nYXRlIENsYXNzIHhtbEF0dHJpYnV0ZUNsYXNzID0gbnVsbDsKICAgIHByaXZh\ndGUgQ2xhc3MgeG1sRWxlbWVudENsYXNzID0gbnVsbDsKICAgIHByaXZhdGUg\nTWV0aG9kIHhtbFR5cGVOYW1lID0gbnVsbDsKICAgIHByaXZhdGUgTWV0aG9k\nIHhtbFR5cGVOYW1lc3BhY2UgPSBudWxsOwogICAgcHJpdmF0ZSBNZXRob2Qg\neG1sUm9vdE5hbWUgPSBudWxsOwogICAgcHJpdmF0ZSBNZXRob2QgeG1sUm9v\ndE5hbWVzcGFjZSA9IG51bGw7CiAgICBwcml2YXRlIE1ldGhvZCB4bWxBdHRy\naWJ1dGVOYW1lID0gbnVsbDsKICAgIHByaXZhdGUgTWV0aG9kIHhtbEF0dHJp\nYnV0ZU5hbWVzcGFjZSA9IG51bGw7CiAgICBwcml2YXRlIE1ldGhvZCB4bWxF\nbGVtZW50TmFtZSA9IG51bGw7CiAgICBwcml2YXRlIE1ldGhvZCB4bWxFbGVt\nZW50TmFtZXNwYWNlID0gbnVsbDsKICAgIHByaXZhdGUgTWV0aG9kIHhtbEFj\nY2Vzc29yVmFsdWUgPSBudWxsOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0\nb3I7IHN1cHBseSBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMg\nQW5ub3RhdGlvblBlcnNpc3RlbmNlWE1MTWV0YURhdGFQYXJzZXIoT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jb25mID0gY29uZjsK\nICAgICAgICBfbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRp\nb24uTE9HX01FVEFEQVRBKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB4\nbWxUeXBlQ2xhc3MgPSBDbGFzcy5mb3JOYW1lKAogICAgICAgICAgICAgICAg\nImphdmF4LnhtbC5iaW5kLmFubm90YXRpb24uWG1sVHlwZSIpOwogICAgICAg\nICAgICB4bWxUeXBlTmFtZSA9IHhtbFR5cGVDbGFzcy5nZXRNZXRob2QoIm5h\nbWUiLCBudWxsKTsKICAgICAgICAgICAgeG1sVHlwZU5hbWVzcGFjZSA9IHht\nbFR5cGVDbGFzcy5nZXRNZXRob2QoIm5hbWVzcGFjZSIsIG51bGwpOwogICAg\nICAgICAgICB4bWxSb290RWxlbWVudENsYXNzID0gQ2xhc3MuZm9yTmFtZSgK\nICAgICAgICAgICAgICAgICJqYXZheC54bWwuYmluZC5hbm5vdGF0aW9uLlht\nbFJvb3RFbGVtZW50Iik7CiAgICAgICAgICAgIHhtbFJvb3ROYW1lID0geG1s\nUm9vdEVsZW1lbnRDbGFzcy5nZXRNZXRob2QoIm5hbWUiLCBudWxsKTsKICAg\nICAgICAgICAgeG1sUm9vdE5hbWVzcGFjZSA9IHhtbFJvb3RFbGVtZW50Q2xh\nc3MuZ2V0TWV0aG9kKCJuYW1lc3BhY2UiLCBudWxsKTsKICAgICAgICAgICAg\neG1sQWNjZXNzb3JUeXBlQ2xhc3MgPSBDbGFzcy5mb3JOYW1lKAogICAgICAg\nICAgICAgICAgImphdmF4LnhtbC5iaW5kLmFubm90YXRpb24uWG1sQWNjZXNz\nb3JUeXBlIik7CiAgICAgICAgICAgIHhtbEFjY2Vzc29yVmFsdWUgPSB4bWxB\nY2Nlc3NvclR5cGVDbGFzcy5nZXRNZXRob2QoInZhbHVlIiwgbnVsbCk7CiAg\nICAgICAgICAgIHhtbEF0dHJpYnV0ZUNsYXNzID0gQ2xhc3MuZm9yTmFtZSgK\nICAgICAgICAgICAgICAgICJqYXZheC54bWwuYmluZC5hbm5vdGF0aW9uLlht\nbEF0dHJpYnV0ZSIpOwogICAgICAgICAgICB4bWxBdHRyaWJ1dGVOYW1lID0g\neG1sQXR0cmlidXRlQ2xhc3MuZ2V0TWV0aG9kKCJuYW1lIiwgbnVsbCk7CiAg\nICAgICAgICAgIHhtbEF0dHJpYnV0ZU5hbWVzcGFjZSA9IHhtbEF0dHJpYnV0\nZUNsYXNzLmdldE1ldGhvZCgibmFtZXNwYWNlIgogICAgICAgICAgICAgICAg\nLCBudWxsKTsKICAgICAgICAgICAgeG1sRWxlbWVudENsYXNzID0gQ2xhc3Mu\nZm9yTmFtZSgKICAgICAgICAgICAgICAgICJqYXZheC54bWwuYmluZC5hbm5v\ndGF0aW9uLlhtbEVsZW1lbnQiKTsKICAgICAgICAgICAgeG1sRWxlbWVudE5h\nbWUgPSB4bWxFbGVtZW50Q2xhc3MuZ2V0TWV0aG9kKCJuYW1lIiwgbnVsbCk7\nCiAgICAgICAgICAgIHhtbEVsZW1lbnROYW1lc3BhY2UgPSB4bWxFbGVtZW50\nQ2xhc3MuZ2V0TWV0aG9kKCJuYW1lc3BhY2UiLCBudWxsKTsKICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIENvbmZpZ3VyYXRpb24gc3VwcGxpZWQgb24gY29uc3RydWN0\naW9uLgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24g\nZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBNZXRhZGF0YSBsb2cuCiAgICAgKi8KICAg\nIHB1YmxpYyBMb2cgZ2V0TG9nKCkgewogICAgICAgIHJldHVybiBfbG9nOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgcmVwb3NpdG9yeSBm\nb3IgdGhpcyBwYXJzZXIuIElmIG5vbmUgaGFzIGJlZW4gc2V0LAogICAgICog\nY3JlYXRlIGEgbmV3IHJlcG9zaXRvcnkgYW5kIHNldHMgaXQuCiAgICAgKi8K\nICAgIHB1YmxpYyBNZXRhRGF0YVJlcG9zaXRvcnkgZ2V0UmVwb3NpdG9yeSgp\nIHsKICAgICAgICBpZiAoX3JlcG9zID09IG51bGwpIHsKICAgICAgICAgICAg\nTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zID0gX2NvbmYubmV3TWV0YURhdGFS\nZXBvc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgTWV0YURhdGFGYWN0\nb3J5IG1kZiA9IHJlcG9zLmdldE1ldGFEYXRhRmFjdG9yeSgpOwogICAgICAg\nICAgICBpZiAobWRmIGluc3RhbmNlb2YgRGVsZWdhdGluZ01ldGFEYXRhRmFj\ndG9yeSkKICAgICAgICAgICAgICAgIG1kZiA9ICgoRGVsZWdhdGluZ01ldGFE\nYXRhRmFjdG9yeSkgbWRmKS5nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpOwogICAg\nICAgICAgICBpZiAobWRmIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VNZXRhRGF0\nYUZhY3RvcnkpCiAgICAgICAgICAgICAgICAoKFBlcnNpc3RlbmNlTWV0YURh\ndGFGYWN0b3J5KSBtZGYpLnNldFhNTEFubm90YXRpb25QYXJzZXIodGhpcyk7\nCiAgICAgICAgICAgIF9yZXBvcyA9IHJlcG9zOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gX3JlcG9zOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBtZXRhZGF0YSByZXBvc2l0b3J5IGZvciB0aGlzIHBhcnNlci4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0UmVwb3NpdG9yeShNZXRhRGF0YVJlcG9z\naXRvcnkgcmVwb3MpIHsKICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgIH0K\nCiAgICAvKioKICAgICAqIENsZWFyIGNhY2hlcy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgY2xlYXIoKSB7CiAgICAgICAgX2NscyA9IG51bGw7CiAgICAg\nICAgX2ZtZCA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBw\nZXJzaXN0ZW5jZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGZpZWxkIG1ldGFk\nYXRhLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwYXJzZShGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgICAgIF9mbWQgPSBmbWQ7CiAgICAgICAgX2NscyA9\nIGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICBpZiAoX2xvZy5pc1Ry\nYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJwYXJzZS1jbGFzcyIsIF9jbHMuZ2V0TmFtZSgpKSk7CgogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHBhcnNlWE1MQ2xhc3NBbm5vdGF0aW9ucygpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9jbHMgPSBudWxsOwog\nICAgICAgICAgICBfZm1kID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZWFkIGFubm90YXRpb25zIGZvciB0aGUgY3VycmVudCB0\neXBlLgogICAgICovCiAgICBwcml2YXRlIFhNTE1ldGFEYXRhIHBhcnNlWE1M\nQ2xhc3NBbm5vdGF0aW9ucygpIHsKICAgICAgICAvLyBjaGVjayBpbW1lZGlh\ndGVseSB3aGV0aGVyIHRoZSBjbGFzcyBoYXMgSkFYQiBYTUwgYW5ub3RhdGlv\nbnMKICAgICAgICBpZiAoX2NscyA9PSBudWxsIHx8IHhtbFR5cGVDbGFzcyA9\nPSBudWxsCiAgICAgICAgICAgIHx8ICEoKChCb29sZWFuKSBBY2Nlc3NDb250\ncm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdjVIZWxwZXIKICAgICAgICAg\nICAgICAgIC5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKF9jbHMsIHhtbFR5\ncGVDbGFzcykpKS5ib29sZWFuVmFsdWUoKQogICAgICAgICAgICAgICAgJiYg\nKChCb29sZWFuKSBBY2Nlc3NDb250cm9sbGVyCiAgICAgICAgICAgICAgICAu\nZG9Qcml2aWxlZ2VkKEoyRG9Qcml2NUhlbHBlci5pc0Fubm90YXRpb25QcmVz\nZW50QWN0aW9uKF9jbHMsCiAgICAgICAgICAgICAgICAgICAgeG1sUm9vdEVs\nZW1lbnRDbGFzcykpKS5ib29sZWFuVmFsdWUoKSkpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICAvLyBmaW5kIC8gY3JlYXRlIG1ldGFkYXRh\nCiAgICAgICAgWE1MTWV0YURhdGEgbWV0YSA9IGdldFhNTE1ldGFEYXRhKCk7\nCiAgICAgICAgCiAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBGaW5kIG9yIGNyZWF0ZSB4bWwgbWV0YWRhdGEgZm9yIHRoZSBj\ndXJyZW50IHR5cGUuIAogICAgICovCiAgICBwcml2YXRlIHN5bmNocm9uaXpl\nZCBYTUxNZXRhRGF0YSBnZXRYTUxNZXRhRGF0YSgpIHsKICAgICAgICBYTUxN\nZXRhRGF0YSBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmdldENhY2hlZFhNTE1l\ndGFEYXRhKF9jbHMpOwogICAgICAgIGlmIChtZXRhID09IG51bGwpIHsKICAg\nICAgICAgICAgLy8gaWYgbm90IGluIGNhY2hlLCBjcmVhdGUgbWV0YWRhdGEK\nICAgICAgICAgICAgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5hZGRYTUxNZXRh\nRGF0YShfY2xzLCBfZm1kLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHBhcnNl\nWG1sUm9vdEVsZW1lbnQoX2NscywgbWV0YSk7CiAgICAgICAgICAgIHBvcHVs\nYXRlRnJvbVJlZmxlY3Rpb24oX2NscywgbWV0YSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBtZXRhOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VYbWxSb290RWxlbWVudChDbGFzcyB0eXBlLCBYTUxNZXRhRGF0YSBt\nZXRhKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHR5cGUuZ2V0\nQW5ub3RhdGlvbih4bWxSb290RWxlbWVudENsYXNzKSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBtZXRhLnNldFhtbFJvb3RFbGVtZW50KHRydWUpOwog\nICAgICAgICAgICAgICAgbWV0YS5zZXRYbWxuYW1lKChTdHJpbmcpIHhtbFJv\nb3ROYW1lLmludm9rZSh0eXBlLmdldEFubm90YXRpb24KICAgICAgICAgICAg\nICAgICAgICAoeG1sUm9vdEVsZW1lbnRDbGFzcyksIG5ldyBPYmplY3RbXXt9\nKSk7CiAgICAgICAgICAgICAgICBtZXRhLnNldFhtbG5hbWVzcGFjZSgoU3Ry\naW5nKSB4bWxSb290TmFtZXNwYWNlLmludm9rZSh0eXBlCiAgICAgICAgICAg\nICAgICAgICAgLmdldEFubm90YXRpb24oeG1sUm9vdEVsZW1lbnRDbGFzcyks\nIG5ldyBPYmplY3RbXXt9KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgICAgICBtZXRhLnNldFhtbG5hbWUoKFN0cmlu\nZykgeG1sVHlwZU5hbWUuaW52b2tlKHR5cGUuZ2V0QW5ub3RhdGlvbgogICAg\nICAgICAgICAgICAgICAgICh4bWxUeXBlQ2xhc3MpLCBuZXcgT2JqZWN0W117\nfSkpOwogICAgICAgICAgICAgICAgbWV0YS5zZXRYbWxuYW1lc3BhY2UoKFN0\ncmluZykgeG1sVHlwZU5hbWVzcGFjZS5pbnZva2UodHlwZQogICAgICAgICAg\nICAgICAgICAgIC5nZXRBbm5vdGF0aW9uKHhtbFR5cGVDbGFzcyksIG5ldyBP\nYmplY3RbXXt9KSk7ICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7ICAgICAgICAgICAgCiAgICAgICAg\nfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBwb3B1bGF0ZUZyb21SZWZsZWN0\naW9uKENsYXNzIGNscywgWE1MTWV0YURhdGEgbWV0YSkgewogICAgICAgIE1l\nbWJlcltdIG1lbWJlcnM7CiAgICAgICAgCiAgICAgICAgQ2xhc3Mgc3VwZXJj\nbGFzcyA9IGNscy5nZXRTdXBlcmNsYXNzKCk7CgogICAgICAgIC8vIGhhbmRs\nZSBpbmhlcml0YW5jZSBhdCBzdWItZWxlbWVudCBsZXZlbAogICAgICAgIGlm\nICgoKEJvb2xlYW4pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoy\nRG9Qcml2NUhlbHBlcgogICAgICAgICAgICAuaXNBbm5vdGF0aW9uUHJlc2Vu\ndEFjdGlvbihzdXBlcmNsYXNzLCB4bWxUeXBlQ2xhc3MpKSkKICAgICAgICAg\nICAgLmJvb2xlYW5WYWx1ZSgpKQogICAgICAgICAgICBwb3B1bGF0ZUZyb21S\nZWZsZWN0aW9uKHN1cGVyY2xhc3MsIG1ldGEpOwoKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzKHhtbEFjY2Vzc29y\nVmFsdWUuaW52b2tlKGNscy5nZXRBbm5vdGF0aW9uKAogICAgICAgICAgICAg\nICAgeG1sQWNjZXNzb3JUeXBlQ2xhc3MpLCBuZXcgT2JqZWN0W117fSkudG9T\ndHJpbmcoKSwgIkZJRUxEIikpCiAgICAgICAgICAgICAgICBtZW1iZXJzID0g\nY2xzLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIG1lbWJlcnMgPSBjbHMuZ2V0RGVjbGFyZWRNZXRob2Rz\nKCk7CgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1lbWJlcnMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIE1lbWJlciBtZW1iZXIg\nPSBtZW1iZXJzW2ldOwogICAgICAgICAgICAgICAgQW5ub3RhdGVkRWxlbWVu\ndCBlbCA9IChBbm5vdGF0ZWRFbGVtZW50KSBtZW1iZXI7CiAgICAgICAgICAg\nICAgICBYTUxNZXRhRGF0YSBmaWVsZCA9IG51bGw7CiAgICAgICAgICAgICAg\nICBpZiAoZWwuZ2V0QW5ub3RhdGlvbih4bWxFbGVtZW50Q2xhc3MpICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICBTdHJpbmcgeG1sbmFtZSA9IChT\ndHJpbmcpIHhtbEVsZW1lbnROYW1lLmludm9rZShlbAogICAgICAgICAgICAg\nICAgICAgICAgICAuZ2V0QW5ub3RhdGlvbih4bWxFbGVtZW50Q2xhc3MpLCBu\nZXcgT2JqZWN0W117fSk7CiAgICAgICAgICAgICAgICAgICAgLy8gYXZvaWQg\nSkFYQiBYTUwgYmluZCBkZWZhdWx0IG5hbWUKICAgICAgICAgICAgICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzKFhNTE1ldGFEYXRhLmRlZmF1bHRO\nYW1lLCB4bWxuYW1lKSkKICAgICAgICAgICAgICAgICAgICAgICAgeG1sbmFt\nZSA9IG1lbWJlci5nZXROYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKCgoQm9vbGVhbikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJE\nb1ByaXY1SGVscGVyCiAgICAgICAgICAgICAgICAgICAgICAgIC5pc0Fubm90\nYXRpb25QcmVzZW50QWN0aW9uKCgoRmllbGQpIG1lbWJlcikuZ2V0VHlwZSgp\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeG1sVHlwZUNsYXNzKSkp\nLmJvb2xlYW5WYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZp\nZWxkID0gX3JlcG9zLmFkZFhNTE1ldGFEYXRhKCgoRmllbGQpIG1lbWJlciku\nZ2V0VHlwZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIG1lbWJl\nci5nZXROYW1lKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZVht\nbFJvb3RFbGVtZW50KCgoRmllbGQpIG1lbWJlcikuZ2V0VHlwZSgpLCBmaWVs\nZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlRnJvbVJlZmxl\nY3Rpb24oKChGaWVsZCkgbWVtYmVyKS5nZXRUeXBlKCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICwgZmllbGQpOwogICAgICAgICAgICAgICAgICAg\nICAgICBmaWVsZC5zZXRYbWx0eXBlKFhNTE1ldGFEYXRhLlhNTFRZUEUpOwog\nICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC5zZXRYbWxuYW1lKHhtbG5h\nbWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBfcmVw\nb3MubmV3WE1MRmllbGRNZXRhRGF0YSgoKEZpZWxkKSBtZW1iZXIpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAuZ2V0VHlwZSgpLCBtZW1iZXIuZ2V0\nTmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQuc2V0WG1s\ndHlwZShYTUxNZXRhRGF0YS5FTEVNRU5UKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgZmllbGQuc2V0WG1sbmFtZSh4bWxuYW1lKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgZmllbGQuc2V0WG1sbmFtZXNwYWNlKChTdHJpbmcpIHht\nbEVsZW1lbnROYW1lc3BhY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC5pbnZva2UoZWwuZ2V0QW5ub3RhdGlvbih4bWxFbGVtZW50Q2xhc3MpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAsIG5ldyBPYmplY3RbXXt9KSk7\nICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChlbC5n\nZXRBbm5vdGF0aW9uKHhtbEF0dHJpYnV0ZUNsYXNzKSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgZmllbGQgPSBfcmVwb3MubmV3WE1MRmllbGRN\nZXRhRGF0YSgoKEZpZWxkKSBtZW1iZXIpCiAgICAgICAgICAgICAgICAgICAg\nICAgIC5nZXRUeXBlKCksIG1lbWJlci5nZXROYW1lKCkpOwogICAgICAgICAg\nICAgICAgICAgIGZpZWxkLnNldFhtbHR5cGUoWE1MRmllbGRNZXRhRGF0YS5B\nVFRSSUJVVEUpOwogICAgICAgICAgICAgICAgICAgIFN0cmluZyB4bWxuYW1l\nID0gKFN0cmluZykgeG1sQXR0cmlidXRlTmFtZS5pbnZva2UoCiAgICAgICAg\nICAgICAgICAgICAgICAgIGVsLmdldEFubm90YXRpb24oeG1sQXR0cmlidXRl\nQ2xhc3MpLCBuZXcgT2JqZWN0W117fSk7CiAgICAgICAgICAgICAgICAgICAg\nLy8gYXZvaWQgSkFYQiBYTUwgYmluZCBkZWZhdWx0IG5hbWUKICAgICAgICAg\nICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzKFhNTE1ldGFEYXRh\nLmRlZmF1bHROYW1lLCB4bWxuYW1lKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgeG1sbmFtZSA9IG1lbWJlci5nZXROYW1lKCk7CiAgICAgICAgICAgICAg\nICAgICAgZmllbGQuc2V0WG1sbmFtZSgiQCIreG1sbmFtZSk7CiAgICAgICAg\nICAgICAgICAgICAgZmllbGQuc2V0WG1sbmFtZXNwYWNlKChTdHJpbmcpIHht\nbEF0dHJpYnV0ZU5hbWVzcGFjZS5pbnZva2UoCiAgICAgICAgICAgICAgICAg\nICAgICAgIGVsLmdldEFubm90YXRpb24oeG1sQXR0cmlidXRlQ2xhc3MpLCBu\nZXcgT2JqZWN0W117fSkpOyAgICAgICAgICAgICAgIAogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgaWYgKGZpZWxkICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgbWV0YS5hZGRGaWVsZChtZW1iZXIuZ2V0TmFtZSgp\nLCBmaWVsZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

