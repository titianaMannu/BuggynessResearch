{"sha":"83e00b7e13bb0e197fd68a656927d22930f31def","node_id":"MDQ6QmxvYjIwNjM2NDo4M2UwMGI3ZTEzYmIwZTE5N2ZkNjhhNjU2OTI3ZDIyOTMwZjMxZGVm","size":12568,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/83e00b7e13bb0e197fd68a656927d22930f31def","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLmxhbmcuYW5u\nb3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkZp\nZWxkOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWVtYmVyOwppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0Nv\nbnRyb2xsZXI7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0\nIGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5CYXNp\nYzsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVtYmVkZGFibGU7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRlZDsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkVtYmVkZGVkSWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5NYW55VG9NYW55OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFueVRv\nT25lOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuT25lVG9NYW55OwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5Qb3N0TG9hZDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNl\nLlBvc3RQZXJzaXN0OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdFJl\nbW92ZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlBvc3RVcGRhdGU7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QcmVQZXJzaXN0OwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuUHJlUmVtb3ZlOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuUHJlVXBkYXRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuVHJh\nbnNpZW50OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoy\nRG9Qcml2NUhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5BYnN0\ncmFjdE1ldGFEYXRhRGVmYXVsdHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLlZhbHVlTWV0YURhdGE7CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNo\nZS5vcGVuanBhLnBlcnNpc3RlbmNlLlBlcnNpc3RlbmNlU3RyYXRlZ3kuKjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNv\nbmZpZ3VyYXRpb247CgovKioKICogSlBBLWJhc2VkIG1ldGFkYXRhIGRlZmF1\nbHRzLgogKgogKiBAYXV0aG9yIFBhdHJpY2sgTGluc2tleQogKiBAYXV0aG9y\nIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgUGVy\nc2lzdGVuY2VNZXRhRGF0YURlZmF1bHRzCiAgICBleHRlbmRzIEFic3RyYWN0\nTWV0YURhdGFEZWZhdWx0cyB7CgogICAgcHJpdmF0ZSBib29sZWFuIF9hbGxv\nd3NNdWx0aXBsZU1ldGhvZHNGb3JTYW1lQ2FsbGJhY2sgPSBmYWxzZTsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2Fs\naXplci5mb3JQYWNrYWdlCiAgICAgICAgKFBlcnNpc3RlbmNlTWV0YURhdGFE\nZWZhdWx0cy5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFw\nPENsYXNzLCBQZXJzaXN0ZW5jZVN0cmF0ZWd5PiBfc3RyYXRzID0KICAgICAg\nICBuZXcgSGFzaE1hcDxDbGFzcywgUGVyc2lzdGVuY2VTdHJhdGVneT4oKTsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFNldDxTdHJpbmc+IF9pZ25vcmVk\nQW5ub3MgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7CgogICAgc3RhdGljIHsK\nICAgICAgICBfc3RyYXRzLnB1dChCYXNpYy5jbGFzcywgQkFTSUMpOwogICAg\nICAgIF9zdHJhdHMucHV0KE1hbnlUb09uZS5jbGFzcywgTUFOWV9PTkUpOwog\nICAgICAgIF9zdHJhdHMucHV0KE9uZVRvT25lLmNsYXNzLCBPTkVfT05FKTsK\nICAgICAgICBfc3RyYXRzLnB1dChFbWJlZGRlZC5jbGFzcywgRU1CRURERUQp\nOwogICAgICAgIF9zdHJhdHMucHV0KEVtYmVkZGVkSWQuY2xhc3MsIEVNQkVE\nREVEKTsKICAgICAgICBfc3RyYXRzLnB1dChPbmVUb01hbnkuY2xhc3MsIE9O\nRV9NQU5ZKTsKICAgICAgICBfc3RyYXRzLnB1dChNYW55VG9NYW55LmNsYXNz\nLCBNQU5ZX01BTlkpOwogICAgICAgIF9zdHJhdHMucHV0KFBlcnNpc3RlbnQu\nY2xhc3MsIFBFUlMpOwogICAgICAgIF9zdHJhdHMucHV0KFBlcnNpc3RlbnRD\nb2xsZWN0aW9uLmNsYXNzLCBQRVJTX0NPTEwpOwogICAgICAgIF9zdHJhdHMu\ncHV0KFBlcnNpc3RlbnRNYXAuY2xhc3MsIFBFUlNfTUFQKTsKCiAgICAgICAg\nX2lnbm9yZWRBbm5vcy5hZGQoRGV0YWNoZWRTdGF0ZS5jbGFzcy5nZXROYW1l\nKCkpOwogICAgICAgIF9pZ25vcmVkQW5ub3MuYWRkKFBvc3RMb2FkLmNsYXNz\nLmdldE5hbWUoKSk7CiAgICAgICAgX2lnbm9yZWRBbm5vcy5hZGQoUG9zdFBl\ncnNpc3QuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAgICBfaWdub3JlZEFubm9z\nLmFkZChQb3N0UmVtb3ZlLmNsYXNzLmdldE5hbWUoKSk7CiAgICAgICAgX2ln\nbm9yZWRBbm5vcy5hZGQoUG9zdFVwZGF0ZS5jbGFzcy5nZXROYW1lKCkpOwog\nICAgICAgIF9pZ25vcmVkQW5ub3MuYWRkKFByZVBlcnNpc3QuY2xhc3MuZ2V0\nTmFtZSgpKTsKICAgICAgICBfaWdub3JlZEFubm9zLmFkZChQcmVSZW1vdmUu\nY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAgICBfaWdub3JlZEFubm9zLmFkZChQ\ncmVVcGRhdGUuY2xhc3MuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICBwdWJsaWMg\nUGVyc2lzdGVuY2VNZXRhRGF0YURlZmF1bHRzKCkgewogICAgICAgIHNldENh\nbGxiYWNrTW9kZShDQUxMQkFDS19SRVRIUk9XIHwgQ0FMTEJBQ0tfUk9MTEJB\nQ0sgfAogICAgICAgICAgICBDQUxMQkFDS19GQUlMX0ZBU1QpOwogICAgICAg\nIHNldERhdGFTdG9yZU9iamVjdElkRmllbGRVbndyYXBwZWQodHJ1ZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvZGUgZm9yIHRoZSBz\ndHJhdGVneSBvZiB0aGUgZ2l2ZW4gbWVtYmVyLiBSZXR1cm4gbnVsbCBpZgog\nICAgICogbm8gc3RyYXRlZ3kuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nUGVyc2lzdGVuY2VTdHJhdGVneSBnZXRQZXJzaXN0ZW5jZVN0cmF0ZWd5CiAg\nICAgICAgKEZpZWxkTWV0YURhdGEgZm1kLCBNZW1iZXIgbWVtYmVyKSB7CiAg\nICAgICAgaWYgKG1lbWJlciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBBbm5vdGF0ZWRFbGVtZW50IGVsID0gKEFubm90YXRl\nZEVsZW1lbnQpIG1lbWJlcjsKICAgICAgICBpZiAoKChCb29sZWFuKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdjVIZWxwZXIKICAg\nICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNlbnRBY3Rpb24oZWwsIFRyYW5z\naWVudC5jbGFzcykpKS5ib29sZWFuVmFsdWUoKSkKICAgICAgICAgICAgcmV0\ndXJuIFRSQU5TSUVOVDsKICAgICAgICBpZiAoZm1kICE9IG51bGwKICAgICAg\nICAgICAgJiYgZm1kLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRh\nLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgLy8gbG9vayBmb3IgcGVyc2lzdGVuY2Ugc3RyYXRlZ3kgaW4g\nYW5ub3RhdGlvbiB0YWJsZQogICAgICAgIFBlcnNpc3RlbmNlU3RyYXRlZ3kg\ncHN0cmF0ID0gbnVsbDsKICAgICAgICBmb3IgKEFubm90YXRpb24gYW5ubyA6\nIGVsLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewogICAgICAgICAgICBp\nZiAocHN0cmF0ICE9IG51bGwgJiYgX3N0cmF0cy5jb250YWluc0tleShhbm5v\nLmFubm90YXRpb25UeXBlKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJhbHJlYWR5LXBlcnMiLCBt\nZW1iZXIpKTsKICAgICAgICAgICAgaWYgKHBzdHJhdCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcHN0cmF0ID0gX3N0cmF0cy5nZXQoYW5uby5hbm5vdGF0\naW9uVHlwZSgpKTsKICAgICAgICB9CiAgICAgICAgaWYgKHBzdHJhdCAhPSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gcHN0cmF0OwoKICAgICAgICBDbGFz\ncyB0eXBlOwogICAgICAgIGludCBjb2RlOwogICAgICAgIGlmIChmbWQgIT0g\nbnVsbCkgewogICAgICAgICAgICB0eXBlID0gZm1kLmdldFR5cGUoKTsKICAg\nICAgICAgICAgY29kZSA9IGZtZC5nZXRUeXBlQ29kZSgpOwogICAgICAgIH0g\nZWxzZSBpZiAobWVtYmVyIGluc3RhbmNlb2YgRmllbGQpIHsKICAgICAgICAg\nICAgdHlwZSA9ICgoRmllbGQpIG1lbWJlcikuZ2V0VHlwZSgpOwogICAgICAg\nICAgICBjb2RlID0gSmF2YVR5cGVzLmdldFR5cGVDb2RlKHR5cGUpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHR5cGUgPSAoKE1ldGhvZCkgbWVt\nYmVyKS5nZXRSZXR1cm5UeXBlKCk7CiAgICAgICAgICAgIGNvZGUgPSBKYXZh\nVHlwZXMuZ2V0VHlwZUNvZGUodHlwZSk7CiAgICAgICAgfQoKICAgICAgICBz\nd2l0Y2ggKGNvZGUpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJS\nQVk6CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PSBieXRlW10uY2xhc3MK\nICAgICAgICAgICAgICAgICAgICB8fCB0eXBlID09IGNoYXJbXS5jbGFzcwog\nICAgICAgICAgICAgICAgICAgIHx8IHR5cGUgPT0gQnl0ZVtdLmNsYXNzCiAg\nICAgICAgICAgICAgICAgICAgfHwgdHlwZSA9PSBDaGFyYWN0ZXJbXS5jbGFz\ncykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gQkFTSUM7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9P\nTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTl9PQko6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFS\nX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TSE9SVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JK\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICByZXR1cm4gQkFTSUM7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAg\nICAgIGlmIChFbnVtLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIEJBU0lDOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICAvLyMjIyBFSkIzOiB3aGF0\nIGlmIGRlZmluZWQgaW4gWE1MPwogICAgICAgIGlmICgoKEJvb2xlYW4pIEFj\nY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2NUhlbHBlcgog\nICAgICAgICAgICAuaXNBbm5vdGF0aW9uUHJlc2VudEFjdGlvbih0eXBlLCBF\nbWJlZGRhYmxlLmNsYXNzKSkpLmJvb2xlYW5WYWx1ZSgpKQogICAgICAgICAg\nICByZXR1cm4gRU1CRURERUQ7CiAgICAgICAgaWYgKFNlcmlhbGl6YWJsZS5j\nbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpKQogICAgICAgICAgICByZXR1\ncm4gQkFTSUM7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAKICAg\nIC8qKiAKICAgICAqIEZsYWdzIGlmIG11bHRpcGxlIG1ldGhvZHMgb2YgdGhl\nIHNhbWUgY2xhc3MgY2FuIGhhbmRsZSB0aGUgc2FtZSAKICAgICAqIGNhbGxi\nYWNrIGV2ZW50LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBbGxv\nd3NNdWx0aXBsZU1ldGhvZHNGb3JTYW1lQ2FsbGJhY2soKSB7CiAgICAgICAg\ncmV0dXJuIF9hbGxvd3NNdWx0aXBsZU1ldGhvZHNGb3JTYW1lQ2FsbGJhY2s7\nCiAgICB9CiAgICAKICAgIC8qKiAKICAgICAqIEZsYWdzIGlmIG11bHRpcGxl\nIG1ldGhvZHMgb2YgdGhlIHNhbWUgY2xhc3MgY2FuIGhhbmRsZSB0aGUgc2Ft\nZSAKICAgICAqIGNhbGxiYWNrIGV2ZW50LgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRBbGxvd3NNdWx0aXBsZU1ldGhvZHNGb3JTYW1lQ2FsbGJhY2so\nYm9vbGVhbiBmbGFnKSB7CiAgICAgICAgX2FsbG93c011bHRpcGxlTWV0aG9k\nc0ZvclNhbWVDYWxsYmFjayA9IGZsYWc7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBdXRvLWNvbmZpZ3VyYXRpb24gbWV0aG9kIGZvciB0aGUgZGVmYXVsdCBh\nY2Nlc3MgdHlwZSBvZiBiYXNlIGNsYXNzZXMgCiAgICAgKiB3aXRoIEFDQ0VT\nU19VTktOT1dOCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERlZmF1bHRB\nY2Nlc3NUeXBlKFN0cmluZyB0eXBlKSB7CiAgICAgICAgaWYgKHR5cGUgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICgiUFJPUEVS\nVFkiLmVxdWFscyh0eXBlLnRvVXBwZXJDYXNlKCkpKQogICAgICAgICAgICBz\nZXREZWZhdWx0QWNjZXNzVHlwZShDbGFzc01ldGFEYXRhLkFDQ0VTU19QUk9Q\nRVJUWSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXREZWZhdWx0QWNj\nZXNzVHlwZShDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCk7CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBwb3B1bGF0ZShDbGFzc01l\ndGFEYXRhIG1ldGEsIGludCBhY2Nlc3MpIHsKICAgICAgICBzdXBlci5wb3B1\nbGF0ZShtZXRhLCBhY2Nlc3MpOwogICAgICAgIG1ldGEuc2V0RGV0YWNoYWJs\nZSh0cnVlKTsKICAgICAgICAvLyBkbyBub3QgY2FsbCBnZXQqRmllbGRzIGFz\nIGl0IHdpbGwgbG9jayBkb3duIHRoZSBmaWVsZHMuCiAgICB9CgogICAgQE92\nZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBwb3B1bGF0ZShGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgICAgIHNldENhc2NhZGVOb25lKGZtZCk7CiAgICAg\nICAgc2V0Q2FzY2FkZU5vbmUoZm1kLmdldEtleSgpKTsKICAgICAgICBzZXRD\nYXNjYWRlTm9uZShmbWQuZ2V0RWxlbWVudCgpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFR1cm5zIG9mZiBhdXRvIGNhc2NhZGluZyBvZiBwZXJzaXN0LCBy\nZWZyZXNoLCBhdHRhY2guCiAgICAgKi8KICAgIHN0YXRpYyB2b2lkIHNldENh\nc2NhZGVOb25lKFZhbHVlTWV0YURhdGEgdm1kKSB7CiAgICAgICAgdm1kLnNl\ndENhc2NhZGVQZXJzaXN0KFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FKTsK\nICAgICAgICB2bWQuc2V0Q2FzY2FkZVJlZnJlc2goVmFsdWVNZXRhRGF0YS5D\nQVNDQURFX05PTkUpOwogICAgICAgIHZtZC5zZXRDYXNjYWRlQXR0YWNoKFZh\nbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FKTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHByb3RlY3RlZCBpbnQgZ2V0QWNjZXNzVHlwZShDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gZ2V0QWNjZXNzVHlwZShtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZWN1cnNpdmUgaGVscGVyIHRvIGRldGVybWluZSBhY2Nlc3MgdHlwZSBiYXNl\nZCBvbiBhbm5vdGF0aW9uIHBsYWNlbWVudC4KICAgICAqLwogICAgcHJpdmF0\nZSBpbnQgZ2V0QWNjZXNzVHlwZShDbGFzcyBjbHMpIHsKICAgICAgICAvLyB0\ncmF2ZXJzZWQgZW50aXJlIGhpZXJhcmNoeSB3aXRob3V0IGZpbmRpbmcgYW5u\nb3RhdGlvbnMKICAgICAgICBpZiAoY2xzID09IG51bGwgfHwgY2xzID09IE9i\namVjdC5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIENsYXNzTWV0YURhdGEu\nQUNDRVNTX1VOS05PV047CgogICAgICAgIGludCBhY2Nlc3MgPSAwOwogICAg\nICAgIGlmICh1c2VzQWNjZXNzKChGaWVsZFtdKSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXY1SGVscGVyLmdl\ndERlY2xhcmVkRmllbGRzQWN0aW9uKGNscykpKSkKICAgICAgICAgICAgYWNj\nZXNzIHw9IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEOwogICAgICAgIGlm\nICh1c2VzQWNjZXNzKChNZXRob2RbXSkgQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2NUhlbHBlci5nZXREZWNs\nYXJlZE1ldGhvZHNBY3Rpb24oY2xzKSkpKQogICAgICAgICAgICBhY2Nlc3Mg\nfD0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVSVFk7CiAgICAgICAgcmV0\ndXJuIChhY2Nlc3MgPT0gMCkgPyBnZXRBY2Nlc3NUeXBlKGNscy5nZXRTdXBl\ncmNsYXNzKCkpIDogYWNjZXNzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHdoZXRoZXIgdGhlIGdpdmVuIG1lbWJlcnMgaGF2ZSBwZXJzaXN0ZW5j\nZSBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9v\nbGVhbiB1c2VzQWNjZXNzKEFubm90YXRlZEVsZW1lbnRbXSBtZW1iZXJzKSB7\nCiAgICAgICAgQW5ub3RhdGlvbltdIGFubm9zOwogICAgICAgIFN0cmluZyBu\nYW1lOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWVtYmVycy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBhbm5vcyA9IChBbm5vdGF0aW9uW10p\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2NUhlbHBl\ncgogICAgICAgICAgICAgICAgLmdldEFubm90YXRpb25zQWN0aW9uKG1lbWJl\ncnNbaV0pKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBhbm5v\ncy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgbmFtZSA9IGFubm9z\nW2pdLmFubm90YXRpb25UeXBlKCkuZ2V0TmFtZSgpOwogICAgICAgICAgICAg\nICAgaWYgKChuYW1lLnN0YXJ0c1dpdGgoImphdmF4LnBlcnNpc3RlbmNlLiIp\nCiAgICAgICAgICAgICAgICAgICAgfHwgbmFtZS5zdGFydHNXaXRoKCJvcmcu\nYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuIikpCiAgICAgICAgICAgICAg\nICAgICAgJiYgIV9pZ25vcmVkQW5ub3MuY29udGFpbnMobmFtZSkpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBib29sZWFuIGlzRGVmYXVsdFBlcnNpc3RlbnQoQ2xhc3NNZXRhRGF0\nYSBtZXRhLCBNZW1iZXIgbWVtYmVyLAogICAgICAgIFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgaW50IG1vZHMgPSBtZW1iZXIuZ2V0TW9kaWZpZXJzKCk7CiAg\nICAgICAgaWYgKE1vZGlmaWVyLmlzVHJhbnNpZW50KG1vZHMpKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmIChtZW1iZXIgaW5zdGFu\nY2VvZiBNZXRob2QpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIC8vIGNoZWNrIGZvciBzZXR0ZXJzIGZvciBtZXRob2RzCiAgICAgICAg\nICAgICAgICBNZXRob2Qgc2V0dGVyID0gKE1ldGhvZCkgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXY1SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAg\nICAgICAgICAgICAgICBtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgInNldCIg\nKwogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmdVdGlscy5jYXBpdGFs\naXplKG5hbWUpLCBuZXcgQ2xhc3NbXSB7IAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKChNZXRob2QpIG1lbWJlcikuZ2V0UmV0dXJuVHlwZSgpIH0p\nKTsKICAgICAgICAgICAgICAgIGlmIChzZXR0ZXIgPT0gbnVsbCAmJiAhaXNB\nbm5vdGF0ZWRUcmFuc2llbnQobWVtYmVyKSkgewogICAgICAgICAgICAgICAg\nICAgIGxvZ05vU2V0dGVyKG1ldGEsIG5hbWUsIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIC8vIGUuZy4sIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbgogICAgICAgICAg\nICAgICAgaWYgKCFpc0Fubm90YXRlZFRyYW5zaWVudChtZW1iZXIpKQogICAg\nICAgICAgICAgICAgICAgIGxvZ05vU2V0dGVyKG1ldGEsIG5hbWUsIGUpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICBQZXJzaXN0ZW5jZVN0cmF0ZWd5IHN0cmF0ID0g\nZ2V0UGVyc2lzdGVuY2VTdHJhdGVneShudWxsLCBtZW1iZXIpOwogICAgICAg\nIGlmIChzdHJhdCA9PSBudWxsIHx8IHN0cmF0ID09IFBlcnNpc3RlbmNlU3Ry\nYXRlZ3kuVFJBTlNJRU5UKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgcmV0dXJuIHRydWU7Cgl9CgogICAgcHJpdmF0ZSBib29sZWFuIGlz\nQW5ub3RhdGVkVHJhbnNpZW50KE1lbWJlciBtZW1iZXIpIHsKICAgICAgICBy\nZXR1cm4gbWVtYmVyIGluc3RhbmNlb2YgQW5ub3RhdGVkRWxlbWVudAogICAg\nICAgICAgICAmJiAoKEJvb2xlYW4pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKEoyRG9Qcml2NUhlbHBlcgogICAgICAgICAgICAgICAgLmlzQW5u\nb3RhdGlvblByZXNlbnRBY3Rpb24oKChBbm5vdGF0ZWRFbGVtZW50KSBtZW1i\nZXIpLAogICAgICAgICAgICAgICAgICAgIFRyYW5zaWVudC5jbGFzcykpKS5i\nb29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgbG9nTm9T\nZXR0ZXIoQ2xhc3NNZXRhRGF0YSBtZXRhLCBTdHJpbmcgbmFtZSwgRXhjZXB0\naW9uIGUpIHsKICAgICAgICBMb2cgbG9nID0gbWV0YS5nZXRSZXBvc2l0b3J5\nKCkuZ2V0Q29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5nZXRMb2coT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24uTE9HX01FVEFEQVRBKTsKICAgICAgICBpZiAo\nbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLndhcm4oX2xv\nYy5nZXQoIm5vLXNldHRlci1mb3ItZ2V0dGVyIiwgbmFtZSwKICAgICAgICAg\nICAgICAgIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSkpOwog\nICAgICAgIGVsc2UgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICAvLyBsb2cgdGhlIGV4Y2VwdGlvbiwgaWYgYW55LCBpZiB3ZSdyZSBp\nbiB0cmFjZS1sZXZlbCBkZWJ1Z2dpbmcKICAgICAgICAgICAgbG9nLndhcm4o\nX2xvYy5nZXQoIm5vLXNldHRlci1mb3ItZ2V0dGVyIiwgbmFtZSwKICAgICAg\nICAgICAgICAgIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSks\nIGUpOwogICAgfQp9Cg==\n","encoding":"base64"}

