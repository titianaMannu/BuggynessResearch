{"sha":"48f6e534f636ae8c2b9d4b0537bae68fb975d7f1","node_id":"MDQ6QmxvYjIwNjM2NDo0OGY2ZTUzNGY2MzZhZThjMmI5ZDRiMDUzN2JhZTY4ZmI5NzVkN2Yx","size":20633,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/48f6e534f636ae8c2b9d4b0537bae68fb975d7f1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubmV0Lk1hbGZvcm1lZFVSTEV4Y2VwdGlvbjsKaW1wb3J0\nIGphdmEubmV0LlVSTDsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNzQ29u\ndHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlv\nbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuRW51\nbWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuTWlzc2luZ1Jlc291cmNlRXhj\nZXB0aW9uOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uuc3BpLlBlcnNpc3Rl\nbmNlVW5pdEluZm87CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5zcGkuUGVy\nc2lzdGVuY2VVbml0VHJhbnNhY3Rpb25UeXBlOwoKaW1wb3J0IG9yZy5hcGFj\naGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbklt\ncGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBUHJv\nZHVjdERlcml2YXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmNvbmYuQWJzdHJhY3RQcm9kdWN0RGVyaXZhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25Qcm92\naWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25m\naWd1cmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29u\nZi5NYXBDb25maWd1cmF0aW9uUHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLmNvbmYuUHJvZHVjdERlcml2YXRpb25zOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5tZXRhLlhNTE1ldGFEYXRhUGFyc2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy54bWwuc2F4LkF0dHJpYnV0ZXM7CmltcG9ydCBvcmcu\neG1sLnNheC5TQVhFeGNlcHRpb247CgovKioKICogU2V0cyBKUEEgc3BlY2lm\naWNhdGlvbiBkZWZhdWx0cyBhbmQgcGFyc2VzIEpQQSBzcGVjaWZpY2F0aW9u\nIFhNTCBmaWxlcy4KICogCiAqIEZvciBnbG9iYWxzLCBsb29rcyBpbiA8Y29k\nZT5vcGVuanBhLnByb3BlcnRpZXM8L2NvZGU+IHN5c3RlbSBwcm9wZXJ0eSBm\nb3IKICogdGhlIGxvY2F0aW9uIG9mIGEgZmlsZSB0byBwYXJzZS4gSWYgbm8g\nc3lzdGVtIHByb3BlcnR5IGlzIGRlZmluZWQsIHRoZQogKiBkZWZhdWx0IHJl\nc291cmNlIGxvY2F0aW9uIG9mIDxjb2RlPk1FVEEtSU5GL29wZW5qcGEueG1s\nPC9jb2RlPiBpcyB1c2VkLgogKgogKiBGb3IgZGVmYXVsdHMsIGxvb2tzIGZv\nciA8Y29kZT5NRVRBLUlORi9wZXJzaXN0ZW5jZS54bWw8L2NvZGU+LgogKiBX\naXRoaW4gPGNvZGU+cGVyc2lzdGVuY2UueG1sPC9jb2RlPiwgbG9vayBmb3Ig\ndGhlIG5hbWVkIHBlcnNpc3RlbmNlIHVuaXQsIG9yCiAqIGlmIG5vIG5hbWUg\nZ2l2ZW4sIGFuIE9wZW5KUEEgdW5pdCAocHJlZmVycmluZyBhbiB1bm5hbWVk\nIE9wZW5KUEEgdW5pdCB0byAKICogYSBuYW1lZCBvbmUpLgogKgogKiBAYXV0\naG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3Mg\nUGVyc2lzdGVuY2VQcm9kdWN0RGVyaXZhdGlvbiAKICAgIGV4dGVuZHMgQWJz\ndHJhY3RQcm9kdWN0RGVyaXZhdGlvbgogICAgaW1wbGVtZW50cyBPcGVuSlBB\nUHJvZHVjdERlcml2YXRpb24gewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nU3RyaW5nIFNQRUNfSlBBID0gImpwYSI7CiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIFN0cmluZyBBTElBU19FSkIgPSAiZWpiIjsKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgU3RyaW5nIFJTUkNfR0xPQkFMID0gIk1FVEEtSU5GL29wZW5q\ncGEueG1sIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFJTUkNf\nREVGQVVMVCA9ICJNRVRBLUlORi9wZXJzaXN0ZW5jZS54bWwiOwoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVy\nLmZvclBhY2thZ2UKICAgICAgICAoUGVyc2lzdGVuY2VQcm9kdWN0RGVyaXZh\ndGlvbi5jbGFzcyk7CgogICAgcHVibGljIHZvaWQgcHV0QnJva2VyRmFjdG9y\neUFsaWFzZXMoTWFwIG0pIHsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldFR5\ncGUoKSB7CiAgICAgICAgcmV0dXJuIFRZUEVfU1BFQzsKICAgIH0KCiAgICBA\nT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHZhbGlkYXRlKCkKICAgICAgICB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvLyBtYWtlIHN1cmUgSlBBIGlz\nIGF2YWlsYWJsZQogICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKAogICAg\nICAgICAgICBqYXZheC5wZXJzaXN0ZW5jZS5FbnRpdHlNYW5hZ2VyRmFjdG9y\neS5jbGFzcykpOwogICAgfQogICAgCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyBib29sZWFuIGJlZm9yZUNvbmZpZ3VyYXRpb25Mb2FkKENvbmZpZ3VyYXRp\nb24gYykgewogICAgICAgIGlmICghKGMgaW5zdGFuY2VvZiBPcGVuSlBBQ29u\nZmlndXJhdGlvbkltcGwpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgCiAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb25JbXBsIGNvbmYg\nPSAoT3BlbkpQQUNvbmZpZ3VyYXRpb25JbXBsKSBjOwogICAgICAgIGNvbmYu\nbWV0YUZhY3RvcnlQbHVnaW4uc2V0QWxpYXMoQUxJQVNfRUpCLAogICAgICAg\nICAgICBQZXJzaXN0ZW5jZU1ldGFEYXRhRmFjdG9yeS5jbGFzcy5nZXROYW1l\nKCkpOwogICAgICAgIGNvbmYubWV0YUZhY3RvcnlQbHVnaW4uc2V0QWxpYXMo\nU1BFQ19KUEEsCiAgICAgICAgICAgIFBlcnNpc3RlbmNlTWV0YURhdGFGYWN0\nb3J5LmNsYXNzLmdldE5hbWUoKSk7CiAgICAgICAgCiAgICAgICAgY29uZi5h\nZGRWYWx1ZShuZXcgRW50aXR5TWFuYWdlckZhY3RvcnlWYWx1ZSgpKTsKICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyBib29sZWFuIGFmdGVyU3BlY2lmaWNhdGlvblNldChDb25maWd1cmF0\naW9uIGMpIHsKICAgICAgaWYgKCEoYyBpbnN0YW5jZW9mIE9wZW5KUEFDb25m\naWd1cmF0aW9uSW1wbCkKICAgICAgICAgfHwgIVNQRUNfSlBBLmVxdWFscygo\nKE9wZW5KUEFDb25maWd1cmF0aW9uKSBjKS5nZXRTcGVjaWZpY2F0aW9uKCkp\nKQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogCiAgICAgICAgT3BlbkpQQUNv\nbmZpZ3VyYXRpb25JbXBsIGNvbmYgPSAoT3BlbkpQQUNvbmZpZ3VyYXRpb25J\nbXBsKSBjOwogICAgICAgIGNvbmYubWV0YUZhY3RvcnlQbHVnaW4uc2V0RGVm\nYXVsdChTUEVDX0pQQSk7CiAgICAgICAgY29uZi5tZXRhRmFjdG9yeVBsdWdp\nbi5zZXRTdHJpbmcoU1BFQ19KUEEpOwogICAgICAgIGNvbmYubG9ja01hbmFn\nZXJQbHVnaW4uc2V0RGVmYXVsdCgidmVyc2lvbiIpOwogICAgICAgIGNvbmYu\nbG9ja01hbmFnZXJQbHVnaW4uc2V0U3RyaW5nKCJ2ZXJzaW9uIik7CiAgICAg\nICAgY29uZi5ub250cmFuc2FjdGlvbmFsV3JpdGUuc2V0RGVmYXVsdCgidHJ1\nZSIpOwogICAgICAgIGNvbmYubm9udHJhbnNhY3Rpb25hbFdyaXRlLnNldCh0\ncnVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIExvYWQgY29uZmlndXJhdGlvbiBmcm9tIHRoZSBnaXZlbiBwZXJzaXN0\nZW5jZSB1bml0IHdpdGggdGhlIHNwZWNpZmllZAogICAgICogdXNlciBwcm9w\nZXJ0aWVzLgogICAgICovCiAgICBwdWJsaWMgQ29uZmlndXJhdGlvblByb3Zp\nZGVyIGxvYWQoUGVyc2lzdGVuY2VVbml0SW5mbyBwaW5mbywgTWFwIG0pCiAg\nICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAocGluZm8g\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYg\nKCFpc09wZW5KUEFQZXJzaXN0ZW5jZVByb3ZpZGVyKHBpbmZvLCBudWxsKSkg\newogICAgICAgICAgICB3YXJuVW5rbm93blByb3ZpZGVyKHBpbmZvKTsKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBDb25m\naWd1cmF0aW9uUHJvdmlkZXJJbXBsIGNwID0gbmV3IENvbmZpZ3VyYXRpb25Q\ncm92aWRlckltcGwoKTsKICAgICAgICBjcC5hZGRQcm9wZXJ0aWVzKFBlcnNp\nc3RlbmNlVW5pdEluZm9JbXBsLnRvT3BlbkpQQVByb3BlcnRpZXMocGluZm8p\nKTsKICAgICAgICBjcC5hZGRQcm9wZXJ0aWVzKG0pOwogICAgICAgIGlmIChw\naW5mbyBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlVW5pdEluZm9JbXBsKSB7CiAg\nICAgICAgICAgIFBlcnNpc3RlbmNlVW5pdEluZm9JbXBsIGltcGwgPSAoUGVy\nc2lzdGVuY2VVbml0SW5mb0ltcGwpIHBpbmZvOwogICAgICAgICAgICBpZiAo\naW1wbC5nZXRQZXJzaXN0ZW5jZVhtbEZpbGVVcmwoKSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgY3Auc2V0U291cmNlKGltcGwuZ2V0UGVyc2lzdGVuY2VY\nbWxGaWxlVXJsKCkudG9TdHJpbmcoKSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBjcDsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgY29uZmlndXJh\ndGlvbiBmcm9tIHRoZSBnaXZlbiByZXNvdXJjZSBhbmQgdW5pdCBuYW1lcywg\nd2hpY2ggbWF5CiAgICAgKiBiZSBudWxsLgogICAgICovCiAgICBwdWJsaWMg\nQ29uZmlndXJhdGlvblByb3ZpZGVyIGxvYWQoU3RyaW5nIHJzcmMsIFN0cmlu\nZyBuYW1lLCBNYXAgbSkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIGJvb2xlYW4gZXhwbGljaXQgPSAhU3RyaW5nVXRpbHMuaXNFbXB0\neShyc3JjKTsKICAgICAgICBpZiAoIWV4cGxpY2l0KQogICAgICAgICAgICBy\nc3JjID0gUlNSQ19ERUZBVUxUOwogICAgICAgIAogICAgICAgIENvbmZpZ3Vy\nYXRpb25Qcm92aWRlckltcGwgY3AgPSBuZXcgQ29uZmlndXJhdGlvblByb3Zp\nZGVySW1wbCgpOwogICAgICAgIEJvb2xlYW4gcmV0ID0gbG9hZChjcCwgcnNy\nYywgbmFtZSwgbSwgbnVsbCwgZXhwbGljaXQpOwogICAgICAgIGlmIChyZXQg\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIChyZXQuYm9vbGVhblZhbHVl\nKCkpID8gY3AgOiBudWxsOwogICAgICAgIGlmIChleHBsaWNpdCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIHBlcnNpc3RlbmNlLnht\nbCBkb2VzIG5vdCBleGlzdDsganVzdCBsb2FkIG1hcAogICAgICAgIFBlcnNp\nc3RlbmNlVW5pdEluZm9JbXBsIHBpbmZvID0gbmV3IFBlcnNpc3RlbmNlVW5p\ndEluZm9JbXBsKCk7CiAgICAgICAgcGluZm8uZnJvbVVzZXJQcm9wZXJ0aWVz\nKG0pOwogICAgICAgIGlmICghaXNPcGVuSlBBUGVyc2lzdGVuY2VQcm92aWRl\ncihwaW5mbywgbnVsbCkpIHsKICAgICAgICAgICAgd2FyblVua25vd25Qcm92\naWRlcihwaW5mbyk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIH0KICAgICAgICBjcC5hZGRQcm9wZXJ0aWVzKHBpbmZvLnRvT3BlbkpQQVBy\nb3BlcnRpZXMoKSk7CiAgICAgICAgcmV0dXJuIGNwOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIENvbmZpZ3VyYXRpb25Qcm92aWRlciBsb2Fk\nKFN0cmluZyByc3JjLCBTdHJpbmcgYW5jaG9yLCAKICAgICAgICBDbGFzc0xv\nYWRlciBsb2FkZXIpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAocnNyYyAhPSBudWxsICYmICFyc3JjLmVuZHNXaXRoKCIueG1s\nIikpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIENvbmZpZ3Vy\nYXRpb25Qcm92aWRlckltcGwgY3AgPSBuZXcgQ29uZmlndXJhdGlvblByb3Zp\nZGVySW1wbCgpOwogICAgICAgIGlmIChsb2FkKGNwLCByc3JjLCBhbmNob3Is\nIG51bGwsIGxvYWRlciwgdHJ1ZSkgPT0gQm9vbGVhbi5UUlVFKQogICAgICAg\nICAgICByZXR1cm4gY3A7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgQ29uZmlndXJhdGlvblByb3ZpZGVy\nIGxvYWQoRmlsZSBmaWxlLCBTdHJpbmcgYW5jaG9yKSAKICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmICghZmlsZS5nZXROYW1lKCku\nZW5kc1dpdGgoIi54bWwiKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIENvbmZpZ3VyYXRpb25QYXJzZXIgcGFyc2VyID0gbmV3IENvbmZp\nZ3VyYXRpb25QYXJzZXIobnVsbCk7CiAgICAgICAgcGFyc2VyLnBhcnNlKGZp\nbGUpOwogICAgICAgIHJldHVybiBsb2FkKGZpbmRVbml0KChMaXN0PFBlcnNp\nc3RlbmNlVW5pdEluZm9JbXBsPikgCiAgICAgICAgICAgIHBhcnNlci5nZXRS\nZXN1bHRzKCksIGFuY2hvciwgbnVsbCksIG51bGwpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIENvbmZpZ3VyYXRpb25Qcm92aWRlciBsb2Fk\nR2xvYmFscyhDbGFzc0xvYWRlciBsb2FkZXIpCiAgICAgICAgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmdbXSBwcmVmaXhlcyA9IFByb2R1\nY3REZXJpdmF0aW9ucy5nZXRDb25maWd1cmF0aW9uUHJlZml4ZXMoKTsKICAg\nICAgICBTdHJpbmcgcnNyYyA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBwcmVmaXhlcy5sZW5ndGggJiYgU3RyaW5nVXRpbHMuaXNFbXB0\neShyc3JjKTsgaSsrKQogICAgICAgICAgIHJzcmMgPSAoU3RyaW5nKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAg\nICAgICAgICAgICAgLmdldFByb3BlcnR5QWN0aW9uKHByZWZpeGVzW2ldICsg\nIi5wcm9wZXJ0aWVzIikpOyAKICAgICAgICBib29sZWFuIGV4cGxpY2l0ID0g\nIVN0cmluZ1V0aWxzLmlzRW1wdHkocnNyYyk7CiAgICAgICAgU3RyaW5nIGFu\nY2hvciA9IG51bGw7CiAgICAgICAgaW50IGlkeCA9ICghZXhwbGljaXQpID8g\nLTEgOiByc3JjLmxhc3RJbmRleE9mKCcjJyk7CiAgICAgICAgaWYgKGlkeCAh\nPSAtMSkgewogICAgICAgICAgICAvLyBzZXBhcmF0ZSBuYW1lIGZyb20gPHJl\nc3JvdWNlPiM8bmFtZT4gc3RyaW5nCiAgICAgICAgICAgIGlmIChpZHggPCBy\nc3JjLmxlbmd0aCgpIC0gMSkKICAgICAgICAgICAgICAgIGFuY2hvciA9IHJz\ncmMuc3Vic3RyaW5nKGlkeCArIDEpOwogICAgICAgICAgICByc3JjID0gcnNy\nYy5zdWJzdHJpbmcoMCwgaWR4KTsKICAgICAgICB9CiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkocnNyYykpCiAgICAgICAgICAgIHJzcmMgPSBS\nU1JDX0dMT0JBTDsKICAgICAgICBlbHNlIGlmICghcnNyYy5lbmRzV2l0aCgi\nLnhtbCIpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ29u\nZmlndXJhdGlvblByb3ZpZGVySW1wbCBjcCA9IG5ldyBDb25maWd1cmF0aW9u\nUHJvdmlkZXJJbXBsKCk7CiAgICAgICAgaWYgKGxvYWQoY3AsIHJzcmMsIGFu\nY2hvciwgbnVsbCwgbG9hZGVyLCBleHBsaWNpdCkgPT0gQm9vbGVhbi5UUlVF\nKQogICAgICAgICAgICByZXR1cm4gY3A7CiAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgQ29uZmlndXJhdGlv\nblByb3ZpZGVyIGxvYWREZWZhdWx0cyhDbGFzc0xvYWRlciBsb2FkZXIpCiAg\nICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBDb25maWd1cmF0\naW9uUHJvdmlkZXJJbXBsIGNwID0gbmV3IENvbmZpZ3VyYXRpb25Qcm92aWRl\nckltcGwoKTsKICAgICAgICBpZiAobG9hZChjcCwgUlNSQ19ERUZBVUxULCBu\ndWxsLCBudWxsLCBsb2FkZXIsIGZhbHNlKSA9PSBCb29sZWFuLlRSVUUpCiAg\nICAgICAgICAgIHJldHVybiBjcDsKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIExvb2tzIHRocm91Z2ggdGhlIHJlc291cmNl\ncyBhdCA8Y29kZT5yc3JjPC9jb2RlPiBmb3IgYSBjb25maWd1cmF0aW9uCiAg\nICAgKiBmaWxlIHRoYXQgbWF0Y2hlcyA8Y29kZT5uYW1lPC9jb2RlPiAob3Ig\nYW4gdW5uYW1lZCBvbmUgaWYKICAgICAqIDxjb2RlPm5hbWU8L2NvZGU+IGlz\nIDxjb2RlPm51bGw8L2NvZGU+KSwgYW5kIGxvYWRzIHRoZSBYTUwgaW4gdGhl\nCiAgICAgKiByZXNvdXJjZSBpbnRvIGEgbmV3IHtAbGluayBQZXJzaXN0ZW5j\nZVVuaXRJbmZvfS4gVGhlbiwgYXBwbGllcyB0aGUKICAgICAqIG92ZXJyaWRl\ncyBpbiA8Y29kZT5tPC9jb2RlPi4KICAgICAqCiAgICAgKiBAcmV0dXJuIHtA\nbGluayBCb29sZWFuI1RSVUV9IGlmIHRoZSByZXNvdXJjZSB3YXMgbG9hZGVk\nLCBudWxsIGlmIGl0CiAgICAgKiBkb2VzIG5vdCBleGlzdCwgb3Ige0BsaW5r\nIEJvb2xlYW4jRkFMU0V9IGlmIGl0IGlzIG5vdCBmb3IgT3BlbkpQQQogICAg\nICovCiAgICBwcml2YXRlIEJvb2xlYW4gbG9hZChDb25maWd1cmF0aW9uUHJv\ndmlkZXJJbXBsIGNwLCBTdHJpbmcgcnNyYywgCiAgICAgICAgU3RyaW5nIG5h\nbWUsIE1hcCBtLCBDbGFzc0xvYWRlciBsb2FkZXIsIGJvb2xlYW4gZXhwbGlj\naXQpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nbG9hZGVyID09IG51bGwpCiAgICAgICAgICAgIGxvYWRlciA9IChDbGFzc0xv\nYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xhc3NMb2FkZXJB\nY3Rpb24oKSk7CgogICAgICAgIEVudW1lcmF0aW9uPFVSTD4gdXJscyA9IG51\nbGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdXJscyA9IChFbnVtZXJh\ndGlvbikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRSZXNvdXJjZXNBY3Rpb24obG9h\nZGVyLCByc3JjKSk7IAogICAgICAgICAgICBpZiAoIXVybHMuaGFzTW9yZUVs\nZW1lbnRzKCkpIHsKICAgICAgICAgICAgICAgIGlmICghcnNyYy5zdGFydHNX\naXRoKCJNRVRBLUlORiIpKQogICAgICAgICAgICAgICAgICAgIHVybHMgPSAo\nRW51bWVyYXRpb24pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAog\nICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRSZXNv\ndXJjZXNBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2Fk\nZXIsICJNRVRBLUlORi8iICsgcnNyYykpOyAKICAgICAgICAgICAgICAgIGlm\nICghdXJscy5oYXNNb3JlRWxlbWVudHMoKSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2gg\nKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24gcGFlKSB7CiAgICAgICAgICAg\nIHRocm93IChJT0V4Y2VwdGlvbikgcGFlLmdldEV4Y2VwdGlvbigpOwogICAg\nICAgIH0KCiAgICAgICAgQ29uZmlndXJhdGlvblBhcnNlciBwYXJzZXIgPSBu\nZXcgQ29uZmlndXJhdGlvblBhcnNlcihtKTsKICAgICAgICBQZXJzaXN0ZW5j\nZVVuaXRJbmZvSW1wbCBwaW5mbyA9IHBhcnNlUmVzb3VyY2VzKHBhcnNlciwg\ndXJscywgbmFtZSwgCiAgICAgICAgICAgIGxvYWRlcik7CiAgICAgICAgaWYg\nKHBpbmZvID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKCFleHBsaWNpdCkK\nICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAg\nICAgICB0aHJvdyBuZXcgTWlzc2luZ1Jlc291cmNlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJtaXNzaW5nLXhtbC1jb25maWciLCAKICAgICAgICAgICAgICAgIHJz\ncmMsIFN0cmluZy52YWx1ZU9mKG5hbWUpKS5nZXRNZXNzYWdlKCksIGdldENs\nYXNzKCkuZ2V0TmFtZSgpLCAKICAgICAgICAgICAgICAgIHJzcmMpOwogICAg\nICAgIH0gZWxzZSBpZiAoIWlzT3BlbkpQQVBlcnNpc3RlbmNlUHJvdmlkZXIo\ncGluZm8sIGxvYWRlcikpIHsKICAgICAgICAgICAgaWYgKCFleHBsaWNpdCkg\newogICAgICAgICAgICAgICAgd2FyblVua25vd25Qcm92aWRlcihwaW5mbyk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgTWlzc2luZ1Jlc291cmNl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bmtub3duLXByb3ZpZGVyIiwgCiAgICAg\nICAgICAgICAgICByc3JjLCBuYW1lLCBwaW5mby5nZXRQZXJzaXN0ZW5jZVBy\nb3ZpZGVyQ2xhc3NOYW1lKCkpLgogICAgICAgICAgICAgICAgZ2V0TWVzc2Fn\nZSgpLCBnZXRDbGFzcygpLmdldE5hbWUoKSwgcnNyYyk7CiAgICAgICAgfQog\nICAgICAgIGNwLmFkZFByb3BlcnRpZXMocGluZm8udG9PcGVuSlBBUHJvcGVy\ndGllcygpKTsKICAgICAgICBjcC5zZXRTb3VyY2UocGluZm8uZ2V0UGVyc2lz\ndGVuY2VYbWxGaWxlVXJsKCkudG9TdHJpbmcoKSk7CiAgICAgICAgcmV0dXJu\nIEJvb2xlYW4uVFJVRTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHJl\nc291cmNlcyBhdCB0aGUgZ2l2ZW4gbG9jYXRpb24uIFNlYXJjaGVzIGZvciBh\nCiAgICAgKiBQZXJzaXN0ZW5jZVVuaXRJbmZvIHdpdGggdGhlIHJlcXVlc3Rl\nZCBuYW1lLCBvciBhbiBPcGVuSlBBIHVuaXQgaWYKICAgICAqIG5vIG5hbWUg\nZ2l2ZW4gKHByZWZlcnJpbmcgYW4gdW5uYW1lZCBPcGVuSlBBIHVuaXQgdG8g\nYSBuYW1lZCBvbmUpLgogICAgICovCiAgICBwcml2YXRlIFBlcnNpc3RlbmNl\nVW5pdEluZm9JbXBsIHBhcnNlUmVzb3VyY2VzKENvbmZpZ3VyYXRpb25QYXJz\nZXIgcGFyc2VyLAogICAgICAgIEVudW1lcmF0aW9uPFVSTD4gdXJscywgU3Ry\naW5nIG5hbWUsIENsYXNzTG9hZGVyIGxvYWRlcikKICAgICAgICB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIExpc3Q8UGVyc2lzdGVuY2VVbml0SW5m\nb0ltcGw+IHBpbmZvcyA9IAogICAgICAgICAgICBuZXcgQXJyYXlMaXN0PFBl\ncnNpc3RlbmNlVW5pdEluZm9JbXBsPigpOwogICAgICAgIGZvciAoVVJMIHVy\nbCA6IENvbGxlY3Rpb25zLmxpc3QodXJscykpIHsKICAgICAgICAgICAgcGFy\nc2VyLnBhcnNlKHVybCk7CiAgICAgICAgICAgIHBpbmZvcy5hZGRBbGwoKExp\nc3Q8UGVyc2lzdGVuY2VVbml0SW5mb0ltcGw+KSBwYXJzZXIuZ2V0UmVzdWx0\ncygpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZpbmRVbml0KHBpbmZv\ncywgbmFtZSwgbG9hZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQg\ndGhlIHVuaXQgd2l0aCB0aGUgZ2l2ZW4gbmFtZSwgb3IgYW4gT3BlbkpQQSB1\nbml0IGlmIG5vIG5hbWUgaXMKICAgICAqIGdpdmVuIChwcmVmZXJyaW5nIGFu\nIHVubmFtZWQgT3BlbkpQQSB1bml0IHRvIGEgbmFtZWQgb25lKS4KICAgICAq\nLwogICAgcHJpdmF0ZSBQZXJzaXN0ZW5jZVVuaXRJbmZvSW1wbCBmaW5kVW5p\ndChMaXN0PFBlcnNpc3RlbmNlVW5pdEluZm9JbXBsPiAKICAgICAgICBwaW5m\nb3MsIFN0cmluZyBuYW1lLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAg\nICBQZXJzaXN0ZW5jZVVuaXRJbmZvSW1wbCBvanBhID0gbnVsbDsKICAgICAg\nICBmb3IgKFBlcnNpc3RlbmNlVW5pdEluZm9JbXBsIHBpbmZvIDogcGluZm9z\nKSB7CiAgICAgICAgICAgIC8vIGZvdW5kIG5hbWVkIHVuaXQ/CiAgICAgICAg\nICAgIGlmIChuYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChu\nYW1lLmVxdWFscyhwaW5mby5nZXRQZXJzaXN0ZW5jZVVuaXROYW1lKCkpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBwaW5mbzsKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\naXNPcGVuSlBBUGVyc2lzdGVuY2VQcm92aWRlcihwaW5mbywgbG9hZGVyKSkg\newogICAgICAgICAgICAgICAgLy8gaWYgbm8gbmFtZSBnaXZlbiBhbmQgZm91\nbmQgdW5uYW1lZCB1bml0LCByZXR1cm4gaXQuICAKICAgICAgICAgICAgICAg\nIC8vIG90aGVyd2lzZSByZWNvcmQgYXMgZGVmYXVsdCB1bml0IHVubGVzcyB3\nZSBmaW5kIGEgCiAgICAgICAgICAgICAgICAvLyBiZXR0ZXIgbWF0Y2ggbGF0\nZXIKICAgICAgICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHBp\nbmZvLmdldFBlcnNpc3RlbmNlVW5pdE5hbWUoKSkpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIHBpbmZvOwogICAgICAgICAgICAgICAgaWYgKG9qcGEg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBvanBhID0gcGluZm87CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9qcGE7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4g\ncGVyc2lzdGVuY2UgdW5pdCB1c2VzIGFuIE9wZW5KUEEgcHJvdmlkZXIuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNPcGVuSlBBUGVy\nc2lzdGVuY2VQcm92aWRlcgogICAgICAgIChQZXJzaXN0ZW5jZVVuaXRJbmZv\nIHBpbmZvLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBTdHJpbmcg\ncHJvdmlkZXIgPSBwaW5mby5nZXRQZXJzaXN0ZW5jZVByb3ZpZGVyQ2xhc3NO\nYW1lKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocHJvdmlk\nZXIpIAogICAgICAgICAgICB8fCBQZXJzaXN0ZW5jZVByb3ZpZGVySW1wbC5j\nbGFzcy5nZXROYW1lKCkuZXF1YWxzKHByb3ZpZGVyKSkKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CgogICAgICAgIGlmIChsb2FkZXIgPT0gbnVsbCkKICAg\nICAgICAgICAgbG9hZGVyID0gKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLmdldENvbnRleHRDbGFzc0xvYWRlckFjdGlvbigpKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoUGVyc2lzdGVuY2VQcm92aWRlckltcGwu\nY2xhc3MuaXNBc3NpZ25hYmxlRnJvbQogICAgICAgICAgICAgICAgKENsYXNz\nLmZvck5hbWUocHJvdmlkZXIsIGZhbHNlLCBsb2FkZXIpKSkKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJs\nZSB0KSB7CiAgICAgICAgICAgIGxvZyhfbG9jLmdldCgidW5sb2FkYWJsZS1w\ncm92aWRlciIsIHByb3ZpZGVyLCB0KS5nZXRNZXNzYWdlKCkpOwogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBm\nYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdhcm4gdGhlIHVzZXIgdGhh\ndCB3ZSBjb3VsZCBvbmx5IGZpbmQgYW4gdW5yZWNvZ25pemVkIHBlcnNpc3Rl\nbmNlIAogICAgICogcHJvdmlkZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIHZvaWQgd2FyblVua25vd25Qcm92aWRlcihQZXJzaXN0ZW5jZVVuaXRJ\nbmZvIHBpbmZvKSB7CiAgICAgICAgbG9nKF9sb2MuZ2V0KCJ1bnJlY29nbml6\nZWQtcHJvdmlkZXIiLCAKICAgICAgICAgICAgcGluZm8uZ2V0UGVyc2lzdGVu\nY2VQcm92aWRlckNsYXNzTmFtZSgpKS5nZXRNZXNzYWdlKCkpOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIExvZyBhIG1lc3NhZ2UuICAgCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIHZvaWQgbG9nKFN0cmluZyBtc2cpIHsKICAg\nICAgICAvLyBhdCB0aGlzIHBvaW50IGxvZ2dpbmcgaXNuJ3QgY29uZmlndXJl\nZCB5ZXQKICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4obXNnKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEN1c3RvbSBjb25maWd1cmF0aW9uIHByb3ZpZGVy\nLiAgIAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIENvbmZpZ3Vy\nYXRpb25Qcm92aWRlckltcGwKICAgICAgICBleHRlbmRzIE1hcENvbmZpZ3Vy\nYXRpb25Qcm92aWRlciB7CgogICAgICAgIHByaXZhdGUgU3RyaW5nIF9zb3Vy\nY2U7CgogICAgICAgIHB1YmxpYyBDb25maWd1cmF0aW9uUHJvdmlkZXJJbXBs\nKCkgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIENvbmZpZ3VyYXRpb25Q\ncm92aWRlckltcGwoTWFwIHByb3BzKSB7CiAgICAgICAgICAgIHN1cGVyKHBy\nb3BzKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0\naGUgc291cmNlIG9mIGluZm9ybWF0aW9uIGluIHRoaXMgcHJvdmlkZXIuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgc2V0U291cmNlKFN0cmlu\nZyBzb3VyY2UpIHsKICAgICAgICAgICAgX3NvdXJjZSA9IHNvdXJjZTsKICAg\nICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lk\nIHNldEludG8oQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAgICAgIGlm\nIChjb25mIGluc3RhbmNlb2YgT3BlbkpQQUNvbmZpZ3VyYXRpb24pIHsKICAg\nICAgICAgICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIG9jb25mID0gKE9w\nZW5KUEFDb25maWd1cmF0aW9uKSBjb25mOwogICAgICAgICAgICAgICAgb2Nv\nbmYuc2V0U3BlY2lmaWNhdGlvbihTUEVDX0pQQSk7CgogICAgICAgICAgICAg\nICAgLy8gd2UgbWVyZ2Ugc2V2ZXJhbCBwZXJzaXN0ZW5jZS54bWwgZWxlbWVu\ndHMgaW50byB0aGUgCiAgICAgICAgICAgICAgICAvLyBNZXRhRGF0YUZhY3Rv\ncnkgcHJvcGVydHkgaW1wbGljaXRseS4gIGlmIHRoZSB1c2VyIGhhcyBhCiAg\nICAgICAgICAgICAgICAvLyBnbG9iYWwgb3BlbmpwYS54bWwgd2l0aCB0aGlz\nIHByb3BlcnR5IHNldCwgaXRzIHZhbHVlIHdpbGwKICAgICAgICAgICAgICAg\nIC8vIGdldCBvdmVyd3JpdHRlbiBieSBvdXIgaW1wbGljaXQgc2V0dGluZy4g\nIHNvIGluc3RlYWQsIGNvbWJpbmUKICAgICAgICAgICAgICAgIC8vIHRoZSBn\nbG9iYWwgdmFsdWUgd2l0aCBvdXIgc2V0dGluZ3MKICAgICAgICAgICAgICAg\nIFN0cmluZyBvcmlnID0gb2NvbmYuZ2V0TWV0YURhdGFGYWN0b3J5KCk7CiAg\nICAgICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkob3JpZykp\nIHsKICAgICAgICAgICAgICAgICAgICBTdHJpbmcga2V5ID0gUHJvZHVjdERl\ncml2YXRpb25zLmdldENvbmZpZ3VyYXRpb25LZXkKICAgICAgICAgICAgICAg\nICAgICAgICAgKCJNZXRhRGF0YUZhY3RvcnkiLCBnZXRQcm9wZXJ0aWVzKCkp\nOwogICAgICAgICAgICAgICAgICAgIE9iamVjdCBvdmVycmlkZSA9IGdldFBy\nb3BlcnRpZXMoKS5nZXQoa2V5KTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nb3ZlcnJpZGUgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgICAgICAg\nICAgICAgIGFkZFByb3BlcnR5KGtleSwgQ29uZmlndXJhdGlvbnMuY29tYmlu\nZVBsdWdpbnMob3JpZywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAo\nU3RyaW5nKSBvdmVycmlkZSkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICBzdXBlci5zZXRJbnRvKGNvbmYsIG51bGwp\nOwogICAgICAgICAgICBMb2cgbG9nID0gY29uZi5nZXRDb25maWd1cmF0aW9u\nTG9nKCk7CiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgU3RyaW5nIHNyYyA9IChfc291cmNlID09IG51\nbGwpID8gIj8iIDogX3NvdXJjZTsKICAgICAgICAgICAgICAgIGxvZy50cmFj\nZShfbG9jLmdldCgiY29uZi1sb2FkIiwgc3JjLCBnZXRQcm9wZXJ0aWVzKCkp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFNBWCBoYW5kbGVyIGNhcGFibGUgb2YgcGFyc2luZyBhbiBKUEEgcGVy\nc2lzdGVuY2UueG1sIGZpbGUuCiAgICAgKiBQYWNrYWdlLXByb3RlY3RlZCBm\nb3IgdGVzdGluZy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFzcyBD\nb25maWd1cmF0aW9uUGFyc2VyCiAgICAgICAgZXh0ZW5kcyBYTUxNZXRhRGF0\nYVBhcnNlciB7CgogICAgICAgIHByaXZhdGUgZmluYWwgTWFwIF9tYXA7CiAg\nICAgICAgcHJpdmF0ZSBQZXJzaXN0ZW5jZVVuaXRJbmZvSW1wbCBfaW5mbyA9\nIG51bGw7CiAgICAgICAgcHJpdmF0ZSBVUkwgX3NvdXJjZSA9IG51bGw7Cgog\nICAgICAgIHB1YmxpYyBDb25maWd1cmF0aW9uUGFyc2VyKE1hcCBtYXApIHsK\nICAgICAgICAgICAgX21hcCA9IG1hcDsKICAgICAgICAgICAgc2V0Q2FjaGlu\nZyhmYWxzZSk7CiAgICAgICAgICAgIHNldFZhbGlkYXRpbmcodHJ1ZSk7CiAg\nICAgICAgICAgIHNldFBhcnNlVGV4dCh0cnVlKTsKICAgICAgICB9CgogICAg\nICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHBhcnNlKFVSTCB1\ncmwpCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIF9zb3VyY2UgPSB1cmw7CiAgICAgICAgICAgIHN1cGVyLnBhcnNlKHVy\nbCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCBwYXJzZShGaWxlIGZpbGUpCiAgICAgICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBfc291cmNlID0gKFVSTCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAgICAgICAudG9VUkxB\nY3Rpb24oZmlsZSkpOwogICAgICAgICAgICB9IGNhdGNoIChQcml2aWxlZ2Vk\nQWN0aW9uRXhjZXB0aW9uIHBhZSkgewogICAgICAgICAgICAgICAgdGhyb3cg\nKE1hbGZvcm1lZFVSTEV4Y2VwdGlvbikgcGFlLmdldEV4Y2VwdGlvbigpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHN1cGVyLnBhcnNlKGZpbGUpOwog\nICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHJvdGVjdGVk\nIE9iamVjdCBnZXRTY2hlbWFTb3VyY2UoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBnZXRDbGFzcygpLmdldFJlc291cmNlQXNTdHJlYW0oInBlcnNpc3RlbmNl\nLXhzZC5yc3JjIik7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwcm90ZWN0ZWQgdm9pZCByZXNldCgpIHsKICAgICAgICAgICAgc3Vw\nZXIucmVzZXQoKTsKICAgICAgICAgICAgX2luZm8gPSBudWxsOwogICAgICAg\nICAgICBfc291cmNlID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHByb3Rl\nY3RlZCBib29sZWFuIHN0YXJ0RWxlbWVudChTdHJpbmcgbmFtZSwgQXR0cmli\ndXRlcyBhdHRycykKICAgICAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIGlmIChjdXJyZW50RGVwdGgoKSA9PSAxKQogICAgICAg\nICAgICAgICAgc3RhcnRQZXJzaXN0ZW5jZVVuaXQoYXR0cnMpOwogICAgICAg\nICAgICBlbHNlIGlmIChjdXJyZW50RGVwdGgoKSA9PSAzICYmICJwcm9wZXJ0\neSIuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICAgICAgX2luZm8uc2V0UHJv\ncGVydHkoYXR0cnMuZ2V0VmFsdWUoIm5hbWUiKSwKICAgICAgICAgICAgICAg\nICAgICBhdHRycy5nZXRWYWx1ZSgidmFsdWUiKSk7CiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQg\nZW5kRWxlbWVudChTdHJpbmcgbmFtZSkKICAgICAgICAgICAgdGhyb3dzIFNB\nWEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChjdXJyZW50RGVwdGgoKSA9\nPSAxKSB7CiAgICAgICAgICAgICAgICBfaW5mby5mcm9tVXNlclByb3BlcnRp\nZXMoX21hcCk7CiAgICAgICAgICAgICAgICBhZGRSZXN1bHQoX2luZm8pOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjdXJyZW50RGVwdGgoKSAh\nPSAyKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgc3dp\ndGNoIChuYW1lLmNoYXJBdCgwKSkgewogICAgICAgICAgICAgICAgY2FzZSAn\nYyc6IC8vIGNsYXNzCiAgICAgICAgICAgICAgICAgICAgX2luZm8uYWRkTWFu\nYWdlZENsYXNzTmFtZShjdXJyZW50VGV4dCgpKTsKICAgICAgICAgICAgICAg\nIGNhc2UgJ2UnOiAvLyBleGNsdWRlLXVubGlzdGVkLWNsYXNzZXMKICAgICAg\nICAgICAgICAgICAgICBfaW5mby5zZXRFeGNsdWRlVW5saXN0ZWRDbGFzc2Vz\nKCJ0cnVlIi5lcXVhbHNJZ25vcmVDYXNlCiAgICAgICAgICAgICAgICAgICAg\nICAgIChjdXJyZW50VGV4dCgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlICdqJzoKICAgICAgICAgICAgICAg\nICAgICBpZiAoImp0YS1kYXRhLXNvdXJjZSIuZXF1YWxzKG5hbWUpKQogICAg\nICAgICAgICAgICAgICAgICAgICBfaW5mby5zZXRKdGFEYXRhU291cmNlTmFt\nZShjdXJyZW50VGV4dCgpKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIC8v\nIGphci1maWxlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nX2luZm8uYWRkSmFyRmlsZU5hbWUoY3VycmVudFRleHQoKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbiBpYWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93\nIGdldEV4Y2VwdGlvbihpYWUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ20nOiAv\nLyBtYXBwaW5nLWZpbGUKICAgICAgICAgICAgICAgICAgICBfaW5mby5hZGRN\nYXBwaW5nRmlsZU5hbWUoY3VycmVudFRleHQoKSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICduJzogLy8gbm9u\nLWp0YS1kYXRhLXNvdXJjZQogICAgICAgICAgICAgICAgICAgIF9pbmZvLnNl\ndE5vbkp0YURhdGFTb3VyY2VOYW1lKGN1cnJlbnRUZXh0KCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAncCc6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKCJwcm92aWRlciIuZXF1YWxzKG5h\nbWUpKQogICAgICAgICAgICAgICAgICAgICAgICBfaW5mby5zZXRQZXJzaXN0\nZW5jZVByb3ZpZGVyQ2xhc3NOYW1lKGN1cnJlbnRUZXh0KCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBQYXJzZSBwZXJzaXN0ZW5jZS11bml0\nIGVsZW1lbnQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIHN0\nYXJ0UGVyc2lzdGVuY2VVbml0KEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAg\nICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgICAgICBfaW5mbyA9\nIG5ldyBQZXJzaXN0ZW5jZVVuaXRJbmZvSW1wbCgpOwogICAgICAgICAgICBf\naW5mby5zZXRQZXJzaXN0ZW5jZVVuaXROYW1lKGF0dHJzLmdldFZhbHVlKCJu\nYW1lIikpOwoKICAgICAgICAgICAgLy8gd2Ugb25seSBwYXJzZSB0aGlzIG91\ncnNlbHZlcyBvdXRzaWRlIGEgY29udGFpbmVyLCBzbyBkZWZhdWx0CiAgICAg\nICAgICAgIC8vIHRyYW5zYWN0aW9uIHR5cGUgdG8gbG9jYWwKICAgICAgICAg\nICAgU3RyaW5nIHZhbCA9IGF0dHJzLmdldFZhbHVlKCJ0cmFuc2FjdGlvbi10\neXBlIik7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9pbmZvLnNldFRyYW5zYWN0aW9uVHlwZQogICAgICAgICAgICAg\nICAgICAgIChQZXJzaXN0ZW5jZVVuaXRUcmFuc2FjdGlvblR5cGUuUkVTT1VS\nQ0VfTE9DQUwpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBf\naW5mby5zZXRUcmFuc2FjdGlvblR5cGUoRW51bS52YWx1ZU9mCiAgICAgICAg\nICAgICAgICAgICAgKFBlcnNpc3RlbmNlVW5pdFRyYW5zYWN0aW9uVHlwZS5j\nbGFzcywgdmFsKSk7CgogICAgICAgICAgICBpZiAoX3NvdXJjZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgX2luZm8uc2V0UGVyc2lzdGVuY2VYbWxGaWxl\nVXJsKF9zb3VyY2UpOwoJCX0KCX0KfQo=\n","encoding":"base64"}

