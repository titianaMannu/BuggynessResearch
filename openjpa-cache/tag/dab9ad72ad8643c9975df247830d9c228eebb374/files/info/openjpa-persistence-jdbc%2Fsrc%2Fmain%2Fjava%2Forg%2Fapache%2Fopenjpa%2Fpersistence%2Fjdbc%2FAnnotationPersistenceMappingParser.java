{"sha":"37a6d22aed1e0a7e3ffff59e7ff08d7c3b44990a","node_id":"MDQ6QmxvYjIwNjM2NDozN2E2ZDIyYWVkMWUwYTdlM2ZmZmY1OWU3ZmYwOGQ3YzNiNDQ5OTBh","size":52798,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/37a6d22aed1e0a7e3ffff59e7ff08d7c3b44990a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYzsK\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1\ncml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2\nYS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuQXNzb2NpYXRpb25PdmVycmlkZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLkFzc29jaWF0aW9uT3ZlcnJpZGVzOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuQXR0cmlidXRlT3ZlcnJpZGU7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5BdHRyaWJ1dGVPdmVycmlkZXM7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW5SZXN1bHQ7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5EaXNjcmltaW5hdG9yQ29sdW1uOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuRGlzY3JpbWluYXRvclZhbHVlOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuRW50aXR5UmVzdWx0OwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuRW51bVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbnVt\nZXJhdGVkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRmllbGRSZXN1bHQ7\nCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Jbmhlcml0YW5jZTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLkpvaW5Db2x1bW47CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5Kb2luQ29sdW1uczsKaW1wb3J0IGphdmF4LnBlcnNpc3Rl\nbmNlLkpvaW5UYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByaW1h\ncnlLZXlKb2luQ29sdW1uOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJp\nbWFyeUtleUpvaW5Db2x1bW5zOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nU2Vjb25kYXJ5VGFibGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TZWNv\nbmRhcnlUYWJsZXM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TcWxSZXN1\nbHRTZXRNYXBwaW5nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuU3FsUmVz\ndWx0U2V0TWFwcGluZ3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5UYWJs\nZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlRhYmxlR2VuZXJhdG9yOwpp\nbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuVGVtcG9yYWw7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5VbmlxdWVDb25zdHJhaW50OwoKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5FYWdlckZldGNo\nTW9kZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNs\nYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuQ2xhc3NNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5NYXBwaW5nSW5mbzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuTWFwcGluZ1JlcG9zaXRvcnk7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlF1ZXJ5UmVz\ndWx0TWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuU2VxdWVuY2VNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFwcGluZ0luZm87CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5FbnVtVmFsdWVIYW5k\nbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuRmxhdENsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5GdWxsQ2xhc3NTdHJhdGVneTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlZlcnRpY2Fs\nQ2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5KMkRvUHJpdjVIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEucGVyc2lzdGVuY2UuQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQ\nYXJzZXI7CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNp\nc3RlbmNlLmpkYmMuTWFwcGluZ1RhZy4qOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsK\nCi8qKgogKiBQZXJzaXN0ZW5jZSBhbm5vdGF0aW9uIG1hcHBpbmcgcGFyc2Vy\nLgogKgogKiBAYXV0aG9yIFBpbmFraSBQb2RkYXIKICogQGF1dGhvciBTdGV2\nZSBLaW0KICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIEFubm90YXRpb25QZXJzaXN0ZW5jZU1hcHBpbmdQYXJz\nZXIKICAgIGV4dGVuZHMgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQ\nYXJzZXIgewoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFRSVUUg\nPSAxOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRkFMU0UgPSAy\nOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0g\nTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQW5ub3RhdGlvblBlcnNp\nc3RlbmNlTWFwcGluZ1BhcnNlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTWFwPENsYXNzLCBNYXBwaW5nVGFnPiBfdGFncyA9CiAgICAg\nICAgbmV3IEhhc2hNYXA8Q2xhc3MsIE1hcHBpbmdUYWc+KCk7CgogICAgc3Rh\ndGljIHsKICAgICAgICBfdGFncy5wdXQoQXNzb2NpYXRpb25PdmVycmlkZS5j\nbGFzcywgQVNTT0NfT1ZFUlJJREUpOwogICAgICAgIF90YWdzLnB1dChBc3Nv\nY2lhdGlvbk92ZXJyaWRlcy5jbGFzcywgQVNTT0NfT1ZFUlJJREVTKTsKICAg\nICAgICBfdGFncy5wdXQoQXR0cmlidXRlT3ZlcnJpZGUuY2xhc3MsIEFUVFJf\nT1ZFUlJJREUpOwogICAgICAgIF90YWdzLnB1dChBdHRyaWJ1dGVPdmVycmlk\nZXMuY2xhc3MsIEFUVFJfT1ZFUlJJREVTKTsKICAgICAgICBfdGFncy5wdXQo\namF2YXgucGVyc2lzdGVuY2UuQ29sdW1uLmNsYXNzLCBDT0wpOwogICAgICAg\nIF90YWdzLnB1dChDb2x1bW5SZXN1bHQuY2xhc3MsIENPTFVNTl9SRVNVTFQp\nOwogICAgICAgIF90YWdzLnB1dChEaXNjcmltaW5hdG9yQ29sdW1uLmNsYXNz\nLCBESVNDUklNX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KERpc2NyaW1pbmF0\nb3JWYWx1ZS5jbGFzcywgRElTQ1JJTV9WQUwpOwogICAgICAgIF90YWdzLnB1\ndChFbnRpdHlSZXN1bHQuY2xhc3MsIEVOVElUWV9SRVNVTFQpOwogICAgICAg\nIF90YWdzLnB1dChFbnVtZXJhdGVkLmNsYXNzLCBFTlVNRVJBVEVEKTsKICAg\nICAgICBfdGFncy5wdXQoRmllbGRSZXN1bHQuY2xhc3MsIEZJRUxEX1JFU1VM\nVCk7CiAgICAgICAgX3RhZ3MucHV0KEluaGVyaXRhbmNlLmNsYXNzLCBJTkhF\nUklUQU5DRSk7CiAgICAgICAgX3RhZ3MucHV0KEpvaW5Db2x1bW4uY2xhc3Ms\nIEpPSU5fQ09MKTsKICAgICAgICBfdGFncy5wdXQoSm9pbkNvbHVtbnMuY2xh\nc3MsIEpPSU5fQ09MUyk7CiAgICAgICAgX3RhZ3MucHV0KEpvaW5UYWJsZS5j\nbGFzcywgSk9JTl9UQUJMRSk7CiAgICAgICAgX3RhZ3MucHV0KFByaW1hcnlL\nZXlKb2luQ29sdW1uLmNsYXNzLCBQS19KT0lOX0NPTCk7CiAgICAgICAgX3Rh\nZ3MucHV0KFByaW1hcnlLZXlKb2luQ29sdW1ucy5jbGFzcywgUEtfSk9JTl9D\nT0xTKTsKICAgICAgICBfdGFncy5wdXQoU2Vjb25kYXJ5VGFibGUuY2xhc3Ms\nIFNFQ09OREFSWV9UQUJMRSk7CiAgICAgICAgX3RhZ3MucHV0KFNlY29uZGFy\neVRhYmxlcy5jbGFzcywgU0VDT05EQVJZX1RBQkxFUyk7CiAgICAgICAgX3Rh\nZ3MucHV0KFNxbFJlc3VsdFNldE1hcHBpbmcuY2xhc3MsIFNRTF9SRVNVTFRf\nU0VUX01BUFBJTkcpOwogICAgICAgIF90YWdzLnB1dChTcWxSZXN1bHRTZXRN\nYXBwaW5ncy5jbGFzcywgU1FMX1JFU1VMVF9TRVRfTUFQUElOR1MpOwogICAg\nICAgIF90YWdzLnB1dChUYWJsZS5jbGFzcywgVEFCTEUpOwogICAgICAgIF90\nYWdzLnB1dChUZW1wb3JhbC5jbGFzcywgVEVNUE9SQUwpOwogICAgICAgIF90\nYWdzLnB1dChUYWJsZUdlbmVyYXRvci5jbGFzcywgVEFCTEVfR0VOKTsKICAg\nICAgICBfdGFncy5wdXQoQ2xhc3NDcml0ZXJpYS5jbGFzcywgQ0xBU1NfQ1JJ\nVCk7CiAgICAgICAgX3RhZ3MucHV0KENvbHVtbnMuY2xhc3MsIENPTFMpOwog\nICAgICAgIF90YWdzLnB1dChDb250YWluZXJUYWJsZS5jbGFzcywgQ09OVEFJ\nTkVSX1RBQkxFKTsKICAgICAgICBfdGFncy5wdXQoRGF0YVN0b3JlSWRDb2x1\nbW4uY2xhc3MsIERBVEFTVE9SRV9JRF9DT0wpOwogICAgICAgIF90YWdzLnB1\ndChEaXNjcmltaW5hdG9yU3RyYXRlZ3kuY2xhc3MsIERJU0NSSU1fU1RSQVQp\nOwogICAgICAgIF90YWdzLnB1dChFYWdlckZldGNoTW9kZS5jbGFzcywgRUFH\nRVJfRkVUQ0hfTU9ERSk7CiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnRDbGFz\nc0NyaXRlcmlhLmNsYXNzLCBFTEVNX0NMQVNTX0NSSVQpOwogICAgICAgIF90\nYWdzLnB1dChFbGVtZW50Rm9yZWlnbktleS5jbGFzcywgRUxFTV9GSyk7CiAg\nICAgICAgX3RhZ3MucHV0KEVsZW1lbnRJbmRleC5jbGFzcywgRUxFTV9JTkRF\nWCk7CiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnRKb2luQ29sdW1uLmNsYXNz\nLCBFTEVNX0pPSU5fQ09MKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudEpv\naW5Db2x1bW5zLmNsYXNzLCBFTEVNX0pPSU5fQ09MUyk7CiAgICAgICAgX3Rh\nZ3MucHV0KEVsZW1lbnROb25wb2x5bW9ycGhpYy5jbGFzcywgRUxFTV9OT05Q\nT0xZKTsKICAgICAgICBfdGFncy5wdXQoRW1iZWRkZWRNYXBwaW5nLmNsYXNz\nLCBFTUJFRERFRF9NQVBQSU5HKTsKICAgICAgICBfdGFncy5wdXQoRm9yZWln\nbktleS5jbGFzcywgRkspOwogICAgICAgIF90YWdzLnB1dChJbmRleC5jbGFz\ncywgSU5ERVgpOwogICAgICAgIF90YWdzLnB1dChNYXBwaW5nT3ZlcnJpZGUu\nY2xhc3MsIE1BUFBJTkdfT1ZFUlJJREUpOwogICAgICAgIF90YWdzLnB1dChN\nYXBwaW5nT3ZlcnJpZGVzLmNsYXNzLCBNQVBQSU5HX09WRVJSSURFUyk7CiAg\nICAgICAgX3RhZ3MucHV0KE5vbnBvbHltb3JwaGljLmNsYXNzLCBOT05QT0xZ\nKTsKICAgICAgICBfdGFncy5wdXQoT3JkZXJDb2x1bW4uY2xhc3MsIE9SREVS\nX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KFN0cmF0ZWd5LmNsYXNzLCBTVFJB\nVCk7CiAgICAgICAgX3RhZ3MucHV0KFN1YmNsYXNzRmV0Y2hNb2RlLmNsYXNz\nLCBTVUJDTEFTU19GRVRDSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQoVW5p\ncXVlLmNsYXNzLCBVTklRVUUpOwogICAgICAgIF90YWdzLnB1dChWZXJzaW9u\nQ29sdW1uLmNsYXNzLCBWRVJTSU9OX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0\nKFZlcnNpb25Db2x1bW5zLmNsYXNzLCBWRVJTSU9OX0NPTFMpOwogICAgICAg\nIF90YWdzLnB1dChWZXJzaW9uU3RyYXRlZ3kuY2xhc3MsIFZFUlNJT05fU1RS\nQVQpOwogICAgICAgIF90YWdzLnB1dChYSm9pbkNvbHVtbi5jbGFzcywgWF9K\nT0lOX0NPTCk7CiAgICAgICAgX3RhZ3MucHV0KFhKb2luQ29sdW1ucy5jbGFz\ncywgWF9KT0lOX0NPTFMpOwogICAgICAgIF90YWdzLnB1dChYU2Vjb25kYXJ5\nVGFibGUuY2xhc3MsIFhfU0VDT05EQVJZX1RBQkxFKTsKICAgICAgICBfdGFn\ncy5wdXQoWFNlY29uZGFyeVRhYmxlcy5jbGFzcywgWF9TRUNPTkRBUllfVEFC\nTEVTKTsKICAgICAgICBfdGFncy5wdXQoWFRhYmxlLmNsYXNzLCBYX1RBQkxF\nKTsKICAgIH0KCiAgICBwdWJsaWMgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWFw\ncGluZ1BhcnNlcihKREJDQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAg\nc3VwZXIoY29uZik7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0\nZWQgdm9pZCBwYXJzZVBhY2thZ2VNYXBwaW5nQW5ub3RhdGlvbnMoUGFja2Fn\nZSBwa2cpIHsKICAgICAgICBNYXBwaW5nVGFnIHRhZzsKICAgICAgICBmb3Ig\nKEFubm90YXRpb24gYW5ubyA6IHBrZy5nZXREZWNsYXJlZEFubm90YXRpb25z\nKCkpIHsKICAgICAgICAgICAgdGFnID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3Rh\ndGlvblR5cGUoKSk7CiAgICAgICAgICAgIGlmICh0YWcgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaGFuZGxlVW5rbm93blBhY2thZ2VNYXBwaW5nQW5u\nb3RhdGlvbihwa2csIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAg\nICAgICAgICAgICAgICBjYXNlIFRBQkxFX0dFTjoKICAgICAgICAgICAgICAg\nICAgICBwYXJzZVRhYmxlR2VuZXJhdG9yKHBrZywgKFRhYmxlR2VuZXJhdG9y\nKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIs\nIHBrZywKICAgICAgICAgICAgICAgICAgICAgICAgYW5uby50b1N0cmluZygp\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRvIGhhbmRsZSB1bmtub3duIGFubm90\nYXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYW5kbGVV\nbmtub3duUGFja2FnZU1hcHBpbmdBbm5vdGF0aW9uKFBhY2thZ2UgcGtnLAog\nICAgICAgIEFubm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBUYWJsZUdlbmVyYXRv\nci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlVGFibGVHZW5lcmF0\nb3IoQW5ub3RhdGVkRWxlbWVudCBlbCwgVGFibGVHZW5lcmF0b3IgZ2VuKSB7\nCiAgICAgICAgU3RyaW5nIG5hbWUgPSBnZW4ubmFtZSgpOwogICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWdlbi1uYW1l\nIiwgZWwpKTsKCiAgICAgICAgTG9nIGxvZyA9IGdldExvZygpOwogICAgICAg\nIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJwYXJzZS1nZW4iLCBuYW1lKSk7CgogICAgICAgIFNl\ncXVlbmNlTWFwcGluZyBtZXRhID0gKFNlcXVlbmNlTWFwcGluZykgZ2V0UmVw\nb3NpdG9yeSgpLgogICAgICAgICAgICBnZXRDYWNoZWRTZXF1ZW5jZU1ldGFE\nYXRhKG5hbWUpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICBsb2cud2FybihfbG9jLmdldCgiZHVwLWdlbiIsIG5hbWUsIGVsKSk7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG1ldGEgPSAo\nU2VxdWVuY2VNYXBwaW5nKSBnZXRSZXBvc2l0b3J5KCkuYWRkU2VxdWVuY2VN\nZXRhRGF0YShuYW1lKTsKICAgICAgICBtZXRhLnNldFNlcXVlbmNlUGx1Z2lu\nKFNlcXVlbmNlTWFwcGluZy5JTVBMX1ZBTFVFX1RBQkxFKTsKICAgICAgICBt\nZXRhLnNldFRhYmxlKHRvVGFibGVOYW1lKGdlbi5zY2hlbWEoKSwgZ2VuLnRh\nYmxlKCkpKTsKICAgICAgICBtZXRhLnNldFByaW1hcnlLZXlDb2x1bW4oZ2Vu\nLnBrQ29sdW1uTmFtZSgpKTsKICAgICAgICBtZXRhLnNldFNlcXVlbmNlQ29s\ndW1uKGdlbi52YWx1ZUNvbHVtbk5hbWUoKSk7CiAgICAgICAgbWV0YS5zZXRQ\ncmltYXJ5S2V5VmFsdWUoZ2VuLnBrQ29sdW1uVmFsdWUoKSk7CiAgICAgICAg\nbWV0YS5zZXRJbml0aWFsVmFsdWUoZ2VuLmluaXRpYWxWYWx1ZSgpKTsKICAg\nICAgICBtZXRhLnNldEFsbG9jYXRlKGdlbi5hbGxvY2F0aW9uU2l6ZSgpKTsK\nICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIChlbCBp\nbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAgICAgICAgbWV0\nYS5TUkNfQU5OT1RBVElPTlMpOwoKICAgICAgICAvLyMjIyBFSkIzCiAgICAg\nICAgaWYgKGdlbi51bmlxdWVDb25zdHJhaW50cygpLmxlbmd0aCA+IDAgJiYg\nbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLndhcm4oX2xv\nYy5nZXQoInVuaXF1ZS1jb25zdHJhaW50cyIsIG5hbWUpKTsKICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlQ2xhc3NNYXBw\naW5nQW5ub3RhdGlvbnMoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAg\nQ2xhc3NNYXBwaW5nIGNtID0gKENsYXNzTWFwcGluZykgbWV0YTsKICAgICAg\nICBDbGFzcyBjbHMgPSBjbS5nZXREZXNjcmliZWRUeXBlKCk7CgogICAgICAg\nIE1hcHBpbmdUYWcgdGFnOwogICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5v\nIDogY2xzLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewogICAgICAgICAg\nICB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsKICAg\nICAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBo\nYW5kbGVVbmtub3duQ2xhc3NNYXBwaW5nQW5ub3RhdGlvbihjbSwgYW5ubyk7\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nQVNTT0NfT1ZFUlJJREU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VBc3Nv\nY2lhdGlvbk92ZXJyaWRlcyhjbSwgKEFzc29jaWF0aW9uT3ZlcnJpZGUpIGFu\nbm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBBU1NPQ19PVkVSUklERVM6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VBc3NvY2lhdGlvbk92ZXJyaWRlcyhjbSwgKChBc3NvY2lhdGlvbk92\nZXJyaWRlcykgYW5ubykuCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBBVFRSX09WRVJSSURFOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlQXR0cmlidXRlT3ZlcnJpZGVzKGNtLCAoQXR0cmlidXRlT3ZlcnJpZGUp\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBBVFRSX09WRVJSSURFUzoKICAgICAgICAgICAgICAgICAg\nICBwYXJzZUF0dHJpYnV0ZU92ZXJyaWRlcyhjbSwgKChBdHRyaWJ1dGVPdmVy\ncmlkZXMpIGFubm8pLgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSgp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgRElTQ1JJTV9DT0w6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VE\naXNjcmltaW5hdG9yQ29sdW1uKGNtLCAoRGlzY3JpbWluYXRvckNvbHVtbikg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIERJU0NSSU1fVkFMOgogICAgICAgICAgICAgICAgICAgIGNt\nLmdldERpc2NyaW1pbmF0b3IoKS5nZXRNYXBwaW5nSW5mbygpLnNldFZhbHVl\nCiAgICAgICAgICAgICAgICAgICAgICAgICgoKERpc2NyaW1pbmF0b3JWYWx1\nZSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKE1v\nZGlmaWVyLmlzQWJzdHJhY3QoY20uZ2V0RGVzY3JpYmVkVHlwZSgpLgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TW9kaWZpZXJzKCkpICYmIGdl\ndExvZygpLmlzSW5mb0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBnZXRMb2coKS5pbmZvKAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgX2xvYy5nZXQoImRpc2NyaW1pbmF0b3Itb24tYWJzdHJhY3QtY2xhc3Mi\nLCBjbQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0\nRGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSkpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgSU5IRVJJVEFOQ0U6CiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VJbmhlcml0YW5jZShjbSwgKEluaGVyaXRhbmNlKSBhbm5vKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEtf\nSk9JTl9DT0w6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQcmltYXJ5S2V5\nSm9pbkNvbHVtbnMoY20sIChQcmltYXJ5S2V5Sm9pbkNvbHVtbikgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIFBLX0pPSU5fQ09MUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZVBy\naW1hcnlLZXlKb2luQ29sdW1ucyhjbSwKICAgICAgICAgICAgICAgICAgICAg\nICAgKChQcmltYXJ5S2V5Sm9pbkNvbHVtbnMpIGFubm8pLgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdmFsdWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNFQ09OREFSWV9UQUJM\nRToKICAgICAgICAgICAgICAgICAgICBwYXJzZVNlY29uZGFyeVRhYmxlcyhj\nbSwgKFNlY29uZGFyeVRhYmxlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU0VDT05EQVJZX1RBQkxF\nUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZVNlY29uZGFyeVRhYmxlcyhj\nbSwgKChTZWNvbmRhcnlUYWJsZXMpIGFubm8pLnZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTUUxf\nUkVTVUxUX1NFVF9NQVBQSU5HOgogICAgICAgICAgICAgICAgICAgIHBhcnNl\nU1FMUmVzdWx0U2V0TWFwcGluZ3MoY20sIChTcWxSZXN1bHRTZXRNYXBwaW5n\nKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgU1FMX1JFU1VMVF9TRVRfTUFQUElOR1M6CiAgICAgICAg\nICAgICAgICAgICAgcGFyc2VTUUxSZXN1bHRTZXRNYXBwaW5ncyhjbSwgKChT\ncWxSZXN1bHRTZXRNYXBwaW5ncykgYW5ubykuCiAgICAgICAgICAgICAgICAg\nICAgICAgIHZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBUQUJMRToKICAgICAgICAgICAgICAgICAg\nICBwYXJzZVRhYmxlKGNtLCAoVGFibGUpIGFubm8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBUQUJMRV9HRU46\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VUYWJsZUdlbmVyYXRvcihjbHMs\nIChUYWJsZUdlbmVyYXRvcikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIERBVEFTVE9SRV9JRF9DT0w6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VEYXRhU3RvcmVJZENvbHVtbihj\nbSwgKERhdGFTdG9yZUlkQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRElTQ1JJTV9TVFJB\nVDoKICAgICAgICAgICAgICAgICAgICBjbS5nZXREaXNjcmltaW5hdG9yKCku\nZ2V0TWFwcGluZ0luZm8oKS5zZXRTdHJhdGVneQogICAgICAgICAgICAgICAg\nICAgICAgICAoKChEaXNjcmltaW5hdG9yU3RyYXRlZ3kpIGFubm8pLnZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBGSzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUZvcmVpZ25L\nZXkoY20uZ2V0TWFwcGluZ0luZm8oKSwgKEZvcmVpZ25LZXkpIGFubm8pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBNQVBQSU5HX09WRVJSSURFOgogICAgICAgICAgICAgICAgICAgIHBhcnNl\nTWFwcGluZ092ZXJyaWRlcyhjbSwgKE1hcHBpbmdPdmVycmlkZSkgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIE1BUFBJTkdfT1ZFUlJJREVTOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlTWFwcGluZ092ZXJyaWRlcyhjbSwKICAgICAgICAgICAgICAgICAgICAg\nICAgKChNYXBwaW5nT3ZlcnJpZGVzKSBhbm5vKS52YWx1ZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU1RS\nQVQ6CiAgICAgICAgICAgICAgICAgICAgY20uZ2V0TWFwcGluZ0luZm8oKS5z\nZXRTdHJhdGVneSgoKFN0cmF0ZWd5KSBhbm5vKS52YWx1ZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU1VC\nQ0xBU1NfRkVUQ0hfTU9ERToKICAgICAgICAgICAgICAgICAgICBjbS5zZXRT\ndWJjbGFzc0ZldGNoTW9kZSh0b0VhZ2VyRmV0Y2hNb2RlQ29uc3RhbnQKICAg\nICAgICAgICAgICAgICAgICAgICAgKCgoU3ViY2xhc3NGZXRjaE1vZGUpIGFu\nbm8pLnZhbHVlKCkpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgVkVSU0lPTl9DT0w6CiAgICAgICAgICAgICAg\nICAgICAgcGFyc2VWZXJzaW9uQ29sdW1ucyhjbSwgKFZlcnNpb25Db2x1bW4p\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBWRVJTSU9OX0NPTFM6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VWZXJzaW9uQ29sdW1ucyhjbSwgKChWZXJzaW9uQ29sdW1ucykgYW5u\nbykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIFZFUlNJT05fU1RSQVQ6CiAgICAgICAgICAgICAg\nICAgICAgY20uZ2V0VmVyc2lvbigpLmdldE1hcHBpbmdJbmZvKCkuc2V0U3Ry\nYXRlZ3kKICAgICAgICAgICAgICAgICAgICAgICAgKCgoVmVyc2lvblN0cmF0\nZWd5KSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgWF9UQUJMRToKICAgICAgICAgICAg\nICAgIGNhc2UgWF9TRUNPTkRBUllfVEFCTEU6CiAgICAgICAgICAgICAgICBj\nYXNlIFhfU0VDT05EQVJZX1RBQkxFUzoKICAgICAgICAgICAgICAgICAgICAv\nLyBubyBicmVhazsgbm90IHN1cHBvcnRlZCB5ZXQKICAgICAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsIGNtLAog\nICAgICAgICAgICAgICAgICAgICAgICBhbm5vKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFz\nc2VzIHRvIGhhbmRsZSB1bmtub3duIGFubm90YXRpb25zLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgYm9vbGVhbiBoYW5kbGVVbmtub3duQ2xhc3NNYXBwaW5n\nQW5ub3RhdGlvbihDbGFzc01hcHBpbmcgY2xzLAogICAgICAgIEFubm90YXRp\nb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIEBBc3NvY2lhdGlvbk92ZXJyaWRlKHMpLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VBc3NvY2lhdGlvbk92ZXJyaWRl\ncyhDbGFzc01hcHBpbmcgY20sCiAgICAgICAgQXNzb2NpYXRpb25PdmVycmlk\nZS4uLiBhc3NvY3MpIHsKICAgICAgICBGaWVsZE1hcHBpbmcgc3VwOwogICAg\nICAgIEpvaW5Db2x1bW5bXSBzY29sczsKICAgICAgICBpbnQgdW5pcXVlOwog\nICAgICAgIExpc3Q8Q29sdW1uPiBqY29sczsKICAgICAgICBmb3IgKEFzc29j\naWF0aW9uT3ZlcnJpZGUgYXNzb2MgOiBhc3NvY3MpIHsKICAgICAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoYXNzb2MubmFtZSgpKSkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tb3ZlcnJpZGUtbmFtZSIsIGNtKSk7CiAgICAgICAgICAgIHN1cCA9\nIChGaWVsZE1hcHBpbmcpIGNtLmdldERlZmluZWRTdXBlcmNsYXNzRmllbGQo\nYXNzb2MubmFtZSgpKTsKICAgICAgICAgICAgaWYgKHN1cCA9PSBudWxsKQog\nICAgICAgICAgICAgICAgc3VwID0gKEZpZWxkTWFwcGluZykgY20uYWRkRGVm\naW5lZFN1cGVyY2xhc3NGaWVsZAogICAgICAgICAgICAgICAgICAgIChhc3Nv\nYy5uYW1lKCksIE9iamVjdC5jbGFzcywgT2JqZWN0LmNsYXNzKTsKICAgICAg\nICAgICAgc2NvbHMgPSBhc3NvYy5qb2luQ29sdW1ucygpOwogICAgICAgICAg\nICBpZiAoc2NvbHMgPT0gbnVsbCB8fCBzY29scy5sZW5ndGggPT0gMCkKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgamNvbHMgPSBu\nZXcgQXJyYXlMaXN0PENvbHVtbj4oc2NvbHMubGVuZ3RoKTsKICAgICAgICAg\nICAgdW5pcXVlID0gMDsKICAgICAgICAgICAgZm9yIChKb2luQ29sdW1uIHNj\nb2wgOiBzY29scykgewogICAgICAgICAgICAgICAgdW5pcXVlIHw9IChzY29s\nLnVuaXF1ZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICAgICAgICAgIGpj\nb2xzLmFkZChuZXdDb2x1bW4oc2NvbCkpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHNldENvbHVtbnMoc3VwLCBzdXAuZ2V0VmFsdWVJbmZvKCksIGpj\nb2xzLCB1bmlxdWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIEBBdHRyaWJ1dGVPdmVycmlkZShzKS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHBhcnNlQXR0cmlidXRlT3ZlcnJpZGVzKENsYXNzTWFwcGlu\nZyBjbSwKICAgICAgICBBdHRyaWJ1dGVPdmVycmlkZS4uLiBhdHRycykgewog\nICAgICAgIEZpZWxkTWFwcGluZyBzdXA7CiAgICAgICAgZm9yIChBdHRyaWJ1\ndGVPdmVycmlkZSBhdHRyIDogYXR0cnMpIHsKICAgICAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkoYXR0ci5uYW1lKCkpKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1v\ndmVycmlkZS1uYW1lIiwgY20pKTsKICAgICAgICAgICAgc3VwID0gKEZpZWxk\nTWFwcGluZykgY20uZ2V0RGVmaW5lZFN1cGVyY2xhc3NGaWVsZChhdHRyLm5h\nbWUoKSk7CiAgICAgICAgICAgIGlmIChzdXAgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHN1cCA9IChGaWVsZE1hcHBpbmcpIGNtLmFkZERlZmluZWRTdXBl\ncmNsYXNzRmllbGQoYXR0ci5uYW1lKCksCiAgICAgICAgICAgICAgICAgICAg\nT2JqZWN0LmNsYXNzLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBpZiAo\nYXR0ci5jb2x1bW4oKSAhPSBudWxsKQogICAgICAgICAgICAgICAgcGFyc2VD\nb2x1bW5zKHN1cCwgYXR0ci5jb2x1bW4oKSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUGFyc2UgaW5oZXJpdGFuY2UgQFByaW1hcnlLZXlK\nb2luQ29sdW1uKHMpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VQ\ncmltYXJ5S2V5Sm9pbkNvbHVtbnMoQ2xhc3NNYXBwaW5nIGNtLAogICAgICAg\nIFByaW1hcnlLZXlKb2luQ29sdW1uLi4uIGpvaW5zKSB7CiAgICAgICAgTGlz\ndDxDb2x1bW4+IGNvbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oam9pbnMu\nbGVuZ3RoKTsKICAgICAgICBmb3IgKFByaW1hcnlLZXlKb2luQ29sdW1uIGpv\naW4gOiBqb2lucykKICAgICAgICAgICAgY29scy5hZGQobmV3Q29sdW1uKGpv\naW4pKTsKICAgICAgICBjbS5nZXRNYXBwaW5nSW5mbygpLnNldENvbHVtbnMo\nY29scyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc2No\nZW1hIGNvbHVtbiB3aXRoIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIGFu\nbm90YXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENvbHVtbiBu\nZXdDb2x1bW4oUHJpbWFyeUtleUpvaW5Db2x1bW4gam9pbikgewogICAgICAg\nIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgY29sLnNldEZs\nYWcoQ29sdW1uLkZMQUdfUEtfSk9JTiwgdHJ1ZSk7CiAgICAgICAgaWYgKCFT\ndHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ubmFtZSgpKSkKICAgICAgICAgICAg\nY29sLnNldE5hbWUoam9pbi5uYW1lKCkpOwogICAgICAgIGlmICghU3RyaW5n\nVXRpbHMuaXNFbXB0eShqb2luLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAg\nICAgICAgIGNvbC5zZXROYW1lKGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKTsK\nICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZlcmVu\nY2VkQ29sdW1uTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldFRhcmdldChq\nb2luLnJlZmVyZW5jZWRDb2x1bW5OYW1lKCkpOwogICAgICAgIHJldHVybiBj\nb2w7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAU2Vjb25kYXJ5VGFi\nbGUocykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVNlY29uZGFy\neVRhYmxlcyhDbGFzc01hcHBpbmcgY20sCiAgICAgICAgU2Vjb25kYXJ5VGFi\nbGUuLi4gdGFibGVzKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nSW5mbyBpbmZv\nID0gY20uZ2V0TWFwcGluZ0luZm8oKTsKICAgICAgICBMb2cgbG9nID0gZ2V0\nTG9nKCk7CgogICAgICAgIFN0cmluZyBuYW1lOwogICAgICAgIExpc3Q8Q29s\ndW1uPiBqb2luczsKICAgICAgICBib29sZWFuIHdhcm5VbmlxdWUgPSBmYWxz\nZTsKICAgICAgICBmb3IgKFNlY29uZGFyeVRhYmxlIHRhYmxlIDogdGFibGVz\nKSB7CiAgICAgICAgICAgIG5hbWUgPSB0YWJsZS5uYW1lKCk7CiAgICAgICAg\nICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJz\nZWNvbmQtbmFtZSIsIGNtKSk7CiAgICAgICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eSh0YWJsZS5zY2hlbWEoKSkpCiAgICAgICAgICAgICAgICBu\nYW1lID0gdGFibGUuc2NoZW1hKCkgKyAiLiIgKyBuYW1lOwogICAgICAgICAg\nICBpZiAodGFibGUucGtKb2luQ29sdW1ucygpLmxlbmd0aCA+IDApIHsKICAg\nICAgICAgICAgICAgIGpvaW5zID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KHRh\nYmxlLnBrSm9pbkNvbHVtbnMoKS5sZW5ndGgpOwogICAgICAgICAgICAgICAg\nZm9yIChQcmltYXJ5S2V5Sm9pbkNvbHVtbiBqb2luIDogdGFibGUucGtKb2lu\nQ29sdW1ucygpKQogICAgICAgICAgICAgICAgICAgIGpvaW5zLmFkZChuZXdD\nb2x1bW4oam9pbikpOwogICAgICAgICAgICAgICAgaW5mby5zZXRTZWNvbmRh\ncnlUYWJsZUpvaW5Db2x1bW5zKG5hbWUsIGpvaW5zKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICB3YXJuVW5pcXVlIHw9IHRhYmxlLnVuaXF1ZUNvbnN0\ncmFpbnRzKCkubGVuZ3RoID4gMDsKICAgICAgICB9CgogICAgICAgIC8vIyMj\nIEVKQjMKICAgICAgICBpZiAod2FyblVuaXF1ZSAmJiBsb2cuaXNXYXJuRW5h\nYmxlZCgpKQogICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgidW5pcXVl\nLWNvbnN0cmFpbnRzIiwgY20pKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCBjbGFzcyB0YWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nVGFibGUoQ2xhc3NNYXBwaW5nIGNtLCBUYWJsZSB0YWJsZSkgewogICAgICAg\nIFN0cmluZyB0YWJsZU5hbWUgPSB0b1RhYmxlTmFtZSh0YWJsZS5zY2hlbWEo\nKSwgdGFibGUubmFtZSgpKTsKICAgICAgICBpZiAodGFibGVOYW1lICE9IG51\nbGwpCiAgICAgICAgICAgIGNtLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVO\nYW1lKHRhYmxlTmFtZSk7CgogICAgICAgIGZvciAoVW5pcXVlQ29uc3RyYWlu\ndCB1bmlxdWVDb25zdHJhaW50OnRhYmxlLnVuaXF1ZUNvbnN0cmFpbnRzKCkp\nIHsKICAgICAgICAgICAgVW5pcXVlIHVuaXF1ZSA9IG5ld1VuaXF1ZShjbSwg\nbnVsbCwgdW5pcXVlQ29uc3RyYWludC5jb2x1bW5OYW1lcygpKTsKICAgICAg\nICAgICAgY20uZ2V0TWFwcGluZ0luZm8oKS5hZGRVbmlxdWUodW5pcXVlKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGb3JtIGEgcXVhbGlm\naWVkIHRhYmxlIG5hbWUgZnJvbSBhIHNjaGVtYSBhbmQgdGFibGUgbmFtZS4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIHRvVGFibGVOYW1l\nKFN0cmluZyBzY2hlbWEsIFN0cmluZyB0YWJsZSkgewogICAgICAgIGlmIChT\ndHJpbmdVdGlscy5pc0VtcHR5KHRhYmxlKSkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc2NoZW1h\nKSkKICAgICAgICAgICAgcmV0dXJuIHRhYmxlOwogICAgICAgIHJldHVybiBz\nY2hlbWEgKyAiLiIgKyB0YWJsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlcyB0aGUgZ2l2ZW4gYW5ub3RhdGlvbiB0byBjcmVhdGUgYW5kIGNhY2hl\nIGEKICAgICAqIHtAbGluayBTUUxSZXN1bHRTZXRNYXBwaW5nTWV0YURhdGF9\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VTUUxSZXN1bHRTZXRN\nYXBwaW5ncyhDbGFzc01hcHBpbmcgY20sCiAgICAgICAgU3FsUmVzdWx0U2V0\nTWFwcGluZy4uLiBhbm5vcykgewogICAgICAgIE1hcHBpbmdSZXBvc2l0b3J5\nIHJlcG9zID0gKE1hcHBpbmdSZXBvc2l0b3J5KSBnZXRSZXBvc2l0b3J5KCk7\nCiAgICAgICAgTG9nIGxvZyA9IGdldExvZygpOwogICAgICAgIGZvciAoU3Fs\nUmVzdWx0U2V0TWFwcGluZyBhbm5vIDogYW5ub3MpIHsKICAgICAgICAgICAg\naWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9n\nLnRyYWNlKF9sb2MuZ2V0KCJwYXJzZS1zcWxyc21hcHBpbmciLCBhbm5vLm5h\nbWUoKSkpOwoKICAgICAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nIHJlc3Vs\ndCA9IHJlcG9zLmdldENhY2hlZFF1ZXJ5UmVzdWx0TWFwcGluZwogICAgICAg\nICAgICAgICAgKG51bGwsIGFubm8ubmFtZSgpKTsKICAgICAgICAgICAgaWYg\nKHJlc3VsdCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlz\nV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cud2Fybihf\nbG9jLmdldCgiZHVwLXNxbHJzbWFwcGluZyIsIGFubm8ubmFtZSgpLCBjbSkp\nOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHJlc3VsdCA9IHJlcG9zLmFkZFF1ZXJ5UmVzdWx0TWFwcGlu\nZyhudWxsLCBhbm5vLm5hbWUoKSk7CiAgICAgICAgICAgIHJlc3VsdC5zZXRT\nb3VyY2UoZ2V0U291cmNlRmlsZSgpLCBjbS5nZXREZXNjcmliZWRUeXBlKCks\nCiAgICAgICAgICAgICAgICByZXN1bHQuU1JDX0FOTk9UQVRJT05TKTsKCiAg\nICAgICAgICAgIGZvciAoRW50aXR5UmVzdWx0IGVudGl0eSA6IGFubm8uZW50\naXRpZXMoKSkgewogICAgICAgICAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5n\nLlBDUmVzdWx0IGVudGl0eVJlc3VsdCA9IHJlc3VsdC5hZGRQQ1Jlc3VsdAog\nICAgICAgICAgICAgICAgICAgIChlbnRpdHkuZW50aXR5Q2xhc3MoKSk7CiAg\nICAgICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoZW50aXR5\nLmRpc2NyaW1pbmF0b3JDb2x1bW4oKSkpCiAgICAgICAgICAgICAgICAgICAg\nZW50aXR5UmVzdWx0LmFkZE1hcHBpbmcoZW50aXR5UmVzdWx0LkRJU0NSSU1J\nTkFUT1IsCiAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eS5kaXNjcmlt\naW5hdG9yQ29sdW1uKCkpOwoKICAgICAgICAgICAgICAgIGZvciAoRmllbGRS\nZXN1bHQgZmllbGQgOiBlbnRpdHkuZmllbGRzKCkpCiAgICAgICAgICAgICAg\nICAgICAgZW50aXR5UmVzdWx0LmFkZE1hcHBpbmcoZmllbGQubmFtZSgpLCBm\naWVsZC5jb2x1bW4oKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9y\nIChDb2x1bW5SZXN1bHQgY29sdW1uIDogYW5uby5jb2x1bW5zKCkpCiAgICAg\nICAgICAgICAgICByZXN1bHQuYWRkQ29sdW1uUmVzdWx0KGNvbHVtbi5uYW1l\nKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBE\naXNjcmltaW5hdG9yQ29sdW1uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncGFyc2VEaXNjcmltaW5hdG9yQ29sdW1uKENsYXNzTWFwcGluZyBjbSwKICAg\nICAgICBEaXNjcmltaW5hdG9yQ29sdW1uIGRjb2wpIHsKICAgICAgICBDb2x1\nbW4gY29sID0gbmV3IENvbHVtbigpOwogICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eShkY29sLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRO\nYW1lKGRjb2wubmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlz\nRW1wdHkoZGNvbC5jb2x1bW5EZWZpbml0aW9uKCkpKQogICAgICAgICAgICBj\nb2wuc2V0VHlwZU5hbWUoZGNvbC5jb2x1bW5EZWZpbml0aW9uKCkpOwogICAg\nICAgIERpc2NyaW1pbmF0b3IgZGlzY3JpbSA9IGNtLmdldERpc2NyaW1pbmF0\nb3IoKTsKICAgICAgICBzd2l0Y2ggKGRjb2wuZGlzY3JpbWluYXRvclR5cGUo\nKSkgewogICAgICAgICAgICBjYXNlIENIQVI6CiAgICAgICAgICAgICAgICBj\nb2wuc2V0SmF2YVR5cGUoSmF2YVR5cGVzLkNIQVIpOwogICAgICAgICAgICAg\nICAgZGlzY3JpbS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuQ0hBUik7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBJTlRFR0VSOgog\nICAgICAgICAgICAgICAgY29sLnNldEphdmFUeXBlKEphdmFUeXBlcy5JTlQp\nOwogICAgICAgICAgICAgICAgaWYgKGRjb2wubGVuZ3RoKCkgIT0gMzEpCiAg\nICAgICAgICAgICAgICAgICAgY29sLnNldFNpemUoZGNvbC5sZW5ndGgoKSk7\nCiAgICAgICAgICAgICAgICBkaXNjcmltLnNldEphdmFUeXBlKEphdmFUeXBl\ncy5JTlQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICBjb2wuc2V0SmF2YVR5cGUoSmF2YVR5\ncGVzLlNUUklORyk7CiAgICAgICAgICAgICAgICBjb2wuc2V0U2l6ZShkY29s\nLmxlbmd0aCgpKTsKICAgICAgICAgICAgICAgIGRpc2NyaW0uc2V0SmF2YVR5\ncGUoSmF2YVR5cGVzLlNUUklORyk7CiAgICAgICAgfQogICAgICAgIGNtLmdl\ndERpc2NyaW1pbmF0b3IoKS5nZXRNYXBwaW5nSW5mbygpLnNldENvbHVtbnMK\nICAgICAgICAgICAgKEFycmF5cy5hc0xpc3QobmV3IENvbHVtbltdeyBjb2wg\nfSkpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQEluaGVyaXRhbmNl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VJbmhlcml0YW5jZShD\nbGFzc01hcHBpbmcgY20sIEluaGVyaXRhbmNlIGluaGVyaXQpIHsKICAgICAg\nICBDbGFzc01hcHBpbmdJbmZvIGluZm8gPSBjbS5nZXRNYXBwaW5nSW5mbygp\nOwogICAgICAgIHN3aXRjaCAoaW5oZXJpdC5zdHJhdGVneSgpKSB7CiAgICAg\nICAgICAgIGNhc2UgU0lOR0xFX1RBQkxFOgogICAgICAgICAgICAgICAgaW5m\nby5zZXRIaWVyYXJjaHlTdHJhdGVneShGbGF0Q2xhc3NTdHJhdGVneS5BTElB\nUyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nT0lORUQ6CiAgICAgICAgICAgICAgICBpbmZvLnNldEhpZXJhcmNoeVN0cmF0\nZWd5KFZlcnRpY2FsQ2xhc3NTdHJhdGVneS5BTElBUyk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBUQUJMRV9QRVJfQ0xBU1M6\nCiAgICAgICAgICAgICAgICBpbmZvLnNldEhpZXJhcmNoeVN0cmF0ZWd5KEZ1\nbGxDbGFzc1N0cmF0ZWd5LkFMSUFTKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgY2xhc3MtbGV2ZWwgQE1hcHBpbmdPdmVycmlk\nZShzKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFwcGluZ092\nZXJyaWRlcyhDbGFzc01hcHBpbmcgY20sCiAgICAgICAgTWFwcGluZ092ZXJy\naWRlLi4uIG92ZXJzKSB7CiAgICAgICAgRmllbGRNYXBwaW5nIHN1cDsKICAg\nICAgICBmb3IgKE1hcHBpbmdPdmVycmlkZSBvdmVyIDogb3ZlcnMpIHsKICAg\nICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkob3Zlci5uYW1lKCkp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1vdmVycmlkZS1uYW1lIiwgY20pKTsKICAgICAgICAg\nICAgc3VwID0gKEZpZWxkTWFwcGluZykgY20uZ2V0RGVmaW5lZFN1cGVyY2xh\nc3NGaWVsZChvdmVyLm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChzdXAgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHN1cCA9IChGaWVsZE1hcHBpbmcpIGNt\nLmFkZERlZmluZWRTdXBlcmNsYXNzRmllbGQob3Zlci5uYW1lKCksCiAgICAg\nICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBPYmplY3QuY2xhc3MpOwog\nICAgICAgICAgICBwb3B1bGF0ZShzdXAsIG92ZXIpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFBvcHVsYXRlIHRoZSBnaXZlbiBmaWVsZCBm\ncm9tIG92ZXJyaWRlIGRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nb3B1bGF0ZShGaWVsZE1hcHBpbmcgZm0sIE1hcHBpbmdPdmVycmlkZSBvdmVy\nKSB7CiAgICAgICAgaWYgKG92ZXIuY29udGFpbmVyVGFibGUoKS5zcGVjaWZp\nZWQoKSkKICAgICAgICAgICAgcGFyc2VDb250YWluZXJUYWJsZShmbSwgb3Zl\nci5jb250YWluZXJUYWJsZSgpKTsKICAgICAgICBwYXJzZUNvbHVtbnMoZm0s\nIG92ZXIuY29sdW1ucygpKTsKICAgICAgICBwYXJzZVhKb2luQ29sdW1ucyhm\nbSwgZm0uZ2V0VmFsdWVJbmZvKCksIHRydWUsIG92ZXIuam9pbkNvbHVtbnMo\nKSk7CiAgICAgICAgcGFyc2VFbGVtZW50Sm9pbkNvbHVtbnMoZm0sIG92ZXIu\nZWxlbWVudEpvaW5Db2x1bW5zKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgZGF0YXN0b3JlIGlkZW50aXR5IGluZm9ybWF0aW9uIGluIEBEYXRh\nU3RvcmVJZENvbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nRGF0YVN0b3JlSWRDb2x1bW4oQ2xhc3NNYXBwaW5nIGNtLCBEYXRhU3RvcmVJ\nZENvbHVtbiBpZCkgewogICAgICAgIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1u\nKCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGlkLm5hbWUo\nKSkpCiAgICAgICAgICAgIGNvbC5zZXROYW1lKGlkLm5hbWUoKSk7CiAgICAg\nICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGlkLmNvbHVtbkRlZmluaXRp\nb24oKSkpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZShpZC5jb2x1bW5E\nZWZpbml0aW9uKCkpOwogICAgICAgIGlmIChpZC5wcmVjaXNpb24oKSAhPSAw\nKQogICAgICAgICAgICBjb2wuc2V0U2l6ZShpZC5wcmVjaXNpb24oKSk7CiAg\nICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAh\naWQuaW5zZXJ0YWJsZSgpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4u\nRkxBR19VTlVQREFUQUJMRSwgIWlkLnVwZGF0YWJsZSgpKTsKICAgICAgICBj\nbS5nZXRNYXBwaW5nSW5mbygpLnNldENvbHVtbnMoQXJyYXlzLmFzTGlzdChu\nZXcgQ29sdW1uW117IGNvbCB9KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBwYXJzZUZvcmVpZ25LZXkoTWFwcGluZ0luZm8gaW5mbywgRm9y\nZWlnbktleSBmaykgewogICAgICAgIHBhcnNlRm9yZWlnbktleShpbmZvLCBm\nay5uYW1lKCksIGZrLmVuYWJsZWQoKSwgZmsuZGVmZXJyZWQoKSwKICAgICAg\nICAgICAgZmsuZGVsZXRlQWN0aW9uKCksIGZrLnVwZGF0ZUFjdGlvbigpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNldCBmb3JlaWduIGtleSBkYXRhIG9u\nIHRoZSBnaXZlbiBtYXBwaW5nIGluZm8uCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIHBhcnNlRm9yZWlnbktleShNYXBwaW5nSW5mbyBpbmZvLCBTdHJp\nbmcgbmFtZSwKICAgICAgICBib29sZWFuIGVuYWJsZWQsIGJvb2xlYW4gZGVm\nZXJyZWQsIEZvcmVpZ25LZXlBY3Rpb24gZGVsZXRlQWN0aW9uLAogICAgICAg\nIEZvcmVpZ25LZXlBY3Rpb24gdXBkYXRlQWN0aW9uKSB7CiAgICAgICAgaWYg\nKCFlbmFibGVkKSB7CiAgICAgICAgICAgIGluZm8uc2V0Q2FuRm9yZWlnbktl\neShmYWxzZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAg\nICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5\nIGZrID0KICAgICAgICAgICAgbmV3IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Gb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICBmay5zZXROYW1lKG5hbWUp\nOwogICAgICAgIGZrLnNldERlZmVycmVkKGRlZmVycmVkKTsKICAgICAgICBm\nay5zZXREZWxldGVBY3Rpb24odG9Gb3JlaWduS2V5QWN0aW9uKGRlbGV0ZUFj\ndGlvbikpOwogICAgICAgIGZrLnNldFVwZGF0ZUFjdGlvbih0b0ZvcmVpZ25L\nZXlBY3Rpb24odXBkYXRlQWN0aW9uKSk7CiAgICAgICAgaW5mby5zZXRGb3Jl\naWduS2V5KGZrKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgb3Vy\nIEZLIGFjdGlvbiBlbnVtIHRvIGFuIGludGVybmFsIE9wZW5KUEEgYWN0aW9u\nLgogICAgICovCiAgICBwcml2YXRlIGludCB0b0ZvcmVpZ25LZXlBY3Rpb24o\nRm9yZWlnbktleUFjdGlvbiBhY3Rpb24pIHsKICAgICAgICBzd2l0Y2ggKGFj\ndGlvbikgewogICAgICAgICAgICBjYXNlIFJFU1RSSUNUOgogICAgICAgICAg\nICAgICAgcmV0dXJuIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5G\nb3JlaWduS2V5LkFDVElPTl9SRVNUUklDVDsKICAgICAgICAgICAgY2FzZSBD\nQVNDQURFOgogICAgICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5LkFDVElPTl9DQVNDQURFOwog\nICAgICAgICAgICBjYXNlIE5VTEw6CiAgICAgICAgICAgICAgICByZXR1cm4g\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXkuQUNU\nSU9OX05VTEw7CiAgICAgICAgICAgIGNhc2UgREVGQVVMVDoKICAgICAgICAg\nICAgICAgIHJldHVybiBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nRm9yZWlnbktleS5BQ1RJT05fREVGQVVMVDsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHRo\nZSBnaXZlbiBpbmRleC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nSW5kZXgoTWFwcGluZ0luZm8gaW5mbywgSW5kZXggaWR4KSB7CiAgICAgICAg\ncGFyc2VJbmRleChpbmZvLCBpZHgubmFtZSgpLCBpZHguZW5hYmxlZCgpLCBp\nZHgudW5pcXVlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGluZGV4\nIGRhdGEgb24gdGhlIGdpdmVuIG1hcHBpbmcgaW5mby4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgcGFyc2VJbmRleChNYXBwaW5nSW5mbyBpbmZvLCBT\ndHJpbmcgbmFtZSwKICAgICAgICBib29sZWFuIGVuYWJsZWQsIGJvb2xlYW4g\ndW5pcXVlKSB7CiAgICAgICAgaWYgKCFlbmFibGVkKSB7CiAgICAgICAgICAg\nIGluZm8uc2V0Q2FuSW5kZXgoZmFsc2UpOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQoKICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuSW5kZXggaWR4ID0KICAgICAgICAgICAgbmV3IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleCgpOwogICAgICAgIGlmICghU3Ry\naW5nVXRpbHMuaXNFbXB0eShuYW1lKSkKICAgICAgICAgICAgaWR4LnNldE5h\nbWUobmFtZSk7CiAgICAgICAgaWR4LnNldFVuaXF1ZSh1bmlxdWUpOwogICAg\nICAgIGluZm8uc2V0SW5kZXgoaWR4KTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB1bmlxdWUgZGF0YSBvbiB0aGUgZ2l2ZW4gbWFwcGluZyBpbmZvLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VVbmlxdWUoRmllbGRNYXBw\naW5nIGZtLCAKICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVu\nY2UuamRiYy5VbmlxdWUgYW5ubykgewogICAgICAgIFZhbHVlTWFwcGluZ0lu\nZm8gaW5mbyA9IGZtLmdldFZhbHVlSW5mbygpOwogICAgICAgIGlmICghYW5u\nby5lbmFibGVkKCkpIHsKICAgICAgICAgICAgaW5mby5zZXRDYW5VbmlxdWUo\nZmFsc2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAg\nICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlIHVucSA9\nIAogICAgICAgICAgICBuZXcgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLlVuaXF1ZSgpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0\neShhbm5vLm5hbWUoKSkpCiAgICAgICAgICAgIHVucS5zZXROYW1lKGFubm8u\nbmFtZSgpKTsKICAgICAgICB1bnEuc2V0RGVmZXJyZWQoYW5uby5kZWZlcnJl\nZCgpKTsKICAgICAgICBpbmZvLnNldFVuaXF1ZSh1bnEpOwogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgQFZlcnNpb25Db2x1bW4ocykuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZVZlcnNpb25Db2x1bW5zKENsYXNzTWFw\ncGluZyBjbSwgVmVyc2lvbkNvbHVtbi4uLiB2Y29scykgewogICAgICAgIGlm\nICh2Y29scy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBMaXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1u\nPih2Y29scy5sZW5ndGgpOwogICAgICAgIGZvciAoVmVyc2lvbkNvbHVtbiB2\nY29sIDogdmNvbHMpCiAgICAgICAgICAgIGNvbHMuYWRkKG5ld0NvbHVtbih2\nY29sKSk7CiAgICAgICAgY20uZ2V0VmVyc2lvbigpLmdldE1hcHBpbmdJbmZv\nKCkuc2V0Q29sdW1ucyhjb2xzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhIG5ldyBzY2hlbWEgY29sdW1uIHdpdGggaW5mb3JtYXRpb24gZnJv\nbSB0aGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgQ29sdW1uIG5ld0NvbHVtbihWZXJzaW9uQ29sdW1uIGFubm8pIHsK\nICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAgICAgIGlm\nICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm5hbWUoKSkpCiAgICAgICAg\nICAgIGNvbC5zZXROYW1lKGFubm8ubmFtZSgpKTsKICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoYW5uby5jb2x1bW5EZWZpbml0aW9uKCkpKQog\nICAgICAgICAgICBjb2wuc2V0VHlwZU5hbWUoYW5uby5jb2x1bW5EZWZpbml0\naW9uKCkpOwogICAgICAgIGlmIChhbm5vLnByZWNpc2lvbigpICE9IDApCiAg\nICAgICAgICAgIGNvbC5zZXRTaXplKGFubm8ucHJlY2lzaW9uKCkpOwogICAg\nICAgIGVsc2UgaWYgKGFubm8ubGVuZ3RoKCkgIT0gMjU1KQogICAgICAgICAg\nICBjb2wuc2V0U2l6ZShhbm5vLmxlbmd0aCgpKTsKICAgICAgICBjb2wuc2V0\nTm90TnVsbCghYW5uby5udWxsYWJsZSgpKTsKICAgICAgICBjb2wuc2V0RGVj\naW1hbERpZ2l0cyhhbm5vLnNjYWxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFn\nKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSwgIWFubm8uaW5zZXJ0YWJsZSgp\nKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJM\nRSwgIWFubm8udXBkYXRhYmxlKCkpOwogICAgICAgIHJldHVybiBjb2w7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2xhdGUgdGhlIGZldGNoIG1vZGUg\nZW51bSB2YWx1ZSB0byB0aGUgaW50ZXJuYWwgT3BlbkpQQSBjb25zdGFudC4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IHRvRWFnZXJGZXRjaE1v\nZGVDb25zdGFudChGZXRjaE1vZGUgbW9kZSkgewogICAgICAgIHN3aXRjaCAo\nbW9kZSkgewogICAgICAgICAgICBjYXNlIE5PTkU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gRWFnZXJGZXRjaE1vZGVzLkVBR0VSX05PTkU7CiAgICAgICAg\nICAgIGNhc2UgSk9JTjoKICAgICAgICAgICAgICAgIHJldHVybiBFYWdlckZl\ndGNoTW9kZXMuRUFHRVJfSk9JTjsKICAgICAgICAgICAgY2FzZSBQQVJBTExF\nTDoKICAgICAgICAgICAgICAgIHJldHVybiBFYWdlckZldGNoTW9kZXMuRUFH\nRVJfUEFSQUxMRUw7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJz\nZUxvYk1hcHBpbmcoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBDb2x1\nbW4gY29sID0gbmV3IENvbHVtbigpOwogICAgICAgIGlmIChmbWQuZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5TVFJJTkcKICAgICAgICAg\nICAgfHwgZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGNoYXJbXS5jbGFzcwog\nICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQ2hhcmFj\ndGVyW10uY2xhc3MpCiAgICAgICAgICAgIGNvbC5zZXRUeXBlKFR5cGVzLkNM\nT0IpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29sLnNldFR5cGUoVHlw\nZXMuQkxPQik7CiAgICAgICAgKChGaWVsZE1hcHBpbmcpIGZtZCkuZ2V0VmFs\ndWVJbmZvKCkuc2V0Q29sdW1ucyhBcnJheXMuYXNMaXN0CiAgICAgICAgICAg\nIChuZXcgQ29sdW1uW117IGNvbCB9KSk7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZU1lbWJlck1hcHBpbmdBbm5vdGF0\naW9ucyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIEZpZWxkTWFwcGlu\nZyBmbSA9IChGaWVsZE1hcHBpbmcpIGZtZDsKICAgICAgICBBbm5vdGF0ZWRF\nbGVtZW50IGVsID0gKEFubm90YXRlZEVsZW1lbnQpIGdldFJlcG9zaXRvcnko\nKS4KICAgICAgICAgICAgZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVs\ndHMoKS5nZXRCYWNraW5nTWVtYmVyKGZtZCk7CgogICAgICAgIE1hcHBpbmdU\nYWcgdGFnOwogICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDogZWwuZ2V0\nRGVjbGFyZWRBbm5vdGF0aW9ucygpKSB7CiAgICAgICAgICAgIHRhZyA9IF90\nYWdzLmdldChhbm5vLmFubm90YXRpb25UeXBlKCkpOwogICAgICAgICAgICBp\nZiAodGFnID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGhhbmRsZVVua25v\nd25NZW1iZXJNYXBwaW5nQW5ub3RhdGlvbihmbSwgYW5ubyk7CiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgICAgIGNhc2UgQVNTT0NfT1ZF\nUlJJREU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VBc3NvY2lhdGlvbk92\nZXJyaWRlcyhmbSwgKEFzc29jaWF0aW9uT3ZlcnJpZGUpIGFubm8pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBB\nU1NPQ19PVkVSUklERVM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VBc3Nv\nY2lhdGlvbk92ZXJyaWRlcyhmbSwgKChBc3NvY2lhdGlvbk92ZXJyaWRlcykg\nYW5ubykuCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlKCkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBB\nVFRSX09WRVJSSURFOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQXR0cmli\ndXRlT3ZlcnJpZGVzKGZtLCAoQXR0cmlidXRlT3ZlcnJpZGUpIGFubm8pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBBVFRSX09WRVJSSURFUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUF0\ndHJpYnV0ZU92ZXJyaWRlcyhmbSwgKChBdHRyaWJ1dGVPdmVycmlkZXMpIGFu\nbm8pLgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQ09M\nOgogICAgICAgICAgICAgICAgICAgIHBhcnNlQ29sdW1ucyhmbSwgKGphdmF4\nLnBlcnNpc3RlbmNlLkNvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIENPTFM6CiAgICAgICAg\nICAgICAgICAgICAgcGFyc2VDb2x1bW5zKGZtLCAoKENvbHVtbnMpIGFubm8p\nLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBFTlVNRVJBVEVEOgogICAgICAgICAgICAgICAgICAg\nIHBhcnNlRW51bWVyYXRlZChmbSwgKEVudW1lcmF0ZWQpIGFubm8pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBK\nT0lOX0NPTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZUpvaW5Db2x1bW5z\nKGZtLCBmbS5nZXRWYWx1ZUluZm8oKSwgdHJ1ZSwKICAgICAgICAgICAgICAg\nICAgICAgICAgKEpvaW5Db2x1bW4pIGFubm8pOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKT0lOX0NPTFM6CiAg\nICAgICAgICAgICAgICAgICAgcGFyc2VKb2luQ29sdW1ucyhmbSwgZm0uZ2V0\nVmFsdWVJbmZvKCksIHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICgo\nSm9pbkNvbHVtbnMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKT0lOX1RBQkxFOgog\nICAgICAgICAgICAgICAgICAgIHBhcnNlSm9pblRhYmxlKGZtLCAoSm9pblRh\nYmxlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgUEtfSk9JTl9DT0w6CiAgICAgICAgICAgICAgICAg\nICAgcGFyc2VQcmltYXJ5S2V5Sm9pbkNvbHVtbnMoZm0sIChQcmltYXJ5S2V5\nSm9pbkNvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIFBLX0pPSU5fQ09MUzoKICAgICAgICAg\nICAgICAgICAgICBwYXJzZVByaW1hcnlLZXlKb2luQ29sdW1ucyhmbSwKICAg\nICAgICAgICAgICAgICAgICAgICAgKChQcmltYXJ5S2V5Sm9pbkNvbHVtbnMp\nIGFubm8pLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUoKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIFRBQkxFX0dFTjoKICAgICAgICAgICAgICAgICAgICBwYXJzZVRhYmxl\nR2VuZXJhdG9yKGVsLCAoVGFibGVHZW5lcmF0b3IpIGFubm8pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBURU1Q\nT1JBTDoKICAgICAgICAgICAgICAgICAgICBwYXJzZVRlbXBvcmFsKGZtLCAo\nVGVtcG9yYWwpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBDTEFTU19DUklUOgogICAgICAgICAgICAg\nICAgICAgIGZtLmdldFZhbHVlSW5mbygpLnNldFVzZUNsYXNzQ3JpdGVyaWEK\nICAgICAgICAgICAgICAgICAgICAgICAgKCgoQ2xhc3NDcml0ZXJpYSkgYW5u\nbykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIENPTlRBSU5FUl9UQUJMRToKICAgICAgICAgICAg\nICAgICAgICBwYXJzZUNvbnRhaW5lclRhYmxlKGZtLCAoQ29udGFpbmVyVGFi\nbGUpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBFQUdFUl9GRVRDSF9NT0RFOgogICAgICAgICAgICAg\nICAgICAgIGZtLnNldEVhZ2VyRmV0Y2hNb2RlKHRvRWFnZXJGZXRjaE1vZGVD\nb25zdGFudAogICAgICAgICAgICAgICAgICAgICAgICAoKChFYWdlckZldGNo\nTW9kZSkgYW5ubykudmFsdWUoKSkpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTEVNX0NMQVNTX0NSSVQ6CiAg\nICAgICAgICAgICAgICAgICAgZm0uZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRW\nYWx1ZUluZm8oKS5zZXRVc2VDbGFzc0NyaXRlcmlhCiAgICAgICAgICAgICAg\nICAgICAgICAgICgoKEVsZW1lbnRDbGFzc0NyaXRlcmlhKSBhbm5vKS52YWx1\nZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgRUxFTV9GSzoKICAgICAgICAgICAgICAgICAgICBFbGVtZW50\nRm9yZWlnbktleSBlZmsgPSAoRWxlbWVudEZvcmVpZ25LZXkpIGFubm87CiAg\nICAgICAgICAgICAgICAgICAgcGFyc2VGb3JlaWduS2V5KGZtLmdldEVsZW1l\nbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCksCiAgICAgICAgICAgICAgICAg\nICAgICAgIGVmay5uYW1lKCksIGVmay5lbmFibGVkKCksIGVmay5kZWZlcnJl\nZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBlZmsuZGVsZXRlQWN0aW9u\nKCksIGVmay51cGRhdGVBY3Rpb24oKSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fSU5ERVg6CiAgICAg\nICAgICAgICAgICAgICAgRWxlbWVudEluZGV4IGVpZHggPSAoRWxlbWVudElu\nZGV4KSBhbm5vOwogICAgICAgICAgICAgICAgICAgIHBhcnNlSW5kZXgoZm0u\nZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgZWlkeC5uYW1lKCksIGVpZHguZW5hYmxlZCgpLCBl\naWR4LnVuaXF1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgRUxFTV9KT0lOX0NPTDoKICAgICAgICAgICAg\nICAgICAgICBwYXJzZUVsZW1lbnRKb2luQ29sdW1ucyhmbSwgKEVsZW1lbnRK\nb2luQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9KT0lOX0NPTFM6CiAgICAgICAg\nICAgICAgICAgICAgcGFyc2VFbGVtZW50Sm9pbkNvbHVtbnMoZm0sICgoRWxl\nbWVudEpvaW5Db2x1bW5zKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAg\nICAgdmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIEVMRU1fTk9OUE9MWToKICAgICAgICAgICAgICAg\nICAgICBmbS5nZXRFbGVtZW50TWFwcGluZygpLnNldFBvbHltb3JwaGljKHRv\nUG9seW1vcnBoaWNDb25zdGFudAogICAgICAgICAgICAgICAgICAgICAgICAo\nKChFbGVtZW50Tm9ucG9seW1vcnBoaWMpIGFubm8pLnZhbHVlKCkpKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nRU1CRURERURfTUFQUElORzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUVt\nYmVkZGVkTWFwcGluZyhmbSwgKEVtYmVkZGVkTWFwcGluZykgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEZLOgogICAgICAgICAgICAgICAgICAgIHBhcnNlRm9yZWlnbktleShmbS5n\nZXRWYWx1ZUluZm8oKSwgKEZvcmVpZ25LZXkpIGFubm8pOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBJTkRFWDoK\nICAgICAgICAgICAgICAgICAgICBwYXJzZUluZGV4KGZtLmdldFZhbHVlSW5m\nbygpLCAoSW5kZXgpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBOT05QT0xZOgogICAgICAgICAgICAg\nICAgICAgIGZtLnNldFBvbHltb3JwaGljKHRvUG9seW1vcnBoaWNDb25zdGFu\ndAogICAgICAgICAgICAgICAgICAgICAgICAoKChOb25wb2x5bW9ycGhpYykg\nYW5ubykudmFsdWUoKSkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBPUkRFUl9DT0w6CiAgICAgICAgICAgICAg\nICAgICAgcGFyc2VPcmRlckNvbHVtbihmbSwgKE9yZGVyQ29sdW1uKSBhbm5v\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgU1RSQVQ6CiAgICAgICAgICAgICAgICAgICAgZm0uZ2V0VmFsdWVJ\nbmZvKCkuc2V0U3RyYXRlZ3koKChTdHJhdGVneSkgYW5ubykudmFsdWUoKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIFVOSVFVRToKICAgICAgICAgICAgICAgICAgICBwYXJzZVVuaXF1ZShm\nbSwgCiAgICAgICAgICAgICAgICAgICAgICAgIChvcmcuYXBhY2hlLm9wZW5q\ncGEucGVyc2lzdGVuY2UuamRiYy5VbmlxdWUpIGFubm8pOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBYX0pPSU5f\nQ09MOgogICAgICAgICAgICAgICAgICAgIHBhcnNlWEpvaW5Db2x1bW5zKGZt\nLCBmbS5nZXRWYWx1ZUluZm8oKSwgdHJ1ZSwKICAgICAgICAgICAgICAgICAg\nICAgICAgKFhKb2luQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgWF9KT0lOX0NPTFM6CiAg\nICAgICAgICAgICAgICAgICAgcGFyc2VYSm9pbkNvbHVtbnMoZm0sIGZtLmdl\ndFZhbHVlSW5mbygpLCB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAo\nKFhKb2luQ29sdW1ucykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihf\nbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBmbSwKICAgICAgICAgICAgICAgICAg\nICAgICAgYW5uby50b1N0cmluZygpKSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRv\nIGhhbmRsZSB1bmtub3duIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90\nZWN0ZWQgYm9vbGVhbiBoYW5kbGVVbmtub3duTWVtYmVyTWFwcGluZ0Fubm90\nYXRpb24oRmllbGRNYXBwaW5nIGZtLAogICAgICAgIEFubm90YXRpb24gYW5u\nbykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUge0BsaW5rIFZhbHVlTWFwcGluZ30gPGNvZGU+UE9M\nWV8qPC9jb2RlPiBjb25zdGFudCBmb3IKICAgICAqIHRoZSBnaXZlbiBlbnVt\nIHZhbHVlLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGludCB0b1Bv\nbHltb3JwaGljQ29uc3RhbnQoTm9ucG9seW1vcnBoaWNUeXBlIHZhbCkgewog\nICAgICAgIHN3aXRjaCAodmFsKSB7CiAgICAgICAgICAgIGNhc2UgRVhBQ1Q6\nCiAgICAgICAgICAgICAgICByZXR1cm4gVmFsdWVNYXBwaW5nLlBPTFlfRkFM\nU0U7CiAgICAgICAgICAgIGNhc2UgSk9JTkFCTEU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gVmFsdWVNYXBwaW5nLlBPTFlfSk9JTkFCTEU7CiAgICAgICAg\nICAgIGNhc2UgRkFMU0U6CiAgICAgICAgICAgICAgICByZXR1cm4gVmFsdWVN\nYXBwaW5nLlBPTFlfVFJVRTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGdpdmVuIEBBc3Nv\nY2lhdGlvbk92ZXJyaWRlIGFubm90YXRpb25zIG9uIGFuIGVtYmVkZGVkIG1h\ncHBpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUFzc29jaWF0\naW9uT3ZlcnJpZGVzKEZpZWxkTWFwcGluZyBmbSwKICAgICAgICBBc3NvY2lh\ndGlvbk92ZXJyaWRlLi4uIGFzc29jcykgewogICAgICAgIENsYXNzTWFwcGlu\nZyBlbWJlZCA9IGZtLmdldEVtYmVkZGVkTWFwcGluZygpOwogICAgICAgIGlm\nIChlbWJlZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1lbWJlZGRlZCIsIGZtKSk7Cgog\nICAgICAgIEZpZWxkTWFwcGluZyBlZm07CiAgICAgICAgSm9pbkNvbHVtbltd\nIGVjb2xzOwogICAgICAgIGludCB1bmlxdWU7CiAgICAgICAgTGlzdDxDb2x1\nbW4+IGpjb2xzOwogICAgICAgIGZvciAoQXNzb2NpYXRpb25PdmVycmlkZSBh\nc3NvYyA6IGFzc29jcykgewogICAgICAgICAgICBlZm0gPSBlbWJlZC5nZXRG\naWVsZE1hcHBpbmcoYXNzb2MubmFtZSgpKTsKICAgICAgICAgICAgaWYgKGVm\nbSA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbWJlZC1vdmVycmlkZS1uYW1lIiwKICAg\nICAgICAgICAgICAgICAgICBmbSwgYXNzb2MubmFtZSgpKSk7CiAgICAgICAg\nICAgIGVjb2xzID0gYXNzb2Muam9pbkNvbHVtbnMoKTsKICAgICAgICAgICAg\naWYgKGVjb2xzID09IG51bGwgfHwgZWNvbHMubGVuZ3RoID09IDApCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIHVuaXF1ZSA9IDA7\nCiAgICAgICAgICAgIGpjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KGVj\nb2xzLmxlbmd0aCk7CiAgICAgICAgICAgIGZvciAoSm9pbkNvbHVtbiBlY29s\nIDogZWNvbHMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZSB8PSAoZWNvbC51\nbmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7CiAgICAgICAgICAgICAgICBqY29s\ncy5hZGQobmV3Q29sdW1uKGVjb2wpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBzZXRDb2x1bW5zKGVmbSwgZWZtLmdldFZhbHVlSW5mbygpLCBqY29s\ncywgdW5pcXVlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSBnaXZlbiBAQXR0cmlidXRlT3ZlcnJpZGUgYW5ub3RhdGlvbnMgb24g\nYW4gZW1iZWRkZWQgbWFwcGluZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHBhcnNlQXR0cmlidXRlT3ZlcnJpZGVzKEZpZWxkTWFwcGluZyBmbSwKICAg\nICAgICBBdHRyaWJ1dGVPdmVycmlkZS4uLiBhdHRycykgewogICAgICAgIENs\nYXNzTWFwcGluZyBlbWJlZCA9IGZtLmdldEVtYmVkZGVkTWFwcGluZygpOwog\nICAgICAgIGlmIChlbWJlZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1lbWJlZGRlZCIs\nIGZtKSk7CgogICAgICAgIEZpZWxkTWFwcGluZyBlZm07CiAgICAgICAgZm9y\nIChBdHRyaWJ1dGVPdmVycmlkZSBhdHRyIDogYXR0cnMpIHsKICAgICAgICAg\nICAgZWZtID0gZW1iZWQuZ2V0RmllbGRNYXBwaW5nKGF0dHIubmFtZSgpKTsK\nICAgICAgICAgICAgaWYgKGVmbSA9PSBudWxsKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbWJlZC1v\ndmVycmlkZS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICBmbSwgYXR0ci5u\nYW1lKCkpKTsKICAgICAgICAgICAgaWYgKGF0dHIuY29sdW1uKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHBhcnNlQ29sdW1ucyhlZm0sIGF0dHIuY29s\ndW1uKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNl\nIEBFbnVtZXJhdGVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VF\nbnVtZXJhdGVkKEZpZWxkTWFwcGluZyBmbSwgRW51bWVyYXRlZCBhbm5vKSB7\nCiAgICAgICAgU3RyaW5nIHN0cmF0ID0gRW51bVZhbHVlSGFuZGxlci5jbGFz\ncy5nZXROYW1lKCkgKyAiKFN0b3JlT3JkaW5hbD0iCiAgICAgICAgICAgICsg\nU3RyaW5nLnZhbHVlT2YoYW5uby52YWx1ZSgpID09IEVudW1UeXBlLk9SRElO\nQUwpICsgIikiOwogICAgICAgIGZtLmdldFZhbHVlSW5mbygpLnNldFN0cmF0\nZWd5KHN0cmF0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBUZW1w\nb3JhbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlVGVtcG9yYWwo\nRmllbGRNYXBwaW5nIGZtLCBUZW1wb3JhbCBhbm5vKSB7CiAgICAgICAgTGlz\ndCBjb2xzID0gZm0uZ2V0VmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygpOwogICAg\nICAgIGlmICghY29scy5pc0VtcHR5KCkgJiYgY29scy5zaXplKCkgIT0gMSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJudW0tY29scy1taXNtYXRjaCIsIGZtLAogICAgICAgICAgICAgICAg\nU3RyaW5nLnZhbHVlT2YoY29scy5zaXplKCkpLCAiMSIpKTsKICAgICAgICBp\nZiAoY29scy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgY29scyA9IEFycmF5\ncy5hc0xpc3QobmV3IENvbHVtbltdeyBuZXcgQ29sdW1uKCkgfSk7CiAgICAg\nICAgICAgIGZtLmdldFZhbHVlSW5mbygpLnNldENvbHVtbnMoY29scyk7CiAg\nICAgICAgfQoKICAgICAgICBDb2x1bW4gY29sID0gKENvbHVtbikgY29scy5n\nZXQoMCk7CiAgICAgICAgc3dpdGNoIChhbm5vLnZhbHVlKCkpIHsKICAgICAg\nICAgICAgY2FzZSBEQVRFOgogICAgICAgICAgICAgICAgY29sLnNldFR5cGUo\nVHlwZXMuREFURSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBUSU1FOgogICAgICAgICAgICAgICAgY29sLnNldFR5cGUoVHlw\nZXMuVElNRSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBUSU1FU1RBTVA6CiAgICAgICAgICAgICAgICBjb2wuc2V0VHlwZShU\neXBlcy5USU1FU1RBTVApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQENvbHVtbihzKS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VDb2x1bW5zKEZpZWxk\nTWFwcGluZyBmbSwKICAgICAgICBqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW4u\nLi4gcGNvbHMpIHsKICAgICAgICBpZiAocGNvbHMubGVuZ3RoID09IDApCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gbWlnaHQgYWxyZWFkeSBo\nYXZlIHNvbWUgY29sdW1uIGluZm9ybWF0aW9uIGZyb20gbWFwcGluZyBhbm5v\ndGF0aW9uCiAgICAgICAgTGlzdCBjb2xzID0gZm0uZ2V0VmFsdWVJbmZvKCku\nZ2V0Q29sdW1ucygpOwogICAgICAgIGlmICghY29scy5pc0VtcHR5KCkgJiYg\nY29scy5zaXplKCkgIT0gcGNvbHMubGVuZ3RoKQogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm51bS1jb2xzLW1p\nc21hdGNoIiwgZm0sCiAgICAgICAgICAgICAgICBTdHJpbmcudmFsdWVPZihj\nb2xzLnNpemUoKSksIFN0cmluZy52YWx1ZU9mKHBjb2xzLmxlbmd0aCkpKTsK\nCiAgICAgICAgLy8gY2FjaGUgdGhlIEpBWEIgWG1sVHlwZSBjbGFzcyBpZiBp\ndCBpcyBwcmVzZW50IHNvIHdlIGRvIG5vdAogICAgICAgIC8vIGhhdmUgYSBo\nYXJkLXdpcmVkIGRlcGVuZGVuY3kgb24gSkFYQiBoZXJlCiAgICAgICAgQ2xh\nc3MgeG1sVHlwZUNsYXNzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAg\nICAgICB4bWxUeXBlQ2xhc3MgPSBDbGFzcy5mb3JOYW1lKCJqYXZheC54bWwu\nYmluZC5hbm5vdGF0aW9uLlhtbFR5cGUiKTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgIH0KCiAgICAgICAgaW50IHVuaXF1ZSA9\nIDA7CiAgICAgICAgU3RyaW5nIHNlY29uZGFyeSA9IG51bGw7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBwY29scy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoY29scy5zaXplKCkgPiBpKQogICAgICAgICAgICAgICAg\nc2V0dXBDb2x1bW4oKENvbHVtbikgY29scy5nZXQoaSksIHBjb2xzW2ldKTsK\nICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoY29scy5p\nc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgY29scyA9IG5ldyBBcnJh\neUxpc3Q8Q29sdW1uPihwY29scy5sZW5ndGgpOwogICAgICAgICAgICAgICAg\nY29scy5hZGQobmV3Q29sdW1uKHBjb2xzW2ldKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh4bWxUeXBlQ2xhc3MgIT0g\nbnVsbAogICAgICAgICAgICAgICAgJiYgU3RyaW5nVXRpbHMuaXNFbXB0eShw\nY29sc1tpXS5jb2x1bW5EZWZpbml0aW9uKCkpCiAgICAgICAgICAgICAgICAm\nJiAoKEJvb2xlYW4pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoy\nRG9Qcml2NUhlbHBlcgogICAgICAgICAgICAgICAgICAgIC5pc0Fubm90YXRp\nb25QcmVzZW50QWN0aW9uKGZtLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAg\nICAgICAgICAgICAgICAgICB4bWxUeXBlQ2xhc3MpKSkuYm9vbGVhblZhbHVl\nKCkpIHsKICAgICAgICAgICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0gKChN\nYXBwaW5nUmVwb3NpdG9yeSkgZ2V0UmVwb3NpdG9yeSgpKQogICAgICAgICAg\nICAgICAgICAgIC5nZXREQkRpY3Rpb25hcnkoKTsKICAgICAgICAgICAgICAg\nIGlmIChkaWN0LnN1cHBvcnRzWE1MQ29sdW1uKQogICAgICAgICAgICAgICAg\nICAgIC8vIGNvbHVtbiBtYXBzIHRvIHhtbCB0eXBlCiAgICAgICAgICAgICAg\nICAgICAgKChDb2x1bW4pIGNvbHMuZ2V0KGkpKS5zZXRUeXBlTmFtZShkaWN0\nLnhtbFR5cGVOYW1lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdW5p\ncXVlIHw9IChwY29sc1tpXS51bmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7CiAg\nICAgICAgICAgIHNlY29uZGFyeSA9IHRyYWNrU2Vjb25kYXJ5VGFibGUoZm0s\nIHNlY29uZGFyeSwKICAgICAgICAgICAgICAgIHBjb2xzW2ldLnRhYmxlKCks\nIGkpOwogICAgICAgIH0KCiAgICAgICAgc2V0Q29sdW1ucyhmbSwgZm0uZ2V0\nVmFsdWVJbmZvKCksIGNvbHMsIHVuaXF1ZSk7CiAgICAgICAgaWYgKHNlY29u\nZGFyeSAhPSBudWxsKQogICAgICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygp\nLnNldFRhYmxlTmFtZShzZWNvbmRhcnkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBjb2x1bW4gd2l0aCBpbmZvcm1hdGlv\nbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0aW9uLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29sdW1uKGphdmF4LnBlcnNpc3RlbmNl\nLkNvbHVtbiBhbm5vKSB7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1\nbW4oKTsKICAgICAgICBzZXR1cENvbHVtbihjb2wsIGFubm8pOwogICAgICAg\nIHJldHVybiBjb2w7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXR1cCB0aGUg\nZ2l2ZW4gY29sdW1uIHdpdGggaW5mb3JtYXRpb24gZnJvbSB0aGUgZ2l2ZW4g\nYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBz\nZXR1cENvbHVtbihDb2x1bW4gY29sLCBqYXZheC5wZXJzaXN0ZW5jZS5Db2x1\nbW4gYW5ubykgewogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShh\nbm5vLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXROYW1lKGFubm8ubmFt\nZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5j\nb2x1bW5EZWZpbml0aW9uKCkpKQogICAgICAgICAgICBjb2wuc2V0VHlwZU5h\nbWUoYW5uby5jb2x1bW5EZWZpbml0aW9uKCkpOwogICAgICAgIGlmIChhbm5v\nLnByZWNpc2lvbigpICE9IDApCiAgICAgICAgICAgIGNvbC5zZXRTaXplKGFu\nbm8ucHJlY2lzaW9uKCkpOwogICAgICAgIGVsc2UgaWYgKGFubm8ubGVuZ3Ro\nKCkgIT0gMjU1KQogICAgICAgICAgICBjb2wuc2V0U2l6ZShhbm5vLmxlbmd0\naCgpKTsKICAgICAgICBjb2wuc2V0Tm90TnVsbCghYW5uby5udWxsYWJsZSgp\nKTsKICAgICAgICBjb2wuc2V0RGVjaW1hbERpZ2l0cyhhbm5vLnNjYWxlKCkp\nOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJM\nRSwgIWFubm8uaW5zZXJ0YWJsZSgpKTsKICAgICAgICBjb2wuc2V0RmxhZyhD\nb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgIWFubm8udXBkYXRhYmxlKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiBjb2x1bW5zIGFz\nIHRoZSBjb2x1bW5zIGZvciA8Y29kZT5mbTwvY29kZT4uCiAgICAgKgogICAg\nICogQHBhcmFtIHVuaXF1ZSBiaXR3aXNlIGNvbWJpbmF0aW9uIG9mIFRSVUUg\nYW5kIEZBTFNFIGZvciB0aGUKICAgICAqIHVuaXF1ZSBhdHRyaWJ1dGUgb2Yg\nZWFjaCBjb2x1bW4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2V0Q29s\ndW1ucyhGaWVsZE1hcHBpbmcgZm0sIE1hcHBpbmdJbmZvIGluZm8sCiAgICAg\nICAgTGlzdDxDb2x1bW4+IGNvbHMsIGludCB1bmlxdWUpIHsKICAgICAgICBp\nbmZvLnNldENvbHVtbnMoY29scyk7CiAgICAgICAgaWYgKHVuaXF1ZSA9PSBU\nUlVFKQogICAgICAgICAgICBpbmZvLnNldFVuaXF1ZShuZXcgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZSgpKTsKCiAgICAgICAgLy8j\nIyMgRUpCMwogICAgICAgIExvZyBsb2cgPSBnZXRMb2coKTsKICAgICAgICBp\nZiAobG9nLmlzV2FybkVuYWJsZWQoKSAmJiB1bmlxdWUgPT0gKFRSVUUgfCBG\nQUxTRSkpCiAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJpbmNvbnNp\nc3QtY29sLWF0dHJzIiwgZm0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhl\nbHBlciB0byB0cmFjayB0aGUgc2Vjb25kYXJ5IHRhYmxlIGZvciBhIHNldCBv\nZiBjb2x1bW5zLgogICAgICoKICAgICAqIEBwYXJhbSBzZWNvbmRhcnkgc2Vj\nb25kYXJ5IHRhYmxlIGZvciBsYXN0IGNvbHVtbgogICAgICogQHBhcmFtIGNv\nbFNlY29uZGFyeSBzZWNvbmRhcnkgdGFibGUgZm9yIGN1cnJlbnQgY29sdW1u\nCiAgICAgKiBAcmV0dXJuIHNlY29uZGFyeSB0YWJsZSBmb3IgZmllbGQKICAg\nICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgdHJhY2tTZWNvbmRhcnlUYWJsZShG\naWVsZE1hcHBpbmcgZm0sIFN0cmluZyBzZWNvbmRhcnksCiAgICAgICAgU3Ry\naW5nIGNvbFNlY29uZGFyeSwgaW50IGNvbCkgewogICAgICAgIGlmIChTdHJp\nbmdVdGlscy5pc0VtcHR5KGNvbFNlY29uZGFyeSkpCiAgICAgICAgICAgIGNv\nbFNlY29uZGFyeSA9IG51bGw7CiAgICAgICAgaWYgKGNvbCA9PSAwKQogICAg\nICAgICAgICByZXR1cm4gY29sU2Vjb25kYXJ5OwogICAgICAgIGlmICghU3Ry\naW5nVXRpbHMuZXF1YWxzSWdub3JlQ2FzZShzZWNvbmRhcnksIGNvbFNlY29u\nZGFyeSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgic2Vjb25kLWluY29uc2lzdCIsIGZtKSk7CiAgICAgICAg\ncmV0dXJuIHNlY29uZGFyeTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNl\nIEBKb2luVGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUpv\naW5UYWJsZShGaWVsZE1hcHBpbmcgZm0sIEpvaW5UYWJsZSBqb2luKSB7CiAg\nICAgICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5zZXRUYWJsZU5hbWUodG9UYWJs\nZU5hbWUoam9pbi5zY2hlbWEoKSwKICAgICAgICAgICAgam9pbi5uYW1lKCkp\nKTsKICAgICAgICBwYXJzZUpvaW5Db2x1bW5zKGZtLCBmbS5nZXRNYXBwaW5n\nSW5mbygpLCBmYWxzZSwgam9pbi5qb2luQ29sdW1ucygpKTsKICAgICAgICBw\nYXJzZUpvaW5Db2x1bW5zKGZtLCBmbS5nZXRFbGVtZW50TWFwcGluZygpLmdl\ndFZhbHVlSW5mbygpLCBmYWxzZSwKICAgICAgICAgICAgam9pbi5pbnZlcnNl\nSm9pbkNvbHVtbnMoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBn\naXZlbiBASm9pbkNvbHVtbiBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHBhcnNlSm9pbkNvbHVtbnMoRmllbGRNYXBwaW5nIGZtLCBN\nYXBwaW5nSW5mbyBpbmZvLAogICAgICAgIGJvb2xlYW4gc2Vjb25kYXJ5QWxs\nb3dlZCwgSm9pbkNvbHVtbi4uLiBqb2lucykgewogICAgICAgIGlmIChqb2lu\ncy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBM\naXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihqb2lu\ncy5sZW5ndGgpOwogICAgICAgIGludCB1bmlxdWUgPSAwOwogICAgICAgIFN0\ncmluZyBzZWNvbmRhcnkgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29scy5h\nZGQobmV3Q29sdW1uKGpvaW5zW2ldKSk7CiAgICAgICAgICAgIHVuaXF1ZSB8\nPSAoam9pbnNbaV0udW5pcXVlKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAg\nICAgICBzZWNvbmRhcnkgPSB0cmFja1NlY29uZGFyeVRhYmxlKGZtLCBzZWNv\nbmRhcnksCiAgICAgICAgICAgICAgICBqb2luc1tpXS50YWJsZSgpLCBpKTsK\nICAgICAgICAgICAgaWYgKCFzZWNvbmRhcnlBbGxvd2VkICYmIHNlY29uZGFy\neSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtc2Vjb25kIiwgZm0pKTsKICAgICAg\nICB9CgogICAgICAgIHNldENvbHVtbnMoZm0sIGluZm8sIGNvbHMsIHVuaXF1\nZSk7CiAgICAgICAgaWYgKHNlY29uZGFyeSAhPSBudWxsKQogICAgICAgICAg\nICBmbS5nZXRNYXBwaW5nSW5mbygpLnNldFRhYmxlTmFtZShzZWNvbmRhcnkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHNjaGVtYSBj\nb2x1bW4gd2l0aCBpbmZvcm1hdGlvbiBmcm9tIHRoZSBnaXZlbiBhbm5vdGF0\naW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW4gbmV3Q29s\ndW1uKEpvaW5Db2x1bW4gam9pbikgewogICAgICAgIENvbHVtbiBjb2wgPSBu\nZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKGpvaW4ubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoam9pbi5u\nYW1lKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2lu\nLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5zZXROYW1l\nKGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKTsKICAgICAgICBpZiAoIVN0cmlu\nZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKSkK\nICAgICAgICAgICAgY29sLnNldFRhcmdldChqb2luLnJlZmVyZW5jZWRDb2x1\nbW5OYW1lKCkpOwogICAgICAgIGNvbC5zZXROb3ROdWxsKCFqb2luLm51bGxh\nYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5T\nRVJUQUJMRSwgIWpvaW4uaW5zZXJ0YWJsZSgpKTsKICAgICAgICBjb2wuc2V0\nRmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSwgIWpvaW4udXBkYXRhYmxl\nKCkpOwogICAgICAgIHJldHVybiBjb2w7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQYXJzZSBnaXZlbiBAUHJpbWFyeUtleUpvaW5Db2x1bW4gYW5ub3RhdGlv\nbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVByaW1hcnlLZXlK\nb2luQ29sdW1ucyhGaWVsZE1hcHBpbmcgZm0sCiAgICAgICAgUHJpbWFyeUtl\neUpvaW5Db2x1bW4uLi4gam9pbnMpIHsKICAgICAgICBMaXN0PENvbHVtbj4g\nY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihqb2lucy5sZW5ndGgpOwog\nICAgICAgIGZvciAoUHJpbWFyeUtleUpvaW5Db2x1bW4gam9pbiA6IGpvaW5z\nKQogICAgICAgICAgICBjb2xzLmFkZChuZXdDb2x1bW4oam9pbikpOwogICAg\nICAgIHNldENvbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCBjb2xzLCAw\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGdpdmVuIEBYSm9pbkNv\nbHVtbiBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\ncGFyc2VYSm9pbkNvbHVtbnMoRmllbGRNYXBwaW5nIGZtLCBNYXBwaW5nSW5m\nbyBpbmZvLAogICAgICAgIGJvb2xlYW4gc2Vjb25kYXJ5QWxsb3dlZCwgWEpv\naW5Db2x1bW4uLi4gam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMubGVuZ3Ro\nID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdDxDb2x1\nbW4+IGNvbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oam9pbnMubGVuZ3Ro\nKTsKICAgICAgICBpbnQgdW5pcXVlID0gMDsKICAgICAgICBTdHJpbmcgc2Vj\nb25kYXJ5ID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGpv\naW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbHMuYWRkKG5ld0Nv\nbHVtbihqb2luc1tpXSkpOwogICAgICAgICAgICB1bmlxdWUgfD0gKGpvaW5z\nW2ldLnVuaXF1ZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICAgICAgc2Vj\nb25kYXJ5ID0gdHJhY2tTZWNvbmRhcnlUYWJsZShmbSwgc2Vjb25kYXJ5LAog\nICAgICAgICAgICAgICAgam9pbnNbaV0udGFibGUoKSwgaSk7CiAgICAgICAg\nICAgIGlmICghc2Vjb25kYXJ5QWxsb3dlZCAmJiBzZWNvbmRhcnkgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLXNlY29uZCIsIGZtKSk7CiAgICAgICAgfQoKICAg\nICAgICBzZXRDb2x1bW5zKGZtLCBpbmZvLCBjb2xzLCB1bmlxdWUpOwogICAg\nICAgIGlmIChzZWNvbmRhcnkgIT0gbnVsbCkKICAgICAgICAgICAgZm0uZ2V0\nTWFwcGluZ0luZm8oKS5zZXRUYWJsZU5hbWUoc2Vjb25kYXJ5KTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBzY2hlbWEgY29sdW1uIHdp\ndGggaW5mb3JtYXRpb24gZnJvbSB0aGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ29sdW1uIG5ld0NvbHVtbihYSm9p\nbkNvbHVtbiBqb2luKSB7CiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1\nbW4oKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5u\nYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFtZShqb2luLm5hbWUoKSk7\nCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4uY29sdW1u\nRGVmaW5pdGlvbigpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoam9pbi5j\nb2x1bW5EZWZpbml0aW9uKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMu\naXNFbXB0eShqb2luLnJlZmVyZW5jZWRDb2x1bW5OYW1lKCkpKQogICAgICAg\nICAgICBjb2wuc2V0VGFyZ2V0KGpvaW4ucmVmZXJlbmNlZENvbHVtbk5hbWUo\nKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ucmVm\nZXJlbmNlZEF0dHJpYnV0ZU5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRU\nYXJnZXRGaWVsZChqb2luLnJlZmVyZW5jZWRBdHRyaWJ1dGVOYW1lKCkpOwog\nICAgICAgIGNvbC5zZXROb3ROdWxsKCFqb2luLm51bGxhYmxlKCkpOwogICAg\nICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSwgIWpv\naW4uaW5zZXJ0YWJsZSgpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4u\nRkxBR19VTlVQREFUQUJMRSwgIWpvaW4udXBkYXRhYmxlKCkpOwogICAgICAg\nIHJldHVybiBjb2w7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBlbWJl\nZGRlZCBpbmZvIGZvciB0aGUgZ2l2ZW4gbWFwcGluZy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlRW1iZWRkZWRNYXBwaW5nKEZpZWxkTWFwcGlu\nZyBmbSwgRW1iZWRkZWRNYXBwaW5nIGFubm8pIHsKICAgICAgICBDbGFzc01h\ncHBpbmcgZW1iZWQgPSBmbS5nZXRFbWJlZGRlZE1hcHBpbmcoKTsKICAgICAg\nICBpZiAoZW1iZWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtZW1iZWRkZWQiLCBmbSkp\nOwoKICAgICAgICBGaWVsZE1hcHBpbmcgZWZtOwogICAgICAgIGZvciAoTWFw\ncGluZ092ZXJyaWRlIG92ZXIgOiBhbm5vLm92ZXJyaWRlcygpKSB7CiAgICAg\nICAgICAgIGVmbSA9IGVtYmVkLmdldEZpZWxkTWFwcGluZyhvdmVyLm5hbWUo\nKSk7CiAgICAgICAgICAgIGlmIChlZm0gPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW1i\nZWQtb3ZlcnJpZGUtbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgZm0sIG92\nZXIubmFtZSgpKSk7CiAgICAgICAgICAgIHBvcHVsYXRlKGVmbSwgb3Zlcik7\nCiAgICAgICAgfQoKICAgICAgICBTdHJpbmcgbnVsbEluZCA9IG51bGw7CiAg\nICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubnVsbEluZGlj\nYXRvckF0dHJpYnV0ZU5hbWUoKSkpCiAgICAgICAgICAgIG51bGxJbmQgPSBh\nbm5vLm51bGxJbmRpY2F0b3JBdHRyaWJ1dGVOYW1lKCk7CiAgICAgICAgZWxz\nZSBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5udWxsSW5kaWNhdG9y\nQ29sdW1uTmFtZSgpKSkKICAgICAgICAgICAgbnVsbEluZCA9IGFubm8ubnVs\nbEluZGljYXRvckNvbHVtbk5hbWUoKTsKICAgICAgICBpZiAobnVsbEluZCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFZhbHVlTWFw\ncGluZ0luZm8gaW5mbyA9IGZtLmdldFZhbHVlSW5mbygpOwogICAgICAgIGlm\nICgiZmFsc2UiLmVxdWFscyhudWxsSW5kKSkKICAgICAgICAgICAgaW5mby5z\nZXRDYW5JbmRpY2F0ZU51bGwoZmFsc2UpOwogICAgICAgIGVsc2UgewogICAg\nICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAgICAgICAg\nICBpZiAoISJ0cnVlIi5lcXVhbHMobnVsbEluZCkpCiAgICAgICAgICAgICAg\nICBjb2wuc2V0TmFtZShudWxsSW5kKTsKICAgICAgICAgICAgaW5mby5zZXRD\nb2x1bW5zKEFycmF5cy5hc0xpc3QobmV3IENvbHVtbltdeyBjb2wgfSkpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBDb250YWlu\nZXJUYWJsZS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VDb250\nYWluZXJUYWJsZShGaWVsZE1hcHBpbmcgZm0sIENvbnRhaW5lclRhYmxlIGN0\nYmwpIHsKICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygpLnNldFRhYmxlTmFt\nZSh0b1RhYmxlTmFtZShjdGJsLnNjaGVtYSgpLAogICAgICAgICAgICBjdGJs\nLm5hbWUoKSkpOwogICAgICAgIHBhcnNlWEpvaW5Db2x1bW5zKGZtLCBmbS5n\nZXRNYXBwaW5nSW5mbygpLCBmYWxzZSwgY3RibC5qb2luQ29sdW1ucygpKTsK\nICAgICAgICBpZiAoY3RibC5qb2luRm9yZWlnbktleSgpLnNwZWNpZmllZCgp\nKQogICAgICAgICAgICBwYXJzZUZvcmVpZ25LZXkoZm0uZ2V0TWFwcGluZ0lu\nZm8oKSwgY3RibC5qb2luRm9yZWlnbktleSgpKTsKICAgICAgICBpZiAoY3Ri\nbC5qb2luSW5kZXgoKS5zcGVjaWZpZWQoKSkKICAgICAgICAgICAgcGFyc2VJ\nbmRleChmbS5nZXRNYXBwaW5nSW5mbygpLCBjdGJsLmpvaW5JbmRleCgpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBPcmRlckNvbHVtbi4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlT3JkZXJDb2x1bW4oRmllbGRN\nYXBwaW5nIGZtLCBPcmRlckNvbHVtbiBvcmRlcikgewogICAgICAgIGlmICgh\nb3JkZXIuZW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGZtLmdldE1hcHBpbmdJ\nbmZvKCkuc2V0Q2FuT3JkZXJDb2x1bW4oZmFsc2UpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICBDb2x1bW4gY29sID0gbmV3IENv\nbHVtbigpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShvcmRl\nci5uYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFtZShvcmRlci5uYW1l\nKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShvcmRlci5j\nb2x1bW5EZWZpbml0aW9uKCkpKQogICAgICAgICAgICBjb2wuc2V0VHlwZU5h\nbWUob3JkZXIuY29sdW1uRGVmaW5pdGlvbigpKTsKICAgICAgICBpZiAob3Jk\nZXIucHJlY2lzaW9uKCkgIT0gMCkKICAgICAgICAgICAgY29sLnNldFNpemUo\nb3JkZXIucHJlY2lzaW9uKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVt\nbi5GTEFHX1VOSU5TRVJUQUJMRSwgIW9yZGVyLmluc2VydGFibGUoKSk7CiAg\nICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUsICFv\ncmRlci51cGRhdGFibGUoKSk7CiAgICAgICAgZm0uZ2V0TWFwcGluZ0luZm8o\nKS5zZXRPcmRlckNvbHVtbihjb2wpOwogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgQEVsZW1lbnRKb2luQ29sdW1uKHMpLgogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCBwYXJzZUVsZW1lbnRKb2luQ29sdW1ucyhGaWVsZE1hcHBp\nbmcgZm0sCiAgICAgICAgRWxlbWVudEpvaW5Db2x1bW4uLi4gam9pbnMpIHsK\nICAgICAgICBpZiAoam9pbnMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSBuZXcgQXJyYXlM\naXN0PENvbHVtbj4oam9pbnMubGVuZ3RoKTsKICAgICAgICBpbnQgdW5pcXVl\nID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGpvaW5zLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIGNvbHMuYWRkKG5ld0NvbHVtbihqb2lu\nc1tpXSkpOwogICAgICAgICAgICB1bmlxdWUgfD0gKGpvaW5zW2ldLnVuaXF1\nZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICB9CiAgICAgICAgc2V0Q29s\ndW1ucyhmbSwgZm0uZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8o\nKSwgY29scywgdW5pcXVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIG5ldyBzY2hlbWEgY29sdW1uIHdpdGggaW5mb3JtYXRpb24gZnJvbSB0\naGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgQ29sdW1uIG5ld0NvbHVtbihFbGVtZW50Sm9pbkNvbHVtbiBqb2luKSB7\nCiAgICAgICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBp\nZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5uYW1lKCkpKQogICAgICAg\nICAgICBjb2wuc2V0TmFtZShqb2luLm5hbWUoKSk7CiAgICAgICAgaWYgKCFT\ndHJpbmdVdGlscy5pc0VtcHR5KGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKSkK\nICAgICAgICAgICAgY29sLnNldE5hbWUoam9pbi5jb2x1bW5EZWZpbml0aW9u\nKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLnJl\nZmVyZW5jZWRDb2x1bW5OYW1lKCkpKQogICAgICAgICAgICBjb2wuc2V0VGFy\nZ2V0KGpvaW4ucmVmZXJlbmNlZENvbHVtbk5hbWUoKSk7CiAgICAgICAgaWYg\nKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ucmVmZXJlbmNlZEF0dHJpYnV0\nZU5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRUYXJnZXRGaWVsZChqb2lu\nLnJlZmVyZW5jZWRBdHRyaWJ1dGVOYW1lKCkpOwogICAgICAgIGNvbC5zZXRO\nb3ROdWxsKCFqb2luLm51bGxhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFn\nIChDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFqb2luLmluc2VydGFibGUg\nKCkpOwoJCWNvbC5zZXRGbGFnIChDb2x1bW4uRkxBR19VTlVQREFUQUJMRSwg\nIWpvaW4udXBkYXRhYmxlICgpKTsKCQlyZXR1cm4gY29sOwoJfQogICAgCiAg\nICBwcml2YXRlIHN0YXRpYyBVbmlxdWUgbmV3VW5pcXVlKENsYXNzTWFwcGlu\nZyBjbSwgU3RyaW5nIG5hbWUsIAogICAgICAgIFN0cmluZ1tdIGNvbHVtbk5h\nbWVzKSB7CiAgICAgICAgaWYgKGNvbHVtbk5hbWVzID09IG51bGwgfHwgY29s\ndW1uTmFtZXMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIFVuaXF1ZSB1bmlxdWVDb25zdHJhaW50ID0gbmV3IFVuaXF1\nZSgpOwogICAgICAgIHVuaXF1ZUNvbnN0cmFpbnQuc2V0TmFtZShuYW1lKTsK\nICAgICAgICBmb3IgKGludCBpPTA7IGk8Y29sdW1uTmFtZXMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoY29s\ndW1uTmFtZXNbaV0pKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoImVtcHR5LXVuaXF1ZS1jb2x1bW4iLCAKICAg\nICAgICAgICAgICAgICAgICBBcnJheXMudG9TdHJpbmcoY29sdW1uTmFtZXMp\nLCBjbSkpOwogICAgICAgICAgICBDb2x1bW4gY29sdW1uID0gbmV3IENvbHVt\nbigpOwogICAgICAgICAgICBjb2x1bW4uc2V0TmFtZShjb2x1bW5OYW1lc1tp\nXSk7CiAgICAgICAgICAgIHVuaXF1ZUNvbnN0cmFpbnQuYWRkQ29sdW1uKGNv\nbHVtbik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1bmlxdWVDb25zdHJh\naW50OwogICAgfQp9Cg==\n","encoding":"base64"}

