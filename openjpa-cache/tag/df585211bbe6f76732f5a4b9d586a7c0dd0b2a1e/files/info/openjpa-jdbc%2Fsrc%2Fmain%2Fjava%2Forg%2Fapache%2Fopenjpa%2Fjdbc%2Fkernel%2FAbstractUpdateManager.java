{"sha":"db3f34345490a8ebcae64c6515159dd56d950b65","node_id":"MDQ6QmxvYjIwNjM2NDpkYjNmMzQzNDU0OTBhOGViY2FlNjRjNjUxNTE1OWRkNTZkOTUwYjY1","size":13654,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/db3f34345490a8ebcae64c6515159dd56d950b65","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlNRTEV4\nY2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwoKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWlu\nYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmll\nbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5TdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuVmVyc2lvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNx\nbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuUm93TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5TUUxFeGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5QQ1N0YXRlOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcHRpbWlzdGljRXhjZXB0aW9u\nOwoKLyoqCiAqIEJhc2UgdXBkYXRlIG1hbmFnZXIgd2l0aCBjb21tb24gZnVu\nY3Rpb25hbGl0eS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCnB1Ymxp\nYyBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdFVwZGF0ZU1hbmFnZXIKICAgIGlt\ncGxlbWVudHMgVXBkYXRlTWFuYWdlciwgQ29uZmlndXJhYmxlIHsKCiAgICBw\ncm90ZWN0ZWQgSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiA9IG51bGw7CiAgICBw\ncm90ZWN0ZWQgREJEaWN0aW9uYXJ5IGRpY3QgPSBudWxsOwoKICAgIHB1Ymxp\nYyB2b2lkIHNldENvbmZpZ3VyYXRpb24oQ29uZmlndXJhdGlvbiBjb25mKSB7\nCiAgICAgICAgdGhpcy5jb25mID0gKEpEQkNDb25maWd1cmF0aW9uKSBjb25m\nOwogICAgICAgIGRpY3QgPSB0aGlzLmNvbmYuZ2V0REJEaWN0aW9uYXJ5SW5z\ndGFuY2UoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydENvbmZpZ3Vy\nYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgZW5kQ29uZmlndXJh\ndGlvbigpIHsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBmbHVzaChD\nb2xsZWN0aW9uIHN0YXRlcywgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAg\nQ29ubmVjdGlvbiBjb25uID0gc3RvcmUuZ2V0Q29ubmVjdGlvbigpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50TWFuYWdl\nciBwc01nciA9IG5ld1ByZXBhcmVkU3RhdGVtZW50TWFuYWdlcihzdG9yZSwK\nICAgICAgICAgICAgICAgIGNvbm4pOwogICAgICAgICAgICByZXR1cm4gZmx1\nc2goc3RhdGVzLCBzdG9yZSwgcHNNZ3IpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHRyeSB7IGNvbm4uY2xvc2UoKTsgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7fQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIENvbGxlY3Rpb24gZmx1c2goQ29sbGVjdGlvbiBzdGF0ZXMsIEpEQkNTdG9y\nZSBzdG9yZSwKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudE1hbmFnZXIgcHNN\nZ3IpIHsKICAgICAgICAvLyBydW4gdGhyb3VnaCBhbGwgdGhlIHN0YXRlcyBh\nbmQgdXBkYXRlIHRoZW0gYXMgbmVjZXNzYXJ5CiAgICAgICAgUm93TWFuYWdl\nciByb3dNZ3IgPSBuZXdSb3dNYW5hZ2VyKCk7CiAgICAgICAgQ29sbGVjdGlv\nbiBjdXN0b21zID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICBDb2xsZWN0\naW9uIGV4Y2VwcyA9IHBzTWdyLmdldEV4Y2VwdGlvbnMoKTsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHN0YXRlcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgZXhjZXBzID0gcG9wdWxhdGVSb3dNYW5h\nZ2VyKChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBpdHIubmV4dCgpLAogICAgICAg\nICAgICAgICAgcm93TWdyLCBzdG9yZSwgZXhjZXBzLCBjdXN0b21zKTsKCiAg\nICAgICAgLy8gZmx1c2ggcm93cwogICAgICAgIGV4Y2VwcyA9IGZsdXNoKHJv\nd01nciwgcHNNZ3IsIGV4Y2Vwcyk7CgogICAgICAgIC8vIG5vdyBkbyBhbnkg\nY3VzdG9tIG1hcHBpbmdzCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBj\ndXN0b21zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAoKEN1c3RvbU1hcHBpbmcpIGl0\nci5uZXh0KCkpLmV4ZWN1dGUoc3RvcmUpOwogICAgICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIGV4Y2VwcyA9\nIGFkZEV4Y2VwdGlvbihleGNlcHMsIFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUo\nc2UsIGRpY3QpKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkRXhjZXB0\naW9uKGV4Y2Vwcywga2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyByZXR1cm4gYWxsIGV4Y2VwdGlvbnMKICAgICAgICByZXR1cm4g\nZXhjZXBzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbmV3IHtA\nbGluayBSb3dNYW5hZ2VyfS4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3Ry\nYWN0IFJvd01hbmFnZXIgbmV3Um93TWFuYWdlcigpOwoKICAgIC8qKgogICAg\nICogUmV0dXJuIGEgbmV3IHtAbGluayBQcmVwYXJlZFN0YXRlbWVudE1hbmFn\nZXJ9LgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgUHJlcGFyZWRT\ndGF0ZW1lbnRNYW5hZ2VyIG5ld1ByZXBhcmVkU3RhdGVtZW50TWFuYWdlcigK\nICAgICAgICBKREJDU3RvcmUgc3RvcmUsIENvbm5lY3Rpb24gY29ubik7Cgog\nICAgLyoqCiAgICAgKiBGbHVzaCBhbGwgcm93cyBvZiB0aGUgZ2l2ZW4gcm93\nIG1hbmFnZXIuIEFkZCBleGNlcHRpb25zIHRvCiAgICAgKiA8Y29kZT5leGNl\ncHM8L2NvZGU+ICh3aGljaCBtYXkgc3RhcnQgYXMgbnVsbCkgdXNpbmcKICAg\nICAqIHtAbGluayAjYWRkRXhjZXB0aW9ufS4gUmV0dXJuIDxjb2RlPmV4Y2Vw\nczwvY29kZT4uCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBDb2xs\nZWN0aW9uIGZsdXNoKFJvd01hbmFnZXIgcm93TWdyLAogICAgICAgIFByZXBh\ncmVkU3RhdGVtZW50TWFuYWdlciBwc01nciwgQ29sbGVjdGlvbiBleGNlcHMp\nOwoKICAgIC8qKgogICAgICogUG9wdWxhdGUgdGhlIHJvdyBtYW5hZ2VyIHdp\ndGggcm93cyB0byBiZSBmbHVzaGVkIGZvciB0aGUgZ2l2ZW4gc3RhdGUuCiAg\nICAgKgogICAgICogQHBhcmFtIGV4Y2VwcyBleGNlcHRpb25zIGVuY291bnRl\ncmVkIHdoZW4gZmx1c2hpbmcgd2lsbCBiZSBhZGRlZCB0bwogICAgICogdGhp\ncyBsaXN0IGFuZCByZXR1cm5lZDsgdGhlIGxpc3QgbWF5IGJlIG51bGwgaW5p\ndGlhbGx5CiAgICAgKiBAcGFyYW0gY3VzdG9tcyBidWZmZXIgY3VzdG9tIG1h\ncHBpbmdzCiAgICAgKiBAcmV0dXJuIHRoZSBleGNlcHRpb25zIGxpc3QKICAg\nICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gcG9wdWxhdGVSb3dNYW5h\nZ2VyKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgUm93TWFuYWdl\nciByb3dNZ3IsIEpEQkNTdG9yZSBzdG9yZSwgQ29sbGVjdGlvbiBleGNlcHMs\nCiAgICAgICAgQ29sbGVjdGlvbiBjdXN0b21zKSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgQml0U2V0IGRpcnR5OwogICAgICAgICAgICBpZiAoc20u\nZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuUE5FVyAmJiAhc20uaXNGbHVzaGVk\nKCkpIHsKICAgICAgICAgICAgICAgIGluc2VydChzbSwgKENsYXNzTWFwcGlu\nZykgc20uZ2V0TWV0YURhdGEoKSwgcm93TWdyLCBzdG9yZSwKICAgICAgICAg\nICAgICAgICAgICBjdXN0b21zKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChz\nbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QTkVXRkxVU0hFRERFTEVURUQK\nICAgICAgICAgICAgICAgIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRl\nLlBERUxFVEVEKSB7CiAgICAgICAgICAgICAgICBkZWxldGUoc20sIChDbGFz\nc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCksIHJvd01nciwgc3RvcmUsCiAg\nICAgICAgICAgICAgICAgICAgY3VzdG9tcyk7CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAoKGRpcnR5ID0gSW1wbEhlbHBlci5nZXRVcGRhdGVGaWVsZHMoc20p\nKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICB1cGRhdGUoc20sIGRpcnR5\nLCAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpLCByb3dNZ3IsCiAg\nICAgICAgICAgICAgICAgICAgc3RvcmUsIGN1c3RvbXMpOwogICAgICAgICAg\nICB9IGVsc2UgaWYgKHNtLmlzVmVyc2lvblVwZGF0ZVJlcXVpcmVkKCkpIHsK\nICAgICAgICAgICAgICAgIHVwZGF0ZUluZGljYXRvcnMoc20sIChDbGFzc01h\ncHBpbmcpIHNtLmdldE1ldGFEYXRhKCksIHJvd01nciwKICAgICAgICAgICAg\nICAgICAgICBzdG9yZSwgY3VzdG9tcywgdHJ1ZSk7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAoc20uaXNWZXJzaW9uQ2hlY2tSZXF1aXJlZCgpKSB7CiAgICAg\nICAgICAgICAgICBpZiAoISgoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0\nYSgpKS5nZXRWZXJzaW9uKCkuCiAgICAgICAgICAgICAgICAgICAgY2hlY2tW\nZXJzaW9uKHNtLCBzdG9yZSwgZmFsc2UpKQogICAgICAgICAgICAgICAgICAg\nIGV4Y2VwcyA9IGFkZEV4Y2VwdGlvbihleGNlcHMsIG5ldyBPcHRpbWlzdGlj\nRXhjZXB0aW9uKHNtLgogICAgICAgICAgICAgICAgICAgICAgICBnZXRNYW5h\nZ2VkSW5zdGFuY2UoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFk\nZEV4Y2VwdGlvbihleGNlcHMsIFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2Us\nIGRpY3QpKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZEV4Y2VwdGlvbihleGNlcHMs\nIGtlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGV4Y2VwczsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gZXhjZXB0aW9uIHRvIHRo\nZSBnaXZlbiBsaXN0LCB3aGljaCBtYXkgc3RhcnQgb3V0IGFzIG51bGwuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGFkZEV4Y2VwdGlvbihD\nb2xsZWN0aW9uIGV4Y2VwcywgRXhjZXB0aW9uIGVycikgewogICAgICAgIGlm\nIChleGNlcHMgPT0gbnVsbCkKICAgICAgICAgICAgZXhjZXBzID0gbmV3IExp\nbmtlZExpc3QoKTsKICAgICAgICBleGNlcHMuYWRkKGVycik7CiAgICAgICAg\ncmV0dXJuIGV4Y2VwczsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2\nZSBtZXRob2QgdG8gaW5zZXJ0IHRoZSBnaXZlbiBpbnN0YW5jZSwgYmFzZSBj\nbGFzcyBmaXJzdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgaW5zZXJ0\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIENsYXNzTWFwcGluZyBtYXBwaW5n\nLAogICAgICAgIFJvd01hbmFnZXIgcm93TWdyLCBKREJDU3RvcmUgc3RvcmUs\nIENvbGxlY3Rpb24gY3VzdG9tcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBCb29sZWFuIGN1c3RvbSA9IG1hcHBpbmcuaXNDdXN0\nb21JbnNlcnQoc20sIHN0b3JlKTsKICAgICAgICBpZiAoIUJvb2xlYW4uRkFM\nU0UuZXF1YWxzKGN1c3RvbSkpCiAgICAgICAgICAgIG1hcHBpbmcuY3VzdG9t\nSW5zZXJ0KHNtLCBzdG9yZSk7CiAgICAgICAgaWYgKEJvb2xlYW4uVFJVRS5l\ncXVhbHMoY3VzdG9tKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBD\nbGFzc01hcHBpbmcgc3VwID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJj\nbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAoc3VwICE9IG51bGwpCiAgICAg\nICAgICAgIGluc2VydChzbSwgc3VwLCByb3dNZ3IsIHN0b3JlLCBjdXN0b21z\nKTsKCiAgICAgICAgbWFwcGluZy5pbnNlcnQoc20sIHN0b3JlLCByb3dNZ3Ip\nOwogICAgICAgIEZpZWxkTWFwcGluZ1tdIGZpZWxkcyA9IG1hcHBpbmcuZ2V0\nRGVmaW5lZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBCaXRTZXQgZGlydHkg\nPSBzbS5nZXREaXJ0eSgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChkaXJ0eS5n\nZXQoZmllbGRzW2ldLmdldEluZGV4KCkpCiAgICAgICAgICAgICAgICAmJiAh\nYnVmZmVyQ3VzdG9tSW5zZXJ0KGZpZWxkc1tpXSwgc20sIHN0b3JlLCBjdXN0\nb21zKSkKICAgICAgICAgICAgICAgIGZpZWxkc1tpXS5pbnNlcnQoc20sIHN0\nb3JlLCByb3dNZ3IpOwogICAgICAgIH0KICAgICAgICBpZiAoc3VwID09IG51\nbGwpIHsKICAgICAgICAgICAgVmVyc2lvbiB2ZXJzID0gbWFwcGluZy5nZXRW\nZXJzaW9uKCk7CiAgICAgICAgICAgIGlmICghYnVmZmVyQ3VzdG9tSW5zZXJ0\nKHZlcnMsIHNtLCBzdG9yZSwgY3VzdG9tcykpCiAgICAgICAgICAgICAgICB2\nZXJzLmluc2VydChzbSwgc3RvcmUsIHJvd01ncik7CiAgICAgICAgICAgIERp\nc2NyaW1pbmF0b3IgZHNjID0gbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCk7\nCiAgICAgICAgICAgIGlmICghYnVmZmVyQ3VzdG9tSW5zZXJ0KGRzYywgc20s\nIHN0b3JlLCBjdXN0b21zKSkKICAgICAgICAgICAgICAgIGRzYy5pbnNlcnQo\nc20sIHN0b3JlLCByb3dNZ3IpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIElmIHRoZSBnaXZlbiBtYXBwaW5nIHVzZXMgYSBjdXN0b20gaW5z\nZXJ0LCBwbGFjZXMgYQogICAgICoge0BsaW5rIEN1c3RvbU1hcHBpbmd9IHN0\ncnVjdCBmb3IgaXQgaW4gdGhlIGdpdmVuIGNvbGxlY3Rpb24gYW5kCiAgICAg\nKiByZXR1cm5zIHRydWUsIGVsc2UgcmV0dXJucyBmYWxzZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIGJ1ZmZlckN1c3RvbUluc2VydChTdHJhdGVn\neSBzdHJhdCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBKREJD\nU3RvcmUgc3RvcmUsIENvbGxlY3Rpb24gY3VzdG9tcykgewogICAgICAgIEJv\nb2xlYW4gY3VzdG9tID0gc3RyYXQuaXNDdXN0b21JbnNlcnQoc20sIHN0b3Jl\nKTsKICAgICAgICBpZiAoIUJvb2xlYW4uRkFMU0UuZXF1YWxzKGN1c3RvbSkp\nCiAgICAgICAgICAgIGN1c3RvbXMuYWRkKG5ldyBDdXN0b21NYXBwaW5nKEN1\nc3RvbU1hcHBpbmcuSU5TRVJULCBzbSwgc3RyYXQpKTsKICAgICAgICByZXR1\ncm4gQm9vbGVhbi5UUlVFLmVxdWFscyhjdXN0b20pOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVjdXJzaXZlIG1ldGhvZCB0byBkZWxldGUgdGhlIGdpdmVu\nIGluc3RhbmNlLCBiYXNlIGNsYXNzIGxhc3QuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCB2b2lkIGRlbGV0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBDbGFz\nc01hcHBpbmcgbWFwcGluZywKICAgICAgICBSb3dNYW5hZ2VyIHJvd01nciwg\nSkRCQ1N0b3JlIHN0b3JlLCBDb2xsZWN0aW9uIGN1c3RvbXMpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQm9vbGVhbiBjdXN0b20g\nPSBtYXBwaW5nLmlzQ3VzdG9tRGVsZXRlKHNtLCBzdG9yZSk7CiAgICAgICAg\naWYgKCFCb29sZWFuLkZBTFNFLmVxdWFscyhjdXN0b20pKQogICAgICAgICAg\nICBtYXBwaW5nLmN1c3RvbURlbGV0ZShzbSwgc3RvcmUpOwogICAgICAgIGlm\nIChCb29sZWFuLlRSVUUuZXF1YWxzKGN1c3RvbSkpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgRmllbGRNYXBwaW5nW10gZmllbGRzID0gbWFwcGlu\nZy5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBp\nZiAoIWJ1ZmZlckN1c3RvbURlbGV0ZShmaWVsZHNbaV0sIHNtLCBzdG9yZSwg\nY3VzdG9tcykpCiAgICAgICAgICAgICAgICBmaWVsZHNbaV0uZGVsZXRlKHNt\nLCBzdG9yZSwgcm93TWdyKTsKCiAgICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9\nIG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAg\nICAgICAgaWYgKHN1cCA9PSBudWxsKSB7CiAgICAgICAgICAgIFZlcnNpb24g\ndmVycyA9IG1hcHBpbmcuZ2V0VmVyc2lvbigpOwogICAgICAgICAgICBpZiAo\nIWJ1ZmZlckN1c3RvbURlbGV0ZSh2ZXJzLCBzbSwgc3RvcmUsIGN1c3RvbXMp\nKQogICAgICAgICAgICAgICAgdmVycy5kZWxldGUoc20sIHN0b3JlLCByb3dN\nZ3IpOwogICAgICAgICAgICBEaXNjcmltaW5hdG9yIGRzYyA9IG1hcHBpbmcu\nZ2V0RGlzY3JpbWluYXRvcigpOwogICAgICAgICAgICBpZiAoIWJ1ZmZlckN1\nc3RvbURlbGV0ZShkc2MsIHNtLCBzdG9yZSwgY3VzdG9tcykpCiAgICAgICAg\nICAgICAgICBkc2MuZGVsZXRlKHNtLCBzdG9yZSwgcm93TWdyKTsKICAgICAg\nICB9CiAgICAgICAgbWFwcGluZy5kZWxldGUoc20sIHN0b3JlLCByb3dNZ3Ip\nOwoKICAgICAgICBpZiAoc3VwICE9IG51bGwpCiAgICAgICAgICAgIGRlbGV0\nZShzbSwgc3VwLCByb3dNZ3IsIHN0b3JlLCBjdXN0b21zKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEBzZWUgI2J1ZmZlckN1c3RvbUluc2VydAogICAgICov\nCiAgICBwcml2YXRlIGJvb2xlYW4gYnVmZmVyQ3VzdG9tRGVsZXRlKFN0cmF0\nZWd5IHN0cmF0LCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpE\nQkNTdG9yZSBzdG9yZSwgQ29sbGVjdGlvbiBjdXN0b21zKSB7CiAgICAgICAg\nQm9vbGVhbiBjdXN0b20gPSBzdHJhdC5pc0N1c3RvbURlbGV0ZShzbSwgc3Rv\ncmUpOwogICAgICAgIGlmICghQm9vbGVhbi5GQUxTRS5lcXVhbHMoY3VzdG9t\nKSkKICAgICAgICAgICAgY3VzdG9tcy5hZGQobmV3IEN1c3RvbU1hcHBpbmco\nQ3VzdG9tTWFwcGluZy5ERUxFVEUsIHNtLCBzdHJhdCkpOwogICAgICAgIHJl\ndHVybiBCb29sZWFuLlRSVUUuZXF1YWxzKGN1c3RvbSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZWN1cnNpdmUgbWV0aG9kIHRvIHVwZGF0ZSB0aGUgZ2l2\nZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHVwZGF0\nZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZGlydHksCiAgICAg\nICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFJvd01hbmFnZXIgcm93TWdyLCBK\nREJDU3RvcmUgc3RvcmUsCiAgICAgICAgQ29sbGVjdGlvbiBjdXN0b21zKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBCb29sZWFuIGN1c3RvbSA9\nIG1hcHBpbmcuaXNDdXN0b21VcGRhdGUoc20sIHN0b3JlKTsKICAgICAgICBp\nZiAoIUJvb2xlYW4uRkFMU0UuZXF1YWxzKGN1c3RvbSkpCiAgICAgICAgICAg\nIG1hcHBpbmcuY3VzdG9tVXBkYXRlKHNtLCBzdG9yZSk7CiAgICAgICAgaWYg\nKEJvb2xlYW4uVFJVRS5lcXVhbHMoY3VzdG9tKSkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAvLyB1cGRhdGUgYWxsIGZpZWxkcyBiZWZvcmUgYWxs\nIG1hcHBpbmdzIHNvIHRoYXQgdGhlIG1hcHBpbmdzIGNhbgogICAgICAgIC8v\nIGRldGVjdCB3aGV0aGVyIGFueSBmaWVsZHMgaW4gdGhlaXIgcm93cyBoYXZl\nIGJlZW4gbW9kaWZpZWQKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmaWVsZHMg\nPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgaWYgKGRpcnR5LmdldChmaWVsZHNbaV0uZ2V0SW5kZXgoKSkK\nICAgICAgICAgICAgICAgICYmICFidWZmZXJDdXN0b21VcGRhdGUoZmllbGRz\nW2ldLCBzbSwgc3RvcmUsIGN1c3RvbXMpKQogICAgICAgICAgICAgICAgZmll\nbGRzW2ldLnVwZGF0ZShzbSwgc3RvcmUsIHJvd01ncik7CiAgICAgICAgfQoK\nICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gbWFwcGluZy5nZXRKb2luYWJs\nZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAoc3VwID09IG51\nbGwpCiAgICAgICAgICAgIHVwZGF0ZUluZGljYXRvcnMoc20sIG1hcHBpbmcs\nIHJvd01nciwgc3RvcmUsIGN1c3RvbXMsIGZhbHNlKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHVwZGF0ZShzbSwgZGlydHksIHN1cCwgcm93TWdyLCBz\ndG9yZSwgY3VzdG9tcyk7CiAgICAgICAgbWFwcGluZy51cGRhdGUoc20sIHN0\nb3JlLCByb3dNZ3IpOwogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIHZl\ncnNpb24gYW5kIGRpc2NyaW1pbmF0b3IgaW5kaWNhdG9ycy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgdXBkYXRlSW5kaWNhdG9ycyhPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBS\nb3dNYW5hZ2VyIHJvd01nciwgSkRCQ1N0b3JlIHN0b3JlLCBDb2xsZWN0aW9u\nIGN1c3RvbXMsCiAgICAgICAgYm9vbGVhbiB2ZXJzaW9uVXBkYXRlT25seSkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgd2hpbGUgKG1hcHBpbmcu\nZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAg\nICAgICAgICAgbWFwcGluZyA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVy\nY2xhc3NNYXBwaW5nKCk7CgogICAgICAgIFZlcnNpb24gdmVycyA9IG1hcHBp\nbmcuZ2V0VmVyc2lvbigpOwogICAgICAgIGlmICghYnVmZmVyQ3VzdG9tVXBk\nYXRlKHZlcnMsIHNtLCBzdG9yZSwgY3VzdG9tcykpCiAgICAgICAgICAgIHZl\ncnMudXBkYXRlKHNtLCBzdG9yZSwgcm93TWdyKTsKCiAgICAgICAgaWYgKHZl\ncnNpb25VcGRhdGVPbmx5KSB7CiAgICAgICAgICAgIC8vIGlmIHdlIGFyZSBv\nbmx5IHVwZGF0aW5nIHRoZSB2ZXJzaW9uIGNvbHVtbiwgd2UgbmVlZCB0byBh\nZGQKICAgICAgICAgICAgLy8gaW4gdGhlIHByaW1hcnkga2V5IHNlbGVjdAog\nICAgICAgICAgICBtYXBwaW5nLnVwZGF0ZShzbSwgc3RvcmUsIHJvd01ncik7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHdl\nIG5lZWQgdG8gbWFrZSBzdXJlIHdlIHVwZGF0ZSB0aGUgZGlzY3JpbWluYXRv\nciB0b28KICAgICAgICAgICAgRGlzY3JpbWluYXRvciBkc2MgPSBtYXBwaW5n\nLmdldERpc2NyaW1pbmF0b3IoKTsKICAgICAgICAgICAgaWYgKCFidWZmZXJD\ndXN0b21VcGRhdGUoZHNjLCBzbSwgc3RvcmUsIGN1c3RvbXMpKQogICAgICAg\nICAgICAgICAgZHNjLnVwZGF0ZShzbSwgc3RvcmUsIHJvd01ncik7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQHNlZSAjYnVmZmVyQ3VzdG9t\nSW5zZXJ0CiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBidWZmZXJDdXN0\nb21VcGRhdGUoU3RyYXRlZ3kgc3RyYXQsIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBDb2xsZWN0aW9uIGN1c3Rv\nbXMpIHsKICAgICAgICBCb29sZWFuIGN1c3RvbSA9IHN0cmF0LmlzQ3VzdG9t\nVXBkYXRlKHNtLCBzdG9yZSk7CiAgICAgICAgaWYgKCFCb29sZWFuLkZBTFNF\nLmVxdWFscyhjdXN0b20pKQogICAgICAgICAgICBjdXN0b21zLmFkZChuZXcg\nQ3VzdG9tTWFwcGluZyhDdXN0b21NYXBwaW5nLlVQREFURSwgc20sIHN0cmF0\nKSk7CiAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRS5lcXVhbHMoY3VzdG9t\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4ZWN1dGVzIGN1c3RvbWl6ZWQg\nbWFwcGluZyB1cGRhdGVzLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGlj\nIGNsYXNzIEN1c3RvbU1hcHBpbmcgewoKICAgICAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBJTlNFUlQgPSAwOwogICAgICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IFVQREFURSA9IDE7CiAgICAgICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgREVMRVRFID0gMzsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBp\nbnQgX2FjdGlvbjsKICAgICAgICBwcml2YXRlIGZpbmFsIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgX3NtOwogICAgICAgIHByaXZhdGUgZmluYWwgU3RyYXRlZ3kg\nX3N0cmF0OwoKICAgICAgICBwdWJsaWMgQ3VzdG9tTWFwcGluZyhpbnQgYWN0\naW9uLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBTdHJhdGVneSBzdHJhdCkg\newogICAgICAgICAgICBfYWN0aW9uID0gYWN0aW9uOwogICAgICAgICAgICBf\nc20gPSBzbTsKICAgICAgICAgICAgX3N0cmF0ID0gc3RyYXQ7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBleGVjdXRlKEpEQkNTdG9yZSBzdG9y\nZSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHN3aXRjaCAo\nX2FjdGlvbikgewogICAgICAgICAgICBjYXNlIElOU0VSVDoKICAgICAgICAg\nICAgICAgIF9zdHJhdC5jdXN0b21JbnNlcnQoX3NtLCBzdG9yZSk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBVUERBVEU6CiAg\nICAgICAgICAgICAgICBfc3RyYXQuY3VzdG9tVXBkYXRlKF9zbSwgc3RvcmUp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgREVM\nRVRFOgogICAgICAgICAgICAgICAgX3N0cmF0LmN1c3RvbURlbGV0ZShfc20s\nIHN0b3JlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

