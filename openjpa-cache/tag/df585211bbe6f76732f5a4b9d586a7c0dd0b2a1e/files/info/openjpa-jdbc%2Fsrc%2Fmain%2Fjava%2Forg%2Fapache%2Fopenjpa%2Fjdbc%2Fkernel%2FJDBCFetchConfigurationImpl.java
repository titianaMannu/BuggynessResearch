{"sha":"a00b5a31ed51486c07e6365c6c50ee879c3ab155","node_id":"MDQ6QmxvYjIwNjM2NDphMDBiNWEzMWVkNTE0ODZjMDdlNjM2NWM2YzUwZWU4NzljM2FiMTU1","size":12565,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a00b5a31ed51486c07e6365c6c50ee879c3ab155","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5SZXN1\nbHRTZXQ7CmltcG9ydCBqYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlv\nbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRp\nbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNs\nYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb25JbXBsOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRleHQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnJvcC5FYWdlclJlc3VsdExpc3Q7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5MaXN0UmVzdWx0T2JqZWN0\nUHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5S\nZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3Au\nUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnJvcC5TaW1wbGVSZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5yb3AuU29mdFJhbmRvbUFjY2Vzc1Jlc3VsdExpc3Q7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5XaW5kb3dSZXN1\nbHRMaXN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxk\nTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2Vy\nRXhjZXB0aW9uOwoKLyoqCiAqIEpEQkMgZXh0ZW5zaW9ucyB0byBPcGVuSlBB\nJ3Mge0BsaW5rIEZldGNoQ29uZmlndXJhdGlvbn0uCiAqCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uSW1wbAogICAgZXh0ZW5kcyBGZXRjaENvbmZp\nZ3VyYXRpb25JbXBsCiAgICBpbXBsZW1lbnRzIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbkltcGwuY2xhc3MpOwoKICAgIC8qKgogICAgICogQ29u\nZmlndXJhYmxlIEpEQkMgc3RhdGUgc2hhcmVkIHRocm91Z2hvdXQgYSB0cmF2\nZXJzYWwgY2hhaW4uCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgY2xh\nc3MgSkRCQ0NvbmZpZ3VyYXRpb25TdGF0ZSBpbXBsZW1lbnRzIFNlcmlhbGl6\nYWJsZSB7CiAgICAgICAgcHVibGljIGludCBlYWdlck1vZGUgPSAwOwogICAg\nICAgIHB1YmxpYyBpbnQgc3ViY2xhc3NNb2RlID0gMDsKICAgICAgICBwdWJs\naWMgaW50IHR5cGUgPSAwOwogICAgICAgIHB1YmxpYyBpbnQgZGlyZWN0aW9u\nID0gMDsKICAgICAgICBwdWJsaWMgaW50IHNpemUgPSAwOwogICAgICAgIHB1\nYmxpYyBpbnQgc3ludGF4ID0gMDsKICAgICAgICBwdWJsaWMgU2V0IGpvaW5z\nID0gbnVsbDsKICAgICAgICBwdWJsaWMgU2V0IGZldGNoSW5uZXJKb2lucyA9\nIG51bGw7CiAgICAgICAgcHVibGljIGludCBpc29sYXRpb25MZXZlbCA9IC0x\nOwogICAgfQoKICAgIHByb3RlY3RlZCBmaW5hbCBKREJDQ29uZmlndXJhdGlv\nblN0YXRlIF9zdGF0ZTsKCiAgICBwdWJsaWMgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbkltcGwoKSB7CiAgICAgICAgdGhpcyhudWxsLCBudWxsKTsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbkltcGwoQ29u\nZmlndXJhdGlvblN0YXRlIHN0YXRlLCAKICAgICAgICBKREJDQ29uZmlndXJh\ndGlvblN0YXRlIGpzdGF0ZSkgewogICAgICAgIHN1cGVyKHN0YXRlKTsKICAg\nICAgICBfc3RhdGUgPSAoanN0YXRlID09IG51bGwpID8gbmV3IEpEQkNDb25m\naWd1cmF0aW9uU3RhdGUoKSA6IGpzdGF0ZTsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgRmV0Y2hDb25maWd1cmF0aW9uSW1wbCBuZXdJbnN0YW5jZShDb25maWd1\ncmF0aW9uU3RhdGUgc3RhdGUpIHsKICAgICAgICBKREJDQ29uZmlndXJhdGlv\nblN0YXRlIGpzdGF0ZSA9IChzdGF0ZSA9PSBudWxsKSA/IG51bGwgOiBfc3Rh\ndGU7CiAgICAgICAgcmV0dXJuIG5ldyBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nSW1wbChzdGF0ZSwganN0YXRlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRDb250ZXh0KFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBzdXBlci5z\nZXRDb250ZXh0KGN0eCk7CiAgICAgICAgSkRCQ0NvbmZpZ3VyYXRpb24gY29u\nZiA9IGdldEpEQkNDb25maWd1cmF0aW9uKCk7CiAgICAgICAgaWYgKGNvbmYg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBzZXRFYWdl\nckZldGNoTW9kZShjb25mLmdldEVhZ2VyRmV0Y2hNb2RlQ29uc3RhbnQoKSk7\nCiAgICAgICAgc2V0U3ViY2xhc3NGZXRjaE1vZGUoY29uZi5nZXRTdWJjbGFz\nc0ZldGNoTW9kZUNvbnN0YW50KCkpOwogICAgICAgIHNldFJlc3VsdFNldFR5\ncGUoY29uZi5nZXRSZXN1bHRTZXRUeXBlQ29uc3RhbnQoKSk7CiAgICAgICAg\nc2V0RmV0Y2hEaXJlY3Rpb24oY29uZi5nZXRGZXRjaERpcmVjdGlvbkNvbnN0\nYW50KCkpOwogICAgICAgIHNldExSU1NpemUoY29uZi5nZXRMUlNTaXplQ29u\nc3RhbnQoKSk7CiAgICAgICAgc2V0Sm9pblN5bnRheChjb25mLmdldERCRGlj\ndGlvbmFyeUluc3RhbmNlKCkuam9pblN5bnRheCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgY29weShGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAg\nICAgICBzdXBlci5jb3B5KGZldGNoKTsKICAgICAgICBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGpmID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIGZldGNo\nOwogICAgICAgIHNldEVhZ2VyRmV0Y2hNb2RlKGpmLmdldEVhZ2VyRmV0Y2hN\nb2RlKCkpOwogICAgICAgIHNldFN1YmNsYXNzRmV0Y2hNb2RlKGpmLmdldFN1\nYmNsYXNzRmV0Y2hNb2RlKCkpOwogICAgICAgIHNldFJlc3VsdFNldFR5cGUo\namYuZ2V0UmVzdWx0U2V0VHlwZSgpKTsKICAgICAgICBzZXRGZXRjaERpcmVj\ndGlvbihqZi5nZXRGZXRjaERpcmVjdGlvbigpKTsKICAgICAgICBzZXRMUlNT\naXplKGpmLmdldExSU1NpemUoKSk7CiAgICAgICAgc2V0Sm9pblN5bnRheChq\nZi5nZXRKb2luU3ludGF4KCkpOwogICAgICAgIGFkZEpvaW5zKGpmLmdldEpv\naW5zKCkpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0RWFnZXJGZXRjaE1v\nZGUoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5lYWdlck1vZGU7CiAgICB9\nCgogICAgcHVibGljIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gc2V0RWFnZXJG\nZXRjaE1vZGUoaW50IG1vZGUpIHsKICAgICAgICBpZiAobW9kZSA9PSBERUZB\nVUxUKSB7CiAgICAgICAgICAgIEpEQkNDb25maWd1cmF0aW9uIGNvbmYgPSBn\nZXRKREJDQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBpZiAoY29uZiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgbW9kZSA9IGNvbmYuZ2V0RWFnZXJG\nZXRjaE1vZGVDb25zdGFudCgpOwogICAgICAgIH0KICAgICAgICBpZiAobW9k\nZSAhPSBERUZBVUxUKQogICAgICAgICAgICBfc3RhdGUuZWFnZXJNb2RlID0g\nbW9kZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldFN1YmNsYXNzRmV0Y2hNb2RlKCkgewogICAgICAgIHJldHVybiBf\nc3RhdGUuc3ViY2xhc3NNb2RlOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0\nU3ViY2xhc3NGZXRjaE1vZGUoQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAg\nIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9zdGF0ZS5z\ndWJjbGFzc01vZGU7CiAgICAgICAgaW50IG1vZGUgPSBjbHMuZ2V0U3ViY2xh\nc3NGZXRjaE1vZGUoKTsKICAgICAgICBpZiAobW9kZSA9PSBERUZBVUxUKQog\nICAgICAgICAgICByZXR1cm4gX3N0YXRlLnN1YmNsYXNzTW9kZTsKICAgICAg\nICByZXR1cm4gTWF0aC5taW4obW9kZSwgX3N0YXRlLnN1YmNsYXNzTW9kZSk7\nCiAgICB9CgogICAgcHVibGljIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gc2V0\nU3ViY2xhc3NGZXRjaE1vZGUoaW50IG1vZGUpIHsKICAgICAgICBpZiAobW9k\nZSA9PSBERUZBVUxUKSB7CiAgICAgICAgICAgIEpEQkNDb25maWd1cmF0aW9u\nIGNvbmYgPSBnZXRKREJDQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBp\nZiAoY29uZiAhPSBudWxsKQogICAgICAgICAgICAgICAgbW9kZSA9IGNvbmYu\nZ2V0U3ViY2xhc3NGZXRjaE1vZGVDb25zdGFudCgpOwogICAgICAgIH0KICAg\nICAgICBpZiAobW9kZSAhPSBERUZBVUxUKQogICAgICAgICAgICBfc3RhdGUu\nc3ViY2xhc3NNb2RlID0gbW9kZTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nIH0KCiAgICBwdWJsaWMgaW50IGdldFJlc3VsdFNldFR5cGUoKSB7CiAgICAg\nICAgcmV0dXJuIF9zdGF0ZS50eXBlOwogICAgfQoKICAgIHB1YmxpYyBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIHNldFJlc3VsdFNldFR5cGUoaW50IHR5cGUp\nIHsKICAgICAgICBpZiAodHlwZSA9PSBERUZBVUxUKSB7CiAgICAgICAgICAg\nIEpEQkNDb25maWd1cmF0aW9uIGNvbmYgPSBnZXRKREJDQ29uZmlndXJhdGlv\nbigpOwogICAgICAgICAgICBpZiAoY29uZiAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX3N0YXRlLnR5cGUgPSBjb25mLmdldFJlc3VsdFNldFR5cGVDb25z\ndGFudCgpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBfc3RhdGUudHlw\nZSA9IHR5cGU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVi\nbGljIGludCBnZXRGZXRjaERpcmVjdGlvbigpIHsKICAgICAgICByZXR1cm4g\nX3N0YXRlLmRpcmVjdGlvbjsKICAgIH0KCiAgICBwdWJsaWMgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBzZXRGZXRjaERpcmVjdGlvbihpbnQgZGlyZWN0aW9u\nKSB7CiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSBERUZBVUxUKSB7CiAgICAg\nICAgICAgIEpEQkNDb25maWd1cmF0aW9uIGNvbmYgPSBnZXRKREJDQ29uZmln\ndXJhdGlvbigpOwogICAgICAgICAgICBpZiAoY29uZiAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX3N0YXRlLmRpcmVjdGlvbiA9IGNvbmYuZ2V0RmV0Y2hE\naXJlY3Rpb25Db25zdGFudCgpOwogICAgICAgIH0gZWxzZQogICAgICAgICAg\nICBfc3RhdGUuZGlyZWN0aW9uID0gZGlyZWN0aW9uOwogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TFJTU2l6ZSgpIHsK\nICAgICAgICByZXR1cm4gX3N0YXRlLnNpemU7CiAgICB9CgogICAgcHVibGlj\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gc2V0TFJTU2l6ZShpbnQgc2l6ZSkg\newogICAgICAgIGlmIChzaXplID09IERFRkFVTFQpIHsKICAgICAgICAgICAg\nSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiA9IGdldEpEQkNDb25maWd1cmF0aW9u\nKCk7CiAgICAgICAgICAgIGlmIChjb25mICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfc3RhdGUuc2l6ZSA9IGNvbmYuZ2V0TFJTU2l6ZUNvbnN0YW50KCk7\nCiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIF9zdGF0ZS5zaXplID0gc2l6\nZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgaW50\nIGdldEpvaW5TeW50YXgoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5zeW50\nYXg7CiAgICB9CgogICAgcHVibGljIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nc2V0Sm9pblN5bnRheChpbnQgc3ludGF4KSB7CiAgICAgICAgaWYgKHN5bnRh\neCA9PSBERUZBVUxUKSB7CiAgICAgICAgICAgIEpEQkNDb25maWd1cmF0aW9u\nIGNvbmYgPSBnZXRKREJDQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBp\nZiAoY29uZiAhPSBudWxsKQogICAgICAgICAgICAgICAgX3N0YXRlLnN5bnRh\neCA9IGNvbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKS5qb2luU3ludGF4\nOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBfc3RhdGUuc3ludGF4ID0g\nc3ludGF4OwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1Ymxp\nYyBSZXN1bHRMaXN0IG5ld1Jlc3VsdExpc3QoUmVzdWx0T2JqZWN0UHJvdmlk\nZXIgcm9wKSB7CiAgICAgICAgLy8gaWYgYnVpbHQgYXJvdW5kIGEgbGlzdCwg\nanVzdCB1c2UgYSBzaW1wbGUgd3JhcHBlcgogICAgICAgIGlmIChyb3AgaW5z\ndGFuY2VvZiBMaXN0UmVzdWx0T2JqZWN0UHJvdmlkZXIpCiAgICAgICAgICAg\nIHJldHVybiBuZXcgU2ltcGxlUmVzdWx0TGlzdChyb3ApOwoKICAgICAgICAv\nLyBpZiBidWlsdCBhcm91bmQgYSBwYWdpbmcgbGlzdCwgdXNlIGEgd2luZG93\nIHByb3ZpZGVyIHdpdGggdGhlCiAgICAgICAgLy8gc2FtZSB3aW5kb3cgc2l6\nZQogICAgICAgIGlmIChyb3AgaW5zdGFuY2VvZiBQYWdpbmdSZXN1bHRPYmpl\nY3RQcm92aWRlcikKICAgICAgICAgICAgcmV0dXJuIG5ldyBXaW5kb3dSZXN1\nbHRMaXN0KHJvcCwgKChQYWdpbmdSZXN1bHRPYmplY3RQcm92aWRlcikKICAg\nICAgICAgICAgICAgIHJvcCkuZ2V0UGFnZVNpemUoKSk7CgogICAgICAgIC8v\nIGlmIGZldGNoIHNpemUgPCAwIGp1c3QgcmVhZCBpbiBhbGwgcmVzdWx0cyBp\nbW1lZGlhdGVseQogICAgICAgIGlmIChnZXRGZXRjaEJhdGNoU2l6ZSgpIDwg\nMCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBFYWdlclJlc3VsdExpc3Qocm9w\nKTsKCiAgICAgICAgLy8gaWYgZm93YXJkIG9ubHkgb3IgZm9yd2FyZCBkaXJl\nY3Rpb24gdXNlIGEgZm9yd2FyZCB3aW5kb3cKICAgICAgICBpZiAoX3N0YXRl\nLnR5cGUgPT0gUmVzdWx0U2V0LlRZUEVfRk9SV0FSRF9PTkxZCiAgICAgICAg\nICAgIHx8IF9zdGF0ZS5kaXJlY3Rpb24gPT0gUmVzdWx0U2V0LkZFVENIX0ZP\nUldBUkQKICAgICAgICAgICAgfHwgIXJvcC5zdXBwb3J0c1JhbmRvbUFjY2Vz\ncygpKSB7CiAgICAgICAgICAgIGlmIChnZXRGZXRjaEJhdGNoU2l6ZSgpID4g\nMCAmJiBnZXRGZXRjaEJhdGNoU2l6ZSgpIDw9IDUwKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBXaW5kb3dSZXN1bHRMaXN0KHJvcCwgZ2V0RmV0Y2hC\nYXRjaFNpemUoKSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgV2luZG93UmVz\ndWx0TGlzdChyb3AsIDUwKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHNr\naXBwaW5nIGFyb3VuZCB1c2UgYSBjYWNoaW5nIHJhbmRvbSBhY2Nlc3MgbGlz\ndAogICAgICAgIGlmIChfc3RhdGUuZGlyZWN0aW9uID09IFJlc3VsdFNldC5G\nRVRDSF9VTktOT1dOKQogICAgICAgICAgICByZXR1cm4gbmV3IFNvZnRSYW5k\nb21BY2Nlc3NSZXN1bHRMaXN0KHJvcCk7CgogICAgICAgIC8vIHNjcm9sbGlu\nZyByZXZlcnNlLi4uIGp1c3QgdXNlIG5vbi1jYWNoaW5nIHNpbXBsZSByZXN1\nbHQgbGlzdAogICAgICAgIHJldHVybiBuZXcgU2ltcGxlUmVzdWx0TGlzdChy\nb3ApOwogICAgfQoKICAgIHB1YmxpYyBTZXQgZ2V0Sm9pbnMoKSB7CiAgICAg\nICAgcmV0dXJuIChfc3RhdGUuam9pbnMgPT0gbnVsbCkgPyBDb2xsZWN0aW9u\ncy5FTVBUWV9TRVQgOiBfc3RhdGUuam9pbnM7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaGFzSm9pbihTdHJpbmcgZmllbGQpIHsKICAgICAgICByZXR1\ncm4gX3N0YXRlLmpvaW5zICE9IG51bGwgJiYgX3N0YXRlLmpvaW5zLmNvbnRh\naW5zKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBhZGRKb2luKFN0cmluZyBqb2luKSB7CiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkoam9pbikpCiAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLWpvaW4iKSk7CiAgICAg\nICAgCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmIChfc3RhdGUuam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9z\ndGF0ZS5qb2lucyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgIF9zdGF0\nZS5qb2lucy5hZGQoam9pbik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlz\nOwogICAgfQoKICAgIHB1YmxpYyBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGFk\nZEpvaW5zKENvbGxlY3Rpb24gam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMg\nPT0gbnVsbCB8fCBqb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gam9pbnMuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgIGFkZEpvaW4o\nKFN0cmluZykgaXRyLm5leHQoKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICB9CgogICAgcHVibGljIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gcmVtb3Zl\nSm9pbihTdHJpbmcgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5qb2lucyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX3N0YXRlLmpvaW5zLnJlbW92ZShmaWVsZCk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIHJlbW92ZUpvaW5zKENvbGxlY3Rpb24g\nam9pbnMpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKF9zdGF0ZS5qb2lucyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX3N0YXRlLmpvaW5zLnJlbW92ZUFsbChqb2lucyk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGNsZWFySm9pbnMoKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc3RhdGUuam9pbnMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5qb2lucy5jbGVhcigpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldElzb2xhdGlvbigpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlz\nb2xhdGlvbkxldmVsOwogICAgfQoKICAgIHB1YmxpYyBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIHNldElzb2xhdGlvbihpbnQgbGV2ZWwpIHsKICAgICAgICBp\nZiAobGV2ZWwgIT0gLTEgJiYgbGV2ZWwgIT0gREVGQVVMVAogICAgICAgICAg\nICAmJiBsZXZlbCAhPSBDb25uZWN0aW9uLlRSQU5TQUNUSU9OX05PTkUKICAg\nICAgICAgICAgJiYgbGV2ZWwgIT0gQ29ubmVjdGlvbi5UUkFOU0FDVElPTl9S\nRUFEX1VOQ09NTUlUVEVECiAgICAgICAgICAgICYmIGxldmVsICE9IENvbm5l\nY3Rpb24uVFJBTlNBQ1RJT05fUkVBRF9DT01NSVRURUQKICAgICAgICAgICAg\nJiYgbGV2ZWwgIT0gQ29ubmVjdGlvbi5UUkFOU0FDVElPTl9SRVBFQVRBQkxF\nX1JFQUQKICAgICAgICAgICAgJiYgbGV2ZWwgIT0gQ29ubmVjdGlvbi5UUkFO\nU0FDVElPTl9TRVJJQUxJWkFCTEUpCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oCiAgICAgICAgICAgICAgICBfbG9j\nLmdldCgiYmFkLWxldmVsIiwgbmV3IEludGVnZXIobGV2ZWwpKS5nZXRNZXNz\nYWdlKCkpOwoKICAgICAgICBpZiAobGV2ZWwgPT0gREVGQVVMVCkKICAgICAg\nICAgICAgX3N0YXRlLmlzb2xhdGlvbkxldmVsID0gLTE7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBfc3RhdGUuaXNvbGF0aW9uTGV2ZWwgPSBsZXZlbDsK\nICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiB0cmF2ZXJzZUpEQkMoRmllbGRNZXRhRGF0YSBm\nbSkgewogICAgICAgIHJldHVybiAoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikg\ndHJhdmVyc2UoZm0pOwogICAgfQoKICAgIC8qKgogICAgICogQWNjZXNzIEpE\nQkMgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbi4gTWF5IHJldHVybiBudWxs\nIGlmIG5vdCBhCiAgICAgKiBKREJDIGJhY2stZW5kIChwb3NzaWJsZSB0byBn\nZXQgYSBKREJDRmV0Y2hDb25maWd1cmF0aW9uIG9uIG5vbi1KREJDCiAgICAg\nKiBiYWNrIGVuZCBpbiByZW1vdGUgY2xpZW50KS4KICAgICAqLwogICAgcHJp\ndmF0ZSBKREJDQ29uZmlndXJhdGlvbiBnZXRKREJDQ29uZmlndXJhdGlvbigp\nIHsKICAgICAgICBTdG9yZUNvbnRleHQgY3R4ID0gZ2V0Q29udGV4dCgpOwog\nICAgICAgIGlmIChjdHggPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiA9IGN0eC5n\nZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgaWYgKCEoY29uZiBpbnN0YW5j\nZW9mIEpEQkNDb25maWd1cmF0aW9uKSkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgcmV0dXJuIChKREJDQ29uZmlndXJhdGlvbikgY29uZjsK\nICAgIH0KCiAgICBwdWJsaWMgU2V0IGdldEZldGNoSW5uZXJKb2lucygpIHsK\nICAgICAgICByZXR1cm4gKF9zdGF0ZS5mZXRjaElubmVySm9pbnMgPT0gbnVs\nbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQKICAgICAgICAgICAgOiBfc3Rh\ndGUuZmV0Y2hJbm5lckpvaW5zOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGhhc0ZldGNoSW5uZXJKb2luKFN0cmluZyBmaWVsZCkgewogICAgICAgIHJl\ndHVybiBfc3RhdGUuZmV0Y2hJbm5lckpvaW5zICE9IG51bGwgJiYKICAgICAg\nICAgICAgX3N0YXRlLmZldGNoSW5uZXJKb2lucy5jb250YWlucyhmaWVsZCk7\nCiAgICB9CgogICAgcHVibGljIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gYWRk\nRmV0Y2hJbm5lckpvaW4oU3RyaW5nIGpvaW4pIHsKICAgICAgICBpZiAoU3Ry\naW5nVXRpbHMuaXNFbXB0eShqb2luKSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm51bGwtam9pbiIpKTsKICAgICAg\nICAKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKF9zdGF0ZS5mZXRjaElubmVySm9pbnMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9zdGF0ZS5mZXRjaElubmVySm9pbnMgPSBuZXcgSGFzaFNldCgp\nOwogICAgICAgICAgICBfc3RhdGUuZmV0Y2hJbm5lckpvaW5zLmFkZChqb2lu\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVi\nbGljIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gYWRkRmV0Y2hJbm5lckpvaW5z\nKENvbGxlY3Rpb24gam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMgPT0gbnVs\nbCB8fCBqb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gam9pbnMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgIGFkZEZldGNoSW5uZXJK\nb2luKChTdHJpbmcpIGl0ci5uZXh0KCkpOwogICAgICAgIHJldHVybiB0aGlz\nOwogICAgfQp9Cg==\n","encoding":"base64"}

