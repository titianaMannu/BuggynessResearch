{"sha":"7434efde55add1e6856a44c7c6fac1d3689dc132","node_id":"MDQ6QmxvYjIwNjM2NDo3NDM0ZWZkZTU1YWRkMWU2ODU2YTQ0YzdjNmZhYzFkMzY4OWRjMTMy","size":63741,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/7434efde55add1e6856a44c7c6fac1d3689dc132","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3Rh\ndGVtZW50OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQg\namF2YS51dGlsLlNldDsKCmltcG9ydCBqYXZheC5zcWwuRGF0YVNvdXJjZTsK\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuT3JwaGFuZWRLZXlB\nY3Rpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpE\nQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuY29uZi5RdWVyeVNRTENhY2hlVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRvcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBp\nbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29s\ndW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGlj\ndGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5K\nb2luU3ludGF4ZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwu\nUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNR\nTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuU1FMRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuU2VsZWN0RXhlY3V0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuVW5pb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuTG9ja01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLlBDU3RhdGU7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2VzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TZXE7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5hZ2VyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZVF1ZXJ5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb25QYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuRGVsZWdhdGluZ0Nv\nbm5lY3Rpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMu\nRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5qZGJjLkRlbGVnYXRpbmdTdGF0ZW1lbnQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnJvcC5NZXJnZWRSZXN1bHRPYmplY3RQcm92\naWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3Vs\ndE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5GZXRjaEdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkFwcGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBs\nSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW52YWxp\nZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuT3BlbkpQQUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nU3RvcmVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAqIFN0b3JlTWFuYWdlciBwbHVnaW4g\ndGhhdCB1c2VzIEpEQkMgdG8gc3RvcmUgcGVyc2lzdGVudCBkYXRhIGluIGEK\nICogcmVsYXRpb25hbCBkYXRhIHN0b3JlLgogKgogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgSkRCQ1N0b3Jl\nTWFuYWdlciAKICAgIGltcGxlbWVudHMgU3RvcmVNYW5hZ2VyLCBKREJDU3Rv\ncmUgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9j\nID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoSkRCQ1N0b3JlTWFu\nYWdlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBTdG9yZUNvbnRleHQgX2N0eCA9\nIG51bGw7CiAgICBwcml2YXRlIEpEQkNDb25maWd1cmF0aW9uIF9jb25mID0g\nbnVsbDsKICAgIHByaXZhdGUgREJEaWN0aW9uYXJ5IF9kaWN0ID0gbnVsbDsK\nICAgIHByaXZhdGUgU1FMRmFjdG9yeSBfc3FsID0gbnVsbDsKICAgIHByaXZh\ndGUgSkRCQ0xvY2tNYW5hZ2VyIF9sbSA9IG51bGw7CiAgICBwcml2YXRlIERh\ndGFTb3VyY2UgX2RzID0gbnVsbDsKICAgIHByaXZhdGUgUmVmQ291bnRDb25u\nZWN0aW9uIF9jb25uID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfYWN0\naXZlID0gZmFsc2U7CgogICAgLy8gdHJhY2sgdGhlIHBlbmRpbmcgc3RhdGVt\nZW50cyBzbyB3ZSBjYW4gY2FuY2VsIHRoZW0KICAgIHByaXZhdGUgU2V0IF9z\ndG1udHMgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRTZXQobmV3IEhhc2hT\nZXQoKSk7CiAgICAKICAgIHByaXZhdGUgTWFwIF9zcWxDYWNoZSA9IG51bGw7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2lzUXVlcnlTUUxDYWNoZSA9IHRydWU7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgX251bGxDYWNoZVZh\nbHVlID0gbmV3IE9iamVjdCgpOwogICAgCiAgICBwdWJsaWMgU3RvcmVDb250\nZXh0IGdldENvbnRleHQoKSB7CiAgICAgICAgcmV0dXJuIF9jdHg7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0Q29udGV4dChTdG9yZUNvbnRleHQgY3R4\nKSB7CiAgICAgICAgc2V0Q29udGV4dChjdHgsIChKREJDQ29uZmlndXJhdGlv\nbikgY3R4LmdldENvbmZpZ3VyYXRpb24oKSk7CiAgICB9CiAgICAKICAgIHB1\nYmxpYyB2b2lkIHNldENvbnRleHQoU3RvcmVDb250ZXh0IGN0eCwgSkRCQ0Nv\nbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jdHggPSBjdHg7CiAgICAg\nICAgX2NvbmYgPSBjb25mOwogICAgICAgIF9kaWN0ID0gX2NvbmYuZ2V0REJE\naWN0aW9uYXJ5SW5zdGFuY2UoKTsKICAgICAgICBfc3FsID0gX2NvbmYuZ2V0\nU1FMRmFjdG9yeUluc3RhbmNlKCk7CgogICAgICAgIExvY2tNYW5hZ2VyIGxt\nID0gY3R4LmdldExvY2tNYW5hZ2VyKCk7CiAgICAgICAgaWYgKGxtIGluc3Rh\nbmNlb2YgSkRCQ0xvY2tNYW5hZ2VyKQogICAgICAgICAgICBfbG0gPSAoSkRC\nQ0xvY2tNYW5hZ2VyKSBsbTsKCiAgICAgICAgaWYgKCFjdHguaXNNYW5hZ2Vk\nKCkgJiYgX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2VkKCkp\nCiAgICAgICAgICAgIF9kcyA9IF9jb25mLmdldERhdGFTb3VyY2UyKGN0eCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBfZHMgPSBfY29uZi5nZXREYXRh\nU291cmNlKGN0eCk7CgogICAgICAgIGlmIChfY29uZi5nZXRVcGRhdGVNYW5h\nZ2VySW5zdGFuY2UoKS5vcmRlckRpcnR5KCkpCiAgICAgICAgICAgIGN0eC5z\nZXRPcmRlckRpcnR5T2JqZWN0cyh0cnVlKTsKICAgICAgICAKICAgICAgICBf\nc3FsQ2FjaGUgPSBfY29uZi5nZXRRdWVyeVNRTENhY2hlSW5zdGFuY2UoKTsK\nICAgICAgICBfaXNRdWVyeVNRTENhY2hlID0gX2NvbmYuaXNRdWVyeVNRTENh\nY2hlT24oKTsKICAgIH0KCiAgICBwdWJsaWMgSkRCQ0NvbmZpZ3VyYXRpb24g\nZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAg\nICB9CgogICAgcHVibGljIERCRGljdGlvbmFyeSBnZXREQkRpY3Rpb25hcnko\nKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0OwogICAgfQoKICAgIHB1YmxpYyBT\nUUxGYWN0b3J5IGdldFNRTEZhY3RvcnkoKSB7CiAgICAgICAgcmV0dXJuIF9z\ncWw7CiAgICB9CgogICAgcHVibGljIEpEQkNMb2NrTWFuYWdlciBnZXRMb2Nr\nTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gX2xtOwogICAgfQoKICAgIHB1\nYmxpYyBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGdldEZldGNoQ29uZmlndXJh\ndGlvbigpIHsKICAgICAgICByZXR1cm4gKEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24pIF9jdHguZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgYmVnaW5PcHRpbWlzdGljKCkgewogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHJvbGxiYWNrT3B0aW1pc3RpYygpIHsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBiZWdpbigpIHsKICAgICAgICBfYWN0aXZlID0gdHJ1ZTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKCFfY3R4LmlzTWFuYWdl\nZCgpIHx8ICFfY29uZi5pc0Nvbm5lY3Rpb25GYWN0b3J5TW9kZU1hbmFnZWQo\nKSkKICAgICAgICAgICAgICAgICYmIF9jb25uLmdldEF1dG9Db21taXQoKSkK\nICAgICAgICAgICAgICAgIF9jb25uLnNldEF1dG9Db21taXQoZmFsc2UpOwog\nICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAg\nICBfYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2Vw\ndGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgY29tbWl0KCkgewogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmICghX2N0eC5pc01hbmFnZWQoKSB8fCAhX2NvbmYuaXNDb25u\nZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2VkKCkpCiAgICAgICAgICAgICAgICBf\nY29ubi5jb21taXQoKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9jb25u\nLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZTIpIHsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBTUUxF\neGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgX2FjdGl2ZSA9IGZhbHNlOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFjaygpIHsKICAgICAgICAv\nLyBhbHJlYWR5IHJvbGxlZCBiYWNrIG91cnNlbHZlcz8KICAgICAgICBpZiAo\nIV9hY3RpdmUpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKF9jb25uICE9IG51bGwKICAgICAgICAgICAgICAg\nICYmICghX2N0eC5pc01hbmFnZWQoKSB8fCAhX2NvbmYKICAgICAgICAgICAg\nICAgICAgICAuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2VkKCkpKQog\nICAgICAgICAgICAgICAgX2Nvbm4ucm9sbGJhY2soKTsKICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FM\nRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIF9hY3RpdmUgPSBmYWxzZTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgcmV0YWluQ29ubmVjdGlvbigpIHsK\nICAgICAgICBjb25uZWN0KGZhbHNlKTsKICAgICAgICBfY29ubi5zZXRSZXRh\naW4odHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVsZWFzZUNvbm5l\nY3Rpb24oKSB7CiAgICAgICAgaWYgKF9jb25uICE9IG51bGwpCiAgICAgICAg\nICAgIF9jb25uLnNldFJldGFpbihmYWxzZSk7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBnZXRDbGllbnRDb25uZWN0aW9uKCkgewogICAgICAgIHJldHVy\nbiBuZXcgQ2xpZW50Q29ubmVjdGlvbihnZXRDb25uZWN0aW9uKCkpOwogICAg\nfQoKICAgIHB1YmxpYyBDb25uZWN0aW9uIGdldENvbm5lY3Rpb24oKSB7CiAg\nICAgICAgY29ubmVjdCh0cnVlKTsKICAgICAgICByZXR1cm4gX2Nvbm47CiAg\nICB9CiAgICAKICAgIHByb3RlY3RlZCBEYXRhU291cmNlIGdldERhdGFTb3Vy\nY2UoKSB7CiAgICAJcmV0dXJuIF9kczsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBleGlzdHMoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgT2JqZWN0IGNv\nbnRleHQpIHsKICAgICAgICAvLyBhZGQgd2hlcmUgY29uZGl0aW9ucyBvbiBi\nYXNlIGNsYXNzIHRvIGF2b2lkIGpvaW5zIGlmIHN1YmNsYXNzCiAgICAgICAg\nLy8gZG9lc24ndCB1c2Ugb2lkIGFzIGlkZW50aWZpZXIKICAgICAgICBDbGFz\nc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNtLmdldE1ldGFE\nYXRhKCk7CiAgICAgICAgcmV0dXJuIGV4aXN0cyhtYXBwaW5nLCBzbS5nZXRP\nYmplY3RJZCgpLCBjb250ZXh0KTsKICAgIH0KCiAgICBwcml2YXRlIGJvb2xl\nYW4gZXhpc3RzKENsYXNzTWFwcGluZyBtYXBwaW5nLCBPYmplY3Qgb2lkLCBP\nYmplY3QgY29udGV4dCkgewogICAgICAgIC8vIGFkZCB3aGVyZSBjb25kaXRp\nb25zIG9uIGJhc2UgY2xhc3MgdG8gYXZvaWQgam9pbnMgaWYgc3ViY2xhc3MK\nICAgICAgICAvLyBkb2Vzbid0IHVzZSBvaWQgYXMgaWRlbnRpZmllcgogICAg\nICAgIFNlbGVjdCBzZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwogICAgICAgIHdo\naWxlIChtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygp\nICE9IG51bGwpCiAgICAgICAgICAgIG1hcHBpbmcgPSBtYXBwaW5nLmdldEpv\naW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwoKICAgICAgICBzZWwud2hl\ncmVQcmltYXJ5S2V5KG9pZCwgbWFwcGluZywgdGhpcyk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcmV0dXJuIHNlbC5nZXRDb3VudCh0aGlzKSAhPSAw\nOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN5bmNWZXJz\naW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIE9iamVjdCBjb250ZXh0KSB7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5n\nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJldHVybiBtYXBwaW5nLmdldFZlcnNpb24oKS5jaGVja1ZlcnNpb24oc20s\nIHRoaXMsIHRydWUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBz\nZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3Jl\nKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBpbnQg\nY29tcGFyZVZlcnNpb24oT3BlbkpQQVN0YXRlTWFuYWdlciBzdGF0ZSwgT2Jq\nZWN0IHYxLCBPYmplY3QgdjIpIHsKICAgICAgICBDbGFzc01hcHBpbmcgbWFw\ncGluZyA9IChDbGFzc01hcHBpbmcpIHN0YXRlLmdldE1ldGFEYXRhKCk7CiAg\nICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmNvbXBhcmVWZXJz\naW9uKHYxLCB2Mik7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaW5pdGlh\nbGl6ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBQQ1N0YXRlIHN0YXRlLAog\nICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGNvbnRl\neHQpIHsKICAgICAgICBDb25uZWN0aW9uSW5mbyBpbmZvID0gKENvbm5lY3Rp\nb25JbmZvKSBjb250ZXh0OwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ndHVybiBpbml0aWFsaXplU3RhdGUoc20sIHN0YXRlLCAoSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbikgZmV0Y2gsIAogICAgICAgICAgICAgICAgaW5mbyk7CiAg\nICAgICAgfSBjYXRjaCAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiBjbmZlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKGNuZmUpOwog\nICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAg\nICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBhIG5l\nd2x5LWxvYWRlZCBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJv\nb2xlYW4gaW5pdGlhbGl6ZVN0YXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIFBDU3RhdGUgc3RhdGUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgQ29ubmVjdGlvbkluZm8gaW5mbykKICAgICAgICB0aHJvd3Mg\nQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBPYmplY3Qgb2lkID0gc20uZ2V0T2JqZWN0SWQoKTsKICAgICAgICBDbGFz\nc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNtLmdldE1ldGFE\nYXRhKCk7CiAgICAgICAgUmVzdWx0IHJlcyA9IG51bGw7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKGluZm8gIT0gbnVsbCAmJiBpbmZvLnJlc3Vs\ndCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXMgPSBpbmZvLnJlc3Vs\ndDsKICAgICAgICAgICAgICAgIGluZm8uc20gPSBzbTsKICAgICAgICAgICAg\nICAgIGlmIChpbmZvLm1hcHBpbmcgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBpbmZvLm1hcHBpbmcgPSBtYXBwaW5nOwogICAgICAgICAgICAgICAg\nbWFwcGluZyA9IGluZm8ubWFwcGluZzsKICAgICAgICAgICAgfSBlbHNlIGlm\nIChvaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQKICAgICAgICAgICAgICAgICYm\nICEoKE9wZW5KUEFJZCkgb2lkKS5oYXNTdWJjbGFzc2VzKCkpIHsKICAgICAg\nICAgICAgICAgIEJvb2xlYW4gY3VzdG9tID0gY3VzdG9tTG9hZChzbSwgbWFw\ncGluZywgc3RhdGUsIGZldGNoKTsKICAgICAgICAgICAgICAgIGlmIChjdXN0\nb20gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VzdG9t\nLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgICAgICAgICAgcmVzID0gZ2V0SW5p\ndGlhbGl6ZVN0YXRlUmVzdWx0KHNtLCBtYXBwaW5nLCBmZXRjaCwKICAgICAg\nICAgICAgICAgICAgICBTZWxlY3QuU1VCU19FWEFDVCk7CiAgICAgICAgICAg\nICAgICBpZiAocmVzID09IG51bGwgJiYgIXNlbGVjdFByaW1hcnlLZXkoc20s\nIG1hcHBpbmcsIGZldGNoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoaXNFbXB0eVJlc3VsdChyZXMp\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIENsYXNzTWFwcGluZ1tdIG1h\ncHBpbmdzID0gbWFwcGluZy4KICAgICAgICAgICAgICAgICAgICBnZXRJbmRl\ncGVuZGVudEFzc2lnbmFibGVNYXBwaW5ncygpOwogICAgICAgICAgICAgICAg\naWYgKG1hcHBpbmdzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAg\nICAgbWFwcGluZyA9IG1hcHBpbmdzWzBdOwogICAgICAgICAgICAgICAgICAg\nIEJvb2xlYW4gY3VzdG9tID0gY3VzdG9tTG9hZChzbSwgbWFwcGluZywgc3Rh\ndGUsIGZldGNoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VzdG9tICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXN0b20u\nYm9vbGVhblZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgcmVzID0gZ2V0\nSW5pdGlhbGl6ZVN0YXRlUmVzdWx0KHNtLCBtYXBwaW5nLCBmZXRjaCwKICAg\nICAgICAgICAgICAgICAgICAgICAgU2VsZWN0LlNVQlNfQU5ZX0pPSU5BQkxF\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzID09IG51bGwgJiYgIXNl\nbGVjdFByaW1hcnlLZXkoc20sIG1hcHBpbmcsIGZldGNoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgcmVzID0gZ2V0SW5pdGlhbGl6\nZVN0YXRlVW5pb25SZXN1bHQoc20sIG1hcHBpbmcsIG1hcHBpbmdzLAogICAg\nICAgICAgICAgICAgICAgICAgICBmZXRjaCk7CiAgICAgICAgICAgICAgICBp\nZiAoaXNFbXB0eVJlc3VsdChyZXMpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZmln\ndXJlIG91dCB3aGF0IHR5cGUgb2Ygb2JqZWN0IHRoaXMgaXM7IHRoZSBzdGF0\nZSBtYW5hZ2VyCiAgICAgICAgICAgIC8vIG9ubHkgZ3VhcmFudGVlcyB0byBw\ncm92aWRlIGEgYmFzZSBjbGFzcwogICAgICAgICAgICBDbGFzcyB0eXBlOwog\nICAgICAgICAgICBpZiAoKHR5cGUgPSBnZXRUeXBlKHJlcywgbWFwcGluZykp\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChyZXMuZ2V0QmFzZU1h\ncHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIG1hcHBpbmcg\nPSByZXMuZ2V0QmFzZU1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIHJlcy5z\ndGFydERhdGFSZXF1ZXN0KG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpKTsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdHlw\nZSA9IG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpLmdldENsYXNzKHRoaXMs\nIG1hcHBpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyk7CiAgICAg\nICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIHJl\ncy5lbmREYXRhUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBpbml0aWFsaXplIHRoZSBzdGF0ZSBt\nYW5hZ2VyOyB0aGlzIG1heSBjaGFuZ2UgdGhlIG1hcHBpbmcKICAgICAgICAg\nICAgLy8gYW5kIHRoZSBvYmplY3QgaWQgaW5zdGFuY2UgaWYgdGhlIHR5cGUg\nYXMgZGV0ZXJtaW5lZAogICAgICAgICAgICAvLyBmcm9tIHRoZSBpbmRpY2F0\nb3IgaXMgYSBzdWJjbGFzcyBvZiBleHBlY3RlZCB0eXBlCiAgICAgICAgICAg\nIHNtLmluaXRpYWxpemUodHlwZSwgc3RhdGUpOwoKICAgICAgICAgICAgaWYg\nKGluZm8gIT0gbnVsbCAmJiBpbmZvLnJlc3VsdCAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBGaWVsZE1hcHBpbmcgbWFwcGVkQnlGaWVsZE1hcHBpbmcg\nPSBpbmZvLnJlc3VsdC4KICAgICAgICAgICAgICAgICAgICBnZXRNYXBwZWRC\neUZpZWxkTWFwcGluZygpOwogICAgICAgICAgICAgICAgT2JqZWN0IG1hcHBl\nZEJ5T2JqZWN0ID0gaW5mby5yZXN1bHQuZ2V0TWFwcGVkQnlWYWx1ZSgpOwog\nICAgICAgICAgICAgICAgaWYgKG1hcHBlZEJ5RmllbGRNYXBwaW5nICE9IG51\nbGwgJiYgbWFwcGVkQnlPYmplY3QgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBzZXRNYXBwZWRCeShzbSwgbWFwcGVkQnlGaWVsZE1hcHBpbmcsIG1h\ncHBlZEJ5T2JqZWN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBs\nb2FkIHRoZSBzZWxlY3RlZCBtYXBwaW5ncyBpbnRvIHRoZSBnaXZlbiBzdGF0\nZSBtYW5hZ2VyCiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgLy8gcmUtZ2V0IHRoZSBtYXBwaW5nIGluIGNhc2UgdGhl\nIGluc3RhbmNlIHdhcyBhIHN1YmNsYXNzCiAgICAgICAgICAgICAgICBtYXBw\naW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURhdGEoKTsKICAgICAg\nICAgICAgICAgIGxvYWQobWFwcGluZywgc20sIGZldGNoLCByZXMpOwogICAg\nICAgICAgICAgICAgZ2V0VmVyc2lvbihtYXBwaW5nLCBzbSwgcmVzKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAocmVzICE9IG51bGwgJiYgKGlu\nZm8gPT0gbnVsbCB8fCByZXMgIT0gaW5mby5yZXN1bHQpKQogICAgICAgICAg\nICAgICAgcmVzLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByb3Rl\nY3RlZCB2b2lkIHNldE1hcHBlZEJ5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nCiAgICAgICAgRmllbGRNYXBwaW5nIG1hcHBlZEJ5RmllbGRNYXBwaW5nLCBP\nYmplY3QgbWFwcGVkQnlPYmplY3QpIHsKICAgICAgICBDbGFzc01hcHBpbmcg\nbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAg\nICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0gbWFwcGluZy5nZXREZWNsYXJl\nZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZm1zW2ldID09\nIG1hcHBlZEJ5RmllbGRNYXBwaW5nKSB7CiAgICAgICAgICAgICAgICBzbS5z\ndG9yZU9iamVjdChmbXNbaV0uZ2V0SW5kZXgoKSwgbWFwcGVkQnlPYmplY3Qp\nOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8g\ncHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAog\nICAgICogaW1wbGVtZW50YXRpb24gb2YgZ2V0dGluZyB2ZXJzaW9uIGZyb20g\ndGhlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGdl\ndFZlcnNpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sCiAgICAgICAgUmVzdWx0IHJlcykgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgbWFwcGluZy5nZXRWZXJzaW9uKCkuYWZ0ZXJMb2Fk\nKHNtLCB0aGlzKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1l\ndGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBK\nREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBjaGVja2luZyB3\naGV0aGVyIHRoZSByZXN1bHQgc2V0IGlzIGVtcHR5IG9yIG5vdC4KICAgICAq\nLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNFbXB0eVJlc3VsdChSZXN1bHQg\ncmVzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAocmVzICE9\nIG51bGwgJiYgIXJlcy5uZXh0KCkpCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBu\nb24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBv\nZiBnZXR0aW5nIHR5cGUgZnJvbSB0aGUgcmVzdWx0IHNldC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIENsYXNzIGdldFR5cGUoUmVzdWx0IHJlcywgQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcpewogICAgICAgIGlmIChyZXMgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0RGVzY3JpYmVkVHlwZSgpOwog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQWxs\nb3cgdGhlIG1hcHBpbmcgdG8gY3VzdG9tIGxvYWQgZGF0YS4gUmV0dXJuIG51\nbGwgaWYgdGhlIG1hcHBpbmcKICAgICAqIGRvZXMgbm90IHVzZSBjdXN0b20g\nbG9hZGluZy4KICAgICAqLwogICAgcHJpdmF0ZSBCb29sZWFuIGN1c3RvbUxv\nYWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsCiAgICAgICAgUENTdGF0ZSBzdGF0ZSwgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCkKICAgICAgICB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2Vw\ndGlvbiwgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBjaGVjayB0byBzZWUg\naWYgdGhlIG1hcHBpbmcgdGFrZXMgY2FyZSBvZiBpbml0aWFsaXphdGlvbgog\nICAgICAgIGlmICghbWFwcGluZy5jdXN0b21Mb2FkKHNtLCB0aGlzLCBzdGF0\nZSwgZmV0Y2gpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBp\nZiAoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkgIT0gbnVsbCkgewogICAgICAg\nICAgICBtYXBwaW5nLmdldFZlcnNpb24oKS5hZnRlckxvYWQoc20sIHRoaXMp\nOwogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNlbGVjdCB0aGUgZGF0YSBmb3IgdGhlIGdpdmVuIGluc3RhbmNl\nIGFuZCByZXR1cm4gdGhlIHJlc3VsdC4gUmV0dXJuCiAgICAgKiBudWxsIGlm\nIHRoZXJlIGlzIG5vIGRhdGEgaW4gdGhlIGN1cnJlbnQgZmV0Y2ggZ3JvdXBz\nIHRvIHNlbGVjdC4KICAgICAqLwogICAgcHJpdmF0ZSBSZXN1bHQgZ2V0SW5p\ndGlhbGl6ZVN0YXRlUmVzdWx0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAg\nICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIGludCBzdWJzKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIExpc3QgcGFyYW1zID0gbmV3IEFycmF5TGlzdCgp\nOwogICAgICAgIFNlbGVjdCBzZWwgPSBuZXdTZWxlY3Qoc20sIG1hcHBpbmcs\nIGZldGNoLCBzdWJzLCBwYXJhbXMpOwogICAgICAgIGlmIChzZWwgPT0gbnVs\nbCkgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIHNlbC5leGVjdXRlKHRo\naXMsIGZldGNoLCBwYXJhbXMpOwogICAgfQoKICAgIHByaXZhdGUgU2VsZWN0\nIG5ld1NlbGVjdChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIENs\nYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLCBpbnQgc3VicywKICAgICAgICBMaXN0IHBhcmFtcykgewogICAgICAg\nIGlmICghX2lzUXVlcnlTUUxDYWNoZSkgCiAgICAgICAgICAgIHJldHVybiBu\nZXdTZWxlY3Qoc20sIG1hcHBpbmcsIGZldGNoLCBzdWJzKTsgICAgICAgCiAg\nICAgICAgICAgCiAgICAgICAgTWFwPFNlbGVjdEtleSwgU2VsZWN0PiBzZWxl\nY3RJbXBsQ2FjaGVNYXAgPSAKICAgICAgICAgICAgZ2V0Q2FjaGVNYXBGcm9t\nUXVlcnlTUUxDYWNoZShKREJDU3RvcmVNYW5hZ2VyLmNsYXNzKTsKICAgICAg\nICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoQ2xvbmUgPSBuZXcgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbkltcGwoKTsKICAgICAgICBmZXRjaENsb25l\nLmNvcHkoZmV0Y2gpOwogICAgICAgIFNlbGVjdEtleSBzZWxLZXkgPSBuZXcg\nU2VsZWN0S2V5KG1hcHBpbmcsIG51bGwsIGZldGNoQ2xvbmUpOwogICAgICAg\nIFNlbGVjdCBzZWwgPSBudWxsOwogICAgICAgIGJvb2xlYW4gZm91bmQgPSB0\ncnVlOwogICAgICAgIE9iamVjdCBvYmogPSBzZWxlY3RJbXBsQ2FjaGVNYXAu\nZ2V0KHNlbEtleSk7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKSB7CiAgICAg\nICAgICAgIHN5bmNocm9uaXplZCAoc2VsZWN0SW1wbENhY2hlTWFwKSB7CiAg\nICAgICAgICAgICAgICBvYmogPSBzZWxlY3RJbXBsQ2FjaGVNYXAuZ2V0KHNl\nbEtleSk7CiAgICAgICAgICAgICAgICBpZiAob2JqID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAvLyBOb3QgZm91bmQgaW4gY2FjaGUsIGNyZWF0\nZSBhIG5ldyBzZWxlY3QKICAgICAgICAgICAgICAgICAgICBvYmogPSBuZXdT\nZWxlY3Qoc20sIG1hcHBpbmcsIGZldGNoLCBzdWJzKTsKICAgICAgICAgICAg\nICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGdlbmVyYXRl\nZCBTZWxlY3RJbXBsIGlzIG51bGwsIHN0b3JlIGEgZ2VuZXJpYwogICAgICAg\nICAgICAgICAgICAgIC8vIGtub3duIG9iamVjdCBpbiB0aGUgY2FjaGUgYXMg\nYSBwbGFjZWhvbGRlci4gU29tZSBtYXAgCiAgICAgICAgICAgICAgICAgICAg\nLy8gaW1wbGVtZW50YXRpb25zIGRvIG5vdCBhbGxvdyBudWxsIHZhbHVlcy4K\nICAgICAgICAgICAgICAgICAgICBvYmogPSBfbnVsbENhY2hlVmFsdWU7CiAg\nICAgICAgICAgICAgICAgICAgZm91bmQgPSBmYWxzZTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG9iaiAhPSBfbnVsbENh\nY2hlVmFsdWUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAg\nICAgc2VsID0gKFNlbGVjdClvYmo7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKHNlbC5nZXRTUUwoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHNlbC5zZXRTUUwodGhpcywgZmV0Y2gpOwogICAgICAgICAgICAgICAg\nICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghZm91bmQp\nIHsKICAgICAgICAgICAgICAgICAgICBhZGRUb1NxbENhY2hlKHNlbGVjdElt\ncGxDYWNoZU1hcCwgc2VsS2V5LCBvYmopOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAob2JqICE9IG51\nbGwgJiYgb2JqICE9IF9udWxsQ2FjaGVWYWx1ZSkKICAgICAgICAgICAgc2Vs\nID0gKFNlbGVjdCkgb2JqOwoKICAgICAgICBMb2cgbG9nID0gX2NvbmYuZ2V0\nTG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsKICAgICAgICBpZiAo\nbG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgaWYgKCFmb3Vu\nZCkKICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiY2FjaGUt\nbWlzc2VkIiwgbWFwcGluZywgdGhpcy5nZXRDbGFzcygpKSk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgi\nY2FjaGUtaGl0IiwgbWFwcGluZywgdGhpcy5nZXRDbGFzcygpKSk7CiAgICAg\nICAgfQoKICAgICAgICBpZiAoc2VsID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIAogICAgICAgIE9iamVjdCBvaWQgPSBzbS5n\nZXRPYmplY3RJZCgpOwogICAgICAgIENvbHVtbltdIGNvbHMgPSBtYXBwaW5n\nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgc2VsLndoZXJlUHJp\nbWFyeUtleShtYXBwaW5nLCBjb2xzLCBjb2xzLCBvaWQsIHRoaXMsIAogICAg\nICAgIAludWxsLCBudWxsLCBwYXJhbXMpOwogICAgICAgIHJldHVybiBzZWw7\nCiAgICB9CgogICAgcHJvdGVjdGVkIFNlbGVjdCBuZXdTZWxlY3QoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGlu\nZywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IHN1YnMpIHsK\nICAgICAgICBTZWxlY3Qgc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAgICAg\nICBpZiAoIXNlbGVjdChzZWwsIG1hcHBpbmcsIHN1YnMsIHNtLCBudWxsLCBm\nZXRjaCwKICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdF\nUl9KT0lOLCB0cnVlLCBmYWxzZSkpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIHNlbC53aGVyZVByaW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQo\nKSwgbWFwcGluZywgdGhpcyk7CiAgICAgICAgc2VsLnNldEV4cGVjdGVkUmVz\ndWx0Q291bnQoMSwgZmFsc2UpOwogICAgICAgIHJldHVybiBzZWw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZWxlY3QgYSB1bmlvbiBvZiB0aGUgZGF0YSBm\nb3IgdGhlIGdpdmVuIGluc3RhbmNlIGZyb20gcG9zc2libGUgY29uY3JldGUK\nICAgICAqIG1hcHBpbmdzIGFuZCByZXR1cm4gdGhlIHJlc3VsdC4KICAgICAq\nLwogICAgcHJpdmF0ZSBSZXN1bHQgZ2V0SW5pdGlhbGl6ZVN0YXRlVW5pb25S\nZXN1bHQoZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBD\nbGFzc01hcHBpbmcgbWFwcGluZywgZmluYWwgQ2xhc3NNYXBwaW5nW10gbWFw\ncGluZ3MsCiAgICAgICAgZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwgSkRC\nQ1N0b3JlTWFuYWdlciBzdG9yZSA9IHRoaXM7CiAgICAgICAgZmluYWwgaW50\nIGVhZ2VyID0gTWF0aC5taW4oZmV0Y2guZ2V0RWFnZXJGZXRjaE1vZGUoKSwK\nICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lO\nKTsKCiAgICAgICAgVW5pb24gdW5pb24gPSBfc3FsLm5ld1VuaW9uKG1hcHBp\nbmdzLmxlbmd0aCk7CiAgICAgICAgdW5pb24uc2V0RXhwZWN0ZWRSZXN1bHRD\nb3VudCgxLCBmYWxzZSk7CiAgICAgICAgaWYgKGZldGNoLmdldFN1YmNsYXNz\nRmV0Y2hNb2RlKG1hcHBpbmcpICE9IGZldGNoLkVBR0VSX0pPSU4pCiAgICAg\nICAgICAgIHVuaW9uLmFib3J0VW5pb24oKTsKICAgICAgICB1bmlvbi5zZWxl\nY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50IGkpIHsKICAgICAgICAgICAg\nICAgIHNlbC5zZWxlY3QobWFwcGluZ3NbaV0sIFNlbGVjdC5TVUJTX0FOWV9K\nT0lOQUJMRSwgc3RvcmUsIGZldGNoLAogICAgICAgICAgICAgICAgICAgIGVh\nZ2VyKTsKICAgICAgICAgICAgICAgIHNlbC53aGVyZVByaW1hcnlLZXkoc20u\nZ2V0T2JqZWN0SWQoKSwgbWFwcGluZ3NbaV0sIHN0b3JlKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB1bmlvbi5leGVjdXRl\nKHRoaXMsIGZldGNoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCBw\ncmltYXJ5IGtleSBkYXRhIHRvIG1ha2Ugc3VyZSB0aGUgZ2l2ZW4gaW5zdGFu\nY2UgZXhpc3RzLCBsb2NraW5nCiAgICAgKiBpZiBuZWVkZWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiBzZWxlY3RQcmltYXJ5S2V5KE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcs\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gc2VsZWN0IHBrcyBmcm9tIGJh\nc2UgY2xhc3MgcmVjb3JkIHRvIGVuc3VyZSBpdCBleGlzdHMgYW5kIGxvY2sK\nICAgICAgICAvLyBpdCBpZiBuZWVkZWQKICAgICAgICBDbGFzc01hcHBpbmcg\nYmFzZSA9IG1hcHBpbmc7CiAgICAgICAgd2hpbGUgKGJhc2UuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAg\nYmFzZSA9IGJhc2UuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7\nCgogICAgICAgIFNlbGVjdCBzZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwogICAg\nICAgIHNlbC5zZWxlY3QoYmFzZS5nZXRQcmltYXJ5S2V5Q29sdW1ucygpKTsK\nICAgICAgICBzZWwud2hlcmVQcmltYXJ5S2V5KHNtLmdldE9iamVjdElkKCks\nIGJhc2UsIHRoaXMpOwogICAgICAgIFJlc3VsdCBleGlzdHMgPSBzZWwuZXhl\nY3V0ZSh0aGlzLCBmZXRjaCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKGlzRW1wdHlSZXN1bHQoZXhpc3RzKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIHJlY29yZCBsb2NrZWQ/CiAg\nICAgICAgICAgIGlmIChfYWN0aXZlICYmIF9sbSAhPSBudWxsICYmIGV4aXN0\ncy5pc0xvY2tpbmcoKSkKICAgICAgICAgICAgICAgIF9sbS5sb2FkZWRGb3JV\ncGRhdGUoc20pOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBleGlzdHMuY2xvc2UoKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gbG9hZChPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvY2tMZXZlbCwgT2JqZWN0IGNvbnRl\neHQpIHsKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGpmZXRjaCA9\nIChKREJDRmV0Y2hDb25maWd1cmF0aW9uKSBmZXRjaDsKCiAgICAgICAgLy8g\nZ2V0IGEgY29ubmVjdGlvbiwgb3IgcmV1c2UgY3VycmVudCBvbmUKICAgICAg\nICBDb25uZWN0aW9uSW5mbyBpbmZvID0gKENvbm5lY3Rpb25JbmZvKSBjb250\nZXh0OwogICAgICAgIFJlc3VsdCByZXMgPSBudWxsOwogICAgICAgIGlmIChp\nbmZvICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgaW5pdGlhbGl6ZSgp\nIGZhaWxzIHRvIGxvYWQgcmVxdWlyZWQgZmllbGRzLCB0aGVuIHRoaXMgbWV0\naG9kCiAgICAgICAgICAgIC8vIGlzIGNhbGxlZDsgbWFrZSBzdXJlIG5vdCB0\nbyB0cnkgdG8gdXNlIHRoZSBnaXZlbiByZXN1bHQgaWYgaXQncwogICAgICAg\nICAgICAvLyB0aGUgc2FtZSBvbmUgd2UganVzdCBmYWlsZWQgdG8gY29tcGxl\ndGVseSBpbml0aWFsaXplKCkgd2l0aAogICAgICAgICAgICBpZiAoaW5mby5z\nbSAhPSBzbSkKICAgICAgICAgICAgICAgIHJlcyA9IGluZm8ucmVzdWx0Owog\nICAgICAgICAgICBpbmZvLnNtID0gbnVsbDsKICAgICAgICB9CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhbiBleGlzdGluZyBy\nZXN1bHQsIGxvYWQgYWxsIHdlIGNhbiBmcm9tIGl0CiAgICAgICAgICAgIENs\nYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0\nYURhdGEoKTsKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBsb2FkKG1hcHBpbmcsIHNtLCBqZmV0Y2gsIHJlcyk7CiAg\nICAgICAgICAgICAgICByZW1vdmVMb2FkZWRGaWVsZHMoc20sIGZpZWxkcyk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHRoZSBpbnN0YW5j\nZSBpcyBob2xsb3cgYW5kIHRoZXJlJ3MgYSBjdXN0b21pemVkCiAgICAgICAg\nICAgIC8vIGdldCBieSBpZCBtZXRob2QsIHVzZSBpdAogICAgICAgICAgICBp\nZiAoc20uZ2V0TG9hZGVkKCkubGVuZ3RoKCkgPT0gMCAKICAgICAgICAgICAg\nICAgICYmIG1hcHBpbmcuY3VzdG9tTG9hZChzbSwgdGhpcywgbnVsbCwgamZl\ndGNoKSkKICAgICAgICAgICAgICAgIHJlbW92ZUxvYWRlZEZpZWxkcyhzbSwg\nZmllbGRzKTsKCiAgICAgICAgICAgIC8vIyMjIHNlbGVjdCBpcyBraW5kIG9m\nIGEgYmlnIG9iamVjdCwgYW5kIGluIHNvbWUgY2FzZXMgd2UgZG9uJ3QKICAg\nICAgICAgICAgLy8jIyMgdXNlIGl0Li4uIHdvdWxkIGl0IGJlIHdvcnRoIGl0\nIHRvIGhhdmUgYSBzbWFsbCBzaGVsbCBzZWxlY3QKICAgICAgICAgICAgLy8j\nIyMgb2JqZWN0IHRoYXQgb25seSBjcmVhdGVzIGEgcmVhbCBzZWxlY3Qgd2hl\nbiBhY3R1YWxseSB1c2VkPwoKICAgICAgICAgICAgU2VsZWN0IHNlbCA9IF9z\ncWwubmV3U2VsZWN0KCk7CiAgICAgICAgICAgIGlmIChzZWxlY3Qoc2VsLCBt\nYXBwaW5nLCBTZWxlY3QuU1VCU19FWEFDVCwgc20sIGZpZWxkcywgamZldGNo\nLAogICAgICAgICAgICAgICAgRWFnZXJGZXRjaE1vZGVzLkVBR0VSX0pPSU4s\nIHRydWUsIGZhbHNlKSkgewogICAgICAgICAgICAgICAgc2VsLndoZXJlUHJp\nbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBwaW5nLCB0aGlzKTsKICAg\nICAgICAgICAgICAgIHJlcyA9IHNlbC5leGVjdXRlKHRoaXMsIGpmZXRjaCwg\nbG9ja0xldmVsKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgCWlmIChpc0VtcHR5UmVzdWx0KHJlcykpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBs\nb2FkKG1hcHBpbmcsIHNtLCBqZmV0Y2gsIHJlcyk7CiAgICAgICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIHJlcy5jbG9zZSgp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBub3cgYWxsb3cgdGhlIGZpZWxkcyB0byBsb2FkIHRoZW1zZWx2ZXMg\naW5kaXZpZHVhbGx5IHRvbwogICAgICAgICAgICBGaWVsZE1hcHBpbmdbXSBm\nbXMgPSBtYXBwaW5nLmdldEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICBpZiAoZmllbGRzLmdldChpKSAmJiAhc20uZ2V0TG9hZGVkKCku\nZ2V0KGkpKQogICAgICAgICAgICAgICAgICAgIGZtc1tpXS5sb2FkKHNtLCB0\naGlzLCBqZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tpXSkpOwogICAgICAgICAg\nICBtYXBwaW5nLmdldFZlcnNpb24oKS5hZnRlckxvYWQoc20sIHRoaXMpOwog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChDbGFz\nc05vdEZvdW5kRXhjZXB0aW9uIGNuZmUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IFN0b3JlRXhjZXB0aW9uKGNuZmUpOwogICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRp\nb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgbGlzdCBmb3JtZWQgYnkgcmVtb3Zpbmcg\nYWxsIGxvYWRlZCBmaWVsZHMgZnJvbSB0aGUgZ2l2ZW4gb25lLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcmVtb3ZlTG9hZGVkRmllbGRzKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMpIHsKICAgICAgICBmb3Ig\nKGludCBpID0gMCwgbGVuID0gZmllbGRzLmxlbmd0aCgpOyBpIDwgbGVuOyBp\nKyspCiAgICAgICAgICAgIGlmIChmaWVsZHMuZ2V0KGkpICYmIHNtLmdldExv\nYWRlZCgpLmdldChpKSkKICAgICAgICAgICAgICAgIGZpZWxkcy5jbGVhcihp\nKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBsb2FkQWxsKENvbGxl\nY3Rpb24gc21zLCBQQ1N0YXRlIHN0YXRlLCBpbnQgbG9hZCwKICAgICAgICBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBjb250ZXh0KSB7CiAg\nICAgICAgcmV0dXJuIEltcGxIZWxwZXIubG9hZEFsbChzbXMsIHRoaXMsIHN0\nYXRlLCBsb2FkLCBmZXRjaCwgY29udGV4dCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgYmVmb3JlU3RhdGVDaGFuZ2UoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgUENTdGF0ZSBmcm9tU3RhdGUsCiAgICAgICAgUENTdGF0ZSB0b1N0YXRl\nKSB7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZmx1c2goQ29sbGVj\ndGlvbiBzbXMpIHsKICAgICAgICByZXR1cm4gX2NvbmYuZ2V0VXBkYXRlTWFu\nYWdlckluc3RhbmNlKCkuZmx1c2goc21zLCB0aGlzKTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBjYW5jZWxBbGwoKSB7CiAgICAgICAgLy8gbm90ZSB0\naGF0IHRoaXMgbWV0aG9kIGRvZXMgbm90IGxvY2sgdGhlIGNvbnRleHQsIHNp\nbmNlCiAgICAgICAgLy8gd2Ugd2FudCB0byBhbGxvdyBhIGRpZmZlcmVudCB0\naHJlYWQgdG8gYmUgYWJsZSB0byBjYW5jZWwgdGhlCiAgICAgICAgLy8gb3V0\nc3RhbmRpbmcgc3RhdGVtZW50IG9uIGEgZGlmZmVyZW50IGNvbnRleHQKCiAg\nICAgICAgQ29sbGVjdGlvbiBzdG1udHM7CiAgICAgICAgc3luY2hyb25pemVk\nIChfc3RtbnRzKSB7CiAgICAgICAgICAgIGlmIChfc3RtbnRzLmlzRW1wdHko\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nc3RtbnRzID0gbmV3IEFycmF5TGlzdChfc3RtbnRzKTsKICAgICAgICB9Cgog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nc3RtbnRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAg\nICAgICAgKChTdGF0ZW1lbnQpIGl0ci5uZXh0KCkpLmNhbmNlbCgpOwogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5n\nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBhc3NpZ25PYmplY3RJZChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBib29sZWFuIHByZUZsdXNoKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhID0gc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICBpZiAobWV0YS5n\nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FU\nSU9OKQogICAgICAgICAgICByZXR1cm4gQXBwbGljYXRpb25JZHMuYXNzaWdu\nKHNtLCB0aGlzLCBwcmVGbHVzaCk7CgogICAgICAgIC8vIGRhdGFzdG9yZSBp\nZGVudGl0eQogICAgICAgIE9iamVjdCB2YWwgPSBJbXBsSGVscGVyLmdlbmVy\nYXRlSWRlbnRpdHlWYWx1ZShfY3R4LCBtZXRhLAogICAgICAgICAgICBKYXZh\nVHlwZXMuTE9ORyk7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsICYmIG1ldGEu\nZ2V0SWRlbnRpdHlTdHJhdGVneSgpICE9IFZhbHVlU3RyYXRlZ2llcy5OQVRJ\nVkUpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAodmFs\nID09IG51bGwpCiAgICAgICAgICAgIHZhbCA9IGdldERhdGFTdG9yZUlkU2Vx\ndWVuY2UobWV0YSkubmV4dChfY3R4LCBtZXRhKTsKICAgICAgICBzbS5zZXRP\nYmplY3RJZChuZXdEYXRhU3RvcmVJZCh2YWwsIG1ldGEpKTsKICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBhc3NpZ25G\naWVsZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBpbnQgZmllbGQsCiAgICAg\nICAgYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgT2JqZWN0IHZhbCA9IEltcGxIZWxwZXIuZ2VuZXJhdGVGaWVsZFZhbHVl\nKF9jdHgsIGZtZCk7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgc20uc3RvcmUoZmllbGQsIHZh\nbCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIENs\nYXNzIGdldE1hbmFnZWRUeXBlKE9iamVjdCBvaWQpIHsKICAgICAgICBpZiAo\nb2lkIGluc3RhbmNlb2YgSWQpCiAgICAgICAgICAgIHJldHVybiAoKElkKSBv\naWQpLmdldFR5cGUoKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICBwdWJsaWMgQ2xhc3MgZ2V0RGF0YVN0b3JlSWRUeXBlKENsYXNzTWV0YURh\ndGEgbWV0YSkgewogICAgICAgIHJldHVybiBJZC5jbGFzczsKICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IGNvcHlEYXRhU3RvcmVJZChPYmplY3Qgb2lkLCBD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBJZCBpZCA9IChJZCkgb2lk\nOwogICAgICAgIHJldHVybiBuZXcgSWQobWV0YS5nZXREZXNjcmliZWRUeXBl\nKCksIGlkLmdldElkKCksIGlkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBuZXdEYXRhU3RvcmVJZChPYmplY3QgdmFsLCBD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gSWQubmV3SW5z\ndGFuY2UobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIHZhbCk7CiAgICB9Cgog\nICAgcHVibGljIElkIG5ld0RhdGFTdG9yZUlkKGxvbmcgaWQsIENsYXNzTWFw\ncGluZyBtYXBwaW5nLCBib29sZWFuIHN1YnMpIHsKICAgICAgICByZXR1cm4g\nbmV3IElkKG1hcHBpbmcuZ2V0RGVzY3JpYmVkVHlwZSgpLCBpZCwgc3Vicyk7\nCiAgICB9CgogICAgcHVibGljIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1\ndGVFeHRlbnQoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIGZpbmFsIGJv\nb2xlYW4gc3ViY2xhc3NlcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5n\nKSBtZXRhOwogICAgICAgIGZpbmFsIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdz\nOwogICAgICAgIGlmIChzdWJjbGFzc2VzKQogICAgICAgICAgICBtYXBwaW5n\ncyA9IG1hcHBpbmcuZ2V0SW5kZXBlbmRlbnRBc3NpZ25hYmxlTWFwcGluZ3Mo\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG1hcHBpbmdzID0gbmV3IENs\nYXNzTWFwcGluZ1tdIHsgbWFwcGluZyB9OwoKICAgICAgICBSZXN1bHRPYmpl\nY3RQcm92aWRlcltdIHJvcHMgPSBudWxsOwogICAgICAgIGZpbmFsIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gamZldGNoID0gKEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24pIGZldGNoOwogICAgICAgIGlmIChqZmV0Y2guZ2V0U3ViY2xhc3NG\nZXRjaE1vZGUobWFwcGluZykgIT0gamZldGNoLkVBR0VSX0pPSU4pCiAgICAg\nICAgICAgIHJvcHMgPSBuZXcgUmVzdWx0T2JqZWN0UHJvdmlkZXJbbWFwcGlu\nZ3MubGVuZ3RoXTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY2hl\nY2sgZm9yIGN1c3RvbSBsb2FkcwogICAgICAgICAgICBSZXN1bHRPYmplY3RQ\ncm92aWRlciByb3A7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nbWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHJvcCA9\nIG1hcHBpbmdzW2ldLmN1c3RvbUxvYWQodGhpcywgc3ViY2xhc3NlcywgamZl\ndGNoLCAwLAogICAgICAgICAgICAgICAgICAgIExvbmcuTUFYX1ZBTFVFKTsK\nICAgICAgICAgICAgICAgIGlmIChyb3AgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIGlmIChyb3BzID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHJvcHMgPSBuZXcgUmVzdWx0T2JqZWN0UHJvdmlkZXJbbWFwcGlu\nZ3MubGVuZ3RoXTsKICAgICAgICAgICAgICAgICAgICByb3BzW2ldID0gcm9w\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBpZiB3ZSdyZSBzZWxlY3RpbmcgaW5kZXBlbmRlbnQgbWFwcGluZ3Mg\nc2VwYXJhdGVseSBvciBoYXZlCiAgICAgICAgICAgIC8vIGN1c3RvbSBsb2Fk\ncywgZG8gaW5kaXZpZHVhbCBzZWxlY3RzIGZvciBlYWNoIGNsYXNzCiAgICAg\nICAgICAgIHJvcCA9IG51bGw7CiAgICAgICAgICAgIGlmIChyb3BzICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWFw\ncGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\ncm9wc1tpXSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0IHNlbCA9IF9zcWwu\nbmV3U2VsZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgc2VsLnNldExSUyh0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBCaXRTZXQgcGFnZWQgPSBzZWxl\nY3RFeHRlbnQoc2VsLCBtYXBwaW5nc1tpXSwgamZldGNoLAogICAgICAgICAg\nICAgICAgICAgICAgICBzdWJjbGFzc2VzKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAocGFnZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\ncm9wc1tpXSA9IG5ldyBJbnN0YW5jZVJlc3VsdE9iamVjdFByb3ZpZGVyKHNl\nbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmdzW2ldLCB0\naGlzLCBqZmV0Y2gpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICAgICAgcm9wc1tpXSA9IG5ldyBQYWdpbmdSZXN1bHRP\nYmplY3RQcm92aWRlcihzZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBtYXBwaW5nc1tpXSwgdGhpcywgamZldGNoLCBwYWdlZCwgTG9uZy5NQVhf\nVkFMVUUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYg\nKHJvcHMubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHJvcHNbMF07CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1lcmdlZFJl\nc3VsdE9iamVjdFByb3ZpZGVyKHJvcHMpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBwZXJmb3JtIGEgdW5pb24gb24gYWxsIGluZGVwZW5kZW50\nIGNsYXNzZXMKICAgICAgICAgICAgVW5pb24gdW5pb24gPSBfc3FsLm5ld1Vu\naW9uKG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgICAgIHVuaW9uLnNldExS\nUyh0cnVlKTsKICAgICAgICAgICAgZmluYWwgQml0U2V0W10gcGFnZWQgPSBu\nZXcgQml0U2V0W21hcHBpbmdzLmxlbmd0aF07CiAgICAgICAgICAgIHVuaW9u\nLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAgICAgICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50IGlkeCkgewog\nICAgICAgICAgICAgICAgICAgIHBhZ2VkW2lkeF0gPSBzZWxlY3RFeHRlbnQo\nc2VsLCBtYXBwaW5nc1tpZHhdLCBqZmV0Y2gsCiAgICAgICAgICAgICAgICAg\nICAgICAgIHN1YmNsYXNzZXMpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9KTsKCiAgICAgICAgICAgIC8vIHVzaW5nIHBhZ2luZyByb3AgaWYg\nYW55IHVuaW9uIGVsZW1lbnQgaGFzIHBhZ2VkIGZpZWxkcwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHBhZ2VkLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBpZiAocGFnZWRbaV0gIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IFBhZ2luZ1Jlc3VsdE9iamVjdFByb3Zp\nZGVyKHVuaW9uLCBtYXBwaW5ncywKICAgICAgICAgICAgICAgICAgICAgICAg\nSkRCQ1N0b3JlTWFuYWdlci50aGlzLCBqZmV0Y2gsIHBhZ2VkLCBMb25nLk1B\nWF9WQUxVRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5l\ndyBJbnN0YW5jZVJlc3VsdE9iamVjdFByb3ZpZGVyKHVuaW9uLCBtYXBwaW5n\nc1swXSwgdGhpcywKICAgICAgICAgICAgICAgIGpmZXRjaCk7CiAgICAgICAg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93\nIFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGdpdmVuIG1hcHBp\nbmcgZm9yIHVzZSBpbiBhbiBleHRlbnQsIHJldHVybmluZyBwYWdlZCBmaWVs\nZHMuCiAgICAgKi8KICAgIHByaXZhdGUgQml0U2V0IHNlbGVjdEV4dGVudChT\nZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBib29sZWFuIHN1YmNsYXNzZXMp\nIHsKICAgICAgICBpbnQgc3VicyA9IChzdWJjbGFzc2VzKSA/IFNlbGVjdC5T\nVUJTX0pPSU5BQkxFIDogU2VsZWN0LlNVQlNfTk9ORTsKICAgICAgICAvLyBk\nZWNpZGUgYmV0d2VlbiBwYWdpbmcgYW5kIHN0YW5kYXJkIGl0ZXJhdGlvbgog\nICAgICAgIEJpdFNldCBwYWdlZCA9IFBhZ2luZ1Jlc3VsdE9iamVjdFByb3Zp\nZGVyLmdldFBhZ2VkRmllbGRzKHNlbCwgbWFwcGluZywKICAgICAgICAgICAg\ndGhpcywgZmV0Y2gsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfUEFS\nQUxMRUwsCiAgICAgICAgICAgIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICBp\nZiAocGFnZWQgPT0gbnVsbCkKICAgICAgICAgICAgc2VsLnNlbGVjdElkZW50\naWZpZXIobWFwcGluZywgc3VicywgdGhpcywgZmV0Y2gsCiAgICAgICAgICAg\nICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX1BBUkFMTEVMKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIHNlbC5zZWxlY3RJZGVudGlmaWVy\nKG1hcHBpbmcsIHN1YnMsIHRoaXMsIGZldGNoLAogICAgICAgICAgICAgICAg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOKTsKICAgICAgICBy\nZXR1cm4gcGFnZWQ7CiAgICB9CgogICAgcHVibGljIFN0b3JlUXVlcnkgbmV3\nUXVlcnkoU3RyaW5nIGxhbmd1YWdlKSB7CiAgICAgICAgRXhwcmVzc2lvblBh\ncnNlciBlcCA9IFF1ZXJ5TGFuZ3VhZ2VzLnBhcnNlckZvckxhbmd1YWdlKGxh\nbmd1YWdlKTsKICAgICAgICBpZiAoZXAgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBKREJDU3RvcmVRdWVyeSh0aGlzLCBlcCk7CiAgICAgICAg\naWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyhsYW5ndWFnZSkp\nCiAgICAgICAgICAgIHJldHVybiBuZXcgU1FMU3RvcmVRdWVyeSh0aGlzKTsK\nICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hD\nb25maWd1cmF0aW9uIG5ld0ZldGNoQ29uZmlndXJhdGlvbigpIHsKICAgICAg\nICByZXR1cm4gbmV3IEpEQkNGZXRjaENvbmZpZ3VyYXRpb25JbXBsKCk7CiAg\nICB9CgogICAgcHVibGljIFNlcSBnZXREYXRhU3RvcmVJZFNlcXVlbmNlKENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhLmdldElkZW50\naXR5U3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTkFUSVZFCiAgICAg\nICAgICAgIHx8IG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVneSgpID09IFZhbHVl\nU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAgICByZXR1cm4gX2NvbmYuZ2V0\nU2VxdWVuY2VJbnN0YW5jZSgpOwogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIHB1YmxpYyBTZXEgZ2V0VmFsdWVTZXF1ZW5jZShGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgIGlmIChfY29ubiAhPSBudWxs\nKQogICAgICAgICAgICBfY29ubi5mcmVlKCk7CiAgICB9CgogICAgLy8vLy8v\nLy8vLy8vLwogICAgLy8gVXRpbGl0aWVzCiAgICAvLy8vLy8vLy8vLy8vCgog\nICAgLyoqCiAgICAgKiBDb25uZWN0IHRvIHRoZSBkYi4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGNvbm5lY3QoYm9vbGVhbiByZWYpIHsKICAgICAgICBf\nY3R4LmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBjb25u\nZWN0IGlmIHRoZSBjb25uZWN0aW9uIGlzIGN1cnJlbnRseSBudWxsLCBvciBp\nZgogICAgICAgICAgICAvLyB0aGUgY29ubmVjdGlvbiBoYXMgYmVlbiBjbG9z\nZWQgb3V0IGZyb20gdW5kZXIgdXMKICAgICAgICAgICAgaWYgKF9jb25uID09\nIG51bGwpCiAgICAgICAgICAgICAgICBfY29ubiA9IGNvbm5lY3RJbnRlcm5h\nbCgpOwogICAgICAgICAgICBpZiAocmVmKQogICAgICAgICAgICAgICAgX2Nv\nbm4ucmVmKCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2Us\nIF9kaWN0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfY3R4\nLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENv\nbm5lY3QgdG8gdGhlIGRhdGFiYXNlLiBUaGlzIG1ldGhvZCBpcyBzZXBhcmF0\nZWQgb3V0IHNvIHRoYXQgaXQKICAgICAqIGNhbiBiZSBvdmVycmlkZGVuLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgUmVmQ291bnRDb25uZWN0aW9uIGNvbm5l\nY3RJbnRlcm5hbCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBuZXcgUmVmQ291bnRDb25uZWN0aW9uKF9kcy5nZXRDb25uZWN0aW9u\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogRmluZCB0aGUgb2JqZWN0IHdp\ndGggdGhlIGdpdmVuIG9pZC4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBm\naW5kKE9iamVjdCBvaWQsIFZhbHVlTWFwcGluZyB2bSwgCiAgICAgICAgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChvaWQg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgT2Jq\nZWN0IHBjID0gX2N0eC5maW5kKG9pZCwgZmV0Y2gsIG51bGwsIG51bGwsIDAp\nOwogICAgICAgIGlmIChwYyA9PSBudWxsICYmIHZtICE9IG51bGwpIHsKICAg\nICAgICAgICAgT3JwaGFuZWRLZXlBY3Rpb24gYWN0aW9uID0gX2NvbmYuZ2V0\nT3JwaGFuZWRLZXlBY3Rpb25JbnN0YW5jZSgpOwogICAgICAgICAgICBwYyA9\nIGFjdGlvbi5vcnBoYW4ob2lkLCBudWxsLCB2bSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBwYzsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhl\nIG9iamVjdCBpbiB0aGUgY3VycmVudCByb3cgb2YgdGhlIGdpdmVuIHJlc3Vs\ndC4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBsb2FkKENsYXNzTWFwcGlu\nZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAg\nICAgIEJpdFNldCBleGNsdWRlLCBSZXN1bHQgcmVzdWx0KSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIW1hcHBpbmcuaXNNYXBwZWQoKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgidmlydHVhbC1tYXBwaW5nIiwgCiAgICAgICAgICAgICAgICBt\nYXBwaW5nKSk7CgogICAgICAgIC8vIGdldCB0aGUgb2JqZWN0IGlkIGZvciB0\naGUgcm93OyBiYXNlIGNsYXNzIHNlbGVjdHMgcGsgY29sdW1ucwogICAgICAg\nIENsYXNzTWFwcGluZyBiYXNlID0gbWFwcGluZzsKICAgICAgICB3aGlsZSAo\nYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxs\nKQogICAgICAgICAgICBiYXNlID0gYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJj\nbGFzc01hcHBpbmcoKTsKICAgICAgICBPYmplY3Qgb2lkID0gYmFzZS5nZXRP\nYmplY3RJZCh0aGlzLCByZXN1bHQsIG51bGwsIHRydWUsIG51bGwpOwogICAg\nICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIENvbm5lY3Rpb25JbmZvIGluZm8gPSBuZXcgQ29ubmVjdGlv\nbkluZm8oKTsKICAgICAgICBpbmZvLnJlc3VsdCA9IHJlc3VsdDsKICAgICAg\nICBpbmZvLm1hcHBpbmcgPSBtYXBwaW5nOwogICAgICAgIHJldHVybiBfY3R4\nLmZpbmQob2lkLCBmZXRjaCwgZXhjbHVkZSwgaW5mbywgMCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBMb2FkIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHdp\ndGggZGF0YSBmcm9tIHRoZSByZXN1bHQgc2V0LiBPbmx5CiAgICAgKiBtYXBw\naW5ncyBvcmlnaW5hbGx5IHNlbGVjdGVkIHdpbGwgYmUgbG9hZGVkLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgbG9hZChDbGFzc01hcHBpbmcgbWFwcGlu\nZywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBGaWVsZE1hcHBpbmcgZWFnZXJUb01hbnkgPSBs\nb2FkKG1hcHBpbmcsIHNtLCBmZXRjaCwgcmVzLCBudWxsKTsKICAgICAgICBp\nZiAoZWFnZXJUb01hbnkgIT0gbnVsbCkKICAgICAgICAgICAgZWFnZXJUb01h\nbnkubG9hZEVhZ2VySm9pbihzbSwgdGhpcywgZmV0Y2gudHJhdmVyc2VKREJD\nKGVhZ2VyVG9NYW55KSwKICAgICAgICAgICAgICAgIHJlcyk7CiAgICAgICAg\naWYgKF9hY3RpdmUgJiYgX2xtICE9IG51bGwgJiYgcmVzLmlzTG9ja2luZygp\nKQogICAgICAgICAgICBfbG0ubG9hZGVkRm9yVXBkYXRlKHNtKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIExvYWQgdGhlIGZpZWxkcyBvZiB0aGUgZ2l2ZW4g\nbWFwcGluZy4gUmV0dXJuIGFueSB0by1tYW55IGVhZ2VyIGZpZWxkCiAgICAg\nKiB3aXRob3V0IGxvYWRpbmcgaXQuCiAgICAgKi8KICAgIHByaXZhdGUgRmll\nbGRNYXBwaW5nIGxvYWQoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgUmVzdWx0IHJlcywgRmllbGRNYXBwaW5nIGVhZ2VyVG9NYW55\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICht\nYXBwaW5nLmN1c3RvbUxvYWQoc20sIHRoaXMsIGZldGNoLCByZXMpKQogICAg\nICAgICAgICByZXR1cm4gZWFnZXJUb01hbnk7CgogICAgICAgIC8vIGxvYWQg\nc3VwZXJjbGFzcyBkYXRhOyBiYXNlIGNsYXNzIGxvYWRzIHZlcnNpb24KICAg\nICAgICBDbGFzc01hcHBpbmcgcGFyZW50ID0gbWFwcGluZy5nZXRKb2luYWJs\nZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAocGFyZW50ICE9\nIG51bGwpCiAgICAgICAgICAgIGVhZ2VyVG9NYW55ID0gbG9hZChwYXJlbnQs\nIHNtLCBmZXRjaCwgcmVzLCBlYWdlclRvTWFueSk7CiAgICAgICAgZWxzZSBp\nZiAoc20uZ2V0VmVyc2lvbigpID09IG51bGwpCiAgICAgICAgICAgIG1hcHBp\nbmcuZ2V0VmVyc2lvbigpLmxvYWQoc20sIHRoaXMsIHJlcyk7CgogICAgICAg\nIC8vIGxvYWQgdW5sb2FkZWQgZmllbGRzCiAgICAgICAgRmllbGRNYXBwaW5n\nW10gZm1zID0gbWFwcGluZy5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwog\nICAgICAgIE9iamVjdCBlcmVzLCBwcm9jZXNzZWQ7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\naWYgKGZtc1tpXS5pc1ByaW1hcnlLZXkoKSB8fCBzbS5nZXRMb2FkZWQoKS5n\nZXQoZm1zW2ldLmdldEluZGV4KCkpKQogICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBjaGVjayBmb3IgZWFn\nZXIgcmVzdWx0LCBhbmQgaWYgbm90IHByZXNlbnQgZG8gc3RhbmRhcmQgbG9h\nZAogICAgICAgICAgICBlcmVzID0gcmVzLmdldEVhZ2VyKGZtc1tpXSk7CiAg\nICAgICAgICAgIHJlcy5zdGFydERhdGFSZXF1ZXN0KGZtc1tpXSk7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgIGlmIChlcmVzID09IHJlcykg\newogICAgICAgICAgICAgICAgICAgIGlmIChlYWdlclRvTWFueSA9PSBudWxs\nICYmIGZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGVhZ2VyVG9NYW55ID0gZm1zW2ldOwogICAgICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZm1zW2ld\nLmxvYWRFYWdlckpvaW4oc20sIHRoaXMsIAogICAgICAgICAgICAgICAgICAg\nICAgICAJZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tpXSksIHJlcyk7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgaWYgKGVyZXMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIHByb2Nlc3NlZCA9IGZtc1tpXS5sb2FkRWFnZXJQYXJh\nbGxlbChzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAgICAgCWZldGNoLnRy\nYXZlcnNlSkRCQyhmbXNbaV0pLCBlcmVzKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAocHJvY2Vzc2VkICE9IGVyZXMpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHJlcy5wdXRFYWdlcihmbXNbaV0sIHByb2Nlc3NlZCk7CiAgICAgICAg\nICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBmbXNbaV0ubG9h\nZChzbSwgdGhpcywgZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tpXSksIHJlcyk7\nCiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICByZXMu\nZW5kRGF0YVJlcXVlc3QoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gZWFnZXJUb01hbnk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBGb3IgaW1wbGVtZW50YXRpb24gdXNlIG9ubHkuCiAgICAgKiBSZXR1cm4g\nYSBzZWxlY3QgZm9yIHRoZSBwcm9wZXIgbWFwcGluZ3MuIFJldHVybiBudWxs\nIGlmIG5vIHNlbGVjdCBpcwogICAgICogbmVlZGVkLiBUaGUgbWV0aG9kIGlz\nIGRlc2lnbmVkIHRvIGJlIGNvbXBsZW1lbnRhcnkgdG8gdGhlIGxvYWQgbWV0\naG9kcy4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VsIHNlbGVjdCB0byBidWls\nZCBvbgogICAgICogQHBhcmFtIG1hcHBpbmcgdGhlIG1hcHBpbmcgZm9yIHRo\nZSBiYXNlIHR5cGUgdG8gc2VsZWN0IGZvcgogICAgICogQHBhcmFtIHN1YnMg\nd2hldGhlciB0aGUgc2VsZWN0IG1pZ2h0IGluY2x1ZGUgc3ViY2xhc3NlcyBv\nZiB0aGUKICAgICAqIGdpdmVuIG1hcHBpbmcKICAgICAqIEBwYXJhbSBzbSBz\ndGF0ZSBtYW5hZ2VyIGlmIGFuIGluc3RhbmNlIGlzIGJlaW5nIGxvYWRlZCBv\ncgogICAgICogaW5pdGlhbGl6ZWQsIGVsc2UgbnVsbAogICAgICogQHBhcmFt\nIGZpZWxkcyBpZiBhIHN0YXRlIG1hbmFnZXIgaXMgYmVpbmcgbG9hZGVkLCB0\naGUgc2V0IG9mCiAgICAgKiBmaWVsZHMgdGhhdCBtdXN0IGJlIGxvYWRlZCBp\nbiBvcmRlciwgZWxzZSBudWxsCiAgICAgKiBAcGFyYW0gZmV0Y2ggdGhlIGZl\ndGNoIGNvbmZpZ3VyYXRpb247IHVzZWQgaWYgbm8gc3BlY2lmaWMgZmllbGRz\nCiAgICAgKiBtdXN0IGJlIGxvYWRlZCwgYW5kIHVzZWQgd2hlbiBzZWxlY3Rp\nbmcgcmVsYXRpb25zCiAgICAgKiBAcGFyYW0gZWFnZXIgZWFnZXIgZmV0Y2gg\nbW9kZSB0byB1c2UKICAgICAqIEBwYXJhbSBpZGVudCB3aGV0aGVyIHRvIHNl\nbGVjdCBwcmltYXJ5IGtleSBjb2x1bW5zIGFzIGRpc3RpbmN0CiAgICAgKiBp\nZGVudGlmaWVycwogICAgICogQHBhcmFtIG91dGVyIHdoZXRoZXIgd2UncmUg\nb3V0ZXItam9pbmluZyB0byB0aGlzIHR5cGUKICAgICAqIEByZXR1cm4gdHJ1\nZSBpZiB0aGUgc2VsZWN0IGlzIHJlcXVpcmVkLCBmYWxzZSBvdGhlcndpc2UK\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0KFNlbGVjdCBzZWws\nIENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3VicywKICAgICAgICBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLCBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIGludCBlYWdlciwgYm9vbGVh\nbiBpZGVudCwgYm9vbGVhbiBvdXRlcikgewogICAgICAgIC8vIGFkZCBjbGFz\ncyBjb25kaXRpb25zIHNvIHRoYXQgdGhleSdyZSBjbG9uZWQgZm9yIGFueSBi\nYXRjaGVkIHNlbGVjdHMKICAgICAgICBib29sZWFuIGpvaW5lZFN1cGVycyA9\nIGZhbHNlOwogICAgICAgIGlmICgoc20gPT0gbnVsbCB8fCBzbS5nZXRQQ1N0\nYXRlKCkgPT0gUENTdGF0ZS5UUkFOU0lFTlQpCiAgICAgICAgICAgICYmIChz\ndWJzID09IFNlbGVjdC5TVUJTX0pPSU5BQkxFIHx8IHN1YnMgPT0gU2VsZWN0\nLlNVQlNfTk9ORSkpIHsKICAgICAgICAgICAgbG9hZFN1YmNsYXNzZXMobWFw\ncGluZyk7IAogICAgICAgICAgICBKb2lucyBqb2lucyA9IChvdXRlcikgPyBz\nZWwubmV3T3V0ZXJKb2lucygpIDogbnVsbDsKICAgICAgICAgICAgam9pbmVk\nU3VwZXJzID0gbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCkuYWRkQ2xhc3ND\nb25kaXRpb25zKHNlbCwKICAgICAgICAgICAgICAgIHN1YnMgPT0gU2VsZWN0\nLlNVQlNfSk9JTkFCTEUsIGpvaW5zKTsKICAgICAgICB9CgogICAgICAgIC8v\nIGNyZWF0ZSBhbGwgb3VyIGVhZ2VyIHNlbGVjdHMgc28gdGhhdCB0aG9zZSBm\naWVsZHMgYXJlIHJlc2VydmVkCiAgICAgICAgLy8gYW5kIGNhbm5vdCBiZSBy\nZXVzZWQgZHVyaW5nIHRoZSBhY3R1YWwgZWFnZXIgc2VsZWN0IHByb2Nlc3Ms\nCiAgICAgICAgLy8gcHJldmVudGluZyBpbmZpbml0ZSByZWN1cnNpb24KICAg\nICAgICBlYWdlciA9IE1hdGgubWluKGVhZ2VyLCBmZXRjaC5nZXRFYWdlckZl\ndGNoTW9kZSgpKTsKICAgICAgICBGaWVsZE1hcHBpbmcgZWFnZXJUb01hbnkg\nPSBjcmVhdGVFYWdlclNlbGVjdHMoc2VsLCBtYXBwaW5nLCBzbSwgZmllbGRz\nLAogICAgICAgICAgICBmZXRjaCwgZWFnZXIpOwoKICAgICAgICAvLyBzZWxl\nY3QgYWxsIGJhc2UgY2xhc3MgbWFwcGluZ3M7IGRvIHRoaXMgYWZ0ZXIgYmF0\nY2hpbmcgc28gdGhhdAogICAgICAgIC8vIHRoZSBqb2lucyBuZWVkZWQgYnkg\ndGhlc2Ugc2VsZWN0cyBkb24ndCBnZXQgaW4gdGhlIFdIRVJFIGNsYXVzZQog\nICAgICAgIC8vIG9mIHRoZSBiYXRjaGVkIHNlbGVjdHMKICAgICAgICBpbnQg\nc2VsZCA9IHNlbGVjdEJhc2VNYXBwaW5ncyhzZWwsIG1hcHBpbmcsIG1hcHBp\nbmcsIHNtLCBmaWVsZHMsCiAgICAgICAgICAgIGZldGNoLCBlYWdlciwgZWFn\nZXJUb01hbnksIGlkZW50LCBqb2luZWRTdXBlcnMpOwoKICAgICAgICAvLyBz\nZWxlY3QgZWFnZXIgdG8tbWFueSByZWxhdGlvbnMgbGFzdCBiZWNhdXNlIGR1\ncmluZyBsb2FkIHRoZXkKICAgICAgICAvLyBhZHZhbmNlIHRoZSByZXN1bHQg\nc2V0IGFuZCBjb3VsZCBleGhhdXN0IGl0LCBzbyBubyBvdGhlciBtYXBwaW5n\ncwogICAgICAgIC8vIGNhbiBsb2FkIGFmdGVyd29yZHMKICAgICAgICBpZiAo\nZWFnZXJUb01hbnkgIT0gbnVsbCkKICAgICAgICAgICAgZWFnZXJUb01hbnku\nc2VsZWN0RWFnZXJKb2luKHNlbCwgc20sIHRoaXMsIAogICAgICAgICAgICAg\nICAgZmV0Y2gudHJhdmVyc2VKREJDKGVhZ2VyVG9NYW55KSwgZWFnZXIpOwoK\nICAgICAgICAvLyBvcHRpb25hbGx5IHNlbGVjdCBzdWJjbGFzcyBtYXBwaW5n\ncwogICAgICAgIGlmIChzdWJzID09IFNlbGVjdC5TVUJTX0pPSU5BQkxFIHx8\nIHN1YnMgPT0gU2VsZWN0LlNVQlNfQU5ZX0pPSU5BQkxFKQogICAgICAgICAg\nICBzZWxlY3RTdWJjbGFzc01hcHBpbmdzKHNlbCwgbWFwcGluZywgc20sIGZl\ndGNoKTsKICAgICAgICBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgc2Vs\nLnNldERpc3RpbmN0KGZhbHNlKTsKICAgICAgICByZXR1cm4gc2VsZCA+IDA7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBNYXJrIHRoZSBmaWVsZHMgb2YgdGhp\ncyBtYXBwaW5nIGFzIHJlc2VydmVkIHNvIHRoYXQgZWFnZXIgZmV0Y2hlcyBj\nYW4ndAogICAgICogZ2V0IGludG8gaW5maW5pdGUgcmVjdXJzaXZlIHNpdHVh\ndGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgRmllbGRNYXBwaW5nIGNyZWF0\nZUVhZ2VyU2VsZWN0cyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgbWFwcGlu\nZywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmll\nbGRzLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIGlu\ndCBlYWdlcikgewogICAgICAgIGlmIChtYXBwaW5nID09IG51bGwgfHwgZWFn\nZXIgPT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9OT05FKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgRmllbGRNYXBwaW5nIGVh\nZ2VyVG9NYW55ID0gY3JlYXRlRWFnZXJTZWxlY3RzKHNlbCwgCiAgICAgICAg\nICAgIG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCks\nIHNtLCBmaWVsZHMsIGZldGNoLCBlYWdlcik7CgogICAgICAgIEZpZWxkTWFw\ncGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3Mo\nKTsKICAgICAgICBib29sZWFuIGluRWFnZXJKb2luID0gc2VsLmhhc0VhZ2Vy\nSm9pbihmYWxzZSk7CiAgICAgICAgaW50IHNlbHM7CiAgICAgICAgaW50IGp0\neXBlOwogICAgICAgIGludCBtb2RlOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG1vZGUgPSBm\nbXNbaV0uZ2V0RWFnZXJGZXRjaE1vZGUoKTsKICAgICAgICAgICAgaWYgKG1v\nZGUgPT0gZmV0Y2guRUFHRVJfTk9ORSkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICBpZiAoIXJlcXVpcmVzU2VsZWN0KGZtc1tpXSwg\nc20sIGZpZWxkcywgZmV0Y2gpKQogICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICAvLyB0cnkgdG8gc2VsZWN0IHdpdGggam9pbiBmaXJz\ndAogICAgICAgICAgICBqdHlwZSA9IChmbXNbaV0uZ2V0TnVsbFZhbHVlKCkg\nPT0gZm1zW2ldLk5VTExfRVhDRVBUSU9OKSAKICAgICAgICAgICAgICAgID8g\nc2VsLkVBR0VSX0lOTkVSIDogc2VsLkVBR0VSX09VVEVSOwogICAgICAgICAg\nICBpZiAobW9kZSAhPSBmZXRjaC5FQUdFUl9QQVJBTExFTCAmJiAhZm1zW2ld\nLmlzRWFnZXJTZWxlY3RUb01hbnkoKQogICAgICAgICAgICAgICAgJiYgZm1z\nW2ldLnN1cHBvcnRzU2VsZWN0KHNlbCwganR5cGUsIHNtLCB0aGlzLCBmZXRj\naCkgPiAwCiAgICAgICAgICAgICAgICAmJiBzZWwuZWFnZXJDbG9uZShmbXNb\naV0sIGp0eXBlLCBmYWxzZSwgMSkgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwoKICAgICAgICAgICAgYm9vbGVhbiBoYXNKb2luID0gZmV0\nY2guaGFzSm9pbihmbXNbaV0uZ2V0RnVsbE5hbWUoZmFsc2UpKTsKCiAgICAg\nICAgICAgIC8vIGlmIHRoZSBmaWVsZCBkZWNsYXJlcyBhIHByZWZlcnJlZCBz\nZWxlY3QgbW9kZSBvZiBqb2luIG9yIGRvZXMgbm90CiAgICAgICAgICAgIC8v\nIGhhdmUgYSBwcmVmZXJyZWQgbW9kZSBhbmQgd2UncmUgZG9pbmcgYSBieS1p\nZCBsb29rdXAsIHRyeQogICAgICAgICAgICAvLyB0byB1c2UgYSB0by1tYW55\nIGpvaW4gYWxzby4gIGN1cnJlbnRseSB3ZSBsaW1pdCBlYWdlcgogICAgICAg\nICAgICAvLyBvdXRlciBqb2lucyB0byBub24tTFJTLCBub24tcmFuZ2VkIHNl\nbGVjdHMgdGhhdCBkb24ndCBhbHJlYWR5CiAgICAgICAgICAgIC8vIGhhdmUg\nYW4gZWFnZXIgdG8tbWFueSBqb2luCiAgICAgICAgICAgIGlmICgoaGFzSm9p\nbiB8fCBtb2RlID09IGZldGNoLkVBR0VSX0pPSU4gCiAgICAgICAgICAgICAg\nICB8fCAobW9kZSA9PSBmZXRjaC5ERUZBVUxUICYmIHNtICE9IG51bGwpKQog\nICAgICAgICAgICAgICAgJiYgZm1zW2ldLmlzRWFnZXJTZWxlY3RUb01hbnko\nKQogICAgICAgICAgICAgICAgJiYgIWluRWFnZXJKb2luCiAgICAgICAgICAg\nICAgICAmJiAhc2VsLmhhc0VhZ2VySm9pbih0cnVlKQogICAgICAgICAgICAg\nICAgJiYgKCFzZWwuZ2V0QXV0b0Rpc3RpbmN0KCkgfHwgKCFzZWwuaXNMUlMo\nKQogICAgICAgICAgICAgICAgJiYgc2VsLmdldFN0YXJ0SW5kZXgoKSA9PSAw\nIAogICAgICAgICAgICAgICAgJiYgc2VsLmdldEVuZEluZGV4KCkgPT0gTG9u\nZy5NQVhfVkFMVUUpKQogICAgICAgICAgICAgICAgJiYgZm1zW2ldLnN1cHBv\ncnRzU2VsZWN0KHNlbCwganR5cGUsIHNtLCB0aGlzLCBmZXRjaCkgPiAwKSB7\nCiAgICAgICAgICAgICAgICBpZiAoc2VsLmVhZ2VyQ2xvbmUoZm1zW2ldLCBq\ndHlwZSwgdHJ1ZSwgMSkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBl\nYWdlclRvTWFueSA9IGZtc1tpXTsKICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gZmluYWxseSwgdHJ5IHBhcmFsbGVsCiAgICAgICAgICAg\nIGlmIChlYWdlciA9PSBmZXRjaC5FQUdFUl9QQVJBTExFTAogICAgICAgICAg\nICAgICAgJiYgKHNlbHMgPSBmbXNbaV0uc3VwcG9ydHNTZWxlY3Qoc2VsLCBz\nZWwuRUFHRVJfUEFSQUxMRUwsIHNtLAogICAgICAgICAgICAgICAgdGhpcywg\nZmV0Y2gpKSAhPSAwKQogICAgICAgICAgICAgICAgc2VsLmVhZ2VyQ2xvbmUo\nZm1zW2ldLCBTZWxlY3QuRUFHRVJfUEFSQUxMRUwsIAogICAgICAgICAgICAg\nICAgICAgIGZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCksIHNlbHMpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gZWFnZXJUb01hbnk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGdpdmVuIGZpZWxkIG5l\nZWRzIHRvIGJlIHNlbGVjdGVkLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBib29sZWFuIHJlcXVpcmVzU2VsZWN0KEZpZWxkTWFwcGluZyBmbSwKICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKGZp\nZWxkcyAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmllbGRzLmdldChm\nbS5nZXRJbmRleCgpKTsKICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiBzbS5n\nZXRQQ1N0YXRlKCkgIT0gUENTdGF0ZS5UUkFOU0lFTlQKICAgICAgICAgICAg\nJiYgc20uZ2V0TG9hZGVkKCkuZ2V0KGZtLmdldEluZGV4KCkpKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIGZldGNoLnJlcXVp\ncmVzRmV0Y2goZm0pID09IEZldGNoQ29uZmlndXJhdGlvbi5GRVRDSF9MT0FE\nOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBmaWVsZCBtYXBw\naW5ncyBvZiB0aGUgZ2l2ZW4gY2xhc3MgYW5kIGFsbCBpdHMgc3VwZXJjbGFz\nc2VzLgogICAgICoKICAgICAqIEBwYXJhbSBzZWwgdGhlIHNlbGVjdCB0byB1\nc2UKICAgICAqIEBwYXJhbSBtYXBwaW5nIHRoZSBtb3N0LWRlcml2ZWQgdHlw\nZSB0byBzZWxlY3QgZm9yCiAgICAgKiBAcGFyYW0gb3JpZyB0aGUgb3JpZ2lu\nYWwgbWFwcGluZyB0eXBlIHNlbGVjdGVkCiAgICAgKiBAcGFyYW0gc20gdGhl\nIGluc3RhbmNlIGJlaW5nIHNlbGVjdGVkIGZvciwgb3IgbnVsbCBpZiBub25l\nCiAgICAgKiBAcGFyYW0gZmllbGRzIHRoZSBmaWVsZHMgdG8gbG9hZAogICAg\nICogQHBhcmFtIGZldGNoIGZldGNoIGNvbmZpZ3VyYXRpb24gdG8gdXNlIGZv\nciBsb2FkaW5nIHJlbGF0aW9ucwogICAgICogQHBhcmFtIGVhZ2VyIHRoZSBl\nYWdlciBmZXRjaCBtb2RlIHRvIHVzZQogICAgICogQHBhcmFtIGpvaW5lZCB3\naGV0aGVyIHRoZSBjbGFzcyBoYXMgYWxyZWFkeSBiZWVuIGpvaW5lZCBkb3du\nIHRvCiAgICAgKiBpdHMgYmFzZSBjbGFzcwogICAgICogQHJldHVybiAmZ3Q7\nIDAgaWYgdGhlIHNlbGVjdCBpcyByZXF1aXJlZCwgMCBpZiBkYXRhIHdhcwog\nICAgICogc2VsZWN0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZCwgYW5kICZsdDsg\nMCBpZiBub3RoaW5nIHdhcyBzZWxlY3RlZAogICAgICovCiAgICBwcml2YXRl\nIGludCBzZWxlY3RCYXNlTWFwcGluZ3MoU2VsZWN0IHNlbCwgQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsCiAgICAgICAgQ2xhc3NNYXBwaW5nIG9yaWcsIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsCiAgICAgICAgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyLCBGaWVsZE1h\ncHBpbmcgZWFnZXJUb01hbnksCiAgICAgICAgYm9vbGVhbiBpZGVudCwgYm9v\nbGVhbiBqb2luZWQpIHsKICAgICAgICBDbGFzc01hcHBpbmcgcGFyZW50ID0g\nbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAg\nICAgICBpZiAocGFyZW50ID09IG51bGwgJiYgIW1hcHBpbmcuaXNNYXBwZWQo\nKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlv\nbihfbG9jLmdldCgidmlydHVhbC1tYXBwaW5nIiwgbWFwcGluZy4KICAgICAg\nICAgICAgICAgIGdldERlc2NyaWJlZFR5cGUoKSkpOwoKICAgICAgICBpbnQg\nc2VsZCA9IC0xOwogICAgICAgIGludCBwc2VsZCA9IC0xOwoKICAgICAgICAv\nLyBiYXNlIGNsYXNzIHNlbGVjdHMgcGtzLCBldGMKICAgICAgICBpZiAocGFy\nZW50ID09IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgbm8gaW5zdGFuY2Us\nIHNlbGVjdCBwa3MKICAgICAgICAgICAgaWYgKHNtID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGlmIChpZGVudCkKICAgICAgICAgICAgICAgICAgICBz\nZWwuc2VsZWN0SWRlbnRpZmllcihtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1\nbW5zKCkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgIHNlbC5zZWxlY3QobWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygp\nKTsKICAgICAgICAgICAgICAgIHNlbGQgPSAxOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBpZiBubyBpbnN0YW5jZSBvciBub3QgaW5pdGlhbGl6\nZWQgYW5kIG5vdCBleGFjdCBvaWQsIHNlbGVjdCB0eXBlCiAgICAgICAgICAg\nIGlmICgoc20gPT0gbnVsbCB8fCAoc20uZ2V0UENTdGF0ZSgpID09IFBDU3Rh\ndGUuVFJBTlNJRU5UIAogICAgICAgICAgICAgICAgJiYgKCEoc20uZ2V0T2Jq\nZWN0SWQoKSBpbnN0YW5jZW9mIE9wZW5KUEFJZCkgCiAgICAgICAgICAgICAg\nICB8fCAoKE9wZW5KUEFJZCkgc20uZ2V0T2JqZWN0SWQoKSkuaGFzU3ViY2xh\nc3NlcygpKSkpCiAgICAgICAgICAgICAgICAmJiBtYXBwaW5nLmdldERpc2Ny\naW1pbmF0b3IoKS5zZWxlY3Qoc2VsLCBvcmlnKSkKICAgICAgICAgICAgICAg\nIHNlbGQgPSAxOwoKICAgICAgICAgICAgLy8gaWYgbm8gaW5zdGFuY2Ugb3Ig\nbm8gdmVyc2lvbiwgc2VsZWN0IHZlcnNpb24KICAgICAgICAgICAgaWYgKChz\nbSA9PSBudWxsIHx8IHNtLmdldFZlcnNpb24oKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgJiYgbWFwcGluZy5nZXRWZXJzaW9uKCkuc2VsZWN0KHNlbCwg\nb3JpZykpCiAgICAgICAgICAgICAgICBzZWxkID0gMTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAvLyByZWN1cnNlIG9uIHBhcmVudAogICAgICAg\nICAgICBwc2VsZCA9IHNlbGVjdEJhc2VNYXBwaW5ncyhzZWwsIHBhcmVudCwg\nb3JpZywgc20sIGZpZWxkcywKICAgICAgICAgICAgICAgIGZldGNoLCBlYWdl\nciwgZWFnZXJUb01hbnksIGlkZW50LCBqb2luZWQpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gc2VsZWN0IHRoZSBtYXBwaW5ncyBpbiB0aGUgZ2l2ZW4gZmll\nbGRzIHNldCwgb3IgYmFzZWQgb24gZmV0Y2gKICAgICAgICAvLyBjb25maWd1\ncmF0aW9uIGlmIG5vIGZpZWxkcyBnaXZlbgogICAgICAgIEZpZWxkTWFwcGlu\nZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3MoKTsK\nICAgICAgICBTZWxlY3RFeGVjdXRvciBlc2VsOwogICAgICAgIGludCBmc2Vs\nZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAvLyBza2lwIGVhZ2VyIHRvLW1hbnkgc2VsZWN0\nOyB3ZSBkbyB0aGF0IHNlcGFyYXRlbHkgaW4gY2FsbGluZwogICAgICAgICAg\nICAvLyBtZXRob2QKICAgICAgICAgICAgaWYgKGZtc1tpXSA9PSBlYWdlclRv\nTWFueSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nLy8gY2hlY2sgZm9yIGVhZ2VyIHNlbGVjdAogICAgICAgICAgICBlc2VsID0g\nc2VsLmdldEVhZ2VyKGZtc1tpXSk7CiAgICAgICAgICAgIGlmIChlc2VsICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChlc2VsID09IHNlbCkKICAg\nICAgICAgICAgICAgICAgICBmbXNbaV0uc2VsZWN0RWFnZXJKb2luKHNlbCwg\nc20sIHRoaXMsIAogICAgICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJz\nZUpEQkMoZm1zW2ldKSwgZWFnZXIpOwogICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgIGZtc1tpXS5zZWxlY3RFYWdlclBhcmFsbGVs\nKGVzZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0Y2gu\ndHJhdmVyc2VKREJDKGZtc1tpXSksIGVhZ2VyKTsKICAgICAgICAgICAgICAg\nIHNlbGQgPSBNYXRoLm1heCgwLCBzZWxkKTsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChyZXF1aXJlc1NlbGVjdChmbXNbaV0sIHNtLCBmaWVsZHMsIGZldGNo\nKSkgewogICAgICAgICAgICAgICAgZnNlbGQgPSBmbXNbaV0uc2VsZWN0KHNl\nbCwgc20sIHRoaXMsIAogICAgICAgICAgICAgICAgCWZldGNoLnRyYXZlcnNl\nSkRCQyhmbXNbaV0pLCBlYWdlcik7CiAgICAgICAgICAgICAgICBzZWxkID0g\nTWF0aC5tYXgoZnNlbGQsIHNlbGQpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKG9wdFNlbGVjdChmbXNbaV0sIHNlbCwgc20sIGZldGNoKSkgewogICAgICAg\nICAgICAgICAgZnNlbGQgPSBmbXNbaV0uc2VsZWN0KHNlbCwgc20sIHRoaXMs\nIAogICAgICAgICAgICAgICAgCWZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0p\nLCBmZXRjaC5FQUdFUl9OT05FKTsKCiAgICAgICAgICAgICAgICAvLyBkb24n\ndCB1cGdyYWRlIHNlbGQgdG8gPiAwIGJhc2VkIG9uIHRoZXNlIGZpZWxkcywg\nc2luY2UKICAgICAgICAgICAgICAgIC8vIHRoZXkncmUgbm90IGluIHRoZSBj\nYWxjdWxhdGVkIGZpZWxkIHNldAogICAgICAgICAgICAgICAgaWYgKGZzZWxk\nID49IDAgJiYgc2VsZCA8IDApCiAgICAgICAgICAgICAgICAgICAgc2VsZCA9\nIDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGpvaW4g\ndG8gcGFyZW50IHRhYmxlIGlmIHRoZSBwYXJlbnQgLyBhbnkgYW5jZXN0b3Jz\nIGhhdmUgc2VsZWN0ZWQKICAgICAgICAvLyBhbnl0aGluZwogICAgICAgIGlm\nICgham9pbmVkICYmIHBzZWxkID49IDAgJiYgcGFyZW50LmdldFRhYmxlKCkg\nIT0gbWFwcGluZy5nZXRUYWJsZSgpKQogICAgICAgICAgICBzZWwud2hlcmUo\nbWFwcGluZy5qb2luU3VwZXJjbGFzcyhzZWwubmV3Sm9pbnMoKSwgZmFsc2Up\nKTsKCiAgICAgICAgLy8gcmV0dXJuIHRoZSBoaWdoZXN0IHZhbHVlCiAgICAg\nICAgcmV0dXJuIE1hdGgubWF4KHBzZWxkLCBzZWxkKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZW4gc2VsZWN0aW5nIGZpZWxkZXMsIGEgc3BlY2lhbCBj\nYXNlIGlzIG1hZGUgZm9yIG1hcHBpbmdzIHRoYXQgdXNlCiAgICAgKiAyLXBh\ncnQgc2VsZWN0cyB0aGF0IGFyZW4ndCBleHBsaWNpdGx5ICpub3QqIGluIHRo\nZSBkZmcgc28gdGhhdCB0aGV5CiAgICAgKiBjYW4gZ2V0IHRoZWlyIHByaW1h\ncnkgdGFibGUgZGF0YS4gVGhpcyBtZXRob2QgdGVzdHMgZm9yIHRoYXQgc3Bl\nY2lhbAogICAgICogY2FzZSBhcyBhbiBvcHRpbWl6YXRpb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiBvcHRTZWxlY3QoRmllbGRNYXBwaW5nIGZt\nLCBTZWxlY3Qgc2VsLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1\ncm4gIWZtLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpIAogICAgICAgICAgICAm\nJiAhZm0uaXNEZWZhdWx0RmV0Y2hHcm91cEV4cGxpY2l0KCkKICAgICAgICAg\nICAgJiYgKHNtID09IG51bGwgfHwgc20uZ2V0UENTdGF0ZSgpID09IFBDU3Rh\ndGUuVFJBTlNJRU5UIAogICAgICAgICAgICB8fCAhc20uZ2V0TG9hZGVkKCku\nZ2V0KGZtLmdldEluZGV4KCkpKQogICAgICAgICAgICAmJiBmbS5zdXBwb3J0\nc1NlbGVjdChzZWwsIHNlbC5UWVBFX1RXT19QQVJULCBzbSwgdGhpcywgZmV0\nY2gpID4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCBmaWVsZCBt\nYXBwaW5ncyB0aGF0IG1hdGNoIHRoZSBnaXZlbiBmZXRjaCBjb25maWd1cmF0\naW9uIGZvcgogICAgICogc3ViY2xhc3NlcyBvZiB0aGUgZ2l2ZW4gdHlwZS4K\nICAgICAqCiAgICAgKiBAcGFyYW0gc2VsIHRoZSBzZWxlY3QgdG8gdXNlCiAg\nICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgdHlwZSB3aG9zZSBzdWJjbGFzc2Vz\nIHRvIHNlbGVjdAogICAgICogQHBhcmFtIHNtIHRoZSBpbnN0YW5jZSBiZWlu\nZyBzZWxlY3RlZCBmb3IsIG9yIG51bGwgaWYgbm9uZQogICAgICogQHBhcmFt\nIGZldGNoIHRoZSBmZXRjaCBjb25maWd1cmF0aW9uCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBzZWxlY3RTdWJjbGFzc01hcHBpbmdzKFNlbGVjdCBzZWws\nIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAg\nICAgICBsb2FkU3ViY2xhc3NlcyhtYXBwaW5nKTsKICAgICAgICBDbGFzc01h\ncHBpbmdbXSBzdWJNYXBwaW5ncyA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1\nYmNsYXNzTWFwcGluZ3MoKTsKICAgICAgICBpZiAoc3ViTWFwcGluZ3MubGVu\nZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gc2Vs\nZWN0IGFsbCBzdWJjbGFzcyBtYXBwaW5ncyB0aGF0IG1hdGNoIHRoZSBmZXRj\naCBjb25maWd1cmF0aW9uCiAgICAgICAgLy8gYW5kIHdob3NlIHRhYmxlIGlz\nIGluIHRoZSBsaXN0IG9mIHRob3NlIHNlbGVjdGVkIHNvIGZhcjsgdGhpcwog\nICAgICAgIC8vIHdheSB3ZSBzZWxlY3QgdGhlIG1heCBwb3NzaWJsZSB3aXRo\nb3V0IHNlbGVjdGluZyBhbnkgdGFibGVzIHRoYXQKICAgICAgICAvLyBhcmVu\nJ3QgcHJlc2VudCBpbiBhbGwgcG9zc2libGUgcXVlcnkgbWF0Y2hlczsgYSBz\ncGVjaWFsIGNhc2UKICAgICAgICAvLyBpcyBtYWRlIGZvciBtYXBwaW5ncyB0\naGF0IHVzZSAyLXBhcnQgc2VsZWN0cyB0aGF0IGFyZW4ndAogICAgICAgIC8v\nIGV4cGxpY2l0bHkgKm5vdCogaW4gdGhlIGRlZmF1bHQgc28gdGhhdCB0aGV5\nIGNhbiBnZXQgdGhlaXIKICAgICAgICAvLyBwcmltYXJ5IHRhYmxlIGRhdGEK\nICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXM7CiAgICAgICAgYm9vbGVhbiBq\nb2luZWQ7CiAgICAgICAgYm9vbGVhbiBjYW5Kb2luID0gX2RpY3Quam9pblN5\nbnRheCAhPSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElPTkFMCiAgICAg\nICAgICAgICYmIGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2RlKG1hcHBpbmcp\nICE9IGZldGNoLkVBR0VSX05PTkU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBzdWJNYXBwaW5ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoIXN1Yk1hcHBpbmdzW2ldLnN1cHBvcnRzRWFnZXJTZWxlY3Qoc2VsLCBz\nbSwgdGhpcywgbWFwcGluZywKICAgICAgICAgICAgICAgIGZldGNoKSkKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8gaW5pdGlh\nbGl6ZSBzbyB0aGF0IGlmIHdlIGNhbid0IGpvaW4sIHdlIHByZXRlbmQgd2Ug\nYWxyZWFkeSBoYXZlCiAgICAgICAgICAgIGpvaW5lZCA9ICFjYW5Kb2luOwog\nICAgICAgICAgICBmbXMgPSBzdWJNYXBwaW5nc1tpXS5nZXREZWZpbmVkRmll\nbGRNYXBwaW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8\nIGZtcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgLy8gbWFrZSBz\ndXJlIGluIG9uZSBvZiBjb25maWd1cmVkIGZldGNoIGdyb3VwcwogICAgICAg\nICAgICAJaWYgKGZldGNoLnJlcXVpcmVzRmV0Y2goZm1zW2pdKSAhPSBGZXRj\naENvbmZpZ3VyYXRpb24uRkVUQ0hfTE9BRAogICAgICAgICAgICAgICAgICAg\nICYmICgoIWZtc1tqXS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAKICAgICAg\nICAgICAgICAgICAgICAmJiBmbXNbal0uaXNEZWZhdWx0RmV0Y2hHcm91cEV4\ncGxpY2l0KCkpCiAgICAgICAgICAgICAgICAgICAgfHwgZm1zW2pdLnN1cHBv\ncnRzU2VsZWN0KHNlbCwgc2VsLlRZUEVfVFdPX1BBUlQsIHNtLCB0aGlzLCAK\nICAgICAgICAgICAgICAgICAgICBmZXRjaCkgPD0gMCkpIAogICAgICAgICAg\nICAJCWNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIC8vIGlmIHdlIGNhbiBq\nb2luIHRvIHRoZSBzdWJjbGFzcywgZG8gc287IG11Y2ggYmV0dGVyIGNoYW5j\nZQogICAgICAgICAgICAgICAgLy8gdGhhdCB0aGUgZmllbGQgd2lsbCBiZSBh\nYmxlIHRvIHNlbGVjdCBpdHNlbGYgd2l0aG91dCBqb2lucwogICAgICAgICAg\nICAgICAgaWYgKCFqb2luZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBt\nYXJrIGpvaW5lZCB3aGV0aGVyIG9yIG5vdCB3ZSBqb2luLCBzbyB3ZSBkb24n\ndCBoYXZlIHRvCiAgICAgICAgICAgICAgICAgICAgLy8gdGVzdCBjb25kaXRp\nb25zIGFnYWluIGZvciB0aGlzIHN1YmNsYXNzCiAgICAgICAgICAgICAgICAg\nICAgam9pbmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBzZWwud2hl\ncmUoam9pblN1YmNsYXNzKHNlbCwgbWFwcGluZywgc3ViTWFwcGluZ3NbaV0s\nIG51bGwpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAv\nLyBpZiBjYW4gc2VsZWN0IHdpdGggdGFibGVzIGFscmVhZHkgc2VsZWN0ZWQs\nIGRvIGl0CiAgICAgICAgICAgICAgICBpZiAoZm1zW2pdLnN1cHBvcnRzU2Vs\nZWN0KHNlbCwgc2VsLlRZUEVfSk9JTkxFU1MsIHNtLCB0aGlzLAogICAgICAg\nICAgICAgICAgICAgIGZldGNoKSA+IDApCiAgICAgICAgICAgICAgICAgICAg\nZm1zW2pdLnNlbGVjdChzZWwsIG51bGwsIHRoaXMsIGZldGNoLnRyYXZlcnNl\nSkRCQyhmbXNbal0pLAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaC5F\nQUdFUl9OT05FKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gam9pbiBmcm9tIGNsYXNz\nIHRvIGl0cyBzdWJjbGFzcy4gUmVjdXJzaXZlIHRvIGFsbG93CiAgICAgKiBm\nb3IgbXVsdGlwbGUgaG9wcywgc3RhcnRpbmcgZnJvbSB0aGUgYmFzZSBjbGFz\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgSm9pbnMgam9pblN1YmNs\nYXNzKFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBiYXNlLAogICAgICAgIENs\nYXNzTWFwcGluZyBzdWIsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKHN1\nYiA9PSBiYXNlIHx8IHN1Yi5nZXRUYWJsZSgpID09IGJhc2UuZ2V0VGFibGUo\nKQogICAgICAgICAgICB8fCBzZWwuaXNTZWxlY3RlZChzdWIuZ2V0VGFibGUo\nKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyByZWN1\ncnNlIGZpcnN0IHNvIHdlIGdvIGxlYXN0LT5tb3N0IGRlcml2ZWQKICAgICAg\nICBDbGFzc01hcHBpbmcgc3VwID0gc3ViLmdldEpvaW5hYmxlUENTdXBlcmNs\nYXNzTWFwcGluZygpOwogICAgICAgIGpvaW5zID0gam9pblN1YmNsYXNzKHNl\nbCwgYmFzZSwgc3VwLCBqb2lucyk7CiAgICAgICAgaWYgKGpvaW5zID09IG51\nbGwpCiAgICAgICAgICAgIGpvaW5zID0gc2VsLm5ld0pvaW5zKCk7CiAgICAg\nICAgcmV0dXJuIHN1Yi5qb2luU3VwZXJjbGFzcyhqb2lucywgdHJ1ZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBNYWtlcyBzdXJlIGFsbCBzdWJjbGFzc2Vz\nIG9mIHRoZSBnaXZlbiB0eXBlIGFyZSBsb2FkZWQgaW4gdGhlIEpWTS4KICAg\nICAqIFRoaXMgaXMgdXN1YWxseSBkb25lIGF1dG9tYXRpY2FsbHkuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIGxvYWRTdWJjbGFzc2VzKENsYXNzTWFwcGlu\nZyBtYXBwaW5nKSB7CiAgICAgICAgRGlzY3JpbWluYXRvciBkc2MgPSBtYXBw\naW5nLmdldERpc2NyaW1pbmF0b3IoKTsKICAgICAgICBpZiAoZHNjLmdldFN1\nYmNsYXNzZXNMb2FkZWQoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICAvLyBpZiB0aGUgc3ViY2xhc3MgbGlzdCBpcyBzZXQsIG5vIG5lZWQgdG8g\nbG9hZCBzdWJzCiAgICAgICAgaWYgKG1hcHBpbmcuZ2V0UmVwb3NpdG9yeSgp\nLmdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsCiAgICAgICAgICAgIF9j\ndHguZ2V0Q2xhc3NMb2FkZXIoKSkgIT0gbnVsbCkgewogICAgICAgICAgICBk\nc2Muc2V0U3ViY2xhc3Nlc0xvYWRlZCh0cnVlKTsKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZHNj\nLmxvYWRTdWJjbGFzc2VzKHRoaXMpOwogICAgICAgIH0gY2F0Y2ggKENsYXNz\nTm90Rm91bmRFeGNlcHRpb24gY25mZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24oY25mZSk7CiAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlv\nbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBNYWtlIHRoZSBzdGF0ZW1lbnQgYSBjYW5kaWRhdGUgZm9y\nIGNhbmNlbGxhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGJlZm9y\nZUV4ZWN1dGVTdGF0ZW1lbnQoU3RhdGVtZW50IHN0bW50KSB7CiAgICAgICAg\nX3N0bW50cy5hZGQoc3RtbnQpOwogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlIHRoZSBzdGF0ZW1lbnQgZnJvbSB0aGUgY2FuY2VsbGFibGUgc2V0Lgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50\nKFN0YXRlbWVudCBzdG1udCkgewogICAgICAgIF9zdG1udHMucmVtb3ZlKHN0\nbW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbm5lY3Rpb24gcmV0dXJu\nZWQgdG8gY2xpZW50IGNvZGUuIE1ha2VzIHN1cmUgaXRzIHdyYXBwZWQgY29u\nbmVjdGlvbgogICAgICogcmVmIGNvdW50IGlzIGRlY3JlbWVudGVkIG9uIGZp\nbmFsaXplLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBDbGll\nbnRDb25uZWN0aW9uIGV4dGVuZHMgRGVsZWdhdGluZ0Nvbm5lY3Rpb24gewoK\nICAgICAgICBwcml2YXRlIGJvb2xlYW4gX2Nsb3NlZCA9IGZhbHNlOwoKICAg\nICAgICBwdWJsaWMgQ2xpZW50Q29ubmVjdGlvbihDb25uZWN0aW9uIGNvbm4p\nIHsKICAgICAgICAgICAgc3VwZXIoY29ubik7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBjbG9zZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICBfY2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3VwZXIu\nY2xvc2UoKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCB2b2lkIGZp\nbmFsaXplKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlm\nICghX2Nsb3NlZCkKICAgICAgICAgICAgICAgIGNsb3NlKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiB3cmFwcGVyIHRo\nYXQga2VlcHMgYW4gaW50ZXJuYWwgcmVmIGNvdW50IHNvIHRoYXQgaXQga25v\nd3MKICAgICAqIHdoZW4gdG8gcmVhbGx5IGNsb3NlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgY2xhc3MgUmVmQ291bnRDb25uZWN0aW9uIGV4dGVuZHMgRGVs\nZWdhdGluZ0Nvbm5lY3Rpb24gewoKICAgICAgICBwcml2YXRlIGJvb2xlYW4g\nX3JldGFpbiA9IGZhbHNlOwogICAgICAgIHByaXZhdGUgaW50IF9yZWZzID0g\nMDsKICAgICAgICBwcml2YXRlIGJvb2xlYW4gX2ZyZWVkID0gZmFsc2U7Cgog\nICAgICAgIHB1YmxpYyBSZWZDb3VudENvbm5lY3Rpb24oQ29ubmVjdGlvbiBj\nb25uKSB7CiAgICAgICAgICAgIHN1cGVyKGNvbm4pOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gZ2V0UmV0YWluKCkgewogICAgICAgICAg\nICByZXR1cm4gX3JldGFpbjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIHNldFJldGFpbihib29sZWFuIHJldGFpbikgewogICAgICAgICAgICBp\nZiAoX3JldGFpbiAmJiAhcmV0YWluICYmIF9yZWZzIDw9IDApCiAgICAgICAg\nICAgICAgICBmcmVlKCk7CiAgICAgICAgICAgIF9yZXRhaW4gPSByZXRhaW47\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCByZWYoKSB7CiAgICAg\nICAgICAgIC8vIGRvbid0IGhhdmUgdG8gbG9jazsgY2FsbGVkIGZyb20gY29u\nbmVjdCgpLCB3aGljaCBpcyBsb2NrZWQKICAgICAgICAgICAgX3JlZnMrKzsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIC8vIGxvY2sgYXQgYnJva2Vy\nIGxldmVsIHRvIGF2b2lkIGRlYWRsb2NrcwogICAgICAgICAgICBfY3R4Lmxv\nY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9yZWZz\nLS07CiAgICAgICAgICAgICAgICBpZiAoX3JlZnMgPD0gMCAmJiAhX3JldGFp\nbikKICAgICAgICAgICAgICAgICAgICBmcmVlKCk7CiAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICBfY3R4LnVubG9jaygpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBmcmVl\nKCkgewogICAgICAgICAgICAvLyBlbnN1cmUgdGhhdCB3ZSBkbyBub3QgY2xv\nc2UgdGhlIHVuZGVybHlpbmcgY29ubmVjdGlvbgogICAgICAgICAgICAvLyBt\ndWx0aXBsZSB0aW1lczsgdGhpcyBjb3VsZCBoYXBwZW4gaWYgc29tZW9uZSAo\nZS5nLiwgYW4KICAgICAgICAgICAgLy8gRXh0ZW50KSBob2xkcyBhIFJlZkNv\nbm5lY3Rpb24sIGFuZCB0aGVuIGNsb3NlcyBpdCAoZS5nLiwgaW4KICAgICAg\nICAgICAgLy8gdGhlIGZpbmFsaXplcikgYWZ0ZXIgdGhlIFN0b3JlTWFuYWdl\nciBoYXMgYWxyZWFkeSBiZWVuIGNsb3NlZC4KICAgICAgICAgICAgaWYgKF9m\ncmVlZCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBnZXREZWxlZ2F0ZSgpLmNsb3NlKCk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICB9CiAgICAgICAgICAgIF9mcmVlZCA9IHRydWU7CiAgICAgICAgICAg\nIF9jb25uID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBT\ndGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGJvb2xlYW4gd3JhcCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FuY2Vs\nU3RhdGVtZW50KHN1cGVyLmNyZWF0ZVN0YXRlbWVudChmYWxzZSksCiAgICAg\nICAgICAgICAgICBSZWZDb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAg\nfQoKICAgICAgICBwcm90ZWN0ZWQgU3RhdGVtZW50IGNyZWF0ZVN0YXRlbWVu\ndChpbnQgcnNUeXBlLCBpbnQgcnNDb25jdXIsCiAgICAgICAgICAgIGJvb2xl\nYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJl\ndHVybiBuZXcgQ2FuY2VsU3RhdGVtZW50KHN1cGVyLmNyZWF0ZVN0YXRlbWVu\ndChyc1R5cGUsIHJzQ29uY3VyLAogICAgICAgICAgICAgICAgZmFsc2UpLCBS\nZWZDb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAgICBw\ncm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChT\ndHJpbmcgc3FsLCBib29sZWFuIHdyYXApCiAgICAgICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3IENhbmNlbFBy\nZXBhcmVkU3RhdGVtZW50KHN1cGVyLnByZXBhcmVTdGF0ZW1lbnQoc3FsLAog\nICAgICAgICAgICAgICAgZmFsc2UpLCBSZWZDb3VudENvbm5lY3Rpb24udGhp\ncyk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0\nZW1lbnQgcHJlcGFyZVN0YXRlbWVudChTdHJpbmcgc3FsLCBpbnQgcnNUeXBl\nLAogICAgICAgICAgICBpbnQgcnNDb25jdXIsIGJvb2xlYW4gd3JhcCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ2Fu\nY2VsUHJlcGFyZWRTdGF0ZW1lbnQoc3VwZXIucHJlcGFyZVN0YXRlbWVudChz\ncWwsCiAgICAgICAgICAgICAgICByc1R5cGUsIHJzQ29uY3VyLCBmYWxzZSks\nIFJlZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTdGF0ZW1lbnQgdHlwZSB0aGF0IGFkZHMgYW5kIHJl\nbW92ZXMgaXRzZWxmIGZyb20gdGhlIHNldCBvZiBhY3RpdmUKICAgICAqIHN0\nYXRlbWVudHMgc28gdGhhdCBpdCBjYW4gYmUgY2FuY2VsZWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgY2xhc3MgQ2FuY2VsU3RhdGVtZW50IGV4dGVuZHMgRGVs\nZWdhdGluZ1N0YXRlbWVudCB7CgogICAgICAgIHB1YmxpYyBDYW5jZWxTdGF0\nZW1lbnQoU3RhdGVtZW50IHN0bW50LCBDb25uZWN0aW9uIGNvbm4pIHsKICAg\nICAgICAgICAgc3VwZXIoc3RtbnQsIGNvbm4pOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBleGVjdXRlVXBkYXRlKFN0cmluZyBzcWwpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3Rh\ndGVtZW50KHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVVcGRhdGUoc3FsKTsKICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0\nYXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgcHJvdGVjdGVkIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoU3RyaW5nIHNx\nbCwgYm9vbGVhbiB3cmFwKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlz\nKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBz\ndXBlci5leGVjdXRlUXVlcnkoc3FsLCB3cmFwKTsKICAgICAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVu\ndCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFN0YXRlbWVudCB0eXBlIHRoYXQgYWRkcyBhbmQgcmVtb3Zl\ncyBpdHNlbGYgZnJvbSB0aGUgc2V0IG9mIGFjdGl2ZQogICAgICogc3RhdGVt\nZW50cyBzbyB0aGF0IGl0IGNhbiBiZSBjYW5jZWxlZC4KICAgICAqLwogICAg\ncHJpdmF0ZSBjbGFzcyBDYW5jZWxQcmVwYXJlZFN0YXRlbWVudCBleHRlbmRz\nIERlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudCB7CgogICAgICAgIHB1Ymxp\nYyBDYW5jZWxQcmVwYXJlZFN0YXRlbWVudChQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgCiAgICAgICAgICAgIENvbm5lY3Rpb24gY29ubikgewogICAgICAg\nICAgICBzdXBlcihzdG1udCwgY29ubik7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgaW50IGV4ZWN1dGVVcGRhdGUoKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBl\nci5leGVjdXRlVXBkYXRlKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICBhZnRlckV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBSZXN1\nbHRTZXQgZXhlY3V0ZVF1ZXJ5KGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQo\ndGhpcyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gc3VwZXIuZXhlY3V0ZVF1ZXJ5KHdyYXApOwogICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50\nKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgaW50W10gZXhlY3V0ZUJhdGNoKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIu\nZXhlY3V0ZUJhdGNoKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICBhZnRlckV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyBNYXAg\nZ2V0Q2FjaGVNYXBGcm9tUXVlcnlTUUxDYWNoZShPYmplY3Qga2V5KSB7CiAg\nICAgICAgc3luY2hyb25pemVkKF9zcWxDYWNoZSkgewogICAgICAgICAgICAv\nL3NxbENhY2hlIGlzIGEgbWFwIG9mIG1hcAogICAgICAgICAgICBNYXAgY2Fj\naGVNYXAgPSAoTWFwKV9zcWxDYWNoZS5nZXQoa2V5KTsKICAgICAgICAgICAg\naWYgKGNhY2hlTWFwID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNhY2hl\nTWFwID0gY3JlYXRlU1FMQ2FjaGUoKTsKICAgICAgICAgICAgICAgIF9zcWxD\nYWNoZS5wdXQoa2V5LCBjYWNoZU1hcCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcmV0dXJuIGNhY2hlTWFwOwogICAgICAgIH0KICAgIH0KICAgIAog\nICAgcHVibGljIHZvaWQgYWRkVG9TcWxDYWNoZShNYXAgY2FjaGVNYXAsIE9i\namVjdCBrZXksIE9iamVjdCB2YWx1ZSkgewogICAgICAgIGNhY2hlTWFwLnB1\ndChrZXksIHZhbHVlKTsKICAgIH0KICAgIAogICAgcHVibGljIE1hcCBjcmVh\ndGVTUUxDYWNoZSgpIHsKICAgICAgICBRdWVyeVNRTENhY2hlVmFsdWUgcXVl\ncnlTUUxDYWNoZSA9IF9jb25mLmdldFF1ZXJ5U1FMQ2FjaGUoKTsKICAgICAg\nICByZXR1cm4gKE1hcClxdWVyeVNRTENhY2hlLm5ld0luc3RhbmNlKCk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNRdWVyeVNRTENhY2hlT24oKSB7\nCiAgICAgICAgcmV0dXJuIF9pc1F1ZXJ5U1FMQ2FjaGU7ICAKICAgIH0KICAg\nIAogICAgcHVibGljIE1hcCBnZXRRdWVyeVNRTENhY2hlKCkgewogICAgICAg\nIHJldHVybiBfc3FsQ2FjaGU7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0\naWMgY2xhc3MgU2VsZWN0S2V5IHsKICAgICAgICBwdWJsaWMgQ2xhc3NNYXBw\naW5nIG1hcHBpbmc7CiAgICAgICAgcHVibGljIEZpZWxkTWFwcGluZyBmbTsK\nICAgICAgICBwdWJsaWMgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaDsK\nICAgICAgICAKICAgICAgICBwdWJsaWMgU2VsZWN0S2V5IChDbGFzc01hcHBp\nbmcgbWFwcGluZywgRmllbGRNYXBwaW5nIGZtLCAKICAgICAgICAgICAgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgICAgICB0aGlz\nLm1hcHBpbmcgPSBtYXBwaW5nOwogICAgICAgICAgICB0aGlzLmZtID0gZm07\nCiAgICAgICAgICAgIHRoaXMuZmV0Y2ggPSBmZXRjaDsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBv\nKSB7CiAgICAgICAgICAgIGlmICh0aGlzID09IG8pIHJldHVybiB0cnVlOwog\nICAgICAgICAgICBpZiAobyA9PSBudWxsIHx8IGdldENsYXNzKCkgIT0gby5n\nZXRDbGFzcygpKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICBTZWxlY3RL\nZXkgc2VsZWN0S2V5ID0gKFNlbGVjdEtleSkgbzsKICAgICAgICAgICAgaWYg\nKGZldGNoICE9IG51bGwgPyAhZXF1YWxzKGZldGNoLCBzZWxlY3RLZXkuZmV0\nY2gpIDoKICAgICAgICAgICAgICAgIHNlbGVjdEtleS5mZXRjaCAhPSBudWxs\nKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChtYXBwaW5nICE9IG51\nbGwgPyAhbWFwcGluZy5lcXVhbHMoc2VsZWN0S2V5Lm1hcHBpbmcpIDoKICAg\nICAgICAgICAgICAgIHNlbGVjdEtleS5tYXBwaW5nICE9IG51bGwpIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgaWYgKGZtICE9IG51bGwgPyAhZm0uZXF1\nYWxzKHNlbGVjdEtleS5mbSkgOgogICAgICAgICAgICAgICAgc2VsZWN0S2V5\nLmZtICE9IG51bGwpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBib29s\nZWFuIGVxdWFscyhKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoMSwKICAg\nICAgICAJSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaDIpIHsKICAgICAg\nICAgICAgaWYgKGZldGNoMSA9PSBmZXRjaDIpIAogICAgICAgICAgICAJcmV0\ndXJuIHRydWU7CgogICAgICAgICAgICBpZiAoZmV0Y2gxLmdldElzb2xhdGlv\nbigpICE9IGZldGNoMi5nZXRJc29sYXRpb24oKSkgCiAgICAgICAgICAgIAly\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChmZXRjaDEuZ2V0RmV0Y2hE\naXJlY3Rpb24oKSAhPSBmZXRjaDIuZ2V0RmV0Y2hEaXJlY3Rpb24oKSkgCiAg\nICAgICAgICAgIAlyZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChmZXRj\naDEuZ2V0RWFnZXJGZXRjaE1vZGUoKSAhPSBmZXRjaDIuZ2V0RWFnZXJGZXRj\naE1vZGUoKSkgCiAgICAgICAgICAgIAlyZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgIGlmIChmZXRjaDEuZ2V0U3ViY2xhc3NGZXRjaE1vZGUoKSAhPSBmZXRj\naDIuZ2V0U3ViY2xhc3NGZXRjaE1vZGUoKSkgCiAgICAgICAgICAgIAlyZXR1\ncm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChmZXRjaDEuZ2V0Sm9pblN5bnRh\neCgpICE9IGZldGNoMi5nZXRKb2luU3ludGF4KCkpIAogICAgICAgICAgICAJ\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICBTZXQgam9pbnMxID0gZmV0Y2gx\nLmdldEpvaW5zKCk7CiAgICAgICAgICAgIFNldCBqb2luczIgPSBmZXRjaDIu\nZ2V0Sm9pbnMoKTsKICAgICAgICAgICAgaWYgKGpvaW5zMSAhPSBudWxsID8g\nIWpvaW5zMS5lcXVhbHMoam9pbnMyKSA6IGpvaW5zMiAhPSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAKICAgICAg\nICAgICAgaWYgKGZldGNoMS5nZXRNYXhGZXRjaERlcHRoKCkgIT0gZmV0Y2gy\nLmdldE1heEZldGNoRGVwdGgoKSkgCiAgICAgICAgICAgIAlyZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIGlmIChmZXRjaDEuZ2V0UmVhZExvY2tMZXZlbCgp\nICE9IGZldGNoMi5nZXRSZWFkTG9ja0xldmVsKCkpIAogICAgICAgICAgICAJ\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoZmV0Y2gxLmdldFdyaXRl\nTG9ja0xldmVsKCkgIT0gZmV0Y2gyLmdldFdyaXRlTG9ja0xldmVsKCkpIAog\nICAgICAgICAgICAJcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAKICAgICAg\nICAgICAgYm9vbGVhbiBzYW1lRmV0Y2hHcm91cCA9IGZhbHNlOwogICAgICAg\nICAgICBib29sZWFuIGhhc0ZldGNoR3JvdXBBbGwgPSAoKEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb25JbXBsKWZldGNoMSkuCiAgICAgICAgICAgIAloYXNGZXRj\naEdyb3VwQWxsKCk7CiAgICAgICAgICAgIGJvb2xlYW4gaGFzRmV0Y2hHcm91\ncEFsbDEgPSAoKEpEQkNGZXRjaENvbmZpZ3VyYXRpb25JbXBsKWZldGNoMiku\nCiAgICAgICAgICAgIAloYXNGZXRjaEdyb3VwQWxsKCk7CiAgICAgICAgICAg\nIGlmIChoYXNGZXRjaEdyb3VwQWxsICYmIGhhc0ZldGNoR3JvdXBBbGwxKSAK\nICAgICAgICAgICAgICAgIHNhbWVGZXRjaEdyb3VwID0gdHJ1ZTsKICAgICAg\nICAgICAgZWxzZSBpZiAoIWhhc0ZldGNoR3JvdXBBbGwgJiYgIWhhc0ZldGNo\nR3JvdXBBbGwxKXsKICAgICAgICAgICAgICAgIGJvb2xlYW4gaGFzRmV0Y2hH\ncm91cERlZmF1bHQgPSAKICAgICAgICAgICAgICAgIAkoKEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb25JbXBsKWZldGNoMSkuaGFzRmV0Y2hHcm91cERlZmF1bHQo\nKTsKICAgICAgICAgICAgICAgIGJvb2xlYW4gaGFzRmV0Y2hHcm91cERlZmF1\nbHQxID0gCiAgICAgICAgICAgICAgICAJKChKREJDRmV0Y2hDb25maWd1cmF0\naW9uSW1wbClmZXRjaDIpLmhhc0ZldGNoR3JvdXBEZWZhdWx0KCk7CiAgICAg\nICAgICAgICAgICBpZiAoaGFzRmV0Y2hHcm91cERlZmF1bHQgJiYgaGFzRmV0\nY2hHcm91cERlZmF1bHQxKSAKICAgICAgICAgICAgICAgICAgICBzYW1lRmV0\nY2hHcm91cCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAg\nICAgICAgICAgIGlmICghc2FtZUZldGNoR3JvdXApIHsKICAgICAgICAgICAg\nICAgIFNldCBmZXRjaEdyb3VwcyA9IGZldGNoMS5nZXRGZXRjaEdyb3Vwcygp\nOwogICAgICAgICAgICAgICAgU2V0IGZldGNoR3JvdXBzMSA9IGZldGNoMi5n\nZXRGZXRjaEdyb3VwcygpOwogICAgICAgICAgICAgICAgaWYgKGZldGNoR3Jv\ndXBzICE9IG51bGwgPyAhZmV0Y2hHcm91cHMuZXF1YWxzKGZldGNoR3JvdXBz\nMSkgOiAKICAgICAgICAgICAgICAgIAlmZXRjaEdyb3VwczEgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIFNldCBmaWVsZHMgPSBmZXRj\naDEuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIFNldCBmaWVsZHMxID0gZmV0\nY2gyLmdldEZpZWxkcygpOwogICAgICAgICAgICBpbnQgc2l6ZSA9IGZpZWxk\ncy5zaXplKCk7CiAgICAgICAgICAgIGludCBzaXplMSA9IGZpZWxkczEuc2l6\nZSgpOwogICAgICAgICAgICBpZiAoc2l6ZSA9PSAwICYmIHNpemUxID09IDAp\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgZWxz\nZSBpZiAoc2l6ZSAhPSBzaXplMSkgCiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7ICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoZmllbGRz\nICE9IG51bGwgPyAhZmllbGRzLmVxdWFscyhmaWVsZHMxKSA6IGZpZWxkczEg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAg\nICAgICAKICAgICAgICAKICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkg\newogICAgICAgICAgICBpbnQgcmVzdWx0ID0gMDsKICAgICAgICAgICAgcmVz\ndWx0ID0gMzEgKiByZXN1bHQgKyAobWFwcGluZyAhPSBudWxsID8gbWFwcGlu\nZy5oYXNoQ29kZSgpIDogMCk7CiAgICAgICAgICAgIHJlc3VsdCA9IDMxICog\ncmVzdWx0ICsgKGZtICE9IG51bGwgPyBmbS5oYXNoQ29kZSgpIDogMCk7CiAg\nICAgICAgICAgIHJlc3VsdCA9IDMxICogcmVzdWx0ICsgZmV0Y2guZ2V0SXNv\nbGF0aW9uKCk7CiAgICAgICAgICAgIHJlc3VsdCA9IDMxICogcmVzdWx0ICsg\nZmV0Y2guZ2V0RmV0Y2hEaXJlY3Rpb24oKTsKICAgICAgICAgICAgcmVzdWx0\nID0gMzEgKiByZXN1bHQgKyBmZXRjaC5nZXRFYWdlckZldGNoTW9kZSgpOwog\nICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGZldGNoLmdldFN1\nYmNsYXNzRmV0Y2hNb2RlKCk7CiAgICAgICAgICAgIHJlc3VsdCA9IDMxICog\ncmVzdWx0ICsgZmV0Y2guZ2V0Sm9pblN5bnRheCgpOwogICAgICAgICAgICBT\nZXQgam9pbnMgPSBmZXRjaC5nZXRKb2lucygpOwogICAgICAgICAgICByZXN1\nbHQgPSAzMSAqIHJlc3VsdCArIChqb2lucyAhPSBudWxsID8gam9pbnMuaGFz\naENvZGUoKSA6IDApOwogICAgICAgICAgICAKICAgICAgICAgICAgcmVzdWx0\nID0gMzEgKiByZXN1bHQgKyBmZXRjaC5nZXRNYXhGZXRjaERlcHRoKCk7CiAg\nICAgICAgICAgIHJlc3VsdCA9IDMxICogcmVzdWx0ICsgZmV0Y2guZ2V0UmVh\nZExvY2tMZXZlbCgpOwogICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3Vs\ndCArIGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCk7CiAgICAgICAgCQogICAg\nICAgICAgICBpZiAoKChKREJDRmV0Y2hDb25maWd1cmF0aW9uSW1wbClmZXRj\naCkuaGFzRmV0Y2hHcm91cEFsbCgpKSAKICAgICAgICAgICAgCXJlc3VsdCA9\nIDMxICogcmVzdWx0ICsgRmV0Y2hHcm91cC5OQU1FX0FMTC5oYXNoQ29kZSgp\nOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIFNldCBmZXRj\naEdyb3VwcyA9IGZldGNoLmdldEZldGNoR3JvdXBzKCk7CiAgICAgICAgICAg\nICAgICBpZiAoKChKREJDRmV0Y2hDb25maWd1cmF0aW9uSW1wbClmZXRjaCku\naGFzRmV0Y2hHcm91cERlZmF1bHQoKSAKICAgICAgICAgICAgICAgIAkmJiBm\nZXRjaEdyb3VwcyAhPSBudWxsICYmIGZldGNoR3JvdXBzLnNpemUoKSA9PSAx\nKQogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IDMxICogcmVzdWx0ICsg\nRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQuaGFzaENvZGUoKTsKICAgICAgICAg\nICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IDMx\nICogcmVzdWx0ICsgKGZldGNoR3JvdXBzICE9IG51bGwgJiYgCiAgICAgICAg\nICAgICAgICAgICAgICAgIGZldGNoR3JvdXBzLnNpemUoKSA+IDAgPyAKICAg\nICAgICAgICAgICAgICAgICAgICAgZmV0Y2hHcm91cHMuaGFzaENvZGUoKSA6\nIDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nICAgIFNldCBmaWVsZHMgPSBmZXRjaC5nZXRGaWVsZHMoKTsKICAgICAgICAJ\ncmVzdWx0ID0gMzEgKiByZXN1bHQgKyAoZmllbGRzICE9IG51bGwgJiYgIGZp\nZWxkcy5zaXplKCkgPiAwID8gCiAgICAgICAgCQlmaWVsZHMuaGFzaENvZGUo\nKSA6IDApOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3Vs\ndDsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

