{"sha":"89a48eefee1bfc940d82a752fb71181746337d74","node_id":"MDQ6QmxvYjIwNjM2NDo4OWE0OGVlZmVlMWJmYzk0MGQ4MmE3NTJmYjcxMTgxNzQ2MzM3ZDc0","size":35926,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/89a48eefee1bfc940d82a752fb71181746337d74","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFw\nOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGls\nLkxpbmtlZEhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJD\nRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLkpEQkNTdG9yZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuc3RyYXRzLk5vbmVDbGFzc1N0cmF0ZWd5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW5JTzsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWdu\nS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNj\naGVtYXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9p\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUmVzdWx0\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJvd01hbmFn\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5GZXRjaENvbmZp\nZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9w\nZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLlBDU3RhdGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5S\nZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CgovKioKICogU3BlY2lh\nbGl6YXRpb24gb2YgbWV0YWRhdGEgZm9yIHJlbGF0aW9uYWwgZGF0YWJhc2Vz\nLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIENs\nYXNzTWFwcGluZwogICAgZXh0ZW5kcyBDbGFzc01ldGFEYXRhCiAgICBpbXBs\nZW1lbnRzIENsYXNzU3RyYXRlZ3kgewoKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgQ2xhc3NNYXBwaW5nW10gRU1QVFlfTUFQUElOR1MgPSBuZXcgQ2xhc3NN\nYXBwaW5nWzBdOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXpl\nciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQ2xhc3NN\nYXBwaW5nLmNsYXNzKTsKCiAgICBwcml2YXRlIGZpbmFsIENsYXNzTWFwcGlu\nZ0luZm8gX2luZm87CiAgICBwcml2YXRlIGZpbmFsIERpc2NyaW1pbmF0b3Ig\nX2Rpc2NyaW07CiAgICBwcml2YXRlIGZpbmFsIFZlcnNpb24gX3ZlcnNpb247\nCiAgICBwcml2YXRlIENsYXNzU3RyYXRlZ3kgX3N0cmF0ZWd5ID0gbnVsbDsK\nCiAgICBwcml2YXRlIFRhYmxlIF90YWJsZSA9IG51bGw7CiAgICBwcml2YXRl\nIENvbHVtbklPIF9pbyA9IG51bGw7CiAgICBwcml2YXRlIENvbHVtbltdIF9j\nb2xzID0gU2NoZW1hcy5FTVBUWV9DT0xVTU5TOwogICAgcHJpdmF0ZSBGb3Jl\naWduS2V5IF9mayA9IG51bGw7CiAgICBwcml2YXRlIGludCBfc3ViY2xhc3NN\nb2RlID0gSW50ZWdlci5NQVhfVkFMVUU7CgogICAgcHJpdmF0ZSBDbGFzc01h\ncHBpbmdbXSBfam9pblN1Yk1hcHMgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFz\nc01hcHBpbmdbXSBfYXNzaWduTWFwcyA9IG51bGw7CgogICAgLy8gbWFwcyBj\nb2x1bW5zIHRvIGpvaW5hYmxlcwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX2pv\naW5hYmxlcyA9IENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFz\naE1hcCgpKTsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkg\nZGVzY3JpYmVkIHR5cGUgYW5kIG93bmluZyByZXBvc2l0b3J5LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgQ2xhc3NNYXBwaW5nKENsYXNzIHR5cGUsIE1hcHBp\nbmdSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgc3VwZXIodHlwZSwgcmVw\nb3MpOwogICAgICAgIF9kaXNjcmltID0gcmVwb3MubmV3RGlzY3JpbWluYXRv\ncih0aGlzKTsKICAgICAgICBfdmVyc2lvbiA9IHJlcG9zLm5ld1ZlcnNpb24o\ndGhpcyk7CiAgICAgICAgX2luZm8gPSByZXBvcy5uZXdNYXBwaW5nSW5mbyh0\naGlzKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVtYmVkZGVkIGNvbnN0cnVj\ndG9yLiBTdXBwbHkgZW1iZWRkaW5nIHZhbHVlIGFuZCBvd25pbmcgcmVwb3Np\ndG9yeS4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzTWFwcGluZyhWYWx1\nZU1ldGFEYXRhIHZtZCkgewogICAgICAgIHN1cGVyKHZtZCk7CiAgICAgICAg\nX2Rpc2NyaW0gPSBnZXRNYXBwaW5nUmVwb3NpdG9yeSgpLm5ld0Rpc2NyaW1p\nbmF0b3IodGhpcyk7CiAgICAgICAgX3ZlcnNpb24gPSBnZXRNYXBwaW5nUmVw\nb3NpdG9yeSgpLm5ld1ZlcnNpb24odGhpcyk7CiAgICAgICAgX2luZm8gPSBn\nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLm5ld01hcHBpbmdJbmZvKHRoaXMpOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIGNsYXNzIGRpc2NyaW1pbmF0b3Iu\nCiAgICAgKi8KICAgIHB1YmxpYyBEaXNjcmltaW5hdG9yIGdldERpc2NyaW1p\nbmF0b3IoKSB7CiAgICAgICAgcmV0dXJuIF9kaXNjcmltOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIHZlcnNpb24gaW5kaWNhdG9yLgogICAgICovCiAg\nICBwdWJsaWMgVmVyc2lvbiBnZXRWZXJzaW9uKCkgewogICAgICAgIHJldHVy\nbiBfdmVyc2lvbjsKICAgIH0KCiAgICAvLy8vLy8vLy8vLwogICAgLy8gUnVu\ndGltZQogICAgLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgb2lkIHZhbHVlIHN0b3JlZCBpbiB0aGUgcmVzdWx0LiBUaGlzIGltcGxl\nbWVudGF0aW9uIHdpbGwKICAgICAqIHJlY3Vyc2UgdW50aWwgaXQgZmluZHMg\nYW4gYW5jZXN0b3IgY2xhc3Mgd2hvIHVzZXMgb2lkIHZhbHVlcyBmb3IgaXRz\nCiAgICAgKiBwcmltYXJ5IGtleS4KICAgICAqCiAgICAgKiBAcGFyYW0gZmsg\naWYgbm9uLW51bGwsIHVzZSB0aGUgbG9jYWwgY29sdW1ucyBvZiB0aGUgZ2l2\nZW4gZm9yZWlnbgogICAgICoga2V5IGluIHBsYWNlIG9mIHRoaXMgY2xhc3Mn\nIHByaW1hcnkga2V5IGNvbHVtbnMKICAgICAqIEBzZWUgI2lzUHJpbWFyeUtl\neU9iamVjdElkCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0T2JqZWN0\nSWQoSkRCQ1N0b3JlIHN0b3JlLCBSZXN1bHQgcmVzLCBGb3JlaWduS2V5IGZr\nLAogICAgICAgIGJvb2xlYW4gc3VicywgSm9pbnMgam9pbnMpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgVmFsdWVNYXBwaW5nIGVt\nYmVkID0gZ2V0RW1iZWRkaW5nTWFwcGluZygpOwogICAgICAgIGlmIChlbWJl\nZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZW1iZWQuZ2V0RmllbGRN\nYXBwaW5nKCkuZ2V0RGVmaW5pbmdNYXBwaW5nKCkuCiAgICAgICAgICAgICAg\nICBnZXRPYmplY3RJZChzdG9yZSwgcmVzLCBmaywgc3Vicywgam9pbnMpOwoK\nICAgICAgICByZXR1cm4gZ2V0T2JqZWN0SWQodGhpcywgc3RvcmUsIHJlcywg\nZmssIHN1YnMsIGpvaW5zKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vy\nc2l2ZSBoZWxwZXIgZm9yIHB1YmxpYyA8Y29kZT5nZXRPYmplY3RJZDwvY29k\nZT4gbWV0aG9kLgogICAgICovCiAgICBwcml2YXRlIE9iamVjdCBnZXRPYmpl\nY3RJZChDbGFzc01hcHBpbmcgY2xzLCBKREJDU3RvcmUgc3RvcmUsIFJlc3Vs\ndCByZXMsCiAgICAgICAgRm9yZWlnbktleSBmaywgYm9vbGVhbiBzdWJzLCBK\nb2lucyBqb2lucykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoIWlzUHJpbWFyeUtleU9iamVjdElkKHRydWUpKQogICAgICAg\nICAgICByZXR1cm4gZ2V0UENTdXBlcmNsYXNzTWFwcGluZygpLmdldE9iamVj\ndElkKGNscywgc3RvcmUsIHJlcywgZmssCiAgICAgICAgICAgICAgICBzdWJz\nLCBqb2lucyk7CiAgICAgICAgaWYgKGdldElkZW50aXR5VHlwZSgpID09IElE\nX1VOS05PV04pCiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2Vw\ndGlvbigpOwoKICAgICAgICBDb2x1bW5bXSBwa3MgPSBnZXRQcmltYXJ5S2V5\nQ29sdW1ucygpOwogICAgICAgIGlmIChnZXRJZGVudGl0eVR5cGUoKSA9PSBJ\nRF9EQVRBU1RPUkUpIHsKICAgICAgICAgICAgQ29sdW1uIGNvbCA9IChmayA9\nPSBudWxsKSA/IHBrc1swXSA6IGZrLmdldENvbHVtbihwa3NbMF0pOwogICAg\nICAgICAgICBsb25nIGlkID0gcmVzLmdldExvbmcoY29sLCBqb2lucyk7CiAg\nICAgICAgICAgIHJldHVybiAoaWQgPT0gMCAmJiByZXMud2FzTnVsbCgpKSA/\nIG51bGwKICAgICAgICAgICAgICAgIDogc3RvcmUubmV3RGF0YVN0b3JlSWQo\naWQsIGNscywgc3Vicyk7CiAgICAgICAgfQoKICAgICAgICAvLyBhcHBsaWNh\ndGlvbiBpZGVudGl0eQogICAgICAgIE9iamVjdFtdIHZhbHMgPSBuZXcgT2Jq\nZWN0W2dldFByaW1hcnlLZXlGaWVsZHMoKS5sZW5ndGhdOwogICAgICAgIEZp\nZWxkTWFwcGluZyBmbTsKICAgICAgICBKb2luYWJsZSBqb2luOwogICAgICAg\nIGludCBwa0lkeDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBrcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyB3ZSBrbm93IHRoYXQgYWxs\nIHBrIGNvbHVtbiBqb2luIG1hcHBpbmdzIHVzZSBwcmltYXJ5IGtleSBmaWVs\nZHMsCiAgICAgICAgICAgIC8vIGNhdXNlIHRoaXMgbWFwcGluZyB1c2VzIHRo\nZSBvaWQgYXMgaXRzIHByaW1hcnkga2V5ICh3ZSByZWN1cnNlZAogICAgICAg\nICAgICAvLyBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBtZXRob2QgdG8gZW5z\ndXJlIHRoaXMpCiAgICAgICAgICAgIGpvaW4gPSBhc3NlcnRKb2luYWJsZShw\na3NbaV0pOwogICAgICAgICAgICBmbSA9IGdldEZpZWxkTWFwcGluZyhqb2lu\nLmdldEZpZWxkSW5kZXgoKSk7CiAgICAgICAgICAgIHBrSWR4ID0gZm0uZ2V0\nUHJpbWFyeUtleUluZGV4KCk7CgogICAgICAgICAgICAvLyBjb3VsZCBoYXZl\nIGFscmVhZHkgc2V0IHZhbHVlIHdpdGggcHJldmlvdXMgbXVsdGktY29sdW1u\nIGpvaW5hYmxlCiAgICAgICAgICAgIGlmICh2YWxzW3BrSWR4XSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICByZXMuc3RhcnREYXRhUmVxdWVzdChmbSk7\nCiAgICAgICAgICAgICAgICB2YWxzW3BrSWR4XSA9IGpvaW4uZ2V0UHJpbWFy\neUtleVZhbHVlKHJlcywgam9pbi5nZXRDb2x1bW5zKCksCiAgICAgICAgICAg\nICAgICAgICAgZmssIHN0b3JlLCBqb2lucyk7CiAgICAgICAgICAgICAgICBy\nZXMuZW5kRGF0YVJlcXVlc3QoKTsKICAgICAgICAgICAgICAgIGlmICh2YWxz\nW3BrSWR4XSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyB0aGUg\nb2lkIGRhdGEgaXMgbG9hZGVkIGJ5IHRoZSBiYXNlIHR5cGUsIGJ1dCBpZiBk\naXNjcmltaW5hdG9yIGRhdGEKICAgICAgICAvLyBpcyBwcmVzZW50LCBtYWtl\nIHN1cmUgdG8gdXNlIGl0IHRvIGNvbnN0cnVjdCB0aGUgYWN0dWFsIG9pZCBp\nbnN0YW5jZQogICAgICAgIC8vIHNvIHRoYXQgd2UgZ2V0IHRoZSBjb3JyZWN0\nIGFwcCBpZCBjbGFzcywgZXRjCiAgICAgICAgQ2xhc3NNYXBwaW5nIGRjbHMg\nPSBjbHM7CiAgICAgICAgaWYgKHN1YnMpIHsKICAgICAgICAgICAgcmVzLnN0\nYXJ0RGF0YVJlcXVlc3QoY2xzLmdldERpc2NyaW1pbmF0b3IoKSk7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBDbGFzcyBkdHlwZSA9IGNs\ncy5nZXREaXNjcmltaW5hdG9yKCkuZ2V0Q2xhc3Moc3RvcmUsIGNscywgcmVz\nKTsKICAgICAgICAgICAgICAgIGlmIChkdHlwZSAhPSBjbHMuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKQogICAgICAgICAgICAgICAgICBkY2xzID0gY2xzLmdldE1h\ncHBpbmdSZXBvc2l0b3J5KCkuZ2V0TWFwcGluZyhkdHlwZSwgCiAgICAgICAg\nICAgICAgICAgICAgc3RvcmUuZ2V0Q29udGV4dCgpLmdldENsYXNzTG9hZGVy\nKCksIHRydWUpOyAKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIC8vIGludGVudGlvbmFsbHkgaWdub3JlZAog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcy5lbmREYXRhUmVxdWVzdCgp\nOyAgCiAgICAgICAgfQogICAgICAgIE9iamVjdCBvaWQgPSBBcHBsaWNhdGlv\nbklkcy5mcm9tUEtWYWx1ZXModmFscywgZGNscyk7CiAgICAgICAgaWYgKG9p\nZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkgewogICAgICAgICAgICAoKE9wZW5K\nUEFJZCkgb2lkKS5zZXRNYW5hZ2VkSW5zdGFuY2VUeXBlKGRjbHMuZ2V0RGVz\nY3JpYmVkVHlwZSgpLCAKICAgICAgICAgICAgICAgIHN1YnMpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gb2lkOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBnaXZlbiBjb2x1bW4gdmFsdWUocykgZm9yIHRoZSBnaXZl\nbiBvYmplY3QuIFRoZSBnaXZlbgogICAgICogY29sdW1ucyB3aWxsIGJlIHBy\naW1hcnkga2V5IGNvbHVtbnMgb2YgdGhpcyBtYXBwaW5nLCBidXQgbWF5IGJl\nIGluCiAgICAgKiBhbnkgb3JkZXIuIElmIHRoZXJlIGlzIG9ubHkgb25lIGNv\nbHVtbiwgcmV0dXJuIGl0cyB2YWx1ZS4gSWYgdGhlcmUKICAgICAqIGFyZSBt\ndWx0aXBsZSBjb2x1bW5zLCByZXR1cm4gYW4gb2JqZWN0IGFycmF5IG9mIHRo\nZWlyIHZhbHVlcywgaW4gdGhlCiAgICAgKiBzYW1lIG9yZGVyIHRoZSBjb2x1\nbW5zIGFyZSBnaXZlbi4KICAgICAqLwogICAgcHVibGljIE9iamVjdCB0b0Rh\ndGFTdG9yZVZhbHVlKE9iamVjdCBvYmosIENvbHVtbltdIGNvbHMsIEpEQkNT\ndG9yZSBzdG9yZSkgewogICAgICAgIE9iamVjdCByZXQgPSAoY29scy5sZW5n\ndGggPT0gMSkgPyBudWxsIDogbmV3IE9iamVjdFtjb2xzLmxlbmd0aF07Cgog\nICAgICAgIC8vIGluIHRoZSBwYXN0IHdlJ3ZlIGJlZW4gbGVuaWVudCBhYm91\ndCBiZWluZyBhYmxlIHRvIHRyYW5zbGF0ZSBvYmplY3RzCiAgICAgICAgLy8g\nZnJvbSBvdGhlciBwZXJzaXN0ZW5jZSBjb250ZXh0cywgc28gdHJ5IHRvIGdl\ndCBzbSBkaXJlY3RseSBmcm9tCiAgICAgICAgLy8gaW5zdGFuY2UgYmVmb3Jl\nIGFza2luZyBvdXIgY29udGV4dAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc207CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9i\naikpIHsKICAgICAgICAJUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gSW1wbEhl\nbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosCiAgICAgICAgICAgICAg\nICAgICAgZ2V0UmVwb3NpdG9yeSgpLmdldENvbmZpZ3VyYXRpb24oKSk7CiAg\nICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpIHBjLnBjR2V0\nU3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIAlyZXQgPSBnZXRWYWx1ZUZyb21Vbm1hbmFnZWRJbnN0\nYW5jZShvYmosIGNvbHMsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKHNtLmlzRGV0YWNoZWQoKSkgewogICAgICAgICAgICAJb2JqID0gc3RvcmUu\nZ2V0Q29udGV4dCgpLmZpbmQoc20uZ2V0T2JqZWN0SWQoKSwgZmFsc2UsIG51\nbGwpOwogICAgICAgICAgICAJc20gPSBzdG9yZS5nZXRDb250ZXh0KCkuZ2V0\nU3RhdGVNYW5hZ2VyKG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBzbSA9IHN0b3JlLmdldENvbnRleHQoKS5nZXRT\ndGF0ZU1hbmFnZXIob2JqKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNtID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiByZXQ7CgogICAgICAgIE9iamVj\ndCB2YWw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIHZhbCA9IGFzc2VydEpvaW5hYmxlKGNv\nbHNbaV0pLmdldEpvaW5WYWx1ZShzbSwgY29sc1tpXSwgc3RvcmUpOwogICAg\nICAgICAgICBpZiAoY29scy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgICAg\nIHJldCA9IHZhbDsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nKChPYmplY3RbXSkgcmV0KVtpXSA9IHZhbDsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHJldDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGpvaW5hYmxlIGZvciB0aGUgZ2l2ZW4gY29sdW1uLCBvciB0aHJvdyBh\nbiBleGNlcHRpb24gaWYKICAgICAqIG5vbmUgaXMgYXZhaWxhYmxlLgogICAg\nICovCiAgICBwdWJsaWMgSm9pbmFibGUgYXNzZXJ0Sm9pbmFibGUoQ29sdW1u\nIGNvbCkgewogICAgICAgIEpvaW5hYmxlIGpvaW4gPSBnZXRKb2luYWJsZShj\nb2wpOwogICAgICAgIGlmIChqb2luID09IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tam9pbmFi\nbGUiLAogICAgICAgICAgICAgICAgY29sLmdldEZ1bGxOYW1lKCkpKTsKICAg\nICAgICByZXR1cm4gam9pbjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUge0BsaW5rIEpvaW5hYmxlfSBmb3IgdGhlIGdpdmVuIGNvbHVtbi4g\nQW55IGNvbHVtbiB0aGF0CiAgICAgKiBhbm90aGVyIG1hcHBpbmcgam9pbnMg\ndG8gbXVzdCBiZSBjb250cm9sbGVkIGJ5IGEgam9pbmFibGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBKb2luYWJsZSBnZXRKb2luYWJsZShDb2x1bW4gY29sKSB7\nCiAgICAgICAgSm9pbmFibGUgam9pbjsKICAgICAgICBpZiAoZ2V0RW1iZWRk\naW5nTWV0YURhdGEoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGpvaW4gPSBn\nZXRFbWJlZGRpbmdNYXBwaW5nKCkuZ2V0RmllbGRNYXBwaW5nKCkuCiAgICAg\nICAgICAgICAgICBnZXREZWZpbmluZ01hcHBpbmcoKS5nZXRKb2luYWJsZShj\nb2wpOwogICAgICAgICAgICBpZiAoam9pbiAhPSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGpvaW47CiAgICAgICAgfQogICAgICAgIENsYXNzTWFw\ncGluZyBzdXAgPSBnZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsK\nICAgICAgICBpZiAoc3VwICE9IG51bGwpIHsKICAgICAgICAgICAgam9pbiA9\nIHN1cC5nZXRKb2luYWJsZShjb2wpOwogICAgICAgICAgICBpZiAoam9pbiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGpvaW47CiAgICAgICAg\nfQogICAgICAgIHJldHVybiAoSm9pbmFibGUpIF9qb2luYWJsZXMuZ2V0KGNv\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIGNvbHVt\nbi10by1qb2luYWJsZSBtYXBwaW5nLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRKb2luYWJsZShDb2x1bW4gY29sLCBKb2luYWJsZSBqb2luYWJsZSkg\newogICAgICAgIC8vIGRvbid0IGxldCBub24tcGsgb3ZlcnJpZGUgcGsKICAg\nICAgICBKb2luYWJsZSBqb2luID0gKEpvaW5hYmxlKSBfam9pbmFibGVzLmdl\ndChjb2wpOwogICAgICAgIGlmIChqb2luID09IG51bGwgfHwgKGpvaW4uZ2V0\nRmllbGRJbmRleCgpICE9IC0xCiAgICAgICAgICAgICYmIGdldEZpZWxkKGpv\naW4uZ2V0RmllbGRJbmRleCgpKS5nZXRQcmltYXJ5S2V5SW5kZXgoKSA9PSAt\nMSkpCiAgICAgICAgICAgIF9qb2luYWJsZXMucHV0KGNvbCwgam9pbmFibGUp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGNv\nbHVtbnMgb2YgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IHRvIHRoaXMgbWFwcGlu\nZwogICAgICogY2FuIGJlIHVzZWQgdG8gY29uc3RydWN0IGFuIG9iamVjdCBp\nZCBmb3IgdGhpcyB0eXBlLiBUaGlzIGlzIGEKICAgICAqIHJlbGF0aXZlbHkg\nZXhwZW5zaXZlIG9wZXJhdGlvbjsgaXRzIHJlc3VsdHMgc2hvdWxkIGJlIGNh\nY2hlZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHtAbGluayBCb29sZWFuI1RS\nVUV9IGlmIHRoZSBmb3JlaWduIGtleSBjb250YWlucyBhbGwgb2lkCiAgICAg\nKiBjb2x1bW5zLCA8Y29kZT5udWxsPC9jb2RlPiBpZiBpdCBjb250YWlucyBv\nbmx5IHNvbWUgY29sdW1ucywKICAgICAqIG9yIHtAbGluayBCb29sZWFuI0ZB\nTFNFfSBpZiBpdCBjb250YWlucyBub24tb2lkIGNvbHVtbnMKICAgICAqLwog\nICAgcHVibGljIEJvb2xlYW4gaXNGb3JlaWduS2V5T2JqZWN0SWQoRm9yZWln\nbktleSBmaykgewogICAgICAgIC8vIGlmIHRoaXMgbWFwcGluZydzIHByaW1h\ncnkga2V5IGNhbid0IGNvbnN0cnVjdCBhbiBvaWQsIHRoZW4gbm8gd2F5CiAg\nICAgICAgLy8gZm9yZWlnbiBrZXkgY2FuCiAgICAgICAgaWYgKGdldElkZW50\naXR5VHlwZSgpID09IElEX1VOS05PV04gfHwgIWlzUHJpbWFyeUtleU9iamVj\ndElkKGZhbHNlKSkKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7\nCgogICAgICAgIC8vIHdpdGggZGF0YXN0b3JlIGlkZW50aXR5LCBpdCdzIGFs\nbCBvciBub3RoaW5nCiAgICAgICAgQ29sdW1uW10gY29scyA9IGZrLmdldFBy\naW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgaWYgKGdldElkZW50aXR5VHlw\nZSgpID09IElEX0RBVEFTVE9SRSkgewogICAgICAgICAgICBpZiAoY29scy5s\nZW5ndGggIT0gMSB8fCBjb2xzWzBdICE9IGdldFByaW1hcnlLZXlDb2x1bW5z\nKClbMF0pCiAgICAgICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsK\nICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGNoZWNrIHRoZSBqb2luIG1hcHBpbmcgZm9yIGVhY2ggcGsg\nY29sdW1uIHRvIHNlZSBpZiBpdCBsaW5rcyB1cCB0bwogICAgICAgIC8vIGEg\ncHJpbWFyeSBrZXkgZmllbGQKICAgICAgICBKb2luYWJsZSBqb2luOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBqb2luID0gYXNzZXJ0Sm9pbmFibGUoY29sc1tpXSk7CiAg\nICAgICAgICAgIGlmIChqb2luLmdldEZpZWxkSW5kZXgoKSAhPSAtMQogICAg\nICAgICAgICAgICAgJiYgZ2V0RmllbGQoam9pbi5nZXRGaWVsZEluZGV4KCkp\nLmdldFByaW1hcnlLZXlJbmRleCgpID09IC0xKQogICAgICAgICAgICAgICAg\ncmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfQoKICAgICAgICAvLyBp\nZiBhbGwgcHJpbWFyeSBrZXkgbGlua3MsIHNlZSB3aGV0aGVyIHdlIGpvaW4g\ndG8gYWxsIHBrcwogICAgICAgIGlmIChpc1ByaW1hcnlLZXlPYmplY3RJZCh0\ncnVlKQogICAgICAgICAgICAmJiBjb2xzLmxlbmd0aCA9PSBnZXRQcmltYXJ5\nS2V5Q29sdW1ucygpLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIEJvb2xl\nYW4uVFJVRTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvLy8v\nLy8vCiAgICAvLyBPUk0KICAgIC8vLy8vLy8KCiAgICAvKioKICAgICAqIFJh\ndyBtYXBwaW5nIGRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01hcHBp\nbmdJbmZvIGdldE1hcHBpbmdJbmZvKCkgewogICAgICAgIHJldHVybiBfaW5m\nbzsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzdHJhdGVneSB1c2VkIHRv\nIG1hcCB0aGlzIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc1N0\ncmF0ZWd5IGdldFN0cmF0ZWd5KCkgewogICAgICAgIHJldHVybiBfc3RyYXRl\nZ3k7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc3RyYXRlZ3kgdXNlZCB0\nbyBtYXAgdGhpcyBtYXBwaW5nLiBUaGUgPGNvZGU+YWRhcHQ8L2NvZGU+CiAg\nICAgKiBwYXJhbWV0ZXIgZGV0ZXJtaW5lcyB3aGV0aGVyIHRvIGFkYXB0IHdo\nZW4gbWFwcGluZyB0aGUgc3RyYXRlZ3k7CiAgICAgKiB1c2UgbnVsbCBpZiB0\naGUgc3RyYXRlZ3kgc2hvdWxkIG5vdCBiZSBtYXBwZWQuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldFN0cmF0ZWd5KENsYXNzU3RyYXRlZ3kgc3RyYXRl\nZ3ksIEJvb2xlYW4gYWRhcHQpIHsKICAgICAgICAvLyBzZXQgc3RyYXRlZ3kg\nZmlyc3Qgc28gd2UgY2FuIGFjY2VzcyBpdCBkdXJpbmcgbWFwcGluZwogICAg\nICAgIENsYXNzU3RyYXRlZ3kgb3JpZyA9IF9zdHJhdGVneTsKICAgICAgICBf\nc3RyYXRlZ3kgPSBzdHJhdGVneTsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0g\nbnVsbCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3Ry\nYXRlZ3kuc2V0Q2xhc3NNYXBwaW5nKHRoaXMpOwogICAgICAgICAgICAgICAg\naWYgKGFkYXB0ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgc3RyYXRl\nZ3kubWFwKGFkYXB0LmJvb2xlYW5WYWx1ZSgpKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAg\nLy8gcmVzZXQgc3RyYXRlZ3kKICAgICAgICAgICAgICAgIF9zdHJhdGVneSA9\nIG9yaWc7CiAgICAgICAgICAgICAgICB0aHJvdyByZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtYXBwaW5n\nJ3MgcHJpbWFyeSB0YWJsZS4KICAgICAqLwogICAgcHVibGljIFRhYmxlIGdl\ndFRhYmxlKCkgewogICAgICAgIHJldHVybiBfdGFibGU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgbWFwcGluZydzIHByaW1hcnkgdGFibGUuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFRhYmxlKFRhYmxlIHRhYmxlKSB7CiAg\nICAgICAgX3RhYmxlID0gdGFibGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgY29sdW1ucyB0aGlzIG1hcHBpbmcgdXNlcyB0byB1bmlxdWVseSBpZGVu\ndGlmeSBhbiBvYmplY3QuCiAgICAgKiBUaGVzZSB3aWxsIHR5cGljYWxseSBi\nZSB0aGUgcHJpbWFyeSBrZXkgY29sdW1ucyBvciB0aGUgY29sdW1ucyB0aGlz\nCiAgICAgKiBjbGFzcyB1c2VzIHRvIGxpbmsgdG8gaXRzIHN1cGVyY2xhc3Mg\ndGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRQcmltYXJ5\nS2V5Q29sdW1ucygpIHsKICAgICAgICBpZiAoX2NvbHMubGVuZ3RoID09IDAg\nJiYgZ2V0SWRlbnRpdHlUeXBlKCkgPT0gSURfQVBQTElDQVRJT04KICAgICAg\nICAgICAgJiYgaXNNYXBwZWQoKSkgewogICAgICAgICAgICBGaWVsZE1hcHBp\nbmdbXSBwa3MgPSBnZXRQcmltYXJ5S2V5RmllbGRNYXBwaW5ncygpOwogICAg\nICAgICAgICBDb2xsZWN0aW9uIGNvbHMgPSBuZXcgQXJyYXlMaXN0KHBrcy5s\nZW5ndGgpOwogICAgICAgICAgICBDb2x1bW5bXSBmaWVsZENvbHM7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGtzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgICAgICBmaWVsZENvbHMgPSBwa3NbaV0uZ2V0Q29sdW1u\ncygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBmaWVs\nZENvbHMubGVuZ3RoOyBqKyspCiAgICAgICAgICAgICAgICAgICAgY29scy5h\nZGQoZmllbGRDb2xzW2pdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBf\nY29scyA9IChDb2x1bW5bXSkgY29scy50b0FycmF5KG5ldyBDb2x1bW5bY29s\ncy5zaXplKCldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jb2xzOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIGNvbHVtbnMgdGhpcyBtYXBwaW5n\nIHVzZXMgdG8gdW5pcXVlbHkgaWRlbnRpZnkgYW4gb2JqZWN0LgogICAgICog\nVGhlc2Ugd2lsbCB0eXBpY2FsbHkgYmUgdGhlIHByaW1hcnkga2V5IGNvbHVt\nbnMgb3IgdGhlIGNvbHVtbnMgdGhpcwogICAgICogY2xhc3MgdXNlcyB0byBs\naW5rIHRvIGl0cyBzdXBlcmNsYXNzIHRhYmxlLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRQcmltYXJ5S2V5Q29sdW1ucyhDb2x1bW5bXSBjb2xzKSB7\nCiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCkKICAgICAgICAgICAgY29scyA9\nIFNjaGVtYXMuRU1QVFlfQ09MVU1OUzsKICAgICAgICBfY29scyA9IGNvbHM7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJL08gaW5mb3JtYXRpb24gb24gdGhl\nIGtleSBjb2x1bW5zIC8gam9pbiBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyBD\nb2x1bW5JTyBnZXRDb2x1bW5JTygpIHsKICAgICAgICByZXR1cm4gKF9pbyA9\nPSBudWxsKSA/IENvbHVtbklPLlVOUkVTVFJJQ1RFRCA6IF9pbzsKICAgIH0K\nCiAgICAvKioKICAgICAqIEkvTyBpbmZvcm1hdGlvbiBvbiB0aGUga2V5IGNv\nbHVtbnMgLyBqb2luIGtleS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nQ29sdW1uSU8oQ29sdW1uSU8gaW8pIHsKICAgICAgICBfaW8gPSBpbzsKICAg\nIH0KCiAgICAvKioKICAgICAqIEZvcmVpZ24ga2V5IGxpbmtpbmcgdGhlIHBy\naW1hcnkga2V5IGNvbHVtbnMgdG8gdGhlIHN1cGVyY2xhc3MgdGFibGUsCiAg\nICAgKiBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBGb3Jl\naWduS2V5IGdldEpvaW5Gb3JlaWduS2V5KCkgewogICAgICAgIHJldHVybiBf\nZms7CiAgICB9CgogICAgLyoqCiAgICAgKiBGb3JlaWduIGtleSBsaW5raW5n\nIHRoZSBwcmltYXJ5IGtleSBjb2x1bW5zIHRvIHRoZSBzdXBlcmNsYXNzIHRh\nYmxlLAogICAgICogb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRKb2luRm9yZWlnbktleShGb3JlaWduS2V5IGZrKSB7CiAg\nICAgICAgX2ZrID0gZms7CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVmU2No\nZW1hQ29tcG9uZW50cygpIHsKICAgICAgICBpZiAoZ2V0RW1iZWRkaW5nTWV0\nYURhdGEoKSA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfdGFibGUgIT0g\nbnVsbCAmJiBfdGFibGUuZ2V0UHJpbWFyeUtleSgpICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBfdGFibGUuZ2V0UHJpbWFyeUtleSgpLnJlZigpOwogICAg\nICAgICAgICBpZiAoX2ZrICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZmsu\ncmVmKCk7CiAgICAgICAgICAgIENvbHVtbltdIHBrcyA9IGdldFByaW1hcnlL\nZXlDb2x1bW5zKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\ncGtzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgcGtzW2ldLnJlZigp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZ1td\nIGZpZWxkcyA9IGdldEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICBmaWVsZHNbaV0ucmVmU2NoZW1hQ29tcG9uZW50cygpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIG1hcHBpbmcgaW5m\nb3JtYXRpb24sIGluY2x1ZGluZyBzdHJhdGVneS4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgY2xlYXJNYXBwaW5nKCkgewogICAgICAgIF9zdHJhdGVneSA9\nIG51bGw7CiAgICAgICAgX2NvbHMgPSBTY2hlbWFzLkVNUFRZX0NPTFVNTlM7\nCiAgICAgICAgX2ZrID0gbnVsbDsKICAgICAgICBfdGFibGUgPSBudWxsOwog\nICAgICAgIF9pbmZvLmNsZWFyKCk7CiAgICAgICAgc2V0UmVzb2x2ZShNT0RF\nX01BUFBJTkcgfCBNT0RFX01BUFBJTkdfSU5JVCwgZmFsc2UpOwogICAgfQoK\nICAgIC8qKgogICAgICogVXBkYXRlIHtAbGluayBNYXBwaW5nSW5mb30gd2l0\naCBvdXIgY3VycmVudCBtYXBwaW5nIGluZm9ybWF0aW9uLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzeW5jTWFwcGluZ0luZm8oKSB7CiAgICAgICAgaWYg\nKGdldEVtYmVkZGluZ01ldGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAg\nX2luZm8uc3luY1dpdGgodGhpcyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIF9pbmZvLmNsZWFyKCk7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZ1td\nIGZpZWxkcyA9IGdldEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICBmaWVsZHNbaV0uc3luY01hcHBpbmdJbmZvKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE1l\ndGFEYXRhIGludGVyZmFjZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoK\nICAgIHByb3RlY3RlZCB2b2lkIHNldERlc2NyaWJlZFR5cGUoQ2xhc3MgdHlw\nZSkgewogICAgICAgIHN1cGVyLnNldERlc2NyaWJlZFR5cGUodHlwZSk7CiAg\nICAgICAgLy8gdGhpcyBtZXRob2QgY2FsbGVkIGZyb20gc3VwZXJjbGFzcyBj\nb25zdHJ1Y3Rvciwgc28gX2luZm8gbm90IHlldAogICAgICAgIC8vIGluaXRp\nYWxpemVkCiAgICAgICAgaWYgKF9pbmZvICE9IG51bGwpCiAgICAgICAgICAg\nIF9pbmZvLnNldENsYXNzTmFtZSh0eXBlLmdldE5hbWUoKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgc3ViY2xhc3MgZmV0Y2ggbW9kZSwgYXMgb25l\nIG9mIHRoZSBlYWdlciBjb25zdGFudHMgaW4KICAgICAqIHtAbGluayBKREJD\nRmV0Y2hDb25maWd1cmF0aW9ufS4KICAgICAqLwogICAgcHVibGljIGludCBn\nZXRTdWJjbGFzc0ZldGNoTW9kZSgpIHsKICAgICAgICBpZiAoX3N1YmNsYXNz\nTW9kZSA9PSBJbnRlZ2VyLk1BWF9WQUxVRSkgewogICAgICAgICAgICBpZiAo\nZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9z\ndWJjbGFzc01vZGUgPSBnZXRQQ1N1cGVyY2xhc3NNYXBwaW5nKCkuCiAgICAg\nICAgICAgICAgICAgICAgZ2V0U3ViY2xhc3NGZXRjaE1vZGUoKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgX3N1YmNsYXNzTW9kZSA9IEZl\ndGNoQ29uZmlndXJhdGlvbi5ERUZBVUxUOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gX3N1YmNsYXNzTW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBzdWJjbGFzcyBmZXRjaCBtb2RlLCBhcyBvbmUgb2YgdGhlIGVhZ2VyIGNv\nbnN0YW50cyBpbgogICAgICoge0BsaW5rIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb259LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTdWJjbGFzc0ZldGNo\nTW9kZShpbnQgbW9kZSkgewogICAgICAgIF9zdWJjbGFzc01vZGUgPSBtb2Rl\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRv\nIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0\nYSNnZXRSZXBvc2l0b3J5fS4KICAgICAqLwogICAgcHVibGljIE1hcHBpbmdS\nZXBvc2l0b3J5IGdldE1hcHBpbmdSZXBvc2l0b3J5KCkgewogICAgICAgIHJl\ndHVybiAoTWFwcGluZ1JlcG9zaXRvcnkpIGdldFJlcG9zaXRvcnkoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJm\nb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0\nRW1iZWRkaW5nTWV0YURhdGF9CiAgICAgKi8KICAgIHB1YmxpYyBWYWx1ZU1h\ncHBpbmcgZ2V0RW1iZWRkaW5nTWFwcGluZygpIHsKICAgICAgICByZXR1cm4g\nKFZhbHVlTWFwcGluZykgZ2V0RW1iZWRkaW5nTWV0YURhdGEoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGNsYXNzIGRv\nZXMgbm90IHVzZSB0aGUgIm5vbmUiIHN0cmF0ZWd5IChpbmNsdWRpbmcKICAg\nICAqIGlmIGl0IGhhcyBhIG51bGwgc3RyYXRlZ3ksIGFuZCB0aGVyZWZvcmUg\naXMgcHJvYmFibHkgaW4gdGhlIHByb2Nlc3Mgb2YKICAgICAqIGJlaW5nIG1h\ncHBlZCkuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzTWFwcGVkKCkg\newogICAgICAgIGlmICghc3VwZXIuaXNNYXBwZWQoKSkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChfc3RyYXRlZ3kgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIF9zdHJhdGVneSAhPSBOb25lQ2xhc3NTdHJh\ndGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAgIHJldHVybiAhTm9uZUNsYXNz\nU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKF9pbmZvLmdldFN0cmF0ZWd5KCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBl\ncmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNn\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YX0uCiAgICAgKi8KICAgIHB1YmxpYyBD\nbGFzc01hcHBpbmcgZ2V0UENTdXBlcmNsYXNzTWFwcGluZygpIHsKICAgICAg\nICByZXR1cm4gKENsYXNzTWFwcGluZykgZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhv\nZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNzTWV0\nYURhdGEjZ2V0TWFwcGVkUENTdXBlcmNsYXNzTWV0YURhdGF9LgogICAgICov\nCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nIGdldE1hcHBlZFBDU3VwZXJjbGFz\nc01hcHBpbmcoKSB7CiAgICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmcpIGdl\ndE1hcHBlZFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIG5lYXJlc3QgbWFwcGVkIHN1cGVyY2xhc3Mg\ndGhhdCBjYW4gam9pbiB0byB0aGlzIGNsYXNzLgogICAgICovCiAgICBwdWJs\naWMgQ2xhc3NNYXBwaW5nIGdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpIHsKICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gZ2V0TWFwcGVkUENT\ndXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChzdXAgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKF9mayAhPSBu\ndWxsIHx8IF90YWJsZSA9PSBudWxsIHx8IF90YWJsZS5lcXVhbHMoc3VwLmdl\ndFRhYmxlKCkpKQogICAgICAgICAgICByZXR1cm4gc3VwOwogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2Ug\nbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xh\nc3NNZXRhRGF0YSNnZXRQQ1N1YmNsYXNzTWV0YURhdGFzfS4KICAgICAqLwog\nICAgcHVibGljIENsYXNzTWFwcGluZ1tdIGdldFBDU3ViY2xhc3NNYXBwaW5n\ncygpIHsKICAgICAgICByZXR1cm4gKENsYXNzTWFwcGluZ1tdKSBnZXRQQ1N1\nYmNsYXNzTWV0YURhdGFzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtA\nbGluayBDbGFzc01ldGFEYXRhI2dldE1hcHBlZFBDU3ViY2xhc3NNZXRhRGF0\nYXN9LgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nW10gZ2V0TWFw\ncGVkUENTdWJjbGFzc01hcHBpbmdzKCkgewogICAgICAgIHJldHVybiAoQ2xh\nc3NNYXBwaW5nW10pIGdldE1hcHBlZFBDU3ViY2xhc3NNZXRhRGF0YXMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBtYXBwZWQgc3ViY2xhc3Nl\ncyB0aGF0IGFyZSByZWFjaGFibGUgdmlhIGpvaW5zLgogICAgICovCiAgICBw\ndWJsaWMgQ2xhc3NNYXBwaW5nW10gZ2V0Sm9pbmFibGVQQ1N1YmNsYXNzTWFw\ncGluZ3MoKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10gc3VicyA9IGdldE1h\ncHBlZFBDU3ViY2xhc3NNYXBwaW5ncygpOyAvLyBjaGVja3MgZm9yIG5ldwog\nICAgICAgIGlmIChfam9pblN1Yk1hcHMgPT0gbnVsbCkgewogICAgICAgICAg\nICBpZiAoc3Vicy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgIF9qb2lu\nU3ViTWFwcyA9IHN1YnM7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAg\nICAgICAgTGlzdCBqb2luYWJsZSA9IG5ldyBBcnJheUxpc3Qoc3Vicy5sZW5n\ndGgpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdWJz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGlmIChpc1N1Ykpv\naW5hYmxlKHN1YnNbaV0pKQogICAgICAgICAgICAgICAgICAgICAgICBqb2lu\nYWJsZS5hZGQoc3Vic1tpXSk7CiAgICAgICAgICAgICAgICBfam9pblN1Yk1h\ncHMgPSAoQ2xhc3NNYXBwaW5nW10pIGpvaW5hYmxlLnRvQXJyYXkKICAgICAg\nICAgICAgICAgICAgICAobmV3IENsYXNzTWFwcGluZ1tqb2luYWJsZS5zaXpl\nKCldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX2pvaW5TdWJNYXBzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdo\nZXRoZXIgd2UgY2FuIHJlYWNoIHRoZSBnaXZlbiBzdWJjbGFzcyB2aWEgam9p\nbnMuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc1N1YkpvaW5hYmxl\nKENsYXNzTWFwcGluZyBzdWIpIHsKICAgICAgICBpZiAoc3ViID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoc3ViID09\nIHRoaXMpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVy\nbiBpc1N1YkpvaW5hYmxlKHN1Yi5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01h\ncHBpbmcoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBj\nbG9zZXN0LWRlcml2ZWQgbGlzdCBvZiBub24taW50ZXItam9pbmFibGUgbWFw\ncGVkIHR5cGVzCiAgICAgKiBhc3NpZ25hYmxlIHRvIHRoaXMgdHlwZS4gTWF5\nIHJldHVybiB0aGlzIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFz\nc01hcHBpbmdbXSBnZXRJbmRlcGVuZGVudEFzc2lnbmFibGVNYXBwaW5ncygp\nIHsKICAgICAgICBDbGFzc01hcHBpbmdbXSBzdWJzID0gZ2V0TWFwcGVkUENT\ndWJjbGFzc01hcHBpbmdzKCk7IC8vIGNoZWNrcyBmb3IgbmV3CiAgICAgICAg\naWYgKF9hc3NpZ25NYXBzID09IG51bGwpIHsKICAgICAgICAgICAgLy8gcmVt\nb3ZlIHVubWFwcGVkIHN1YnMKICAgICAgICAgICAgaWYgKHN1YnMubGVuZ3Ro\nID09IDApIHsKICAgICAgICAgICAgICAgIGlmIChpc01hcHBlZCgpKQogICAg\nICAgICAgICAgICAgICAgIF9hc3NpZ25NYXBzID0gbmV3IENsYXNzTWFwcGlu\nZ1tdeyB0aGlzIH07CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgX2Fzc2lnbk1hcHMgPSBzdWJzOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgaW50IHNpemUgPSAoaW50KSAoc3Vicy5s\nZW5ndGggKiAxLjMzICsgMik7CiAgICAgICAgICAgICAgICBTZXQgaW5kZXBl\nbmRlbnQgPSBuZXcgTGlua2VkSGFzaFNldChzaXplKTsKICAgICAgICAgICAg\nICAgIGlmIChpc01hcHBlZCgpKQogICAgICAgICAgICAgICAgICAgIGluZGVw\nZW5kZW50LmFkZCh0aGlzKTsKICAgICAgICAgICAgICAgIGluZGVwZW5kZW50\nLmFkZEFsbChBcnJheXMuYXNMaXN0KHN1YnMpKTsKCiAgICAgICAgICAgICAg\nICAvLyByZW1vdmUgYWxsIG1hcHBpbmdzIHRoYXQgaGF2ZSBhIHN1cGVyY2xh\nc3MgbWFwcGluZyBpbiB0aGUgc2V0CiAgICAgICAgICAgICAgICBDbGFzc01h\ncHBpbmcgbWFwLCBzdXA7CiAgICAgICAgICAgICAgICBMaXN0IGNsZWFyID0g\nbnVsbDsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gaW5k\nZXBlbmRlbnQuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgICAgICBtYXAgPSAoQ2xhc3NNYXBwaW5nKSBpdHIubmV4dCgp\nOwogICAgICAgICAgICAgICAgICAgIHN1cCA9IG1hcC5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nc3VwICE9IG51bGwgJiYgaW5kZXBlbmRlbnQuY29udGFpbnMoc3VwKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2xlYXIgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyID0gbmV3IEFycmF5TGlz\ndChpbmRlcGVuZGVudC5zaXplKCkgLSAxKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgY2xlYXIuYWRkKG1hcCk7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNsZWFyICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgaW5kZXBlbmRlbnQucmVtb3Zl\nQWxsKGNsZWFyKTsKCiAgICAgICAgICAgICAgICBfYXNzaWduTWFwcyA9IChD\nbGFzc01hcHBpbmdbXSkgaW5kZXBlbmRlbnQudG9BcnJheQogICAgICAgICAg\nICAgICAgICAgIChuZXcgQ2xhc3NNYXBwaW5nW2luZGVwZW5kZW50LnNpemUo\nKV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nYXNzaWduTWFwczsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNl\nIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbSB7QGxpbmsgQ2xhc3NNZXRh\nRGF0YSNnZXRGaWVsZHN9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBw\naW5nW10gZ2V0RmllbGRNYXBwaW5ncygpIHsKICAgICAgICByZXR1cm4gKEZp\nZWxkTWFwcGluZ1tdKSBnZXRGaWVsZHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQog\nICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0RGVjbGFyZWRGaWVsZHN9\nLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nW10gZ2V0RGVjbGFy\nZWRGaWVsZE1hcHBpbmdzKCkgewogICAgICAgIHJldHVybiAoRmllbGRNYXBw\naW5nW10pIGdldERlY2xhcmVkRmllbGRzKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20K\nICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldFByaW1hcnlLZXlGaWVs\nZHN9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nW10gZ2V0UHJp\nbWFyeUtleUZpZWxkTWFwcGluZ3MoKSB7CiAgICAgICAgcmV0dXJuIChGaWVs\nZE1hcHBpbmdbXSkgZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2Fz\ndCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXRWZXJzaW9u\nRmllbGR9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGdldFZl\ncnNpb25GaWVsZE1hcHBpbmcoKSB7CiAgICAgICAgcmV0dXJuIChGaWVsZE1h\ncHBpbmcpIGdldFZlcnNpb25GaWVsZCgpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAg\nICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXREZWZhdWx0RmV0Y2hHcm91\ncEZpZWxkc30uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmdbXSBn\nZXREZWZhdWx0RmV0Y2hHcm91cEZpZWxkTWFwcGluZ3MoKSB7CiAgICAgICAg\ncmV0dXJuIChGaWVsZE1hcHBpbmdbXSkgZ2V0RGVmYXVsdEZldGNoR3JvdXBG\naWVsZHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1l\ndGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNz\nTWV0YURhdGEjZ2V0RGVmaW5lZEZpZWxkc30uCiAgICAgKi8KICAgIHB1Ymxp\nYyBGaWVsZE1hcHBpbmdbXSBnZXREZWZpbmVkRmllbGRNYXBwaW5ncygpIHsK\nICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZ1tdKSBnZXREZWZpbmVkRmll\nbGRzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRo\nb2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFzc01l\ndGFEYXRhI2dldEZpZWxkc0luTGlzdGluZ09yZGVyfS4KICAgICAqLwogICAg\ncHVibGljIEZpZWxkTWFwcGluZ1tdIGdldEZpZWxkTWFwcGluZ3NJbkxpc3Rp\nbmdPcmRlcigpIHsKICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZ1tdKSBn\nZXRGaWVsZHNJbkxpc3RpbmdPcmRlcigpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAg\nICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXREZWZpbmVkRmllbGRzSW5M\naXN0aW5nT3JkZXJ9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5n\nW10gZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3NJbkxpc3RpbmdPcmRlcigpIHsK\nICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZ1tdKSBnZXREZWZpbmVkRmll\nbGRzSW5MaXN0aW5nT3JkZXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbSB7QGxpbmsg\nQ2xhc3NNZXRhRGF0YSNnZXRGaWVsZH0uCiAgICAgKi8KICAgIHB1YmxpYyBG\naWVsZE1hcHBpbmcgZ2V0RmllbGRNYXBwaW5nKGludCBpbmRleCkgewogICAg\nICAgIHJldHVybiAoRmllbGRNYXBwaW5nKSBnZXRGaWVsZChpbmRleCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVy\nZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dl\ndERlY2xhcmVkRmllbGR9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBw\naW5nIGdldERlY2xhcmVkRmllbGRNYXBwaW5nKGludCBpbmRleCkgewogICAg\nICAgIHJldHVybiAoRmllbGRNYXBwaW5nKSBnZXREZWNsYXJlZEZpZWxkKGlu\nZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhv\nZCB0byBwZXJmb3JtIGNhc3QgZnJvbSB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNn\nZXRGaWVsZH0uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0\nRmllbGRNYXBwaW5nKFN0cmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIChG\naWVsZE1hcHBpbmcpIGdldEZpZWxkKG5hbWUpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9t\nCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXREZWNsYXJlZEZpZWxk\nfS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZyBnZXREZWNsYXJl\nZEZpZWxkTWFwcGluZyhTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVybiAo\nRmllbGRNYXBwaW5nKSBnZXREZWNsYXJlZEZpZWxkKG5hbWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0g\nY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXREZWNs\nYXJlZFVubWFuYWdlZEZpZWxkc30uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVs\nZE1hcHBpbmdbXSBnZXREZWNsYXJlZFVubWFuYWdlZEZpZWxkTWFwcGluZ3Mo\nKSB7CiAgICAgICAgcmV0dXJuIChGaWVsZE1hcHBpbmdbXSkgZ2V0RGVjbGFy\nZWRVbm1hbmFnZWRGaWVsZHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICog\ne0BsaW5rIENsYXNzTWV0YURhdGEjYWRkRGVjbGFyZWRGaWVsZH0uCiAgICAg\nKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgYWRkRGVjbGFyZWRGaWVsZE1h\ncHBpbmcoU3RyaW5nIG5hbWUsIENsYXNzIHR5cGUpIHsKICAgICAgICByZXR1\ncm4gKEZpZWxkTWFwcGluZykgYWRkRGVjbGFyZWRGaWVsZChuYW1lLCB0eXBl\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCByZXNvbHZlTWFwcGluZyhi\nb29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBzdXBlci5yZXNvbHZlTWFwcGlu\nZyhydW50aW1lKTsKCiAgICAgICAgLy8gbWFwIGNsYXNzIHN0cmF0ZWd5OyBp\ndCBtYXkgYWxyZWFkeSBiZSBtYXBwZWQgYnkgdGhlIHJlcG9zaXRvcnkgYmVm\nb3JlCiAgICAgICAgLy8gdGhlIHJlc29sdmUgcHJvY2VzcyBiZWdpbnMKICAg\nICAgICBNYXBwaW5nUmVwb3NpdG9yeSByZXBvcyA9IGdldE1hcHBpbmdSZXBv\nc2l0b3J5KCk7CiAgICAgICAgaWYgKF9zdHJhdGVneSA9PSBudWxsKQogICAg\nICAgICAgICByZXBvcy5nZXRTdHJhdGVneUluc3RhbGxlcigpLmluc3RhbGxT\ndHJhdGVneSh0aGlzKTsKICAgICAgICBMb2cgbG9nID0gZ2V0UmVwb3NpdG9y\neSgpLmdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJzdHJhdGVneSIs\nIHRoaXMsIF9zdHJhdGVneS5nZXRBbGlhcygpKSk7CgogICAgICAgIC8vIG1h\na2Ugc3VyZSB1bm1hcHBlZCBzdXBlcmNsYXNzIGZpZWxkcyBhcmUgZGVmaW5l\nZCBpZiB3ZSdyZSBtYXBwZWQ7CiAgICAgICAgLy8gYWxzbyBtYXkgaGF2ZSBi\nZWVuIGRvbmUgYnkgcmVwb3NpdG9yeSBhbHJlYWR5CiAgICAgICAgZGVmaW5l\nU3VwZXJjbGFzc0ZpZWxkcyhnZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBp\nbmcoKSA9PSBudWxsKTsKCiAgICAgICAgLy8gcmVzb2x2ZSBldmVyeXRoaW5n\nIHRoYXQgZG9lc24ndCByZWx5IG9uIGFueSByZWxhdGlvbnMgdG8gYXZvaWQK\nICAgICAgICAvLyByZWN1cnNpb24sIHRoZW4gcmVzb2x2ZSBhbGwgZmllbGRz\nCiAgICAgICAgcmVzb2x2ZU5vblJlbGF0aW9uTWFwcGluZ3MoKTsKICAgICAg\nICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBnZXRGaWVsZE1hcHBpbmdzKCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgIGlmIChmbXNbaV0uZ2V0RGVmaW5pbmdNZXRhRGF0YSgpID09\nIHRoaXMpCiAgICAgICAgICAgICAgICBmbXNbaV0ucmVzb2x2ZShNT0RFX01B\nUFBJTkcpOwogICAgICAgIGZtcyA9IGdldERlY2xhcmVkVW5tYW5hZ2VkRmll\nbGRNYXBwaW5ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1z\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBmbXNbaV0ucmVzb2x2ZShNT0RF\nX01BUFBJTkcpOwoKICAgICAgICAvLyBtYXJrIG1hcHBlZCBjb2x1bW5zCiAg\nICAgICAgaWYgKF9jb2xzICE9IG51bGwpIHsKICAgICAgICAgICAgQ29sdW1u\nSU8gaW8gPSBnZXRDb2x1bW5JTygpOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAoaW8uaXNJbnNlcnRhYmxlKGksIGZhbHNlKSkKICAgICAgICAgICAg\nICAgICAgICBfY29sc1tpXS5zZXRGbGFnKENvbHVtbi5GTEFHX0RJUkVDVF9J\nTlNFUlQsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGlvLmlzVXBkYXRh\nYmxlKGksIGZhbHNlKSkKICAgICAgICAgICAgICAgICAgICBfY29sc1tpXS5z\nZXRGbGFnKENvbHVtbi5GTEFHX0RJUkVDVF9VUERBVEUsIHRydWUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIG9uY2UgY29sdW1ucyBh\ncmUgcmVzb2x2ZWQsIHJlc29sdmUgdW5pcXVlIGNvbnN0cmFpbnRzIGFzIHRo\nZXkgbmVlZAogICAgICAgIC8vIHRoZSBjb2x1bW5zIGJlIHJlc29sdmVkIAog\nICAgICAgIF9pbmZvLmdldFVuaXF1ZXModGhpcywgdHJ1ZSk7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogUmVzb2x2ZSBub24tcmVsYXRpb24gZmllbGQg\nbWFwcGluZ3Mgc28gdGhhdCB3aGVuIHdlIGRvIHJlbGF0aW9uCiAgICAgKiBt\nYXBwaW5ncyB0aGV5IGNhbiByZWx5IG9uIHRoZW0gZm9yIGpvaW5zLgogICAg\nICovCiAgICB2b2lkIHJlc29sdmVOb25SZWxhdGlvbk1hcHBpbmdzKCkgewog\nICAgICAgIC8vIG1ha2Ugc3VyZSBwcmltYXJ5IGtleSBmaWVsZHMgYXJlIHJl\nc29sdmVkIGZpcnN0IGJlY2F1c2Ugb3RoZXIKICAgICAgICAvLyBmaWVsZHMg\nbWlnaHQgcmVseSBvbiB0aGVtCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1z\nID0gZ2V0UHJpbWFyeUtleUZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nZm1zW2ldLnJlc29sdmUoTU9ERV9NQVBQSU5HKTsKCiAgICAgICAgLy8gcmVz\nb2x2ZSBkZWZpbmVkIGZpZWxkcyB0aGF0IGFyZSBzYWZlOyB0aGF0IGRvbid0\nIHJlbHkgb24gb3RoZXIgdHlwZXMKICAgICAgICAvLyBhbHNvIGJlaW5nIHJl\nc29sdmVkLiAgZG9uJ3QgdXNlIGdldERlZmluZWRGaWVsZHMgYi9jIGl0IHJl\nbGllcyBvbgogICAgICAgIC8vIHdoZXRoZXIgZmllbGRzIGFyZSBtYXBwZWQs\nIHdoaWNoIGlzbid0IGtub3duIHlldAogICAgICAgIGZtcyA9IGdldEZpZWxk\nTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGZtc1tpXS5nZXREZWZpbmlu\nZ01ldGFEYXRhKCkgPT0gdGhpcwogICAgICAgICAgICAgICAgJiYgIWZtc1tp\nXS5pc1R5cGVQQygpICYmICFmbXNbaV0uZ2V0S2V5KCkuaXNUeXBlUEMoKQog\nICAgICAgICAgICAgICAgJiYgIWZtc1tpXS5nZXRFbGVtZW50KCkuaXNUeXBl\nUEMoKSkKICAgICAgICAgICAgICAgIGZtc1tpXS5yZXNvbHZlKE1PREVfTUFQ\nUElORyk7CgogICAgICAgIF9kaXNjcmltLnJlc29sdmUoTU9ERV9NQVBQSU5H\nKTsKICAgICAgICBfdmVyc2lvbi5yZXNvbHZlKE1PREVfTUFQUElORyk7ICAg\nICAgICAKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBpbml0aWFsaXplTWFw\ncGluZygpIHsKICAgICAgICBzdXBlci5pbml0aWFsaXplTWFwcGluZygpOwoK\nICAgICAgICBGaWVsZE1hcHBpbmdbXSBmaWVsZHMgPSBnZXREZWZpbmVkRmll\nbGRNYXBwaW5ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmll\nbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBmaWVsZHNbaV0ucmVzb2x2\nZShNT0RFX01BUFBJTkdfSU5JVCk7CiAgICAgICAgX2Rpc2NyaW0ucmVzb2x2\nZShNT0RFX01BUFBJTkdfSU5JVCk7CiAgICAgICAgX3ZlcnNpb24ucmVzb2x2\nZShNT0RFX01BUFBJTkdfSU5JVCk7CiAgICAgICAgX3N0cmF0ZWd5LmluaXRp\nYWxpemUoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhckRlZmlu\nZWRGaWVsZENhY2hlKCkgewogICAgICAgIC8vIGp1c3QgbWFrZSB0aGlzIG1l\ndGhvZCBhdmFpbGFibGUgdG8gb3RoZXIgY2xhc3NlcyBpbiB0aGlzIHBhY2th\nZ2UKICAgICAgICBzdXBlci5jbGVhckRlZmluZWRGaWVsZENhY2hlKCk7CiAg\nICB9CgogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJTdWJjbGFzc0NhY2hlKCkg\newogICAgICAgIHN1cGVyLmNsZWFyU3ViY2xhc3NDYWNoZSgpOwogICAgICAg\nIF9qb2luU3ViTWFwcyA9IG51bGw7CiAgICAgICAgX2Fzc2lnbk1hcHMgPSBu\ndWxsOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvcHkoQ2xhc3NNZXRhRGF0\nYSBjbHMpIHsKICAgICAgICBzdXBlci5jb3B5KGNscyk7CiAgICAgICAgaWYg\nKF9zdWJjbGFzc01vZGUgPT0gSW50ZWdlci5NQVhfVkFMVUUpCiAgICAgICAg\nICAgIF9zdWJjbGFzc01vZGUgPSAoKENsYXNzTWFwcGluZykgY2xzKS5nZXRT\ndWJjbGFzc0ZldGNoTW9kZSgpOwogICAgfQoKICAgIHByb3RlY3RlZCBib29s\nZWFuIHZhbGlkYXRlRGF0YVN0b3JlRXh0ZW5zaW9uUHJlZml4KFN0cmluZyBw\ncmVmaXgpIHsKICAgICAgICByZXR1cm4gImpkYmMtIi5lcXVhbHMocHJlZml4\nKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwogICAgLy8gQ2xhc3NTdHJhdGVneSBpbXBsZW1lbnRhdGlvbgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgU3Ry\naW5nIGdldEFsaWFzKCkgewogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVn\neSgpLmdldEFsaWFzKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbWFwKGJv\nb2xlYW4gYWRhcHQpIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgpLm1hcChh\nZGFwdCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZSgpIHsK\nICAgICAgICBhc3NlcnRTdHJhdGVneSgpLmluaXRpYWxpemUoKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBpbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydFN0cmF0ZWd5KCku\naW5zZXJ0KHNtLCBzdG9yZSwgcm0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHVwZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3Rv\ncmUsIFJvd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS51cGRhdGUoc20sIHN0b3Jl\nLCBybSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsZXRlKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBy\nbSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3Nl\ncnRTdHJhdGVneSgpLmRlbGV0ZShzbSwgc3RvcmUsIHJtKTsKICAgIH0KCiAg\nICBwdWJsaWMgQm9vbGVhbiBpc0N1c3RvbUluc2VydChPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICByZXR1cm4g\nYXNzZXJ0U3RyYXRlZ3koKS5pc0N1c3RvbUluc2VydChzbSwgc3RvcmUpOwog\nICAgfQoKICAgIHB1YmxpYyBCb29sZWFuIGlzQ3VzdG9tVXBkYXRlKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAg\nIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmlzQ3VzdG9tVXBkYXRlKHNtLCBz\ndG9yZSk7CiAgICB9CgogICAgcHVibGljIEJvb2xlYW4gaXNDdXN0b21EZWxl\ndGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlKSB7\nCiAgICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkuaXNDdXN0b21EZWxl\ndGUoc20sIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjdXN0b21J\nbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3Jl\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2Vy\ndFN0cmF0ZWd5KCkuY3VzdG9tSW5zZXJ0KHNtLCBzdG9yZSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgY3VzdG9tVXBkYXRlKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgpLmN1c3RvbVVwZGF0\nZShzbSwgc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGN1c3RvbURl\nbGV0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0\nU3RyYXRlZ3koKS5jdXN0b21EZWxldGUoc20sIHN0b3JlKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRDbGFzc01hcHBpbmcoQ2xhc3NNYXBwaW5nIG93\nbmVyKSB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5zZXRDbGFzc01hcHBp\nbmcob3duZXIpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUHJpbWFy\neUtleU9iamVjdElkKGJvb2xlYW4gaGFzQWxsKSB7CiAgICAgICAgcmV0dXJu\nIGFzc2VydFN0cmF0ZWd5KCkuaXNQcmltYXJ5S2V5T2JqZWN0SWQoaGFzQWxs\nKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pblN1cGVyY2xhc3MoSm9p\nbnMgam9pbnMsIGJvb2xlYW4gdG9UaGlzKSB7CiAgICAgICAgcmV0dXJuIGFz\nc2VydFN0cmF0ZWd5KCkuam9pblN1cGVyY2xhc3Moam9pbnMsIHRvVGhpcyk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNFYWdlclNlbGVj\ndChTZWxlY3Qgc2VsLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSwgQ2xhc3NNYXBwaW5nIGJhc2UsIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4gYXNzZXJ0\nU3RyYXRlZ3koKS5zdXBwb3J0c0VhZ2VyU2VsZWN0KHNlbCwgc20sIHN0b3Jl\nLCBiYXNlLAogICAgICAgICAgICBmZXRjaCk7CiAgICB9CgogICAgcHVibGlj\nIFJlc3VsdE9iamVjdFByb3ZpZGVyIGN1c3RvbUxvYWQoSkRCQ1N0b3JlIHN0\nb3JlLCBib29sZWFuIHN1YmNsYXNzZXMsCiAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgbG9uZyBzdGFydElkeCwgbG9uZyBlbmRJZHgp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIGFzc2VydFN0cmF0ZWd5KCkuY3VzdG9tTG9hZChzdG9yZSwgc3ViY2xhc3Nl\ncywgZmV0Y2gsCiAgICAgICAgICAgIHN0YXJ0SWR4LCBlbmRJZHgpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGN1c3RvbUxvYWQoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIFBDU3RhdGUg\nc3RhdGUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkuY3VzdG9tTG9hZChz\nbSwgc3RvcmUsIHN0YXRlLCBmZXRjaCk7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gY3VzdG9tTG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJD\nU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgUmVzdWx0IHJlc3VsdCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3koKS5jdXN0b21M\nb2FkKHNtLCBzdG9yZSwgZmV0Y2gsIHJlc3VsdCk7CiAgICB9CiAgICAKICAg\nIHByaXZhdGUgQ2xhc3NTdHJhdGVneSBhc3NlcnRTdHJhdGVneSgpIHsKICAg\nICAgICBpZiAoX3N0cmF0ZWd5ID09IG51bGwpCiAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIHJldHVybiBfc3Ry\nYXRlZ3k7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogRmluZCB0aGUgZmll\nbGQgbWFwcGluZ3MgdGhhdCBjb3JyZXNwb25kIHRvIHRoZSBnaXZlbiBjb2x1\nbW5zLgogICAgICogCiAgICAgKiBAcmV0dXJuIG51bGwgaWYgbm8gY29sdW1u\ncyBhcmUgZ2l2ZW4gb3Igbm8gZmllbGQgbWFwcGluZyB1c2VzIHRoZSBnaXZl\nbgogICAgICogY29sdW1ucy4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PEZp\nZWxkTWFwcGluZz4gZ2V0RmllbGRNYXBwaW5ncyhDb2x1bW5bXSBjb2xzLCBi\nb29sZWFuIHByaW1lKSB7CiAgICAJaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xz\nLmxlbmd0aCA9PSAwKQogICAgCQlyZXR1cm4gbnVsbDsKICAgIAlMaXN0PEZp\nZWxkTWFwcGluZz4gcmVzdWx0ID0gbnVsbDsKICAgIAlmb3IgKENvbHVtbiBj\nIDogY29scykgewogICAgCQlMaXN0PEZpZWxkTWFwcGluZz4gZm1zID0gaGFz\nQ29sdW1uKGMsIHByaW1lKTsKICAgIAkJaWYgKGZtcyA9PSBudWxsKSBjb250\naW51ZTsKCQkJaWYgKHJlc3VsdCA9PSBudWxsKQoJCQkJcmVzdWx0ID0gbmV3\nIEFycmF5TGlzdDxGaWVsZE1hcHBpbmc+KCk7CgkJCWZvciAoRmllbGRNYXBw\naW5nIGZtIDogZm1zKQoJCQkJaWYgKCFyZXN1bHQuY29udGFpbnMoZm0pKQoJ\nCQkJCXJlc3VsdC5hZGQoZm0pOwogICAgCX0KICAgIAlyZXR1cm4gcmVzdWx0\nOwogICAgfQogICAgCiAgICAvKioKICAgICAqIExvb2tzIHVwIGluIHJldmVy\nc2UgdG8gZmluZCB0aGUgbGlzdCBvZiBmaWVsZCBtYXBwaW5ncyB0aGF0IGlu\nY2x1ZGUgdGhlCiAgICAgKiBnaXZlbiBjb2x1bW4uIENvc3RseS4KICAgICAq\nIAogICAgICogQHJldHVybiBudWxsIGlmIG5vIGZpZWxkIG1hcHBpbmdzIGNh\ncnJ5IHRoaXMgY29sdW1uLiAKICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PEZp\nZWxkTWFwcGluZz4gaGFzQ29sdW1uKENvbHVtbiBjLCBib29sZWFuIHByaW1l\nKSB7CiAgICAJTGlzdDxGaWVsZE1hcHBpbmc+IHJlc3VsdCA9IG51bGw7CiAg\nICAJRmllbGRNYXBwaW5nW10gZm1zID0gKHByaW1lKSA/IAogICAgCQlnZXRQ\ncmltYXJ5S2V5RmllbGRNYXBwaW5ncygpIDogZ2V0RmllbGRNYXBwaW5ncygp\nOwogICAgCWZvciAoRmllbGRNYXBwaW5nIGZtIDogZm1zKSB7CiAgICAJCUNv\nbHVtbltdIGNvbHMgPSBmbS5nZXRDb2x1bW5zKCk7CiAgICAJCWlmIChjb250\nYWlucyhjb2xzLCBjKSkgewogICAgCQkJaWYgKHJlc3VsdCA9PSBudWxsKQog\nICAgCQkJCXJlc3VsdCA9IG5ldyBBcnJheUxpc3Q8RmllbGRNYXBwaW5nPigp\nOwogICAgCQkJcmVzdWx0LmFkZChmbSk7CiAgICAJCX0KICAgIAl9CiAgICAJ\ncmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIAogICAgYm9vbGVhbiBjb250YWlu\ncyhDb2x1bW5bXSBjb2xzLCBDb2x1bW4gYykgewogICAgCWZvciAoQ29sdW1u\nIGNvbCA6IGNvbHMpCiAgICAJCWlmIChjb2wgPT0gYykKICAgIAkJCXJldHVy\nbiB0cnVlOwogICAgCXJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBHZXRzIHRoZSBmaWVsZCB2YWx1ZXMgb2YgdGhlIGdpdmVuIGlu\nc3RhbmNlIGZvciB0aGUgZ2l2ZW4gY29sdW1ucy4KICAgICAqIFRoZSBnaXZl\nbiBjb2x1bW5zIGFyZSB1c2VkIHRvIGlkZW50aWZ5IHRoZSBmaWVsZHMgYnkg\nYSByZXZlcnNlIGxvb2t1cC4KICAgICAqICAKICAgICAqIEByZXR1cm4gYSBz\naW5nbGUgb2JqZWN0IG9yIGFuIGFycmF5IG9mIG9iamVjdHMgYmFzZWQgb24g\nbnVtYmVyIG9mIAogICAgICogZmllbGRzIHRoZSBnaXZlbiBjb2x1bW5zIHJl\ncHJlc2VudC4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgZ2V0VmFsdWVG\ncm9tVW5tYW5hZ2VkSW5zdGFuY2UoT2JqZWN0IG9iaiwgQ29sdW1uW10gY29s\ncywgCiAgICAJCWJvb2xlYW4gcHJpbWUpIHsKICAgIAlMaXN0PEZpZWxkTWFw\ncGluZz4gZm1zID0gZ2V0RmllbGRNYXBwaW5ncyhjb2xzLCBwcmltZSk7CiAg\nICAJaWYgKGZtcyA9PSBudWxsKQogICAgCQlyZXR1cm4gbnVsbDsKICAgIAlp\nZiAoZm1zLnNpemUoKSA9PSAxKQogICAgCQlyZXR1cm4gUmVmbGVjdGlvbi5n\nZXRWYWx1ZShvYmosIGZtcy5nZXQoMCkuZ2V0TmFtZSgpLCB0cnVlKTsKICAg\nIAlPYmplY3RbXSByZXN1bHQgPSBuZXcgT2JqZWN0W2Ztcy5zaXplKCldOwog\nICAgCWludCBpID0gMDsKICAgIAlmb3IgKEZpZWxkTWFwcGluZyBmbSA6IGZt\ncykgewogICAgCQlyZXN1bHRbaSsrXSA9IFJlZmxlY3Rpb24uZ2V0VmFsdWUo\nb2JqLCBmbS5nZXROYW1lKCksIHRydWUpOwogICAgCX0KICAgIAlyZXR1cm4g\ncmVzdWx0OwogICAgfQp9Cg==\n","encoding":"base64"}

