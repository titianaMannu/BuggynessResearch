{"sha":"bbd7ef52637c9fc04b9d1e00427ef8c4fd3642cf","node_id":"MDQ6QmxvYjIwNjM2NDpiYmQ3ZWY1MjYzN2M5ZmMwNGI5ZDFlMDA0MjdlZjhjNGZkMzY0MmNm","size":53098,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/bbd7ef52637c9fc04b9d1e00427ef8c4fd3642cf","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1\ncml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Q\ncml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuVHlw\nZXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0\ncmF0cy5CbG9iVmFsdWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5zdHJhdHMuQnl0ZUFycmF5VmFsdWVIYW5kbGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuQ2hh\nckFycmF5U3RyZWFtVmFsdWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5zdHJhdHMuQ2hhckFycmF5VmFsdWVIYW5kbGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMu\nQ2xhc3NOYW1lRGlzY3JpbWluYXRvclN0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuQ2xvYlZhbHVlSGFuZGxl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRz\nLkVsZW1lbnRFbWJlZFZhbHVlSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkVtYmVkRmllbGRTdHJhdGVneTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkVt\nYmVkZGVkQ2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuc3RyYXRzLkZsYXRDbGFzc1N0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRnVsbENsYXNz\nU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLnN0cmF0cy5IYW5kbGVyQ29sbGVjdGlvblRhYmxlRmllbGRTdHJhdGVneTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkhh\nbmRsZXJGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5zdHJhdHMuSGFuZGxlckhhbmRsZXJNYXBUYWJsZUZpZWxk\nU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLnN0cmF0cy5IYW5kbGVyUmVsYXRpb25NYXBUYWJsZUZpZWxkU3RyYXRlZ3k7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5J\nbW11dGFibGVWYWx1ZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5Mb2JGaWVsZFN0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuTWF4RW1iZWRk\nZWRCbG9iRmllbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuc3RyYXRzLk1heEVtYmVkZGVkQnl0ZUFycmF5RmllbGRT\ndHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEu\nc3RyYXRzLk1heEVtYmVkZGVkQ2hhckFycmF5RmllbGRTdHJhdGVneTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLk1heEVt\nYmVkZGVkQ2xvYkZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5OYW5vUHJlY2lzaW9uVGltZXN0YW1w\nVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuTm9uZUNsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5Ob25lRGlzY3JpbWlu\nYXRvclN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5zdHJhdHMuTm9uZUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5Ob25lVmVyc2lvblN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuTnVtYmVyVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5zdHJhdHMuT2JqZWN0SWRDbGFzc1N0cmF0ZWd5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMu\nT2JqZWN0SWRWYWx1ZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5QcmltaXRpdmVGaWVsZFN0cmF0ZWd5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuUmVs\nYXRpb25Db2xsZWN0aW9uSW52ZXJzZUtleUZpZWxkU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5SZWxhdGlv\nbkNvbGxlY3Rpb25UYWJsZUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5SZWxhdGlvbkZpZWxkU3Ry\nYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0\ncmF0cy5SZWxhdGlvbkhhbmRsZXJNYXBUYWJsZUZpZWxkU3RyYXRlZ3k7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5SZWxh\ndGlvbk1hcEludmVyc2VLZXlGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuUmVsYXRpb25NYXBUYWJs\nZUZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLnN0cmF0cy5SZWxhdGlvblJlbGF0aW9uTWFwVGFibGVGaWVsZFN0\ncmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5z\ndHJhdHMuU3RhdGVDb21wYXJpc29uVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuU3RyaW5nRmll\nbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuc3RyYXRzLlN1YmNsYXNzSm9pbkRpc2NyaW1pbmF0b3JTdHJhdGVneTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlN1\ncGVyY2xhc3NEaXNjcmltaW5hdG9yU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5TdXBlcmNsYXNzVmVyc2lv\nblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5zdHJhdHMuVGltZXN0YW1wVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuVW50eXBlZFBDVmFs\ndWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5zdHJhdHMuVmFsdWVNYXBEaXNjcmltaW5hdG9yU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5WZXJ0aWNh\nbENsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbC5Kb2luU3ludGF4ZXM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhYmxlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkphdmFWZXJz\naW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2Nh\nbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFU\neXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRh\nUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk9y\nZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVl\nTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRh\nRGF0YUV4Y2VwdGlvbjsKCi8qKgogKiBSZXBvc2l0b3J5IG9mIG9iamVjdC9y\nZWxhdGlvbmFsIG1hcHBpbmcgaW5mb3JtYXRpb24uCiAqCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgTWFwcGluZ1JlcG9zaXRvcnkK\nICAgIGV4dGVuZHMgTWV0YURhdGFSZXBvc2l0b3J5IHsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQ\nYWNrYWdlCiAgICAgICAgKE1hcHBpbmdSZXBvc2l0b3J5LmNsYXNzKTsKCiAg\nICBwcml2YXRlIHRyYW5zaWVudCBEQkRpY3Rpb25hcnkgX2RpY3QgPSBudWxs\nOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgTWFwcGluZ0RlZmF1bHRzIF9kZWZh\ndWx0cyA9IG51bGw7CiAgICAKICAgIHByaXZhdGUgTWFwIF9yZXN1bHRzID0g\nbmV3IEhhc2hNYXAoKTsgLy8gb2JqZWN0LT5xdWVyeXJlc3VsdG1hcHBpbmcK\nICAgIHByaXZhdGUgU2NoZW1hR3JvdXAgX3NjaGVtYSA9IG51bGw7CiAgICBw\ncml2YXRlIFN0cmF0ZWd5SW5zdGFsbGVyIF9pbnN0YWxsZXIgPSBudWxsOwoK\nICAgIC8qKgogICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci4gIENvbmZpZ3Vy\nZSB2aWEgCiAgICAgKiB7QGxpbmsgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5j\nb25mLkNvbmZpZ3VyYWJsZX0uCiAgICAgKi8KICAgIHB1YmxpYyBNYXBwaW5n\nUmVwb3NpdG9yeSgpIHsKICAgICAgICBzZXRWYWxpZGF0ZShWQUxJREFURV9N\nQVBQSU5HLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmll\nbnQgYWNjZXNzIHRvIGRpY3Rpb25hcnkgZm9yIG1hcHBpbmdzLgogICAgICov\nCiAgICBwdWJsaWMgREJEaWN0aW9uYXJ5IGdldERCRGljdGlvbmFyeSgpIHsK\nICAgICAgICByZXR1cm4gX2RpY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBN\nYXBwaW5nIGRlZmF1bHRzLgogICAgICovCiAgICBwdWJsaWMgTWFwcGluZ0Rl\nZmF1bHRzIGdldE1hcHBpbmdEZWZhdWx0cygpIHsKICAgICAgICByZXR1cm4g\nX2RlZmF1bHRzOwogICAgfQoKICAgIC8qKgogICAgICogTWFwcGluZyBkZWZh\ndWx0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNYXBwaW5nRGVmYXVs\ndHMoTWFwcGluZ0RlZmF1bHRzIGRlZmF1bHRzKSB7CiAgICAgICAgX2RlZmF1\nbHRzID0gZGVmYXVsdHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXByZXNl\nbnRhdGlvbiBvZiB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICovCiAgICBw\ndWJsaWMgc3luY2hyb25pemVkIFNjaGVtYUdyb3VwIGdldFNjaGVtYUdyb3Vw\nKCkgewogICAgICAgIGlmIChfc2NoZW1hID09IG51bGwpCiAgICAgICAgICAg\nIF9zY2hlbWEgPSAoKEpEQkNDb25maWd1cmF0aW9uKSBnZXRDb25maWd1cmF0\naW9uKCkpLgogICAgICAgICAgICAgICAgZ2V0U2NoZW1hRmFjdG9yeUluc3Rh\nbmNlKCkucmVhZFNjaGVtYSgpOwogICAgICAgIHJldHVybiBfc2NoZW1hOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50YXRpb24gb2YgdGhlIGRh\ndGFiYXNlIHNjaGVtYS4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXpl\nZCB2b2lkIHNldFNjaGVtYUdyb3VwKFNjaGVtYUdyb3VwIHNjaGVtYSkgewog\nICAgICAgIF9zY2hlbWEgPSBzY2hlbWE7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbnN0YWxscyBtYXBwaW5nIHN0cmF0ZWdpZXMgb24gY29tcG9uZW50cy4K\nICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBTdHJhdGVneUluc3Rh\nbGxlciBnZXRTdHJhdGVneUluc3RhbGxlcigpIHsKICAgICAgICBpZiAoX2lu\nc3RhbGxlciA9PSBudWxsKQogICAgICAgICAgICBfaW5zdGFsbGVyID0gbmV3\nIFJ1bnRpbWVTdHJhdGVneUluc3RhbGxlcih0aGlzKTsKICAgICAgICByZXR1\ncm4gX2luc3RhbGxlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEluc3RhbGxz\nIG1hcHBpbmcgc3RyYXRlZ2llcyBvbiBjb21wb25lbnRzLgogICAgICovCiAg\nICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgc2V0U3RyYXRlZ3lJbnN0YWxs\nZXIoU3RyYXRlZ3lJbnN0YWxsZXIgaW5zdGFsbGVyKSB7CiAgICAgICAgX2lu\nc3RhbGxlciA9IGluc3RhbGxlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgcXVlcnkgcmVzdWx0IG1hcHBpbmcgZm9yIHRoZSBnaXZlbiBu\nYW1lLgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIFF1ZXJ5UmVz\ndWx0TWFwcGluZyBnZXRRdWVyeVJlc3VsdE1hcHBpbmcoQ2xhc3MgY2xzLAog\nICAgICAgIFN0cmluZyBuYW1lLCBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIGJv\nb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5n\nIHJlcyA9IGdldFF1ZXJ5UmVzdWx0TWFwcGluZ0ludGVybmFsKGNscywgbmFt\nZSwKICAgICAgICAgICAgZW52TG9hZGVyKTsKICAgICAgICBpZiAocmVzID09\nIG51bGwgJiYgbXVzdEV4aXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXF1ZXJ5LXJlcyIsIGNscywg\nbmFtZSkpOwogICAgICAgIHJldHVybiByZXM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5lZCB0aGUgcXVlcnkgcmVzdWx0IG1hcHBpbmcgd2l0aCB0\naGUgZ2l2ZW4gbmFtZS4KICAgICAqLwogICAgcHJpdmF0ZSBRdWVyeVJlc3Vs\ndE1hcHBpbmcgZ2V0UXVlcnlSZXN1bHRNYXBwaW5nSW50ZXJuYWwoQ2xhc3Mg\nY2xzLAogICAgICAgIFN0cmluZyBuYW1lLCBDbGFzc0xvYWRlciBlbnZMb2Fk\nZXIpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gY2hlY2sgY2FjaGUKICAgICAgICBP\nYmplY3Qga2V5ID0gZ2V0UXVlcnlSZXN1bHRLZXkoY2xzLCBuYW1lKTsKICAg\nICAgICBRdWVyeVJlc3VsdE1hcHBpbmcgcmVzID0gKFF1ZXJ5UmVzdWx0TWFw\ncGluZykgX3Jlc3VsdHMuZ2V0KGtleSk7CiAgICAgICAgaWYgKHJlcyAhPSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gcmVzOwoKICAgICAgICAvLyBnZXQg\nbWV0YWRhdGEgZm9yIGNsYXNzLCB3aGljaCB3aWxsIGZpbmQgcmVzdWx0cyBp\nbiBtZXRhZGF0YSBmaWxlCiAgICAgICAgaWYgKGNscyAhPSBudWxsICYmIGdl\ndE1ldGFEYXRhKGNscywgZW52TG9hZGVyLCBmYWxzZSkgIT0gbnVsbCkgewog\nICAgICAgICAgICByZXMgPSAoUXVlcnlSZXN1bHRNYXBwaW5nKSBfcmVzdWx0\ncy5nZXQoa2V5KTsKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CiAgICAgICAgaWYg\nKChnZXRTb3VyY2VNb2RlKCkgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKGNscyA9PSBudWxsKQog\nICAgICAgICAgICBjbHMgPSBnZXRNZXRhRGF0YUZhY3RvcnkoKQogICAgICAg\nICAgICAgICAgICAgIC5nZXRSZXN1bHRTZXRNYXBwaW5nU2NvcGUobmFtZSwg\nZW52TG9hZGVyKTsKICAgICAgICAvLyBub3QgaW4gY2FjaGU7IGxvYWQKICAg\nICAgICBnZXRNZXRhRGF0YUZhY3RvcnkoKS5sb2FkKGNscywgTU9ERV9NRVRB\nIHwgTU9ERV9NQVBQSU5HLCBlbnZMb2FkZXIpOwogICAgICAgIHJldHVybiAo\nUXVlcnlSZXN1bHRNYXBwaW5nKSBfcmVzdWx0cy5nZXQoa2V5KTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhbGwgY2FjaGVkIHF1ZXJ5IHJlc3Vs\ndCBtYXBwaW5ncy4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBR\ndWVyeVJlc3VsdE1hcHBpbmdbXSBnZXRRdWVyeVJlc3VsdE1hcHBpbmdzKCkg\newogICAgICAgIENvbGxlY3Rpb24gdmFsdWVzID0gX3Jlc3VsdHMudmFsdWVz\nKCk7CiAgICAgICAgcmV0dXJuIChRdWVyeVJlc3VsdE1hcHBpbmdbXSkgdmFs\ndWVzLnRvQXJyYXkKICAgICAgICAgICAgKG5ldyBRdWVyeVJlc3VsdE1hcHBp\nbmdbdmFsdWVzLnNpemUoKV0pOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBjYWNoZWQgcXVlcnkgcmVzdWx0IG1hcHBpbmcgd2l0aCB0aGUg\nZ2l2ZW4gbmFtZSwgb3IgbnVsbCBpZgogICAgICogbm9uZS4KICAgICAqLwog\nICAgcHVibGljIHN5bmNocm9uaXplZCBRdWVyeVJlc3VsdE1hcHBpbmcgZ2V0\nQ2FjaGVkUXVlcnlSZXN1bHRNYXBwaW5nCiAgICAgICAgKENsYXNzIGNscywg\nU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gKFF1ZXJ5UmVzdWx0TWFw\ncGluZykgX3Jlc3VsdHMuZ2V0KGdldFF1ZXJ5UmVzdWx0S2V5KGNscywgbmFt\nZSkpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgcXVlcnkgcmVzdWx0\nIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgUXVl\ncnlSZXN1bHRNYXBwaW5nIGFkZFF1ZXJ5UmVzdWx0TWFwcGluZyhDbGFzcyBj\nbHMsCiAgICAgICAgU3RyaW5nIG5hbWUpIHsKICAgICAgICBRdWVyeVJlc3Vs\ndE1hcHBpbmcgcmVzID0gbmV3IFF1ZXJ5UmVzdWx0TWFwcGluZyhuYW1lLCB0\naGlzKTsKICAgICAgICByZXMuc2V0RGVmaW5pbmdUeXBlKGNscyk7CiAgICAg\nICAgX3Jlc3VsdHMucHV0KGdldFF1ZXJ5UmVzdWx0S2V5KHJlcyksIHJlcyk7\nCiAgICAgICAgcmV0dXJuIHJlczsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nbW92ZSBhIHF1ZXJ5IHJlc3VsdCBtYXBwaW5nLgogICAgICovCiAgICBwdWJs\naWMgc3luY2hyb25pemVkIGJvb2xlYW4gcmVtb3ZlUXVlcnlSZXN1bHRNYXBw\naW5nCiAgICAgICAgKFF1ZXJ5UmVzdWx0TWFwcGluZyByZXMpIHsKICAgICAg\nICByZXR1cm4gX3Jlc3VsdHMucmVtb3ZlKGdldFF1ZXJ5UmVzdWx0S2V5KHJl\ncykpICE9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBx\ndWVyeSByZXN1bHQgbWFwcGluZy4KICAgICAqLwogICAgcHVibGljIHN5bmNo\ncm9uaXplZCBib29sZWFuIHJlbW92ZVF1ZXJ5UmVzdWx0TWFwcGluZyhDbGFz\ncyBjbHMsCiAgICAgICAgU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAobmFt\nZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\ncmV0dXJuIF9yZXN1bHRzLnJlbW92ZShnZXRRdWVyeVJlc3VsdEtleShjbHMs\nIG5hbWUpKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgdW5pcXVlIGtleSBmb3IgdGhlIGdpdmVuIG1hcHBpbmcuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBnZXRRdWVyeVJlc3VsdEtleShR\ndWVyeVJlc3VsdE1hcHBpbmcgcmVzKSB7CiAgICAgICAgaWYgKHJlcyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4g\nZ2V0UXVlcnlSZXN1bHRLZXkocmVzLmdldERlZmluaW5nVHlwZSgpLCByZXMu\nZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHVu\naXF1ZSBrZXkgZm9yIHRoZSBnaXZlbiBjbGFzcyAvIG5hbWUuIFRoZSBjbGFz\ncyBhcmd1bWVudAogICAgICogY2FuIGJlIG51bGwuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIE9iamVjdCBnZXRRdWVyeVJlc3VsdEtleShDbGFzcyBj\nbHMsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIGdldFF1ZXJ5S2V5\nKGNscywgbmFtZSk7CiAgICB9CgogICAgcHVibGljIENsYXNzTWFwcGluZyBn\nZXRNYXBwaW5nKENsYXNzIGNscywgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLAog\nICAgICAgIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgcmV0dXJuIChD\nbGFzc01hcHBpbmcpIHN1cGVyLmdldE1ldGFEYXRhKGNscywgZW52TG9hZGVy\nLCBtdXN0RXhpc3QpOwogICAgfQoKICAgIHB1YmxpYyBDbGFzc01hcHBpbmdb\nXSBnZXRNYXBwaW5ncygpIHsKICAgICAgICByZXR1cm4gKENsYXNzTWFwcGlu\nZ1tdKSBzdXBlci5nZXRNZXRhRGF0YXMoKTsKICAgIH0KCiAgICBwdWJsaWMg\nQ2xhc3NNYXBwaW5nIGdldE1hcHBpbmcoT2JqZWN0IG9pZCwgQ2xhc3NMb2Fk\nZXIgZW52TG9hZGVyLAogICAgICAgIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAg\nICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmcpIHN1cGVyLmdldE1ldGFEYXRh\nKG9pZCwgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwogICAgfQoKICAgIHB1Ymxp\nYyBDbGFzc01hcHBpbmdbXSBnZXRJbXBsZW1lbnRvck1hcHBpbmdzKENsYXNz\nIGNscywKICAgICAgICBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIGJvb2xlYW4g\nbXVzdEV4aXN0KSB7CiAgICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmdbXSkg\nc3VwZXIuZ2V0SW1wbGVtZW50b3JNZXRhRGF0YXMoY2xzLCBlbnZMb2FkZXIs\nCiAgICAgICAgICAgIG11c3RFeGlzdCk7CiAgICB9CgogICAgcHVibGljIHN5\nbmNocm9uaXplZCB2b2lkIGNsZWFyKCkgewogICAgICAgIHN1cGVyLmNsZWFy\nKCk7CiAgICAgICAgX3NjaGVtYSA9IG51bGw7CiAgICAgICAgX3Jlc3VsdHMu\nY2xlYXIoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBwcmVwYXJlTWFw\ncGluZyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICAvLyBtYWtlIHN1\ncmUgc3VwZXJjbGFzcyByZXNvbHZlZCBmaXJzdDsgcmVzb2x2aW5nIHN1cGVy\nY2xhc3MgbWF5IGhhdmUKICAgICAgICAvLyByZXNvbHZlZCB0aGlzIG1hcHBp\nbmcKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBp\nbmcpIG1ldGE7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9IG1hcHBpbmcu\nZ2V0UENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChzdXAgIT0g\nbnVsbCAmJiAobWFwcGluZy5nZXRSZXNvbHZlKCkgJiBNT0RFX01BUFBJTkcp\nICE9IDApCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAKICAgICAgICAv\nLyBpZiB0aGlzIG1hcHBpbmcgaXMgbm90IGZvciBhIG1hbmFnZWQgaW50ZXJm\nYWNlLCBlbnN1cmUgdGhhdCBpZiAKICAgICAgICAvLyB3ZSBoYXZlIGFuIGlu\naGVyaXRhbmNlIGhpZXJhcmNoeSB0aGVyZSBpcyBhIGRlZmF1bHQgc3RyYXRl\nZ3kKICAgICAgICAvLyBhcHBsaWVkIHRvIHRoZSByb290IGNsYXNzCiAgICAg\nICAgaWYgKCFtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKS5pc0ludGVyZmFj\nZSgpICYmCiAgICAgICAgICAgICFtYXBwaW5nLmlzRW1iZWRkZWRPbmx5KCkp\nIHsKICAgICAgICAgICAgLy8gaWYgYW4gaW5oZXJpdGFuY2Ugc3RyYXRlZ3kg\naGFzIG5vdCBiZWVuIHNldCBvbiB0aGlzIG1hcHBpbmcKICAgICAgICAgICAg\nLy8gZGV0ZXJtaW5lIGlmIG5lZWRzIG9uZSBhbmQgaWYgc28sIHNldCBpdAog\nICAgICAgICAgICBpZiAoIWhhc0luaGVyaXRhbmNlU3RyYXRlZ3kobWFwcGlu\nZykpIHsKICAgICAgICAgICAgICAgIENsYXNzTWFwcGluZyBiYXNlTWFwcGlu\nZyA9IGZpbmRCYXNlQ2xhc3NNYXBwaW5nKG1hcHBpbmcpOyAKICAgICAgICAg\nICAgICAgIGlmIChiYXNlTWFwcGluZyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHNldERlZmF1bHRJbmhlcml0YW5jZVN0cmF0ZWd5KGJhc2VNYXBw\naW5nKTsKICAgICAgICAgICAgfSAgICAgICAgICAgIAogICAgICAgIH0KCiAg\nICAgICAgLy8gZGVmaW5lIHN1cGVyY2xhc3MgZmllbGRzIGFmdGVyIG1hcHBp\nbmcgY2xhc3MsIHNvIHdlIGNhbiB0ZWxsIHdoZXRoZXIKICAgICAgICAvLyB0\naGUgY2xhc3MgaXMgbWFwcGVkIGFuZCBuZWVkcyB0byByZWRlZmluZSBhYnN0\ncmFjdCBzdXBlcmNsYXNzIGZpZWxkcwogICAgICAgIGdldFN0cmF0ZWd5SW5z\ndGFsbGVyKCkuaW5zdGFsbFN0cmF0ZWd5KG1hcHBpbmcpOwogICAgICAgIG1h\ncHBpbmcuZGVmaW5lU3VwZXJjbGFzc0ZpZWxkcyhtYXBwaW5nLmdldEpvaW5h\nYmxlUENTdXBlcmNsYXNzTWFwcGluZygpCiAgICAgICAgICAgID09IG51bGwp\nOwoKICAgICAgICAvLyByZXNvbHZlIGV2ZXJ5dGhpbmcgdGhhdCBkb2Vzbid0\nIGludm9sdmUgcmVsYXRpb25zIHRvIGFsbG93IHJlbGF0aW9uCiAgICAgICAg\nLy8gbWFwcGluZ3MgdG8gdXNlIHRoZSBvdGhlcnMgYXMgam9pbmFibGVzCiAg\nICAgICAgbWFwcGluZy5yZXNvbHZlTm9uUmVsYXRpb25NYXBwaW5ncygpOwog\nICAgfQoKICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIG5ld0NsYXNzTWV0\nYURhdGEoQ2xhc3MgdHlwZSkgewogICAgICAgIHJldHVybiBuZXcgQ2xhc3NN\nYXBwaW5nKHR5cGUsIHRoaXMpOwogICAgfQoKICAgIHByb3RlY3RlZCBDbGFz\nc01ldGFEYXRhW10gbmV3Q2xhc3NNZXRhRGF0YUFycmF5KGludCBsZW5ndGgp\nIHsKICAgICAgICByZXR1cm4gbmV3IENsYXNzTWFwcGluZ1tsZW5ndGhdOwog\nICAgfQoKICAgIHByb3RlY3RlZCBGaWVsZE1ldGFEYXRhIG5ld0ZpZWxkTWV0\nYURhdGEoU3RyaW5nIG5hbWUsIENsYXNzIHR5cGUsCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBvd25lcikgewogICAgICAgIHJldHVybiBuZXcgRmllbGRNYXBw\naW5nKG5hbWUsIHR5cGUsIChDbGFzc01hcHBpbmcpIG93bmVyKTsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgRmllbGRNZXRhRGF0YVtdIG5ld0ZpZWxkTWV0YURh\ndGFBcnJheShpbnQgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGaWVs\nZE1hcHBpbmdbbGVuZ3RoXTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NN\nZXRhRGF0YSBuZXdFbWJlZGRlZENsYXNzTWV0YURhdGEoVmFsdWVNZXRhRGF0\nYSBvd25lcikgewogICAgICAgIHJldHVybiBuZXcgQ2xhc3NNYXBwaW5nKG93\nbmVyKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgVmFsdWVNZXRhRGF0YSBuZXdW\nYWx1ZU1ldGFEYXRhKEZpZWxkTWV0YURhdGEgb3duZXIpIHsKICAgICAgICBy\nZXR1cm4gbmV3IFZhbHVlTWFwcGluZ0ltcGwoKEZpZWxkTWFwcGluZykgb3du\nZXIpOwogICAgfQoKICAgIHByb3RlY3RlZCBTZXF1ZW5jZU1ldGFEYXRhIG5l\nd1NlcXVlbmNlTWV0YURhdGEoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1\ncm4gbmV3IFNlcXVlbmNlTWFwcGluZyhuYW1lLCB0aGlzKTsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgT3JkZXIgbmV3VmFsdWVPcmRlcihGaWVsZE1ldGFEYXRh\nIG93bmVyLCBib29sZWFuIGFzYykgewogICAgICAgIHJldHVybiBuZXcgSkRC\nQ1ZhbHVlT3JkZXIoKEZpZWxkTWFwcGluZykgb3duZXIsIGFzYyk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIE9yZGVyIG5ld1JlbGF0ZWRGaWVsZE9yZGVyKEZp\nZWxkTWV0YURhdGEgb3duZXIsCiAgICAgICAgRmllbGRNZXRhRGF0YSByZWws\nIGJvb2xlYW4gYXNjKSB7CiAgICAgICAgcmV0dXJuIG5ldyBKREJDUmVsYXRl\nZEZpZWxkT3JkZXIoKEZpZWxkTWFwcGluZykgb3duZXIsCiAgICAgICAgICAg\nIChGaWVsZE1hcHBpbmcpIHJlbCwgYXNjKTsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgT3JkZXJbXSBuZXdPcmRlckFycmF5KGludCBzaXplKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBKREJDT3JkZXJbc2l6ZV07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgdmVyc2lvbiBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNs\nYXNzLgogICAgICovCiAgICBwcm90ZWN0ZWQgVmVyc2lvbiBuZXdWZXJzaW9u\nKENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICByZXR1cm4gbmV3IFZlcnNp\nb24oY2xzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBkaXNjcmlt\naW5hdG9yIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBEaXNjcmltaW5hdG9yIG5ld0Rpc2NyaW1pbmF0b3Io\nQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAgIHJldHVybiBuZXcgRGlzY3Jp\nbWluYXRvcihjbHMpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHJh\ndyBtYXBwaW5nIGluZm8gZm9yIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIENsYXNzTWFwcGluZ0luZm8gbmV3TWFwcGluZ0lu\nZm8oQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAgIENsYXNzTWFwcGluZ0lu\nZm8gaW5mbyA9IG5ldyBDbGFzc01hcHBpbmdJbmZvKCk7CiAgICAgICAgaW5m\nby5zZXRDbGFzc05hbWUoY2xzLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1l\nKCkpOwogICAgICAgIHJldHVybiBpbmZvOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIHJhdyBtYXBwaW5nIGluZm8gZm9yIHRoZSBnaXZlbiBpbnN0\nYW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkTWFwcGluZ0luZm8g\nbmV3TWFwcGluZ0luZm8oRmllbGRNYXBwaW5nIGZtKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBGaWVsZE1hcHBpbmdJbmZvKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgcmF3IG1hcHBpbmcgaW5mbyBmb3IgdGhlIGdpdmVuIGlu\nc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgVmFsdWVNYXBwaW5nSW5m\nbyBuZXdNYXBwaW5nSW5mbyhWYWx1ZU1hcHBpbmcgdm0pIHsKICAgICAgICBy\nZXR1cm4gbmV3IFZhbHVlTWFwcGluZ0luZm8oKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSByYXcgbWFwcGluZyBpbmZvIGZvciB0aGUgZ2l2ZW4g\naW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uTWFwcGlu\nZ0luZm8gbmV3TWFwcGluZ0luZm8oVmVyc2lvbiB2ZXJzaW9uKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBWZXJzaW9uTWFwcGluZ0luZm8oKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENyZWF0ZSByYXcgbWFwcGluZyBpbmZvIGZvciB0aGUg\nZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBEaXNjcmlt\naW5hdG9yTWFwcGluZ0luZm8gbmV3TWFwcGluZ0luZm8oRGlzY3JpbWluYXRv\nciBkaXNjKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEaXNjcmltaW5hdG9yTWFw\ncGluZ0luZm8oKTsKICAgIH0KCiAgICAvKioKICAgICAqIEluc3RhbnRpYXRl\nIHRoZSBnaXZlbiBjbGFzcycgbmFtZWQgc3RyYXRlZ3ksIG9yIHJldHVybiBu\ndWxsIGlmIG5vCiAgICAgKiBuYW1lZCBzdHJhdGVneS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIENsYXNzU3RyYXRlZ3kgbmFtZWRTdHJhdGVneShDbGFzc01h\ncHBpbmcgY2xzKSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSBjbHMuZ2V0TWFw\ncGluZ0luZm8oKS5nZXRTdHJhdGVneSgpOwogICAgICAgIHJldHVybiBpbnN0\nYW50aWF0ZUNsYXNzU3RyYXRlZ3kobmFtZSwgY2xzKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgc3RyYXRlZ3kgZm9yIHRoZSBnaXZlbiBu\nYW1lLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NTdHJhdGVneSBpbnN0\nYW50aWF0ZUNsYXNzU3RyYXRlZ3koU3RyaW5nIG5hbWUsCiAgICAgICAgQ2xh\nc3NNYXBwaW5nIGNscykgewogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChOb25lQ2xhc3NT\ndHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHJldHVy\nbiBOb25lQ2xhc3NTdHJhdGVneS5nZXRJbnN0YW5jZSgpOwoKICAgICAgICBT\ndHJpbmcgcHJvcHMgPSBDb25maWd1cmF0aW9ucy5nZXRQcm9wZXJ0aWVzKG5h\nbWUpOwogICAgICAgIG5hbWUgPSBDb25maWd1cmF0aW9ucy5nZXRDbGFzc05h\nbWUobmFtZSk7CiAgICAgICAgQ2xhc3Mgc3RyYXQgPSBudWxsOwoKICAgICAg\nICAvLyBiYXNlIGFuZCB2ZXJ0aWNhbCBzdHJhdGVnaWVzIHVzZSBzYW1lIGFs\naWFzOyBkaWZmZXJlbnRpYXRlIG9uIGpvaW4KICAgICAgICBpZiAoRnVsbENs\nYXNzU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICBz\ndHJhdCA9IEZ1bGxDbGFzc1N0cmF0ZWd5LmNsYXNzOwogICAgICAgIGVsc2Ug\naWYgKEZsYXRDbGFzc1N0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAg\nICAgICAgICAgc3RyYXQgPSBGbGF0Q2xhc3NTdHJhdGVneS5jbGFzczsKICAg\nICAgICBlbHNlIGlmIChWZXJ0aWNhbENsYXNzU3RyYXRlZ3kuQUxJQVMuZXF1\nYWxzKG5hbWUpKQogICAgICAgICAgICBzdHJhdCA9IFZlcnRpY2FsQ2xhc3NT\ndHJhdGVneS5jbGFzczsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nc3RyYXQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHN0cmF0ID0gSmF2YVR5\ncGVzLmNsYXNzRm9yTmFtZShuYW1lLCBjbHMsCiAgICAgICAgICAgICAgICAg\nICAgKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0\nQ2xhc3NMb2FkZXJBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBDbGFzc1N0cmF0ZWd5LmNsYXNzKSkpOwogICAgICAgICAgICBDbGFzc1N0\ncmF0ZWd5IHN0cmF0ZWd5ID0gCiAgICAgICAgICAgICAgICAoQ2xhc3NTdHJh\ndGVneSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24o\nc3RyYXQpKTsKICAgICAgICAgICAgQ29uZmlndXJhdGlvbnMuY29uZmlndXJl\nSW5zdGFuY2Uoc3RyYXRlZ3ksIGdldENvbmZpZ3VyYXRpb24oKSwKICAgICAg\nICAgICAgICAgIHByb3BzKTsKICAgICAgICAgICAgcmV0dXJuIHN0cmF0ZWd5\nOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIGlmIChlIGluc3RhbmNlb2YgUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikK\nICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1jbHMtc3RyYXRlZ3ki\nLAogICAgICAgICAgICAgICAgY2xzLCBuYW1lKSwgZSk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogSW5zdGFudGlhdGUgdGhlIGdpdmVuIGZp\nZWxkJ3MgbmFtZWQgc3RyYXRlZ3ksIG9yIHJldHVybiBudWxsIGlmIG5vCiAg\nICAgKiBuYW1lZCBzdHJhdGVneS4KICAgICAqLwogICAgcHJvdGVjdGVkIEZp\nZWxkU3RyYXRlZ3kgbmFtZWRTdHJhdGVneShGaWVsZE1hcHBpbmcgZmllbGQs\nCiAgICAgICAgYm9vbGVhbiBpbnN0YWxsSGFuZGxlcnMpIHsKICAgICAgICBT\ndHJpbmcgbmFtZSA9IGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0U3RyYXRl\nZ3koKTsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKE5vbmVGaWVsZFN0cmF0ZWd5LkFM\nSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIE5vbmVGaWVs\nZFN0cmF0ZWd5LmdldEluc3RhbmNlKCk7CgogICAgICAgIFN0cmluZyBwcm9w\ncyA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRpZXMobmFtZSk7CiAgICAg\nICAgbmFtZSA9IENvbmZpZ3VyYXRpb25zLmdldENsYXNzTmFtZShuYW1lKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzcyBjID0gSmF2YVR5cGVz\nLmNsYXNzRm9yTmFtZShuYW1lLCBmaWVsZCwKICAgICAgICAgICAgICAgIChD\nbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAg\nICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2Fk\nZXJBY3Rpb24oRmllbGRTdHJhdGVneS5jbGFzcykpKTsKICAgICAgICAgICAg\naWYgKEZpZWxkU3RyYXRlZ3kuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjKSkg\newogICAgICAgICAgICAgICAgRmllbGRTdHJhdGVneSBzdHJhdCA9IChGaWVs\nZFN0cmF0ZWd5KQogICAgICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRv\nUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihjKSk7CiAgICAgICAgICAg\nICAgICBDb25maWd1cmF0aW9ucy5jb25maWd1cmVJbnN0YW5jZShzdHJhdCwg\nZ2V0Q29uZmlndXJhdGlvbigpLAogICAgICAgICAgICAgICAgICAgIHByb3Bz\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBzdHJhdDsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gbXVzdCBiZSBuYW1lZCBoYW5kbGVyCiAgICAg\nICAgICAgIGlmIChpbnN0YWxsSGFuZGxlcnMpIHsKICAgICAgICAgICAgICAg\nIFZhbHVlSGFuZGxlciB2aCA9IChWYWx1ZUhhbmRsZXIpIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLm5ld0luc3RhbmNlQWN0aW9uKGMpKTsKICAgICAgICAgICAg\nICAgIENvbmZpZ3VyYXRpb25zLmNvbmZpZ3VyZUluc3RhbmNlKHZoLCBnZXRD\nb25maWd1cmF0aW9uKCksCiAgICAgICAgICAgICAgICAgICAgcHJvcHMpOwog\nICAgICAgICAgICAgICAgZmllbGQuc2V0SGFuZGxlcih2aCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ldyBIYW5kbGVyRmllbGRTdHJh\ndGVneSgpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIGlmIChlIGluc3RhbmNlb2YgUHJpdmlsZWdlZEFjdGlvbkV4Y2Vw\ndGlvbikKICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25F\neGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1maWVsZC1z\ndHJhdGVneSIsCiAgICAgICAgICAgICAgICBmaWVsZCwgbmFtZSksIGUpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEluc3RhbnRpYXRlIHRo\nZSBnaXZlbiBkaXNjcmltaW5hdG9yJ3MgbmFtZWQgc3RyYXRlZ3ksIG9yIHJl\ndHVybiBudWxsCiAgICAgKiBpZiBubyBuYW1lZCBzdHJhdGVneS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIERpc2NyaW1pbmF0b3JTdHJhdGVneSBuYW1lZFN0\ncmF0ZWd5KERpc2NyaW1pbmF0b3IgZGlzY3JpbSkgewogICAgICAgIFN0cmlu\nZyBuYW1lID0gZGlzY3JpbS5nZXRNYXBwaW5nSW5mbygpLmdldFN0cmF0ZWd5\nKCk7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIC8vIGlmIHRoZXJlIGlzIGEgbmFtZWQgc3Ry\nYXRlZ3kgcHJlc2VudCwgZGlzY2FyZCBpdCBpZiBpdCBtYXRjaGVzCiAgICAg\nICAgLy8gdGhlIGJhc2Ugc3RyYXRlZ3ksIHNvIHRoYXQgd2Ugd29uJ3QgY3Jl\nYXRlIGFuIGluZGVwZW5kZW50IGluc3RhbmNlCiAgICAgICAgQ2xhc3NNYXBw\naW5nIGNscyA9IGRpc2NyaW0uZ2V0Q2xhc3NNYXBwaW5nKCk7CiAgICAgICAg\nd2hpbGUgKGNscy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAh\nPSBudWxsKQogICAgICAgICAgICBjbHMgPSBjbHMuZ2V0Sm9pbmFibGVQQ1N1\ncGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgRGlzY3JpbWluYXRvciBiYXNl\nID0gY2xzLmdldERpc2NyaW1pbmF0b3IoKTsKICAgICAgICBpZiAoYmFzZSAh\nPSBkaXNjcmltICYmIGJhc2UuZ2V0U3RyYXRlZ3koKSAhPSBudWxsCiAgICAg\nICAgICAgICYmIG5hbWUuZXF1YWxzKGJhc2UuZ2V0U3RyYXRlZ3koKS5nZXRB\nbGlhcygpKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIHJl\ndHVybiBpbnN0YW50aWF0ZURpc2NyaW1pbmF0b3JTdHJhdGVneShuYW1lLCBk\naXNjcmltKTsKICAgIH0KCiAgICAvKioKICAgICAqIEluc3RhbnRpYXRlIHRo\nZSBnaXZlbiBkaXNjcmltaW5hdG9yIHN0cmF0ZWd5LgogICAgICovCiAgICBw\ncm90ZWN0ZWQgRGlzY3JpbWluYXRvclN0cmF0ZWd5IGluc3RhbnRpYXRlRGlz\nY3JpbWluYXRvclN0cmF0ZWd5CiAgICAgICAgKFN0cmluZyBuYW1lLCBEaXNj\ncmltaW5hdG9yIGRpc2NyaW0pIHsKICAgICAgICBpZiAoTm9uZURpc2NyaW1p\nbmF0b3JTdHJhdGVneS5BTElBUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAg\nIHJldHVybiBOb25lRGlzY3JpbWluYXRvclN0cmF0ZWd5LmdldEluc3RhbmNl\nKCk7CgogICAgICAgIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdl\ndFByb3BlcnRpZXMobmFtZSk7CiAgICAgICAgbmFtZSA9IENvbmZpZ3VyYXRp\nb25zLmdldENsYXNzTmFtZShuYW1lKTsKICAgICAgICBDbGFzcyBzdHJhdCA9\nIG51bGw7CgogICAgICAgIGlmIChDbGFzc05hbWVEaXNjcmltaW5hdG9yU3Ry\nYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICBzdHJhdCA9\nIENsYXNzTmFtZURpc2NyaW1pbmF0b3JTdHJhdGVneS5jbGFzczsKICAgICAg\nICBlbHNlIGlmIChWYWx1ZU1hcERpc2NyaW1pbmF0b3JTdHJhdGVneS5BTElB\nUy5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHN0cmF0ID0gVmFsdWVNYXBE\naXNjcmltaW5hdG9yU3RyYXRlZ3kuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAo\nU3ViY2xhc3NKb2luRGlzY3JpbWluYXRvclN0cmF0ZWd5LkFMSUFTLmVxdWFs\ncyhuYW1lKSkKICAgICAgICAgICAgc3RyYXQgPSBTdWJjbGFzc0pvaW5EaXNj\ncmltaW5hdG9yU3RyYXRlZ3kuY2xhc3M7CgogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmIChzdHJhdCA9PSBudWxsKQogICAgICAgICAgICAgICAgc3Ry\nYXQgPSBKYXZhVHlwZXMuY2xhc3NGb3JOYW1lKG5hbWUsCiAgICAgICAgICAg\nICAgICAgICAgZGlzY3JpbS5nZXRDbGFzc01hcHBpbmcoKSwKICAgICAgICAg\nICAgICAgICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhl\nbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbigKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIERpc2NyaW1pbmF0b3JTdHJhdGVneS5jbGFzcykpKTsKICAg\nICAgICAgICAgRGlzY3JpbWluYXRvclN0cmF0ZWd5IHN0cmF0ZWd5ID0gKERp\nc2NyaW1pbmF0b3JTdHJhdGVneSkKICAgICAgICAgICAgICAgIEFjY2Vzc0Nv\nbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLm5ld0luc3RhbmNlQWN0aW9uKHN0cmF0KSk7CiAgICAg\nICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZpZ3VyZUluc3RhbmNlKHN0cmF0\nZWd5LCBnZXRDb25maWd1cmF0aW9uKCksCiAgICAgICAgICAgICAgICBwcm9w\ncyk7CiAgICAgICAgICAgIHJldHVybiBzdHJhdGVneTsKICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAoZSBpbnN0YW5j\nZW9mIFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pCiAgICAgICAgICAgICAg\nICBlID0gKChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKSBlKS5nZXRFeGNl\ncHRpb24oKTsKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtZGlzY3JpbS1zdHJhdGVneSIsCiAgICAgICAg\nICAgICAgICBkaXNjcmltLmdldENsYXNzTWFwcGluZygpLCBuYW1lKSwgZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5zdGFudGlhdGUg\ndGhlIGdpdmVuIHZlcnNpb24ncyBuYW1lZCBzdHJhdGVneSwgb3IgcmV0dXJu\nIG51bGwKICAgICAqIGlmIG5vIG5hbWVkIHN0cmF0ZWd5LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgVmVyc2lvblN0cmF0ZWd5IG5hbWVkU3RyYXRlZ3koVmVy\nc2lvbiB2ZXJzaW9uKSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSB2ZXJzaW9u\nLmdldE1hcHBpbmdJbmZvKCkuZ2V0U3RyYXRlZ3koKTsKICAgICAgICBpZiAo\nbmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgLy8gaWYgdGhlcmUgaXMgYSBuYW1lZCBzdHJhdGVneSBwcmVzZW50LCBk\naXNjYXJkIGl0IGlmIGl0IG1hdGNoZXMKICAgICAgICAvLyB0aGUgYmFzZSBz\ndHJhdGVneSwgc28gdGhhdCB3ZSB3b24ndCBjcmVhdGUgYW4gaW5kZXBlbmRl\nbnQgaW5zdGFuY2UKICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0gdmVyc2lv\nbi5nZXRDbGFzc01hcHBpbmcoKTsKICAgICAgICB3aGlsZSAoY2xzLmdldEpv\naW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAgICAg\nICAgIGNscyA9IGNscy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmco\nKTsKICAgICAgICBWZXJzaW9uIGJhc2UgPSBjbHMuZ2V0VmVyc2lvbigpOwog\nICAgICAgIGlmIChiYXNlICE9IHZlcnNpb24gJiYgYmFzZS5nZXRTdHJhdGVn\neSgpICE9IG51bGwKICAgICAgICAgICAgJiYgbmFtZS5lcXVhbHMoYmFzZS5n\nZXRTdHJhdGVneSgpLmdldEFsaWFzKCkpKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgcmV0dXJuIGluc3RhbnRpYXRlVmVyc2lvblN0cmF0\nZWd5KG5hbWUsIHZlcnNpb24pOwogICAgfQoKICAgIC8qKgogICAgICogSW5z\ndGFudGlhdGUgdGhlIGdpdmVuIHZlcnNpb24gc3RyYXRlZ3kuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBWZXJzaW9uU3RyYXRlZ3kgaW5zdGFudGlhdGVWZXJz\naW9uU3RyYXRlZ3koU3RyaW5nIG5hbWUsCiAgICAgICAgVmVyc2lvbiB2ZXJz\naW9uKSB7CiAgICAgICAgaWYgKE5vbmVWZXJzaW9uU3RyYXRlZ3kuQUxJQVMu\nZXF1YWxzKG5hbWUpKQogICAgICAgICAgICByZXR1cm4gTm9uZVZlcnNpb25T\ndHJhdGVneS5nZXRJbnN0YW5jZSgpOwoKICAgICAgICBTdHJpbmcgcHJvcHMg\nPSBDb25maWd1cmF0aW9ucy5nZXRQcm9wZXJ0aWVzKG5hbWUpOwogICAgICAg\nIG5hbWUgPSBDb25maWd1cmF0aW9ucy5nZXRDbGFzc05hbWUobmFtZSk7CiAg\nICAgICAgQ2xhc3Mgc3RyYXQgPSBudWxsOwoKICAgICAgICBpZiAoTnVtYmVy\nVmVyc2lvblN0cmF0ZWd5LkFMSUFTLmVxdWFscyhuYW1lKSkKICAgICAgICAg\nICAgc3RyYXQgPSBOdW1iZXJWZXJzaW9uU3RyYXRlZ3kuY2xhc3M7CiAgICAg\nICAgZWxzZSBpZiAoVGltZXN0YW1wVmVyc2lvblN0cmF0ZWd5LkFMSUFTLmVx\ndWFscyhuYW1lKSkKICAgICAgICAgICAgc3RyYXQgPSBUaW1lc3RhbXBWZXJz\naW9uU3RyYXRlZ3kuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAoTmFub1ByZWNp\nc2lvblRpbWVzdGFtcFZlcnNpb25TdHJhdGVneS5BTElBUy5lcXVhbHMobmFt\nZSkpCiAgICAgICAgICAgIHN0cmF0ID0gTmFub1ByZWNpc2lvblRpbWVzdGFt\ncFZlcnNpb25TdHJhdGVneS5jbGFzczsKICAgICAgICBlbHNlIGlmIChTdGF0\nZUNvbXBhcmlzb25WZXJzaW9uU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKG5hbWUp\nKQogICAgICAgICAgICBzdHJhdCA9IFN0YXRlQ29tcGFyaXNvblZlcnNpb25T\ndHJhdGVneS5jbGFzczsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKHN0cmF0ID09IG51bGwpCiAgICAgICAgICAgICAgICBzdHJhdCA9IEphdmFU\neXBlcy5jbGFzc0Zvck5hbWUobmFtZSwKICAgICAgICAgICAgICAgICAgICB2\nZXJzaW9uLmdldENsYXNzTWFwcGluZygpLAogICAgICAgICAgICAgICAgICAg\nIChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENs\nYXNzTG9hZGVyQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nVmVyc2lvblN0cmF0ZWd5LmNsYXNzKSkpOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiYmFkLXZlcnNpb24tc3RyYXRlZ3kiLAogICAg\nICAgICAgICAgICAgdmVyc2lvbi5nZXRDbGFzc01hcHBpbmcoKSwgbmFtZSks\nIGUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGluc3RhbnRpYXRlVmVy\nc2lvblN0cmF0ZWd5KHN0cmF0LCB2ZXJzaW9uLCBwcm9wcyk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0aGUgZ2l2ZW4gdmVyc2lvbiBz\ndHJhdGVneS4KICAgICAqLwogICAgcHJvdGVjdGVkIFZlcnNpb25TdHJhdGVn\neSBpbnN0YW50aWF0ZVZlcnNpb25TdHJhdGVneShDbGFzcyBzdHJhdCwKICAg\nICAgICBWZXJzaW9uIHZlcnNpb24sIFN0cmluZyBwcm9wcykgewogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIFZlcnNpb25TdHJhdGVneSBzdHJhdGVneSA9\nIChWZXJzaW9uU3RyYXRlZ3kpCiAgICAgICAgICAgICAgICBBY2Nlc3NDb250\ncm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRv\nUHJpdkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbihzdHJhdCkpOwogICAgICAg\nICAgICBDb25maWd1cmF0aW9ucy5jb25maWd1cmVJbnN0YW5jZShzdHJhdGVn\neSwgZ2V0Q29uZmlndXJhdGlvbigpLAogICAgICAgICAgICAgICAgcHJvcHMp\nOwogICAgICAgICAgICByZXR1cm4gc3RyYXRlZ3k7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2Vv\nZiBQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKQogICAgICAgICAgICAgICAg\nZSA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgZSkuZ2V0RXhjZXB0\naW9uKCk7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLXZlcnNpb24tc3RyYXRlZ3kiLAogICAgICAgICAg\nICAgICAgdmVyc2lvbi5nZXRDbGFzc01hcHBpbmcoKSwgc3RyYXQgKyAiIiks\nIGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWlu\nZSB0aGUgZGVmYXVsdCBzdHJhdGVneSB0byB1c2UgZm9yIHRoZSBnaXZlbiBj\nbGFzcy4gRG9lcwogICAgICogbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBj\ndXJyZW50IHN0cmF0ZWd5LCBpZiBhbnkuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBDbGFzc1N0cmF0ZWd5IGRlZmF1bHRTdHJhdGVneShDbGFzc01hcHBpbmcg\nY2xzKSB7CiAgICAgICAgcmV0dXJuIGRlZmF1bHRTdHJhdGVneShjbHMsIGdl\ndFN0cmF0ZWd5SW5zdGFsbGVyKCkuaXNBZGFwdGluZygpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIERldGVybWluZSB0aGUgZGVmYXVsdCBzdHJhdGVneSB0\nbyB1c2UgZm9yIHRoZSBnaXZlbiBjbGFzcy4gRG9lcwogICAgICogbm90IHRh\na2UgaW50byBhY2NvdW50IHRoZSBjdXJyZW50IHN0cmF0ZWd5LCBpZiBhbnku\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc1N0cmF0ZWd5IGRlZmF1bHRT\ndHJhdGVneShDbGFzc01hcHBpbmcgY2xzLAogICAgICAgIGJvb2xlYW4gYWRh\ncHRpbmcpIHsKICAgICAgICBWYWx1ZU1hcHBpbmcgZW1iZWQgPSBjbHMuZ2V0\nRW1iZWRkaW5nTWFwcGluZygpOwogICAgICAgIGlmIChlbWJlZCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIC8vIHN1cGVyY2xhc3Mgb2YgZW1iZWRkZWQgY2xh\nc3MgaXNuJ3QgbWFwcGVkCiAgICAgICAgICAgIGlmIChlbWJlZC5nZXRUeXBl\nKCkgIT0gY2xzLmdldERlc2NyaWJlZFR5cGUoKQogICAgICAgICAgICAgICAg\nfHwgZW1iZWQuZ2V0RmllbGRNYXBwaW5nKCkuZ2V0U3RyYXRlZ3koKQogICAg\nICAgICAgICAgICAgPT0gTm9uZUZpZWxkU3RyYXRlZ3kuZ2V0SW5zdGFuY2Uo\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBOb25lQ2xhc3NTdHJhdGVneS5n\nZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBpZiAoZW1iZWQuZ2V0VHlwZUNv\nZGUoKSA9PSBKYXZhVHlwZXMuT0lEKQogICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBPYmplY3RJZENsYXNzU3RyYXRlZ3koKTsKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBFbWJlZGRlZENsYXNzU3RyYXRlZ3koKTsKICAgICAgICB9CiAg\nICAgICAgaWYgKGNscy5pc0VtYmVkZGVkT25seSgpKQogICAgICAgICAgICBy\nZXR1cm4gTm9uZUNsYXNzU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKCiAgICAg\nICAgT2JqZWN0IHN0cmF0ID0gX2RlZmF1bHRzLmdldFN0cmF0ZWd5KGNscywg\nYWRhcHRpbmcpOwogICAgICAgIGlmIChzdHJhdCBpbnN0YW5jZW9mIFN0cmlu\nZykKICAgICAgICAgICAgcmV0dXJuIGluc3RhbnRpYXRlQ2xhc3NTdHJhdGVn\neSgoU3RyaW5nKSBzdHJhdCwgY2xzKTsKICAgICAgICBpZiAoc3RyYXQgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIChDbGFzc1N0cmF0ZWd5KSBzdHJh\ndDsKICAgICAgICAKICAgICAgICAvLyBzZWUgaWYgdGhlcmUgaXMgYSBkZWNs\nYXJlZCBoaWVyYXJjaHkgc3RyYXRlZ3kKICAgICAgICBDbGFzc1N0cmF0ZWd5\nIGhzdHJhdCA9IG51bGw7CiAgICAgICAgZm9yIChDbGFzc01hcHBpbmcgYmFz\nZSA9IGNsczsgYmFzZSAhPSBudWxsICYmIGhzdHJhdCA9PSBudWxsOykgewog\nICAgICAgICAgICBoc3RyYXQgPSBpbnN0YW50aWF0ZUNsYXNzU3RyYXRlZ3ko\nYmFzZS5nZXRNYXBwaW5nSW5mbygpLgogICAgICAgICAgICAgICAgZ2V0SGll\ncmFyY2h5U3RyYXRlZ3koKSwgY2xzKTsKICAgICAgICAgICAgYmFzZSA9IGJh\nc2UuZ2V0TWFwcGVkUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gdGhlIGZ1bGwgc3RyYXRlZ3kgYXMgYXBwbGllZCB0byBh\nIGhpZXJhcmNoeSBpcyBhCiAgICAgICAgLy8gdGFibGUtcGVyLWNvbmNyZXRl\nLWNsYXNzIHN0cmF0ZWd5LCBzbyBkb24ndCBtYXAgYWJzdHJhY3QgdHlwZXMK\nICAgICAgICBpZiAoaHN0cmF0IGluc3RhbmNlb2YgRnVsbENsYXNzU3RyYXRl\nZ3kKICAgICAgICAgICAgJiYgIWNscy5pc01hbmFnZWRJbnRlcmZhY2UoKQog\nICAgICAgICAgICAmJiBNb2RpZmllci5pc0Fic3RyYWN0KGNscy5nZXREZXNj\ncmliZWRUeXBlKCkuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICByZXR1\ncm4gTm9uZUNsYXNzU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAK\nICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gY2xzLmdldE1hcHBlZFBDU3Vw\nZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAoc3VwID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBuZXcgRnVsbENsYXNzU3RyYXRlZ3koKTsKICAg\nICAgICBpZiAoaHN0cmF0ICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBo\nc3RyYXQ7CiAgICAgICAgcmV0dXJuIG5ldyBGbGF0Q2xhc3NTdHJhdGVneSgp\nOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBkZWZhdWx0\nIHN0cmF0ZWd5IHRvIHVzZSBmb3IgdGhlIGdpdmVuIGZpZWxkLiBEb2VzCiAg\nICAgKiBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIG5hbWVkIG9yIGN1cnJl\nbnQgc3RyYXRlZ3ksIGlmIGFueS4gSWYgYQogICAgICogbm9uLW51bGwgc3Ry\nYXRlZ3kgaXMgcmV0dXJuZWQsIHRoaXMgbWV0aG9kIG1heSBhcyBhIHNpZGUg\nZWZmZWN0IGluc3RhbGwKICAgICAqIHZhbHVlIGhhbmRsZXJzIG9uIHRoZSBm\naWVsZCdzIHZhbHVlIG1hcHBpbmdzLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nRmllbGRTdHJhdGVneSBkZWZhdWx0U3RyYXRlZ3koRmllbGRNYXBwaW5nIGZp\nZWxkLAogICAgICAgIGJvb2xlYW4gaW5zdGFsbEhhbmRsZXJzKSB7CiAgICAg\nICAgcmV0dXJuIGRlZmF1bHRTdHJhdGVneShmaWVsZCwgaW5zdGFsbEhhbmRs\nZXJzLAogICAgICAgICAgICBnZXRTdHJhdGVneUluc3RhbGxlcigpLmlzQWRh\ncHRpbmcoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgdGhl\nIGRlZmF1bHQgc3RyYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gZmllbGQu\nIERvZXMKICAgICAqIG5vdCB0YWtlIGludG8gYWNjb3VudCB0aGUgbmFtZWQg\nb3IgY3VycmVudCBzdHJhdGVneSwgaWYgYW55LiBJZiBhCiAgICAgKiBub24t\nbnVsbCBzdHJhdGVneSBpcyByZXR1cm5lZCwgdGhpcyBtZXRob2QgbWF5IGFz\nIGEgc2lkZSBlZmZlY3QgaW5zdGFsbAogICAgICogdmFsdWUgaGFuZGxlcnMg\nb24gdGhlIGZpZWxkJ3MgdmFsdWUgbWFwcGluZ3MuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBGaWVsZFN0cmF0ZWd5IGRlZmF1bHRTdHJhdGVneShGaWVsZE1h\ncHBpbmcgZmllbGQsCiAgICAgICAgYm9vbGVhbiBpbnN0YWxsSGFuZGxlcnMs\nIGJvb2xlYW4gYWRhcHRpbmcpIHsKICAgICAgICAvLyBub3QgcGVyc2lzdGVu\ndD8KICAgICAgICBpZiAoZmllbGQuZ2V0TWFuYWdlbWVudCgpICE9IGZpZWxk\nLk1BTkFHRV9QRVJTSVNURU5UCiAgICAgICAgICAgIHx8IGZpZWxkLmlzVmVy\nc2lvbigpKQogICAgICAgICAgICByZXR1cm4gTm9uZUZpZWxkU3RyYXRlZ3ku\nZ2V0SW5zdGFuY2UoKTsKICAgICAgICBpZiAoZmllbGQuZ2V0RGVmaW5pbmdN\nYXBwaW5nKCkuZ2V0U3RyYXRlZ3koKSA9PQogICAgICAgICAgICBOb25lQ2xh\nc3NTdHJhdGVneS5nZXRJbnN0YW5jZSgpKQogICAgICAgICAgICByZXR1cm4g\nTm9uZUZpZWxkU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKCiAgICAgICAgLy8g\nY2hlY2sgZm9yIG5hbWVkIGhhbmRsZXIgZmlyc3QKICAgICAgICBWYWx1ZUhh\nbmRsZXIgaGFuZGxlciA9IG5hbWVkSGFuZGxlcihmaWVsZCk7CiAgICAgICAg\naWYgKGhhbmRsZXIgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoaW5zdGFs\nbEhhbmRsZXJzKQogICAgICAgICAgICAgICAgZmllbGQuc2V0SGFuZGxlciho\nYW5kbGVyKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBIYW5kbGVyRmllbGRT\ndHJhdGVneSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZpZWxkLmlzU2Vy\naWFsaXplZCgpKSB7CiAgICAgICAgICAgIGlmIChfZGljdC5tYXhFbWJlZGRl\nZEJsb2JTaXplICE9IC0xKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBN\nYXhFbWJlZGRlZEJsb2JGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgLy8gY2hlY2sgZm9yIG1hcHBlZCBzdHJhdGVneQog\nICAgICAgICAgICBPYmplY3Qgc3RyYXQgPSBtYXBwZWRTdHJhdGVneShmaWVs\nZCwgZmllbGQuZ2V0VHlwZSgpLCBhZGFwdGluZyk7CiAgICAgICAgICAgIGlm\nIChzdHJhdCBpbnN0YW5jZW9mIEZpZWxkU3RyYXRlZ3kpCiAgICAgICAgICAg\nICAgICByZXR1cm4gKEZpZWxkU3RyYXRlZ3kpIHN0cmF0OwogICAgICAgICAg\nICBpZiAoc3RyYXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGlu\nc3RhbGxIYW5kbGVycykKICAgICAgICAgICAgICAgICAgICBmaWVsZC5zZXRI\nYW5kbGVyKChWYWx1ZUhhbmRsZXIpIHN0cmF0KTsKICAgICAgICAgICAgICAg\nIHJldHVybiBuZXcgSGFuZGxlckZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgZm9yIGtub3duIGZp\nZWxkIHN0cmF0ZWdpZXMKICAgICAgICBpZiAoIWZpZWxkLmlzU2VyaWFsaXpl\nZCgpICYmIChmaWVsZC5nZXRUeXBlKCkgPT0gYnl0ZVtdLmNsYXNzCiAgICAg\nICAgICAgIHx8IGZpZWxkLmdldFR5cGUoKSA9PSBCeXRlW10uY2xhc3MpKSB7\nCiAgICAgICAgICAgIGlmIChfZGljdC5tYXhFbWJlZGRlZEJsb2JTaXplICE9\nIC0xKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXhFbWJlZGRlZEJ5\ndGVBcnJheUZpZWxkU3RyYXRlZ3koKTsKICAgICAgICB9IGVsc2UgaWYgKCFm\naWVsZC5pc1NlcmlhbGl6ZWQoKQogICAgICAgICAgICAmJiAoZmllbGQuZ2V0\nVHlwZSgpID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICB8fCBmaWVsZC5n\nZXRUeXBlKCkgPT0gQ2hhcmFjdGVyW10uY2xhc3MpKSB7CiAgICAgICAgICAg\nIGlmIChfZGljdC5tYXhFbWJlZGRlZENsb2JTaXplICE9IC0xICYmIGlzQ2xv\nYihmaWVsZCwgZmFsc2UpKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBN\nYXhFbWJlZGRlZENoYXJBcnJheUZpZWxkU3RyYXRlZ3koKTsKICAgICAgICB9\nIGVsc2UgaWYgKCFmaWVsZC5pc1NlcmlhbGl6ZWQoKSkgewogICAgICAgICAg\nICBGaWVsZFN0cmF0ZWd5IHN0cmF0ID0gZGVmYXVsdFR5cGVTdHJhdGVneShm\naWVsZCwgaW5zdGFsbEhhbmRsZXJzLAogICAgICAgICAgICAgICAgYWRhcHRp\nbmcpOwogICAgICAgICAgICBpZiAoc3RyYXQgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBzdHJhdDsKICAgICAgICB9CgogICAgICAgIC8vIGNo\nZWNrIGZvciBkZWZhdWx0IGhhbmRsZXIKICAgICAgICBoYW5kbGVyID0gZGVm\nYXVsdEhhbmRsZXIoZmllbGQsIGFkYXB0aW5nKTsKICAgICAgICBpZiAoaGFu\nZGxlciAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpbnN0YWxsSGFuZGxl\ncnMpCiAgICAgICAgICAgICAgICBmaWVsZC5zZXRIYW5kbGVyKGhhbmRsZXIp\nOwogICAgICAgICAgICByZXR1cm4gbmV3IEhhbmRsZXJGaWVsZFN0cmF0ZWd5\nKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBkZWZhdWx0IHRvIGJsb2IKICAg\nICAgICBpZiAoaW5zdGFsbEhhbmRsZXJzKSB7CiAgICAgICAgICAgIGlmIChn\nZXRMb2coKS5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBnZXRM\nb2coKS53YXJuKF9sb2MuZ2V0KCJuby1maWVsZC1zdHJhdGVneSIsIGZpZWxk\nKSk7CiAgICAgICAgICAgIGZpZWxkLnNldFNlcmlhbGl6ZWQodHJ1ZSk7CiAg\nICAgICAgfQogICAgICAgIGlmIChfZGljdC5tYXhFbWJlZGRlZEJsb2JTaXpl\nID09IC0xKSB7CiAgICAgICAgICAgIGlmIChpbnN0YWxsSGFuZGxlcnMpCiAg\nICAgICAgICAgICAgICBmaWVsZC5zZXRIYW5kbGVyKEJsb2JWYWx1ZUhhbmRs\nZXIuZ2V0SW5zdGFuY2UoKSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgSGFu\nZGxlckZpZWxkU3RyYXRlZ3koKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIG5ldyBNYXhFbWJlZGRlZEJsb2JGaWVsZFN0cmF0ZWd5KCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGJ1aWx0LWluIHN0cmF0ZWd5IGZv\nciB0aGUgZmllbGQncyB0eXBlLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBGaWVsZFN0cmF0ZWd5IGRlZmF1bHRUeXBlU3RyYXRl\nZ3koRmllbGRNYXBwaW5nIGZpZWxkLAogICAgICAgIGJvb2xlYW4gaW5zdGFs\nbEhhbmRsZXJzLCBib29sZWFuIGFkYXB0aW5nKSB7CiAgICAgICAgc3dpdGNo\nIChmaWVsZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZ\nVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IFByaW1pdGl2ZUZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgaWYgKCFp\nc0Nsb2IoZmllbGQsIGZhbHNlKSkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IFN0cmluZ0ZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAgICAg\nIGlmIChfZGljdC5tYXhFbWJlZGRlZENsb2JTaXplICE9IC0xKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgTWF4RW1iZWRkZWRDbG9iRmllbGRT\ndHJhdGVneSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgaWYgKGZpZWxk\nLmlzRW1iZWRkZWRQQygpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgRW1iZWRGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgICAgICAgICBpZiAo\nZmllbGQuZ2V0VHlwZU1hcHBpbmcoKS5pc01hcHBlZCgpCiAgICAgICAgICAg\nICAgICAgICAgfHwgIXVzZVVudHlwZWRQQ0hhbmRsZXIoZmllbGQpKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVsYXRpb25GaWVsZFN0cmF0\nZWd5KCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBWYWx1ZU1hcHBpbmcgZWxl\nbSA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgICAgICAg\nICBWYWx1ZUhhbmRsZXIgZWhhbmRsZXIgPSBuYW1lZEhhbmRsZXIoZWxlbSk7\nCiAgICAgICAgICAgICAgICBpZiAoZWhhbmRsZXIgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBlaGFuZGxlciA9IGRlZmF1bHRIYW5kbGVyKGVsZW0p\nOwogICAgICAgICAgICAgICAgaWYgKGVoYW5kbGVyICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXJDb2xsZWN0aW9uU3RyYXRl\nZ3koZmllbGQsIGVoYW5kbGVyLCAKICAgICAgICAgICAgICAgICAgICAgICAg\naW5zdGFsbEhhbmRsZXJzKTsKICAgICAgICAgICAgICAgIGlmIChlbGVtLmdl\ndFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDCiAgICAgICAgICAgICAgICAg\nICAgJiYgIWVsZW0uaXNTZXJpYWxpemVkKCkgJiYgIWVsZW0uaXNFbWJlZGRl\nZFBDKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlSW52ZXJzZUtl\neU1hcHBpbmcoZmllbGQpKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IFJlbGF0aW9uQ29sbGVjdGlvbkludmVyc2VLZXlGaWVsZFN0cmF0\nZWd5KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWxhdGlv\nbkNvbGxlY3Rpb25UYWJsZUZpZWxkU3RyYXRlZ3koKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBWYWx1ZU1hcHBpbmcg\na2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygpOwogICAgICAgICAgICAgICAg\nVmFsdWVIYW5kbGVyIGtoYW5kbGVyID0gbmFtZWRIYW5kbGVyKGtleSk7CiAg\nICAgICAgICAgICAgICBpZiAoa2hhbmRsZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBraGFuZGxlciA9IGRlZmF1bHRIYW5kbGVyKGtleSk7CiAg\nICAgICAgICAgICAgICBWYWx1ZU1hcHBpbmcgdmFsID0gZmllbGQuZ2V0RWxl\nbWVudE1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIFZhbHVlSGFuZGxlciB2\naGFuZGxlciA9IG5hbWVkSGFuZGxlcih2YWwpOwogICAgICAgICAgICAgICAg\naWYgKHZoYW5kbGVyID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgdmhh\nbmRsZXIgPSBkZWZhdWx0SGFuZGxlcih2YWwpOwogICAgICAgICAgICAgICAg\nYm9vbGVhbiBrcmVsID0ga2hhbmRsZXIgPT0gbnVsbCAKICAgICAgICAgICAg\nICAgICAgICAmJiBrZXkuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMK\nICAgICAgICAgICAgICAgICAgICAmJiAha2V5LmlzU2VyaWFsaXplZCgpICYm\nICFrZXkuaXNFbWJlZGRlZFBDKCk7CiAgICAgICAgICAgICAgICBib29sZWFu\nIHZyZWwgPSB2aGFuZGxlciA9PSBudWxsIAogICAgICAgICAgICAgICAgICAg\nICYmIHZhbC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQwogICAgICAg\nICAgICAgICAgICAgICYmICF2YWwuaXNTZXJpYWxpemVkKCkgJiYgIXZhbC5p\nc0VtYmVkZGVkUEMoKTsKICAgICAgICAgICAgICAgIGlmICgha3JlbCAmJiB2\ncmVsICYmIGtleS5nZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIGlmICh1c2VJbnZlcnNlS2V5TWFwcGluZyhmaWVs\nZCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVsYXRp\nb25NYXBJbnZlcnNlS2V5RmllbGRTdHJhdGVneSgpOwogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBuZXcgUmVsYXRpb25NYXBUYWJsZUZpZWxkU3RyYXRl\nZ3koKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgh\na3JlbCAmJiBraGFuZGxlciA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgaWYgKCF2cmVsICYmIHZoYW5kbGVy\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICByZXR1cm4gaGFuZGxlck1hcFN0cmF0ZWd5KGZpZWxkLCBraGFu\nZGxlciwgdmhhbmRsZXIsIGtyZWwsCiAgICAgICAgICAgICAgICAgICAgdnJl\nbCwgaW5zdGFsbEhhbmRsZXJzKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuSU5QVVRfU1RSRUFNOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlBVVF9SRUFERVI6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExvYkZp\nZWxkU3RyYXRlZ3koKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvbGxlY3Rpb24g\nc3RyYXRlZ3kgZm9yIHRoZSBnaXZlbiBlbGVtZW50IGhhbmRsZXIsIG9yIG51\nbGwKICAgICAqIGlmIG5vbmUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGaWVs\nZFN0cmF0ZWd5IGhhbmRsZXJDb2xsZWN0aW9uU3RyYXRlZ3koRmllbGRNYXBw\naW5nIGZpZWxkLCAKICAgICAgICBWYWx1ZUhhbmRsZXIgZWhhbmRsZXIsIGJv\nb2xlYW4gaW5zdGFsbEhhbmRsZXJzKSB7CiAgICAgICAgaWYgKGdldENvbmZp\nZ3VyYXRpb24oKS5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKQogICAgICAg\nICAgICAuZ2V0U3RvcmVNYXBDb2xsZWN0aW9uSW5FbnRpdHlBc0Jsb2IoKSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGluc3RhbGxI\nYW5kbGVycykKICAgICAgICAgICAgZmllbGQuZ2V0RWxlbWVudE1hcHBpbmco\nKS5zZXRIYW5kbGVyKGVoYW5kbGVyKTsKICAgICAgICByZXR1cm4gbmV3IEhh\nbmRsZXJDb2xsZWN0aW9uVGFibGVGaWVsZFN0cmF0ZWd5KCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1hcCBzdHJhdGVneSBmb3IgdGhl\nIGdpdmVuIGtleSBhbmQgdmFsdWUgaGFuZGxlcnMgLyByZWxhdGlvbnMsCiAg\nICAgKiBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBG\naWVsZFN0cmF0ZWd5IGhhbmRsZXJNYXBTdHJhdGVneShGaWVsZE1hcHBpbmcg\nZmllbGQsIAogICAgICAgIFZhbHVlSGFuZGxlciBraGFuZGxlciwgVmFsdWVI\nYW5kbGVyIHZoYW5kbGVyLCBib29sZWFuIGtyZWwsIAogICAgICAgIGJvb2xl\nYW4gdnJlbCwgIGJvb2xlYW4gaW5zdGFsbEhhbmRsZXJzKSB7CiAgICAgICAg\naWYgKGdldENvbmZpZ3VyYXRpb24oKS5nZXRDb21wYXRpYmlsaXR5SW5zdGFu\nY2UoKQogICAgICAgICAgICAuZ2V0U3RvcmVNYXBDb2xsZWN0aW9uSW5FbnRp\ndHlBc0Jsb2IoKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\naWYgKGluc3RhbGxIYW5kbGVycykgewogICAgICAgICAgICBmaWVsZC5nZXRL\nZXlNYXBwaW5nKCkuc2V0SGFuZGxlcihraGFuZGxlcik7CiAgICAgICAgICAg\nIGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuc2V0SGFuZGxlcih2aGFuZGxl\ncik7CiAgICAgICAgfQogICAgICAgIGlmICgha3JlbCAmJiAhdnJlbCkKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBIYW5kbGVySGFuZGxlck1hcFRhYmxlRmll\nbGRTdHJhdGVneSgpOwogICAgICAgIGlmICgha3JlbCAmJiB2cmVsKQogICAg\nICAgICAgICByZXR1cm4gbmV3IEhhbmRsZXJSZWxhdGlvbk1hcFRhYmxlRmll\nbGRTdHJhdGVneSgpOwogICAgICAgIGlmIChrcmVsICYmICF2cmVsKQogICAg\nICAgICAgICByZXR1cm4gbmV3IFJlbGF0aW9uSGFuZGxlck1hcFRhYmxlRmll\nbGRTdHJhdGVneSgpOwogICAgICAgIHJldHVybiBuZXcgUmVsYXRpb25SZWxh\ndGlvbk1hcFRhYmxlRmllbGRTdHJhdGVneSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogVXNlIGhpbnRzIGluIG1hcHBpbmcgZGF0YSB0byBmaWd1cmUgb3V0\nIHdoZXRoZXIgdGhlIGdpdmVuIHJlbGF0aW9uCiAgICAgKiBmaWVsZCBzaG91\nbGQgdXNlIGFuIGludmVyc2UgZm9yZWlnbiBrZXkgb3IgYW4gYXNzb2NpYXRp\nb24gdGFibGUgbWFwcGluZy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIHVzZUludmVyc2VLZXlNYXBwaW5nKEZpZWxkTWFwcGluZyBmaWVsZCkgewog\nICAgICAgIEZpZWxkTWFwcGluZyBtYXBwZWQgPSBmaWVsZC5nZXRNYXBwZWRC\neU1hcHBpbmcoKTsKICAgICAgICBpZiAobWFwcGVkICE9IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKG1hcHBlZC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBl\ncy5QQykKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAg\nICBpZiAobWFwcGVkLmdldEVsZW1lbnQoKS5nZXRUeXBlQ29kZSgpID09IEph\ndmFUeXBlcy5QQykKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtbWFwcGVkLWJ5IiwgZmllbGQsCiAgICAgICAgICAgICAgICBtYXBw\nZWQpKTsKICAgICAgICB9CgogICAgICAgIC8vIHdpdGhvdXQgYSBtYXBwZWQt\nYnksIHdlIGhhdmUgdG8gbG9vayBmb3IgY2x1ZXMgYXMgdG8gdGhlIG1hcHBp\nbmcuCiAgICAgICAgLy8gd2UgYXNzdW1lIHRoYXQgYW55dGhpbmcgd2l0aCBl\nbGVtZW50IGZvcmVpZ24ga2V5IGNvbHVtbnMgYnV0IG5vIGpvaW4KICAgICAg\nICAvLyBjb2x1bW5zIG9yIHRhYmxlIHVzZXMgYW4gaW52ZXJzZSBmb3JlaWdu\nIGtleSwgYW5kIGFueXRoaW5nIGVsc2UgdXNlcwogICAgICAgIC8vIGFuIGFz\nc29jaWF0aW9uIHRhYmxlCiAgICAgICAgRmllbGRNYXBwaW5nSW5mbyBpbmZv\nID0gZmllbGQuZ2V0TWFwcGluZ0luZm8oKTsKICAgICAgICBWYWx1ZU1hcHBp\nbmcgZWxlbSA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAg\ncmV0dXJuIGluZm8uZ2V0VGFibGVOYW1lKCkgPT0gbnVsbCAmJiBpbmZvLmdl\ndENvbHVtbnMoKS5pc0VtcHR5KCkKICAgICAgICAgICAgJiYgIWVsZW0uZ2V0\nVmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygpLmlzRW1wdHkoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENoZWNrIHRoZSBnaXZlbiB2YWx1ZSBhZ2FpbnN0IG1h\ncHBlZCBzdHJhdGVnaWVzLgogICAgICovCiAgICBwcml2YXRlIE9iamVjdCBt\nYXBwZWRTdHJhdGVneShWYWx1ZU1hcHBpbmcgdmFsLCBDbGFzcyB0eXBlLAog\nICAgICAgIGJvb2xlYW4gYWRhcHRpbmcpIHsKICAgICAgICBpZiAodHlwZSA9\nPSBudWxsIHx8IHR5cGUgPT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgT2JqZWN0IHN0cmF0ID0gX2RlZmF1bHRz\nLmdldFN0cmF0ZWd5KHZhbCwgdHlwZSwgYWRhcHRpbmcpOwoKICAgICAgICAv\nLyByZWN1cnNlIG9uIHN1cGVyY2xhc3Mgc28gdGhhdCwgZm9yIGV4YW1wbGUs\nIGEgcmVnaXN0ZXJlZCBoYW5kbGVyCiAgICAgICAgLy8gZm9yIGphdmEubGFu\nZy5FbnVtIHdpbGwgd29yayBvbiBhbGwgZW51bXMKICAgICAgICBpZiAoc3Ry\nYXQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG1hcHBlZFN0cmF0ZWd5\nKHZhbCwgdHlwZS5nZXRTdXBlcmNsYXNzKCksIGFkYXB0aW5nKTsKICAgICAg\nICBpZiAoIShzdHJhdCBpbnN0YW5jZW9mIFN0cmluZykpCiAgICAgICAgICAg\nIHJldHVybiBzdHJhdDsKCiAgICAgICAgU3RyaW5nIG5hbWUgPSAoU3RyaW5n\nKSBzdHJhdDsKICAgICAgICBpZiAoTm9uZUZpZWxkU3RyYXRlZ3kuQUxJQVMu\nZXF1YWxzKG5hbWUpKQogICAgICAgICAgICByZXR1cm4gTm9uZUZpZWxkU3Ry\nYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKCiAgICAgICAgU3RyaW5nIHByb3BzID0g\nQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhuYW1lKTsKICAgICAgICBu\nYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKG5hbWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIENsYXNzIGMgPSBKYXZhVHlwZXMuY2xh\nc3NGb3JOYW1lKG5hbWUsIHZhbCwKICAgICAgICAgICAgICAgIChDbGFzc0xv\nYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rp\nb24oRmllbGRTdHJhdGVneS5jbGFzcykpKTsKICAgICAgICAgICAgT2JqZWN0\nIG8gPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAg\nICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0luc3RhbmNlQWN0aW9uKGMpKTsK\nICAgICAgICAgICAgQ29uZmlndXJhdGlvbnMuY29uZmlndXJlSW5zdGFuY2Uo\nbywgZ2V0Q29uZmlndXJhdGlvbigpLCBwcm9wcyk7CiAgICAgICAgICAgIHJl\ndHVybiBvOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIGlmIChlIGluc3RhbmNlb2YgUHJpdmlsZWdlZEFjdGlvbkV4Y2Vw\ndGlvbikKICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25F\neGNlcHRpb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tYXBwZWQt\nc3RyYXRlZ3kiLAogICAgICAgICAgICAgICAgdmFsLCBuYW1lKSwgZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5zdGFudGlhdGUgdGhl\nIGdpdmVuIHZhbHVlJ3MgbmFtZWQgaGFuZGxlciwgb3IgcmV0dXJuIG51bGwg\naWYgbm8KICAgICAqIG5hbWVkIGhhbmRsZXIuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBWYWx1ZUhhbmRsZXIgbmFtZWRIYW5kbGVyKFZhbHVlTWFwcGluZyB2\nYWwpIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IHZhbC5nZXRWYWx1ZUluZm8o\nKS5nZXRTdHJhdGVneSgpOwogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJpbmcgcHJvcHMg\nPSBDb25maWd1cmF0aW9ucy5nZXRQcm9wZXJ0aWVzKG5hbWUpOwogICAgICAg\nIG5hbWUgPSBDb25maWd1cmF0aW9ucy5nZXRDbGFzc05hbWUobmFtZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3MgYyA9IEphdmFUeXBlcy5j\nbGFzc0Zvck5hbWUobmFtZSwgdmFsLAogICAgICAgICAgICAgICAgKENsYXNz\nTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFj\ndGlvbihWYWx1ZUhhbmRsZXIuY2xhc3MpKSk7CiAgICAgICAgICAgIGlmIChW\nYWx1ZUhhbmRsZXIuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjKSkgewogICAg\nICAgICAgICAgICAgVmFsdWVIYW5kbGVyIHZoID0gKFZhbHVlSGFuZGxlcikg\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rpb24oYykpOwog\nICAgICAgICAgICAgICAgQ29uZmlndXJhdGlvbnMuY29uZmlndXJlSW5zdGFu\nY2UodmgsIGdldENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAgICAg\nICBwcm9wcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdmg7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7IC8vIG5hbWVkIGZpZWxk\nIHN0cmF0ZWd5CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhj\nZXB0aW9uKQogICAgICAgICAgICAgICAgZSA9ICgoUHJpdmlsZWdlZEFjdGlv\nbkV4Y2VwdGlvbikgZSkuZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXZhbHVl\nLWhhbmRsZXIiLAogICAgICAgICAgICAgICAgdmFsLCBuYW1lKSwgZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBk\nZWZhdWx0IGhhbmRsZXIgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gdmFsdWUuIERv\nZXMKICAgICAqIG5vdCB0YWtlIGludG8gYWNjb3VudCB0aGUgbmFtZWQgaGFu\nZGxlciwgaWYgYW55LgogICAgICovCiAgICBwcm90ZWN0ZWQgVmFsdWVIYW5k\nbGVyIGRlZmF1bHRIYW5kbGVyKFZhbHVlTWFwcGluZyB2YWwpIHsKICAgICAg\nICByZXR1cm4gZGVmYXVsdEhhbmRsZXIodmFsLCBnZXRTdHJhdGVneUluc3Rh\nbGxlcigpLmlzQWRhcHRpbmcoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBE\nZXRlcm1pbmUgdGhlIGRlZmF1bHQgaGFuZGxlciB0byB1c2UgZm9yIHRoZSBn\naXZlbiB2YWx1ZS4gRG9lcwogICAgICogbm90IHRha2UgaW50byBhY2NvdW50\nIHRoZSBuYW1lZCBoYW5kbGVyLCBpZiBhbnkuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBWYWx1ZUhhbmRsZXIgZGVmYXVsdEhhbmRsZXIoVmFsdWVNYXBwaW5n\nIHZhbCwgYm9vbGVhbiBhZGFwdGluZykgewogICAgICAgIGlmICh2YWwuaXNT\nZXJpYWxpemVkKCkpIHsKICAgICAgICAgICAgaWYgKF9kaWN0Lm1heEVtYmVk\nZGVkQmxvYlNpemUgIT0gLTEpCiAgICAgICAgICAgICAgICB3YXJuTWF4RW1i\nZWRkZWQodmFsLCBfZGljdC5tYXhFbWJlZGRlZEJsb2JTaXplKTsKICAgICAg\nICAgICAgcmV0dXJuIEJsb2JWYWx1ZUhhbmRsZXIuZ2V0SW5zdGFuY2UoKTsK\nICAgICAgICB9CgogICAgICAgIE9iamVjdCBoYW5kbGVyID0gbWFwcGVkU3Ry\nYXRlZ3kodmFsLCB2YWwuZ2V0VHlwZSgpLCBhZGFwdGluZyk7CiAgICAgICAg\naWYgKGhhbmRsZXIgaW5zdGFuY2VvZiBWYWx1ZUhhbmRsZXIpCiAgICAgICAg\nICAgIHJldHVybiAoVmFsdWVIYW5kbGVyKSBoYW5kbGVyOwoKICAgICAgICBp\nZiAodmFsLmdldFR5cGUoKSA9PSBieXRlW10uY2xhc3MgCiAgICAgICAgICAg\nIHx8IHZhbC5nZXRUeXBlKCkgPT0gQnl0ZVtdLmNsYXNzKSB7CiAgICAgICAg\nICAgIGlmIChfZGljdC5tYXhFbWJlZGRlZEJsb2JTaXplICE9IC0xKQogICAg\nICAgICAgICAgICAgd2Fybk1heEVtYmVkZGVkKHZhbCwgX2RpY3QubWF4RW1i\nZWRkZWRCbG9iU2l6ZSk7CiAgICAgICAgICAgIHJldHVybiBCeXRlQXJyYXlW\nYWx1ZUhhbmRsZXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICB9CiAgICAgICAg\naWYgKHZhbC5nZXRUeXBlKCkgPT0gY2hhcltdLmNsYXNzCiAgICAgICAgICAg\nIHx8IHZhbC5nZXRUeXBlKCkgPT0gQ2hhcmFjdGVyW10uY2xhc3MpIHsKICAg\nICAgICAgICAgaWYgKGlzQ2xvYih2YWwsIHRydWUpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIENoYXJBcnJheVN0cmVhbVZhbHVlSGFuZGxlci5nZXRJbnN0\nYW5jZSgpOwogICAgICAgICAgICByZXR1cm4gQ2hhckFycmF5VmFsdWVIYW5k\nbGVyLmdldEluc3RhbmNlKCk7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2gg\nKHZhbC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJPT0xFQU46CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJPT0xFQU5fT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNI\nT1JUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdF\nUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DQUxFTkRBUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxF\nOgogICAgICAgICAgICAgICAgcmV0dXJuIEltbXV0YWJsZVZhbHVlSGFuZGxl\nci5nZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5T\nVFJJTkc6CiAgICAgICAgICAgICAgICBpZiAoaXNDbG9iKHZhbCwgdHJ1ZSkp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIENsb2JWYWx1ZUhhbmRsZXIu\nZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiBJbW11dGFi\nbGVWYWx1ZUhhbmRsZXIuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICBpZiAoIXZhbC5nZXRU\neXBlTWFwcGluZygpLmlzTWFwcGVkKCkKICAgICAgICAgICAgICAgICAgICAm\nJiB1c2VVbnR5cGVkUENIYW5kbGVyKHZhbCkpIAogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBVbnR5cGVkUENWYWx1ZUhhbmRsZXIuZ2V0SW5zdGFuY2Uo\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgcmV0dXJuIFVu\ndHlwZWRQQ1ZhbHVlSGFuZGxlci5nZXRJbnN0YW5jZSgpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IE9iamVjdElkVmFsdWVIYW5kbGVyKCk7CiAgICAgICAgfQogICAgICAg\nIGlmICghZ2V0Q29uZmlndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0\nYW5jZSgpCiAgICAgICAgICAgIC5nZXRTdG9yZU1hcENvbGxlY3Rpb25JbkVu\ndGl0eUFzQmxvYigpCiAgICAgICAgICAgICYmIHZhbC5pc0VtYmVkZGVkUEMo\nKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBFbGVtZW50RW1iZWRWYWx1ZUhh\nbmRsZXIoKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0cnVlIGlmIHdlIHNob3VsZCB1c2UgdGhlIGdlbmVy\naWMgdW50eXBlZCBQQyBoYW5kbGVyIGZvciB0aGUKICAgICAqIGdpdmVuIHVu\nbWFwcGVkIHJlbGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4g\ndXNlVW50eXBlZFBDSGFuZGxlcihWYWx1ZU1hcHBpbmcgdmFsKSB7CiAgICAg\nICAgQ2xhc3NNYXBwaW5nIHJlbCA9IHZhbC5nZXRUeXBlTWFwcGluZygpOwog\nICAgICAgIHJldHVybiByZWwuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NN\nYXBwaW5nLklEX1VOS05PV04KICAgICAgICAgICAgfHwgKHJlbC5nZXRJZGVu\ndGl0eVR5cGUoKSA9PSBDbGFzc01hcHBpbmcuSURfQVBQTElDQVRJT04KICAg\nICAgICAgICAgJiYgKHJlbC5nZXRQcmltYXJ5S2V5RmllbGRzKCkubGVuZ3Ro\nID09IDAKICAgICAgICAgICAgfHwgKCFyZWwuaXNPcGVuSlBBSWRlbnRpdHko\nKSAmJiBNb2RpZmllci5pc0Fic3RyYWN0CiAgICAgICAgICAgIChyZWwuZ2V0\nT2JqZWN0SWRUeXBlKCkuZ2V0TW9kaWZpZXJzKCkpKSkpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2hlY2tzIGZvciBoaW50cyBhcyB0byB3aGV0aGVyIHRo\nZSBnaXZlbiBjb2x1bW4gaXMgYSBDTE9CLgogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gaXNDbG9iKFZhbHVlTWFwcGluZyB2YWwsIGJvb2xlYW4gd2Fy\nbikgewogICAgICAgIExpc3QgY29scyA9IHZhbC5nZXRWYWx1ZUluZm8oKS5n\nZXRDb2x1bW5zKCk7CiAgICAgICAgaWYgKGNvbHMuc2l6ZSgpICE9IDEpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgQ29sdW1uIGNvbCA9\nIChDb2x1bW4pIGNvbHMuZ2V0KDApOwogICAgICAgIGlmIChjb2wuZ2V0U2l6\nZSgpICE9IC0xICYmIGNvbC5nZXRUeXBlKCkgIT0gVHlwZXMuQ0xPQikKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAoX2RpY3QuZ2V0\nUHJlZmVycmVkVHlwZShUeXBlcy5DTE9CKSAhPSBUeXBlcy5DTE9CKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmICh3YXJuICYmIF9k\naWN0Lm1heEVtYmVkZGVkQ2xvYlNpemUgIT0gLTEpCiAgICAgICAgICAgIHdh\ncm5NYXhFbWJlZGRlZCh2YWwsIF9kaWN0Lm1heEVtYmVkZGVkQ2xvYlNpemUp\nOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICog\nV2FybiB0aGF0IHRoZSBnaXZlbiB2YWx1ZSBpcyBiZWluZyBtYXBwZWQgdG8g\nYSBoYW5kbGVyIHRoYXQgd2lsbCBub3QKICAgICAqIGJlIGFibGUgdG8gc3Rv\ncmUgbGFyZ2UgbG9icy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdhcm5N\nYXhFbWJlZGRlZChWYWx1ZU1hcHBpbmcgdmFsLCBpbnQgc2l6ZSkgewogICAg\nICAgIGlmIChnZXRMb2coKS5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAg\nIGdldExvZygpLndhcm4oX2xvYy5nZXQoIm1heC1lbWJlZC1sb2IiLCB2YWws\nCiAgICAgICAgICAgICAgICBTdHJpbmcudmFsdWVPZihzaXplKSkpOwogICAg\nfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0cmF0\nZWd5IHRvIHVzZSBmb3IgdGhlIGdpdmVuIGRpc2NyaW1pbmF0b3IuCiAgICAg\nKiBEb2VzIG5vdCB0YWtlIGludG8gYWNjb3VudCB0aGUgY3VycmVudCBzdHJh\ndGVneSwgaWYgYW55LgogICAgICovCiAgICBwcm90ZWN0ZWQgRGlzY3JpbWlu\nYXRvclN0cmF0ZWd5IGRlZmF1bHRTdHJhdGVneShEaXNjcmltaW5hdG9yIGRp\nc2NyaW0pIHsKICAgICAgICByZXR1cm4gZGVmYXVsdFN0cmF0ZWd5KGRpc2Ny\naW0sIGdldFN0cmF0ZWd5SW5zdGFsbGVyKCkuaXNBZGFwdGluZygpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB0aGUgZGVmYXVsdCBzdHJh\ndGVneSB0byB1c2UgZm9yIHRoZSBnaXZlbiBkaXNjcmltaW5hdG9yLgogICAg\nICogRG9lcyBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIGN1cnJlbnQgc3Ry\nYXRlZ3ksIGlmIGFueS4KICAgICAqLwogICAgcHJvdGVjdGVkIERpc2NyaW1p\nbmF0b3JTdHJhdGVneSBkZWZhdWx0U3RyYXRlZ3koRGlzY3JpbWluYXRvciBk\naXNjcmltLAogICAgICAgIGJvb2xlYW4gYWRhcHRpbmcpIHsKICAgICAgICBD\nbGFzc01hcHBpbmcgY2xzID0gZGlzY3JpbS5nZXRDbGFzc01hcHBpbmcoKTsK\nICAgICAgICBpZiAoY2xzLmdldEVtYmVkZGluZ01ldGFEYXRhKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIE5vbmVEaXNjcmltaW5hdG9yU3RyYXRl\nZ3kuZ2V0SW5zdGFuY2UoKTsKICAgICAgICBpZiAoY2xzLmdldEpvaW5hYmxl\nUENTdXBlcmNsYXNzTWFwcGluZygpID09IG51bGwKICAgICAgICAgICAgJiYg\nKGNscy5nZXRTdHJhdGVneSgpID09IE5vbmVDbGFzc1N0cmF0ZWd5LmdldElu\nc3RhbmNlKCkKICAgICAgICAgICAgfHwgTW9kaWZpZXIuaXNGaW5hbChkaXNj\ncmltLmdldENsYXNzTWFwcGluZygpLmdldERlc2NyaWJlZFR5cGUoKS4KICAg\nICAgICAgICAgZ2V0TW9kaWZpZXJzKCkpKSkKICAgICAgICAgICAgcmV0dXJu\nIE5vbmVEaXNjcmltaW5hdG9yU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKCiAg\nICAgICAgT2JqZWN0IHN0cmF0ID0gX2RlZmF1bHRzLmdldFN0cmF0ZWd5KGRp\nc2NyaW0sIGFkYXB0aW5nKTsKICAgICAgICBpZiAoc3RyYXQgaW5zdGFuY2Vv\nZiBTdHJpbmcpCiAgICAgICAgICAgIHJldHVybiBpbnN0YW50aWF0ZURpc2Ny\naW1pbmF0b3JTdHJhdGVneSgoU3RyaW5nKSBzdHJhdCwgZGlzY3JpbSk7CiAg\nICAgICAgaWYgKHN0cmF0ICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiAo\nRGlzY3JpbWluYXRvclN0cmF0ZWd5KSBzdHJhdDsKCiAgICAgICAgaWYgKGNs\ncy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbmV3IFN1cGVyY2xhc3NEaXNjcmltaW5hdG9y\nU3RyYXRlZ3koKTsKICAgICAgICBpZiAoZGlzY3JpbS5nZXRNYXBwaW5nSW5m\nbygpLmdldFZhbHVlKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBWYWx1ZU1hcERpc2NyaW1pbmF0b3JTdHJhdGVneSgpOwogICAgICAgIGlm\nIChjbHMuZ2V0TWFwcGVkUENTdXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBOb25lRGlzY3JpbWluYXRvclN0cmF0ZWd5\nLmdldEluc3RhbmNlKCk7CiAgICAgICAgaWYgKGFkYXB0aW5nIHx8IF9kZWZh\ndWx0cy5kZWZhdWx0TWlzc2luZ0luZm8oKSkKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBDbGFzc05hbWVEaXNjcmltaW5hdG9yU3RyYXRlZ3koKTsKICAgICAg\nICBEQkRpY3Rpb25hcnkgZGljdCA9ICgoSkRCQ0NvbmZpZ3VyYXRpb24pIGdl\ndENvbmZpZ3VyYXRpb24oKSkuCiAgICAgICAgICAgIGdldERCRGljdGlvbmFy\neUluc3RhbmNlKCk7CiAgICAgICAgaWYgKGRpY3Quam9pblN5bnRheCA9PSBK\nb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElPTkFMKQogICAgICAgICAgICBy\nZXR1cm4gTm9uZURpc2NyaW1pbmF0b3JTdHJhdGVneS5nZXRJbnN0YW5jZSgp\nOwogICAgICAgIHJldHVybiBuZXcgU3ViY2xhc3NKb2luRGlzY3JpbWluYXRv\nclN0cmF0ZWd5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUg\ndGhlIGRlZmF1bHQgc3RyYXRlZ3kgdG8gdXNlIGZvciB0aGUgZ2l2ZW4gdmVy\nc2lvbi4KICAgICAqIERvZXMgbm90IHRha2UgaW50byBhY2NvdW50IHRoZSBj\ndXJyZW50IHN0cmF0ZWd5LCBpZiBhbnkuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBWZXJzaW9uU3RyYXRlZ3kgZGVmYXVsdFN0cmF0ZWd5KFZlcnNpb24gdmVy\nc2lvbikgewogICAgICAgIHJldHVybiBkZWZhdWx0U3RyYXRlZ3kodmVyc2lv\nbiwgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5pc0FkYXB0aW5nKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBkZWZhdWx0IHN0cmF0\nZWd5IHRvIHVzZSBmb3IgdGhlIGdpdmVuIHZlcnNpb24uCiAgICAgKiBEb2Vz\nIG5vdCB0YWtlIGludG8gYWNjb3VudCB0aGUgY3VycmVudCBzdHJhdGVneSwg\naWYgYW55LgogICAgICovCiAgICBwcm90ZWN0ZWQgVmVyc2lvblN0cmF0ZWd5\nIGRlZmF1bHRTdHJhdGVneShWZXJzaW9uIHZlcnNpb24sCiAgICAgICAgYm9v\nbGVhbiBhZGFwdGluZykgewogICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSB2\nZXJzaW9uLmdldENsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChjbHMuZ2V0\nRW1iZWRkaW5nTWV0YURhdGEoKSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gTm9uZVZlcnNpb25TdHJhdGVneS5nZXRJbnN0YW5jZSgpOwogICAgICAg\nIGlmIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgPT0g\nbnVsbAogICAgICAgICAgICAmJiBjbHMuZ2V0U3RyYXRlZ3koKSA9PSBOb25l\nQ2xhc3NTdHJhdGVneS5nZXRJbnN0YW5jZSgpKQogICAgICAgICAgICByZXR1\ncm4gTm9uZVZlcnNpb25TdHJhdGVneS5nZXRJbnN0YW5jZSgpOwoKICAgICAg\nICBPYmplY3Qgc3RyYXQgPSBfZGVmYXVsdHMuZ2V0U3RyYXRlZ3kodmVyc2lv\nbiwgYWRhcHRpbmcpOwogICAgICAgIGlmIChzdHJhdCBpbnN0YW5jZW9mIFN0\ncmluZykKICAgICAgICAgICAgcmV0dXJuIGluc3RhbnRpYXRlVmVyc2lvblN0\ncmF0ZWd5KChTdHJpbmcpIHN0cmF0LCB2ZXJzaW9uKTsKICAgICAgICBpZiAo\nc3RyYXQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIChWZXJzaW9uU3Ry\nYXRlZ3kpIHN0cmF0OwoKICAgICAgICBpZiAoY2xzLmdldEpvaW5hYmxlUENT\ndXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBuZXcgU3VwZXJjbGFzc1ZlcnNpb25TdHJhdGVneSgpOwoKICAgICAgICBG\naWVsZE1hcHBpbmcgdmZpZWxkID0gdmVyc2lvbi5nZXRDbGFzc01hcHBpbmco\nKS4KICAgICAgICAgICAgZ2V0VmVyc2lvbkZpZWxkTWFwcGluZygpOwogICAg\nICAgIGlmICh2ZmllbGQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGRl\nZmF1bHRTdHJhdGVneSh2ZXJzaW9uLCB2ZmllbGQpOwogICAgICAgIGlmIChh\nZGFwdGluZyB8fCBfZGVmYXVsdHMuZGVmYXVsdE1pc3NpbmdJbmZvKCkpCiAg\nICAgICAgICAgIHJldHVybiBuZXcgTnVtYmVyVmVyc2lvblN0cmF0ZWd5KCk7\nCiAgICAgICAgcmV0dXJuIE5vbmVWZXJzaW9uU3RyYXRlZ3kuZ2V0SW5zdGFu\nY2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGVmYXVs\ndCB2ZXJzaW9uIHN0cmF0ZWd5LCBnaXZlbiBhIHZlcnNpb24gZmllbGQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBWZXJzaW9uU3RyYXRlZ3kgZGVmYXVsdFN0\ncmF0ZWd5KFZlcnNpb24gdmVycywKICAgICAgICBGaWVsZE1hcHBpbmcgdmZp\nZWxkKSB7CiAgICAgICAgc3dpdGNoICh2ZmllbGQuZ2V0VHlwZUNvZGUoKSkg\newogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgIHJl\ndHVybiAoSmF2YVZlcnNpb25zLlZFUlNJT04gPj0gNSkgCiAgICAgICAgICAg\nICAgICAgICAgPyBuZXcgTmFub1ByZWNpc2lvblRpbWVzdGFtcFZlcnNpb25T\ndHJhdGVneSgpCiAgICAgICAgICAgICAgICAgICAgOiBuZXcgVGltZXN0YW1w\nVmVyc2lvblN0cmF0ZWd5KCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZ\nVEVfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5OVU1CRVI6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIE51bWJlclZlcnNpb25TdHJhdGVneSgpOwogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmVWZXJzaW9uU3RyYXRlZ3ku\nZ2V0SW5zdGFuY2UoKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyB2b2lkIGVuZENvbmZpZ3VyYXRpb24oKQogICAgewogICAgICAgIHN1cGVy\nLmVuZENvbmZpZ3VyYXRpb24oKTsKCiAgICAgICAgSkRCQ0NvbmZpZ3VyYXRp\nb24gY29uZiA9IChKREJDQ29uZmlndXJhdGlvbikgZ2V0Q29uZmlndXJhdGlv\nbigpOwogICAgICAgIF9kaWN0ID0gY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0\nYW5jZSgpOwogICAgICAgIGlmIChfZGVmYXVsdHMgPT0gbnVsbCkKICAgICAg\nICAgICAgX2RlZmF1bHRzID0gY29uZi5nZXRNYXBwaW5nRGVmYXVsdHNJbnN0\nYW5jZSgpOwogICAgICAgIGlmIChfc2NoZW1hICE9IG51bGwgJiYgX3NjaGVt\nYSBpbnN0YW5jZW9mIENvbmZpZ3VyYWJsZSkgewogICAgICAgICAgICAoKENv\nbmZpZ3VyYWJsZSkgX3NjaGVtYSkuc2V0Q29uZmlndXJhdGlvbihjb25mKTsK\nICAgICAgICAgICAgKChDb25maWd1cmFibGUpIF9zY2hlbWEpLnN0YXJ0Q29u\nZmlndXJhdGlvbigpOwogICAgICAgICAgICAoKENvbmZpZ3VyYWJsZSkgX3Nj\naGVtYSkuZW5kQ29uZmlndXJhdGlvbigpOwogICAgICAgIH0gICAgICAgICAg\nICAKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBGaW5kcyB0aGUgYmFzZSBj\nbGFzcyBtYXBwaW5nIGZvciB0aGUgc3BlY2lmaWVkIG1hcHBpbmcuICBMb2Fk\ncyBhbGwKICAgICAqIHBlcnNpc3RlbnQgdHlwZXMgaWYgbmVjZXNzYXJ5LCBz\naW5jZSBhbGwgcGVyc2lzdGVudCBzdWJjbGFzc2VzIG9mIHRoaXMKICAgICAq\nIG1hcHBpbmcgbWF5IG5vdCBoYXZlIGJlZW4gcmVzb2x2ZWQgYmVmb3JlIHRo\naXMgbWV0aG9kIGlzIGNhbGxlZC4KICAgICAqLwogICAgcHJvdGVjdGVkIENs\nYXNzTWFwcGluZyBmaW5kQmFzZUNsYXNzTWFwcGluZyhDbGFzc01hcHBpbmcg\nbWFwcGluZykgeyAgICAgICAgCiAgICAgICAgQ2xhc3NNYXBwaW5nIGJhc2VN\nYXBwaW5nID0gbnVsbDsKICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gbWFw\ncGluZy5nZXRQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHN1\ncCA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIG5vIHN1cGVyY2xhc3MgbWV0\nYWRhdGEgd2FzIHByb3ZpZGVkLiAgY2hlY2sgdG8gc2VlIGlmIHRoaXMgY2xh\nc3MKICAgICAgICAgICAgLy8gaGFzIGFueSBwZXJzaXN0ZW50IHN1YmNsYXNz\nZXMuCiAgICAgICAgICAgIGlmIChtYXBwaW5nLmdldFBDU3ViY2xhc3Nlcygp\nLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICBiYXNlTWFwcGluZyA9IG1h\ncHBpbmc7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8g\ncGVyc2lzdGVudCBzdWJjbGFzc2VzIG1heSBub3QgaGF2ZSBiZWVuIHJlc29s\ndmVkIHlldC4gIAogICAgICAgICAgICAgICAgLy8gcnVuIHRocm91Z2ggdGhl\nIHBlcnNpc3RlbnQgdHlwZXMgdG8gc2VlIGlmIGFueSBvZiB0aGVtIAogICAg\nICAgICAgICAgICAgLy8gb3IgdGhlaXIgc3VwZXJjbGFzcyBpcyBhIHN1YmNs\nYXNzIG9mIHRoaXMgY2xhc3MuCiAgICAgICAgICAgICAgICBDb2xsZWN0aW9u\nIGNsYXNzZXMgPSBsb2FkUGVyc2lzdGVudFR5cGVzKGZhbHNlLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgbWFwcGluZy5nZXRFbnZDbGFzc0xvYWRlcigp\nKTsKICAgICAgICAgICAgICAgIENsYXNzIGNsczsKICAgICAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gY2xhc3Nlcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgIGNscyA9IChDbGFz\ncykgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBDbGFzcyBzdXBj\nbCA9IGNscy5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgICAgICAgICAgICAg\nd2hpbGUgKHN1cGNsICE9IG51bGwgJiYgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICFzdXBjbC5nZXRDbGFzcygpLmVxdWFscyhqYXZhLmxhbmcuT2Jq\nZWN0LmNsYXNzKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN1\ncGNsLmlzSW50ZXJmYWNlKCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHN1cGNsLmVxdWFscyhtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKSkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VNYXBwaW5nID0g\nbWFwcGluZzsgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICBzdXBjbCA9IHN1cGNsLmdldFN1cGVyY2xhc3MoKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VN\nYXBwaW5nICE9IG51bGwpIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghc3VwLmdldERlc2NyaWJl\nZFR5cGUoKS5pc0ludGVyZmFjZSgpKSB7CiAgICAgICAgICAgIC8vIGlmIHRo\nZSBzdXBlcmNsYXNzIGlzIG5vdCBhIG1hbmFnZWQgaW50ZXJmYWNlLCBmaW5k\nIHRoZSByb290CiAgICAgICAgICAgIC8vIHN1cGVyY2xhc3MgYW5kIGdldCBp\ndHMgbWFwcGluZyBpbmZvCiAgICAgICAgICAgIENsYXNzTWFwcGluZyBzdXBj\nbSA9IHN1cDsKICAgICAgICAgICAgd2hpbGUgKHN1cGNtICE9IG51bGwgJiYg\nCiAgICAgICAgICAgICAgICAgICAgIXN1cGNtLmdldERlc2NyaWJlZFR5cGUo\nKS5pc0ludGVyZmFjZSgpICYmCiAgICAgICAgICAgICAgICAgICAgIXN1cGNt\nLmlzRW1iZWRkZWRPbmx5KCkpIHsKICAgICAgICAgICAgICAgIENsYXNzTWFw\ncGluZyBzdXBjbTIgPSBzdXBjbS5nZXRQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7\nCiAgICAgICAgICAgICAgICBpZiAoc3VwY20yID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgYmFzZU1hcHBpbmcgPSBzdXBjbTsKICAgICAgICAgICAg\nICAgIHN1cGNtID0gc3VwY20yOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBiYXNlTWFwcGluZzsKICAgIH0KICAgCiAgICAvKioK\nICAgICAqIElmIGFuIGluaGVyaXRhbmNlIHN0cmF0ZWd5IGhhcyBub3QgYmVl\nbiBzZXQgb24gdGhpcyBtYXBwaW5nLCBzZXQgaXQKICAgICAqIHRvIHRoZSBk\nZWZhdWx0IChmbGF0KS4gIFRoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQg\nYmVmb3JlIHN0cmF0ZWdpZXMKICAgICAqIGFyZSBjcmVhdGVkIGZvciB0aGUg\nc3BlY2lmaWVkIG1hcHBpbmcuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIHNldERlZmF1bHRJbmhlcml0YW5jZVN0cmF0ZWd5KENsYXNzTWFwcGluZyBt\nYXBwaW5nKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nSW5mbyBpbmZvID0gbWFw\ncGluZy5nZXRNYXBwaW5nSW5mbygpOwogICAgICAgIGlmIChpbmZvICE9IG51\nbGwgJiYgaW5mby5nZXRIaWVyYXJjaHlTdHJhdGVneSgpID09IG51bGwpCiAg\nICAgICAgICAgIGluZm8uc2V0SGllcmFyY2h5U3RyYXRlZ3koRmxhdENsYXNz\nU3RyYXRlZ3kuQUxJQVMpOyAgICAgICAgCiAgICB9IAogICAgCiAgICAvKioK\nICAgICAqIERldGVybWluZXMgd2hldGhlciBhbiBpbmhlcnRhbmNlIHN0cmF0\nZWd5IGhhcyBiZWVuIHNldCBvbiB0aGUKICAgICAqIHNwZWNpZmllZCBtYXBw\naW5nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYXNJbmhlcml0\nYW5jZVN0cmF0ZWd5KENsYXNzTWFwcGluZyBtYXBwaW5nKSB7CiAgICAgICAg\nQ2xhc3NNYXBwaW5nSW5mbyBpbmZvID0gbWFwcGluZy5nZXRNYXBwaW5nSW5m\nbygpOwogICAgICAgIGlmIChpbmZvICE9IG51bGwgJiYgaW5mby5nZXRIaWVy\nYXJjaHlTdHJhdGVneSgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIHJldHVybiBmYWxzZTsgICAgICAgIAogICAgfQp9Cg==\n","encoding":"base64"}

