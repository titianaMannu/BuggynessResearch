{"sha":"1b82463902dd1a19b69e710bb451bdc68f403ed4","node_id":"MDQ6QmxvYjIwNjM2NDoxYjgyNDYzOTAyZGQxYTE5YjY5ZTcxMGJiNDUxYmRjNjhmNDAzZWQ0","size":14934,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1b82463902dd1a19b69e710bb451bdc68f403ed4","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRC\nQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5F\nbWJlZGRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5GaWVsZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLkpvaW5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5WYWx1ZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLkNvbHVtbklPOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuUHJpbWFyeUtleTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLlJvd01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZVN0cmF0ZWdpZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlv\nbjsKCi8qKgogKiBNYXBwaW5nIGZvciBhIHNpbmdsZS12YWx1ZWQgZmllbGQg\ndGhhdCBkZWxlZ2F0ZXMgdG8gYSB7QGxpbmsgVmFsdWVIYW5kbGVyfS4KICoK\nICogQGF1dGhvciBBYmUgV2hpdGUKICogQHNpbmNlIDAuNC4wCiAqLwpwdWJs\naWMgY2xhc3MgSGFuZGxlckZpZWxkU3RyYXRlZ3kKICAgIGV4dGVuZHMgQWJz\ndHJhY3RGaWVsZFN0cmF0ZWd5CiAgICBpbXBsZW1lbnRzIEpvaW5hYmxlLCBF\nbWJlZGRhYmxlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3Qg\nTlVMTCA9IG5ldyBPYmplY3QoKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAg\nICAgKEhhbmRsZXJGaWVsZFN0cmF0ZWd5LmNsYXNzKTsKCiAgICBwcml2YXRl\nIENvbHVtbltdIF9jb2xzID0gbnVsbDsKICAgIHByaXZhdGUgQ29sdW1uSU8g\nX2lvID0gbnVsbDsKICAgIHByaXZhdGUgT2JqZWN0W10gX2FyZ3MgPSBudWxs\nOwogICAgcHJpdmF0ZSBib29sZWFuIF9sb2FkID0gZmFsc2U7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX2xvYiA9IGZhbHNlOwoKICAgIHB1YmxpYyB2b2lkIG1h\ncChib29sZWFuIGFkYXB0KSB7CiAgICAgICAgaWYgKGZpZWxkLmdldEhhbmRs\nZXIoKSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLWhhbmRsZXIiLCBmaWVsZCkpOwogICAg\nICAgIGFzc2VydE5vdE1hcHBlZEJ5KCk7CgogICAgICAgIC8vIG1hcCBqb2lu\nIGtleSAoaWYgYW55KQogICAgICAgIGZpZWxkLm1hcEpvaW4oYWRhcHQsIGZh\nbHNlKTsKICAgICAgICBmaWVsZC5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJ\nbmZvKCkuYXNzZXJ0Tm9TY2hlbWFDb21wb25lbnRzCiAgICAgICAgICAgIChm\naWVsZC5nZXRLZXkoKSwgIWFkYXB0KTsKICAgICAgICBmaWVsZC5nZXRFbGVt\nZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLmFzc2VydE5vU2NoZW1hQ29t\ncG9uZW50cwogICAgICAgICAgICAoZmllbGQuZ2V0RWxlbWVudCgpLCAhYWRh\ncHQpOwoKICAgICAgICBfaW8gPSBuZXcgQ29sdW1uSU8oKTsKICAgICAgICBf\nY29scyA9IEhhbmRsZXJTdHJhdGVnaWVzLm1hcChmaWVsZCwgZmllbGQuZ2V0\nTmFtZSgpLCBfaW8sIGFkYXB0KTsKICAgICAgICBpZiAoZmllbGQuZ2V0VmFs\ndWVTdHJhdGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5BVVRPQVNTSUdOKSB7\nCiAgICAgICAgICAgIC8vIGZpcnN0IHNlZSBpZiBhbnkgY29sdW1ucyBhbHJl\nYWR5IG1hcmtlZCBhdXRvYXNzaWduOyBpZiBub3QgbWFyawogICAgICAgICAg\nICAvLyB0aGVtIGFsbAogICAgICAgICAgICBib29sZWFuIG1hcmtlZCA9IGZh\nbHNlOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgIW1hcmtlZCAmJiBp\nIDwgX2NvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoX2Nv\nbHNbaV0uaXNBdXRvQXNzaWduZWQoKSkKICAgICAgICAgICAgICAgICAgICBt\nYXJrZWQgPSB0cnVlOwogICAgICAgICAgICBpZiAoIW1hcmtlZCkKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2NvbHMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgICAgICAgICAgX2NvbHNbaV0uc2V0QXV0b0Fzc2ln\nbmVkKHRydWUpOwogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHByaW1hcnkg\na2V5IGNvbHVtbnMgdG8gdGFibGUgcGsgaWYgbG9naWNhbAogICAgICAgIGZp\nZWxkLm1hcFByaW1hcnlLZXkoYWRhcHQpOwogICAgICAgIFByaW1hcnlLZXkg\ncGsgPSBmaWVsZC5nZXRUYWJsZSgpLmdldFByaW1hcnlLZXkoKTsKICAgICAg\nICBpZiAoZmllbGQuaXNQcmltYXJ5S2V5KCkgJiYgcGsgIT0gbnVsbCAmJiAo\nYWRhcHQgfHwgcGsuaXNMb2dpY2FsKCkpKQogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAg\nICAgcGsuYWRkQ29sdW1uKF9jb2xzW2ldKTsKCiAgICAgICAgLy8gc2V0IGpv\naW5hYmxlCiAgICAgICAgaWYgKCFmaWVsZC5nZXRIYW5kbGVyKCkub2JqZWN0\nVmFsdWVSZXF1aXJlc0xvYWQoZmllbGQpKQogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAg\nICAgZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCkuc2V0Sm9pbmFibGUoX2Nv\nbHNbaV0sIHRoaXMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluaXRpYWxp\nemUoKSB7CiAgICAgICAgX2xvYWQgPSBmaWVsZC5nZXRIYW5kbGVyKCkub2Jq\nZWN0VmFsdWVSZXF1aXJlc0xvYWQoZmllbGQpOwogICAgICAgIGlmIChfbG9h\nZCkKICAgICAgICAgICAgZmllbGQuc2V0VXNlc0ludGVybWVkaWF0ZSh0cnVl\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgIV9sb2IgJiYgaSA8IF9jb2xz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBfbG9iID0gX2NvbHNbaV0uaXNM\nb2IoKTsKCiAgICAgICAgT2JqZWN0IGFyZ3MgPSBmaWVsZC5nZXRIYW5kbGVy\nKCkuZ2V0UmVzdWx0QXJndW1lbnQoZmllbGQpOwogICAgICAgIGlmIChhcmdz\nID09IG51bGwpCiAgICAgICAgICAgIF9hcmdzID0gbnVsbDsKICAgICAgICBl\nbHNlIGlmIChfY29scy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgX2FyZ3Mg\nPSBuZXcgT2JqZWN0W117IGFyZ3MgfTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIF9hcmdzID0gKE9iamVjdFtdKSBhcmdzOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGluc2VydChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3Rv\ncmUgc3RvcmUsIFJvd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgUm93IHJvdyA9IGZpZWxkLmdldFJvdyhzbSwg\nc3RvcmUsIHJtLCBSb3cuQUNUSU9OX0lOU0VSVCk7CiAgICAgICAgaWYgKHJv\ndyAhPSBudWxsKSB7CiAgICAgICAgICAgIE9iamVjdCB2YWx1ZSA9IHNtLmZl\ndGNoKGZpZWxkLmdldEluZGV4KCkpOwogICAgICAgICAgICBpZiAoIUhhbmRs\nZXJTdHJhdGVnaWVzLnNldChmaWVsZCwgdmFsdWUsIHN0b3JlLCByb3csIF9j\nb2xzLCBfaW8sIAogICAgICAgICAgICAJZmllbGQuZ2V0TnVsbFZhbHVlKCkg\nPT0gRmllbGRNYXBwaW5nLk5VTExfTk9ORSkpCiAgICAgICAgICAgIAlpZiAo\nZmllbGQuZ2V0VmFsdWVTdHJhdGVneSgpICE9IFZhbHVlU3RyYXRlZ2llcy5B\nVVRPQVNTSUdOKQogICAgICAgICAgICAJCXRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJjYW50LXNldC12YWx1ZSIsIAogICAgICAgICAgICAJ\nCQkJcm93LmdldEZhaWxlZE9iamVjdCgpLCBmaWVsZCwgdmFsdWUpKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgdXBkYXRlKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBy\nbSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBSb3cg\ncm93ID0gZmllbGQuZ2V0Um93KHNtLCBzdG9yZSwgcm0sIFJvdy5BQ1RJT05f\nVVBEQVRFKTsKICAgICAgICBpZiAocm93ICE9IG51bGwpewogICAgICAgICAg\nICBPYmplY3QgdmFsdWUgPSBzbS5mZXRjaChmaWVsZC5nZXRJbmRleCgpKTsK\nICAgICAgICAgICAgaWYgKCFIYW5kbGVyU3RyYXRlZ2llcy5zZXQoZmllbGQs\nIHZhbHVlLCBzdG9yZSwgcm93LCBfY29scywgX2lvLAogICAgICAgICAgICAg\nICAgIGZpZWxkLmdldE51bGxWYWx1ZSgpID09IEZpZWxkTWFwcGluZy5OVUxM\nX05PTkUpKSAKICAgICAgICAgICAgCWlmIChmaWVsZC5nZXRWYWx1ZVN0cmF0\nZWd5KCkgIT0gVmFsdWVTdHJhdGVnaWVzLkFVVE9BU1NJR04pCiAgICAgICAg\nICAgIAl0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiY2FudC1z\nZXQtdmFsdWUiLCAKICAgICAgICAgICAgCQkJcm93LmdldEZhaWxlZE9iamVj\ndCgpLCBmaWVsZCwgdmFsdWUpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgZGVsZXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNT\ndG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBmaWVsZC5kZWxldGVSb3coc20sIHN0b3Jl\nLCBybSk7CiAgICB9CgogICAgcHVibGljIGludCBzdXBwb3J0c1NlbGVjdChT\nZWxlY3Qgc2VsLCBpbnQgdHlwZSwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwK\nICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpIHsKICAgICAgICBpZiAoKHR5cGUgPT0gU2VsZWN0LlRZUEVf\nSk9JTkxFU1MgJiYgc2VsLmlzU2VsZWN0ZWQoZmllbGQuZ2V0VGFibGUoKSkp\nCiAgICAgICAgICAgIHx8IChfbG9hZCAmJiB0eXBlID09IHNlbC5UWVBFX1RX\nT19QQVJUKSkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgcmV0dXJu\nIDA7CiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3QoU2VsZWN0IHNlbCwg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAg\nICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlck1v\nZGUpIHsKICAgICAgICBpZiAoX2NvbHMubGVuZ3RoID09IDApCiAgICAgICAg\nICAgIHJldHVybiAtMTsKCiAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20u\nZ2V0SW50ZXJtZWRpYXRlKGZpZWxkLmdldEluZGV4KCkpICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBpZiAoX2xvYiAmJiAhZmll\nbGQuaXNQcmltYXJ5S2V5KCkgJiYgKHNlbC5pc0Rpc3RpbmN0KCkgfHwKICAg\nICAgICAgICAgICAgIGVhZ2VyTW9kZSA9PSBKREJDRmV0Y2hDb25maWd1cmF0\naW9uLkVBR0VSX05PTkUpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAg\nICAgc2VsLnNlbGVjdChfY29scywgZmllbGQuam9pbihzZWwpKTsKICAgICAg\nICByZXR1cm4gMTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2FkKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChfY29scy5s\nZW5ndGggPT0gMCB8fCAhcmVzLmNvbnRhaW5zQWxsKF9jb2xzKSkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBPYmplY3QgdmFsID0gSGFuZGxlclN0\ncmF0ZWdpZXMubG9hZERhdGFTdG9yZShmaWVsZCwgcmVzLCBudWxsLCBfY29s\ncyk7CiAgICAgICAgaWYgKCFfbG9hZCkKICAgICAgICAgICAgc20uc3RvcmUo\nZmllbGQuZ2V0SW5kZXgoKSwgZmllbGQuZ2V0SGFuZGxlcigpLgogICAgICAg\nICAgICAgICAgdG9PYmplY3RWYWx1ZShmaWVsZCwgdmFsKSk7CiAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHZhbCA9IE5VTEw7CiAgICAgICAgICAgIHNtLnNldEludGVybWVk\naWF0ZShmaWVsZC5nZXRJbmRleCgpLCB2YWwpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBsb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIC8vIGV2ZW4gaWYgbm8gY29sdW1ucywgYWxsb3cgYSBoYW5kbGVyIHRv\nIGxvYWQgYSBnZW5lcmF0ZWQgdmFsdWUKICAgICAgICBpZiAoX2NvbHMubGVu\nZ3RoID09IDApIHsKICAgICAgICAgICAgaWYgKF9sb2FkKQogICAgICAgICAg\nICAgICAgc20uc3RvcmUoZmllbGQuZ2V0SW5kZXgoKSwgZmllbGQuZ2V0SGFu\nZGxlcigpLgogICAgICAgICAgICAgICAgICAgIHRvT2JqZWN0VmFsdWUoZmll\nbGQsIG51bGwsIHNtLCBzdG9yZSwgZmV0Y2gpKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgc20uc3RvcmUoZmllbGQuZ2V0SW5kZXgoKSwg\nZmllbGQuZ2V0SGFuZGxlcigpLgogICAgICAgICAgICAgICAgICAgIHRvT2Jq\nZWN0VmFsdWUoZmllbGQsIG51bGwpKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgLy8gbG9hZCBjYWNoZWQgaW50ZXJtZWRpYXRl\nIHZhbHVlPwogICAgICAgIGlmIChfbG9hZCkgewogICAgICAgICAgICBPYmpl\nY3QgZHMgPSBzbS5nZXRJbnRlcm1lZGlhdGUoZmllbGQuZ2V0SW5kZXgoKSk7\nCiAgICAgICAgICAgIGlmIChkcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBpZiAoZHMgPT0gTlVMTCkKICAgICAgICAgICAgICAgICAgICBkcyA9IG51\nbGw7CiAgICAgICAgICAgICAgICBzbS5zdG9yZShmaWVsZC5nZXRJbmRleCgp\nLCBmaWVsZC5nZXRIYW5kbGVyKCkuCiAgICAgICAgICAgICAgICAgICAgdG9P\nYmplY3RWYWx1ZShmaWVsZCwgZHMsIHNtLCBzdG9yZSwgZmV0Y2gpKTsKICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgU2VsZWN0IHNlbCA9IHN0b3JlLmdldFNRTEZhY3RvcnkoKS5u\nZXdTZWxlY3QoKTsKICAgICAgICBzZWwuc2VsZWN0KF9jb2xzKTsKICAgICAg\nICBmaWVsZC53aGVyZVByaW1hcnlLZXkoc2VsLCBzbSwgc3RvcmUpOwoKICAg\nICAgICBSZXN1bHQgcmVzID0gc2VsLmV4ZWN1dGUoc3RvcmUsIGZldGNoKTsK\nICAgICAgICBPYmplY3QgdmFsID0gbnVsbDsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAocmVzLm5leHQoKSkKICAgICAgICAgICAgICAgIHZhbCA9\nIEhhbmRsZXJTdHJhdGVnaWVzLmxvYWREYXRhU3RvcmUoZmllbGQsIHJlcywg\nbnVsbCwgX2NvbHMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHJlcy5jbG9zZSgpOwogICAgICAgIH0KCiAgICAgICAgbG9hZEVtYmVkZGVk\nKHNtLCBzdG9yZSwgZmV0Y2gsIHZhbCk7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCB0b0RhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBz\ndG9yZSkgewogICAgICAgIHJldHVybiBIYW5kbGVyU3RyYXRlZ2llcy50b0Rh\ndGFTdG9yZVZhbHVlKGZpZWxkLCB2YWwsIF9jb2xzLCBzdG9yZSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgYXBwZW5kSXNOdWxsKFNRTEJ1ZmZlciBzcWws\nIFNlbGVjdCBzZWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgam9pbnMgPSBq\nb2luKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBfY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaSA+IDAp\nCiAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKCIgQU5EICIpOwogICAgICAg\nICAgICBzcWwuYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlhcyhfY29sc1tpXSwg\nam9pbnMpKS5hcHBlbmQoIiBJUyAiKS4KICAgICAgICAgICAgICAgIGFwcGVu\nZFZhbHVlKG51bGwsIF9jb2xzW2ldKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgYXBwZW5kSXNOb3ROdWxsKFNRTEJ1ZmZlciBzcWwsIFNl\nbGVjdCBzZWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgam9pbnMgPSBqb2lu\nKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgaWYgKF9jb2xzLmxlbmd0aCA+IDEp\nCiAgICAgICAgICAgIHNxbC5hcHBlbmQoIigiKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGlmIChpID4gMCkKICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoIiBPUiAi\nKTsKICAgICAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMo\nX2NvbHNbaV0sIGpvaW5zKSkuCiAgICAgICAgICAgICAgICBhcHBlbmQoIiBJ\nUyBOT1QgIikuYXBwZW5kVmFsdWUobnVsbCwgX2NvbHNbaV0pOwogICAgICAg\nIH0KICAgICAgICBpZiAoX2NvbHMubGVuZ3RoID4gMSkKICAgICAgICAgICAg\nc3FsLmFwcGVuZCgiKSIpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2lu\nKEpvaW5zIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0ZXIpIHsKICAgICAgICBy\nZXR1cm4gZmllbGQuam9pbihqb2lucywgZm9yY2VPdXRlciwgZmFsc2UpOwog\nICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oSm9pbnMgam9p\nbnMsIGJvb2xlYW4gZm9yY2VPdXRlciwKICAgICAgICBib29sZWFuIHRyYXZl\ncnNlKSB7CiAgICAgICAgaWYgKHRyYXZlcnNlKQogICAgICAgICAgICBIYW5k\nbGVyU3RyYXRlZ2llcy5hc3NlcnRKb2luYWJsZShmaWVsZCk7CiAgICAgICAg\ncmV0dXJuIGpvaW5zOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZFBy\nb2plY3Rpb24oSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLAogICAgICAgIFJlc3VsdCByZXMsIEpvaW5zIGpvaW5zKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBI\nYW5kbGVyU3RyYXRlZ2llcy5sb2FkT2JqZWN0KGZpZWxkLCBudWxsLCBzdG9y\nZSwgZmV0Y2gsIHJlcywKICAgICAgICAgICAgam9pbnMsIF9jb2xzLCBfbG9h\nZCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNWZXJzaW9uYWJsZSgp\nIHsKICAgICAgICByZXR1cm4gIV9sb2IgJiYgIWZpZWxkLmlzSm9pbk91dGVy\nKCkKICAgICAgICAgICAgJiYgZmllbGQuZ2V0SGFuZGxlcigpLmlzVmVyc2lv\nbmFibGUoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFu\nYWdlciBybSwKICAgICAgICBPYmplY3QgcHJldlZhbHVlKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFJvdyByb3cgPSBmaWVsZC5n\nZXRSb3coc20sIHN0b3JlLCBybSwgUm93LkFDVElPTl9VUERBVEUpOwogICAg\nICAgIGlmIChyb3cgIT0gbnVsbCkKICAgICAgICAgICAgSGFuZGxlclN0cmF0\nZWdpZXMud2hlcmUoZmllbGQsIHByZXZWYWx1ZSwgc3RvcmUsIHJvdywgX2Nv\nbHMpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwog\nICAgLy8gSm9pbmFibGUgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBpbnQgZ2V0RmllbGRJbmRl\neCgpIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0SW5kZXgoKTsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IGdldFByaW1hcnlLZXlWYWx1ZShSZXN1bHQg\ncmVzLCBDb2x1bW5bXSBjb2xzLCBGb3JlaWduS2V5IGZrLAogICAgICAgIEpE\nQkNTdG9yZSBzdG9yZSwgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBPYmpl\nY3QgdmFsID0gbnVsbDsKICAgICAgICBpZiAoY29scy5sZW5ndGggPT0gMSkg\newogICAgICAgICAgICBjb2wgPSBjb2xzWzBdOwogICAgICAgICAgICBpZiAo\nZmsgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbCA9IGZrLmdldENvbHVt\nbihjb2wpOwogICAgICAgICAgICB2YWwgPSByZXMuZ2V0T2JqZWN0KGNvbCwg\nZmllbGQuZ2V0SGFuZGxlcigpLgogICAgICAgICAgICAgICAgZ2V0UmVzdWx0\nQXJndW1lbnQoZmllbGQpLCBqb2lucyk7CiAgICAgICAgfSBlbHNlIGlmIChj\nb2xzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgT2JqZWN0W10gdmFscyA9\nIG5ldyBPYmplY3RbY29scy5sZW5ndGhdOwogICAgICAgICAgICBPYmplY3Rb\nXSBhcmdzID0gKE9iamVjdFtdKSBmaWVsZC5nZXRIYW5kbGVyKCkuCiAgICAg\nICAgICAgICAgICBnZXRSZXN1bHRBcmd1bWVudChmaWVsZCk7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdmFscy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgY29sID0gY29sc1tpXTsKICAgICAgICAgICAgICAg\nIGlmIChmayAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbCA9IGZr\nLmdldENvbHVtbihjb2wpOwogICAgICAgICAgICAgICAgdmFsc1tpXSA9IHJl\ncy5nZXRPYmplY3QoY29sLCAoYXJncyA9PSBudWxsKSA/IG51bGwgOiBhcmdz\nW2ldLAogICAgICAgICAgICAgICAgICAgIGpvaW5zKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICB2YWwgPSB2YWxzOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gZmllbGQuZ2V0SGFuZGxlcigpLnRvT2JqZWN0VmFsdWUoZmllbGQs\nIHZhbCk7CiAgICB9CgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMo\nKSB7CiAgICAgICAgcmV0dXJuIF9jb2xzOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3RbXSBnZXRSZXN1bHRBcmd1bWVudHMoKSB7CiAgICAgICAgcmV0dXJu\nIF9hcmdzOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0Sm9pblZhbHVl\nKE9iamVjdCBmaWVsZFZhbCwgQ29sdW1uIGNvbCwgSkRCQ1N0b3JlIHN0b3Jl\nKSB7CiAgICAgICAgT2JqZWN0IHZhbCA9IEhhbmRsZXJTdHJhdGVnaWVzLnRv\nRGF0YVN0b3JlVmFsdWUoZmllbGQsIGZpZWxkVmFsLAogICAgICAgICAgICBf\nY29scywgc3RvcmUpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCB8fCBfY29s\ncy5sZW5ndGggPCAyKQogICAgICAgICAgICByZXR1cm4gdmFsOwoKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICBpZiAoX2NvbHNbaV0gPT0gY29sKQogICAgICAgICAgICAgICAg\ncmV0dXJuICgoT2JqZWN0W10pIHZhbClbaV07CiAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKCk7CiAgICB9CgogICAgcHVibGljIE9iamVj\ndCBnZXRKb2luVmFsdWUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQ29sdW1u\nIGNvbCwKICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICByZXR1\ncm4gZ2V0Sm9pblZhbHVlKHNtLmZldGNoKGZpZWxkLmdldEluZGV4KCkpLCBj\nb2wsIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvQXNz\naWduZWRWYWx1ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUg\nc3RvcmUsCiAgICAgICAgQ29sdW1uIGNvbCwgT2JqZWN0IGF1dG9JbmMpIHsK\nICAgICAgICBPYmplY3QgZGF0YTsKICAgICAgICBpZiAoX2NvbHMubGVuZ3Ro\nID09IDEpCiAgICAgICAgICAgIGRhdGEgPSBKYXZhVHlwZXMuY29udmVydChh\ndXRvSW5jLCBjb2wuZ2V0SmF2YVR5cGUoKSk7CiAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgIC8vIG11bHRpcGxlIGNvbHVtbnM7IGhhdmUgdG8gZ2V0IGN1\ncnJlbnQgdmFsdWUsIHJlcGxhY2UgdGhpcyBjb2wncwogICAgICAgICAgICAv\nLyB2YWx1ZSB3aXRoIHRoZSBnaXZlbiBvbmUsIGFuZCByZXNldAogICAgICAg\nICAgICBkYXRhID0gZmllbGQuZ2V0SGFuZGxlcigpLnRvRGF0YVN0b3JlVmFs\ndWUoZmllbGQsCiAgICAgICAgICAgICAgICBzbS5mZXRjaChmaWVsZC5nZXRJ\nbmRleCgpKSwgc3RvcmUpOwogICAgICAgICAgICBpZiAoZGF0YSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgZGF0YSA9IG5ldyBPYmplY3RbX2NvbHMubGVu\nZ3RoXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfY29scy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9jb2xzW2ldID09\nIGNvbCkgewogICAgICAgICAgICAgICAgICAgICgoT2JqZWN0W10pIGRhdGEp\nW2ldID0gSmF2YVR5cGVzLmNvbnZlcnQoYXV0b0luYywgCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNvbC5nZXRKYXZhVHlwZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IHZhbCA9IGZpZWxkLmdldEhh\nbmRsZXIoKS50b09iamVjdFZhbHVlKGZpZWxkLCBkYXRhKTsKICAgICAgICBz\nbS5zdG9yZShmaWVsZC5nZXRJbmRleCgpLCB2YWwpOwogICAgfQoKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBFbWJlZGRhYmxl\nIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIHB1YmxpYyBDb2x1bW5JTyBnZXRDb2x1bW5JTygpIHsKICAg\nICAgICByZXR1cm4gX2lvOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9F\nbWJlZGRlZERhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBz\ndG9yZSkgewogICAgICAgIC8vIGRvbid0IHVzZSBIYW5kbGVyU3RyYXRlZ2ll\ncy50b0RhdGFTdG9yZVZhbHVlIGIvYyB3ZSB3YW50IHJlbGF0aW9uIGlkcwog\nICAgICAgIC8vIHRvIGJlIHJlcHJlc2VudGVkIGJ5IHN0YXRlIG1hbmFnZXJz\nLCBub3QgdGhlIHNlcmlhbGl6ZWQgaWQgdmFsdWUKICAgICAgICB2YWwgPSBm\naWVsZC5nZXRIYW5kbGVyKCkudG9EYXRhU3RvcmVWYWx1ZShmaWVsZCwgdmFs\nLCBzdG9yZSk7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsICYmIF9jb2xzLmxl\nbmd0aCA+IDEpCiAgICAgICAgICAgIHJldHVybiBuZXcgT2JqZWN0W19jb2xz\nLmxlbmd0aF07CiAgICAgICAgcmV0dXJuIHZhbDsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IHRvRW1iZWRkZWRPYmplY3RWYWx1ZShPYmplY3QgdmFsKSB7\nCiAgICAgICAgaWYgKCFfbG9hZCkKICAgICAgICAgICAgcmV0dXJuIGZpZWxk\nLmdldEhhbmRsZXIoKS50b09iamVjdFZhbHVlKGZpZWxkLCB2YWwpOwogICAg\nICAgIHJldHVybiBVTlNVUFBPUlRFRDsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBsb2FkRW1iZWRkZWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0\nb3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIE9iamVjdCB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKHZhbCA9PSBudWxsICYmIF9jb2xzLmxlbmd0aCA+IDEp\nCiAgICAgICAgICAgIHZhbCA9IG5ldyBPYmplY3RbX2NvbHMubGVuZ3RoXTsK\nICAgICAgICBpZiAoX2xvYWQpCiAgICAgICAgICAgIHNtLnN0b3JlKGZpZWxk\nLmdldEluZGV4KCksIGZpZWxkLmdldEhhbmRsZXIoKS4KICAgICAgICAgICAg\nICAgIHRvT2JqZWN0VmFsdWUoZmllbGQsIHZhbCwgc20sIHN0b3JlLCBmZXRj\naCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc20uc3RvcmUoZmllbGQu\nZ2V0SW5kZXgoKSwgZmllbGQuZ2V0SGFuZGxlcigpLgogICAgICAgICAgICAg\nICAgdG9PYmplY3RWYWx1ZShmaWVsZCwgdmFsKSk7CiAgICB9Cn0K\n","encoding":"base64"}

