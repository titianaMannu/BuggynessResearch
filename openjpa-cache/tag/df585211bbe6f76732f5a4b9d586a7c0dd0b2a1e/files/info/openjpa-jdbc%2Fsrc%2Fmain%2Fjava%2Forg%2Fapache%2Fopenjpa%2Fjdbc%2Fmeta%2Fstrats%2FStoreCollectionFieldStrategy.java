{"sha":"065e0996adfdc128ea7d5e5c49a1c1652fd32d8d","node_id":"MDQ6QmxvYjIwNjM2NDowNjVlMDk5NmFkZmRjMTI4ZWE3ZDVlNWM0OWExYzE2NTJmZDMyZDhk","size":26842,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/065e0996adfdc128ea7d5e5c49a1c1652fd32d8d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Cmlt\ncG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRj\naENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZU1h\nbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNs\nYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5GaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zcWwuTG9naWNhbFVuaW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJlc3VsdDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0RXhlY3V0b3I7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0SW1wbDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5VbmlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2hhbmdlVHJhY2tlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklkOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuUHJveHk7CgovKioKICogQmFzZSBjbGFzcyBmb3Ig\nc3RyYXRlZ2llcyB0aGF0IGFyZSBzdG9yZWQgYXMgYSBjb2xsZWN0aW9uLCBl\ndmVuIGlmCiAqIHRoZWlyIGZpZWxkIHZhbHVlIGlzIHNvbWV0aGluZyBlbHNl\nLiBIYW5kbGVzIGRhdGEgbG9hZGluZyBhbmQgYmFzaWMgcXVlcnkKICogZnVu\nY3Rpb25hbGl0eS4gU3ViY2xhc3NlcyBtdXN0IGltcGxlbWVudCBhYnN0cmFj\ndCBtZXRob2RzIGFuZAogKiBpbnNlcnQvdXBkYXRlL2RlbGV0ZSBiZWhhdmlv\nciBhcyB3ZWxsIGFzIG92ZXJyaWRpbmcKICoge0BsaW5rIEZpZWxkU3RyYXRl\nZ3kjdG9EYXRhU3RvcmVWYWx1ZX0sIHtAbGluayBGaWVsZFN0cmF0ZWd5I2pv\naW59LCBhbmQKICoge0BsaW5rIEZpZWxkU3RyYXRlZ3kjam9pblJlbGF0aW9u\nfSBpZiBuZWNlc3NhcnkuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpw\ndWJsaWMgYWJzdHJhY3QgY2xhc3MgU3RvcmVDb2xsZWN0aW9uRmllbGRTdHJh\ndGVneQogICAgZXh0ZW5kcyBDb250YWluZXJGaWVsZFN0cmF0ZWd5IHsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2Fs\naXplci5mb3JQYWNrYWdlCiAgICAgICAgKFN0b3JlQ29sbGVjdGlvbkZpZWxk\nU3RyYXRlZ3kuY2xhc3MpOwogICAgCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgZm9yZWlnbiBrZXkgdXNlZCB0byBqb2luIHRvIHRoZSBvd25pbmcgZmll\nbGQgZm9yIHRoZSBnaXZlbgogICAgICogZWxlbWVudCBtYXBwaW5nIGZyb20g\ne0BsaW5rICNnZXRJbmRlcGVuZGVudEVsZW1lbnRNYXBwaW5nc30gKG9yIG51\nbGwpLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgRm9yZWlnbktl\neSBnZXRKb2luRm9yZWlnbktleShDbGFzc01hcHBpbmcgZWxlbSk7CgogICAg\nLyoqCiAgICAgKiBJbXBsZW1lbnQgdGhpcyBtZXRob2QgdG8gc2VsZWN0IHRo\nZSBlbGVtZW50cyBvZiB0aGlzIGZpZWxkIGZvciB0aGUKICAgICAqIGdpdmVu\nIGVsZW1lbnQgbWFwcGluZyBmcm9tIHtAbGluayAjZ2V0SW5kZXBlbmRlbnRF\nbGVtZW50TWFwcGluZ3N9CiAgICAgKiAob3IgbnVsbCkuIEVsZW1lbnRzIG9m\nIHRoZSByZXN1bHQgd2lsbCBiZSBsb2FkZWQgd2l0aAogICAgICoge0BsaW5r\nICNsb2FkRWxlbWVudH0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFj\ndCB2b2lkIHNlbGVjdEVsZW1lbnQoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5n\nIGVsZW0sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXJNb2RlLAogICAgICAgIEpvaW5z\nIGpvaW5zKTsKCiAgICAvKioKICAgICAqIExvYWQgYW4gZWxlbWVudCBvZiB0\naGUgY29sbGVjdGlvbi4gVGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgbWlnaHQg\nYmUKICAgICAqIG51bGwgaWYgdGhlIGxvYWQgaXMgZm9yIGEgcHJvamVjdGlv\nbiBvciBmb3IgcHJvY2Vzc2luZyBlYWdlciBwYXJhbGxlbAogICAgICogcmVz\ndWx0cy4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IE9iamVjdCBs\nb2FkRWxlbWVudChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpE\nQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwg\nUmVzdWx0IHJlcywgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbjsKCiAgICAvKioKICAgICAqIEpvaW4gdGhpcyB2YWx1ZSdzIHRh\nYmxlIHRvIHRoZSB0YWJsZSBmb3IgdGhlIGdpdmVuIGVsZW1lbnQgbWFwcGlu\nZwogICAgICogZnJvbSB7QGxpbmsgI2dldEluZGVwZW5kZW50RWxlbWVudE1h\ncHBpbmdzfSAob3IgbnVsbCkuCiAgICAgKgogICAgICogQHNlZSBGaWVsZE1h\ncHBpbmcjam9pblJlbGF0aW9uCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0\ncmFjdCBKb2lucyBqb2luRWxlbWVudFJlbGF0aW9uKEpvaW5zIGpvaW5zLAog\nICAgICAgIENsYXNzTWFwcGluZyBlbGVtKTsKCiAgICAvKioKICAgICAqIEpv\naW4gdG8gdGhlIG93bmluZyBmaWVsZCB0YWJsZSBmb3IgdGhlIGdpdmVuIGVs\nZW1lbnQgbWFwcGluZyBmcm9tCiAgICAgKiB7QGxpbmsgI2dldEluZGVwZW5k\nZW50RWxlbWVudE1hcHBpbmdzfSAob3IgbnVsbCkuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBhYnN0cmFjdCBKb2lucyBqb2luKEpvaW5zIGpvaW5zLCBDbGFz\nc01hcHBpbmcgZWxlbSk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBsYXJn\nZSByZXN1bHQgc2V0IHByb3h5IGZvciB0aGlzIGZpZWxkLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgYWJzdHJhY3QgUHJveHkgbmV3TFJTUHJveHkoKTsKCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIGZpZWxkIHZhbHVlIHRvIGEgY29s\nbGVjdGlvbi4gSGFuZGxlcyBjb2xsZWN0aW9ucyBhbmQKICAgICAqIGFycmF5\ncyBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlv\nbiB0b0NvbGxlY3Rpb24oT2JqZWN0IHZhbCkgewogICAgICAgIGlmIChmaWVs\nZC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5DT0xMRUNUSU9OKQogICAg\nICAgICAgICByZXR1cm4gKENvbGxlY3Rpb24pIHZhbDsKICAgICAgICByZXR1\ncm4gSmF2YVR5cGVzLnRvTGlzdCh2YWwsIGZpZWxkLmdldEVsZW1lbnQoKS5n\nZXRUeXBlKCksIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBh\nbiBpdGVtIHRvIHRoZSBkYXRhIHN0cnVjdHVyZSByZXByZXNlbnRpbmcgYSBm\naWVsZCB2YWx1ZS4KICAgICAqIEJ5IGRlZmF1bHQsIGFzc3VtZXMgdGhlIHN0\ncnVjdHVyZSBpcyBhIGNvbGxlY3Rpb24uCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIGFkZChKREJDU3RvcmUgc3RvcmUsIE9iamVjdCBjb2xsLCBPYmpl\nY3Qgb2JqKSB7CiAgICAgICAgKChDb2xsZWN0aW9uKSBjb2xsKS5hZGQob2Jq\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGZpcnN0IGlu\nZGVwZW5kZW50IGVsZW1lbnQgbWFwcGluZywgb3IgbnVsbC4KICAgICAqLwog\nICAgcHJpdmF0ZSBDbGFzc01hcHBpbmcgZ2V0RGVmYXVsdEVsZW1lbnRNYXBw\naW5nKGJvb2xlYW4gdHJhdmVyc2UpIHsKICAgICAgICBDbGFzc01hcHBpbmdb\nXSBlbGVtcyA9IGdldEluZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzKHRyYXZl\ncnNlKTsKICAgICAgICByZXR1cm4gKGVsZW1zLmxlbmd0aCA9PSAwKSA/IG51\nbGwgOiBlbGVtc1swXTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHN1cHBvcnRz\nU2VsZWN0KFNlbGVjdCBzZWwsIGludCB0eXBlLCBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChmaWVsZC5pc0xSUygp\nKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAodHlwZSA9PSBT\nZWxlY3QuRUFHRVJfUEFSQUxMRUwpCiAgICAgICAgICAgIHJldHVybiBNYXRo\nLm1heCgxLCBnZXRJbmRlcGVuZGVudEVsZW1lbnRNYXBwaW5ncyh0cnVlKS5s\nZW5ndGgpOwogICAgICAgIGlmICh0eXBlICE9IFNlbGVjdC5FQUdFUl9JTk5F\nUiAmJiB0eXBlICE9IFNlbGVjdC5FQUdFUl9PVVRFUikKICAgICAgICAgICAg\ncmV0dXJuIDA7CiAgICAgICAgaWYgKGdldEluZGVwZW5kZW50RWxlbWVudE1h\ncHBpbmdzKHRydWUpLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIHJldHVybiAw\nOwogICAgICAgIHJldHVybiAodHlwZSA9PSBTZWxlY3QuRUFHRVJfSU5ORVIg\nfHwgc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCkuCiAgICAgICAgICAgIGNhbk91\ndGVySm9pbihzZWwuZ2V0Sm9pblN5bnRheCgpLCBnZXRKb2luRm9yZWlnbktl\neQogICAgICAgICAgICAgICAgKGdldERlZmF1bHRFbGVtZW50TWFwcGluZyhm\nYWxzZSkpKSkgPyAxIDogMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxl\nY3RFYWdlclBhcmFsbGVsKFNlbGVjdEV4ZWN1dG9yIHNlbCwKICAgICAgICBm\naW5hbCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBmaW5hbCBKREJDU3RvcmUg\nc3RvcmUsCiAgICAgICAgZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgZmluYWwgaW50IGVhZ2VyTW9kZSkgewogICAgICAgIGlmICghKHNl\nbCBpbnN0YW5jZW9mIFVuaW9uKSkKICAgICAgICAgICAgc2VsZWN0RWFnZXIo\nKFNlbGVjdCkgc2VsLCBnZXREZWZhdWx0RWxlbWVudE1hcHBpbmcodHJ1ZSks\nIHNtLAogICAgICAgICAgICAgICAgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUs\nIHRydWUsIGZhbHNlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZmlu\nYWwgQ2xhc3NNYXBwaW5nW10gZWxlbXMgPSBnZXRJbmRlcGVuZGVudEVsZW1l\nbnRNYXBwaW5ncyh0cnVlKTsKICAgICAgICAgICAgVW5pb24gdW5pb24gPSAo\nVW5pb24pIHNlbDsKICAgICAgICAgICAgaWYgKGZldGNoLmdldFN1YmNsYXNz\nRmV0Y2hNb2RlKGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuCiAgICAgICAg\nICAgICAgICBnZXRUeXBlTWFwcGluZygpKSAhPSBmZXRjaC5FQUdFUl9KT0lO\nKQogICAgICAgICAgICAgICAgdW5pb24uYWJvcnRVbmlvbigpOwogICAgICAg\nICAgICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIGlu\ndCBpZHgpIHsKICAgICAgICAgICAgICAgICAgICBzZWxlY3RFYWdlcihzZWws\nIGVsZW1zW2lkeF0sIHNtLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyTW9kZSwgCiAg\nICAgICAgICAgICAgICAgICAgICAgIHRydWUsIGZhbHNlKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNlbGVjdEVhZ2VySm9pbihTZWxlY3Qgc2VsLCBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyTW9kZSkg\newogICAgICAgIC8vIHdlIGxpbWl0IGZ1cnRoZXIgZWFnZXIgZmV0Y2hlcyB0\nbyBqb2lucywgYmVjYXVzZSBhZnRlciB0aGlzIHBvaW50CiAgICAgICAgLy8g\ndGhlIHNlbGVjdCBoYXMgYmVlbiBtb2RpZmllZCBzdWNoIHRoYXQgcGFyYWxs\nZWwgY2xvbmVzIG1heSBwcm9kdWNlCiAgICAgICAgLy8gaW52YWxpZCBzcWwK\nICAgICAgICBib29sZWFuIG91dGVyID0gZmllbGQuZ2V0TnVsbFZhbHVlKCkg\nIT0gRmllbGRNYXBwaW5nLk5VTExfRVhDRVBUSU9OOwogICAgICAgIC8vIGZv\ncmNlIGlubmVyIGpvaW4gZm9yIGlubmVyIGpvaW4gZmV0Y2ggCiAgICAgICAg\naWYgKGZldGNoLmhhc0ZldGNoSW5uZXJKb2luKGZpZWxkLmdldEZ1bGxOYW1l\nKGZhbHNlKSkpCiAgICAgICAgICAgIG91dGVyID0gZmFsc2U7CiAgICAgICAg\nc2VsZWN0RWFnZXIoc2VsLCBnZXREZWZhdWx0RWxlbWVudE1hcHBpbmcodHJ1\nZSksIHNtLCBzdG9yZSwgZmV0Y2gsIAogICAgICAgICAgICBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uLkVBR0VSX0pPSU4sIGZhbHNlLAogICAgICAgICAgICBv\ndXRlcik7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNFYWdlclNlbGVj\ndFRvTWFueSgpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNlbGVjdCBvdXIgZGF0YSBlYWdlcmx5LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgc2VsZWN0RWFnZXIoU2VsZWN0IHNlbCwgQ2xhc3NN\nYXBwaW5nIGVsZW0sCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLAogICAgICAgIGludCBlYWdlck1vZGUsIGJvb2xlYW4gc2VsZWN0T2lkLCBi\nb29sZWFuIG91dGVyKSB7CiAgICAgICAgLy8gZm9yY2UgZGlzdGluY3QgaWYg\ndGhlcmUgd2FzIGEgdG8tbWFueSBqb2luIHRvIGF2b2lkIGR1cHMsIGJ1dAog\nICAgICAgIC8vIGlmIHRoaXMgaXMgYSBwYXJhbGxlbCBzZWxlY3QgZG9uJ3Qg\nbWFrZSBkaXN0aW5jdCBiYXNlZCBvbiB0aGUKICAgICAgICAvLyBlYWdlciBq\nb2lucyBhbG9uZSBpZiB0aGUgb3JpZ2luYWwgd2Fzbid0IGRpc3RpbmN0CiAg\nICAgICAgaWYgKGVhZ2VyTW9kZSA9PSBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nLkVBR0VSX1BBUkFMTEVMKSB7CiAgICAgICAgICAgIGlmIChzZWwuaGFzSm9p\nbih0cnVlKSkKICAgICAgICAgICAgICAgIHNlbC5zZXREaXN0aW5jdCh0cnVl\nKTsKICAgICAgICAgICAgZWxzZSBpZiAoIXNlbC5pc0Rpc3RpbmN0KCkpCiAg\nICAgICAgICAgICAgICBzZWwuc2V0RGlzdGluY3QoZmFsc2UpOyAvLyBzZXQg\nZXhwbGljaXRseSBzbyByZW1lbWJlcmVkCiAgICAgICAgfQoKICAgICAgICAv\nLyBzZXQgYSB2YXJpYWJsZSBuYW1lIHRoYXQgZG9lcyBub3QgY29uZmxpY3Qg\nd2l0aCBhbnkgaW4gdGhlIHF1ZXJ5OwogICAgICAgIC8vIHVzaW5nIGEgdmFy\naWFibGUgZ3VhcmFudGVlcyB0aGF0IHRoZSBzZWxlY3RlZCBkYXRhIHdpbGwg\ndXNlIGRpZmZlcmVudAogICAgICAgIC8vIGFsaWFzZXMgYW5kIGpvaW5zIHRo\nYW4gYW55IGV4aXN0aW5nIFdIRVJFIGNvbmRpdGlvbnMgb24gdGhpcyBmaWVs\nZAogICAgICAgIC8vIHRoYXQgbWlnaHQgb3RoZXJ3aXNlIGxpbWl0IHRoZSBl\nbGVtZW50cyBvZiB0aGUgZmllbGQgdGhhdCBtYXRjaAogICAgICAgIGlmIChz\nZWxlY3RPaWQpCiAgICAgICAgICAgIHNlbC5vcmRlckJ5UHJpbWFyeUtleShm\naWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKSwgdHJ1ZSwgdHJ1ZSk7CiAgICAg\nICAgSm9pbnMgam9pbnMgPSBzZWwubmV3Sm9pbnMoKS5zZXRWYXJpYWJsZSgi\nKiIpOwogICAgICAgIGpvaW5zID0gam9pbihqb2lucywgZWxlbSk7CgogICAg\nICAgIC8vIG9yZGVyLCByZWYgY29scwogICAgICAgIGlmIChmaWVsZC5nZXRP\ncmRlckNvbHVtbigpICE9IG51bGwgfHwgZmllbGQuZ2V0T3JkZXJzKCkubGVu\nZ3RoID4gMAogICAgICAgICAgICB8fCAhc2VsZWN0T2lkKSB7CiAgICAgICAg\nICAgIGlmIChvdXRlcikKICAgICAgICAgICAgICAgIGpvaW5zID0gc2VsLm91\ndGVyKGpvaW5zKTsKICAgICAgICAgICAgaWYgKCFzZWxlY3RPaWQpIHsKICAg\nICAgICAgICAgICAgIENvbHVtbltdIHJlZnMgPSBnZXRKb2luRm9yZWlnbktl\neShlbGVtKS5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBzZWwub3Jk\nZXJCeShyZWZzLCB0cnVlLCBqb2lucywgdHJ1ZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgZmllbGQub3JkZXJMb2NhbChzZWwsIGVsZW0sIGpvaW5z\nKTsKICAgICAgICB9CgogICAgICAgIC8vIHNlbGVjdCBkYXRhCiAgICAgICAg\nam9pbnMgPSBqb2luRWxlbWVudFJlbGF0aW9uKGpvaW5zLCBlbGVtKTsKICAg\nICAgICBpZiAob3V0ZXIpCiAgICAgICAgICAgIGpvaW5zID0gc2VsLm91dGVy\nKGpvaW5zKTsKICAgICAgICBmaWVsZC5vcmRlclJlbGF0aW9uKHNlbCwgZWxl\nbSwgam9pbnMpOwogICAgICAgIHNlbGVjdEVsZW1lbnQoc2VsLCBlbGVtLCBz\ndG9yZSwgZmV0Y2gsIGVhZ2VyTW9kZSwgam9pbnMpOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgbG9hZEVhZ2VyUGFyYWxsZWwoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCByZXMpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHJvY2VzcyBiYXRjaGVkIHJl\nc3VsdHMgaWYgd2UgaGF2ZW4ndCBhbHJlYWR5CiAgICAgICAgTWFwIHJlbHM7\nCiAgICAgICAgaWYgKHJlcyBpbnN0YW5jZW9mIFJlc3VsdCkKICAgICAgICAg\nICAgcmVscyA9IHByb2Nlc3NFYWdlclBhcmFsbGVsUmVzdWx0KHNtLCBzdG9y\nZSwgZmV0Y2gsIChSZXN1bHQpIHJlcyk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICByZWxzID0gKE1hcCkgcmVzOwoKICAgICAgICAvLyBsb29rIHVwIHRo\nZSBjb2xsZWN0aW9uIGZvciB0aGlzIG9pZCwgYW5kIHN0b3JlIGluIGluc3Rh\nbmNlCiAgICAgICAgT2JqZWN0IGNvbGwgPSByZWxzLnJlbW92ZShzbS5nZXRP\nYmplY3RJZCgpKTsKICAgICAgICBpZiAoZmllbGQuZ2V0VHlwZUNvZGUoKSA9\nPSBKYXZhVHlwZXMuQVJSQVkpCiAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0\nKGZpZWxkLmdldEluZGV4KCksIEphdmFUeXBlcy50b0FycmF5CiAgICAgICAg\nICAgICAgICAoKENvbGxlY3Rpb24pIGNvbGwsIGZpZWxkLmdldEVsZW1lbnQo\nKS5nZXRUeXBlKCkpKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYg\nKGNvbGwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbGwgPSBzbS5uZXdQ\ncm94eShmaWVsZC5nZXRJbmRleCgpKTsKICAgICAgICAgICAgc20uc3RvcmVP\nYmplY3QoZmllbGQuZ2V0SW5kZXgoKSwgY29sbCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiByZWxzOwogICAgfQoKICAgIC8qKgogICAgICogUHJvY2Vz\ncyB0aGUgZ2l2ZW4gYmF0Y2hlZCByZXN1bHQuCiAgICAgKi8KICAgIHByaXZh\ndGUgTWFwIHByb2Nlc3NFYWdlclBhcmFsbGVsUmVzdWx0KE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGRvIHNhbWUgam9pbnMg\nYXMgZm9yIGxvYWQKICAgICAgICAvLyMjIyBjaGVhdDogd2Uga25vdyB0eXBp\nY2FsIHJlc3VsdCBqb2lucyBvbmx5IGNhcmUgYWJvdXQgdGhlIHJlbGF0aW9u\nCiAgICAgICAgLy8jIyMgcGF0aDsgdGh1cyB3ZSBjYW4gaWdub3JlIGRpZmZl\ncmVudCBtYXBwaW5ncwogICAgICAgIENsYXNzTWFwcGluZyBlbGVtID0gZ2V0\nRGVmYXVsdEVsZW1lbnRNYXBwaW5nKHRydWUpOwogICAgICAgIEpvaW5zIGRh\ndGFKb2lucyA9IHJlcy5uZXdKb2lucygpLnNldFZhcmlhYmxlKCIqIik7CiAg\nICAgICAgZGF0YUpvaW5zID0gam9pbihkYXRhSm9pbnMsIGVsZW0pOwogICAg\nICAgIGRhdGFKb2lucyA9IGpvaW5FbGVtZW50UmVsYXRpb24oZGF0YUpvaW5z\nLCBlbGVtKTsKICAgICAgICBKb2lucyBvcmRlckpvaW5zID0gbnVsbDsKICAg\nICAgICBpZiAoZmllbGQuZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxsKSB7CiAg\nICAgICAgICAgIG9yZGVySm9pbnMgPSByZXMubmV3Sm9pbnMoKS5zZXRWYXJp\nYWJsZSgiKiIpOwogICAgICAgICAgICBvcmRlckpvaW5zID0gam9pbihvcmRl\nckpvaW5zLCBlbGVtKTsKICAgICAgICB9CgogICAgICAgIE1hcCByZWxzID0g\nbmV3IEhhc2hNYXAoKTsKICAgICAgICBDbGFzc01hcHBpbmcgb3duZXJNYXBw\naW5nID0gZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCk7CiAgICAgICAgT2Jq\nZWN0IG5leHRPaWQsIG9pZCA9IG51bGw7CiAgICAgICAgT2JqZWN0IGNvbGwg\nPSBudWxsOwogICAgICAgIGludCBzZXEgPSAwOwogICAgICAgIHdoaWxlIChy\nZXMubmV4dCgpKSB7CiAgICAgICAgICAgIC8vIGV4dHJhY3QgdGhlIG93bmVy\nIGlkIHZhbHVlCiAgICAgICAgICAgIG5leHRPaWQgPSBnZXROZXh0T2JqZWN0\nSWQob3duZXJNYXBwaW5nLCBzdG9yZSwgcmVzLCBvaWQpOwogICAgICAgICAg\nICBpZiAobmV4dE9pZCAhPSBvaWQpIHsKICAgICAgICAgICAgICAgIC8vIGlm\nIHRoZSBvbGQgY29sbCB3YXMgYW4gb3JkZXJlZCB0cmFja2luZyBwcm94eSwg\nc2V0CiAgICAgICAgICAgICAgICAvLyBpdHMgc2VxIHZhbHVlIHRvIHRoZSBs\nYXN0IG9yZGVyIHZhbCB3ZSByZWFkCiAgICAgICAgICAgICAgICBpZiAoc2Vx\nICE9IDAgJiYgY29sbCBpbnN0YW5jZW9mIFByb3h5KQogICAgICAgICAgICAg\nICAgICAgICgoUHJveHkpIGNvbGwpLmdldENoYW5nZVRyYWNrZXIoKS5zZXRO\nZXh0U2VxdWVuY2Uoc2VxKTsKCiAgICAgICAgICAgICAgICAvLyBzdGFydCBh\nIG5ldyBjb2xsZWN0aW9uCiAgICAgICAgICAgICAgICBvaWQgPSBuZXh0T2lk\nOwogICAgICAgICAgICAgICAgc2VxID0gMDsKICAgICAgICAgICAgICAgIGlm\nIChmaWVsZC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5BUlJBWSkKICAg\nICAgICAgICAgICAgICAgICBjb2xsID0gbmV3IEFycmF5TGlzdCgpOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGNvbGwgPSBz\nbS5uZXdQcm94eShmaWVsZC5nZXRJbmRleCgpKTsKICAgICAgICAgICAgICAg\nIHJlbHMucHV0KG9pZCwgY29sbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGlmIChmaWVsZC5nZXRPcmRlckNvbHVtbigpICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBzZXEgPSByZXMuZ2V0SW50KGZpZWxkLmdldE9yZGVyQ29s\ndW1uKCksIG9yZGVySm9pbnMpICsgMTsKCiAgICAgICAgICAgIC8vIGZvciBp\nbnZlcnNlRWFnZXIgZmllbGQKICAgICAgICAgICAgc2V0TWFwcGVkQnkob2lk\nLCBzbSwgY29sbCwgcmVzKTsKICAgICAgICAgICAgT2JqZWN0IHZhbCA9IGxv\nYWRFbGVtZW50KG51bGwsIHN0b3JlLCBmZXRjaCwgcmVzLCBkYXRhSm9pbnMp\nOwogICAgICAgICAgICBhZGQoc3RvcmUsIGNvbGwsIHZhbCk7CiAgICAgICAg\nfQogICAgICAgIHJlcy5jbG9zZSgpOwoKICAgICAgICByZXR1cm4gcmVsczsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgc2V0TWFwcGVkQnkoT2JqZWN0IG9p\nZCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgT2JqZWN0IGNvbGwsCiAgICAg\nICAgUmVzdWx0IHJlcykgewogICAgICAgIC8vIGZvciBpbnZlcnNlRWFnZXIg\nZmllbGQKICAgICAgICBGaWVsZE1hcHBpbmcgbWFwcGVkQnlGaWVsZE1hcHBp\nbmcgPSBmaWVsZC5nZXRNYXBwZWRCeU1hcHBpbmcoKTsKICAgICAgICBQZXJz\naXN0ZW5jZUNhcGFibGUgbWFwcGVkQnlWYWx1ZSA9IG51bGw7CiAgICAgICAg\nCiAgICAgICAgaWYgKG1hcHBlZEJ5RmllbGRNYXBwaW5nICE9IG51bGwpIHsK\nICAgICAgICAgICAgVmFsdWVNYXBwaW5nIHZhbCA9IG1hcHBlZEJ5RmllbGRN\nYXBwaW5nLmdldFZhbHVlTWFwcGluZygpOwogICAgICAgICAgICBDbGFzc01l\ndGFEYXRhIGRlY01ldGEgPSB2YWwuZ2V0VHlwZU1ldGFEYXRhKCk7CiAgICAg\nICAgICAgIC8vIHRoaXMgaW52ZXJzZSBmaWVsZCBkb2VzIG5vdCBoYXZlIGNv\ncnJlc3BvbmRpbmcgY2xhc3NNYXBwaW5nCiAgICAgICAgICAgIC8vIGl0cyB2\nYWx1ZSBtYXkgYmUgYSBjb2xsZWN0aW9uL21hcCBldGMuCiAgICAgICAgICAg\nIGlmIChkZWNNZXRhID09IG51bGwpIAogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIAkKICAgICAgICAgICAgaWYgKG9pZC5lcXVhbHMoc20uZ2V0\nT2JqZWN0SWQoKSkpIHsKICAgICAgICAgICAgICAgIG1hcHBlZEJ5VmFsdWUg\nPSBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICAgICAgICAg\nIHJlcy5zZXRNYXBwZWRCeUZpZWxkTWFwcGluZyhtYXBwZWRCeUZpZWxkTWFw\ncGluZyk7CiAgICAgICAgICAgICAgICByZXMuc2V0TWFwcGVkQnlWYWx1ZSht\nYXBwZWRCeVZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChjb2xsIGlu\nc3RhbmNlb2YgQ29sbGVjdGlvbiAmJiAKICAgICAgICAgICAgICAgICgoQ29s\nbGVjdGlvbikgY29sbCkuc2l6ZSgpID4gMCkgewogICAgICAgICAgICAgICAg\nLy8gQ3VzdG9tZXIgKDEpIDwtLT4gT3JkZXJzKG4pCiAgICAgICAgICAgICAg\nICAvLyBjb2xsIGNvbnRhaW5zIHRoZSB2YWx1ZXMgb2YgdGhlIHRvTWFueSBm\naWVsZCAoT3JkZXJzKQogICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBTdGF0\nZU1hbmFnZXIgb2YgdGhpcyB0b01hbnkgdmFsdWUKICAgICAgICAgICAgICAg\nIC8vIGFuZCBmaW5kIHRoZSB2YWx1ZSBvZiB0aGUgaW52ZXJzZSBtYXBwZWRC\neSBmaWVsZCAoQ3VzdG9tZXIpCiAgICAgICAgICAgICAgICAvLyBmb3IgdGhp\ncyB0b01hY2RueSBmaWVsZAogICAgICAgICAgICAgICAgUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjID0gKFBlcnNpc3RlbmNlQ2FwYWJsZSkKICAgICAgICAgICAg\nICAgICAgICAoKENvbGxlY3Rpb24pIGNvbGwpLml0ZXJhdG9yKCkubmV4dCgp\nOwogICAgICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbTEgPSAo\nT3BlbkpQQVN0YXRlTWFuYWdlcikgcGMuCiAgICAgICAgICAgICAgICAgICAg\ncGNHZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAgICAgIAogICAgICAg\nICAgICAgICAgQ2xhc3NNYXBwaW5nIGNsbSA9ICgoQ2xhc3NNYXBwaW5nKSBz\nbTEuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgICAgICAgICBGaWVsZE1hcHBp\nbmcgZm0gPSAoRmllbGRNYXBwaW5nKSBjbG0uZ2V0RmllbGQoCiAgICAgICAg\nICAgICAgICAgICAgbWFwcGVkQnlGaWVsZE1hcHBpbmcuZ2V0TmFtZSgpKTsK\nICAgICAgICAgICAgICAgIGlmIChmbSA9PSBtYXBwZWRCeUZpZWxkTWFwcGlu\nZykKICAgICAgICAgICAgICAgICAgICByZXMuc2V0TWFwcGVkQnlWYWx1ZShz\nbTEuZmV0Y2hPYmplY3QoZm0uZ2V0SW5kZXgoKSkpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgcmVzLnNldE1hcHBlZEJ5VmFsdWUo\nbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9ICAgICAgICAKICAgIH0K\nCiAgICAvKioKICAgICAqIEV4dHJhY3QgdGhlIG9pZCB2YWx1ZSBmcm9tIHRo\nZSBnaXZlbiByZXN1bHQuIElmIHRoZSBuZXh0IG9pZCBpcyB0aGUKICAgICAq\nIHNhbWUgYXMgdGhlIGdpdmVuIG9uZSwgcmV0dXJucyB0aGUgZ2l2ZW4gSlZN\nIGluc3RhbmNlLgogICAgICovCiAgICBwcml2YXRlIE9iamVjdCBnZXROZXh0\nT2JqZWN0SWQoQ2xhc3NNYXBwaW5nIG93bmVyLCBKREJDU3RvcmUgc3RvcmUs\nCiAgICAgICAgUmVzdWx0IHJlcywgT2JqZWN0IG9pZCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiB0aGlzIGlzIGEgZGF0\nYXN0b3JlIGlkIGNsYXNzIHdlIGNhbiBhdm9pZCBjcmVhdGluZyBhIG5ldyBv\naWQKICAgICAgICAvLyBvYmplY3QgZm9yIHRoZSBjb21tb24gY2FzZQogICAg\nICAgIGlmIChvaWQgIT0gbnVsbCAmJiBvd25lci5nZXRJZGVudGl0eVR5cGUo\nKSA9PSBDbGFzc01hcHBpbmcuSURfREFUQVNUT1JFCiAgICAgICAgICAgICYm\nIG93bmVyLmlzUHJpbWFyeUtleU9iamVjdElkKHRydWUpKSB7CiAgICAgICAg\nICAgIGxvbmcgbmlkID0gcmVzLmdldExvbmcob3duZXIuZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKVswXSk7CiAgICAgICAgICAgIGxvbmcgaWQgPSAoKElkKSBv\naWQpLmdldElkKCk7CiAgICAgICAgICAgIHJldHVybiAobmlkID09IGlkKSA/\nIG9pZCA6IHN0b3JlLm5ld0RhdGFTdG9yZUlkKG5pZCwgb3duZXIsIHRydWUp\nOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IG5vaWQgPSBvd25lci5nZXRP\nYmplY3RJZChzdG9yZSwgcmVzLCBudWxsLCB0cnVlLCBudWxsKTsKICAgICAg\nICBpZiAobm9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICByZXR1cm4gKG5vaWQuZXF1YWxzKG9pZCkpID8gb2lkIDogbm9p\nZDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2FkRWFnZXJKb2luKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGluaXRpYWxp\nemUgZmllbGQgdmFsdWUKICAgICAgICBPYmplY3QgY29sbDsKICAgICAgICBp\nZiAoZmllbGQuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuQVJSQVkpCiAg\nICAgICAgICAgIGNvbGwgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBjb2xsID0gc20ubmV3UHJveHkoZmllbGQuZ2V0SW5k\nZXgoKSk7CgogICAgICAgIEpvaW5zIGRhdGFKb2lucyA9IG51bGw7CiAgICAg\nICAgSm9pbnMgcmVmSm9pbnMgPSByZXMubmV3Sm9pbnMoKS5zZXRWYXJpYWJs\nZSgiKiIpOwogICAgICAgIGpvaW4ocmVmSm9pbnMsIGZhbHNlKTsKCiAgICAg\nICAgQ2xhc3NNYXBwaW5nIG93bmVyTWFwcGluZyA9IGZpZWxkLmdldERlZmlu\naW5nTWFwcGluZygpOwogICAgICAgIE9iamVjdCByZWYgPSBudWxsOwogICAg\nICAgIGludCBzZXEgPSAwOwogICAgICAgIGludCB0eXBlSWR4ID0gcmVzLmlu\nZGV4T2YoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgdHJ1ZTsgaSsrKSB7\nCiAgICAgICAgICAgIC8vIGV4dHJhY3QgdGhlIG93bmVyIGlkIHZhbHVlCiAg\nICAgICAgICAgIHJlZiA9IGdldE5leHRSZWYob3duZXJNYXBwaW5nLCBzdG9y\nZSwgcmVzLCByZWYsIHJlZkpvaW5zKTsKICAgICAgICAgICAgaWYgKHJlZiA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgb2xkIGNvbGwg\nd2FzIGFuIG9yZGVyZWQgdHJhY2tpbmcgcHJveHksIHNldAogICAgICAgICAg\nICAgICAgLy8gaXRzIHNlcSB2YWx1ZSB0byB0aGUgbGFzdCBvcmRlciB2YWwg\nd2UgcmVhZAogICAgICAgICAgICAgICAgaWYgKHNlcSAhPSAwICYmIGNvbGwg\naW5zdGFuY2VvZiBQcm94eSkKICAgICAgICAgICAgICAgICAgICAoKFByb3h5\nKSBjb2xsKS5nZXRDaGFuZ2VUcmFja2VyKCkuc2V0TmV4dFNlcXVlbmNlKHNl\ncSk7CiAgICAgICAgICAgICAgICBpZiAoaSAhPSAwKQogICAgICAgICAgICAg\nICAgICAgIHJlcy5wdXNoQmFjaygpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRvIHNhbWUgam9pbnMg\nYXMgZm9yIGxvYWQKICAgICAgICAgICAgaWYgKGRhdGFKb2lucyA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBkYXRhSm9pbnMgPSByZXMubmV3Sm9pbnMo\nKS5zZXRWYXJpYWJsZSgiKiIpOwogICAgICAgICAgICAgICAgZGF0YUpvaW5z\nID0gam9pbihkYXRhSm9pbnMsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGRh\ndGFKb2lucyA9IGpvaW5SZWxhdGlvbihkYXRhSm9pbnMsIGZhbHNlLCBmYWxz\nZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRP\ncmRlckNvbHVtbigpICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXEgPSBy\nZXMuZ2V0SW50KGZpZWxkLmdldE9yZGVyQ29sdW1uKCksIHJlZkpvaW5zKSAr\nIDE7CiAgICAgICAgICAgIHJlcy5zZXRCYXNlTWFwcGluZyhudWxsKTsKICAg\nICAgICAgICAgYWRkKHN0b3JlLCBjb2xsLCBsb2FkRWxlbWVudChzbSwgc3Rv\ncmUsIGZldGNoLCByZXMsIGRhdGFKb2lucykpOwogICAgICAgICAgICBpZiAo\nIXJlcy5uZXh0KCkgfHwgcmVzLmluZGV4T2YoKSAhPSB0eXBlSWR4KSB7CiAg\nICAgICAgICAgICAgICByZXMucHVzaEJhY2soKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBs\nb2FkIHRoZSBjb2xsZWN0aW9uIGludG8gdGhlIG9iamVjdAogICAgICAgIGlm\nIChmaWVsZC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5BUlJBWSkKICAg\nICAgICAgICAgc20uc3RvcmVPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSwgSmF2\nYVR5cGVzLnRvQXJyYXkKICAgICAgICAgICAgICAgICgoQ29sbGVjdGlvbikg\nY29sbCwgZmllbGQuZ2V0RWxlbWVudCgpLmdldFR5cGUoKSkpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZmllbGQuZ2V0SW5k\nZXgoKSwgY29sbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHRyYWN0IHRo\nZSByZWZlcmVuY2UgY29sdW1uIHZhbHVlKHMpIGZyb20gdGhlIGdpdmVuIHJl\nc3VsdC4gSWYgdGhlCiAgICAgKiBleHRyYWN0ZWQgcmVzdWx0IGlzIHRoZSBz\nYW1lIGFzIHRoZSBjdXJyZW50IG9uZSBvciB0aGUgY3VycmVudAogICAgICog\nb25lIGlzIG51bGwsIHJldHVybnMgdGhlIGV4dHJhY3RlZCByZXN1bHQuIEVs\nc2UgcmV0dXJucyBudWxsLgogICAgICovCiAgICBwcml2YXRlIE9iamVjdCBn\nZXROZXh0UmVmKENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDU3RvcmUgc3Rv\ncmUsCiAgICAgICAgUmVzdWx0IHJlcywgT2JqZWN0IHJlZiwgSm9pbnMgcmVm\nSm9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nQ29sdW1uW10gY29scyA9IGdldEpvaW5Gb3JlaWduS2V5KGdldERlZmF1bHRF\nbGVtZW50TWFwcGluZyhmYWxzZSkpLgogICAgICAgICAgICBnZXRDb2x1bW5z\nKCk7CiAgICAgICAgT2JqZWN0IHZhbDsKICAgICAgICBpZiAoY29scy5sZW5n\ndGggPT0gMSkgewogICAgICAgICAgICB2YWwgPSByZXMuZ2V0T2JqZWN0KGNv\nbHNbMF0sIG51bGwsIHJlZkpvaW5zKTsKICAgICAgICAgICAgaWYgKHZhbCA9\nPSBudWxsIHx8IChyZWYgIT0gbnVsbCAmJiAhdmFsLmVxdWFscyhyZWYpKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1\ncm4gdmFsOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0W10gcmVmcyA9IChP\nYmplY3RbXSkgcmVmOwogICAgICAgIGlmIChyZWZzID09IG51bGwpCiAgICAg\nICAgICAgIHJlZnMgPSBuZXcgT2JqZWN0W2NvbHMubGVuZ3RoXTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgdmFsID0gcmVzLmdldE9iamVjdChjb2xzW2ldLCBudWxsLCBy\nZWZKb2lucyk7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAocmVmc1tp\nXSAhPSBudWxsICYmICF2YWwuZXF1YWxzKHJlZnNbaV0pKQogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJlZnNbaV0gPSB2YWw7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiByZWZzOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGxvYWQoZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nZmluYWwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIGZpbmFsIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKGZpZWxkLmlzTFJTKCkpIHsKICAgICAgICAg\nICAgUHJveHkgY29sbCA9IG5ld0xSU1Byb3h5KCk7CgogICAgICAgICAgICAv\nLyBpZiB0aGlzIGlzIG9yZGVyZWQgd2UgbmVlZCB0byBrbm93IHRoZSBuZXh0\nIHNlcSB0byB1c2UgaW4gY2FzZQogICAgICAgICAgICAvLyBvYmplY3RzIGFy\nZSBhZGRlZCB0byB0aGUgY29sbGVjdGlvbgogICAgICAgICAgICBpZiAoZmll\nbGQuZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAvLyB3ZSBkb24ndCBhbGxvdyBvcmRlcmluZyB0YWJsZSBwZXIgY2xhc3Mg\nb25lLW1hbnkncywgc28KICAgICAgICAgICAgICAgIC8vIHdlIGtub3cgd2Ug\nZG9uJ3QgbmVlZCBhIHVuaW9uCiAgICAgICAgICAgICAgICBTZWxlY3Qgc2Vs\nID0gc3RvcmUuZ2V0U1FMRmFjdG9yeSgpLm5ld1NlbGVjdCgpOwogICAgICAg\nICAgICAgICAgc2VsLnNldEFnZ3JlZ2F0ZSh0cnVlKTsKICAgICAgICAgICAg\nICAgIFN0cmluZ0J1ZmZlciBzcWwgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAg\nICAgICAgICAgICAgICBzcWwuYXBwZW5kKCJNQVgoIikuCiAgICAgICAgICAg\nICAgICAgICAgYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlhcyhmaWVsZC5nZXRP\ncmRlckNvbHVtbigpKSkuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKCIp\nIik7CiAgICAgICAgICAgICAgICBzZWwuc2VsZWN0KHNxbC50b1N0cmluZygp\nLCBmaWVsZCk7CiAgICAgICAgICAgICAgICBDbGFzc01hcHBpbmcgcmVsID0g\nZ2V0RGVmYXVsdEVsZW1lbnRNYXBwaW5nKGZhbHNlKTsKICAgICAgICAgICAg\nICAgIHNlbC53aGVyZUZvcmVpZ25LZXkoZ2V0Sm9pbkZvcmVpZ25LZXkocmVs\nKSwKICAgICAgICAgICAgICAgICAgICBzbS5nZXRPYmplY3RJZCgpLCBmaWVs\nZC5nZXREZWZpbmluZ01hcHBpbmcoKSwgc3RvcmUpOwoKICAgICAgICAgICAg\nICAgIFJlc3VsdCByZXMgPSBzZWwuZXhlY3V0ZShzdG9yZSwgZmV0Y2gpOwog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXMu\nbmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGNvbGwuZ2V0Q2hhbmdlVHJh\nY2tlcigpLnNldE5leHRTZXF1ZW5jZQogICAgICAgICAgICAgICAgICAgICAg\nICAocmVzLmdldEludChmaWVsZCkgKyAxKTsKICAgICAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgcmVzLmNsb3NlKCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc20u\nc3RvcmVPYmplY3RGaWVsZChmaWVsZC5nZXRJbmRleCgpLCBjb2xsKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy9jYWNoZSB1\nbmlvbiBmb3IgZmllbGQgaGVyZQogICAgICAgIC8vIHNlbGVjdCBkYXRhIGZv\nciB0aGlzIHNtCiAgICAgICAgYm9vbGVhbiBmb3VuZCA9IHRydWU7CiAgICAg\nICAgZmluYWwgQ2xhc3NNYXBwaW5nW10gZWxlbXMgPSBnZXRJbmRlcGVuZGVu\ndEVsZW1lbnRNYXBwaW5ncyh0cnVlKTsKICAgICAgICBmaW5hbCBKb2luc1td\nIHJlc0pvaW5zID0gbmV3IEpvaW5zW01hdGgubWF4KDEsIGVsZW1zLmxlbmd0\naCldOwogICAgICAgIExpc3QgcGFybUxpc3QgPSBudWxsOwogICAgICAgIFVu\naW9uIHVuaW9uID0gbnVsbDsKICAgICAgICBTZWxlY3RJbXBsIHNlbCA9IG51\nbGw7CiAgICAgICAgTWFwPEpEQkNTdG9yZU1hbmFnZXIuU2VsZWN0S2V5LCBP\nYmplY3RbXT4gc3RvcmVDb2xsZWN0aW9uVW5pb25DYWNoZSA9IG51bGw7CiAg\nICAgICAgSkRCQ1N0b3JlTWFuYWdlci5TZWxlY3RLZXkgc2VsS2V5ID0gbnVs\nbDsKICAgICAgICBpZiAoISgoSkRCQ1N0b3JlTWFuYWdlcilzdG9yZSkuaXNR\ndWVyeVNRTENhY2hlT24oKSB8fCBlbGVtcy5sZW5ndGggPiAxKQogICAgICAg\nICAgICB1bmlvbiA9IG5ld1VuaW9uKHNtLCBzdG9yZSwgZmV0Y2gsIGVsZW1z\nLCByZXNKb2lucyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHBhcm1M\naXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoQ2xvbmUgPSBuZXcgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbkltcGwoKTsKICAgICAgICAgICAgZmV0Y2hDbG9uZS5jb3B5KGZl\ndGNoKTsKICAgICAgICAgICAKICAgICAgICAgICAgLy8gdG8gc3BlY2lmeSB0\naGUgdHlwZSBzbyB0aGF0IG5vIGNhc3QgaXMgbmVlZGVkCiAgICAgICAgICAg\nIHN0b3JlQ29sbGVjdGlvblVuaW9uQ2FjaGUgPSAoKEpEQkNTdG9yZU1hbmFn\nZXIpc3RvcmUpLgogICAgICAgICAgICAgICAgZ2V0Q2FjaGVNYXBGcm9tUXVl\ncnlTUUxDYWNoZShTdG9yZUNvbGxlY3Rpb25GaWVsZFN0cmF0ZWd5LmNsYXNz\nKTsKICAgICAgICAgICAgc2VsS2V5ID0gCiAgICAgICAgICAgICAgICBuZXcg\nSkRCQ1N0b3JlTWFuYWdlci5TZWxlY3RLZXkobnVsbCwgZmllbGQsIGZldGNo\nQ2xvbmUpOwogICAgICAgICAgICBPYmplY3RbXSBvYmpzID0gc3RvcmVDb2xs\nZWN0aW9uVW5pb25DYWNoZS5nZXQoc2VsS2V5KTsKICAgICAgICAgICAgaWYg\nKG9ianMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgdW5pb24gPSAoVW5p\nb24pIG9ianNbMF07CiAgICAgICAgICAgICAgICByZXNKb2luc1swXSA9IChK\nb2lucykgb2Jqc1sxXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgIHN5bmNocm9uaXplZChzdG9yZUNvbGxlY3Rp\nb25VbmlvbkNhY2hlKSB7CiAgICAgICAgICAgICAgICAgICAgb2JqcyA9IHN0\nb3JlQ29sbGVjdGlvblVuaW9uQ2FjaGUuZ2V0KHNlbEtleSk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKG9ianMgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgICAgICAvLyBzZWxlY3QgZGF0YSBmb3IgdGhpcyBzbQogICAgICAg\nICAgICAgICAgICAgICAgICB1bmlvbiA9IG5ld1VuaW9uKHNtLCBzdG9yZSwg\nZmV0Y2gsIGVsZW1zLCByZXNKb2lucyk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW5pb24gPSAoVW5pb24pIG9i\nanNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc0pvaW5zWzBdID0g\nKEpvaW5zKSBvYmpzWzFdOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgICAgICAgICAgc2VsID0gKChMb2dpY2FsVW5pb24uVW5pb25TZWxl\nY3QpdW5pb24uZ2V0U2VsZWN0cygpWzBdKS4KICAgICAgICAgICAgICAgICAg\nICAgICAgZ2V0RGVsZWdhdGUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nc2VsLmdldFNRTCgpID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAJ\nKChTZWxlY3RJbXBsKXNlbCkuc2V0U1FMKHN0b3JlLCBmZXRjaCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IGNhY2hl\nIHRoZSB1bmlvbiB3aGVuIGVsZW1zIGxlbmd0aCBpcyAxIGZvciBub3cKICAg\nICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kKSB7IAogICAgICAgICAgICAg\nICAgICAgICAgICBPYmplY3RbXSBvYmpzMSA9IG5ldyBPYmplY3RbMl07CiAg\nICAgICAgICAgICAgICAgICAgICAgIG9ianMxWzBdID0gdW5pb247CiAgICAg\nICAgICAgICAgICAgICAgICAgIG9ianMxWzFdID0gcmVzSm9pbnNbMF07CiAg\nICAgICAgICAgICAgICAgICAgICAgICgoSkRCQ1N0b3JlTWFuYWdlcilzdG9y\nZSkuYWRkVG9TcWxDYWNoZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHN0b3JlQ29sbGVjdGlvblVuaW9uQ2FjaGUsIHNlbEtleSwgb2JqczEpOwog\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIExvZyBsb2cgPSBz\ndG9yZS5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICBnZXRM\nb2coSkRCQ0NvbmZpZ3VyYXRpb24uTE9HX0pEQkMpOwogICAgICAgICAgICBp\nZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgIGlm\nIChmb3VuZCkKICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5n\nZXQoImNhY2hlLWhpdCIsIGZpZWxkLCB0aGlzLmdldENsYXNzKCkpKTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBsb2cudHJh\nY2UoX2xvYy5nZXQoImNhY2hlLW1pc3NlZCIsIGZpZWxkLCB0aGlzLmdldENs\nYXNzKCkpKTsgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAg\nICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gZmllbGQuZ2V0RGVmaW5pbmdN\nYXBwaW5nKCk7CiAgICAgICAgICAgIE9iamVjdCBvaWQgPSBzbS5nZXRPYmpl\nY3RJZCgpOwogICAgICAgICAgICBDb2x1bW5bXSBjb2xzID0gbWFwcGluZy5n\nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgICAgICBpZiAoc2VsID09\nIG51bGwpCiAgICAgICAgICAgICAgICBzZWwgPSAoKExvZ2ljYWxVbmlvbi5V\nbmlvblNlbGVjdCl1bmlvbi5nZXRTZWxlY3RzKClbMF0pLgogICAgICAgICAg\nICAgICAgZ2V0RGVsZWdhdGUoKTsKCiAgICAgICAgICAgIHNlbC53aGVyZVBy\naW1hcnlLZXkobWFwcGluZywgY29scywgY29scywgb2lkLCBzdG9yZSwgCiAg\nICAgICAgICAgICAgICAJbnVsbCwgbnVsbCwgcGFybUxpc3QpOwogICAgICAg\nICAgICBMaXN0IG5vbkZLUGFyYW1zID0gc2VsLmdldFNRTCgpLmdldE5vbkZL\nUGFyYW1ldGVycygpOwogICAgICAgICAgICBpZiAobm9uRktQYXJhbXMgIT0g\nbnVsbCAmJiBub25GS1BhcmFtcy5zaXplKCkgPiAwKSAKICAgICAgICAgICAg\nICAgIHBhcm1MaXN0LmFkZEFsbChub25GS1BhcmFtcyk7CiAgICAgICAgfQog\nICAgICAgIAogICAgICAgIC8vIGNyZWF0ZSBwcm94eQogICAgICAgIE9iamVj\ndCBjb2xsOwogICAgICAgIENoYW5nZVRyYWNrZXIgY3QgPSBudWxsOwogICAg\nICAgIGlmIChmaWVsZC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5BUlJB\nWSkKICAgICAgICAgICAgY29sbCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgY29sbCA9IHNtLm5ld1Byb3h5KGZpZWxk\nLmdldEluZGV4KCkpOwogICAgICAgICAgICBpZiAoY29sbCBpbnN0YW5jZW9m\nIFByb3h5KQogICAgICAgICAgICAgICAgY3QgPSAoKFByb3h5KSBjb2xsKS5n\nZXRDaGFuZ2VUcmFja2VyKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBsb2Fk\nIHZhbHVlcwogICAgICAgIFJlc3VsdCByZXMgPSB1bmlvbi5leGVjdXRlKHN0\nb3JlLCBmZXRjaCwgcGFybUxpc3QpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGludCBzZXEgPSAtMTsKICAgICAgICAgICAgd2hpbGUgKHJlcy5uZXh0\nKCkpIHsKICAgICAgICAgICAgICAgIGlmIChjdCAhPSBudWxsICYmIGZpZWxk\nLmdldE9yZGVyQ29sdW1uKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICBzZXEgPSByZXMuZ2V0SW50KGZpZWxkLmdldE9yZGVyQ29sdW1uKCkpOwog\nICAgICAgICAgICAgICAgc2V0TWFwcGVkQnkoc20uZ2V0T2JqZWN0SWQoKSwg\nc20sIGNvbGwsIHJlcyk7CiAgICAgICAgICAgICAgIAlhZGQoc3RvcmUsIGNv\nbGwsIGxvYWRFbGVtZW50KHNtLCBzdG9yZSwgZmV0Y2gsIHJlcywKICAgICAg\nICAgICAJICAgICAgICByZXNKb2luc1tyZXMuaW5kZXhPZigpXSkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChjdCAhPSBudWxsICYmIGZpZWxk\nLmdldE9yZGVyQ29sdW1uKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGN0\nLnNldE5leHRTZXF1ZW5jZShzZXEgKyAxKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICByZXMuY2xvc2UoKTsKICAgICAgICB9CgogICAgICAg\nIC8vIHNldCBpbnRvIHNtCiAgICAgICAgaWYgKGZpZWxkLmdldFR5cGVDb2Rl\nKCkgPT0gSmF2YVR5cGVzLkFSUkFZKQogICAgICAgICAgICBzbS5zdG9yZU9i\namVjdChmaWVsZC5nZXRJbmRleCgpLCBKYXZhVHlwZXMudG9BcnJheQogICAg\nICAgICAgICAgICAgKChDb2xsZWN0aW9uKSBjb2xsLCBmaWVsZC5nZXRFbGVt\nZW50KCkuZ2V0VHlwZSgpKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\nbS5zdG9yZU9iamVjdChmaWVsZC5nZXRJbmRleCgpLCBjb2xsKTsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgVW5pb24gbmV3VW5pb24oZmluYWwgT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgZmluYWwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAg\nIGZpbmFsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGZpbmFsIENs\nYXNzTWFwcGluZ1tdIGVsZW1zLAogICAgICAgIGZpbmFsIEpvaW5zW10gcmVz\nSm9pbnMpIHsKICAgICAgICBVbmlvbiB1bmlvbiA9IHN0b3JlLmdldFNRTEZh\nY3RvcnkoKS5uZXdVbmlvbgogICAgICAgIChNYXRoLm1heCgxLCBlbGVtcy5s\nZW5ndGgpKTsKICAgICAgICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVj\ndG9yKCkgewogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0\nIHNlbCwgaW50IGlkeCkgewogICAgICAgICAgICAgICAgQ2xhc3NNYXBwaW5n\nIGVsZW0gPSAoZWxlbXMubGVuZ3RoID09IDApID8gbnVsbCA6IGVsZW1zW2lk\neF07CiAgICAgICAgICAgICAgICByZXNKb2luc1tpZHhdID0gc2VsZWN0QWxs\nKHNlbCwgZWxlbSwgc20sIHN0b3JlLCBmZXRjaCwKICAgICAgICAgICAgICAg\nICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9QQVJBTExF\nTCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4g\ndW5pb247CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2VsZWN0IGRhdGEg\nZm9yIGxvYWRpbmcsIHN0YXJ0aW5nIGluIGZpZWxkIHRhYmxlLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgSm9pbnMgc2VsZWN0QWxsKFNlbGVjdCBzZWwsIENs\nYXNzTWFwcGluZyBlbGVtLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwKICAgICAgICBpbnQgZWFnZXJNb2RlKSB7CiAgICAgICAgc2VsLndo\nZXJlRm9yZWlnbktleShnZXRKb2luRm9yZWlnbktleShlbGVtKSwgc20uZ2V0\nT2JqZWN0SWQoKSwKICAgICAgICAgICAgZmllbGQuZ2V0RGVmaW5pbmdNYXBw\naW5nKCksIHN0b3JlKTsKCiAgICAgICAgLy8gb3JkZXIgZmlyc3QsIHRoZW4g\nc2VsZWN0IHNvIHRoYXQgaWYgdGhlIHByb2plY3Rpb24gaW50cm9kdWNlcwog\nICAgICAgIC8vIGFkZGl0aW9uYWwgb3JkZXJpbmcsIGl0IHdpbGwgYmUgYWZ0\nZXIgb3VyIHJlcXVpcmVkIG9yZGVyaW5nCiAgICAgICAgZmllbGQub3JkZXJM\nb2NhbChzZWwsIGVsZW0sIG51bGwpOwogICAgICAgIEpvaW5zIGpvaW5zID0g\nam9pbkVsZW1lbnRSZWxhdGlvbihzZWwubmV3Sm9pbnMoKSwgZWxlbSk7CiAg\nICAgICAgZmllbGQub3JkZXJSZWxhdGlvbihzZWwsIGVsZW0sIGpvaW5zKTsK\nICAgICAgICBzZWxlY3RFbGVtZW50KHNlbCwgZWxlbSwgc3RvcmUsIGZldGNo\nLCBlYWdlck1vZGUsIGpvaW5zKTsKICAgICAgICByZXR1cm4gam9pbnM7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBsb2FkUHJvamVjdGlvbihKREJDU3Rv\ncmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAg\nICAgUmVzdWx0IHJlcywgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGxvYWRFbGVtZW50KG51bGws\nIHN0b3JlLCBmZXRjaCwgcmVzLCBqb2lucyk7CiAgICB9CgogICAgcHJvdGVj\ndGVkIEZvcmVpZ25LZXkgZ2V0Sm9pbkZvcmVpZ25LZXkoKSB7CiAgICAgICAg\ncmV0dXJuIGdldEpvaW5Gb3JlaWduS2V5KGdldERlZmF1bHRFbGVtZW50TWFw\ncGluZyhmYWxzZSkpOwogICAgfQp9Cg==\n","encoding":"base64"}

