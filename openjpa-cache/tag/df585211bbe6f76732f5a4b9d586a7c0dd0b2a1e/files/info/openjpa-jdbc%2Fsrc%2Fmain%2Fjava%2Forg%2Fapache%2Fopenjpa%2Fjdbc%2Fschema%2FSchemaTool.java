{"sha":"e500de0977fbc8df1612135fe648fc2d77a0fa6b","node_id":"MDQ6QmxvYjIwNjM2NDplNTAwZGUwOTc3ZmJjOGRmMTYxMjEzNWZlNjQ4ZmMyZDc3YTBmYTZi","size":54653,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e500de0977fbc8df1612135fe648fc2d77a0fa6b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuaW8uUHJpbnRXcml0ZXI7CmltcG9ydCBqYXZhLmlvLldy\naXRlcjsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9ydCBqYXZh\nLnNxbC5EYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgamF2YS5zcWwuU1FMRXhj\nZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVtZW50OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsK\naW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwoKaW1wb3J0IG9yZy5hcGFj\naGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29u\nZmlndXJhdGlvbkltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuREJEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc3FsLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuRmlsZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CgovKioKICogVGhlIFNj\naGVtYVRvb2wgaXMgdXNlZCB0byBtYW5hZ2UgdGhlIGRhdGFiYXNlIHNjaGVt\nYS4gTm90ZSB0aGF0IHRoZQogKiB0b29sIG5ldmVyIGFkZHMgb3IgZHJvcHMg\ndW5pcXVlIGNvbnN0cmFpbnRzIGZyb20gZXhpc3RpbmcgdGFibGVzLCBiZWNh\ndXNlCiAqIEpEQkMge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9IGRvZXMgbm90\nIGluY2x1ZGUgaW5mb3JtYXRpb24gb24gdGhlc2UKICogY29uc3RyYWludHMu\nCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgUGF0cmljayBM\naW5za2V5CiAqLwpwdWJsaWMgY2xhc3MgU2NoZW1hVG9vbCB7CgogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQUNUSU9OX0FERCA9ICJhZGQiOwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQUNUSU9OX0RST1AgPSAi\nZHJvcCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05f\nUkVUQUlOID0gInJldGFpbiI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBBQ1RJT05fUkVGUkVTSCA9ICJyZWZyZXNoIjsKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgU3RyaW5nIEFDVElPTl9CVUlMRCA9ICJidWlsZCI7CiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fUkVGTEVDVCA9\nICJyZWZsZWN0IjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIEFD\nVElPTl9DUkVBVEVEQiA9ICJjcmVhdGVEQiI7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBBQ1RJT05fRFJPUERCID0gImRyb3BEQiI7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fSU1QT1JUID0gImlt\ncG9ydCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05f\nRVhQT1JUID0gImV4cG9ydCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBBQ1RJT05fREVMRVRFX1RBQkxFX0NPTlRFTlRTID0gCiAgICAgICAg\nImRlbGV0ZVRhYmxlQ29udGVudHMiOwoKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgU3RyaW5nW10gQUNUSU9OUyA9IG5ldyBTdHJpbmdbXXsKICAgICAgICBB\nQ1RJT05fQURELAogICAgICAgIEFDVElPTl9EUk9QLAogICAgICAgIEFDVElP\nTl9SRVRBSU4sCiAgICAgICAgQUNUSU9OX1JFRlJFU0gsCiAgICAgICAgQUNU\nSU9OX0JVSUxELAogICAgICAgIEFDVElPTl9SRUZMRUNULAogICAgICAgIEFD\nVElPTl9DUkVBVEVEQiwKICAgICAgICBBQ1RJT05fRFJPUERCLAogICAgICAg\nIEFDVElPTl9JTVBPUlQsCiAgICAgICAgQUNUSU9OX0VYUE9SVCwKICAgICAg\nICBBQ1RJT05fREVMRVRFX1RBQkxFX0NPTlRFTlRTLAogICAgfTsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXpl\nci5mb3JQYWNrYWdlCiAgICAgICAgKFNjaGVtYVRvb2wuY2xhc3MpOwoKICAg\nIHByaXZhdGUgZmluYWwgSkRCQ0NvbmZpZ3VyYXRpb24gX2NvbmY7CiAgICBw\ncml2YXRlIGZpbmFsIERhdGFTb3VyY2UgX2RzOwogICAgcHJpdmF0ZSBmaW5h\nbCBMb2cgX2xvZzsKICAgIHByaXZhdGUgZmluYWwgREJEaWN0aW9uYXJ5IF9k\naWN0OwogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX2FjdGlvbjsKICAgIHBy\naXZhdGUgYm9vbGVhbiBfaWdub3JlRXJycyA9IGZhbHNlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9vcGVuanBhVGFibGVzID0gZmFsc2U7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2Ryb3BUYWJsZXMgPSB0cnVlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9kcm9wU2VxcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX3Br\ncyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ZrcyA9IHRydWU7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2luZGV4ZXMgPSB0cnVlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9zZXFzID0gdHJ1ZTsKICAgIHByaXZhdGUgUHJpbnRXcml0\nZXIgX3dyaXRlciA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIF9n\ncm91cCA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIF9kYiA9IG51\nbGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Z1bGxEQiA9IGZhbHNlOwoKICAg\nIC8qKgogICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci4gVG9vbHMgY29uc3Ry\ndWN0ZWQgdGhpcyB3YXkgd2lsbCBub3QgaGF2ZSBhbgogICAgICogYWN0aW9u\nLCBzbyB0aGUge0BsaW5rICNydW4oKX0gbWV0aG9kIHdpbGwgYmUgYSBuby1v\ncC4KICAgICAqLwogICAgcHVibGljIFNjaGVtYVRvb2woSkRCQ0NvbmZpZ3Vy\nYXRpb24gY29uZikgewogICAgICAgIHRoaXMoY29uZiwgbnVsbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSB0b29sIHRvIHBlcmZvcm0g\ndGhlIGdpdmVuIGFjdGlvbi4KICAgICAqLwogICAgcHVibGljIFNjaGVtYVRv\nb2woSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nIGFjdGlvbikgewog\nICAgICAgIGlmIChhY3Rpb24gIT0gbnVsbCAmJiAhQXJyYXlzLmFzTGlzdChB\nQ1RJT05TKS5jb250YWlucyhhY3Rpb24pKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJhY3Rpb24gPT0gIiArIGFj\ndGlvbik7CgogICAgICAgIF9jb25mID0gY29uZjsKICAgICAgICBfYWN0aW9u\nID0gYWN0aW9uOwogICAgICAgIF9kcyA9IEFDVElPTl9CVUlMRC5lcXVhbHMo\nYWN0aW9uKSA/IG51bGwgOiBjb25mLmdldERhdGFTb3VyY2UyKG51bGwpOwog\nICAgICAgIF9sb2cgPSBjb25mLmdldExvZyhKREJDQ29uZmlndXJhdGlvbi5M\nT0dfU0NIRU1BKTsKCiAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGlzIHVwLWZy\nb250OyBvdGhlcndpc2UgdGhlIGRiZGljdGlvbmFyeWZhY3RvcnkgbWlnaHQK\nICAgICAgICAvLyB0cnkgdG8gdGFrZSBhIGNvbm5lY3Rpb24gdG8gaW5pdGlh\nbGl6ZSB3aGVuIHdlJ3ZlIGFscmVhZHkgZ290IG9uZToKICAgICAgICAvLyBi\nYWQgbmV3cyBpZiB0aGUgbWF4IHBvb2wgaXMgMQogICAgICAgIF9kaWN0ID0g\nX2NvbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBhY3Rpb24gc3VwcGxpZWQgb24gY29uc3RydWN0aW9u\nLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldEFjdGlvbigpIHsKICAg\nICAgICByZXR1cm4gX2FjdGlvbjsKICAgIH0KCiAgICAvKioKICAgICAqIElm\nIHRydWUsIFNRTEV4Y2VwdGlvbnMgdGhyb3duIGR1cmluZyBzY2hlbWEgbWFu\naXB1bGF0aW9uIHdpbGwgYmUKICAgICAqIHByaW50ZWQgYnV0IGlnbm9yZWQu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldElnbm9yZUVycm9ycygp\nIHsKICAgICAgICByZXR1cm4gX2lnbm9yZUVycnM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJZiB0cnVlLCBTUUxFeGNlcHRpb25zIHRocm93biBkdXJpbmcg\nc2NoZW1hIG1hbmlwdWxhdGlvbiB3aWxsIGJlCiAgICAgKiBwcmludGVkIGJ1\ndCBpZ25vcmVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJZ25vcmVF\ncnJvcnMoYm9vbGVhbiBpZ25vcmVFcnJzKSB7CiAgICAgICAgX2lnbm9yZUVy\ncnMgPSBpZ25vcmVFcnJzOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0byBhY3Qgb24gc3BlY2lhbCB0YWJsZXMgdXNlZCBieSBPcGVuSlBBIGNv\nbXBvbmVudHMKICAgICAqIGZvciBib29ra2VlcGluZy4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gZ2V0T3BlbkpQQVRhYmxlcygpIHsKICAgICAgICBy\nZXR1cm4gX29wZW5qcGFUYWJsZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIHRvIGFjdCBvbiBzcGVjaWFsIHRhYmxlcyB1c2VkIGJ5IE9wZW5K\nUEEgY29tcG9uZW50cwogICAgICogZm9yIGJvb2trZWVwaW5nLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRPcGVuSlBBVGFibGVzKGJvb2xlYW4gb3Bl\nbmpwYVRhYmxlcykgewogICAgICAgIF9vcGVuanBhVGFibGVzID0gb3Blbmpw\nYVRhYmxlczsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRydWUsIHRhYmxl\ncyB0aGF0IGFwcGVhciB0byBiZSB1bnVzZWQgd2lsbCBiZSBkcm9wcGVkLiBE\nZWZhdWx0cyB0bwogICAgICogdHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gZ2V0RHJvcFRhYmxlcygpIHsKICAgICAgICByZXR1cm4gX2Ryb3BU\nYWJsZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0cnVlLCB0YWJsZXMg\ndGhhdCBhcHBlYXIgdG8gYmUgdW51c2VkIHdpbGwgYmUgZHJvcHBlZC4gRGVm\nYXVsdHMgdG8KICAgICAqIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldERyb3BUYWJsZXMoYm9vbGVhbiBkcm9wVGFibGVzKSB7CiAgICAgICAg\nX2Ryb3BUYWJsZXMgPSBkcm9wVGFibGVzOwogICAgfQoKICAgIC8qKgogICAg\nICogSWYgdHJ1ZSwgc2VxdWVuY2VzIHRoYXQgYXBwZWFyIHRvIGJlIHVudXNl\nZCB3aWxsIGJlIGRyb3BwZWQuIERlZmF1bHRzCiAgICAgKiB0byB0cnVlLgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXREcm9wU2VxdWVuY2VzKCkg\newogICAgICAgIHJldHVybiBfZHJvcFNlcXM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJZiB0cnVlLCBzZXF1ZW5jZXMgdGhhdCBhcHBlYXIgdG8gYmUgdW51\nc2VkIHdpbGwgYmUgZHJvcHBlZC4gRGVmYXVsdHMKICAgICAqIHRvIHRydWUu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERyb3BTZXF1ZW5jZXMoYm9v\nbGVhbiBkcm9wU2VxcykgewogICAgICAgIF9kcm9wU2VxcyA9IGRyb3BTZXFz\nOwogICAgICAgIGlmIChkcm9wU2VxcykKICAgICAgICAgICAgc2V0U2VxdWVu\nY2VzKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBzZXF1\nZW5jZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVkLiBEZWZhdWx0cyB0byB0cnVl\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRTZXF1ZW5jZXMoKSB7\nCiAgICAgICAgcmV0dXJuIF9zZXFzOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciBzZXF1ZW5jZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVkLiBEZWZh\ndWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTZXF1\nZW5jZXMoYm9vbGVhbiBzZXFzKSB7CiAgICAgICAgX3NlcXMgPSBzZXFzOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBpbmRleGVzIG9uIGV4aXN0\naW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuCiAgICAgKiBEZWZh\ndWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRJ\nbmRleGVzKCkgewogICAgICAgIHJldHVybiBfaW5kZXhlczsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgaW5kZXhlcyBvbiBleGlzdGluZyB0YWJs\nZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVkLgogICAgICogRGVmYXVsdHMgdG8g\ndHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW5kZXhlcyhib29s\nZWFuIGluZGV4ZXMpIHsKICAgICAgICBfaW5kZXhlcyA9IGluZGV4ZXM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGZvcmVpZ24ga2V5cyBvbiBl\neGlzdGluZyB0YWJsZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVkLgogICAgICog\nRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nZ2V0Rm9yZWlnbktleXMoKSB7CiAgICAgICAgcmV0dXJuIF9ma3M7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGZvcmVpZ24ga2V5cyBvbiBleGlz\ndGluZyB0YWJsZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVkLgogICAgICogRGVm\nYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Rm9y\nZWlnbktleXMoYm9vbGVhbiBma3MpIHsKICAgICAgICBfZmtzID0gZmtzOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBwcmltYXJ5IGtleXMgb24g\nZXhpc3RpbmcgdGFibGVzIHNob3VsZCBiZSBtYW5pcHVsYXRlZC4KICAgICAq\nIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGdldFByaW1hcnlLZXlzKCkgewogICAgICAgIHJldHVybiBfcGtzOwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciBwcmltYXJ5IGtleXMgb24gZXhp\nc3RpbmcgdGFibGVzIHNob3VsZCBiZSBtYW5pcHVsYXRlZC4KICAgICAqIERl\nZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFBy\naW1hcnlLZXlzKGJvb2xlYW4gcGtzKSB7CiAgICAgICAgX3BrcyA9IHBrczsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzdHJlYW0gdG8gd3JpdGUgdG8g\nZm9yIHRoZSBjcmVhdGlvbiBvZiBTUUwgc2NyaXB0cy4gSWYgdGhlCiAgICAg\nKiBzdHJlYW0gaXMgbm9uLW51bGwsIGFsbCBTUUwgd2lsbCBiZSB3cml0dGVu\nIHRvIHRoaXMgc3RyZWFtIHJhdGhlciB0aGFuCiAgICAgKiBleGVjdXRlZCBh\nZ2FpbnN0IHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHVibGljIFdyaXRl\nciBnZXRXcml0ZXIoKSB7CiAgICAgICAgcmV0dXJuIF93cml0ZXI7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgc3RyZWFtIHRvIHdyaXRlIHRvIGZvciB0\naGUgY3JlYXRpb24gb2YgU1FMIHNjcmlwdHMuIElmIHRoZQogICAgICogc3Ry\nZWFtIGlzIG5vbi1udWxsLCBhbGwgU1FMIHdpbGwgYmUgd3JpdHRlbiB0byB0\naGlzIHN0cmVhbSByYXRoZXIgdGhhbgogICAgICogZXhlY3V0ZWQgYWdhaW5z\ndCB0aGUgZGF0YWJhc2UuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFdy\naXRlcihXcml0ZXIgd3JpdGVyKSB7CiAgICAgICAgaWYgKHdyaXRlciA9PSBu\ndWxsKQogICAgICAgICAgICBfd3JpdGVyID0gbnVsbDsKICAgICAgICBlbHNl\nIGlmICh3cml0ZXIgaW5zdGFuY2VvZiBQcmludFdyaXRlcikKICAgICAgICAg\nICAgX3dyaXRlciA9IChQcmludFdyaXRlcikgd3JpdGVyOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgX3dyaXRlciA9IG5ldyBQcmludFdyaXRlcih3cml0\nZXIpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzY2hlbWEg\nZ3JvdXAgdGhlIHRvb2wgd2lsbCBhY3Qgb24uCiAgICAgKi8KICAgIHB1Ymxp\nYyBTY2hlbWFHcm91cCBnZXRTY2hlbWFHcm91cCgpIHsKICAgICAgICByZXR1\ncm4gX2dyb3VwOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBzY2hl\nbWEgZ3JvdXAgdGhlIHRvb2wgd2lsbCBhY3Qgb24uCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldFNjaGVtYUdyb3VwKFNjaGVtYUdyb3VwIGdyb3VwKSB7\nCiAgICAgICAgX2dyb3VwID0gZ3JvdXA7CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8KICAgIC8vIEFjdGlvbnMKICAgIC8vLy8vLy8vLy8vCgogICAgLyoqCiAg\nICAgKiBSdW4gdGhlIHRvb2wgYWN0aW9uLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBydW4oKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmIChfYWN0aW9uID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgaWYgKEFDVElPTl9BREQuZXF1YWxzKF9hY3Rpb24pKQogICAg\nICAgICAgICBhZGQoKTsKICAgICAgICBlbHNlIGlmIChBQ1RJT05fRFJPUC5l\ncXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAgIGRyb3AoKTsKICAgICAgICBl\nbHNlIGlmIChBQ1RJT05fUkVUQUlOLmVxdWFscyhfYWN0aW9uKSkKICAgICAg\nICAgICAgcmV0YWluKCk7CiAgICAgICAgZWxzZSBpZiAoQUNUSU9OX1JFRlJF\nU0guZXF1YWxzKF9hY3Rpb24pKQogICAgICAgICAgICByZWZyZXNoKCk7CiAg\nICAgICAgZWxzZSBpZiAoQUNUSU9OX0JVSUxELmVxdWFscyhfYWN0aW9uKSkK\nICAgICAgICAgICAgYnVpbGQoKTsKICAgICAgICBlbHNlIGlmIChBQ1RJT05f\nQ1JFQVRFREIuZXF1YWxzKF9hY3Rpb24pKQogICAgICAgICAgICBjcmVhdGVE\nQigpOwogICAgICAgIGVsc2UgaWYgKEFDVElPTl9EUk9QREIuZXF1YWxzKF9h\nY3Rpb24pKQogICAgICAgICAgICBkcm9wREIoKTsKICAgICAgICBlbHNlIGlm\nIChBQ1RJT05fREVMRVRFX1RBQkxFX0NPTlRFTlRTLmVxdWFscyhfYWN0aW9u\nKSkKICAgICAgICAgICAgZGVsZXRlVGFibGVDb250ZW50cygpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkcyBhbnkgY29tcG9uZW50cyBwcmVzZW50IGlu\nIHRoZSBzY2hlbWEgcmVwb3NpdG9yeSBidXQgYWJzZW50IGZyb20KICAgICAq\nIHRoZSBkYXRhYmFzZS4gUGFja2FnZS1wcml2YXRlIGZvciB0ZXN0aW5nLgog\nICAgICovCiAgICB2b2lkIGFkZCgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgYWRkKGdldERCU2NoZW1hR3JvdXAoZmFsc2UpLCBh\nc3NlcnRTY2hlbWFHcm91cCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERy\nb3BzIGFsbCBzY2hlbWEgY29tcG9uZW50cyBpbiB0aGUgc2NoZW1hIHJlcG9z\naXRvcnkgdGhhdCBhbHNvIGV4aXN0CiAgICAgKiBpbiB0aGUgZGF0YWJhc2Uu\nIFBhY2thZ2UtcHJpdmF0ZSBmb3IgdGVzdGluZy4KICAgICAqLwogICAgdm9p\nZCBkcm9wKCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBkcm9wKGdldERCU2NoZW1hR3JvdXAoZmFsc2UpLCBhc3NlcnRTY2hlbWFH\ncm91cCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERyb3BzIGRhdGFiYXNl\nIGNvbXBvbmVudHMgdGhhdCBhcmUgbm90IG1lbnRpb25lZCBpbiB0aGUgc2No\nZW1hCiAgICAgKiByZXBvc2l0b3J5LiBQYWNrYWdlLXByaXZhdGUgZm9yIHRl\nc3RpbmcuCiAgICAgKi8KICAgIHZvaWQgcmV0YWluKCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXRhaW4oZ2V0REJTY2hlbWFH\ncm91cCh0cnVlKSwgYXNzZXJ0U2NoZW1hR3JvdXAoKSwKICAgICAgICAgICAg\nZ2V0RHJvcFRhYmxlcygpLCBnZXREcm9wU2VxdWVuY2VzKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkcyBhbnkgY29tcG9uZW50cyBwcmVzZW50IGlu\nIHRoZSBzY2hlbWEgcmVwb3NpdG9yeSBidXQgYWJzZW50IGZyb20KICAgICAq\nIHRoZSBkYXRhYmFzZSwgYW5kIGRyb3BzIHVudXNlZCBkYXRhYmFzZSBjb21w\nb25lbnRzLgogICAgICogUGFja2FnZS1wcml2YXRlIGZvciB0ZXN0aW5nLgog\nICAgICovCiAgICB2b2lkIHJlZnJlc2goKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIFNjaGVtYUdyb3VwIGxvY2FsID0gYXNzZXJ0\nU2NoZW1hR3JvdXAoKTsKICAgICAgICBTY2hlbWFHcm91cCBkYiA9IGdldERC\nU2NoZW1hR3JvdXAodHJ1ZSk7CiAgICAgICAgcmV0YWluKGRiLCBsb2NhbCwg\nZ2V0RHJvcFRhYmxlcygpLCBnZXREcm9wU2VxdWVuY2VzKCkpOwogICAgICAg\nIGFkZChkYiwgbG9jYWwpOwogICAgfQoKICAgIC8qKgogICAgICogUmUtZXhl\nY3V0ZSBhbGwgU1FMIHVzZWQgZm9yIHRoZSBjcmVhdGlvbiBvZiB0aGUgY3Vy\ncmVudCBkYXRhYmFzZTsKICAgICAqIHRoaXMgYWN0aW9uIGlzIHVzdWFsbHkg\ndXNlZCB3aGVuIGNyZWF0aW5nIFNRTCBzY3JpcHRzLgogICAgICogUGFja2Fn\nZS1wcml2YXRlIGZvciB0ZXN0aW5nLgogICAgICovCiAgICB2b2lkIGNyZWF0\nZURCKCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBT\nY2hlbWFHcm91cCBncm91cCA9IG5ldyBTY2hlbWFHcm91cCgpOwogICAgICAg\nIGdyb3VwLmFkZFNjaGVtYSgpOwogICAgICAgIGFkZChncm91cCwgZ2V0REJT\nY2hlbWFHcm91cCh0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZS1l\neGVjdXRlIGFsbCBTUUwgdXNlZCBmb3IgdGhlIGNyZWF0aW9uIG9mIHRoZSBj\ndXJyZW50IGRhdGFiYXNlOwogICAgICogdGhpcyBhY3Rpb24gaXMgdXN1YWxs\neSB1c2VkIHdoZW4gY3JlYXRpbmcgU1FMIHNjcmlwdHMuCiAgICAgKiBQYWNr\nYWdlLXByaXZhdGUgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHZvaWQgYnVp\nbGQoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNj\naGVtYUdyb3VwIGdyb3VwID0gbmV3IFNjaGVtYUdyb3VwKCk7CiAgICAgICAg\nZ3JvdXAuYWRkU2NoZW1hKCk7CiAgICAgICAgYWRkKGdyb3VwLCBhc3NlcnRT\nY2hlbWFHcm91cCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERyb3AgdGhl\nIGN1cnJlbnQgZGF0YWJhc2UuIFBhY2thZ2UtcHJpdmF0ZSBmb3IgdGVzdGlu\nZy4KICAgICAqLwogICAgdm9pZCBkcm9wREIoKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldGFpbihnZXREQlNjaGVtYUdyb3Vw\nKHRydWUpLCBuZXcgU2NoZW1hR3JvdXAoKSwgdHJ1ZSwgdHJ1ZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBJc3N1ZSBERUxFVEUgc3RhdGVtZW50IGFnYWlu\nc3QgYWxsIGtub3duIHRhYmxlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGRlbGV0ZVRhYmxlQ29udGVudHMoKSAKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBTY2hlbWFHcm91cCBncm91cCA9IGdldFNjaGVt\nYUdyb3VwKCk7CiAgICAgICAgU2NoZW1hW10gc2NoZW1hcyA9IGdyb3VwLmdl\ndFNjaGVtYXMoKTsKICAgICAgICBDb2xsZWN0aW9uIHRhYmxlcyA9IG5ldyBM\naW5rZWRIYXNoU2V0KCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\nY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFRhYmxlW10gdHMg\nPSBzY2hlbWFzW2ldLmdldFRhYmxlcygpOwogICAgICAgICAgICBmb3IgKGlu\ndCBqID0gMDsgaiA8IHRzLmxlbmd0aDsgaisrKQogICAgICAgICAgICAgICAg\ndGFibGVzLmFkZCh0c1tqXSk7CiAgICAgICAgfQogICAgICAgIFRhYmxlW10g\ndGFibGVBcnJheSA9IChUYWJsZVtdKSB0YWJsZXMudG9BcnJheShuZXcgVGFi\nbGVbdGFibGVzLnNpemUoKV0pOwogICAgICAgIFN0cmluZ1tdIHNxbCA9IF9j\nb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCkKICAgICAgICAgICAgLmdl\ndERlbGV0ZVRhYmxlQ29udGVudHNTUUwodGFibGVBcnJheSk7CiAgICAgICAg\naWYgKCFleGVjdXRlU1FMKHNxbCkpCiAgICAgICAgICAgIF9sb2cud2Fybihf\nbG9jLmdldCgiZGVsZXRlLXRhYmxlLWNvbnRlbnRzIikpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVjb3JkIHRoZSBjaGFuZ2VzIG1hZGUgdG8gdGhlIERC\nIGluIHRoZSBjdXJyZW50IHtAbGluayBTY2hlbWFGYWN0b3J5fS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgcmVjb3JkKCkgewogICAgICAgIGlmIChfZGIg\nIT0gbnVsbCAmJiBfd3JpdGVyID09IG51bGwpCiAgICAgICAgICAgIF9jb25m\nLmdldFNjaGVtYUZhY3RvcnlJbnN0YW5jZSgpLnN0b3JlU2NoZW1hKF9kYik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGFsbCBkYXRhYmFzZSBjb21w\nb25lbnRzIGluIHRoZSByZXBvc2l0b3J5IHNjaGVtYSB0aGF0IGFyZSBub3QK\nICAgICAqIHByZXNlbnQgaW4gdGhlIGdpdmVuIGRhdGFiYXNlIHNjaGVtYSB0\nbyB0aGUgZGF0YWJhc2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGQo\nU2NoZW1hR3JvdXAgZGIsIFNjaGVtYUdyb3VwIHJlcG9zKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGFkZCBzZXF1ZW5jZXMK\nICAgICAgICBTY2hlbWFbXSBzY2hlbWFzID0gcmVwb3MuZ2V0U2NoZW1hcygp\nOwogICAgICAgIFNjaGVtYSBzY2hlbWE7CiAgICAgICAgaWYgKF9zZXFzKSB7\nCiAgICAgICAgICAgIFNlcXVlbmNlW10gc2VxczsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBzZXFzID0gc2NoZW1hc1tpXS5nZXRTZXF1ZW5jZXMoKTsK\nICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgc2Vxcy5sZW5n\ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIGlmIChkYi5maW5kU2Vx\ndWVuY2Uoc2NoZW1hc1tpXSwgc2Vxc1tqXS5nZXRGdWxsTmFtZSgpKSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICAgICAgaWYgKGNyZWF0ZVNlcXVlbmNlKHNlcXNbal0pKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYSA9IGRiLmdldFNjaGVt\nYShzZXFzW2pdLmdldFNjaGVtYU5hbWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChzY2hlbWEgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHNjaGVtYSA9IGRiLmFkZFNjaGVtYShzZXFzW2pdLmdldFNj\naGVtYU5hbWUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYS5p\nbXBvcnRTZXF1ZW5jZShzZXFzW2pdKTsKICAgICAgICAgICAgICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2Mu\nZ2V0KCJhZGQtc2VxIiwgc2Vxc1tqXSkpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBvcmRlciBpcyBp\nbXBvcnRhbnQgaW4gdGhpcyBtZXRob2Q7IHN0YXJ0IHdpdGggY29sdW1ucwog\nICAgICAgIFRhYmxlW10gdGFiczsKICAgICAgICBUYWJsZSBkYlRhYmxlOwog\nICAgICAgIENvbHVtbltdIGNvbHM7CiAgICAgICAgQ29sdW1uIGNvbDsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7\nCiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdGFicy5sZW5ndGg7\nIGorKykgewogICAgICAgICAgICAgICAgY29scyA9IHRhYnNbal0uZ2V0Q29s\ndW1ucygpOwogICAgICAgICAgICAgICAgZGJUYWJsZSA9IGRiLmZpbmRUYWJs\nZShzY2hlbWFzW2ldLCB0YWJzW2pdLmdldEZ1bGxOYW1lKCkpOwogICAgICAg\nICAgICAgICAgZm9yIChpbnQgayA9IDA7IGsgPCBjb2xzLmxlbmd0aDsgaysr\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRiVGFibGUgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSBkYlRhYmxlLmdldENv\nbHVtbihjb2xzW2tdLmdldE5hbWUoKSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChjb2wgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGFkZENvbHVtbihjb2xzW2tdKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBkYlRhYmxlLmltcG9ydENvbHVtbihjb2xzW2td\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImFk\nZC1jb2wiLCBjb2xzW2tdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB0YWJzW2pdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0g\nZWxzZSBpZiAoIWNvbHNba10uZXF1YWxzQ29sdW1uKGNvbCkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYmFk\nLWNvbCIsIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBjb2wsIGRiVGFibGUsIGNvbC5nZXREZXNjcmlwdGlvbigpLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHNba10uZ2V0RGVz\nY3JpcHRpb24oKSB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHByaW1hcnkga2V5cwogICAg\nICAgIGlmIChfcGtzKSB7CiAgICAgICAgICAgIFByaW1hcnlLZXkgcGs7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNbaV0uZ2V0\nVGFibGVzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8\nIHRhYnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBwayA9\nIHRhYnNbal0uZ2V0UHJpbWFyeUtleSgpOwogICAgICAgICAgICAgICAgICAg\nIGRiVGFibGUgPSBkYi5maW5kVGFibGUoc2NoZW1hc1tpXSwgdGFic1tqXS5n\nZXRGdWxsTmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGsgIT0g\nbnVsbCAmJiAhcGsuaXNMb2dpY2FsKCkgJiYgZGJUYWJsZSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYlRhYmxlLmdldFByaW1h\ncnlLZXkoKSA9PSBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAm\nJiBhZGRQcmltYXJ5S2V5KHBrKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGRiVGFibGUuaW1wb3J0UHJpbWFyeUtleShwayk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGVsc2UgaWYgKGRiVGFibGUuZ2V0UHJpbWFyeUtleSgp\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9nLndh\ncm4oX2xvYy5nZXQoImFkZC1wayIsIHBrLCB0YWJzW2pdKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFway5lcXVhbHNQcmltYXJ5S2V5\nKGRiVGFibGUuZ2V0UHJpbWFyeUtleSgpKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYmFkLXBrIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBkYlRhYmxlLmdldFByaW1hcnlL\nZXkoKSwgZGJUYWJsZSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nLy8gdGFibGVzCiAgICAgICAgU2V0IG5ld1RhYmxlcyA9IG5ldyBIYXNoU2V0\nKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRh\nYmxlcygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHRhYnMu\nbGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIGlmIChkYi5maW5kVGFi\nbGUoc2NoZW1hc1tpXSwgdGFic1tqXS5nZXRGdWxsTmFtZSgpKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nICAgIGlmIChjcmVhdGVUYWJsZSh0YWJzW2pdKSkgewogICAgICAgICAgICAg\nICAgICAgIG5ld1RhYmxlcy5hZGQodGFic1tqXSk7CiAgICAgICAgICAgICAg\nICAgICAgc2NoZW1hID0gZGIuZ2V0U2NoZW1hKHRhYnNbal0uZ2V0U2NoZW1h\nTmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYSA9IGRiLmFkZFNj\naGVtYSh0YWJzW2pdLmdldFNjaGVtYU5hbWUoKSk7CiAgICAgICAgICAgICAg\nICAgICAgc2NoZW1hLmltcG9ydFRhYmxlKHRhYnNbal0pOwogICAgICAgICAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9s\nb2MuZ2V0KCJhZGQtdGFibGUiLCB0YWJzW2pdKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8vIGluZGV4ZXMKICAgICAgICBJbmRleFtd\nIGlkeHM7CiAgICAgICAgSW5kZXggaWR4OwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0\nYWJzID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAg\nICAgICAgICAvLyBjcmVhdGUgaW5kZXhlcyBvbiBuZXcgdGFibGVzIGV2ZW4g\naWYgaW5kZXhlcwogICAgICAgICAgICAgICAgLy8gaGF2ZSBiZWVuIHR1cm5l\nZCBvZmYKICAgICAgICAgICAgICAgIGlmICghX2luZGV4ZXMgJiYgIW5ld1Rh\nYmxlcy5jb250YWlucyh0YWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICBpZHhzID0gdGFic1tqXS5nZXRJ\nbmRleGVzKCk7CiAgICAgICAgICAgICAgICBkYlRhYmxlID0gZGIuZmluZFRh\nYmxlKHNjaGVtYXNbaV0sIHRhYnNbal0uZ2V0RnVsbE5hbWUoKSk7CiAgICAg\nICAgICAgICAgICBmb3IgKGludCBrID0gMDsgayA8IGlkeHMubGVuZ3RoOyBr\nKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGJUYWJsZSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkeCA9IGZpbmRJbmRleChk\nYlRhYmxlLCBpZHhzW2tdKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGlkeCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoY3JlYXRlSW5kZXgoaWR4c1trXSwgZGJUYWJsZSkpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZGJUYWJsZS5pbXBvcnRJbmRleChpZHhz\nW2tdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQo\nImFkZC1pbmRleCIsIGlkeHNba10sCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHRhYnNbal0pKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlIGlmICghaWR4c1trXS5lcXVhbHNJbmRleChpZHgpKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJi\nYWQtaW5kZXgiLCBpZHgsIGRiVGFibGUpKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIC8vIFVuaXF1ZSBDb25zdHJhaW50cyBvbiBncm91cCBvZiBj\nb2x1bW5zCiAgICAgICAgVW5pcXVlW10gdW5pcXVlczsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgdGFicyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAg\nICAgIGZvciAoaW50IGogPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewog\nICAgICAgICAgICAgICAgLy8gY3JlYXRlIHVuaXF1ZSBjb25zdHJhaW50cyBv\nbmx5IG9uIG5ldyB0YWJsZXMgCiAgICAgICAgICAgICAgICBpZiAoIW5ld1Rh\nYmxlcy5jb250YWlucyh0YWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICB1bmlxdWVzID0gdGFic1tqXS5n\nZXRVbmlxdWVzKCk7CiAgICAgICAgICAgICAgICBpZiAodW5pcXVlcyA9PSBu\ndWxsIHx8IHVuaXF1ZXMubGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgICAgICBkYlRhYmxlID0gZGIuZmlu\nZFRhYmxlKHRhYnNbal0pOwogICAgICAgICAgICAgICAgaWYgKGRiVGFibGUg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwgdW5pcXVlcy5sZW5ndGg7\nIGsrKykgewogICAgICAgICAgICAgICAgICAgIGRiVGFibGUuaW1wb3J0VW5p\ncXVlKHVuaXF1ZXNba10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGZvcmVpZ24ga2V5\ncwogICAgICAgIEZvcmVpZ25LZXlbXSBma3M7CiAgICAgICAgRm9yZWlnbktl\neSBmazsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNbaV0uZ2V0\nVGFibGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdGFi\ncy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgLy8gY3JlYXRlIGZv\ncmVpZ24ga2V5cyBvbiBuZXcgdGFibGVzIGV2ZW4gaWYgZmtzCiAgICAgICAg\nICAgICAgICAvLyBoYXZlIGJlZW4gdHVybmVkIG9mZgogICAgICAgICAgICAg\nICAgaWYgKCFfZmtzICYmICFuZXdUYWJsZXMuY29udGFpbnModGFic1tqXSkp\nCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAg\nICAgZmtzID0gdGFic1tqXS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgICAg\nICAgICAgZGJUYWJsZSA9IGRiLmZpbmRUYWJsZShzY2hlbWFzW2ldLHRhYnNb\nal0uZ2V0RnVsbE5hbWUoKSk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBr\nID0gMDsgayA8IGZrcy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAg\nICAgIGlmICghZmtzW2tdLmlzTG9naWNhbCgpICYmIGRiVGFibGUgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgICAgICBmayA9IGZpbmRGb3JlaWdu\nS2V5KGRiVGFibGUsIGZrc1trXSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChmayA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoYWRkRm9yZWlnbktleShma3Nba10pKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGRiVGFibGUuaW1wb3J0Rm9yZWlnbktleShma3Nb\na10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgi\nYWRkLWZrIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZmtzW2tdLCB0YWJzW2pdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0g\nZWxzZSBpZiAoIWZrc1trXS5lcXVhbHNGb3JlaWduS2V5KGZrKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYmFk\nLWZrIiwgZmssIGRiVGFibGUpKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBEcm9wcyBhbGwgZGF0YWJhc2UgY29tcG9uZW50\ncyB0aGF0IGFyZSBpbiB0aGUgZ2l2ZW4gZGF0YWJhc2Ugc2NoZW1hCiAgICAg\nKiBidXQgbm90IGluIHRoZSByZXBvc2l0b3J5IHNjaGVtYS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJldGFpbihTY2hlbWFHcm91cCBkYiwgU2NoZW1h\nR3JvdXAgcmVwb3MsIGJvb2xlYW4gdGFibGVzLAogICAgICAgIGJvb2xlYW4g\nc2VxdWVuY2VzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIFNjaGVtYVtdIHNjaGVtYXMgPSBkYi5nZXRTY2hlbWFzKCk7CiAgICAg\nICAgaWYgKF9zZXFzICYmIHNlcXVlbmNlcykgewogICAgICAgICAgICBTZXF1\nZW5jZVtdIHNlcXM7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgc2VxcyA9\nIHNjaGVtYXNbaV0uZ2V0U2VxdWVuY2VzKCk7CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBqID0gMDsgaiA8IHNlcXMubGVuZ3RoOyBqKyspIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAoIWlzRHJvcHBhYmxlKHNlcXNbal0pKQogICAg\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAg\nICAgICBpZiAocmVwb3MuZmluZFNlcXVlbmNlKHNlcXNbal0pID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRyb3BTZXF1ZW5jZShz\nZXFzW2pdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYXNb\naV0ucmVtb3ZlU2VxdWVuY2Uoc2Vxc1tqXSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cu\nd2FybihfbG9jLmdldCgiZHJvcC1zZXEiLCBzZXFzW2pdKSk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyBvcmRlciBpcyBpbXBvcnRhbnQgaW4g\ndGhpcyBtZXRob2Q7IHN0YXJ0IHdpdGggZm9yZWlnbiBrZXlzCiAgICAgICAg\nVGFibGVbXSB0YWJzOwogICAgICAgIFRhYmxlIHJlcG9zVGFibGU7CiAgICAg\nICAgaWYgKF9ma3MpIHsKICAgICAgICAgICAgRm9yZWlnbktleVtdIGZrczsK\nICAgICAgICAgICAgRm9yZWlnbktleSBmazsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdGFicy5sZW5ndGg7IGor\nKykgewogICAgICAgICAgICAgICAgICAgIGlmICghaXNEcm9wcGFibGUodGFi\nc1tqXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAg\nICAgICAgICAgICAgICAgIGZrcyA9IHRhYnNbal0uZ2V0Rm9yZWlnbktleXMo\nKTsKICAgICAgICAgICAgICAgICAgICByZXBvc1RhYmxlID0gcmVwb3MuZmlu\nZFRhYmxlKHRhYnNbal0pOwogICAgICAgICAgICAgICAgICAgIGlmICghdGFi\nbGVzICYmIHJlcG9zVGFibGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIGZvciAoaW50\nIGsgPSAwOyBrIDwgZmtzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChma3Nba10uaXNMb2dpY2FsKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZrID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHJlcG9zVGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGZrID0gZmluZEZvcmVpZ25LZXkocmVwb3NUYWJsZSwgZmtzW2tdKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcG9zVGFibGUgPT0gbnVs\nbCB8fCBmayA9PSBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB8\nfCAhZmtzW2tdLmVxdWFsc0ZvcmVpZ25LZXkoZmspKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoZHJvcEZvcmVpZ25LZXkoZmtzW2tdKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJzW2pdLnJlbW92\nZUZvcmVpZ25LZXkoZmtzW2tdKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9n\nLndhcm4oX2xvYy5nZXQoImRyb3AtZmsiLCBma3Nba10sCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHRhYnNbal0pKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nLy8gcHJpbWFyeSBrZXlzCiAgICAgICAgaWYgKF9wa3MpIHsKICAgICAgICAg\nICAgUHJpbWFyeUtleSBwazsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0\nYWJzID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGogPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewogICAg\nICAgICAgICAgICAgICAgIGlmICghaXNEcm9wcGFibGUodGFic1tqXSkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAg\nICAgICAgIHBrID0gdGFic1tqXS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHBrICE9IG51bGwgJiYgcGsuaXNMb2dpY2FsKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgICAgICAgICByZXBvc1RhYmxlID0gcmVwb3MuZmluZFRhYmxlKHRhYnNb\nal0pOwogICAgICAgICAgICAgICAgICAgIGlmIChwayAhPSBudWxsICYmIHJl\ncG9zVGFibGUgIT0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAmJiAo\ncmVwb3NUYWJsZS5nZXRQcmltYXJ5S2V5KCkgPT0gbnVsbAogICAgICAgICAg\nICAgICAgICAgICAgICB8fCAhcGsuZXF1YWxzUHJpbWFyeUtleShyZXBvc1Rh\nYmxlLmdldFByaW1hcnlLZXkoKSkpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChkcm9wUHJpbWFyeUtleShwaykpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB0YWJzW2pdLnJlbW92ZVByaW1hcnlLZXkoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkcm9wLXBrIiwgcGssIHRhYnNb\nal0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNvbHVtbnMK\nICAgICAgICBDb2x1bW5bXSBjb2xzOwogICAgICAgIENvbHVtbiBjb2w7CiAg\nICAgICAgQ29sbGVjdGlvbiBkcm9wcyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygp\nOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHRhYnMubGVuZ3Ro\nOyBqKyspIHsKICAgICAgICAgICAgICAgIGlmICghaXNEcm9wcGFibGUodGFi\nc1tqXSkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgICAgICBjb2xzID0gdGFic1tqXS5nZXRDb2x1bW5zKCk7CiAgICAgICAg\nICAgICAgICByZXBvc1RhYmxlID0gcmVwb3MuZmluZFRhYmxlKHRhYnNbal0p\nOwogICAgICAgICAgICAgICAgaWYgKHJlcG9zVGFibGUgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwgY29scy5s\nZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSBy\nZXBvc1RhYmxlLmdldENvbHVtbihjb2xzW2tdLmdldE5hbWUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChjb2wgPT0gbnVsbCB8fCAhY29sc1tr\nXS5lcXVhbHNDb2x1bW4oY29sKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKHRhYnNbal0uZ2V0Q29sdW1ucygpLmxlbmd0aCA9PSAxKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BzLmFkZCh0YWJz\nW2pdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRy\nb3BDb2x1bW4oY29sc1trXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdGFic1tqXS5yZW1vdmVDb2x1bW4oY29sc1trXSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkcm9wLWNvbCIsIGNv\nbHNba10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRh\nYnNbal0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLy8gbm93IHRhYmxlcwogICAgICAgIGlmICh0\nYWJsZXMpIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hl\nbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YWJzID0gc2No\nZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50\nIGogPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykKICAgICAgICAgICAgICAg\nICAgICBpZiAoISFpc0Ryb3BwYWJsZSh0YWJzW2pdKQogICAgICAgICAgICAg\nICAgICAgICAgICAmJiByZXBvcy5maW5kVGFibGUodGFic1tqXSkgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgZHJvcHMuYWRkKHRhYnNbal0p\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRyb3BUYWJsZXMo\nZHJvcHMsIGRiKTsKICAgIH0KCiAgICAvKioKICAgICAqIERyb3BzIGFsbCBk\nYXRhYmFzZSBjb21wb25lbnRzIGluIHRoZSBnaXZlbiByZXBvc2l0b3J5IHNj\naGVtYS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGRyb3AoU2NoZW1hR3Jv\ndXAgZGIsIFNjaGVtYUdyb3VwIHJlcG9zKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIC8vIGRyb3Agc2VxdWVuY2VzCiAgICAgICAg\nU2NoZW1hW10gc2NoZW1hcyA9IHJlcG9zLmdldFNjaGVtYXMoKTsKICAgICAg\nICBpZiAoX3NlcXMpIHsKICAgICAgICAgICAgU2VxdWVuY2VbXSBzZXFzOwog\nICAgICAgICAgICBTZXF1ZW5jZSBkYlNlcTsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgICAgICBzZXFzID0gc2NoZW1hc1tpXS5nZXRTZXF1ZW5jZXMoKTsKICAg\nICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgc2Vxcy5sZW5ndGg7\nIGorKykgewogICAgICAgICAgICAgICAgICAgIGlmICghaXNEcm9wcGFibGUo\nc2Vxc1tqXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICAgICAgICAgIGRiU2VxID0gZGIuZmluZFNlcXVlbmNlKHNl\ncXNbal0pOwogICAgICAgICAgICAgICAgICAgIGlmIChkYlNlcSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkcm9wU2VxdWVuY2Uo\nc2Vxc1tqXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYlNlcS5n\nZXRTY2hlbWEoKS5yZW1vdmVTZXF1ZW5jZShkYlNlcSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIF9sb2cud2FybihfbG9jLmdldCgiZHJvcC1zZXEiLCBzZXFzW2pdKSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjYWxjdWxhdGUgdGFibGVz\nIHRvIGRyb3A7IHdlIGNhbiBvbmx5IGRyb3AgdGFibGVzIGlmIHdlJ3JlIHN1\ncmUKICAgICAgICAvLyB0aGUgdXNlciBsaXN0ZWQgdGhlIGVudGlyZSB0YWJs\nZSBkZWZpbml0aW9uIGluIHRoZSBzdHVmZiB0aGV5IHdhbnQKICAgICAgICAv\nLyBkcm9wcGVkOyBlbHNlIHRoZXkgbWlnaHQganVzdCB3YW50IHRvIGRyb3Ag\nYSBmZXcgY29sdW1ucwogICAgICAgIENvbGxlY3Rpb24gZHJvcHMgPSBuZXcg\nTGlua2VkTGlzdCgpOwogICAgICAgIFRhYmxlW10gdGFiczsKICAgICAgICBU\nYWJsZSBkYlRhYmxlOwogICAgICAgIENvbHVtbltdIGRiQ29sczsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAg\nICAgICAgICAgIHRhYmxlczoKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7\nIGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBpZiAo\nIWlzRHJvcHBhYmxlKHRhYnNbal0pKQogICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICAgICAgZGJUYWJsZSA9IGRiLmZpbmRUYWJs\nZSh0YWJzW2pdKTsKICAgICAgICAgICAgICAgIGlmIChkYlRhYmxlID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAg\nICAgICAgZGJDb2xzID0gZGJUYWJsZS5nZXRDb2x1bW5zKCk7CiAgICAgICAg\nICAgICAgICBmb3IgKGludCBrID0gMDsgayA8IGRiQ29scy5sZW5ndGg7IGsr\nKykKICAgICAgICAgICAgICAgICAgICBpZiAodGFic1tqXS5nZXRDb2x1bW4o\nZGJDb2xzW2tdLmdldE5hbWUoKSkgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgY29udGludWUgdGFibGVzOwoKICAgICAgICAgICAgICAgIGRy\nb3BzLmFkZCh0YWJzW2pdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gb3JkZXIgaXMgaW1wb3J0YW50IGluIHRoaXMgbWV0aG9kOyBz\ndGFydCB3aXRoIGZvcmVpZ24ga2V5cyBtZW50aW9uZWQKICAgICAgICAvLyBp\nbiB0aGUgZHJvcCBzY2hlbWEKICAgICAgICBpZiAoX2ZrcykgewogICAgICAg\nICAgICBGb3JlaWduS2V5W10gZmtzOwogICAgICAgICAgICBGb3JlaWduS2V5\nIGZrOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRhYnMgPSBzY2hlbWFz\nW2ldLmdldFRhYmxlcygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9\nIDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKCFpc0Ryb3BwYWJsZSh0YWJzW2pdKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgZmtzID0g\ndGFic1tqXS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgICAgICAgICAgICAg\nIGRiVGFibGUgPSBkYi5maW5kVGFibGUodGFic1tqXSk7CiAgICAgICAgICAg\nICAgICAgICAgZm9yIChpbnQgayA9IDA7IGsgPCBma3MubGVuZ3RoOyBrKysp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZrc1trXS5pc0xvZ2lj\nYWwoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgICAgICAgICAgICAgZmsgPSBudWxsOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoZGJUYWJsZSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZmsgPSBmaW5kRm9yZWlnbktleShkYlRhYmxl\nLCBma3Nba10pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGJUYWJs\nZSA9PSBudWxsIHx8IGZrID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChkcm9wRm9yZWlnbktleShma3Nba10pKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKGRiVGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBkYlRhYmxlLnJlbW92ZUZvcmVpZ25LZXkoZmsp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHJv\ncC1mayIsIGZrc1trXSwgdGFic1tqXSkpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gYWxzbyBkcm9wIGltcG9ydGVkIGZvcmVpZ24ga2V5cyBmb3IgdGFi\nbGVzIHRoYXQgd2lsbCBiZSBkcm9wcGVkCiAgICAgICAgICAgIFRhYmxlIHRh\nYjsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBkcm9wcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdGFi\nID0gKFRhYmxlKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgZGJUYWJs\nZSA9IGRiLmZpbmRUYWJsZSh0YWIpOwogICAgICAgICAgICAgICAgaWYgKGRi\nVGFibGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgICAgICBma3MgPSBkYi5maW5kRXhwb3J0ZWRGb3JlaWdu\nS2V5cyhkYlRhYmxlLmdldFByaW1hcnlLZXkoKSk7CiAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZrcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgICAgIGlmIChkcm9wRm9yZWlnbktleShma3NbaV0pKQog\nICAgICAgICAgICAgICAgICAgICAgICBkYlRhYmxlLnJlbW92ZUZvcmVpZ25L\nZXkoZmtzW2ldKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHJvcC1mayIs\nIGZrc1tpXSwgZGJUYWJsZSkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBkcm9wIHRoZSB0YWJsZXMg\nd2UgY2FsY3VsYXRlZCBhYm92ZQogICAgICAgIGRyb3BUYWJsZXMoZHJvcHMs\nIGRiKTsKCiAgICAgICAgLy8gY29sdW1ucwogICAgICAgIENvbHVtbltdIGNv\nbHM7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFi\ncyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgIGZvciAo\naW50IGogPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAg\nICAgICAgaWYgKCFpc0Ryb3BwYWJsZSh0YWJzW2pdKSkKICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbHMgPSB0YWJz\nW2pdLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgICAgIGRiVGFibGUgPSBk\nYi5maW5kVGFibGUodGFic1tqXSk7CiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBrID0gMDsgayA8IGNvbHMubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAg\nICAgICAgICBjb2wgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmIChk\nYlRhYmxlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9\nIGRiVGFibGUuZ2V0Q29sdW1uKGNvbHNba10uZ2V0TmFtZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAoZGJUYWJsZSA9PSBudWxsIHx8IGNvbCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICAgICAgaWYgKGRyb3BDb2x1bW4oY29sc1trXSkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKGRiVGFibGUgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUucmVtb3ZlQ29sdW1u\nKGNvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHJvcC1j\nb2wiLCBjb2xzW2tdLCB0YWJzW2pdKSk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIHRhYmxl\nIGlzIGRyb3BwYWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlz\nRHJvcHBhYmxlKFRhYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0dXJuIF9vcGVu\nanBhVGFibGVzCiAgICAgICAgICAgIHx8ICghdGFibGUuZ2V0TmFtZSgpLnRv\nVXBwZXJDYXNlKCkuc3RhcnRzV2l0aCgiT1BFTkpQQV8iKQogICAgICAgICAg\nICAmJiAhdGFibGUuZ2V0TmFtZSgpLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0\naCgiSkRPXyIpKTsgLy8gbGVnYWN5CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdHJ1ZSBpZiB0aGUgc2VxdWVuY2UgaXMgZHJvcHBhYmxlLgogICAg\nICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNEcm9wcGFibGUoU2VxdWVuY2Ug\nc2VxKSB7CiAgICAgICAgcmV0dXJuIF9vcGVuanBhVGFibGVzCiAgICAgICAg\nICAgIHx8ICghc2VxLmdldE5hbWUoKS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dp\ndGgoIk9QRU5KUEFfIikKICAgICAgICAgICAgJiYgIXNlcS5nZXROYW1lKCku\ndG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCJKRE9fIikpOyAvLyBsZWdhY3kK\nICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgYW4gaW5kZXggaW4gdGhlIGdp\ndmVuIHRhYmxlIHRoYXQgbWF0Y2hlcyB0aGUgZ2l2ZW4gb25lLgogICAgICov\nCiAgICBwcml2YXRlIEluZGV4IGZpbmRJbmRleChUYWJsZSBkYlRhYmxlLCBJ\nbmRleCBpZHgpIHsKICAgICAgICBJbmRleFtdIGlkeHMgPSBkYlRhYmxlLmdl\ndEluZGV4ZXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGlkeHMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChpZHguY29sdW1uc01hdGNo\nKGlkeHNbaV0uZ2V0Q29sdW1ucygpKSkKICAgICAgICAgICAgICAgIHJldHVy\nbiBpZHhzW2ldOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogRmluZCBhIGZvcmVpZ24ga2V5IGluIHRoZSBnaXZlbiB0YWJs\nZSB0aGF0IG1hdGNoZXMgdGhlIGdpdmVuIG9uZS4KICAgICAqLwogICAgcHJp\ndmF0ZSBGb3JlaWduS2V5IGZpbmRGb3JlaWduS2V5KFRhYmxlIGRiVGFibGUs\nIEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBpZiAoZmsuZ2V0Q29uc3RhbnRD\nb2x1bW5zKCkubGVuZ3RoID4gMAogICAgICAgICAgICB8fCBmay5nZXRDb25z\ndGFudFByaW1hcnlLZXlDb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9IGRi\nVGFibGUuZ2V0Rm9yZWlnbktleXMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZrcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGZrLmNv\nbHVtbnNNYXRjaChma3NbaV0uZ2V0Q29sdW1ucygpLAogICAgICAgICAgICAg\nICAgZmtzW2ldLmdldFByaW1hcnlLZXlDb2x1bW5zKCkpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIGZrc1tpXTsKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gY29sbGVjdGlv\nbiBvZiB0YWJsZXMgZnJvbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLiBPcmRlcnMK\nICAgICAqIHRoZSByZW1vdmFscyBhY2NvcmRpbmcgdG8gZm9yZWlnbiBrZXkg\nY29uc3RyYWludHMgb24gdGhlIHRhYmxlcy4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGRyb3BUYWJsZXMoQ29sbGVjdGlvbiB0YWJsZXMsIFNjaGVtYUdy\nb3VwIGNoYW5nZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAodGFibGVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBUYWJsZSB0YWJsZTsKICAgICAgICBUYWJsZSBjaGFuZ2VU\nYWJsZTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRhYmxlcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICB0YWJsZSA9\nIChUYWJsZSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGRyb3BUYWJs\nZSh0YWJsZSkpIHsKICAgICAgICAgICAgICAgIGNoYW5nZVRhYmxlID0gY2hh\nbmdlLmZpbmRUYWJsZSh0YWJsZSk7CiAgICAgICAgICAgICAgICBpZiAoY2hh\nbmdlVGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjaGFuZ2VU\nYWJsZS5nZXRTY2hlbWEoKS5yZW1vdmVUYWJsZShjaGFuZ2VUYWJsZSk7CiAg\nICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9s\nb2MuZ2V0KCJkcm9wLXRhYmxlIiwgdGFibGUpKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIHRhYmxlIHRvIHRoZSBk\nYXRhYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlm\nIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lz\nZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBjcmVhdGVUYWJsZShUYWJs\nZSB0YWJsZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXRDcmVhdGVUYWJsZVNRTCh0\nYWJsZSkpOwogICAgfQoKICAgIC8qKgogICAgICogRHJvcCB0aGUgZ2l2ZW4g\ndGFibGUgZnJvbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoKICAgICAq\nIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVs\nLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nZHJvcFRhYmxlKFRhYmxlIHRhYmxlKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0LmdldERy\nb3BUYWJsZVNRTCh0YWJsZSkpOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\nIHRoZSBnaXZlbiBzZXF1ZW5jZSB0byB0aGUgZGF0YWJhc2Ugc2NoZW1hLgog\nICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdh\ncyBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gY3JlYXRlU2VxdWVuY2UoU2VxdWVuY2Ugc2VxKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBleGVj\ndXRlU1FMKF9kaWN0LmdldENyZWF0ZVNlcXVlbmNlU1FMKHNlcSkpOwogICAg\nfQoKICAgIC8qKgogICAgICogRHJvcCB0aGUgZ2l2ZW4gc2VxdWVuY2UgZnJv\nbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoKICAgICAqIEByZXR1cm4g\ndHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBv\ndGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZHJvcFNlcXVl\nbmNlKFNlcXVlbmNlIHNlcSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXREcm9wU2Vx\ndWVuY2VTUUwoc2VxKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhl\nIGdpdmVuIGluZGV4IHRvIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKgog\nICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nl\nc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBjcmVhdGVJbmRleChJbmRleCBpZHgsIFRhYmxlIHRhYmxlKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIEluZm9ybWl4\nIHdpbGwgYXV0b21hdGljYWxseSBjcmVhdGUgYSB1bmlxdWUgaW5kZXggZm9y\nIHRoZSAKICAgICAgICAvLyBwcmltYXJ5IGtleSwgc28gZG9uJ3QgY3JlYXRl\nIGFub3RoZXIgaW5kZXggYWdhaW4KCiAgICAgICAgaWYgKCFfZGljdC5uZWVk\nc1RvQ3JlYXRlSW5kZXgoaWR4LHRhYmxlKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICBpbnQgbWF4ID0gX2RpY3QubWF4SW5kZXhlc1Bl\nclRhYmxlOwoKICAgICAgICBpbnQgbGVuID0gdGFibGUuZ2V0SW5kZXhlcygp\nLmxlbmd0aDsKICAgICAgICBpZiAodGFibGUuZ2V0UHJpbWFyeUtleSgpICE9\nIG51bGwpCiAgICAgICAgICAgIGxlbiArPSB0YWJsZS5nZXRQcmltYXJ5S2V5\nKCkuZ2V0Q29sdW1ucygpLmxlbmd0aDsKCiAgICAgICAgaWYgKGxlbiA+PSBt\nYXgpIHsKICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJ0b28tbWFu\neS1pbmRleGVzIiwgaWR4LCB0YWJsZSwgbWF4ICsgIiIpKTsKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGV4\nZWN1dGVTUUwoX2RpY3QuZ2V0Q3JlYXRlSW5kZXhTUUwoaWR4KSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBEcm9wIHRoZSBnaXZlbiBpbmRleCBmcm9tIHRo\nZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICogQHJldHVybiB0cnVl\nIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVy\nd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBkcm9wSW5kZXgoSW5k\nZXggaWR4KQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBleGVjdXRlU1FMKF9kaWN0LmdldERyb3BJbmRleFNRTChpZHgp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY29sdW1u\nIHRvIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICogQHJldHVy\nbiB0cnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNl\nIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBhZGRDb2x1\nbW4oQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXRBZGRDb2x1bW5T\nUUwoY29sKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEcm9wIHRoZSBnaXZl\nbiBjb2x1bW4gZnJvbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoKICAg\nICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNz\nZnVsLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gZHJvcENvbHVtbihDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0Lmdl\ndERyb3BDb2x1bW5TUUwoY29sKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgdGhlIGdpdmVuIHByaW1hcnkga2V5IHRvIHRoZSBkYXRhYmFzZSBzY2hl\nbWEuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRp\nb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBhZGRQcmltYXJ5S2V5KFByaW1hcnlLZXkgcGsp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIGV4ZWN1dGVTUUwoX2RpY3QuZ2V0QWRkUHJpbWFyeUtleVNRTChwaykpOwog\nICAgfQoKICAgIC8qKgogICAgICogRHJvcCB0aGUgZ2l2ZW4gcHJpbWFyeSBr\nZXkgZnJvbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoKICAgICAqIEBy\nZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLCBm\nYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZHJv\ncFByaW1hcnlLZXkoUHJpbWFyeUtleSBwaykKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5n\nZXREcm9wUHJpbWFyeUtleVNRTChwaykpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkIHRoZSBnaXZlbiBmb3JlaWduIGtleSB0byB0aGUgZGF0YWJhc2Ug\nc2NoZW1hLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3Bl\ncmF0aW9uIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gYWRkRm9yZWlnbktleShGb3JlaWduS2V5\nIGZrKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBleGVjdXRlU1FMKF9kaWN0LmdldEFkZEZvcmVpZ25LZXlTUUwoZmsp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIERyb3AgdGhlIGdpdmVuIGZvcmVp\nZ24ga2V5IGZyb20gdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqCiAgICAg\nKiBAcmV0dXJuIHRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1\nbCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGRyb3BGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmspCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGVTUUwoX2Rp\nY3QuZ2V0RHJvcEZvcmVpZ25LZXlTUUwoZmspKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICovCiAg\nICBwdWJsaWMgU2NoZW1hR3JvdXAgZ2V0REJTY2hlbWFHcm91cCgpIHsKICAg\nICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gZ2V0REJTY2hlbWFHcm91\ncCh0cnVlKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsK\nICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwg\nX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXREQlNjaGVtYUdyb3VwKFNjaGVtYUdyb3VwIGRiKSB7CiAgICAgICAgX2Ri\nID0gZGI7CiAgICAgICAgaWYgKGRiICE9IG51bGwpCiAgICAgICAgICAgIF9m\ndWxsREIgPSB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICogQHBhcmFtIGZ1bGwg\naWYgZmFsc2UsIG9ubHkgdGhlIHRhYmxlcyBuYW1lZCBpbiB0aGUgc2V0IHNj\naGVtYQogICAgICogcmVwb3NpdG9yeSB3aWxsIGJlIGdlbmVyYXRlZAogICAg\nICovCiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIGdldERCU2NoZW1hR3JvdXAo\nYm9vbGVhbiBmdWxsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmIChfZGIgPT0gbnVsbCB8fCAoZnVsbCAmJiAhX2Z1bGxEQikp\nIHsKICAgICAgICAgICAgU2NoZW1hR2VuZXJhdG9yIGdlbiA9IG5ldyBTY2hl\nbWFHZW5lcmF0b3IoX2NvbmYpOwogICAgICAgICAgICBnZW4uc2V0UHJpbWFy\neUtleXMoX3Brcyk7CiAgICAgICAgICAgIGdlbi5zZXRGb3JlaWduS2V5cyhf\nZmtzKTsKICAgICAgICAgICAgZ2VuLnNldEluZGV4ZXMoX2luZGV4ZXMpOwog\nICAgICAgICAgICBpZiAoZnVsbCkKICAgICAgICAgICAgICAgIGdlbi5nZW5l\ncmF0ZVNjaGVtYXMoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nICAgICAvLyBnZW5lcmF0ZSBvbmx5IHRoZSB0YWJsZXMgaW4gdGhlIGdpdmVu\nIHJlcG9zaXRvcnkKICAgICAgICAgICAgICAgIC8vIGdyb3VwOyBzb21lIG1h\neSBub3QgZXhpc3QgeWV0LCB3aGljaCBpcyBPSzsgd2UganVzdCBuZWVkCiAg\nICAgICAgICAgICAgICAvLyB0byBtYWtlIHN1cmUgd2UgY2FuIGRldGVjdCB0\naGUgY2hhbmdlcyB0byB0aGUgb25lcyB0aGF0CiAgICAgICAgICAgICAgICAv\nLyBkbyBleGlzdAogICAgICAgICAgICAgICAgQ29sbGVjdGlvbiB0YWJsZXMg\nPSBuZXcgTGlua2VkTGlzdCgpOwogICAgICAgICAgICAgICAgU2NoZW1hR3Jv\ndXAgZ3JvdXAgPSBhc3NlcnRTY2hlbWFHcm91cCgpOwogICAgICAgICAgICAg\nICAgU2NoZW1hW10gc2NoZW1hcyA9IGdyb3VwLmdldFNjaGVtYXMoKTsKICAg\nICAgICAgICAgICAgIFRhYmxlW10gdGFiczsKICAgICAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygp\nOwogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdGFi\ncy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\ndGFic1tqXS5nZXRTY2hlbWFOYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHRhYmxlcy5hZGQoIi4iICsgdGFic1tqXS5nZXRO\nYW1lKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB0YWJsZXMuYWRkKHRhYnNbal0uZ2V0RnVs\nbE5hbWUoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgaWYgKCF0YWJsZXMuaXNFbXB0eSgpKQog\nICAgICAgICAgICAgICAgICAgIGdlbi5nZW5lcmF0ZVNjaGVtYXMoKFN0cmlu\nZ1tdKSB0YWJsZXMudG9BcnJheQogICAgICAgICAgICAgICAgICAgICAgICAo\nbmV3IFN0cmluZ1t0YWJsZXMuc2l6ZSgpXSkpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIF9kYiA9IGdlbi5nZXRTY2hlbWFHcm91cCgpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gX2RiOwogICAgfQoKICAgIHByaXZhdGUgU2No\nZW1hR3JvdXAgYXNzZXJ0U2NoZW1hR3JvdXAoKSB7CiAgICAgICAgU2NoZW1h\nR3JvdXAgbG9jYWwgPSBnZXRTY2hlbWFHcm91cCgpOwogICAgICAgIGlmIChs\nb2NhbCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0\nYXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJ0b29sLW5vcmVwb3MiKSk7CiAgICAg\nICAgcmV0dXJuIGxvY2FsOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8KICAg\nIC8vIFV0aWxpdGllcwogICAgLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAg\nICogRXhlY3V0ZXMgdGhlIGdpdmVuIGFycmF5IG9mIG5vbi1zZWxlY3Rpbmcg\nU1FMIHN0YXRlbWVudHMsIGNvcnJlY3RseQogICAgICogbG9nZ2luZyB0aGUg\nU1FMIGNhbGxzIGFuZCBvcHRpb25hbGx5IGlnbm9yaW5nIGVycm9ycy4KICAg\nICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlcmUgd2FzIFNRTCB0byBl\neGVjdXRlIGFuZCB0aGUgY2FsbHMgd2VyZQogICAgICogc3VjY2Vzc2Z1bCwg\nZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBl\neGVjdXRlU1FMKFN0cmluZ1tdIHNxbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBpZiBubyBzcWwsIHByb2JhYmx5IGIvYyBk\naWN0aW9uYXJ5IGRvZXNuJ3Qgc3VwcG9ydCBvcGVyYXRpb24KICAgICAgICBp\nZiAoc3FsLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCgogICAgICAgIGJvb2xlYW4gZXJyID0gZmFsc2U7CiAgICAgICAgaWYgKF93\ncml0ZXIgPT0gbnVsbCkgewogICAgICAgICAgICAvLyB0aGlzIGlzIG91dHNp\nZGUgdGhlIHRyeS1jYXRjaCBiZWNhdXNlIGEgZmFpbHVyZSBoZXJlIGlzCiAg\nICAgICAgICAgIC8vIHJlYWxseSBiYWQsIGFuZCBzaG91bGQgbm90IGJlIGln\nbm9yZWQuCiAgICAgICAgICAgIENvbm5lY3Rpb24gY29ubiA9IF9kcy5nZXRD\nb25uZWN0aW9uKCk7CiAgICAgICAgICAgIFN0YXRlbWVudCBzdGF0ZW1lbnQg\nPSBudWxsOwogICAgICAgICAgICBib29sZWFuIHdhc0F1dG8gPSB0cnVlOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgd2FzQXV0byA9IGNv\nbm4uZ2V0QXV0b0NvbW1pdCgpOwogICAgICAgICAgICAgICAgaWYgKCF3YXNB\ndXRvKQogICAgICAgICAgICAgICAgICAgIGNvbm4uc2V0QXV0b0NvbW1pdCh0\ncnVlKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Fs\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gc29tZSBjb25uZWN0aW9ucyByZXF1\naXJlIHRoYXQgcm9sbGJhY2sgYmUKICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gY2FsbGVkIG9uIHRoZSBjb25uZWN0aW9uIGJlZm9yZSBhbnkgRERMIHN0\nYXRlbWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FuIGJlIHJ1\nbiBvbiBpdCwgZXZlbiB3aGVuIGF1dG9jb21taXQgaXMgb24uCiAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgc29tZXRpbWVzIGJlY2F1c2Ug\ndGhlIGNvbm5lY3Rpb24gZG9lcyBub3QKICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gYWxsb3cgRERMIHN0YXRlbWVudHMgd2hlbiB0aGVyZSBhcmUgbXVs\ndGlwbGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29tbWFuZHMgaXNz\ndWVkIG9uIHRoZSBjb25uZWN0aW9uLCBhbmQgdGhlCiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIGNvbm5lY3Rpb24gcG9vbCBtYXkgaGF2ZSBpc3N1ZWQg\nc29tZSB2YWxpZGF0aW9uIFNRTC4KICAgICAgICAgICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm4ucm9sbGJh\nY2soKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgICAgICAgICAgc3RhdGVtZW50ID0gY29ubi5jcmVhdGVTdGF0ZW1l\nbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVtZW50LmV4ZWN1\ndGVVcGRhdGUoc3FsW2ldKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIHNvbWUgY29ubmVjdGlvbnMgc2VlbSB0byByZXF1aXJlIGFuIGV4cGxpY2l0\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbW1pdCBmb3IgRERMIHN0\nYXRlbWVudHMsIGV2ZW4gd2hlbiBhdXRvY29tbWl0CiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIGlzIG9uLiBUaGUgRGF0YURpcmVjdCBkcml2ZXJzIHNl\nZW0gdG8gc3VmZmVyIGZyb20KICAgICAgICAgICAgICAgICAgICAgICAgLy8g\ndGhpcyBsaW1pdGF0aW9uLgogICAgICAgICAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubi5jb21taXQoKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVyciA9IHRydWU7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUV4Y2VwdGlvbihzZSk7CiAg\nICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKHN0YXRlbWVudCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBzdGF0ZW1lbnQuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBm\naW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmICghd2FzQXV0bykKICAgICAg\nICAgICAgICAgICAgICBjb25uLnNldEF1dG9Db21taXQoZmFsc2UpOwogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25uLmNs\nb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Fs\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgX3dyaXRlci5wcmludGxu\nKHNxbFtpXSArICI7Iik7CiAgICAgICAgICAgIF93cml0ZXIuZmx1c2goKTsK\nICAgICAgICB9CgogICAgICAgIHJldHVybiAhZXJyOwogICAgfQoKICAgIC8q\nKgogICAgICogSGFuZGxlIHRoZSBnaXZlbiBleGNlcHRpb24sIGxvZ2dpbmcg\naXQgYW5kIG9wdGlvbmFsbHkgaWdub3JpbmcgaXQsCiAgICAgKiBkZXBlbmRp\nbmcgb24gdGhlIGZsYWdzIHRoaXMgU2NoZW1hVG9vbCB3YXMgY3JlYXRlZCB3\naXRoLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgaGFuZGxlRXhjZXB0aW9u\nKFNRTEV4Y2VwdGlvbiBzcWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKCFfaWdub3JlRXJycykKICAgICAgICAgICAgdGhy\nb3cgc3FsOwogICAgICAgIF9sb2cud2FybihzcWwuZ2V0TWVzc2FnZSgpLCBz\ncWwpOwogICAgfQoKICAgIC8vLy8vLy8vCiAgICAvLyBNYWluCiAgICAvLy8v\nLy8vLwoKICAgIC8qKgogICAgICogVXNhZ2U6IGphdmEgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYVRvb2wgW29wdGlvbl0qCiAgICAg\nKiBbLWFjdGlvbi8tYSAmbHQ7YWRkIHwgcmV0YWluIHwgZHJvcCB8IHJlZnJl\nc2ggfCBjcmVhdGVEQiB8IGRyb3BEQgogICAgICogfCBidWlsZCB8IHJlZmxl\nY3QgfCBpbXBvcnQgfCBleHBvcnQmZ3Q7XQogICAgICogJmx0Oy5zY2hlbWEg\nZmlsZSBvciByZXNvdXJjZSZndDsqCiAgICAgKiAgV2hlcmUgdGhlIGZvbGxv\nd2luZyBvcHRpb25zIGFyZSByZWNvZ25pemVkLgogICAgICogPHVsPgogICAg\nICogPGxpPjxpPi1wcm9wZXJ0aWVzLy1wICZsdDtwcm9wZXJ0aWVzIGZpbGUg\nb3IgcmVzb3VyY2UmZ3Q7PC9pPjogVGhlCiAgICAgKiBwYXRoIG9yIHJlc291\ncmNlIG5hbWUgb2YgYSBPcGVuSlBBIHByb3BlcnRpZXMgZmlsZSBjb250YWlu\naW5nCiAgICAgKiBpbmZvcm1hdGlvbiBzdWNoIGFzIHRoZSBsaWNlbnNlIGtl\neQlhbmQgY29ubmVjdGlvbiBkYXRhIGFzCiAgICAgKiBvdXRsaW5lZCBpbiB7\nQGxpbmsgSkRCQ0NvbmZpZ3VyYXRpb259LiBPcHRpb25hbC48L2xpPgogICAg\nICogPGxpPjxpPi0mbHQ7cHJvcGVydHkgbmFtZSZndDsgJmx0O3Byb3BlcnR5\nIHZhbHVlJmd0OzwvaT46IEFsbCBiZWFuCiAgICAgKiBwcm9wZXJ0aWVzIG9m\nIHRoZSBPcGVuSlBBIHtAbGluayBKREJDQ29uZmlndXJhdGlvbn0gY2FuIGJl\nIHNldCBieQogICAgICogdXNpbmcgdGhlaXIJbmFtZXMgYW5kIHN1cHBseWlu\nZyBhIHZhbHVlLiBGb3IgZXhhbXBsZToKICAgICAqIDxjb2RlPi1saWNlbnNl\nS2V5IGFkc2xmamE4M3IzbGthZGY8L2NvZGU+PC9saT4KICAgICAqIDxsaT48\naT4taWdub3JlRXJyb3JzLy1pICZsdDt0cnVlL3QgfCBmYWxzZS9mJmd0Ozwv\naT46IElmIGZhbHNlLCBhbgogICAgICogZXhjZXB0aW9uIHdpbGwgd2lsbCBi\nZSB0aHJvd24gaWYgdGhlIHRvb2wgZW5jb3VudGVycyBhbnkgZGF0YWJhc2UK\nICAgICAqIGV4Y2VwdGlvbnM7IGRlZmF1bHRzIHRvIDxjb2RlPmZhbHNlPC9j\nb2RlPi48L2xpPgogICAgICogPGxpPjxpPi1maWxlLy1mICZsdDtzdGRvdXQg\nfCBvdXRwdXQgZmlsZSBvciByZXNvdXJjZSZndDs8L2k+OiBVc2UgdGhpcwog\nICAgICogb3B0aW9uIHRvIHdyaXRlIGEgU1FMIHNjcmlwdCBmb3IgdGhlIHBs\nYW5uZWQgc2NoZW1hIG1vZGlmaWNhdGlvbnMsCiAgICAgKiByYXRoZXIgdGhh\nbiBjb21taXR0aW5nIHRoZW0gdG8gdGhlIGRhdGFiYXNlLiBUaGlzIG9wdGlv\nbiBhbHNvCiAgICAgKiBhcHBsaWVzIHRvIHRoZSA8Y29kZT5leHBvcnQ8L2Nv\nZGU+IGFuZCA8Y29kZT5yZWZsZWN0PC9jb2RlPiBhY3Rpb25zLjwvbGk+CiAg\nICAgKiA8bGk+PGk+LW9wZW5qcGFUYWJsZXMvLWt0ICZsdDt0cnVlL3QgfCBm\nYWxzZS9mJmd0OzwvaT46IFVuZGVyIHRoZQogICAgICogPGNvZGU+cmVmbGVj\ndDwvY29kZT4gYWN0aW9uLCB3aGV0aGVyIHRvIHJlZmxlY3Qgb24gdGFibGVz\nIHdpdGgKICAgICAqIHRoZSBuYW1lIDxjb2RlPk9QRU5KUEFfKjwvY29kZT4u\nIFVuZGVyIG90aGVyIGFjdGlvbnMsIHdoZXRoZXIgdG8KICAgICAqIGRyb3Ag\nc3VjaCB0YWJsZXMuIERlZmF1bHRzIHRvIDxjb2RlPmZhbHNlPC9jb2RlPi48\nL2xpPgogICAgICogPGxpPjxpPi1kcm9wVGFibGVzLy1kdCAmbHQ7dHJ1ZS90\nIHwgZmFsc2UvZiZndDs8L2k+OiBTZXQgdGhpcyBvcHRpb24gdG8KICAgICAq\nIHRydWUgdG8gZHJvcCB0YWJsZXMgdGhhdCBhcHBlYXIgdG8gYmUgdW51c2Vk\nIGR1cmluZwogICAgICogPGNvZGU+cmV0YWluPC9jb2RlPglhbmQgPGNvZGU+\ncmVmcmVzaDwvY29kZT4gYWN0aW9ucy4gRGVmYXVsdHMgdG8KICAgICAqIDxj\nb2RlPnRydWU8L2NvZGU+LjwvbGk+CiAgICAgKiA8bGk+PGk+LWRyb3BTZXF1\nZW5jZXMvLWRzcSAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8L2k+OiBTZXQg\ndGhpcyBvcHRpb24KICAgICAqIHRvIHRydWUgdG8gZHJvcCBzZXF1ZW5jZXMg\ndGhhdCBhcHBlYXIgdG8gYmUgdW51c2VkIGR1cmluZwogICAgICogPGNvZGU+\ncmV0YWluPC9jb2RlPglhbmQgPGNvZGU+cmVmcmVzaDwvY29kZT4gYWN0aW9u\ncy4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPnRydWU8L2NvZGU+LjwvbGk+\nCiAgICAgKiA8bGk+PGk+LXByaW1hcnlLZXlzLy1wayAmbHQ7dHJ1ZS90IHwg\nZmFsc2UvZiZndDs8L2k+OiBXaGV0aGVyIHByaW1hcnkKICAgICAqIGtleXMg\nb24gZXhpc3RpbmcgdGFibGVzIGFyZSBtYW5pcHVsYXRlZC4gRGVmYXVsdHMg\ndG8gdHJ1ZS48L2xpPgogICAgICogPGxpPjxpPi1mb3JlaWduS2V5cy8tZmsg\nJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogV2hldGhlciBmb3JlaWdu\nCiAgICAgKiBrZXlzIG9uIGV4aXN0aW5nIHRhYmxlcyBhcmUgbWFuaXB1bGF0\nZWQuIERlZmF1bHRzIHRvIHRydWUuPC9saT4KICAgICAqIDxsaT48aT4taW5k\nZXhlcy8taXggJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogV2hldGhl\nciBpbmRleGVzCiAgICAgKiBvbiBleGlzdGluZyB0YWJsZXMgYXJlIG1hbmlw\ndWxhdGVkLiBEZWZhdWx0cyB0byB0cnVlLjwvbGk+CiAgICAgKiA8bGk+PGk+\nLXNlcXVlbmNlcy8tc3EgJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjog\nV2hldGhlciB0bwogICAgICogbWFuaXB1bGF0ZSBzZXF1ZW5jZXMuIERlZmF1\nbHRzIHRvIHRydWUuPC9saT4KICAgICAqIDxsaT48aT4tcmVjb3JkLy1yICZs\ndDt0cnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46IFNldCB0aGlzIG9wdGlvbiB0\nbwogICAgICogPGNvZGU+ZmFsc2U8L2NvZGU+IHRvIHByZXZlbnQgd3JpdGlu\nZyB0aGUgc2NoZW1hIGNoYW5nZXMgdG8gdGhlCiAgICAgKiBjdXJyZW50IHtA\nbGluayBTY2hlbWFGYWN0b3J5fS48L2xpPgogICAgICogPC91bD4KICAgICAq\nICBBY3Rpb25zIGNhbiBiZSBjb21wb3NlZCBpbiBhIGNvbW1hLXNlcGFyYXRl\nZCBsaXN0LiBUaGUgdmFyaW91cyBhY3Rpb25zIAogICAgICogIGFyZSBhcyBm\nb2xsb3dzLgogICAgICogPHVsPgogICAgICogPGxpPjxpPmFkZDwvaT46IEJy\naW5nIHRoZSBzY2hlbWEgdXAtdG8tZGF0ZSB3aXRoIHRoZSBsYXRlc3QKICAg\nICAqIGNoYW5nZXMgdG8gdGhlIHNjaGVtYSBYTUwgZGF0YSBieSBhZGRpbmcg\ndGFibGVzLCBjb2x1bW5zLAogICAgICogaW5kZXhlcywgZXRjLiBUaGlzIGFj\ndGlvbiBuZXZlciBkcm9wcyBhbnkgZGF0YS4gVGhpcyBpcyB0aGUKICAgICAq\nIGRlZmF1bHQgYWN0aW9uLjwvbGk+CiAgICAgKiA8bGk+PGk+cmV0YWluPC9p\nPjogS2VlcCBhbGwgc2NoZW1hIGNvbXBvbmVudHMgaW4gdGhlIHNjaGVtYSBY\nTUwsIGJ1dAogICAgICogZHJvcCB0aGUgcmVzdCBmcm9tIHRoZSBkYXRhYmFz\nZS4gVGhpcyBhY3Rpb24gbmV2ZXIgYWRkcyBhbnkgZGF0YS48L2xpPgogICAg\nICogPGxpPjxpPmRyb3A8L2k+OiBEcm9wIGFsbCB0aGUgc2NoZW1hIGNvbXBv\nbmVudHMgaW4gdGhlIHNjaGVtYSBYTUwuPC9saT4KICAgICAqIDxsaT48aT5y\nZWZyZXNoPC9pPjogRXF1aXZhbGVudCB0byByZXRhaW4sIHRoZW4gYWRkLjwv\nbGk+CiAgICAgKiA8bGk+PGk+Y3JlYXRlREI8L2k+OiBFeGVjdXRlIFNRTCB0\nbyByZS1jcmVhdGUgdGhlIGN1cnJlbnQgZGF0YWJhc2UuCiAgICAgKiBUaGlz\nIGFjdGlvbiBpcyB0eXBpY2FsbHkgdXNlZCBpbiBjb25qdWN0aW9uIHdpdGgg\ndGhlCiAgICAgKiA8Y29kZT5maWxlPC9jb2RlPiBvcHRpb24uPC9saT4KICAg\nICAqIDxsaT48aT5idWlsZDwvaT46IEV4ZWN1dGUgU1FMIHRvIGJ1aWxkIHRo\nZSBzY2hlbWEgZGVmaW5lZCBpbiB0aGUgWE1MLgogICAgICogQmVjYXVzZSBp\ndCBkb2Vzbid0IHRha2UgdGhlIGN1cnJlbnQgZGF0YWJhc2Ugc2NoZW1hIGlu\ndG8gYWNjb3VudCwKICAgICAqIHRoaXMgYWN0aW9uIGlzIHR5cGljYWxseSB1\nc2VkIGluIGNvbmp1Y3Rpb24gd2l0aCB0aGUKICAgICAqIDxjb2RlPmZpbGU8\nL2NvZGU+IG9wdGlvbi48L2xpPgogICAgICogPGxpPjxpPnJlZmxlY3Q8L2k+\nOiBSZWZsZWN0IG9uIHRoZSBjdXJyZW50IGRhdGFiYXNlIHNjaGVtYS4gV3Jp\ndGUgdGhlCiAgICAgKiBzY2hlbWEncyBYTUwgcmVwcmVzZW50YXRpb24gdG8g\ndGhlIGZpbGUgc3BlY2lmaWVkIHdpdGggdGhlCiAgICAgKiA8Y29kZT5maWxl\nPC9jb2RlPiBvcHRpb24sIG9yIHRvIHN0ZG91dCBpZiBubyBmaWxlIGlzIGdp\ndmVuLjwvbGk+CiAgICAgKiA8bGk+PGk+ZHJvcERCPC9pPjogRXhlY3V0ZSBT\nUUwgdG8gZHJvcCB0aGUgY3VycmVudCBkYXRhYmFzZS4gVGhpcwogICAgICog\nYWN0aW9uIGltcGxpZXMgPGNvZGU+ZHJvcFRhYmxlczwvY29kZT4uPC9saT4K\nICAgICAqIDxsaT48aT5kZWxldGVUYWJsZUNvbnRlbnRzPC9pPjogRXhlY3V0\nZSBTUUwgdG8gZGVsZXRlIGFsbCByb3dzIGZyb20gCiAgICAgKiBhbGwgdGFi\nbGVzIHRoYXQgT3BlbkpQQSBrbm93cyBhYm91dC48L2xpPgogICAgICogPGxp\nPjxpPmltcG9ydDwvaT46IEltcG9ydCB0aGUgZ2l2ZW4gWE1MIHNjaGVtYSBk\nZWZpbml0aW9uIGludG8gdGhlCiAgICAgKiBjdXJyZW50IHtAbGluayBTY2hl\nbWFGYWN0b3J5fS48L2xpPgogICAgICogPGxpPjxpPmV4cG9ydDwvaT46IEV4\ncG9ydCB0aGUgY3VycmVudCB7QGxpbmsgU2NoZW1hRmFjdG9yeX0ncyByZWNv\ncmRlZAogICAgICogc2NoZW1hIHRvIGFuIFhNTCBzY2hlbWEgZGVmaW5pdGlv\nbiBmaWxlLjwvbGk+CiAgICAgKiA8L3VsPgogICAgICogIEV4YW1wbGVzOgog\nICAgICogPHVsPgogICAgICogPGxpPldyaXRlIGEgc2NyaXB0IHRvIHN0ZG91\ndCB0byByZS1jcmVhdGUgdGhlIGN1cnJlbnQgZGF0YWJhc2UKICAgICAqIHNj\naGVtYTo8YnIgLz4KICAgICAqIDxjb2RlPmphdmEgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlNjaGVtYVRvb2wgLWYgc3Rkb3V0IAogICAgICog\nLWEgY3JlYXRlREI8L2NvZGU+PC9saT4KICAgICAqIDxsaT5Ecm9wIHRoZSBj\ndXJyZW50IGRhdGFiYXNlIHNjaGVtYTo8YnIgLz4KICAgICAqIDxjb2RlPmph\ndmEgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYVRvb2wg\nCiAgICAgKiAtYSBkcm9wREI8L2NvZGU+PC9saT4KICAgICAqIDxsaT5SZWZy\nZXNoIHRoZSBzY2hlbWEgYW5kIGRlbGV0ZSBhbGwgcmVjb3JkcyBpbiBhbGwg\ndGFibGVzOjxiciAvPgogICAgICogPGNvZGU+amF2YSBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hVG9vbCAKICAgICAqIC1hIHJlZnJl\nc2gsZGVsZXRlVGFibGVDb250ZW50czwvY29kZT48L2xpPgogICAgICogPGxp\nPkNyZWF0ZSBhIHNjaGVtYSBiYXNlZCBvbiBhbiBYTUwgc2NoZW1hIGRlZmlu\naXRpb24gZmlsZTo8YnIgLz4KICAgICAqIDxjb2RlPmphdmEgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYVRvb2wgCiAgICAgKiBteXNj\naGVtYS54bWw8L2NvZGU+PC9saT4KICAgICAqIDwvdWw+CiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpCiAgICAg\nICAgdGhyb3dzIElPRXhjZXB0aW9uLCBTUUxFeGNlcHRpb24gewogICAgICAg\nIE9wdGlvbnMgb3B0cyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgZmluYWwg\nU3RyaW5nW10gYXJndW1lbnRzID0gb3B0cy5zZXRGcm9tQ21kTGluZShhcmdz\nKTsKICAgICAgICBib29sZWFuIHJldCA9IENvbmZpZ3VyYXRpb25zLnJ1bkFn\nYWluc3RBbGxBbmNob3JzKG9wdHMsCiAgICAgICAgICAgIG5ldyBDb25maWd1\ncmF0aW9ucy5SdW5uYWJsZSgpIHsKICAgICAgICAgICAgcHVibGljIGJvb2xl\nYW4gcnVuKE9wdGlvbnMgb3B0cykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgICAgICBKREJDQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IEpEQkND\nb25maWd1cmF0aW9uSW1wbCgpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gU2NoZW1hVG9vbC5ydW4oY29uZiwg\nYXJndW1lbnRzLCBvcHRzKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICAgICAgY29uZi5jbG9zZSgpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYg\nKCFyZXQpCiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbihfbG9jLmdl\ndCgidG9vbC11c2FnZSIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJ1biB0\naGUgdG9vbC4gUmV0dXJucyBmYWxzZSBpZiBhbnkgaW52YWxpZCBvcHRpb25z\nIHdlcmUgZ2l2ZW4uCiAgICAgKgogICAgICogQHNlZSAjbWFpbgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gcnVuKEpEQkNDb25maWd1cmF0\naW9uIGNvbmYsIFN0cmluZ1tdIGFyZ3MsCiAgICAgICAgT3B0aW9ucyBvcHRz\nKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBGbGFncyBmbGFncyA9IG5ldyBGbGFncygpOwogICAgICAgIGZs\nYWdzLmRyb3BUYWJsZXMgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQog\nICAgICAgICAgICAoImRyb3BUYWJsZXMiLCAiZHQiLCBmbGFncy5kcm9wVGFi\nbGVzKTsKICAgICAgICBmbGFncy5kcm9wU2VxdWVuY2VzID0gb3B0cy5yZW1v\ndmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJkcm9wU2VxdWVuY2Vz\nIiwgImRzcSIsIGZsYWdzLmRyb3BTZXF1ZW5jZXMpOwogICAgICAgIGZsYWdz\nLmlnbm9yZUVycm9ycyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAg\nICAgICAgICAgICgiaWdub3JlRXJyb3JzIiwgImkiLCBmbGFncy5pZ25vcmVF\ncnJvcnMpOwogICAgICAgIGZsYWdzLm9wZW5qcGFUYWJsZXMgPSBvcHRzLnJl\nbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoIm9wZW5qcGFUYWJs\nZXMiLCAib3QiLCBmbGFncy5vcGVuanBhVGFibGVzKTsKICAgICAgICBmbGFn\ncy5wcmltYXJ5S2V5cyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAg\nICAgICAgICAgICgicHJpbWFyeUtleXMiLCAicGsiLCBmbGFncy5wcmltYXJ5\nS2V5cyk7CiAgICAgICAgZmxhZ3MuZm9yZWlnbktleXMgPSBvcHRzLnJlbW92\nZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoImZvcmVpZ25LZXlzIiwg\nImZrcyIsIGZsYWdzLmZvcmVpZ25LZXlzKTsKICAgICAgICBmbGFncy5pbmRl\neGVzID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAg\nKCJpbmRleGVzIiwgIml4IiwgZmxhZ3MuaW5kZXhlcyk7CiAgICAgICAgZmxh\nZ3Muc2VxdWVuY2VzID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAg\nICAgICAgICAgKCJzZXF1ZW5jZXMiLCAic3EiLCBmbGFncy5zZXF1ZW5jZXMp\nOwogICAgICAgIGZsYWdzLnJlY29yZCA9IG9wdHMucmVtb3ZlQm9vbGVhblBy\nb3BlcnR5KCJyZWNvcmQiLCAiciIsIGZsYWdzLnJlY29yZCk7CiAgICAgICAg\nU3RyaW5nIGZpbGVOYW1lID0gb3B0cy5yZW1vdmVQcm9wZXJ0eSgiZmlsZSIs\nICJmIiwgbnVsbCk7CiAgICAgICAgU3RyaW5nIHNjaGVtYXMgPSBvcHRzLnJl\nbW92ZVByb3BlcnR5KCJzIik7CiAgICAgICAgaWYgKHNjaGVtYXMgIT0gbnVs\nbCkKICAgICAgICAgICAgb3B0cy5zZXRQcm9wZXJ0eSgic2NoZW1hcyIsIHNj\naGVtYXMpOwoKICAgICAgICBTdHJpbmdbXSBhY3Rpb25zID0gb3B0cy5yZW1v\ndmVQcm9wZXJ0eSgiYWN0aW9uIiwgImEiLCBmbGFncy5hY3Rpb24pCiAgICAg\nICAgICAgIC5zcGxpdCgiLCIpOwogICAgICAgIAogICAgICAgIC8vIHNldHVw\nIGEgY29uZmlndXJhdGlvbiBpbnN0YW5jZSB3aXRoIGNtZC1saW5lIGluZm8K\nICAgICAgICBDb25maWd1cmF0aW9ucy5wb3B1bGF0ZUNvbmZpZ3VyYXRpb24o\nY29uZiwgb3B0cyk7CgogICAgICAgIC8vIGNyZWF0ZSBzY3JpcHQgd3JpdGVy\nCiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyID0gY29uZi5nZXRDbGFzc1Jl\nc29sdmVySW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0Q2xhc3NMb2FkZXIo\nU2NoZW1hVG9vbC5jbGFzcywgbnVsbCk7CiAgICAgICAgZmxhZ3Mud3JpdGVy\nID0gRmlsZXMuZ2V0V3JpdGVyKGZpbGVOYW1lLCBsb2FkZXIpOwoKICAgICAg\nICBib29sZWFuIHJldHVyblZhbHVlID0gdHJ1ZTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGFjdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgZmxhZ3MuYWN0aW9uID0gYWN0aW9uc1tpXTsKICAgICAgICAgICAgcmV0\ndXJuVmFsdWUgJj0gcnVuKGNvbmYsIGFyZ3MsIGZsYWdzLCBsb2FkZXIpOwog\nICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSdW4gdGhlIHRvb2wuIFJldHVybiBm\nYWxzZSBpZiBpbnZhbGlkIG9wdGlvbnMgd2VyZSBnaXZlbi4KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBib29sZWFuIHJ1bihKREJDQ29uZmlndXJhdGlv\nbiBjb25mLCBTdHJpbmdbXSBhcmdzLAogICAgICAgIEZsYWdzIGZsYWdzLCBD\nbGFzc0xvYWRlciBsb2FkZXIpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9u\nLCBTUUxFeGNlcHRpb24gewogICAgICAgIExvZyBsb2cgPSBjb25mLmdldExv\nZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfVE9PTCk7CiAgICAgICAgaWYg\nKEFDVElPTl9SRUZMRUNULmVxdWFscyhmbGFncy5hY3Rpb24pKSB7CiAgICAg\nICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChmbGFncy53cml0ZXIgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIGZsYWdzLndyaXRlciA9IG5ldyBQcmlu\ndFdyaXRlcihTeXN0ZW0ub3V0KTsKCiAgICAgICAgICAgIFNjaGVtYUdlbmVy\nYXRvciBnZW4gPSBuZXcgU2NoZW1hR2VuZXJhdG9yKGNvbmYpOwogICAgICAg\nICAgICBnZW4uc2V0UHJpbWFyeUtleXMoZmxhZ3MucHJpbWFyeUtleXMpOwog\nICAgICAgICAgICBnZW4uc2V0SW5kZXhlcyhmbGFncy5pbmRleGVzKTsKICAg\nICAgICAgICAgZ2VuLnNldEZvcmVpZ25LZXlzKGZsYWdzLmZvcmVpZ25LZXlz\nKTsKICAgICAgICAgICAgZ2VuLnNldFNlcXVlbmNlcyhmbGFncy5zZXF1ZW5j\nZXMpOwogICAgICAgICAgICBnZW4uc2V0T3BlbkpQQVRhYmxlcyhmbGFncy5v\ncGVuanBhVGFibGVzKTsKCiAgICAgICAgICAgIFN0cmluZyBzY2hlbWFzID0g\nY29uZi5nZXRTY2hlbWFzKCk7CiAgICAgICAgICAgIGlmIChTdHJpbmdVdGls\ncy5pc0VtcHR5KHNjaGVtYXMpKQogICAgICAgICAgICAgICAgc2NoZW1hcyA9\nICJhbGwiOwogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgic2NoLXJl\nZmxlY3QiLCBzY2hlbWFzKSk7CiAgICAgICAgICAgIGdlbi5nZW5lcmF0ZVNj\naGVtYXMoKTsKCiAgICAgICAgICAgIC8vIHJlY29yZCB0aGUgc2NoZW1hCiAg\nICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJzY2gtcmVmbGVjdC13cml0\nZSIpKTsKICAgICAgICAgICAgU2NoZW1hU2VyaWFsaXplciBzZXIgPSBuZXcg\nWE1MU2NoZW1hU2VyaWFsaXplcihjb25mKTsKICAgICAgICAgICAgc2VyLmFk\nZEFsbChnZW4uZ2V0U2NoZW1hR3JvdXAoKSk7CiAgICAgICAgICAgIHNlci5z\nZXJpYWxpemUoZmxhZ3Mud3JpdGVyLCBzZXIuUFJFVFRZKTsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoYXJncy5s\nZW5ndGggPT0gMAogICAgICAgICAgICAmJiAhQUNUSU9OX0NSRUFURURCLmVx\ndWFscyhmbGFncy5hY3Rpb24pCiAgICAgICAgICAgICYmICFBQ1RJT05fRFJP\nUERCLmVxdWFscyhmbGFncy5hY3Rpb24pCiAgICAgICAgICAgICYmICFBQ1RJ\nT05fRVhQT1JULmVxdWFscyhmbGFncy5hY3Rpb24pCiAgICAgICAgICAgICYm\nICFBQ1RJT05fREVMRVRFX1RBQkxFX0NPTlRFTlRTLmVxdWFscyhmbGFncy5h\nY3Rpb24pKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8v\nIHBhcnNlIGluIHRoZSBhcmd1bWVudHMKICAgICAgICBTY2hlbWFQYXJzZXIg\ncGFyc2VyID0gbmV3IFhNTFNjaGVtYVBhcnNlcihjb25mKTsKICAgICAgICBw\nYXJzZXIuc2V0RGVsYXlDb25zdHJhaW50UmVzb2x2ZSh0cnVlKTsKICAgICAg\nICBGaWxlIGZpbGU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZpbGUgPSBGaWxlcy5nZXRG\naWxlKGFyZ3NbaV0sIGxvYWRlcik7CiAgICAgICAgICAgIGxvZy5pbmZvKF9s\nb2MuZ2V0KCJ0b29sLXJ1bm5pbmciLCBmaWxlKSk7CiAgICAgICAgICAgIHBh\ncnNlci5wYXJzZShmaWxlKTsKICAgICAgICB9CiAgICAgICAgcGFyc2VyLnJl\nc29sdmVDb25zdHJhaW50cygpOwoKICAgICAgICBpZiAoQUNUSU9OX0lNUE9S\nVC5lcXVhbHMoZmxhZ3MuYWN0aW9uKSkgewogICAgICAgICAgICBsb2cuaW5m\nbyhfbG9jLmdldCgidG9vbC1pbXBvcnQtc3RvcmUiKSk7CiAgICAgICAgICAg\nIFNjaGVtYUdyb3VwIHNjaGVtYSA9IHBhcnNlci5nZXRTY2hlbWFHcm91cCgp\nOwogICAgICAgICAgICBjb25mLmdldFNjaGVtYUZhY3RvcnlJbnN0YW5jZSgp\nLnN0b3JlU2NoZW1hKHNjaGVtYSk7CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0KICAgICAgICBpZiAoQUNUSU9OX0VYUE9SVC5lcXVhbHMo\nZmxhZ3MuYWN0aW9uKSkgewogICAgICAgICAgICBpZiAoZmxhZ3Mud3JpdGVy\nID09IG51bGwpCiAgICAgICAgICAgICAgICBmbGFncy53cml0ZXIgPSBuZXcg\nUHJpbnRXcml0ZXIoU3lzdGVtLm91dCk7CgogICAgICAgICAgICBsb2cuaW5m\nbyhfbG9jLmdldCgidG9vbC1leHBvcnQtZ2VuIikpOwogICAgICAgICAgICBT\nY2hlbWFHcm91cCBzY2hlbWEgPSBjb25mLmdldFNjaGVtYUZhY3RvcnlJbnN0\nYW5jZSgpLnJlYWRTY2hlbWEoKTsKCiAgICAgICAgICAgIGxvZy5pbmZvKF9s\nb2MuZ2V0KCJ0b29sLWV4cG9ydC13cml0ZSIpKTsKICAgICAgICAgICAgU2No\nZW1hU2VyaWFsaXplciBzZXIgPSBuZXcgWE1MU2NoZW1hU2VyaWFsaXplcihj\nb25mKTsKICAgICAgICAgICAgc2VyLmFkZEFsbChzY2hlbWEpOwogICAgICAg\nICAgICBzZXIuc2VyaWFsaXplKGZsYWdzLndyaXRlciwgc2VyLlBSRVRUWSk7\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAg\nU2NoZW1hVG9vbCB0b29sID0gbmV3IFNjaGVtYVRvb2woY29uZiwgZmxhZ3Mu\nYWN0aW9uKTsKICAgICAgICB0b29sLnNldElnbm9yZUVycm9ycyhmbGFncy5p\nZ25vcmVFcnJvcnMpOwogICAgICAgIHRvb2wuc2V0RHJvcFRhYmxlcyhmbGFn\ncy5kcm9wVGFibGVzKTsKICAgICAgICB0b29sLnNldFNlcXVlbmNlcyhmbGFn\ncy5zZXF1ZW5jZXMpOyAvLyBzZXQgYmVmb3JlIGRyb3BzZXFzCiAgICAgICAg\ndG9vbC5zZXREcm9wU2VxdWVuY2VzKGZsYWdzLmRyb3BTZXF1ZW5jZXMpOwog\nICAgICAgIHRvb2wuc2V0UHJpbWFyeUtleXMoZmxhZ3MucHJpbWFyeUtleXMp\nOwogICAgICAgIHRvb2wuc2V0Rm9yZWlnbktleXMoZmxhZ3MuZm9yZWlnbktl\neXMpOwogICAgICAgIHRvb2wuc2V0SW5kZXhlcyhmbGFncy5pbmRleGVzKTsK\nICAgICAgICB0b29sLnNldE9wZW5KUEFUYWJsZXMoZmxhZ3Mub3BlbmpwYVRh\nYmxlcyk7CiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMCkKICAgICAgICAg\nICAgdG9vbC5zZXRTY2hlbWFHcm91cChwYXJzZXIuZ2V0U2NoZW1hR3JvdXAo\nKSk7CiAgICAgICAgaWYgKGZsYWdzLndyaXRlciAhPSBudWxsKQogICAgICAg\nICAgICB0b29sLnNldFdyaXRlcihmbGFncy53cml0ZXIpOwoKICAgICAgICBs\nb2cuaW5mbyhfbG9jLmdldCgidG9vbC1hY3Rpb24iLCBmbGFncy5hY3Rpb24p\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB0b29sLnJ1bigpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChmbGFncy5yZWNvcmQp\nIHsKICAgICAgICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJ0b29sLXJl\nY29yZCIpKTsKICAgICAgICAgICAgICAgIHRvb2wucmVjb3JkKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZsYWdzLndyaXRlciAh\nPSBudWxsKQogICAgICAgICAgICBmbGFncy53cml0ZXIuZmx1c2goKTsKCiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSdW4g\nZmxhZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgRmxhZ3Mg\newoKICAgICAgICBwdWJsaWMgU3RyaW5nIGFjdGlvbiA9IEFDVElPTl9BREQ7\nCiAgICAgICAgcHVibGljIFdyaXRlciB3cml0ZXIgPSBudWxsOwogICAgICAg\nIHB1YmxpYyBib29sZWFuIGRyb3BUYWJsZXMgPSB0cnVlOwogICAgICAgIHB1\nYmxpYyBib29sZWFuIGRyb3BTZXF1ZW5jZXMgPSB0cnVlOwogICAgICAgIHB1\nYmxpYyBib29sZWFuIGlnbm9yZUVycm9ycyA9IGZhbHNlOwogICAgICAgIHB1\nYmxpYyBib29sZWFuIG9wZW5qcGFUYWJsZXMgPSBmYWxzZTsKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBwcmltYXJ5S2V5cyA9IHRydWU7CiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gZm9yZWlnbktleXMgPSB0cnVlOwogICAgICAgIHB1Ymxp\nYyBib29sZWFuIGluZGV4ZXMgPSB0cnVlOwogICAgICAgIHB1YmxpYyBib29s\nZWFuIHNlcXVlbmNlcyA9IHRydWU7CiAgICAgICAgcHVibGljIGJvb2xlYW4g\ncmVjb3JkID0gdHJ1ZTsKICAgIH0KfQo=\n","encoding":"base64"}

