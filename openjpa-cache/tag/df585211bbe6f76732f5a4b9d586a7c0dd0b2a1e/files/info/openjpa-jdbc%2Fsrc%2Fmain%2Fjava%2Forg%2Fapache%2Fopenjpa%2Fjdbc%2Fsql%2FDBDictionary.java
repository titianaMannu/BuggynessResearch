{"sha":"4189e46016403a5651ecc4d59bd41b560c3bc77d","node_id":"MDQ6QmxvYjIwNjM2NDo0MTg5ZTQ2MDE2NDAzYTU2NTFlY2M0ZDU5YmQ0MWI1NjBjM2JjNzdk","size":165338,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4189e46016403a5651ecc4d59bd41b560c3bc77d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uQnl0ZUFy\ncmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkNoYXJBcnJheVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlv\nLklucHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5p\nby5SZWFkZXI7CmltcG9ydCBqYXZhLmlvLlN0cmluZ1JlYWRlcjsKaW1wb3J0\nIGphdmEuaW8uV3JpdGVyOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuSW52\nb2NhdGlvblRhcmdldEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubGFuZy5yZWZs\nZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubWF0aC5CaWdEZWNpbWFsOwppbXBv\ncnQgamF2YS5tYXRoLkJpZ0ludGVnZXI7CmltcG9ydCBqYXZhLnNxbC5BcnJh\neTsKaW1wb3J0IGphdmEuc3FsLkJsb2I7CmltcG9ydCBqYXZhLnNxbC5DbG9i\nOwppbXBvcnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3Fs\nLkRhdGFiYXNlTWV0YURhdGE7CmltcG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0\nYXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlJlZjsKaW1wb3J0IGphdmEuc3Fs\nLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEuc3FsLlNRTFdhcm5pbmc7CmltcG9ydCBqYXZhLnNxbC5TdGF0\nZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5UaW1lOwppbXBvcnQgamF2YS5zcWwu\nVGltZXN0YW1wOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZh\nLnRleHQuTWVzc2FnZUZvcm1hdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGls\nLkNhbGVuZGFyOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuRGF0\nZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGls\nLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBq\nYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IGphdmF4LnNxbC5E\nYXRhU291cmNlOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0\ncmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29u\nZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkV4cENv\nbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwu\nZXhwcy5FeHBTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC5leHBzLkZpbHRlclZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMua2VybmVsLmV4cHMuTnVsbDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLlZhbDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmc7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkphdmFTUUxUeXBl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1\nbW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRGF0\nYVNvdXJjZUZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5OYW1lU2V0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNlcXVlbmNlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmlsdGVyczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU2VxOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlBhdGg7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhYmxlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuQ29ubmVjdGlv\nbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRi\nYy5Mb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTG9ja0V4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVj\ndEV4aXN0c0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0aWNFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5SZWZlcmVudGlhbEludGVncml0\neUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlNl\ncmlhbGl6YXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5T\ndG9yZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCmltcG9ydCBzZXJwLnV0aWwuTnVt\nYmVyczsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIENsYXNz\nIHdoaWNoIGFsbG93cyB0aGUgY3JlYXRpb24gb2YgU1FMIGR5bmFtaWNhbGx5\nLCBpbiBhCiAqIGRhdGFiYXNlIGFnbm9zdGljIGZhc2hpb24uIFN1YmNsYXNz\nIGZvciB0aGUgbnVhbmNlcyBvZiBkaWZmZXJlbnQgZGF0YSBzdG9yZXMuCiAq\nLwpwdWJsaWMgY2xhc3MgREJEaWN0aW9uYXJ5CiAgICBpbXBsZW1lbnRzIENv\nbmZpZ3VyYWJsZSwgQ29ubmVjdGlvbkRlY29yYXRvciwgSm9pblN5bnRheGVz\nLAogICAgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IuU1FMV2FybmluZ0hh\nbmRsZXIgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFZFTkRP\nUl9PVEhFUiA9ICJvdGhlciI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBWRU5ET1JfREFUQURJUkVDVCA9ICJkYXRhZGlyZWN0IjsKCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9VUFBFUiA9\nICJ1cHBlciI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTQ0hF\nTUFfQ0FTRV9MT1dFUiA9ICJsb3dlciI7CiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9QUkVTRVJWRSA9ICJwcmVzZXJ2ZSI7\nCgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ09OU19OQU1FX0JF\nRk9SRSA9ICJiZWZvcmUiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgQ09OU19OQU1FX01JRCA9ICJtaWQiOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBTdHJpbmcgQ09OU19OQU1FX0FGVEVSID0gImFmdGVyIjsKICAgIAog\nICAgcHVibGljIGludCBibG9iQnVmZmVyU2l6ZSA9IDUwMDAwOwogICAgcHVi\nbGljIGludCBjbG9iQnVmZmVyU2l6ZSA9IDUwMDAwOwoKICAgIHByb3RlY3Rl\nZCBzdGF0aWMgZmluYWwgaW50IFJBTkdFX1BPU1RfU0VMRUNUID0gMDsKICAg\nIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFJBTkdFX1BSRV9ESVNUSU5D\nVCA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBSQU5HRV9Q\nT1NUX0RJU1RJTkNUID0gMjsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFJBTkdFX1BPU1RfTE9DSyA9IDM7CgogICAgcHJvdGVjdGVkIHN0YXRp\nYyBmaW5hbCBpbnQgTkFOTyA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZp\nbmFsIGludCBNSUNSTyA9IE5BTk8gKiAxMDAwOwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBpbnQgTUlMTEkgPSBNSUNSTyAqIDEwMDA7CiAgICBwcm90\nZWN0ZWQgc3RhdGljIGZpbmFsIGludCBDRU5USSA9IE1JTExJICogMTA7CiAg\nICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBERUNJID0gTUlMTEkgKiAx\nMDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBTRUMgPSBNSUxM\nSSAqIDEwMDA7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFN\nRV9BTlkgPSAwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFN\nRV9UQUJMRSA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBO\nQU1FX1NFUVVFTkNFID0gMjsKICAgIAogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBpbnQgVU5MSU1JVEVEID0gLTE7CiAgICBwcm90ZWN0ZWQgc3RhdGlj\nIGZpbmFsIGludCBOT19CQVRDSCA9IDA7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIFpFUk9fREFURV9TVFIgPQogICAgICAgICInIiArIG5l\ndyBqYXZhLnNxbC5EYXRlKDApICsgIiciOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIFpFUk9fVElNRV9TVFIgPSAiJyIgKyBuZXcgVGltZSgw\nKSArICInIjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBaRVJP\nX1RJTUVTVEFNUF9TVFIgPQogICAgICAgICInIiArIG5ldyBUaW1lc3RhbXAo\nMCkgKyAiJyI7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVy\nIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChEQkRpY3Rp\nb25hcnkuY2xhc3MpOwoKICAgIC8vIHNjaGVtYSBkYXRhCiAgICBwdWJsaWMg\nU3RyaW5nIHBsYXRmb3JtID0gIkdlbmVyaWMiOwogICAgcHVibGljIFN0cmlu\nZyBkcml2ZXJWZW5kb3IgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBjYXRh\nbG9nU2VwYXJhdG9yID0gIi4iOwogICAgcHVibGljIGJvb2xlYW4gY3JlYXRl\nUHJpbWFyeUtleXMgPSB0cnVlOwogICAgcHVibGljIFN0cmluZyBjb25zdHJh\naW50TmFtZU1vZGUgPSBDT05TX05BTUVfQkVGT1JFOwogICAgcHVibGljIGlu\ndCBtYXhUYWJsZU5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1h\neENvbHVtbk5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1heENv\nbnN0cmFpbnROYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhJ\nbmRleE5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1heEluZGV4\nZXNQZXJUYWJsZSA9IEludGVnZXIuTUFYX1ZBTFVFOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNGb3JlaWduS2V5cyA9IHRydWU7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c1VuaXF1ZUNvbnN0cmFpbnRzID0gdHJ1ZTsKICAg\nIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cyA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jlc3RyaWN0RGVs\nZXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nQ2FzY2FkZURlbGV0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c051bGxEZWxldGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNEZWZhdWx0RGVsZXRlQWN0aW9uID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmVzdHJpY3RVcGRhdGVBY3Rp\nb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNDYXNjYWRl\nVXBkYXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzTnVsbFVwZGF0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c0RlZmF1bHRVcGRhdGVBY3Rpb24gPSB0cnVlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNBbHRlclRhYmxlV2l0aEFkZENvbHVtbiA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0FsdGVyVGFibGVX\naXRoRHJvcENvbHVtbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBw\nb3J0c0NvbW1lbnRzID0gZmFsc2U7CiAgICBwdWJsaWMgU3RyaW5nIHJlc2Vy\ndmVkV29yZHMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzeXN0ZW1TY2hl\nbWFzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc3lzdGVtVGFibGVzID0g\nbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc2VsZWN0V29yZHMgPSBudWxsOwog\nICAgcHVibGljIFN0cmluZyBmaXhlZFNpemVUeXBlTmFtZXMgPSBudWxsOwog\nICAgcHVibGljIFN0cmluZyBzY2hlbWFDYXNlID0gU0NIRU1BX0NBU0VfVVBQ\nRVI7CgogICAgLy8gc3FsCiAgICBwdWJsaWMgU3RyaW5nIHZhbGlkYXRpb25T\nUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBjbG9zZVBvb2xTUUwgPSBu\ndWxsOwogICAgcHVibGljIFN0cmluZyBpbml0aWFsaXphdGlvblNRTCA9IG51\nbGw7CiAgICBwdWJsaWMgaW50IGpvaW5TeW50YXggPSBTWU5UQVhfU1FMOTI7\nCiAgICBwdWJsaWMgU3RyaW5nIG91dGVySm9pbkNsYXVzZSA9ICJMRUZUIE9V\nVEVSIEpPSU4iOwogICAgcHVibGljIFN0cmluZyBpbm5lckpvaW5DbGF1c2Ug\nPSAiSU5ORVIgSk9JTiI7CiAgICBwdWJsaWMgU3RyaW5nIGNyb3NzSm9pbkNs\nYXVzZSA9ICJDUk9TUyBKT0lOIjsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVp\ncmVzQ29uZGl0aW9uRm9yQ3Jvc3NKb2luID0gZmFsc2U7CiAgICBwdWJsaWMg\nU3RyaW5nIGZvclVwZGF0ZUNsYXVzZSA9ICJGT1IgVVBEQVRFIjsKICAgIHB1\nYmxpYyBTdHJpbmcgdGFibGVGb3JVcGRhdGVDbGF1c2UgPSBudWxsOwogICAg\ncHVibGljIFN0cmluZyBkaXN0aW5jdENvdW50Q29sdW1uU2VwYXJhdG9yID0g\nbnVsbDsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzU2VsZWN0Rm9yVXBk\nYXRlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2lu\nZ1dpdGhEaXN0aW5jdENsYXVzZSA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c0xvY2tpbmdXaXRoTXVsdGlwbGVUYWJsZXMgPSB0cnVlOwog\nICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aE9yZGVyQ2xh\ndXNlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2lu\nZ1dpdGhPdXRlckpvaW4gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNMb2NraW5nV2l0aElubmVySm9pbiA9IHRydWU7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFuZ2UgPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNRdWVyeVRpbWVvdXQgPSB0\ncnVlOwogICAgcHVibGljIGJvb2xlYW4gc2ltdWxhdGVMb2NraW5nID0gZmFs\nc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1N1YnNlbGVjdCA9IHRy\ndWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0NvcnJlbGF0ZWRTdWJz\nZWxlY3QgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNIYXZp\nbmcgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTZWxlY3RT\ndGFydEluZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0\nc1NlbGVjdEVuZEluZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMgaW50IHJhbmdl\nUG9zaXRpb24gPSBSQU5HRV9QT1NUX1NFTEVDVDsKICAgIHB1YmxpYyBib29s\nZWFuIHJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3QgPSBmYWxzZTsKICAgIHB1\nYmxpYyBib29sZWFuIHJlcXVpcmVzVGFyZ2V0Rm9yRGVsZXRlID0gZmFsc2U7\nCiAgICBwdWJsaWMgYm9vbGVhbiBhbGxvd3NBbGlhc0luQnVsa0NsYXVzZSA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c011bHRpcGxlTm9u\ndHJhbnNhY3Rpb25hbFJlc3VsdFNldHMgPSB0cnVlOwogICAgcHVibGljIFN0\ncmluZyBzZWFyY2hTdHJpbmdFc2NhcGUgPSAiXFwiOwogICAgcHVibGljIGJv\nb2xlYW4gcmVxdWlyZXNDYXN0Rm9yTWF0aEZ1bmN0aW9ucyA9IGZhbHNlOwog\nICAgcHVibGljIGJvb2xlYW4gcmVxdWlyZXNDYXN0Rm9yQ29tcGFyaXNvbnMg\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTW9kT3BlcmF0\nb3IgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzWE1MQ29s\ndW1uID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiByZXBvcnRzU3VjY2Vz\nc05vSW5mb09uQmF0Y2hVcGRhdGVzID0gZmFsc2U7CiAgICAKICAgIC8qKgog\nICAgICogU29tZSBEYXRhYmFzZXMgYXBwZW5kIHdoaXRlc3BhY2UgYWZ0ZXIg\ndGhlIHNjaGVtYSBuYW1lIAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiB0\ncmltU2NoZW1hTmFtZSA9IGZhbHNlOwoKICAgIC8vIGZ1bmN0aW9ucwogICAg\ncHVibGljIFN0cmluZyBjYXN0RnVuY3Rpb24gPSAiQ0FTVCh7MH0gQVMgezF9\nKSI7CiAgICBwdWJsaWMgU3RyaW5nIHRvTG93ZXJDYXNlRnVuY3Rpb24gPSAi\nTE9XRVIoezB9KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRvVXBwZXJDYXNlRnVu\nY3Rpb24gPSAiVVBQRVIoezB9KSI7CiAgICBwdWJsaWMgU3RyaW5nIHN0cmlu\nZ0xlbmd0aEZ1bmN0aW9uID0gIkNIQVJfTEVOR1RIKHswfSkiOwogICAgcHVi\nbGljIFN0cmluZyBiaXRMZW5ndGhGdW5jdGlvbiA9ICIoT0NURVRfTEVOR1RI\nKHswfSkgKiA4KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRyaW1MZWFkaW5nRnVu\nY3Rpb24gPSAiVFJJTShMRUFESU5HIHsxfSBGUk9NIHswfSkiOwogICAgcHVi\nbGljIFN0cmluZyB0cmltVHJhaWxpbmdGdW5jdGlvbiA9ICJUUklNKFRSQUlM\nSU5HIHsxfSBGUk9NIHswfSkiOwogICAgcHVibGljIFN0cmluZyB0cmltQm90\naEZ1bmN0aW9uID0gIlRSSU0oQk9USCB7MX0gRlJPTSB7MH0pIjsKICAgIHB1\nYmxpYyBTdHJpbmcgY29uY2F0ZW5hdGVGdW5jdGlvbiA9ICIoezB9fHx7MX0p\nIjsKICAgIHB1YmxpYyBTdHJpbmcgY29uY2F0ZW5hdGVEZWxpbWl0ZXIgPSAi\nJ09QRU5KUEFUT0tFTiciOwogICAgcHVibGljIFN0cmluZyBzdWJzdHJpbmdG\ndW5jdGlvbk5hbWUgPSAiU1VCU1RSSU5HIjsKICAgIHB1YmxpYyBTdHJpbmcg\nY3VycmVudERhdGVGdW5jdGlvbiA9ICJDVVJSRU5UX0RBVEUiOwogICAgcHVi\nbGljIFN0cmluZyBjdXJyZW50VGltZUZ1bmN0aW9uID0gIkNVUlJFTlRfVElN\nRSI7CiAgICBwdWJsaWMgU3RyaW5nIGN1cnJlbnRUaW1lc3RhbXBGdW5jdGlv\nbiA9ICJDVVJSRU5UX1RJTUVTVEFNUCI7CiAgICBwdWJsaWMgU3RyaW5nIGRy\nb3BUYWJsZVNRTCA9ICJEUk9QIFRBQkxFIHswfSI7CgogICAgLy8gdHlwZXMK\nICAgIHB1YmxpYyBib29sZWFuIHN0b3JhZ2VMaW1pdGF0aW9uc0ZhdGFsID0g\nZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdG9yZUxhcmdlTnVtYmVyc0Fz\nU3RyaW5ncyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3RvcmVDaGFy\nc0FzTnVtYmVycyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiB1c2VHZXRC\neXRlc0ZvckJsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiB1c2VT\nZXRCeXRlc0ZvckJsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiB1\nc2VHZXRPYmplY3RGb3JCbG9icyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xl\nYW4gdXNlR2V0U3RyaW5nRm9yQ2xvYnMgPSBmYWxzZTsKICAgIHB1YmxpYyBi\nb29sZWFuIHVzZVNldFN0cmluZ0ZvckNsb2JzID0gZmFsc2U7CiAgICBwdWJs\naWMgaW50IG1heEVtYmVkZGVkQmxvYlNpemUgPSAtMTsKICAgIHB1YmxpYyBp\nbnQgbWF4RW1iZWRkZWRDbG9iU2l6ZSA9IC0xOwogICAgcHVibGljIGludCBp\nbkNsYXVzZUxpbWl0ID0gLTE7CiAgICBwdWJsaWMgaW50IGRhdGVQcmVjaXNp\nb24gPSBNSUxMSTsKICAgIHB1YmxpYyBpbnQgY2hhcmFjdGVyQ29sdW1uU2l6\nZSA9IDI1NTsKICAgIHB1YmxpYyBTdHJpbmcgYXJyYXlUeXBlTmFtZSA9ICJB\nUlJBWSI7CiAgICBwdWJsaWMgU3RyaW5nIGJpZ2ludFR5cGVOYW1lID0gIkJJ\nR0lOVCI7CiAgICBwdWJsaWMgU3RyaW5nIGJpbmFyeVR5cGVOYW1lID0gIkJJ\nTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5nIGJpdFR5cGVOYW1lID0gIkJJVCI7\nCiAgICBwdWJsaWMgU3RyaW5nIGJsb2JUeXBlTmFtZSA9ICJCTE9CIjsKICAg\nIHB1YmxpYyBTdHJpbmcgYm9vbGVhblR5cGVOYW1lID0gIkJPT0xFQU4iOwog\nICAgcHVibGljIFN0cmluZyBjaGFyVHlwZU5hbWUgPSAiQ0hBUiI7CiAgICBw\ndWJsaWMgU3RyaW5nIGNsb2JUeXBlTmFtZSA9ICJDTE9CIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgZGF0ZVR5cGVOYW1lID0gIkRBVEUiOwogICAgcHVibGljIFN0\ncmluZyBkZWNpbWFsVHlwZU5hbWUgPSAiREVDSU1BTCI7CiAgICBwdWJsaWMg\nU3RyaW5nIGRpc3RpbmN0VHlwZU5hbWUgPSAiRElTVElOQ1QiOwogICAgcHVi\nbGljIFN0cmluZyBkb3VibGVUeXBlTmFtZSA9ICJET1VCTEUiOwogICAgcHVi\nbGljIFN0cmluZyBmbG9hdFR5cGVOYW1lID0gIkZMT0FUIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgaW50ZWdlclR5cGVOYW1lID0gIklOVEVHRVIiOwogICAgcHVi\nbGljIFN0cmluZyBqYXZhT2JqZWN0VHlwZU5hbWUgPSAiSkFWQV9PQkpFQ1Qi\nOwogICAgcHVibGljIFN0cmluZyBsb25nVmFyYmluYXJ5VHlwZU5hbWUgPSAi\nTE9OR1ZBUkJJTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5nIGxvbmdWYXJjaGFy\nVHlwZU5hbWUgPSAiTE9OR1ZBUkNIQVIiOwogICAgcHVibGljIFN0cmluZyBu\ndWxsVHlwZU5hbWUgPSAiTlVMTCI7CiAgICBwdWJsaWMgU3RyaW5nIG51bWVy\naWNUeXBlTmFtZSA9ICJOVU1FUklDIjsKICAgIHB1YmxpYyBTdHJpbmcgb3Ro\nZXJUeXBlTmFtZSA9ICJPVEhFUiI7CiAgICBwdWJsaWMgU3RyaW5nIHJlYWxU\neXBlTmFtZSA9ICJSRUFMIjsKICAgIHB1YmxpYyBTdHJpbmcgcmVmVHlwZU5h\nbWUgPSAiUkVGIjsKICAgIHB1YmxpYyBTdHJpbmcgc21hbGxpbnRUeXBlTmFt\nZSA9ICJTTUFMTElOVCI7CiAgICBwdWJsaWMgU3RyaW5nIHN0cnVjdFR5cGVO\nYW1lID0gIlNUUlVDVCI7CiAgICBwdWJsaWMgU3RyaW5nIHRpbWVUeXBlTmFt\nZSA9ICJUSU1FIjsKICAgIHB1YmxpYyBTdHJpbmcgdGltZXN0YW1wVHlwZU5h\nbWUgPSAiVElNRVNUQU1QIjsKICAgIHB1YmxpYyBTdHJpbmcgdGlueWludFR5\ncGVOYW1lID0gIlRJTllJTlQiOwogICAgcHVibGljIFN0cmluZyB2YXJiaW5h\ncnlUeXBlTmFtZSA9ICJWQVJCSU5BUlkiOwogICAgcHVibGljIFN0cmluZyB2\nYXJjaGFyVHlwZU5hbWUgPSAiVkFSQ0hBUiI7CiAgICBwdWJsaWMgU3RyaW5n\nIHhtbFR5cGVOYW1lID0gIlhNTCI7CiAgICBwdWJsaWMgU3RyaW5nIGdldFN0\ncmluZ1ZhbCA9ICIiOwoKICAgIC8vIHNjaGVtYSBtZXRhZGF0YQogICAgcHVi\nbGljIGJvb2xlYW4gdXNlU2NoZW1hTmFtZSA9IHRydWU7CiAgICBwdWJsaWMg\nU3RyaW5nIHRhYmxlVHlwZXMgPSAiVEFCTEUiOwogICAgcHVibGljIGJvb2xl\nYW4gc3VwcG9ydHNTY2hlbWFGb3JHZXRUYWJsZXMgPSB0cnVlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNTY2hlbWFGb3JHZXRDb2x1bW5zID0gdHJ1\nZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0\nQ29sdW1ucyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c051\nbGxUYWJsZUZvckdldFByaW1hcnlLZXlzID0gZmFsc2U7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c051bGxUYWJsZUZvckdldEluZGV4SW5mbyA9IGZh\nbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNOdWxsVGFibGVGb3JH\nZXRJbXBvcnRlZEtleXMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHVz\nZUdldEJlc3RSb3dJZGVudGlmaWVyRm9yUHJpbWFyeUtleXMgPSBmYWxzZTsK\nICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQXV0b0NvbW1pdEZvck1ldGFE\nYXRhID0gZmFsc2U7CgogICAgLy8gYXV0by1pbmNyZW1lbnQKICAgIHB1Ymxp\nYyBpbnQgbWF4QXV0b0Fzc2lnbk5hbWVMZW5ndGggPSAzMTsKICAgIHB1Ymxp\nYyBTdHJpbmcgYXV0b0Fzc2lnbkNsYXVzZSA9IG51bGw7CiAgICBwdWJsaWMg\nU3RyaW5nIGF1dG9Bc3NpZ25UeXBlTmFtZSA9IG51bGw7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c0F1dG9Bc3NpZ24gPSBmYWxzZTsKICAgIHB1Ymxp\nYyBTdHJpbmcgbGFzdEdlbmVyYXRlZEtleVF1ZXJ5ID0gbnVsbDsKICAgIHB1\nYmxpYyBTdHJpbmcgbmV4dFNlcXVlbmNlUXVlcnkgPSBudWxsOwogICAgcHVi\nbGljIFN0cmluZyBzZXF1ZW5jZVNRTCA9IG51bGw7CiAgICBwdWJsaWMgU3Ry\naW5nIHNlcXVlbmNlU2NoZW1hU1FMID0gbnVsbDsKICAgIHB1YmxpYyBTdHJp\nbmcgc2VxdWVuY2VOYW1lU1FMID0gbnVsbDsKICAgIC8vIG1vc3QgbmF0aXZl\nIHNlcXVlbmNlcyBjYW4gYmUgcnVuIGluc2lkZSB0aGUgYnVzaW5lc3MgdHJh\nbnNhY3Rpb24KICAgIHB1YmxpYyBpbnQgbmF0aXZlU2VxdWVuY2VUeXBlPSBT\nZXEuVFlQRV9UUkFOU0FDVElPTkFMOwoKICAgIHByb3RlY3RlZCBKREJDQ29u\nZmlndXJhdGlvbiBjb25mID0gbnVsbDsKICAgIHByb3RlY3RlZCBMb2cgbG9n\nID0gbnVsbDsKICAgIHByb3RlY3RlZCBib29sZWFuIGNvbm5lY3RlZCA9IGZh\nbHNlOwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNKREJDMyA9IGZhbHNlOwog\nICAgcHJvdGVjdGVkIGZpbmFsIFNldCByZXNlcnZlZFdvcmRTZXQgPSBuZXcg\nSGFzaFNldCgpOwogICAgcHJvdGVjdGVkIGZpbmFsIFNldCBzeXN0ZW1TY2hl\nbWFTZXQgPSBuZXcgSGFzaFNldCgpOwogICAgcHJvdGVjdGVkIGZpbmFsIFNl\ndCBzeXN0ZW1UYWJsZVNldCA9IG5ldyBIYXNoU2V0KCk7CiAgICBwcm90ZWN0\nZWQgZmluYWwgU2V0IGZpeGVkU2l6ZVR5cGVOYW1lU2V0ID0gbmV3IEhhc2hT\nZXQoKTsKICAgIHByb3RlY3RlZCBmaW5hbCBTZXQgdHlwZU1vZGlmaWVyU2V0\nID0gbmV3IEhhc2hTZXQoKTsKCiAgICAvKioKICAgICAqIElmIGEgbmF0aXZl\nIHF1ZXJ5IGJlZ2lucyB3aXRoIGFueSBvZiB0aGUgdmFsdWVzIGZvdW5kIGhl\ncmUgdGhlbiBpdCB3aWxsCiAgICAgKiBiZSB0cmVhdGVkIGFzIGEgc2VsZWN0\nIHN0YXRlbWVudC4gIAogICAgICovCiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0\nIHNlbGVjdFdvcmRTZXQgPSBuZXcgSGFzaFNldCgpOwoKICAgIC8vIHdoZW4g\nd2Ugc3RvcmUgdmFsdWVzIHRoYXQgbG9zZSBwcmVjaW9uLCB0cmFjayB0aGUg\ndHlwZXMgc28gdGhhdCB0aGUKICAgIC8vIGZpcnN0IHRpbWUgaXQgaGFwcGVu\ncyB3ZSBjYW4gd2FybiB0aGUgdXNlcgogICAgcHJpdmF0ZSBTZXQgX3ByZWNp\nc2lvbldhcm5lZFR5cGVzID0gbnVsbDsKCiAgICAvLyBjYWNoZSBsb2IgbWV0\naG9kcwogICAgcHJpdmF0ZSBNZXRob2QgX3NldEJ5dGVzID0gbnVsbDsKICAg\nIHByaXZhdGUgTWV0aG9kIF9zZXRTdHJpbmcgPSBudWxsOwogICAgcHJpdmF0\nZSBNZXRob2QgX3NldENoYXJTdHJlYW0gPSBudWxsOwoKICAgIC8vIGJhdGNo\nTGltaXQgdmFsdWU6CiAgICAvLyAtMSA9IHVubGltaXRlZAogICAgLy8gMCAg\nPSBubyBiYXRjaAogICAgLy8gYW55IHBvc2l0aXZlIG51bWJlciA9IGJhdGNo\nIGxpbWl0CiAgICBwdWJsaWMgaW50IGJhdGNoTGltaXQgPSBOT19CQVRDSDsK\nICAgIAogICAgcHVibGljIGZpbmFsIE1hcDxJbnRlZ2VyLFNldDxTdHJpbmc+\nPiBzcWxTdGF0ZUNvZGVzID0gCiAgICAJbmV3IEhhc2hNYXA8SW50ZWdlciwg\nU2V0PFN0cmluZz4+KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAKICAgIHB1YmxpYyBEQkRpY3Rpb25hcnkoKSB7\nCiAgICAgICAgZml4ZWRTaXplVHlwZU5hbWVTZXQuYWRkQWxsKEFycmF5cy5h\nc0xpc3QobmV3IFN0cmluZ1tdewogICAgICAgICAgICAiQklHSU5UIiwgIkJJ\nVCIsICJCTE9CIiwgIkNMT0IiLCAiREFURSIsICJERUNJTUFMIiwgIkRJU1RJ\nTkNUIiwKICAgICAgICAgICAgIkRPVUJMRSIsICJGTE9BVCIsICJJTlRFR0VS\nIiwgIkpBVkFfT0JKRUNUIiwgIk5VTEwiLCAiTlVNRVJJQyIsCiAgICAgICAg\nICAgICJPVEhFUiIsICJSRUFMIiwgIlJFRiIsICJTTUFMTElOVCIsICJTVFJV\nQ1QiLCAiVElNRSIsICJUSU1FU1RBTVAiLAogICAgICAgICAgICAiVElOWUlO\nVCIsCiAgICAgICAgfSkpOwogICAgICAgIAogICAgICAgIHNlbGVjdFdvcmRT\nZXQuYWRkKCJTRUxFQ1QiKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMg\nbWV0aG9kIGlzIGNhbGxlZCB3aGVuIHRoZSBkaWN0aW9uYXJ5IGZpcnN0IHNl\nZXMgYW55IGNvbm5lY3Rpb24uCiAgICAgKiBJdCBpcyB1c2VkIHRvIGluaXRp\nYWxpemUgZGljdGlvbmFyeSBtZXRhZGF0YSBpZiBuZWVkZWQuIElmIHlvdQog\nICAgICogb3ZlcnJpZGUgdGhpcyBtZXRob2QsIGJlIHN1cmUgdG8gY2FsbAog\nICAgICogPGNvZGU+c3VwZXIuY29ubmVjdGVkQ29uZmlndXJhdGlvbjwvY29k\nZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNvbm5lY3RlZENvbmZpZ3Vy\nYXRpb24oQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmICghY29ubmVjdGVkKSB7CiAgICAgICAgICAg\nIERhdGFiYXNlTWV0YURhdGEgbWV0YURhdGEgPSBudWxsOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgbWV0YURhdGEgPSBjb25uLmdldE1l\ndGFEYXRhKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIC8vIEpEQkMzLW9ubHkgbWV0aG9kLCBzbyBpdCBtaWdodCB0aHJv\ndyBhIAogICAgICAgICAgICAgICAgICAgIC8vIEFic3RyYWN0TWV0aG9kRXJy\nb3IKICAgICAgICAgICAgICAgICAgICBpc0pEQkMzID0gbWV0YURhdGEuZ2V0\nSkRCQ01ham9yVmVyc2lvbigpID49IDM7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICAgICAgICAgIC8vIGln\nbm9yZSBpZiBub3QgSkRCQzMKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIGlm\nIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBs\nb2cudHJhY2UoZS50b1N0cmluZygpLCBlKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKSB7ICAgICAgICAg\nICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvZy50cmFjZShEQkRpY3Rp\nb25hcnlGYWN0b3J5LnRvU3RyaW5nKG1ldGFEYXRhKSk7CgogICAgICAgICAg\nICAgICAgaWYgKGlzSkRCQzMpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJjb25uZWN0aW9uLWRlZmF1bHRzIiwgbmV3IE9iamVj\ndFtdewogICAgICAgICAgICAgICAgICAgICAgICBjb25uLmdldEF1dG9Db21t\naXQoKSwgY29ubi5nZXRIb2xkYWJpbGl0eSgpLAogICAgICAgICAgICAgICAg\nICAgICAgICBjb25uLmdldFRyYW5zYWN0aW9uSXNvbGF0aW9uKCl9KSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29ubmVjdGVkID0gdHJ1\nZTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBS\nZXN1bHRTZXQgd3JhcHBlcnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4g\nb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2\nYSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQXJyYXkgZ2V0QXJyYXkoUmVz\ndWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRBcnJheShjb2x1bW4pOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNv\nbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAg\nKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBJbnB1dFN0cmVhbSBn\nZXRBc2NpaVN0cmVhbShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdl\ndEFzY2lpU3RyZWFtKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0\nU2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwog\nICAgcHVibGljIEJpZ0RlY2ltYWwgZ2V0QmlnRGVjaW1hbChSZXN1bHRTZXQg\ncnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSB7CiAg\nICAgICAgICAgIFN0cmluZyBzdHIgPSBnZXRTdHJpbmcocnMsIGNvbHVtbik7\nCiAgICAgICAgICAgIHJldHVybiAoc3RyID09IG51bGwpID8gbnVsbCA6IG5l\ndyBCaWdEZWNpbWFsKHN0cik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBy\ncy5nZXRCaWdEZWNpbWFsKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHRoZSBzcGVjaWZpZWQgY29sdW1uIHZhbHVlIGFzIGFuIHVu\na25vd24gbnVtZXJpYyB0eXBlOwogICAgICogd2UgdHJ5IGZyb20gdGhlIG1v\nc3QgZ2VuZXJpYyB0byB0aGUgbGVhc3QgZ2VuZXJpYy4KICAgICAqLwogICAg\ncHVibGljIE51bWJlciBnZXROdW1iZXIoUmVzdWx0U2V0IHJzLCBpbnQgY29s\ndW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8v\nIHRyeSBmcm9tIHRoZSBtb3N0IGdlbmVyaWMsIGFuZCBpZiBlcnJvcnMgb2Nj\ndXIsIHRyeQogICAgICAgIC8vIGxlc3MgZ2VuZXJpYyB0eXBlczsgdGhpcyBl\nbmFibGVzIHVzIHRvIGhhbmRsZSB2YWx1ZXMKICAgICAgICAvLyBsaWtlIERv\ndWJsZS5OYU4gd2l0aG91dCBoYXZpbmcgdG8gaW50cm9zcGVjdCBvbiB0aGUK\nICAgICAgICAvLyBSZXN1bHRTZXRNZXRhRGF0YSAoYnVnICMxMDUzKS4gbm90\nZSB0aGF0IHdlIGhhbmRsZQogICAgICAgIC8vIGdlbmVyaWMgZXhjZXB0aW9u\ncywgc2luY2Ugc29tZSBkcml2ZXJzIG1heSB0aHJvdwogICAgICAgIC8vIE51\nbWJlckZvcm1hdEV4Y2VwdGlvbnMsIHdoZXJlYXMgb3RoZXJzIG1heSB0aHJv\ndyBTUUxFeGNlcHRpb25zCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0\ndXJuIGdldEJpZ0RlY2ltYWwocnMsIGNvbHVtbik7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUxKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IERvdWJsZShnZXREb3VibGUocnMsIGNvbHVt\nbikpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZTIpIHsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBGbG9hdChnZXRGbG9hdChycywgY29sdW1uKSk7CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZTMpIHsKICAgICAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTnVt\nYmVycy52YWx1ZU9mKGdldExvbmcocnMsIGNvbHVtbikpOwogICAgICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlNCkgewogICAgICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihnZXRJbnQocnMsIGNvbHVtbikp\nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZTUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgaWYgKGUxIGluc3RhbmNlb2YgUnVudGltZUV4Y2VwdGlvbikK\nICAgICAgICAgICAgICAgIHRocm93KFJ1bnRpbWVFeGNlcHRpb24pIGUxOwog\nICAgICAgICAgICBpZiAoZTEgaW5zdGFuY2VvZiBTUUxFeGNlcHRpb24pCiAg\nICAgICAgICAgICAgICB0aHJvdyhTUUxFeGNlcHRpb24pIGUxOwogICAgICAg\nIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVz\ndWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAq\nLwogICAgcHVibGljIEJpZ0ludGVnZXIgZ2V0QmlnSW50ZWdlcihSZXN1bHRT\nZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSB7\nCiAgICAgICAgICAgIFN0cmluZyBzdHIgPSBnZXRTdHJpbmcocnMsIGNvbHVt\nbik7CiAgICAgICAgICAgIHJldHVybiAoc3RyID09IG51bGwpID8gbnVsbCA6\nIG5ldyBCaWdEZWNpbWFsKHN0cikudG9CaWdJbnRlZ2VyKCk7CiAgICAgICAg\nfQogICAgICAgIEJpZ0RlY2ltYWwgYmQgPSBnZXRCaWdEZWNpbWFsKHJzLCBj\nb2x1bW4pOwogICAgICAgIHJldHVybiAoYmQgPT0gbnVsbCkgPyBudWxsIDog\nYmQudG9CaWdJbnRlZ2VyKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0\nIHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIElucHV0U3RyZWFtIGdldEJpbmFyeVN0cmVhbShSZXN1bHRTZXQg\ncnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIHJzLmdldEJpbmFyeVN0cmVhbShjb2x1bW4pOwog\nICAgfQoKICAgIHB1YmxpYyBJbnB1dFN0cmVhbSBnZXRMT0JTdHJlYW0oSkRC\nQ1N0b3JlIHN0b3JlLCBSZXN1bHRTZXQgcnMsCiAgICAgICAgaW50IGNvbHVt\nbikgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdl\ndEJpbmFyeVN0cmVhbShjb2x1bW4pOwogICAgfQogICAgCiAgICAvKioKICAg\nICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBS\nZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAg\nICovCiAgICBwdWJsaWMgQmxvYiBnZXRCbG9iKFJlc3VsdFNldCBycywgaW50\nIGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gcnMuZ2V0QmxvYihjb2x1bW4pOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FM\nIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAg\nICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0QmxvYk9iamVjdChSZXN1bHRT\nZXQgcnMsIGludCBjb2x1bW4sIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBJbnB1dFN0cmVhbSBpbiA9\nIG51bGw7CiAgICAgICAgaWYgKHVzZUdldEJ5dGVzRm9yQmxvYnMgfHwgdXNl\nR2V0T2JqZWN0Rm9yQmxvYnMpIHsKICAgICAgICAgICAgYnl0ZVtdIGJ5dGVz\nID0gZ2V0Qnl0ZXMocnMsIGNvbHVtbik7CiAgICAgICAgICAgIGlmIChieXRl\ncyAhPSBudWxsICYmIGJ5dGVzLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAg\nICBpbiA9IG5ldyBCeXRlQXJyYXlJbnB1dFN0cmVhbShieXRlcyk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgQmxvYiBibG9iID0gZ2V0QmxvYihy\ncywgY29sdW1uKTsKICAgICAgICAgICAgaWYgKGJsb2IgIT0gbnVsbCAmJiBi\nbG9iLmxlbmd0aCgpID4gMCkKICAgICAgICAgICAgICAgIGluID0gYmxvYi5n\nZXRCaW5hcnlTdHJlYW0oKTsKICAgICAgICB9CiAgICAgICAgaWYgKGluID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICB0cnkg\newogICAgICAgICAgICBpZiAoc3RvcmUgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybiBTZXJpYWxpemF0aW9uLmRlc2VyaWFsaXplKGluLCBudWxs\nKTsKICAgICAgICAgICAgcmV0dXJuIFNlcmlhbGl6YXRpb24uZGVzZXJpYWxp\nemUoaW4sIHN0b3JlLmdldENvbnRleHQoKSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGluLmNsb3Nl\nKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3Vs\ndFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGdldEJvb2xlYW4oUmVzdWx0U2V0IHJzLCBp\nbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHJldHVybiBycy5nZXRCb29sZWFuKGNvbHVtbik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRo\nZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlw\nZS4KICAgICAqLwogICAgcHVibGljIGJ5dGUgZ2V0Qnl0ZShSZXN1bHRTZXQg\ncnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIHJzLmdldEJ5dGUoY29sdW1uKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgYnl0ZVtdIGdldEJ5dGVzKFJlc3Vs\ndFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAodXNlR2V0Qnl0ZXNGb3JCbG9icykKICAgICAg\nICAgICAgcmV0dXJuIHJzLmdldEJ5dGVzKGNvbHVtbik7CiAgICAgICAgaWYg\nKHVzZUdldE9iamVjdEZvckJsb2JzKQogICAgICAgICAgICByZXR1cm4gKGJ5\ndGVbXSkgcnMuZ2V0T2JqZWN0KGNvbHVtbik7CgogICAgICAgIEJsb2IgYmxv\nYiA9IGdldEJsb2IocnMsIGNvbHVtbik7CiAgICAgICAgaWYgKGJsb2IgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaW50IGxl\nbmd0aCA9IChpbnQpIGJsb2IubGVuZ3RoKCk7CiAgICAgICAgaWYgKGxlbmd0\naCA9PSAwKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1\ncm4gYmxvYi5nZXRCeXRlcygxLCBsZW5ndGgpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FM\nIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuIENv\nbnZlcnRzIHRoZSBkYXRlIGZyb20gYSB7QGxpbmsgVGltZXN0YW1wfSBieSBk\nZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgQ2FsZW5kYXIgZ2V0Q2FsZW5k\nYXIoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIERhdGUgZCA9IGdldERhdGUocnMsIGNv\nbHVtbik7CiAgICAgICAgaWYgKGQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIENhbGVuZGFyIGNhbCA9IENhbGVuZGFyLmdl\ndEluc3RhbmNlKCk7CiAgICAgICAgY2FsLnNldFRpbWUoZCk7CiAgICAgICAg\ncmV0dXJuIGNhbDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhl\nIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhl\nIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMg\nY2hhciBnZXRDaGFyKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc3RvcmVDaGFy\nc0FzTnVtYmVycykKICAgICAgICAgICAgcmV0dXJuIChjaGFyKSBnZXRJbnQo\ncnMsIGNvbHVtbik7CgogICAgICAgIFN0cmluZyBzdHIgPSBnZXRTdHJpbmco\ncnMsIGNvbHVtbik7CiAgICAgICAgcmV0dXJuIChTdHJpbmdVdGlscy5pc0Vt\ncHR5KHN0cikpID8gMCA6IHN0ci5jaGFyQXQoMCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBT\nUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4K\nICAgICAqLwogICAgcHVibGljIFJlYWRlciBnZXRDaGFyYWN0ZXJTdHJlYW0o\nUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRDaGFyYWN0ZXJTdHJl\nYW0oY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhl\nIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhl\nIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMg\nQ2xvYiBnZXRDbG9iKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0\nQ2xvYihjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0\naGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0\naGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0Q2xvYlN0cmluZyhSZXN1bHRTZXQgcnMsIGludCBjb2x1\nbW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKHVzZUdldFN0cmluZ0ZvckNsb2JzKQogICAgICAgICAgICByZXR1cm4gcnMu\nZ2V0U3RyaW5nKGNvbHVtbik7CgogICAgICAgIENsb2IgY2xvYiA9IGdldENs\nb2IocnMsIGNvbHVtbik7CiAgICAgICAgaWYgKGNsb2IgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGNsb2IubGVuZ3Ro\nKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuICIiOwoKICAgICAgICAvLyB1\nbmxpa2VseSB0aGF0IHdlJ2xsIGhhdmUgc3RyaW5ncyBvdmVyIEludGVnZXIu\nTUFYX1ZBTFVFIGNoYXJzCiAgICAgICAgcmV0dXJuIGNsb2IuZ2V0U3ViU3Ry\naW5nKDEsIChpbnQpIGNsb2IubGVuZ3RoKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FM\nIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuIENv\nbnZlcnRzIHRoZSBkYXRlIGZyb20gYSB7QGxpbmsgVGltZXN0YW1wfSBieSBk\nZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgRGF0ZSBnZXREYXRlKFJlc3Vs\ndFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBUaW1lc3RhbXAgdHN0YW1wID0gZ2V0VGltZXN0YW1w\nKHJzLCBjb2x1bW4sIG51bGwpOwogICAgICAgIGlmICh0c3RhbXAgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGdldCB0\naGUgZnJhY3Rpb25hbCBzZWNvbmRzIGNvbXBvbmVudCwgcm91bmRpbmcgYXdh\neSBhbnl0aGluZyBiZXlvbmQKICAgICAgICAvLyBtaWxsaXNlY29uZHMKICAg\nICAgICBpbnQgZnJhY3Rpb25hbCA9IChpbnQpIE1hdGgucm91bmQodHN0YW1w\nLmdldE5hbm9zKCkgLyAoZG91YmxlKSBNSUxMSSk7CgogICAgICAgIC8vIGdl\ndCB0aGUgbWlsbGlzIGNvbXBvbmVudDsgc29tZSBKREJDIGRyaXZlcnMgcm91\nbmQgdGhpcyB0byB0aGUKICAgICAgICAvLyBuZWFyZXN0IHNlY29uZCwgd2hp\nbGUgb3RoZXJzIGRvIG5vdAogICAgICAgIGxvbmcgbWlsbGlzID0gKHRzdGFt\ncC5nZXRUaW1lKCkgLyAxMDAwTCkgKiAxMDAwTDsKICAgICAgICByZXR1cm4g\nbmV3IERhdGUobWlsbGlzICsgZnJhY3Rpb25hbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBT\nUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4K\nICAgICAqLwogICAgcHVibGljIGphdmEuc3FsLkRhdGUgZ2V0RGF0ZShSZXN1\nbHRTZXQgcnMsIGludCBjb2x1bW4sIENhbGVuZGFyIGNhbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY2FsID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBycy5nZXREYXRlKGNvbHVtbik7CiAgICAg\nICAgcmV0dXJuIHJzLmdldERhdGUoY29sdW1uLCBjYWwpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0\naGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyBkb3VibGUgZ2V0RG91YmxlKFJlc3Vs\ndFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0RG91YmxlKGNvbHVtbik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29s\ndW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAq\nIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGZsb2F0IGdldEZsb2F0\nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0RmxvYXQoY29sdW1u\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmll\nZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3Blcgog\nICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldElu\ndChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEludChjb2x1bW4p\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVk\nIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAg\nICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBMb2NhbGUgZ2V0\nTG9jYWxlKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgc3RyID0gZ2V0U3Ry\naW5nKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0Vt\ncHR5KHN0cikpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBT\ndHJpbmdbXSBwYXJhbXMgPSBTdHJpbmdzLnNwbGl0KHN0ciwgIl8iLCAzKTsK\nICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA8IDMpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIHJldHVybiBuZXcgTG9jYWxlKHBhcmFtc1sw\nXSwgcGFyYW1zWzFdLCBwYXJhbXNbMl0pOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJl\nc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBsb25nIGdldExvbmcoUmVzdWx0U2V0IHJzLCBpbnQg\nY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBycy5nZXRMb25nKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwg\nUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAg\nICAqLwogICAgcHVibGljIE9iamVjdCBnZXRPYmplY3QoUmVzdWx0U2V0IHJz\nLCBpbnQgY29sdW1uLCBNYXAgbWFwKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmIChtYXAgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIHJzLmdldE9iamVjdChjb2x1bW4pOwogICAgICAgIHJldHVybiBy\ncy5nZXRPYmplY3QoY29sdW1uLCBtYXApOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJl\nc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBSZWYgZ2V0UmVmKFJlc3VsdFNldCBycywgaW50IGNv\nbHVtbiwgTWFwIG1hcCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gcnMuZ2V0UmVmKGNvbHVtbik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRo\nZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlw\nZS4KICAgICAqLwogICAgcHVibGljIHNob3J0IGdldFNob3J0KFJlc3VsdFNl\ndCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gcnMuZ2V0U2hvcnQoY29sdW1uKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4g\nb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2\nYSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFN0cmluZyhS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldFN0cmluZyhjb2x1bW4p\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVk\nIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAg\nICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBUaW1lIGdldFRp\nbWUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBDYWxlbmRhciBjYWwpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0VGltZShjb2x1bW4p\nOwogICAgICAgIHJldHVybiBycy5nZXRUaW1lKGNvbHVtbiwgY2FsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1\nbW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICog\namF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgVGltZXN0YW1wIGdldFRp\nbWVzdGFtcChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIENhbGVuZGFyIGNh\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nY2FsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBycy5nZXRUaW1lc3Rh\nbXAoY29sdW1uKTsKICAgICAgICByZXR1cm4gcnMuZ2V0VGltZXN0YW1wKGNv\nbHVtbiwgY2FsKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIFByZXBhcmVkU3RhdGVtZW50IHdyYXBwZXJzCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhl\nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QXJyYXko\nUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIEFycmF5IHZhbCwK\nICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHN0bW50LnNldEFycmF5KGlkeCwgdmFsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJh\nbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0QXNjaWlTdHJlYW0oUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGlu\ndCBpZHgsCiAgICAgICAgSW5wdXRTdHJlYW0gdmFsLCBpbnQgbGVuZ3RoLCBD\nb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHN0bW50LnNldEFzY2lpU3RyZWFtKGlkeCwgdmFsLCBsZW5ndGgpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBh\nIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRCaWdEZWNpbWFsKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LCBCaWdEZWNpbWFsIHZhbCwKICAgICAgICBDb2x1bW4gY29s\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICgo\nY29sICE9IG51bGwgJiYgY29sLmlzQ29tcGF0aWJsZShUeXBlcy5WQVJDSEFS\nLCBudWxsLCAwLCAwKSkKICAgICAgICAgICAgfHwgKGNvbCA9PSBudWxsICYm\nIHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSkKICAgICAgICAgICAgc2V0\nU3RyaW5nKHN0bW50LCBpZHgsIHZhbC50b1N0cmluZygpLCBjb2wpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgc3RtbnQuc2V0QmlnRGVjaW1hbChpZHgs\nIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZh\nbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldEJpZ0ludGVnZXIoUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQsIGludCBpZHgsIEJpZ0ludGVnZXIgdmFsLAogICAgICAgIENv\nbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKChjb2wgIT0gbnVsbCAmJiBjb2wuaXNDb21wYXRpYmxlKFR5cGVz\nLlZBUkNIQVIsIG51bGwsIDAsIDApKQogICAgICAgICAgICB8fCAoY29sID09\nIG51bGwgJiYgc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MpKQogICAgICAg\nICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLnRvU3RyaW5nKCksIGNv\nbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRCaWdEZWNpbWFsKHN0\nbW50LCBpZHgsIG5ldyBCaWdEZWNpbWFsKHZhbCksIGNvbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1l\ndGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEJpbmFyeVN0cmVhbShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50\nIGlkeCwKICAgICAgICBJbnB1dFN0cmVhbSB2YWwsIGludCBsZW5ndGgsIENv\nbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgc3RtbnQuc2V0QmluYXJ5U3RyZWFtKGlkeCwgdmFsLCBsZW5ndGgpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBh\nIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRCbG9iKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQg\naWR4LCBCbG9iIHZhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRCbG9iKGlkeCwgdmFsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMg\nYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4gVXNlcyB0aGUKICAgICAq\nIHtAbGluayAjc2VyaWFsaXplfSBtZXRob2QgdG8gc2VyaWFsaXplIHRoZSB2\nYWx1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QmxvYk9iamVjdChQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgT2JqZWN0IHZhbCwK\nICAgICAgICBDb2x1bW4gY29sLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0Qnl0ZXMoc3RtbnQs\nIGlkeCwgc2VyaWFsaXplKHZhbCwgc3RvcmUpLCBjb2wpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRl\nciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRCb29sZWFuKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBi\nb29sZWFuIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldEludChpZHgsICh2\nYWwpID8gMSA6IDApOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBn\naXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCeXRlKFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBpbnQgaWR4LCBieXRlIHZhbCwgQ29sdW1uIGNvbCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRC\neXRlKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\nZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Qnl0ZXMoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsIGJ5dGVbXSB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAodXNlU2V0Qnl0ZXNGb3JCbG9icykKICAgICAgICAgICAgc3RtbnQu\nc2V0Qnl0ZXMoaWR4LCB2YWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc2V0QmluYXJ5U3RyZWFtKHN0bW50LCBpZHgsIG5ldyBCeXRlQXJyYXlJbnB1\ndFN0cmVhbSh2YWwpLAogICAgICAgICAgICAgICAgdmFsLmxlbmd0aCwgY29s\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0Q2hhcihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwg\naW50IGlkeCwgY2hhciB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKChjb2wgIT0gbnVsbCAmJiBj\nb2wuaXNDb21wYXRpYmxlKFR5cGVzLklOVEVHRVIsIG51bGwsIDAsIDApKQog\nICAgICAgICAgICB8fCAoY29sID09IG51bGwgJiYgc3RvcmVDaGFyc0FzTnVt\nYmVycykpCiAgICAgICAgICAgIHNldEludChzdG1udCwgaWR4LCAoaW50KSB2\nYWwsIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRTdHJpbmco\nc3RtbnQsIGlkeCwgU3RyaW5nLnZhbHVlT2YodmFsKSwgY29sKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJh\nbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0Q2hhcmFjdGVyU3RyZWFtKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LAogICAgICAgIFJlYWRlciB2YWwsIGludCBsZW5ndGgsIENv\nbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgc3RtbnQuc2V0Q2hhcmFjdGVyU3RyZWFtKGlkeCwgdmFsLCBsZW5ndGgp\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBh\ncyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRDbG9iKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBDbG9iIHZhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRDbG9iKGlkeCwgdmFs\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0Q2xvYlN0cmluZyhQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgaW50IGlkeCwgU3RyaW5nIHZhbCwKICAgICAgICBDb2x1bW4gY29s\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh1\nc2VTZXRTdHJpbmdGb3JDbG9icykKICAgICAgICAgICAgc3RtbnQuc2V0U3Ry\naW5nKGlkeCwgdmFsKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8g\nc2V0IHJlYWRlciBmcm9tIHN0cmluZwogICAgICAgICAgICBTdHJpbmdSZWFk\nZXIgaW4gPSBuZXcgU3RyaW5nUmVhZGVyKHZhbCk7CiAgICAgICAgICAgIHNl\ndENoYXJhY3RlclN0cmVhbShzdG1udCwgaWR4LCBpbiwgdmFsLmxlbmd0aCgp\nLCBjb2wpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVu\ndC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGF0ZShQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgaW50IGlkeCwgRGF0ZSB2YWwsIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNv\nbCAhPSBudWxsICYmIGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMuREFURSkKICAg\nICAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCBuZXcgamF2YS5zcWwuRGF0\nZSh2YWwuZ2V0VGltZSgpKSwgbnVsbCwgY29sKTsKICAgICAgICBlbHNlIGlm\nIChjb2wgIT0gbnVsbCAmJiBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLlRJTUUp\nCiAgICAgICAgICAgIHNldFRpbWUoc3RtbnQsIGlkeCwgbmV3IFRpbWUodmFs\nLmdldFRpbWUoKSksIG51bGwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFs\nIGluc3RhbmNlb2YgVGltZXN0YW1wKQogICAgICAgICAgICBzZXRUaW1lc3Rh\nbXAoc3RtbnQsIGlkeCwoVGltZXN0YW1wKSB2YWwsIG51bGwsIGNvbCk7ICAg\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3RtbnQs\nIGlkeCwgbmV3IFRpbWVzdGFtcCh2YWwuZ2V0VGltZSgpKSwgbnVsbCwgY29s\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0RGF0ZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwg\naW50IGlkeCwgamF2YS5zcWwuRGF0ZSB2YWwsCiAgICAgICAgQ2FsZW5kYXIg\nY2FsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQu\nc2V0RGF0ZShpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\ndG1udC5zZXREYXRlKGlkeCwgdmFsLCBjYWwpOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0\naGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDYWxl\nbmRhcihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgQ2FsZW5k\nYXIgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYnkgZGVmYXVsdCB3ZSBtZXJlbHkg\nZGVsZWdhdGUgdGhlIHRoZSBEYXRlIHBhcmFtZXRlcgogICAgICAgIHNldERh\ndGUoc3RtbnQsIGlkeCwgdmFsLmdldFRpbWUoKSwgY29sKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0\nZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0RG91YmxlKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBk\nb3VibGUgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0RG91YmxlKGlkeCwg\ndmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFs\ndWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0RmxvYXQoUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIGludCBpZHgsIGZsb2F0IHZhbCwKICAgICAgICBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNl\ndEZsb2F0KGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVu\ndC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW50KFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50LCBpbnQgaWR4LCBpbnQgdmFsLCBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNl\ndEludChpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhl\nIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldExvbmcoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsIGxvbmcgdmFsLCBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNl\ndExvbmcoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRMb2NhbGUoUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIExvY2FsZSB2YWwsCiAgICAgICAg\nQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLmdldExhbmd1YWdlKCkg\nKyAiXyIgKyB2YWwuZ2V0Q291bnRyeSgpCiAgICAgICAgICAgICsgIl8iICsg\ndmFsLmdldFZhcmlhbnQoKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXJzIHRvIHRoZSBz\ndGF0ZW1lbnQuIFRoZSBjb2x1bW4KICAgICAqIHR5cGUgd2lsbCBjb21lIGZy\nb20ge0BsaW5rIFR5cGVzfS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nTnVsbChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgaW50IGNv\nbFR5cGUsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXROdWxsKGlkeCwgY29sVHlw\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVl\nIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldE51bWJlcihQcmVwYXJlZFN0YXRlbWVudCBzdG1u\ndCwgaW50IGlkeCwgTnVtYmVyIG51bSwKICAgICAgICBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGNoZWNr\nIGZvciBrbm93biBmbG9hdGluZyBwb2ludCB0eXBlcyB0byBnaXZlIGRyaXZl\nciBhIGNoYW5jZSB0bwogICAgICAgIC8vIGhhbmRsZSBzcGVjaWFsIG51bWJl\ncnMgbGlrZSBOYU4gYW5kIGluZmluaXR5OyBidWcgIzEwNTMKICAgICAgICBp\nZiAobnVtIGluc3RhbmNlb2YgRG91YmxlKQogICAgICAgICAgICBzZXREb3Vi\nbGUoc3RtbnQsIGlkeCwgKChEb3VibGUpIG51bSkuZG91YmxlVmFsdWUoKSwg\nY29sKTsKICAgICAgICBlbHNlIGlmIChudW0gaW5zdGFuY2VvZiBGbG9hdCkK\nICAgICAgICAgICAgc2V0RmxvYXQoc3RtbnQsIGlkeCwgKChGbG9hdCkgbnVt\nKS5mbG9hdFZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBzZXRCaWdEZWNpbWFsKHN0bW50LCBpZHgsIG5ldyBCaWdEZWNpbWFsKG51\nbS50b1N0cmluZygpKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXJzIHRvIHRoZSBzdGF0\nZW1lbnQuIFRoZSBjb2x1bW4KICAgICAqIHR5cGUgd2lsbCBjb21lIGZyb20g\ne0BsaW5rIFR5cGVzfS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0T2Jq\nZWN0KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBPYmplY3Qg\ndmFsLAogICAgICAgIGludCBjb2xUeXBlLCBDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjb2xUeXBlID09\nIC0xIHx8IGNvbFR5cGUgPT0gVHlwZXMuT1RIRVIpCiAgICAgICAgICAgIHN0\nbW50LnNldE9iamVjdChpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBzdG1udC5zZXRPYmplY3QoaWR4LCB2YWwsIGNvbFR5cGUpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBh\ncmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRSZWYoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgs\nIFJlZiB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgc3RtbnQuc2V0UmVmKGlkeCwgdmFsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJh\nbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0U2hvcnQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgs\nIHNob3J0IHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldFNob3J0KGlkeCwg\ndmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFs\ndWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0U3RyaW5nKFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50LCBpbnQgaWR4LCBTdHJpbmcgdmFsLAogICAgICAgIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQu\nc2V0U3RyaW5nKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRl\nbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VGltZShQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgVGltZSB2YWwsCiAgICAgICAg\nQ2FsZW5kYXIgY2FsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChjYWwgPT0gbnVsbCkKICAgICAgICAg\nICAgc3RtbnQuc2V0VGltZShpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBzdG1udC5zZXRUaW1lKGlkeCwgdmFsLCBjYWwpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFt\nZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRUaW1lc3RhbXAoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBp\nZHgsCiAgICAgICAgVGltZXN0YW1wIHZhbCwgQ2FsZW5kYXIgY2FsLCBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIC8vIGVuc3VyZSB0aGF0IHdlIGRvIG5vdCBpbnNlcnQgZGF0ZXMgYXQgYSBn\ncmVhdGVyIHByZWNpc2lvbiB0aGFuCiAgICAgICAgLy8gdGhhdCBhdCB3aGlj\naCB0aGV5IHdpbGwgYmUgcmV0dXJuZWQgYnkgYSBTRUxFQ1QKICAgICAgICBp\nbnQgcm91bmRlZCA9IChpbnQpIE1hdGgucm91bmQodmFsLmdldE5hbm9zKCkg\nLwogICAgICAgICAgICAoZG91YmxlKSBkYXRlUHJlY2lzaW9uKTsKICAgICAg\nICBpbnQgbmFub3MgPSByb3VuZGVkICogZGF0ZVByZWNpc2lvbjsKICAgICAg\nICBpZiAobmFub3MgPiA5OTk5OTk5OTkpIHsKICAgICAgICAgICAgLy8gcm9s\nbG92ZXIgdG8gbmV4dCBzZWNvbmQKICAgICAgICAgICAgdmFsLnNldFRpbWUo\ndmFsLmdldFRpbWUoKSArIDEwMDApOwogICAgICAgICAgICBuYW5vcyA9IDA7\nCiAgICAgICAgfQoKICAgICAgICB2YWwuc2V0TmFub3MobmFub3MpOwoKICAg\nICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHN0bW50LnNldFRp\nbWVzdGFtcChpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\ndG1udC5zZXRUaW1lc3RhbXAoaWR4LCB2YWwsIGNhbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgYSBjb2x1bW4gdmFsdWUgaW50byBhIHByZXBhcmVk\nIHN0YXRlbWVudC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RtbnQgdGhlIHBy\nZXBhcmVkIHN0YXRlbWVudCB0byBwYXJhbWV0ZXJpemUKICAgICAqIEBwYXJh\nbSBpZHggdGhlIGluZGV4IG9mIHRoZSBwYXJhbWV0ZXIgaW4gdGhlIHByZXBh\ncmVkIHN0YXRlbWVudAogICAgICogQHBhcmFtIHZhbCB0aGUgdmFsdWUgb2Yg\ndGhlIGNvbHVtbgogICAgICogQHBhcmFtIGNvbCB0aGUgY29sdW1uIGJlaW5n\nIHNldAogICAgICogQHBhcmFtIHR5cGUgdGhlIGZpZWxkIG1hcHBpbmcgdHlw\nZSBjb2RlIGZvciB0aGUgdmFsdWUKICAgICAqIEBwYXJhbSBzdG9yZSB0aGUg\nc3RvcmUgbWFuYWdlciBmb3IgdGhlIGN1cnJlbnQgY29udGV4dAogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBlZChQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgaW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBDb2x1bW4gY29s\nLCBpbnQgdHlwZSwgSkRCQ1N0b3JlIHN0b3JlKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkgewogICAg\nICAgICAgICBzZXROdWxsKHN0bW50LCBpZHgsIChjb2wgPT0gbnVsbCkgPyBU\neXBlcy5PVEhFUiA6IGNvbC5nZXRUeXBlKCksCiAgICAgICAgICAgICAgICBj\nb2wpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBT\naXplZCBzOwogICAgICAgIENhbGVuZGFyZCBjOwogICAgICAgIHN3aXRjaCAo\ndHlwZSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAg\nICAgICAgICAgIHNldEJvb2xlYW4oc3RtbnQsIGlkeCwgKChCb29sZWFuKSB2\nYWwpLmJvb2xlYW5WYWx1ZSgpLCBjb2wpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAg\nc2V0Qnl0ZShzdG1udCwgaWR4LCAoKE51bWJlcikgdmFsKS5ieXRlVmFsdWUo\nKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIHNldENoYXIoc3RtbnQsIGlk\neCwgKChDaGFyYWN0ZXIpIHZhbCkuY2hhclZhbHVlKCksIGNvbCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JK\nOgogICAgICAgICAgICAgICAgc2V0RG91YmxlKHN0bW50LCBpZHgsICgoTnVt\nYmVyKSB2YWwpLmRvdWJsZVZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAg\nICAgICAgIHNldEZsb2F0KHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLmZs\nb2F0VmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICBzZXRJbnQoc3Rt\nbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuaW50VmFsdWUoKSwgY29sKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5MT05HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoK\nICAgICAgICAgICAgICAgIHNldExvbmcoc3RtbnQsIGlkeCwgKChOdW1iZXIp\nIHZhbCkubG9uZ1ZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAg\nIHNldFNob3J0KHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLnNob3J0VmFs\ndWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICBpZiAo\nY29sICE9IG51bGwgJiYgKGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMuQ0xPQgog\nICAgICAgICAgICAgICAgICAgIHx8IGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMu\nTE9OR1ZBUkNIQVIpKQogICAgICAgICAgICAgICAgICAgIHNldENsb2JTdHJp\nbmcoc3RtbnQsIGlkeCwgKFN0cmluZykgdmFsLCBjb2wpOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1u\ndCwgaWR4LCAoU3RyaW5nKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAg\nICAgICAgICAgICAgc2V0QmxvYk9iamVjdChzdG1udCwgaWR4LCB2YWwsIGNv\nbCwgc3RvcmUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBzZXREYXRl\nKHN0bW50LCBpZHgsIChEYXRlKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6\nCiAgICAgICAgICAgICAgICBzZXRDYWxlbmRhcihzdG1udCwgaWR4LCAoQ2Fs\nZW5kYXIpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAgICAg\nICAgICAgc2V0QmlnRGVjaW1hbChzdG1udCwgaWR4LCAoQmlnRGVjaW1hbCkg\ndmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAgICAgICBz\nZXRCaWdJbnRlZ2VyKHN0bW50LCBpZHgsIChCaWdJbnRlZ2VyKSB2YWwsIGNv\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICAgICAgc2V0TnVtYmVyKHN0\nbW50LCBpZHgsIChOdW1iZXIpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAg\nICAgICAgICAgICAgICBzZXRMb2NhbGUoc3RtbnQsIGlkeCwgKExvY2FsZSkg\ndmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVNRTFR5cGVzLlNRTF9BUlJBWToKICAgICAgICAgICAgICAg\nIHNldEFycmF5KHN0bW50LCBpZHgsIChBcnJheSkgdmFsLCBjb2wpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5\ncGVzLkFTQ0lJX1NUUkVBTToKICAgICAgICAgICAgICAgIHMgPSAoU2l6ZWQp\nIHZhbDsKICAgICAgICAgICAgICAgIHNldEFzY2lpU3RyZWFtKHN0bW50LCBp\nZHgsIChJbnB1dFN0cmVhbSkgcy52YWx1ZSwgcy5zaXplLCBjb2wpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5\ncGVzLkJJTkFSWV9TVFJFQU06CiAgICAgICAgICAgICAgICBzID0gKFNpemVk\nKSB2YWw7CiAgICAgICAgICAgICAgICBzZXRCaW5hcnlTdHJlYW0oc3RtbnQs\nIGlkeCwgKElucHV0U3RyZWFtKSBzLnZhbHVlLCBzLnNpemUsIGNvbCk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FM\nVHlwZXMuQkxPQjoKICAgICAgICAgICAgICAgIHNldEJsb2Ioc3RtbnQsIGlk\neCwgKEJsb2IpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CWVRFUzoKICAgICAgICAg\nICAgICAgIHNldEJ5dGVzKHN0bW50LCBpZHgsIChieXRlW10pIHZhbCwgY29s\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFTUUxUeXBlcy5DSEFSX1NUUkVBTToKICAgICAgICAgICAgICAgIHMgPSAo\nU2l6ZWQpIHZhbDsKICAgICAgICAgICAgICAgIHNldENoYXJhY3RlclN0cmVh\nbShzdG1udCwgaWR4LCAoUmVhZGVyKSBzLnZhbHVlLCBzLnNpemUsIGNvbCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nU1FMVHlwZXMuQ0xPQjoKICAgICAgICAgICAgICAgIHNldENsb2Ioc3RtbnQs\nIGlkeCwgKENsb2IpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5TUUxfREFURToKICAg\nICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRhcmQpIHsK\nICAgICAgICAgICAgICAgICAgICBjID0gKENhbGVuZGFyZCkgdmFsOwogICAg\nICAgICAgICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKGphdmEuc3Fs\nLkRhdGUpIGMudmFsdWUsIGMuY2FsZW5kYXIsCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAg\nICAgICAgICAgICBzZXREYXRlKHN0bW50LCBpZHgsIChqYXZhLnNxbC5EYXRl\nKSB2YWwsIG51bGwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuUkVGOgogICAgICAgICAgICAg\nICAgc2V0UmVmKHN0bW50LCBpZHgsIChSZWYpIHZhbCwgY29sKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBl\ncy5USU1FOgogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIENh\nbGVuZGFyZCkgewogICAgICAgICAgICAgICAgICAgIGMgPSAoQ2FsZW5kYXJk\nKSB2YWw7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZShzdG1udCwgaWR4\nLCAoVGltZSkgYy52YWx1ZSwgYy5jYWxlbmRhciwgY29sKTsKICAgICAgICAg\nICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHNldFRpbWUoc3Rt\nbnQsIGlkeCwgKFRpbWUpIHZhbCwgbnVsbCwgY29sKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5USU1F\nU1RBTVA6CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgQ2Fs\nZW5kYXJkKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IChDYWxlbmRhcmQp\nIHZhbDsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3RtbnQs\nIGlkeCwgKFRpbWVzdGFtcCkgYy52YWx1ZSwgYy5jYWxlbmRhciwKICAgICAg\nICAgICAgICAgICAgICAgICAgY29sKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4\nLCAoVGltZXN0YW1wKSB2YWwsIG51bGwsIGNvbCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nIGlmIChjb2wgIT0gbnVsbCAmJiAoY29sLmdldFR5cGUoKSA9PSBUeXBlcy5C\nTE9CCiAgICAgICAgICAgICAgICAgICAgfHwgY29sLmdldFR5cGUoKSA9PSBU\neXBlcy5WQVJCSU5BUlkpKQogICAgICAgICAgICAgICAgICAgIHNldEJsb2JP\nYmplY3Qoc3RtbnQsIGlkeCwgdmFsLCBjb2wsIHN0b3JlKTsKICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXRPYmplY3Qoc3Rt\nbnQsIGlkeCwgdmFsLCBjb2wuZ2V0VHlwZSgpLCBjb2wpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhIGNvbXBsZXRlbHkgdW5rbm93\nbiBwYXJhbWV0ZXIgaW50byBhIHByZXBhcmVkIHN0YXRlbWVudC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0VW5rbm93bihQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNp\nemVkIHNpemVkID0gbnVsbDsKICAgICAgICBDYWxlbmRhcmQgY2FsZCA9IG51\nbGw7CiAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFNpemVkKSB7CiAgICAg\nICAgICAgIHNpemVkID0gKFNpemVkKSB2YWw7CiAgICAgICAgICAgIHZhbCA9\nIHNpemVkLnZhbHVlOwogICAgICAgIH0gZWxzZSBpZiAodmFsIGluc3RhbmNl\nb2YgQ2FsZW5kYXJkKSB7CiAgICAgICAgICAgIGNhbGQgPSAoQ2FsZW5kYXJk\nKSB2YWw7CiAgICAgICAgICAgIHZhbCA9IGNhbGQudmFsdWU7CiAgICAgICAg\nfQoKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHNldE51\nbGwoc3RtbnQsIGlkeCwgKGNvbCA9PSBudWxsKSA/IFR5cGVzLk9USEVSIDog\nY29sLmdldFR5cGUoKSwKICAgICAgICAgICAgICAgIGNvbCk7CiAgICAgICAg\nZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAgICBz\nZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLnRvU3RyaW5nKCksIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgSW50ZWdlcikKICAgICAg\nICAgICAgc2V0SW50KHN0bW50LCBpZHgsICgoSW50ZWdlcikgdmFsKS5pbnRW\nYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIEJvb2xlYW4pCiAgICAgICAgICAgIHNldEJvb2xlYW4oc3RtbnQsIGlkeCwg\nKChCb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1ZSgpLCBjb2wpOwogICAgICAg\nIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIExvbmcpCiAgICAgICAgICAgIHNl\ndExvbmcoc3RtbnQsIGlkeCwgKChMb25nKSB2YWwpLmxvbmdWYWx1ZSgpLCBj\nb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEZsb2F0KQog\nICAgICAgICAgICBzZXRGbG9hdChzdG1udCwgaWR4LCAoKEZsb2F0KSB2YWwp\nLmZsb2F0VmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5z\ndGFuY2VvZiBEb3VibGUpCiAgICAgICAgICAgIHNldERvdWJsZShzdG1udCwg\naWR4LCAoKERvdWJsZSkgdmFsKS5kb3VibGVWYWx1ZSgpLCBjb2wpOwogICAg\nICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJ5dGUpCiAgICAgICAgICAg\nIHNldEJ5dGUoc3RtbnQsIGlkeCwgKChCeXRlKSB2YWwpLmJ5dGVWYWx1ZSgp\nLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIENoYXJh\nY3RlcikKICAgICAgICAgICAgc2V0Q2hhcihzdG1udCwgaWR4LCAoKENoYXJh\nY3RlcikgdmFsKS5jaGFyVmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlm\nICh2YWwgaW5zdGFuY2VvZiBTaG9ydCkKICAgICAgICAgICAgc2V0U2hvcnQo\nc3RtbnQsIGlkeCwgKChTaG9ydCkgdmFsKS5zaG9ydFZhbHVlKCksIGNvbCk7\nCiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgTG9jYWxlKQogICAg\nICAgICAgICBzZXRMb2NhbGUoc3RtbnQsIGlkeCwgKExvY2FsZSkgdmFsLCBj\nb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJpZ0RlY2lt\nYWwpCiAgICAgICAgICAgIHNldEJpZ0RlY2ltYWwoc3RtbnQsIGlkeCwgKEJp\nZ0RlY2ltYWwpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5z\ndGFuY2VvZiBCaWdJbnRlZ2VyKQogICAgICAgICAgICBzZXRCaWdJbnRlZ2Vy\nKHN0bW50LCBpZHgsIChCaWdJbnRlZ2VyKSB2YWwsIGNvbCk7CiAgICAgICAg\nZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQXJyYXkpCiAgICAgICAgICAgIHNl\ndEFycmF5KHN0bW50LCBpZHgsIChBcnJheSkgdmFsLCBjb2wpOwogICAgICAg\nIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJsb2IpCiAgICAgICAgICAgIHNl\ndEJsb2Ioc3RtbnQsIGlkeCwgKEJsb2IpIHZhbCwgY29sKTsKICAgICAgICBl\nbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBieXRlW10pCiAgICAgICAgICAgIHNl\ndEJ5dGVzKHN0bW50LCBpZHgsIChieXRlW10pIHZhbCwgY29sKTsKICAgICAg\nICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBDbG9iKQogICAgICAgICAgICBz\nZXRDbG9iKHN0bW50LCBpZHgsIChDbG9iKSB2YWwsIGNvbCk7CiAgICAgICAg\nZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgUmVmKQogICAgICAgICAgICBzZXRS\nZWYoc3RtbnQsIGlkeCwgKFJlZikgdmFsLCBjb2wpOwogICAgICAgIGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIGphdmEuc3FsLkRhdGUpCiAgICAgICAgICAg\nIHNldERhdGUoc3RtbnQsIGlkeCwgKGphdmEuc3FsLkRhdGUpIHZhbCwKICAg\nICAgICAgICAgICAgIChjYWxkID09IG51bGwpID8gbnVsbCA6IGNhbGQuY2Fs\nZW5kYXIsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2Yg\nVGltZXN0YW1wKQogICAgICAgICAgICBzZXRUaW1lc3RhbXAoc3RtbnQsIGlk\neCwgKFRpbWVzdGFtcCkgdmFsLAogICAgICAgICAgICAgICAgKGNhbGQgPT0g\nbnVsbCkgPyBudWxsIDogY2FsZC5jYWxlbmRhciwgY29sKTsKICAgICAgICBl\nbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBUaW1lKQogICAgICAgICAgICBzZXRU\naW1lKHN0bW50LCBpZHgsIChUaW1lKSB2YWwsCiAgICAgICAgICAgICAgICAo\nY2FsZCA9PSBudWxsKSA/IG51bGwgOiBjYWxkLmNhbGVuZGFyLCBjb2wpOwog\nICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIERhdGUpCiAgICAgICAg\nICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKERhdGUpIHZhbCwgY29sKTsKICAg\nICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRhcikKICAgICAg\nICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCAoKENhbGVuZGFyKSB2YWwpLmdl\ndFRpbWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2Vv\nZiBSZWFkZXIpCiAgICAgICAgICAgIHNldENoYXJhY3RlclN0cmVhbShzdG1u\ndCwgaWR4LCAoUmVhZGVyKSB2YWwsCiAgICAgICAgICAgICAgICAoc2l6ZWQg\nPT0gbnVsbCkgPyAwIDogc2l6ZWQuc2l6ZSwgY29sKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtcGFyYW0iLCB2YWwuZ2V0Q2xhc3MoKSkpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBzZXJpYWxpemVkIGJ5dGVzIGZvciB0aGUg\nZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgYnl0ZVtdIHNlcmlh\nbGl6ZShPYmplY3QgdmFsLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAodmFsIGluc3Rh\nbmNlb2YgU2VyaWFsaXplZERhdGEpCiAgICAgICAgICAgIHJldHVybiAoKFNl\ncmlhbGl6ZWREYXRhKSB2YWwpLmJ5dGVzOwogICAgICAgIHJldHVybiBTZXJp\nYWxpemF0aW9uLnNlcmlhbGl6ZSh2YWwsIHN0b3JlLmdldENvbnRleHQoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhlIEpESyAxLjQgPGNv\nZGU+c2V0Qnl0ZXM8L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4gQkxPQiBv\nYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHB1dEJ5dGVzKE9iamVj\ndCBibG9iLCBieXRlW10gZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoX3NldEJ5dGVzID09IG51bGwpIHsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9zZXRCeXRlcyA9IGJsb2Iu\nZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInNldEJ5dGVzIiwKICAgICAgICAgICAg\nICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywgYnl0ZVtdLmNsYXNz\nIH0pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGludm9rZVB1dExvYk1ldGhv\nZChfc2V0Qnl0ZXMsIGJsb2IsCiAgICAgICAgICAgIG5ldyBPYmplY3RbXXsg\nTnVtYmVycy52YWx1ZU9mKDFMKSwgZGF0YSB9KTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRTdHJpbmc8L2Nv\nZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4gQ0xPQgogICAgICogb2JqZWN0Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRTdHJpbmcoT2JqZWN0IGNsb2Is\nIFN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmIChfc2V0U3RyaW5nID09IG51bGwpIHsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIF9zZXRTdHJpbmcgPSBjbG9iLmdldENs\nYXNzKCkuZ2V0TWV0aG9kKCJzZXRTdHJpbmciLAogICAgICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNzLCBTdHJpbmcuY2xhc3MgfSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaW52b2tlUHV0TG9iTWV0aG9kKF9z\nZXRTdHJpbmcsIGNsb2IsCiAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgTnVt\nYmVycy52YWx1ZU9mKDFMKSwgZGF0YSB9KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRDaGFyYWN0ZXJTdHJl\nYW08L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4KICAgICAqIENMT0Igb2Jq\nZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRDaGFycyhPYmplY3Qg\nY2xvYiwgY2hhcltdIGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKF9zZXRDaGFyU3RyZWFtID09IG51bGwpIHsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9zZXRDaGFyU3RyZWFt\nID0gY2xvYi5nZXRDbGFzcygpLmdldE1ldGhvZAogICAgICAgICAgICAgICAg\nICAgICgic2V0Q2hhcmFjdGVyU3RyZWFtIiwgbmV3IENsYXNzW117IGxvbmcu\nY2xhc3MgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIFdyaXRlciB3cml0\nZXIgPSAoV3JpdGVyKSBpbnZva2VQdXRMb2JNZXRob2QoX3NldENoYXJTdHJl\nYW0sIGNsb2IsCiAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgTnVtYmVycy52\nYWx1ZU9mKDFMKSB9KTsKICAgICAgICB0cnkgewogICAgICAgICAgICB3cml0\nZXIud3JpdGUoZGF0YSk7CiAgICAgICAgICAgIHdyaXRlci5mbHVzaCgpOwog\nICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGlvZS50b1N0cmluZygpKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhlIGdpdmVu\nIExPQiBtZXRob2Qgb24gdGhlIGdpdmVuIHRhcmdldCB3aXRoIHRoZSBnaXZl\nbiBkYXRhLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3QgaW52\nb2tlUHV0TG9iTWV0aG9kKE1ldGhvZCBtZXRob2QsIE9iamVjdCB0YXJnZXQs\nCiAgICAgICAgT2JqZWN0W10gYXJncykKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gbWV0\naG9kLmludm9rZSh0YXJnZXQsIGFyZ3MpOwogICAgICAgIH0gY2F0Y2ggKElu\ndm9jYXRpb25UYXJnZXRFeGNlcHRpb24gaXRlKSB7CiAgICAgICAgICAgIFRo\ncm93YWJsZSB0ID0gaXRlLmdldFRhcmdldEV4Y2VwdGlvbigpOwogICAgICAg\nICAgICBpZiAodCBpbnN0YW5jZW9mIFNRTEV4Y2VwdGlvbikKICAgICAgICAg\nICAgICAgIHRocm93KFNRTEV4Y2VwdGlvbikgdDsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHQpOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2Vw\ndGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXYXJu\nIHRoYXQgYSBwYXJ0aWN1bGFyIHZhbHVlIGNvdWxkIG5vdCBiZSBzdG9yZWQg\ncHJlY2lzZWx5LgogICAgICogQWZ0ZXIgdGhlIGZpcnN0IHdhcm5pbmcgZm9y\nIGEgcGFydGljdWxhciB0eXBlLCBtZXNzYWdlcwogICAgICogd2lsbCBiZSB0\ndXJuZWQgaW50byB0cmFjZSBtZXNzYWdlcy4KICAgICAqLwogICAgcHJvdGVj\ndGVkIHZvaWQgc3RvcmFnZVdhcm5pbmcoT2JqZWN0IG9yaWcsIE9iamVjdCBj\nb252ZXJ0ZWQpIHsKICAgICAgICBib29sZWFuIHdhcm47CiAgICAgICAgc3lu\nY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIGlmIChfcHJlY2lzaW9u\nV2FybmVkVHlwZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wcmVjaXNp\nb25XYXJuZWRUeXBlcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgIHdh\ncm4gPSBfcHJlY2lzaW9uV2FybmVkVHlwZXMuYWRkKG9yaWcuZ2V0Q2xhc3Mo\nKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3RvcmFnZUxpbWl0YXRpb25z\nRmF0YWwgfHwgKHdhcm4gJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAg\nICAgICAgfHwgKCF3YXJuICYmIGxvZy5pc1RyYWNlRW5hYmxlZCgpKSkgewog\nICAgICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJzdG9yYWdlLXJl\nc3RyaWN0aW9uIiwgbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAgcGxh\ndGZvcm0sCiAgICAgICAgICAgICAgICBvcmlnLAogICAgICAgICAgICAgICAg\nb3JpZy5nZXRDbGFzcygpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGNv\nbnZlcnRlZCwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoc3Rv\ncmFnZUxpbWl0YXRpb25zRmF0YWwpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24obXNnKTsKCiAgICAgICAgICAgIGlmICh3YXJu\nKQogICAgICAgICAgICAgICAgbG9nLndhcm4obXNnKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgbG9nLnRyYWNlKG1zZyk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8vLy8vLy8vLwogICAgLy8gVHlwZXMKICAgIC8vLy8v\nLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQge0Bs\naW5rIFR5cGVzfSBjb25zdGFudCBmb3IgdGhlIGdpdmVuCiAgICAgKiB7QGxp\nbmsgSmF2YVR5cGVzfSBvciB7QGxpbmsgSmF2YVNRTFR5cGVzfSBjb25zdGFu\ndC4KICAgICAqLwogICAgcHVibGljIGludCBnZXRKREJDVHlwZShpbnQgbWV0\nYVR5cGVDb2RlLCBib29sZWFuIGxvYikgewogICAgICAgIGlmIChsb2IpIHsK\nICAgICAgICAgICAgc3dpdGNoIChtZXRhVHlwZUNvZGUpIHsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVNRTFR5cGVzLkFTQ0lJX1NUUkVBTToKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVNRTFR5cGVzLkNIQVJfU1RSRUFNOgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkNMT0Ip\nOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CTE9CKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc3dpdGNoIChtZXRhVHlwZUNv\nZGUpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTl9PQko6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CSVQpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJTllJTlQpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIGlmIChzdG9yZUNoYXJz\nQXNOdW1iZXJzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVm\nZXJyZWRUeXBlKFR5cGVzLklOVEVHRVIpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQ0hBUik7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQ\ncmVmZXJyZWRUeXBlKFR5cGVzLkRPVUJMRSk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5G\nTE9BVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVk\nVHlwZShUeXBlcy5SRUFMKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuSU5U\nRUdFUik7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQklHSU5UKTsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlNNQUxMSU5UKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVz\nLkFTQ0lJX1NUUkVBTToKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMu\nQ0hBUl9TVFJFQU06CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVy\ncmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgIGlmIChzdG9yZUxh\ncmdlTnVtYmVyc0FzU3RyaW5ncykKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJJR0lOVCk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAg\nICAgICAgICAgICBpZiAoc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlw\nZXMuVkFSQ0hBUik7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVy\ncmVkVHlwZShUeXBlcy5OVU1FUklDKTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTlVNQkVSOgogICAgICAgICAgICAgICAgaWYgKHN0b3JlTGFyZ2VO\ndW1iZXJzQXNTdHJpbmdzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlZBUkNIQVIpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuTlVNRVJJQyk7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVElNRVNUQU1QKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhU1FMVHlwZXMuU1FMX0FSUkFZOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQVJSQVkpOwogICAg\nICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CSU5BUllfU1RSRUFNOgogICAg\nICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CTE9COgogICAgICAgICAgICBj\nYXNlIEphdmFTUUxUeXBlcy5CWVRFUzoKICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJMT0IpOwogICAgICAgICAgICBj\nYXNlIEphdmFTUUxUeXBlcy5DTE9COgogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQ0xPQik7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVNRTFR5cGVzLlNRTF9EQVRFOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuREFURSk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVNRTFR5cGVzLlRJTUU6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5USU1FKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhU1FMVHlwZXMuVElNRVNUQU1QOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVElNRVNUQU1QKTsKICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQ\ncmVmZXJyZWRUeXBlKFR5cGVzLkJMT0IpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgcHJlZmVycmVkIHtAbGluayBUeXBl\nc30gdHlwZSBmb3IgdGhlIGdpdmVuIG9uZS4gUmV0dXJucwogICAgICogdGhl\nIGdpdmVuIHR5cGUgYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRQcmVmZXJyZWRUeXBlKGludCB0eXBlKSB7CiAgICAgICAgcmV0dXJu\nIHR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByZWZl\ncnJlZCBkYXRhYmFzZSB0eXBlIG5hbWUgZm9yIHRoZSBnaXZlbiBjb2x1bW4n\ncyB0eXBlCiAgICAgKiBmcm9tIHtAbGluayBUeXBlc30uCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0VHlwZU5hbWUoQ29sdW1uIGNvbCkgewogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShjb2wuZ2V0VHlwZU5hbWUo\nKSkpCiAgICAgICAgICAgIHJldHVybiBhcHBlbmRTaXplKGNvbCwgY29sLmdl\ndFR5cGVOYW1lKCkpOwoKICAgICAgICBpZiAoY29sLmlzQXV0b0Fzc2lnbmVk\nKCkgJiYgYXV0b0Fzc2lnblR5cGVOYW1lICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBhcHBlbmRTaXplKGNvbCwgYXV0b0Fzc2lnblR5cGVOYW1lKTsK\nCiAgICAgICAgcmV0dXJuIGFwcGVuZFNpemUoY29sLCBnZXRUeXBlTmFtZShj\nb2wuZ2V0VHlwZSgpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5z\nIHRoZSB0eXBlIG5hbWUgZm9yIHRoZSBzcGVjaWZpYyBjb25zdGFudCBhcyBk\nZWZpbmVkCiAgICAgKiBieSB7QGxpbmsgamF2YS5zcWwuVHlwZXN9LgogICAg\nICoKICAgICAqIEBwYXJhbSB0eXBlIHRoZSB0eXBlCiAgICAgKiBAcmV0dXJu\nIHRoZSBuYW1lIGZvciB0aGUgdHlwZQogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nIGdldFR5cGVOYW1lKGludCB0eXBlKSB7CiAgICAgICAgc3dpdGNoICh0\neXBlKSB7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQVJSQVk6CiAgICAgICAg\nICAgICAgICByZXR1cm4gYXJyYXlUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5CSUdJTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gYmlnaW50\nVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQklOQVJZOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGJpbmFyeVR5cGVOYW1lOwogICAgICAgICAg\nICBjYXNlIFR5cGVzLkJJVDoKICAgICAgICAgICAgICAgIHJldHVybiBiaXRU\neXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5CTE9COgogICAgICAg\nICAgICAgICAgcmV0dXJuIGJsb2JUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgcmV0dXJuIGJvb2xl\nYW5UeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5DSEFSOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGNoYXJUeXBlTmFtZTsKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5DTE9COgogICAgICAgICAgICAgICAgcmV0dXJuIGNsb2JU\neXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5EQVRFOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGRhdGVUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5ERUNJTUFMOgogICAgICAgICAgICAgICAgcmV0dXJuIGRlY2lt\nYWxUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5ESVNUSU5DVDoK\nICAgICAgICAgICAgICAgIHJldHVybiBkaXN0aW5jdFR5cGVOYW1lOwogICAg\nICAgICAgICBjYXNlIFR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIHJl\ndHVybiBkb3VibGVUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5G\nTE9BVDoKICAgICAgICAgICAgICAgIHJldHVybiBmbG9hdFR5cGVOYW1lOwog\nICAgICAgICAgICBjYXNlIFR5cGVzLklOVEVHRVI6CiAgICAgICAgICAgICAg\nICByZXR1cm4gaW50ZWdlclR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5\ncGVzLkpBVkFfT0JKRUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIGphdmFP\nYmplY3RUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5MT05HVkFS\nQklOQVJZOgogICAgICAgICAgICAgICAgcmV0dXJuIGxvbmdWYXJiaW5hcnlU\neXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5MT05HVkFSQ0hBUjoK\nICAgICAgICAgICAgICAgIHJldHVybiBsb25nVmFyY2hhclR5cGVOYW1lOwog\nICAgICAgICAgICBjYXNlIFR5cGVzLk5VTEw6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbnVsbFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLk5V\nTUVSSUM6CiAgICAgICAgICAgICAgICByZXR1cm4gbnVtZXJpY1R5cGVOYW1l\nOwogICAgICAgICAgICBjYXNlIFR5cGVzLk9USEVSOgogICAgICAgICAgICAg\nICAgcmV0dXJuIG90aGVyVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuUkVBTDoKICAgICAgICAgICAgICAgIHJldHVybiByZWFsVHlwZU5hbWU7\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuUkVGOgogICAgICAgICAgICAgICAg\ncmV0dXJuIHJlZlR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlNN\nQUxMSU5UOgogICAgICAgICAgICAgICAgcmV0dXJuIHNtYWxsaW50VHlwZU5h\nbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuU1RSVUNUOgogICAgICAgICAg\nICAgICAgcmV0dXJuIHN0cnVjdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNl\nIFR5cGVzLlRJTUU6CiAgICAgICAgICAgICAgICByZXR1cm4gdGltZVR5cGVO\nYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlRJTUVTVEFNUDoKICAgICAg\nICAgICAgICAgIHJldHVybiB0aW1lc3RhbXBUeXBlTmFtZTsKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5USU5ZSU5UOgogICAgICAgICAgICAgICAgcmV0dXJu\nIHRpbnlpbnRUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5WQVJC\nSU5BUlk6CiAgICAgICAgICAgICAgICByZXR1cm4gdmFyYmluYXJ5VHlwZU5h\nbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuVkFSQ0hBUjoKICAgICAgICAg\nICAgICAgIHJldHVybiB2YXJjaGFyVHlwZU5hbWU7CiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gb3RoZXJUeXBlTmFtZTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9k\nIHRvIGFkZCBzaXplIHByb3BlcnRpZXMgdG8gdGhlIHNwZWNpZmllZCB0eXBl\nLgogICAgICogSWYgcHJlc2VudCwgdGhlIHN0cmluZyAiezB9IiB3aWxsIGJl\nIHJlcGxhY2VkIHdpdGggdGhlIHNpemUgZGVmaW5pdGlvbjsKICAgICAqIG90\naGVyd2lzZSB0aGUgc2l6ZSBkZWZpbml0aW9uIHdpbGwgYmUgYXBwZW5kZWQg\ndG8gdGhlIHR5cGUgbmFtZS4KICAgICAqIElmIHlvdXIgZGF0YWJhc2UgaGFz\nIGNvbHVtbiB0eXBlcyB0aGF0IGRvbid0IGFsbG93IHNpemUgZGVmaW5pdGlv\nbnMsCiAgICAgKiBvdmVycmlkZSB0aGlzIG1ldGhvZCB0byByZXR1cm4gdGhl\nIHVuYWx0ZXJlZCB0eXBlIG5hbWUgZm9yIGNvbHVtbnMgb2YKICAgICAqIHRo\nb3NlIHR5cGVzIChvciBhZGQgdGhlIHR5cGUgbmFtZXMgdG8gdGhlCiAgICAg\nKiA8Y29kZT5maXhlZFNpemVUeXBlTmFtZVNldDwvY29kZT4pLgogICAgICog\nCiAgICAgKiA8UD5Tb21lIGRhdGFiYXNlcyBzdXBwb3J0ICJ0eXBlIG1vZGlm\naWVycyIgZm9yIGV4YW1wbGUgdGhlIHVuc2lnbmVkCiAgICAgKiAibW9kaWZp\nZXIiIGluIE15U1FMLiBJbiB0aGVzZSBjYXNlcyB0aGUgc2l6ZSBzaG91bGQg\nZ28gYmV0d2VlbiB0aGUgdHlwZSAKICAgICAqIGFuZCB0aGUgIm1vZGlmaWVy\nIiwgaW5zdGVhZCBvZiBhZnRlciB0aGUgbW9kaWZpZXIuIEZvciBleGFtcGxl\nIAogICAgICogQ1JFQVRFIHRhYmxlIEZPTyAoIG15aW50IElOVCAoMTApIFVO\nU0lHTkVEIC4gLiAuKSBpbnN0ZWFkIG9mIAogICAgICogQ1JFQVRFIHRhYmxl\nIEZPTyAoIG15aW50IElOVCBVTlNJR05FRCAoMTApIC4gLiAuKS4KICAgICAq\nIFR5cGUgbW9kaWZpZXJzIHNob3VsZCBiZSBhZGRlZCB0byA8Y29kZT50eXBl\nTW9kaWZpZXJTZXQ8L2NvZGU+IGluIAogICAgICogc3ViY2xhc3Nlcy4gCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgYXBwZW5kU2l6ZShDb2x1bW4g\nY29sLCBTdHJpbmcgdHlwZU5hbWUpIHsKICAgICAgICBpZiAoZml4ZWRTaXpl\nVHlwZU5hbWVTZXQuY29udGFpbnModHlwZU5hbWUudG9VcHBlckNhc2UoKSkp\nCiAgICAgICAgICAgIHJldHVybiB0eXBlTmFtZTsKICAgICAgICBpZiAodHlw\nZU5hbWUuaW5kZXhPZignKCcpICE9IC0xKQogICAgICAgICAgICByZXR1cm4g\ndHlwZU5hbWU7CgogICAgICAgIFN0cmluZyBzaXplID0gbnVsbDsKICAgICAg\nICBpZiAoY29sLmdldFNpemUoKSA+IDApIHsKICAgICAgICAgICAgU3RyaW5n\nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoMTApOwogICAgICAgICAg\nICBidWYuYXBwZW5kKCIoIikuYXBwZW5kKGNvbC5nZXRTaXplKCkpOwogICAg\nICAgICAgICBpZiAoY29sLmdldERlY2ltYWxEaWdpdHMoKSA+IDApCiAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpLmFwcGVuZChjb2wuZ2V0RGVj\naW1hbERpZ2l0cygpKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiKSIpOwog\nICAgICAgICAgICBzaXplID0gYnVmLnRvU3RyaW5nKCk7CiAgICAgICAgfQoK\nICAgICAgICByZXR1cm4gaW5zZXJ0U2l6ZSh0eXBlTmFtZSwgc2l6ZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRoYXQgaW5zZXJ0\ncyBhIHNpemUgY2xhdXNlIGZvciBhIGdpdmVuIFNRTCB0eXBlLiAKICAgICAq\nIAogICAgICogQHNlZSBhcHBlbmRTaXplCiAgICAgKiAKICAgICAqIEBwYXJh\nbSB0eXBlTmFtZSAgVGhlIFNRTCB0eXBlIGllIElOVAogICAgICogQHBhcmFt\nIHNpemUgICAgICBUaGUgc2l6ZSBjbGF1c2UgaWUgKDEwKQogICAgICogQHJl\ndHVybiAgICAgICAgICBUaGUgdHlwZU5hbWUgKyBzaXplIGNsYXVzZS4gVXN1\nYWxseSB0aGUgc2l6ZSBjbGF1c2Ugd2lsbCAKICAgICAqICAgICAgICAgICAg\nICAgICAgYmUgYXBwZW5kZWQgdG8gdHlwZU5hbWUuIElmIHRoZSB0eXBlTmFt\nZSBjb250YWlucyBhIAogICAgICogICAgICAgICAgICAgICAgICBtYXJrZXIg\nOiB7MH0gb3IgaWYgdHlwZU5hbWUgY29udGFpbnMgYSBtb2RpZmllciB0aGUg\nCiAgICAgKiAgICAgICAgICAgICAgICAgIHNpemUgY2xhdXNlIHdpbGwgYmUg\naW5zZXJ0ZWQgYXBwcm9wcmlhdGVseS4gICAKICAgICAqLwogICAgcHJvdGVj\ndGVkIFN0cmluZyBpbnNlcnRTaXplKFN0cmluZyB0eXBlTmFtZSwgU3RyaW5n\nIHNpemUpIHsKICAgIAlpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzaXplKSkg\newogICAgICAgICAgICBpbnQgaWR4ID0gdHlwZU5hbWUuaW5kZXhPZigiezB9\nIik7CiAgICAgICAgICAgIGlmIChpZHggIT0gLTEpIHsKICAgICAgICAgICAg\nICAgIHJldHVybiB0eXBlTmFtZS5zdWJzdHJpbmcoMCwgaWR4KTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHlwZU5hbWU7CiAgICAgICAg\nfQogICAgCQogICAgICAgIGludCBpZHggPSB0eXBlTmFtZS5pbmRleE9mKCJ7\nMH0iKTsKICAgICAgICBpZiAoaWR4ICE9IC0xKSB7CiAgICAgICAgICAgIC8v\nIHJlcGxhY2UgJ3swfScgd2l0aCBzaXplCiAgICAgICAgICAgIFN0cmluZyBy\nZXQgPSB0eXBlTmFtZS5zdWJzdHJpbmcoMCwgaWR4KTsKICAgICAgICAgICAg\naWYgKHNpemUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldCA9IHJldCAr\nIHNpemU7CiAgICAgICAgICAgIGlmICh0eXBlTmFtZS5sZW5ndGgoKSA+IGlk\neCArIDMpCiAgICAgICAgICAgICAgICByZXQgPSByZXQgKyB0eXBlTmFtZS5z\ndWJzdHJpbmcoaWR4ICsgMyk7CiAgICAgICAgICAgIHJldHVybiByZXQ7CiAg\nICAgICAgfQogICAgICAgIGlmICghdHlwZU1vZGlmaWVyU2V0LmlzRW1wdHko\nKSkgewogICAgICAgICAgICBTdHJpbmcgczsKICAgICAgICAgICAgaWR4ID0g\ndHlwZU5hbWUubGVuZ3RoKCk7CiAgICAgICAgICAgIGludCBjdXJJZHggPSAt\nMTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpID0gdHlwZU1vZGlmaWVy\nU2V0Lml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgcyA9IChTdHJpbmcpIGkubmV4dCgpOwogICAgICAgICAgICAgICAgaWYg\nKHR5cGVOYW1lLnRvVXBwZXJDYXNlKCkuaW5kZXhPZihzKSAhPSAtMSkgewog\nICAgICAgICAgICAgICAgICAgIGN1cklkeCA9IHR5cGVOYW1lLnRvVXBwZXJD\nYXNlKCkuaW5kZXhPZihzKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3Vy\nSWR4ICE9IC0xICYmIGN1cklkeCA8IGlkeCkgewogICAgICAgICAgICAgICAg\nICAgICAgICBpZHggPSBjdXJJZHg7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nKGlkeCAhPSB0eXBlTmFtZS5sZW5ndGgoKSkgewogICAgICAgICAgICAgICAg\nU3RyaW5nIHJldCA9IHR5cGVOYW1lLnN1YnN0cmluZygwLCBpZHgpOwogICAg\nICAgICAgICAgICAgcmV0ID0gcmV0ICsgc2l6ZTsKICAgICAgICAgICAgICAg\nIHJldCA9IHJldCArICcgJyArIHR5cGVOYW1lLnN1YnN0cmluZyhpZHgpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdHlwZU5hbWUgKyBzaXplOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vCiAgICAvLyBTZWxlY3RzCiAgICAvLy8vLy8vLy8v\nLwoKICAgIC8qKgogICAgICogU2V0IHRoZSBuYW1lIG9mIHRoZSBqb2luIHN5\nbnRheCB0byB1c2U6IHNxbDkyLCB0cmFkaXRpb25hbCwgZGF0YWJhc2UKICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0Sm9pblN5bnRheChTdHJpbmcgc3lu\ndGF4KSB7CiAgICAgICAgaWYgKCJzcWw5MiIuZXF1YWxzKHN5bnRheCkpCiAg\nICAgICAgICAgIGpvaW5TeW50YXggPSBTWU5UQVhfU1FMOTI7CiAgICAgICAg\nZWxzZSBpZiAoInRyYWRpdGlvbmFsIi5lcXVhbHMoc3ludGF4KSkKICAgICAg\nICAgICAgam9pblN5bnRheCA9IFNZTlRBWF9UUkFESVRJT05BTDsKICAgICAg\nICBlbHNlIGlmICgiZGF0YWJhc2UiLmVxdWFscyhzeW50YXgpKQogICAgICAg\nICAgICBqb2luU3ludGF4ID0gU1lOVEFYX0RBVEFCQVNFOwogICAgICAgIGVs\nc2UgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KHN5bnRheCkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oc3ludGF4\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIFNRTCBzdHJpbmcg\ndG8gYWN0IGFzIGEgcGxhY2Vob2xkZXIgZm9yIHRoZSBnaXZlbiBjb2x1bW4u\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0UGxhY2Vob2xkZXJWYWx1\nZVN0cmluZyhDb2x1bW4gY29sKSB7CiAgICAgICAgc3dpdGNoIChjb2wuZ2V0\nVHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQklHSU5UOgogICAg\nICAgICAgICBjYXNlIFR5cGVzLkJJVDoKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5JTlRFR0VSOgogICAgICAgICAgICBjYXNlIFR5cGVzLk5VTUVSSUM6CiAg\nICAgICAgICAgIGNhc2UgVHlwZXMuU01BTExJTlQ6CiAgICAgICAgICAgIGNh\nc2UgVHlwZXMuVElOWUlOVDoKICAgICAgICAgICAgICAgIHJldHVybiAiMCI7\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAg\nIHJldHVybiAoc3RvcmVDaGFyc0FzTnVtYmVycykgPyAiMCIgOiAiJyAnIjsK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5DTE9COgogICAgICAgICAgICBjYXNl\nIFR5cGVzLkxPTkdWQVJDSEFSOgogICAgICAgICAgICBjYXNlIFR5cGVzLlZB\nUkNIQVI6CiAgICAgICAgICAgICAgICByZXR1cm4gIicnIjsKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIFpF\nUk9fREFURV9TVFI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuREVDSU1BTDoK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNh\nc2UgVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgVHlwZXMuUkVBTDoK\nICAgICAgICAgICAgICAgIHJldHVybiAiMC4wIjsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgcmV0dXJuIFpFUk9fVElN\nRV9TVFI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuVElNRVNUQU1QOgogICAg\nICAgICAgICAgICAgcmV0dXJuIFpFUk9fVElNRVNUQU1QX1NUUjsKICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiAiTlVMTCI7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgU0VM\nRUNUIENPVU5UIHN0YXRlbWVudCBpbiB0aGUgcHJvcGVyIGpvaW4gc3ludGF4\nIGZvciB0aGUKICAgICAqIGdpdmVuIGluc3RhbmNlLgogICAgICovCiAgICBw\ndWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0Q291bnQoU2VsZWN0IHNlbCkgewog\nICAgICAgIFNRTEJ1ZmZlciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVyKHRo\naXMpOwogICAgICAgIFNRTEJ1ZmZlciBmcm9tOwogICAgICAgIHNlbC5hZGRK\nb2luQ2xhc3NDb25kaXRpb25zKCk7CiAgICAgICAgaWYgKHNlbC5nZXRGcm9t\nU2VsZWN0KCkgIT0gbnVsbCkKICAgICAgICAgICAgZnJvbSA9IGdldEZyb21T\nZWxlY3Qoc2VsLCBmYWxzZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBm\ncm9tID0gZ2V0RnJvbShzZWwsIGZhbHNlKTsKICAgICAgICBTUUxCdWZmZXIg\nd2hlcmUgPSBnZXRXaGVyZShzZWwsIGZhbHNlKTsKCiAgICAgICAgLy8gaWYg\nbm8gZ3JvdXBpbmcgYW5kIG5vIHJhbmdlLCB3ZSBtaWdodCBiZSBhYmxlIHRv\nIGdldCBieSB3aXRob3V0CiAgICAgICAgLy8gYSBzdWJzZWxlY3QKICAgICAg\nICBpZiAoc2VsLmdldEdyb3VwaW5nKCkgPT0gbnVsbCAmJiBzZWwuZ2V0U3Rh\ncnRJbmRleCgpID09IDAKICAgICAgICAgICAgJiYgc2VsLmdldEVuZEluZGV4\nKCkgPT0gTG9uZy5NQVhfVkFMVUUpIHsKICAgICAgICAgICAgLy8gaWYgdGhl\nIHNlbGVjdCBoYXMgbm8gaWRlbnRpZmllciBjb2xzLCB1c2UgQ09VTlQoKikK\nICAgICAgICAgICAgTGlzdCBhbGlhc2VzID0gKCFzZWwuaXNEaXN0aW5jdCgp\nKSA/IENvbGxlY3Rpb25zLkVNUFRZX0xJU1QKICAgICAgICAgICAgICAgIDog\nc2VsLmdldElkZW50aWZpZXJBbGlhc2VzKCk7CiAgICAgICAgICAgIGlmIChh\nbGlhc2VzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgc2VsZWN0U1FM\nLmFwcGVuZCgiQ09VTlQoKikiKTsKICAgICAgICAgICAgICAgIHJldHVybiB0\nb1NlbGVjdChzZWxlY3RTUUwsIG51bGwsIGZyb20sIHdoZXJlLCBudWxsLCBu\ndWxsLCBudWxsLAogICAgICAgICAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwg\nMCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBpZiB0aGVyZSBpcyBhIHNpbmdsZSBkaXN0aW5jdCBjb2wsIHVzZSBD\nT1VOVChESVNUSU5DVCBjb2wpCiAgICAgICAgICAgIGlmIChhbGlhc2VzLnNp\nemUoKSA9PSAxKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5k\nKCJDT1VOVChESVNUSU5DVCAiKS4KICAgICAgICAgICAgICAgICAgICBhcHBl\nbmQoYWxpYXNlcy5nZXQoMCkudG9TdHJpbmcoKSkuYXBwZW5kKCIpIik7CiAg\nICAgICAgICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0U1FMLCBudWxs\nLCBmcm9tLCB3aGVyZSwgbnVsbCwgbnVsbCwgbnVsbCwKICAgICAgICAgICAg\nICAgICAgICBmYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY2FuIHdlIGNvbWJpbmUgZGlz\ndGluY3QgY29scz8KICAgICAgICAgICAgaWYgKGRpc3RpbmN0Q291bnRDb2x1\nbW5TZXBhcmF0b3IgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VsZWN0\nU1FMLmFwcGVuZCgiQ09VTlQoRElTVElOQ1QgIik7CiAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGFsaWFzZXMuc2l6ZSgpOyBpKyspIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiICIpOwogICAgICAgICAg\nICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKGRpc3RpbmN0Q291bnRD\nb2x1bW5TZXBhcmF0b3IpOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxl\nY3RTUUwuYXBwZW5kKCIgIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoYWxpYXNlcy5nZXQo\naSkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBzZWxlY3RTUUwuYXBwZW5kKCIpIik7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gdG9TZWxlY3Qoc2VsZWN0U1FMLCBudWxsLCBmcm9tLCB3aGVyZSwg\nbnVsbCwgbnVsbCwgbnVsbCwKICAgICAgICAgICAgICAgICAgICBmYWxzZSwg\nZmFsc2UsIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgLy8gc2luY2Ugd2UgY2FuJ3QgY29tYmluZSBkaXN0\naW5jdCBjb2xzLCB3ZSBoYXZlIHRvIHBlcmZvcm0gYW4gb3V0ZXIKICAgICAg\nICAvLyBDT1VOVCgqKSBzZWxlY3QgdXNpbmcgdGhlIG9yaWdpbmFsIHNlbGVj\ndCBhcyBhIHN1YnNlbGVjdCBpbiB0aGUKICAgICAgICAvLyBGUk9NIGNsYXVz\nZQogICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNTdWJzZWxlY3QsICJT\ndXBwb3J0c1N1YnNlbGVjdCIpOwoKICAgICAgICBTUUxCdWZmZXIgc3ViU2Vs\nZWN0ID0gZ2V0U2VsZWN0cyhzZWwsIHRydWUsIGZhbHNlKTsKICAgICAgICBT\nUUxCdWZmZXIgc3ViRnJvbSA9IGZyb207CiAgICAgICAgZnJvbSA9IG5ldyBT\nUUxCdWZmZXIodGhpcyk7CiAgICAgICAgZnJvbS5hcHBlbmQoIigiKTsKICAg\nICAgICBmcm9tLmFwcGVuZCh0b1NlbGVjdChzdWJTZWxlY3QsIG51bGwsIHN1\nYkZyb20sIHdoZXJlLAogICAgICAgICAgICBzZWwuZ2V0R3JvdXBpbmcoKSwg\nc2VsLmdldEhhdmluZygpLCBudWxsLCBzZWwuaXNEaXN0aW5jdCgpLAogICAg\nICAgICAgICBmYWxzZSwgc2VsLmdldFN0YXJ0SW5kZXgoKSwgc2VsLmdldEVu\nZEluZGV4KCksIHRydWUpKTsKICAgICAgICBmcm9tLmFwcGVuZCgiKSIpOwog\nICAgICAgIGlmIChyZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0KQogICAgICAg\nICAgICBmcm9tLmFwcGVuZCgiICIpLmFwcGVuZChTZWxlY3QuRlJPTV9TRUxF\nQ1RfQUxJQVMpOwoKICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCJDT1VOVCgq\nKSIpOwogICAgICAgIHJldHVybiB0b1NlbGVjdChzZWxlY3RTUUwsIG51bGws\nIGZyb20sIG51bGwsIG51bGwsIG51bGwsIG51bGwsCiAgICAgICAgICAgIGZh\nbHNlLCBmYWxzZSwgMCwgTG9uZy5NQVhfVkFMVUUpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGEgREVMRVRFIHN0YXRlbWVudCBmb3IgdGhlIHNw\nZWNpZmllZCBTZWxlY3QuIElmIHRoZQogICAgICogZGF0YWJhc2UgZG9lcyBu\nb3Qgc3VwcG9ydCB0aGUgYnVsayBkZWxldGUgc3RhdGVtZW50IChzdWNoIGFz\nCiAgICAgKiBjYXNlcyB3aGVyZSBhIHN1YnNlbGVjdCBpcyByZXF1aXJlZCBh\nbmQgdGhlIGRhdGFiYXNlIGRvZXNuJ3Qgc3VwcG9ydAogICAgICogc3Vic2Vs\nZWN0cyksIHRoaXMgbWV0aG9kIHNob3VsZCByZXR1cm4gbnVsbC4KICAgICAq\nLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b0RlbGV0ZShDbGFzc01hcHBpbmcg\nbWFwcGluZywgU2VsZWN0IHNlbCwgCiAgICAgICAgT2JqZWN0W10gcGFyYW1z\nKSB7CiAgICAgICAgcmV0dXJuIHRvQnVsa09wZXJhdGlvbihtYXBwaW5nLCBz\nZWwsIG51bGwsIHBhcmFtcywgbnVsbCk7CiAgICB9CgogICAgcHVibGljIFNR\nTEJ1ZmZlciB0b1VwZGF0ZShDbGFzc01hcHBpbmcgbWFwcGluZywgU2VsZWN0\nIHNlbCwKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIE9iamVjdFtdIHBhcmFt\ncywgTWFwIHVwZGF0ZXMpIHsKICAgICAgICByZXR1cm4gdG9CdWxrT3BlcmF0\naW9uKG1hcHBpbmcsIHNlbCwgc3RvcmUsIHBhcmFtcywgdXBkYXRlcyk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBTUUwgZm9yIGEgYnVs\nayBvcGVyYXRpb24sIGVpdGhlciBhIERFTEVURSBvciBhbiBVUERBVEUuCiAg\nICAgKgogICAgICogQHBhcmFtIG1hcHBpbmcgdGhlIG1hcHBuZyBhZ2FpbnN0\nIHdoaWNoIHdlIGFyZSBvcGVyYXRpbmcKICAgICAqIEBwYXJhbSBzZWwgdGhl\nIFNlbGVjdCB0aGF0IHdpbGwgY29uc3RpdHV0ZSB0aGUgV0hFUkUgY2xhdXNl\nCiAgICAgKiBAcGFyYW0gc3RvcmUgdGhlIGN1cnJlbnQgc3RvcmUKICAgICAq\nIEBwYXJhbSB1cGRhdGVQYXJhbXMgdGhlIE1hcCB0aGF0IGhvbGRzIHRoZSB1\ncGRhdGUgcGFyYW1ldGVyczsgYSBudWxsCiAgICAgKiB2YWx1ZSBpbmRpY2F0\nZXMgdGhhdCB0aGlzIGlzIGEgZGVsZXRlIG9wZXJhdGlvbgogICAgICogQHJl\ndHVybiB0aGUgU1FMQnVmZmVyIGZvciB0aGUgdXBkYXRlLCBvciA8ZW0+bnVs\nbDwvZW0+IGlmIGl0IGlzIG5vdAogICAgICogcG9zc2libGUgdG8gcGVyZm9y\nbSB0aGUgYnVsayB1cGRhdGUKICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1\nZmZlciB0b0J1bGtPcGVyYXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFNl\nbGVjdCBzZWwsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBPYmplY3RbXSBw\nYXJhbXMsIE1hcCB1cGRhdGVQYXJhbXMpIHsKICAgICAgICBTUUxCdWZmZXIg\nc3FsID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBpZiAodXBkYXRl\nUGFyYW1zID09IG51bGwpIHsKICAgICAgICAgIGlmIChyZXF1aXJlc1Rhcmdl\ndEZvckRlbGV0ZSkgewogICAgICAgICAgICBzcWwuYXBwZW5kKCJERUxFVEUg\nIik7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBkZWxldGVUYXJnZXRzID0gZ2V0\nRGVsZXRlVGFyZ2V0cyhzZWwpOwogICAgICAgICAgICBzcWwuYXBwZW5kKGRl\nbGV0ZVRhcmdldHMpOwogICAgICAgICAgICBzcWwuYXBwZW5kKCIgRlJPTSAi\nKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNxbC5hcHBlbmQo\nIkRFTEVURSBGUk9NICIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHNxbC5hcHBlbmQoIlVQREFURSAiKTsKICAg\nICAgICBzZWwuYWRkSm9pbkNsYXNzQ29uZGl0aW9ucygpOwoKICAgICAgICAv\nLyBpZiB0aGVyZSBpcyBvbmx5IGEgc2luZ2xlIHRhYmxlIGluIHRoZSBzZWxl\nY3QsIHRoZW4gd2UgY2FuCiAgICAgICAgLy8ganVzdCBpc3N1ZSBhIHNpbmds\nZSBERUxFVEUgRlJPTSBUQUJMRSBXSEVSRSA8Y29uZGl0aW9ucz4KICAgICAg\nICAvLyBzdGF0ZW1lbnQ7IG90aGVyd2lzZSwgc2luY2UgU1FMIGRvZXNuJ3Qg\nYWxsb3cgZGVsZXRpbmcKICAgICAgICAvLyBmcm9tIG9uZSBvZiBhIG11bHRp\nLXRhYmxlIHNlbGVjdCwgd2UgbmVlZCB0byBpc3N1ZSBhIHN1YnNlbGVjdAog\nICAgICAgIC8vIGxpa2UgREVMRVRFIEZST00gVEFCTEUgV0hFUkUgRVhJU1RT\nCiAgICAgICAgLy8gKFNFTEVDVCAxIEZST00gVEFCTEUgdDAgV0hFUkUgdDAu\nSUQgPSBUQUJMRS5JRCk7IGFsc28sIHNvbWUKICAgICAgICAvLyBkYXRhYmFz\nZXMgZG8gbm90IGFsbG93IGFsaWFzZXMgaW4gZGVsZXRlIHN0YXRlbWVudHMs\nIHdoaWNoCiAgICAgICAgLy8gYWxzbyBjYXVzZXMgdXMgdG8gdXNlIGEgc3Vi\nc2VsZWN0CiAgICAgICAgaWYgKHNlbC5nZXRUYWJsZUFsaWFzZXMoKS5zaXpl\nKCkgPT0gMSAmJiBzdXBwb3J0c1N1YnNlbGVjdAogICAgICAgICAgICAmJiBh\nbGxvd3NBbGlhc0luQnVsa0NsYXVzZSkgewogICAgICAgICAgICBTUUxCdWZm\nZXIgZnJvbTsKICAgICAgICAgICAgaWYgKHNlbC5nZXRGcm9tU2VsZWN0KCkg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZyb20gPSBnZXRGcm9tU2VsZWN0\nKHNlbCwgZmFsc2UpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBmcm9tID0gZ2V0RnJvbShzZWwsIGZhbHNlKTsKCiAgICAgICAgICAgIHNx\nbC5hcHBlbmQoZnJvbSk7CiAgICAgICAgICAgIGFwcGVuZFVwZGF0ZXMoc2Vs\nLCBzdG9yZSwgc3FsLCBwYXJhbXMsIHVwZGF0ZVBhcmFtcywKICAgICAgICAg\nICAgICAgIGFsbG93c0FsaWFzSW5CdWxrQ2xhdXNlKTsKCiAgICAgICAgICAg\nIFNRTEJ1ZmZlciB3aGVyZSA9IHNlbC5nZXRXaGVyZSgpOwogICAgICAgICAg\nICBpZiAod2hlcmUgIT0gbnVsbCAmJiAhd2hlcmUuaXNFbXB0eSgpKSB7CiAg\nICAgICAgICAgICAgICBzcWwuYXBwZW5kKCIgV0hFUkUgIik7CiAgICAgICAg\nICAgICAgICBzcWwuYXBwZW5kKHdoZXJlKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICByZXR1cm4gc3FsOwogICAgICAgIH0KCiAgICAgICAgVGFibGUg\ndGFibGUgPSBtYXBwaW5nLmdldFRhYmxlKCk7CiAgICAgICAgU3RyaW5nIHRh\nYmxlTmFtZSA9IGdldEZ1bGxOYW1lKHRhYmxlLCBmYWxzZSk7CgogICAgICAg\nIC8vIG9ubHkgdXNlIGEgIHN1YnNlbGVjdCBpZiB0aGUgd2hlcmUgaXMgbm90\nIGVtcHR5OyBvdGhlcndpc2UKICAgICAgICAvLyBhbiB1bnF1YWxpZmllZCBk\nZWxldGUgb3IgdXBkYXRlIHdpbGwgd29yawogICAgICAgIGlmIChzZWwuZ2V0\nV2hlcmUoKSA9PSBudWxsIHx8IHNlbC5nZXRXaGVyZSgpLmlzRW1wdHkoKSkg\newogICAgICAgICAgICBzcWwuYXBwZW5kKHRhYmxlTmFtZSk7CiAgICAgICAg\nICAgIGFwcGVuZFVwZGF0ZXMoc2VsLCBzdG9yZSwgc3FsLCBwYXJhbXMsIHVw\nZGF0ZVBhcmFtcywgZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gc3FsOwog\nICAgICAgIH0KCiAgICAgICAgLy8gd2UgbmVlZCB0byB1c2UgYSBzdWJzZWxl\nY3QgaWYgd2UgYXJlIHRvIGJ1bGsgZGVsZXRlIHdoZXJlCiAgICAgICAgLy8g\ndGhlIHNlbGVjdCBpbmNsdWRlcyBtdWx0aXBsZSB0YWJsZXM7IGlmIHRoZSBk\nYXRhYmFzZQogICAgICAgIC8vIGRvZXNuJ3Qgc3VwcG9ydCBpdCwgdGhlbiB3\nZSBuZWVkIHRvIHNpZ2FsIHRoaXMgYnkgcmV0dXJuaW5nIG51bGwKICAgICAg\nICBpZiAoIXN1cHBvcnRzU3Vic2VsZWN0IHx8ICFzdXBwb3J0c0NvcnJlbGF0\nZWRTdWJzZWxlY3QpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBDb2x1bW5bXSBwa3MgPSBtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5z\nKCk7CiAgICAgICAgc2VsLmNsZWFyU2VsZWN0cygpOwogICAgICAgIHNlbC5z\nZXREaXN0aW5jdCh0cnVlKTsKCiAgICAgICAgLy8gaWYgd2UgaGF2ZSBvbmx5\nIGEgc2luZ2xlIFBLLCB3ZSBjYW4gdXNlIGEgbm9uLWNvcnJlbGF0ZWQKICAg\nICAgICAvLyBzdWJxdWVyeSAodXNpbmcgYW4gSU4gc3RhdGVtZW50KSwgd2hp\nY2ggaXMgbXVjaCBmYXN0ZXIgdGhhbgogICAgICAgIC8vIGEgY29ycmVsYXRl\nZCBzdWJxdWVyeSAoc2luY2UgYSBjb3JyZWxhdGVkIHN1YnF1ZXJ5IG5lZWRz\nCiAgICAgICAgLy8gdG8gYmUgZXhlY3V0ZWQgb25jZSBmb3IgZWFjaCByb3cg\naW4gdGhlIHRhYmxlKQogICAgICAgIGlmIChwa3MubGVuZ3RoID09IDEpIHsK\nICAgICAgICAgICAgc2VsLnNlbGVjdChwa3NbMF0pOwogICAgICAgICAgICBz\ncWwuYXBwZW5kKHRhYmxlTmFtZSk7CiAgICAgICAgICAgIGFwcGVuZFVwZGF0\nZXMoc2VsLCBzdG9yZSwgc3FsLCBwYXJhbXMsIHVwZGF0ZVBhcmFtcywgZmFs\nc2UpOwogICAgICAgICAgICBzcWwuYXBwZW5kKCIgV0hFUkUgIikuCiAgICAg\nICAgICAgICAgICBhcHBlbmQocGtzWzBdKS5hcHBlbmQoIiBJTiAoIikuCiAg\nICAgICAgICAgICAgICBhcHBlbmQoc2VsLnRvU2VsZWN0KGZhbHNlLCBudWxs\nKSkuYXBwZW5kKCIpIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nc2VsLmNsZWFyU2VsZWN0cygpOwogICAgICAgICAgICBzZWwuc2V0RGlzdGlu\nY3QoZmFsc2UpOwoKICAgICAgICAgICAgLy8gc2luY2UgdGhlIHNlbGVjdCBp\ncyB1c2luZyBhIGNvcnJlbGF0ZWQgc3VicXVlcnksIHdlCiAgICAgICAgICAg\nIC8vIG9ubHkgbmVlZCB0byBzZWxlY3QgYSBib2d1cyB2aXJ0dWFsIGNvbHVt\nbgogICAgICAgICAgICBzZWwuc2VsZWN0KCIxIiwgbnVsbCk7CgogICAgICAg\nICAgICAvLyBhZGQgaW4gdGhlIGpvaW5zIHRvIHRoZSB0YWJsZQogICAgICAg\nICAgICBDb2x1bW5bXSBjb2xzID0gdGFibGUuZ2V0UHJpbWFyeUtleSgpLmdl\ndENvbHVtbnMoKTsKICAgICAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBT\nUUxCdWZmZXIodGhpcyk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIigiKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoaSA+IDApCiAgICAgICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKCiAgICAgICAgICAgICAg\nICAvLyBhZGQgaW4gInQwLlBLID0gTVlUQUJMRS5QSyIKICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoc2VsLmdldENvbHVtbkFsaWFzKGNvbHNbaV0sIG51\nbGwpKS5hcHBlbmQoIiA9ICIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVu\nZCh0YWJsZSkuYXBwZW5kKGNhdGFsb2dTZXBhcmF0b3IpLmFwcGVuZChjb2xz\nW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBidWYuYXBwZW5kKCIp\nIik7CiAgICAgICAgICAgIHNlbC53aGVyZShidWYsIG51bGwpOwoKICAgICAg\nICAgICAgc3FsLmFwcGVuZCh0YWJsZU5hbWUpOwogICAgICAgICAgICBhcHBl\nbmRVcGRhdGVzKHNlbCwgc3RvcmUsIHNxbCwgcGFyYW1zLCB1cGRhdGVQYXJh\nbXMsIGZhbHNlKTsKICAgICAgICAgICAgc3FsLmFwcGVuZCgiIFdIRVJFIEVY\nSVNUUyAoIikuCiAgICAgICAgICAgICAgICBhcHBlbmQoc2VsLnRvU2VsZWN0\nKGZhbHNlLCBudWxsKSkuYXBwZW5kKCIpIik7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBzcWw7CiAgICB9CgogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBn\nZXREZWxldGVUYXJnZXRzKFNlbGVjdCBzZWwpIHsKICAgICAgU1FMQnVmZmVy\nIGRlbGV0ZVRhcmdldHMgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICBD\nb2xsZWN0aW9uIGFsaWFzZXMgPSBzZWwuZ2V0VGFibGVBbGlhc2VzKCk7CiAg\nICAgIC8vIEFzc3VtZXMgYWxpYXNlcyBhcmUgb2YgdGhlIGZvcm0gIlRBQkxF\nTkFNRSB0MCIKICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBhbGlhc2VzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgU3RyaW5nIHRh\nYmxlQWxpYXMgPSBpdHIubmV4dCgpLnRvU3RyaW5nKCk7CiAgICAgICAgaW50\nIHNwYWNlSW5kZXggPSB0YWJsZUFsaWFzLmluZGV4T2YoJyAnKTsKICAgICAg\nICBpZiAoc3BhY2VJbmRleCA+IDAgJiYgc3BhY2VJbmRleCA8IHRhYmxlQWxp\nYXMubGVuZ3RoKCkgLSAxKSB7CiAgICAgICAgICBpZiAoYWxsb3dzQWxpYXNJ\nbkJ1bGtDbGF1c2UpIHsKICAgICAgICAgICAgZGVsZXRlVGFyZ2V0cy5hcHBl\nbmQodGFibGVBbGlhcy5zdWJzdHJpbmcoc3BhY2VJbmRleCArIDEpKTsKICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRlbGV0ZVRhcmdldHMuYXBw\nZW5kKHRhYmxlQWxpYXMuc3Vic3RyaW5nKDAsIHNwYWNlSW5kZXgpKTsKICAg\nICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsZXRlVGFy\nZ2V0cy5hcHBlbmQodGFibGVBbGlhcyk7CiAgICAgICAgfQogICAgICAgIGlm\nIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgZGVsZXRlVGFyZ2V0cy5hcHBl\nbmQoIiwgIik7CiAgICAgIH0gICAgICAKICAgICAgcmV0dXJuIGRlbGV0ZVRh\ncmdldHM7ICAgICAgCiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5k\nVXBkYXRlcyhTZWxlY3Qgc2VsLCBKREJDU3RvcmUgc3RvcmUsIFNRTEJ1ZmZl\nciBzcWwsCiAgICAgICAgT2JqZWN0W10gcGFyYW1zLCBNYXAgdXBkYXRlUGFy\nYW1zLCBib29sZWFuIGFsbG93QWxpYXMpIHsKICAgICAgICBpZiAodXBkYXRl\nUGFyYW1zID09IG51bGwgfHwgdXBkYXRlUGFyYW1zLnNpemUoKSA9PSAwKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIG1hbnVhbGx5IGJ1aWxk\nIHVwIHRoZSBTRVQgY2xhdXNlIGZvciB0aGUgVVBEQVRFIHN0YXRlbWVudAog\nICAgICAgIHNxbC5hcHBlbmQoIiBTRVQgIik7CiAgICAgICAgRXhwQ29udGV4\ndCBjdHggPSBuZXcgRXhwQ29udGV4dChzdG9yZSwgcGFyYW1zLCAKICAgICAg\nICAgICAgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkpOwoKICAgICAg\nICAvLyBJZiB0aGUgdXBkYXRlcyBtYXAgY29udGFpbnMgYW55IHZlcnNpb24g\nZmllbGRzLCBhc3N1bWUgdGhhdCB0aGUKICAgICAgICAvLyBvcHRpbWlzdGlj\nIGxvY2sgdmVyc2lvbiBkYXRhIGlzIGJlaW5nIGhhbmRsZWQgcHJvcGVybHkg\nYnkgdGhlCiAgICAgICAgLy8gY2FsbGVyLiBPdGhlcndpc2UsIGdpdmUgdGhl\nIHZlcnNpb24gaW5kaWNhdG9yIGFuIG9wcG9ydHVuaXR5IHRvCiAgICAgICAg\nLy8gYWRkIG1vcmUgdXBkYXRlIGNsYXVzZXMgYXMgbmVlZGVkLgogICAgICAg\nIGJvb2xlYW4gYXVnbWVudFVwZGF0ZXMgPSB0cnVlOwoKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGkgPSB1cGRhdGVQYXJhbXMuZW50cnlTZXQoKS5pdGVyYXRv\ncigpOyBpLmhhc05leHQoKTspIHsKICAgICAgICAgICAgTWFwLkVudHJ5IG5l\neHQgPSAoTWFwLkVudHJ5KSBpLm5leHQoKTsKICAgICAgICAgICAgUGF0aCBw\nYXRoID0gKFBhdGgpIG5leHQuZ2V0S2V5KCk7CiAgICAgICAgICAgIEZpZWxk\nTWFwcGluZyBmbWQgPSAoRmllbGRNYXBwaW5nKSBwYXRoLmxhc3QoKTsKCiAg\nICAgICAgICAgIGlmIChmbWQuaXNWZXJzaW9uKCkpCiAgICAgICAgICAgICAg\nICBhdWdtZW50VXBkYXRlcyA9IGZhbHNlOwoKICAgICAgICAgICAgVmFsIHZh\nbCA9IChWYWwpIG5leHQuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgaWYgKHZh\nbCA9PSBudWxsKQogICAgICAgICAgICAJdmFsID0gbmV3IE51bGwoKTsKICAg\nICAgICAgICAgQ29sdW1uIGNvbCA9IGZtZC5nZXRDb2x1bW5zKClbMF07CiAg\nICAgICAgICAgIGlmIChhbGxvd0FsaWFzKSB7CiAgICAgICAgICAgICAgc3Fs\nLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoY29sKSk7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3FsLmFwcGVuZChjb2wuZ2V0TmFt\nZSgpKTsgIAogICAgICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAgICAg\nIHNxbC5hcHBlbmQoIiA9ICIpOwoKICAgICAgICAgICAgRXhwU3RhdGUgc3Rh\ndGUgPSB2YWwuaW5pdGlhbGl6ZShzZWwsIGN0eCwgMCk7CiAgICAgICAgICAg\nIC8vIEpEQkMgUGF0aHMgYXJlIGFsd2F5cyBQQ1BhdGhzOyBQQ1BhdGggaW1w\nbGVtZW50cyBWYWwKICAgICAgICAgICAgRXhwU3RhdGUgcGF0aFN0YXRlID0g\nKChWYWwpIHBhdGgpLmluaXRpYWxpemUoc2VsLCBjdHgsIDApOwogICAgICAg\nICAgICBjYWxjdWxhdGVWYWx1ZSh2YWwsIHNlbCwgY3R4LCBzdGF0ZSwgcGF0\naCwgcGF0aFN0YXRlKTsKCiAgICAgICAgICAgIC8vIGFwcGVuZCB0aGUgdmFs\ndWUgd2l0aCBhIG51bGwgZm9yIHRoZSBTZWxlY3Q7IGkKICAgICAgICAgICAg\nLy8gaW5kaWNhdGVzIHRoYXQgdGhlCiAgICAgICAgICAgIGludCBsZW5ndGgg\nPSB2YWwubGVuZ3RoKHNlbCwgY3R4LCBzdGF0ZSk7CiAgICAgICAgICAgIGZv\nciAoaW50IGogPSAwOyBqIDwgbGVuZ3RoOyBqKyspCiAgICAgICAgICAgICAg\nICB2YWwuYXBwZW5kVG8oKGFsbG93QWxpYXMpID8gc2VsIDogbnVsbCwgY3R4\nLCBzdGF0ZSwgc3FsLCBqKTsKCiAgICAgICAgICAgIGlmIChpLmhhc05leHQo\nKSkKICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoIiwgIik7CiAgICAgICAg\nfQoKICAgICAgICBpZiAoYXVnbWVudFVwZGF0ZXMpIHsKICAgICAgICAgICAg\nUGF0aCBwYXRoID0gKFBhdGgpIHVwZGF0ZVBhcmFtcy5rZXlTZXQoKS5pdGVy\nYXRvcigpLm5leHQoKTsKICAgICAgICAgICAgRmllbGRNYXBwaW5nIGZtID0g\nKEZpZWxkTWFwcGluZykgcGF0aC5sYXN0KCk7CiAgICAgICAgICAgIENsYXNz\nTWFwcGluZyBtZXRhID0gZm0uZ2V0RGVjbGFyaW5nTWFwcGluZygpOwogICAg\nICAgICAgICBNYXAgdXBkYXRlcyA9IG1ldGEuZ2V0VmVyc2lvbigpLmdldEJ1\nbGtVcGRhdGVWYWx1ZXMoKTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndGVyID0gdXBkYXRlcy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAg\nICAgICAgICBpdGVyLmhhc05leHQoKTsgKSB7CiAgICAgICAgICAgICAgICBN\nYXAuRW50cnkgZSA9IChNYXAuRW50cnkpIGl0ZXIubmV4dCgpOwogICAgICAg\nICAgICAgICAgQ29sdW1uIGNvbCA9IChDb2x1bW4pIGUuZ2V0S2V5KCk7CiAg\nICAgICAgICAgICAgICBTdHJpbmcgdmFsID0gKFN0cmluZykgZS5nZXRWYWx1\nZSgpOwogICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgiLCAiKS5hcHBlbmQo\nY29sLmdldE5hbWUoKSkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCIg\nPSAiKS5hcHBlbmQodmFsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVhdGUgU1FMIHRvIGRlbGV0ZSB0\naGUgY29udGVudHMgb2YgdGhlIHNwZWNpZmllZCB0YWJsZXMuIAogICAgICog\nVGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gZHJvcHMgYWxsIG5vbi1kZWZl\ncnJlZCBSRVNUUklDVCBmb3JlaWduIGtleSAKICAgICAqIGNvbnN0cmFpbnRz\nIGludm9sdmluZyB0aGUgc3BlY2lmaWVkIHRhYmxlcywgaXNzdWVzIERFTEVU\nRSBzdGF0ZW1lbnRzIAogICAgICogYWdhaW5zdCB0aGUgdGFibGVzLCBhbmQg\ndGhlbiBhZGRzIHRoZSBkcm9wcGVkIGNvbnN0cmFpbnRzIGJhY2sgaW4uIAog\nICAgICogRGF0YWJhc2VzIHdpdGggbW9yZSBvcHRpbWFsIHdheXMgb2YgZGVs\nZXRpbmcgdGhlIGNvbnRlbnRzIG9mIHNldmVyYWwgCiAgICAgKiB0YWJsZXMg\nc2hvdWxkIG92ZXJyaWRlIHRoaXMgbWV0aG9kLgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0RGVsZXRlVGFibGVDb250ZW50c1NRTChUYWJsZVtd\nIHRhYmxlcykgewogICAgICAgIENvbGxlY3Rpb24gc3FsID0gbmV3IEFycmF5\nTGlzdCgpOwogICAgICAgIAogICAgICAgIC8vIGNvbGxlY3QgYW5kIGRyb3Ag\nbm9uLWRlZmVycmVkIHBoeXNpY2FsIHJlc3RyaWN0IGNvbnN0cmFpbnRzLCBh\nbmQKICAgICAgICAvLyBjb2xsZWN0IHRoZSBERUxFVEUgRlJPTSBzdGF0ZW1l\nbnRzCiAgICAgICAgQ29sbGVjdGlvbiBkZWxldGVTUUwgPSBuZXcgQXJyYXlM\naXN0KHRhYmxlcy5sZW5ndGgpOwogICAgICAgIENvbGxlY3Rpb24gcmVzdHJp\nY3RDb25zdHJhaW50cyA9IG5ldyBMaW5rZWRIYXNoU2V0KCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCB0YWJsZXMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9IHRhYmxlc1tpXS5nZXRGb3Jl\naWduS2V5cygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGZr\ncy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYgKCFma3Nbal0u\naXNMb2dpY2FsKCkgJiYgIWZrc1tqXS5pc0RlZmVycmVkKCkgCiAgICAgICAg\nICAgICAgICAgICAgJiYgZmtzW2pdLmdldERlbGV0ZUFjdGlvbigpID09IEZv\ncmVpZ25LZXkuQUNUSU9OX1JFU1RSSUNUKQogICAgICAgICAgICAgICAgcmVz\ndHJpY3RDb25zdHJhaW50cy5hZGQoZmtzW2pdKTsKICAgICAgICAgICAgICAg\nIFN0cmluZ1tdIGNvbnN0cmFpbnRTUUwgPSBnZXREcm9wRm9yZWlnbktleVNR\nTChma3Nbal0pOwogICAgICAgICAgICAgICAgc3FsLmFkZEFsbChBcnJheXMu\nYXNMaXN0KGNvbnN0cmFpbnRTUUwpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICAKICAgICAgICAgICAgZGVsZXRlU1FMLmFkZCgiREVMRVRFIEZST00g\nIiArIHRhYmxlc1tpXS5nZXRGdWxsTmFtZSgpKTsKICAgICAgICB9CiAgICAg\nICAgCiAgICAgICAgLy8gYWRkIHRoZSBkZWxldGUgc3RhdGVtZW50cyBhZnRl\nciBhbGwgdGhlIGNvbnN0cmFpbnQgbXV0YXRpb25zCiAgICAgICAgc3FsLmFk\nZEFsbChkZWxldGVTUUwpOwogICAgICAgIAogICAgICAgIC8vIGFkZCB0aGUg\nZGVsZXRlZCBjb25zdHJhaW50cyBiYWNrIHRvIHRoZSBzY2hlbWEKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSByZXN0cmljdENvbnN0cmFpbnRzLml0\nZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOyApIHsKICAgICAgICAgICAgU3Ry\naW5nW10gY29uc3RyYWludFNRTCA9IAogICAgICAgICAgICAgICAgZ2V0QWRk\nRm9yZWlnbktleVNRTCgoRm9yZWlnbktleSkgaXRlci5uZXh0KCkpOwogICAg\nICAgICAgICBzcWwuYWRkQWxsKEFycmF5cy5hc0xpc3QoY29uc3RyYWludFNR\nTCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gKFN0cmlu\nZ1tdKSBzcWwudG9BcnJheShuZXcgU3RyaW5nW3NxbC5zaXplKCldKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIFNFTEVDVCBzdGF0ZW1lbnQg\naW4gdGhlIHByb3BlciBqb2luIHN5bnRheCBmb3IgdGhlIGdpdmVuCiAgICAg\nKiBpbnN0YW5jZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1Nl\nbGVjdChTZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSwKICAgICAgICBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgc2VsLmFk\nZEpvaW5DbGFzc0NvbmRpdGlvbnMoKTsKICAgICAgICBib29sZWFuIHVwZGF0\nZSA9IGZvclVwZGF0ZSAmJiBzZWwuZ2V0RnJvbVNlbGVjdCgpID09IG51bGw7\nCiAgICAgICAgU1FMQnVmZmVyIHNlbGVjdCA9IGdldFNlbGVjdHMoc2VsLCBm\nYWxzZSwgdXBkYXRlKTsKICAgICAgICBTUUxCdWZmZXIgb3JkZXJpbmcgPSBu\ndWxsOwogICAgICAgIGlmICghc2VsLmlzQWdncmVnYXRlKCkgfHwgc2VsLmdl\ndEdyb3VwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgb3JkZXJpbmcgPSBz\nZWwuZ2V0T3JkZXJpbmcoKTsKICAgICAgICBTUUxCdWZmZXIgZnJvbTsKICAg\nICAgICBpZiAoc2VsLmdldEZyb21TZWxlY3QoKSAhPSBudWxsKQogICAgICAg\nICAgICBmcm9tID0gZ2V0RnJvbVNlbGVjdChzZWwsIGZvclVwZGF0ZSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBmcm9tID0gZ2V0RnJvbShzZWwsIHVw\nZGF0ZSk7CiAgICAgICAgU1FMQnVmZmVyIHdoZXJlID0gZ2V0V2hlcmUoc2Vs\nLCB1cGRhdGUpOwogICAgICAgIHJldHVybiB0b1NlbGVjdChzZWxlY3QsIGZl\ndGNoLCBmcm9tLCB3aGVyZSwgc2VsLmdldEdyb3VwaW5nKCksCiAgICAgICAg\nICAgIHNlbC5nZXRIYXZpbmcoKSwgb3JkZXJpbmcsIHNlbC5pc0Rpc3RpbmN0\nKCksIGZvclVwZGF0ZSwKICAgICAgICAgICAgc2VsLmdldFN0YXJ0SW5kZXgo\nKSwgc2VsLmdldEVuZEluZGV4KCksIHNlbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHBvcnRpb24gb2YgdGhlIHNlbGVjdCBzdGF0ZW1l\nbnQgYmV0d2VlbiB0aGUgRlJPTSBrZXl3b3JkCiAgICAgKiBhbmQgdGhlIFdI\nRVJFIGtleXdvcmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxCdWZmZXIg\nZ2V0RnJvbShTZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSkgewogICAg\nICAgIFNRTEJ1ZmZlciBmcm9tU1FMID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsK\nICAgICAgICBDb2xsZWN0aW9uIGFsaWFzZXMgPSBzZWwuZ2V0VGFibGVBbGlh\nc2VzKCk7CiAgICAgICAgaWYgKGFsaWFzZXMuc2l6ZSgpIDwgMiB8fCBzZWwu\nZ2V0Sm9pblN5bnRheCgpICE9IFNZTlRBWF9TUUw5MikgewogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGFsaWFzZXMuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGZyb21TUUwuYXBwZW5k\nKGl0ci5uZXh0KCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICBpZiAo\nZm9yVXBkYXRlICYmIHRhYmxlRm9yVXBkYXRlQ2xhdXNlICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiAiKS5hcHBlbmQo\ndGFibGVGb3JVcGRhdGVDbGF1c2UpOwogICAgICAgICAgICAgICAgaWYgKGl0\nci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBl\nbmQoIiwgIik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBJdGVyYXRvciBpdHIgPSBzZWwuZ2V0Sm9pbkl0ZXJhdG9yKCk7\nCiAgICAgICAgICAgIGJvb2xlYW4gZmlyc3QgPSB0cnVlOwogICAgICAgICAg\nICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgZnJv\nbVNRTC5hcHBlbmQodG9TUUw5MkpvaW4oKEpvaW4pIGl0ci5uZXh0KCksIGZv\nclVwZGF0ZSwKICAgICAgICAgICAgICAgICAgICBmaXJzdCkpOwogICAgICAg\nICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gZnJvbVNRTDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgRlJPTSBjbGF1c2UgZm9yIGEgc2VsZWN0IHRoYXQg\nc2VsZWN0cyBmcm9tIGEgdG1wIHRhYmxlCiAgICAgKiBjcmVhdGVkIGJ5IGFu\nIGlubmVyIHNlbGVjdC4KICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1ZmZl\nciBnZXRGcm9tU2VsZWN0KFNlbGVjdCBzZWwsIGJvb2xlYW4gZm9yVXBkYXRl\nKSB7CiAgICAgICAgU1FMQnVmZmVyIGZyb21TUUwgPSBuZXcgU1FMQnVmZmVy\nKHRoaXMpOwogICAgICAgIGZyb21TUUwuYXBwZW5kKCIoIik7CiAgICAgICAg\nZnJvbVNRTC5hcHBlbmQodG9TZWxlY3Qoc2VsLmdldEZyb21TZWxlY3QoKSwg\nZm9yVXBkYXRlLCBudWxsKSk7CiAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiki\nKTsKICAgICAgICBpZiAocmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVjdCkKICAg\nICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiAiKS5hcHBlbmQoU2VsZWN0LkZS\nT01fU0VMRUNUX0FMSUFTKTsKICAgICAgICByZXR1cm4gZnJvbVNRTDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgV0hFUkUgcG9ydGlvbiBv\nZiB0aGUgc2VsZWN0IHN0YXRlbWVudCwgb3IgbnVsbCBpZiBubyB3aGVyZQog\nICAgICogY29uZGl0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1\nZmZlciBnZXRXaGVyZShTZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSkg\newogICAgICAgIEpvaW5zIGpvaW5zID0gc2VsLmdldEpvaW5zKCk7CiAgICAg\nICAgaWYgKHNlbC5nZXRKb2luU3ludGF4KCkgPT0gU1lOVEFYX1NRTDkyCiAg\nICAgICAgICAgIHx8IGpvaW5zID09IG51bGwgfHwgam9pbnMuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm4gc2VsLmdldFdoZXJlKCk7CgogICAgICAg\nIFNRTEJ1ZmZlciB3aGVyZSA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAg\nICAgaWYgKHNlbC5nZXRXaGVyZSgpICE9IG51bGwpCiAgICAgICAgICAgIHdo\nZXJlLmFwcGVuZChzZWwuZ2V0V2hlcmUoKSk7CiAgICAgICAgaWYgKGpvaW5z\nICE9IG51bGwpCiAgICAgICAgICAgIHNlbC5hcHBlbmQod2hlcmUsIGpvaW5z\nKTsKICAgICAgICByZXR1cm4gd2hlcmU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBVc2UgdGhlIGdpdmVuIGpvaW4gaW5zdGFuY2UgdG8gY3JlYXRlIFNRTCBq\nb2luaW5nIGl0cyB0YWJsZXMgaW4KICAgICAqIHRoZSB0cmFkaXRpb25hbCBz\ndHlsZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1RyYWRpdGlv\nbmFsSm9pbihKb2luIGpvaW4pIHsKICAgICAgICBGb3JlaWduS2V5IGZrID0g\nam9pbi5nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZrID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBib29sZWFuIGlu\ndmVyc2UgPSBqb2luLmlzRm9yZWlnbktleUludmVyc2VkKCk7CiAgICAgICAg\nQ29sdW1uW10gZnJvbSA9IChpbnZlcnNlKSA/IGZrLmdldFByaW1hcnlLZXlD\nb2x1bW5zKCkKICAgICAgICAgICAgOiBmay5nZXRDb2x1bW5zKCk7CiAgICAg\nICAgQ29sdW1uW10gdG8gPSAoaW52ZXJzZSkgPyBmay5nZXRDb2x1bW5zKCkK\nICAgICAgICAgICAgOiBmay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwoKICAg\nICAgICAvLyBkbyBjb2x1bW4gam9pbnMKICAgICAgICBTUUxCdWZmZXIgYnVm\nID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBpbnQgY291bnQgPSAw\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZnJvbS5sZW5ndGg7IGkr\nKywgY291bnQrKykgewogICAgICAgICAgICBpZiAoY291bnQgPiAwKQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAg\nYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMSgpKS5hcHBlbmQoIi4iKS5hcHBl\nbmQoZnJvbVtpXSk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwog\nICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVu\nZCgiLiIpLmFwcGVuZCh0b1tpXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBk\nbyBjb25zdGFudCBqb2lucwogICAgICAgIENvbHVtbltdIGNvbnN0Q29scyA9\nIGZrLmdldENvbnN0YW50Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgY29uc3RDb2xzLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAg\nICAgICAgICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAgICBpZiAoaW52ZXJzZSkKICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmRWYWx1ZShmay5nZXRDb25zdGFudChj\nb25zdENvbHNbaV0pLCBjb25zdENvbHNbaV0pOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMxKCkp\nLmFwcGVuZCgiLiIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZChjb25z\ndENvbHNbaV0pOwogICAgICAgICAgICBidWYuYXBwZW5kKCIgPSAiKTsKCiAg\nICAgICAgICAgIGlmIChpbnZlcnNlKQogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZChqb2luLmdldEFsaWFzMigpKS5hcHBlbmQoIi4iKS4KICAgICAgICAg\nICAgICAgICAgICBhcHBlbmQoY29uc3RDb2xzW2ldKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldENv\nbnN0YW50KGNvbnN0Q29sc1tpXSksIGNvbnN0Q29sc1tpXSk7CiAgICAgICAg\nfQoKICAgICAgICBDb2x1bW5bXSBjb25zdENvbHNQSyA9IGZrLmdldENvbnN0\nYW50UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNvbnN0Q29sc1BLLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAg\nICAgICAgICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAgICBpZiAoaW52ZXJzZSkKICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRBbGlhczEoKSkuYXBw\nZW5kKCIuIikuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKGNvbnN0Q29s\nc1BLW2ldKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZFZhbHVlKGZrLmdldFByaW1hcnlLZXlDb25zdGFudChjb25zdENv\nbHNQS1tpXSksCiAgICAgICAgICAgICAgICAgICAgY29uc3RDb2xzUEtbaV0p\nOwogICAgICAgICAgICBidWYuYXBwZW5kKCIgPSAiKTsKCiAgICAgICAgICAg\nIGlmIChpbnZlcnNlKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVl\nKGZrLmdldFByaW1hcnlLZXlDb25zdGFudChjb25zdENvbHNQS1tpXSksCiAg\nICAgICAgICAgICAgICAgICAgY29uc3RDb2xzUEtbaV0pOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxp\nYXMyKCkpLmFwcGVuZCgiLiIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVu\nZChjb25zdENvbHNQS1tpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBi\ndWY7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVuIGpvaW4g\naW5zdGFuY2UgdG8gY3JlYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJsZXMgaW4K\nICAgICAqIHRoZSBTUUw5MiBzdHlsZS4KICAgICAqLwogICAgcHVibGljIFNR\nTEJ1ZmZlciB0b1NRTDkySm9pbihKb2luIGpvaW4sIGJvb2xlYW4gZm9yVXBk\nYXRlLCBib29sZWFuIGZpcnN0KSB7CiAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9\nIG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgaWYgKGZpcnN0KSB7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRUYWJsZTEoKSkuYXBwZW5k\nKCIgIikuCiAgICAgICAgICAgICAgICBhcHBlbmQoam9pbi5nZXRBbGlhczEo\nKSk7CiAgICAgICAgICAgIGlmIChmb3JVcGRhdGUgJiYgdGFibGVGb3JVcGRh\ndGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiAiKS5hcHBlbmQodGFibGVGb3JVcGRhdGVDbGF1c2UpOwogICAgICAgIH0K\nCiAgICAgICAgYnVmLmFwcGVuZCgiICIpOwogICAgICAgIGlmIChqb2luLmdl\ndFR5cGUoKSA9PSBKb2luLlRZUEVfT1VURVIpCiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQob3V0ZXJKb2luQ2xhdXNlKTsKICAgICAgICBlbHNlIGlmIChqb2lu\nLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpCiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoaW5uZXJKb2luQ2xhdXNlKTsKICAgICAgICBlbHNlIC8vIGNy\nb3NzCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoY3Jvc3NKb2luQ2xhdXNlKTsK\nICAgICAgICBidWYuYXBwZW5kKCIgIik7CgogICAgICAgIGJ1Zi5hcHBlbmQo\nam9pbi5nZXRUYWJsZTIoKSkuYXBwZW5kKCIgIikuYXBwZW5kKGpvaW4uZ2V0\nQWxpYXMyKCkpOwogICAgICAgIGlmIChmb3JVcGRhdGUgJiYgdGFibGVGb3JV\ncGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nICIpLmFwcGVuZCh0YWJsZUZvclVwZGF0ZUNsYXVzZSk7CgogICAgICAgIGlm\nIChqb2luLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgT04gIikuYXBwZW5kKHRvVHJhZGl0aW9uYWxKb2luKGpv\naW4pKTsKICAgICAgICBlbHNlIGlmIChyZXF1aXJlc0NvbmRpdGlvbkZvckNy\nb3NzSm9pbiAmJgogICAgICAgICAgICBqb2luLmdldFR5cGUoKSA9PSBKb2lu\nLlRZUEVfQ1JPU1MpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBPTiAoMSA9\nIDEpIik7CgogICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBVc2UgdGhlIGdpdmVuIGpvaW4gaW5zdGFuY2UgdG8gY3JlYXRlIFNR\nTCBqb2luaW5nIGl0cyB0YWJsZXMgaW4KICAgICAqIHRoZSBkYXRhYmFzZSdz\nIG5hdGl2ZSBzeW50YXguIFRocm93cyBhbiBleGNlcHRpb24gYnkgZGVmYXVs\ndC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b05hdGl2ZUpvaW4o\nSm9pbiBqb2luKSB7CiAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGlmIHRo\nZSBnaXZlbiBmb3JlaWduIGtleSBjYW4gYmUgZWFnZXJseSBsb2FkZWQgdXNp\nbmcgb3RoZXIgam9pbnMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGNh\nbk91dGVySm9pbihpbnQgc3ludGF4LCBGb3JlaWduS2V5IGZrKSB7CiAgICAg\nICAgcmV0dXJuIHN5bnRheCAhPSBTWU5UQVhfVFJBRElUSU9OQUw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBjb21wb25lbnRz\nIGludG8gYSBTRUxFQ1Qgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMg\nU1FMQnVmZmVyIHRvU2VsZWN0KFNRTEJ1ZmZlciBzZWxlY3RzLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIFNRTEJ1ZmZlciBmcm9t\nLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwKICAgICAgICBT\nUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgYm9v\nbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBmb3JVcGRhdGUsIGxvbmcgc3RhcnQs\nIGxvbmcgZW5kKSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKGdldFNl\nbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVjdHMsIGZyb20sIHdoZXJlLAog\nICAgICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlzdGluY3QsIHN0\nYXJ0LCBlbmQsCiAgICAgICAgICAgIGdldEZvclVwZGF0ZUNsYXVzZShmZXRj\naCwgZm9yVXBkYXRlLCBudWxsKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb21iaW5lIHRoZSBnaXZlbiBjb21wb25lbnRzIGludG8gYSBTRUxFQ1Qgc3Rh\ndGVtZW50LgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0\nKFNRTEJ1ZmZlciBzZWxlY3RzLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUs\nIFNRTEJ1ZmZlciBncm91cCwKICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBT\nUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9v\nbGVhbiBmb3JVcGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAg\nIGJvb2xlYW4gc3Vic2VsZWN0KSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0\naW9uKGdldFNlbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVjdHMsIGZyb20s\nIHdoZXJlLAogICAgICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlz\ndGluY3QsIHN0YXJ0LCBlbmQsCiAgICAgICAgICAgIGdldEZvclVwZGF0ZUNs\nYXVzZShmZXRjaCwgZm9yVXBkYXRlLCBudWxsKSwgc3Vic2VsZWN0KTsKICAg\nIH0KICAgIAogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdChTUUxCdWZm\nZXIgc2VsZWN0cywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAg\nICAgICAgICAgU1FMQnVmZmVyIGZyb20sIFNRTEJ1ZmZlciB3aGVyZSwgU1FM\nQnVmZmVyIGdyb3VwLAogICAgICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBT\nUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgICAgIGJvb2xlYW4gZGlzdGluY3Qs\nIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25nIGVuZCwKICAg\nICAgICAgICAgYm9vbGVhbiBzdWJzZWxlY3QsIGJvb2xlYW4gY2hlY2tUYWJs\nZUZvclVwZGF0ZSkgewogICAgICAgICAgICByZXR1cm4gdG9PcGVyYXRpb24o\nZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKSwgc2VsZWN0cywgZnJvbSwgd2hl\ncmUsCiAgICAgICAgICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlz\ndGluY3QsIHN0YXJ0LCBlbmQsCiAgICAgICAgICAgICAgICBnZXRGb3JVcGRh\ndGVDbGF1c2UoZmV0Y2gsIGZvclVwZGF0ZSwgbnVsbCksIHN1YnNlbGVjdCwg\nY2hlY2tUYWJsZUZvclVwZGF0ZSk7CiAgICAgICAgfQoKICAgIC8qKgogICAg\nICogQ29tYmluZSB0aGUgZ2l2ZW4gY29tcG9uZW50cyBpbnRvIGEgU0VMRUNU\nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1Nl\nbGVjdChTUUxCdWZmZXIgc2VsZWN0cywgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwKICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FMQnVmZmVyIHdo\nZXJlLCBTUUxCdWZmZXIgZ3JvdXAsCiAgICAgICAgU1FMQnVmZmVyIGhhdmlu\nZywgU1FMQnVmZmVyIG9yZGVyLAogICAgICAgIGJvb2xlYW4gZGlzdGluY3Qs\nIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25nIGVuZCwKICAg\nICAgICBTZWxlY3Qgc2VsKSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9u\nKGdldFNlbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVjdHMsIGZyb20sIHdo\nZXJlLAogICAgICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlzdGlu\nY3QsIHN0YXJ0LCBlbmQsCiAgICAgICAgICAgIGdldEZvclVwZGF0ZUNsYXVz\nZShmZXRjaCwgZm9yVXBkYXRlLCBzZWwpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEdldCB0aGUgdXBkYXRlIGNsYXVzZSBmb3IgdGhlIHF1ZXJ5IGJhc2Vk\nIG9uIHRoZQogICAgICogdXBkYXRlQ2xhdXNlIGFuZCBpc29sYXRpb25MZXZl\nbCBoaW50cwogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldEZvclVw\nZGF0ZUNsYXVzZShKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAg\nICAgIGJvb2xlYW4gaXNGb3JVcGRhdGUsIFNlbGVjdCBzZWwpIHsKICAgICAg\nICBpZiAoZmV0Y2ggIT0gbnVsbCAmJiBmZXRjaC5nZXRJc29sYXRpb24oKSAh\nPSAtMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhj\nZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAgICAgImlzb2xhdGlvbi1s\nZXZlbC1jb25maWctbm90LXN1cHBvcnRlZCIsIGdldENsYXNzKCkuZ2V0TmFt\nZSgpKSk7CiAgICAgICAgfSBlbHNlIGlmIChpc0ZvclVwZGF0ZSAmJiAhc2lt\ndWxhdGVMb2NraW5nKSB7CiAgICAgICAgICAgIGFzc2VydFN1cHBvcnQoc3Vw\ncG9ydHNTZWxlY3RGb3JVcGRhdGUsICJTdXBwb3J0c1NlbGVjdEZvclVwZGF0\nZSIpOwogICAgICAgICAgICByZXR1cm4gZm9yVXBkYXRlQ2xhdXNlOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgIlNFTEVDVCIg\nb3BlcmF0aW9uIGNsYXVzZSwgYWRkaW5nIGFueSBhdmFpbGFibGUgaGludHMs\nIGV0Yy4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTZWxlY3RPcGVy\nYXRpb24oSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIHJldHVybiAiU0VMRUNUIjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlvbi4K\nICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b09wZXJhdGlvbihTdHJp\nbmcgb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNRTEJ1ZmZlciBm\ncm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwgU1FMQnVm\nZmVyIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIsIGJvb2xlYW4g\nZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFN0cmlu\nZyBmb3JVcGRhdGVDbGF1c2UpIHsKICAgICAgICByZXR1cm4gdG9PcGVyYXRp\nb24ob3AsIHNlbGVjdHMsIGZyb20sIHdoZXJlLCBncm91cCwgaGF2aW5nLCBv\ncmRlciwKICAgICAgICAgICAgZGlzdGluY3QsIHN0YXJ0LCBlbmQsIGZvclVw\nZGF0ZUNsYXVzZSwgZmFsc2UpOwogICAgfQogICAgCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJh\ndGlvbi4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b09wZXJhdGlv\nbihTdHJpbmcgb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNRTEJ1\nZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwg\nU1FMQnVmZmVyIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIsIGJv\nb2xlYW4gZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAg\nIFN0cmluZyBmb3JVcGRhdGVDbGF1c2UsIGJvb2xlYW4gc3Vic2VsZWN0KSB7\nCiAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKG9wLCBzZWxlY3RzLCBmcm9t\nLCB3aGVyZSwgZ3JvdXAsIGhhdmluZywgb3JkZXIsCiAgICAgICAgICAgICAg\nICBkaXN0aW5jdCwgc3RhcnQsIGVuZCwgZm9yVXBkYXRlQ2xhdXNlLCBzdWJz\nZWxlY3QsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlvbi4KICAg\nICAqLwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgdG9PcGVyYXRpb24oU3RyaW5n\nIG9wLCBTUUxCdWZmZXIgc2VsZWN0cywKICAgICAgICBTUUxCdWZmZXIgZnJv\nbSwgU1FMQnVmZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsIFNRTEJ1ZmZl\nciBoYXZpbmcsCiAgICAgICAgU1FMQnVmZmVyIG9yZGVyLCBib29sZWFuIGRp\nc3RpbmN0LCBsb25nIHN0YXJ0LCBsb25nIGVuZCwKICAgICAgICBTdHJpbmcg\nZm9yVXBkYXRlQ2xhdXNlLCBib29sZWFuIHN1YnNlbGVjdCwgYm9vbGVhbiBj\naGVja1RhYmxlRm9yVXBkYXRlKSB7CiAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9\nIG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgYnVmLmFwcGVuZChvcCk7\nCgogICAgICAgIGJvb2xlYW4gcmFuZ2UgPSBzdGFydCAhPSAwIHx8IGVuZCAh\nPSBMb25nLk1BWF9WQUxVRTsKICAgICAgICBpZiAocmFuZ2UgJiYgcmFuZ2VQ\nb3NpdGlvbiA9PSBSQU5HRV9QUkVfRElTVElOQ1QpCiAgICAgICAgICAgIGFw\ncGVuZFNlbGVjdFJhbmdlKGJ1Ziwgc3RhcnQsIGVuZCwgc3Vic2VsZWN0KTsK\nICAgICAgICBpZiAoZGlzdGluY3QpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBESVNUSU5DVCIpOwogICAgICAgIGlmIChyYW5nZSAmJiByYW5nZVBvc2l0\naW9uID09IFJBTkdFX1BPU1RfRElTVElOQ1QpCiAgICAgICAgICAgIGFwcGVu\nZFNlbGVjdFJhbmdlKGJ1Ziwgc3RhcnQsIGVuZCwgc3Vic2VsZWN0KTsKCiAg\nICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChzZWxlY3RzKS5hcHBlbmQo\nIiBGUk9NICIpLmFwcGVuZChmcm9tKTsKCiAgICAgICAgaWYgKGNoZWNrVGFi\nbGVGb3JVcGRhdGUKICAgICAgICAgICAgICAgICYmIChTdHJpbmdVdGlscy5p\nc0VtcHR5KGZvclVwZGF0ZUNsYXVzZSkgJiYgIVN0cmluZ1V0aWxzCiAgICAg\nICAgICAgICAgICAgICAgICAgIC5pc0VtcHR5KHRhYmxlRm9yVXBkYXRlQ2xh\ndXNlKSkpIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZCh0\nYWJsZUZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAo\nd2hlcmUgIT0gbnVsbCAmJiAhd2hlcmUuaXNFbXB0eSgpKQogICAgICAgICAg\nICBidWYuYXBwZW5kKCIgV0hFUkUgIikuYXBwZW5kKHdoZXJlKTsKICAgICAg\nICBpZiAoZ3JvdXAgIT0gbnVsbCAmJiAhZ3JvdXAuaXNFbXB0eSgpKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgR1JPVVAgQlkgIikuYXBwZW5kKGdyb3Vw\nKTsKICAgICAgICBpZiAoaGF2aW5nICE9IG51bGwgJiYgIWhhdmluZy5pc0Vt\ncHR5KCkpIHsKICAgICAgICAgICAgYXNzZXJ0U3VwcG9ydChzdXBwb3J0c0hh\ndmluZywgIlN1cHBvcnRzSGF2aW5nIik7CiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBIQVZJTkcgIikuYXBwZW5kKGhhdmluZyk7CiAgICAgICAgfQogICAg\nICAgIGlmIChvcmRlciAhPSBudWxsICYmICFvcmRlci5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBPUkRFUiBCWSAiKS5hcHBlbmQob3Jk\nZXIpOwogICAgICAgIGlmIChyYW5nZSAmJiByYW5nZVBvc2l0aW9uID09IFJB\nTkdFX1BPU1RfU0VMRUNUKQogICAgICAgICAgICBhcHBlbmRTZWxlY3RSYW5n\nZShidWYsIHN0YXJ0LCBlbmQsIHN1YnNlbGVjdCk7CiAgICAgICAgaWYgKGZv\nclVwZGF0ZUNsYXVzZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5k\nKCIgIikuYXBwZW5kKGZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgaWYgKHJh\nbmdlICYmIHJhbmdlUG9zaXRpb24gPT0gUkFOR0VfUE9TVF9MT0NLKQogICAg\nICAgICAgICBhcHBlbmRTZWxlY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQsIHN1\nYnNlbGVjdCk7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAgICAvKioK\nICAgICAqIElmIHRoaXMgZGljdGlvbmFyeSBjYW4gc2VsZWN0IHJhbmdlcywK\nICAgICAqIHVzZSB0aGlzIG1ldGhvZCB0byBhcHBlbmQgdGhlIHJhbmdlIFNR\nTC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5kU2VsZWN0UmFu\nZ2UoU1FMQnVmZmVyIGJ1ZiwgbG9uZyBzdGFydCwgbG9uZyBlbmQsCiAgICAg\nICAgYm9vbGVhbiBzdWJzZWxlY3QpIHsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgcG9ydGlvbiBvZiB0aGUgc2VsZWN0IHN0YXRlbWVudCBi\nZXR3ZWVuIHRoZSBTRUxFQ1Qga2V5d29yZAogICAgICogYW5kIHRoZSBGUk9N\nIGtleXdvcmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxCdWZmZXIgZ2V0\nU2VsZWN0cyhTZWxlY3Qgc2VsLCBib29sZWFuIGRpc3RpbmN0SWRlbnRpZmll\ncnMsCiAgICAgICAgYm9vbGVhbiBmb3JVcGRhdGUpIHsKICAgICAgICAvLyBh\ncHBlbmQgdGhlIGFsaWFzZXMgZm9yIGFsbCB0aGUgY29sdW1ucwogICAgICAg\nIFNRTEJ1ZmZlciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwog\nICAgICAgIExpc3QgYWxpYXNlczsKICAgICAgICBpZiAoZGlzdGluY3RJZGVu\ndGlmaWVycykKICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5nZXRJZGVudGlm\naWVyQWxpYXNlcygpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYWxpYXNl\ncyA9IHNlbC5nZXRTZWxlY3RBbGlhc2VzKCk7CgogICAgICAgIE9iamVjdCBh\nbGlhczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFsaWFzZXMuc2l6\nZSgpOyBpKyspIHsKICAgICAgICAgICAgYWxpYXMgPSBhbGlhc2VzLmdldChp\nKTsKICAgICAgICAgICAgYXBwZW5kU2VsZWN0KHNlbGVjdFNRTCwgYWxpYXMs\nIHNlbCwgaSk7CiAgICAgICAgICAgIGlmIChpIDwgYWxpYXNlcy5zaXplKCkg\nLSAxKQogICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiLCAiKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGVjdFNRTDsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFwcGVuZCA8Y29kZT5lbGVtPC9jb2RlPiB0byA8Y29k\nZT5zZWxlY3RTUUw8L2NvZGU+LgogICAgICogQHBhcmFtIHNlbGVjdFNRTCBU\naGUgU1FMQnVmZmVyIHRvIGFwcGVuZCB0by4KICAgICAqIEBwYXJhbSBhbGlh\ncyBBIHtAbGluayBTUUxCdWZmZXJ9IG9yIGEge0BsaW5rIFN0cmluZ30gdG8g\nYXBwZW5kLgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmRTZWxlY3QoU1FMQnVmZmVyIHNlbGVj\ndFNRTCwgT2JqZWN0IGVsZW0sIFNlbGVjdCBzZWwsCiAgICAgICAgaW50IGlk\neCkgewogICAgICAgIGlmIChlbGVtIGluc3RhbmNlb2YgU1FMQnVmZmVyKQog\nICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKChTUUxCdWZmZXIpIGVsZW0p\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZChl\nbGVtLnRvU3RyaW5nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\ncyB0cnVlIGlmIGEgIkZPUiBVUERBVEUiIGNsYXVzZSBjYW4gYmUgdXNlZCBm\nb3IgdGhlIHNwZWNpZmllZAogICAgICogU2VsZWN0IG9iamVjdC4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nKFNlbGVjdCBz\nZWwpIHsKICAgICAgICBpZiAoc2VsLmlzQWdncmVnYXRlKCkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIXN1cHBvcnRzU2VsZWN0\nRm9yVXBkYXRlKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\naWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFuZ2UgJiYgKHNlbC5n\nZXRTdGFydEluZGV4KCkgIT0gMAogICAgICAgICAgICB8fCBzZWwuZ2V0RW5k\nSW5kZXgoKSAhPSBMb25nLk1BWF9WQUxVRSkpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgLy8gb25seSBpbm5lciBzZWxlY3QgaXMgbG9j\na2VkCiAgICAgICAgaWYgKHNlbC5nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCkK\nICAgICAgICAgICAgc2VsID0gc2VsLmdldEZyb21TZWxlY3QoKTsKCiAgICAg\nICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoRGlzdGluY3RDbGF1c2UgJiYg\nc2VsLmlzRGlzdGluY3QoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aE11bHRpcGxlVGFibGVz\nCiAgICAgICAgICAgICYmIHNlbC5nZXRUYWJsZUFsaWFzZXMoKS5zaXplKCkg\nPiAxKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFz\ndXBwb3J0c0xvY2tpbmdXaXRoT3JkZXJDbGF1c2UgJiYgc2VsLmdldE9yZGVy\naW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aE91dGVySm9pbiB8fCAhc3Vw\ncG9ydHNMb2NraW5nV2l0aElubmVySm9pbikgewogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IHNlbC5nZXRKb2luSXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgIEpvaW4gam9pbiA9IChKb2lu\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKCFzdXBwb3J0c0xv\nY2tpbmdXaXRoT3V0ZXJKb2luCiAgICAgICAgICAgICAgICAgICAgJiYgam9p\nbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX09VVEVSKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICghc3Vw\ncG9ydHNMb2NraW5nV2l0aElubmVySm9pbgogICAgICAgICAgICAgICAgICAg\nICYmIGpvaW4uZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9JTk5FUikKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gZmFsc2UgaWYgdGhlIGdpdmVuIHNlbGVjdCByZXF1aXJl\ncyBhIGZvcndhcmQtb25seSByZXN1bHQgc2V0LgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c1JhbmRvbUFjY2Vzc1Jlc3VsdFNldChTZWxl\nY3Qgc2VsLAogICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAg\ncmV0dXJuICFzZWwuaXNBZ2dyZWdhdGUoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFzc2VydCB0aGF0IHRoZSBnaXZlbiBkaWN0aW9uYXJ5IGZsYWcgaXMg\ndHJ1ZS4gSWYgaXQgaXMgbm90IHRydWUsCiAgICAgKiB0aHJvdyBhbiBlcnJv\nciBzYXlpbmcgdGhhdCB0aGUgZ2l2ZW4gc2V0dGluZyBuZWVkcyB0byByZXR1\ncm4gdHJ1ZSBmb3IKICAgICAqIHRoZSBjdXJyZW50IG9wZXJhdGlvbiB0byB3\nb3JrLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRTdXBwb3J0KGJv\nb2xlYW4gZmVhdHVyZSwgU3RyaW5nIHByb3BlcnR5KSB7CiAgICAgICAgaWYg\nKCFmZWF0dXJlKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRF\neGNlcHRpb24oX2xvYy5nZXQoImZlYXR1cmUtbm90LXN1cHBvcnRlZCIsCiAg\nICAgICAgICAgICAgICBnZXRDbGFzcygpLCBwcm9wZXJ0eSkpOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBRdWVyeSBmdW5jdGlv\nbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBJ\nbnZva2UgdGhpcyBkYXRhYmFzZSdzIHN1YnN0cmluZyBmdW5jdGlvbi4KICAg\nICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRl\nIHRoZSBzdWJzdHJpbmcgaW52b2NhdGlvbiB0bwogICAgICogQHBhcmFtIHN0\nciBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0IHN0cmlu\nZwogICAgICogQHBhcmFtIHN0YXJ0IGEgcXVlcnkgdmFsdWUgcmVwcmVzZW50\naW5nIHRoZSBzdGFydCBpbmRleAogICAgICogQHBhcmFtIGVuZCBhIHF1ZXJ5\nIHZhbHVlIHJlcHJlc2VudGluZyB0aGUgZW5kIGluZGV4LCBvciBudWxsIGZv\nciBub25lCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN1YnN0cmluZyhTUUxC\ndWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSBzdHIsIEZpbHRlclZhbHVlIHN0YXJ0\nLAogICAgICAgIEZpbHRlclZhbHVlIGVuZCkgewogICAgICAgIGJ1Zi5hcHBl\nbmQoc3Vic3RyaW5nRnVuY3Rpb25OYW1lKS5hcHBlbmQoIigiKTsKICAgICAg\nICBzdHIuYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYuYXBwZW5kKCIsICIp\nOwogICAgICAgIGlmIChzdGFydC5nZXRWYWx1ZSgpIGluc3RhbmNlb2YgTnVt\nYmVyKSB7CiAgICAgICAgICAgIGxvbmcgc3RhcnRMb25nID0gdG9Mb25nKHN0\nYXJ0KTsKICAgICAgICAgICAgYnVmLmFwcGVuZChMb25nLnRvU3RyaW5nKHN0\nYXJ0TG9uZyArIDEpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIoIik7CiAgICAgICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1\nZik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiArIDEpIik7CiAgICAgICAg\nfQogICAgICAgIGlmIChlbmQgIT0gbnVsbCkgewogICAgICAgICAgICBidWYu\nYXBwZW5kKCIsICIpOwogICAgICAgICAgICBpZiAoc3RhcnQuZ2V0VmFsdWUo\nKSBpbnN0YW5jZW9mIE51bWJlcgogICAgICAgICAgICAgICAgJiYgZW5kLmdl\ndFZhbHVlKCkgaW5zdGFuY2VvZiBOdW1iZXIpIHsKICAgICAgICAgICAgICAg\nIGxvbmcgc3RhcnRMb25nID0gdG9Mb25nKHN0YXJ0KTsKICAgICAgICAgICAg\nICAgIGxvbmcgZW5kTG9uZyA9IHRvTG9uZyhlbmQpOwogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZChMb25nLnRvU3RyaW5nKGVuZExvbmcgLSBzdGFydExv\nbmcpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVu\nZC5hcHBlbmRUbyhidWYpOwogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nIC0gKCIpOwogICAgICAgICAgICAgICAgc3RhcnQuYXBwZW5kVG8oYnVmKTsK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICB9Cgog\nICAgbG9uZyB0b0xvbmcoRmlsdGVyVmFsdWUgbGl0VmFsdWUpIHsKICAgICAg\nICByZXR1cm4gKChOdW1iZXIpIGxpdFZhbHVlLmdldFZhbHVlKCkpLmxvbmdW\nYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHRoaXMgZGF0\nYWJhc2UncyBpbmRleE9mIGZ1bmN0aW9uLgogICAgICoKICAgICAqIEBwYXJh\nbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGluZGV4T2YgaW52\nb2NhdGlvbiB0bwogICAgICogQHBhcmFtIHN0ciBhIHF1ZXJ5IHZhbHVlIHJl\ncHJlc2VudGluZyB0aGUgdGFyZ2V0IHN0cmluZwogICAgICogQHBhcmFtIGZp\nbmQgYSBxdWVyeSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIHNlYXJjaCBzdHJp\nbmcKICAgICAqIEBwYXJhbSBzdGFydCBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2Vu\ndGluZyB0aGUgc3RhcnQgaW5kZXgsIG9yIG51bGwKICAgICAqIHRvIHN0YXJ0\nIGF0IHRoZSBiZWdpbm5pbmcKICAgICAqLwogICAgcHVibGljIHZvaWQgaW5k\nZXhPZihTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSBzdHIsIEZpbHRlclZh\nbHVlIGZpbmQsCiAgICAgICAgRmlsdGVyVmFsdWUgc3RhcnQpIHsKICAgICAg\nICBidWYuYXBwZW5kKCIoSU5TVFIoKCIpOwogICAgICAgIGlmIChzdGFydCAh\nPSBudWxsKQogICAgICAgICAgICBzdWJzdHJpbmcoYnVmLCBzdHIsIHN0YXJ0\nLCBudWxsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0ci5hcHBlbmRU\nbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiksICgiKTsKICAgICAgICBm\naW5kLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZCgiKSkgLSAx\nIik7CiAgICAgICAgaWYgKHN0YXJ0ICE9IG51bGwpIHsKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiICsgIik7CiAgICAgICAgICAgIHN0YXJ0LmFwcGVuZFRv\nKGJ1Zik7CiAgICAgICAgfQogICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCB0aGUgbnVtZXJpYyBwYXJ0cyBv\nZiBhIG1hdGhlbWF0aWNhbCBmdW5jdGlvbi4KICAgICAqCiAgICAgKiBAcGFy\nYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBtYXRoIGZ1bmN0\naW9uCiAgICAgKiBAcGFyYW0gb3AgdGhlIG1hdGhlbWF0aWNhbCBvcGVyYXRp\nb24gdG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUgbGVmdCBoYW5k\nIHNpZGUgb2YgdGhlIG1hdGggZnVuY3Rpb24KICAgICAqIEBwYXJhbSByaHMg\ndGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUgbWF0aCBmdW5jdGlvbgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBtYXRoRnVuY3Rpb24oU1FMQnVmZmVyIGJ1\nZiwgU3RyaW5nIG9wLCBGaWx0ZXJWYWx1ZSBsaHMsCiAgICAgICAgRmlsdGVy\nVmFsdWUgcmhzKSB7CiAgICAgICAgYm9vbGVhbiBjYXN0bGhzID0gZmFsc2U7\nCiAgICAgICAgYm9vbGVhbiBjYXN0cmhzID0gZmFsc2U7CiAgICAgICAgQ2xh\nc3MgbGMgPSBGaWx0ZXJzLndyYXAobGhzLmdldFR5cGUoKSk7CiAgICAgICAg\nQ2xhc3MgcmMgPSBGaWx0ZXJzLndyYXAocmhzLmdldFR5cGUoKSk7CiAgICAg\nICAgaW50IHR5cGUgPSAwOwogICAgICAgIGlmIChyZXF1aXJlc0Nhc3RGb3JN\nYXRoRnVuY3Rpb25zICYmIChsYyAhPSByYwogICAgICAgICAgICB8fCAobGhz\nLmlzQ29uc3RhbnQoKSAmJiByaHMuaXNDb25zdGFudCgpKSkpIHsKICAgICAg\nICAgICAgQ2xhc3MgYyA9IEZpbHRlcnMucHJvbW90ZShsYywgcmMpOwogICAg\nICAgICAgICB0eXBlID0gZ2V0SkRCQ1R5cGUoSmF2YVR5cGVzLmdldFR5cGVD\nb2RlKGMpLCBmYWxzZSk7CiAgICAgICAgICAgIGlmICh0eXBlICE9IFR5cGVz\nLlZBUkJJTkFSWSAmJiB0eXBlICE9IFR5cGVzLkJMT0IpIHsKICAgICAgICAg\nICAgICAgIGNhc3RsaHMgPSAobGhzLmlzQ29uc3RhbnQoKSAmJiByaHMuaXND\nb25zdGFudCgpKSB8fCBsYyAhPSBjOwogICAgICAgICAgICAgICAgY2FzdHJo\ncyA9IChsaHMuaXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50KCkpIHx8\nIHJjICE9IGM7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJv\nb2xlYW4gbW9kID0gIk1PRCIuZXF1YWxzKG9wKTsKICAgICAgICBpZiAobW9k\nKSB7CiAgICAgICAgICAgIGlmIChzdXBwb3J0c01vZE9wZXJhdG9yKQogICAg\nICAgICAgICAgICAgb3AgPSAiJSI7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQob3ApOwogICAgICAgIH0KICAgICAgICBi\ndWYuYXBwZW5kKCIoIik7CgogICAgICAgIGlmIChjYXN0bGhzKQogICAgICAg\nICAgICBhcHBlbmRDYXN0KGJ1ZiwgbGhzLCB0eXBlKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIGxocy5hcHBlbmRUbyhidWYpOwoKICAgICAgICBpZiAo\nbW9kICYmICFzdXBwb3J0c01vZE9wZXJhdG9yKQogICAgICAgICAgICBidWYu\nYXBwZW5kKCIsICIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiICIpLmFwcGVuZChvcCkuYXBwZW5kKCIgIik7CgogICAgICAgIGlm\nIChjYXN0cmhzKQogICAgICAgICAgICBhcHBlbmRDYXN0KGJ1ZiwgcmhzLCB0\neXBlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJocy5hcHBlbmRUbyhi\ndWYpOwoKICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBcHBlbmQgYSBjb21wYXJpc29uLgogICAgICoKICAgICAqIEBw\nYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGNvbXBhcmlz\nb24KICAgICAqIEBwYXJhbSBvcCB0aGUgY29tcGFyaXNvbiBvcGVyYXRpb24g\ndG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUgbGVmdCBoYW5kIHNp\nZGUgb2YgdGhlIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSByaHMgdGhlIHJp\nZ2h0IGhhbmQgc2lkZSBvZiB0aGUgY29tcGFyaXNvbgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBjb21wYXJpc29uKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBv\ncCwgRmlsdGVyVmFsdWUgbGhzLAogICAgICAgIEZpbHRlclZhbHVlIHJocykg\newogICAgICAgIGJvb2xlYW4gbGhzeG1sID0gbGhzLmdldFhQYXRoKCkgIT0g\nbnVsbDsKICAgICAgICBib29sZWFuIHJoc3htbCA9IHJocy5nZXRYUGF0aCgp\nICE9IG51bGw7CiAgICAgICAgaWYgKGxoc3htbCB8fCByaHN4bWwpIHsKICAg\nICAgICAgICAgYXBwZW5kWG1sQ29tcGFyaXNvbihidWYsIG9wLCBsaHMsIHJo\ncywgbGhzeG1sLCByaHN4bWwpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQogICAgICAgIGJvb2xlYW4gY2FzdGxocyA9IGZhbHNlOwogICAgICAg\nIGJvb2xlYW4gY2FzdHJocyA9IGZhbHNlOwogICAgICAgIENsYXNzIGxjID0g\nRmlsdGVycy53cmFwKGxocy5nZXRUeXBlKCkpOwogICAgICAgIENsYXNzIHJj\nID0gRmlsdGVycy53cmFwKHJocy5nZXRUeXBlKCkpOwogICAgICAgIGludCB0\neXBlID0gMDsKICAgICAgICBpZiAocmVxdWlyZXNDYXN0Rm9yQ29tcGFyaXNv\nbnMgJiYgKGxjICE9IHJjCiAgICAgICAgICAgIHx8IChsaHMuaXNDb25zdGFu\ndCgpICYmIHJocy5pc0NvbnN0YW50KCkpKSkgewogICAgICAgICAgICBDbGFz\ncyBjID0gRmlsdGVycy5wcm9tb3RlKGxjLCByYyk7CiAgICAgICAgICAgIHR5\ncGUgPSBnZXRKREJDVHlwZShKYXZhVHlwZXMuZ2V0VHlwZUNvZGUoYyksIGZh\nbHNlKTsKICAgICAgICAgICAgaWYgKHR5cGUgIT0gVHlwZXMuVkFSQklOQVJZ\nICYmIHR5cGUgIT0gVHlwZXMuQkxPQikgewogICAgICAgICAgICAgICAgY2Fz\ndGxocyA9IChsaHMuaXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50KCkp\nIHx8IGxjICE9IGM7CiAgICAgICAgICAgICAgICBjYXN0cmhzID0gKGxocy5p\nc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkgfHwgcmMgIT0gYzsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGNhc3RsaHMp\nCiAgICAgICAgICAgIGFwcGVuZENhc3QoYnVmLCBsaHMsIHR5cGUpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgbGhzLmFwcGVuZFRvKGJ1Zik7CgogICAg\nICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQob3ApLmFwcGVuZCgiICIpOwoK\nICAgICAgICBpZiAoY2FzdHJocykKICAgICAgICAgICAgYXBwZW5kQ2FzdChi\ndWYsIHJocywgdHlwZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByaHMu\nYXBwZW5kVG8oYnVmKTsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRoaXMg\nZGljdGlvbmFyeSBzdXBwb3J0cyBYTUwgdHlwZSwKICAgICAqIHVzZSB0aGlz\nIG1ldGhvZCB0byBhcHBlbmQgeG1sIHByZWRpY2F0ZS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgYXBwZW5kWG1sQ29tcGFyaXNvbihTUUxCdWZmZXIgYnVm\nLCBTdHJpbmcgb3AsIEZpbHRlclZhbHVlIGxocywKICAgICAgICBGaWx0ZXJW\nYWx1ZSByaHMsIGJvb2xlYW4gbGhzeG1sLCBib29sZWFuIHJoc3htbCkgewog\nICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNYTUxDb2x1bW4sICJTdXBw\nb3J0c1hNTENvbHVtbiIpOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5k\nIFNRTCBmb3IgdGhlIGdpdmVuIG51bWVyaWMgdmFsdWUgdG8gdGhlIGJ1ZmZl\nciwgY2FzdGluZyBhcyBuZWVkZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIGFwcGVuZE51bWVyaWNDYXN0KFNRTEJ1ZmZlciBidWYsIEZpbHRlclZh\nbHVlIHZhbCkgewogICAgICAgIGlmICh2YWwuaXNDb25zdGFudCgpKQogICAg\nICAgICAgICBhcHBlbmRDYXN0KGJ1ZiwgdmFsLCBUeXBlcy5OVU1FUklDKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIHZhbC5hcHBlbmRUbyhidWYpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ2FzdCB0aGUgc3BlY2lmaWVkIHZhbHVl\nIHRvIHRoZSBzcGVjaWZpZWQgdHlwZS4KICAgICAqCiAgICAgKiBAcGFyYW0g\nYnVmIHRoZSBidWZmZXIgdG8gYXBwZW5kIHRoZSBjYXN0IHRvCiAgICAgKiBA\ncGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBjYXN0CiAgICAgKiBAcGFyYW0gdHlw\nZSB0aGUgdHlwZSBvZiB0aGUgY2FzZSwgZS5nLiB7QGxpbmsgVHlwZXMjTlVN\nRVJJQ30KICAgICAqLwogICAgcHVibGljIHZvaWQgYXBwZW5kQ2FzdChTUUxC\ndWZmZXIgYnVmLCBPYmplY3QgdmFsLCBpbnQgdHlwZSkgewogICAgICAgIC8v\nIENvbnZlcnQgdGhlIGNhc3QgZnVuY3Rpb246ICJDQVNUKHswfSBBUyB7MX0p\nIgogICAgICAgIGludCBmaXJzdFBhcmFtID0gY2FzdEZ1bmN0aW9uLmluZGV4\nT2YoInswfSIpOwogICAgICAgIFN0cmluZyBwcmUgPSBjYXN0RnVuY3Rpb24u\nc3Vic3RyaW5nKDAsIGZpcnN0UGFyYW0pOyAvLyAiQ0FTVCgiCiAgICAgICAg\nU3RyaW5nIG1pZCA9IGNhc3RGdW5jdGlvbi5zdWJzdHJpbmcoZmlyc3RQYXJh\nbSArIDMpOwogICAgICAgIGludCBzZWNvbmRQYXJhbSA9IG1pZC5pbmRleE9m\nKCJ7MX0iKTsKICAgICAgICBTdHJpbmcgcG9zdDsKICAgICAgICBpZiAoc2Vj\nb25kUGFyYW0gPiAtMSkgewogICAgICAgICAgICBwb3N0ID0gbWlkLnN1YnN0\ncmluZyhzZWNvbmRQYXJhbSArIDMpOyAvLyAiKSIKICAgICAgICAgICAgbWlk\nID0gbWlkLnN1YnN0cmluZygwLCBzZWNvbmRQYXJhbSk7IC8vICIgQVMgIgog\nICAgICAgIH0gZWxzZQogICAgICAgICAgICBwb3N0ID0gIiI7CgogICAgICAg\nIGJ1Zi5hcHBlbmQocHJlKTsKICAgICAgICBpZiAodmFsIGluc3RhbmNlb2Yg\nRmlsdGVyVmFsdWUpCiAgICAgICAgICAgICgoRmlsdGVyVmFsdWUpIHZhbCku\nYXBwZW5kVG8oYnVmKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2Vv\nZiBTUUxCdWZmZXIpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoKChTUUxCdWZm\nZXIpIHZhbCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnVmLmFwcGVu\nZCh2YWwudG9TdHJpbmcoKSk7CiAgICAgICAgYnVmLmFwcGVuZChtaWQpOwog\nICAgICAgIGJ1Zi5hcHBlbmQoZ2V0VHlwZU5hbWUodHlwZSkpOwogICAgICAg\nIGFwcGVuZExlbmd0aChidWYsIHR5cGUpOwogICAgICAgIGJ1Zi5hcHBlbmQo\ncG9zdCk7CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZExl\nbmd0aChTUUxCdWZmZXIgYnVmLCBpbnQgdHlwZSkgeyAgICAgICAgCiAgICB9\nCgogICAgCiAgICAvKioKICAgICAqIGFkZCBDQVNUIGZvciBhIGZ1bmN0aW9u\nIG9wZXJhdG9yIHdoZXJlIG9wZXJhbmQgaXMgYSBwYXJhbQogICAgICogQHBh\ncmFtIGZ1bmMgIGZ1bmN0aW9uIG5hbWUKICAgICAqIEBwYXJhbSB2YWwgCiAg\nICAgKiBAcmV0dXJuIHVwZGF0ZWQgZnVuYwogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nIGFkZENhc3RBc1R5cGUoU3RyaW5nIGZ1bmMsIFZhbCB2YWwpIHsK\nICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0gICAgCgoKICAgIC8vLy8vLy8v\nLy8vCiAgICAvLyBEREwgU1FMCiAgICAvLy8vLy8vLy8vLwoKICAgIC8qKgog\nICAgICogSW5jcmVtZW50IHRoZSByZWZlcmVuY2UgY291bnQgb2YgYW55IHRh\nYmxlIGNvbXBvbmVudHMgdGhhdCB0aGlzCiAgICAgKiBkaWN0aW9uYXJ5IGFk\nZHMgdGhhdCBhcmUgbm90IHVzZWQgYnkgbWFwcGluZ3MuIERvZXMgbm90aGlu\nZyBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWZTY2hl\nbWFDb21wb25lbnRzKFRhYmxlIHRhYmxlKSB7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHRhYmxlLCBpbmNs\ndWRpbmcgdGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBieSB7QGxpbmsg\nI2NhdGFsb2dTZXBhcmF0b3J9KS4KICAgICAqLwogICAgcHVibGljIFN0cmlu\nZyBnZXRGdWxsTmFtZShUYWJsZSB0YWJsZSwgYm9vbGVhbiBsb2dpY2FsKSB7\nCiAgICAgICAgaWYgKCF1c2VTY2hlbWFOYW1lIHx8IHRhYmxlLmdldFNjaGVt\nYU5hbWUoKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdGFibGUuZ2V0\nTmFtZSgpOwogICAgICAgIGlmIChsb2dpY2FsIHx8ICIuIi5lcXVhbHMoY2F0\nYWxvZ1NlcGFyYXRvcikpCiAgICAgICAgICAgIHJldHVybiB0YWJsZS5nZXRG\ndWxsTmFtZSgpOwogICAgICAgIHJldHVybiB0YWJsZS5nZXRTY2hlbWFOYW1l\nKCkgKyBjYXRhbG9nU2VwYXJhdG9yICsgdGFibGUuZ2V0TmFtZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgZnVsbCBuYW1lIG9mIHRo\nZSBpbmRleCwgaW5jbHVkaW5nIHRoZSBzY2hlbWEgKGRlbGltaXRlZAogICAg\nICogYnkgdGhlIHJlc3VsdCBvZiB7QGxpbmsgI2NhdGFsb2dTZXBhcmF0b3J9\nKS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRGdWxsTmFtZShJbmRl\neCBpbmRleCkgewogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCBpbmRl\neC5nZXRTY2hlbWFOYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGluZGV4LmdldE5hbWUoKTsKICAgICAgICBpZiAoIi4iLmVxdWFscyhjYXRh\nbG9nU2VwYXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIGluZGV4LmdldEZ1\nbGxOYW1lKCk7CiAgICAgICAgcmV0dXJuIGluZGV4LmdldFNjaGVtYU5hbWUo\nKSArIGNhdGFsb2dTZXBhcmF0b3IgKyBpbmRleC5nZXROYW1lKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhl\nIHNlcXVlbmNlLCBpbmNsdWRpbmcgdGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAg\nICAgKiBieSB0aGUgcmVzdWx0IG9mIHtAbGluayAjY2F0YWxvZ1NlcGFyYXRv\ncn0pLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldEZ1bGxOYW1lKFNl\ncXVlbmNlIHNlcSkgewogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCBz\nZXEuZ2V0U2NoZW1hTmFtZSgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBzZXEuZ2V0TmFtZSgpOwogICAgICAgIGlmICgiLiIuZXF1YWxzKGNhdGFs\nb2dTZXBhcmF0b3IpKQogICAgICAgICAgICByZXR1cm4gc2VxLmdldEZ1bGxO\nYW1lKCk7CiAgICAgICAgcmV0dXJuIHNlcS5nZXRTY2hlbWFOYW1lKCkgKyBj\nYXRhbG9nU2VwYXJhdG9yICsgc2VxLmdldE5hbWUoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBn\naXZlbiB0YWJsZSBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0\naGUgY3VycmVudCBEQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRW\nYWxpZFRhYmxlTmFtZShTdHJpbmcgbmFtZSwgU2NoZW1hIHNjaGVtYSkgewog\nICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAgICAg\nICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIHJldHVybiBt\nYWtlTmFtZVZhbGlkKG5hbWUsIHNjaGVtYS5nZXRTY2hlbWFHcm91cCgpLAog\nICAgICAgICAgICBtYXhUYWJsZU5hbWVMZW5ndGgsIE5BTUVfVEFCTEUpOwog\nICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5n\nZXMgdG8gdGhlIGdpdmVuIHNlcXVlbmNlIG5hbWUgdG8gbWFrZSBpdCB2YWxp\nZAogICAgICogZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nIGdldFZhbGlkU2VxdWVuY2VOYW1lKFN0cmluZyBuYW1lLCBT\nY2hlbWEgc2NoZW1hKSB7CiAgICAgICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0\naCgiXyIpKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7\nCiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQoIlNfIiArIG5hbWUsIHNj\naGVtYS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhUYWJsZU5h\nbWVMZW5ndGgsIE5BTUVfU0VRVUVOQ0UpOwogICAgfQoKICAgIC8qKgogICAg\nICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVuIGNv\nbHVtbiBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUgY3Vy\ncmVudCBEQi4gIFRoZSBjb2x1bW4gbmFtZSB3aWxsIGJlIG1hZGUgdW5pcXVl\nIGZvciB0aGUKICAgICAqIHNwZWNpZmllZCB0YWJsZS4KICAgICAqLwogICAg\ncHVibGljIFN0cmluZyBnZXRWYWxpZENvbHVtbk5hbWUoU3RyaW5nIG5hbWUs\nIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0dXJuIGdldFZhbGlkQ29sdW1u\nTmFtZShuYW1lLCB0YWJsZSwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gY29s\ndW1uIG5hbWUgdG8gbWFrZSBpdCB2YWxpZAogICAgICogZm9yIHRoZSBjdXJy\nZW50IERCLiAgSWYgY2hlY2tGb3JVbmlxdWVuZXNzIGlzIHRydWUsIHRoZSBj\nb2x1bW4gbmFtZSB3aWxsIAogICAgICogYmUgbWFkZSB1bmlxdWUgZm9yIHRo\nZSBzcGVjaWZpZWQgdGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0VmFsaWRDb2x1bW5OYW1lKFN0cmluZyBuYW1lLCBUYWJsZSB0YWJsZSwK\nICAgICAgICBib29sZWFuIGNoZWNrRm9yVW5pcXVlbmVzcykgewogICAgICAg\nIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAgICAgICAgbmFt\nZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIHJldHVybiBtYWtlTmFt\nZVZhbGlkKG5hbWUsIHRhYmxlLCBtYXhDb2x1bW5OYW1lTGVuZ3RoLCBOQU1F\nX0FOWSwKICAgICAgICAgICAgY2hlY2tGb3JVbmlxdWVuZXNzKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRv\nIHRoZSBnaXZlbiBwcmltYXJ5IGtleSBuYW1lIHRvIG1ha2UgaXQKICAgICAq\nIHZhbGlkIGZvciB0aGUgY3VycmVudCBEQi4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZyBnZXRWYWxpZFByaW1hcnlLZXlOYW1lKFN0cmluZyBuYW1lLCBU\nYWJsZSB0YWJsZSkgewogICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgo\nIl8iKSkKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwog\nICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKCJQXyIgKyBuYW1lLCB0YWJs\nZS5nZXRTY2hlbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBt\nYXhDb25zdHJhaW50TmFtZUxlbmd0aCwgTkFNRV9BTlkpOwogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhl\nIGdpdmVuIGZvcmVpZ24ga2V5IG5hbWUgdG8gbWFrZSBpdAogICAgICogdmFs\naWQgZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nIGdldFZhbGlkRm9yZWlnbktleU5hbWUoU3RyaW5nIG5hbWUsIFRhYmxl\nIHRhYmxlLAogICAgICAgIFRhYmxlIHRvVGFibGUpIHsKICAgICAgICB3aGls\nZSAobmFtZS5zdGFydHNXaXRoKCJfIikpCiAgICAgICAgICAgIG5hbWUgPSBu\nYW1lLnN1YnN0cmluZygxKTsKICAgICAgICBTdHJpbmcgdGFibGVOYW1lID0g\ndGFibGUuZ2V0TmFtZSgpOwogICAgICAgIGludCBsZW4gPSBNYXRoLm1pbih0\nYWJsZU5hbWUubGVuZ3RoKCksIDcpOwogICAgICAgIG5hbWUgPSAiRl8iICsg\nc2hvcnRlbih0YWJsZU5hbWUsIGxlbikgKyAiXyIgKyBuYW1lOwogICAgICAg\nIHJldHVybiBtYWtlTmFtZVZhbGlkKG5hbWUsIHRhYmxlLmdldFNjaGVtYSgp\nLmdldFNjaGVtYUdyb3VwKCksCiAgICAgICAgICAgIG1heENvbnN0cmFpbnRO\nYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBN\nYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gaW5kZXgg\nbmFtZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQg\nREIuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRJbmRleE5h\nbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgd2hpbGUg\nKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1lID0gbmFt\nZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgU3RyaW5nIHRhYmxlTmFtZSA9IHRh\nYmxlLmdldE5hbWUoKTsKICAgICAgICBpbnQgbGVuID0gTWF0aC5taW4odGFi\nbGVOYW1lLmxlbmd0aCgpLCA3KTsKICAgICAgICBuYW1lID0gIklfIiArIHNo\nb3J0ZW4odGFibGVOYW1lLCBsZW4pICsgIl8iICsgbmFtZTsKICAgICAgICBy\nZXR1cm4gbWFrZU5hbWVWYWxpZChuYW1lLCB0YWJsZS5nZXRTY2hlbWEoKS5n\nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhJbmRleE5hbWVMZW5n\ndGgsIE5BTUVfQU5ZKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55\nIG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiB1bmlxdWUgY29uc3Ry\nYWludCBuYW1lIHRvIG1ha2UKICAgICAqIGl0IHZhbGlkIGZvciB0aGUgY3Vy\ncmVudCBEQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZFVu\naXF1ZU5hbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAg\nd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1l\nID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgU3RyaW5nIHRhYmxlTmFt\nZSA9IHRhYmxlLmdldE5hbWUoKTsKICAgICAgICBpbnQgbGVuID0gTWF0aC5t\naW4odGFibGVOYW1lLmxlbmd0aCgpLCA3KTsKICAgICAgICBuYW1lID0gIlVf\nIiArIHNob3J0ZW4odGFibGVOYW1lLCBsZW4pICsgIl8iICsgbmFtZTsKICAg\nICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZChuYW1lLCB0YWJsZS5nZXRTY2hl\nbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhDb25zdHJh\naW50TmFtZUxlbmd0aCwgTkFNRV9BTlkpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2hvcnRlbiB0aGUgc3BlY2lmaWVkIG5hbWUgdG8gdGhlIHNwZWNpZmll\nZCB0YXJnZXQgbmFtZS4gVGhpcyB3aWxsCiAgICAgKiBiZSBkb25lIGJ5IGZp\ncnN0IHN0cmlwcGluZyBvdXQgdGhlIHZvd2VscywgYW5kIHRoZW4gcmVtb3Zp\nbmcKICAgICAqIGNoYXJhY3RlcnMgZnJvbSB0aGUgbWlkZGxlIG9mIHRoZSB3\nb3JkIHVudGlsIGl0IHJlYWNoZXMgdGhlIHRhcmdldAogICAgICogbGVuZ3Ro\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIFN0cmluZyBzaG9ydGVu\nKFN0cmluZyBuYW1lLCBpbnQgdGFyZ2V0TGVuZ3RoKSB7CiAgICAgICAgaWYg\nKG5hbWUgPT0gbnVsbCB8fCBuYW1lLmxlbmd0aCgpIDw9IHRhcmdldExlbmd0\naCkKICAgICAgICAgICAgcmV0dXJuIG5hbWU7CgogICAgICAgIFN0cmluZ0J1\nZmZlciBubSA9IG5ldyBTdHJpbmdCdWZmZXIobmFtZSk7CiAgICAgICAgd2hp\nbGUgKG5tLmxlbmd0aCgpID4gdGFyZ2V0TGVuZ3RoKSB7CiAgICAgICAgICAg\nIGlmICghc3RyaXBWb3dlbChubSkpIHsKICAgICAgICAgICAgICAgIC8vIGN1\ndCBvdXQgdGhlIG1pZGRsZSBjaGFyCiAgICAgICAgICAgICAgICBubS5yZXBs\nYWNlKG5tLmxlbmd0aCgpIC8gMiwgKG5tLmxlbmd0aCgpIC8gMikgKyAxLCAi\nIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5t\nLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdm93\nZWxzIGZyb20gdGhlIHNwZWNpZmllZCBTdHJpbmdCdWZmZXIuCiAgICAgKgog\nICAgICogQHJldHVybiB0cnVlIGlmIGFueSB2b3dlbHMgaGF2ZSBiZWVuIHJl\nbW92ZWQKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBzdHJp\ncFZvd2VsKFN0cmluZ0J1ZmZlciBuYW1lKSB7CiAgICAgICAgaWYgKG5hbWUg\nPT0gbnVsbCB8fCBuYW1lLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKCiAgICAgICAgY2hhcltdIHZvd2VscyA9IHsgJ0EnLCAn\nRScsICdJJywgJ08nLCAnVScsIH07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCB2b3dlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaW50IGlu\nZGV4ID0gbmFtZS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkuaW5kZXhPZih2\nb3dlbHNbaV0pOwogICAgICAgICAgICBpZiAoaW5kZXggIT0gLTEpIHsKICAg\nICAgICAgICAgICAgIG5hbWUucmVwbGFjZShpbmRleCwgaW5kZXggKyAxLCAi\nIik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0byB0aGUgZ2l2\nZW4gbWF4aW11bSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQKICAgICAqIGl0\nIGlzIG5vdCBhIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJlc2VydmVkLCBh\ncHBlbmRzIGEgIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29uZmxpY3RzIHdp\ndGggYW4gZXhpc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCwgdGhlIGxhc3QKICAg\nICAqIGNoYXJhY3RlciBpcyByZXBsYWNlIHdpdGggJzAnLCB0aGVuICcxJywg\nZXRjLgogICAgICogTm90ZSB0aGF0IHRoZSBnaXZlbiBtYXggbGVuIG1heSBi\nZSAwIGlmIHRoZSBkYXRhYmFzZSBtZXRhZGF0YSBpcwogICAgICogaW5jb21w\nbGV0ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBtYWtlTmFtZVZh\nbGlkKFN0cmluZyBuYW1lLCBOYW1lU2V0IHNldCwgaW50IG1heExlbiwKICAg\nICAgICBpbnQgbmFtZVR5cGUpIHsKICAgICAgICByZXR1cm4gbWFrZU5hbWVW\nYWxpZChuYW1lLCBzZXQsIG1heExlbiwgbmFtZVR5cGUsIHRydWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogU2hvcnRlbnMgdGhlIGdpdmVuIG5hbWUgdG8g\ndGhlIGdpdmVuIG1heGltdW0gbGVuZ3RoLCB0aGVuIGNoZWNrcyB0aGF0CiAg\nICAgKiBpdCBpcyBub3QgYSByZXNlcnZlZCB3b3JkLiBJZiBpdCBpcyByZXNl\ncnZlZCwgYXBwZW5kcyBhICIwIi4gSWYKICAgICAqIHRoZSBuYW1lIGNvbmZs\naWN0cyB3aXRoIGFuIGV4aXN0aW5nIHNjaGVtYSBjb21wb25lbnQgYW5kIHVu\naXF1ZW5lc3MKICAgICAqIGNoZWNraW5nIGlzIGVuYWJsZWQsIHRoZSBsYXN0\nIGNoYXJhY3RlciBpcyByZXBsYWNlIHdpdGggJzAnLCB0aGVuIAogICAgICog\nJzEnLCBldGMuIAogICAgICogTm90ZSB0aGF0IHRoZSBnaXZlbiBtYXggbGVu\nIG1heSBiZSAwIGlmIHRoZSBkYXRhYmFzZSBtZXRhZGF0YSBpcyAKICAgICAq\nIGluY29tcGxldGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgbWFr\nZU5hbWVWYWxpZChTdHJpbmcgbmFtZSwgTmFtZVNldCBzZXQsIGludCBtYXhM\nZW4sCiAgICAgICAgaW50IG5hbWVUeXBlLCBib29sZWFuIGNoZWNrRm9yVW5p\ncXVlbmVzcykgewogICAgICAgIGlmIChtYXhMZW4gPCAxKQogICAgICAgICAg\nICBtYXhMZW4gPSAyNTU7CiAgICAgICAgaWYgKG5hbWUubGVuZ3RoKCkgPiBt\nYXhMZW4pCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygwLCBt\nYXhMZW4pOwogICAgICAgIGlmIChyZXNlcnZlZFdvcmRTZXQuY29udGFpbnMo\nbmFtZS50b1VwcGVyQ2FzZSgpKSkgewogICAgICAgICAgICBpZiAobmFtZS5s\nZW5ndGgoKSA9PSBtYXhMZW4pCiAgICAgICAgICAgICAgICBuYW1lID0gbmFt\nZS5zdWJzdHJpbmcoMCwgbmFtZS5sZW5ndGgoKSAtIDEpOwogICAgICAgICAg\nICBuYW1lICs9ICIwIjsKICAgICAgICB9CgogICAgICAgIC8vIG5vdyBtYWtl\nIHN1cmUgdGhlIG5hbWUgaXMgdW5pcXVlCiAgICAgICAgaWYgKHNldCAhPSBu\ndWxsICYmIGNoZWNrRm9yVW5pcXVlbmVzcykgewogICAgICAgICAgICBvdXRl\ncjoKICAgICAgICAgICAgZm9yIChpbnQgdmVyc2lvbiA9IDEsIGNoYXJzID0g\nMTsgdHJ1ZTsgdmVyc2lvbisrKSB7CiAgICAgICAgICAgICAgICAvLyBmb3Ig\ndGFibGUgbmFtZXMsIHdlIGNoZWNrIGZvciB0aGUgdGFibGUgaXRzZWxmIGlu\nIGNhc2UgdGhlCiAgICAgICAgICAgICAgICAvLyBuYW1lIHNldCBpcyBsYXp5\nIGFib3V0IHNjaGVtYSByZWZsZWN0aW9uCiAgICAgICAgICAgICAgICBzd2l0\nY2ggKG5hbWVUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBOQU1F\nX1RBQkxFOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgoU2NoZW1h\nR3JvdXApIHNldCkuaXNLbm93blRhYmxlKG5hbWUpKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgTkFNRV9T\nRVFVRU5DRToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoKFNjaGVt\nYUdyb3VwKSBzZXQpLmlzS25vd25TZXF1ZW5jZShuYW1lKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVyOwogICAgICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNldC5pc05hbWVUYWtl\nbihuYW1lKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIG91\ndGVyOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGEg\nc2luZ2xlIGNoYXIgZm9yIHRoZSB2ZXJzaW9uIGlzIHByb2JhYmx5IGVub3Vn\naCwgYnV0IG1pZ2h0CiAgICAgICAgICAgICAgICAvLyBhcyB3ZWxsIGJlIGdl\nbmVyYWwgYWJvdXQgaXQuLi4KICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9u\nID4gMSkKICAgICAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJp\nbmcoMCwgbmFtZS5sZW5ndGgoKSAtIGNoYXJzKTsKICAgICAgICAgICAgICAg\nIGlmICh2ZXJzaW9uID49IE1hdGgucG93KDEwLCBjaGFycykpCiAgICAgICAg\nICAgICAgICAgICAgY2hhcnMrKzsKICAgICAgICAgICAgICAgIGlmIChuYW1l\nLmxlbmd0aCgpICsgY2hhcnMgPiBtYXhMZW4pCiAgICAgICAgICAgICAgICAg\nICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIG1heExlbiAtIGNoYXJzKTsK\nICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICsgdmVyc2lvbjsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmFtZS50b1VwcGVy\nQ2FzZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVz\nIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGNyZWF0ZSB0aGUgZ2l2ZW4gdGFibGUs\nIGNvbXBsZXRlCiAgICAgKiB3aXRoIGNvbHVtbnMuIEluZGV4ZXMgYW5kIGNv\nbnN0cmFpbnRzIHdpbGwgYmUgY3JlYXRlZCBzZXBhcmF0ZWx5LgogICAgICov\nCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVTUUwoVGFibGUg\ndGFibGUpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmlu\nZ0J1ZmZlcigpOwogICAgICAgIFN0cmluZyB0YWJsZU5hbWUgPSBjaGVja05h\nbWVMZW5ndGgoZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKSwgCiAgICAgICAg\nCQltYXhUYWJsZU5hbWVMZW5ndGgsICJsb25nLXRhYmxlLW5hbWUiKTsKICAg\nICAgICBidWYuYXBwZW5kKCJDUkVBVEUgVEFCTEUgIikuYXBwZW5kKHRhYmxl\nTmFtZSk7CiAgICAgICAgaWYgKHN1cHBvcnRzQ29tbWVudHMgJiYgdGFibGUu\naGFzQ29tbWVudCgpKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAiKTsK\nICAgICAgICAgICAgY29tbWVudChidWYsIHRhYmxlLmdldENvbW1lbnQoKSk7\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlxuICAgICgiKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICBidWYuYXBwZW5kKCIgKCIpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gZG8gdGhpcyBiZWZvcmUgZ2V0dGluZyB0aGUgY29s\ndW1ucyBzbyB3ZSBrbm93IGhvdyB0byBoYW5kbGUKICAgICAgICAvLyB0aGUg\nbGFzdCBjb21tYQogICAgICAgIFN0cmluZ0J1ZmZlciBlbmRCdWYgPSBuZXcg\nU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgUHJpbWFyeUtleSBwayA9IHRhYmxl\nLmdldFByaW1hcnlLZXkoKTsKICAgICAgICBTdHJpbmcgcGtTdHI7CiAgICAg\nICAgaWYgKHBrICE9IG51bGwpIHsKICAgICAgICAgICAgcGtTdHIgPSBnZXRQ\ncmltYXJ5S2V5Q29uc3RyYWludFNRTChwayk7CiAgICAgICAgICAgIGlmIChw\na1N0ciAhPSBudWxsKQogICAgICAgICAgICAgICAgZW5kQnVmLmFwcGVuZChw\na1N0cik7CiAgICAgICAgfQoKICAgICAgICBVbmlxdWVbXSB1bnFzID0gdGFi\nbGUuZ2V0VW5pcXVlcygpOwogICAgICAgIFN0cmluZyB1bnFTdHI7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCB1bnFzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIHVucVN0ciA9IGdldFVuaXF1ZUNvbnN0cmFpbnRTUUwodW5x\nc1tpXSk7CiAgICAgICAgICAgIGlmICh1bnFTdHIgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgaWYgKGVuZEJ1Zi5sZW5ndGgoKSA+IDApCiAgICAgICAg\nICAgICAgICAgICAgZW5kQnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICAgICAg\nICAgIGVuZEJ1Zi5hcHBlbmQodW5xU3RyKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgQ29sdW1uW10gY29scyA9IHRhYmxlLmdldENvbHVt\nbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgYnVmLmFwcGVuZChnZXREZWNsYXJlQ29s\ndW1uU1FMKGNvbHNbaV0sIGZhbHNlKSk7CiAgICAgICAgICAgIGlmIChpIDwg\nY29scy5sZW5ndGggLSAxIHx8IGVuZEJ1Zi5sZW5ndGgoKSA+IDApCiAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAgICAgICBpZiAo\nc3VwcG9ydHNDb21tZW50cyAmJiBjb2xzW2ldLmhhc0NvbW1lbnQoKSkgewog\nICAgICAgICAgICAgICAgY29tbWVudChidWYsIGNvbHNbaV0uZ2V0Q29tbWVu\ndCgpKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlxuICAgICIpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBidWYuYXBwZW5kKGVu\nZEJ1Zi50b1N0cmluZygpKTsKICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAg\nICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgYnVmLnRvU3RyaW5nKCkgfTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nQnVmZmVyIGNvbW1lbnQoU3Ry\naW5nQnVmZmVyIGJ1ZiwgU3RyaW5nIGNvbW1lbnQpIHsKICAgICAgICByZXR1\ncm4gYnVmLmFwcGVuZCgiLS0gIikuYXBwZW5kKGNvbW1lbnQpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1l\nbnRzIHRvIGRyb3AgdGhlIGdpdmVuIHRhYmxlLiBJbmRleGVzCiAgICAgKiB3\naWxsIGJlIGRyb3BwZWQgc2VwYXJhdGVseS4gUmV0dXJucwogICAgICogPGNv\nZGU+RFJPUCBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDs8L2NvZGU+IGJ5IGRl\nZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREcm9wVGFi\nbGVTUUwoVGFibGUgdGFibGUpIHsKICAgICAgICBTdHJpbmcgZHJvcCA9IE1l\nc3NhZ2VGb3JtYXQuZm9ybWF0KGRyb3BUYWJsZVNRTCwgbmV3IE9iamVjdFtd\newogICAgICAgICAgICBnZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2UpIH0pOwog\nICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117IGRyb3AgfTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50\ncyB0byBjcmVhdGUgdGhlIGdpdmVuIHNlcXVlbmNlLiBSZXR1cm5zCiAgICAg\nKiA8Y29kZT5DUkVBVEUgU0VRVUVOQ0UgJmx0O3NlcXVlbmNlIG5hbWUmZ3Q7\nWyBTVEFSVCBXSVRIICZsdDtzdGFydCZndDtdCiAgICAgKiBbIElOQ1JFTUVO\nVCBCWSAmbHQ7aW5jcmVtZW50Jmd0O108L2NvZGU+IGJ5IGRlZmF1bHQuCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVTZXF1ZW5jZVNR\nTChTZXF1ZW5jZSBzZXEpIHsKICAgICAgICBpZiAobmV4dFNlcXVlbmNlUXVl\ncnkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAg\nICAgYnVmLmFwcGVuZCgiQ1JFQVRFIFNFUVVFTkNFICIpOwogICAgICAgIFN0\ncmluZyBzZXFOYW1lID0gY2hlY2tOYW1lTGVuZ3RoKGdldEZ1bGxOYW1lKHNl\ncSksIG1heFRhYmxlTmFtZUxlbmd0aCwgCiAgICAgICAgCQkibG9uZy1zZXEt\nbmFtZSIpOwogICAgICAgIGJ1Zi5hcHBlbmQoc2VxTmFtZSk7CiAgICAgICAg\naWYgKHNlcS5nZXRJbml0aWFsVmFsdWUoKSAhPSAwKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgU1RBUlQgV0lUSCAiKS5hcHBlbmQoc2VxLmdldEluaXRp\nYWxWYWx1ZSgpKTsKICAgICAgICBpZiAoc2VxLmdldEluY3JlbWVudCgpID4g\nMSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIElOQ1JFTUVOVCBCWSAiKS5h\ncHBlbmQoc2VxLmdldEluY3JlbWVudCgpKTsKICAgICAgICByZXR1cm4gbmV3\nIFN0cmluZ1tdeyBidWYudG9TdHJpbmcoKSB9OwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRy\nb3AgdGhlIGdpdmVuIHNlcXVlbmNlLiBSZXR1cm5zCiAgICAgKiA8Y29kZT5E\nUk9QIFNFUVVFTkNFICZsdDtzZXF1ZW5jZSBuYW1lJmd0OzwvY29kZT4gYnkg\nZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BT\nZXF1ZW5jZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAgICByZXR1cm4gbmV3\nIFN0cmluZ1tdeyAiRFJPUCBTRVFVRU5DRSAiICsgZ2V0RnVsbE5hbWUoc2Vx\nKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9m\nIFNRTCBzdGF0ZW1lbnRzIHRvIGNyZWF0ZSB0aGUgZ2l2ZW4gaW5kZXguIFJl\ndHVybnMKICAgICAqIDxjb2RlPkNSRUFURSBbVU5JUVVFXSBJTkRFWCAmbHQ7\naW5kZXggbmFtZSZndDsgT04gJmx0O3RhYmxlIG5hbWUmZ3Q7CiAgICAgKiAo\nJmx0O2NvbCBsaXN0Jmd0Oyk8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8K\nICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVJbmRleFNRTChJbmRleCBp\nbmRleCkgewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5n\nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiQ1JFQVRFICIpOwogICAg\nICAgIGlmIChpbmRleC5pc1VuaXF1ZSgpKQogICAgICAgICAgICBidWYuYXBw\nZW5kKCJVTklRVUUgIik7CiAgICAgICAgU3RyaW5nIGluZGV4TmFtZSA9IGNo\nZWNrTmFtZUxlbmd0aChpbmRleC5nZXROYW1lKCksIG1heEluZGV4TmFtZUxl\nbmd0aCwgCiAgICAgICAgICAgICAgICAibG9uZy1pbmRleC1uYW1lIik7CiAg\nICAgICAgYnVmLmFwcGVuZCgiSU5ERVggIikuYXBwZW5kKGluZGV4TmFtZSk7\nCiAgICAgICAgYnVmLmFwcGVuZCgiIE9OICIpLmFwcGVuZChnZXRGdWxsTmFt\nZShpbmRleC5nZXRUYWJsZSgpLCBmYWxzZSkpOwogICAgICAgIGJ1Zi5hcHBl\nbmQoIiAoIikuYXBwZW5kKFN0cmluZ3Muam9pbihpbmRleC5nZXRDb2x1bW5z\nKCksICIsICIpKS4KICAgICAgICAgICAgYXBwZW5kKCIpIik7CgogICAgICAg\nIHJldHVybiBuZXcgU3RyaW5nW117IGJ1Zi50b1N0cmluZygpIH07CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRl\nbWVudHMgdG8gZHJvcCB0aGUgZ2l2ZW4gaW5kZXguIFJldHVybnMKICAgICAq\nIDxjb2RlPkRST1AgSU5ERVggJmx0O2luZGV4IG5hbWUmZ3Q7PC9jb2RlPiBi\neSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RHJv\ncEluZGV4U1FMKEluZGV4IGluZGV4KSB7CiAgICAgICAgcmV0dXJuIG5ldyBT\ndHJpbmdbXXsgIkRST1AgSU5ERVggIiArIGdldEZ1bGxOYW1lKGluZGV4KSB9\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNR\nTCBzdGF0ZW1lbnRzIHRvIGFkZCB0aGUgZ2l2ZW4gY29sdW1uIHRvCiAgICAg\nKiBpdHMgdGFibGUuIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRp\nb24gbm90IHN1cHBvcnRlZC4gUmV0dXJucwogICAgICogPGNvZGU+QUxURVIg\nVEFCTEUgJmx0O3RhYmxlIG5hbWUmZ3Q7IEFERCAoJmx0O2NvbCBkZWMmZ3Q7\nKTwvY29kZT4KICAgICAqIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBTdHJpbmdbXSBnZXRBZGRDb2x1bW5TUUwoQ29sdW1uIGNvbHVtbikgewog\nICAgICAgIGlmICghc3VwcG9ydHNBbHRlclRhYmxlV2l0aEFkZENvbHVtbikK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CgogICAgICAgIFN0\ncmluZyBkZWMgPSBnZXREZWNsYXJlQ29sdW1uU1FMKGNvbHVtbiwgdHJ1ZSk7\nCiAgICAgICAgaWYgKGRlYyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbmV3IFN0cmluZ1swXTsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAi\nQUxURVIgVEFCTEUgIgogICAgICAgICAgICArIGdldEZ1bGxOYW1lKGNvbHVt\nbi5nZXRUYWJsZSgpLCBmYWxzZSkgKyAiIEFERCAiICsgZGVjIH07CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRl\nbWVudHMgdG8gZHJvcCB0aGUgZ2l2ZW4gY29sdW1uIGZyb20KICAgICAqIGl0\ncyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5IGlmIG9wZXJhdGlvbiBu\nb3Qgc3VwcG9ydGVkLiBSZXR1cm5zCiAgICAgKiA8Y29kZT5BTFRFUiBUQUJM\nRSAmbHQ7dGFibGUgbmFtZSZndDsgRFJPUCBDT0xVTU4gJmx0O2NvbCBuYW1l\nJmd0OzwvY29kZT4KICAgICAqIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmdbXSBnZXREcm9wQ29sdW1uU1FMKENvbHVtbiBjb2x1bW4p\nIHsKICAgICAgICBpZiAoIXN1cHBvcnRzQWx0ZXJUYWJsZVdpdGhEcm9wQ29s\ndW1uKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsKICAgICAg\nICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgogICAgICAg\nICAgICArIGdldEZ1bGxOYW1lKGNvbHVtbi5nZXRUYWJsZSgpLCBmYWxzZSkK\nICAgICAgICAgICAgKyAiIERST1AgQ09MVU1OICIgKyBjb2x1bW4gfTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3Rh\ndGVtZW50cyB0byBhZGQgdGhlIGdpdmVuIHByaW1hcnkga2V5IHRvCiAgICAg\nKiBpdHMgdGFibGUuIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRp\nb24gbm90IHN1cHBvcnRlZC4KICAgICAqIFJldHVybnMgPGNvZGU+QUxURVIg\nVEFCTEUgJmx0O3RhYmxlIG5hbWUmZ3Q7IEFERAogICAgICogJmx0O3BrIGNv\nbnMgc3FsICZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmdbXSBnZXRBZGRQcmltYXJ5S2V5U1FMKFByaW1hcnlLZXkg\ncGspIHsKICAgICAgICBTdHJpbmcgcGtzcWwgPSBnZXRQcmltYXJ5S2V5Q29u\nc3RyYWludFNRTChwayk7CiAgICAgICAgaWYgKHBrc3FsID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVy\nbiBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsg\nZ2V0RnVsbE5hbWUocGsuZ2V0VGFibGUoKSwgZmFsc2UpICsgIiBBREQgIiAr\nIHBrc3FsIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJp\nZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gZHJvcCB0aGUgZ2l2ZW4gcHJpbWFy\neSBrZXkgZnJvbQogICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkg\nYXJyYXkgaWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiBSZXR1\ncm5zIDxjb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBEUk9Q\nIENPTlNUUkFJTlQKICAgICAqICZsdDtwayBuYW1lJmd0OzwvY29kZT4gYnkg\nZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BQ\ncmltYXJ5S2V5U1FMKFByaW1hcnlLZXkgcGspIHsKICAgICAgICBpZiAocGsu\nZ2V0TmFtZSgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU3Ry\naW5nWzBdOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRFUiBU\nQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUocGsuZ2V0VGFibGUo\nKSwgZmFsc2UpCiAgICAgICAgICAgICsgIiBEUk9QIENPTlNUUkFJTlQgIiAr\nIHBrLmdldE5hbWUoKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGFkZCB0aGUgZ2l2ZW4g\nZm9yZWlnbiBrZXkgdG8KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVt\ncHR5IGFycmF5IGlmIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLgogICAgICog\nUmV0dXJucyA8Y29kZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsg\nQURECiAgICAgKiAmbHQ7ZmsgY29ucyBzcWwgJmd0OzwvY29kZT4gYnkgZGVm\nYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldEFkZEZvcmVp\nZ25LZXlTUUwoRm9yZWlnbktleSBmaykgewogICAgICAgIFN0cmluZyBma1NR\nTCA9IGdldEZvcmVpZ25LZXlDb25zdHJhaW50U1FMKGZrKTsKICAgICAgICBp\nZiAoZmtTUUwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJp\nbmdbMF07CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRB\nQkxFICIKICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShmay5nZXRUYWJsZSgp\nLCBmYWxzZSkgKyAiIEFERCAiICsgZmtTUUwgfTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBk\ncm9wIHRoZSBnaXZlbiBmb3JlaWduIGtleSBmcm9tCiAgICAgKiBpdHMgdGFi\nbGUuIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90IHN1\ncHBvcnRlZC4KICAgICAqIFJldHVybnMgPGNvZGU+QUxURVIgVEFCTEUgJmx0\nO3RhYmxlIG5hbWUmZ3Q7IERST1AgQ09OU1RSQUlOVAogICAgICogJmx0O2Zr\nIG5hbWUmZ3Q7PC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0RHJvcEZvcmVpZ25LZXlTUUwoRm9yZWlnbktleSBm\naykgewogICAgICAgIGlmIChmay5nZXROYW1lKCkgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAgICAgcmV0dXJuIG5l\ndyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBnZXRG\ndWxsTmFtZShmay5nZXRUYWJsZSgpLCBmYWxzZSkKICAgICAgICAgICAgKyAi\nIERST1AgQ09OU1RSQUlOVCAiICsgZmsuZ2V0TmFtZSgpIH07CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRlY2xhcmF0aW9uIFNRTCBmb3Ig\ndGhlIGdpdmVuIGNvbHVtbi4gVGhpcyBtZXRob2QgaXMgdXNlZAogICAgICog\nZm9yIGVhY2ggY29sdW1uIGZyb20gd2l0aGluIHtAbGluayAjZ2V0Q3JlYXRl\nVGFibGVTUUx9IGFuZAogICAgICoge0BsaW5rICNnZXRBZGRDb2x1bW5TUUx9\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldERlY2xhcmVDb2x1\nbW5TUUwoQ29sdW1uIGNvbCwgYm9vbGVhbiBhbHRlcikgewogICAgICAgIFN0\ncmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAg\nU3RyaW5nIGNvbHVtbk5hbWUgPSBjaGVja05hbWVMZW5ndGgoY29sLmdldE5h\nbWUoKSwgbWF4Q29sdW1uTmFtZUxlbmd0aCwgCiAgICAgICAgCQkibG9uZy1j\nb2x1bW4tbmFtZSIpOwogICAgICAgIGJ1Zi5hcHBlbmQoY29sdW1uTmFtZSku\nYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZChnZXRUeXBlTmFtZShj\nb2wpKTsKCiAgICAgICAgLy8gY2FuJ3QgYWRkIGNvbnN0cmFpbnRzIHRvIGEg\nY29sdW1uIHdlJ3JlIGFkZGluZyBhZnRlciB0YWJsZQogICAgICAgIC8vIGNy\nZWF0aW9uLCBjYXVzZSBzb21lIGRhdGEgbWlnaHQgYWxyZWFkeSBiZSBpbnNl\ncnRlZAogICAgICAgIGlmICghYWx0ZXIpIHsKICAgICAgICAgICAgaWYgKGNv\nbC5nZXREZWZhdWx0U3RyaW5nKCkgIT0gbnVsbCAmJiAhY29sLmlzQXV0b0Fz\nc2lnbmVkKCkpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgREVGQVVM\nVCAiKS5hcHBlbmQoY29sLmdldERlZmF1bHRTdHJpbmcoKSk7CiAgICAgICAg\nICAgIGlmIChjb2wuaXNOb3ROdWxsKCkpCiAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKCIgTk9UIE5VTEwiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNv\nbC5pc0F1dG9Bc3NpZ25lZCgpKSB7CiAgICAgICAgICAgIGlmICghc3VwcG9y\ndHNBdXRvQXNzaWduKQogICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5n\nZXQoImludmFsaWQtYXV0b2Fzc2lnbiIsIHBsYXRmb3JtLCBjb2wpKTsKICAg\nICAgICAgICAgZWxzZSBpZiAoYXV0b0Fzc2lnbkNsYXVzZSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChhdXRvQXNz\naWduQ2xhdXNlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0\ncmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWNs\nYXJhdGlvbiBTUUwgZm9yIHRoZSBnaXZlbiBwcmltYXJ5IGtleS4gVGhpcyBt\nZXRob2QgaXMKICAgICAqIHVzZWQgZnJvbSB3aXRoaW4ge0BsaW5rICNnZXRD\ncmVhdGVUYWJsZVNRTH0gYW5kCiAgICAgKiB7QGxpbmsgI2dldEFkZFByaW1h\ncnlLZXlTUUx9LiBSZXR1cm5zCiAgICAgKiA8Y29kZT5DT05TVFJBSU5UICZs\ndDtwayBuYW1lJmd0OyBQUklNQVJZIEtFWSAoJmx0O2NvbCBsaXN0Jmd0Oyk8\nL2NvZGU+CiAgICAgKiBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0\nZWQgU3RyaW5nIGdldFByaW1hcnlLZXlDb25zdHJhaW50U1FMKFByaW1hcnlL\nZXkgcGspIHsKICAgICAgICAvLyBpZiB3ZSBoYXZlIGRpc2FibGVkIHRoZSBj\ncmVhdGlvbiBvZiBwcmltYXJ5IGtleXMsIGFib3J0IGhlcmUKICAgICAgICBp\nZiAoIWNyZWF0ZVByaW1hcnlLZXlzKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgU3RyaW5nIG5hbWUgPSBway5nZXROYW1lKCk7CiAgICAg\nICAgaWYgKG5hbWUgIT0gbnVsbCAmJiByZXNlcnZlZFdvcmRTZXQuY29udGFp\nbnMobmFtZS50b1VwcGVyQ2FzZSgpKSkKICAgICAgICAgICAgbmFtZSA9IG51\nbGw7CgogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVm\nZmVyKCk7CiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBDT05TX05BTUVf\nQkVGT1JFLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAg\nICBidWYuYXBwZW5kKCJDT05TVFJBSU5UICIpLmFwcGVuZChuYW1lKS5hcHBl\nbmQoIiAiKTsKICAgICAgICBidWYuYXBwZW5kKCJQUklNQVJZIEtFWSAiKTsK\nICAgICAgICBpZiAobmFtZSAhPSBudWxsICYmIENPTlNfTkFNRV9NSUQuZXF1\nYWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQobmFtZSkuYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiKCIp\nLmFwcGVuZChTdHJpbmdzLmpvaW4ocGsuZ2V0Q29sdW1ucygpLCAiLCAiKSku\nCiAgICAgICAgICAgIGFwcGVuZCgiKSIpOwogICAgICAgIGlmIChuYW1lICE9\nIG51bGwgJiYgQ09OU19OQU1FX0FGVEVSLmVxdWFscyhjb25zdHJhaW50TmFt\nZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQ09OU1RSQUlOVCAi\nKS5hcHBlbmQobmFtZSk7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWNsYXJhdGlv\nbiBTUUwgZm9yIHRoZSBnaXZlbiBmb3JlaWduIGtleSwgb3IgbnVsbCBpZiBp\ndCBpcwogICAgICogbm90IHN1cHBvcnRlZC4gVGhpcyBtZXRob2QgaXMgdXNl\nZCBmcm9tIHdpdGhpbgogICAgICoge0BsaW5rICNnZXRDcmVhdGVUYWJsZVNR\nTH0gYW5kIHtAbGluayAjZ2V0QWRkRm9yZWlnbktleVNRTH0uIFJldHVybnMK\nICAgICAqIDxjb2RlPkNPTlNUUkFJTlQgJmx0O2NvbnMgbmFtZSZndDsgRk9S\nRUlHTiBLRVkgKCZsdDtjb2wgbGlzdCZndDspCiAgICAgKiBSRUZFUkVOQ0VT\nICZsdDtmb3JlaWduIHRhYmxlJmd0OyAoJmx0O2NvbCBsaXN0Jmd0OykKICAg\nICAqIFtPTiBERUxFVEUgJmx0O2FjdGlvbiZndDtdIFtPTiBVUERBVEUgJmx0\nO2FjdGlvbiZndDtdPC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBw\ncm90ZWN0ZWQgU3RyaW5nIGdldEZvcmVpZ25LZXlDb25zdHJhaW50U1FMKEZv\ncmVpZ25LZXkgZmspIHsKICAgICAgICBpZiAoIXN1cHBvcnRzRm9yZWlnbktl\neXMpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChmay5n\nZXREZWxldGVBY3Rpb24oKSA9PSBGb3JlaWduS2V5LkFDVElPTl9OT05FKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoZmsuaXNEZWZl\ncnJlZCgpICYmICFzdXBwb3J0c0RlZmVycmVkRm9yZWlnbktleUNvbnN0cmFp\nbnRzKCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmICgh\nc3VwcG9ydHNEZWxldGVBY3Rpb24oZmsuZ2V0RGVsZXRlQWN0aW9uKCkpCiAg\nICAgICAgICAgIHx8ICFzdXBwb3J0c1VwZGF0ZUFjdGlvbihmay5nZXRVcGRh\ndGVBY3Rpb24oKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBDb2x1bW5bXSBsb2NhbHMgPSBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAg\nQ29sdW1uW10gZm9yZWlnbnMgPSBmay5nZXRQcmltYXJ5S2V5Q29sdW1ucygp\nOwoKICAgICAgICBpbnQgZGVsQWN0aW9uSWQgPSBmay5nZXREZWxldGVBY3Rp\nb24oKTsKICAgICAgICBpZiAoZGVsQWN0aW9uSWQgPT0gRm9yZWlnbktleS5B\nQ1RJT05fTlVMTCkgewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGxvY2Fscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGxv\nY2Fsc1tpXS5pc05vdE51bGwoKSkKICAgICAgICAgICAgICAgICAgICBkZWxB\nY3Rpb25JZCA9IEZvcmVpZ25LZXkuQUNUSU9OX05PTkU7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIFN0cmluZyBkZWxBY3Rpb24gPSBnZXRB\nY3Rpb25OYW1lKGRlbEFjdGlvbklkKTsKICAgICAgICBTdHJpbmcgdXBBY3Rp\nb24gPSBnZXRBY3Rpb25OYW1lKGZrLmdldFVwZGF0ZUFjdGlvbigpKTsKCiAg\nICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsK\nICAgICAgICBpZiAoZmsuZ2V0TmFtZSgpICE9IG51bGwKICAgICAgICAgICAg\nJiYgQ09OU19OQU1FX0JFRk9SRS5lcXVhbHMoY29uc3RyYWludE5hbWVNb2Rl\nKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiQ09OU1RSQUlOVCAiKS5hcHBl\nbmQoZmsuZ2V0TmFtZSgpKS5hcHBlbmQoIiAiKTsKICAgICAgICBidWYuYXBw\nZW5kKCJGT1JFSUdOIEtFWSAiKTsKICAgICAgICBpZiAoZmsuZ2V0TmFtZSgp\nICE9IG51bGwgJiYgQ09OU19OQU1FX01JRC5lcXVhbHMoY29uc3RyYWludE5h\nbWVNb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVuZChmay5nZXROYW1lKCkp\nLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIigiKS5hcHBlbmQo\nU3RyaW5ncy5qb2luKGxvY2FscywgIiwgIikpLmFwcGVuZCgiKSIpOwogICAg\nICAgIGJ1Zi5hcHBlbmQoIiBSRUZFUkVOQ0VTICIpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoZ2V0RnVsbE5hbWUoZm9yZWlnbnNbMF0uZ2V0VGFibGUoKSwgZmFs\nc2UpKTsKICAgICAgICBidWYuYXBwZW5kKCIgKCIpLmFwcGVuZChTdHJpbmdz\nLmpvaW4oZm9yZWlnbnMsICIsICIpKS5hcHBlbmQoIikiKTsKICAgICAgICBp\nZiAoZGVsQWN0aW9uICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBPTiBERUxFVEUgIikuYXBwZW5kKGRlbEFjdGlvbik7CiAgICAgICAgaWYg\nKHVwQWN0aW9uICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBP\nTiBVUERBVEUgIikuYXBwZW5kKHVwQWN0aW9uKTsKICAgICAgICBpZiAoZmsu\naXNEZWZlcnJlZCgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgSU5JVElB\nTExZIERFRkVSUkVEIik7CiAgICAgICAgaWYgKHN1cHBvcnRzRGVmZXJyZWRG\nb3JlaWduS2V5Q29uc3RyYWludHMoKSkKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiIERFRkVSUkFCTEUiKTsKICAgICAgICBpZiAoZmsuZ2V0TmFtZSgpICE9\nIG51bGwKICAgICAgICAgICAgJiYgQ09OU19OQU1FX0FGVEVSLmVxdWFscyhj\nb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nQ09OU1RSQUlOVCAiKS5hcHBlbmQoZmsuZ2V0TmFtZSgpKTsKICAgICAgICBy\nZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIG9yIG5vdCB0aGlzIGRpY3Rpb25hcnkgc3VwcG9ydHMgZGVmZXJy\nZWQgZm9yZWlnbiBrZXkgY29uc3RyYWludHMuCiAgICAgKiBUaGlzIGltcGxl\nbWVudGF0aW9uIHJldHVybnMge0BsaW5rICNzdXBwb3J0c1VuaXF1ZUNvbnN0\ncmFpbnRzfS4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwog\nICAgcHJvdGVjdGVkIGJvb2xlYW4gc3VwcG9ydHNEZWZlcnJlZEZvcmVpZ25L\nZXlDb25zdHJhaW50cygpIHsKICAgICAgICByZXR1cm4gc3VwcG9ydHNEZWZl\ncnJlZENvbnN0cmFpbnRzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBuYW1lIG9mIHRoZSBnaXZlbiBmb3JlaWduIGtleSBhY3Rpb24uCiAg\nICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldEFjdGlvbk5hbWUoaW50IGFj\ndGlvbikgewogICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7CiAgICAgICAgICAg\nIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fQ0FTQ0FERToKICAgICAgICAgICAg\nICAgIHJldHVybiAiQ0FTQ0FERSI7CiAgICAgICAgICAgIGNhc2UgRm9yZWln\nbktleS5BQ1RJT05fTlVMTDoKICAgICAgICAgICAgICAgIHJldHVybiAiU0VU\nIE5VTEwiOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX0RF\nRkFVTFQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIlNFVCBERUZBVUxUIjsK\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\ndGhpcyBkYXRhYmFzZSBzdXBwb3J0cyB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkg\nZGVsZXRlIGFjdGlvbi4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNEZWxldGVBY3Rpb24oaW50IGFjdGlvbikgewogICAgICAgIGlmIChh\nY3Rpb24gPT0gRm9yZWlnbktleS5BQ1RJT05fTk9ORSkKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCFzdXBwb3J0c0ZvcmVpZ25LZXlz\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgc3dpdGNoIChh\nY3Rpb24pIHsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9S\nRVNUUklDVDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c1Jlc3Ry\naWN0RGVsZXRlQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXku\nQUNUSU9OX0NBU0NBREU6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9y\ndHNDYXNjYWRlRGVsZXRlQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZvcmVp\nZ25LZXkuQUNUSU9OX05VTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gc3Vw\ncG9ydHNOdWxsRGVsZXRlQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZvcmVp\nZ25LZXkuQUNUSU9OX0RFRkFVTFQ6CiAgICAgICAgICAgICAgICByZXR1cm4g\nc3VwcG9ydHNEZWZhdWx0RGVsZXRlQWN0aW9uOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyBkYXRhYmFzZSBz\ndXBwb3J0cyB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgdXBkYXRlIGFjdGlvbi4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNVcGRhdGVBY3Rp\nb24oaW50IGFjdGlvbikgewogICAgICAgIGlmIChhY3Rpb24gPT0gRm9yZWln\nbktleS5BQ1RJT05fTk9ORSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgaWYgKCFzdXBwb3J0c0ZvcmVpZ25LZXlzKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAg\nICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9SRVNUUklDVDoKICAgICAg\nICAgICAgICAgIHJldHVybiBzdXBwb3J0c1Jlc3RyaWN0VXBkYXRlQWN0aW9u\nOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX0NBU0NBREU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNDYXNjYWRlVXBkYXRl\nQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX05V\nTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNOdWxsVXBkYXRl\nQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX0RF\nRkFVTFQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNEZWZhdWx0\nVXBkYXRlQWN0aW9uOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgZGVjbGFyYXRpb24gU1FMIGZvciB0aGUgZ2l2\nZW4gdW5pcXVlIGNvbnN0cmFpbnQuIFRoaXMKICAgICAqIG1ldGhvZCBpcyB1\nc2VkIGZyb20gd2l0aGluIHtAbGluayAjZ2V0Q3JlYXRlVGFibGVTUUx9Lgog\nICAgICogUmV0dXJucwk8Y29kZT5DT05TVFJBSU5UICZsdDtuYW1lJmd0OyBV\nTklRVUUgKCZsdDtjb2wgbGlzdCZndDspPC9jb2RlPgogICAgICogYnkgZGVm\nYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRVbmlxdWVD\nb25zdHJhaW50U1FMKFVuaXF1ZSB1bnEpIHsKICAgICAgICBpZiAoIXN1cHBv\ncnRzVW5pcXVlQ29uc3RyYWludHMKICAgICAgICAgICAgfHwgKHVucS5pc0Rl\nZmVycmVkKCkgJiYgIXN1cHBvcnRzRGVmZXJyZWRVbmlxdWVDb25zdHJhaW50\ncygpKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgU3RyaW5n\nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBpZiAo\ndW5xLmdldE5hbWUoKSAhPSBudWxsCiAgICAgICAgICAgICYmIENPTlNfTkFN\nRV9CRUZPUkUuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIkNPTlNUUkFJTlQgIikuYXBwZW5kKGNoZWNrTmFt\nZUxlbmd0aCh1bnEuZ2V0TmFtZSgpLCAKICAgICAgICAgICAgCW1heENvbnN0\ncmFpbnROYW1lTGVuZ3RoLCAibG9uZy1jb25zdHJhaW50LW5hbWUiKSkuYXBw\nZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiVU5JUVVFICIpOwogICAg\nICAgIGlmICh1bnEuZ2V0TmFtZSgpICE9IG51bGwgJiYgQ09OU19OQU1FX01J\nRC5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVm\nLmFwcGVuZCh1bnEuZ2V0TmFtZSgpKS5hcHBlbmQoIiAiKTsKICAgICAgICBi\ndWYuYXBwZW5kKCIoIikuYXBwZW5kKFN0cmluZ3Muam9pbih1bnEuZ2V0Q29s\ndW1ucygpLCAiLCAiKSkuCiAgICAgICAgICAgIGFwcGVuZCgiKSIpOwogICAg\nICAgIGlmICh1bnEuaXNEZWZlcnJlZCgpKQogICAgICAgICAgICBidWYuYXBw\nZW5kKCIgSU5JVElBTExZIERFRkVSUkVEIik7CiAgICAgICAgaWYgKHN1cHBv\ncnRzRGVmZXJyZWRVbmlxdWVDb25zdHJhaW50cygpKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgREVGRVJSQUJMRSIpOwogICAgICAgIGlmICh1bnEuZ2V0\nTmFtZSgpICE9IG51bGwKICAgICAgICAgICAgJiYgQ09OU19OQU1FX0FGVEVS\nLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYu\nYXBwZW5kKCIgQ09OU1RSQUlOVCAiKS5hcHBlbmQodW5xLmdldE5hbWUoKSk7\nCiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciBvciBub3QgdGhpcyBkaWN0aW9uYXJ5IHN1cHBv\ncnRzIGRlZmVycmVkIHVuaXF1ZSBjb25zdHJhaW50cy4KICAgICAqIFRoaXMg\naW1wbGVtZW50YXRpb24gcmV0dXJucyB7QGxpbmsgI3N1cHBvcnRzVW5pcXVl\nQ29uc3RyYWludHN9LgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAg\nICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBzdXBwb3J0c0RlZmVycmVkVW5p\ncXVlQ29uc3RyYWludHMoKSB7CiAgICAgICAgcmV0dXJuIHN1cHBvcnRzRGVm\nZXJyZWRDb25zdHJhaW50czsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KICAgIC8vIERhdGFiYXNlIG1ldGFkYXRhCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHVz\nZWQgdG8gZmlsdGVyIHN5c3RlbSB0YWJsZXMgZnJvbSBkYXRhYmFzZSBtZXRh\nZGF0YS4KICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiB0YWJsZSBu\nYW1lIHJlcHJlc2VudHMgYSBzeXN0ZW0gdGFibGUgdGhhdAogICAgICogc2hv\ndWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNjaGVtYSBkZWZpbml0aW9uLiBCeSBk\nZWZhdWx0LCByZXR1cm5zCiAgICAgKiB0cnVlIG9ubHkgaWYgdGhlIGdpdmVu\nIHRhYmxlIGlzIGluIHRoZSBpbnRlcm5hbCBsaXN0IG9mIHN5c3RlbSB0YWJs\nZXMsCiAgICAgKiBvciBpZiB0aGUgZ2l2ZW4gc2NoZW1hIGlzIGluIHRoZSBs\naXN0IG9mIHN5c3RlbSBzY2hlbWFzIGFuZCBpcyBub3QKICAgICAqIHRoZSB0\nYXJnZXQgc2NoZW1hLgogICAgICoKICAgICAqIEBwYXJhbSBuYW1lIHRoZSB0\nYWJsZSBuYW1lCiAgICAgKiBAcGFyYW0gc2NoZW1hIHRoZSB0YWJsZSBzY2hl\nbWE7IG1heSBiZSBudWxsCiAgICAgKiBAcGFyYW0gdGFyZ2V0U2NoZW1hIGlm\nIHRydWUsIHRoZW4gdGhlIGdpdmVuIHNjaGVtYSB3YXMgbGlzdGVkIGJ5CiAg\nICAgKiB0aGUgdXNlciBhcyBvbmUgb2YgaGlzIHNjaGVtYXMKICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gaXNTeXN0ZW1UYWJsZShTdHJpbmcgbmFtZSwg\nU3RyaW5nIHNjaGVtYSwKICAgICAgICBib29sZWFuIHRhcmdldFNjaGVtYSkg\newogICAgICAgIGlmIChzeXN0ZW1UYWJsZVNldC5jb250YWlucyhuYW1lLnRv\nVXBwZXJDYXNlKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICByZXR1cm4gIXRhcmdldFNjaGVtYSAmJiBzY2hlbWEgIT0gbnVsbAogICAg\nICAgICAgICAmJiBzeXN0ZW1TY2hlbWFTZXQuY29udGFpbnMoc2NoZW1hLnRv\nVXBwZXJDYXNlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRo\nb2QgaXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVtIGluZGV4ZXMgZnJvbSBkYXRh\nYmFzZSBtZXRhZGF0YS4KICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZl\nbiBpbmRleCBuYW1lIHJlcHJlc2VudHMgYSBzeXN0ZW0gaW5kZXggdGhhdAog\nICAgICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNjaGVtYSBkZWZpbml0\naW9uLiBSZXR1cm5zIGZhbHNlIGJ5IGRlZmF1bHQuCiAgICAgKgogICAgICog\nQHBhcmFtIG5hbWUgdGhlIGluZGV4IG5hbWUKICAgICAqIEBwYXJhbSB0YWJs\nZSB0aGUgaW5kZXggdGFibGUKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\naXNTeXN0ZW1JbmRleChTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlz\nIG1ldGhvZCBpcyB1c2VkIHRvIGZpbHRlciBzeXN0ZW0gc2VxdWVuY2VzIGZy\nb20gZGF0YWJhc2UgbWV0YWRhdGEuCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0\naGUgZ2l2ZW4gc2VxdWVuY2UgcmVwcmVzZW50cyBhIHN5c3RlbSBzZXF1ZW5j\nZSB0aGF0CiAgICAgKiBzaG91bGQgbm90IGFwcGVhciBpbiB0aGUgc2NoZW1h\nIGRlZmluaXRpb24uIFJldHVybnMgdHJ1ZSBpZiBzeXN0ZW0KICAgICAqIHNj\naGVtYSBieSBkZWZhdWx0LgogICAgICoKICAgICAqIEBwYXJhbSBuYW1lIHRo\nZSB0YWJsZSBuYW1lCiAgICAgKiBAcGFyYW0gc2NoZW1hIHRoZSB0YWJsZSBz\nY2hlbWE7IG1heSBiZSBudWxsCiAgICAgKiBAcGFyYW0gdGFyZ2V0U2NoZW1h\nIGlmIHRydWUsIHRoZW4gdGhlIGdpdmVuIHNjaGVtYSB3YXMgbGlzdGVkIGJ5\nCiAgICAgKiB0aGUgdXNlciBhcyBvbmUgb2YgaGlzIHNjaGVtYXMKICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gaXNTeXN0ZW1TZXF1ZW5jZShTdHJpbmcg\nbmFtZSwgU3RyaW5nIHNjaGVtYSwKICAgICAgICBib29sZWFuIHRhcmdldFNj\naGVtYSkgewogICAgICAgIHJldHVybiAhdGFyZ2V0U2NoZW1hICYmIHNjaGVt\nYSAhPSBudWxsCiAgICAgICAgICAgICYmIHN5c3RlbVNjaGVtYVNldC5jb250\nYWlucyhzY2hlbWEudG9VcHBlckNhc2UoKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCB0YWJsZXMgbWF0\nY2hpbmcgdGhlIGdpdmVuIG5hbWUgcGF0dGVybi4KICAgICAqLwogICAgcHVi\nbGljIFRhYmxlW10gZ2V0VGFibGVzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwg\nU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0\ncmluZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIXN1cHBvcnRzU2NoZW1h\nRm9yR2V0VGFibGVzKQogICAgICAgICAgICBzY2hlbWFOYW1lID0gbnVsbDsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBnZXRTY2hl\nbWFOYW1lRm9yTWV0YWRhdGEoc2NoZW1hTmFtZSk7CgogICAgICAgIFN0cmlu\nZ1tdIHR5cGVzID0gU3RyaW5ncy5zcGxpdCh0YWJsZVR5cGVzLCAiLCIsIDAp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdHlwZXMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIHR5cGVzW2ldID0gdHlwZXNbaV0udHJpbSgpOwoK\nICAgICAgICBiZWZvcmVNZXRhZGF0YU9wZXJhdGlvbihjb25uKTsKICAgICAg\nICBSZXN1bHRTZXQgdGFibGVzID0gbnVsbDsKICAgICAgICB0cnkgewogICAg\nICAgICAgICB0YWJsZXMgPSBtZXRhLmdldFRhYmxlcyhnZXRDYXRhbG9nTmFt\nZUZvck1ldGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAgICAgICAgc2NoZW1h\nTmFtZSwgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVOYW1lKSwgdHlw\nZXMpOwogICAgICAgICAgICBMaXN0IHRhYmxlTGlzdCA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHRhYmxlcyAhPSBudWxsICYmIHRh\nYmxlcy5uZXh0KCkpCiAgICAgICAgICAgICAgICB0YWJsZUxpc3QuYWRkKG5l\nd1RhYmxlKHRhYmxlcykpOwogICAgICAgICAgICByZXR1cm4gKFRhYmxlW10p\nIHRhYmxlTGlzdC50b0FycmF5KG5ldyBUYWJsZVt0YWJsZUxpc3Quc2l6ZSgp\nXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHRhYmxl\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICB0YWJsZXMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHRhYmxlIGZy\nb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBzY2hlbWEgbWV0YWRhdGEuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBUYWJsZSBuZXdUYWJsZShSZXN1bHRTZXQg\ndGFibGVNZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIFRhYmxlIHQgPSBuZXcgVGFibGUoKTsKICAgICAgICB0LnNldE5hbWUo\ndGFibGVNZXRhLmdldFN0cmluZygiVEFCTEVfTkFNRSIpKTsKICAgICAgICBy\nZXR1cm4gdDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhl\nIHNjaGVtYSB0byBmaW5kIHNlcXVlbmNlcyBtYXRjaGluZyB0aGUgZ2l2ZW4g\nbmFtZSBwYXR0ZXJuLgogICAgICogUmV0dXJucyBhbiBlbXB0eSBhcnJheSBi\neSBkZWZhdWx0LCBhcyB0aGVyZSBpcyBubyBzdGFuZGFyZCB3YXkgdG8KICAg\nICAqIHJldHJpZXZlIGEgbGlzdCBvZiBzZXF1ZW5jZXMuCiAgICAgKi8KICAg\nIHB1YmxpYyBTZXF1ZW5jZVtdIGdldFNlcXVlbmNlcyhEYXRhYmFzZU1ldGFE\nYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hl\nbWFOYW1lLCBTdHJpbmcgc2VxdWVuY2VOYW1lLCBDb25uZWN0aW9uIGNvbm4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5n\nIHN0ciA9IGdldFNlcXVlbmNlc1NRTChzY2hlbWFOYW1lLCBzZXF1ZW5jZU5h\nbWUpOwogICAgICAgIGlmIChzdHIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBTZXF1ZW5jZVswXTsKCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQgPSBwcmVwYXJlU3RhdGVtZW50KGNvbm4sIHN0cik7ICAgICAg\nICAKICAgICAgICBSZXN1bHRTZXQgcnMgPSBudWxsOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGludCBpZHggPSAxOwogICAgICAgICAgICBpZiAoc2No\nZW1hTmFtZSAhPSBudWxsKQogICAgICAgICAgICAgICAgc3RtbnQuc2V0U3Ry\naW5nKGlkeCsrLCBzY2hlbWFOYW1lLnRvVXBwZXJDYXNlKCkpOwogICAgICAg\nICAgICBpZiAoc2VxdWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBzdG1udC5zZXRTdHJpbmcoaWR4KyssIHNlcXVlbmNlTmFtZSk7CgogICAg\nICAgICAgICBycyA9IGV4ZWN1dGVRdWVyeShjb25uLCBzdG1udCwgc3RyKTsK\nICAgICAgICAgICAgcmV0dXJuIGdldFNlcXVlbmNlKHJzKTsgICAgICAgICAg\nICAKICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIHJzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxF\neGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\naWYgKHN0bW50ICE9IG51bGwpICAgIAogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBzdG1udC5jbG9zZSgpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIGEgbmV3IHNlcXVlbmNlIGZyb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBz\nY2hlbWEgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTZXF1ZW5j\nZSBuZXdTZXF1ZW5jZShSZXN1bHRTZXQgc2VxdWVuY2VNZXRhKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNlcXVlbmNlIHNlcSA9\nIG5ldyBTZXF1ZW5jZSgpOwogICAgICAgIHNlcS5zZXRTY2hlbWFOYW1lKHNl\ncXVlbmNlTWV0YS5nZXRTdHJpbmcoIlNFUVVFTkNFX1NDSEVNQSIpKTsKICAg\nICAgICBzZXEuc2V0TmFtZShzZXF1ZW5jZU1ldGEuZ2V0U3RyaW5nKCJTRVFV\nRU5DRV9OQU1FIikpOwogICAgICAgIHJldHVybiBzZXE7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBuZWVkZWQgdG8gc2VsZWN0IHRo\nZSBsaXN0IG9mIHNlcXVlbmNlcy4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0\ncmluZyBnZXRTZXF1ZW5jZXNTUUwoU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmlu\nZyBzZXF1ZW5jZU5hbWUpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5k\nIGNvbHVtbnMgbWF0Y2hpbmcgdGhlIGdpdmVuIHRhYmxlIGFuZAogICAgICog\nY29sdW1uIHBhdHRlcm5zLgogICAgICovCiAgICBwdWJsaWMgQ29sdW1uW10g\nZ2V0Q29sdW1ucyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRh\nbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVO\nYW1lLCBTdHJpbmcgY29sdW1uTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh0YWJsZU5h\nbWUgPT0gbnVsbCAmJiAhc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRDb2x1bW5z\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKCFzdXBw\nb3J0c1NjaGVtYUZvckdldENvbHVtbnMpCiAgICAgICAgICAgIHNjaGVtYU5h\nbWUgPSBudWxsOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2NoZW1hTmFt\nZSA9IGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0YShzY2hlbWFOYW1lKTsKCiAg\nICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAgICAgICAg\nUmVzdWx0U2V0IGNvbHMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGNvbHMgPSBtZXRhLmdldENvbHVtbnMoZ2V0Q2F0YWxvZ05hbWVGb3JN\nZXRhZGF0YShjYXRhbG9nKSwKICAgICAgICAgICAgICAgIHNjaGVtYU5hbWUs\nIGdldFRhYmxlTmFtZUZvck1ldGFkYXRhKHRhYmxlTmFtZSksCiAgICAgICAg\nICAgICAgICBnZXRDb2x1bW5OYW1lRm9yTWV0YWRhdGEoY29sdW1uTmFtZSkp\nOwoKICAgICAgICAgICAgTGlzdCBjb2x1bW5MaXN0ID0gbmV3IEFycmF5TGlz\ndCgpOwogICAgICAgICAgICB3aGlsZSAoY29scyAhPSBudWxsICYmIGNvbHMu\nbmV4dCgpKQogICAgICAgICAgICAgICAgY29sdW1uTGlzdC5hZGQobmV3Q29s\ndW1uKGNvbHMpKTsKICAgICAgICAgICAgcmV0dXJuIChDb2x1bW5bXSkgY29s\ndW1uTGlzdC50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IENvbHVtbltj\nb2x1bW5MaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGlmIChjb2xzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIGNvbHMuY2xvc2UoKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEg\nbmV3IGNvbHVtbiBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1h\nIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29sdW1uIG5ld0Nv\nbHVtbihSZXN1bHRTZXQgY29sTWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBDb2x1bW4gYyA9IG5ldyBDb2x1bW4oKTsKICAg\nICAgICBjLnNldFNjaGVtYU5hbWUoY29sTWV0YS5nZXRTdHJpbmcoIlRBQkxF\nX1NDSEVNIikpOwogICAgICAgIGMuc2V0VGFibGVOYW1lKGNvbE1ldGEuZ2V0\nU3RyaW5nKCJUQUJMRV9OQU1FIikpOwogICAgICAgIGMuc2V0TmFtZShjb2xN\nZXRhLmdldFN0cmluZygiQ09MVU1OX05BTUUiKSk7CiAgICAgICAgYy5zZXRU\neXBlKGNvbE1ldGEuZ2V0SW50KCJEQVRBX1RZUEUiKSk7CiAgICAgICAgYy5z\nZXRUeXBlTmFtZShjb2xNZXRhLmdldFN0cmluZygiVFlQRV9OQU1FIikpOwog\nICAgICAgIGMuc2V0U2l6ZShjb2xNZXRhLmdldEludCgiQ09MVU1OX1NJWkUi\nKSk7CiAgICAgICAgYy5zZXREZWNpbWFsRGlnaXRzKGNvbE1ldGEuZ2V0SW50\nKCJERUNJTUFMX0RJR0lUUyIpKTsKICAgICAgICBjLnNldE5vdE51bGwoY29s\nTWV0YS5nZXRJbnQoIk5VTExBQkxFIikKICAgICAgICAgICAgPT0gRGF0YWJh\nc2VNZXRhRGF0YS5jb2x1bW5Ob051bGxzKTsKCiAgICAgICAgU3RyaW5nIGRl\nZiA9IGNvbE1ldGEuZ2V0U3RyaW5nKCJDT0xVTU5fREVGIik7CiAgICAgICAg\naWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGRlZikgJiYgISJudWxsIi5lcXVh\nbHNJZ25vcmVDYXNlKGRlZikpCiAgICAgICAgICAgIGMuc2V0RGVmYXVsdFN0\ncmluZyhkZWYpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgcHJpbWFyeSBr\nZXlzIGZvciB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqLwogICAg\ncHVibGljIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5cyhEYXRhYmFzZU1l\ndGFEYXRhIG1ldGEsCiAgICAgICAgU3RyaW5nIGNhdGFsb2csIFN0cmluZyBz\nY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHVz\nZUdldEJlc3RSb3dJZGVudGlmaWVyRm9yUHJpbWFyeUtleXMpCiAgICAgICAg\nICAgIHJldHVybiBnZXRQcmltYXJ5S2V5c0Zyb21CZXN0Um93SWRlbnRpZmll\ncihtZXRhLCBjYXRhbG9nLAogICAgICAgICAgICAgICAgc2NoZW1hTmFtZSwg\ndGFibGVOYW1lLCBjb25uKTsKICAgICAgICByZXR1cm4gZ2V0UHJpbWFyeUtl\neXNGcm9tR2V0UHJpbWFyeUtleXMobWV0YSwgY2F0YWxvZywKICAgICAgICAg\nICAgc2NoZW1hTmFtZSwgdGFibGVOYW1lLCBjb25uKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIHByaW1h\ncnkga2V5cyBmb3IgdGhlIGdpdmVuIHRhYmxlIHBhdHRlcm4uCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBQcmltYXJ5S2V5W10gZ2V0UHJpbWFyeUtleXNGcm9t\nR2V0UHJpbWFyeUtleXMKICAgICAgICAoRGF0YWJhc2VNZXRhRGF0YSBtZXRh\nLCBTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYU5hbWUsCiAgICAgICAg\nICAgIFN0cmluZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodGFibGVOYW1l\nID09IG51bGwgJiYgIXN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0UHJpbWFyeUtl\neXMpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWZvcmVN\nZXRhZGF0YU9wZXJhdGlvbihjb25uKTsKICAgICAgICBSZXN1bHRTZXQgcGtz\nID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBwa3MgPSBtZXRh\nLmdldFByaW1hcnlLZXlzKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoY2F0\nYWxvZyksCiAgICAgICAgICAgICAgICBnZXRTY2hlbWFOYW1lRm9yTWV0YWRh\ndGEoc2NoZW1hTmFtZSksCiAgICAgICAgICAgICAgICBnZXRUYWJsZU5hbWVG\nb3JNZXRhZGF0YSh0YWJsZU5hbWUpKTsKCiAgICAgICAgICAgIExpc3QgcGtM\naXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICB3aGlsZSAocGtz\nICE9IG51bGwgJiYgcGtzLm5leHQoKSkKICAgICAgICAgICAgICAgIHBrTGlz\ndC5hZGQobmV3UHJpbWFyeUtleShwa3MpKTsKICAgICAgICAgICAgcmV0dXJu\nIChQcmltYXJ5S2V5W10pIHBrTGlzdC50b0FycmF5CiAgICAgICAgICAgICAg\nICAobmV3IFByaW1hcnlLZXlbcGtMaXN0LnNpemUoKV0pOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGlmIChwa3MgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcGtzLmNsb3Nl\nKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIENyZWF0ZSBhIG5ldyBwcmltYXJ5IGtleSBmcm9tIHRoZSBpbmZvcm1h\ndGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90\nZWN0ZWQgUHJpbWFyeUtleSBuZXdQcmltYXJ5S2V5KFJlc3VsdFNldCBwa01l\ndGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgUHJp\nbWFyeUtleSBwayA9IG5ldyBQcmltYXJ5S2V5KCk7CiAgICAgICAgcGsuc2V0\nU2NoZW1hTmFtZShwa01ldGEuZ2V0U3RyaW5nKCJUQUJMRV9TQ0hFTSIpKTsK\nICAgICAgICBway5zZXRUYWJsZU5hbWUocGtNZXRhLmdldFN0cmluZygiVEFC\nTEVfTkFNRSIpKTsKICAgICAgICBway5zZXRDb2x1bW5OYW1lKHBrTWV0YS5n\nZXRTdHJpbmcoIkNPTFVNTl9OQU1FIikpOwogICAgICAgIHBrLnNldE5hbWUo\ncGtNZXRhLmdldFN0cmluZygiUEtfTkFNRSIpKTsKICAgICAgICByZXR1cm4g\ncGs7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hl\nbWEgdG8gZmluZCBwcmltYXJ5IGtleXMgZm9yIHRoZSBnaXZlbiB0YWJsZSBw\nYXR0ZXJuLgogICAgICovCiAgICBwcm90ZWN0ZWQgUHJpbWFyeUtleVtdIGdl\ndFByaW1hcnlLZXlzRnJvbUJlc3RSb3dJZGVudGlmaWVyCiAgICAgICAgKERh\ndGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csIFN0cmluZyBz\nY2hlbWFOYW1lLAogICAgICAgICAgICBTdHJpbmcgdGFibGVOYW1lLCBDb25u\nZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29u\nbik7CiAgICAgICAgUmVzdWx0U2V0IHBrcyA9IG51bGw7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcGtzID0gbWV0YS5nZXRCZXN0Um93SWRlbnRpZmll\ncihjYXRhbG9nLCBzY2hlbWFOYW1lLAogICAgICAgICAgICAgICAgdGFibGVO\nYW1lLCAwLCBmYWxzZSk7CgogICAgICAgICAgICBMaXN0IHBrTGlzdCA9IG5l\ndyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHBrcyAhPSBudWxs\nICYmIHBrcy5uZXh0KCkpIHsKICAgICAgICAgICAgICAgIFByaW1hcnlLZXkg\ncGsgPSBuZXcgUHJpbWFyeUtleSgpOwogICAgICAgICAgICAgICAgcGsuc2V0\nU2NoZW1hTmFtZShzY2hlbWFOYW1lKTsKICAgICAgICAgICAgICAgIHBrLnNl\ndFRhYmxlTmFtZSh0YWJsZU5hbWUpOwogICAgICAgICAgICAgICAgcGsuc2V0\nQ29sdW1uTmFtZShwa3MuZ2V0U3RyaW5nKCJDT0xVTU5fTkFNRSIpKTsKICAg\nICAgICAgICAgICAgIHBrTGlzdC5hZGQocGspOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybiAoUHJpbWFyeUtleVtdKSBwa0xpc3QudG9BcnJh\neQogICAgICAgICAgICAgICAgKG5ldyBQcmltYXJ5S2V5W3BrTGlzdC5zaXpl\nKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocGtz\nICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIHBrcy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8g\nZmluZCBpbmRleGVzIG1hdGNoaW5nIHRoZSBnaXZlbiB0YWJsZSBwYXR0ZXJu\nLgogICAgICovCiAgICBwdWJsaWMgSW5kZXhbXSBnZXRJbmRleEluZm8oRGF0\nYWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBT\ndHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgYm9vbGVhbiB1\nbmlxdWUsCiAgICAgICAgYm9vbGVhbiBhcHByb3gsIENvbm5lY3Rpb24gY29u\nbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\ndGFibGVOYW1lID09IG51bGwgJiYgIXN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0\nSW5kZXhJbmZvKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAgICAgICAgUmVzdWx0\nU2V0IGluZGV4ZXMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGluZGV4ZXMgPSBtZXRhLmdldEluZGV4SW5mbyhnZXRDYXRhbG9nTmFtZUZv\nck1ldGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAgICAgICAgZ2V0U2NoZW1h\nTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpLAogICAgICAgICAgICAgICAg\nZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVOYW1lKSwgdW5pcXVlLCBh\ncHByb3gpOwoKICAgICAgICAgICAgTGlzdCBpbmRleExpc3QgPSBuZXcgQXJy\nYXlMaXN0KCk7CiAgICAgICAgICAgIHdoaWxlIChpbmRleGVzICE9IG51bGwg\nJiYgaW5kZXhlcy5uZXh0KCkpCiAgICAgICAgICAgICAgICBpbmRleExpc3Qu\nYWRkKG5ld0luZGV4KGluZGV4ZXMpKTsKICAgICAgICAgICAgcmV0dXJuIChJ\nbmRleFtdKSBpbmRleExpc3QudG9BcnJheShuZXcgSW5kZXhbaW5kZXhMaXN0\nLnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlm\nIChpbmRleGVzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIGluZGV4ZXMuY2xvc2UoKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3\nIGluZGV4IGZyb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBzY2hlbWEgbWV0\nYWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBJbmRleCBuZXdJbmRleChS\nZXN1bHRTZXQgaWR4TWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBJbmRleCBpZHggPSBuZXcgSW5kZXgoKTsKICAgICAgICBp\nZHguc2V0U2NoZW1hTmFtZShpZHhNZXRhLmdldFN0cmluZygiVEFCTEVfU0NI\nRU0iKSk7CiAgICAgICAgaWR4LnNldFRhYmxlTmFtZShpZHhNZXRhLmdldFN0\ncmluZygiVEFCTEVfTkFNRSIpKTsKICAgICAgICBpZHguc2V0Q29sdW1uTmFt\nZShpZHhNZXRhLmdldFN0cmluZygiQ09MVU1OX05BTUUiKSk7CiAgICAgICAg\naWR4LnNldE5hbWUoaWR4TWV0YS5nZXRTdHJpbmcoIklOREVYX05BTUUiKSk7\nCiAgICAgICAgaWR4LnNldFVuaXF1ZSghaWR4TWV0YS5nZXRCb29sZWFuKCJO\nT05fVU5JUVVFIikpOwogICAgICAgIHJldHVybiBpZHg7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gcmV0dXJuIGZv\ncmVpZ24ga2V5cyBpbXBvcnRlZCBieSB0aGUgZ2l2ZW4KICAgICAqIHRhYmxl\nIHBhdHRlcm4uCiAgICAgKi8KICAgIHB1YmxpYyBGb3JlaWduS2V5W10gZ2V0\nSW1wb3J0ZWRLZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNh\ndGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJs\nZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoIXN1cHBvcnRzRm9yZWlnbktleXMpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmICh0YWJsZU5hbWUg\nPT0gbnVsbCAmJiAhc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRJbXBvcnRlZEtl\neXMpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWZvcmVN\nZXRhZGF0YU9wZXJhdGlvbihjb25uKTsKICAgICAgICBSZXN1bHRTZXQga2V5\ncyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAga2V5cyA9IG1l\ndGEuZ2V0SW1wb3J0ZWRLZXlzKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEo\nY2F0YWxvZyksCiAgICAgICAgICAgICAgICBnZXRTY2hlbWFOYW1lRm9yTWV0\nYWRhdGEoc2NoZW1hTmFtZSksCiAgICAgICAgICAgICAgICBnZXRUYWJsZU5h\nbWVGb3JNZXRhZGF0YSh0YWJsZU5hbWUpKTsKCiAgICAgICAgICAgIExpc3Qg\naW1wb3J0ZWRLZXlMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAg\nICB3aGlsZSAoa2V5cyAhPSBudWxsICYmIGtleXMubmV4dCgpKQogICAgICAg\nICAgICAgICAgaW1wb3J0ZWRLZXlMaXN0LmFkZChuZXdGb3JlaWduS2V5KGtl\neXMpKTsKICAgICAgICAgICAgcmV0dXJuIChGb3JlaWduS2V5W10pIGltcG9y\ndGVkS2V5TGlzdC50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IEZvcmVp\nZ25LZXlbaW1wb3J0ZWRLZXlMaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGlmIChrZXlzICE9IG51bGwpCiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGtleXMuY2xvc2Uo\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgbmV3IGZvcmVpZ24ga2V5IGZyb20gdGhlIGluZm9ybWF0\naW9uIGluIHRoZSBzY2hlbWEgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBGb3JlaWduS2V5IG5ld0ZvcmVpZ25LZXkoUmVzdWx0U2V0IGZrTWV0\nYSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBGb3Jl\naWduS2V5IGZrID0gbmV3IEZvcmVpZ25LZXkoKTsKICAgICAgICBmay5zZXRT\nY2hlbWFOYW1lKGZrTWV0YS5nZXRTdHJpbmcoIkZLVEFCTEVfU0NIRU0iKSk7\nCiAgICAgICAgZmsuc2V0VGFibGVOYW1lKGZrTWV0YS5nZXRTdHJpbmcoIkZL\nVEFCTEVfTkFNRSIpKTsKICAgICAgICBmay5zZXRDb2x1bW5OYW1lKGZrTWV0\nYS5nZXRTdHJpbmcoIkZLQ09MVU1OX05BTUUiKSk7CiAgICAgICAgZmsuc2V0\nTmFtZShma01ldGEuZ2V0U3RyaW5nKCJGS19OQU1FIikpOwogICAgICAgIGZr\nLnNldFByaW1hcnlLZXlTY2hlbWFOYW1lKGZrTWV0YS5nZXRTdHJpbmcoIlBL\nVEFCTEVfU0NIRU0iKSk7CiAgICAgICAgZmsuc2V0UHJpbWFyeUtleVRhYmxl\nTmFtZShma01ldGEuZ2V0U3RyaW5nKCJQS1RBQkxFX05BTUUiKSk7CiAgICAg\nICAgZmsuc2V0UHJpbWFyeUtleUNvbHVtbk5hbWUoZmtNZXRhLmdldFN0cmlu\nZygiUEtDT0xVTU5fTkFNRSIpKTsKICAgICAgICBmay5zZXRLZXlTZXF1ZW5j\nZShma01ldGEuZ2V0U2hvcnQoIktFWV9TRVEiKSk7CiAgICAgICAgZmsuc2V0\nRGVmZXJyZWQoZmtNZXRhLmdldFNob3J0KCJERUZFUlJBQklMSVRZIikKICAg\nICAgICAgICAgPT0gRGF0YWJhc2VNZXRhRGF0YS5pbXBvcnRlZEtleUluaXRp\nYWxseURlZmVycmVkKTsKCiAgICAgICAgaW50IGRlbCA9IGZrTWV0YS5nZXRT\naG9ydCgiREVMRVRFX1JVTEUiKTsKICAgICAgICBzd2l0Y2ggKGRlbCkgewog\nICAgICAgICAgICBjYXNlIERhdGFiYXNlTWV0YURhdGEuaW1wb3J0ZWRLZXlT\nZXROdWxsOgogICAgICAgICAgICAgICAgZmsuc2V0RGVsZXRlQWN0aW9uKEZv\ncmVpZ25LZXkuQUNUSU9OX05VTEwpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgRGF0YWJhc2VNZXRhRGF0YS5pbXBvcnRlZEtl\neVNldERlZmF1bHQ6CiAgICAgICAgICAgICAgICBmay5zZXREZWxldGVBY3Rp\nb24oRm9yZWlnbktleS5BQ1RJT05fREVGQVVMVCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBEYXRhYmFzZU1ldGFEYXRhLmlt\ncG9ydGVkS2V5Q2FzY2FkZToKICAgICAgICAgICAgICAgIGZrLnNldERlbGV0\nZUFjdGlvbihGb3JlaWduS2V5LkFDVElPTl9DQVNDQURFKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgZmsuc2V0RGVsZXRlQWN0aW9uKEZvcmVpZ25LZXkuQUNUSU9OX1JF\nU1RSSUNUKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gZms7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5z\nIHRoZSB0YWJsZSBuYW1lIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBvYnRhaW5p\nbmcgaW5mb3JtYXRpb24KICAgICAqIGZyb20ge0BsaW5rIERhdGFiYXNlTWV0\nYURhdGF9LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFRhYmxl\nTmFtZUZvck1ldGFkYXRhKFN0cmluZyB0YWJsZU5hbWUpIHsKICAgICAgICBy\nZXR1cm4gY29udmVydFNjaGVtYUNhc2UodGFibGVOYW1lKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIHNjaGVtYSBuYW1lIHRoYXQgd2ls\nbCBiZSB1c2VkIGZvciBvYnRhaW5pbmcgaW5mb3JtYXRpb24KICAgICAqIGZy\nb20ge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9LgogICAgICovCiAgICBwcm90\nZWN0ZWQgU3RyaW5nIGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0YShTdHJpbmcg\nc2NoZW1hTmFtZSkgewogICAgICAgIGlmIChzY2hlbWFOYW1lID09IG51bGwp\nCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBjb25mLmdldFNjaGVtYSgpOwog\nICAgICAgIHJldHVybiBjb252ZXJ0U2NoZW1hQ2FzZShzY2hlbWFOYW1lKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGNhdGFsb2cgbmFt\nZSB0aGF0IHdpbGwgYmUgdXNlZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9u\nCiAgICAgKiBmcm9tIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRDYXRhbG9nTmFtZUZvck1ldGFk\nYXRhKFN0cmluZyBjYXRhbG9nTmFtZSkgewogICAgICAgIHJldHVybiBjb252\nZXJ0U2NoZW1hQ2FzZShjYXRhbG9nTmFtZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIHRoZSBjb2x1bW4gbmFtZSB0aGF0IHdpbGwgYmUgdXNl\nZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBmcm9tIHtAbGlu\nayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0\ncmluZyBnZXRDb2x1bW5OYW1lRm9yTWV0YWRhdGEoU3RyaW5nIGNvbHVtbk5h\nbWUpIHsKICAgICAgICByZXR1cm4gY29udmVydFNjaGVtYUNhc2UoY29sdW1u\nTmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVj\naWZpZWQgc2NoZW1hIG5hbWUgdG8gYSBuYW1lIHRoYXQgdGhlIGRhdGFiYXNl\nIHdpbGwKICAgICAqIGJlIGFibGUgdG8gdW5kZXJzdGFuZC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFN0cmluZyBjb252ZXJ0U2NoZW1hQ2FzZShTdHJpbmcg\nb2JqZWN0TmFtZSkgewogICAgICAgIGlmIChvYmplY3ROYW1lID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJpbmcgc2Nh\nc2UgPSBnZXRTY2hlbWFDYXNlKCk7CiAgICAgICAgaWYgKFNDSEVNQV9DQVNF\nX0xPV0VSLmVxdWFscyhzY2FzZSkpCiAgICAgICAgICAgIHJldHVybiBvYmpl\nY3ROYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgaWYgKFNDSEVNQV9DQVNF\nX1BSRVNFUlZFLmVxdWFscyhzY2FzZSkpCiAgICAgICAgICAgIHJldHVybiBv\nYmplY3ROYW1lOwogICAgICAgIHJldHVybiBvYmplY3ROYW1lLnRvVXBwZXJD\nYXNlKCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIERCIHNw\nZWNpZmljIHNjaGVtYUNhc2UgCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0U2NoZW1hQ2FzZSgpewogICAgICAgIHJldHVybiBzY2hlbWFDYXNlOwog\nICAgfQogICAgICAgIAogICAgLyoqCiAgICAgKiBQcmVwYXJlZCB0aGUgY29u\nbmVjdGlvbiBmb3IgbWV0YWRhdGEgb3BlcmF0aW9ucy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGJlZm9yZU1ldGFkYXRhT3BlcmF0aW9uKENvbm5lY3Rp\nb24gYykgewogICAgICAgIGlmIChyZXF1aXJlc0F1dG9Db21taXRGb3JNZXRh\nRGF0YSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYy5y\nb2xsYmFjaygpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc3FsZSkgewogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBpZiAoIWMuZ2V0QXV0b0NvbW1pdCgpKQogICAgICAgICAg\nICAgICAgICAgIGMuc2V0QXV0b0NvbW1pdCh0cnVlKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNxbGUpIHsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gU2VxdWVuY2VzIGFuZCBBdXRvLUFzc2lnbgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgbGFzdCBnZW5lcmF0ZWQgdmFsdWUgZm9yIHRoZSBnaXZlbiBj\nb2x1bW4uCiAgICAgKiBUaHJvd3MgYW4gZXhjZXB0aW9uIGJ5IGRlZmF1bHQg\naWYge0BsaW5rICNsYXN0R2VuZXJhdGVkS2V5UXVlcnl9IGlzIG51bGwuCiAg\nICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0R2VuZXJhdGVkS2V5KENvbHVt\nbiBjb2wsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAobGFzdEdlbmVyYXRlZEtleVF1ZXJ5ID09\nIG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tYXV0by1hc3NpZ24iKSk7CgogICAgICAgIC8vIHJlcGxh\nY2UgdGhpbmdzIGxpa2UgIlNFTEVDVCBNQVgoezB9KSBGUk9NIHsxfSIKICAg\nICAgICBTdHJpbmcgcXVlcnkgPSBsYXN0R2VuZXJhdGVkS2V5UXVlcnk7CiAg\nICAgICAgaWYgKHF1ZXJ5LmluZGV4T2YoJ3snKSAhPSAtMSkgLy8gb25seSBp\nZiB0aGUgdG9rZW4gaXMgaW4gdGhlIHN0cmluZwogICAgICAgIHsKICAgICAg\nICAgICAgcXVlcnkgPSBNZXNzYWdlRm9ybWF0LmZvcm1hdChxdWVyeSwgbmV3\nIE9iamVjdFtdewogICAgICAgICAgICAgICAgY29sLmdldE5hbWUoKSwgZ2V0\nRnVsbE5hbWUoY29sLmdldFRhYmxlKCksIGZhbHNlKSwKICAgICAgICAgICAg\nICAgIGdldEdlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2wpLAogICAgICAg\nICAgICB9KTsKICAgICAgICB9CgogICAgICAgIFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChjb25uLCBxdWVyeSk7CiAgICAg\nICAgUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBycyA9IGV4ZWN1dGVRdWVyeShjb25uLCBzdG1udCwgcXVlcnkpOwog\nICAgICAgICAgICByZXR1cm4gZ2V0S2V5KHJzLCBjb2wpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdHJ5IHsgcnMuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIHNlKSB7fQogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkgICAg\nCiAgICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHt9IAogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgc2VxdWVuY2UgbmFtZSB1c2VkIGJ5IGRh\ndGFiYXNlcyBmb3IgdGhlIGdpdmVuIGF1dG9hc3NpZ25lZAogICAgICogY29s\ndW1uLiBUaGlzIGlzIG9ubHkgdXNlZCBieSBkYXRhYmFzZXMgdGhhdCByZXF1\naXJlIGFuIGV4cGxpY2l0IG5hbWUKICAgICAqIHRvIGJlIHVzZWQgZm9yIGF1\ndG8tYXNzaWduIHN1cHBvcnQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJp\nbmcgZ2V0R2VuZXJhdGVkS2V5U2VxdWVuY2VOYW1lKENvbHVtbiBjb2wpIHsK\nICAgICAgICBTdHJpbmcgdG5hbWUgPSBjb2wuZ2V0VGFibGVOYW1lKCk7CiAg\nICAgICAgU3RyaW5nIGNuYW1lID0gY29sLmdldE5hbWUoKTsKICAgICAgICBp\nbnQgbWF4ID0gbWF4QXV0b0Fzc2lnbk5hbWVMZW5ndGg7CiAgICAgICAgaW50\nIGV4dHJhQ2hhcnMgPSAtbWF4ICsgdG5hbWUubGVuZ3RoKCkgKyAxIC8vIDx0\nbmFtZT4gKyAnXycKICAgICAgICAgICAgKyBjbmFtZS5sZW5ndGgoKSArIDQ7\nIC8vIDxjbmFtZT4gKyAnX1NFUScKICAgICAgICBpZiAoZXh0cmFDaGFycyA+\nIDApIHsKICAgICAgICAgICAgLy8gdGhpcyBhc3N1bWVzIHRoYXQgdG5hbWUg\naXMgbG9uZ2VyIHRoYW4gZXh0cmFDaGFycwogICAgICAgICAgICB0bmFtZSA9\nIHRuYW1lLnN1YnN0cmluZygwLCB0bmFtZS5sZW5ndGgoKSAtIGV4dHJhQ2hh\ncnMpOwogICAgICAgIH0KICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3\nIFN0cmluZ0J1ZmZlcihtYXgpOwogICAgICAgIGJ1Zi5hcHBlbmQodG5hbWUp\nLmFwcGVuZCgiXyIpLmFwcGVuZChjbmFtZSkuYXBwZW5kKCJfU0VRIik7CiAg\nICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbmZpZ3VyYWJs\nZSBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHNldENvbmZpZ3VyYXRpb24oQ29u\nZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAgdGhpcy5jb25mID0gKEpEQkND\nb25maWd1cmF0aW9uKSBjb25mOwogICAgICAgIHRoaXMubG9nID0gdGhpcy5j\nb25mLmdldExvZyhKREJDQ29uZmlndXJhdGlvbi5MT0dfSkRCQyk7CgogICAg\nICAgIC8vIHdhcm4gYWJvdXQgdW5zdXBwb3J0ZWQgZGljdHMKICAgICAgICBp\nZiAobG9nLmlzV2FybkVuYWJsZWQoKSAmJiAhaXNTdXBwb3J0ZWQoKSkKICAg\nICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImRpY3Qtbm90LXN1cHBvcnRl\nZCIsIGdldENsYXNzKCkpKTsKICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4g\naXNTdXBwb3J0ZWQoKSB7CiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGN1c3Rv\nbSBkaWN0LCB0cmF2ZXJzZSB0byB3aGF0ZXZlciBvcGVuanBhIGRpY3QgaXQg\nZXh0ZW5kcwogICAgICAgIENsYXNzIGMgPSBnZXRDbGFzcygpOwogICAgICAg\nIHdoaWxlICghYy5nZXROYW1lKCkuc3RhcnRzV2l0aCgib3JnLmFwYWNoZS5v\ncGVuanBhLiIpKQogICAgICAgICAgICBjID0gYy5nZXRTdXBlcmNsYXNzKCk7\nCgogICAgICAgIC8vIHRoZSBnZW5lcmljIGRiZGljdGlvbmFyeSBpcyBub3Qg\nY29uc2lkZXJlZCBhIHN1cHBvcnRlZCBkaWN0OyBhbGwKICAgICAgICAvLyBv\ndGhlciBjb25jcmV0ZSBkaWN0aW9uYXJpZXMgYXJlCiAgICAgICAgaWYgKGMg\nPT0gREJEaWN0aW9uYXJ5LmNsYXNzKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc3RhcnRDb25maWd1cmF0aW9uKCkgewogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGVuZENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgLy8gaW5pdGlhbGl6\nZSB0aGUgc2V0IG9mIHJlc2VydmVkIFNRTDkyIHdvcmRzIGZyb20gcmVzb3Vy\nY2UKICAgICAgICBJbnB1dFN0cmVhbSBpbiA9IERCRGljdGlvbmFyeS5jbGFz\ncy5nZXRSZXNvdXJjZUFzU3RyZWFtCiAgICAgICAgICAgICgic3FsLWtleXdv\ncmRzLnJzcmMiKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdHJpbmcg\na2V5d29yZHMgPSBuZXcgQnVmZmVyZWRSZWFkZXIobmV3IElucHV0U3RyZWFt\nUmVhZGVyKGluKSkuCiAgICAgICAgICAgICAgICByZWFkTGluZSgpOwogICAg\nICAgICAgICBpbi5jbG9zZSgpOwogICAgICAgICAgICByZXNlcnZlZFdvcmRT\nZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5ncy5zcGxpdAogICAgICAg\nICAgICAgICAgKGtleXdvcmRzLCAiLCIsIDApKSk7CiAgICAgICAgfSBjYXRj\naCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBH\nZW5lcmFsRXhjZXB0aW9uKGlvZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdHJ5IHsgaW4uY2xvc2UoKTsgfSBjYXRjaCAoSU9FeGNlcHRp\nb24gZSkge30KICAgICAgICB9CgogICAgICAgIC8vIGFkZCBhZGRpdGlvbmFs\nIHJlc2VydmVkIHdvcmRzIHNldCBieSB1c2VyCiAgICAgICAgaWYgKHJlc2Vy\ndmVkV29yZHMgIT0gbnVsbCkKICAgICAgICAgICAgcmVzZXJ2ZWRXb3JkU2V0\nLmFkZEFsbChBcnJheXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQKICAgICAgICAg\nICAgICAgIChyZXNlcnZlZFdvcmRzLnRvVXBwZXJDYXNlKCksICIsIiwgMCkp\nKTsKCiAgICAgICAgLy8gYWRkIHN5c3RlbSBzY2hlbWFzIHNldCBieSB1c2Vy\nCiAgICAgICAgaWYgKHN5c3RlbVNjaGVtYXMgIT0gbnVsbCkKICAgICAgICAg\nICAgc3lzdGVtU2NoZW1hU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KFN0cmlu\nZ3Muc3BsaXQKICAgICAgICAgICAgICAgIChzeXN0ZW1TY2hlbWFzLnRvVXBw\nZXJDYXNlKCksICIsIiwgMCkpKTsKCiAgICAgICAgLy8gYWRkIHN5c3RlbSB0\nYWJsZXMgc2V0IGJ5IHVzZXIKICAgICAgICBpZiAoc3lzdGVtVGFibGVzICE9\nIG51bGwpCiAgICAgICAgICAgIHN5c3RlbVRhYmxlU2V0LmFkZEFsbChBcnJh\neXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQKICAgICAgICAgICAgICAgIChzeXN0\nZW1UYWJsZXMudG9VcHBlckNhc2UoKSwgIiwiLCAwKSkpOwoKICAgICAgICAv\nLyBhZGQgZml4ZWQgc2l6ZSB0eXBlIG5hbWVzIHNldCBieSB0aGUgdXNlcgog\nICAgICAgIGlmIChmaXhlZFNpemVUeXBlTmFtZXMgIT0gbnVsbCkKICAgICAg\nICAgICAgZml4ZWRTaXplVHlwZU5hbWVTZXQuYWRkQWxsKEFycmF5cy5hc0xp\nc3QoU3RyaW5ncy5zcGxpdAogICAgICAgICAgICAgICAgKGZpeGVkU2l6ZVR5\ncGVOYW1lcy50b1VwcGVyQ2FzZSgpLCAiLCIsIDApKSk7CiAgICAgICAgCiAg\nICAgICAgLy8gaWYgdXNlciBoYXMgdW5zZXQgc2VxdWVuY2Ugc3FsLCBudWxs\nIGl0IG91dCBzbyB3ZSBrbm93IHNlcXVlbmNlcwogICAgICAgIC8vIGFyZW4n\ndCBzdXBwb3J0ZWQKICAgICAgICBuZXh0U2VxdWVuY2VRdWVyeSA9IFN0cmlu\nZ1V0aWxzLnRyaW1Ub051bGwobmV4dFNlcXVlbmNlUXVlcnkpOwogICAgICAg\nIAogICAgICAgIGlmIChzZWxlY3RXb3JkcyAhPSBudWxsKQogICAgICAgICAg\nICBzZWxlY3RXb3JkU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KFN0cmluZ3Mu\nc3BsaXQoc2VsZWN0V29yZHMKICAgICAgICAgICAgICAgICAgICAudG9VcHBl\nckNhc2UoKSwgIiwiLCAwKSkpOwogICAgICAgIAogICAgICAgIC8vIGluaXRp\nYWxpemUgdGhlIGVycm9yIGNvZGVzCiAgICAgICAgU1FMRXJyb3JDb2RlUmVh\nZGVyIGNvZGVSZWFkZXIgPSBuZXcgU1FMRXJyb3JDb2RlUmVhZGVyKCk7CiAg\nICAgICAgU3RyaW5nIHJzcmMgPSAic3FsLWVycm9yLXN0YXRlLWNvZGVzLnht\nbCI7CiAgICAgICAgSW5wdXRTdHJlYW0gc3RyZWFtID0gZ2V0Q2xhc3MoKS5n\nZXRSZXNvdXJjZUFzU3RyZWFtKHJzcmMpOwogICAgICAgIFN0cmluZyBkaWN0\naW9uYXJ5Q2xhc3NOYW1lID0gZ2V0Q2xhc3MoKS5nZXROYW1lKCk7CiAgICAg\nICAgaWYgKHN0cmVhbSA9PSBudWxsKSB7IC8vIFVzZXIgc3VwcGxpZWQgZGlj\ndGlvbmFyeSBidXQgbm8gZXJyb3IgY29kZXMgeG1sCiAgICAgICAgCXN0cmVh\nbSA9IERCRGljdGlvbmFyeS5jbGFzcy5nZXRSZXNvdXJjZUFzU3RyZWFtKHJz\ncmMpOyAvLyB1c2UgZGVmYXVsdAogICAgICAgIAlkaWN0aW9uYXJ5Q2xhc3NO\nYW1lID0gZ2V0Q2xhc3MoKS5nZXRTdXBlcmNsYXNzKCkuZ2V0TmFtZSgpOwog\nICAgICAgIH0KICAgICAgICBjb2RlUmVhZGVyLnBhcnNlKHN0cmVhbSwgZGlj\ndGlvbmFyeUNsYXNzTmFtZSwgdGhpcyk7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyB2b2lkIGFkZEVycm9yQ29kZShpbnQgZXJyb3JUeXBlLCBTdHJpbmcgZXJy\nb3JDb2RlKSB7CiAgICAJaWYgKGVycm9yQ29kZSA9PSBudWxsIHx8IGVycm9y\nQ29kZS50cmltKCkubGVuZ3RoKCkgPT0gMCkKICAgIAkJcmV0dXJuOwoJCVNl\ndDxTdHJpbmc+IGNvZGVzID0gc3FsU3RhdGVDb2Rlcy5nZXQoZXJyb3JUeXBl\nKTsKICAgIAlpZiAoY29kZXMgPT0gbnVsbCkgewogICAgCQljb2RlcyA9IG5l\ndyBIYXNoU2V0PFN0cmluZz4oKTsKICAgIAkJY29kZXMuYWRkKGVycm9yQ29k\nZS50cmltKCkpOwogICAgCQlzcWxTdGF0ZUNvZGVzLnB1dChlcnJvclR5cGUs\nIGNvZGVzKTsKICAgIAl9IGVsc2UgewogICAgCQljb2Rlcy5hZGQoZXJyb3JD\nb2RlLnRyaW0oKSk7CiAgICAJfQogICAgfQogICAgCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29ubmVjdGlv\nbkRlY29yYXRvciBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIERlY29y\nYXRlIHRoZSBnaXZlbiBjb25uZWN0aW9uIGlmIG5lZWRlZC4gU29tZSBkYXRh\nYmFzZXMgcmVxdWlyZSBzcGVjaWFsCiAgICAgKiBoYW5kbGluZyBmb3IgSkRC\nQyBidWdzLiBUaGlzIGltcGxlbWVudGF0aW9uIGlzc3VlcyBhbnkKICAgICAq\nIHtAbGluayAjaW5pdGlhbGl6YXRpb25TUUx9IHRoYXQgaGFzIGJlZW4gc2V0\nIGZvciB0aGUgZGljdGlvbmFyeSBidXQKICAgICAqIGRvZXMgbm90IGRlY29y\nYXRlIHRoZSBjb25uZWN0aW9uLgogICAgICovCiAgICBwdWJsaWMgQ29ubmVj\ndGlvbiBkZWNvcmF0ZShDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFjb25uZWN0ZWQpCiAgICAg\nICAgICAgIGNvbm5lY3RlZENvbmZpZ3VyYXRpb24oY29ubik7CiAgICAgICAg\naWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGluaXRpYWxpemF0aW9uU1FMKSkg\newogICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IG51bGw7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzdG1udCA9IGNv\nbm4ucHJlcGFyZVN0YXRlbWVudChpbml0aWFsaXphdGlvblNRTCk7CiAgICAg\nICAgICAgICAgICBzdG1udC5leGVjdXRlKCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNl\nKGUudG9TdHJpbmcoKSwgZSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBzdG1udC5j\nbG9zZSgpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY29ubjsKICAgIH0KCiAgICAv\nKioKICAgICAqIEltcGxlbWVudGF0aW9uIG9mIHRoZQogICAgICoge0BsaW5r\nIExvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yLlNRTFdhcm5pbmdIYW5kbGVy\nfSBpbnRlcmZhY2UKICAgICAqIHRoYXQgYWxsb3dzIGN1c3RvbWl6YXRpb24g\nb2YgdGhlIGFjdGlvbnMgdG8gcGVyZm9ybSB3aGVuIGEKICAgICAqIHtAbGlu\nayBTUUxXYXJuaW5nfSBvY2N1cnMgYXQgYW55IHBvaW50IG9uIGEge0BsaW5r\nIENvbm5lY3Rpb259LAogICAgICoge0BsaW5rIFN0YXRlbWVudH0sIG9yIHtA\nbGluayBSZXN1bHRTZXR9LiBUaGlzIG1ldGhvZCBtYXkKICAgICAqIGJlIHVz\nZWQgZGV0ZXJtaW5lIHRob3NlIHdhcm5pbmdzIHRoZSBhcHBsaWNhdGlvbiB3\nYW50cyB0bwogICAgICogY29uc2lkZXIgY3JpdGljYWwgZmFpbHVyZXMsIGFu\nZCB0aHJvdyB0aGUgd2FybmluZyBpbiB0aG9zZQogICAgICogY2FzZXMuIEJ5\nIGRlZmF1bHQsIHRoaXMgbWV0aG9kIGRvZXMgbm90aGluZy4KICAgICAqCiAg\nICAgKiBAc2VlIExvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yI3NldFdhcm5p\nbmdBY3Rpb24KICAgICAqIEBzZWUgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0\nb3Ijc2V0V2FybmluZ0hhbmRsZXIKICAgICAqLwogICAgcHVibGljIHZvaWQg\naGFuZGxlV2FybmluZyhTUUxXYXJuaW5nIHdhcm5pbmcpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSBuZXcgZXhjZXB0aW9uIHRoYXQgd3JhcHMgPGNvZGU+Y2F1c2VzPC9j\nb2RlPi4KICAgICAqIEhvd2V2ZXIsIHRoZSBkZXRhaWxzIG9mIGV4YWN0bHkg\nd2hhdCB0eXBlIG9mIGV4Y2VwdGlvbiBpcyByZXR1cm5lZCBjYW4KICAgICAq\nIGJlIGRldGVybWluZWQgYnkgdGhlIGltcGxlbWVudGF0aW9uLiBUaGlzIG1h\neSB0YWtlIGludG8gYWNjb3VudAogICAgICogREItc3BlY2lmaWMgZXhjZXB0\naW9uIGluZm9ybWF0aW9uIGluIDxjb2RlPmNhdXNlczwvY29kZT4uCiAgICAg\nKi8KICAgIHB1YmxpYyBPcGVuSlBBRXhjZXB0aW9uIG5ld1N0b3JlRXhjZXB0\naW9uKFN0cmluZyBtc2csIFNRTEV4Y2VwdGlvbltdIGNhdXNlcywKICAgICAg\nICBPYmplY3QgZmFpbGVkKSB7CiAgICAJaWYgKGNhdXNlcyAhPSBudWxsICYm\nIGNhdXNlcy5sZW5ndGggPiAwKSB7CiAgICAJCU9wZW5KUEFFeGNlcHRpb24g\ncmV0ID0gbmFycm93KG1zZywgY2F1c2VzWzBdKTsKICAgIAkJcmV0LnNldEZh\naWxlZE9iamVjdChmYWlsZWQpLnNldE5lc3RlZFRocm93YWJsZXMoY2F1c2Vz\nKTsKICAgIAkJcmV0dXJuIHJldDsKICAgIAl9CiAgICAgICAgcmV0dXJuIG5l\ndyBTdG9yZUV4Y2VwdGlvbihtc2cpLnNldEZhaWxlZE9iamVjdChmYWlsZWQp\nLgogICAgICAgICAgICBzZXROZXN0ZWRUaHJvd2FibGVzKGNhdXNlcyk7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogR2V0cyB0aGUgc3VidHlwZSBvZiBT\ndG9yZUV4Y2VwdGlvbiBieSBtYXRjaGluZyB0aGUgZ2l2ZW4gU1FMRXhjZXB0\naW9uJ3MKICAgICAqIGVycm9yIHN0YXRlIGNvZGUgdG8gdGhlIGxpc3Qgb2Yg\nZXJyb3IgY29kZXMgc3VwcGxpZWQgYnkgdGhlIGRpY3Rpb25hcnkuCiAgICAg\nKiBSZXR1cm5zIC0xIGlmIG5vIG1hdGNoaW5nIGNvZGUgY2FuIGJlIGZvdW5k\nLgogICAgICovCiAgICBPcGVuSlBBRXhjZXB0aW9uIG5hcnJvdyhTdHJpbmcg\nbXNnLCBTUUxFeGNlcHRpb24gZXgpIHsKICAgIAlTdHJpbmcgZXJyb3JTdGF0\nZSA9IGV4LmdldFNRTFN0YXRlKCk7CiAgICAJaW50IGVycm9yVHlwZSA9IFN0\nb3JlRXhjZXB0aW9uLkdFTkVSQUw7CiAgICAJZm9yIChJbnRlZ2VyIHR5cGUg\nOiBzcWxTdGF0ZUNvZGVzLmtleVNldCgpKSB7CiAgICAJCVNldDxTdHJpbmc+\nIGVycm9TdGF0ZXMgPSBzcWxTdGF0ZUNvZGVzLmdldCh0eXBlKTsKICAgIAkJ\naWYgKGVycm9TdGF0ZXMgIT0gbnVsbCAmJiBlcnJvU3RhdGVzLmNvbnRhaW5z\nKGVycm9yU3RhdGUpKSB7CiAgICAJCQllcnJvclR5cGUgPSB0eXBlOwogICAg\nCQkJYnJlYWs7CiAgICAJCX0KICAgIAl9CiAgICAJc3dpdGNoIChlcnJvclR5\ncGUpIHsKCSAgICAJY2FzZSBTdG9yZUV4Y2VwdGlvbi5MT0NLOiAKCSAgICAg\nICAgICAgIHJldHVybiBuZXcgTG9ja0V4Y2VwdGlvbihtc2cpOwoJICAgIAlj\nYXNlIFN0b3JlRXhjZXB0aW9uLk9CSkVDVF9FWElTVFM6CgkgICAgICAgICAg\nICByZXR1cm4gbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlvbihtc2cpOwoJICAg\nIAljYXNlIFN0b3JlRXhjZXB0aW9uLk9CSkVDVF9OT1RfRk9VTkQ6CgkgICAg\nICAgICAgICByZXR1cm4gbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKG1z\nZyk7CgkgICAgCWNhc2UgU3RvcmVFeGNlcHRpb24uT1BUSU1JU1RJQzoKCSAg\nICAgICAgICAgIHJldHVybiBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihtc2cp\nOwoJICAgIAljYXNlIFN0b3JlRXhjZXB0aW9uLlJFRkVSRU5USUFMX0lOVEVH\nUklUWTogCgkgICAgICAgICAgICByZXR1cm4gbmV3IFJlZmVyZW50aWFsSW50\nZWdyaXR5RXhjZXB0aW9uKG1zZyk7CgkgICAgICAgIGRlZmF1bHQ6CgkgICAg\nICAgICAgICByZXR1cm4gbmV3IFN0b3JlRXhjZXB0aW9uKG1zZyk7CiAgICAg\nICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIENsb3NlcyB0aGUgc3Bl\nY2lmaWVkIHtAbGluayBEYXRhU291cmNlfSBhbmQgcmVsZWFzZXMgYW55CiAg\nICAgKiByZXNvdXJjZXMgYXNzb2NpYXRlZCB3aXRoIGl0LgogICAgICoKICAg\nICAqIEBwYXJhbSBkYXRhU291cmNlIHRoZSBEYXRhU291cmNlIHRvIGNsb3Nl\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsb3NlRGF0YVNvdXJjZShEYXRh\nU291cmNlIGRhdGFTb3VyY2UpIHsKICAgICAgICBEYXRhU291cmNlRmFjdG9y\neS5jbG9zZURhdGFTb3VyY2UoZGF0YVNvdXJjZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBVc2VkIGJ5IHNvbWUgbWFwcGluZ3MgdG8gcmVwcmVzZW50IGRh\ndGEgdGhhdCBoYXMgYWxyZWFkeSBiZWVuCiAgICAgKiBzZXJpYWxpemVkIHNv\nIHRoYXQgd2UgZG9uJ3QgaGF2ZSB0byBzZXJpYWxpemUgbXVsdGlwbGUgdGlt\nZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgU2VyaWFsaXpl\nZERhdGEgewoKICAgICAgICBwdWJsaWMgZmluYWwgYnl0ZVtdIGJ5dGVzOwoK\nICAgICAgICBwdWJsaWMgU2VyaWFsaXplZERhdGEoYnl0ZVtdIGJ5dGVzKSB7\nCiAgICAgICAgICAgIHRoaXMuYnl0ZXMgPSBieXRlczsKICAgICAgICB9CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHZlcnNpb24gY29sdW1u\nIG5hbWUKICAgICAqIEBwYXJhbSBjb2x1bW4KICAgICAqIEBwYXJhbSB0YWJs\nZUFsaWFzIDogdGhpcyBpcyBuZWVkZWQgZm9yIHBsYXRmb3JtIHNwZWNpZmlj\nIHZlcnNpb24gY29sdW1uCiAgICAgKiBAcmV0dXJuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0VmVyc2lvbkNvbHVtbihDb2x1bW4gY29sdW1uLCBT\ndHJpbmcgdGFibGVBbGlhcykgewogICAgICAgIHJldHVybiBjb2x1bW4udG9T\ndHJpbmcoKTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgaW5zZXJ0Qmxv\nYkZvclN0cmVhbWluZ0xvYWQoUm93IHJvdywgQ29sdW1uIGNvbCwgCiAgICAg\nICAgSkRCQ1N0b3JlIHN0b3JlLCBPYmplY3Qgb2IsIFNlbGVjdCBzZWwpIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChvYiAhPSBudWxsKSB7\nCiAgICAgICAgICAgIHJvdy5zZXRCaW5hcnlTdHJlYW0oY29sLCAKICAgICAg\nICAgICAgICAgIG5ldyBCeXRlQXJyYXlJbnB1dFN0cmVhbShuZXcgYnl0ZVsw\nXSksIDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJvdy5zZXRO\ndWxsKGNvbCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgdm9p\nZCBpbnNlcnRDbG9iRm9yU3RyZWFtaW5nTG9hZChSb3cgcm93LCBDb2x1bW4g\nY29sLCBPYmplY3Qgb2IpCiAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAob2IgIT0gbnVsbCkgewogICAgICAgIHJvdy5zZXRDaGFyYWN0\nZXJTdHJlYW0oY29sLAogICAgICAgICAgICAgICAgbmV3IENoYXJBcnJheVJl\nYWRlcihuZXcgY2hhclswXSksIDApOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIHJvdy5zZXROdWxsKGNvbCk7CiAgICAgICAgfQogICAgfQogICAg\nCiAgICBwdWJsaWMgdm9pZCB1cGRhdGVCbG9iKFNlbGVjdCBzZWwsIEpEQkNT\ndG9yZSBzdG9yZSwgSW5wdXRTdHJlYW0gaXMpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgU1FMQnVmZmVyIHNxbCA9IHNlbC50b1Nl\nbGVjdCh0cnVlLCBzdG9yZS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSk7CiAg\nICAgICAgUmVzdWx0U2V0IHJlcyA9IG51bGw7CiAgICAgICAgQ29ubmVjdGlv\nbiBjb25uID0gc3RvcmUuZ2V0Q29ubmVjdGlvbigpOwogICAgICAgIFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50ID0gbnVsbDsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBzdG1udCA9IHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4sIHN0\nb3JlLmdldEZldGNoQ29uZmlndXJhdGlvbigpLAogICAgICAgICAgICAgICAg\nUmVzdWx0U2V0LlRZUEVfU0NST0xMX1NFTlNJVElWRSwKICAgICAgICAgICAg\nICAgIFJlc3VsdFNldC5DT05DVVJfVVBEQVRBQkxFKTsKICAgICAgICAgICAg\ncmVzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAgIGlmICgh\ncmVzLm5leHQoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVy\nbmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJzdHJlYW0tZXhjZXB0aW9uIikpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIEJsb2IgYmxvYiA9IHJlcy5nZXRC\nbG9iKDEpOwogICAgICAgICAgICBPdXRwdXRTdHJlYW0gb3MgPSBibG9iLnNl\ndEJpbmFyeVN0cmVhbSgxKTsKICAgICAgICAgICAgY29weShpcywgb3MpOwog\nICAgICAgICAgICBvcy5jbG9zZSgpOwogICAgICAgICAgICByZXMudXBkYXRl\nQmxvYigxLCBibG9iKTsKICAgICAgICAgICAgcmVzLnVwZGF0ZVJvdygpOwoK\nICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGlvZSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdHJ5IHsgcmVzLmNsb3NlICgpOyB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gZSkge30KICAgICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwpCiAg\nICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSAoKTsgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgICAgIGlmIChjb25uICE9IG51\nbGwpCiAgICAgICAgICAgICAgICB0cnkgeyBjb25uLmNsb3NlICgpOyB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gZSkge30KICAgICAgICB9CiAgICB9CiAgICAK\nICAgIHB1YmxpYyB2b2lkIHVwZGF0ZUNsb2IoU2VsZWN0IHNlbCwgSkRCQ1N0\nb3JlIHN0b3JlLCBSZWFkZXIgcmVhZGVyKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIFNRTEJ1ZmZlciBzcWwgPSBzZWwudG9TZWxl\nY3QodHJ1ZSwgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkpOwogICAg\nICAgIFJlc3VsdFNldCByZXMgPSBudWxsOwogICAgICAgIENvbm5lY3Rpb24g\nY29ubiA9IHN0b3JlLmdldENvbm5lY3Rpb24oKTsKICAgICAgICBQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgc3RtbnQgPSBzcWwucHJlcGFyZVN0YXRlbWVudChjb25uLCBzdG9y\nZS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAgIFJl\nc3VsdFNldC5UWVBFX1NDUk9MTF9TRU5TSVRJVkUsCiAgICAgICAgICAgICAg\nICBSZXN1bHRTZXQuQ09OQ1VSX1VQREFUQUJMRSk7CiAgICAgICAgICAgIHJl\ncyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAgICAgICBpZiAoIXJl\ncy5uZXh0KCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5h\nbEV4Y2VwdGlvbihfbG9jLmdldCgic3RyZWFtLWV4Y2VwdGlvbiIpKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBDbG9iIGNsb2IgPSByZXMuZ2V0Q2xv\nYigxKTsKICAgICAgICAgICAgV3JpdGVyIHdyaXRlciA9IGNsb2Iuc2V0Q2hh\ncmFjdGVyU3RyZWFtKDEpOwogICAgICAgICAgICBjb3B5KHJlYWRlciwgd3Jp\ndGVyKTsKICAgICAgICAgICAgd3JpdGVyLmNsb3NlKCk7CiAgICAgICAgICAg\nIHJlcy51cGRhdGVDbG9iKDEsIGNsb2IpOwogICAgICAgICAgICByZXMudXBk\nYXRlUm93KCk7CgogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oaW9lKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocmVzICE9IG51\nbGwpIAogICAgICAgICAgICAgICAgdHJ5IHsgcmVzLmNsb3NlICgpOyB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gZSkge30KICAgICAgICAgICAgaWYgKHN0bW50\nICE9IG51bGwpIAogICAgICAgICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2Ug\nKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBlKSB7fQogICAgICAgICAgICBp\nZiAoY29ubiAhPSBudWxsKSAKICAgICAgICAgICAgICAgIHRyeSB7IGNvbm4u\nY2xvc2UgKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBlKSB7fQogICAgICAg\nIH0gICAgCiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBsb25nIGNvcHkoSW5w\ndXRTdHJlYW0gaW4sIE91dHB1dFN0cmVhbSBvdXQpIHRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgYnl0ZVtdIGNvcHlCdWZmZXIgPSBuZXcgYnl0ZVti\nbG9iQnVmZmVyU2l6ZV07CiAgICAgICAgbG9uZyBieXRlc0NvcGllZCA9IDA7\nCiAgICAgICAgaW50IHJlYWQgPSAtMTsKCiAgICAgICAgd2hpbGUgKChyZWFk\nID0gaW4ucmVhZChjb3B5QnVmZmVyLCAwLCBjb3B5QnVmZmVyLmxlbmd0aCkp\nICE9IC0xKSB7CiAgICAgICAgICAgIG91dC53cml0ZShjb3B5QnVmZmVyLCAw\nLCByZWFkKTsKICAgICAgICAgICAgYnl0ZXNDb3BpZWQgKz0gcmVhZDsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGJ5dGVzQ29waWVkOwogICAgfQogICAg\nCiAgICBwcm90ZWN0ZWQgbG9uZyBjb3B5KFJlYWRlciByZWFkZXIsIFdyaXRl\nciB3cml0ZXIpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgY2hhcltd\nIGNvcHlCdWZmZXIgPSBuZXcgY2hhcltjbG9iQnVmZmVyU2l6ZV07CiAgICAg\nICAgbG9uZyBieXRlc0NvcGllZCA9IDA7CiAgICAgICAgaW50IHJlYWQgPSAt\nMTsKCiAgICAgICAgd2hpbGUgKChyZWFkID0gcmVhZGVyLnJlYWQoY29weUJ1\nZmZlciwgMCwgY29weUJ1ZmZlci5sZW5ndGgpKSAhPSAtMSkgewogICAgICAg\nICAgICB3cml0ZXIud3JpdGUoY29weUJ1ZmZlciwgMCwgcmVhZCk7CiAgICAg\nICAgICAgIGJ5dGVzQ29waWVkICs9IHJlYWQ7CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gYnl0ZXNDb3BpZWQ7CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogQXR0YWNoIENBU1QgdG8gdGhlIGN1cnJlbnQgZnVuY3Rpb24gaWYgbmVj\nZXNzYXJ5CiAgICAgKiAKICAgICAqIEBwYXJhbSB2YWwgb3BlcmFuZCB2YWx1\nZQogICAgICogQHBhcm1hIGZ1bmMgdGhlIHNxbCBmdW5jdGlvbiBzdGF0ZW1l\nbnQKICAgICAqIEByZXR1cm4gYSBTdHJpbmcgd2l0aCB0aGUgY29ycmVjdCBD\nQVNUIGZ1bmN0aW9uIHN5bnRheAogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nIGdldENhc3RGdW5jdGlvbihWYWwgdmFsLCBTdHJpbmcgZnVuYykgewogICAg\nICAgIHJldHVybiBmdW5jOwogICAgfQogICAgCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhbiBpbmRleCBpZiBuZWNlc3NhcnkgZm9yIHNvbWUgZGF0YWJhc2Ug\ndGFibGVzCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNyZWF0ZUluZGV4SWZO\nZWNlc3NhcnkoU2NoZW1hIHNjaGVtYSwgU3RyaW5nIHRhYmxlLAogICAgICAg\nICAgICBDb2x1bW4gcGtDb2x1bW4pIHsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGJhdGNoTGltaXQKICAgICAqLwogICAgcHVibGlj\nIGludCBnZXRCYXRjaExpbWl0KCl7CiAgICAgICAgcmV0dXJuIGJhdGNoTGlt\naXQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2V0IHRoZSBiYXRjaExp\nbWl0IHZhbHVlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJhdGNoTGlt\naXQoaW50IGxpbWl0KXsKICAgICAgICBiYXRjaExpbWl0ID0gbGltaXQ7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhlIGJhdGNoIHBy\nb2Nlc3MuIEluIHNvbWUgY2FzZXMsIHdlIGNhbid0IGJhdGNoIHRoZSBzdGF0\nZW1lbnRzCiAgICAgKiBkdWUgdG8gc29tZSByZXN0cmljdGlvbnMuIEZvciBl\neGFtcGxlLCBpZiB0aGUgR2VuZXJhdGVkVHlwZT1JREVOVElUWSwKICAgICAq\nIHdlIGhhdmUgdG8gZGlzYWJsZSB0aGUgYmF0Y2ggcHJvY2VzcyBiZWNhdXNl\nIHdlIG5lZWQgdG8gZ2V0IHRoZSBJRCB2YWx1ZQogICAgICogcmlnaHQgYXdh\neSBmb3IgdGhlIGluLW1lbW9yeSBlbnRpdHkgdG8gdXNlLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiB2YWxpZGF0ZUJhdGNoUHJvY2VzcyhSb3dJbXBs\nIHJvdywgQ29sdW1uW10gYXV0b0Fzc2lnbiwKICAgICAgICAgICAgT3BlbkpQ\nQVN0YXRlTWFuYWdlciAgc20sIENsYXNzTWFwcGluZyBjbWQgKSB7CiAgICAg\nICAgYm9vbGVhbiBkaXNhYmxlQmF0Y2ggPSBmYWxzZTsKICAgICAgICBpZiAo\nZ2V0QmF0Y2hMaW1pdCgpPT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nIChhdXRvQXNzaWduICE9IG51bGwgJiYgc20gIT0gbnVsbCkgewogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZm1kID0gY21kLmdldFByaW1hcnlLZXlG\naWVsZHMoKTsKICAgICAgICAgICAgaW50IGkgPSAwOwogICAgICAgICAgICB3\naGlsZSAoIWRpc2FibGVCYXRjaCAmJiBpIDwgZm1kLmxlbmd0aCkgewogICAg\nICAgICAgICAgICAgaWYgKGZtZFtpXS5nZXRWYWx1ZVN0cmF0ZWd5KCkgPT0g\nVmFsdWVTdHJhdGVnaWVzLkFVVE9BU1NJR04pCiAgICAgICAgICAgICAgICAg\nICAgZGlzYWJsZUJhdGNoID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGkrKzsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBnbyB0byBlYWNo\nIERpY3Rpb25hcnkgdG8gdmFsaWRhdGUgdGhlIGJhdGNoIGNhcGFiaWxpdHkK\nICAgICAgICBpZiAoIWRpc2FibGVCYXRjaCkKICAgICAgICAgICAgZGlzYWJs\nZUJhdGNoID0gdmFsaWRhdGVEQlNwZWNpZmljQmF0Y2hQcm9jZXNzKGRpc2Fi\nbGVCYXRjaCwgcm93LCAKICAgICAgICAgICAgICAgIGF1dG9Bc3NpZ24sIHNt\nLCBjbWQpOwogICAgICAgIHJldHVybiBkaXNhYmxlQmF0Y2g7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogQWxsb3cgZWFjaCBEaWN0aW9uYXJ5IHRvIHZh\nbGlkYXRlIGl0cyBvd24gYmF0Y2ggcHJvY2Vzcy4gCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIHZhbGlkYXRlREJTcGVjaWZpY0JhdGNoUHJvY2VzcyAo\nYm9vbGVhbiBkaXNhYmxlQmF0Y2gsIAogICAgICAgICAgICBSb3dJbXBsIHJv\ndywgQ29sdW1uW10gYXV0b0Fzc2lnbiwgCiAgICAgICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgIHNtLCBDbGFzc01hcHBpbmcgY21kICkgewogICAgICAg\nIHJldHVybiBkaXNhYmxlQmF0Y2g7CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9u\nLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2Yg\nZXhlY3V0aW5nIHF1ZXJ5LgogICAgICovCiAgICBwcm90ZWN0ZWQgUmVzdWx0\nU2V0IGV4ZWN1dGVRdWVyeShDb25uZWN0aW9uIGNvbm4sIFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50LCBTdHJpbmcgc3FsIAogICAgICAgICkgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHN0bW50LmV4ZWN1dGVRdWVy\neSgpOwogICAgfQogICAgICAgICAgICAKICAgIC8qKgogICAgICogVGhpcyBt\nZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3Ig\nSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2YgcHJlcGFyaW5n\nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHJvdGVjdGVkIFByZXBhcmVkU3Rh\ndGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoQ29ubmVjdGlvbiBjb25uLCBTdHJp\nbmcgc3FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBjb25uLnByZXBhcmVTdGF0ZW1lbnQoc3FsKTsKICAgIH0gICAg\nCiAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBv\ndmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1w\nbGVtZW50YXRpb24gb2YgZ2V0dGluZyBzZXF1ZW5jZSBmcm9tIHRoZSByZXN1\nbHQgc2V0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU2VxdWVuY2VbXSBnZXRT\nZXF1ZW5jZShSZXN1bHRTZXQgcnMpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIExpc3Qgc2VxTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAg\nICB3aGlsZSAocnMgIT0gbnVsbCAmJiBycy5uZXh0KCkpCiAgICAgICAgICAg\nIHNlcUxpc3QuYWRkKG5ld1NlcXVlbmNlKHJzKSk7CiAgICAgICAgcmV0dXJu\nIChTZXF1ZW5jZVtdKSBzZXFMaXN0LnRvQXJyYXkobmV3IFNlcXVlbmNlW3Nl\ncUxpc3Quc2l6ZSgpXSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVGhp\ncyBtZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMg\nb3IgSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2YgZ2V0dGlu\nZyBrZXkgZnJvbSB0aGUgcmVzdWx0IHNldC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIE9iamVjdCBnZXRLZXkgKFJlc3VsdFNldCBycywgQ29sdW1uIGNvbCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFycy5uZXh0KCkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tZ2Vua2V5IikpOwogICAgICAgIE9iamVjdCBrZXkgPSBycy5nZXRP\nYmplY3QoMSk7CiAgICAgICAgaWYgKGtleSA9PSBudWxsKQogICAgICAgICAg\nICBsb2cud2FybihfbG9jLmdldCgiaW52YWxpZC1nZW5rZXkiLCBjb2wpKTsK\nICAgICAgICByZXR1cm4ga2V5OyAgICAgICAgCiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBm\nb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRp\nb24gb2YgY2FsY3VsYXRpbmcgdmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIGNhbGN1bGF0ZVZhbHVlKFZhbCB2YWwsIFNlbGVjdCBzZWwsIEV4\ncENvbnRleHQgY3R4LCAKICAgICAgICBFeHBTdGF0ZSBzdGF0ZSwgUGF0aCBw\nYXRoLCBFeHBTdGF0ZSBwYXRoU3RhdGUpIHsKICAgICAgICB2YWwuY2FsY3Vs\nYXRlVmFsdWUoc2VsLCBjdHgsIHN0YXRlLCAoVmFsKSBwYXRoLCBwYXRoU3Rh\ndGUpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHdoZXRoZXIg\ndGhlIHByb3ZpZGVkIDxjb2RlPnNxbDwvY29kZT4gbWF5IGJlIHRyZWF0ZWQg\nYXMgYSAKICAgICAqIHNlbGVjdCBzdGF0ZW1lbnQgb24gdGhpcyBkYXRhYmFz\nZS4KICAgICAqICAKICAgICAqIEBwYXJhbSBzcWwgICBBIHNxbCBzdGF0ZW1l\nbnQuIAogICAgICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgPGNvZGU+c3Fs\nPC9jb2RlPiByZXByZXNlbnRzIGEgc2VsZWN0IHN0YXRlbWVudC4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gaXNTZWxlY3QoU3RyaW5nIHNxbCkgewog\nICAgICAgIEl0ZXJhdG9yIGkgPSBzZWxlY3RXb3JkU2V0Lml0ZXJhdG9yKCk7\nCiAgICAgICAgU3RyaW5nIGN1cjsKICAgICAgICB3aGlsZSAoaS5oYXNOZXh0\nKCkpIHsKICAgICAgICAgICAgY3VyID0gKFN0cmluZykgaS5uZXh0KCk7CiAg\nICAgICAgICAgIGlmIChzcWwubGVuZ3RoKCkgPj0gY3VyLmxlbmd0aCgpCiAg\nICAgICAgICAgICAgICAgICAgJiYgc3FsLnN1YnN0cmluZygwLCBjdXIubGVu\nZ3RoKCkpLmVxdWFsc0lnbm9yZUNhc2UoY3VyKSkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIG5l\nZWRzVG9DcmVhdGVJbmRleChJbmRleCBpZHgsIFRhYmxlIHRhYmxlKSB7CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYmF0Y2hlZCBzdGF0ZW1lbnRzIHVwZGF0ZSBzdWNjZXMgY291bnQKICAg\nICAqIEBwYXJhbSBwcyBBIFByZXBhcmVkU3RhdGVtZW50CiAgICAgKiBAcmV0\ndXJuIHJldHVybiB1cGRhdGUgY291bnQKICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRCYXRjaFVwZGF0ZUNvdW50KFByZXBhcmVkU3RhdGVtZW50IHBzKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0K\nICAgIAogICAgcHVibGljIGJvb2xlYW4gZ2V0VHJpbVNjaGVtYU5hbWUoKSB7\nIAogICAgICAgIHJldHVybiB0cmltU2NoZW1hTmFtZTsKICAgIH0KICAgIAog\nICAgcHVibGljIHZvaWQgc2V0VHJpbVNjaGVtYU5hbWUoYm9vbGVhbiB0cmlt\nU2NoZW1hTmFtZSkgeyAKICAgICAgICB0aGlzLnRyaW1TY2hlbWFOYW1lID0g\ndHJpbVNjaGVtYU5hbWU7IAogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBk\nZWxldGVTdHJlYW0oSkRCQ1N0b3JlIHN0b3JlLCBTZWxlY3Qgc2VsKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBEbyBub3RoaW5nCiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhhdCB0aGUgZ2l2ZW4g\nbmFtZSBpcyBubyBsb25nZXIgdGhhbiBnaXZlbiBtYXhpbXVtIGxlbmd0aC4K\nICAgICAqIElmIHRoZSBnaXZlbiBuYW1lIGlzIGluZGVlZCBsb25nZXIgdGhl\nbiByYWlzZXMgYW4gVXNlckV4Y2VwdGlvbiB3aXRoIHRoZSAKICAgICAqIGdp\ndmVuIG1lc3NhZ2Uga2V5IG90aGVyd2lzZSByZXR1cm5zIHRoZSBzYW1lIG5h\nbWUuCiAgICAgKi8KICAgIGZpbmFsIFN0cmluZyBjaGVja05hbWVMZW5ndGgo\nU3RyaW5nIG5hbWUsIGludCBsZW5ndGgsIFN0cmluZyBtc2dLZXkpIHsKICAg\nIAlpZiAobmFtZS5sZW5ndGgoKSA+IGxlbmd0aCkKICAgIAkJdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQobXNnS2V5LCBuYW1lLCBuYW1lLmxl\nbmd0aCgpLCAKICAgIAkJCQlsZW5ndGgpKTsKICAgIAlyZXR1cm4gbmFtZTsK\nICAgIH0KfQo=\n","encoding":"base64"}

