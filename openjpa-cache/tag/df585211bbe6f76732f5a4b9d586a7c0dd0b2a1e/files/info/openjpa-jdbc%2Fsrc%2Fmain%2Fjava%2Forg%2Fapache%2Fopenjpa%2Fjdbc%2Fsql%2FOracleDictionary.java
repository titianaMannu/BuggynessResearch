{"sha":"872d964880fdef32ef96970877c39679050a075f","node_id":"MDQ6QmxvYjIwNjM2NDo4NzJkOTY0ODgwZmRlZjMyZWY5Njk3MDg3N2MzOTY3OTA1MGEwNzVm","size":43740,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/872d964880fdef32ef96970877c39679050a075f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc3FsLkJs\nb2I7CmltcG9ydCBqYXZhLnNxbC5DbG9iOwppbXBvcnQgamF2YS5zcWwuQ29u\nbmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURhdGE7Cmlt\ncG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEu\nc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlRp\nbWVzdGFtcDsKaW1wb3J0IGphdmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS51\ndGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9y\ndCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0\nb3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpE\nQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5rZXJuZWwuZXhwcy5GaWx0ZXJWYWx1ZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5QcmltYXJ5S2V5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNlcXVlbmNl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlbGVnYXRp\nbmdEYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5qZGJjLkRlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdG9yZUV4Y2VwdGlv\nbjsKCmltcG9ydCBzZXJwLnV0aWwuTnVtYmVyczsKCi8qKgogKiBEaWN0aW9u\nYXJ5IGZvciBPcmFjbGUuCiAqLwpwdWJsaWMgY2xhc3MgT3JhY2xlRGljdGlv\nbmFyeQogICAgZXh0ZW5kcyBEQkRpY3Rpb25hcnkgewoKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgU3RyaW5nIFNFTEVDVF9ISU5UID0gIm9wZW5qcGEuaGlu\ndC5PcmFjbGVTZWxlY3RIaW50IjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nU3RyaW5nIFZFTkRPUl9PUkFDTEUgPSAib3JhY2xlIjsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgQkVIQVZFX09USEVSID0gMDsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBCRUhBVkVfT1JBQ0xFID0gMTsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBCRUhBVkVfREFUQURJUkVDVDMxID0g\nMjsKCiAgICBwcml2YXRlIHN0YXRpYyBCbG9iIEVNUFRZX0JMT0IgPSBudWxs\nOwogICAgcHJpdmF0ZSBzdGF0aWMgQ2xvYiBFTVBUWV9DTE9CID0gbnVsbDsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExv\nY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKE9yYWNsZURpY3Rpb25hcnku\nY2xhc3MpOwoKICAgIC8qKgogICAgICogSWYgdHJ1ZSwgdGhlbiBzaW11bGF0\nZSBhdXRvLWFzc2lnbmVkIHZhbHVlcyBpbiBPcmFjbGUgYnkKICAgICAqIHVz\naW5nIGEgdHJpZ2dlciB0aGF0IGluc2VydHMgYSBzZXF1ZW5jZSB2YWx1ZSBp\nbnRvIHRoZQogICAgICogcHJpbWFyeSBrZXkgdmFsdWUgd2hlbiBhIHJvdyBp\ncyBpbnNlcnRlZC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gdXNlVHJp\nZ2dlcnNGb3JBdXRvQXNzaWduID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBU\naGUgZ2xvYmFsIHNlcXVlbmNlIG5hbWUgdG8gdXNlIGZvciBhdXRvYXNzaWdu\nIHNpbXVsYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgYXV0b0Fz\nc2lnblNlcXVlbmNlTmFtZSA9IG51bGw7CgogICAgLyoqCiAgICAgKiBGbGFn\nIHRvIHVzZSBPcGVuSlBBIDAuMyBzdHlsZSBuYW1pbmcgZm9yIGF1dG8gYXNz\naWduIHNlcXVlbmNlIG5hbWUgYW5kCiAgICAgKiB0cmlnZ2VyIG5hbWUgZm9y\nIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBvcGVuanBhM0dlbmVyYXRlZEtleU5hbWVzID0gZmFsc2U7Cgog\nICAgLyoqCiAgICAgKiBJZiB0cnVlLCB0aGVuIE9wZW5KUEEgd2lsbCBhdHRl\nbXB0IHRvIHVzZSB0aGUgc3BlY2lhbAogICAgICogT3JhY2xlUHJlcGFyZWRT\ndGF0ZW1lbnQuc2V0Rm9ybU9mVXNlIG1ldGhvZCB0bwogICAgICogY29uZmln\ndXJlIHN0YXRlbWVudHMgdGhhdCBpdCBkZXRlY3RzIGFyZSBvcGVyYXRpbmcg\nb24gdW5pY29kZSBmaWVsZHMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIHVzZVNldEZvcm1PZlVzZUZvclVuaWNvZGUgPSB0cnVlOwoKICAgIC8vIHNv\nbWUgb3JhY2xlIGRyaXZlcnMgaGF2ZSBwcm9ibGVtcyB3aXRoIHNlbGVjdCBm\nb3IgdXBkYXRlOyB3YXJuIHRoZQogICAgLy8gZmlyc3QgdGltZSBsb2NraW5n\nIGlzIGF0dGVtcHRlZAogICAgcHJpdmF0ZSBib29sZWFuIF9jaGVja2VkVXBk\nYXRlQnVnID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3dhcm5lZENo\nYXJDb2x1bW4gPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfd2FybmVk\nTmNoYXJDb2x1bW4gPSBmYWxzZTsKICAgIHByaXZhdGUgaW50IF9kcml2ZXJC\nZWhhdmlvciA9IC0xOwoKICAgIC8vIGNhY2hlIGxvYiBtZXRob2RzCiAgICBw\ncml2YXRlIE1ldGhvZCBfcHV0Qnl0ZXMgPSBudWxsOwogICAgcHJpdmF0ZSBN\nZXRob2QgX3B1dFN0cmluZyA9IG51bGw7CiAgICBwcml2YXRlIE1ldGhvZCBf\ncHV0Q2hhcnMgPSBudWxsOwogICAgCiAgICAvLyBiYXRjaCBsaW1pdAogICAg\ncHJpdmF0ZSBpbnQgZGVmYXVsdEJhdGNoTGltaXQgPSAxMDA7CgogICAgcHVi\nbGljIE9yYWNsZURpY3Rpb25hcnkoKSB7CiAgICAgICAgcGxhdGZvcm0gPSAi\nT3JhY2xlIjsKICAgICAgICB2YWxpZGF0aW9uU1FMID0gIlNFTEVDVCBTWVNE\nQVRFIEZST00gRFVBTCI7CiAgICAgICAgbmV4dFNlcXVlbmNlUXVlcnkgPSAi\nU0VMRUNUIHswfS5ORVhUVkFMIEZST00gRFVBTCI7CiAgICAgICAgc3RyaW5n\nTGVuZ3RoRnVuY3Rpb24gPSAiTEVOR1RIKHswfSkiOwogICAgICAgIGpvaW5T\neW50YXggPSBTWU5UQVhfREFUQUJBU0U7CiAgICAgICAgbWF4VGFibGVOYW1l\nTGVuZ3RoID0gMzA7CiAgICAgICAgbWF4Q29sdW1uTmFtZUxlbmd0aCA9IDMw\nOwogICAgICAgIG1heEluZGV4TmFtZUxlbmd0aCA9IDMwOwogICAgICAgIG1h\neENvbnN0cmFpbnROYW1lTGVuZ3RoID0gMzA7CiAgICAgICAgbWF4RW1iZWRk\nZWRCbG9iU2l6ZSA9IDQwMDA7CiAgICAgICAgbWF4RW1iZWRkZWRDbG9iU2l6\nZSA9IDQwMDA7CiAgICAgICAgaW5DbGF1c2VMaW1pdCA9IDEwMDA7CgogICAg\nICAgIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cyA9IHRydWU7CiAgICAg\nICAgc3VwcG9ydHNMb2NraW5nV2l0aERpc3RpbmN0Q2xhdXNlID0gZmFsc2U7\nCiAgICAgICAgc3VwcG9ydHNTZWxlY3RTdGFydEluZGV4ID0gdHJ1ZTsKICAg\nICAgICBzdXBwb3J0c1NlbGVjdEVuZEluZGV4ID0gdHJ1ZTsKCiAgICAgICAg\nc3lzdGVtU2NoZW1hU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KG5ldyBTdHJp\nbmdbXXsKICAgICAgICAgICAgIkNUWFNZUyIsICJNRFNZUyIsICJTWVMiLCAi\nU1lTVEVNIiwgIldLU1lTIiwgIldNU1lTIiwgIlhEQiIsCiAgICAgICAgfSkp\nOwoKICAgICAgICBzdXBwb3J0c1hNTENvbHVtbiA9IHRydWU7CiAgICAgICAg\neG1sVHlwZU5hbWUgPSAiWE1MVHlwZSI7CiAgICAgICAgYmlnaW50VHlwZU5h\nbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBiaXRUeXBlTmFtZSA9ICJOVU1C\nRVJ7MH0iOwogICAgICAgIGRlY2ltYWxUeXBlTmFtZSA9ICJOVU1CRVJ7MH0i\nOwogICAgICAgIGRvdWJsZVR5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAgICAg\nICAgaW50ZWdlclR5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAgbnVt\nZXJpY1R5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAgc21hbGxpbnRU\neXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIHRpbnlpbnRUeXBlTmFt\nZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIGxvbmdWYXJjaGFyVHlwZU5hbWUg\nPSAiTE9ORyI7CiAgICAgICAgYmluYXJ5VHlwZU5hbWUgPSAiQkxPQiI7CiAg\nICAgICAgdmFyYmluYXJ5VHlwZU5hbWUgPSAiQkxPQiI7CiAgICAgICAgbG9u\nZ1ZhcmJpbmFyeVR5cGVOYW1lID0gIkJMT0IiOwogICAgICAgIHRpbWVUeXBl\nTmFtZSA9ICJEQVRFIjsKICAgICAgICB2YXJjaGFyVHlwZU5hbWUgPSAiVkFS\nQ0hBUjJ7MH0iOwogICAgICAgIGZpeGVkU2l6ZVR5cGVOYW1lU2V0LmFkZEFs\nbChBcnJheXMuYXNMaXN0KG5ldyBTdHJpbmdbXXsKICAgICAgICAgICAgIkxP\nTkcgUkFXIiwgIlJBVyIsICJMT05HIiwgIlJFRiIsCiAgICAgICAgfSkpOwog\nICAgICAgIHJlc2VydmVkV29yZFNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChu\nZXcgU3RyaW5nW117CiAgICAgICAgICAgICJBQ0NFU1MiLCAiQVVESVQiLCAi\nQ0xVU1RFUiIsICJDT01NRU5UIiwgIkNPTVBSRVNTIiwgIkVYQ0xVU0lWRSIs\nCiAgICAgICAgICAgICJGSUxFIiwgIklERU5USUZJRUQiLCAiSU5DUkVNRU5U\nIiwgIklOREVYIiwgIklOSVRJQUwiLCAiTE9DSyIsCiAgICAgICAgICAgICJM\nT05HIiwgIk1BWEVYVEVOVFMiLCAiTUlOVVMiLCAiTU9ERSIsICJOT0FVRElU\nIiwgIk5PQ09NUFJFU1MiLAogICAgICAgICAgICAiTk9XQUlUIiwgIk9GRkxJ\nTkUiLCAiT05MSU5FIiwgIlBDVEZSRUUiLCAiUk9XIiwKICAgICAgICB9KSk7\nCgogICAgICAgIHN1YnN0cmluZ0Z1bmN0aW9uTmFtZSA9ICJTVUJTVFIiOwog\nICAgICAgIHN1cGVyLnNldEJhdGNoTGltaXQoZGVmYXVsdEJhdGNoTGltaXQp\nOwogICAgICAgIHNlbGVjdFdvcmRTZXQuYWRkKCJXSVRIIik7CiAgICAgICAg\ncmVwb3J0c1N1Y2Nlc3NOb0luZm9PbkJhdGNoVXBkYXRlcyA9IHRydWU7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgZW5kQ29uZmlndXJhdGlvbigpIHsKICAg\nICAgICBzdXBlci5lbmRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgaWYgKHVz\nZVRyaWdnZXJzRm9yQXV0b0Fzc2lnbikKICAgICAgICAgICAgc3VwcG9ydHNB\ndXRvQXNzaWduID0gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb25u\nZWN0ZWRDb25maWd1cmF0aW9uKENvbm5lY3Rpb24gY29ubikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdXBlci5jb25uZWN0ZWRD\nb25maWd1cmF0aW9uKGNvbm4pOwogICAgICAgIGlmIChkcml2ZXJWZW5kb3Ig\nPT0gbnVsbCkgewogICAgICAgICAgICBEYXRhYmFzZU1ldGFEYXRhIG1ldGEg\nPSBjb25uLmdldE1ldGFEYXRhKCk7CiAgICAgICAgICAgIFN0cmluZyB1cmwg\nPSAobWV0YS5nZXRVUkwoKSA9PSBudWxsKSA/ICIiIDogbWV0YS5nZXRVUkwo\nKTsKICAgICAgICAgICAgU3RyaW5nIGRyaXZlck5hbWUgPSBtZXRhLmdldERy\naXZlck5hbWUoKTsKICAgICAgICAgICAgU3RyaW5nIG1ldGFkYXRhQ2xhc3NO\nYW1lOwogICAgICAgICAgICBpZiAobWV0YSBpbnN0YW5jZW9mIERlbGVnYXRp\nbmdEYXRhYmFzZU1ldGFEYXRhKQogICAgICAgICAgICAgICAgbWV0YWRhdGFD\nbGFzc05hbWUgPSAoKERlbGVnYXRpbmdEYXRhYmFzZU1ldGFEYXRhKSBtZXRh\nKS4KICAgICAgICAgICAgICAgICAgICBnZXRJbm5lcm1vc3REZWxlZ2F0ZSgp\nLmdldENsYXNzKCkuZ2V0TmFtZSgpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBtZXRhZGF0YUNsYXNzTmFtZSA9IG1ldGEuZ2V0Q2xhc3Mo\nKS5nZXROYW1lKCk7CgogICAgICAgICAgICAvLyBjaGVjayBib3RoIHRoZSBk\ncml2ZXIgY2xhc3MgbmFtZSBhbmQgdGhlIFVSTCBmb3Iga25vd24gcGF0dGVy\nbnMKICAgICAgICAgICAgaWYgKG1ldGFkYXRhQ2xhc3NOYW1lLnN0YXJ0c1dp\ndGgoIm9yYWNsZS4iKQogICAgICAgICAgICAgICAgfHwgdXJsLmluZGV4T2Yo\nImpkYmM6b3JhY2xlOiIpICE9IC0xCiAgICAgICAgICAgICAgICB8fCAiT3Jh\nY2xlIEpEQkMgZHJpdmVyIi5lcXVhbHMoZHJpdmVyTmFtZSkpIHsKICAgICAg\nICAgICAgICAgIGRyaXZlclZlbmRvciA9IFZFTkRPUl9PUkFDTEUgKyBtZXRh\nLmdldERyaXZlck1ham9yVmVyc2lvbigpCiAgICAgICAgICAgICAgICAgICAg\nKyBtZXRhLmdldERyaXZlck1pbm9yVmVyc2lvbigpOwoKICAgICAgICAgICAg\nICAgIFN0cmluZyBwcm9kdWN0VmVyc2lvbiA9IG1ldGEuZ2V0RGF0YWJhc2VQ\ncm9kdWN0VmVyc2lvbigpCiAgICAgICAgICAgICAgICAgICAgLnNwbGl0KCJS\nZWxlYXNlICIsMClbMV0uc3BsaXQoIlxcLiIsMClbMF07CiAgICAgICAgICAg\nICAgICBpbnQgcmVsZWFzZSA9IEludGVnZXIucGFyc2VJbnQocHJvZHVjdFZl\ncnNpb24pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyB3\nYXJuIHNxbDkyCiAgICAgICAgICAgICAgICBpZiAocmVsZWFzZSA8PSA4KSB7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGpvaW5TeW50YXggPT0gU1lOVEFY\nX1NRTDkyICYmIGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJvcmFjbGUtc3ludGF4Iikp\nOwogICAgICAgICAgICAgICAgICAgIGpvaW5TeW50YXggPSBTWU5UQVhfREFU\nQUJBU0U7CiAgICAgICAgICAgICAgICAgICAgZGF0ZVR5cGVOYW1lID0gIkRB\nVEUiOyAvLyBhZGRlZCBvcmFjbGUgOQogICAgICAgICAgICAgICAgICAgIHRp\nbWVzdGFtcFR5cGVOYW1lID0gIkRBVEUiOyAvLyBhZGRlZCBvcmFjbGUgOQog\nICAgICAgICAgICAgICAgICAgIHN1cHBvcnRzWE1MQ29sdW1uID0gZmFsc2U7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gc2Vs\nZWN0IG9mIGFuIHhtbCBjb2x1bW4gcmVxdWlyZXMgIi5nZXRTdHJpbmdWYWwo\nKSIKICAgICAgICAgICAgICAgICAgICAvLyBzdWZmaXguIGVnLiB0MC54bWxj\nb2wuZ2V0U3RyaW5nVmFsKCkKICAgICAgICAgICAgICAgICAgICBnZXRTdHJp\nbmdWYWwgPSAiLmdldFN0cmluZ1ZhbCgpIjsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChtZXRhZGF0YUNsYXNzTmFtZS5zdGFydHNXaXRoKCJjb20uZGR0ZWsu\nIikKICAgICAgICAgICAgICAgIHx8IHVybC5pbmRleE9mKCJqZGJjOmRhdGFk\naXJlY3Q6b3JhY2xlOiIpICE9IC0xCiAgICAgICAgICAgICAgICB8fCAiT3Jh\nY2xlIi5lcXVhbHMoZHJpdmVyTmFtZSkpIHsKICAgICAgICAgICAgICAgIGRy\naXZlclZlbmRvciA9IFZFTkRPUl9EQVRBRElSRUNUICsgbWV0YS5nZXREcml2\nZXJNYWpvclZlcnNpb24oKQogICAgICAgICAgICAgICAgICAgICsgbWV0YS5n\nZXREcml2ZXJNaW5vclZlcnNpb24oKTsKICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfT1RIRVI7CiAg\nICAgICAgfQogICAgICAgIGNhY2hlRHJpdmVyQmVoYXZpb3IoZHJpdmVyVmVu\nZG9yKTsKICAgIH0KCiAgICAvKioKICAgICAqIENhY2hlIGNvbnN0YW50IGZv\nciBkcml2ZXJzIHdpdGggYmVoYXZpb3JzIHdlIGhhdmUgdG8gZGVhbCB3aXRo\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY2FjaGVEcml2ZXJCZWhhdmlv\ncihTdHJpbmcgZHJpdmVyVmVuZG9yKSB7CiAgICAgICAgaWYgKF9kcml2ZXJC\nZWhhdmlvciAhPSAtMSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBk\ncml2ZXJWZW5kb3IgPSBkcml2ZXJWZW5kb3IudG9Mb3dlckNhc2UoKTsKICAg\nICAgICBpZiAoZHJpdmVyVmVuZG9yLnN0YXJ0c1dpdGgoVkVORE9SX09SQUNM\nRSkpCiAgICAgICAgICAgIF9kcml2ZXJCZWhhdmlvciA9IEJFSEFWRV9PUkFD\nTEU7CiAgICAgICAgZWxzZSBpZiAoZHJpdmVyVmVuZG9yLmVxdWFscyhWRU5E\nT1JfREFUQURJUkVDVCArICIzMCIpCiAgICAgICAgICAgIHx8IGRyaXZlclZl\nbmRvci5lcXVhbHMoVkVORE9SX0RBVEFESVJFQ1QgKyAiMzEiKSkKICAgICAg\nICAgICAgX2RyaXZlckJlaGF2aW9yID0gQkVIQVZFX0RBVEFESVJFQ1QzMTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIF9kcml2ZXJCZWhhdmlvciA9IEJF\nSEFWRV9PVEhFUjsKICAgIH0KCiAgICAvKioKICAgICAqIEVuc3VyZSB0aGF0\nIHRoZSBkcml2ZXIgdmVuZG9yIGhhcyBiZWVuIHNldCwgYW5kIGlmIG5vdCwg\nc2V0IGl0IG5vdy4KICAgICAqLwogICAgcHVibGljIHZvaWQgZW5zdXJlRHJp\ndmVyVmVuZG9yKCkgewogICAgICAgIGlmIChkcml2ZXJWZW5kb3IgIT0gbnVs\nbCkgewogICAgICAgICAgICBjYWNoZURyaXZlckJlaGF2aW9yKGRyaXZlclZl\nbmRvcik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIGlmIChsb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cuaW5m\nbyhfbG9jLmdldCgib3JhY2xlLWNvbm5lY3RpbmctZm9yLWRyaXZlciIpKTsK\nICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBudWxsOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGNvbm4gPSBjb25mLmdldERhdGFTb3VyY2UyKG51bGwp\nLmdldENvbm5lY3Rpb24oKTsKICAgICAgICAgICAgY29ubmVjdGVkQ29uZmln\ndXJhdGlvbihjb25uKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9y\nZShzZSwgdGhpcyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\naWYgKGNvbm4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgY29ubi5jbG9zZSgpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nTG9ja2luZyhTZWxlY3Qgc2VsKSB7CiAgICAgICAgaWYgKCFzdXBlci5zdXBw\nb3J0c0xvY2tpbmcoc2VsKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIHJldHVybiAhcmVxdWlyZXNTdWJzZWxlY3RGb3JSYW5nZShzZWwu\nZ2V0U3RhcnRJbmRleCgpLAogICAgICAgICAgICBzZWwuZ2V0RW5kSW5kZXgo\nKSwgc2VsLmlzRGlzdGluY3QoKSwgc2VsLmdldE9yZGVyaW5nKCkpOwogICAg\nfQoKICAgIHByb3RlY3RlZCBTUUxCdWZmZXIgZ2V0U2VsZWN0cyhTZWxlY3Qg\nc2VsLCBib29sZWFuIGRpc3RpbmN0SWRlbnRpZmllcnMsCiAgICAgICAgYm9v\nbGVhbiBmb3JVcGRhdGUpIHsKICAgICAgICAvLyBpZiByYW5nZSBkb2Vzbid0\nIHJlcXVpcmUgYSBzdWJzZWxlY3QgY2FuIHVzZSBzdXBlcgogICAgICAgIGlm\nICghcmVxdWlyZXNTdWJzZWxlY3RGb3JSYW5nZShzZWwuZ2V0U3RhcnRJbmRl\neCgpLAogICAgICAgICAgICBzZWwuZ2V0RW5kSW5kZXgoKSwgc2VsLmlzRGlz\ndGluY3QoKSwgc2VsLmdldE9yZGVyaW5nKCkpKQogICAgICAgICAgICByZXR1\ncm4gc3VwZXIuZ2V0U2VsZWN0cyhzZWwsIGRpc3RpbmN0SWRlbnRpZmllcnMs\nIGZvclVwZGF0ZSk7CgogICAgICAgIC8vIGlmIHRoZXJlIGFyZSBubyBqb2lu\ncyBpbnZvbHZlZCBvciB3ZSdyZSB1c2luZyBhIGZyb20gc2VsZWN0IHNvCiAg\nICAgICAgLy8gdGhhdCBhbGwgY29scyBhbHJlYWR5IGhhdmUgdW5pcXVlIGFs\naWFzZXMsIGNhbiB1c2Ugc3VwZXIKICAgICAgICBpZiAoc2VsLmdldEZyb21T\nZWxlY3QoKSAhPSBudWxsIHx8IHNlbC5nZXRUYWJsZUFsaWFzZXMoKS5zaXpl\nKCkgPCAyKQogICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0U2VsZWN0cyhz\nZWwsIGRpc3RpbmN0SWRlbnRpZmllcnMsIGZvclVwZGF0ZSk7CgogICAgICAg\nIC8vIHNpbmNlIG5vbmUgb2YgdGhlIGNvbmRpdGlvbnMgYWJvdmUgd2VyZSBt\nZXQsIHdlJ3JlIGRlYWxpbmcgd2l0aAogICAgICAgIC8vIGEgc2VsZWN0IHRo\nYXQgdXNlcyBqb2lucyBhbmQgcmVxdWlyZXMgc3Vic2VsZWN0cyB0byBzZWxl\nY3QgdGhlCiAgICAgICAgLy8gcHJvcGVyIHJhbmdlOyBhbGlhcyBhbGwgY29s\ndW1uIHZhbHVlcyBzbyB0aGF0IHRoZXkgYXJlIHVuaXF1ZSB3aXRoaW4KICAg\nICAgICAvLyB0aGUgc3Vic2VsZWN0CiAgICAgICAgU1FMQnVmZmVyIHNlbGVj\ndFNRTCA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgTGlzdCBhbGlh\nc2VzOwogICAgICAgIGlmIChkaXN0aW5jdElkZW50aWZpZXJzKQogICAgICAg\nICAgICBhbGlhc2VzID0gc2VsLmdldElkZW50aWZpZXJBbGlhc2VzKCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBhbGlhc2VzID0gc2VsLmdldFNlbGVj\ndEFsaWFzZXMoKTsKCiAgICAgICAgT2JqZWN0IGFsaWFzOwogICAgICAgIGlu\ndCBpID0gMDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGFsaWFzZXMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaSsrKSB7CiAgICAgICAgICAg\nIGFsaWFzID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGFsaWFzIGlu\nc3RhbmNlb2YgU1FMQnVmZmVyKQogICAgICAgICAgICAgICAgc2VsZWN0U1FM\nLmFwcGVuZCgoU1FMQnVmZmVyKSBhbGlhcyk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoYWxpYXMudG9TdHJp\nbmcoKSk7CiAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIiBBUyBjIiku\nYXBwZW5kKFN0cmluZy52YWx1ZU9mKGkpKTsKICAgICAgICAgICAgaWYgKGl0\nci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5k\nKCIsICIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZWN0U1FMOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGNhbk91dGVySm9pbihpbnQgc3lu\ndGF4LCBGb3JlaWduS2V5IGZrKSB7CiAgICAgICAgaWYgKCFzdXBlci5jYW5P\ndXRlckpvaW4oc3ludGF4LCBmaykpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpZiAoZmsgIT0gbnVsbCAmJiBzeW50YXggPT0gU1lOVEFY\nX0RBVEFCQVNFKSB7CiAgICAgICAgICAgIGlmIChmay5nZXRDb25zdGFudHMo\nKS5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgICAgICBpZiAoZmsuZ2V0UHJpbWFyeUtleUNvbnN0YW50cygpLmxl\nbmd0aCA+IDApCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBT\nUUxCdWZmZXIgdG9OYXRpdmVKb2luKEpvaW4gam9pbikgewogICAgICAgIGlm\nIChqb2luLmdldFR5cGUoKSAhPSBKb2luLlRZUEVfT1VURVIpCiAgICAgICAg\nICAgIHJldHVybiB0b1RyYWRpdGlvbmFsSm9pbihqb2luKTsKCiAgICAgICAg\nRm9yZWlnbktleSBmayA9IGpvaW4uZ2V0Rm9yZWlnbktleSgpOwogICAgICAg\nIGlmIChmayA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgYm9vbGVhbiBpbnZlcnNlID0gam9pbi5pc0ZvcmVpZ25LZXlJbnZl\ncnNlZCgpOwogICAgICAgIENvbHVtbltdIGZyb20gPSAoaW52ZXJzZSkgPyBm\nay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpCiAgICAgICAgICAgIDogZmsuZ2V0\nQ29sdW1ucygpOwogICAgICAgIENvbHVtbltdIHRvID0gKGludmVyc2UpID8g\nZmsuZ2V0Q29sdW1ucygpCiAgICAgICAgICAgIDogZmsuZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKTsKCiAgICAgICAgLy8gZG8gY29sdW1uIGpvaW5zCiAgICAg\nICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAg\nICAgaW50IGNvdW50ID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZyb20ubGVuZ3RoOyBpKyssIGNvdW50KyspIHsKICAgICAgICAgICAgaWYg\nKGNvdW50ID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQg\nIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRBbGlhczEoKSku\nYXBwZW5kKCIuIikuYXBwZW5kKGZyb21baV0pOwogICAgICAgICAgICBidWYu\nYXBwZW5kKCIgPSAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdl\ndEFsaWFzMigpKS5hcHBlbmQoIi4iKS5hcHBlbmQodG9baV0pOwogICAgICAg\nICAgICBidWYuYXBwZW5kKCIoKykiKTsKICAgICAgICB9CgogICAgICAgIC8v\nIGNoZWNrIGNvbnN0YW50IGpvaW5zCiAgICAgICAgaWYgKGZrLmdldENvbnN0\nYW50Q29sdW1ucygpLmxlbmd0aCA+IDApCiAgICAgICAgICAgIHRocm93IG5l\ndyBTdG9yZUV4Y2VwdGlvbihfbG9jLmdldCgib3JhY2xlLWNvbnN0YW50IiwK\nICAgICAgICAgICAgICAgIGpvaW4uZ2V0VGFibGUxKCksIGpvaW4uZ2V0VGFi\nbGUyKCkpKS5zZXRGYXRhbCh0cnVlKTsKCiAgICAgICAgaWYgKGZrLmdldENv\nbnN0YW50UHJpbWFyeUtleUNvbHVtbnMoKS5sZW5ndGggPiAwKQogICAgICAg\nICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm9yYWNs\nZS1jb25zdGFudCIsCiAgICAgICAgICAgICAgICBqb2luLmdldFRhYmxlMSgp\nLCBqb2luLmdldFRhYmxlMigpKSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAg\ncmV0dXJuIGJ1ZjsKICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvU2Vs\nZWN0KFNRTEJ1ZmZlciBzZWxlY3QsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsCiAgICAgICAgU1FMQnVmZmVyIHRhYmxlcywgU1FMQnVmZmVyIHdo\nZXJlLCBTUUxCdWZmZXIgZ3JvdXAsCiAgICAgICAgU1FMQnVmZmVyIGhhdmlu\nZywgU1FMQnVmZmVyIG9yZGVyLAogICAgICAgIGJvb2xlYW4gZGlzdGluY3Qs\nIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25nIGVuZCwKICAg\nICAgICBTZWxlY3Qgc2VsKSB7CiAgICAgICAgaWYgKCFfY2hlY2tlZFVwZGF0\nZUJ1ZykgewogICAgICAgICAgICBlbnN1cmVEcml2ZXJWZW5kb3IoKTsKICAg\nICAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiBfZHJpdmVyQmVoYXZpb3IgPT0g\nQkVIQVZFX0RBVEFESVJFQ1QzMSkKICAgICAgICAgICAgICAgIGxvZy53YXJu\nKF9sb2MuZ2V0KCJkZC1sb2NrLWJ1ZyIpKTsKICAgICAgICAgICAgX2NoZWNr\nZWRVcGRhdGVCdWcgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYg\nbm8gcmFuZ2UsIHVzZSBzdGFuZGFyZCBzZWxlY3QKICAgICAgICBpZiAoc3Rh\ncnQgPT0gMCAmJiBlbmQgPT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAg\nIHJldHVybiBzdXBlci50b1NlbGVjdChzZWxlY3QsIGZldGNoLCB0YWJsZXMs\nIHdoZXJlLCBncm91cCwgaGF2aW5nLAogICAgICAgICAgICAgICAgb3JkZXIs\nIGRpc3RpbmN0LCBmb3JVcGRhdGUsIDAsIExvbmcuTUFYX1ZBTFVFLCBzZWwp\nOwoKICAgICAgICAvLyBpZiBubyBza2lwLCBvcmRlcmluZywgb3IgZGlzdGlu\nY3QgY2FuIHVzZSByb3dudW0gZGlyZWN0bHkKICAgICAgICBTUUxCdWZmZXIg\nYnVmID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBpZiAoIXJlcXVp\ncmVzU3Vic2VsZWN0Rm9yUmFuZ2Uoc3RhcnQsIGVuZCwgZGlzdGluY3QsIG9y\nZGVyKSkgewogICAgICAgICAgICBpZiAod2hlcmUgIT0gbnVsbCAmJiAhd2hl\ncmUuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCh3aGVy\nZSkuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKCJS\nT1dOVU0gPD0gIikuYXBwZW5kVmFsdWUoZW5kKTsKICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLnRvU2VsZWN0KHNlbGVjdCwgZmV0Y2gsIHRhYmxlcywgYnVm\nLCBncm91cCwgaGF2aW5nLAogICAgICAgICAgICAgICAgb3JkZXIsIGRpc3Rp\nbmN0LCBmb3JVcGRhdGUsIDAsIExvbmcuTUFYX1ZBTFVFLCBzZWwpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gaWYgdGhlcmUgaXMgb3JkZXJpbmcsIHNraXAs\nIG9yIGRpc3RpbmN0IHdlIGhhdmUgdG8gdXNlIHN1YnNlbGVjdHMKICAgICAg\nICBTUUxCdWZmZXIgbmV3c2VsID0gc3VwZXIudG9TZWxlY3Qoc2VsZWN0LCBm\nZXRjaCwgdGFibGVzLCB3aGVyZSwKICAgICAgICAgICAgZ3JvdXAsIGhhdmlu\nZywgb3JkZXIsIGRpc3RpbmN0LCBmb3JVcGRhdGUsIDAsIExvbmcuTUFYX1ZB\nTFVFLAogICAgICAgICAgICBzZWwpOwoKICAgICAgICAvLyBpZiBubyBza2lw\nLCBjYW4gdXNlIHNpbmdsZSBuZXN0ZWQgc3Vic2VsZWN0CiAgICAgICAgaWYg\nKHN0YXJ0ID09IDApIHsKICAgICAgICAgICAgYnVmLmFwcGVuZChnZXRTZWxl\nY3RPcGVyYXRpb24oZmV0Y2gpICsgIiAqIEZST00gKCIpOwogICAgICAgICAg\nICBidWYuYXBwZW5kKG5ld3NlbCk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIikgV0hFUkUgUk9XTlVNIDw9ICIpLmFwcGVuZFZhbHVlKGVuZCk7CiAgICAg\nICAgICAgIHJldHVybiBidWY7CiAgICAgICAgfQoKICAgICAgICAvLyB3aXRo\nIGEgc2tpcCwgd2UgaGF2ZSB0byB1c2UgYSBkb3VibGUtbmVzdGVkIHN1YnNl\nbGVjdCB0byBwdXQKICAgICAgICAvLyB3aGVyZSBjb25kaXRpb25zIG9uIHRo\nZSByb3dudW0KICAgICAgICBidWYuYXBwZW5kKGdldFNlbGVjdE9wZXJhdGlv\nbihmZXRjaCkKICAgICAgICAgICAgKyAiICogRlJPTSAoU0VMRUNUIHIuKiwg\nUk9XTlVNIFJOVU0gRlJPTSAoIik7CiAgICAgICAgYnVmLmFwcGVuZChuZXdz\nZWwpOwogICAgICAgIGJ1Zi5hcHBlbmQoIikgciIpOwogICAgICAgIGlmIChl\nbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBXSEVSRSBST1dOVU0gPD0gIikuYXBwZW5kVmFsdWUoZW5kKTsKICAgICAg\nICBidWYuYXBwZW5kKCIpIFdIRVJFIFJOVU0gPiAiKS5hcHBlbmRWYWx1ZShz\ndGFydCk7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0cnVlIGlmIHRoZSBzZWxlY3Qgd2l0aCB0aGUgZ2l2ZW4g\ncGFyYW1ldGVycyBuZWVkcyBhCiAgICAgKiBzdWJzZWxlY3QgdG8gYXBwbHkg\nYSByYW5nZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHJlcXVpcmVz\nU3Vic2VsZWN0Rm9yUmFuZ2UobG9uZyBzdGFydCwgbG9uZyBlbmQsCiAgICAg\nICAgYm9vbGVhbiBkaXN0aW5jdCwgU1FMQnVmZmVyIG9yZGVyKSB7CiAgICAg\nICAgaWYgKHN0YXJ0ID09IDAgJiYgZW5kID09IExvbmcuTUFYX1ZBTFVFKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHN0YXJ0\nICE9IDAgfHwgZGlzdGluY3QgfHwgKG9yZGVyICE9IG51bGwgJiYgIW9yZGVy\nLmlzRW1wdHkoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0byBz\nZWUgaWYgd2UgaGF2ZSBzZXQgdGhlIHtAbGluayAjU0VMRUNUX0hJTlR9IGlu\nIHRoZQogICAgICogZmV0Y2ggY29uZmlndXJhaXRvbiwgYW5kIGlmIHNvLCBh\ncHBlbmQgdGhlIE9yYWNoZSBoaW50IGFmdGVyIHRoZQogICAgICogIlNFTEVD\nVCIgcGFydCBvZiB0aGUgcXVlcnkuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0U2VsZWN0T3BlcmF0aW9uKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gpIHsKICAgICAgICBPYmplY3QgaGludCA9IGZldGNoID09IG51bGwg\nPyBudWxsIDogZmV0Y2guZ2V0SGludChTRUxFQ1RfSElOVCk7CiAgICAgICAg\nU3RyaW5nIHNlbGVjdCA9ICJTRUxFQ1QiOwogICAgICAgIGlmIChoaW50ICE9\nIG51bGwpCiAgICAgICAgICAgIHNlbGVjdCArPSAiICIgKyBoaW50OwogICAg\nICAgIHJldHVybiBzZWxlY3Q7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nU3RyaW5nKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBTdHJp\nbmcgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gb3JhY2xlIE5DSEFSL05WQVJDSEFS\nL05DTE9CIHVuaWNvZGUgY29sdW1ucyByZXF1aXJlIHNvbWUKICAgICAgICAv\nLyBzcGVjaWFsIGhhbmRsaW5nIHRvIGNvbmZpZ3VyZSB0aGVtIGNvcnJlY3Rs\neTsgc2VlOgogICAgICAgIC8vIGh0dHA6Ly93d3cub3JhY2xlLmNvbS90ZWNo\nbm9sb2d5L3NhbXBsZV9jb2RlL3RlY2gvamF2YS8KICAgICAgICAvLyBzcWxq\nX2pkYmMvZmlsZXMvOWlfamRiYy9OQ0hBUnN1cHBvcnQ0VW5pY29kZVNhbXBs\nZS9SZWFkbWUuaHRtbAogICAgICAgIFN0cmluZyB0eXBlTmFtZSA9IChjb2wg\nPT0gbnVsbCkgPyBudWxsIDogY29sLmdldFR5cGVOYW1lKCk7CiAgICAgICAg\naWYgKHVzZVNldEZvcm1PZlVzZUZvclVuaWNvZGUgJiYgdHlwZU5hbWUgIT0g\nbnVsbCAmJgogICAgICAgICAgICAodHlwZU5hbWUudG9Mb3dlckNhc2UoKS5z\ndGFydHNXaXRoKCJudmFyY2hhciIpIHx8CiAgICAgICAgICAgICAgICB0eXBl\nTmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoIm5jaGFyIikgfHwKICAg\nICAgICAgICAgICAgIHR5cGVOYW1lLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0\naCgibmNsb2IiKSkpIHsKICAgICAgICAgICAgU3RhdGVtZW50IGlubmVyID0g\nc3RtbnQ7CiAgICAgICAgICAgIGlmIChpbm5lciBpbnN0YW5jZW9mIERlbGVn\nYXRpbmdQcmVwYXJlZFN0YXRlbWVudCkKICAgICAgICAgICAgICAgIGlubmVy\nID0gKChEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQpIGlubmVyKS4KICAg\nICAgICAgICAgICAgICAgICBnZXRJbm5lcm1vc3REZWxlZ2F0ZSgpOwogICAg\nICAgICAgICBpZiAoaXNPcmFjbGVQcmVwYXJlZFN0YXRlbWVudChpbm5lcikp\nIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\naW5uZXIuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInNldEZvcm1PZlVzZSIsCiAg\nICAgICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3Ms\nIHNob3J0LmNsYXNzIH0pLgogICAgICAgICAgICAgICAgICAgICAgICBpbnZv\na2UoaW5uZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElu\ndGVnZXIoaWR4KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBD\nbGFzcy5mb3JOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICgib3JhY2xlLmpkYmMuT3JhY2xlUHJlcGFyZWRTdGF0ZW1lbnQiKS4K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RmllbGQo\nIkZPUk1fTkNIQVIiKS5nZXQobnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2FybihlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICghX3dhcm5lZE5j\naGFyQ29sdW1uICYmIGxvZy5pc1dhcm5FbmFibGVkKCkpIHsKICAgICAgICAg\nICAgICAgIF93YXJuZWROY2hhckNvbHVtbiA9IHRydWU7CiAgICAgICAgICAg\nICAgICBsb2cud2FybihfbG9jLmdldCgidW5jb25maWd1cmVkLW5jaGFyLWNv\nbHMiKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNh\nbGwgc2V0Rml4ZWRDSEFSIGZvciBmaXhlZCB3aWR0aCBjaGFyYWN0ZXIgY29s\ndW1ucyB0byBnZXQgcGFkZGluZwogICAgICAgIC8vIHNlbWFudGljcwogICAg\nICAgIGlmIChjb2wgIT0gbnVsbCAmJiBjb2wuZ2V0VHlwZSgpID09IFR5cGVz\nLkNIQVIKICAgICAgICAgICAgJiYgdmFsICE9IG51bGwgJiYgdmFsLmxlbmd0\naCgpICE9IGNvbC5nZXRTaXplKCkpIHsKICAgICAgICAgICAgU3RhdGVtZW50\nIGlubmVyID0gc3RtbnQ7CiAgICAgICAgICAgIGlmIChpbm5lciBpbnN0YW5j\nZW9mIERlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudCkKICAgICAgICAgICAg\nICAgIGlubmVyID0gKChEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQpIGlu\nbmVyKS4KICAgICAgICAgICAgICAgICAgICBnZXRJbm5lcm1vc3REZWxlZ2F0\nZSgpOwogICAgICAgICAgICBpZiAoaXNPcmFjbGVQcmVwYXJlZFN0YXRlbWVu\ndChpbm5lcikpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgaW5uZXIuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInNldEZpeGVk\nQ0hBUiIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBp\nbnQuY2xhc3MsIFN0cmluZy5jbGFzcyB9KS4KICAgICAgICAgICAgICAgICAg\nICAgICAgaW52b2tlKGlubmVyLCBuZXcgT2JqZWN0W117IG5ldyBJbnRlZ2Vy\nKGlkeCksIHZhbCB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgICAgIGxvZy53YXJuKGUpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIV93YXJuZWRDaGFyQ29s\ndW1uICYmIGxvZy5pc1dhcm5FbmFibGVkKCkpIHsKICAgICAgICAgICAgICAg\nIF93YXJuZWRDaGFyQ29sdW1uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxv\nZy53YXJuKF9sb2MuZ2V0KCJ1bnBhZGRlZC1jaGFyLWNvbHMiKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3VwZXIuc2V0U3RyaW5nKHN0\nbW50LCBpZHgsIHZhbCwgY29sKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXROdWxsKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBpbnQg\nY29sVHlwZSwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjb2xUeXBlID09IFR5cGVzLkJM\nT0IgJiYgX2RyaXZlckJlaGF2aW9yID09IEJFSEFWRV9PUkFDTEUpCiAgICAg\nICAgICAgIHN0bW50LnNldEJsb2IoaWR4LCBnZXRFbXB0eUJsb2IoKSk7CiAg\nICAgICAgZWxzZSBpZiAoY29sVHlwZSA9PSBUeXBlcy5DTE9CICYmIF9kcml2\nZXJCZWhhdmlvciA9PSBCRUhBVkVfT1JBQ0xFCiAgICAgICAgICAgICYmICFj\nb2wuaXNYTUwoKSkKICAgICAgICAgICAgc3RtbnQuc2V0Q2xvYihpZHgsIGdl\ndEVtcHR5Q2xvYigpKTsKICAgICAgICBlbHNlIGlmICgoY29sVHlwZSA9PSBU\neXBlcy5TVFJVQ1QgfHwgY29sVHlwZSA9PSBUeXBlcy5PVEhFUikKICAgICAg\nICAgICAgJiYgY29sICE9IG51bGwgJiYgY29sLmdldFR5cGVOYW1lKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgc3RtbnQuc2V0TnVsbChpZHgsIFR5cGVzLlNU\nUlVDVCwgY29sLmdldFR5cGVOYW1lKCkpOwogICAgICAgICAgICAvLyBzb21l\nIHZlcnNpb25zIG9mIHRoZSBPcmFjbGUgSkRCQyBkcml2ZXIgd2lsbCBmYWls\nIGlmIGNhbGxpbmcKICAgICAgICAgICAgLy8gc2V0TnVsbCB3aXRoIERBVEU7\nIHNlZSBidWcgIzExNzEKICAgICAgICBlbHNlIGlmIChjb2xUeXBlID09IFR5\ncGVzLkRBVEUpCiAgICAgICAgICAgIHN1cGVyLnNldE51bGwoc3RtbnQsIGlk\neCwgVHlwZXMuVElNRVNUQU1QLCBjb2wpOwogICAgICAgIC8vIHRoZSBPcmFj\nbGUgZHJpdmVyIGRvZXMgbm90IHN1cHBvcnQgVHlwZXMuT1RIRVIgd2l0aCBz\nZXROdWxsCiAgICAgICAgZWxzZSBpZiAoY29sVHlwZSA9PSBUeXBlcy5PVEhF\nUiB8fCBjb2wuaXNYTUwoKSkKICAgICAgICAgICAgc3VwZXIuc2V0TnVsbChz\ndG1udCwgaWR4LCBUeXBlcy5OVUxMLCBjb2wpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgc3VwZXIuc2V0TnVsbChzdG1udCwgaWR4LCBjb2xUeXBlLCBj\nb2wpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2xvYlN0cmluZyhS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKF9kcml2ZXJCZWhhdmlvciAhPSBCRUhB\nVkVfT1JBQ0xFKQogICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0Q2xvYlN0\ncmluZyhycywgY29sdW1uKTsKCiAgICAgICAgQ2xvYiBjbG9iID0gZ2V0Q2xv\nYihycywgY29sdW1uKTsKICAgICAgICBpZiAoY2xvYiA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoY2xvYi5nZXRDbGFz\ncygpLmdldE5hbWUoKS5lcXVhbHMoIm9yYWNsZS5zcWwuQ0xPQiIpKSB7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoKChCb29sZWFu\nKSBDbGFzcy5mb3JOYW1lKCJvcmFjbGUuc3FsLkNMT0IiKS4KICAgICAgICAg\nICAgICAgICAgICBnZXRNZXRob2QoImlzRW1wdHlMb2IiLCBuZXcgQ2xhc3Nb\nMF0pLgogICAgICAgICAgICAgICAgICAgIGludm9rZShjbG9iLCBuZXcgT2Jq\nZWN0WzBdKSkuCiAgICAgICAgICAgICAgICAgICAgYm9vbGVhblZhbHVlKCkp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAvLyBw\nb3NzaWJseSBkaWZmZXJlbnQgdmVyc2lvbiBvZiB0aGUgZHJpdmVyCiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNsb2IubGVuZ3RoKCkg\nPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIHVu\nbGlrZWx5IHRoYXQgd2UnbGwgaGF2ZSBzdHJpbmdzIG92ZXIgNCBiaWxsaW9u\nIGNoYXJzCiAgICAgICAgcmV0dXJuIGNsb2IuZ2V0U3ViU3RyaW5nKDEsIChp\nbnQpIGNsb2IubGVuZ3RoKCkpOwogICAgfQoKICAgIHB1YmxpYyBUaW1lc3Rh\nbXAgZ2V0VGltZXN0YW1wKFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgQ2Fs\nZW5kYXIgY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmIChjYWwgPT0gbnVsbCkgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFRpbWVzdGFtcChycywgY29s\ndW1uLCBjYWwpOwogICAgICAgICAgICB9IGNhdGNoIChBcnJheUluZGV4T3V0\nT2ZCb3VuZHNFeGNlcHRpb24gYWUpIHsKICAgICAgICAgICAgICAgIC8vIENS\nMjk1NjA0OiBpc3N1ZSBhIHdhcm5pbmcgdGhpcyB0aGlzIGJ1ZyBjYW4gYmUg\nZ290dGVuCiAgICAgICAgICAgICAgICAvLyBhcm91bmQgd2l0aCBTdXBwb3J0\nc1RpbWVzdGFtcE5hbm9zPWZhbHNlCiAgICAgICAgICAgICAgICBsb2cud2Fy\nbihfbG9jLmdldCgib3JhY2xlLXRpbWVzdGFtcC1idWciKSwgYWUpOwogICAg\nICAgICAgICAgICAgdGhyb3cgYWU7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIC8vIGhhbmRsZSBPcmFjbGUgYnVnIHdoZXJlIG5hbm9zIG5v\ndCByZXR1cm5lZCBmcm9tIGNhbGwgd2l0aCBDYWxlbmRhcgogICAgICAgIC8v\nIHBhcmFtZXRlcgogICAgICAgIFRpbWVzdGFtcCB0cyA9IHJzLmdldFRpbWVz\ndGFtcChjb2x1bW4sIGNhbCk7CiAgICAgICAgaWYgKHRzICE9IG51bGwgJiYg\ndHMuZ2V0TmFub3MoKSA9PSAwKQogICAgICAgICAgICB0cy5zZXROYW5vcyhy\ncy5nZXRUaW1lc3RhbXAoY29sdW1uKS5nZXROYW5vcygpKTsKICAgICAgICBy\nZXR1cm4gdHM7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRPYmplY3Qo\nUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBNYXAgbWFwKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIHJlY2VudCBvcmFjbGUg\nZHJpdmVycyByZXR1cm4gb3JhY2xlLXNwZWNpZmljIHR5cGVzIGZvciB0aW1l\nc3RhbXBzCiAgICAgICAgLy8gYW5kIGRhdGVzCiAgICAgICAgT2JqZWN0IG9i\naiA9IHN1cGVyLmdldE9iamVjdChycywgY29sdW1uLCBtYXApOwogICAgICAg\nIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgaWYgKCJvcmFjbGUuc3FsLkRBVEUiLmVxdWFscyhvYmouZ2V0Q2xh\nc3MoKS5nZXROYW1lKCkpKQogICAgICAgICAgICBvYmogPSBjb252ZXJ0RnJv\nbU9yYWNsZVR5cGUob2JqLCAiZGF0ZVZhbHVlIik7CiAgICAgICAgZWxzZSBp\nZiAoIm9yYWNsZS5zcWwuVElNRVNUQU1QIi5lcXVhbHMob2JqLmdldENsYXNz\nKCkuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgb2JqID0gY29udmVydEZyb21P\ncmFjbGVUeXBlKG9iaiwgInRpbWVzdGFtcFZhbHVlIik7CiAgICAgICAgcmV0\ndXJuIG9iajsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgYW4gb2Jq\nZWN0IGZyb20gaXRzIHByb3ByaWV0YXJ5IE9yYWNsZSB0eXBlIHRvIHRoZSBz\ndGFuZGFyZAogICAgICogSmF2YSB0eXBlLgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBPYmplY3QgY29udmVydEZyb21PcmFjbGVUeXBlKE9iamVjdCBv\nYmosCiAgICAgICAgU3RyaW5nIGNvbnZlcnRNZXRob2QpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nTWV0aG9kIG0gPSBvYmouZ2V0Q2xhc3MoKS5nZXRNZXRob2QoY29udmVydE1l\ndGhvZCwgKENsYXNzW10pIG51bGwpOwogICAgICAgICAgICByZXR1cm4gbS5p\nbnZva2Uob2JqLCAoT2JqZWN0W10pIG51bGwpOwogICAgICAgIH0gY2F0Y2gg\nKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIGlmICh0IGluc3RhbmNlb2Yg\nSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIHQg\nPSAoKEludm9jYXRpb25UYXJnZXRFeGNlcHRpb24pIHQpLmdldFRhcmdldEV4\nY2VwdGlvbigpOwogICAgICAgICAgICBpZiAodCBpbnN0YW5jZW9mIFNRTEV4\nY2VwdGlvbikKICAgICAgICAgICAgICAgIHRocm93KFNRTEV4Y2VwdGlvbikg\ndDsKICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlvbih0LmdldE1l\nc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDb2x1bW5b\nXSBnZXRDb2x1bW5zKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNh\ndGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJs\nZU5hbWUsIFN0cmluZyBjb2x1bW5OYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uW10g\nY29scyA9IHN1cGVyLmdldENvbHVtbnMobWV0YSwgY2F0YWxvZywgc2NoZW1h\nTmFtZSwgdGFibGVOYW1lLAogICAgICAgICAgICBjb2x1bW5OYW1lLCBjb25u\nKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNvbHMgIT0gbnVsbCAmJiBp\nIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY29sc1tp\nXS5nZXRUeXBlTmFtZSgpID09IG51bGwpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgaWYgKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKS50\nb1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIlRJTUVTVEFNUCIpKQogICAgICAg\nICAgICAgICAgY29sc1tpXS5zZXRUeXBlKFR5cGVzLlRJTUVTVEFNUCk7CiAg\nICAgICAgICAgIGVsc2UgaWYgKCJCTE9CIi5lcXVhbHNJZ25vcmVDYXNlKGNv\nbHNbaV0uZ2V0VHlwZU5hbWUoKSkpCiAgICAgICAgICAgICAgICBjb2xzW2ld\nLnNldFR5cGUoVHlwZXMuQkxPQik7CiAgICAgICAgICAgIGVsc2UgaWYgKCJD\nTE9CIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKSkK\nICAgICAgICAgICAgICAgIHx8ICJOQ0xPQiIuZXF1YWxzSWdub3JlQ2FzZShj\nb2xzW2ldLmdldFR5cGVOYW1lKCkpKQogICAgICAgICAgICAgICAgY29sc1tp\nXS5zZXRUeXBlKFR5cGVzLkNMT0IpOwogICAgICAgICAgICBlbHNlIGlmICgi\nRkxPQVQiLmVxdWFsc0lnbm9yZUNhc2UoY29sc1tpXS5nZXRUeXBlTmFtZSgp\nKSkKICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5GTE9B\nVCk7CiAgICAgICAgICAgIGVsc2UgaWYgKCJOVkFSQ0hBUiIuZXF1YWxzSWdu\nb3JlQ2FzZShjb2xzW2ldLmdldFR5cGVOYW1lKCkpKQogICAgICAgICAgICAg\nICAgY29sc1tpXS5zZXRUeXBlKFR5cGVzLlZBUkNIQVIpOwogICAgICAgICAg\nICBlbHNlIGlmICgiTkNIQVIiLmVxdWFsc0lnbm9yZUNhc2UoY29sc1tpXS5n\nZXRUeXBlTmFtZSgpKSkKICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlw\nZShUeXBlcy5DSEFSKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbHM7\nCiAgICB9CgogICAgcHVibGljIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5\ncyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsCiAgICAgICAgU3RyaW5nIGNhdGFs\nb2csIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25u\nZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsK\nICAgICAgICBidWYuYXBwZW5kKCJTRUxFQ1QgdDAuT1dORVIgQVMgVEFCTEVf\nU0NIRU0sICIpLgogICAgICAgICAgICBhcHBlbmQoInQwLlRBQkxFX05BTUUg\nQVMgVEFCTEVfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuQ09M\nVU1OX05BTUUgQVMgQ09MVU1OX05BTUUsICIpLgogICAgICAgICAgICBhcHBl\nbmQoInQwLkNPTlNUUkFJTlRfTkFNRSBBUyBQS19OQU1FICIpLgogICAgICAg\nICAgICBhcHBlbmQoIkZST00gQUxMX0NPTlNfQ09MVU1OUyB0MCwgQUxMX0NP\nTlNUUkFJTlRTIHQxICIpLgogICAgICAgICAgICBhcHBlbmQoIldIRVJFIHQw\nLk9XTkVSID0gdDEuT1dORVIgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5E\nIHQwLkNPTlNUUkFJTlRfTkFNRSA9IHQxLkNPTlNUUkFJTlRfTkFNRSAiKS4K\nICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDEuQ09OU1RSQUlOVF9UWVBFID0g\nJ1AnIik7CiAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiIEFORCB0MC5PV05FUiA9ID8iKTsKICAgICAg\nICBpZiAodGFibGVOYW1lICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBBTkQgdDAuVEFCTEVfTkFNRSA9ID8iKTsKCiAgICAgICAgUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoYnVm\nLnRvU3RyaW5nKCkpOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGlkeCA9IDE7CiAgICAgICAg\nICAgIGlmIChzY2hlbWFOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBz\nZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCBzY2hlbWFOYW1lLnRvVXBwZXJDYXNl\nKCksIG51bGwpOwogICAgICAgICAgICBpZiAodGFibGVOYW1lICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCB0YWJs\nZU5hbWUudG9VcHBlckNhc2UoKSwgbnVsbCk7CgogICAgICAgICAgICBycyA9\nIHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAgICAgICBMaXN0IHBrTGlz\ndCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHJzICE9\nIG51bGwgJiYgcnMubmV4dCgpKQogICAgICAgICAgICAgICAgcGtMaXN0LmFk\nZChuZXdQcmltYXJ5S2V5KHJzKSk7CiAgICAgICAgICAgIHJldHVybiAoUHJp\nbWFyeUtleVtdKSBwa0xpc3QudG9BcnJheQogICAgICAgICAgICAgICAgKG5l\ndyBQcmltYXJ5S2V5W3BrTGlzdC5zaXplKCldKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBpZiAocnMgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcnMuY2xvc2UoKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBz\ndG1udC5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBJbmRleFtdIGdldEluZGV4SW5mbyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEs\nIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBT\ndHJpbmcgdGFibGVOYW1lLCBib29sZWFuIHVuaXF1ZSwgYm9vbGVhbiBhcHBy\nb3gsCiAgICAgICAgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcg\nU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiU0VMRUNUIHQw\nLklOREVYX09XTkVSIEFTIFRBQkxFX1NDSEVNLCAiKS4KICAgICAgICAgICAg\nYXBwZW5kKCJ0MC5UQUJMRV9OQU1FIEFTIFRBQkxFX05BTUUsICIpLgogICAg\nICAgICAgICBhcHBlbmQoIkRFQ09ERSh0MS5VTklRVUVORVNTLCAnVU5JUVVF\nJywgMCwgJ05PTlVOSVFVRScsIDEpICIpLgogICAgICAgICAgICBhcHBlbmQo\nIkFTIE5PTl9VTklRVUUsICIpLgogICAgICAgICAgICBhcHBlbmQoInQwLklO\nREVYX05BTUUgQVMgSU5ERVhfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVu\nZCgidDAuQ09MVU1OX05BTUUgQVMgQ09MVU1OX05BTUUgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgiRlJPTSBBTExfSU5EX0NPTFVNTlMgdDAsIEFMTF9JTkRF\nWEVTIHQxICIpLgogICAgICAgICAgICBhcHBlbmQoIldIRVJFIHQwLklOREVY\nX09XTkVSID0gdDEuT1dORVIgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5E\nIHQwLklOREVYX05BTUUgPSB0MS5JTkRFWF9OQU1FIik7CiAgICAgICAgaWYg\nKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nIEFORCB0MC5UQUJMRV9PV05FUiA9ID8iKTsKICAgICAgICBpZiAodGFibGVO\nYW1lICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgdDAu\nVEFCTEVfTkFNRSA9ID8iKTsKCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoYnVmLnRvU3RyaW5nKCkp\nOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaW50IGlkeCA9IDE7CiAgICAgICAgICAgIGlmIChzY2hl\nbWFOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3Rt\nbnQsIGlkeCsrLCBzY2hlbWFOYW1lLnRvVXBwZXJDYXNlKCksIG51bGwpOwog\nICAgICAgICAgICBpZiAodGFibGVOYW1lICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCB0YWJsZU5hbWUudG9VcHBl\nckNhc2UoKSwgbnVsbCk7CgogICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1\ndGVRdWVyeSgpOwogICAgICAgICAgICBMaXN0IGlkeExpc3QgPSBuZXcgQXJy\nYXlMaXN0KCk7CiAgICAgICAgICAgIHdoaWxlIChycyAhPSBudWxsICYmIHJz\nLm5leHQoKSkKICAgICAgICAgICAgICAgIGlkeExpc3QuYWRkKG5ld0luZGV4\nKHJzKSk7CiAgICAgICAgICAgIHJldHVybiAoSW5kZXhbXSkgaWR4TGlzdC50\nb0FycmF5KG5ldyBJbmRleFtpZHhMaXN0LnNpemUoKV0pOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBycy5jbG9zZSgp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIHN0bW50LmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIEZvcmVpZ25LZXlbXSBnZXRJbXBvcnRlZEtleXMoRGF0YWJhc2VN\nZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcg\nc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25u\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmlu\nZ0J1ZmZlciBkZWxBY3Rpb24gPSBuZXcgU3RyaW5nQnVmZmVyKCJERUNPREUo\ndDEuREVMRVRFX1JVTEUiKS4KICAgICAgICAgICAgYXBwZW5kKCIsICdOTyBB\nQ1RJT04nLCAiKS5hcHBlbmQobWV0YS5pbXBvcnRlZEtleU5vQWN0aW9uKS4K\nICAgICAgICAgICAgYXBwZW5kKCIsICdSRVNUUklDVCcsICIpLmFwcGVuZCht\nZXRhLmltcG9ydGVkS2V5UmVzdHJpY3QpLgogICAgICAgICAgICBhcHBlbmQo\nIiwgJ0NBU0NBREUnLCAiKS5hcHBlbmQobWV0YS5pbXBvcnRlZEtleUNhc2Nh\nZGUpLgogICAgICAgICAgICBhcHBlbmQoIiwgJ1NFVCBOVUxMJywgIikuYXBw\nZW5kKG1ldGEuaW1wb3J0ZWRLZXlTZXROdWxsKS4KICAgICAgICAgICAgYXBw\nZW5kKCIsICdTRVQgREVGQVVMVCcsICIpLmFwcGVuZChtZXRhLmltcG9ydGVk\nS2V5U2V0RGVmYXVsdCkuCiAgICAgICAgICAgIGFwcGVuZCgiKSIpOwoKICAg\nICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwog\nICAgICAgIGJ1Zi5hcHBlbmQoIlNFTEVDVCB0Mi5PV05FUiBBUyBQS1RBQkxF\nX1NDSEVNLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0Mi5UQUJMRV9OQU1F\nIEFTIFBLVEFCTEVfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDIu\nQ09MVU1OX05BTUUgQVMgUEtDT0xVTU5fTkFNRSwgIikuCiAgICAgICAgICAg\nIGFwcGVuZCgidDAuT1dORVIgQVMgRktUQUJMRV9TQ0hFTSwgIikuCiAgICAg\nICAgICAgIGFwcGVuZCgidDAuVEFCTEVfTkFNRSBBUyBGS1RBQkxFX05BTUUs\nICIpLgogICAgICAgICAgICBhcHBlbmQoInQwLkNPTFVNTl9OQU1FIEFTIEZL\nQ09MVU1OX05BTUUsICIpLgogICAgICAgICAgICBhcHBlbmQoInQwLlBPU0lU\nSU9OIEFTIEtFWV9TRVEsICIpLgogICAgICAgICAgICBhcHBlbmQoZGVsQWN0\naW9uKS5hcHBlbmQoIiBBUyBERUxFVEVfUlVMRSwgIikuCiAgICAgICAgICAg\nIGFwcGVuZCgidDAuQ09OU1RSQUlOVF9OQU1FIEFTIEZLX05BTUUsICIpLgog\nICAgICAgICAgICBhcHBlbmQoIkRFQ09ERSh0MS5ERUZFUlJFRCwgJ0RFRkVS\nUkVEJywgIikuCiAgICAgICAgICAgIGFwcGVuZChtZXRhLmltcG9ydGVkS2V5\nSW5pdGlhbGx5RGVmZXJyZWQpLgogICAgICAgICAgICBhcHBlbmQoIiwgJ0lN\nTUVESUFURScsICIpLgogICAgICAgICAgICBhcHBlbmQobWV0YS5pbXBvcnRl\nZEtleUluaXRpYWxseUltbWVkaWF0ZSkuCiAgICAgICAgICAgIGFwcGVuZCgi\nKSBBUyBERUZFUlJBQklMSVRZICIpLgogICAgICAgICAgICBhcHBlbmQoIkZS\nT00gQUxMX0NPTlNfQ09MVU1OUyB0MCwgQUxMX0NPTlNUUkFJTlRTIHQxLCAi\nKS4KICAgICAgICAgICAgYXBwZW5kKCJBTExfQ09OU19DT0xVTU5TIHQyICIp\nLgogICAgICAgICAgICBhcHBlbmQoIldIRVJFIHQwLk9XTkVSID0gdDEuT1dO\nRVIgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5EIHQwLkNPTlNUUkFJTlRf\nTkFNRSA9IHQxLkNPTlNUUkFJTlRfTkFNRSAiKS4KICAgICAgICAgICAgYXBw\nZW5kKCJBTkQgdDEuQ09OU1RSQUlOVF9UWVBFID0gJ1InICIpLgogICAgICAg\nICAgICBhcHBlbmQoIkFORCB0MS5SX09XTkVSID0gdDIuT1dORVIgIikuCiAg\nICAgICAgICAgIGFwcGVuZCgiQU5EIHQxLlJfQ09OU1RSQUlOVF9OQU1FID0g\ndDIuQ09OU1RSQUlOVF9OQU1FICIpLgogICAgICAgICAgICBhcHBlbmQoIkFO\nRCB0MC5QT1NJVElPTiA9IHQyLlBPU0lUSU9OIik7CiAgICAgICAgaWYgKHNj\naGVtYU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFO\nRCB0MC5PV05FUiA9ID8iKTsKICAgICAgICBpZiAodGFibGVOYW1lICE9IG51\nbGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgdDAuVEFCTEVfTkFN\nRSA9ID8iKTsKICAgICAgICBidWYuYXBwZW5kKCIgT1JERVIgQlkgdDIuT1dO\nRVIsIHQyLlRBQkxFX05BTUUsIHQwLlBPU0lUSU9OIik7CgogICAgICAgIFBy\nZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gY29ubi5wcmVwYXJlU3RhdGVtZW50\nKGJ1Zi50b1N0cmluZygpKTsKICAgICAgICBSZXN1bHRTZXQgcnMgPSBudWxs\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGludCBpZHggPSAxOwogICAg\nICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgc2V0U3RyaW5nKHN0bW50LCBpZHgrKywgc2NoZW1hTmFtZS50b1VwcGVy\nQ2FzZSgpLCBudWxsKTsKICAgICAgICAgICAgaWYgKHRhYmxlTmFtZSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgrKywg\ndGFibGVOYW1lLnRvVXBwZXJDYXNlKCksIG51bGwpOwoKICAgICAgICAgICAg\ncnMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAgICAgICAgICAgTGlzdCBm\na0xpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIHdoaWxlIChy\ncyAhPSBudWxsICYmIHJzLm5leHQoKSkKICAgICAgICAgICAgICAgIGZrTGlz\ndC5hZGQobmV3Rm9yZWlnbktleShycykpOwogICAgICAgICAgICByZXR1cm4g\nKEZvcmVpZ25LZXlbXSkgZmtMaXN0LnRvQXJyYXkKICAgICAgICAgICAgICAg\nIChuZXcgRm9yZWlnbktleVtma0xpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9IG51bGwpCiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJzLmNsb3NlKCk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVTUUwoVGFibGUgdGFibGUp\nIHsKICAgICAgICAvLyBvbmx5IG92ZXJyaWRlIGlmIHdlIGFyZSBzaW11bGF0\naW5nIGF1dG8taW5jcmVtZW5ldCB3aXRoIHRyaWdnZXJzCiAgICAgICAgU3Ry\naW5nW10gY3JlYXRlID0gc3VwZXIuZ2V0Q3JlYXRlVGFibGVTUUwodGFibGUp\nOwogICAgICAgIGlmICghdXNlVHJpZ2dlcnNGb3JBdXRvQXNzaWduKQogICAg\nICAgICAgICByZXR1cm4gY3JlYXRlOwoKICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gdGFibGUuZ2V0Q29sdW1ucygpOwogICAgICAgIExpc3Qgc2VxcyA9IG51\nbGw7CiAgICAgICAgU3RyaW5nIHNlcSwgdHJpZzsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgY29scyAhPSBudWxsICYmIGkgPCBjb2xzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmICghY29sc1tpXS5pc0F1dG9Bc3NpZ25lZCgp\nKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGlmIChz\nZXFzID09IG51bGwpCiAgICAgICAgICAgICAgICBzZXFzID0gbmV3IEFycmF5\nTGlzdCg0KTsKCiAgICAgICAgICAgIHNlcSA9IGF1dG9Bc3NpZ25TZXF1ZW5j\nZU5hbWU7CiAgICAgICAgICAgIGlmIChzZXEgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaWYgKG9wZW5qcGEzR2VuZXJhdGVkS2V5TmFtZXMpCiAgICAg\nICAgICAgICAgICAgICAgc2VxID0gZ2V0T3BlbkpQQTNHZW5lcmF0ZWRLZXlT\nZXF1ZW5jZU5hbWUoY29sc1tpXSk7CiAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgc2VxID0gZ2V0R2VuZXJhdGVkS2V5U2VxdWVu\nY2VOYW1lKGNvbHNbaV0pOwogICAgICAgICAgICAgICAgc2Vxcy5hZGQoIkNS\nRUFURSBTRVFVRU5DRSAiICsgc2VxICsgIiBTVEFSVCBXSVRIIDEiKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAob3BlbmpwYTNHZW5lcmF0ZWRL\nZXlOYW1lcykKICAgICAgICAgICAgICAgIHRyaWcgPSBnZXRPcGVuSlBBM0dl\nbmVyYXRlZEtleVRyaWdnZXJOYW1lKGNvbHNbaV0pOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICB0cmlnID0gZ2V0R2VuZXJhdGVkS2V5VHJp\nZ2dlck5hbWUoY29sc1tpXSk7CgogICAgICAgICAgICAvLyBjcmVhdGUgdGhl\nIHRyaWdnZXIgdGhhdCB3aWxsIGluc2VydCBuZXcgdmFsdWVzIGludG8KICAg\nICAgICAgICAgLy8gdGhlIHRhYmxlIHdoZW5ldmVyIGEgcm93IGlzIGNyZWF0\nZWQKICAgICAgICAgICAgc2Vxcy5hZGQoIkNSRUFURSBPUiBSRVBMQUNFIFRS\nSUdHRVIgIiArIHRyaWcKICAgICAgICAgICAgICAgICsgIiBCRUZPUkUgSU5T\nRVJUIE9OICIgKyB0YWJsZS5nZXROYW1lKCkKICAgICAgICAgICAgICAgICsg\nIiBGT1IgRUFDSCBST1cgQkVHSU4gU0VMRUNUICIgKyBzZXEgKyAiLm5leHR2\nYWwgSU5UTyAiCiAgICAgICAgICAgICAgICArICI6bmV3LiIgKyBjb2xzW2ld\nLmdldE5hbWUoKSArICIgRlJPTSBEVUFMOyAiCiAgICAgICAgICAgICAgICAr\nICJFTkQgIiArIHRyaWcgKyAiOyIpOwogICAgICAgIH0KICAgICAgICBpZiAo\nc2VxcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gY3JlYXRlOwoKICAg\nICAgICAvLyBjb21iaW5lIGNyZWF0ZSB0YWJsZSBzcWwgYW5kIGNyZWF0ZSBz\nZXFlbmNlcyBzcWwKICAgICAgICBTdHJpbmdbXSBzcWwgPSBuZXcgU3RyaW5n\nW2NyZWF0ZS5sZW5ndGggKyBzZXFzLnNpemUoKV07CiAgICAgICAgU3lzdGVt\nLmFycmF5Y29weShjcmVhdGUsIDAsIHNxbCwgMCwgY3JlYXRlLmxlbmd0aCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZXFzLnNpemUoKTsgaSsr\nKQogICAgICAgICAgICBzcWxbY3JlYXRlLmxlbmd0aCArIGldID0gKFN0cmlu\nZykgc2Vxcy5nZXQoaSk7CiAgICAgICAgcmV0dXJuIHNxbDsKICAgIH0KCiAg\nICBwdWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlU2VxdWVuY2VTUUwoU2VxdWVu\nY2Ugc2VxKSB7CiAgICAgICAgU3RyaW5nW10gc3FsID0gc3VwZXIuZ2V0Q3Jl\nYXRlU2VxdWVuY2VTUUwoc2VxKTsKICAgICAgICBpZiAoc2VxLmdldEFsbG9j\nYXRlKCkgPiAxKQogICAgICAgICAgICBzcWxbMF0gKz0gIiBDQUNIRSAiICsg\nc2VxLmdldEFsbG9jYXRlKCk7CiAgICAgICAgcmV0dXJuIHNxbDsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFNlcXVlbmNlc1NRTChTdHJpbmcg\nc2NoZW1hTmFtZSwgU3RyaW5nIHNlcXVlbmNlTmFtZSkgewogICAgICAgIFN0\ncmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAg\nYnVmLmFwcGVuZCgiU0VMRUNUIFNFUVVFTkNFX09XTkVSIEFTIFNFUVVFTkNF\nX1NDSEVNQSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgiU0VRVUVOQ0VfTkFN\nRSBGUk9NIEFMTF9TRVFVRU5DRVMiKTsKICAgICAgICBpZiAoc2NoZW1hTmFt\nZSAhPSBudWxsIHx8IHNlcXVlbmNlTmFtZSAhPSBudWxsKQogICAgICAgICAg\nICBidWYuYXBwZW5kKCIgV0hFUkUgIik7CiAgICAgICAgaWYgKHNjaGVtYU5h\nbWUgIT0gbnVsbCkgewogICAgICAgICAgICBidWYuYXBwZW5kKCJTRVFVRU5D\nRV9PV05FUiA9ID8iKTsKICAgICAgICAgICAgaWYgKHNlcXVlbmNlTmFtZSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsK\nICAgICAgICB9CiAgICAgICAgaWYgKHNlcXVlbmNlTmFtZSAhPSBudWxsKQog\nICAgICAgICAgICBidWYuYXBwZW5kKCJTRVFVRU5DRV9OQU1FID0gPyIpOwog\nICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc1N5c3RlbVNlcXVlbmNlKFN0cmluZyBuYW1lLCBTdHJp\nbmcgc2NoZW1hLAogICAgICAgIGJvb2xlYW4gdGFyZ2V0U2NoZW1hKSB7CiAg\nICAgICAgaWYgKHN1cGVyLmlzU3lzdGVtU2VxdWVuY2UobmFtZSwgc2NoZW1h\nLCB0YXJnZXRTY2hlbWEpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAg\nICAgICAgLy8gZmlsdGVyIG91dCBnZW5lcmF0ZWQgc2VxdWVuY2VzIHVzZWQg\nZm9yIGF1dG8tYXNzaWduCiAgICAgICAgcmV0dXJuIChhdXRvQXNzaWduU2Vx\ndWVuY2VOYW1lICE9IG51bGwKICAgICAgICAgICAgJiYgbmFtZS5lcXVhbHNJ\nZ25vcmVDYXNlKGF1dG9Bc3NpZ25TZXF1ZW5jZU5hbWUpKQogICAgICAgICAg\nICB8fCAoYXV0b0Fzc2lnblNlcXVlbmNlTmFtZSA9PSBudWxsCiAgICAgICAg\nICAgICYmIG5hbWUudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCJTVF8iKSk7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRHZW5lcmF0ZWRLZXkoQ29s\ndW1uIGNvbCwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmICghdXNlVHJpZ2dlcnNGb3JBdXRvQXNz\naWduKQogICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKDBMKTsK\nCiAgICAgICAgLy8gaWYgd2Ugc2ltdWxhdGUgYXV0by1hc3NpZ25lZCBjb2x1\nbW5zIHVzaW5nIHRyaWdnZXJzIGFuZAogICAgICAgIC8vIHNlcXVlbmNlcywg\ndGhlbiByZXR1cm4gdGhlIGN1cnJlbnQgdmFsdWUgb2YgdGhlIHNlcXVlbmNl\nCiAgICAgICAgLy8gZnJvbSBhdXRvQXNzaWduU2VxdWVuY2VOYW1lCiAgICAg\nICAgU3RyaW5nIHNlcSA9IGF1dG9Bc3NpZ25TZXF1ZW5jZU5hbWU7CiAgICAg\nICAgaWYgKHNlcSA9PSBudWxsICYmIG9wZW5qcGEzR2VuZXJhdGVkS2V5TmFt\nZXMpCiAgICAgICAgICAgIHNlcSA9IGdldE9wZW5KUEEzR2VuZXJhdGVkS2V5\nU2VxdWVuY2VOYW1lKGNvbCk7CiAgICAgICAgZWxzZSBpZiAoc2VxID09IG51\nbGwpCiAgICAgICAgICAgIHNlcSA9IGdldEdlbmVyYXRlZEtleVNlcXVlbmNl\nTmFtZShjb2wpOwogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0g\nY29ubi5wcmVwYXJlU3RhdGVtZW50KCJTRUxFQ1QgIiArIHNlcQogICAgICAg\nICAgICArICIuY3VycnZhbCBGUk9NIERVQUwiKTsKICAgICAgICBSZXN1bHRT\nZXQgcnMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJzID0g\nc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAgIHJzLm5leHQoKTsK\nICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihycy5nZXRMb25n\nKDEpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocnMg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7IHJzLmNsb3NlKCk7IH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICAgICAgdHJ5IHsg\nc3RtbnQuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRyaWdnZXIgbmFtZSBm\nb3Igc2ltdWxhdGluZyBhdXRvLWFzc2lnbiB2YWx1ZXMgb24gdGhlIGdpdmVu\nIGNvbHVtbi4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRHZW5l\ncmF0ZWRLZXlUcmlnZ2VyTmFtZShDb2x1bW4gY29sKSB7CiAgICAgICAgLy8g\ncmVwbGFjZSB0cmFpbGluZyBfU0VRIHdpdGggX1RSRwogICAgICAgIFN0cmlu\nZyBzZXFOYW1lID0gZ2V0R2VuZXJhdGVkS2V5U2VxdWVuY2VOYW1lKGNvbCk7\nCiAgICAgICAgcmV0dXJuIHNlcU5hbWUuc3Vic3RyaW5nKDAsIHNlcU5hbWUu\nbGVuZ3RoKCkgLSAzKSArICJUUkciOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJucyBhIE9wZW5KUEEgMy1jb21wYXRpYmxlIG5hbWUgZm9yIGFuIGF1\ndG8tYXNzaWduIHNlcXVlbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGdldE9wZW5KUEEzR2VuZXJhdGVkS2V5U2VxdWVuY2VOYW1lKENvbHVt\nbiBjb2wpIHsKICAgICAgICBUYWJsZSB0YWJsZSA9IGNvbC5nZXRUYWJsZSgp\nOwogICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKCJTRVFfIiArIHRhYmxl\nLmdldE5hbWUoKSwgdGFibGUuZ2V0U2NoZW1hKCkuCiAgICAgICAgICAgIGdl\ndFNjaGVtYUdyb3VwKCksIG1heFRhYmxlTmFtZUxlbmd0aCwgTkFNRV9BTlkp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhIE9wZW5KUEEgMy1j\nb21wYXRpYmxlIG5hbWUgZm9yIGFuIGF1dG8tYXNzaWduIHRyaWdnZXIuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0T3BlbkpQQTNHZW5lcmF0\nZWRLZXlUcmlnZ2VyTmFtZShDb2x1bW4gY29sKSB7CiAgICAgICAgVGFibGUg\ndGFibGUgPSBjb2wuZ2V0VGFibGUoKTsKICAgICAgICByZXR1cm4gbWFrZU5h\nbWVWYWxpZCgiVFJJR18iICsgdGFibGUuZ2V0TmFtZSgpLCB0YWJsZS5nZXRT\nY2hlbWEoKS4KICAgICAgICAgICAgZ2V0U2NoZW1hR3JvdXAoKSwgbWF4VGFi\nbGVOYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbnZva2UgT3JhY2xlJ3MgPGNvZGU+cHV0Qnl0ZXM8L2NvZGU+IG1ldGhv\nZCBvbiB0aGUgZ2l2ZW4gQkxPQiBvYmplY3QuCiAgICAgKiBVc2VzIHJlZmxl\nY3Rpb24gaW4gY2FzZSB0aGUgYmxvYiBpcyB3cmFwcGVkIGluIGFub3RoZXIK\nICAgICAqIHZlbmRvci1zcGVjaWZpYyBjbGFzczsgZm9yIGV4YW1wbGUgV2Vi\nbG9naWMgd3JhcHMgb3JhY2xlIHRoaW4gZHJpdmVyCiAgICAgKiBsb2JzIGlu\nIGl0cyBvd24gaW50ZXJmYWNlcyB3aXRoIHRoZSBzYW1lIG1ldGhvZHMuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHB1dEJ5dGVzKE9iamVjdCBibG9iLCBi\neXRlW10gZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoYmxvYiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgaWYgKF9wdXRCeXRlcyA9PSBudWxsKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBfcHV0Qnl0ZXMgPSBibG9iLmdldENsYXNz\nKCkuZ2V0TWV0aG9kKCJwdXRCeXRlcyIsCiAgICAgICAgICAgICAgICAgICAg\nbmV3IENsYXNzW117IGxvbmcuY2xhc3MsIGJ5dGVbXS5jbGFzcyB9KTsKICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBpbnZva2VQdXRMb2JNZXRob2QoX3B1dEJ5\ndGVzLCBibG9iLCBkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludm9r\nZSBPcmFjbGUncyA8Y29kZT5wdXRTdHJpbmc8L2NvZGU+IG1ldGhvZCBvbiB0\naGUgZ2l2ZW4gQ0xPQiBvYmplY3QuCiAgICAgKiBVc2VzIHJlZmxlY3Rpb24g\naW4gY2FzZSB0aGUgY2xvYiBpcyB3cmFwcGVkIGluIGFub3RoZXIKICAgICAq\nIHZlbmRvci1zcGVjaWZpYyBjbGFzczsgZm9yIGV4YW1wbGUgV2VibG9naWMg\nd3JhcHMgb3JhY2xlIHRoaW4gZHJpdmVyCiAgICAgKiBsb2JzIGluIGl0cyBv\nd24gaW50ZXJmYWNlcyB3aXRoIHRoZSBzYW1lIG1ldGhvZHMuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHB1dFN0cmluZyhPYmplY3QgY2xvYiwgU3RyaW5n\nIGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKF9wdXRTdHJpbmcgPT0gbnVsbCkgewogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgX3B1dFN0cmluZyA9IGNsb2IuZ2V0Q2xhc3MoKS5n\nZXRNZXRob2QoInB1dFN0cmluZyIsCiAgICAgICAgICAgICAgICAgICAgbmV3\nIENsYXNzW117IGxvbmcuY2xhc3MsIFN0cmluZy5jbGFzcyB9KTsKICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICBpbnZva2VQdXRMb2JNZXRob2QoX3B1dFN0cmlu\nZywgY2xvYiwgZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2Ug\nT3JhY2xlJ3MgPGNvZGU+cHV0Q2hhcnM8L2NvZGU+IG1ldGhvZCBvbiB0aGUg\nZ2l2ZW4gQ0xPQgogICAgICogb2JqZWN0LiBVc2VzIHJlZmxlY3Rpb24gaW4g\nY2FzZSB0aGUgY2xvYiBpcyB3cmFwcGVkIGluIGFub3RoZXIKICAgICAqIHZl\nbmRvci1zcGVjaWZpYyBjbGFzczsgZm9yIGV4YW1wbGUgV2VibG9naWMgd3Jh\ncHMgb3JhY2xlIHRoaW4gZHJpdmVyCiAgICAgKiBsb2JzIGluIGl0cyBvd24g\naW50ZXJmYWNlcyB3aXRoIHRoZSBzYW1lIG1ldGhvZHMuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHB1dENoYXJzKE9iamVjdCBjbG9iLCBjaGFyW10gZGF0\nYSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nX3B1dENoYXJzID09IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIF9wdXRDaGFycyA9IGNsb2IuZ2V0Q2xhc3MoKS5nZXRNZXRo\nb2QoInB1dENoYXJzIiwKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3Nb\nXXsgbG9uZy5jbGFzcywgY2hhcltdLmNsYXNzIH0pOwogICAgICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIGludm9rZVB1dExvYk1ldGhvZChfcHV0Q2hhcnMsIGNsb2Is\nIGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHRoZSBnaXZl\nbiBMT0IgbWV0aG9kIG9uIHRoZSBnaXZlbiB0YXJnZXQgd2l0aCB0aGUgZ2l2\nZW4gZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBpbnZv\na2VQdXRMb2JNZXRob2QoTWV0aG9kIG1ldGhvZCwgT2JqZWN0IHRhcmdldCwK\nICAgICAgICBPYmplY3QgZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBtZXRob2QuaW52b2tl\nKHRhcmdldCwgbmV3IE9iamVjdFtdeyBOdW1iZXJzLnZhbHVlT2YoMUwpLCBk\nYXRhIH0pOwogICAgICAgIH0gY2F0Y2ggKEludm9jYXRpb25UYXJnZXRFeGNl\ncHRpb24gaXRlKSB7CiAgICAgICAgICAgIFRocm93YWJsZSB0ID0gaXRlLmdl\ndFRhcmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICBpZiAodCBpbnN0YW5j\nZW9mIFNRTEV4Y2VwdGlvbikKICAgICAgICAgICAgICAgIHRocm93KFNRTEV4\nY2VwdGlvbikgdDsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0\naW9uKHQpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSBDbG9iIGdldEVtcHR5Q2xvYigpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKEVNUFRZX0NM\nT0IgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0NMT0I7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0NMT0IgPSAo\nQ2xvYikgQ2xhc3MuZm9yTmFtZSgib3JhY2xlLnNxbC5DTE9CIix0cnVlLCAK\nICAgICAgICAgICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLmdldENvbnRleHRDbGFzc0xvYWRlckFjdGlvbigpKSkuCiAgICAgICAg\nICAgICAgICBnZXRNZXRob2QoImVtcHR5X2xvYiIsIG5ldyBDbGFzc1swXSku\nCiAgICAgICAgICAgICAgICBpbnZva2UobnVsbCwgbmV3IE9iamVjdFswXSk7\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFNRTEV4Y2VwdGlvbihlLmdldE1lc3NhZ2UoKSk7CiAgICAg\nICAgfQogICAgfQoKICAgIHByaXZhdGUgQmxvYiBnZXRFbXB0eUJsb2IoKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChFTVBU\nWV9CTE9CICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBFTVBUWV9CTE9C\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBFTVBUWV9CTE9C\nID0gKEJsb2IpIENsYXNzLmZvck5hbWUoIm9yYWNsZS5zcWwuQkxPQiIsdHJ1\nZSwgCiAgICAgICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC5nZXRDb250ZXh0Q2xhc3NMb2FkZXJBY3Rpb24oKSkpLgogICAg\nICAgICAgICAgICAgZ2V0TWV0aG9kKCJlbXB0eV9sb2IiLCBuZXcgQ2xhc3Nb\nMF0pLgogICAgICAgICAgICAgICAgaW52b2tlKG51bGwsIG5ldyBPYmplY3Rb\nMF0pOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBTUUxFeGNlcHRpb24oZS5nZXRNZXNzYWdlKCkpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlz\nT3JhY2xlUHJlcGFyZWRTdGF0ZW1lbnQoU3RhdGVtZW50IHN0bW50KSB7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIENsYXNzLmZvck5hbWUo\nIm9yYWNsZS5qZGJjLk9yYWNsZVByZXBhcmVkU3RhdGVtZW50IikuCiAgICAg\nICAgICAgICAgICBpc0luc3RhbmNlKHN0bW50KTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIElmIHRoaXMgZGlj\ndGlvbmFyeSBzdXBwb3J0cyBYTUwgdHlwZSwKICAgICAqIHVzZSB0aGlzIG1l\ndGhvZCB0byBhcHBlbmQgeG1sIHByZWRpY2F0ZS4KICAgICAqIAogICAgICog\nQHBhcmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUgY29tcGFy\naXNvbgogICAgICogQHBhcmFtIG9wIHRoZSBjb21wYXJpc29uIG9wZXJhdGlv\nbiB0byBwZXJmb3JtCiAgICAgKiBAcGFyYW0gbGhzIHRoZSBsZWZ0IGhhbmQg\nc2lkZSBvZiB0aGUgY29tcGFyaXNvbgogICAgICogQHBhcmFtIHJocyB0aGUg\ncmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGFwcGVuZFhtbENvbXBhcmlzb24oU1FMQnVmZmVyIGJ1\nZiwgU3RyaW5nIG9wLCBGaWx0ZXJWYWx1ZSBsaHMsCiAgICAgICAgRmlsdGVy\nVmFsdWUgcmhzLCBib29sZWFuIGxoc3htbCwgYm9vbGVhbiByaHN4bWwpIHsK\nICAgICAgICBzdXBlci5hcHBlbmRYbWxDb21wYXJpc29uKGJ1Ziwgb3AsIGxo\ncywgcmhzLCBsaHN4bWwsIHJoc3htbCk7CiAgICAgICAgaWYgKGxoc3htbCAm\nJiByaHN4bWwpCiAgICAgICAgICAgIGFwcGVuZFhtbENvbXBhcmlzb24yKGJ1\nZiwgb3AsIGxocywgcmhzKTsKICAgICAgICBlbHNlIGlmIChsaHN4bWwpCiAg\nICAgICAgICAgIGFwcGVuZFhtbENvbXBhcmlzb24xKGJ1Ziwgb3AsIGxocywg\ncmhzKTsKICAgICAgICBlbHNlIAogICAgICAgICAgICBhcHBlbmRYbWxDb21w\nYXJpc29uMShidWYsIG9wLCByaHMsIGxocyk7CiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogQXBwZW5kIGFuIHhtbCBjb21wYXJpc29uIHByZWRpY2F0ZQog\nICAgICoKICAgICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3Jp\ndGUgdGhlIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSBvcCB0aGUgY29tcGFy\naXNvbiBvcGVyYXRpb24gdG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0\naGUgbGVmdCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24gKG1hcHMgdG8g\neG1sIGNvbHVtbikKICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQg\nc2lkZSBvZiB0aGUgY29tcGFyaXNvbgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYXBwZW5kWG1sQ29tcGFyaXNvbjEoU1FMQnVmZmVyIGJ1ZiwgU3RyaW5n\nIG9wLAogICAgICAgIEZpbHRlclZhbHVlIGxocywgRmlsdGVyVmFsdWUgcmhz\nKSB7CiAgICAgICAgYXBwZW5kWG1sRXh0cmFjdFZhbHVlKGJ1ZiwgbGhzKTsK\nICAgICAgICBidWYuYXBwZW5kKCIgIikuYXBwZW5kKG9wKS5hcHBlbmQoIiAi\nKTsKICAgICAgICByaHMuYXBwZW5kVG8oYnVmKTsKICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBBcHBlbmQgYW4geG1sIGNvbXBhcmlzb24gcHJlZGljYXRl\nIChib3RoIG9wZXJhbmRzIG1hcCB0byB4bWwgY29sdW1uKQogICAgICoKICAg\nICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGNv\nbXBhcmlzb24KICAgICAqIEBwYXJhbSBvcCB0aGUgY29tcGFyaXNvbiBvcGVy\nYXRpb24gdG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUgbGVmdCBo\nYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24gKG1hcHMgdG8geG1sIGNvbHVt\nbikKICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0\naGUgY29tcGFyaXNvbiAobWFwcyB0byB4bWwgY29sdW1uKQogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYXBwZW5kWG1sQ29tcGFyaXNvbjIoU1FMQnVmZmVy\nIGJ1ZiwgU3RyaW5nIG9wLCAKICAgICAgICBGaWx0ZXJWYWx1ZSBsaHMsIEZp\nbHRlclZhbHVlIHJocykgewogICAgICAgIGFwcGVuZFhtbEV4dHJhY3RWYWx1\nZShidWYsIGxocyk7CiAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChv\ncCkuYXBwZW5kKCIgIik7CiAgICAgICAgYXBwZW5kWG1sRXh0cmFjdFZhbHVl\nKGJ1ZiwgcmhzKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIGFwcGVu\nZFhtbEV4dHJhY3RWYWx1ZShTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSB2\nYWwpIHsKICAgICAgICBidWYuYXBwZW5kKCJleHRyYWN0VmFsdWUoIikuCiAg\nICAgICAgICAgIGFwcGVuZCh2YWwuZ2V0Q29sdW1uQWxpYXMoCiAgICAgICAg\nICAgIHZhbC5nZXRGaWVsZE1hcHBpbmcoKS5nZXRDb2x1bW5zKClbMF0pKS4K\nICAgICAgICAgICAgYXBwZW5kKCIsJy8qLyIpOwogICAgICAgIHZhbC5hcHBl\nbmRUbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIicpIik7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyB2b2lkIGluc2VydEJsb2JGb3JTdHJlYW1pbmdMb2Fk\nKFJvdyByb3csIENvbHVtbiBjb2wsIE9iamVjdCBvYikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAob2IgPT0gbnVsbCkKICAg\nICAgICAgICAgY29sLnNldFR5cGUoVHlwZXMuT1RIRVIpOwogICAgICAgIHJv\ndy5zZXROdWxsKGNvbCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIGlu\nc2VydENsb2JGb3JTdHJlYW1pbmdMb2FkKFJvdyByb3csIENvbHVtbiBjb2ws\nIE9iamVjdCBvYikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAob2IgPT0gbnVsbCkKICAgICAgICAgICAgY29sLnNldFR5cGUo\nVHlwZXMuT1RIRVIpOwogICAgICAgIHJvdy5zZXROdWxsKGNvbCk7CiAgICB9\nCgogICAgcHVibGljIGludCBnZXRCYXRjaFVwZGF0ZUNvdW50KFByZXBhcmVk\nU3RhdGVtZW50IHBzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBp\nbnQgdXBkYXRlU3VjY2Vzc0NudCA9IDA7CiAgICAgICAgaWYgKGJhdGNoTGlt\naXQgPiAwICYmIHBzICE9IG51bGwpIHsKICAgICAgICAgICAgdXBkYXRlU3Vj\nY2Vzc0NudCA9IHBzLmdldFVwZGF0ZUNvdW50KCk7CiAgICAgICAgICAgIGlm\nIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy50\ncmFjZShfbG9jLmdldCgiYmF0Y2gtdXBkYXRlLXN1Y2Nlc3MtY291bnQiLAog\nICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN1Y2Nlc3NDbnQpKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHVwZGF0ZVN1Y2Nlc3NDbnQ7CiAgICB9Cn0K\n","encoding":"base64"}

