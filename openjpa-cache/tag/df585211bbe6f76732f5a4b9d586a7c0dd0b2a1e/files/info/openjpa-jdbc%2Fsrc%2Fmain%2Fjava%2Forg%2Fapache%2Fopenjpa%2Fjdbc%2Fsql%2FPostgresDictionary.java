{"sha":"2aaf95d3b2d8984a788ae13d9fd242c4c0601ea6","node_id":"MDQ6QmxvYjIwNjM2NDoyYWFmOTVkM2IyZDg5ODRhNzg4YWUxM2Q5ZmQyNDJjNGMwNjAxZWE2","size":21035,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/2aaf95d3b2d8984a788ae13d9fd242c4c0601ea6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJl\nYW07CmltcG9ydCBqYXZhLmlvLk91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEu\nc3FsLkNvbm5lY3Rpb247CmltcG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRl\nbWVudDsKaW1wb3J0IGphdmEuc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEu\nc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsK\naW1wb3J0IGphdmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS50ZXh0LlBhcnNl\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS50ZXh0LlNpbXBsZURhdGVGb3JtYXQ7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkRh\ndGU7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpE\nQkNTdG9yZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5l\nbC5leHBzLkZpbHRlclZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5TZXF1ZW5jZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nQ29ubmVjdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nUHJlcGFyZWRT\ndGF0ZW1lbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50\nZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5TdG9yZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5wb3N0Z3Jlc3FsLlBHQ29u\nbmVjdGlvbjsKaW1wb3J0IG9yZy5wb3N0Z3Jlc3FsLmxhcmdlb2JqZWN0Lkxh\ncmdlT2JqZWN0OwppbXBvcnQgb3JnLnBvc3RncmVzcWwubGFyZ2VvYmplY3Qu\nTGFyZ2VPYmplY3RNYW5hZ2VyOwoKLyoqCiAqIERpY3Rpb25hcnkgZm9yIFBv\nc3RncmVzLgogKi8KcHVibGljIGNsYXNzIFBvc3RncmVzRGljdGlvbmFyeQog\nICAgZXh0ZW5kcyBEQkRpY3Rpb25hcnkgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoUG9zdGdyZXNEaWN0aW9uYXJ5LmNsYXNzKTsKCiAgICAvKioK\nICAgICAqIFNRTCBzdGF0ZW1lbnQgdG8gbG9hZCBhbGwgc2VxdWVuY2Ugc2No\nZW1hLG5hbWUgcGFpcnMgZnJvbSBhbGwgc2NoZW1hcy4KICAgICAqLwogICAg\ncHVibGljIFN0cmluZyBhbGxTZXF1ZW5jZXNTUUwgPSAiU0VMRUNUIE5VTEwg\nQVMgU0VRVUVOQ0VfU0NIRU1BLCByZWxuYW1lICIgKwogICAgICAgICJBUyBT\nRVFVRU5DRV9OQU1FIEZST00gcGdfY2xhc3MgV0hFUkUgcmVsa2luZD0nUyci\nOwoKICAgIC8qKgogICAgICogU1FMIHN0YXRlbWVudCB0byBsb2FkIHNjaGVt\nYSxuYW1lIHBhaXJzIGZvciBhbGwgc2VxdWVuY2VzIHdpdGggYQogICAgICog\nY2VydGFpbiBuYW1lIGZyb20gYWxsIHNjaGVtYXMuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgbmFtZWRTZXF1ZW5jZXNGcm9tQWxsU2NoZW1hc1NRTCA9\nICJTRUxFQ1QgTlVMTCBBUyAiICsKICAgICAgICAiU0VRVUVOQ0VfU0NIRU1B\nLCByZWxuYW1lIEFTIFNFUVVFTkNFX05BTUUgRlJPTSBwZ19jbGFzcyAiICsK\nICAgICAgICAiV0hFUkUgcmVsa2luZD0nUycgQU5EIHJlbG5hbWUgPSA/IjsK\nCiAgICAvKioKICAgICAqIFNRTCBzdGF0ZW1lbnQgdG8gbG9hZCBzY2hlbWEs\nbmFtZSBwYWlycyBmcm9tIGEgbmFtZWQgc2NoZW1hLgogICAgICovCiAgICBw\ndWJsaWMgU3RyaW5nIGFsbFNlcXVlbmNlc0Zyb21PbmVTY2hlbWFTUUwgPSAi\nU0VMRUNUIE5VTEwgQVMgIiArCiAgICAgICAgIlNFUVVFTkNFX1NDSEVNQSwg\ncmVsbmFtZSBBUyBTRVFVRU5DRV9OQU1FIEZST00gcGdfY2xhc3MsICIgKwog\nICAgICAgICJwZ19uYW1lc3BhY2UgV0hFUkUgcmVsa2luZD0nUycgQU5EIHBn\nX2NsYXNzLnJlbG5hbWVzcGFjZSA9ICIgKwogICAgICAgICJwZ19uYW1lc3Bh\nY2Uub2lkIEFORCBuc3BuYW1lID0gPyI7CgogICAgLyoqCiAgICAgKiBTUUwg\nc3RhdGVtZW50IHRvIGxvYWQgYSBzZXF1ZW5jZSdzIHNjaGVtYSxuYW1lIHBh\naXIgZnJvbSBvbmUgc2NoZW1hLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nIG5hbWVkU2VxdWVuY2VGcm9tT25lU2NoZW1hU1FMID0gIlNFTEVDVCBOVUxM\nIEFTICIgKwogICAgICAgICJTRVFVRU5DRV9TQ0hFTUEsIHJlbG5hbWUgQVMg\nU0VRVUVOQ0VfTkFNRSBGUk9NIHBnX2NsYXNzLCAiICsKICAgICAgICAicGdf\nbmFtZXNwYWNlIFdIRVJFIHJlbGtpbmQ9J1MnIEFORCBwZ19jbGFzcy5yZWxu\nYW1lc3BhY2UgPSAiICsKICAgICAgICAicGdfbmFtZXNwYWNlLm9pZCBBTkQg\ncmVsbmFtZSA9ID8gQU5EIG5zcG5hbWUgPSA/IjsKCiAgICAvKioKICAgICAq\nIFNvbWUgUG9zdGdyZXMgZHJpdmVycyBkbyBub3Qgc3VwcG9ydCB0aGUge0Bs\naW5rIFN0YXRlbWVudCNzZXRGZXRjaFNpemV9CiAgICAgKiBtZXRob2QuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzU2V0RmV0Y2hTaXpl\nID0gdHJ1ZTsKCiAgICBwdWJsaWMgUG9zdGdyZXNEaWN0aW9uYXJ5KCkgewog\nICAgICAgIHBsYXRmb3JtID0gIlBvc3RncmVTUUwiOwogICAgICAgIHZhbGlk\nYXRpb25TUUwgPSAiU0VMRUNUIE5PVygpIjsKICAgICAgICBkYXRlUHJlY2lz\naW9uID0gQ0VOVEk7CiAgICAgICAgc3VwcG9ydHNBbHRlclRhYmxlV2l0aERy\nb3BDb2x1bW4gPSBmYWxzZTsKICAgICAgICBzdXBwb3J0c0RlZmVycmVkQ29u\nc3RyYWludHMgPSB0cnVlOwogICAgICAgIHN1cHBvcnRzU2VsZWN0U3RhcnRJ\nbmRleCA9IHRydWU7CiAgICAgICAgc3VwcG9ydHNTZWxlY3RFbmRJbmRleCA9\nIHRydWU7CgogICAgICAgIC8vIFBvc3RncmVTUUwgcmVxdWlyZXMgZG91Ymxl\nLWVzY2FwZSBmb3Igc3RyaW5ncwogICAgICAgIHNlYXJjaFN0cmluZ0VzY2Fw\nZSA9ICJcXFxcIjsKCiAgICAgICAgbWF4VGFibGVOYW1lTGVuZ3RoID0gNjM7\nCiAgICAgICAgbWF4Q29sdW1uTmFtZUxlbmd0aCA9IDYzOwogICAgICAgIG1h\neEluZGV4TmFtZUxlbmd0aCA9IDYzOwogICAgICAgIG1heENvbnN0cmFpbnRO\nYW1lTGVuZ3RoID0gNjM7CiAgICAgICAgbWF4QXV0b0Fzc2lnbk5hbWVMZW5n\ndGggPSA2MzsKICAgICAgICBzY2hlbWFDYXNlID0gU0NIRU1BX0NBU0VfTE9X\nRVI7CiAgICAgICAgcmFuZ2VQb3NpdGlvbiA9IFJBTkdFX1BPU1RfTE9DSzsK\nICAgICAgICByZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0ID0gdHJ1ZTsKICAg\nICAgICBhbGxvd3NBbGlhc0luQnVsa0NsYXVzZSA9IGZhbHNlOwoKICAgICAg\nICAvLyB7Mn0gaXMgdGhlIHJlc3VsdCBvZiBnZXRHZW5lcmF0ZWRLZXlTZXF1\nZW5jZU5hbWU7IHRoZQogICAgICAgIC8vIHNpbmdsZS1xdW90ZSBlc2NhcGUg\nd2lsbCByZXN1bHQgaW4gU0VMRUNUIENVUlZBTCgnbXlzZXF1ZW5jZScpCiAg\nICAgICAgbGFzdEdlbmVyYXRlZEtleVF1ZXJ5ID0gIlNFTEVDVCBDVVJSVkFM\nKCcnezJ9JycpIjsKICAgICAgICBzdXBwb3J0c0F1dG9Bc3NpZ24gPSB0cnVl\nOwogICAgICAgIGF1dG9Bc3NpZ25UeXBlTmFtZSA9ICJCSUdTRVJJQUwiOwog\nICAgICAgIG5leHRTZXF1ZW5jZVF1ZXJ5ID0gIlNFTEVDVCBORVhUVkFMKCcn\nezB9JycpIjsKCiAgICAgICAgdXNlR2V0Qnl0ZXNGb3JCbG9icyA9IHRydWU7\nCiAgICAgICAgdXNlU2V0Qnl0ZXNGb3JCbG9icyA9IHRydWU7CiAgICAgICAg\ndXNlR2V0U3RyaW5nRm9yQ2xvYnMgPSB0cnVlOwogICAgICAgIHVzZVNldFN0\ncmluZ0ZvckNsb2JzID0gdHJ1ZTsKICAgICAgICBiaXRUeXBlTmFtZSA9ICJC\nT09MIjsKICAgICAgICBzbWFsbGludFR5cGVOYW1lID0gIlNNQUxMSU5UIjsK\nICAgICAgICByZWFsVHlwZU5hbWUgPSAiRkxPQVQ4IjsKICAgICAgICB0aW55\naW50VHlwZU5hbWUgPSAiU01BTExJTlQiOwogICAgICAgIGJpbmFyeVR5cGVO\nYW1lID0gIkJZVEVBIjsKICAgICAgICBibG9iVHlwZU5hbWUgPSAiQllURUEi\nOwogICAgICAgIGxvbmdWYXJiaW5hcnlUeXBlTmFtZSA9ICJCWVRFQSI7CiAg\nICAgICAgdmFyYmluYXJ5VHlwZU5hbWUgPSAiQllURUEiOwogICAgICAgIGNs\nb2JUeXBlTmFtZSA9ICJURVhUIjsKICAgICAgICBsb25nVmFyY2hhclR5cGVO\nYW1lID0gIlRFWFQiOwogICAgICAgIGRvdWJsZVR5cGVOYW1lID0gIkRPVUJM\nRSBQUkVDSVNJT04iOwogICAgICAgIHZhcmNoYXJUeXBlTmFtZSA9ICJWQVJD\nSEFSezB9IjsKICAgICAgICB0aW1lc3RhbXBUeXBlTmFtZSA9ICJBQlNUSU1F\nIjsKICAgICAgICBmaXhlZFNpemVUeXBlTmFtZVNldC5hZGRBbGwoQXJyYXlz\nLmFzTGlzdChuZXcgU3RyaW5nW117CiAgICAgICAgICAgICJCT09MIiwgIkJZ\nVEVBIiwgIk5BTUUiLCAiSU5UOCIsICJJTlQyIiwgIklOVDJWRUNUT1IiLCAi\nSU5UNCIsCiAgICAgICAgICAgICJSRUdQUk9DIiwgIlRFWFQiLCAiT0lEIiwg\nIlRJRCIsICJYSUQiLCAiQ0lEIiwgIk9JRFZFQ1RPUiIsCiAgICAgICAgICAg\nICJTRVQiLCAiRkxPQVQ0IiwgIkZMT0FUOCIsICJBQlNUSU1FIiwgIlJFTFRJ\nTUUiLCAiVElOVEVSVkFMIiwKICAgICAgICAgICAgIk1PTkVZIiwKICAgICAg\nICB9KSk7CgogICAgICAgIHN1cHBvcnRzTG9ja2luZ1dpdGhEaXN0aW5jdENs\nYXVzZSA9IGZhbHNlOwogICAgICAgIHN1cHBvcnRzTG9ja2luZ1dpdGhPdXRl\nckpvaW4gPSBmYWxzZTsKICAgICAgICBzdXBwb3J0c051bGxUYWJsZUZvckdl\ndEltcG9ydGVkS2V5cyA9IHRydWU7CgogICAgICAgIHJlc2VydmVkV29yZFNl\ndC5hZGRBbGwoQXJyYXlzLmFzTGlzdChuZXcgU3RyaW5nW117CiAgICAgICAg\nICAgICJBQk9SVCIsICJBQ0wiLCAiQUdHUkVHQVRFIiwgIkFQUEVORCIsICJB\nUkNISVZFIiwgIkFSQ0hfU1RPUkUiLAogICAgICAgICAgICAiQkFDS1dBUkQi\nLCAiQklOQVJZIiwgIkNIQU5HRSIsICJDTFVTVEVSIiwgIkNPUFkiLCAiREFU\nQUJBU0UiLAogICAgICAgICAgICAiREVMSU1JVEVSIiwgIkRFTElNSVRFUlMi\nLCAiRE8iLCAiRVhQTEFJTiIsICJFWFRFTkQiLAogICAgICAgICAgICAiRk9S\nV0FSRCIsICJIRUFWWSIsICJJTkRFWCIsICJJTkhFUklUUyIsICJJU05VTEwi\nLCAiTElHSFQiLAogICAgICAgICAgICAiTElTVEVOIiwgIkxPQUQiLCAiTUVS\nR0UiLCAiTk9USElORyIsICJOT1RJRlkiLCAiTk9UTlVMTCIsCiAgICAgICAg\nICAgICJPSUQiLCAiT0lEUyIsICJQVVJHRSIsICJSRUNJUEUiLCAiUkVOQU1F\nIiwgIlJFUExBQ0UiLAogICAgICAgICAgICAiUkVUUklFVkUiLCAiUkVUVVJO\nUyIsICJSVUxFIiwgIlNFVE9GIiwgIlNURElOIiwgIlNURE9VVCIsCiAgICAg\nICAgICAgICJTVE9SRSIsICJWQUNVVU0iLCAiVkVSQk9TRSIsICJWRVJTSU9O\nIiwKICAgICAgICB9KSk7CiAgICB9CgogICAgcHVibGljIERhdGUgZ2V0RGF0\nZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJu\nIHN1cGVyLmdldERhdGUocnMsIGNvbHVtbik7CiAgICAgICAgfSBjYXRjaCAo\nU3RyaW5nSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBzaW9vYmUpIHsKICAg\nICAgICAgICAgLy8gdGhlcmUgaXMgYSBidWcgaW4gc29tZSB2ZXJzaW9ucyBv\nZiB0aGUgcG9zdGdyZXMgSkRCQwogICAgICAgICAgICAvLyBkcml2ZXIgc3Vj\naCB0aGF0IGEgZGF0ZSB3aXRoIG5vdCBlbm91Z2ggbnVtYmVycyBpbiBpdAog\nICAgICAgICAgICAvLyB3aWxsIHRocm93IGEgcGFyc2luZyBleGNlcHRpb246\nIHRoaXMgdHJpZXMgdG8gd29yawogICAgICAgICAgICAvLyBhcm91bmQgaXQu\nIFRoZSBidWcgb25seSBvY2N1cnMgd2hlbiB0aGVyZSBpcyBhIHRyYWlsaW5n\nCiAgICAgICAgICAgIC8vIG1pbGxpc2Vjb25kIG1pc3NpbmcgZnJvbSB0aGUg\nZW5kLiBFLmcuLCB3aGVuIHRoZSBkYXRlIGlzCiAgICAgICAgICAgIC8vIGxp\na2U6CiAgICAgICAgICAgIC8vIDIwNjYtMTAtMTkgMjI6MDg6MzIuODMKICAg\nICAgICAgICAgLy8gcmF0aGVyIHRoYW4gd2hhdCB0aGUgZHJpdmVyIGV4cGVj\ndHM6CiAgICAgICAgICAgIC8vIDIwNjYtMTAtMTkgMjI6MDg6MzIuODMwCiAg\nICAgICAgICAgIFN0cmluZyBkYXRlU3RyID0gcnMuZ2V0U3RyaW5nKGNvbHVt\nbik7CiAgICAgICAgICAgIFNpbXBsZURhdGVGb3JtYXQgZm10ID0gbmV3IFNp\nbXBsZURhdGVGb3JtYXQoCiAgICAgICAgICAgICAgICAieXl5eS1NTS1kZCBo\naDptbTpzcy5TUyIpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIGZtdC5wYXJzZShkYXRlU3RyKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoUGFyc2VFeGNlcHRpb24gcGUpIHsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBTUUxFeGNlcHRpb24ocGUudG9TdHJpbmcoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJ5dGUgZ2V0Qnl0\nZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcG9zdGdyZXMgZG9lcyBub3QgcGVy\nZm9ybSBhdXRvbWF0aWMgY29udmVyc2lvbnMsIHNvIGF0dGVtcHRpbmcgdG8K\nICAgICAgICAvLyBnZXQgYSB3aG9sZSBudW1iZXIgb3V0IG9mIGEgZGVjaW1h\nbCB3aWxsIHRocm93IGFuIGV4Y2VwdGlvbi4KICAgICAgICAvLyBmYWxsIGJh\nY2sgdG8gcGVyZm9ybWluZyBtYW51YWwgY29udmVyc2lvbiBpZiB0aGUgaW5p\ndGlhbCBnZXQgZmFpbHMKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1\ncm4gc3VwZXIuZ2V0Qnl0ZShycywgY29sdW1uKTsKICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc3FsZSkgewogICAgICAgICAgICByZXR1cm4gc3Vw\nZXIuZ2V0QmlnRGVjaW1hbChycywgY29sdW1uKS5ieXRlVmFsdWUoKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHNob3J0IGdldFNob3J0KFJlc3Vs\ndFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAvLyBwb3N0Z3JlcyBkb2VzIG5vdCBwZXJmb3JtIGF1\ndG9tYXRpYyBjb252ZXJzaW9ucywgc28gYXR0ZW1wdGluZyB0bwogICAgICAg\nIC8vIGdldCBhIHdob2xlIG51bWJlciBvdXQgb2YgYSBkZWNpbWFsIHdpbGwg\ndGhyb3cgYW4gZXhjZXB0aW9uLgogICAgICAgIC8vIGZhbGwgYmFjayB0byBw\nZXJmb3JtaW5nIG1hbnVhbCBjb252ZXJzaW9uIGlmIHRoZSBpbml0aWFsIGdl\ndCBmYWlscwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBzdXBl\nci5nZXRTaG9ydChycywgY29sdW1uKTsKICAgICAgICB9IGNhdGNoIChTUUxF\neGNlcHRpb24gc3FsZSkgewogICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0\nQmlnRGVjaW1hbChycywgY29sdW1uKS5zaG9ydFZhbHVlKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0SW50KFJlc3VsdFNldCBycywg\naW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBwb3N0Z3JlcyBkb2VzIG5vdCBwZXJmb3JtIGF1dG9tYXRpYyBj\nb252ZXJzaW9ucywgc28gYXR0ZW1wdGluZyB0bwogICAgICAgIC8vIGdldCBh\nIHdob2xlIG51bWJlciBvdXQgb2YgYSBkZWNpbWFsIHdpbGwgdGhyb3cgYW4g\nZXhjZXB0aW9uLgogICAgICAgIC8vIGZhbGwgYmFjayB0byBwZXJmb3JtaW5n\nIG1hbnVhbCBjb252ZXJzaW9uIGlmIHRoZSBpbml0aWFsIGdldCBmYWlscwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5nZXRJbnQo\ncnMsIGNvbHVtbik7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNx\nbGUpIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldEJpZ0RlY2ltYWwo\ncnMsIGNvbHVtbikuaW50VmFsdWUoKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIGxvbmcgZ2V0TG9uZyhSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcG9z\ndGdyZXMgZG9lcyBub3QgcGVyZm9ybSBhdXRvbWF0aWMgY29udmVyc2lvbnMs\nIHNvIGF0dGVtcHRpbmcgdG8KICAgICAgICAvLyBnZXQgYSB3aG9sZSBudW1i\nZXIgb3V0IG9mIGEgZGVjaW1hbCB3aWxsIHRocm93IGFuIGV4Y2VwdGlvbi4K\nICAgICAgICAvLyBmYWxsIGJhY2sgdG8gcGVyZm9ybWluZyBtYW51YWwgY29u\ndmVyc2lvbiBpZiB0aGUgaW5pdGlhbCBnZXQgZmFpbHMKICAgICAgICB0cnkg\newogICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0TG9uZyhycywgY29sdW1u\nKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc3FsZSkgewogICAg\nICAgICAgICByZXR1cm4gc3VwZXIuZ2V0QmlnRGVjaW1hbChycywgY29sdW1u\nKS5sb25nVmFsdWUoKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0Qm9vbGVhbihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlk\neCwgYm9vbGVhbiB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBwb3N0Z3JlcyBhY3R1\nYWxseSByZXF1aXJlcyB0aGF0IGEgYm9vbGVhbiBiZSBzZXQ6IGl0IGNhbm5v\ndAogICAgICAgIC8vIGhhbmRsZSBhIG51bWVyaWMgYXJndW1lbnQuCiAgICAg\nICAgc3RtbnQuc2V0Qm9vbGVhbihpZHgsIHZhbCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0TnVsbChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50\nIGlkeCwgaW50IGNvbFR5cGUsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBPUEVOSlBBLQog\nICAgICAgIGlmIChjb2xUeXBlID09IFR5cGVzLkJMT0IpCiAgICAgICAgICAg\nIGNvbFR5cGUgPSBUeXBlcy5CSU5BUlk7CiAgICAgICAgc3RtbnQuc2V0TnVs\nbChpZHgsIGNvbFR5cGUpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFw\ncGVuZFNlbGVjdFJhbmdlKFNRTEJ1ZmZlciBidWYsIGxvbmcgc3RhcnQsIGxv\nbmcgZW5kLAogICAgICAgIGJvb2xlYW4gc3Vic2VsZWN0KSB7CiAgICAgICAg\naWYgKGVuZCAhPSBMb25nLk1BWF9WQUxVRSkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIExJTUlUICIpLmFwcGVuZFZhbHVlKGVuZCAtIHN0YXJ0KTsKICAg\nICAgICBpZiAoc3RhcnQgIT0gMCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nIE9GRlNFVCAiKS5hcHBlbmRWYWx1ZShzdGFydCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgaW5kZXhPZihTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSBz\ndHIsIEZpbHRlclZhbHVlIGZpbmQsCiAgICAgICAgRmlsdGVyVmFsdWUgc3Rh\ncnQpIHsKICAgICAgICBidWYuYXBwZW5kKCIoUE9TSVRJT04oIik7CiAgICAg\nICAgZmluZC5hcHBlbmRUbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiBJ\nTiAiKTsKICAgICAgICBpZiAoc3RhcnQgIT0gbnVsbCkKICAgICAgICAgICAg\nc3Vic3RyaW5nKGJ1Ziwgc3RyLCBzdGFydCwgbnVsbCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBzdHIuYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYu\nYXBwZW5kKCIpIC0gMSIpOwogICAgICAgIGlmIChzdGFydCAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiArICIpOwogICAgICAgICAgICBz\ndGFydC5hcHBlbmRUbyhidWYpOwogICAgICAgIH0KICAgICAgICBidWYuYXBw\nZW5kKCIpIik7CiAgICB9CgogICAgcHVibGljIFN0cmluZ1tdIGdldENyZWF0\nZVNlcXVlbmNlU1FMKFNlcXVlbmNlIHNlcSkgewogICAgICAgIFN0cmluZ1td\nIHNxbCA9IHN1cGVyLmdldENyZWF0ZVNlcXVlbmNlU1FMKHNlcSk7CiAgICAg\nICAgaWYgKHNlcS5nZXRBbGxvY2F0ZSgpID4gMSkKICAgICAgICAgICAgc3Fs\nWzBdICs9ICIgQ0FDSEUgIiArIHNlcS5nZXRBbGxvY2F0ZSgpOwogICAgICAg\nIHJldHVybiBzcWw7CiAgICB9CgogICAgcHJvdGVjdGVkIGJvb2xlYW4gc3Vw\ncG9ydHNEZWZlcnJlZFVuaXF1ZUNvbnN0cmFpbnRzKCkgewogICAgICAgIC8v\nIFBvc3RncmVzIG9ubHkgc3VwcG9ydHMgZGVmZXJyZWQgZm9yZWlnbiBrZXkg\nY29uc3RyYWludHMuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIHByb3RlY3RlZCBTdHJpbmcgZ2V0U2VxdWVuY2VzU1FMKFN0cmluZyBzY2hl\nbWFOYW1lLCBTdHJpbmcgc2VxdWVuY2VOYW1lKSB7CiAgICAgICAgaWYgKHNj\naGVtYU5hbWUgPT0gbnVsbCAmJiBzZXF1ZW5jZU5hbWUgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGFsbFNlcXVlbmNlc1NRTDsKICAgICAgICBlbHNl\nIGlmIChzY2hlbWFOYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\nYW1lZFNlcXVlbmNlc0Zyb21BbGxTY2hlbWFzU1FMOwogICAgICAgIGVsc2Ug\naWYgKHNlcXVlbmNlTmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nYWxsU2VxdWVuY2VzRnJvbU9uZVNjaGVtYVNRTDsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHJldHVybiBuYW1lZFNlcXVlbmNlRnJvbU9uZVNjaGVtYVNR\nTDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5c3RlbVNlcXVlbmNl\nKFN0cmluZyBuYW1lLCBTdHJpbmcgc2NoZW1hLAogICAgICAgIGJvb2xlYW4g\ndGFyZ2V0U2NoZW1hKSB7CiAgICAgICAgaWYgKHN1cGVyLmlzU3lzdGVtU2Vx\ndWVuY2UobmFtZSwgc2NoZW1hLCB0YXJnZXRTY2hlbWEpKQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgLy8gZmlsdGVyIG91dCBnZW5lcmF0\nZWQgc2VxdWVuY2VzIHVzZWQgZm9yIGJpZ3NlcmlhbCBjb2xzLCB3aGljaCBh\ncmUKICAgICAgICAvLyBvZiB0aGUgZm9ybSA8dGFibGU+Xzxjb2w+X3NlcQog\nICAgICAgIGludCBpZHggPSBuYW1lLmluZGV4T2YoJ18nKTsKICAgICAgICBy\nZXR1cm4gaWR4ICE9IC0xICYmIGlkeCAhPSBuYW1lLmxlbmd0aCgpIC0gNAog\nICAgICAgICAgICAmJiBuYW1lLnRvVXBwZXJDYXNlKCkuZW5kc1dpdGgoIl9T\nRVEiKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5c3RlbVRhYmxl\nKFN0cmluZyBuYW1lLCBTdHJpbmcgc2NoZW1hLAogICAgICAgIGJvb2xlYW4g\ndGFyZ2V0U2NoZW1hKSB7CiAgICAgICAgLy8gbmFtZXMgc3RhcnRpbmcgd2l0\naCAicGdfIiBhcmUgcmVzZXJ2ZWQgZm9yIFBvc3RncmVzcWwgaW50ZXJuYWwg\ndXNlCiAgICAgICAgcmV0dXJuIHN1cGVyLmlzU3lzdGVtVGFibGUobmFtZSwg\nc2NoZW1hLCB0YXJnZXRTY2hlbWEpCiAgICAgICAgICAgIHx8IChuYW1lICE9\nIG51bGwgJiYgbmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoInBnXyIp\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5c3RlbUluZGV4KFN0\ncmluZyBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIC8vIG5hbWVzIHN0\nYXJ0aW5nIHdpdGggInBnXyIgYXJlIHJlc2VydmVkIGZvciBQb3N0Z3Jlc3Fs\nIGludGVybmFsIHVzZQogICAgICAgIHJldHVybiBzdXBlci5pc1N5c3RlbUlu\nZGV4KG5hbWUsIHRhYmxlKQogICAgICAgICAgICB8fCAobmFtZSAhPSBudWxs\nICYmIG5hbWUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKCJwZ18iKSk7CiAg\nICB9CgogICAgcHVibGljIENvbm5lY3Rpb24gZGVjb3JhdGUoQ29ubmVjdGlv\nbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBuZXcgUG9zdGdyZXNDb25uZWN0aW9uKHN1cGVyLmRlY29yYXRl\nKGNvbm4pLCB0aGlzKTsKICAgIH0KCiAgICBwdWJsaWMgSW5wdXRTdHJlYW0g\nZ2V0TE9CU3RyZWFtKEpEQkNTdG9yZSBzdG9yZSwgUmVzdWx0U2V0IHJzLAog\nICAgICAgIGludCBjb2x1bW4pIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIERlbGVnYXRpbmdDb25uZWN0aW9uIGNvbm4gPSAoRGVsZWdhdGluZ0Nv\nbm5lY3Rpb24pc3RvcmUKICAgICAgICAgICAgLmdldENvbm5lY3Rpb24oKTsK\nICAgICAgICBjb25uLnNldEF1dG9Db21taXQoZmFsc2UpOwogICAgICAgIExh\ncmdlT2JqZWN0TWFuYWdlciBsb20gPSAoKFBHQ29ubmVjdGlvbiljb25uLmdl\ndElubmVybW9zdERlbGVnYXRlKCkpCiAgICAgICAgLmdldExhcmdlT2JqZWN0\nQVBJKCk7CiAgICAgICAgaWYgKHJzLmdldEludChjb2x1bW4pICE9IC0xKSB7\nCiAgICAgICAgICAgIExhcmdlT2JqZWN0IGxvID0gbG9tLm9wZW4ocnMuZ2V0\nSW50KGNvbHVtbikpOwogICAgICAgICAgICByZXR1cm4gbG8uZ2V0SW5wdXRT\ndHJlYW0oKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5zZXJ0\nQmxvYkZvclN0cmVhbWluZ0xvYWQoUm93IHJvdywgQ29sdW1uIGNvbCwgCiAg\nICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBPYmplY3Qgb2IsIFNlbGVjdCBzZWwp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChyb3cuZ2V0QWN0\naW9uKCkgPT0gUm93LkFDVElPTl9JTlNFUlQpIHsKICAgICAgICAgICAgaW5z\nZXJ0UG9zdGdyZXNCbG9iKHJvdywgY29sLCBzdG9yZSwgb2IpOwogICAgICAg\nIH0gZWxzZSBpZiAocm93LmdldEFjdGlvbigpID09IFJvdy5BQ1RJT05fVVBE\nQVRFKSB7CiAgICAgICAgICAgIHVwZGF0ZVBvc3RncmVzQmxvYihyb3csIGNv\nbCwgc3RvcmUsIG9iLCBzZWwpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgaW5zZXJ0UG9zdGdyZXNCbG9iKFJvdyByb3csIENvbHVtbiBj\nb2wsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBPYmplY3Qgb2IpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChvYiAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGNvbC5zZXRUeXBlKFR5cGVzLklOVEVHRVIpOwogICAgICAg\nICAgICBEZWxlZ2F0aW5nQ29ubmVjdGlvbiBjb25uID0gKERlbGVnYXRpbmdD\nb25uZWN0aW9uKXN0b3JlCiAgICAgICAgICAgIC5nZXRDb25uZWN0aW9uKCk7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25uLnNldEF1\ndG9Db21taXQoZmFsc2UpOwogICAgICAgICAgICAgICAgUEdDb25uZWN0aW9u\nIHBnY29ubiA9IChQR0Nvbm5lY3Rpb24pIGNvbm4uZ2V0SW5uZXJtb3N0RGVs\nZWdhdGUoKTsKICAgICAgICAgICAgICAgIExhcmdlT2JqZWN0TWFuYWdlciBs\nb20gPSBwZ2Nvbm4uZ2V0TGFyZ2VPYmplY3RBUEkoKTsKICAgICAgICAgICAg\nICAgIC8vIFRoZSBjcmVhdGUgbWV0aG9kIGlzIHZhbGlkIGluIHZlcnNpb25z\nIHByZXZpb3VzIDguMwogICAgICAgICAgICAgICAgLy8gaW4gOC4zIHRoaXMg\nbWV0aG9zIGlzIGRlcHJlY2F0ZWQsIHVzZSBjcmVhdGVMTwogICAgICAgICAg\nICAgICAgaW50IG9pZCA9IGxvbS5jcmVhdGUoKTsKICAgICAgICAgICAgICAg\nIExhcmdlT2JqZWN0IGxvID0gbG9tLm9wZW4ob2lkLCBMYXJnZU9iamVjdE1h\nbmFnZXIuV1JJVEUpOwogICAgICAgICAgICAgICAgT3V0cHV0U3RyZWFtIG9z\nID0gbG8uZ2V0T3V0cHV0U3RyZWFtKCk7CiAgICAgICAgICAgICAgICBjb3B5\nKChJbnB1dFN0cmVhbSlvYiwgb3MpOwogICAgICAgICAgICAgICAgbG8uY2xv\nc2UoKTsKICAgICAgICAgICAgICAgIHJvdy5zZXRJbnQoY29sLCBvaWQpOwog\nICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihpb2UpOwogICAg\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgY29ubi5jbG9z\nZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgcm93LnNldEludChjb2wsIC0xKTsKICAgICAgICB9CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgdm9pZCB1cGRhdGVQb3N0Z3Jlc0Jsb2IoUm93IHJvdywg\nQ29sdW1uIGNvbCwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIE9iamVjdCBv\nYiwgU2VsZWN0IHNlbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nU1FMQnVmZmVyIHNxbCA9IHNlbC50b1NlbGVjdCh0cnVlLCBzdG9yZS5nZXRG\nZXRjaENvbmZpZ3VyYXRpb24oKSk7CiAgICAgICAgUmVzdWx0U2V0IHJlcyA9\nIG51bGw7CiAgICAgICAgRGVsZWdhdGluZ0Nvbm5lY3Rpb24gY29ubiA9IAog\nICAgICAgICAgICAoRGVsZWdhdGluZ0Nvbm5lY3Rpb24pIHN0b3JlLmdldENv\nbm5lY3Rpb24oKTsKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9\nIG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RtbnQgPSBzcWwu\ncHJlcGFyZVN0YXRlbWVudChjb25uLCBzdG9yZS5nZXRGZXRjaENvbmZpZ3Vy\nYXRpb24oKSwKICAgICAgICAgICAgICAgIFJlc3VsdFNldC5UWVBFX1NDUk9M\nTF9TRU5TSVRJVkUsIFJlc3VsdFNldC5DT05DVVJfVVBEQVRBQkxFKTsKICAg\nICAgICAgICAgcmVzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAg\nICAgIGlmICghcmVzLm5leHQoKSkgewogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJzdHJlYW0tZXhjZXB0\naW9uIikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGludCBvaWQgPSBy\nZXMuZ2V0SW50KDEpOwogICAgICAgICAgICBpZiAob2lkICE9IC0xKSB7CiAg\nICAgICAgICAgICAgICBjb25uLnNldEF1dG9Db21taXQoZmFsc2UpOwogICAg\nICAgICAgICAgICAgUEdDb25uZWN0aW9uIHBnY29ubiA9IChQR0Nvbm5lY3Rp\nb24pY29ubgogICAgICAgICAgICAgICAgICAgIC5nZXRJbm5lcm1vc3REZWxl\nZ2F0ZSgpOwogICAgICAgICAgICAgICAgTGFyZ2VPYmplY3RNYW5hZ2VyIGxv\nbSA9IHBnY29ubi5nZXRMYXJnZU9iamVjdEFQSSgpOwogICAgICAgICAgICAg\nICAgaWYgKG9iICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBMYXJn\nZU9iamVjdCBsbyA9IGxvbS5vcGVuKG9pZCwgTGFyZ2VPYmplY3RNYW5hZ2Vy\nLldSSVRFKTsKICAgICAgICAgICAgICAgICAgICBPdXRwdXRTdHJlYW0gb3Mg\nPSBsby5nZXRPdXRwdXRTdHJlYW0oKTsKICAgICAgICAgICAgICAgICAgICBj\nb3B5KChJbnB1dFN0cmVhbSlvYiwgb3MpOwogICAgICAgICAgICAgICAgICAg\nIGxvLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgIGxvbS5kZWxldGUob2lkKTsKICAgICAgICAgICAgICAg\nICAgICByb3cuc2V0SW50KGNvbCwgLTEpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKG9iICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBjb25uLnNldEF1dG9Db21t\naXQoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIFBHQ29ubmVjdGlvbiBw\nZ2Nvbm4gPSAoUEdDb25uZWN0aW9uKWNvbm4KICAgICAgICAgICAgICAgICAg\nICAgICAgLmdldElubmVybW9zdERlbGVnYXRlKCk7CiAgICAgICAgICAgICAg\nICAgICAgTGFyZ2VPYmplY3RNYW5hZ2VyIGxvbSA9IHBnY29ubi5nZXRMYXJn\nZU9iamVjdEFQSSgpOwogICAgICAgICAgICAgICAgICAgIG9pZCA9IGxvbS5j\ncmVhdGUoKTsKICAgICAgICAgICAgICAgICAgICBMYXJnZU9iamVjdCBsbyA9\nIGxvbS5vcGVuKG9pZCwgTGFyZ2VPYmplY3RNYW5hZ2VyLldSSVRFKTsKICAg\nICAgICAgICAgICAgICAgICBPdXRwdXRTdHJlYW0gb3MgPSBsby5nZXRPdXRw\ndXRTdHJlYW0oKTsKICAgICAgICAgICAgICAgICAgICBjb3B5KChJbnB1dFN0\ncmVhbSlvYiwgb3MpOwogICAgICAgICAgICAgICAgICAgIGxvLmNsb3NlKCk7\nCiAgICAgICAgICAgICAgICAgICAgcm93LnNldEludChjb2wsIG9pZCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBjYXRj\naCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihpb2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGlmIChyZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7\nIHJlcy5jbG9zZSAoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHt9CiAg\nICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsgc3RtbnQuY2xvc2UgKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBl\nKSB7fQogICAgICAgICAgICBpZiAoY29ubiAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdHJ5IHsgY29ubi5jbG9zZSAoKTsgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIGUpIHt9CiAgICAgICAgfQoKICAgIH0KICAgIAogICAgcHVibGljIHZv\naWQgdXBkYXRlQmxvYihTZWxlY3Qgc2VsLCBKREJDU3RvcmUgc3RvcmUsIElu\ncHV0U3RyZWFtIGlzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIC8vRG8gbm90aGluZwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRl\nbGV0ZVN0cmVhbShKREJDU3RvcmUgc3RvcmUsIFNlbGVjdCBzZWwpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIFNRTEJ1ZmZlciBzcWwgPSBzZWwu\ndG9TZWxlY3QodHJ1ZSwgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkp\nOwogICAgICAgIFJlc3VsdFNldCByZXMgPSBudWxsOwogICAgICAgIERlbGVn\nYXRpbmdDb25uZWN0aW9uIGNvbm4gPSAKICAgICAgICAgICAgKERlbGVnYXRp\nbmdDb25uZWN0aW9uKSBzdG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAg\nUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIHN0bW50ID0gc3FsLnByZXBhcmVTdGF0ZW1lbnQoY29u\nbiwgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCksCiAgICAgICAgICAg\nICAgICBSZXN1bHRTZXQuVFlQRV9TQ1JPTExfU0VOU0lUSVZFLCBSZXN1bHRT\nZXQuQ09OQ1VSX1VQREFUQUJMRSk7CiAgICAgICAgICAgIHJlcyA9IHN0bW50\nLmV4ZWN1dGVRdWVyeSgpOwogICAgICAgICAgICBpZiAoIXJlcy5uZXh0KCkp\nIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbihfbG9jLmdldCgic3RyZWFtLWV4Y2VwdGlvbiIpKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpbnQgb2lkID0gcmVzLmdldEludCgxKTsKICAgICAg\nICAgICAgaWYgKG9pZCAhPSAtMSkgewogICAgICAgICAgICAgICAgY29ubi5z\nZXRBdXRvQ29tbWl0KGZhbHNlKTsKICAgICAgICAgICAgICAgIFBHQ29ubmVj\ndGlvbiBwZ2Nvbm4gPSAoUEdDb25uZWN0aW9uKWNvbm4KICAgICAgICAgICAg\nICAgICAgICAuZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKTsKICAgICAgICAgICAg\nICAgIExhcmdlT2JqZWN0TWFuYWdlciBsb20gPSBwZ2Nvbm4uZ2V0TGFyZ2VP\nYmplY3RBUEkoKTsKICAgICAgICAgICAgICAgIGxvbS5kZWxldGUob2lkKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGlmIChyZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7IHJlcy5j\nbG9zZSAoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHt9CiAgICAgICAg\nICAgIGlmIChzdG1udCAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsg\nc3RtbnQuY2xvc2UgKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBlKSB7fQog\nICAgICAgICAgICBpZiAoY29ubiAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsgY29ubi5jbG9zZSAoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUp\nIHt9CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIENvbm5l\nY3Rpb24gd3JhcHBlciB0byB3b3JrIGFyb3VuZCB0aGUgcG9zdGdyZXMgZW1w\ndHkgcmVzdWx0IHNldCBidWcuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIFBvc3RncmVzQ29ubmVjdGlvbgogICAgICAgIGV4dGVuZHMgRGVs\nZWdhdGluZ0Nvbm5lY3Rpb24gewoKICAgICAgICBwcml2YXRlIGZpbmFsIFBv\nc3RncmVzRGljdGlvbmFyeSBfZGljdDsKCiAgICAgICAgcHVibGljIFBvc3Rn\ncmVzQ29ubmVjdGlvbihDb25uZWN0aW9uIGNvbm4sIFBvc3RncmVzRGljdGlv\nbmFyeSBkaWN0KSB7CiAgICAgICAgICAgIHN1cGVyKGNvbm4pOwogICAgICAg\nICAgICBfZGljdCA9IGRpY3Q7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0\nZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChTdHJpbmcg\nc3FsLCBib29sZWFuIHdyYXApCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3IFBvc3RncmVzUHJlcGFy\nZWRTdGF0ZW1lbnQoc3VwZXIucHJlcGFyZVN0YXRlbWVudAogICAgICAgICAg\nICAgICAgKHNxbCwgZmFsc2UpLCB0aGlzLCBfZGljdCk7CiAgICAgICAgfQoK\nICAgICAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0\nYXRlbWVudChTdHJpbmcgc3FsLCBpbnQgcnNUeXBlLAogICAgICAgICAgICBp\nbnQgcnNDb25jdXIsIGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUG9zdGdy\nZXNQcmVwYXJlZFN0YXRlbWVudChzdXBlci5wcmVwYXJlU3RhdGVtZW50CiAg\nICAgICAgICAgICAgICAoc3FsLCByc1R5cGUsIHJzQ29uY3VyLCBmYWxzZSks\nIHRoaXMsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTdGF0ZW1lbnQgd3JhcHBlciB0byB3b3JrIGFyb3VuZCB0aGUgcG9zdGdy\nZXMgZW1wdHkgcmVzdWx0IHNldCBidWcuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIFBvc3RncmVzUHJlcGFyZWRTdGF0ZW1lbnQKICAgICAg\nICBleHRlbmRzIERlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudCB7CgogICAg\nICAgIHByaXZhdGUgZmluYWwgUG9zdGdyZXNEaWN0aW9uYXJ5IF9kaWN0OwoK\nICAgICAgICBwdWJsaWMgUG9zdGdyZXNQcmVwYXJlZFN0YXRlbWVudChQcmVw\nYXJlZFN0YXRlbWVudCBwcywKICAgICAgICAgICAgQ29ubmVjdGlvbiBjb25u\nLCBQb3N0Z3Jlc0RpY3Rpb25hcnkgZGljdCkgewogICAgICAgICAgICBzdXBl\ncihwcywgY29ubik7CiAgICAgICAgICAgIF9kaWN0ID0gZGljdDsKICAgICAg\nICB9CgogICAgICAgIHByb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5\nKGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nc3VwZXIuZXhlY3V0ZVF1ZXJ5KHdyYXApOwogICAgICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIC8vIHdlIG5l\nZWQgdG8gbWFrZSBvdXIgYmVzdCBndWVzcyB3aGV0aGVyIHRoaXMgaXMgdGhl\nIGVtcHR5CiAgICAgICAgICAgICAgICAvLyBSZXN1bHRTZXQgYnVnLCBzaW5j\nZSB0aGlzIGV4Y2VwdGlvbiBjb3VsZCBvY2N1cgogICAgICAgICAgICAgICAg\nLy8gZm9yIG90aGVyIHJlYXNvbnMgKGxpa2UgYW4gaW52YWxpZCBxdWVyeSBz\ndHJpbmcpLiBOb3RlCiAgICAgICAgICAgICAgICAvLyB0aGF0IFBvc3RncmVz\nIGVycm9yIG1lc3NhZ2VzIGFyZSBsb2NhbGl6ZWQsIHNvIHdlCiAgICAgICAg\nICAgICAgICAvLyBjYW5ub3QganVzdCBwYXJzZSB0aGUgZXhjZXB0aW9uIFN0\ncmluZy4KICAgICAgICAgICAgICAgIFJlc3VsdFNldCBycyA9IGdldFJlc3Vs\ndFNldCh3cmFwKTsKCiAgICAgICAgICAgICAgICAvLyBSZXN1bHRTZXQgc2hv\ndWxkIGJlIGVtcHR5OiBpZiBub3QsIHRoZW4gbWF5YmUgYW4KICAgICAgICAg\nICAgICAgIC8vIGFjdHVhbCBlcnJvciBvY2N1cmVkCiAgICAgICAgICAgICAg\nICBpZiAocnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBz\nZTsKCiAgICAgICAgICAgICAgICByZXR1cm4gcnM7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldEZldGNoU2l6ZShp\nbnQgaSkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIC8vIHNvbWUgcG9zdGdyZXMgZHJpdmVycyBkbyBub3Qgc3VwcG9y\ndCB0aGUgc2V0RmV0Y2hTaXplIG1ldGhvZAogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgaWYgKF9kaWN0LnN1cHBvcnRzU2V0RmV0Y2hTaXpl\nKQogICAgICAgICAgICAgICAgICAgIHN1cGVyLnNldEZldGNoU2l6ZShpKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgIF9kaWN0LnN1cHBvcnRzU2V0RmV0Y2hTaXplID0gZmFsc2U7\nCiAgICAgICAgICAgICAgICBpZiAoX2RpY3QubG9nLmlzV2FybkVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgICAgICBfZGljdC5sb2cud2FybihfbG9jLmdl\ndCgicHNxbC1uby1zZXQtZmV0Y2gtc2l6ZSIpLCBlKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

