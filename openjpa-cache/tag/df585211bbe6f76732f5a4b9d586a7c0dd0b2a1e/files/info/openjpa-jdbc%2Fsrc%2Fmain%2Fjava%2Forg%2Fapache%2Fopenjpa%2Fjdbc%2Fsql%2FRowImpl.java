{"sha":"b59a47c531612cf92cf22d742f26a08e264bb62d","node_id":"MDQ6QmxvYjIwNjM2NDpiNTlhNDdjNTMxNjEyY2Y5MmNmMjJkNzQyZjI2YTA4ZTI2NGJiNjJk","size":29119,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b59a47c531612cf92cf22d742f26a08e264bb62d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uUmVhZGVyOwpp\nbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9ydCBqYXZhLm1hdGgu\nQmlnSW50ZWdlcjsKaW1wb3J0IGphdmEuc3FsLkFycmF5OwppbXBvcnQgamF2\nYS5zcWwuQmxvYjsKaW1wb3J0IGphdmEuc3FsLkNsb2I7CmltcG9ydCBqYXZh\nLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4\nY2VwdGlvbjsKaW1wb3J0IGphdmEuc3FsLlRpbWU7CmltcG9ydCBqYXZhLnNx\nbC5UaW1lc3RhbXA7CmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9y\ndCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5Mb2NhbGU7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9y\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5K\nYXZhU1FMVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLkpvaW5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5SZWxhdGlvbklkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS5Db2x1bW5JTzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBz\nZXJwLnV0aWwuTnVtYmVyczsKCi8qKgogKiBCYXNpYyB7QGxpbmsgUm93fSBp\nbXBsZW1lbnRhdGlvbi4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5v\namF2YWRvYwogKi8KcHVibGljIGNsYXNzIFJvd0ltcGwKICAgIGltcGxlbWVu\ndHMgUm93LCBDbG9uZWFibGUgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nT2JqZWN0IE5VTEwgPSBuZXcgT2JqZWN0KCk7CiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGZpbmFsIGludCBWQUxJRCA9IDIgPDwgMDsKCiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGludCBSQVcgPSBJbnRlZ2VyLk1JTl9WQUxVRTsKCiAgICBw\ncm90ZWN0ZWQgYnl0ZSBmbGFncyA9IDA7CiAgICBwcml2YXRlIGZpbmFsIENv\nbHVtbltdIF9jb2xzOwogICAgcHJpdmF0ZSBmaW5hbCBpbnQgX2FjdGlvbjsK\nICAgIHByaXZhdGUgZmluYWwgT2JqZWN0W10gX3ZhbHM7CiAgICBwcml2YXRl\nIGZpbmFsIGludFtdIF90eXBlczsKCiAgICBwcml2YXRlIFN0cmluZyBfc3Fs\nID0gbnVsbDsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLgogICAgICoK\nICAgICAqIEBwYXJhbSB0YWJsZSB0aGUgdGFibGUgdGhlIHJvdyBpcyBhIHBh\ncnQgb2YKICAgICAqIEBwYXJhbSBhY3Rpb24gdGhlIGFjdGlvbiBvbiB0aGUg\ncm93CiAgICAgKi8KICAgIHB1YmxpYyBSb3dJbXBsKFRhYmxlIHRhYmxlLCBp\nbnQgYWN0aW9uKSB7CiAgICAgICAgdGhpcyh0YWJsZS5nZXRDb2x1bW5zKCks\nIGFjdGlvbik7CiAgICB9CgogICAgcHJvdGVjdGVkIFJvd0ltcGwoQ29sdW1u\nW10gY29scywgaW50IGFjdGlvbikgewogICAgICAgIF9jb2xzID0gY29sczsK\nICAgICAgICBfYWN0aW9uID0gYWN0aW9uOwoKICAgICAgICAvLyB3ZSBuZWVk\nIHJvb20gZm9yIHZhbHVlcyBhbmQgdHlwZXMgZm9yIGFsbCBjb2x1bW5zOyBp\nZiBhbiB1cGRhdGUgb3IKICAgICAgICAvLyBkZWxldGUsIHRoZW4gd2UgbmVl\nZCB0byBkb3VibGUgdGhhdCBmb3Igd2hlcmUgY29sdW1uIGNvbmRpdGlvbnMK\nICAgICAgICBpbnQgbGVuID0gX2NvbHMubGVuZ3RoOwogICAgICAgIGlmIChh\nY3Rpb24gIT0gQUNUSU9OX0lOU0VSVCkKICAgICAgICAgICAgbGVuICo9IDI7\nCiAgICAgICAgX3ZhbHMgPSBuZXcgT2JqZWN0W2xlbl07CiAgICAgICAgX3R5\ncGVzID0gbmV3IGludFtsZW5dOwogICAgfQoKICAgIHB1YmxpYyBUYWJsZSBn\nZXRUYWJsZSgpIHsKICAgICAgICByZXR1cm4gX2NvbHNbMF0uZ2V0VGFibGUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0Q29sdW1ucygpIHsK\nICAgICAgICByZXR1cm4gX2NvbHM7CiAgICB9CgogICAgcHVibGljIGludCBn\nZXRBY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF9hY3Rpb247CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNWYWxpZCgpIHsKICAgICAgICByZXR1cm4g\nKGZsYWdzICYgVkFMSUQpICE9IDA7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0VmFsaWQoYm9vbGVhbiB2YWxpZCkgewogICAgICAgIGlmICh2YWxpZCkK\nICAgICAgICAgICAgZmxhZ3MgfD0gVkFMSUQ7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBmbGFncyAmPSB+VkFMSUQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGlzIGltcGxlbWVudGF0aW9uIGRvZXMgbm90IHRyYWNrIHByaW1hcnkg\na2V5cy4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nZ2V0UHJpbWFyeUtleSgpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoaXMgaW1wbGVtZW50YXRpb24gZG9lcyBub3Qg\ndHJhY2sgZmFpbGVkIG9iamVjdHMuCiAgICAgKi8KICAgIHB1YmxpYyBPYmpl\nY3QgZ2V0RmFpbGVkT2JqZWN0KCkgewogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhpcyBpbXBsZW1lbnRhdGlvbiBkb2Vz\nIG5vdCB0cmFjayBmYWlsZWQgb2JqZWN0cy4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0RmFpbGVkT2JqZWN0KE9iamVjdCBmYWlsZWQpIHsKICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNlY29uZGFyeSByb3dzIGNhbm5vdCBiZSBkZXBlbmRlbnQu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRGVwZW5kZW50KCkgewog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgdmFsdWUgc2V0IGZvciB1cGRhdGUgb24gdGhlIGdpdmVuIGNv\nbHVtbi4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBnZXRTZXQoQ29sdW1u\nIGNvbCkgewogICAgICAgIHJldHVybiBfdmFsc1tnZXRTZXRJbmRleChjb2wp\nXTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdmFsdWUgc2V0\nIGZvciB3aGVyZSBvbiB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBw\ndWJsaWMgT2JqZWN0IGdldFdoZXJlKENvbHVtbiBjb2wpIHsKICAgICAgICBy\nZXR1cm4gX3ZhbHNbZ2V0V2hlcmVJbmRleChjb2wpXTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRQcmltYXJ5S2V5KE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0\nUHJpbWFyeUtleShudWxsLCBzbSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0UHJpbWFyeUtleShDb2x1bW5JTyBpbywgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBm\nbHVzaFByaW1hcnlLZXkoc20sIGlvLCB0cnVlKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCB3aGVyZVByaW1hcnlLZXkoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBmbHVz\naFByaW1hcnlLZXkoc20sIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEZsdXNoIHRoZSBwcmltYXJ5IGtleSB2YWx1ZXMuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBmbHVzaFByaW1hcnlLZXkoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgQ29sdW1uSU8gaW8sCiAgICAgICAgYm9vbGVhbiBzZXQp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0\nYSgpOwogICAgICAgIHdoaWxlIChtYXBwaW5nLmdldFRhYmxlKCkgIT0gZ2V0\nVGFibGUoKSkKICAgICAgICAgICAgbWFwcGluZyA9IG1hcHBpbmcuZ2V0UENT\ndXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIENvbHVtbltdIGNvbHMgPSBt\nYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgZmx1c2hK\nb2luVmFsdWVzKHNtLCBjb2xzLCBjb2xzLCBpbywgc2V0KTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgc2V0Rm9yZWlnbktleShmaywgbnVsbCwgc20pOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEZvcmVpZ25LZXkoRm9yZWlnbktl\neSBmaywgQ29sdW1uSU8gaW8sCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBm\nbHVzaEZvcmVpZ25LZXkoZmssIGlvLCBzbSwgdHJ1ZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgd2hlcmVGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgZmx1c2hGb3JlaWduS2V5KGZrLCBudWxsLCBzbSwg\nZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYSBjaXJjdWxh\nciBmb3JlaWduIGtleS4KICAgICAqLwogICAgcHVibGljIHZvaWQgY2xlYXJG\nb3JlaWduS2V5KEZvcmVpZ25LZXkgZmspCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgX3NxbCA9IG51bGw7CiAgICAgICAgQ29sdW1u\nW10gY29scyA9IGZrLmdldENvbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIF92YWxz\nW2dldFNldEluZGV4KGNvbHNbaV0pXSA9IG51bGw7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBGbHVzaCB0aGUgZm9yZWlnbiBrZXkgdmFsdWVzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgZmx1c2hGb3JlaWduS2V5KEZvcmVpZ25LZXkg\nZmssIENvbHVtbklPIGlvLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIGJvb2xlYW4gc2V0KQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGZsdXNoSm9pblZhbHVlcyhzbSwgZmsuZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKSwgZmsuZ2V0Q29sdW1ucygpLAogICAgICAgICAgICBpbywg\nc2V0KTsKICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICBD\nb2x1bW5bXSBjb2xzID0gZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCk7CiAgICAg\nICAgICAgIGludCBsZW4gPSBmay5nZXRDb2x1bW5zKCkubGVuZ3RoOwogICAg\nICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBpbnQgdHlwZTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBvYmogPSBmay5nZXRDb25zdGFudChjb2xz\nW2ldKTsKICAgICAgICAgICAgICAgIHR5cGUgPSBjb2xzW2ldLmdldEphdmFU\neXBlKCk7CiAgICAgICAgICAgICAgICBpZiAoc2V0ICYmIGNhblNldChpbywg\naSArIGxlbiwgb2JqID09IG51bGwpKQogICAgICAgICAgICAgICAgICAgIHNl\ndE9iamVjdChjb2xzW2ldLCBvYmosIHR5cGUsIGZhbHNlKTsKICAgICAgICAg\nICAgICAgIGVsc2UgaWYgKCFzZXQpCiAgICAgICAgICAgICAgICAgICAgd2hl\ncmVPYmplY3QoY29sc1tpXSwgb2JqLCB0eXBlKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIHRoZSBnaXZl\nbiBpbnN0YW5jZSB2YWx1ZSB0byB0aGUgZ2l2ZW4gY29sdW1ucy4gTm90ZSB0\naGF0CiAgICAgKiBmb3JlaWduIGtleXMgbWF5IGluY2x1ZGUgY29sdW1ucyBh\nbHNvIG1hcHBlZCBieSBzaW1wbGUgdmFsdWVzLiBXZQogICAgICogdXNlIGEg\ncHJpb3JpdHkgbWVjaGFuaXNtIHRvIGVuc3VyZSB0aGF0IHdlIGRvIG5vdCBs\nZXQgdGhlIG51bGxpbmcKICAgICAqIG9mIGEgZm9yZWlnbiBrZXkgbnVsbCBj\nb2x1bW5zIGFsc28gb3duZWQgYnkgc2ltcGxlIHZhbHVlcy4KICAgICAqCiAg\nICAgKiBAcGFyYW0gdG8gdGhlIGluc3RhbmNlIGJlaW5nIGpvaW5lZCB0bwog\nICAgICogQHBhcmFtIHRvQ29scyB0aGUgY29sdW1ucyBiZWluZyBqb2luZWQg\ndG8KICAgICAqIEBwYXJhbSBmcm9tQ29scyB0aGUgY29sdW1ucyBiZWluZyBq\nb2luZWQgZnJvbQogICAgICogQHBhcmFtIGlvIGluZm9ybWF0aW9uIGFib3V0\nIEkvTyBjYXBhYmlsaXRpZXMgaW4gdGhpcyBjb250ZXh0CiAgICAgKiBAcGFy\nYW0gc2V0IHdoZXRoZXIgdGhpcyBzaG91bGQgYmUgZmx1c2hlZCBhcyBhbiB1\ncGRhdGUgb3IKICAgICAqIGFzIGEgd2hlcmUgY29uZGl0aW9uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBmbHVzaEpvaW5WYWx1ZXMoT3BlbkpQQVN0YXRl\nTWFuYWdlciB0bywgQ29sdW1uW10gdG9Db2xzLAogICAgICAgIENvbHVtbltd\nIGZyb21Db2xzLCBDb2x1bW5JTyBpbywgYm9vbGVhbiBzZXQpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHRvID09IG51bGwp\nIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmcm9tQ29scy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHNldCAmJiBjYW5T\nZXQoaW8sIGksIHRydWUpKQogICAgICAgICAgICAgICAgICAgIHNldE51bGwo\nZnJvbUNvbHNbaV0pOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoIXNldCkK\nICAgICAgICAgICAgICAgICAgICB3aGVyZU51bGwoZnJvbUNvbHNbaV0pOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAg\nICAgICAgaWYgKHNldCAmJiAhY2FuU2V0QW55KGlvLCBmcm9tQ29scy5sZW5n\ndGgsIGZhbHNlKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBDbGFz\nc01hcHBpbmcgdG9NYXBwaW5nID0gKENsYXNzTWFwcGluZykgdG8uZ2V0TWV0\nYURhdGEoKTsKICAgICAgICBKb2luYWJsZSBqb2luOwogICAgICAgIE9iamVj\ndCB2YWw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0b0NvbHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gZG9uJ3QgZXZlbiB0cmFuc2xh\ndGUgam9pbiB2YWx1ZSBpZiB1bnNldHRhYmxlCiAgICAgICAgICAgIGlmIChz\nZXQpIHsKICAgICAgICAgICAgICAgIGlmIChfYWN0aW9uID09IEFDVElPTl9J\nTlNFUlQgJiYgZnJvbUNvbHNbaV0uaXNBdXRvQXNzaWduZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmICgh\nY2FuU2V0KGlvLCBpLCBmYWxzZSkpCiAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGpvaW4gPSB0b01h\ncHBpbmcuYXNzZXJ0Sm9pbmFibGUodG9Db2xzW2ldKTsKICAgICAgICAgICAg\ndmFsID0gam9pbi5nZXRKb2luVmFsdWUodG8sIHRvQ29sc1tpXSwgKEpEQkNT\ndG9yZSkgdG8uCiAgICAgICAgICAgICAgICBnZXRDb250ZXh0KCkuZ2V0U3Rv\ncmVNYW5hZ2VyKCkuZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKSk7CiAgICAgICAg\nICAgIGlmIChzZXQgJiYgdmFsID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGlmIChjYW5TZXQoaW8sIGksIHRydWUpKQogICAgICAgICAgICAgICAgICAg\nIHNldE51bGwoZnJvbUNvbHNbaV0pOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKHNldCAmJiB2YWwgaW5zdGFuY2VvZiBSYXcpCiAgICAgICAgICAgICAgICBz\nZXRSYXcoZnJvbUNvbHNbaV0sIHZhbC50b1N0cmluZygpKTsKICAgICAgICAg\nICAgZWxzZSBpZiAoc2V0KQogICAgICAgICAgICAgICAgc2V0T2JqZWN0KGZy\nb21Db2xzW2ldLCB2YWwsIHRvQ29sc1tpXS5nZXRKYXZhVHlwZSgpLCBmYWxz\nZSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHZhbCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgd2hlcmVOdWxsKGZyb21Db2xzW2ldKTsKICAgICAgICAgICAg\nZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgUmF3KQogICAgICAgICAgICAgICAg\nd2hlcmVSYXcoZnJvbUNvbHNbaV0sIHZhbC50b1N0cmluZygpKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgd2hlcmVPYmplY3QoZnJvbUNv\nbHNbaV0sIHZhbCwgdG9Db2xzW2ldLmdldEphdmFUeXBlKCkpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIGFueSBv\nZiB0aGUgZ2l2ZW4gY29sdW1uIGluZGV4ZXMgYXJlIHNldHRhYmxlLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjYW5TZXRBbnkoQ29sdW1uSU8g\naW8sIGludCBpLCBib29sZWFuIG51bGxWYWx1ZSkgewogICAgICAgIGlmIChp\nbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBp\nZiAoX2FjdGlvbiA9PSBBQ1RJT05fSU5TRVJUKQogICAgICAgICAgICByZXR1\ncm4gaW8uaXNBbnlJbnNlcnRhYmxlKGksIG51bGxWYWx1ZSk7CiAgICAgICAg\naWYgKF9hY3Rpb24gPT0gQUNUSU9OX1VQREFURSkKICAgICAgICAgICAgcmV0\ndXJuIGlvLmlzQW55VXBkYXRhYmxlKGksIG51bGxWYWx1ZSk7CiAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1\nZSBpZiB0aGUgZ2l2ZW4gY29sdW1uIGluZGV4IGlzIHNldHRhYmxlLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjYW5TZXQoQ29sdW1uSU8gaW8s\nIGludCBpLCBib29sZWFuIG51bGxWYWx1ZSkgewogICAgICAgIGlmIChpbyA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAo\nX2FjdGlvbiA9PSBBQ1RJT05fSU5TRVJUKQogICAgICAgICAgICByZXR1cm4g\naW8uaXNJbnNlcnRhYmxlKGksIG51bGxWYWx1ZSk7CiAgICAgICAgaWYgKF9h\nY3Rpb24gPT0gQUNUSU9OX1VQREFURSkKICAgICAgICAgICAgcmV0dXJuIGlv\nLmlzVXBkYXRhYmxlKGksIG51bGxWYWx1ZSk7CiAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVsYXRpb25JZChDb2x1\nbW4gY29sLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIFJlbGF0\naW9uSWQgcmVsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHNldE9iamVjdChjb2wsIHJlbC50b1JlbGF0aW9uRGF0YVN0b3JlVmFs\ndWUoc20sIGNvbCksCiAgICAgICAgICAgIGNvbC5nZXRKYXZhVHlwZSgpLCBm\nYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhIGNpcmN1bGFy\nIHJlbGF0aW9uIGlkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbGVhclJl\nbGF0aW9uSWQoQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBfc3FsID0gbnVsbDsKICAgICAgICBfdmFsc1tnZXRT\nZXRJbmRleChjb2wpXSA9IG51bGw7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0QXJyYXkoQ29sdW1uIGNvbCwgQXJyYXkgdmFsKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChjb2wsIHZhbCwg\nSmF2YVNRTFR5cGVzLkFSUkFZLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0QXNjaWlTdHJlYW0oQ29sdW1uIGNvbCwgSW5wdXRTdHJlYW0g\ndmFsLCBpbnQgbGVuZ3RoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHNldE9iamVjdChjb2wsICh2YWwgPT0gbnVsbCkgPyBudWxs\nIDogbmV3IFNpemVkKHZhbCwgbGVuZ3RoKSwKICAgICAgICAgICAgSmF2YVNR\nTFR5cGVzLkFTQ0lJX1NUUkVBTSwgZmFsc2UpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldEJpZ0RlY2ltYWwoQ29sdW1uIGNvbCwgQmlnRGVjaW1hbCB2\nYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0\nT2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMuQklHREVDSU1BTCwgZmFsc2Up\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEJpZ0ludGVnZXIoQ29sdW1u\nIGNvbCwgQmlnSW50ZWdlciB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMu\nQklHSU5URUdFUiwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndEJpbmFyeVN0cmVhbShDb2x1bW4gY29sLCBJbnB1dFN0cmVhbSB2YWwsIGlu\ndCBsZW5ndGgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgc2V0T2JqZWN0KGNvbCwgKHZhbCA9PSBudWxsKSA/IG51bGwgOiBuZXcg\nU2l6ZWQodmFsLCBsZW5ndGgpLAogICAgICAgICAgICBKYXZhU1FMVHlwZXMu\nQklOQVJZX1NUUkVBTSwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldEJsb2IoQ29sdW1uIGNvbCwgQmxvYiB2YWwpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBK\nYXZhU1FMVHlwZXMuQkxPQiwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldEJvb2xlYW4oQ29sdW1uIGNvbCwgYm9vbGVhbiB2YWwpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNv\nbCwgKCh2YWwpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRSksCiAg\nICAgICAgICAgIEphdmFUeXBlcy5CT09MRUFOLCBmYWxzZSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0Qnl0ZShDb2x1bW4gY29sLCBieXRlIHZhbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRPYmpl\nY3QoY29sLCBuZXcgQnl0ZSh2YWwpLCBKYXZhVHlwZXMuQllURSwgZmFsc2Up\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEJ5dGVzKENvbHVtbiBjb2ws\nIGJ5dGVbXSB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBKYXZhU1FMVHlwZXMuQllURVMs\nIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDYWxlbmRhcihD\nb2x1bW4gY29sLCBDYWxlbmRhciB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlw\nZXMuQ0FMRU5EQVIsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRDaGFyKENvbHVtbiBjb2wsIGNoYXIgdmFsKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChjb2wsIG5ldyBDaGFy\nYWN0ZXIodmFsKSwgSmF2YVR5cGVzLkNIQVIsIGZhbHNlKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRDaGFyYWN0ZXJTdHJlYW0oQ29sdW1uIGNvbCwg\nUmVhZGVyIHZhbCwgaW50IGxlbmd0aCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCAodmFsID09IG51bGwp\nID8gbnVsbCA6IG5ldyBTaXplZCh2YWwsIGxlbmd0aCksCiAgICAgICAgICAg\nIEphdmFTUUxUeXBlcy5DSEFSX1NUUkVBTSwgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldENsb2IoQ29sdW1uIGNvbCwgQ2xvYiB2YWwpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0\nKGNvbCwgdmFsLCBKYXZhU1FMVHlwZXMuQ0xPQiwgZmFsc2UpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldERhdGUoQ29sdW1uIGNvbCwgRGF0ZSB2YWwp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2Jq\nZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMuREFURSwgZmFsc2UpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldERhdGUoQ29sdW1uIGNvbCwgamF2YS5zcWwu\nRGF0ZSB2YWwsIENhbGVuZGFyIGNhbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgIGlmICh2YWwg\nPT0gbnVsbCB8fCBjYWwgPT0gbnVsbCkKICAgICAgICAgICAgb2JqID0gdmFs\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgb2JqID0gbmV3IENhbGVuZGFy\nZCh2YWwsIGNhbCk7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgb2JqLCBKYXZh\nU1FMVHlwZXMuU1FMX0RBVEUsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXREb3VibGUoQ29sdW1uIGNvbCwgZG91YmxlIHZhbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3QoY29s\nLCBuZXcgRG91YmxlKHZhbCksIEphdmFUeXBlcy5ET1VCTEUsIGZhbHNlKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRGbG9hdChDb2x1bW4gY29sLCBm\nbG9hdCB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgc2V0T2JqZWN0KGNvbCwgbmV3IEZsb2F0KHZhbCksIEphdmFUeXBlcy5G\nTE9BVCwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEludChD\nb2x1bW4gY29sLCBpbnQgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHNldE9iamVjdChjb2wsIE51bWJlcnMudmFsdWVPZih2\nYWwpLCBKYXZhVHlwZXMuSU5ULCBmYWxzZSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0TG9uZyhDb2x1bW4gY29sLCBsb25nIHZhbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCBO\ndW1iZXJzLnZhbHVlT2YodmFsKSwgSmF2YVR5cGVzLkxPTkcsIGZhbHNlKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRMb2NhbGUoQ29sdW1uIGNvbCwg\nTG9jYWxlIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBzZXRPYmplY3QoY29sLCB2YWwsIEphdmFUeXBlcy5MT0NBTEUsIGZh\nbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROdWxsKENvbHVtbiBj\nb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0\nTnVsbChjb2wsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRO\ndWxsKENvbHVtbiBjb2wsIGJvb2xlYW4gb3ZlcnJpZGVEZWZhdWx0KQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChj\nb2wsIG51bGwsIGNvbC5nZXRKYXZhVHlwZSgpLCBvdmVycmlkZURlZmF1bHQp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE51bWJlcihDb2x1bW4gY29s\nLCBOdW1iZXIgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHNldE9iamVjdChjb2wsIHZhbCwgSmF2YVR5cGVzLk5VTUJFUiwg\nZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJhdyhDb2x1bW4g\nY29sLCBTdHJpbmcgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHNldE9iamVjdChjb2wsIHZhbCwgUkFXLCBmYWxzZSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0U2hvcnQoQ29sdW1uIGNvbCwgc2hv\ncnQgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHNldE9iamVjdChjb2wsIG5ldyBTaG9ydCh2YWwpLCBKYXZhVHlwZXMuU0hP\nUlQsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTdHJpbmco\nQ29sdW1uIGNvbCwgU3RyaW5nIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCB2YWwsIEphdmFUeXBl\ncy5TVFJJTkcsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRU\naW1lKENvbHVtbiBjb2wsIFRpbWUgdmFsLCBDYWxlbmRhciBjYWwpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IG9iajsK\nICAgICAgICBpZiAodmFsID09IG51bGwgfHwgY2FsID09IG51bGwpCiAgICAg\nICAgICAgIG9iaiA9IHZhbDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG9i\naiA9IG5ldyBDYWxlbmRhcmQodmFsLCBjYWwpOwogICAgICAgIHNldE9iamVj\ndChjb2wsIG9iaiwgSmF2YVNRTFR5cGVzLlRJTUUsIGZhbHNlKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRUaW1lc3RhbXAoQ29sdW1uIGNvbCwgVGlt\nZXN0YW1wIHZhbCwgQ2FsZW5kYXIgY2FsKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgaWYgKHZh\nbCA9PSBudWxsIHx8IGNhbCA9PSBudWxsKQogICAgICAgICAgICBvYmogPSB2\nYWw7CiAgICAgICAgZWxzZQogICAgICAgICAgICBvYmogPSBuZXcgQ2FsZW5k\nYXJkKHZhbCwgY2FsKTsKICAgICAgICBzZXRPYmplY3QoY29sLCBvYmosIEph\ndmFTUUxUeXBlcy5USU1FU1RBTVAsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRPYmplY3QoQ29sdW1uIGNvbCwgT2JqZWN0IHZhbCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodmFsIGlu\nc3RhbmNlb2YgUmF3KQogICAgICAgICAgICBzZXRPYmplY3QoY29sLCB2YWws\nIFJBVywgZmFsc2UpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0T2Jq\nZWN0KGNvbCwgdmFsLCBjb2wuZ2V0SmF2YVR5cGUoKSwgZmFsc2UpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlQXJyYXkoQ29sdW1uIGNvbCwgQXJy\nYXkgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhU1FMVHlwZXMuU1FMX0FSUkFZ\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUFzY2lpU3RyZWFtKENv\nbHVtbiBjb2wsIElucHV0U3RyZWFtIHZhbCwgaW50IGxlbmd0aCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChj\nb2wsICh2YWwgPT0gbnVsbCkgPyBudWxsIDogbmV3IFNpemVkKHZhbCwgbGVu\nZ3RoKSwKICAgICAgICAgICAgSmF2YVNRTFR5cGVzLkFTQ0lJX1NUUkVBTSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVCaWdEZWNpbWFsKENvbHVt\nbiBjb2wsIEJpZ0RlY2ltYWwgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlw\nZXMuQklHREVDSU1BTCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVC\naWdJbnRlZ2VyKENvbHVtbiBjb2wsIEJpZ0ludGVnZXIgdmFsKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNv\nbCwgdmFsLCBKYXZhVHlwZXMuQklHSU5URUdFUik7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgd2hlcmVCaW5hcnlTdHJlYW0oQ29sdW1uIGNvbCwgSW5wdXRT\ndHJlYW0gdmFsLCBpbnQgbGVuZ3RoKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgKHZhbCA9PSBudWxs\nKSA/IG51bGwgOiBuZXcgU2l6ZWQodmFsLCBsZW5ndGgpLAogICAgICAgICAg\nICBKYXZhU1FMVHlwZXMuQklOQVJZX1NUUkVBTSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgd2hlcmVCbG9iKENvbHVtbiBjb2wsIEJsb2IgdmFsKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0\nKGNvbCwgdmFsLCBKYXZhU1FMVHlwZXMuQkxPQik7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgd2hlcmVCb29sZWFuKENvbHVtbiBjb2wsIGJvb2xlYW4gdmFs\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJl\nT2JqZWN0KGNvbCwgKCh2YWwpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRSksCiAgICAgICAgICAgIEphdmFUeXBlcy5CT09MRUFOKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB3aGVyZUJ5dGUoQ29sdW1uIGNvbCwgYnl0ZSB2\nYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgd2hl\ncmVPYmplY3QoY29sLCBuZXcgQnl0ZSh2YWwpLCBKYXZhVHlwZXMuQllURSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVCeXRlcyhDb2x1bW4gY29s\nLCBieXRlW10gdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhU1FMVHlwZXMuQllU\nRVMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlQ2FsZW5kYXIoQ29s\ndW1uIGNvbCwgQ2FsZW5kYXIgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlw\nZXMuQ0FMRU5EQVIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlQ2hh\ncihDb2x1bW4gY29sLCBjaGFyIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIG5ldyBDaGFyYWN0\nZXIodmFsKSwgSmF2YVR5cGVzLkNIQVIpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHdoZXJlQ2hhcmFjdGVyU3RyZWFtKENvbHVtbiBjb2wsIFJlYWRlciB2\nYWwsIGludCBsZW5ndGgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgd2hlcmVPYmplY3QoY29sLCAodmFsID09IG51bGwpID8gbnVs\nbCA6IG5ldyBTaXplZCh2YWwsIGxlbmd0aCksCiAgICAgICAgICAgIEphdmFT\nUUxUeXBlcy5DSEFSX1NUUkVBTSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nd2hlcmVDbG9iKENvbHVtbiBjb2wsIENsb2IgdmFsKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFs\nLCBKYXZhU1FMVHlwZXMuQ0xPQik7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nd2hlcmVEYXRlKENvbHVtbiBjb2wsIERhdGUgdmFsKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFs\nLCBKYXZhVHlwZXMuREFURSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hl\ncmVEYXRlKENvbHVtbiBjb2wsIGphdmEuc3FsLkRhdGUgdmFsLCBDYWxlbmRh\nciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nT2JqZWN0IG9iajsKICAgICAgICBpZiAodmFsID09IG51bGwgfHwgY2FsID09\nIG51bGwpCiAgICAgICAgICAgIG9iaiA9IHZhbDsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIG9iaiA9IG5ldyBDYWxlbmRhcmQodmFsLCBjYWwpOwogICAg\nICAgIHdoZXJlT2JqZWN0KGNvbCwgb2JqLCBKYXZhU1FMVHlwZXMuU1FMX0RB\nVEUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlRG91YmxlKENvbHVt\nbiBjb2wsIGRvdWJsZSB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgd2hlcmVPYmplY3QoY29sLCBuZXcgRG91YmxlKHZhbCks\nIEphdmFUeXBlcy5ET1VCTEUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdo\nZXJlRmxvYXQoQ29sdW1uIGNvbCwgZmxvYXQgdmFsKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgbmV3\nIEZsb2F0KHZhbCksIEphdmFUeXBlcy5GTE9BVCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgd2hlcmVJbnQoQ29sdW1uIGNvbCwgaW50IHZhbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChj\nb2wsIE51bWJlcnMudmFsdWVPZih2YWwpLCBKYXZhVHlwZXMuSU5UKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUxvbmcoQ29sdW1uIGNvbCwgbG9u\nZyB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nd2hlcmVPYmplY3QoY29sLCBOdW1iZXJzLnZhbHVlT2YodmFsKSwgSmF2YVR5\ncGVzLkxPTkcpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlTG9jYWxl\nKENvbHVtbiBjb2wsIExvY2FsZSB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgd2hlcmVPYmplY3QoY29sLCB2YWwsIEphdmFU\neXBlcy5MT0NBTEUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlTnVs\nbChDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgbnVsbCwgY29sLmdldEphdmFUeXBl\nKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlTnVtYmVyKENvbHVt\nbiBjb2wsIE51bWJlciB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgd2hlcmVPYmplY3QoY29sLCB2YWwsIEphdmFUeXBlcy5O\nVU1CRVIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlUmF3KENvbHVt\nbiBjb2wsIFN0cmluZyB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgd2hlcmVPYmplY3QoY29sLCB2YWwsIFJBVyk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgd2hlcmVTaG9ydChDb2x1bW4gY29sLCBzaG9y\ndCB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nd2hlcmVPYmplY3QoY29sLCBuZXcgU2hvcnQodmFsKSwgSmF2YVR5cGVzLlNI\nT1JUKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZVN0cmluZyhDb2x1\nbW4gY29sLCBTdHJpbmcgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMu\nU1RSSU5HKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZVRpbWUoQ29s\ndW1uIGNvbCwgVGltZSB2YWwsIENhbGVuZGFyIGNhbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBPYmplY3Qgb2JqOwogICAgICAg\nIGlmICh2YWwgPT0gbnVsbCB8fCBjYWwgPT0gbnVsbCkKICAgICAgICAgICAg\nb2JqID0gdmFsOwogICAgICAgIGVsc2UKICAgICAgICAgICAgb2JqID0gbmV3\nIENhbGVuZGFyZCh2YWwsIGNhbCk7CiAgICAgICAgd2hlcmVPYmplY3QoY29s\nLCBvYmosIEphdmFTUUxUeXBlcy5USU1FKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCB3aGVyZVRpbWVzdGFtcChDb2x1bW4gY29sLCBUaW1lc3RhbXAgdmFs\nLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICBpZiAodmFsID09IG51bGwg\nfHwgY2FsID09IG51bGwpCiAgICAgICAgICAgIG9iaiA9IHZhbDsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIG9iaiA9IG5ldyBDYWxlbmRhcmQodmFsLCBj\nYWwpOwogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgb2JqLCBKYXZhU1FMVHlw\nZXMuVElNRVNUQU1QKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZU9i\namVjdChDb2x1bW4gY29sLCBPYmplY3QgdmFsKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBSYXcp\nCiAgICAgICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBSQVcpOwogICAg\nICAgIGVsc2UKICAgICAgICAgICAgd2hlcmVPYmplY3QoY29sLCB2YWwsIGNv\nbC5nZXRKYXZhVHlwZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbCBz\nZXQgY29sdW1uIG1ldGhvZHMgZGVsZWdhdGUgdG8gdGhpcyBvbmUuIFNldCB0\naGUgZ2l2ZW4gb2JqZWN0CiAgICAgKiB1bmxlc3MgdGhpcyBpcyBhbiBpbnNl\ncnQgYW5kIHRoZSBnaXZlbiBjb2x1bW4gaXMgYXV0by1hc3NpZ25lZC4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2V0T2JqZWN0KENvbHVtbiBjb2ws\nIE9iamVjdCB2YWwsIGludCBtZXRhVHlwZSwKICAgICAgICBib29sZWFuIG92\nZXJyaWRlRGVmYXVsdCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBuZXZlciBzZXQgYXV0byBpbmNyZW1lbnQgY29sdW1ucyBh\nbmQgaG9ub3IgY29sdW1uIGRlZmF1bHRzCiAgICAgICAgaWYgKF9hY3Rpb24g\nPT0gQUNUSU9OX0lOU0VSVCkgewogICAgICAgICAgICBpZiAoY29sLmlzQXV0\nb0Fzc2lnbmVkKCkpIHsKICAgICAgICAgICAgCS8vIE9QRU5KUEEtMzQ5OiB2\nYWxpZGF0ZSBiZWNhdXNlIHRoaXMgY2FuIGJlIHRoZSBvbmx5IGNvbHVtbgog\nICAgICAgICAgICAJc2V0VmFsaWQodHJ1ZSk7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFvdmVycmlk\nZURlZmF1bHQgJiYgdmFsID09IG51bGwgCiAgICAgICAgICAgICAgICAmJiBj\nb2wuZ2V0RGVmYXVsdFN0cmluZygpICE9IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh2YWwgPT0gbnVsbCAm\nJiBjb2wuaXNOb3ROdWxsKCkpCiAgICAgICAgICAgIHZhbCA9IEphdmFTUUxU\neXBlcy5nZXRFbXB0eVZhbHVlKGNvbC5nZXRKYXZhVHlwZSgpKTsKICAgICAg\nICBmbHVzaChjb2wsIHZhbCwgbWV0YVR5cGUsIHRydWUpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWxsIHdoZXJlIGNvbHVtbiBtZXRob2RzIGRlbGVnYXRl\nIHRvIHRoaXMgb25lLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCB3aGVy\nZU9iamVjdChDb2x1bW4gY29sLCBPYmplY3QgdmFsLCBpbnQgbWV0YVR5cGUp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZmx1c2go\nY29sLCB2YWwsIG1ldGFUeXBlLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBGbHVzaCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBzZXQgb3Igd2hlcmUg\nY29uZGl0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZmx1c2goQ29s\ndW1uIGNvbCwgT2JqZWN0IHZhbCwgaW50IG1ldGFUeXBlLCBib29sZWFuIHNl\ndCkgewogICAgICAgIGludCBpZHggPSAoc2V0KSA/IGdldFNldEluZGV4KGNv\nbCkgOiBnZXRXaGVyZUluZGV4KGNvbCk7CiAgICAgICAgX3R5cGVzW2lkeF0g\nPSBtZXRhVHlwZTsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAg\nICAgIF92YWxzW2lkeF0gPSBOVUxMOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX3ZhbHNbaWR4XSA9IHZhbDsKICAgICAgICBpZiAoc2V0IHx8IF9hY3Rp\nb24gPT0gQUNUSU9OX0RFTEVURSkKICAgICAgICAgICAgc2V0VmFsaWQodHJ1\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBmb3Ig\ndGhlIG9wZXJhdGlvbiBvbiB0aGlzIHJvdy4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZyBnZXRTUUwoREJEaWN0aW9uYXJ5IGRpY3QpIHsKICAgICAgICBp\nZiAoIWlzVmFsaWQoKSkKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAg\nIGlmIChfc3FsID09IG51bGwpCiAgICAgICAgICAgIF9zcWwgPSBnZW5lcmF0\nZVNRTChkaWN0KTsKICAgICAgICByZXR1cm4gX3NxbDsKICAgIH0KCiAgICAv\nKioKICAgICAqIEdlbmVyYXRlIHRoZSBTUUwgZm9yIHRoaXMgcm93OyB0aGUg\ncmVzdWx0IG9mIHRoaXMgbWV0aG9kIGlzIGNhY2hlZC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFN0cmluZyBnZW5lcmF0ZVNRTChEQkRpY3Rpb25hcnkgZGlj\ndCkgewogICAgICAgIHN3aXRjaCAoZ2V0QWN0aW9uKCkpIHsKICAgICAgICAg\nICAgY2FzZSBBQ1RJT05fVVBEQVRFOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFVwZGF0ZVNRTChkaWN0KTsKICAgICAgICAgICAgY2FzZSBBQ1RJT05f\nSU5TRVJUOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldEluc2VydFNRTChk\naWN0KTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXREZWxldGVTUUwoZGljdCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBTUUwgZm9yIGEgcHJlcGFyZWQgc3Rh\ndGVtZW50IHVwZGF0ZSBvbiB0aGlzIHJvdy4KICAgICAqLwogICAgcHJpdmF0\nZSBTdHJpbmcgZ2V0VXBkYXRlU1FMKERCRGljdGlvbmFyeSBkaWN0KSB7CiAg\nICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsK\nICAgICAgICBidWYuYXBwZW5kKCJVUERBVEUgIikuYXBwZW5kKGRpY3QuZ2V0\nRnVsbE5hbWUoZ2V0VGFibGUoKSwgZmFsc2UpKS4KICAgICAgICAgICAgYXBw\nZW5kKCIgU0VUICIpOwoKICAgICAgICBib29sZWFuIGhhc1ZhbCA9IGZhbHNl\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2NvbHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKF92YWxzW2ldID09IG51bGwpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChoYXNWYWwp\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAgICAg\nICBidWYuYXBwZW5kKF9jb2xzW2ldKTsKICAgICAgICAgICAgaWYgKF90eXBl\nc1tpXSA9PSBSQVcpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgPSAi\nKS5hcHBlbmQoX3ZhbHNbaV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKCIgPSA/Iik7CiAgICAgICAgICAgIGhhc1Zh\nbCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBhcHBlbmRXaGVyZShidWYs\nIGRpY3QpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgU1FMIGZvciBhIHByZXBhcmVk\nIHN0YXRlbWVudCBpbnNlcnQgb24gdGhpcyByb3cuCiAgICAgKi8KICAgIHBy\naXZhdGUgU3RyaW5nIGdldEluc2VydFNRTChEQkRpY3Rpb25hcnkgZGljdCkg\newogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVy\nKCk7CiAgICAgICAgU3RyaW5nQnVmZmVyIHZhbHMgPSBuZXcgU3RyaW5nQnVm\nZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiSU5TRVJUIElOVE8gIikuCiAg\nICAgICAgICAgIGFwcGVuZChkaWN0LmdldEZ1bGxOYW1lKGdldFRhYmxlKCks\nIGZhbHNlKSkuYXBwZW5kKCIgKCIpOwoKICAgICAgICBib29sZWFuIGhhc1Zh\nbCA9IGZhbHNlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2NvbHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKF92YWxzW2ldID09IG51\nbGwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlm\nIChoYXNWYWwpIHsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7\nCiAgICAgICAgICAgICAgICB2YWxzLmFwcGVuZCgiLCAiKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBidWYuYXBwZW5kKF9jb2xzW2ldKTsKICAgICAg\nICAgICAgaWYgKF90eXBlc1tpXSA9PSBSQVcpCiAgICAgICAgICAgICAgICB2\nYWxzLmFwcGVuZChfdmFsc1tpXSk7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIHZhbHMuYXBwZW5kKCI/Iik7CiAgICAgICAgICAgIGhhc1Zh\nbCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBidWYuYXBwZW5kKCIpIFZB\nTFVFUyAoIikuYXBwZW5kKHZhbHMudG9TdHJpbmcoKSkuYXBwZW5kKCIpIik7\nCiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBTUUwgZm9yIGEgcHJlcGFyZWQgc3RhdGVt\nZW50IGRlbGV0ZSBvbiB0aGlzIHJvdy4KICAgICAqLwogICAgcHJpdmF0ZSBT\ndHJpbmcgZ2V0RGVsZXRlU1FMKERCRGljdGlvbmFyeSBkaWN0KSB7CiAgICAg\nICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAg\nICAgICBidWYuYXBwZW5kKCJERUxFVEUgRlJPTSAiKS4KICAgICAgICAgICAg\nYXBwZW5kKGRpY3QuZ2V0RnVsbE5hbWUoZ2V0VGFibGUoKSwgZmFsc2UpKTsK\nICAgICAgICBhcHBlbmRXaGVyZShidWYsIGRpY3QpOwogICAgICAgIHJldHVy\nbiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVu\nZHMgdGhlIHdoZXJlIGNsYXVzZSBvbnRvIHRoZSBnaXZlbiBzcWwgYnVmZmVy\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXBwZW5kV2hlcmUoU3RyaW5n\nQnVmZmVyIGJ1ZiwgREJEaWN0aW9uYXJ5IGRpY3QpIHsKICAgICAgICBib29s\nZWFuIGhhc1doZXJlID0gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBfY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoX3Zh\nbHNbZ2V0V2hlcmVJbmRleChfY29sc1tpXSldID09IG51bGwpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmICghaGFzV2hlcmUp\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgV0hFUkUgIik7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQg\nIik7CgogICAgICAgICAgICAvLyBHZXQgcGxhdGZvcm0gc3BlY2lmaWMgdmVy\nc2lvbiBjb2x1bW4gbmFtZQogICAgICAgICAgICBpZiAoX2NvbHNbaV0uZ2V0\nVmVyc2lvblN0cmF0ZWd5KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZChkaWN0LmdldFZlcnNpb25Db2x1bW4oX2NvbHNbaV0sIF9jb2xz\nW2ldCiAgICAgICAgICAgICAgICAgICAuZ2V0VGFibGVOYW1lKCkpKS5hcHBl\nbmQoIiA9ID8iKTsKICAgICAgICAgICAgLy8gc3Fsc2VydmVyIHNlZW1zIHRv\nIGhhdmUgcHJvYmxlbXMgdXNpbmcgbnVsbCBwYXJhbWV0ZXJzIGluIHRoZQog\nICAgICAgICAgICAvLyB3aGVyZSBjbGF1c2UKICAgICAgICAgICAgZWxzZSBp\nZiAoX3ZhbHNbZ2V0V2hlcmVJbmRleChfY29sc1tpXSldID09IE5VTEwpCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKF9jb2xzW2ldKS5hcHBlbmQoIiBJ\nUyBOVUxMIik7CiAgICAgICAgICAgIGVsc2UgaWYgKF90eXBlc1tpXSA9PSBS\nQVcpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKF9jb2xzW2ldKS5hcHBl\nbmQoIiA9ICIpLmFwcGVuZChfdmFsc1tpXSk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoX2NvbHNbaV0pLmFwcGVuZCgi\nID0gPyIpOwogICAgICAgICAgICBoYXNXaGVyZSA9IHRydWU7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGhlIG51bWJlciBvZiBwYXJhbWV0\nZXJzIHRoYXQgd2lsbCBiZSBzZXQgZm9yIHRoaXMgcm93LgogICAgICovCiAg\nICBwdWJsaWMgaW50IGdldFBhcmFtZXRlckNvdW50KCkgewogICAgICAgIHJl\ndHVybiBfdmFscy5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVz\naCB0aGUgcm93J3MgdmFsdWVzIHRvIHRoZSBnaXZlbiBwcmVwYXJlZCBzdGF0\nZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGZsdXNoKFByZXBhcmVk\nU3RhdGVtZW50IHN0bW50LCBEQkRpY3Rpb25hcnkgZGljdCwKICAgICAgICBK\nREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgZmx1c2goc3RtbnQsIDEsIGRpY3QsIHN0b3JlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEZsdXNoIHRoZSByb3cncyB2YWx1ZXMgdG8gdGhl\nIGdpdmVuIHByZXBhcmVkIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgZmx1c2goUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgs\nIERCRGljdGlvbmFyeSBkaWN0LAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKCiAgICAgICAgLy8gdGhp\ncyBzaW1wbGUgbWV0aG9kIHdvcmtzIGJlY2F1c2UgdGhlIFNRTCBpcyBhbHdh\neXMgcHJlcGFyZWQKICAgICAgICAvLyBiYXNlZCBvbiB0aGUgaW5kZXhpbmcg\nb2YgdGhlIGNvbHVtbnMgaW4gdGhlIHRhYmxlIG9iamVjdCAtLSB0aGUKICAg\nICAgICAvLyBzYW1lIG9yZGVyaW5nIHdlIHVzZSB3aGVuIHN0b3JpbmcgdmFs\ndWVzIGFuZCBtZXRhIHR5cGVzLiBza2lwCiAgICAgICAgLy8gdXBkYXRlcyB3\naGVuIHNldHRpbmcgcGFyYW1zIGZvciBERUxFVEVzOyB0aGUgdXBkYXRlcyBh\ncmUganVzdCB0aGVyZQogICAgICAgIC8vIHRvIGxldCB1cyBldmFsIGZrIGNv\nbnN0cmFpbnRzCiAgICAgICAgaW50IGkgPSAoZ2V0QWN0aW9uKCkgPT0gQUNU\nSU9OX0RFTEVURSkgPyBfY29scy5sZW5ndGg6IDA7CiAgICAgICAgQ29sdW1u\nIGNvbDsKICAgICAgICBPYmplY3QgdmFsOwogICAgICAgIGludCBoYWxmID0g\nX3ZhbHMubGVuZ3RoIC8gMjsKICAgICAgICBmb3IgKDsgaSA8IF92YWxzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChfdmFsc1tpXSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyB3\nZSBkb24ndCBzZXQgbnVsbCBwYXJhbXMgaW4gdGhlIFdIRVJFIGNsYXVzZTsg\nd2UgdXNlIHRoZSBOVUxMCiAgICAgICAgICAgIC8vIGtleXdvcmQgaW5zdGVh\nZCB0byBzYXRpc2Z5IHNxbHNlcnZlcgogICAgICAgICAgICBpZiAoX3ZhbHNb\naV0gPT0gTlVMTCAmJiBnZXRBY3Rpb24oKSAhPSBBQ1RJT05fSU5TRVJUICYm\nIGkgPj0gaGFsZikKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAg\nICAgICAgLy8gaWYgdGhpcyBpcyBhbiB1cGRhdGUgdGhlIHZhbHMgYXJyYXkg\nd2lsbCBiZSAyIHggdGhlIGNvbHMKICAgICAgICAgICAgLy8gYXJyYXkgbGVu\nZ3RoOyBpdCByZXBlYXRzIGZvciB3aGVyZSB2YWx1ZXMKICAgICAgICAgICAg\naWYgKGkgPCBfY29scy5sZW5ndGgpCiAgICAgICAgICAgICAgICBjb2wgPSBf\nY29sc1tpXTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY29s\nID0gX2NvbHNbaSAtIF9jb2xzLmxlbmd0aF07CgogICAgICAgICAgICB2YWwg\nPSBfdmFsc1tpXTsKICAgICAgICAgICAgaWYgKHZhbCA9PSBOVUxMKQogICAg\nICAgICAgICAgICAgdmFsID0gbnVsbDsKCiAgICAgICAgICAgIGlmICh2YWwg\nPT0gbnVsbCB8fCBfdHlwZXNbaV0gIT0gUkFXKSB7CiAgICAgICAgICAgICAg\nICBkaWN0LnNldFR5cGVkKHN0bW50LCBpZHgsIHZhbCwgY29sLCBfdHlwZXNb\naV0sIHN0b3JlKTsKICAgICAgICAgICAgICAgIGlkeCsrOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhlIGFycmF5\nIHZhbHVlIGFycmF5IGluZGV4IGZvciB0aGUgZ2l2ZW4gY29sdW1uJ3MgdmFs\ndWUuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGdldFNldEluZGV4KENvbHVt\nbiBjb2wpIHsKICAgICAgICByZXR1cm4gY29sLmdldEluZGV4KCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgdmFsdWUgYXJyYXkgaW5kZXgg\nZm9yIHRoZSBnaXZlbiBjb2x1bW4ncyB2YWx1ZS4KICAgICAqLwogICAgcHJp\ndmF0ZSBpbnQgZ2V0V2hlcmVJbmRleChDb2x1bW4gY29sKSB7CiAgICAgICAg\ncmV0dXJuIGNvbC5nZXRJbmRleCgpICsgX2NvbHMubGVuZ3RoOwogICAgfQoK\nICAgIC8qKgogICAgICogUGVyZm9ybXMgYSBwcm9wZXIgZGVlcCBjbG9uZS4K\nICAgICAqLwogICAgcHVibGljIE9iamVjdCBjbG9uZSgpIHsKICAgICAgICBS\nb3dJbXBsIGNsb25lID0gbmV3SW5zdGFuY2UoZ2V0Q29sdW1ucygpLCBnZXRB\nY3Rpb24oKSk7CiAgICAgICAgY29weUludG8oY2xvbmUsIGZhbHNlKTsKICAg\nICAgICByZXR1cm4gY2xvbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSBuZXcgcm93LgogICAgICovCiAgICBwcm90ZWN0ZWQgUm93SW1wbCBu\nZXdJbnN0YW5jZShDb2x1bW5bXSBjb2xzLCBpbnQgYWN0aW9uKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBSb3dJbXBsKGNvbHMsIGFjdGlvbik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb3B5IGFsbCB2YWx1ZXMgZnJvbSB0aGlzIHJvdyBp\nbnRvIHRoZSBnaXZlbiBvbmUuCiAgICAgKgogICAgICogQHBhcmFtIHdoZXJl\nT25seSBpZiB0cnVlLCBvbmx5IGNvcHkgd2hlcmUgY29uZGl0aW9ucwogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBjb3B5SW50byhSb3dJbXBsIHJvdywgYm9v\nbGVhbiB3aGVyZU9ubHkpIHsKICAgICAgICBpbnQgYWN0aW9uID0gZ2V0QWN0\naW9uKCk7CiAgICAgICAgaW50IHJvd0FjdGlvbiA9IHJvdy5nZXRBY3Rpb24o\nKTsKCiAgICAgICAgaW50IHN0YXJ0OwogICAgICAgIGludCBsZW47CiAgICAg\nICAgaWYgKHdoZXJlT25seSkgewogICAgICAgICAgICBpZiAoYWN0aW9uID09\nIEFDVElPTl9JTlNFUlQgfHwgcm93QWN0aW9uID09IEFDVElPTl9JTlNFUlQp\nCiAgICAgICAgICAgICAgICBzdGFydCA9IGxlbiA9IDA7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIHN0YXJ0ID0gbGVuID0gX3ZhbHMubGVu\nZ3RoIC8gMjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFydCA9\nIDA7CiAgICAgICAgICAgIGlmIChyb3dBY3Rpb24gPT0gQUNUSU9OX0lOU0VS\nVCAmJiBhY3Rpb24gIT0gQUNUSU9OX0lOU0VSVCkKICAgICAgICAgICAgICAg\nIGxlbiA9IF92YWxzLmxlbmd0aCAvIDI7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIGxlbiA9IF92YWxzLmxlbmd0aDsKICAgICAgICB9Cgog\nICAgICAgIFN5c3RlbS5hcnJheWNvcHkoX3ZhbHMsIHN0YXJ0LCByb3cuX3Zh\nbHMsIHN0YXJ0LCBsZW4pOwogICAgICAgIFN5c3RlbS5hcnJheWNvcHkoX3R5\ncGVzLCBzdGFydCwgcm93Ll90eXBlcywgc3RhcnQsIGxlbik7CiAgICAgICAg\naWYgKGlzVmFsaWQoKSkKICAgICAgICAgICAgcm93LnNldFZhbGlkKHRydWUp\nOwogICAgfQogICAgCiAgICBwdWJsaWMgT2JqZWN0W10gZ2V0VmFscygpIHsK\nICAgICAgICByZXR1cm4gX3ZhbHM7CiAgICB9CiAgICAKICAgIHB1YmxpYyBp\nbnRbXSBnZXRUeXBlcygpIHsKICAgICAgICByZXR1cm4gX3R5cGVzOwogICAg\nfQp9Cg==\n","encoding":"base64"}

