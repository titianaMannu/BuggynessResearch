{"sha":"35d42f2b10e03d256d5781f28a9d6e3cc603913b","node_id":"MDQ6QmxvYjIwNjM2NDozNWQ0MmYyYjEwZTAzZDI1NmQ1NzgxZjI4YTlkNmUzY2M2MDM5MTNi","size":101078,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/35d42f2b10e03d256d5781f28a9d6e3cc603913b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0\nOwppbXBvcnQgamF2YS51dGlsLlNvcnRlZE1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TdGFjazsKaW1wb3J0IGphdmEudXRpbC5UcmVlTWFwOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5pdGVyYXRvcnMuRW1wdHlJ\ndGVyYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5K\nREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5FYWdlckZldGNoTW9kZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDTG9j\na01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJu\nZWwuSkRCQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\na2VybmVsLkpEQkNTdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5Kb2luYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRl\neHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBv\ncnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogU3RhbmRhcmQge0BsaW5r\nIFNlbGVjdH0gaW1wbGVtZW50YXRpb24uIFVzYWdlIG5vdGU6IHRob3VnaCB0\naGlzIGNsYXNzCiAqIGltcGxlbWVudHMge0BsaW5rIEpvaW5zfSwgaXQgc2hv\ndWxkIG5vdCBiZSB1c2VkIGZvciBqb2luaW5nIGRpcmVjdGx5LgogKiBJbnN0\nZWFkLCB1c2UgdGhlIHJldHVybiB2YWx1ZSBvZiB7QGxpbmsgI25ld0pvaW5z\nfS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIFNlbGVjdEltcGwKICAgIGltcGxlbWVudHMgU2VsZWN0\nLCBQYXRoSm9pbnMgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBO\nT05BVVRPX0RJU1RJTkNUID0gMiA8PCAwOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IERJU1RJTkNUID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE5PVF9ESVNUSU5DVCA9IDIgPDwgMjsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBJTVBMSUNJVF9ESVNUSU5DVCA9IDIgPDwg\nMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBUT19NQU5ZID0gMiA8\nPCA0OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEFHR1JFR0FURSA9\nIDIgPDwgNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBMT0IgPSAy\nIDw8IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgT1VURVIgPSAy\nIDw8IDc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTFJTID0gMiA8\nPCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEVBR0VSX1RPX09O\nRSA9IDIgPDwgOTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBFQUdF\nUl9UT19NQU5ZID0gMiA8PCAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBSRUNPUkRfT1JERVJFRCA9IDIgPDwgMTE7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgR1JPVVBJTkcgPSAyIDw8IDEyOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZPUkNFX0NPVU5UID0gMiA8PCAxMzsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmdbXSBUQUJMRV9BTElBU0VT\nID0gbmV3IFN0cmluZ1sxNl07CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBT\ndHJpbmdbXSBPUkRFUl9BTElBU0VTID0gbmV3IFN0cmluZ1sxNl07CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3RbXSBOVUxMX0lEUyA9IG5ldyBP\nYmplY3RbMTZdOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10g\nUExBQ0VIT0xERVJTID0gbmV3IE9iamVjdFs1MF07CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZShTZWxlY3QuY2xhc3MpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBUQUJMRV9BTElBU0VTLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBUQUJMRV9BTElBU0VTW2ldID0gInQiICsgaTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IE9SREVSX0FMSUFTRVMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE9SREVSX0FMSUFTRVNbaV0gPSAibyIgKyBpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgTlVMTF9JRFMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE5VTExfSURTW2ldID0gbmV3IE51bGxJZCgpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgUExBQ0VIT0xERVJTLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBQTEFDRUhPTERFUlNbaV0gPSBuZXcgUGxh\nY2Vob2xkZXIoKTsKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIEpEQkNDb25m\naWd1cmF0aW9uIF9jb25mOwogICAgcHJpdmF0ZSBmaW5hbCBEQkRpY3Rpb25h\ncnkgX2RpY3Q7CgogICAgLy8gbWFwIG9mIHZhcmlhYmxlICsgcmVsYXRpb24g\ncGF0aCArIHRhYmxlIGtleXMgdG8gdGhlIGNvcnJlY3QgYWxpYXMgaW5kZXg6\nCiAgICAvLyBlYWNoIHJlbGF0aW9uIHBhdGgvdGFibGUgY29tYmluYXRpb24g\nc2hvdWxkIGhhdmUgYSB1bmlxdWUgYWxpYXMgYmVjYXVzZQogICAgLy8gaXQg\ncmVwcmVzZW50cyBhIHNlcGFyYXRlIG9iamVjdDsgZm9yIGV4YW1wbGUsIGlm\nIGEgUGVyc29uIGNsYXNzIGhhcyBhCiAgICAvLyAncGFyZW50JyBmaWVsZCBy\nZXByZXNlbnRpbmcgYW5vdGhlciBQZXJzb24gYW5kIGFsc28gaGFzIGFuICdh\nZGRyZXNzJwogICAgLy8gZmllbGQgb2YgdHlwZSBBZGRyZXNzOgogICAgLy8g\nJ2FkZHJlc3Muc3RyZWV0JyBzaG91bGQgbWFwIHRvIGEgZGlmZmVyZW50IHRh\nYmxlIGFsaWFzIHRoYW4KICAgIC8vICdwYXJlbnQuYWRkcmVzcy5zdHJlZXQn\nIGZvciB0aGUgcHVycG9zZXMgb2YgY29tcGFyaXNvbnMKICAgIHByaXZhdGUg\nTWFwIF9hbGlhc2VzID0gbnVsbDsKCiAgICAvLyB0byBjYWNoZSB0YWJsZSBh\nbGlhcyB1c2luZyBUYWJsZSBhcyB0aGUga2V5CiAgICBwcml2YXRlIE1hcCBf\ndGFibGVBbGlhc2VzID0gbnVsbDsKCiAgICAvLyBtYXAgb2YgaW5kZXhlcyB0\nbyB0YWJsZSBhbGlhc2VzIGxpa2UgJ1RBQkxFTkFNRSB0MCcKICAgIHByaXZh\ndGUgU29ydGVkTWFwIF90YWJsZXMgPSBudWxsOwoKICAgIC8vIGNvbWJpbmVk\nIGxpc3Qgb2Ygc2VsZWN0ZWQgaWRzIGFuZCBtYXAgb2YgZWFjaCBpZCB0byBp\ndHMgYWxpYXMKICAgIHByb3RlY3RlZCBmaW5hbCBTZWxlY3RzIF9zZWxlY3Rz\nID0gbmV3U2VsZWN0cygpOwogICAgcHJpdmF0ZSBMaXN0IF9vcmRlcmVkID0g\nbnVsbDsKICAgIHByaXZhdGUgTGlzdCBfZ3JvdXBlZCA9IG51bGw7CgogICAg\nLy8gZmxhZ3MKICAgIHByaXZhdGUgaW50IF9mbGFncyA9IDA7CiAgICBwcml2\nYXRlIGludCBfam9pblN5bnRheCA9IDA7CiAgICBwcml2YXRlIGxvbmcgX3N0\nYXJ0SWR4ID0gMDsKICAgIHByaXZhdGUgbG9uZyBfZW5kSWR4ID0gTG9uZy5N\nQVhfVkFMVUU7CiAgICBwcml2YXRlIGludCBfbnVsbElkcyA9IDA7CiAgICBw\ncml2YXRlIGludCBfb3JkZXJzID0gMDsKICAgIHByaXZhdGUgaW50IF9wbGFj\nZWhvbGRlcnMgPSAwOwogICAgcHJpdmF0ZSBpbnQgX2V4cGVjdGVkUmVzdWx0\nQ291bnQgPSAwOwoKICAgIC8vIHF1ZXJ5IGNsYXVzZXMKICAgIHByaXZhdGUg\nU1FMQnVmZmVyIF9vcmRlcmluZyA9IG51bGw7CiAgICBwcml2YXRlIFNRTEJ1\nZmZlciBfd2hlcmUgPSBudWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX2dy\nb3VwaW5nID0gbnVsbDsKICAgIHByaXZhdGUgU1FMQnVmZmVyIF9oYXZpbmcg\nPSBudWxsOwoKICAgIC8vIGpvaW5zIHRvIGFkZCB0byB0aGUgZW5kIG9mIG91\nciB3aGVyZSBjbGF1c2UsIGFuZCBqb2lucyB0byBwcmVwZW5kIHRvCiAgICAv\nLyBhbGwgc2VsZWN0cyAoc2VlIHNlbGVjdChjbGFzc21hcHBpbmcpIG1ldGhv\nZCkKICAgIHByaXZhdGUgU2VsZWN0Sm9pbnMgX2pvaW5zID0gbnVsbDsKICAg\nIHByaXZhdGUgU3RhY2sgX3ByZUpvaW5zID0gbnVsbDsKCiAgICAvLyBtYXAg\nb2Ygam9pbnMra2V5cyB0byBlYWdlciBzZWxlY3RzIGFuZCBnbG9iYWwgc2V0\nIG9mIGVhZ2VyIGtleXM7IHRoZQogICAgLy8gc2FtZSBrZXkgY2FuJ3QgYmUg\ndXNlZCBtb3JlIHRoYW4gb25jZQogICAgcHJpdmF0ZSBNYXAgX2VhZ2VyID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9lYWdlcktleXMgPSBudWxsOwoKICAg\nIC8vIHN1YnNlbGVjdCBzdXBwb3J0CiAgICBwcml2YXRlIExpc3QgX3N1YnNl\nbHMgPSBudWxsOwogICAgcHJpdmF0ZSBTZWxlY3RJbXBsIF9wYXJlbnQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX3N1YlBhdGggPSBudWxsOwoKICAg\nIC8vIGZyb20gc2VsZWN0IGlmIHRoaXMgc2VsZWN0IHNlbGVjdHMgZnJvbSBh\nIHRtcCB0YWJsZSBjcmVhdGVkIGJ5IGFub3RoZXIKICAgIHByaXZhdGUgU2Vs\nZWN0SW1wbCBfZnJvbSA9IG51bGw7CiAgICBwcm90ZWN0ZWQgU2VsZWN0SW1w\nbCBfb3V0ZXIgPSBudWxsOwogICAgCiAgICAvLyBiaXRTZXQgaW5kaWNhdGlu\nZyBpZiBhbiBhbGlhcyBpcyByZW1vdmVkIGZyb20gcGFyZW50IHNlbGVjdAog\nICAgLy8gYml0IDAgOiBjb3JyZXNwb25kIHRvIGFsaWFzIDAKICAgIC8vIGJp\ndCAxIDogY29ycmVzcG9uZCB0byBhbGlhcyAxLCBldGMuCiAgICAvLyBpZiB0\naGUgYml0IGlzIHNldCwgdGhlIGNvcnJlc3BvbmRpbmcgYWxpYXMgaGFzIGJl\nZW4gcmVtb3ZlZCBmcm9tIHBhcmVudAogICAgLy8gYW5kIHJlY29yZGVkIHVu\nZGVyIHN1YnNlbGVjdC4KICAgIHByaXZhdGUgQml0U2V0IF9yZW1vdmVkQWxp\nYXNGcm9tUGFyZW50ID0gbmV3IEJpdFNldCgxNik7CgogICAgLy9jb250YWlu\ncyBmaW5hbCBzcWwgc3RhdGVtZW50IHRvIGJlIGV4ZWN1dGVkL2NhY2hlZAog\nICAgcHJpdmF0ZSBTUUxCdWZmZXIgX3NxbCA9IG51bGw7CiAgICAKICAgIC8q\nKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1cm4gdGhlIHByb3BlciB0\nYWJsZSBhbGlhcyBmb3IgdGhlIGdpdmVuIGFsaWFzIGluZGV4LgogICAgICov\nCiAgICBzdGF0aWMgU3RyaW5nIHRvQWxpYXMoaW50IGluZGV4KSB7CiAgICAg\nICAgaWYgKGluZGV4ID09IC0xKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAoaW5kZXggPCBUQUJMRV9BTElBU0VTLmxlbmd0aCkKICAg\nICAgICAgICAgcmV0dXJuIFRBQkxFX0FMSUFTRVNbaW5kZXhdOwogICAgICAg\nIHJldHVybiAidCIgKyBpbmRleDsKICAgIH0KCiAgICAvKioKICAgICAqIEhl\nbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBwcm9wZXIgb3JkZXIgYWxpYXMg\nZm9yIHRoZSBnaXZlbiBvcmRlcgogICAgICogY29sdW1uIGluZGV4LgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyB0b09yZGVyQWxpYXMoaW50\nIGluZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID09IC0xKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaW5kZXggPCBPUkRFUl9BTElB\nU0VTLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIE9SREVSX0FMSUFTRVNb\naW5kZXhdOwogICAgICAgIHJldHVybiAibyIgKyBpbmRleDsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlv\nbi4KICAgICAqLwogICAgcHVibGljIFNlbGVjdEltcGwoSkRCQ0NvbmZpZ3Vy\nYXRpb24gY29uZikgewogICAgICAgIF9jb25mID0gY29uZjsKICAgICAgICBf\nZGljdCA9IF9jb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAg\nICAgX2pvaW5TeW50YXggPSBfZGljdC5qb2luU3ludGF4OwogICAgICAgIF9z\nZWxlY3RzLl9kaWN0ID0gX2RpY3Q7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTZWxlY3RFeGVjdXRvciBp\nbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgcHVibGljIEpEQkNDb25maWd1cmF0aW9uIGdldENvbmZp\nZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9jb25mOwogICAgfQoKICAg\nIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoYm9vbGVhbiBmb3JVcGRhdGUs\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1\ncm4gX2RpY3QudG9TZWxlY3QodGhpcywgZm9yVXBkYXRlLCBmZXRjaCk7CiAg\nICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdENvdW50KCkgewog\nICAgICAgIHJldHVybiBfZGljdC50b1NlbGVjdENvdW50KHRoaXMpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGdldEF1dG9EaXN0aW5jdCgpIHsKICAg\nICAgICByZXR1cm4gKF9mbGFncyAmIE5PTkFVVE9fRElTVElOQ1QpID09IDA7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QXV0b0Rpc3RpbmN0KGJvb2xl\nYW4gdmFsKSB7CiAgICAgICAgaWYgKHZhbCkKICAgICAgICAgICAgX2ZsYWdz\nICY9IH5OT05BVVRPX0RJU1RJTkNUOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX2ZsYWdzIHw9IE5PTkFVVE9fRElTVElOQ1Q7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNEaXN0aW5jdCgpIHsKICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIE5PVF9ESVNUSU5DVCkgPT0gMCAmJiAoKF9mbGFncyAmIERJU1RJ\nTkNUKSAhPSAwCiAgICAgICAgICAgIHx8ICgoX2ZsYWdzICYgTk9OQVVUT19E\nSVNUSU5DVCkgPT0gMAogICAgICAgICAgICAmJiAoX2ZsYWdzICYgSU1QTElD\nSVRfRElTVElOQ1QpICE9IDApKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXREaXN0aW5jdChib29sZWFuIGRpc3RpbmN0KSB7CiAgICAgICAgLy8gbmVl\nZCB0d28gZmxhZ3MgaW4gY2FzZSBzZXQgbm90X2Rpc3RpbmN0LCB0aGVuIGEg\ndG8tbWFueSBqb2luIGhhcHBlbnMKICAgICAgICAvLyBhbmQgZGlzdGluY3Qg\nZmxhZyBnZXRzIHNldCBhdXRvbWF0aWNhbGx5CiAgICAgICAgaWYgKGRpc3Rp\nbmN0KSB7CiAgICAgICAgICAgIF9mbGFncyB8PSBESVNUSU5DVDsKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5OT1RfRElTVElOQ1Q7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgX2ZsYWdzIHw9IE5PVF9ESVNUSU5DVDsKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5ESVNUSU5DVDsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNMUlMoKSB7CiAgICAgICAgcmV0dXJuIChf\nZmxhZ3MgJiBMUlMpICE9IDA7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nTFJTKGJvb2xlYW4gbHJzKSB7CiAgICAgICAgaWYgKGxycykKICAgICAgICAg\nICAgX2ZsYWdzIHw9IExSUzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9m\nbGFncyAmPSB+TFJTOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0RXhwZWN0\nZWRSZXN1bHRDb3VudCgpIHsKICAgICAgICAvLyBpZiB0aGUgY291bnQgaXNu\nJ3QgZm9yY2VkIGFuZCB3ZSBoYXZlIHRvLW1hbnkgZWFnZXIgam9pbnMgdGhh\ndCBjb3VsZAogICAgICAgIC8vIHRocm93IHRoZSBjb3VudCBvZmYsIGRvbid0\nIHBheSBhdHRlbnRpb24gdG8gaXQKICAgICAgICBpZiAoKF9mbGFncyAmIEZP\nUkNFX0NPVU5UKSA9PSAwICYmIGhhc0VhZ2VySm9pbih0cnVlKSkKICAgICAg\nICAgICAgcmV0dXJuIDA7CiAgICAgICAgcmV0dXJuIF9leHBlY3RlZFJlc3Vs\ndENvdW50OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEV4cGVjdGVkUmVz\ndWx0Q291bnQoaW50IGV4cGVjdGVkUmVzdWx0Q291bnQsIGJvb2xlYW4gZm9y\nY2UpIHsKICAgICAgICBfZXhwZWN0ZWRSZXN1bHRDb3VudCA9IGV4cGVjdGVk\nUmVzdWx0Q291bnQ7CiAgICAgICAgaWYgKGZvcmNlKQogICAgICAgICAgICBf\nZmxhZ3MgfD0gRk9SQ0VfQ09VTlQ7CiAgICAgICAgZWxzZSAKICAgICAgICAg\nICAgX2ZsYWdzICY9IH5GT1JDRV9DT1VOVDsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldEpvaW5TeW50YXgoKSB7CiAgICAgICAgcmV0dXJuIF9qb2luU3lu\ndGF4OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEpvaW5TeW50YXgoaW50\nIGpvaW5TeW50YXgpIHsKICAgICAgICBfam9pblN5bnRheCA9IGpvaW5TeW50\nYXg7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNSYW5kb21B\nY2Nlc3MoYm9vbGVhbiBmb3JVcGRhdGUpIHsKICAgICAgICByZXR1cm4gX2Rp\nY3Quc3VwcG9ydHNSYW5kb21BY2Nlc3NSZXN1bHRTZXQodGhpcywgZm9yVXBk\nYXRlKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tp\nbmcoKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0LnN1cHBvcnRzTG9ja2luZyh0\naGlzKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldENvdW50KEpEQkNTdG9y\nZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBDb25uZWN0aW9uIGNvbm4gPSBudWxsOwogICAgICAgIFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50ID0gbnVsbDsKICAgICAgICBSZXN1bHRTZXQgcnMgPSBu\ndWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBzcWwg\nPSB0b1NlbGVjdENvdW50KCk7CiAgICAgICAgICAgIGNvbm4gPSBzdG9yZS5n\nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0\nYXRlbWVudChjb25uLCBzcWwsIG51bGwsIAogICAgICAgICAgICAgICAgUmVz\ndWx0U2V0LlRZUEVfRk9SV0FSRF9PTkxZLCAKICAgICAgICAgICAgICAgIFJl\nc3VsdFNldC5DT05DVVJfUkVBRF9PTkxZLCBmYWxzZSk7CiAgICAgICAgICAg\nIHJzID0gZXhlY3V0ZVF1ZXJ5KGNvbm4sIHN0bW50LCBzcWwsIGZhbHNlLCBz\ndG9yZSwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybiBnZXRDb3VudChycyk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICB0cnkgeyBycy5jbG9zZSgpOyB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgICAgIGlmIChzdG1udCAh\nPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UoKTsg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAgICBpZiAo\nY29ubiAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgY29ubi5jbG9z\nZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBSZXN1bHQgZXhlY3V0ZShKREJDU3RvcmUgc3Rv\ncmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIAogICAgICAgIExp\nc3QgcGFybXMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChm\nZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IHN0b3JlLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIHJldHVybiBleGVjdXRlKHN0\nb3JlLmdldENvbnRleHQoKSwgc3RvcmUsIGZldGNoLAogICAgICAgICAgICBm\nZXRjaC5nZXRSZWFkTG9ja0xldmVsKCksIHBhcm1zKTsKICAgIH0KCiAgICBw\ndWJsaWMgUmVzdWx0IGV4ZWN1dGUoSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoKSAKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZShzdG9yZSwgZmV0Y2gs\nIG51bGwpOwogICAgIH0KCiAgICBwdWJsaWMgUmVzdWx0IGV4ZWN1dGUoSkRC\nQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAog\nICAgICAgIGludCBsb2NrTGV2ZWwsIExpc3QgcGFybXMpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChmZXRjaCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgZmV0Y2ggPSBzdG9yZS5nZXRGZXRjaENv\nbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgcmV0dXJuIGV4ZWN1dGUoc3Rv\ncmUuZ2V0Q29udGV4dCgpLCBzdG9yZSwgZmV0Y2gsIGxvY2tMZXZlbCwgcGFy\nbXMpOwogICAgfQoKICAgIHB1YmxpYyBSZXN1bHQgZXhlY3V0ZShKREJDU3Rv\ncmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAg\nICAgaW50IGxvY2tMZXZlbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZShzdG9yZSwgZmV0Y2gsIGxvY2tM\nZXZlbCwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeGVjdXRlIHRo\naXMgc2VsZWN0IGluIHRoZSBjb250ZXh0IG9mIHRoZSBnaXZlbiBzdG9yZSBt\nYW5hZ2VyLiBUaGUKICAgICAqIGNvbnRleHQgaXMgcGFzc2VkIGluIHNlcGFy\nYXRlbHkgZm9yIHByb2ZpbGluZyBwdXJwb3Nlcy4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFJlc3VsdCBleGVjdXRlKFN0b3JlQ29udGV4dCBjdHgsIEpEQkNT\ndG9yZSBzdG9yZSwgCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgaW50IGxvY2tMZXZlbCwgTGlzdCBwYXJhbXMpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYm9vbGVhbiBmb3JVcGRhdGUg\nPSBpc0ZvclVwZGF0ZShzdG9yZSwgbG9ja0xldmVsKTsKICAgICAgICAKICAg\nICAgICAvLyBBIG5vbi1udWxsIF9zcWwgaW5kaWNhdGVzIHRoYXQgdGhpcyBT\nZWxlY3RJbXBsIG9iamVjdAogICAgICAgIC8vIGlzIG9idGFpbmVkIGZyb20g\nY2FjaGUuIFRoZSBfc3FsIGlzIGNvbnN0cnVjdGVkCiAgICAgICAgLy8gdW5k\nZXIgdGhlIGFzc3VtcHRpb24gdGhhdCBpc0FnZ3JlZ2F0ZSgpIGlzIGZhbHNl\nCiAgICAgICAgLy8gYW5kIF9ncm91cGluZyBpcyBudWxsLiBJZiBuZWl0aGVy\nIG9mIHRoZXNlIGhvbGRzLAogICAgICAgIC8vIHdlIG5lZWQgdG8gcmUtY29u\nc3RydWN0IHRoZSBfc3FsCiAgICAgICAgaWYgKF9zcWwgIT0gbnVsbCAmJiAo\naXNBZ2dyZWdhdGUoKSB8fCBfZ3JvdXBpbmcgIT0gbnVsbCkpIAogICAgICAg\nICAgICBfc3FsID0gbnVsbDsKICAgICAgICAKICAgICAgICBpZiAoX3NxbCA9\nPSBudWxsKSAKICAgICAgICAJX3NxbCA9IHRvU2VsZWN0KGZvclVwZGF0ZSwg\nZmV0Y2gpOwogICAgICAgIAogICAgICAgIGJvb2xlYW4gaXNMUlMgPSBpc0xS\nUygpOwogICAgICAgIGludCByc1R5cGUgPSAoaXNMUlMgJiYgc3VwcG9ydHNS\nYW5kb21BY2Nlc3MoZm9yVXBkYXRlKSkKICAgICAgICAgICAgPyAtMSA6IFJl\nc3VsdFNldC5UWVBFX0ZPUldBUkRfT05MWTsKICAgICAgICBDb25uZWN0aW9u\nIGNvbm4gPSBzdG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwogICAgICAgIFJlc3VsdFNldCBy\ncyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzTFJT\nKSAKICAgICAgICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChj\nb25uLCBfc3FsLCBmZXRjaCwgcnNUeXBlLCAtMSwgdHJ1ZSwgCiAgICAgICAg\nICAgICAgICAgICAgICAgIHBhcmFtcyk7IAogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBzdG1udCA9IHByZXBhcmVTdGF0ZW1lbnQoY29ubiwg\nX3NxbCwgbnVsbCwgcnNUeXBlLCAtMSwgZmFsc2UsIAogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJhbXMpOwogICAgICAgICAgICAKICAgICAgICAgICAg\nc2V0VGltZW91dChzdG1udCwgZm9yVXBkYXRlLCBmZXRjaCk7CiAgICAgICAg\nICAgIAogICAgICAgICAgICBycyA9IGV4ZWN1dGVRdWVyeShjb25uLCBzdG1u\ndCwgX3NxbCwgaXNMUlMsIHN0b3JlLCBwYXJhbXMpOwogICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAvLyBjbGVhbiB1\ncCBzdGF0ZW1lbnQKICAgICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwpCiAg\nICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UyKSB7fQogICAgICAgICAgICB0cnkgeyBjb25uLmNs\nb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHt9CiAgICAgICAg\nICAgIHRocm93IHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGdldEVh\nZ2VyUmVzdWx0KGNvbm4sIHN0bW50LCBycywgc3RvcmUsIGZldGNoLCBmb3JV\ncGRhdGUsIAogICAgICAgICAgICBfc3FsLmdldFNRTCgpKTsKICAgIH0KICAg\nIAogICAgcHJpdmF0ZSBib29sZWFuIGlzRm9yVXBkYXRlKEpEQkNTdG9yZSBz\ndG9yZSwgaW50IGxvY2tMZXZlbCkgewogICAgCWJvb2xlYW4gZm9yVXBkYXRl\nID0gZmFsc2U7CiAgICAgICAgaWYgKCFpc0FnZ3JlZ2F0ZSgpICYmIF9ncm91\ncGluZyA9PSBudWxsKSB7CiAgICAgICAgICAgIEpEQkNMb2NrTWFuYWdlciBs\nbSA9IHN0b3JlLmdldExvY2tNYW5hZ2VyKCk7CiAgICAgICAgICAgIGlmIChs\nbSAhPSBudWxsKQogICAgICAgICAgICAgICAgZm9yVXBkYXRlID0gbG0uc2Vs\nZWN0Rm9yVXBkYXRlKHRoaXMsIGxvY2tMZXZlbCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBmb3JVcGRhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBF\neGVjdXRlIG91ciBlYWdlciBzZWxlY3RzLCBhZGRpbmcgdGhlIHJlc3VsdHMg\ndW5kZXIgdGhlIHNhbWUga2V5cwogICAgICogdG8gdGhlIGdpdmVuIHJlc3Vs\ndC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBhZGRFYWdlclJl\nc3VsdHMoU2VsZWN0UmVzdWx0IHJlcywgU2VsZWN0SW1wbCBzZWwsCiAgICAg\nICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChzZWwuX2VhZ2VyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgLy8gZXhlY3V0ZSBlYWdlciBzZWxlY3RzCiAgICAgICAgTWFwLkVu\ndHJ5IGVudHJ5OwogICAgICAgIFJlc3VsdCBlcmVzOwogICAgICAgIE1hcCBl\nYWdlcjsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNlbC5fZWFnZXIu\nZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CgogICAg\nICAgICAgICAvLyBzaW11bGF0ZWQgYmF0Y2hlZCBzZWxlY3RzIGZvciBpbm5l\nci9vdXRlciBqb2luczsgZm9yIHNlcGFyYXRlCiAgICAgICAgICAgIC8vIHNl\nbGVjdHMsIGRvbid0IHBhc3Mgb24gbG9jayBsZXZlbCwgYmVjYXVzZSB0aGV5\nJ3JlIHByb2JhYmx5CiAgICAgICAgICAgIC8vIGZvciByZWxhdGlvbnMgYW5k\nIHRoZXJlZm9yZSBzaG91bGQgdXNlIGRlZmF1bHQgbGV2ZWwKICAgICAgICAg\nICAgaWYgKGVudHJ5LmdldFZhbHVlKCkgPT0gc2VsKQogICAgICAgICAgICAg\nICAgZXJlcyA9IHJlczsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgZXJlcyA9ICgoU2VsZWN0RXhlY3V0b3IpIGVudHJ5LmdldFZhbHVlKCkp\nLmV4ZWN1dGUoc3RvcmUsCiAgICAgICAgICAgICAgICAgICAgZmV0Y2gpOwoK\nICAgICAgICAgICAgZWFnZXIgPSByZXMuZ2V0RWFnZXJNYXAoZmFsc2UpOwog\nICAgICAgICAgICBpZiAoZWFnZXIgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgZWFnZXIgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICAgICAgcmVz\nLnNldEVhZ2VyTWFwKGVhZ2VyKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBlYWdlci5wdXQoZW50cnkuZ2V0S2V5KCksIGVyZXMpOwogICAgICAgIH0K\nICAgIH0KCgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92\naWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAg\nKiBpbXBsZW1lbnRhdGlvbiBvZiBwcmVwYXJpbmcgc3RhdGVtZW50LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0\nYXRlbWVudChDb25uZWN0aW9uIGNvbm4sIAogICAgICAgIFNRTEJ1ZmZlciBz\ncWwsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCByc1R5cGUs\nIAogICAgICAgIGludCByc0NvbmN1ciwgYm9vbGVhbiBpc0xSUykgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYWRkIGNvbW1lbnRzIHdoeSB3\nZSBwYXNzIGluIG51bGwgYXMgdGhlIGxhc3QgcGFyYW1ldGVyCiAgICAgICAg\ncmV0dXJuIHByZXBhcmVTdGF0ZW1lbnQoY29ubiwgc3FsLCBmZXRjaCwgcnNU\neXBlLCByc0NvbmN1ciwgaXNMUlMsIAogICAgICAgICAgICAgICAgbnVsbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92\naWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAg\nKiBpbXBsZW1lbnRhdGlvbiBvZiBwcmVwYXJpbmcgc3RhdGVtZW50LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0\nYXRlbWVudChDb25uZWN0aW9uIGNvbm4sIAogICAgICAgIFNRTEJ1ZmZlciBz\ncWwsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCByc1R5cGUs\nIAogICAgICAgIGludCByc0NvbmN1ciwgYm9vbGVhbiBpc0xSUywgTGlzdCBw\nYXJhbXMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmZXRj\naCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gc3FsLnByZXBhcmVTdGF0\nZW1lbnQoY29ubiwgcnNUeXBlLCByc0NvbmN1ciwgcGFyYW1zKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHJldHVybiBzcWwucHJlcGFyZVN0YXRlbWVu\ndChjb25uLCBmZXRjaCwgcnNUeXBlLCAtMSwgcGFyYW1zKTsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92\nZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBs\nZW1lbnRhdGlvbiBvZiBzZXR0aW5nIHF1ZXJ5IHRpbWVvdXQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIHNldFRpbWVvdXQoUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQsIGJvb2xlYW4gZm9yVXBkYXRlLAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIC8vIGlmIHRoaXMgaXMgYSBsb2NraW5nIHNlbGVjdCBhbmQgdGhl\nIGxvY2sgdGltZW91dCBpcyBncmVhdGVyIHRoYW4KICAgICAgICAvLyB0aGUg\nY29uZmlndXJlZCBxdWVyeSB0aW1lb3V0LCB1c2UgdGhlIGxvY2sgdGltZW91\ndAogICAgICAgIGlmIChmb3JVcGRhdGUgJiYgX2RpY3Quc3VwcG9ydHNRdWVy\neVRpbWVvdXQgJiYgZmV0Y2ggIT0gbnVsbCAKICAgICAgICAgICAgJiYgZmV0\nY2guZ2V0TG9ja1RpbWVvdXQoKSA+IHN0bW50LmdldFF1ZXJ5VGltZW91dCgp\nICogMTAwMCkgewogICAgICAgICAgICBpbnQgdGltZW91dCA9IGZldGNoLmdl\ndExvY2tUaW1lb3V0KCk7CiAgICAgICAgICAgIGlmICh0aW1lb3V0IDwgMTAw\nMCkgewogICAgICAgICAgICAgICAgdGltZW91dCA9IDEwMDA7IAogICAgICAg\nICAgICAgICAgTG9nIGxvZyA9IF9jb25mLmdldExvZyhKREJDQ29uZmlndXJh\ndGlvbi5MT0dfSkRCQyk7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9j\nLmdldCgibWlsbGlzLXF1ZXJ5LXRpbWVvdXQiKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgc3RtbnQuc2V0UXVlcnlUaW1lb3V0KHRpbWVvdXQgLyAx\nMDAwKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1l\ndGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBK\nREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBleGVjdXRpbmcg\ncXVlcnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0\nZVF1ZXJ5KENvbm5lY3Rpb24gY29ubiwgUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwsIGJvb2xlYW4gaXNMUlMsIEpE\nQkNTdG9yZSBzdG9yZSwgTGlzdCBwYXJhbXMpIAogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBzdG1udC5leGVjdXRlUXVl\ncnkoKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBp\ncyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxp\na2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBnZXR0aW5nIGNvdW50IGZy\nb20gdGhlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBpbnQg\nZ2V0Q291bnQoUmVzdWx0U2V0IHJzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBycy5uZXh0KCk7CiAgICAgICAgcmV0dXJuIHJzLmdldEludCgx\nKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0\nbyBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2Ug\nCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBleGVjdXRpbmcgZWFnZXIgc2Vs\nZWN0cy4KICAgICAqLwogICAgcHJvdGVjdGVkIFJlc3VsdCBnZXRFYWdlclJl\nc3VsdChDb25uZWN0aW9uIGNvbm4sIAogICAgICAgIFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBSZXN1bHRTZXQgcnMsIEpEQkNTdG9yZSBzdG9yZSwgCiAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgYm9vbGVhbiBm\nb3JVcGRhdGUsIFN0cmluZyBzcWxTdHIpIAogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIFNlbGVjdFJlc3VsdCByZXMgPSBuZXcgU2Vs\nZWN0UmVzdWx0KGNvbm4sIHN0bW50LCBycywgX2RpY3QpOwogICAgICAgIHJl\ncy5zZXRTZWxlY3QodGhpcyk7CiAgICAgICAgcmVzLnNldFN0b3JlKHN0b3Jl\nKTsKICAgICAgICByZXMuc2V0TG9ja2luZyhmb3JVcGRhdGUpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFkZEVhZ2VyUmVzdWx0cyhyZXMsIHRoaXMs\nIHN0b3JlLCBmZXRjaCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgIHJlcy5jbG9zZSgpOwogICAgICAgICAgICB0\naHJvdyBzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH0K\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTZWxlY3Qg\naW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nCiAgICBwdWJsaWMgaW50IGluZGV4T2YoKSB7CiAgICAgICAgcmV0dXJuIDA7\nCiAgICB9CgogICAgcHVibGljIExpc3QgZ2V0U3Vic2VsZWN0cygpIHsKICAg\nICAgICByZXR1cm4gKF9zdWJzZWxzID09IG51bGwpID8gQ29sbGVjdGlvbnMu\nRU1QVFlfTElTVCA6IF9zdWJzZWxzOwogICAgfQoKICAgIHB1YmxpYyBTZWxl\nY3QgZ2V0UGFyZW50KCkgewogICAgICAgIHJldHVybiBfcGFyZW50OwogICAg\nfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0U3Vic2VsZWN0UGF0aCgpIHsKICAg\nICAgICByZXR1cm4gX3N1YlBhdGg7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0UGFyZW50KFNlbGVjdCBwYXJlbnQsIFN0cmluZyBwYXRoKSB7CiAgICAg\nICAgaWYgKHBhdGggIT0gbnVsbCkKICAgICAgICAgICAgX3N1YlBhdGggPSBw\nYXRoICsgJzonOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3N1YlBhdGgg\nPSBudWxsOwoKICAgICAgICBpZiAocGFyZW50ID09IF9wYXJlbnQpCiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICBpZiAoX3BhcmVudCAhPSBudWxsKQog\nICAgICAgICAgICBfcGFyZW50Ll9zdWJzZWxzLnJlbW92ZSh0aGlzKTsKCiAg\nICAgICAgLy8jIyMgcmlnaHQgbm93IHdlIGNhbid0IHVzZSBzcWw5MiBqb2lu\ncyB3aXRoIHN1YnNlbGVjdHMsIGNhdXNlCiAgICAgICAgLy8jIyMgSSBjYW4n\ndCBmaWd1cmUgb3V0IHdoYXQgdG8gZG8gd2hlbiB0aGUgc3Vic2VsZWN0IGhh\ncyBhIGpvaW4KICAgICAgICAvLyMjIyB3aXRoIGFuIGFsaWFzIGFsc28gcHJl\nc2VudCBpbiB0aGUgb3V0ZXIgc2VsZWN0Li4uIHlvdSBkb24ndCB3YW50CiAg\nICAgICAgLy8jIyMgdGhlIGpvaW4gdG8gYXBwZWFyIGluIHRoZSBGUk9NIGNs\nYXVzZSBvZiB0aGUgc3Vic2VsZWN0IGNhdXNlCiAgICAgICAgLy8jIyMgdGhl\nbiBpdCByZS1hbGlhc2VzIGJvdGggdGFibGVzIGluIHRoZSBzY29wZSBvZiB0\naGUgc3Vic2VsZWN0CiAgICAgICAgLy8jIyMgYW5kIHRoZSBjb3JyZWxhdGlv\nbiB3aXRoIHRoZSBvdXRlciBzZWxlY3QgaXMgbG9zdAogICAgICAgIF9wYXJl\nbnQgPSAoU2VsZWN0SW1wbCkgcGFyZW50OwogICAgICAgIGlmIChfcGFyZW50\nICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9wYXJlbnQuX3N1YnNlbHMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wYXJlbnQuX3N1YnNlbHMgPSBu\nZXcgQXJyYXlMaXN0KDIpOwogICAgICAgICAgICBfcGFyZW50Ll9zdWJzZWxz\nLmFkZCh0aGlzKTsKICAgICAgICAgICAgaWYgKF9wYXJlbnQuX2pvaW5TeW50\nYXggPT0gSm9pblN5bnRheGVzLlNZTlRBWF9TUUw5MikKICAgICAgICAgICAg\nICAgIF9qb2luU3ludGF4ID0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJ\nT05BTDsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2pvaW5T\neW50YXggPSBfcGFyZW50Ll9qb2luU3ludGF4OwogICAgICAgIH0KICAgICAg\nICAKICAgICAgICBpZiAoX3BhcmVudC5nZXRBbGlhc2VzKCkgPT0gbnVsbCB8\nfCBfc3ViUGF0aCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgCiAgICAgICAgLy8gcmVzb2x2ZSBhbGlhc2VzIGZvciBzdWJzZWxlY3Qg\nZnJvbSBwYXJlbnQKICAgICAgICBTZXQ8TWFwLkVudHJ5PiBlbnRyaWVzID0g\nX3BhcmVudC5nZXRBbGlhc2VzKCkuZW50cnlTZXQoKTsKICAgICAgICBmb3Ig\nKE1hcC5FbnRyeSBlbnRyeSA6IGVudHJpZXMpIHsKICAgICAgICAgICAgT2Jq\nZWN0IGtleSA9IGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICBJbnRlZ2Vy\nIGFsaWFzID0gKEludGVnZXIpIGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAg\nICAgIGlmIChrZXkudG9TdHJpbmcoKS5pbmRleE9mKF9zdWJQYXRoKSAhPSAt\nMSB8fAogICAgICAgICAgICAgICAgX3BhcmVudC5maW5kVGFibGVBbGlhcyhh\nbGlhcykgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGlmIChfYWxpYXNl\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9hbGlhc2VzID0gbmV3\nIEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIF9hbGlhc2VzLnB1dChrZXks\nIGFsaWFzKTsKCiAgICAgICAgICAgICAgICBPYmplY3QgdGFibGVTdHJpbmcg\nPSBfcGFyZW50LmdldFRhYmxlcygpLmdldChhbGlhcyk7CiAgICAgICAgICAg\nICAgICBpZiAoX3RhYmxlcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIF90YWJsZXMgPSBuZXcgVHJlZU1hcCgpOwogICAgICAgICAgICAgICAgX3Rh\nYmxlcy5wdXQoYWxpYXMsIHRhYmxlU3RyaW5nKTsKICAgICAgICAgICAgICAg\nIAogICAgICAgICAgICAgICAgX3JlbW92ZWRBbGlhc0Zyb21QYXJlbnQuc2V0\nKGFsaWFzLmludFZhbHVlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIAogICAgICAgIGlmIChfYWxpYXNlcyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIC8vIGFsaWFzZXMgbW92ZWQgaW50byBzdWJzZWxlY3Qgc2hvdWxk\nIGJlIHJlbW92ZWQgZnJvbSBwYXJlbnQKICAgICAgICAgICAgZW50cmllcyA9\nIF9hbGlhc2VzLmVudHJ5U2V0KCk7CiAgICAgICAgICAgIGZvciAoTWFwLkVu\ndHJ5IGVudHJ5IDogZW50cmllcykgewogICAgICAgICAgICAgICAgT2JqZWN0\nIGtleSA9IGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICAgICAgSW50ZWdl\nciBhbGlhcyA9IChJbnRlZ2VyKSBlbnRyeS5nZXRWYWx1ZSgpOwogICAgICAg\nICAgICAgICAgaWYgKGtleS50b1N0cmluZygpLmluZGV4T2YoX3N1YlBhdGgp\nICE9IC0xIHx8CiAgICAgICAgICAgICAgICAgICAgX3BhcmVudC5maW5kVGFi\nbGVBbGlhcyhhbGlhcykgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAg\nICBfcGFyZW50LnJlbW92ZUFsaWFzKGtleSk7CgogICAgICAgICAgICAgICAg\nICAgIE9iamVjdCB0YWJsZVN0cmluZyA9IF9wYXJlbnQuZ2V0VGFibGVzKCku\nZ2V0KGFsaWFzKTsKICAgICAgICAgICAgICAgICAgICBfcGFyZW50LnJlbW92\nZVRhYmxlKGFsaWFzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpdmF0ZSBib29sZWFuIGZp\nbmRUYWJsZUFsaWFzKEludGVnZXIgYWxpYXMpIHsKICAgICAgICAvLyBpZiBh\nbGlhcyBpcyBkZWZpbmVkIGFuZCByZWZlcmVuY2VkLCByZXR1cm4gdHJ1ZS4K\nICAgICAgICBTdHJpbmcgdmFsdWUgPSAidCIgKyBhbGlhcy50b1N0cmluZygp\nICsgIi4iOwogICAgICAgIGlmIChfdGFibGVBbGlhc2VzICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBfdGFibGVBbGlhc2VzLmNvbnRhaW5zVmFsdWUo\ndmFsdWUpICYmCiAgICAgICAgICAgICAgIF90YWJsZXMuY29udGFpbnNLZXko\nYWxpYXMpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CiAgICAKICAgIHB1YmxpYyBNYXAgZ2V0QWxpYXNlcygpIHsKICAg\nICAgICByZXR1cm4gX2FsaWFzZXM7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2\nb2lkIHJlbW92ZUFsaWFzKE9iamVjdCBrZXkpIHsKICAgICAgICBfYWxpYXNl\ncy5yZW1vdmUoa2V5KTsKICAgIH0KICAgIAogICAgcHVibGljIE1hcCBnZXRU\nYWJsZXMoKSB7CiAgICAgICAgcmV0dXJuIF90YWJsZXM7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyB2b2lkIHJlbW92ZVRhYmxlKE9iamVjdCBrZXkpIHsKICAg\nICAgICBfdGFibGVzLnJlbW92ZShrZXkpOwogICAgfQoKICAgIHB1YmxpYyBT\nZWxlY3QgZ2V0RnJvbVNlbGVjdCgpIHsKICAgICAgICByZXR1cm4gX2Zyb207\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RnJvbVNlbGVjdChTZWxlY3Qg\nc2VsKSB7CiAgICAgICAgX2Zyb20gPSAoU2VsZWN0SW1wbCkgc2VsOwogICAg\nICAgIGlmIChfZnJvbSAhPSBudWxsKQogICAgICAgICAgICBfZnJvbS5fb3V0\nZXIgPSB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc0VhZ2Vy\nSm9pbihib29sZWFuIHRvTWFueSkgewogICAgICAgIGlmICh0b01hbnkpCiAg\nICAgICAgICAgIHJldHVybiAoX2ZsYWdzICYgRUFHRVJfVE9fTUFOWSkgIT0g\nMDsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEVBR0VSX1RPX09ORSkgIT0g\nMDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNKb2luKGJvb2xlYW4g\ndG9NYW55KSB7CiAgICAgICAgaWYgKHRvTWFueSkKICAgICAgICAgICAgcmV0\ndXJuIChfZmxhZ3MgJiBUT19NQU5ZKSAhPSAwOwogICAgICAgIHJldHVybiBf\ndGFibGVzICE9IG51bGwgJiYgX3RhYmxlcy5zaXplKCkgPiAxOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzU2VsZWN0ZWQoVGFibGUgdGFibGUpIHsK\nICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhudWxsLCBmYWxzZSk7\nCiAgICAgICAgaWYgKF9mcm9tICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBfZnJvbS5nZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgZmFsc2UpICE9IC0x\nOwogICAgICAgIHJldHVybiBnZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgZmFs\nc2UpICE9IC0xOwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldFRh\nYmxlQWxpYXNlcygpIHsKICAgICAgICByZXR1cm4gKF90YWJsZXMgPT0gbnVs\nbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQgOiBfdGFibGVzLnZhbHVlcygp\nOwogICAgfQoKICAgIHB1YmxpYyBMaXN0IGdldFNlbGVjdHMoKSB7CiAgICAg\nICAgcmV0dXJuIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUxpc3QoX3NlbGVj\ndHMpOwogICAgfQoKICAgIHB1YmxpYyBMaXN0IGdldFNlbGVjdEFsaWFzZXMo\nKSB7CiAgICAgICAgcmV0dXJuIF9zZWxlY3RzLmdldEFsaWFzZXMoZmFsc2Us\nIF9vdXRlciAhPSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgTGlzdCBnZXRJ\nZGVudGlmaWVyQWxpYXNlcygpIHsKICAgICAgICByZXR1cm4gX3NlbGVjdHMu\nZ2V0QWxpYXNlcyh0cnVlLCBfb3V0ZXIgIT0gbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIFNRTEJ1ZmZlciBnZXRPcmRlcmluZygpIHsKICAgICAgICByZXR1\ncm4gX29yZGVyaW5nOwogICAgfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgZ2V0\nR3JvdXBpbmcoKSB7CiAgICAgICAgcmV0dXJuIF9ncm91cGluZzsKICAgIH0K\nCiAgICBwdWJsaWMgU1FMQnVmZmVyIGdldFdoZXJlKCkgewogICAgICAgIHJl\ndHVybiBfd2hlcmU7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciBnZXRI\nYXZpbmcoKSB7CiAgICAgICAgcmV0dXJuIF9oYXZpbmc7CiAgICB9CgogICAg\ncHVibGljIFNRTEJ1ZmZlciBnZXRTUUwoKSB7CiAgICAgICAgcmV0dXJuIF9z\ncWw7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U1FMKFNRTEJ1ZmZlciBz\ncWwpIHsKICAgICAgICBfc3FsID0gc3FsOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldFNRTChKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gpIHsKICAgICAgICBib29sZWFuIGZvclVwZGF0ZSA9IGlz\nRm9yVXBkYXRlKHN0b3JlLCBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCkpOwog\nICAgICAgIF9zcWwgPSB0b1NlbGVjdChmb3JVcGRhdGUsIGZldGNoKTsKICAg\nIH0KICAgIAogICAgcHVibGljIHZvaWQgYWRkSm9pbkNsYXNzQ29uZGl0aW9u\ncygpIHsKICAgICAgICBpZiAoX2pvaW5zID09IG51bGwgfHwgX2pvaW5zLmpv\naW5zKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAv\nLyBqb2luIHNldCBpdGVyYXRvciBhbGxvd3MgY29uY3VycmVudCBtb2RpZmlj\nYXRpb24KICAgICAgICBKb2luIGo7CiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBfam9pbnMuam9pbnMoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICBqID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgIGlmIChqLmdldFJlbGF0aW9uVGFyZ2V0KCkgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgai5nZXRSZWxhdGlvblRhcmdldCgpLmdldERpc2Ny\naW1pbmF0b3IoKS5hZGRDbGFzc0NvbmRpdGlvbnMKICAgICAgICAgICAgICAg\nICAgICAodGhpcywgai5nZXRTdWJjbGFzc2VzKCkgPT0gU1VCU19KT0lOQUJM\nRSwgCiAgICAgICAgICAgICAgICAgICAgai5nZXRSZWxhdGlvbkpvaW5zKCkp\nOwogICAgICAgICAgICAgICAgai5zZXRSZWxhdGlvbihudWxsLCAwLCBudWxs\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nSm9pbnMgZ2V0Sm9pbnMoKSB7CiAgICAgICAgcmV0dXJuIF9qb2luczsKICAg\nIH0KCiAgICBwdWJsaWMgSXRlcmF0b3IgZ2V0Sm9pbkl0ZXJhdG9yKCkgewog\nICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCB8fCBfam9pbnMuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm4gRW1wdHlJdGVyYXRvci5JTlNUQU5DRTsK\nICAgICAgICByZXR1cm4gX2pvaW5zLmpvaW5zKCkuam9pbkl0ZXJhdG9yKCk7\nCiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0U3RhcnRJbmRleCgpIHsKICAg\nICAgICByZXR1cm4gX3N0YXJ0SWR4OwogICAgfQoKICAgIHB1YmxpYyBsb25n\nIGdldEVuZEluZGV4KCkgewogICAgICAgIHJldHVybiBfZW5kSWR4OwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldFJhbmdlKGxvbmcgc3RhcnQsIGxvbmcg\nZW5kKSB7CiAgICAgICAgX3N0YXJ0SWR4ID0gc3RhcnQ7CiAgICAgICAgX2Vu\nZElkeCA9IGVuZDsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVt\nbkFsaWFzKENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1u\nQWxpYXMoY29sLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0Q29sdW1uQWxpYXMoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMp\nIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29sLCBnZXRKb2lu\ncyhqb2lucywgZmFsc2UpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBjb2x1bW4uCiAgICAgKi8KICAg\nIHByaXZhdGUgU3RyaW5nIGdldENvbHVtbkFsaWFzKENvbHVtbiBjb2wsIFBh\ndGhKb2lucyBwaikgewogICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhj\nb2wuZ2V0TmFtZSgpLCBjb2wuZ2V0VGFibGUoKSwgcGopOwogICAgfQoKICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoU3RyaW5nIGNvbCwgVGFi\nbGUgdGFibGUpIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29s\nLCB0YWJsZSwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIGdldENvbHVtbkFsaWFzKFN0cmluZyBjb2wsIFRhYmxlIHRhYmxlLCBK\nb2lucyBqb2lucykgewogICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhj\nb2wsIHRhYmxlLCBnZXRKb2lucyhqb2lucywgZmFsc2UpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBj\nb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldENvbHVtbkFs\naWFzKFN0cmluZyBjb2wsIFRhYmxlIHRhYmxlLCBQYXRoSm9pbnMgcGopIHsK\nICAgICAgICBTdHJpbmcgdGFibGVBbGlhcyA9IG51bGw7CiAgICAgICAgaWYg\nKHBqID09IG51bGwgfHwgcGoucGF0aCgpID09IG51bGwpIHsKICAgICAgICAg\nICAgaWYgKF90YWJsZUFsaWFzZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF90YWJsZUFsaWFzZXMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICB0\nYWJsZUFsaWFzID0gKFN0cmluZykgX3RhYmxlQWxpYXNlcy5nZXQodGFibGUp\nOwogICAgICAgICAgICBpZiAodGFibGVBbGlhcyA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICB0YWJsZUFsaWFzID0gZ2V0VGFibGVBbGlhcyh0YWJsZSwg\ncGopLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICBfdGFibGVBbGlhc2Vz\nLnB1dCh0YWJsZSwgdGFibGVBbGlhcyk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcmV0dXJuIG5ldyBTdHJpbmdCdWlsZGVyKHRhYmxlQWxpYXMpLmFw\ncGVuZChjb2wpLnRvU3RyaW5nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBnZXRUYWJsZUFsaWFzKHRhYmxlLCBwaikuYXBwZW5kKGNvbCkudG9TdHJp\nbmcoKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBTdHJpbmdCdWlsZGVyIGdl\ndFRhYmxlQWxpYXMoVGFibGUgdGFibGUsIFBhdGhKb2lucyBwaikgewogICAg\nICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsK\nICAgICAgICBpZiAoX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAgICBTdHJp\nbmcgYWxpYXMgPSB0b0FsaWFzKF9mcm9tLmdldFRhYmxlSW5kZXgodGFibGUs\nIHBqLCB0cnVlKSk7CiAgICAgICAgICAgIGlmIChfZGljdC5yZXF1aXJlc0Fs\naWFzRm9yU3Vic2VsZWN0KQogICAgICAgICAgICAgICAgcmV0dXJuIGJ1Zi5h\ncHBlbmQoRlJPTV9TRUxFQ1RfQUxJQVMpLmFwcGVuZCgiLiIpLmFwcGVuZChh\nbGlhcykuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKCJfIik7CiAgICAg\nICAgICAgIHJldHVybiBidWYuYXBwZW5kKGFsaWFzKS5hcHBlbmQoIl8iKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1Zi5hcHBlbmQodG9BbGlhcyhn\nZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgdHJ1ZSkpKS5hcHBlbmQoIi4iKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FnZ3JlZ2F0ZSgpIHsKICAg\nICAgICByZXR1cm4gKF9mbGFncyAmIEFHR1JFR0FURSkgIT0gMDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRBZ2dyZWdhdGUoYm9vbGVhbiBhZ2cpIHsK\nICAgICAgICBpZiAoYWdnKQogICAgICAgICAgICBfZmxhZ3MgfD0gQUdHUkVH\nQVRFOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5BR0dS\nRUdBVEU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNMb2IoKSB7CiAg\nICAgICAgcmV0dXJuIChfZmxhZ3MgJiBMT0IpICE9IDA7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0TG9iKGJvb2xlYW4gbG9iKSB7CiAgICAgICAgaWYg\nKGxvYikKICAgICAgICAgICAgX2ZsYWdzIHw9IExPQjsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIF9mbGFncyAmPSB+TE9COwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGNsZWFyU2VsZWN0cygpIHsKICAgICAgICBfc2VsZWN0cy5jbGVh\ncigpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTUUxCdWZm\nZXIgc3FsLCBPYmplY3QgaWQpIHsKICAgICAgICByZXR1cm4gc2VsZWN0KHNx\nbCwgaWQsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVj\ndChTUUxCdWZmZXIgc3FsLCBPYmplY3QgaWQsIEpvaW5zIGpvaW5zKSB7CiAg\nICAgICAgaWYgKCFpc0dyb3VwaW5nKCkpCiAgICAgICAgICAgIHJldHVybiBz\nZWxlY3QoKE9iamVjdCkgc3FsLCBpZCwgam9pbnMpOwogICAgICAgIGdyb3Vw\nQnkoc3FsLCBqb2lucyk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVjb3JkIHRoZSBzZWxlY3Qgb2YgdGhlIGdpdmVu\nIFNRTCBidWZmZXIgb3Igc3RyaW5nLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gc2VsZWN0KE9iamVjdCBzcWwsIE9iamVjdCBpZCwgSm9pbnMgam9p\nbnMpIHsKICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAg\nYm9vbGVhbiBjb250YWluczsKICAgICAgICBpZiAoaWQgPT0gbnVsbCkgewog\nICAgICAgICAgICBpbnQgaWR4ID0gX3NlbGVjdHMuaW5kZXhPZkFsaWFzKHNx\nbCk7CiAgICAgICAgICAgIGNvbnRhaW5zID0gaWR4ICE9IC0xOwogICAgICAg\nICAgICBpZiAoY29udGFpbnMpCiAgICAgICAgICAgICAgICBpZCA9IF9zZWxl\nY3RzLmdldChpZHgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBpZCA9IG51bGxJZCgpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBj\nb250YWlucyA9IF9zZWxlY3RzLmNvbnRhaW5zKGlkKTsKCiAgICAgICAgaWYg\nKGNvbnRhaW5zKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nX3NlbGVjdHMuc2V0QWxpYXMoaWQsIHNxbCwgZmFsc2UpOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhIHVu\naXF1ZSBpZCBmb3IgYSBTUUwgc3RyaW5nIHdob3NlIGdpdmVuIGlkIGlzIG51\nbGwuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IG51bGxJZCgpIHsKICAg\nICAgICBpZiAoX251bGxJZHMgPj0gTlVMTF9JRFMubGVuZ3RoKQogICAgICAg\nICAgICByZXR1cm4gbmV3IE51bGxJZCgpOwogICAgICAgIHJldHVybiBOVUxM\nX0lEU1tfbnVsbElkcysrXTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBz\nZWxlY3QoU3RyaW5nIHNxbCwgT2JqZWN0IGlkKSB7CiAgICAgICAgcmV0dXJu\nIHNlbGVjdChzcWwsIGlkLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBzZWxlY3QoU3RyaW5nIHNxbCwgT2JqZWN0IGlkLCBKb2lucyBqb2lu\ncykgewogICAgICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAgICAgICBy\nZXR1cm4gc2VsZWN0KChPYmplY3QpIHNxbCwgaWQsIGpvaW5zKTsKICAgICAg\nICBncm91cEJ5KHNxbCwgam9pbnMpOwogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdFBsYWNlaG9sZGVyKFN0cmlu\nZyBzcWwpIHsKICAgICAgICBPYmplY3QgaG9sZGVyID0gKF9wbGFjZWhvbGRl\ncnMgPj0gUExBQ0VIT0xERVJTLmxlbmd0aCkKICAgICAgICAgICAgPyBuZXcg\nUGxhY2Vob2xkZXIoKSA6IFBMQUNFSE9MREVSU1tfcGxhY2Vob2xkZXJzKytd\nOwogICAgICAgIHNlbGVjdChzcWwsIGhvbGRlcik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJbnNlcnQgYSBwbGFjZWhvbGRlciBhdCB0aGUgZ2l2ZW4gaW5k\nZXg7IHVzZSBhIG5lZ2F0aXZlIGluZGV4CiAgICAgKiB0byBjb3VudCBmcm9t\nIHRoZSBiYWNrIG9mIHRoZSBzZWxlY3QgbGlzdC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgaW5zZXJ0UGxhY2Vob2xkZXIoU3RyaW5nIHNxbCwgaW50IHBv\ncykgewogICAgICAgIE9iamVjdCBob2xkZXIgPSAoX3BsYWNlaG9sZGVycyA+\nPSBQTEFDRUhPTERFUlMubGVuZ3RoKQogICAgICAgICAgICA/IG5ldyBQbGFj\nZWhvbGRlcigpIDogUExBQ0VIT0xERVJTW19wbGFjZWhvbGRlcnMrK107CiAg\nICAgICAgX3NlbGVjdHMuaW5zZXJ0QWxpYXMocG9zLCBob2xkZXIsIHNxbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBzZWxlY3RlZCBwbGFjZWhv\nbGRlcnMsIGFuZCByZXR1cm4gcmVtb3ZlZCBzZWxlY3QgaW5kZXhlcy4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgY2xlYXJQbGFjZWhvbGRlclNlbGVjdHMo\nKSB7CiAgICAgICAgX3NlbGVjdHMuY2xlYXJQbGFjZWhvbGRlcnMoKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoQ29sdW1uIGNvbCkgewog\nICAgICAgIHJldHVybiBzZWxlY3QoY29sLCAoSm9pbnMpIG51bGwpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChDb2x1bW4gY29sLCBKb2lu\ncyBqb2lucykgewogICAgICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAg\nICAgICByZXR1cm4gc2VsZWN0KGNvbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUp\nLCBmYWxzZSk7CiAgICAgICAgZ3JvdXBCeShjb2wsIGpvaW5zKTsKICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3Qo\nQ29sdW1uW10gY29scykgewogICAgICAgIHJldHVybiBzZWxlY3QoY29scywg\nbnVsbCk7CiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3QoQ29sdW1uW10g\nY29scywgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoY29scyA9PSBudWxs\nIHx8IGNvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwog\nICAgICAgIGlmIChpc0dyb3VwaW5nKCkpIHsKICAgICAgICAgICAgZ3JvdXBC\neShjb2xzLCBqb2lucyk7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAg\nIH0KICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucywgdHJ1\nZSk7CiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKHNl\nbGVjdChjb2xzW2ldLCBwaiwgZmFsc2UpKQogICAgICAgICAgICAgICAgc2Vs\nZCB8PSAyIDw8IGk7CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZWxlY3QgdGhlIGdpdmVuIGNvbHVtbiBhZnRlciBtYWtp\nbmcgdGhlIGdpdmVuIGpvaW5zLgogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gc2VsZWN0KENvbHVtbiBjb2wsIFBhdGhKb2lucyBwaiwgYm9vbGVhbiBp\nZGVudCkgewogICAgICAgIC8vIHdlIGNhY2hlIG9uIGNvbHVtbiBvYmplY3Qg\naWYgdGhlcmUgYXJlIG5vIGpvaW5zIHNvIHRoYXQgd2hlbgogICAgICAgIC8v\nIGxvb2tpbmcgdXAgY29sdW1ucyBpbiB0aGUgcmVzdWx0IHdlIGRvbid0IGhh\ndmUgdG8gY3JlYXRlIGEgc3RyaW5nCiAgICAgICAgLy8gYnVmZmVyIGZvciB0\naGUgdGFibGUgKyBjb2x1bW4gYWxpYXM7IGlmIHRoZXJlIGFyZSBqb2lucywg\ndGhlbgogICAgICAgIC8vIHdlIGtleSBvbiB0aGUgYWxpYXMKICAgICAgICBT\ndHJpbmcgYWxpYXMgPSBnZXRDb2x1bW5BbGlhcyhjb2wsIHBqKTsKICAgICAg\nICBPYmplY3QgaWQ7CiAgICAgICAgaWYgKHBqID09IG51bGwgfHwgcGoucGF0\naCgpID09IG51bGwpCiAgICAgICAgICAgIGlkID0gY29sOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgaWQgPSBhbGlhczsKICAgICAgICBpZiAoX3NlbGVj\ndHMuY29udGFpbnMoaWQpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7Cgog\nICAgICAgIGlmIChjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkJMT0IgfHwgY29s\nLmdldFR5cGUoKSA9PSBUeXBlcy5DTE9CKQogICAgICAgICAgICBzZXRMb2Io\ndHJ1ZSk7CiAgICAgICAgX3NlbGVjdHMuc2V0QWxpYXMoaWQsIGFsaWFzLCBp\nZGVudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2VsZWN0KENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xh\nc3NlcywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlcikgewogICAgICAgIHNlbGVjdCht\nYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyLCBudWxs\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3QoQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBz\ndG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2Vy\nLAogICAgICAgIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgc2VsZWN0KHRoaXMs\nIG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBmZXRjaCwgZWFnZXIsIGpv\naW5zLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhl\nIGdpdmVuIG1hcHBpbmcuCiAgICAgKi8KICAgIHZvaWQgc2VsZWN0KFNlbGVj\ndCB3cmFwcGVyLCBDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNz\nZXMsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBpbnQgZWFnZXIsCiAgICAgICAgSm9pbnMgam9pbnMs\nIGJvb2xlYW4gaWRlbnQpIHsKICAgICAgICAvLyBub3RlIHRoYXQgdGhpcyBp\ncyBvbmUgY2FzZSB3aGVyZSB3ZSBkb24ndCB3YW50IHRvIHVzZSB0aGUgcmVz\ndWx0CiAgICAgICAgLy8gb2YgZ2V0Sm9pbnMoKTsganVzdCB1c2UgdGhlIGdp\ndmVuIGpvaW5zLCB3aGljaCB3aWxsIGVpdGhlciBiZSBjbGVhbgogICAgICAg\nIC8vIG9yIHRoZSByZXN1bHQgb2YgcHJldmlvdXMgcHJlLWpvaW5zLiB0aGlz\nIHdheSB3ZSBkb24ndCBwdXNoIGV4dHJhCiAgICAgICAgLy8gc3RhY2sgc3R1\nZmYgd2hlbiBubyBhY3R1YWwgbmV3IGpvaW5zIGhhdmUgYmVlbiBtYWRlLCBh\nbmQgd2UgZG9uJ3QKICAgICAgICAvLyB0aGluayB0aGUgdXNlciB3YW50cyBv\ndXRlciBqb2lucyB3aGVuIGFjdHVhbGx5IG9ubHkgdGhlIHByZXZpb3VzCiAg\nICAgICAgLy8gam9pbnMgd2VyZSBvdXRlci4gIHdlIGRvIGludm9rZSBnZXRK\nb2lucygpLCB0aG91Z2gsIHRvIGFkZCB0aGVzZQogICAgICAgIC8vIGpvaW5z\nIChpZiBhbnkpIHRvIG91ciB0b3AtbGV2ZWwgam9pbnM7IG90aGVyd2lzZSBp\ndCdkIGJlIHBvc3NpYmxlCiAgICAgICAgLy8gZm9yIHRoZSB1c2VyIHRvIGlt\nbWVkaWF0ZWx5IGRvIGFub3RoZXIgam9pbiBhbmQgc2VsZWN0IHNvbWV0aGlu\nZywKICAgICAgICAvLyBhbmQgaWYgd2UncmUgaW4gb3V0ZXIgbW9kZSBhbGwg\ndGhlc2Ugam9pbnMgd2lsbCBnZXQgc3dpdGNoZWQgdG8gb3V0ZXIKICAgICAg\nICAvLyBqb2lucy4gIGNhY2hpbmcgdGhlbSBhcyB0aGVpciBvcmlnaW5hbCBq\nb2luIHR5cGUgcHJldmVudHMgdGhhdAogICAgICAgIGdldEpvaW5zKGpvaW5z\nLCB0cnVlKTsKCiAgICAgICAgUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lucykg\nam9pbnM7CiAgICAgICAgYm9vbGVhbiBoYXNKb2lucyA9IHBqICE9IG51bGwg\nJiYgcGouaXNEaXJ0eSgpOwogICAgICAgIGlmIChoYXNKb2lucykgewogICAg\nICAgICAgICBpZiAoX3ByZUpvaW5zID09IG51bGwpCiAgICAgICAgICAgICAg\nICBfcHJlSm9pbnMgPSBuZXcgU3RhY2soKTsKICAgICAgICAgICAgX3ByZUpv\naW5zLnB1c2gocGopOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhleSBh\ncmUgc2VsZWN0aW5nIHRoaXMgbWFwcGluZyB3aXRoIG91dGVyIGpvaW5zLCB0\naGVuIGFsbCBqb2lucwogICAgICAgIC8vIGZyb20gdGhpcyBtYXBwaW5nIHNo\nb3VsZCBhbHNvIGJlIG91dGVyCiAgICAgICAgYm9vbGVhbiB3YXNPdXRlciA9\nIChfZmxhZ3MgJiBPVVRFUikgIT0gMDsKICAgICAgICBpZiAoaGFzSm9pbnMg\nJiYgIXdhc091dGVyICYmIHBqLmlzT3V0ZXIoKSkKICAgICAgICAgICAgX2Zs\nYWdzIHw9IE9VVEVSOwoKICAgICAgICAvLyBkZWxlZ2F0ZSB0byBzdG9yZSBt\nYW5hZ2VyIHRvIHNlbGVjdCBpbiBzYW1lIG9yZGVyIGl0IGxvYWRzIHJlc3Vs\ndAogICAgICAgICgoSkRCQ1N0b3JlTWFuYWdlcikgc3RvcmUpLnNlbGVjdCh3\ncmFwcGVyLCBtYXBwaW5nLCBzdWJjbGFzc2VzLCBudWxsLAogICAgICAgICAg\nICBudWxsLCBmZXRjaCwgZWFnZXIsIGlkZW50LCAoX2ZsYWdzICYgT1VURVIp\nICE9IDApOwoKICAgICAgICAvLyByZXNldAogICAgICAgIGlmIChoYXNKb2lu\ncykKICAgICAgICAgICAgX3ByZUpvaW5zLnBvcCgpOwogICAgICAgIGlmICgh\nd2FzT3V0ZXIgJiYgKF9mbGFncyAmIE9VVEVSKSAhPSAwKQogICAgICAgICAg\nICBfZmxhZ3MgJj0gfk9VVEVSOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIHNlbGVjdElkZW50aWZpZXIoQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVy\nbiBzZWxlY3RJZGVudGlmaWVyKGNvbCwgKEpvaW5zKSBudWxsKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3RJZGVudGlmaWVyKENvbHVtbiBj\nb2wsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKCFpc0dyb3VwaW5nKCkp\nCiAgICAgICAgICAgIHJldHVybiBzZWxlY3QoY29sLCBnZXRKb2lucyhqb2lu\ncywgdHJ1ZSksIHRydWUpOwogICAgICAgIGdyb3VwQnkoY29sLCBqb2lucyk7\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nc2VsZWN0SWRlbnRpZmllcihDb2x1bW5bXSBjb2xzKSB7CiAgICAgICAgcmV0\ndXJuIHNlbGVjdElkZW50aWZpZXIoY29scywgbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIGludCBzZWxlY3RJZGVudGlmaWVyKENvbHVtbltdIGNvbHMsIEpv\naW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xz\nLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBp\nZiAoaXNHcm91cGluZygpKSB7CiAgICAgICAgICAgIGdyb3VwQnkoY29scywg\nam9pbnMpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAg\nICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAg\nICAgIGludCBzZWxkID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChzZWxlY3QoY29s\nc1tpXSwgcGosIHRydWUpKQogICAgICAgICAgICAgICAgc2VsZCB8PSAyIDw8\nIGk7CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2VsZWN0SWRlbnRpZmllcihDbGFzc01hcHBpbmcgbWFwcGluZywgaW50\nIHN1YmNsYXNzZXMsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXIpIHsKICAgICAgICBz\nZWxlY3RJZGVudGlmaWVyKG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBm\nZXRjaCwgZWFnZXIsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\nbGVjdElkZW50aWZpZXIoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJj\nbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyLAogICAgICAgIEpvaW5zIGpv\naW5zKSB7CiAgICAgICAgc2VsZWN0KHRoaXMsIG1hcHBpbmcsIHN1YmNsYXNz\nZXMsIHN0b3JlLCBmZXRjaCwgZWFnZXIsIGpvaW5zLCB0cnVlKTsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IHNlbGVjdFByaW1hcnlLZXkoQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcpIHsKICAgICAgICByZXR1cm4gc2VsZWN0UHJpbWFyeUtleSht\nYXBwaW5nLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdFBy\naW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpvaW5zIGpvaW5zKSB7\nCiAgICAgICAgcmV0dXJuIHByaW1hcnlLZXlPcGVyYXRpb24obWFwcGluZywg\ndHJ1ZSwgbnVsbCwgam9pbnMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIE9wZXJhdGUgb24gcHJpbWFyeSBrZXkgZGF0YS4gUmV0dXJuIGEgYml0\nIG1hc2sgb2Ygc2VsZWN0ZWQgY29sdW1ucy4KICAgICAqLwogICAgcHJpdmF0\nZSBpbnQgcHJpbWFyeUtleU9wZXJhdGlvbihDbGFzc01hcHBpbmcgbWFwcGlu\nZywgYm9vbGVhbiBzZWwsCiAgICAgICAgQm9vbGVhbiBhc2MsIEpvaW5zIGpv\naW5zLCBib29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICBpZiAoIXNlbCAm\nJiBhc2MgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIDA7CgogICAgICAg\nIC8vIGlmIHRoaXMgbWFwcGluZyBjYW4ndCBzZWxlY3QgdGhlIGZ1bGwgcGsg\ndmFsdWVzLCB0aGVuIGpvaW4gdG8KICAgICAgICAvLyBzdXBlciBhbmQgcmVj\ndXJzZQogICAgICAgIENsYXNzTWFwcGluZyBzdXA7CiAgICAgICAgaWYgKCFt\nYXBwaW5nLmlzUHJpbWFyeUtleU9iamVjdElkKHRydWUpKSB7CiAgICAgICAg\nICAgIHN1cCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBw\naW5nKCk7CiAgICAgICAgICAgIGlmIChqb2lucyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgam9pbnMgPSBuZXdKb2lucygpOwogICAgICAgICAgICBqb2lu\ncyA9IG1hcHBpbmcuam9pblN1cGVyY2xhc3Moam9pbnMsIGZhbHNlKTsKICAg\nICAgICAgICAgcmV0dXJuIHByaW1hcnlLZXlPcGVyYXRpb24oc3VwLCBzZWws\nIGFzYywgam9pbnMsIGFsaWFzT3JkZXIpOwogICAgICAgIH0KCiAgICAgICAg\nQ29sdW1uW10gY29scyA9IG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMo\nKTsKICAgICAgICBpZiAoaXNHcm91cGluZygpKSB7CiAgICAgICAgICAgIGdy\nb3VwQnkoY29scywgam9pbnMpOwogICAgICAgICAgICByZXR1cm4gMDsKICAg\nICAgICB9CgogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5z\nLCBmYWxzZSk7CiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\naWYgKGNvbHVtbk9wZXJhdGlvbihjb2xzW2ldLCBzZWwsIGFzYywgcGosIGFs\naWFzT3JkZXIpKQogICAgICAgICAgICAgICAgc2VsZCB8PSAyIDw8IGk7Cgog\nICAgICAgIC8vIGlmIHRoaXMgbWFwcGluZyBoYXMgbm90IGJlZW4gdXNlZCBp\nbiB0aGUgc2VsZWN0IHlldCAoYW5kIHRoZXJlZm9yZQogICAgICAgIC8vIGlz\nIG5vdCBqb2luZWQgdG8gYW55dGhpbmcpLCBidXQgaGFzIGFuIG90aGVyLXRh\nYmxlIHN1cGVyY2xhc3MgdGhhdAogICAgICAgIC8vIGhhcyBiZWVuIHVzZWQs\nIG1ha2Ugc3VyZSB0byBqb2luIHRvIGl0CiAgICAgICAgYm9vbGVhbiBqb2lu\nZWQgPSBmYWxzZTsKICAgICAgICBmb3IgKHN1cCA9IG1hcHBpbmcuZ2V0Sm9p\nbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7IHN1cCAhPSBudWxsOwogICAg\nICAgICAgICBtYXBwaW5nID0gc3VwLCBzdXAgPSBtYXBwaW5nLmdldEpvaW5h\nYmxlUENTdXBlcmNsYXNzTWFwcGluZygpKSB7CiAgICAgICAgICAgIGlmIChz\ndXAuZ2V0VGFibGUoKSA9PSBtYXBwaW5nLmdldFRhYmxlKCkpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChtYXBwaW5nLmdl\ndFRhYmxlKCkgIT0gc3VwLmdldFRhYmxlKCkKICAgICAgICAgICAgICAgICYm\nIGdldFRhYmxlSW5kZXgobWFwcGluZy5nZXRUYWJsZSgpLCBwaiwgZmFsc2Up\nID09IC0xCiAgICAgICAgICAgICAgICAmJiBnZXRUYWJsZUluZGV4KHN1cC5n\nZXRUYWJsZSgpLCBwaiwgZmFsc2UpICE9IC0xKSB7CiAgICAgICAgICAgICAg\nICBpZiAocGogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBwaiA9IChQ\nYXRoSm9pbnMpIG5ld0pvaW5zKCk7CiAgICAgICAgICAgICAgICBwaiA9IChQ\nYXRoSm9pbnMpIG1hcHBpbmcuam9pblN1cGVyY2xhc3MocGosIGZhbHNlKTsK\nICAgICAgICAgICAgICAgIGpvaW5lZCA9IHRydWU7CiAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAg\nIGlmIChqb2luZWQpCiAgICAgICAgICAgIHdoZXJlKHBqKTsKCiAgICAgICAg\ncmV0dXJuIHNlbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIGFu\nIG9wZXJhdGlvbiBvbiBhIGNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSBi\nb29sZWFuIGNvbHVtbk9wZXJhdGlvbihDb2x1bW4gY29sLCBib29sZWFuIHNl\nbCwgQm9vbGVhbiBhc2MsCiAgICAgICAgUGF0aEpvaW5zIHBqLCBib29sZWFu\nIGFsaWFzT3JkZXIpIHsKICAgICAgICBTdHJpbmcgYXMgPSBudWxsOwogICAg\nICAgIGlmIChhc2MgIT0gbnVsbCAmJiAoYWxpYXNPcmRlciB8fCAoX2ZsYWdz\nICYgUkVDT1JEX09SREVSRUQpICE9IDApKSB7CiAgICAgICAgICAgIE9iamVj\ndCBpZDsKICAgICAgICAgICAgaWYgKHBqID09IG51bGwgfHwgcGoucGF0aCgp\nID09IG51bGwpCiAgICAgICAgICAgICAgICBpZCA9IGNvbDsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgaWQgPSBnZXRDb2x1bW5BbGlhcyhj\nb2wsIHBqKTsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBSRUNPUkRfT1JE\nRVJFRCkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKF9vcmRlcmVkID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgX29yZGVyZWQgPSBuZXcgQXJy\nYXlMaXN0KDUpOwogICAgICAgICAgICAgICAgX29yZGVyZWQuYWRkKGlkKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWxpYXNPcmRlcikgewog\nICAgICAgICAgICAgICAgYXMgPSB0b09yZGVyQWxpYXMoX29yZGVycysrKTsK\nICAgICAgICAgICAgICAgIF9zZWxlY3RzLnNldFNlbGVjdEFzKGlkLCBhcyk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gc2Vs\nZCA9IHNlbCAmJiBzZWxlY3QoY29sLCBwaiwgZmFsc2UpOwogICAgICAgIGlm\nIChhc2MgIT0gbnVsbCkgewogICAgICAgICAgICBTdHJpbmcgYWxpYXMgPSAo\nYXMgIT0gbnVsbCkgPyBhcyA6IGdldENvbHVtbkFsaWFzKGNvbCwgcGopOwog\nICAgICAgICAgICBhcHBlbmRPcmRlcmluZyhhbGlhcywgYXNjLmJvb2xlYW5W\nYWx1ZSgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBcHBlbmQgb3JkZXJpbmcgaW5mb3JtYXRpb24g\ndG8gb3VyIGludGVybmFsIGJ1ZmZlci4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFwcGVuZE9yZGVyaW5nKE9iamVjdCBvcmRlckJ5LCBib29sZWFuIGFz\nYykgewogICAgICAgIGlmIChfb3JkZXJpbmcgPT0gbnVsbCkKICAgICAgICAg\nICAgX29yZGVyaW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKCIsICIpOwoKICAg\nICAgICBpZiAob3JkZXJCeSBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAg\nICAgICAgX29yZGVyaW5nLmFwcGVuZCgoU1FMQnVmZmVyKSBvcmRlckJ5KTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIF9vcmRlcmluZy5hcHBlbmQoKFN0\ncmluZykgb3JkZXJCeSk7CiAgICAgICAgaWYgKGFzYykKICAgICAgICAgICAg\nX29yZGVyaW5nLmFwcGVuZCgiIEFTQyIpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgX29yZGVyaW5nLmFwcGVuZCgiIERFU0MiKTsKICAgIH0KCiAgICBw\ndWJsaWMgaW50IG9yZGVyQnlQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBw\naW5nLCBib29sZWFuIGFzYywKICAgICAgICBib29sZWFuIHNlbCkgewogICAg\nICAgIHJldHVybiBvcmRlckJ5UHJpbWFyeUtleShtYXBwaW5nLCBhc2MsIG51\nbGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGludCBvcmRlckJ5UHJpbWFy\neUtleShDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBhc2MsCiAgICAg\nICAgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJu\nIG9yZGVyQnlQcmltYXJ5S2V5KG1hcHBpbmcsIGFzYywgam9pbnMsIHNlbCwg\nZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRv\nIHNldCBhbGlhc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIHB1\nYmxpYyBpbnQgb3JkZXJCeVByaW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsIGJvb2xlYW4gYXNjLAogICAgICAgIEpvaW5zIGpvaW5zLCBib29sZWFu\nIHNlbCwgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgcmV0dXJuIHBy\naW1hcnlLZXlPcGVyYXRpb24obWFwcGluZywgc2VsLAogICAgICAgICAgICAo\nYXNjKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UsIGpvaW5zLCBh\nbGlhc09yZGVyKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5\nKENvbHVtbiBjb2wsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNlbCkgewogICAg\nICAgIHJldHVybiBvcmRlckJ5KGNvbCwgYXNjLCBudWxsLCBzZWwpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoQ29sdW1uIGNvbCwgYm9v\nbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCkgewogICAgICAg\nIHJldHVybiBvcmRlckJ5KGNvbCwgYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFs\naWFzZXMgb24gb3JkZXIgY29sdW1ucy4KICAgICAqLwogICAgYm9vbGVhbiBv\ncmRlckJ5KENvbHVtbiBjb2wsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywg\nYm9vbGVhbiBzZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAg\nICAgICAgcmV0dXJuIGNvbHVtbk9wZXJhdGlvbihjb2wsIHNlbCwgKGFzYykg\nPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFLAogICAgICAgICAgICBn\nZXRKb2lucyhqb2lucywgdHJ1ZSksIGFsaWFzT3JkZXIpOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xzLCBib29sZWFuIGFz\nYywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShjb2xz\nLCBhc2MsIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGludCBvcmRl\nckJ5KENvbHVtbltdIGNvbHMsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywg\nYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShjb2xzLCBh\nc2MsIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFsbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBjb2x1bW5z\nLgogICAgICovCiAgICBpbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xzLCBib29s\nZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJv\nb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIFBhdGhKb2lucyBwaiA9IGdl\ndEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpbnQgc2VsZCA9IDA7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBpZiAoY29sdW1uT3BlcmF0aW9uKGNvbHNbaV0sIHNlbCwK\nICAgICAgICAgICAgICAgIChhc2MpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVh\nbi5GQUxTRSwgcGosIGFsaWFzT3JkZXIpKQogICAgICAgICAgICAgICAgc2Vs\nZCB8PSAyIDw8IGk7CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gb3JkZXJCeShTUUxCdWZmZXIgc3FsLCBib29sZWFu\nIGFzYywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShz\ncWwsIGFzYywgKEpvaW5zKSBudWxsLCBzZWwpOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIG9yZGVyQnkoU1FMQnVmZmVyIHNxbCwgYm9vbGVhbiBhc2Ms\nIEpvaW5zIGpvaW5zLAogICAgICAgIGJvb2xlYW4gc2VsKSB7CiAgICAgICAg\ncmV0dXJuIG9yZGVyQnkoc3FsLCBhc2MsIGpvaW5zLCBzZWwsIGZhbHNlKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHVuaW9ucyB0byBzZXQgYWxp\nYXNlcyBvbiBvcmRlciBjb2x1bW5zLgogICAgICovCiAgICBib29sZWFuIG9y\nZGVyQnkoU1FMQnVmZmVyIHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5z\nLCBib29sZWFuIHNlbCwKICAgICAgICBib29sZWFuIGFsaWFzT3JkZXIpIHsK\nICAgICAgICByZXR1cm4gb3JkZXJCeSgoT2JqZWN0KSBzcWwsIGFzYywgam9p\nbnMsIHNlbCwgYWxpYXNPcmRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBP\ncmRlciBvbiBhIFNRTCBidWZmZXIgb3Igc3RyaW5nLgogICAgICovCiAgICBw\ncml2YXRlIGJvb2xlYW4gb3JkZXJCeShPYmplY3Qgc3FsLCBib29sZWFuIGFz\nYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJvb2xlYW4g\nYWxpYXNPcmRlcikgewogICAgICAgIE9iamVjdCBvcmRlciA9IHNxbDsKICAg\nICAgICBpZiAoYWxpYXNPcmRlcikgewogICAgICAgICAgICBvcmRlciA9IHRv\nT3JkZXJBbGlhcyhfb3JkZXJzKyspOwogICAgICAgICAgICBfc2VsZWN0cy5z\nZXRTZWxlY3RBcyhzcWwsIChTdHJpbmcpIG9yZGVyKTsKICAgICAgICB9CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBSRUNPUkRfT1JERVJFRCkgIT0gMCkgewog\nICAgICAgICAgICBpZiAoX29yZGVyZWQgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9vcmRlcmVkID0gbmV3IEFycmF5TGlzdCg1KTsKICAgICAgICAgICAg\nX29yZGVyZWQuYWRkKHNxbCk7CiAgICAgICAgfQoKICAgICAgICBnZXRKb2lu\ncyhqb2lucywgdHJ1ZSk7CiAgICAgICAgYXBwZW5kT3JkZXJpbmcob3JkZXIs\nIGFzYyk7CiAgICAgICAgaWYgKHNlbCkgewogICAgICAgICAgICBpbnQgaWR4\nID0gX3NlbGVjdHMuaW5kZXhPZkFsaWFzKHNxbCk7CiAgICAgICAgICAgIGlm\nIChpZHggPT0gLTEpIHsKICAgICAgICAgICAgICAgIF9zZWxlY3RzLnNldEFs\naWFzKG51bGxJZCgpLCBzcWwsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5\nKFN0cmluZyBzcWwsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNlbCkgewogICAg\nICAgIHJldHVybiBvcmRlckJ5KHNxbCwgYXNjLCBudWxsLCBzZWwpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoU3RyaW5nIHNxbCwgYm9v\nbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCkgewogICAgICAg\nIHJldHVybiBvcmRlckJ5KHNxbCwgYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFs\naWFzZXMgb24gb3JkZXIgY29sdW1ucy4KICAgICAqLwogICAgYm9vbGVhbiBv\ncmRlckJ5KFN0cmluZyBzcWwsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywg\nYm9vbGVhbiBzZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAg\nICAgICAgcmV0dXJuIG9yZGVyQnkoKE9iamVjdCkgc3FsLCBhc2MsIGpvaW5z\nLCBzZWwsIGFsaWFzT3JkZXIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNs\nZWFyT3JkZXJpbmcoKSB7CiAgICAgICAgX29yZGVyaW5nID0gbnVsbDsKICAg\nICAgICBfb3JkZXJzID0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93\nIHVuaW9ucyB0byByZWNvcmQgdGhlIHNlbGVjdCBsaXN0IGluZGV4ZXMgb2Yg\naXRlbXMgd2Ugb3JkZXIgYnkuCiAgICAgKi8KICAgIHZvaWQgc2V0UmVjb3Jk\nT3JkZXJlZEluZGV4ZXMoYm9vbGVhbiByZWNvcmQpIHsKICAgICAgICBpZiAo\ncmVjb3JkKQogICAgICAgICAgICBfZmxhZ3MgfD0gUkVDT1JEX09SREVSRUQ7\nCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIF9vcmRlcmVkID0gbnVsbDsK\nICAgICAgICAgICAgX2ZsYWdzICY9IH5SRUNPUkRfT1JERVJFRDsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGluZGV4ZXMg\naW4gdGhlIHNlbGVjdCBsaXN0IG9mIGFsbCBpdGVtcyB3ZSdyZSBvcmRlcmlu\nZwogICAgICogYnksIG9yIG51bGwgaWYgbm9uZS4gRm9yIHVzZSB3aXRoIHVu\naW9ucy4KICAgICAqLwogICAgTGlzdCBnZXRPcmRlcmVkSW5kZXhlcygpIHsK\nICAgICAgICBpZiAoX29yZGVyZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgTGlzdCBpZHhzID0gbmV3IEFycmF5TGlzdChf\nb3JkZXJlZC5zaXplKCkpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nX29yZGVyZWQuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgIGlkeHMuYWRkKE51\nbWJlcnMudmFsdWVPZihfc2VsZWN0cy5pbmRleE9mKF9vcmRlcmVkLmdldChp\nKSkpKTsKICAgICAgICByZXR1cm4gaWR4czsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCB3aGVyZVByaW1hcnlLZXkoT2JqZWN0IG9pZCwgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAg\nd2hlcmVQcmltYXJ5S2V5KG9pZCwgbWFwcGluZywgbnVsbCwgc3RvcmUpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIHdoZXJlIGNvbmRpdGlvbnMgc2V0\ndGluZyB0aGUgbWFwcGluZydzIHByaW1hcnkga2V5IHRvIHRoZSBnaXZlbgog\nICAgICogb2lkIHZhbHVlcy4gSWYgdGhlIGdpdmVuIG1hcHBpbmcgZG9lcyBu\nb3QgdXNlIG9pZCB2YWx1ZXMgZm9yIGl0cwogICAgICogcHJpbWFyeSBrZXks\nIHdlIHdpbGwgcmVjdXJzaXZlbHkgam9pbiB0byBpdHMgc3VwZXJjbGFzcyB1\nbnRpbCB3ZSBmaW5kCiAgICAgKiBhbiBhbmNlc3RvciB0aGF0IGRvZXMuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCB3aGVyZVByaW1hcnlLZXkoT2JqZWN0\nIG9pZCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpvaW5zIGpvaW5zLAogICAg\nICAgIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIC8vIGlmIHRoaXMgbWFw\ncGluZydzIGlkZW50aWZpZXJzIGluY2x1ZGUgc29tZXRoaW5nIG90aGVyIHRo\nYW4KICAgICAgICAvLyB0aGUgcGsgdmFsdWVzLCBqb2luIHRvIHN1cGVyIGFu\nZCByZWN1cnNlCiAgICAgICAgaWYgKCFtYXBwaW5nLmlzUHJpbWFyeUtleU9i\namVjdElkKGZhbHNlKSkgewogICAgICAgICAgICBDbGFzc01hcHBpbmcgc3Vw\nID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsK\nICAgICAgICAgICAgaWYgKGpvaW5zID09IG51bGwpCiAgICAgICAgICAgICAg\nICBqb2lucyA9IG5ld0pvaW5zKCk7CiAgICAgICAgICAgIGpvaW5zID0gbWFw\ncGluZy5qb2luU3VwZXJjbGFzcyhqb2lucywgZmFsc2UpOwogICAgICAgICAg\nICB3aGVyZVByaW1hcnlLZXkob2lkLCBzdXAsIGpvaW5zLCBzdG9yZSk7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIENvbHVtbltd\nIGNvbHMgPSBtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAg\nICAgd2hlcmUob2lkLCBtYXBwaW5nLCBjb2xzLCBjb2xzLCBudWxsLCBudWxs\nLCBnZXRKb2lucyhqb2lucywgdHJ1ZSksCiAgICAgICAgICAgIHN0b3JlKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUZvcmVpZ25LZXkoRm9yZWln\nbktleSBmaywgT2JqZWN0IG9pZCwKICAgICAgICBDbGFzc01hcHBpbmcgbWFw\ncGluZywgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgd2hlcmVGb3JlaWdu\nS2V5KGZrLCBvaWQsIG1hcHBpbmcsIG51bGwsIHN0b3JlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCB3aGVyZSBjb25kaXRpb25zIHNldHRpbmcgdGhl\nIGdpdmVuIGZvcmVpZ24ga2V5IHRvIHRoZSBnaXZlbgogICAgICogb2lkIHZh\nbHVlcy4KICAgICAqCiAgICAgKiBAc2VlICN3aGVyZVByaW1hcnlLZXkKICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHdoZXJlRm9yZWlnbktleShGb3JlaWdu\nS2V5IGZrLCBPYmplY3Qgb2lkLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBw\naW5nLCBKb2lucyBqb2lucywgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAg\nLy8gaWYgdGhpcyBtYXBwaW5nJ3MgaWRlbnRpZmllcnMgaW5jbHVkZSBzb21l\ndGhpbmcgb3RoZXIgdGhhbgogICAgICAgIC8vIHRoZSBwayB2YWx1ZXMsIG9y\nIGlmIHRoaXMgZm9yZWlnbiBrZXkgZG9lc24ndCBsaW5rIHRvIG9ubHkKICAg\nICAgICAvLyBpZGVudGlmaWVycywgam9pbiB0byB0YWJsZSBhbmQgZG8gYSBn\nZXRQcmltYXJ5S2V5CiAgICAgICAgaWYgKCFtYXBwaW5nLmlzUHJpbWFyeUtl\neU9iamVjdElkKGZhbHNlKSB8fCAhY29udGFpbnNBbGwKICAgICAgICAgICAg\nKG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSwgZmsuZ2V0UHJpbWFy\neUtleUNvbHVtbnMoKSkpIHsKICAgICAgICAgICAgaWYgKGpvaW5zID09IG51\nbGwpCiAgICAgICAgICAgICAgICBqb2lucyA9IG5ld0pvaW5zKCk7CiAgICAg\nICAgICAgIC8vIHRyYXZlcnNlIHRvIGZvcmVpZ24ga2V5IHRhcmdldCBtYXBw\naW5nCiAgICAgICAgICAgIHdoaWxlIChtYXBwaW5nLmdldFRhYmxlKCkgIT0g\nZmsuZ2V0UHJpbWFyeUtleVRhYmxlKCkpIHsKICAgICAgICAgICAgICAgIGlm\nIChqb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGpvaW5zID0g\nbmV3Sm9pbnMoKTsKICAgICAgICAgICAgICAgIGpvaW5zID0gbWFwcGluZy5q\nb2luU3VwZXJjbGFzcyhqb2lucywgZmFsc2UpOwogICAgICAgICAgICAgICAg\nbWFwcGluZyA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBw\naW5nKCk7CiAgICAgICAgICAgICAgICBpZiAobWFwcGluZyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGpvaW5zID0gam9pbnMu\nam9pbihmaywgZmFsc2UsIGZhbHNlKTsKICAgICAgICAgICAgd2hlcmVQcmlt\nYXJ5S2V5KG9pZCwgbWFwcGluZywgam9pbnMsIHN0b3JlKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgQ29sdW1uW10gZnJvbUNv\nbHMgPSBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10gdG9Db2xz\nID0gZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBDb2x1bW5b\nXSBjb25zdENvbHMgPSBmay5nZXRDb25zdGFudENvbHVtbnMoKTsKICAgICAg\nICBPYmplY3RbXSBjb25zdHMgPSBmay5nZXRDb25zdGFudHMoKTsKICAgICAg\nICB3aGVyZShvaWQsIG1hcHBpbmcsIHRvQ29scywgZnJvbUNvbHMsIGNvbnN0\ncywgY29uc3RDb2xzLAogICAgICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1\nZSksIHN0b3JlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIG1l\ndGhvZCB0byBmbHVzaCB0aGUgb2lkIHZhbHVlcyBhcyB3aGVyZSBjb25kaXRp\nb25zIHRvIHRoZQogICAgICogZ2l2ZW4gY29sdW1ucy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHdoZXJlKE9iamVjdCBvaWQsIENsYXNzTWFwcGluZyBt\nYXBwaW5nLCBDb2x1bW5bXSB0b0NvbHMsCiAgICAgICAgQ29sdW1uW10gZnJv\nbUNvbHMsIE9iamVjdFtdIHZhbHMsIENvbHVtbltdIGNvbnN0Q29scywgUGF0\naEpvaW5zIHBqLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAg\nIFZhbHVlTWFwcGluZyBlbWJlZCA9IG1hcHBpbmcuZ2V0RW1iZWRkaW5nTWFw\ncGluZygpOwogICAgICAgIGlmIChlbWJlZCAhPSBudWxsKSB7CiAgICAgICAg\nICAgIHdoZXJlKG9pZCwgZW1iZWQuZ2V0RmllbGRNYXBwaW5nKCkuZ2V0RGVm\naW5pbmdNYXBwaW5nKCksCiAgICAgICAgICAgICAgICB0b0NvbHMsIGZyb21D\nb2xzLCB2YWxzLCBjb25zdENvbHMsIHBqLCBzdG9yZSk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBu\nZXcgU1FMQnVmZmVyKF9kaWN0KTsKCiAgICAgICAgLy8gb25seSBib3RoZXIg\ndG8gcGFjayBwayB2YWx1ZXMgaW50byBhcnJheSBpZiBhcHAgaWQgICAgICAg\nIAogICAgICAgIGludCBjb3VudCA9IHdoZXJlUHJpbWFyeUtleShtYXBwaW5n\nLCB0b0NvbHMsIGZyb21Db2xzLCBvaWQsIHN0b3JlLCBwaiwgCiAgICAgICAg\nCWJ1ZiwgbnVsbCk7CiAgICAgICAgICAgIAkKICAgICAgICBpZiAoY29uc3RD\nb2xzICE9IG51bGwgJiYgY29uc3RDb2xzLmxlbmd0aCA+IDApIHsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb25zdENvbHMubGVuZ3RoOyBp\nKyssIGNvdW50KyspIHsKICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IDAp\nCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoZ2V0Q29sdW1uQWxpYXMoY29uc3RD\nb2xzW2ldLCBwaikpOwoKICAgICAgICAgICAgICAgIGlmICh2YWxzW2ldID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIElTICIp\nOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiA9ICIpOwogICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZh\nbHVlKHZhbHNbaV0sIGNvbnN0Q29sc1tpXSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIHdoZXJlKGJ1ZiwgcGopOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgd2hlcmVQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5n\nLCBDb2x1bW5bXSB0b0NvbHMsIAogICAgCUNvbHVtbltdIGZyb21Db2xzLCBP\nYmplY3Qgb2lkLCBKREJDU3RvcmUgc3RvcmUsIFBhdGhKb2lucyBwaiwKICAg\nIAlTUUxCdWZmZXIgYnVmLCBMaXN0IHBhcm1MaXN0KSB7CiAgICAgICAgLy8g\nb25seSBib3RoZXIgdG8gcGFjayBwayB2YWx1ZXMgaW50byBhcnJheSBpZiBh\ncHAgaWQKICAgIAlib29sZWFuIGNvbGxlY3RQYXJtVmFsdWVPbmx5ID0gKHBh\ncm1MaXN0ICE9IG51bGwgPyB0cnVlIDogZmFsc2UpOwogICAgICAgIE9iamVj\ndFtdIHBrcyA9IG51bGw7CiAgICAgICAgaWYgKG1hcHBpbmcuZ2V0SWRlbnRp\ndHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX0FQUExJQ0FUSU9OKQogICAg\nICAgICAgICBwa3MgPSBBcHBsaWNhdGlvbklkcy50b1BLVmFsdWVzKG9pZCwg\nbWFwcGluZyk7CgogICAgICAgIEpvaW5hYmxlIGpvaW47CiAgICAgICAgT2Jq\nZWN0IHZhbDsKICAgICAgICBpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgdG9Db2xzLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7\nCiAgICAgICAgICAgIGlmIChwa3MgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHZhbCA9IChvaWQgPT0gbnVsbCkgPyBudWxsIDogTnVtYmVycy52YWx1ZU9m\nKCgoSWQpIG9pZCkuZ2V0SWQoKSk7CiAgICAgICAgICAgIGVsc2UgewogICAg\nICAgICAgICAgICAgLy8gbXVzdCBiZSBhcHAgaWRlbnRpdHk7IHVzZSBwayBp\nbmRleCB0byBnZXQgY29ycmVjdCBwayB2YWx1ZQogICAgICAgICAgICAgICAg\nam9pbiA9IG1hcHBpbmcuYXNzZXJ0Sm9pbmFibGUodG9Db2xzW2ldKTsKICAg\nICAgICAgICAgICAgIHZhbCA9IHBrc1ttYXBwaW5nLmdldEZpZWxkKGpvaW4u\nZ2V0RmllbGRJbmRleCgpKS4KICAgICAgICAgICAgICAgICAgICBnZXRQcmlt\nYXJ5S2V5SW5kZXgoKV07CiAgICAgICAgICAgICAgICB2YWwgPSBqb2luLmdl\ndEpvaW5WYWx1ZSh2YWwsIHRvQ29sc1tpXSwgc3RvcmUpOwogICAgICAgICAg\nICAgICAgaWYgKHBhcm1MaXN0ICE9IG51bGwpCiAgICAgICAgICAgICAgICAJ\ncGFybUxpc3QuYWRkKHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nCiAgICAgICAgICAgIGlmIChjb2xsZWN0UGFybVZhbHVlT25seSkgCiAgICAg\nICAgICAgIAljb250aW51ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlm\nIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5E\nICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGdldENvbHVtbkFsaWFzKGZy\nb21Db2xzW2ldLCBwaikpOwogICAgICAgICAgICBpZiAodmFsID09IG51bGwp\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgSVMgIik7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwog\nICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUodmFsLCBmcm9tQ29sc1tpXSk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBjb3VudDsKICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBUZXN0IHRvIHNlZSBpZiB0aGUgZ2l2ZW4gc2V0IG9m\nIGNvbHVtbnMgY29udGFpbnMgYWxsIHRoZQogICAgICogY29sdW1ucyBpbiB0\naGUgZ2l2ZW4gcG90ZW50aWFsIHN1YnNldC4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgYm9vbGVhbiBjb250YWluc0FsbChDb2x1bW5bXSBzZXQsIENv\nbHVtbltdIHN1YikgewogICAgICAgIGlmIChzdWIubGVuZ3RoID4gc2V0Lmxl\nbmd0aCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyB0\naGlzIGlzIG9idmlvdXNseSBuXjIsIGJ1dCB0aGUgbnVtYmVyIG9mIGNvbHVt\nbnMgc2hvdWxkIGJlIGluCiAgICAgICAgLy8gdGhlIDEtMiByYW5nZSwgc28g\nbm8gYmlnZ2llCiAgICAgICAgYm9vbGVhbiBmb3VuZCA9IHRydWU7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdWIubGVuZ3RoICYmIGZvdW5kOyBp\nKyspIHsKICAgICAgICAgICAgZm91bmQgPSBmYWxzZTsKICAgICAgICAgICAg\nZm9yIChpbnQgaiA9IDA7IGogPCBzZXQubGVuZ3RoICYmICFmb3VuZDsgaisr\nKQogICAgICAgICAgICAgICAgZm91bmQgPSBzdWJbaV0gPT0gc2V0W2pdOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gZm91bmQ7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgd2hlcmUoSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoam9p\nbnMgIT0gbnVsbCkKICAgICAgICAgICAgd2hlcmUoKFN0cmluZykgbnVsbCwg\nam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKFNRTEJ1ZmZl\nciBzcWwpIHsKICAgICAgICB3aGVyZShzcWwsIChKb2lucykgbnVsbCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgd2hlcmUoU1FMQnVmZmVyIHNxbCwgSm9p\nbnMgam9pbnMpIHsKICAgICAgICB3aGVyZShzcWwsIGdldEpvaW5zKGpvaW5z\nLCB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIGNvbmRpdGlvbiB0byB0aGUgV0hFUkUgY2xhdXNlLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgd2hlcmUoU1FMQnVmZmVyIHNxbCwgUGF0aEpvaW5zIHBq\nKSB7CiAgICAgICAgLy8gbm8gbmVlZCB0byB1c2Ugam9pbnMuLi4KICAgICAg\nICBpZiAoc3FsID09IG51bGwgfHwgc3FsLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBpZiAoX3doZXJlID09IG51bGwpCiAgICAg\nICAgICAgIF93aGVyZSA9IG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAg\nIGVsc2UgaWYgKCFfd2hlcmUuaXNFbXB0eSgpKQogICAgICAgICAgICBfd2hl\ncmUuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIF93aGVyZS5hcHBlbmQoc3Fs\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZShTdHJpbmcgc3FsKSB7\nCiAgICAgICAgd2hlcmUoc3FsLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHdoZXJlKFN0cmluZyBzcWwsIEpvaW5zIGpvaW5zKSB7\nCiAgICAgICAgd2hlcmUoc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRpb24g\ndG8gdGhlIFdIRVJFIGNsYXVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHdoZXJlKFN0cmluZyBzcWwsIFBhdGhKb2lucyBwaikgewogICAgICAgIC8v\nIG5vIG5lZWQgdG8gdXNlIGpvaW5zLi4uCiAgICAgICAgaWYgKFN0cmluZ1V0\naWxzLmlzRW1wdHkoc3FsKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBpZiAoX3doZXJlID09IG51bGwpCiAgICAgICAgICAgIF93aGVyZSA9IG5l\ndyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2UgaWYgKCFfd2hlcmUu\naXNFbXB0eSgpKQogICAgICAgICAgICBfd2hlcmUuYXBwZW5kKCIgQU5EICIp\nOwogICAgICAgIF93aGVyZS5hcHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBoYXZpbmcoU1FMQnVmZmVyIHNxbCkgewogICAgICAgIGhhdmlu\nZyhzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\naGF2aW5nKFNRTEJ1ZmZlciBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAg\naGF2aW5nKHNxbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBI\nQVZJTkcgY2xhdXNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgaGF2aW5n\nKFNRTEJ1ZmZlciBzcWwsIFBhdGhKb2lucyBwaikgewogICAgICAgIC8vIG5v\nIG5lZWQgdG8gdXNlIGpvaW5zLi4uCiAgICAgICAgaWYgKHNxbCA9PSBudWxs\nIHx8IHNxbC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgaWYgKF9oYXZpbmcgPT0gbnVsbCkKICAgICAgICAgICAgX2hhdmluZyA9\nIG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2UgaWYgKCFfaGF2\naW5nLmlzRW1wdHkoKSkKICAgICAgICAgICAgX2hhdmluZy5hcHBlbmQoIiBB\nTkQgIik7CiAgICAgICAgX2hhdmluZy5hcHBlbmQoc3FsKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBoYXZpbmcoU3RyaW5nIHNxbCkgewogICAgICAgIGhh\ndmluZyhzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgaGF2aW5nKFN0cmluZyBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAg\naGF2aW5nKHNxbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBI\nQVZJTkcgY2xhdXNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgaGF2aW5n\nKFN0cmluZyBzcWwsIFBhdGhKb2lucyBwaikgewogICAgICAgIC8vIG5vIG5l\nZWQgdG8gdXNlIGpvaW5zLi4uCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlz\nRW1wdHkoc3FsKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAo\nX2hhdmluZyA9PSBudWxsKQogICAgICAgICAgICBfaGF2aW5nID0gbmV3IFNR\nTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgZWxzZSBpZiAoIV9oYXZpbmcuaXNF\nbXB0eSgpKQogICAgICAgICAgICBfaGF2aW5nLmFwcGVuZCgiIEFORCAiKTsK\nICAgICAgICBfaGF2aW5nLmFwcGVuZChzcWwpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGdyb3VwQnkoU1FMQnVmZmVyIHNxbCkgewogICAgICAgIGdyb3Vw\nQnkoc3FsLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGdyb3VwQnkoU1FMQnVmZmVyIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAg\nICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgZ3JvdXBCeUFwcGVu\nZChzcWwuZ2V0U1FMKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3Vw\nQnkoU3RyaW5nIHNxbCkgewogICAgICAgIGdyb3VwQnkoc3FsLCAoSm9pbnMp\nIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU3RyaW5n\nIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBnZXRKb2lucyhqb2lucywg\ndHJ1ZSk7CiAgICAgICAgZ3JvdXBCeUFwcGVuZChzcWwpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ29sdW1uIGNvbCkgewogICAgICAgIGdy\nb3VwQnkoY29sLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91\ncEJ5KENvbHVtbiBjb2wsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgUGF0aEpv\naW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAgIGdyb3Vw\nQnlBcHBlbmQoZ2V0Q29sdW1uQWxpYXMoY29sLCBwaikpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ29sdW1uW10gY29scykgewogICAgICAg\nIGdyb3VwQnkoY29scywgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nZ3JvdXBCeShDb2x1bW5bXSBjb2xzLCBKb2lucyBqb2lucykgewogICAgICAg\nIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgZ3JvdXBCeUFwcGVuZChnZXRDb2x1bW5BbGlhcyhjb2xzW2ld\nLCBwaikpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lk\nIGdyb3VwQnlBcHBlbmQoU3RyaW5nIHNxbCkgewogICAgICAgIGlmIChfZ3Jv\ndXBlZCA9PSBudWxsIHx8ICFfZ3JvdXBlZC5jb250YWlucyhzcWwpKSB7CiAg\nICAgICAgICAgIGlmIChfZ3JvdXBpbmcgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgX2dyb3VwaW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAg\nICAgICAgICAgICBfZ3JvdXBlZCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBfZ3JvdXBpbmcuYXBwZW5k\nKCIsICIpOwoKICAgICAgICAgICAgX2dyb3VwaW5nLmFwcGVuZChzcWwpOwog\nICAgICAgICAgICBfZ3JvdXBlZC5hZGQoc3FsKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDbGFzc01hcHBpbmcgbWFwcGlu\nZywgaW50IHN1YmNsYXNzZXMsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgZ3JvdXBC\neShtYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIG51bGwpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIGludCBzdWJjbGFzc2VzLCBKREJDU3RvcmUgc3RvcmUsCiAgICAg\nICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgSm9pbnMgam9pbnMp\nIHsKICAgICAgICAvLyB3ZSBpbXBsZW1lbnQgdGhpcyBieSBwdXR0aW5nIG91\ncnNlbHZlcyBpbnRvIGdyb3VwaW5nIG1vZGUsIHdoZXJlCiAgICAgICAgLy8g\nYWxsIHNlbGVjdCBpbnZvY2F0aW9ucyBhcmUgcmUtcm91dGVkIHRvIGdyb3Vw\nLWJ5IGludm9jYXRpb25zIGluc3RlYWQuCiAgICAgICAgLy8gdGhpcyBhbGxv\nd3MgdXMgdG8gdXRpbGl6ZSB0aGUgc2FtZSBzZWxlY3QgQVBJcyBvZiB0aGUg\nc3RvcmUgbWFuYWdlcgogICAgICAgIC8vIGFuZCBhbGwgdGhlIG1hcHBpbmcg\nc3RyYXRlZ2llcywgcmF0aGVyIHRoYW4gaGF2aW5nIHRvIGNyZWF0ZSAKICAg\nICAgICAvLyBlcXVpdmFsZW50IEFQSXMgYW5kIGR1cGxpY2F0ZSBsb2dpYyBm\nb3IgZ3JvdXBpbmcKICAgICAgICBib29sZWFuIHdhc0dyb3VwaW5nID0gaXNH\ncm91cGluZygpOwogICAgICAgIF9mbGFncyB8PSBHUk9VUElORzsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBzZWxlY3QobWFwcGluZywgc3ViY2xhc3Nl\ncywgc3RvcmUsIGZldGNoLCAKICAgICAgICAgICAgICAgIEVhZ2VyRmV0Y2hN\nb2Rlcy5FQUdFUl9OT05FLCBqb2lucyk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgaWYgKCF3YXNHcm91cGluZykKICAgICAgICAgICAgICAg\nIF9mbGFncyAmPSB+R1JPVVBJTkc7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciB3ZSdyZSBpbiBncm91cCBtb2RlLCB3aGVyZSBh\nbnkgc2VsZWN0IGlzIGNoYW5nZWQgdG8gYSBncm91cC1ieQogICAgICogY2Fs\nbC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzR3JvdXBpbmcoKSB7\nCiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBHUk9VUElORykgIT0gMDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgam9pbnMgdG8gdXNlIGZv\nciBjb2x1bW4gYWxpYXNlcywgZXRjLgogICAgICoKICAgICAqIEBwYXJhbSBq\nb2lucyBqb2lucyBnaXZlbiBieSB0aGUgdXNlcgogICAgICogQHJldHVybiB0\naGUgam9pbnMgdG8gdXNlIGZvciBhbGlhc2VzLCBldGMKICAgICAqLwogICAg\ncHJpdmF0ZSBQYXRoSm9pbnMgZ2V0Sm9pbnMoSm9pbnMgam9pbnMsIGJvb2xl\nYW4gcmVjb3JkKSB7CiAgICAgICAgUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lu\ncykgam9pbnM7CiAgICAgICAgYm9vbGVhbiBwcmUgPSAocGogPT0gbnVsbCB8\nfCAhcGouaXNEaXJ0eSgpKQogICAgICAgICAgICAmJiBfcHJlSm9pbnMgIT0g\nbnVsbCAmJiAhX3ByZUpvaW5zLmlzRW1wdHkoKTsKICAgICAgICBpZiAocHJl\nKQogICAgICAgICAgICBwaiA9IChQYXRoSm9pbnMpIF9wcmVKb2lucy5wZWVr\nKCk7CgogICAgICAgIGlmIChwaiA9PSBudWxsIHx8ICFwai5pc0RpcnR5KCkp\nCiAgICAgICAgICAgIHBqID0gX2pvaW5zOwogICAgICAgIGVsc2UgaWYgKCFw\ncmUpIHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBPVVRFUikgIT0gMCkK\nICAgICAgICAgICAgICAgIHBqID0gKFBhdGhKb2lucykgb3V0ZXIocGopOwog\nICAgICAgICAgICBpZiAocmVjb3JkKSB7CiAgICAgICAgICAgICAgICBpZiAo\nIXBqLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICByZW1vdmVQYXJl\nbnRKb2lucyhwaik7CiAgICAgICAgICAgICAgICBpZiAoIXBqLmlzRW1wdHko\nKSkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZUpvaW5zRnJvbVN1YnNl\nbGVjdHMocGopOwogICAgICAgICAgICAgICAgICAgIGlmIChfam9pbnMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX2pvaW5zID0gbmV3IFNl\nbGVjdEpvaW5zKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChfam9p\nbnMuam9pbnMoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBf\nam9pbnMuc2V0Sm9pbnMobmV3IEpvaW5TZXQocGouam9pbnMoKSkpOwogICAg\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAg\nX2pvaW5zLmpvaW5zKCkuYWRkQWxsKHBqLmpvaW5zKCkpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBwajsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhbnkgam9pbnMg\nYWxyZWFkeSBpbiBvdXIgcGFyZW50IHNlbGVjdCBmcm9tIHRoZSBnaXZlbiBu\nb24tZW1wdHkKICAgICAqIGpvaW4gc2V0LgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcmVtb3ZlUGFyZW50Sm9pbnMoUGF0aEpvaW5zIHBqKSB7CiAgICAg\nICAgaWYgKF9wYXJlbnQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIGlmIChfcGFyZW50Ll9qb2lucyAhPSBudWxsICYmICFfcGFyZW50\nLl9qb2lucy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgYm9vbGVhbiByZW1v\ndmVkID0gZmFsc2U7CiAgICAgICAgICAgIGlmICghX3JlbW92ZWRBbGlhc0Zy\nb21QYXJlbnQuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IHBqLmpvaW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgICAgIEpvaW4gam4gPSAoSm9pbikg\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgIGlmIChfYWxpYXNlcy5j\nb250YWluc1ZhbHVlKGpuLmdldEluZGV4MSgpKSkKICAgICAgICAgICAgICAg\nICAgICAgICByZW1vdmVkID0gX3BhcmVudC5fam9pbnMuam9pbnMoKS5yZW1v\ndmUoam4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlmICghcmVtb3ZlZCkKICAgICAgICAgICAgICAgIHBqLmpvaW5z\nKCkucmVtb3ZlQWxsKF9wYXJlbnQuX2pvaW5zLmpvaW5zKCkpOwogICAgICAg\nIH0KICAgICAgICBpZiAoIXBqLmlzRW1wdHkoKSkKICAgICAgICAgICAgX3Bh\ncmVudC5yZW1vdmVQYXJlbnRKb2lucyhwaik7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZW1vdmUgdGhlIGdpdmVuIG5vbi1lbXB0eSBqb2lucyBmcm9tIHRo\nZSBqb2lucyBvZiBvdXIgc3Vic2VsZWN0cy4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHJlbW92ZUpvaW5zRnJvbVN1YnNlbGVjdHMoUGF0aEpvaW5zIHBq\nKSB7CiAgICAgICAgaWYgKF9zdWJzZWxzID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICBTZWxlY3RJbXBsIHN1YjsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IF9zdWJzZWxzLnNpemUoKTsgaSsrKSB7CiAgICAg\nICAgICAgIHN1YiA9IChTZWxlY3RJbXBsKSBfc3Vic2Vscy5nZXQoaSk7CiAg\nICAgICAgICAgIGlmIChzdWIuX2pvaW5zICE9IG51bGwgJiYgIXN1Yi5fam9p\nbnMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgc3ViLl9qb2lucy5qb2lu\ncygpLnJlbW92ZUFsbChwai5qb2lucygpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIFNlbGVjdEV4ZWN1dG9yIHdoZXJlQ2xvbmUoaW50IHNlbHMp\nIHsKICAgICAgICBpZiAoc2VscyA8IDEpCiAgICAgICAgICAgIHNlbHMgPSAx\nOwoKICAgICAgICBTZWxlY3RbXSBjbG9uZXMgPSBudWxsOwogICAgICAgIFNl\nbGVjdEltcGwgc2VsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2Vs\nczsgaSsrKSB7CiAgICAgICAgICAgIHNlbCA9IChTZWxlY3RJbXBsKSBfY29u\nZi5nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKS5uZXdTZWxlY3QoKTsKICAgICAg\nICAgICAgc2VsLl9mbGFncyA9IF9mbGFnczsKICAgICAgICAgICAgc2VsLl9m\nbGFncyAmPSB+QUdHUkVHQVRFOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9\nIH5PVVRFUjsKICAgICAgICAgICAgc2VsLl9mbGFncyAmPSB+TFJTOwogICAg\nICAgICAgICBzZWwuX2ZsYWdzICY9IH5FQUdFUl9UT19PTkU7CiAgICAgICAg\nICAgIHNlbC5fZmxhZ3MgJj0gfkVBR0VSX1RPX01BTlk7CiAgICAgICAgICAg\nIHNlbC5fZmxhZ3MgJj0gfkZPUkNFX0NPVU5UOwogICAgICAgICAgICBzZWwu\nX2pvaW5TeW50YXggPSBfam9pblN5bnRheDsKICAgICAgICAgICAgaWYgKF9h\nbGlhc2VzICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX2FsaWFzZXMg\nPSBuZXcgSGFzaE1hcChfYWxpYXNlcyk7CiAgICAgICAgICAgIGlmIChfdGFi\nbGVzICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX3RhYmxlcyA9IG5l\ndyBUcmVlTWFwKF90YWJsZXMpOwogICAgICAgICAgICBpZiAoX2pvaW5zICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX2pvaW5zID0gX2pvaW5zLmNs\nb25lKHNlbCk7CiAgICAgICAgICAgIGlmIChfd2hlcmUgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHNlbC5fd2hlcmUgPSBuZXcgU1FMQnVmZmVyKF93aGVy\nZSk7CiAgICAgICAgICAgIGlmIChfZnJvbSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBzZWwuX2Zyb20gPSAoU2VsZWN0SW1wbCkgX2Zyb20ud2hlcmVD\nbG9uZSgxKTsKICAgICAgICAgICAgICAgIHNlbC5fZnJvbS5fb3V0ZXIgPSBz\nZWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9zdWJzZWxzICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIHNlbC5fc3Vic2VscyA9IG5ldyBB\ncnJheUxpc3QoX3N1YnNlbHMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgIFNl\nbGVjdEltcGwgc3ViLCBzZWxTdWI7CiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBqID0gMDsgaiA8IF9zdWJzZWxzLnNpemUoKTsgaisrKSB7CiAgICAgICAg\nICAgICAgICAgICAgc3ViID0gKFNlbGVjdEltcGwpIF9zdWJzZWxzLmdldChq\nKTsKICAgICAgICAgICAgICAgICAgICBzZWxTdWIgPSAoU2VsZWN0SW1wbCkg\nc3ViLmZ1bGxDbG9uZSgxKTsKICAgICAgICAgICAgICAgICAgICBzZWxTdWIu\nX3BhcmVudCA9IHNlbDsKICAgICAgICAgICAgICAgICAgICBzZWxTdWIuX3N1\nYlBhdGggPSBzdWIuX3N1YlBhdGg7CiAgICAgICAgICAgICAgICAgICAgc2Vs\nLl9zdWJzZWxzLmFkZChzZWxTdWIpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChzZWwuX3doZXJlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNlbC5fd2hlcmUucmVwbGFjZShzdWIsIHNlbFN1Yik7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWxzID09\nIDEpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsOwogICAgICAgICAgICBp\nZiAoY2xvbmVzID09IG51bGwpCiAgICAgICAgICAgICAgICBjbG9uZXMgPSBu\nZXcgU2VsZWN0W3NlbHNdOwogICAgICAgICAgICBjbG9uZXNbaV0gPSBzZWw7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBfY29uZi5nZXRTUUxGYWN0b3J5\nSW5zdGFuY2UoKS5uZXdVbmlvbihjbG9uZXMpOwogICAgfQoKICAgIHB1Ymxp\nYyBTZWxlY3RFeGVjdXRvciBmdWxsQ2xvbmUoaW50IHNlbHMpIHsKICAgICAg\nICBpZiAoc2VscyA8IDEpCiAgICAgICAgICAgIHNlbHMgPSAxOwoKICAgICAg\nICBTZWxlY3RbXSBjbG9uZXMgPSBudWxsOwogICAgICAgIFNlbGVjdEltcGwg\nc2VsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2VsczsgaSsrKSB7\nCiAgICAgICAgICAgIHNlbCA9IChTZWxlY3RJbXBsKSB3aGVyZUNsb25lKDEp\nOwogICAgICAgICAgICBzZWwuX2ZsYWdzID0gX2ZsYWdzOwogICAgICAgICAg\nICBzZWwuX2V4cGVjdGVkUmVzdWx0Q291bnQgPSBfZXhwZWN0ZWRSZXN1bHRD\nb3VudDsKICAgICAgICAgICAgc2VsLl9zZWxlY3RzLmFkZEFsbChfc2VsZWN0\ncyk7CiAgICAgICAgICAgIGlmIChfb3JkZXJpbmcgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHNlbC5fb3JkZXJpbmcgPSBuZXcgU1FMQnVmZmVyKF9vcmRl\ncmluZyk7CiAgICAgICAgICAgIHNlbC5fb3JkZXJzID0gX29yZGVyczsKICAg\nICAgICAgICAgaWYgKF9ncm91cGluZyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgc2VsLl9ncm91cGluZyA9IG5ldyBTUUxCdWZmZXIoX2dyb3VwaW5nKTsK\nICAgICAgICAgICAgaWYgKF9oYXZpbmcgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHNlbC5faGF2aW5nID0gbmV3IFNRTEJ1ZmZlcihfaGF2aW5nKTsKICAg\nICAgICAgICAgaWYgKF9mcm9tICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIHNlbC5fZnJvbSA9IChTZWxlY3RJbXBsKSBfZnJvbS5mdWxsQ2xvbmUoMSk7\nCiAgICAgICAgICAgICAgICBzZWwuX2Zyb20uX291dGVyID0gc2VsOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2VscyA9PSAxKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHNlbDsKICAgICAgICAgICAgaWYgKGNsb25lcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgY2xvbmVzID0gbmV3IFNlbGVjdFtz\nZWxzXTsKICAgICAgICAgICAgY2xvbmVzW2ldID0gc2VsOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCku\nbmV3VW5pb24oY2xvbmVzKTsKICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0RXhl\nY3V0b3IgZWFnZXJDbG9uZShGaWVsZE1hcHBpbmcga2V5LCBpbnQgZWFnZXJU\neXBlLAogICAgICAgIGJvb2xlYW4gdG9NYW55LCBpbnQgc2VscykgewogICAg\nICAgIGlmIChlYWdlclR5cGUgPT0gRUFHRVJfT1VURVIKICAgICAgICAgICAg\nJiYgX2pvaW5TeW50YXggPT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJ\nT05BTCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKF9l\nYWdlcktleXMgIT0gbnVsbCAmJiBfZWFnZXJLZXlzLmNvbnRhaW5zKGtleSkp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBnbG9iYWwg\nc2V0IG9mIGVhZ2VyIGtleXMKICAgICAgICBpZiAoX2VhZ2VyS2V5cyA9PSBu\ndWxsKQogICAgICAgICAgICBfZWFnZXJLZXlzID0gbmV3IEhhc2hTZXQoKTsK\nICAgICAgICBfZWFnZXJLZXlzLmFkZChrZXkpOwoKICAgICAgICBTZWxlY3RF\neGVjdXRvciBzZWw7CiAgICAgICAgaWYgKGVhZ2VyVHlwZSAhPSBFQUdFUl9Q\nQVJBTExFTCkgewogICAgICAgICAgICBpZiAodG9NYW55KQogICAgICAgICAg\nICAgICAgX2ZsYWdzIHw9IEVBR0VSX1RPX01BTlk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBFQUdFUl9UT19PTkU7CiAg\nICAgICAgICAgIHNlbCA9IHRoaXM7CiAgICAgICAgfSBlbHNlIGlmIChzZWxz\nIDwgMikKICAgICAgICAgICAgc2VsID0gcGFyYWxsZWxDbG9uZSgpOwogICAg\nICAgIGVsc2UgewogICAgICAgICAgICBTZWxlY3RbXSBjbG9uZXMgPSBuZXcg\nU2VsZWN0W3NlbHNdOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGNsb25lcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNsb25lc1tp\nXSA9IHBhcmFsbGVsQ2xvbmUoKTsKICAgICAgICAgICAgc2VsID0gX2NvbmYu\nZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCkubmV3VW5pb24oY2xvbmVzKTsKICAg\nICAgICB9CgogICAgICAgIGlmIChfZWFnZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgX2VhZ2VyID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfZWFnZXIucHV0\nKHRvRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsLCBmYWxzZSkpLCBzZWwp\nOwogICAgICAgIHJldHVybiBzZWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gYSBjbG9uZSBvZiB0aGlzIHNlbGVjdCBmb3IgdXNlIGluIGVhZ2Vy\nIHBhcmFsbGVsIHNlbGVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUgU2VsZWN0\nSW1wbCBwYXJhbGxlbENsb25lKCkgewogICAgICAgIFNlbGVjdEltcGwgc2Vs\nID0gKFNlbGVjdEltcGwpIHdoZXJlQ2xvbmUoMSk7CiAgICAgICAgc2VsLl9m\nbGFncyAmPSB+Tk9OQVVUT19ESVNUSU5DVDsKICAgICAgICBzZWwuX2VhZ2Vy\nS2V5cyA9IF9lYWdlcktleXM7CiAgICAgICAgaWYgKF9wcmVKb2lucyAhPSBu\ndWxsICYmICFfcHJlSm9pbnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIHNl\nbC5fcHJlSm9pbnMgPSBuZXcgU3RhY2soKTsKICAgICAgICAgICAgc2VsLl9w\ncmVKb2lucy5wdXNoKCgoU2VsZWN0Sm9pbnMpIF9wcmVKb2lucy5wZWVrKCkp\nLgogICAgICAgICAgICAgICAgY2xvbmUoc2VsKSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBzZWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndmlldyBvZiBlYWdlciBzZWxlY3RzLiBNYXkgYmUgbnVsbC4KICAgICAqLwog\nICAgcHVibGljIE1hcCBnZXRFYWdlck1hcCgpIHsKICAgICAgICByZXR1cm4g\nX2VhZ2VyOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3RFeGVjdXRvciBnZXRF\nYWdlcihGaWVsZE1hcHBpbmcga2V5KSB7CiAgICAgICAgaWYgKF9lYWdlciA9\nPSBudWxsIHx8ICFfZWFnZXJLZXlzLmNvbnRhaW5zKGtleSkpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAoU2VsZWN0RXhlY3V0\nb3IpIF9lYWdlci5nZXQodG9FYWdlcktleShrZXksIGdldEpvaW5zKG51bGws\nCiAgICAgICAgICAgIGZhbHNlKSkpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBlYWdlciBrZXkgdG8gdXNlIGZvciB0aGUgdXNlci1naXZl\nbiBrZXkuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCB0b0Vh\nZ2VyS2V5KEZpZWxkTWFwcGluZyBrZXksIFBhdGhKb2lucyBwaikgewogICAg\nICAgIGlmIChwaiA9PSBudWxsIHx8IHBqLnBhdGgoKSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4ga2V5OwogICAgICAgIHJldHVybiBuZXcgS2V5KHBq\nLnBhdGgoKS50b1N0cmluZygpLCBrZXkpOwogICAgfQoKICAgIHB1YmxpYyBK\nb2lucyBuZXdKb2lucygpIHsKICAgICAgICBpZiAoX3ByZUpvaW5zICE9IG51\nbGwgJiYgIV9wcmVKb2lucy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgU2Vs\nZWN0Sm9pbnMgc2ogPSAoU2VsZWN0Sm9pbnMpIF9wcmVKb2lucy5wZWVrKCk7\nCiAgICAgICAgICAgIHJldHVybiBzai5jbG9uZSh0aGlzKTsKICAgICAgICB9\nCiAgICAgICAgLy8gcmV0dXJuIHRoaXMgZm9yIGVmZmljaWVuY3kgaW4gY2Fz\nZSBubyBqb2lucyBlbmQgdXAgYmVpbmcgbWFkZQogICAgICAgIHJldHVybiB0\naGlzOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBuZXdPdXRlckpvaW5zKCkg\newogICAgICAgIHJldHVybiAoKFBhdGhKb2lucykgbmV3Sm9pbnMoKSkuc2V0\nT3V0ZXIodHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kKFNR\nTEJ1ZmZlciBidWYsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKGpvaW5z\nID09IG51bGwgfHwgam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGlmICghYnVmLmlzRW1wdHkoKSkKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICBKb2luIGpvaW4gPSBudWxs\nOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gKChQYXRoSm9pbnMpIGpv\naW5zKS5qb2lucygpLmpvaW5JdGVyYXRvcigpOwogICAgICAgICAgICBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICBqb2luID0gKEpvaW4pIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgIHN3aXRjaCAoX2pvaW5TeW50YXgpIHsKICAg\nICAgICAgICAgICAgIGNhc2UgSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJ\nT05BTDoKICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKF9kaWN0LnRv\nVHJhZGl0aW9uYWxKb2luKGpvaW4pKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSm9pblN5bnRheGVzLlNZTlRB\nWF9EQVRBQkFTRToKICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKF9k\naWN0LnRvTmF0aXZlSm9pbihqb2luKSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBKb2lucyBhbmQoSm9pbnMgam9pbnMxLCBKb2lucyBq\nb2luczIpIHsKICAgICAgICByZXR1cm4gYW5kKChQYXRoSm9pbnMpIGpvaW5z\nMSwgKFBhdGhKb2lucykgam9pbnMyLCB0cnVlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENvbWJpbmUgdGhlIGdpdmVuIGpvaW5zLgogICAgICovCiAgICBw\ncml2YXRlIFNlbGVjdEpvaW5zIGFuZChQYXRoSm9pbnMgajEsIFBhdGhKb2lu\ncyBqMiwgYm9vbGVhbiBudWxsSm9pbnMpIHsKICAgICAgICBpZiAoKGoxID09\nIG51bGwgfHwgajEuaXNFbXB0eSgpKQogICAgICAgICAgICAmJiAoajIgPT0g\nbnVsbCB8fCBqMi5pc0VtcHR5KCkpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgU2VsZWN0Sm9pbnMgc2ogPSBuZXcgU2VsZWN0Sm9pbnMo\ndGhpcyk7CiAgICAgICAgaWYgKGoxID09IG51bGwgfHwgajEuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgIGlmIChudWxsSm9pbnMpCiAgICAgICAgICAgICAg\nICBzai5zZXRKb2lucyhqMi5qb2lucygpKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgc2ouc2V0Sm9pbnMobmV3IEpvaW5TZXQoajIuam9p\nbnMoKSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEpvaW5TZXQg\nc2V0OwogICAgICAgICAgICBpZiAobnVsbEpvaW5zKQogICAgICAgICAgICAg\nICAgc2V0ID0gajEuam9pbnMoKTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgc2V0ID0gbmV3IEpvaW5TZXQoajEuam9pbnMoKSk7CgogICAg\nICAgICAgICBpZiAoajIgIT0gbnVsbCAmJiAhajIuaXNFbXB0eSgpKQogICAg\nICAgICAgICAgICAgc2V0LmFkZEFsbChqMi5qb2lucygpKTsKICAgICAgICAg\nICAgc2ouc2V0Sm9pbnMoc2V0KTsKICAgICAgICB9CgogICAgICAgIC8vIG51\nbGwgcHJldmlvdXMgam9pbnM7IGFsbCBhcmUgY29tYmluZWQgaW50byB0aGlz\nIG9uZQogICAgICAgIGlmIChudWxsSm9pbnMgJiYgajEgIT0gbnVsbCkKICAg\nICAgICAgICAgajEubnVsbEpvaW5zKCk7CiAgICAgICAgaWYgKG51bGxKb2lu\ncyAmJiBqMiAhPSBudWxsKQogICAgICAgICAgICBqMi5udWxsSm9pbnMoKTsK\nCiAgICAgICAgcmV0dXJuIHNqOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBv\ncihKb2lucyBqb2luczEsIEpvaW5zIGpvaW5zMikgewogICAgICAgIFBhdGhK\nb2lucyBqMSA9IChQYXRoSm9pbnMpIGpvaW5zMTsKICAgICAgICBQYXRoSm9p\nbnMgajIgPSAoUGF0aEpvaW5zKSBqb2luczI7CgogICAgICAgIC8vIGlmIG5v\nIGNvbW1vbiBqb2lucywgcmV0dXJuIG51bGw7IGlmIG9uZSBzaWRlIG9mIHRo\nZSBvciBjbGF1c2UgaGFzCiAgICAgICAgLy8gZGlmZmVyZW50IGpvaW5zIHRo\nYW4gdGhlIG90aGVyLCB0aGVuIHdlIG5lZWQgdG8gdXNlIGRpc3RpbmN0CiAg\nICAgICAgYm9vbGVhbiBqMUVtcHR5ID0gajEgPT0gbnVsbCB8fCBqMS5pc0Vt\ncHR5KCk7CiAgICAgICAgYm9vbGVhbiBqMkVtcHR5ID0gajIgPT0gbnVsbCB8\nfCBqMi5pc0VtcHR5KCk7CiAgICAgICAgaWYgKGoxRW1wdHkgfHwgajJFbXB0\neSkgewogICAgICAgICAgICBpZiAoajFFbXB0eSAmJiAhajJFbXB0eSkgewog\nICAgICAgICAgICAgICAgY29sbGVjdE91dGVySm9pbnMoajIpOwogICAgICAg\nICAgICAgICAgaWYgKCFqMi5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAg\nICAgX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNUOwogICAgICAgICAgICB9\nIGVsc2UgaWYgKGoyRW1wdHkgJiYgIWoxRW1wdHkpIHsKICAgICAgICAgICAg\nICAgIGNvbGxlY3RPdXRlckpvaW5zKGoxKTsKICAgICAgICAgICAgICAgIGlm\nICghajEuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgICAgIF9mbGFncyB8\nPSBJTVBMSUNJVF9ESVNUSU5DVDsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIGlmIGFsbCBj\nb21tb24gam9pbnMsIG1vdmUgYWxsIGpvaW5zIHRvIHJldHVybmVkIGluc3Rh\nbmNlCiAgICAgICAgU2VsZWN0Sm9pbnMgc2ogPSBuZXcgU2VsZWN0Sm9pbnMo\ndGhpcyk7CiAgICAgICAgaWYgKGoxLmpvaW5zKCkuZXF1YWxzKGoyLmpvaW5z\nKCkpKSB7CiAgICAgICAgICAgIHNqLnNldEpvaW5zKGoxLmpvaW5zKCkpOwog\nICAgICAgICAgICBqMS5udWxsSm9pbnMoKTsKICAgICAgICAgICAgajIubnVs\nbEpvaW5zKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgSm9pblNl\ndCBjb21tb25Kb2lucyA9IG5ldyBKb2luU2V0KGoxLmpvaW5zKCkpOwogICAg\nICAgICAgICBjb21tb25Kb2lucy5yZXRhaW5BbGwoajIuam9pbnMoKSk7CiAg\nICAgICAgICAgIGlmICghY29tbW9uSm9pbnMuaXNFbXB0eSgpKSB7CiAgICAg\nICAgICAgICAgICAvLyBwdXQgY29tbW9uIGpvaW5zIGluIHJldHVybmVkIGlu\nc3RhbmNlOyByZW1vdmUgdGhlbSBmcm9tCiAgICAgICAgICAgICAgICAvLyBl\nYWNoIGdpdmVuIGluc3RhbmNlCiAgICAgICAgICAgICAgICBzai5zZXRKb2lu\ncyhjb21tb25Kb2lucyk7CiAgICAgICAgICAgICAgICBqMS5qb2lucygpLnJl\nbW92ZUFsbChjb21tb25Kb2lucyk7CiAgICAgICAgICAgICAgICBqMi5qb2lu\ncygpLnJlbW92ZUFsbChjb21tb25Kb2lucyk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgY29sbGVjdE91dGVySm9pbnMoajEpOwogICAgICAgICAgICBj\nb2xsZWN0T3V0ZXJKb2lucyhqMik7CgogICAgICAgICAgICAvLyBpZiBvbmUg\nc2lkZSBvZiB0aGUgb3IgY2xhdXNlIGhhcyBkaWZmZXJlbnQgam9pbnMgdGhh\nbiB0aGUgb3RoZXIsCiAgICAgICAgICAgIC8vIHRoZW4gd2UgbmVlZCB0byB1\nc2UgZGlzdGluY3QKICAgICAgICAgICAgaWYgKCFqMS5pc0VtcHR5KCkgfHwg\nIWoyLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBJTVBM\nSUNJVF9ESVNUSU5DVDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNqOwog\nICAgfQoKICAgIHB1YmxpYyBKb2lucyBvdXRlcihKb2lucyBqb2lucykgewog\nICAgICAgIGlmIChfam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFY\nX1RSQURJVElPTkFMIHx8IGpvaW5zID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBqb2luczsKCiAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBpcyBh\nbiBvdXRlciBqb2luIHNldCwgZXZlbiBpZiBpdCdzIGVtcHR5CiAgICAgICAg\nUGF0aEpvaW5zIHBqID0gKChQYXRoSm9pbnMpIGpvaW5zKS5zZXRPdXRlcih0\ncnVlKTsKICAgICAgICBpZiAocGouaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm4gcGo7CgogICAgICAgIEpvaW4gam9pbjsKICAgICAgICBKb2luIHJl\nYzsKICAgICAgICBib29sZWFuIGhhc0pvaW5zID0gX2pvaW5zICE9IG51bGwg\nJiYgX2pvaW5zLmpvaW5zKCkgIT0gbnVsbDsKICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IHBqLmpvaW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgam9pbiA9IChKb2luKSBpdHIubmV4dCgpOwog\nICAgICAgICAgICBpZiAoam9pbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX0lO\nTkVSKSB7CiAgICAgICAgICAgICAgICBpZiAoIWhhc0pvaW5zKQogICAgICAg\nICAgICAgICAgICAgIGpvaW4uc2V0VHlwZShKb2luLlRZUEVfT1VURVIpOwog\nICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVj\nID0gX2pvaW5zLmpvaW5zKCkuZ2V0UmVjb3JkZWRKb2luKGpvaW4pOwogICAg\nICAgICAgICAgICAgICAgIGlmIChyZWMgPT0gbnVsbCB8fCByZWMuZ2V0VHlw\nZSgpID09IEpvaW4uVFlQRV9PVVRFUikKICAgICAgICAgICAgICAgICAgICAg\nICAgam9pbi5zZXRUeXBlKEpvaW4uVFlQRV9PVVRFUik7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGpvaW5zOwogICAgfQoKICAgIC8qKgogICAgICogTW92ZXMgdGhlIGpvaW5z\nIGZyb20gdGhlIGdpdmVuIGluc3RhbmNlIGludG8gb3VyIG91dGVyIGpvaW5z\nIHNldC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNvbGxlY3RPdXRlckpv\naW5zKFBhdGhKb2lucyBwaikgewogICAgICAgIGlmIChfam9pblN5bnRheCA9\nPSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElPTkFMIHx8IHBqID09IG51\nbGwKICAgICAgICAgICAgfHwgcGouaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAg\nICAgX2pvaW5zID0gbmV3IFNlbGVjdEpvaW5zKHRoaXMpOwoKICAgICAgICBi\nb29sZWFuIGFkZCA9IHRydWU7CiAgICAgICAgaWYgKF9qb2lucy5qb2lucygp\nID09IG51bGwpIHsKICAgICAgICAgICAgX2pvaW5zLnNldEpvaW5zKHBqLmpv\naW5zKCkpOwogICAgICAgICAgICBhZGQgPSBmYWxzZTsKICAgICAgICB9Cgog\nICAgICAgIEpvaW4gam9pbjsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIHBqLmpvaW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgam9pbiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAgICAg\nICBpZiAoam9pbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX0lOTkVSKSB7CiAg\nICAgICAgICAgICAgICBpZiAoam9pbi5nZXRGb3JlaWduS2V5KCkgIT0gbnVs\nbAogICAgICAgICAgICAgICAgICAgICYmICFfZGljdC5jYW5PdXRlckpvaW4o\nX2pvaW5TeW50YXgsIGpvaW4uZ2V0Rm9yZWlnbktleSgpKSkgewogICAgICAg\nICAgICAgICAgICAgIExvZyBsb2cgPSBfY29uZi5nZXRMb2coSkRCQ0NvbmZp\nZ3VyYXRpb24uTE9HX0pEQkMpOwogICAgICAgICAgICAgICAgICAgIGlmIChs\nb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBs\nb2cud2FybihfbG9jLmdldCgiY2FudC1vdXRlci1mayIsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBqb2luLmdldEZvcmVpZ25LZXkoKSkpOwogICAg\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgam9pbi5z\nZXRUeXBlKEpvaW4uVFlQRV9PVVRFUik7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKGFkZCkKICAgICAgICAgICAgICAgIF9qb2lucy5qb2lucygp\nLmFkZChqb2luKTsKICAgICAgICB9CiAgICAgICAgcGoubnVsbEpvaW5zKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGFsaWFzIGZvciB0\naGUgZ2l2ZW4gdGFibGUgdW5kZXIgdGhlIGdpdmVuIGpvaW5zLgogICAgICog\nTk9URTogV0UgUkVMWSBPTiBUSEVTRSBJTkRFWEVTIEJFSU5HIE1PTk9UT05J\nQ0FMTFkgSU5DUkVBU0lORyBGUk9NIDAKICAgICAqLwogICAgcHJpdmF0ZSBp\nbnQgZ2V0VGFibGVJbmRleChUYWJsZSB0YWJsZSwgUGF0aEpvaW5zIHBqLCBi\nb29sZWFuIGNyZWF0ZSkgewogICAgICAgIC8vIGlmIHdlIGhhdmUgYSBmcm9t\nIHNlbGVjdCwgdGhlbiB0aGVyZSBhcmUgbm8gdGFibGUgYWxpYXNlcwogICAg\nICAgIGlmIChfZnJvbSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gLTE7\nCgogICAgICAgIE9iamVjdCBrZXkgPSB0YWJsZS5nZXRGdWxsTmFtZSgpOwog\nICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBqLnBhdGgoKSAhPSBudWxsKQog\nICAgICAgICAgICBrZXkgPSBuZXcgS2V5KHBqLnBhdGgoKS50b1N0cmluZygp\nLCBrZXkpOwoKICAgICAgICAvLyBjaGVjayBvdXQgZXhpc3RpbmcgYWxpYXNl\ncwogICAgICAgIEludGVnZXIgaSA9IGZpbmRBbGlhcyh0YWJsZSwga2V5LCBm\nYWxzZSwgbnVsbCk7CiAgICAgICAgaWYgKGkgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGkuaW50VmFsdWUoKTsKICAgICAgICBpZiAoIWNyZWF0ZSkK\nICAgICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAgICAvLyBub3QgZm91bmQ7\nIGNyZWF0ZSBhbGlhcwogICAgICAgIGkgPSBOdW1iZXJzLnZhbHVlT2YoYWxp\nYXNTaXplKCkpOwogICAgICAgIHJlY29yZFRhYmxlQWxpYXModGFibGUsIGtl\neSwgaSk7CiAgICAgICAgcmV0dXJuIGkuaW50VmFsdWUoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEF0dGVtcHQgdG8gZmluZCB0aGUgYWxpYXMgZm9yIHRo\nZSBnaXZlbiBrZXkuCiAgICAgKgogICAgICogQHBhcmFtIGZyb21QYXJlbnQg\nd2hldGhlciBhIHBhcmVudCBpcyBjaGVja2luZyBpdHMgc3Vic2VsZWN0cwog\nICAgICogQHBhcmFtIGZyb21TdWIgdGhlIHN1YnNlbGVjdCBjaGVja2luZyBp\ndHMgcGFyZW50CiAgICAgKi8KICAgIHByaXZhdGUgSW50ZWdlciBmaW5kQWxp\nYXMoVGFibGUgdGFibGUsIE9iamVjdCBrZXksIGJvb2xlYW4gZnJvbVBhcmVu\ndCwKICAgICAgICBTZWxlY3RJbXBsIGZyb21TdWIpIHsKICAgICAgICBJbnRl\nZ2VyIGFsaWFzID0gbnVsbDsKICAgICAgICBpZiAoX2FsaWFzZXMgIT0gbnVs\nbCkgewogICAgICAgICAgICBhbGlhcyA9IChJbnRlZ2VyKSAoKGZyb21QYXJl\nbnQpID8gX2FsaWFzZXMucmVtb3ZlKGtleSkKICAgICAgICAgICAgICAgIDog\nX2FsaWFzZXMuZ2V0KGtleSkpOwogICAgICAgICAgICBpZiAoYWxpYXMgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGZyb21QYXJlbnQpCiAgICAg\nICAgICAgICAgICAgICAgX3RhYmxlcy5yZW1vdmUoYWxpYXMpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIGlmICghZnJvbVBhcmVudCAmJiBfcGFyZW50ICE9IG51bGwp\nIHsKICAgICAgICAgICAgYm9vbGVhbiByZW1vdmVBbGlhc0Zyb21QYXJlbnQg\nPSBrZXkudG9TdHJpbmcoKS5pbmRleE9mKCI6IikgIT0gLTE7CiAgICAgICAg\nICAgIGFsaWFzID0gX3BhcmVudC5maW5kQWxpYXModGFibGUsIGtleSwgcmVt\nb3ZlQWxpYXNGcm9tUGFyZW50LCB0aGlzKTsKICAgICAgICAgICAgaWYgKGFs\naWFzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChyZW1vdmVBbGlh\nc0Zyb21QYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICByZWNvcmRUYWJs\nZUFsaWFzKHRhYmxlLCBrZXksIGFsaWFzKTsKICAgICAgICAgICAgICAgICAg\nICBfcmVtb3ZlZEFsaWFzRnJvbVBhcmVudC5zZXQoYWxpYXMuaW50VmFsdWUo\nKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4g\nYWxpYXM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF9z\ndWJzZWxzICE9IG51bGwpIHsKICAgICAgICAgICAgU2VsZWN0SW1wbCBzdWI7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX3N1YnNlbHMuc2l6\nZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIHN1YiA9IChTZWxlY3RJbXBs\nKSBfc3Vic2Vscy5nZXQoaSk7CiAgICAgICAgICAgICAgICBpZiAoc3ViID09\nIGZyb21TdWIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgICAgICBpZiAoYWxpYXMgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIGlmIChzdWIuX2FsaWFzZXMgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgc3ViLl9hbGlhc2VzLnJlbW92ZShrZXkpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChzdWIuX3RhYmxlcyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICBzdWIuX3RhYmxlcy5yZW1vdmUoYWxpYXMpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoa2V5IGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGFsaWFzID0gc3ViLmZpbmRBbGlhcyh0YWJsZSwga2V5LCB0cnVl\nLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmcm9tUGFy\nZW50ICYmIGFsaWFzICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICByZWNvcmRUYWJsZUFsaWFzKHRhYmxlLCBrZXksIGFsaWFzKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVjb3JkIHRoZSBtYXBwaW5nIG9mIHRoZSBnaXZl\nbiBrZXkgdG8gdGhlIGdpdmVuIGFsaWFzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcmVjb3JkVGFibGVBbGlhcyhUYWJsZSB0YWJsZSwgT2JqZWN0IGtl\neSwgSW50ZWdlciBhbGlhcykgewogICAgICAgIGlmIChfYWxpYXNlcyA9PSBu\ndWxsKQogICAgICAgICAgICBfYWxpYXNlcyA9IG5ldyBIYXNoTWFwKCk7CiAg\nICAgICAgX2FsaWFzZXMucHV0KGtleSwgYWxpYXMpOwoKICAgICAgICBTdHJp\nbmcgdGFibGVTdHJpbmcgPSBfZGljdC5nZXRGdWxsTmFtZSh0YWJsZSwgZmFs\nc2UpICsgIiAiCiAgICAgICAgICAgICsgdG9BbGlhcyhhbGlhcy5pbnRWYWx1\nZSgpKTsKICAgICAgICBpZiAoX3RhYmxlcyA9PSBudWxsKQogICAgICAgICAg\nICBfdGFibGVzID0gbmV3IFRyZWVNYXAoKTsKICAgICAgICBfdGFibGVzLnB1\ndChhbGlhcywgdGFibGVTdHJpbmcpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ2FsY3VsYXRlIHRvdGFsIG51bWJlciBvZiBhbGlhc2VzLgogICAgICovCiAg\nICBwcml2YXRlIGludCBhbGlhc1NpemUoKSB7CiAgICAgICAgcmV0dXJuIGFs\naWFzU2l6ZShmYWxzZSwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nYWxjdWxhdGUgdG90YWwgbnVtYmVyIG9mIGFsaWFzZXMuCiAgICAgKgogICAg\nICogQHBhcmFtIGZyb21QYXJlbnQgd2hldGhlciBhIHBhcmVudCBpcyBjaGVj\na2luZyBpdHMgc3Vic2VsZWN0cwogICAgICogQHBhcmFtIGZyb21TdWIgdGhl\nIHN1YnNlbGVjdCBjaGVja2luZyBpdHMgcGFyZW50CiAgICAgKi8KICAgIHBy\naXZhdGUgaW50IGFsaWFzU2l6ZShib29sZWFuIGZyb21QYXJlbnQsIFNlbGVj\ndEltcGwgZnJvbVN1YikgewogICAgICAgIGludCBhbGlhc2VzID0gKGZyb21Q\nYXJlbnQgfHwgX3BhcmVudCA9PSBudWxsKSA/IDAKICAgICAgICAgICAgOiBf\ncGFyZW50LmFsaWFzU2l6ZShmYWxzZSwgdGhpcyk7CiAgICAgICAgYWxpYXNl\ncyArPSAoX2FsaWFzZXMgPT0gbnVsbCkgPyAwIDogX2FsaWFzZXMuc2l6ZSgp\nOwogICAgICAgIGlmIChfc3Vic2VscyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIFNlbGVjdEltcGwgc3ViOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IF9zdWJzZWxzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBz\ndWIgPSAoU2VsZWN0SW1wbCkgX3N1YnNlbHMuZ2V0KGkpOwogICAgICAgICAg\nICAgICAgaWYgKHN1YiAhPSBmcm9tU3ViKQogICAgICAgICAgICAgICAgICAg\nIGFsaWFzZXMgKz0gc3ViLmFsaWFzU2l6ZSh0cnVlLCBudWxsKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYWxpYXNlczsKICAg\nIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgIHJl\ndHVybiB0b1NlbGVjdChmYWxzZSwgbnVsbCkuZ2V0U1FMKCk7CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUGF0aEpv\naW5zIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgcHVibGljIGJvb2xlYW4gaXNPdXRlcigpIHsKICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIFBhdGhKb2lucyBz\nZXRPdXRlcihib29sZWFuIG91dGVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBT\nZWxlY3RKb2lucyh0aGlzKS5zZXRPdXRlcih0cnVlKTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nQnVmZmVyIHBhdGgoKSB7CiAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIEpvaW5TZXQg\nam9pbnMoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVi\nbGljIGludCBqb2luQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgbnVsbEpvaW5zKCkgewogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBsb2Nh\nbFRhYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICByZXR1cm4g\nbmV3IFNlbGVjdEpvaW5zKHRoaXMpLmNyb3NzSm9pbihsb2NhbFRhYmxlLCBm\nb3JlaWduVGFibGUpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2luKEZv\ncmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkp\nIHsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLmpvaW4o\nZmssIGludmVyc2UsIHRvTWFueSk7CiAgICB9CgogICAgcHVibGljIEpvaW5z\nIG91dGVySm9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJv\nb2xlYW4gdG9NYW55KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lu\ncyh0aGlzKS5vdXRlckpvaW4oZmssIGludmVyc2UsIHRvTWFueSk7CiAgICB9\nCgogICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwg\nRm9yZWlnbktleSBmaywgQ2xhc3NNYXBwaW5nIHRhcmdldCwKICAgICAgICBp\nbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewog\nICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhpcykuam9pblJlbGF0\naW9uKG5hbWUsIGZrLCB0YXJnZXQsIHN1YnMsIAogICAgICAgICAgICBpbnZl\ncnNlLCB0b01hbnkpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBvdXRlckpv\naW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywgCiAgICAg\nICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xlYW4gaW52\nZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICByZXR1cm4gbmV3IFNl\nbGVjdEpvaW5zKHRoaXMpLm91dGVySm9pblJlbGF0aW9uKG5hbWUsIGZrLCB0\nYXJnZXQsIHN1YnMsIAogICAgICAgICAgICBpbnZlcnNlLCB0b01hbnkpOwog\nICAgfQoKICAgIHB1YmxpYyBKb2lucyBzZXRWYXJpYWJsZShTdHJpbmcgdmFy\nKSB7CiAgICAgICAgaWYgKHZhciA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMp\nLnNldFZhcmlhYmxlKHZhcik7CiAgICB9CgogICAgcHVibGljIEpvaW5zIHNl\ndFN1YnNlbGVjdChTdHJpbmcgYWxpYXMpIHsKICAgICAgICBpZiAoYWxpYXMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgcmV0\ndXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5zZXRTdWJzZWxlY3QoYWxpYXMp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50cyBhIFNRTCBzdHJp\nbmcgc2VsZWN0ZWQgd2l0aCBudWxsIGlkLgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBjbGFzcyBOdWxsSWQgewogICAgfQoKICAgIC8qKgogICAgICog\nUmVwcmVzZW50cyBhIHBsYWNlaG9sZGVyIFNRTCBzdHJpbmcuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFBsYWNlaG9sZGVyIHsKICAgIH0K\nCiAgICAvKioKICAgICAqIEtleSB0eXBlIHVzZWQgZm9yIGFsaWFzZXMuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIEtleSB7CgogICAgICAg\nIHByaXZhdGUgZmluYWwgU3RyaW5nIF9wYXRoOwogICAgICAgIHByaXZhdGUg\nZmluYWwgT2JqZWN0IF9rZXk7CgogICAgICAgIHB1YmxpYyBLZXkoU3RyaW5n\nIHBhdGgsIE9iamVjdCBrZXkpIHsKICAgICAgICAgICAgX3BhdGggPSBwYXRo\nOwogICAgICAgICAgICBfa2V5ID0ga2V5OwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9w\nYXRoLmhhc2hDb2RlKCkgXiBfa2V5Lmhhc2hDb2RlKCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7\nCiAgICAgICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChvdGhlci5nZXRDbGFz\ncygpICE9IGdldENsYXNzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIEtleSBrID0gKEtleSkgb3RoZXI7CiAgICAgICAg\nICAgIHJldHVybiBrLl9wYXRoLmVxdWFscyhfcGF0aCkgJiYgay5fa2V5LmVx\ndWFscyhfa2V5KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcg\ndG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBfcGF0aCArICJ8IiAr\nIF9rZXk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQSB7QGxp\nbmsgUmVzdWx0fSBpbXBsZW1lbnRhdGlvbiB3cmFwcGVkIGFyb3VuZCB0aGlz\nIHNlbGVjdC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFzcyBTZWxl\nY3RSZXN1bHQKICAgICAgICBleHRlbmRzIFJlc3VsdFNldFJlc3VsdAogICAg\nICAgIGltcGxlbWVudHMgUGF0aEpvaW5zIHsKCiAgICAgICAgcHJpdmF0ZSBT\nZWxlY3RJbXBsIF9zZWwgPSBudWxsOwoKICAgICAgICAvLyBwb3NpdGlvbiBp\nbiBzZWxlY3RlZCBjb2x1bW5zIGxpc3Qgd2hlcmUgd2UgZXhwZWN0IHRoZSBu\nZXh0IGxvYWQKICAgICAgICBwcml2YXRlIGludCBfcG9zID0gMDsKICAgICAg\nICBwcml2YXRlIFN0YWNrIF9wcmVKb2lucyA9IG51bGw7CgogICAgICAgIC8q\nKgogICAgICAgICAqIENvbnN0cnVjdG9yLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyBTZWxlY3RSZXN1bHQoQ29ubmVjdGlvbiBjb25uLCBTdGF0ZW1l\nbnQgc3RtbnQsIFJlc3VsdFNldCBycywKICAgICAgICAgICAgREJEaWN0aW9u\nYXJ5IGRpY3QpIHsKICAgICAgICAgICAgc3VwZXIoY29ubiwgc3RtbnQsIHJz\nLCBkaWN0KTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNl\nbGVjdCBmb3IgdGhpcyByZXN1bHQuCiAgICAgICAgICovCiAgICAgICAgcHVi\nbGljIFNlbGVjdEltcGwgZ2V0U2VsZWN0KCkgewogICAgICAgICAgICByZXR1\ncm4gX3NlbDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNl\nbGVjdCBmb3IgdGhpcyByZXN1bHQuCiAgICAgICAgICovCiAgICAgICAgcHVi\nbGljIHZvaWQgc2V0U2VsZWN0KFNlbGVjdEltcGwgc2VsKSB7CiAgICAgICAg\nICAgIF9zZWwgPSBzZWw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2Jq\nZWN0IGdldEVhZ2VyKEZpZWxkTWFwcGluZyBrZXkpIHsKICAgICAgICAgICAg\nLy8gZG9uJ3QgYm90aGVyIGNyZWF0aW5nIGtleSBpZiB3ZSBrbm93IHdlIGRv\nbid0IGhhdmUgYW55CiAgICAgICAgICAgIC8vIGVhZ2VyIHJlc3VsdHMKICAg\nICAgICAgICAgaWYgKF9zZWwuX2VhZ2VyID09IG51bGwgfHwgIV9zZWwuX2Vh\nZ2VyS2V5cy5jb250YWlucyhrZXkpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgICAgIE1hcCBtYXAgPSBTZWxlY3RSZXN1bHQudGhp\ncy5nZXRFYWdlck1hcCh0cnVlKTsKICAgICAgICAgICAgaWYgKG1hcCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAg\nIHJldHVybiBtYXAuZ2V0KF9zZWwudG9FYWdlcktleShrZXksIGdldEpvaW5z\nKG51bGwpKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBwdXRF\nYWdlcihGaWVsZE1hcHBpbmcga2V5LCBPYmplY3QgcmVzKSB7CiAgICAgICAg\nICAgIE1hcCBtYXAgPSBTZWxlY3RSZXN1bHQudGhpcy5nZXRFYWdlck1hcCh0\ncnVlKTsKICAgICAgICAgICAgaWYgKG1hcCA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBtYXAgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICAgICAg\nc2V0RWFnZXJNYXAobWFwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBt\nYXAucHV0KF9zZWwudG9FYWdlcktleShrZXksIGdldEpvaW5zKG51bGwpKSwg\ncmVzKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgbG9hZChD\nbGFzc01hcHBpbmcgbWFwcGluZywgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAg\nICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBKb2lucyBqb2lu\ncykKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIGJvb2xlYW4gaGFzSm9pbnMgPSBqb2lucyAhPSBudWxsCiAgICAgICAg\nICAgICAgICAmJiAoKFBhdGhKb2lucykgam9pbnMpLnBhdGgoKSAhPSBudWxs\nOwogICAgICAgICAgICBpZiAoaGFzSm9pbnMpIHsKICAgICAgICAgICAgICAg\nIGlmIChfcHJlSm9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBf\ncHJlSm9pbnMgPSBuZXcgU3RhY2soKTsKICAgICAgICAgICAgICAgIF9wcmVK\nb2lucy5wdXNoKGpvaW5zKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nT2JqZWN0IG9iaiA9IHN1cGVyLmxvYWQobWFwcGluZywgc3RvcmUsIGZldGNo\nLCBqb2lucyk7CgogICAgICAgICAgICAvLyByZXNldAogICAgICAgICAgICBp\nZiAoaGFzSm9pbnMpCiAgICAgICAgICAgICAgICBfcHJlSm9pbnMucG9wKCk7\nCiAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSm9pbnMgbmV3Sm9pbnMoKSB7CiAgICAgICAgICAgIFBhdGhKb2lu\ncyBwcmUgPSBnZXRQcmVKb2lucygpOwogICAgICAgICAgICBpZiAocHJlID09\nIG51bGwgfHwgcHJlLnBhdGgoKSA9PSBudWxsKQogICAgICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CgogICAgICAgICAgICBQYXRoSm9pbnNJbXBsIHBqID0g\nbmV3IFBhdGhKb2luc0ltcGwoKTsKICAgICAgICAgICAgcGoucGF0aCA9IG5l\ndyBTdHJpbmdCdWZmZXIocHJlLnBhdGgoKS50b1N0cmluZygpKTsKICAgICAg\nICAgICAgcmV0dXJuIHBqOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVk\nIGJvb2xlYW4gY29udGFpbnNJbnRlcm5hbChPYmplY3Qgb2JqLCBKb2lucyBq\nb2lucykgewogICAgICAgICAgICAvLyB3ZSBrZXkgZGlyZWN0bHkgb24gb2Jq\ncyBhbmQgam9pbi1sZXNzIGNvbHMsIG9yIG9uIHRoZSBhbGlhcwogICAgICAg\nICAgICAvLyBmb3IgY29scyB3aXRoIGpvaW5zCiAgICAgICAgICAgIFBhdGhK\nb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zKTsKICAgICAgICAgICAgaWYgKHBq\nICE9IG51bGwgJiYgcGoucGF0aCgpICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBvYmogPSBnZXRDb2x1bW5BbGlhcygoQ29sdW1uKSBvYmosIHBqKTsKICAg\nICAgICAgICAgcmV0dXJuIG9iaiAhPSBudWxsICYmIF9zZWwuX3NlbGVjdHMu\nY29udGFpbnMob2JqKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBi\nb29sZWFuIGNvbnRhaW5zQWxsSW50ZXJuYWwoT2JqZWN0W10gb2JqcywgSm9p\nbnMgam9pbnMpCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucyk7CiAg\nICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgb2Jqcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\naWYgKHBqICE9IG51bGwgJiYgcGoucGF0aCgpICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgb2JqID0gZ2V0Q29sdW1uQWxpYXMoKENvbHVtbikgb2Jq\nc1tpXSwgcGopOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgIG9iaiA9IG9ianNbaV07CiAgICAgICAgICAgICAgICBpZiAob2Jq\nID09IG51bGwgfHwgIV9zZWwuX3NlbGVjdHMuY29udGFpbnMob2JqKSkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBwdXNoQmFjaygpCiAgICAgICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICBfcG9zID0gMDsKICAgICAgICAgICAg\nc3VwZXIucHVzaEJhY2soKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3Rl\nZCBib29sZWFuIGFic29sdXRlSW50ZXJuYWwoaW50IHJvdykKICAgICAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9wb3MgPSAw\nOwogICAgICAgICAgICByZXR1cm4gc3VwZXIuYWJzb2x1dGVJbnRlcm5hbChy\nb3cpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4gbmV4\ndEludGVybmFsKCkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIF9wb3MgPSAwOwogICAgICAgICAgICByZXR1cm4gc3Vw\nZXIubmV4dEludGVybmFsKCk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0\nZWQgaW50IGZpbmRPYmplY3QoT2JqZWN0IG9iaiwgSm9pbnMgam9pbnMpCiAg\nICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBp\nZiAoX3BvcyA9PSBfc2VsLl9zZWxlY3RzLnNpemUoKSkKICAgICAgICAgICAg\nICAgIF9wb3MgPSAwOwoKICAgICAgICAgICAgLy8gd2Uga2V5IGRpcmVjdGx5\nIG9uIG9ianMgYW5kIGpvaW4tbGVzcyBjb2xzLCBvciBvbiB0aGUgYWxpYXMK\nICAgICAgICAgICAgLy8gZm9yIGNvbHMgd2l0aCBqb2lucwogICAgICAgICAg\nICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucyk7CiAgICAgICAgICAg\nIEJvb2xlYW4gcGsgPSBudWxsOwogICAgICAgICAgICBpZiAocGogIT0gbnVs\nbCAmJiBwai5wYXRoKCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgQ29s\ndW1uIGNvbCA9IChDb2x1bW4pIG9iajsKICAgICAgICAgICAgICAgIHBrID0g\nKGNvbC5pc1ByaW1hcnlLZXkoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFu\nLkZBTFNFOwogICAgICAgICAgICAgICAgb2JqID0gZ2V0Q29sdW1uQWxpYXMo\nY29sLCBwaik7CiAgICAgICAgICAgICAgICBpZiAob2JqID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlvbihjb2wu\nZ2V0VGFibGUoKSArICI6ICIKICAgICAgICAgICAgICAgICAgICAgICAgKyBw\nai5wYXRoKCkgKyAiICgiICsgX3NlbC5fYWxpYXNlcyArICIpIik7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIHdlIGxvYWQgaW4gdGhlIHNhbWUg\nb3JkZXIgd2Ugc2VsZWN0LCBtb3JlIG9yIGxlc3MuLi4KICAgICAgICAgICAg\naWYgKF9zZWwuX3NlbGVjdHMuZ2V0KF9wb3MpLmVxdWFscyhvYmopKQogICAg\nICAgICAgICAgICAgcmV0dXJuICsrX3BvczsKCiAgICAgICAgICAgIC8vIGlm\nIHdlJ3JlIGxvb2tpbmcgZm9yIGEgcHJpbWFyeSBrZXksIHRyeSBiYWNrIGEg\nY291cGxlIHBsYWNlcywKICAgICAgICAgICAgLy8gc2luY2UgcGtzIG1pZ2h0\nIGJlIHNlbGVjdGVkIGluIGEgc2xpZ2h0bHkgZGlmZmVyZW50IG9yZGVyIHRo\nYW4KICAgICAgICAgICAgLy8gdGhleSBhcmUgbG9hZGVkIGJhY2s7IGRvbid0\nIGNoYW5nZSB0aGUgbWFya2VyIHBvc2l0aW9uCiAgICAgICAgICAgIGlmIChw\nayA9PSBudWxsKQogICAgICAgICAgICAgICAgcGsgPSAob2JqIGluc3RhbmNl\nb2YgQ29sdW1uICYmICgoQ29sdW1uKSBvYmopLmlzUHJpbWFyeUtleSgpKQog\nICAgICAgICAgICAgICAgICAgID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRTsKICAgICAgICAgICAgaWYgKHBrLmJvb2xlYW5WYWx1ZSgpKSB7CiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gX3BvcyAtIDE7IGkgPj0gMCAm\nJiBpID49IF9wb3MgLSAzOyBpLS0pCiAgICAgICAgICAgICAgICAgICAgaWYg\nKF9zZWwuX3NlbGVjdHMuZ2V0KGkpLmVxdWFscyhvYmopKQogICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gaSArIDE7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIHNlYXJjaCBmb3J3YXJkIG9uIHRoZSBhc3N1bXB0aW9u\nIHRoYXQgd2UgbWlnaHQgYmUgc2tpcHBpbmcKICAgICAgICAgICAgLy8gc2Vs\nZWN0cyBmb3Igc2libGluZyBjbGFzc2VzOyBhZHZhbmNlIHRoZSBwb3NpdGlv\nbiBpZiB3ZSBmaW5kCiAgICAgICAgICAgIC8vIHNvbWV0aGluZyBmb3J3YXJk\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSBfcG9zICsgMTsgaSA8IF9zZWwu\nX3NlbGVjdHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChf\nc2VsLl9zZWxlY3RzLmdldChpKS5lcXVhbHMob2JqKSkgewogICAgICAgICAg\nICAgICAgICAgIF9wb3MgPSBpOwogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiArK19wb3M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIG1heWJlIHRoZSBjb2x1bW4gd2FzIHNlbGVjdGVkIGJ5\nIDIgZGlmZmVyZW50IG1hcHBpbmdzLCBzbyBpdCdzCiAgICAgICAgICAgIC8v\nIHNvbWV3aGVyZSBwcmlvciB0byB0aGUgY3VycmVudCBwb3NpdGlvbjsgaW4g\ndGhpcyBjYXNlIGxlYXZlIHRoZQogICAgICAgICAgICAvLyBwb3NpdGlvbiBt\nYXJrZXIgYXQgaXRzIGN1cnJlbnQgcGxhY2UgY2F1c2Ugc3Vic2VxdWVudCBs\nb2FkcyB3aWxsCiAgICAgICAgICAgIC8vIHN0aWxsIHByb2JhYmx5IHN0YXJ0\nIGZyb20gdGhlcmUKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBf\ncG9zOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoX3NlbC5fc2VsZWN0cy5n\nZXQoaSkuZXF1YWxzKG9iaikpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGkgKyAxOwoKICAgICAgICAgICAgLy8gc29tZXRoaW5ncydzIHdyb25nLi4u\nCiAgICAgICAgICAgIHRocm93IG5ldyBTUUxFeGNlcHRpb24ob2JqLnRvU3Ry\naW5nKCkpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0\ndXJuIHRoZSBqb2lucyB0byB1c2UgdG8gZmluZCBjb2x1bW4gZGF0YS4KICAg\nICAgICAgKi8KICAgICAgICBwcml2YXRlIFBhdGhKb2lucyBnZXRKb2lucyhK\nb2lucyBqb2lucykgewogICAgICAgICAgICBQYXRoSm9pbnMgcGogPSAoUGF0\naEpvaW5zKSBqb2luczsKICAgICAgICAgICAgaWYgKHBqICE9IG51bGwgJiYg\ncGoucGF0aCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gcGo7\nCiAgICAgICAgICAgIHJldHVybiBnZXRQcmVKb2lucygpOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBwcmUgam9pbnMg\nZm9yIHRoZSByZXN1bHQsIG9yIG51bGwgaWYgbm9uZS4gTm90ZSB0aGF0CiAg\nICAgICAgICogd2UgaGF2ZSB0byB0YWtlIHRoZSBTZWxlY3QncyBwcmUgam9p\nbnMgaW50byBhY2NvdW50IHRvbywgc2luY2UKICAgICAgICAgKiBiYXRjaGVk\nIHNlbGVjdHMgY2FuIGhhdmUgYWRkaXRpb25hbCBwcmUgam9pbnMgb24gdGhl\nIHN0YWNrIGV2ZW4KICAgICAgICAgKiBvbiBleGVjdXRpb24uCiAgICAgICAg\nICovCiAgICAgICAgcHJpdmF0ZSBQYXRoSm9pbnMgZ2V0UHJlSm9pbnMoKSB7\nCiAgICAgICAgICAgIGlmIChfcHJlSm9pbnMgIT0gbnVsbCAmJiAhX3ByZUpv\naW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiAoUGF0aEpv\naW5zKSBfcHJlSm9pbnMucGVlaygpOwogICAgICAgICAgICBpZiAoX3NlbC5f\ncHJlSm9pbnMgIT0gbnVsbCAmJiAhX3NlbC5fcHJlSm9pbnMuaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIChQYXRoSm9pbnMpIF9zZWwuX3By\nZUpvaW5zLnBlZWsoKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIGFsaWFz\nIHVzZWQgdG8ga2V5IG9uIHRoZSBjb2x1bW4gZGF0YSwgY29uc2lkZXJpbmcg\ndGhlCiAgICAgICAgICogZ2l2ZW4gam9pbnMuCiAgICAgICAgICovCiAgICAg\nICAgcHJpdmF0ZSBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoQ29sdW1uIGNvbCwg\nUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgICAgIFN0cmluZyBhbGlhczsKICAg\nICAgICAgICAgaWYgKF9zZWwuX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgYWxpYXMgPSBfc2VsLnRvQWxpYXMoX3NlbC5fZnJvbS5nZXRUYWJs\nZUluZGV4CiAgICAgICAgICAgICAgICAgICAgKGNvbC5nZXRUYWJsZSgpLCBw\naiwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIGlmIChhbGlhcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAg\nICAgICAgaWYgKF9zZWwuX2RpY3QucmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVj\ndCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRlJPTV9TRUxFQ1RfQUxJ\nQVMgKyAiLiIgKyBhbGlhcyArICJfIiArIGNvbDsKICAgICAgICAgICAgICAg\nIHJldHVybiBhbGlhcyArICJfIiArIGNvbDsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBhbGlhcyA9IF9zZWwudG9BbGlhcyhfc2VsLmdldFRhYmxlSW5k\nZXgoY29sLmdldFRhYmxlKCksIHBqLCBmYWxzZSkpOwogICAgICAgICAgICBy\nZXR1cm4gKGFsaWFzID09IG51bGwpID8gbnVsbCA6IGFsaWFzICsgIi4iICsg\nY29sOwogICAgICAgIH0KCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwogICAgICAgIC8vIFBhdGhKb2lucyBpbXBsZW1lbnRhdGlvbgog\nICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gaXNPdXRlcigpIHsKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFBhdGhKb2lucyBz\nZXRPdXRlcihib29sZWFuIG91dGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0\neSgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIFN0cmluZ0J1ZmZlciBwYXRoKCkgewogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lu\nU2V0IGpvaW5zKCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBpbnQgam9pbkNvdW50KCkgewogICAgICAg\nICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIG51bGxKb2lucygpIHsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29s\nZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBs\nb2NhbFRhYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMg\nam9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4g\ndG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9pbihGb3JlaWduS2V5IGZr\nLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpv\naW5zIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywg\nCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBi\nb29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAg\nIHJldHVybiBuZXcgUGF0aEpvaW5zSW1wbCgpLmpvaW5SZWxhdGlvbihuYW1l\nLCBmaywgdGFyZ2V0LCBzdWJzLCAKICAgICAgICAgICAgICAgIGludmVyc2Us\nIHRvTWFueSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0\nZXJKb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssCiAg\nICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29s\nZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJl\ndHVybiBuZXcgUGF0aEpvaW5zSW1wbCgpLm91dGVySm9pblJlbGF0aW9uKG5h\nbWUsIGZrLCB0YXJnZXQsIHN1YnMsCiAgICAgICAgICAgICAgICBpbnZlcnNl\nLCB0b01hbnkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNl\ndFZhcmlhYmxlKFN0cmluZyB2YXIpIHsKICAgICAgICAgICAgaWYgKHZhciA9\nPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nICAgIHJldHVybiBuZXcgUGF0aEpvaW5zSW1wbCgpLnNldFZhcmlhYmxlKHZh\ncik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0U3Vic2Vs\nZWN0KFN0cmluZyBhbGlhcykgewogICAgICAgICAgICBpZiAoYWxpYXMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICByZXR1cm4gbmV3IFBhdGhKb2luc0ltcGwoKS5zZXRTdWJzZWxlY3QoYWxp\nYXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEJhc2Ugam9p\nbnMgaW1wbGVtZW50YXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIFBhdGhKb2luc0ltcGwKICAgICAgICBpbXBsZW1lbnRzIFBhdGhK\nb2lucyB7CgogICAgICAgIHByb3RlY3RlZCBTdHJpbmdCdWZmZXIgcGF0aCA9\nIG51bGw7CiAgICAgICAgcHJvdGVjdGVkIFN0cmluZyB2YXIgPSBudWxsOwoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc091dGVyKCkgewogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUGF0\naEpvaW5zIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBpc0RpcnR5KCkgewogICAgICAgICAgICByZXR1cm4gdmFyICE9IG51bGwg\nfHwgcGF0aCAhPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0\ncmluZ0J1ZmZlciBwYXRoKCkgewogICAgICAgICAgICByZXR1cm4gcGF0aDsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2luU2V0IGpvaW5zKCkgewog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBpbnQgam9pbkNvdW50KCkgewogICAgICAgICAgICByZXR1cm4gMDsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygpIHsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBzZXRWYXJpYWJsZShT\ndHJpbmcgdmFyKSB7CiAgICAgICAgICAgIHRoaXMudmFyID0gdmFyOwogICAg\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBKb2lucyBzZXRTdWJzZWxlY3QoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAg\nICAgIGlmICghYWxpYXMuZW5kc1dpdGgoIjoiKSkKICAgICAgICAgICAgICAg\nIGFsaWFzICs9ICc6JzsKICAgICAgICAgICAgYXBwZW5kKGFsaWFzKTsKICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBjcm9zc0pvaW4o\nVGFibGUgbG9jYWxUYWJsZSwgVGFibGUgZm9yZWlnblRhYmxlKSB7CiAgICAg\nICAgICAgIGFwcGVuZCh2YXIpOwogICAgICAgICAgICB2YXIgPSBudWxsOwog\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBKb2lucyBqb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJz\nZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgYXBwZW5kKHZhcik7\nCiAgICAgICAgICAgIHZhciA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9p\nbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9N\nYW55KSB7CiAgICAgICAgICAgIGFwcGVuZCh2YXIpOwogICAgICAgICAgICB2\nYXIgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oU3RyaW5nIG5h\nbWUsIEZvcmVpZ25LZXkgZmssIAogICAgICAgICAgICBDbGFzc01hcHBpbmcg\ndGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRv\nTWFueSkgewogICAgICAgICAgICBhcHBlbmQobmFtZSk7CiAgICAgICAgICAg\nIGFwcGVuZCh2YXIpOwogICAgICAgICAgICB2YXIgPSBudWxsOwogICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBK\nb2lucyBvdXRlckpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktl\neSBmaywKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1\nYnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAg\nICAgICAgYXBwZW5kKG5hbWUpOwogICAgICAgICAgICBhcHBlbmQodmFyKTsK\nICAgICAgICAgICAgdmFyID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmQo\nU3RyaW5nIHN0cikgewogICAgICAgICAgICBpZiAoc3RyICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGlmIChwYXRoID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgcGF0aCA9IG5ldyBTdHJpbmdCdWZmZXIoc3RyKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBwYXRoLmFwcGVu\nZCgnLicpLmFwcGVuZChzdHIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAg\nICByZXR1cm4gIlBhdGhKb2luc0ltcGw8IiArIGhhc2hDb2RlKCkgKyAiPjog\nIgogICAgICAgICAgICAgICAgKyBTdHJpbmcudmFsdWVPZihwYXRoKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBKb2lucyBpbXBsZW1lbnRh\ndGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgU2VsZWN0\nSm9pbnMKICAgICAgICBleHRlbmRzIFBhdGhKb2luc0ltcGwgCiAgICAgICAg\naW1wbGVtZW50cyBDbG9uZWFibGUgewoKICAgICAgICBwcml2YXRlIGZpbmFs\nIFNlbGVjdEltcGwgX3NlbDsKICAgICAgICBwcml2YXRlIEpvaW5TZXQgX2pv\naW5zID0gbnVsbDsKICAgICAgICBwcml2YXRlIGJvb2xlYW4gX291dGVyID0g\nZmFsc2U7CiAgICAgICAgcHJpdmF0ZSBpbnQgX2NvdW50ID0gMDsKCiAgICAg\nICAgcHVibGljIFNlbGVjdEpvaW5zKFNlbGVjdEltcGwgc2VsKSB7CiAgICAg\nICAgICAgIF9zZWwgPSBzZWw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBpc091dGVyKCkgewogICAgICAgICAgICByZXR1cm4gX291dGVy\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFBhdGhKb2lucyBzZXRPdXRl\ncihib29sZWFuIG91dGVyKSB7CiAgICAgICAgICAgIF9vdXRlciA9IG91dGVy\nOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBzdXBlci5pc0RpcnR5KCkgfHwgIWlzRW1wdHkoKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBKb2luU2V0IGpvaW5zKCkgewogICAgICAgICAgICBy\nZXR1cm4gX2pvaW5zOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\nc2V0Sm9pbnMoSm9pblNldCBqb2lucykgewogICAgICAgICAgICBfam9pbnMg\nPSBqb2luczsKICAgICAgICAgICAgX291dGVyID0gam9pbnMgIT0gbnVsbCAm\nJiBqb2lucy5sYXN0KCkgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgam9p\nbnMubGFzdCgpLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfT1VURVI7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgaW50IGpvaW5Db3VudCgpIHsKICAgICAg\nICAgICAgaWYgKF9qb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIF9jb3VudDsKICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KF9jb3Vu\ndCwgX2pvaW5zLnNpemUoKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\ndm9pZCBudWxsSm9pbnMoKSB7CiAgICAgICAgICAgIGlmIChfam9pbnMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9jb3VudCA9IE1hdGgubWF4KF9jb3Vu\ndCwgX2pvaW5zLnNpemUoKSk7CiAgICAgICAgICAgIF9qb2lucyA9IG51bGw7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5KCkg\newogICAgICAgICAgICByZXR1cm4gX2pvaW5zID09IG51bGwgfHwgX2pvaW5z\nLmlzRW1wdHkoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBj\ncm9zc0pvaW4oVGFibGUgbG9jYWxUYWJsZSwgVGFibGUgZm9yZWlnblRhYmxl\nKSB7CiAgICAgICAgICAgIC8vIGNyb3NzIGpvaW5zIGFyZSBmb3IgdW5ib3Vu\nZCB2YXJpYWJsZXM7IHVuZm9ydHVuYXRlbHkgd2UgaGF2ZQogICAgICAgICAg\nICAvLyB0byBhbHdheXMgZ28gRElTVElOQ1QgZm9yIHVuYm91bmQgdmFycyBi\nZWNhdXNlIHRoZXJlIGFyZSBjZXJ0YWluCiAgICAgICAgICAgIC8vIGNhc2Vz\nIHRoYXQgcmVxdWlyZSBpdCwgYW5kIHdlIGNhbid0IGRpZmZlcmVudGlhdGUg\ndGhlbSBmcm9tIHRoZQogICAgICAgICAgICAvLyBjYXNlcyB0aGF0IGRvbid0\nCiAgICAgICAgICAgIF9zZWwuX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNU\nOwoKICAgICAgICAgICAgaWYgKF9zZWwuZ2V0Sm9pblN5bnRheCgpICE9IEpv\naW5TeW50YXhlcy5TWU5UQVhfU1FMOTIKICAgICAgICAgICAgICAgIHx8IF9z\nZWwuX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gZG9uJ3Qg\nbWFrZSBhbnkgam9pbnMsIGJ1dCB1cGRhdGUgdGhlIHBhdGggaWYgYSB2YXJp\nYWJsZQogICAgICAgICAgICAgICAgLy8gaGFzIGJlZW4gc2V0CiAgICAgICAg\nICAgICAgICB0aGlzLmFwcGVuZCh0aGlzLnZhcik7CiAgICAgICAgICAgICAg\nICB0aGlzLnZhciA9IG51bGw7CiAgICAgICAgICAgICAgICBfb3V0ZXIgPSBm\nYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBkb24ndCBsZXQgdGhlIGdldCBhbGlhcyBt\nZXRob2RzIHNlZSB0aGF0IGEgdmFyIGhhcyBiZWVuIHNldAogICAgICAgICAg\nICAvLyB1bnRpbCB3ZSBnZXQgcGFzdCB0aGUgbG9jYWwgdGFibGUKICAgICAg\nICAgICAgU3RyaW5nIHZhciA9IHRoaXMudmFyOwogICAgICAgICAgICB0aGlz\nLnZhciA9IG51bGw7CgogICAgICAgICAgICBpbnQgYWxpYXMxID0gX3NlbC5n\nZXRUYWJsZUluZGV4KGxvY2FsVGFibGUsIHRoaXMsIHRydWUpOwogICAgICAg\nICAgICB0aGlzLmFwcGVuZCh2YXIpOwogICAgICAgICAgICBpbnQgYWxpYXMy\nID0gX3NlbC5nZXRUYWJsZUluZGV4KGZvcmVpZ25UYWJsZSwgdGhpcywgdHJ1\nZSk7CiAgICAgICAgICAgIEpvaW4gaiA9IG5ldyBKb2luKGxvY2FsVGFibGUs\nIGFsaWFzMSwgZm9yZWlnblRhYmxlLCBhbGlhczIsCiAgICAgICAgICAgICAg\nICBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgIGouc2V0VHlwZShKb2luLlRZ\nUEVfQ1JPU1MpOwoKICAgICAgICAgICAgaWYgKF9qb2lucyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgX2pvaW5zID0gbmV3IEpvaW5TZXQoKTsKICAgICAg\nICAgICAgX2pvaW5zLmFkZChqKTsKICAgICAgICAgICAgX291dGVyID0gZmFs\nc2U7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIEpvaW5zIGpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBp\nbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICByZXR1cm4g\nam9pbihudWxsLCBmaywgbnVsbCwgLTEsIGludmVyc2UsIHRvTWFueSwgZmFs\nc2UpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9p\nbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9N\nYW55KSB7CiAgICAgICAgICAgIHJldHVybiBqb2luKG51bGwsIGZrLCBudWxs\nLCAtMSwgaW52ZXJzZSwgdG9NYW55LCB0cnVlKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZv\ncmVpZ25LZXkgZmssIAogICAgICAgICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0\nLCBpbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkg\newogICAgICAgICAgICByZXR1cm4gam9pbihuYW1lLCBmaywgdGFyZ2V0LCBz\ndWJzLCBpbnZlcnNlLCB0b01hbnksIGZhbHNlKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW5SZWxhdGlvbihTdHJpbmcgbmFt\nZSwgRm9yZWlnbktleSBmaywKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRh\ncmdldCwgaW50IHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01h\nbnkpIHsKICAgICAgICAgICAgcmV0dXJuIGpvaW4obmFtZSwgZmssIHRhcmdl\ndCwgc3VicywgaW52ZXJzZSwgdG9NYW55LCB0cnVlKTsKICAgICAgICB9Cgog\nICAgICAgIHByaXZhdGUgSm9pbnMgam9pbihTdHJpbmcgbmFtZSwgRm9yZWln\nbktleSBmaywgQ2xhc3NNYXBwaW5nIHRhcmdldCwKICAgICAgICAgICAgaW50\nIHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnksIGJvb2xl\nYW4gb3V0ZXIpIHsKICAgICAgICAgICAgLy8gZG9uJ3QgbGV0IHRoZSBnZXQg\nYWxpYXMgbWV0aG9kcyBzZWUgdGhhdCBhIHZhciBoYXMgYmVlbiBzZXQKICAg\nICAgICAgICAgLy8gdW50aWwgd2UgZ2V0IHBhc3QgdGhlIGxvY2FsIHRhYmxl\nCiAgICAgICAgICAgIFN0cmluZyB2YXIgPSB0aGlzLnZhcjsKICAgICAgICAg\nICAgdGhpcy52YXIgPSBudWxsOwoKICAgICAgICAgICAgLy8gZ2V0IGZpcnN0\nIHRhYmxlIGFsaWFzIGJlZm9yZSB1cGRhdGluZyBwYXRoOyBpZiB0aGVyZSBp\ncyBhIGZyb20KICAgICAgICAgICAgLy8gc2VsZWN0IHRoZW4gd2Ugc2hvdWxk\nbid0IGFjdHVhbGx5IGNyZWF0ZSBhIGpvaW4gb2JqZWN0LCBzaW5jZQogICAg\nICAgICAgICAvLyB0aGUgam9pbnMgd2lsbCBhbGwgYmUgZG9uZSBpbiB0aGUg\nZnJvbSBzZWxlY3QKICAgICAgICAgICAgYm9vbGVhbiBjcmVhdGVKb2luID0g\nX3NlbC5fZnJvbSA9PSBudWxsOwogICAgICAgICAgICBUYWJsZSB0YWJsZTEg\nPSBudWxsOwogICAgICAgICAgICBpbnQgYWxpYXMxID0gLTE7CiAgICAgICAg\nICAgIGlmIChjcmVhdGVKb2luKSB7CiAgICAgICAgICAgICAgICB0YWJsZTEg\nPSAoaW52ZXJzZSkgPyBmay5nZXRQcmltYXJ5S2V5VGFibGUoKSA6IGZrLmdl\ndFRhYmxlKCk7CiAgICAgICAgICAgICAgICBhbGlhczEgPSBfc2VsLmdldFRh\nYmxlSW5kZXgodGFibGUxLCB0aGlzLCB0cnVlKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBwYXRoIHdpdGggdGhlIHJlbGF0\naW9uIG5hbWUgYmVmb3JlIGdldHRpbmcgcGsgYWxpYXMKICAgICAgICAgICAg\ndGhpcy5hcHBlbmQobmFtZSk7CiAgICAgICAgICAgIHRoaXMuYXBwZW5kKHZh\ncik7CiAgICAgICAgICAgIGlmICh0b01hbnkpIHsKICAgICAgICAgICAgICAg\nIF9zZWwuX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNUOwogICAgICAgICAg\nICAgICAgX3NlbC5fZmxhZ3MgfD0gVE9fTUFOWTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBfb3V0ZXIgPSBvdXRlcjsKCiAgICAgICAgICAgIGlmIChj\ncmVhdGVKb2luKSB7CiAgICAgICAgICAgICAgICBUYWJsZSB0YWJsZTIgPSAo\naW52ZXJzZSkgPyBmay5nZXRUYWJsZSgpIAogICAgICAgICAgICAgICAgICAg\nIDogZmsuZ2V0UHJpbWFyeUtleVRhYmxlKCk7CiAgICAgICAgICAgICAgICBp\nbnQgYWxpYXMyID0gX3NlbC5nZXRUYWJsZUluZGV4KHRhYmxlMiwgdGhpcywg\ndHJ1ZSk7CiAgICAgICAgICAgICAgICBKb2luIGogPSBuZXcgSm9pbih0YWJs\nZTEsIGFsaWFzMSwgdGFibGUyLCBhbGlhczIsIGZrLCBpbnZlcnNlKTsKICAg\nICAgICAgICAgICAgIGouc2V0VHlwZSgob3V0ZXIpID8gSm9pbi5UWVBFX09V\nVEVSIDogSm9pbi5UWVBFX0lOTkVSKTsKCiAgICAgICAgICAgICAgICBpZiAo\nX2pvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2pvaW5zID0g\nbmV3IEpvaW5TZXQoKTsKICAgICAgICAgICAgICAgIGlmIChfam9pbnMuYWRk\nKGopICYmIChzdWJzID09IFNlbGVjdC5TVUJTX0pPSU5BQkxFIAogICAgICAg\nICAgICAgICAgICAgIHx8IHN1YnMgPT0gU2VsZWN0LlNVQlNfTk9ORSkpCiAg\nICAgICAgICAgICAgICAgICAgai5zZXRSZWxhdGlvbih0YXJnZXQsIHN1YnMs\nIGNsb25lKF9zZWwpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTZWxlY3RKb2lu\ncyBjbG9uZShTZWxlY3RJbXBsIHNlbCkgewogICAgICAgICAgICBTZWxlY3RK\nb2lucyBzaiA9IG5ldyBTZWxlY3RKb2lucyhzZWwpOwogICAgICAgICAgICBz\nai52YXIgPSB2YXI7CiAgICAgICAgICAgIGlmIChwYXRoICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBzai5wYXRoID0gbmV3IFN0cmluZ0J1ZmZlcihwYXRo\nLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBpZiAoX2pvaW5zICE9IG51bGwg\nJiYgIV9qb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBzai5fam9p\nbnMgPSBuZXcgSm9pblNldChfam9pbnMpOwogICAgICAgICAgICBzai5fb3V0\nZXIgPSBfb3V0ZXI7CiAgICAgICAgICAgIHJldHVybiBzajsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAg\nICAgIHJldHVybiBzdXBlci50b1N0cmluZygpICsgIiAoIiArIF9vdXRlciAr\nICIpOiAiICsgX2pvaW5zOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJv\ndGVjdGVkIFNlbGVjdHMgbmV3U2VsZWN0cygpIHsKICAgICAgICByZXR1cm4g\nbmV3IFNlbGVjdHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBj\nbGFzcyB0byB0cmFjayBzZWxlY3RlZCBjb2x1bW5zLCB3aXRoIGZhc3QgY29u\ndGFpbnMgbWV0aG9kLgogICAgICogQWN0cyBhcyBhIGxpc3Qgb2Ygc2VsZWN0\nIGlkcywgd2l0aCBhZGRpdGlvbmFsIG1ldGhvZHMgdG8gbWFuaXB1bGF0ZQog\nICAgICogdGhlIGFsaWFzIG9mIGVhY2ggc2VsZWN0ZWQgaWQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgU2VsZWN0cwogICAgICAgIGV4\ndGVuZHMgQWJzdHJhY3RMaXN0IHsKCiAgICAgICAgcHJvdGVjdGVkIExpc3Qg\nX2lkcyA9IG51bGw7CiAgICAgICAgcHJvdGVjdGVkIExpc3QgX2lkZW50cyA9\nIG51bGw7CiAgICAgICAgcHJvdGVjdGVkIE1hcCBfYWxpYXNlcyA9IG51bGw7\nCiAgICAgICAgcHJvdGVjdGVkIE1hcCBfc2VsZWN0QXMgPSBudWxsOwogICAg\nICAgIHByb3RlY3RlZCBEQkRpY3Rpb25hcnkgX2RpY3QgPSBudWxsOwoKICAg\nICAgICAvKioKICAgICAgICAgKiBBZGQgYWxsIGFsaWFzZXMgZnJvbSBhbm90\naGVyIGluc3RhbmNlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIGFkZEFsbChTZWxlY3RzIHNlbHMpIHsKICAgICAgICAgICAgaWYgKF9pZHMg\nPT0gbnVsbCAmJiBzZWxzLl9pZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9pZHMgPSBuZXcgQXJyYXlMaXN0KHNlbHMuX2lkcyk7CiAgICAgICAgICAg\nIGVsc2UgaWYgKHNlbHMuX2lkcyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX2lkcy5hZGRBbGwoc2Vscy5faWRzKTsKCiAgICAgICAgICAgIGlmIChfaWRl\nbnRzID09IG51bGwgJiYgc2Vscy5faWRlbnRzICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBfaWRlbnRzID0gbmV3IEFycmF5TGlzdChzZWxzLl9pZGVudHMp\nOwogICAgICAgICAgICBlbHNlIGlmIChzZWxzLl9pZGVudHMgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIF9pZGVudHMuYWRkQWxsKHNlbHMuX2lkZW50cyk7\nCgogICAgICAgICAgICBpZiAoX2FsaWFzZXMgPT0gbnVsbCAmJiBzZWxzLl9h\nbGlhc2VzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfYWxpYXNlcyA9IG5l\ndyBIYXNoTWFwKHNlbHMuX2FsaWFzZXMpOwogICAgICAgICAgICBlbHNlIGlm\nIChzZWxzLl9hbGlhc2VzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfYWxp\nYXNlcy5wdXRBbGwoc2Vscy5fYWxpYXNlcyk7CgogICAgICAgICAgICBpZiAo\nX3NlbGVjdEFzID09IG51bGwgJiYgc2Vscy5fc2VsZWN0QXMgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIF9zZWxlY3RBcyA9IG5ldyBIYXNoTWFwKHNlbHMu\nX3NlbGVjdEFzKTsKICAgICAgICAgICAgZWxzZSBpZiAoc2Vscy5fc2VsZWN0\nQXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zZWxlY3RBcy5wdXRBbGwo\nc2Vscy5fc2VsZWN0QXMpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAg\nICAgICogUmV0dXJucyB0aGUgYWxpYXMgb2YgYSBnaXZlbiBpZC4KICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgT2JqZWN0IGdldEFsaWFzKE9iamVjdCBp\nZCkgewogICAgICAgICAgICByZXR1cm4gKF9hbGlhc2VzID09IG51bGwpID8g\nbnVsbCA6IF9hbGlhc2VzLmdldChpZCk7CiAgICAgICAgfQoKICAgICAgICAv\nKioKICAgICAgICAgKiBTZXQgYW4gYWxpYXMgZm9yIGEgZ2l2ZW4gaWQuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIGludCBzZXRBbGlhcyhPYmplY3Qg\naWQsIE9iamVjdCBhbGlhcywgYm9vbGVhbiBpZGVudCkgewogICAgICAgICAg\nICBpZiAoX2lkcyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBfaWRzID0g\nbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICAgICAgX2FsaWFzZXMgPSBu\nZXcgSGFzaE1hcCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnQg\naWR4OwogICAgICAgICAgICBpZiAoX2FsaWFzZXMucHV0KGlkLCBhbGlhcykg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGlkeCA9IF9pZHMuaW5kZXhPZihp\nZCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgX2lkcy5h\nZGQoaWQpOwogICAgICAgICAgICAgICAgaWR4ID0gX2lkcy5zaXplKCkgLSAx\nOwoKICAgICAgICAgICAgICAgIGlmIChpZGVudCkgewogICAgICAgICAgICAg\nICAgICAgIGlmIChfaWRlbnRzID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgIF9pZGVudHMgPSBuZXcgQXJyYXlMaXN0KDMpOwogICAgICAgICAg\nICAgICAgICAgIF9pZGVudHMuYWRkKGlkKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaWR4OwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0IGFuIGFsaWFzIGZvciBh\nIGdpdmVuIGluZGV4LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIHNldEFsaWFzKGludCBpZHgsIE9iamVjdCBhbGlhcykgewogICAgICAgICAg\nICBPYmplY3QgaWQgPSBfaWRzLmdldChpZHgpOwogICAgICAgICAgICBfYWxp\nYXNlcy5wdXQoaWQsIGFsaWFzKTsKICAgICAgICB9CgogICAgICAgIC8qKgog\nICAgICAgICAqIEluc2VydCBhbiBhbGlhcyBiZWZvcmUgdGhlIGdpdmVuIGlu\nZGV4LCB1c2luZyBuZWdhdGl2ZSBpbmRleGVzCiAgICAgICAgICogdG8gY291\nbnQgYmFja3dhcmRzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lk\nIGluc2VydEFsaWFzKGludCBpZHgsIE9iamVjdCBpZCwgT2JqZWN0IGFsaWFz\nKSB7CiAgICAgICAgICAgIF9hbGlhc2VzLnB1dChpZCwgYWxpYXMpOwogICAg\nICAgICAgICBpZiAoaWR4ID49IDApCiAgICAgICAgICAgICAgICBfaWRzLmFk\nZChpZHgsIGlkKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nX2lkcy5hZGQoX2lkcy5zaXplKCkgKyBpZHgsIGlkKTsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgaW5kZXggb2YgdGhl\nIGdpdmVuIGFsaWFzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBpbnQg\naW5kZXhPZkFsaWFzKE9iamVjdCBhbGlhcykgewogICAgICAgICAgICBpZiAo\nX2FsaWFzZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfaWRzLnNpemUoKTsg\naSsrKQogICAgICAgICAgICAgICAgaWYgKGFsaWFzLmVxdWFscyhfYWxpYXNl\ncy5nZXQoX2lkcy5nZXQoaSkpKSkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gaTsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogQSBsaXN0IHJlcHJlc2VudGF0aW9uIG9mIHRo\nZSBhbGlhc2VzLCBpbiBzZWxlY3Qgb3JkZXIsIHdpdGgKICAgICAgICAgKiBB\nUyBhbGlhc2VzIHByZXNlbnQuCiAgICAgICAgICovCiAgICAgICAgcHVibGlj\nIExpc3QgZ2V0QWxpYXNlcyhmaW5hbCBib29sZWFuIGlkZW50LCBmaW5hbCBi\nb29sZWFuIGlubmVyKSB7CiAgICAgICAgICAgIGlmIChfaWRzID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElT\nVDsKCiAgICAgICAgICAgIHJldHVybiBuZXcgQWJzdHJhY3RMaXN0KCkgewog\nICAgICAgICAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAg\nICAgICAgICAgIHJldHVybiAoaWRlbnQgJiYgX2lkZW50cyAhPSBudWxsKSA/\nIF9pZGVudHMuc2l6ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIDogX2lk\ncy5zaXplKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAg\ncHVibGljIE9iamVjdCBnZXQoaW50IGkpIHsKICAgICAgICAgICAgICAgICAg\nICBPYmplY3QgaWQgPSAoaWRlbnQgJiYgX2lkZW50cyAhPSBudWxsKSA/IF9p\nZGVudHMuZ2V0KGkpCiAgICAgICAgICAgICAgICAgICAgICAgIDogX2lkcy5n\nZXQoaSk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IGFsaWFzID0gX2Fs\naWFzZXMuZ2V0KGlkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaWQgaW5z\ndGFuY2VvZiBDb2x1bW4gJiYgKChDb2x1bW4pIGlkKS5pc1hNTCgpKQogICAg\nICAgICAgICAgICAgICAgICAgICBhbGlhcyA9IGFsaWFzICsgX2RpY3QuZ2V0\nU3RyaW5nVmFsOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAg\nICAgICAgICAgICBTdHJpbmcgYXMgPSBudWxsOwogICAgICAgICAgICAgICAg\nICAgIGlmIChpbm5lcikKICAgICAgICAgICAgICAgICAgICAgICAgYXMgPSAo\nKFN0cmluZykgYWxpYXMpLnJlcGxhY2UoJy4nLCAnXycpOwogICAgICAgICAg\nICAgICAgICAgIGVsc2UgaWYgKF9zZWxlY3RBcyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICBhcyA9IChTdHJpbmcpIF9zZWxlY3RBcy5nZXQo\naWQpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoYXMgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRlbnQgJiYgX2lkZW50cyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFz\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxpYXMgaW5zdGFuY2Vv\nZiBTUUxCdWZmZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGlh\ncyA9IG5ldyBTUUxCdWZmZXIoKFNRTEJ1ZmZlcikgYWxpYXMpLgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZCgiIEFTICIpLmFwcGVu\nZChhcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGFsaWFzID0gYWxpYXMgKyAiIEFTICIgKyBh\nczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGFsaWFzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0IHRoYXQg\nYSBnaXZlbiBpZCdzIGFsaWFzIGhhcyBhbiBBUyB2YWx1ZS4KICAgICAgICAg\nKi8KICAgICAgICBwdWJsaWMgdm9pZCBzZXRTZWxlY3RBcyhPYmplY3QgaWQs\nIFN0cmluZyBhcykgewogICAgICAgICAgICBpZiAoX3NlbGVjdEFzID09IG51\nbGwpCiAgICAgICAgICAgICAgICBfc2VsZWN0QXMgPSBuZXcgSGFzaE1hcCgo\naW50KSAoNSAqIDEuMzMgKyAxKSk7CiAgICAgICAgICAgIF9zZWxlY3RBcy5w\ndXQoaWQsIGFzKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIENsZWFyIGFsbCBwbGFjZWhvbGRlcnMgYW5kIHNlbGVjdCBBUyBjbGF1c2Vz\nLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGNsZWFyUGxhY2Vo\nb2xkZXJzKCkgewogICAgICAgICAgICBpZiAoX2lkcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgT2JqZWN0IGlkOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9pZHMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGlkID0gaXRy\nLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChpZCBpbnN0YW5jZW9mIFBs\nYWNlaG9sZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgp\nOwogICAgICAgICAgICAgICAgICAgIF9hbGlhc2VzLnJlbW92ZShpZCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zKE9iamVjdCBpZCkgewogICAg\nICAgICAgICByZXR1cm4gX2FsaWFzZXMgIT0gbnVsbCAmJiBfYWxpYXNlcy5j\nb250YWluc0tleShpZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2Jq\nZWN0IGdldChpbnQgaSkgewogICAgICAgICAgICBpZiAoX2lkcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJv\ndW5kc0V4Y2VwdGlvbigpOwogICAgICAgICAgICByZXR1cm4gX2lkcy5nZXQo\naSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IHNpemUoKSB7CiAg\nICAgICAgICAgIHJldHVybiAoX2lkcyA9PSBudWxsKSA/IDAgOiBfaWRzLnNp\nemUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkg\newogICAgICAgICAgICBfaWRzID0gbnVsbDsKICAgICAgICAgICAgX2FsaWFz\nZXMgPSBudWxsOwogICAgICAgICAgICBfc2VsZWN0QXMgPSBudWxsOwogICAg\nICAgICAgICBfaWRlbnRzID0gbnVsbDsKICAgICAgICB9CiAgICB9Cn0KCi8q\nKgogKiBDb21tb24gam9pbnMgaW50ZXJmYWNlIHVzZWQgaW50ZXJuYWxseS4g\nQ2Fubm90IGJlIG1hZGUgYW4gaW5uZXIgY2xhc3MKICogYmVjYXVzZSB0aGUg\nb3V0ZXIgY2xhc3MgKFNlbGVjdCkgaGFzIHRvIGltcGxlbWVudCBpdC4KICov\nCmludGVyZmFjZSBQYXRoSm9pbnMKICAgIGV4dGVuZHMgSm9pbnMgewoKICAg\nIC8qKgogICAgICogTWFyayB0aGlzIGFzIGFuIG91dGVyIGpvaW5zIHNldC4K\nICAgICAqLwogICAgcHVibGljIFBhdGhKb2lucyBzZXRPdXRlcihib29sZWFu\nIG91dGVyKTsKCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoaXMg\naW5zdGFuY2UgaGFzIGEgcGF0aCwgYW55IGpvaW5zLCBvciBhIHZhcmlhYmxl\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCk7CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJlbGF0aW9uIHBhdGggdHJhdmVyc2Vk\nIGJ5IHRoZXNlIGpvaW5zLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmdCdWZmZXIgcGF0aCgpOwoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBzZXQgb2Yge0BsaW5rIEpvaW59IGVsZW1lbnRzLCBvciBu\ndWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBKb2luU2V0IGpvaW5z\nKCk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1heGltdW0gbnVtYmVy\nIG9mIGpvaW5zIGNvbnRhaW5lZCBpbiB0aGlzIGluc3RhbmNlIGF0IGFueQog\nICAgICogdGltZS4KICAgICAqLwogICAgcHVibGljIGludCBqb2luQ291bnQo\nKTsKCiAgICAvKioKICAgICAqIE51bGwgdGhlIHNldCBvZiB7QGxpbmsgSm9p\nbn0gZWxlbWVudHMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIG51bGxKb2lu\ncygpOwp9Cgo=\n","encoding":"base64"}

