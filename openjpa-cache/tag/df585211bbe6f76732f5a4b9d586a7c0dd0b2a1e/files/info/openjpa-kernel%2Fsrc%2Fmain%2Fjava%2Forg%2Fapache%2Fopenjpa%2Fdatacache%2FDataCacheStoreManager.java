{"sha":"999129ec113b6141c6b2690d9b2c0d5098d84d9a","node_id":"MDQ6QmxvYjIwNjM2NDo5OTkxMjllYzExM2I2MTQxYzZiMjY5MGQ5YjJjMGQ1MDk4ZDg0ZDlh","size":27519,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/999129ec113b6141c6b2690d9b2c0d5098d84d9a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0\nOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRyeTsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ0RhdGFHZW5lcmF0b3I7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRlbGVnYXRpbmdTdG9yZU1h\nbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZldGNo\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuTG9ja0xldmVsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5TdG9yZVF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0aWNFeGNlcHRpb247CgovKioK\nICogU3RvcmVNYW5hZ2VyIHByb3h5IHRoYXQgZGVsZWdhdGVzIHRvIGEgZGF0\nYSBjYWNoZSB3aGVuIHBvc3NpYmxlLgogKgogKiBAYXV0aG9yIFBhdHJpY2sg\nTGluc2tleQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRGF0YUNh\nY2hlU3RvcmVNYW5hZ2VyCiAgICBleHRlbmRzIERlbGVnYXRpbmdTdG9yZU1h\nbmFnZXIgewoKICAgIC8vIGFsbCB0aGUgc3RhdGUgbWFuYWdlcnMgY2hhbmdl\nZCBpbiB0aGlzIHRyYW5zYWN0aW9uCiAgICBwcml2YXRlIENvbGxlY3Rpb24g\nX2luc2VydHMgPSBudWxsOyAvLyBzdGF0ZW1hbmFnZXJzCiAgICBwcml2YXRl\nIE1hcCBfdXBkYXRlcyA9IG51bGw7IC8vIHN0YXRlbWFuYWdlciAtPiBmbWQg\nc2V0CiAgICBwcml2YXRlIENvbGxlY3Rpb24gX2RlbGV0ZXMgPSBudWxsOyAv\nLyBzdGF0ZW1hbmFnZXJzCgogICAgLy8gdGhlIG93bmluZyBjb250ZXh0CiAg\nICBwcml2YXRlIFN0b3JlQ29udGV4dCBfY3R4ID0gbnVsbDsKCiAgICAvLyBw\nYyBkYXRhIGdlbmVyYXRvcgogICAgcHJpdmF0ZSBQQ0RhdGFHZW5lcmF0b3Ig\nX2dlbiA9IG51bGw7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAg\nICAqCiAgICAgKiBAcGFyYW0gc20gdGhlIHN0b3JlIG1hbmFnZXIgdG8gZGVs\nZWdhdGUgdG8KICAgICAqLwogICAgcHVibGljIERhdGFDYWNoZVN0b3JlTWFu\nYWdlcihTdG9yZU1hbmFnZXIgc20pIHsKICAgICAgICBzdXBlcihzbSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0Q29udGV4dChTdG9yZUNvbnRleHQg\nY3R4KSB7CiAgICAgICAgX2N0eCA9IGN0eDsKICAgICAgICBfZ2VuID0gY3R4\nLmdldENvbmZpZ3VyYXRpb24oKS5nZXREYXRhQ2FjaGVNYW5hZ2VySW5zdGFu\nY2UoKS4KICAgICAgICAgICAgZ2V0UENEYXRhR2VuZXJhdG9yKCk7CiAgICAg\nICAgc3VwZXIuc2V0Q29udGV4dChjdHgpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGJlZ2luKCkgewogICAgICAgIHN1cGVyLmJlZ2luKCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgY29tbWl0KCkgewogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHN1cGVyLmNvbW1pdCgpOwogICAgICAgICAgICB1cGRhdGVDYWNo\nZXMoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaW5zZXJ0\ncyA9IG51bGw7CiAgICAgICAgICAgIF91cGRhdGVzID0gbnVsbDsKICAgICAg\nICAgICAgX2RlbGV0ZXMgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCByb2xsYmFjaygpIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBzdXBlci5yb2xsYmFjaygpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIF9pbnNlcnRzID0gbnVsbDsKICAgICAgICAgICAgX3VwZGF0\nZXMgPSBudWxsOwogICAgICAgICAgICBfZGVsZXRlcyA9IG51bGw7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogRXZpY3QgYWxsIG1lbWJlcnMg\nb2YgdGhlIGdpdmVuIGNsYXNzZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBldmljdFR5cGVzKENvbGxlY3Rpb24gY2xhc3NlcykgewogICAgICAgIGlm\nIChjbGFzc2VzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgbWRyID0gX2N0eC5nZXRDb25maWd1\ncmF0aW9uKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9yeUlu\nc3RhbmNlKCk7CiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyID0gX2N0eC5n\nZXRDbGFzc0xvYWRlcigpOwoKICAgICAgICBDbGFzcyBjbHM7CiAgICAgICAg\nRGF0YUNhY2hlIGNhY2hlOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nY2xhc3Nlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICBjbHMgPSAoQ2xhc3MpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGNh\nY2hlID0gbWRyLmdldE1ldGFEYXRhKGNscywgbG9hZGVyLCBmYWxzZSkuZ2V0\nRGF0YUNhY2hlKCk7CiAgICAgICAgICAgIGlmIChjYWNoZSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgY2FjaGUucmVtb3ZlQWxsKGNscywgZmFsc2UpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgY2Fj\naGVzIHdpdGggdGhlIGNvbW1pdHRlZCBpbnNlcnRzLCB1cGRhdGVzLCBhbmQg\nZGVsZXRlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUNhY2hl\ncygpIHsKICAgICAgICAvLyBtYXAgZWFjaCBkYXRhIGNhY2hlIHRvIHRoZSBt\nb2RpZmljYXRpb25zIHdlIG5lZWQgdG8gcGVyZm9ybQogICAgICAgIE1hcCBt\nb2RNYXAgPSBudWxsOwogICAgICAgIE1vZGlmaWNhdGlvbnMgbW9kczsKICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtOwogICAgICAgIERhdGFDYWNo\nZVBDRGF0YSBkYXRhOwogICAgICAgIERhdGFDYWNoZSBjYWNoZTsKCiAgICAg\nICAgLy8gY3JlYXRlIHBjIGRhdGFzIGZvciBpbnNlcnRzCiAgICAgICAgaWYg\nKF9jdHguZ2V0UG9wdWxhdGVEYXRhQ2FjaGUoKSAmJiBfaW5zZXJ0cyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2luc2Vy\ndHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0\nYUNhY2hlKCk7CiAgICAgICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAg\nICBpZiAobW9kTWFwID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgbW9k\nTWFwID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIG1vZHMgPSBn\nZXRNb2RpZmljYXRpb25zKG1vZE1hcCwgY2FjaGUpOwogICAgICAgICAgICAg\nICAgZGF0YSA9IG5ld1BDRGF0YShzbSk7CiAgICAgICAgICAgICAgICBkYXRh\nLnN0b3JlKHNtKTsKICAgICAgICAgICAgICAgIG1vZHMuYWRkaXRpb25zLmFk\nZChuZXcgUENEYXRhSG9sZGVyKGRhdGEsIHNtKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8vIHVwZGF0ZSBwY2RhdGFzIGZvciB1cGRh\ndGVzCiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIGlmIChfdXBk\nYXRlcyAhPSBudWxsKSB7CiAgICAgICAgICAgIEJpdFNldCBmaWVsZHM7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX3VwZGF0ZXMuZW50cnlT\nZXQoKS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRy\nLm5leHQoKTsKICAgICAgICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIpIGVudHJ5LmdldEtleSgpOwogICAgICAgICAgICAgICAgZmllbGRz\nID0gKEJpdFNldCkgZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAgICAg\nICBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAg\nICAgICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBpdCdzIG9r\nIG5vdCB0byBjbG9uZSB0aGUgb2JqZWN0IHRoYXQgd2UgZ2V0IGZyb20gdGhl\nIGNhY2hlLAogICAgICAgICAgICAgICAgLy8gc2luY2Ugd2UncmUgaW5zaWRl\nIHRoZSBjb21taXQoKSBtZXRob2QsIHNvIGFueSBtb2RpZmljYXRpb25zCiAg\nICAgICAgICAgICAgICAvLyB0byB0aGUgdW5kZXJseWluZyBjYWNoZSBhcmUg\ndmFsaWQuIElmIHRoZSBjb21taXQgaGFkIG5vdAogICAgICAgICAgICAgICAg\nLy8gYWxyZWFkeSBzdWNjZWVkZWQsIHRoZW4gd2UnZCB3YW50IHRvIGNsb25l\nIHRoZSByZXRyaWV2ZWQKICAgICAgICAgICAgICAgIC8vIG9iamVjdC4KICAg\nICAgICAgICAgICAgIGlmIChtb2RNYXAgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBtb2RNYXAgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICAg\nICAgZGF0YSA9IGNhY2hlLmdldChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAg\nICAgICAgICAgIG1vZHMgPSBnZXRNb2RpZmljYXRpb25zKG1vZE1hcCwgY2Fj\naGUpOwoKICAgICAgICAgICAgICAgIC8vIGRhdGEgc2hvdWxkIGFsd2F5cyBi\nZSBub24tbnVsbCwgc2luY2UgdGhlIG9iamVjdCBpcwogICAgICAgICAgICAg\nICAgLy8gZGlydHksIGJ1dCBtYXliZSBpdCBnb3QgZHJvcHBlZCBmcm9tIHRo\nZSBjYWNoZSBpbiB0aGUKICAgICAgICAgICAgICAgIC8vIGludGVyaW0KICAg\nICAgICAgICAgICAgIGlmIChkYXRhID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICBkYXRhID0gbmV3UENEYXRhKHNtKTsKICAgICAgICAgICAgICAg\nICAgICBkYXRhLnN0b3JlKHNtKTsKICAgICAgICAgICAgICAgICAgICBtb2Rz\nLm5ld1VwZGF0ZXMuYWRkKG5ldyBQQ0RhdGFIb2xkZXIoZGF0YSwgc20pKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nZGF0YS5zdG9yZShzbSwgZmllbGRzKTsKICAgICAgICAgICAgICAgICAgICBt\nb2RzLmV4aXN0aW5nVXBkYXRlcy5hZGQobmV3IFBDRGF0YUhvbGRlcihkYXRh\nLCBzbSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyByZW1vdmUgcGNkYXRhcyBmb3IgZGVsZXRlcwog\nICAgICAgIGlmIChfZGVsZXRlcyAhPSBudWxsKSB7CiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gX2RlbGV0ZXMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0\nZU1hbmFnZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBjYWNoZSA9\nIHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgICAg\nICAgICBpZiAoY2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICBpZiAobW9kTWFwID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgbW9kTWFwID0gbmV3IEhhc2hNYXAoKTsK\nICAgICAgICAgICAgICAgIG1vZHMgPSBnZXRNb2RpZmljYXRpb25zKG1vZE1h\ncCwgY2FjaGUpOwogICAgICAgICAgICAgICAgbW9kcy5kZWxldGVzLmFkZChz\nbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gbm90aWZ5IHRoZSBjYWNoZXMgb2YgdGhlIGNoYW5nZXMKICAg\nICAgICBpZiAobW9kTWFwICE9IG51bGwpIHsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBtb2RNYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgZW50cnkgPSAoTWFw\nLkVudHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgY2FjaGUgPSAo\nRGF0YUNhY2hlKSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgICAgIG1v\nZHMgPSAoTW9kaWZpY2F0aW9ucykgZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAg\nICAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UncmUgbm90IGNhY2hpbmcgb2xk\nIHZlcnNpb25zCiAgICAgICAgICAgICAgICBjYWNoZS53cml0ZUxvY2soKTsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdHJh\nbnNmb3JtVG9WZXJzaW9uU2FmZVBDRGF0YXMoY2FjaGUsIG1vZHMuYWRkaXRp\nb25zKTsKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Ub1ZlcnNpb25T\nYWZlUENEYXRhcyhjYWNoZSwgbW9kcy5uZXdVcGRhdGVzKTsKICAgICAgICAg\nICAgICAgICAgICB0cmFuc2Zvcm1Ub1ZlcnNpb25TYWZlUENEYXRhcyhjYWNo\nZSwgbW9kcy5leGlzdGluZ1VwZGF0ZXMpOwogICAgICAgICAgICAgICAgICAg\nIGNhY2hlLmNvbW1pdChtb2RzLmFkZGl0aW9ucywgbW9kcy5uZXdVcGRhdGVz\nLAogICAgICAgICAgICAgICAgICAgICAgICBtb2RzLmV4aXN0aW5nVXBkYXRl\ncywgbW9kcy5kZWxldGVzKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICAgICAgY2FjaGUud3JpdGVVbmxvY2soKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLy8gaWYgd2Ugd2VyZSBpbiBsYXJnZVRyYW5zYWN0aW9uIG1vZGUsIHRo\nZW4gd2UgaGF2ZSByZWNvcmRlZAogICAgICAgIC8vIHRoZSBjbGFzc2VzIG9m\nIHVwZGF0ZWQvZGVsZXRlZCBvYmplY3RzIGFuZCB0aGVzZSBub3cgbmVlZCB0\nbyBiZQogICAgICAgIC8vIGV2aWN0ZWQKICAgICAgICBpZiAoX2N0eC5pc1Ry\nYWNrQ2hhbmdlc0J5VHlwZSgpKSB7CiAgICAgICAgICAgIGV2aWN0VHlwZXMo\nX2N0eC5nZXREZWxldGVkVHlwZXMoKSk7CiAgICAgICAgICAgIGV2aWN0VHlw\nZXMoX2N0eC5nZXRVcGRhdGVkVHlwZXMoKSk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBhbmQgbm90aWZ5IHRoZSBxdWVyeSBjYWNoZS4gIG5vdGlmeSBpbiBv\nbmUgYmF0Y2ggdG8gcmVkdWNlIHN5bmNoCiAgICAgICAgUXVlcnlDYWNoZSBx\ndWVyeUNhY2hlID0gX2N0eC5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAg\nICAgIGdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgpLmdldFN5c3RlbVF1\nZXJ5Q2FjaGUoKTsKICAgICAgICBpZiAocXVlcnlDYWNoZSAhPSBudWxsKSB7\nCiAgICAgICAgICAgIENvbGxlY3Rpb24gcGVycyA9IF9jdHguZ2V0UGVyc2lz\ndGVkVHlwZXMoKTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBkZWwgPSBfY3R4\nLmdldERlbGV0ZWRUeXBlcygpOwogICAgICAgICAgICBDb2xsZWN0aW9uIHVw\nID0gX2N0eC5nZXRVcGRhdGVkVHlwZXMoKTsKICAgICAgICAgICAgaW50IHNp\nemUgPSBwZXJzLnNpemUoKSArIGRlbC5zaXplKCkgKyB1cC5zaXplKCk7CiAg\nICAgICAgICAgIGlmIChzaXplID4gMCkgewogICAgICAgICAgICAgICAgQ29s\nbGVjdGlvbiB0eXBlcyA9IG5ldyBBcnJheUxpc3Qoc2l6ZSk7CiAgICAgICAg\nICAgICAgICB0eXBlcy5hZGRBbGwocGVycyk7CiAgICAgICAgICAgICAgICB0\neXBlcy5hZGRBbGwoZGVsKTsKICAgICAgICAgICAgICAgIHR5cGVzLmFkZEFs\nbCh1cCk7CiAgICAgICAgICAgICAgICBxdWVyeUNhY2hlLm9uVHlwZXNDaGFu\nZ2VkKG5ldyBUeXBlc0NoYW5nZWRFdmVudCh0aGlzLCB0eXBlcykpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVHJh\nbnNmb3JtcyBhIGNvbGxlY3Rpb24gb2Yge0BsaW5rIFBDRGF0YUhvbGRlcn1z\nIHRoYXQgbWlnaHQgY29udGFpbgogICAgICogc3RhbGUgaW5zdGFuY2VzIGlu\ndG8gYSBjb2xsZWN0aW9uIG9mIHVwLXRvLWRhdGUge0BsaW5rIERhdGFDYWNo\nZVBDRGF0YX1zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNmb3Jt\nVG9WZXJzaW9uU2FmZVBDRGF0YXMoRGF0YUNhY2hlIGNhY2hlLAogICAgICAg\nIExpc3QgaG9sZGVycykgewoKICAgICAgICBNYXA8T2JqZWN0LEludGVnZXI+\nIGlkcyA9IG5ldyBIYXNoTWFwPE9iamVjdCxJbnRlZ2VyPihob2xkZXJzLnNp\nemUoKSk7CiAgICAgICAgLy8gdGhpcyBsaXN0IGNvdWxkIGJlIHJlbW92ZWQg\naWYgRGF0YUNhY2hlLmdldEFsbCgpIHRvb2sgYSBDb2xsZWN0aW9uCiAgICAg\nICAgTGlzdCBpZExpc3QgPSBuZXcgQXJyYXlMaXN0KGhvbGRlcnMuc2l6ZSgp\nKTsKICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChQQ0RhdGFIb2xk\nZXIgaG9sZGVyIDogKExpc3Q8UENEYXRhSG9sZGVyPikgaG9sZGVycykgewog\nICAgICAgICAgICBpZHMucHV0KGhvbGRlci5zbS5nZXRPYmplY3RJZCgpLCBp\nKyspOwogICAgICAgICAgICBpZExpc3QuYWRkKGhvbGRlci5zbS5nZXRPYmpl\nY3RJZCgpKTsKICAgICAgICB9CgogICAgICAgIExpc3Q8UENEYXRhSG9sZGVy\nPiByZW1vdmVzID0gbmV3IEFycmF5TGlzdDxQQ0RhdGFIb2xkZXI+KCk7CiAg\nICAgICAgTWFwPE9iamVjdCxEYXRhQ2FjaGVQQ0RhdGE+IHBjZGF0YXMgPSBj\nYWNoZS5nZXRBbGwoaWRMaXN0KTsKICAgICAgICBmb3IgKEVudHJ5PE9iamVj\ndCxEYXRhQ2FjaGVQQ0RhdGE+IGVudHJ5IDogcGNkYXRhcy5lbnRyeVNldCgp\nKSB7CiAgICAgICAgICAgIEludGVnZXIgaW5kZXggPSBpZHMuZ2V0KGVudHJ5\nLmdldEtleSgpKTsKICAgICAgICAgICAgRGF0YUNhY2hlUENEYXRhIG9sZHBj\nID0gZW50cnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgUENEYXRhSG9sZGVy\nIGhvbGRlciA9IChQQ0RhdGFIb2xkZXIpIGhvbGRlcnMuZ2V0KGluZGV4KTsK\nICAgICAgICAgICAgaWYgKG9sZHBjICE9IG51bGwgJiYgY29tcGFyZVZlcnNp\nb24oaG9sZGVyLnNtLAogICAgICAgICAgICAgICAgaG9sZGVyLnNtLmdldFZl\ncnNpb24oKSwgb2xkcGMuZ2V0VmVyc2lvbigpKSA9PSBWRVJTSU9OX0VBUkxJ\nRVIpCiAgICAgICAgICAgICAgICByZW1vdmVzLmFkZChob2xkZXIpOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBob2xkZXJzLnNldChpbmRl\neCwgaG9sZGVyLnBjZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKFBD\nRGF0YUhvbGRlciBob2xkZXIgOiByZW1vdmVzKQogICAgICAgICAgICBob2xk\nZXJzLnJlbW92ZShob2xkZXIpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGEge0BsaW5rIE1vZGlmaWNhdGlvbnN9IGluc3RhbmNlIHRvIHRyYWNr\nIG1vZGlmaWNhdGlvbnMKICAgICAqIHRvIHRoZSBnaXZlbiBjYWNoZSwgY3Jl\nYXRpbmcgYW5kIGNhY2hpbmcgdGhlIGluc3RhbmNlIGlmIGl0IGRvZXMKICAg\nICAqIG5vdCBhbHJlYWR5IGV4aXN0IGluIHRoZSBnaXZlbiBtYXAuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIE1vZGlmaWNhdGlvbnMgZ2V0TW9kaWZp\nY2F0aW9ucyhNYXAgbW9kTWFwLCBEYXRhQ2FjaGUgY2FjaGUpIHsKICAgICAg\nICBNb2RpZmljYXRpb25zIG1vZHMgPSAoTW9kaWZpY2F0aW9ucykgbW9kTWFw\nLmdldChjYWNoZSk7CiAgICAgICAgaWYgKG1vZHMgPT0gbnVsbCkgewogICAg\nICAgICAgICBtb2RzID0gbmV3IE1vZGlmaWNhdGlvbnMoKTsKICAgICAgICAg\nICAgbW9kTWFwLnB1dChjYWNoZSwgbW9kcyk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBtb2RzOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGV4aXN0\ncyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgZWRhdGEpIHsKICAg\nICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBzbS5nZXRNZXRhRGF0YSgpLmdldERh\ndGFDYWNoZSgpOwogICAgICAgIGlmIChjYWNoZSAhPSBudWxsICYmICFpc0xv\nY2tpbmcobnVsbCkKICAgICAgICAgICAgJiYgY2FjaGUuY29udGFpbnMoc20u\nZ2V0T2JqZWN0SWQoKSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIHJldHVybiBzdXBlci5leGlzdHMoc20sIGVkYXRhKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBzeW5jVmVyc2lvbihPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBPYmplY3QgZWRhdGEpIHsKICAgICAgICBEYXRhQ2FjaGUgY2Fj\naGUgPSBzbS5nZXRNZXRhRGF0YSgpLmdldERhdGFDYWNoZSgpOwogICAgICAg\nIGlmIChjYWNoZSA9PSBudWxsIHx8IHNtLmlzRW1iZWRkZWQoKSkKICAgICAg\nICAgICAgcmV0dXJuIHN1cGVyLnN5bmNWZXJzaW9uKHNtLCBlZGF0YSk7Cgog\nICAgICAgIERhdGFDYWNoZVBDRGF0YSBkYXRhOwogICAgICAgIE9iamVjdCB2\nZXJzaW9uID0gbnVsbDsKICAgICAgICBkYXRhID0gY2FjaGUuZ2V0KHNtLmdl\ndE9iamVjdElkKCkpOwogICAgICAgIGlmICghaXNMb2NraW5nKG51bGwpICYm\nIGRhdGEgIT0gbnVsbCkKICAgICAgICAgICAgdmVyc2lvbiA9IGRhdGEuZ2V0\nVmVyc2lvbigpOwoKICAgICAgICAvLyBpZiB3ZSBoYXZlIGEgY2FjaGVkIHZl\ncnNpb24gdXBkYXRlIGZyb20gdGhlcmUKICAgICAgICBpZiAodmVyc2lvbiAh\nPSBudWxsKSB7CiAgICAgICAgICAgIGlmICghdmVyc2lvbi5lcXVhbHMoc20u\nZ2V0VmVyc2lvbigpKSkgewogICAgICAgICAgICAgICAgc20uc2V0VmVyc2lv\nbih2ZXJzaW9uKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCgogICAgICAgIC8vIHVzZSBkYXRhIHN0b3JlIHZlcnNpb24KICAgICAgICBy\nZXR1cm4gc3VwZXIuc3luY1ZlcnNpb24oc20sIGVkYXRhKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpbml0aWFsaXplKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIFBDU3RhdGUgc3RhdGUsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLCBPYmplY3QgZWRhdGEpIHsKICAgICAgICBEYXRhQ2FjaGUg\nY2FjaGUgPSBzbS5nZXRNZXRhRGF0YSgpLmdldERhdGFDYWNoZSgpOwogICAg\nICAgIGlmIChjYWNoZSA9PSBudWxsIHx8IHNtLmlzRW1iZWRkZWQoKSkKICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLmluaXRpYWxpemUoc20sIHN0YXRlLCBm\nZXRjaCwgZWRhdGEpOwoKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YSA9\nIGNhY2hlLmdldChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICBpZiAoZGF0\nYSAhPSBudWxsICYmICFpc0xvY2tpbmcoZmV0Y2gpKSB7CiAgICAgICAgICAg\nIC8vIyMjIHRoZSAnZGF0YS50eXBlJyBhY2Nlc3MgaGVyZSBwcm9iYWJseSBu\nZWVkcyB0byBiZQogICAgICAgICAgICAvLyMjIyBhZGRyZXNzZWQgZm9yIGJ1\nZyA1MTEKICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShkYXRhLmdldFR5cGUo\nKSwgc3RhdGUpOwogICAgICAgICAgICBkYXRhLmxvYWQoc20sIGZldGNoLCBl\nZGF0YSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAg\nICAgICAgLy8gaW5pdGlhbGl6ZSBmcm9tIHN0b3JlIG1hbmFnZXIKICAgICAg\nICBpZiAoIXN1cGVyLmluaXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgZWRh\ndGEpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFf\nY3R4LmdldFBvcHVsYXRlRGF0YUNhY2hlKCkpCiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCB3ZSdyZSBub3Qg\ndHJ5aW5nIHRvIGNhY2hlIGFuIG9sZCB2ZXJzaW9uCiAgICAgICAgY2FjaGUu\nd3JpdGVMb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZGF0YSA9\nIGNhY2hlLmdldChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgaWYg\nKGRhdGEgIT0gbnVsbCAmJiBjb21wYXJlVmVyc2lvbihzbSwgc20uZ2V0VmVy\nc2lvbigpLAogICAgICAgICAgICAgICAgZGF0YS5nZXRWZXJzaW9uKCkpID09\nIFZFUlNJT05fRUFSTElFUikKICAgICAgICAgICAgICAgIHJldHVybiB0cnVl\nOwoKICAgICAgICAgICAgLy8gY2FjaGUgbmV3bHkgbG9hZGVkIGluZm8uIEl0\nIGlzIHNhZmUgdG8gY2FjaGUgZGF0YSBmcm9ybQogICAgICAgICAgICAvLyBp\nbml0aWFsaXplKCkgYmVjYXVzZSB0aGlzIG1ldGhvZCBpcyBvbmx5IGNhbGxl\nZCB1cG9uCiAgICAgICAgICAgIC8vIGluaXRpYWwgbG9hZCBvZiB0aGUgZGF0\nYS4KICAgICAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGRhdGEgPSBuZXdQQ0RhdGEoc20pOwogICAgICAgICAgICBkYXRhLnN0\nb3JlKHNtKTsKICAgICAgICAgICAgY2FjaGUucHV0KGRhdGEpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGNhY2hlLndyaXRlVW5sb2NrKCk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGxvYWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0\nU2V0IGZpZWxkcywKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nIGludCBsb2NrTGV2ZWwsIE9iamVjdCBlZGF0YSkgewogICAgICAgIERhdGFD\nYWNoZSBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7\nCiAgICAgICAgaWYgKGNhY2hlID09IG51bGwgfHwgc20uaXNFbWJlZGRlZCgp\nKQogICAgICAgICAgICByZXR1cm4gc3VwZXIubG9hZChzbSwgZmllbGRzLCBm\nZXRjaCwgbG9ja0xldmVsLCBlZGF0YSk7CgogICAgICAgIERhdGFDYWNoZVBD\nRGF0YSBkYXRhID0gY2FjaGUuZ2V0KHNtLmdldE9iamVjdElkKCkpOwogICAg\nICAgIGlmIChsb2NrTGV2ZWwgPT0gTG9ja0xldmVscy5MT0NLX05PTkUgJiYg\nIWlzTG9ja2luZyhmZXRjaCkKICAgICAgICAgICAgJiYgZGF0YSAhPSBudWxs\nKQogICAgICAgICAgICBkYXRhLmxvYWQoc20sIGZpZWxkcywgZmV0Y2gsIGVk\nYXRhKTsKICAgICAgICBpZiAoZmllbGRzLmxlbmd0aCgpID09IDApCiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBsb2FkIGZyb20gc3Rv\ncmUgbWFuYWdlcjsgY2xvbmUgdGhlIHNldCBvZiBzdGlsbC11bmxvYWRlZCBm\naWVsZHMKICAgICAgICAvLyBzbyB0aGF0IGlmIHRoZSBzdG9yZSBtYW5hZ2Vy\nIGRlY2lkZXMgdG8gbW9kaWZ5IGl0IGl0IHdvbid0IGFmZmVjdCB1cwogICAg\nICAgIGlmICghc3VwZXIubG9hZChzbSwgKEJpdFNldCkgZmllbGRzLmNsb25l\nKCksIGZldGNoLCBsb2NrTGV2ZWwsIGVkYXRhKSkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIGlmICghX2N0eC5nZXRQb3B1bGF0ZURhdGFD\nYWNoZSgpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAvLyBE\nbyBub3QgbG9hZCBjaGFuZ2VzIGludG8gY2FjaGUgaWYgdGhlIGluc3RhbmNl\nIGhhcyBiZWVuIGZsdXNoZWQKICAgICAgICBpZiAoc20uaXNGbHVzaGVkKCkp\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhhdCB3ZSdyZSBub3QgdHJ5aW5nIHRvIGNhY2hlIGFuIG9sZCB2ZXJz\naW9uCiAgICAgICAgY2FjaGUud3JpdGVMb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgZGF0YSA9IGNhY2hlLmdldChzbS5nZXRPYmplY3RJZCgp\nKTsKICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCAmJiBjb21wYXJlVmVy\nc2lvbihzbSwgc20uZ2V0VmVyc2lvbigpLAogICAgICAgICAgICAgICAgZGF0\nYS5nZXRWZXJzaW9uKCkpID09IFZFUlNJT05fRUFSTElFUikKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgLy8gY2FjaGUgbmV3\nbHkgbG9hZGVkIGluZm8KICAgICAgICAgICAgYm9vbGVhbiBpc05ldyA9IGRh\ndGEgPT0gbnVsbDsKICAgICAgICAgICAgaWYgKGlzTmV3KQogICAgICAgICAg\nICAgICAgZGF0YSA9IG5ld1BDRGF0YShzbSk7CiAgICAgICAgICAgIGRhdGEu\nc3RvcmUoc20sIGZpZWxkcyk7CiAgICAgICAgICAgIGlmIChpc05ldykKICAg\nICAgICAgICAgICAgIGNhY2hlLnB1dChkYXRhKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgY2FjaGUudXBkYXRlKGRhdGEpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGNhY2hlLndyaXRlVW5sb2NrKCk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1\nYmxpYyBDb2xsZWN0aW9uIGxvYWRBbGwoQ29sbGVjdGlvbiBzbXMsIFBDU3Rh\ndGUgc3RhdGUsIGludCBsb2FkLAogICAgCQlGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIE9iamVjdCBlZGF0YSkgewogICAgCWlmIChpc0xvY2tpbmcoZmV0\nY2gpIHx8IAogICAgCSAgICghaXNMb2NraW5nKGZldGNoKSAmJgogICAgCQko\nbG9hZCA9PSBTdG9yZU1hbmFnZXIuRk9SQ0VfTE9BRF9SRUZSRVNIKQogICAg\nCQkmJiAhX2N0eC5nZXRDb25maWd1cmF0aW9uKCkuZ2V0UmVmcmVzaEZyb21E\nYXRhQ2FjaGUoKSkpIHsKICAgIAkgICAgICAgcmV0dXJuIHN1cGVyLmxvYWRB\nbGwoc21zLCBzdGF0ZSwgbG9hZCwgZmV0Y2gsIGVkYXRhKTsKICAgIAl9Cgog\nICAgICAgIE1hcCB1bmxvYWRlZCA9IG51bGw7CiAgICAgICAgTGlzdCBzbUxp\nc3QgPSBudWxsOwogICAgICAgIE1hcCBjYWNoZXMgPSBuZXcgSGFzaE1hcCgp\nOwogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc207CiAgICAgICAgRGF0\nYUNhY2hlIGNhY2hlOwogICAgICAgIERhdGFDYWNoZVBDRGF0YSBkYXRhOwog\nICAgICAgIEJpdFNldCBmaWVsZHM7CgogICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gc21zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgIGNhY2hlID0gc20uZ2V0TWV0YURhdGEoKS5nZXREYXRh\nQ2FjaGUoKTsKICAgICAgICAgICAgaWYgKGNhY2hlID09IG51bGwgfHwgc20u\naXNFbWJlZGRlZCgpKSB7CiAgICAgICAgICAgICAgICB1bmxvYWRlZCA9IGFk\nZFVubG9hZGVkKHNtLCBudWxsLCB1bmxvYWRlZCk7CiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNt\nLmdldE1hbmFnZWRJbnN0YW5jZSgpID09IG51bGwKICAgICAgICAgICAgICAg\nIHx8IGxvYWQgIT0gRk9SQ0VfTE9BRF9OT05FCiAgICAgICAgICAgICAgICB8\nfCBzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xMT1cpIHsKICAgICAg\nICAgICAgICAgIHNtTGlzdCA9IChMaXN0KSBjYWNoZXMuZ2V0KGNhY2hlKTsK\nICAgICAgICAgICAgICAgIGlmIChzbUxpc3QgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIHNtTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAg\nICAgICAgICAgICAgICBjYWNoZXMucHV0KGNhY2hlLCBzbUxpc3QpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc21MaXN0LmFkZChzbSk7\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWNhY2hlLmNvbnRhaW5zKHNtLmdl\ndE9iamVjdElkKCkpKQogICAgICAgICAgICAgICAgdW5sb2FkZWQgPSBhZGRV\nbmxvYWRlZChzbSwgbnVsbCwgdW5sb2FkZWQpOwogICAgICAgIH0KICAgICAg\nICAKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNhY2hlcy5rZXlTZXQo\nKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBj\nYWNoZSA9IChEYXRhQ2FjaGUpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHNt\nTGlzdCA9IChMaXN0KSBjYWNoZXMuZ2V0KGNhY2hlKTsKICAgICAgICAgICAg\nTGlzdCBvaWRMaXN0ID0gbmV3IEFycmF5TGlzdChzbUxpc3Quc2l6ZSgpKTsK\nCiAgICAgICAgICAgIGZvciAoaXRyPXNtTGlzdC5pdGVyYXRvcigpO2l0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBzbSA9IChPcGVuSlBBU3Rh\ndGVNYW5hZ2VyKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgb2lkTGlz\ndC5hZGQoKE9wZW5KUEFJZCkgc20uZ2V0T2JqZWN0SWQoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIE1hcCBkYXRhTWFwID0g\nY2FjaGUuZ2V0QWxsKG9pZExpc3QpOwoKICAgICAgICAgICAgZm9yIChpdHI9\nc21MaXN0Lml0ZXJhdG9yKCk7aXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBkYXRhID0gKERhdGFDYWNoZVBDRGF0YSkgZGF0\nYU1hcC5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIChPcGVuSlBBSWQp\nIHNtLmdldE9iamVjdElkKCkpOwoKICAgICAgICAgICAgICAgIGlmIChzbS5n\nZXRNYW5hZ2VkSW5zdGFuY2UoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGRhdGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nICAgICAvLyMjIyB0aGUgJ2RhdGEudHlwZScgYWNjZXNzIGhlcmUgcHJvYmFi\nbHkgbmVlZHMKICAgICAgICAgICAgICAgICAgICAgICAgLy8jIyMgdG8gYmUg\nYWRkcmVzc2VkIGZvciBidWcgNTExCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNtLmluaXRpYWxpemUoZGF0YS5nZXRUeXBlKCksIHN0YXRlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgZGF0YS5sb2FkKHNtLCBmZXRjaCwgZWRhdGEp\nOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAg\nICAgICAgICB1bmxvYWRlZCA9IGFkZFVubG9hZGVkKHNtLCBudWxsLCB1bmxv\nYWRlZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxvYWQgIT0gRk9S\nQ0VfTE9BRF9OT05FCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IHNtLmdl\ndFBDU3RhdGUoKSA9PSBQQ1N0YXRlLkhPTExPVykgewogICAgICAgICAgICAg\nICAgICAgIGRhdGEgPSBjYWNoZS5nZXQoc20uZ2V0T2JqZWN0SWQoKSk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBsb2FkIHVubG9hZGVkIGZpZWxkcwogICAg\nICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBzbS5nZXRVbmxvYWRlZChm\nZXRjaCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubG9hZChzbSwg\nZmllbGRzLCBmZXRjaCwgZWRhdGEpOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoZmllbGRzLmxlbmd0aCgpID4gMCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHVubG9hZGVkID0gYWRkVW5sb2FkZWQoc20sIGZpZWxkcywg\ndW5sb2FkZWQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAg\nICAgICAgICAgICAgICAgICB1bmxvYWRlZCA9IGFkZFVubG9hZGVkKHNtLCBu\ndWxsLCB1bmxvYWRlZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIGlmICh1bmxvYWRlZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKCiAg\nICAgICAgLy8gbG9hZCB3aXRoIGRlbGVnYXRlCiAgICAgICAgQ29sbGVjdGlv\nbiBmYWlsZWQgPSBzdXBlci5sb2FkQWxsKHVubG9hZGVkLmtleVNldCgpLCBz\ndGF0ZSwgbG9hZCwKICAgICAgICAgICAgZmV0Y2gsIGVkYXRhKTsKICAgICAg\nICBpZiAoIV9jdHguZ2V0UG9wdWxhdGVEYXRhQ2FjaGUoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhaWxlZDsKCiAgICAgICAgLy8gZm9yIGVhY2ggbG9hZGVk\nIGluc3RhbmNlLCBtZXJnZSBsb2FkZWQgc3RhdGUgaW50byBjYWNoZWQgZGF0\nYQogICAgICAgIE1hcC5FbnRyeSBlbnRyeTsKICAgICAgICBib29sZWFuIGlz\nTmV3OwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdW5sb2FkZWQuZW50\ncnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIHNtID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpIGVudHJ5LmdldEtleSgp\nOwogICAgICAgICAgICBmaWVsZHMgPSAoQml0U2V0KSBlbnRyeS5nZXRWYWx1\nZSgpOwoKICAgICAgICAgICAgY2FjaGUgPSBzbS5nZXRNZXRhRGF0YSgpLmdl\ndERhdGFDYWNoZSgpOwogICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCB8\nfCBzbS5pc0VtYmVkZGVkKCkgfHwgKGZhaWxlZCAhPSBudWxsCiAgICAgICAg\nICAgICAgICAmJiBmYWlsZWQuY29udGFpbnMoc20uZ2V0SWQoKSkpKQogICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhhdCB3ZSdyZSBub3QgdHJ5aW5nIHRvIGNhY2hlIGFuIG9sZCB2ZXJz\naW9uCiAgICAgICAgICAgIGNhY2hlLndyaXRlTG9jaygpOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgZGF0YSA9IGNhY2hlLmdldChzbS5n\nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgICAgIGlmIChkYXRhICE9IG51\nbGwgJiYgY29tcGFyZVZlcnNpb24oc20sIHNtLmdldFZlcnNpb24oKSwKICAg\nICAgICAgICAgICAgICAgICBkYXRhLmdldFZlcnNpb24oKSkgPT0gVkVSU0lP\nTl9FQVJMSUVSKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgICAgIGlzTmV3ID0gZGF0YSA9PSBudWxsOwogICAgICAgICAg\nICAgICAgaWYgKGlzTmV3KQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBu\nZXdQQ0RhdGEoc20pOwogICAgICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGRhdGEuc3RvcmUoc20pOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGRhdGEuc3Rv\ncmUoc20sIGZpZWxkcyk7CiAgICAgICAgICAgICAgICBpZiAoaXNOZXcpCiAg\nICAgICAgICAgICAgICAgICAgY2FjaGUucHV0KGRhdGEpOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGNhY2hlLnVwZGF0ZShk\nYXRhKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nIGNhY2hlLndyaXRlVW5sb2NrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGZhaWxlZDsKICAgIH0KCiAgICAvKioKICAgICAq\nIEhlbHBlciBtZXRob2QgdG8gYWRkIGFuIHVubG9hZGVkIGluc3RhbmNlIHRv\nIHRoZSBnaXZlbiBtYXAuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE1h\ncCBhZGRVbmxvYWRlZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQg\nZmllbGRzLAogICAgICAgIE1hcCB1bmxvYWRlZCkgewogICAgICAgIGlmICh1\nbmxvYWRlZCA9PSBudWxsKQogICAgICAgICAgICB1bmxvYWRlZCA9IG5ldyBI\nYXNoTWFwKCk7CiAgICAgICAgdW5sb2FkZWQucHV0KHNtLCBmaWVsZHMpOwog\nICAgICAgIHJldHVybiB1bmxvYWRlZDsKICAgIH0KCiAgICBwdWJsaWMgQ29s\nbGVjdGlvbiBmbHVzaChDb2xsZWN0aW9uIHN0YXRlcykgewogICAgICAgIENv\nbGxlY3Rpb24gZXhjZXBzID0gc3VwZXIuZmx1c2goc3RhdGVzKTsKCiAgICAg\nICAgLy8gaWYgdGhlcmUgd2VyZSBlcnJvcnMgZXZpY3QgYmFkIGluc3RhbmNl\ncyBhbmQgZG9uJ3QgcmVjb3JkIGNoYW5nZXMKICAgICAgICBpZiAoIWV4Y2Vw\ncy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdGVy\nID0gZXhjZXBzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOyApIHsKICAg\nICAgICAgICAgICAgIEV4Y2VwdGlvbiBlID0gKEV4Y2VwdGlvbikgaXRlci5u\nZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIE9wdGlt\naXN0aWNFeGNlcHRpb24pCiAgICAgICAgICAgICAgICAgICAgbm90aWZ5T3B0\naW1pc3RpY0xvY2tGYWlsdXJlKChPcHRpbWlzdGljRXhjZXB0aW9uKSBlKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZXhjZXBzOwogICAg\nICAgIH0KCiAgICAgICAgLy8gaWYgbGFyZ2UgdHJhbnNhY3Rpb24gbW9kZSBk\nb24ndCByZWNvcmQgaW5kaXZpZHVhbCBjaGFuZ2VzCiAgICAgICAgaWYgKF9j\ndHguaXNUcmFja0NoYW5nZXNCeVR5cGUoKSkKICAgICAgICAgICAgcmV0dXJu\nIGV4Y2VwczsKCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbTsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHN0YXRlcy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBzbSA9IChPcGVuSlBBU3Rh\ndGVNYW5hZ2VyKSBpdHIubmV4dCgpOwoKICAgICAgICAgICAgaWYgKHNtLmdl\ndFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBORVcgJiYgIXNtLmlzRmx1c2hlZCgp\nKSB7CiAgICAgICAgICAgICAgICBpZiAoX2luc2VydHMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBfaW5zZXJ0cyA9IG5ldyBBcnJheUxpc3QoKTsK\nICAgICAgICAgICAgICAgIF9pbnNlcnRzLmFkZChzbSk7CgogICAgICAgICAg\nICAgICAgLy8gbWF5IGhhdmUgYmVlbiByZS1wZXJzaXN0ZWQKICAgICAgICAg\nICAgICAgIGlmIChfZGVsZXRlcyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIF9kZWxldGVzLnJlbW92ZShzbSk7CiAgICAgICAgICAgIH0gZWxzZSBp\nZiAoX2luc2VydHMgIT0gbnVsbCAKICAgICAgICAgICAgICAgICYmIChzbS5n\nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QTkVXREVMRVRFRCAKICAgICAgICAg\nICAgICAgIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBORVdGTFVT\nSEVEREVMRVRFRCkpCiAgICAgICAgICAgICAgICBfaW5zZXJ0cy5yZW1vdmUo\nc20pOwogICAgICAgICAgICBlbHNlIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0g\nUENTdGF0ZS5QRElSVFkpIHsKICAgICAgICAgICAgICAgIGlmIChfdXBkYXRl\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF91cGRhdGVzID0gbmV3\nIEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIF91cGRhdGVzLnB1dChzbSwg\nc20uZ2V0RGlydHkoKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc20uZ2V0\nUENTdGF0ZSgpID09IFBDU3RhdGUuUERFTEVURUQpIHsKICAgICAgICAgICAg\nICAgIGlmIChfZGVsZXRlcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIF9kZWxldGVzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgIF9k\nZWxldGVzLmFkZChzbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBGaXJlIGxvY2FsIHN0YWxlbmVzcyBkZXRlY3Rpb24gZXZl\nbnRzIGZyb20gdGhlIGNhY2hlIHRoZSBPSUQgKGlmCiAgICAgKiBhdmFpbGFi\nbGUpIHRoYXQgcmVzdWx0ZWQgaW4gYW4gb3B0aW1pc3RpYyBsb2NrIGV4Y2Vw\ndGlvbiBpZmYgdGhlCiAgICAgKiB2ZXJzaW9uIGluZm9ybWF0aW9uIGluIHRo\nZSBjYWNoZSBtYXRjaGVzIHRoZSB2ZXJzaW9uIGluZm9ybWF0aW9uCiAgICAg\nKiBpbiB0aGUgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGZhaWxlZCBpbnN0YW5j\nZS4gVGhpcyBtZWFucyB0aGF0IHdlCiAgICAgKiB3aWxsIGV2aWN0IGRhdGEg\nZnJvbSB0aGUgY2FjaGUgZm9yIHJlY29yZHMgdGhhdCBzaG91bGQgaGF2ZQog\nICAgICogc3VjY2Vzc2Z1bGx5IGNvbW1pdHRlZCBhY2NvcmRpbmcgdG8gdGhl\nIGRhdGEgY2FjaGUgYnV0CiAgICAgKiBkaWQgbm90LiBUaGUgb25seSBwcmVk\naWN0YWJsZSByZWFzb24gdGhhdCBjb3VsZCBjYXVzZSB0aGlzIGJlaGF2aW9y\nCiAgICAgKiBpcyBhIGNvbmN1cnJlbnQgb3V0LW9mLWJhbmQgbW9kaWZpY2F0\naW9uIHRvIHRoZSBkYXRhYmFzZSB0aGF0IHdhcyBub3QgCiAgICAgKiBjb21t\ndW5pY2F0ZWQgdG8gdGhlIGNhY2hlLiBUaGlzIGxvZ2ljIG1ha2VzIE9wZW5K\nUEEncyBkYXRhIGNhY2hlIAogICAgICogc29tZXdoYXQgdG9sZXJhbnQgb2Yg\nc3VjaCBiZWhhdmlvciwgaW4gdGhhdCB0aGUgY2FjaGUgd2lsbCBiZSBjbGVh\nbmVkIAogICAgICogdXAgYXMgZmFpbHVyZXMgb2NjdXIuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBub3RpZnlPcHRpbWlzdGljTG9ja0ZhaWx1cmUoT3B0\naW1pc3RpY0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgT2JqZWN0IG8gPSBlLmdl\ndEZhaWxlZE9iamVjdCgpOwogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20gPSBfY3R4LmdldFN0YXRlTWFuYWdlcihvKTsKICAgICAgICBpZiAoc20g\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIE9iamVjdCBv\naWQgPSBzbS5nZXRJZCgpOwogICAgICAgIGJvb2xlYW4gcmVtb3ZlOwoKICAg\nICAgICAvLyB0aGlzIGxvZ2ljIGNvdWxkIGJlIG1vcmUgZWZmaWNpZW50IC0t\nIHdlIGNvdWxkIGFnZ3JlZ2F0ZQogICAgICAgIC8vIGFsbCB0aGUgY2FjaGUt\nPm9pZCBjaGFuZ2VzLCBhbmQgdGhlbiB1c2UgRGF0YUNhY2hlLnJlbW92ZUFs\nbCgpIAogICAgICAgIC8vIGFuZCBsZXNzIHdyaXRlIGxvY2tzIHRvIGRvIHRo\nZSBtdXRhdGlvbi4KICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBzbS5n\nZXRNZXRhRGF0YSgpOwogICAgICAgIERhdGFDYWNoZSBjYWNoZSA9IG1ldGEu\nZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgaWYgKGNhY2hlID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgY2FjaGUud3JpdGVMb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgRGF0YUNhY2hlUENEYXRhIGRh\ndGEgPSBjYWNoZS5nZXQob2lkKTsKICAgICAgICAgICAgaWYgKGRhdGEgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHN3\naXRjaCAoY29tcGFyZVZlcnNpb24oc20sIHNtLmdldFZlcnNpb24oKSwgZGF0\nYS5nZXRWZXJzaW9uKCkpKSB7CiAgICAgICAgICAgICAgICBjYXNlIFN0b3Jl\nTWFuYWdlci5WRVJTSU9OX0xBVEVSOgogICAgICAgICAgICAgICAgY2FzZSBT\ndG9yZU1hbmFnZXIuVkVSU0lPTl9TQU1FOgogICAgICAgICAgICAgICAgICAg\nIC8vIFRoaXMgdHgncyBjdXJyZW50IHZlcnNpb24gaXMgbGF0ZXIgdGhhbiBv\nciB0aGUgc2FtZSBhcyAKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZGF0\nYSBjYWNoZSB2ZXJzaW9uLiBJbiB0aGlzIGNhc2UsIHRoZSBjb21taXQgc2hv\ndWxkIAogICAgICAgICAgICAgICAgICAgIC8vIGhhdmUgc3VjY2VlZGVkIGZy\nb20gdGhlIHN0YW5kcG9pbnQgb2YgdGhlIGNhY2hlLiBSZW1vdmUgCiAgICAg\nICAgICAgICAgICAgICAgLy8gdGhlIGluc3RhbmNlIGZyb20gY2FjaGUgaW4g\ndGhlIGhvcGVzIHRoYXQgdGhlIGNhY2hlIGlzIAogICAgICAgICAgICAgICAg\nICAgIC8vIG91dCBvZiBzeW5jLgogICAgICAgICAgICAgICAgICAgIHJlbW92\nZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIFN0b3JlTWFuYWdlci5WRVJTSU9OX0VBUkxJRVI6CiAg\nICAgICAgICAgICAgICAgICAgLy8gVGhpcyB0eCdzIGN1cnJlbnQgdmVyc2lv\nbiBpcyBlYXJsaWVyIHRoYW4gdGhlIGRhdGEgCiAgICAgICAgICAgICAgICAg\nICAgLy8gY2FjaGUgdmVyc2lvbi4gVGhpcyBpcyBhIG5vcm1hbCBvcHRpbWlz\ndGljIGxvY2sgZmFpbHVyZS4gCiAgICAgICAgICAgICAgICAgICAgLy8gRG8g\nbm90IGNsZWFuIHVwIHRoZSBjYWNoZTsgaXQgcHJvYmFibHkgYWxyZWFkeSBo\nYXMgdGhlIAogICAgICAgICAgICAgICAgICAgIC8vIHJpZ2h0IHZhbHVlcywg\nYW5kIGlmIG5vdCwgaXQnbGwgZ2V0IGNsZWFuZWQgdXAgYnkgYSB0eAogICAg\nICAgICAgICAgICAgICAgIC8vIHRoYXQgZmFpbHMgaW4gb25lIG9mIHRoZSBv\ndGhlciBjYXNlIHN0YXRlbWVudHMuCiAgICAgICAgICAgICAgICAgICAgcmVt\nb3ZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIFN0b3JlTWFuYWdlci5WRVJTSU9OX0RJRkZFUkVO\nVDoKICAgICAgICAgICAgICAgICAgICAvLyBUaGUgdmVyc2lvbiBzdHJhdGVn\neSBmb3IgdGhlIGZhaWxlZCBvYmplY3QgZG9lcyBub3QKICAgICAgICAgICAg\nICAgICAgICAvLyBzdG9yZSBlbm91Z2ggaW5mb3JtYXRpb24gdG8gb3B0aW1p\nemUgZm9yIGV4cGVjdGVkCiAgICAgICAgICAgICAgICAgICAgLy8gZmFpbHVy\nZXMuIENsZWFuIHVwIHRoZSBjYWNoZS4KICAgICAgICAgICAgICAgICAgICBy\nZW1vdmUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAvLyBV\nbmV4cGVjdGVkIHJldHVybiB2YWx1ZS4gUmVtb3ZlIHRvIGJlIGZ1dHVyZS1w\ncm9vZi4KICAgICAgICAgICAgICAgICAgICByZW1vdmUgPSB0cnVlOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChyZW1vdmUpCiAgICAgICAgICAgICAgICAvLyByZW1vdmUgZGly\nZWN0bHkgaW5zdGVhZCBvZiB2aWEgdGhlIFJlbW90ZUNvbW1pdExpc3RlbmVy\nCiAgICAgICAgICAgICAgICAvLyBzaW5jZSB3ZSBoYXZlIGEgd3JpdGUgbG9j\nayBoZXJlIGFscmVhZHksIHNvIHRoaXMgaXMgbW9yZQogICAgICAgICAgICAg\nICAgLy8gZWZmaWNpZW50IHRoYW4gcmVhZC1sb2NraW5nIGFuZCB0aGVuIHdy\naXRlLWxvY2tpbmcgbGF0ZXIuCiAgICAgICAgICAgICAgICBjYWNoZS5yZW1v\ndmUoc20uZ2V0SWQoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgY2FjaGUud3JpdGVVbmxvY2soKTsKICAgICAgICB9CgogICAgICAgIC8v\nIGZpcmUgb2ZmIGEgcmVtb3RlIGNvbW1pdCBzdGFsZW5lc3NzIGRldGVjdGlv\nbiBldmVudC4KICAgICAgICBfY3R4LmdldENvbmZpZ3VyYXRpb24oKS5nZXRS\nZW1vdGVDb21taXRFdmVudE1hbmFnZXIoKQogICAgICAgICAgICAuZmlyZUxv\nY2FsU3RhbGVOb3RpZmljYXRpb24ob2lkKTsKICAgIH0KCiAgICBwdWJsaWMg\nU3RvcmVRdWVyeSBuZXdRdWVyeShTdHJpbmcgbGFuZ3VhZ2UpIHsKICAgICAg\nICBTdG9yZVF1ZXJ5IHEgPSBzdXBlci5uZXdRdWVyeShsYW5ndWFnZSk7Cgog\nICAgICAgIC8vIGlmIHRoZSBxdWVyeSBjYW4ndCBiZSBwYXJzZWQgb3IgaXQn\ncyB1c2luZyBhIG5vbi1wYXJzZWQgbGFuZ3VhZ2UKICAgICAgICAvLyAob25l\nIGZvciB3aGljaCB0aGVyZSBpcyBubyBFeHByZXNzaW9uUGFyc2VyKSwgd2Ug\nY2FuJ3QgY2FjaGUgaXQuCiAgICAgICAgaWYgKHEgPT0gbnVsbCB8fCBRdWVy\neUxhbmd1YWdlcy5wYXJzZXJGb3JMYW5ndWFnZShsYW5ndWFnZSkgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIHE7CgogICAgICAgIFF1ZXJ5Q2FjaGUg\ncXVlcnlDYWNoZSA9IF9jdHguZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAg\nICAgICBnZXREYXRhQ2FjaGVNYW5hZ2VySW5zdGFuY2UoKS5nZXRTeXN0ZW1R\ndWVyeUNhY2hlKCk7CiAgICAgICAgaWYgKHF1ZXJ5Q2FjaGUgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIHE7CgogICAgICAgIHJldHVybiBuZXcgUXVl\ncnlDYWNoZVN0b3JlUXVlcnkocSwgcXVlcnlDYWNoZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgY2FjaGVhYmxlIGluc3RhbmNlIGZv\nciB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlci4KICAgICAqLwogICAgcHJpdmF0\nZSBEYXRhQ2FjaGVQQ0RhdGEgbmV3UENEYXRhKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20pIHsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBzbS5nZXRN\nZXRhRGF0YSgpOwogICAgICAgIGlmIChfZ2VuICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiAoRGF0YUNhY2hlUENEYXRhKSBfZ2VuLmdlbmVyYXRlUENE\nYXRhCiAgICAgICAgICAgICAgICAoc20uZ2V0T2JqZWN0SWQoKSwgbWV0YSk7\nCiAgICAgICAgcmV0dXJuIG5ldyBEYXRhQ2FjaGVQQ0RhdGFJbXBsKHNtLmZl\ndGNoT2JqZWN0SWQoKSwgbWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gd2hldGhlciB0aGUgY29udGV4dCBpcyBsb2NraW5nIGxvYWRlZCBk\nYXRhLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNMb2NraW5nKEZl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChmZXRjaCA9\nPSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IF9jdHguZ2V0RmV0Y2hDb25m\naWd1cmF0aW9uKCk7CiAgICAgICAgcmV0dXJuIGZldGNoLmdldFJlYWRMb2Nr\nTGV2ZWwoKSA+IExvY2tMZXZlbHMuTE9DS19OT05FOwogICAgfQoKICAgIC8q\nKgogICAgICogU3RydWN0dXJlIHVzZWQgZHVyaW5nIHRoZSBjb21taXQgcHJv\nY2VzcyB0byB0cmFjayBjYWNoZSBtb2RpZmljYXRpb25zLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBjbGFzcyBNb2RpZmljYXRpb25zIHsKCiAgICAg\nICAgcHVibGljIGZpbmFsIExpc3QgYWRkaXRpb25zID0gbmV3IEFycmF5TGlz\ndCgpOwogICAgICAgIHB1YmxpYyBmaW5hbCBMaXN0IG5ld1VwZGF0ZXMgPSBu\nZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgcHVibGljIGZpbmFsIExpc3QgZXhp\nc3RpbmdVcGRhdGVzID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgIHB1Ymxp\nYyBmaW5hbCBMaXN0IGRlbGV0ZXMgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICB9\nCgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUENEYXRhSG9sZGVyIHsKCiAg\nICAgICAgcHVibGljIGZpbmFsIERhdGFDYWNoZVBDRGF0YSBwY2RhdGE7CiAg\nICAgICAgcHVibGljIGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc207Cgog\nICAgICAgIHB1YmxpYyBQQ0RhdGFIb2xkZXIoRGF0YUNhY2hlUENEYXRhIHBj\nZGF0YSwKICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewog\nICAgICAgICAgICB0aGlzLnBjZGF0YSA9IHBjZGF0YTsKICAgICAgICAgICAg\ndGhpcy5zbSA9IHNtOwoJCX0KCX0KfQoK\n","encoding":"base64"}

