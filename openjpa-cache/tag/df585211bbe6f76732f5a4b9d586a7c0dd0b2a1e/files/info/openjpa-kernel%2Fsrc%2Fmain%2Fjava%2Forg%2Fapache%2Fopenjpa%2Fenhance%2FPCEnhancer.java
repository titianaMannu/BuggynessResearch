{"sha":"a194aa3c65c7b1326483cd63c70db8135e8c4bd5","node_id":"MDQ6QmxvYjIwNjM2NDphMTk0YWEzYzY1YzdiMTMyNjQ4M2NkNjNjNzBkYjgxMzVlOGM0YmQ1","size":179890,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a194aa3c65c7b1326483cd63c70db8135e8c4bd5","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5s\nYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNv\nbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuQ2xhc3NBcmdQYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQnl0ZWNvZGVXcml0\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuRmlsZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZI\nZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLk9w\ndGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuU2Vy\ndmljZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJpZ0RlY2ltYWxJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJpZ0ludGVnZXJJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJ5dGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkNoYXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkRhdGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkRvdWJsZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRJZDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlNob3J0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5TdHJpbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFz\nczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNGaWVsZDsKaW1wb3J0IHNlcnAu\nYnl0ZWNvZGUuQkNNZXRob2Q7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvZGU7\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvbnN0YW50czsKaW1wb3J0IHNlcnAu\nYnl0ZWNvZGUuRXhjZXB0aW9uczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuRmll\nbGRJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuR2V0RmllbGRJ\nbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSWZJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSW5zdHJ1Y3Rpb247CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLkp1bXBJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0\nZWNvZGUuTG9hZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5N\nZXRob2RJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuUHJvamVj\ndDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuVGFibGVTd2l0Y2hJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQ2xhc3NJbnN0cnVjdGlvbjsKaW1w\nb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2VycC51dGlsLlN0cmlu\nZ3M7CgovKioKICogQnl0ZWNvZGUgZW5oYW5jZXIgdXNlZCB0byBlbmhhbmNl\nIHBlcnNpc3RlbnQgY2xhc3NlcyBmcm9tIG1ldGFkYXRhLiBUaGUKICogZW5o\nYW5jZXIgbXVzdCBiZSBpbnZva2VkIG9uIGFsbCBwZXJzaXN0ZW5jZS1jYXBh\nYmxlIGFuZCBwZXJzaXN0ZW5jZSBhd2FyZQogKiBjbGFzc2VzLgogKgogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFBDRW5oYW5jZXIg\newogICAgLy8gRGVzaWduYXRlcyBhIHZlcnNpb24gZm9yIG1haW50YWluaW5n\nIGNvbXBhdGJpbGl0eSB3aGVuIFBDRW5oYW5jZXIKICAgIC8vIG1vZGlmaWVz\nIGVuaGFuY2VtZW50IHRoYXQgY2FuIGJyZWFrIHNlcmlhbGl6YXRpb24gb3Ig\nb3RoZXIgY29udHJhY3RzCiAgICAvLyBFYWNoIGVuaGFuY2VkIGNsYXNzIHdp\nbGwgcmV0dXJuIHRoZSB2YWx1ZSBvZiB0aGlzIGZpZWxkIHZpYQogICAgLy8g\ncHVibGljIGludCBnZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbigpCiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFUl9WRVJTSU9OID0g\nMjsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX05PTkUg\nPSAwOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRU5IQU5DRV9BV0FS\nRSA9IDIgPDwgMDsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFO\nQ0VfSU5URVJGQUNFID0gMiA8PCAxOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgRU5IQU5DRV9QQyA9IDIgPDwgMjsKCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBQUkUgPSAicGMiOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBTdHJpbmcgSVNERVRBQ0hFRFNUQVRFREVGSU5JVElWRSA9IFBSRSAK\nICAgICAgICArICJpc0RldGFjaGVkU3RhdGVEZWZpbml0aXZlIjsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBQQ1RZUEUgPSBQZXJzaXN0ZW5j\nZUNhcGFibGUuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgU00gPSBQUkUgKyAiU3RhdGVNYW5hZ2VyIjsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIENsYXNzIFNNVFlQRSA9IFN0YXRlTWFuYWdlci5jbGFzczsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBJTkhFUklUID0gUFJF\nICsgIkluaGVyaXRlZEZpZWxkQ291bnQiOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIENPTlRFWFROQU1FID0gIkdlbmVyaWNDb250ZXh0IjsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIFVTRVJFWENFUCA9IFVz\nZXJFeGNlcHRpb24uY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBD\nbGFzcyBJTlRFUk5FWENFUCA9IEludGVybmFsRXhjZXB0aW9uLmNsYXNzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgSEVMUEVSVFlQRSA9IFBD\nUmVnaXN0cnkuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgU1VQRVIgPSBQUkUgKyAiUENTdXBlcmNsYXNzIjsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIENsYXNzIE9JREZTVFlQRSA9IEZpZWxkU3VwcGxpZXIu\nY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBPSURGQ1RZ\nUEUgPSBGaWVsZENvbnN1bWVyLmNsYXNzOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoUENFbmhhbmNlci5jbGFzcyk7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgUkVERUZJTkVEX0FUVFJJQlVURQogICAgICAgID0g\nUENFbmhhbmNlci5jbGFzcy5nZXROYW1lKCkgKyAiI3JlZGVmaW5lZC10eXBl\nIjsKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQXV4aWxpYXJ5RW5o\nYW5jZXJbXSBfYXV4RW5oYW5jZXJzOwogICAgc3RhdGljIHsKICAgICAgICBD\nbGFzc1tdIGNsYXNzZXMgPSBTZXJ2aWNlcy5nZXRJbXBsZW1lbnRvckNsYXNz\nZXMoCiAgICAgICAgICAgIEF1eGlsaWFyeUVuaGFuY2VyLmNsYXNzLAogICAg\nICAgICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xh\nc3NMb2FkZXJBY3Rpb24oQXV4aWxpYXJ5RW5oYW5jZXIuY2xhc3MpKSk7CiAg\nICAgICAgTGlzdCBhdXhFbmhhbmNlcnMgPSBuZXcgQXJyYXlMaXN0KGNsYXNz\nZXMubGVuZ3RoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNsYXNz\nZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGF1eEVuaGFuY2Vycy5hZGQoQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nbmV3SW5zdGFuY2VBY3Rpb24oY2xhc3Nlc1tpXSkpKTsKCQkgICAgfSBjYXRj\naCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIGF1eCBlbmhh\nbmNlciBtYXkgcmVseSBvbiBub24tZXhpc3RhbnQgc3BlYyBjbGFzc2VzLCBl\ndGMKCQkgICAgfQoJCX0KICAgIAlfYXV4RW5oYW5jZXJzID0gKEF1eGlsaWFy\neUVuaGFuY2VyW10pIGF1eEVuaGFuY2Vycy50b0FycmF5CiAgICAgICAgICAg\nIChuZXcgQXV4aWxpYXJ5RW5oYW5jZXJbYXV4RW5oYW5jZXJzLnNpemUoKV0p\nOwogICAgfQoKICAgIHByaXZhdGUgQkNDbGFzcyBfcGM7CiAgICBwcml2YXRl\nIGZpbmFsIEJDQ2xhc3MgX21hbmFnZWRUeXBlOwogICAgcHJpdmF0ZSBmaW5h\nbCBNZXRhRGF0YVJlcG9zaXRvcnkgX3JlcG9zOwogICAgcHJpdmF0ZSBmaW5h\nbCBDbGFzc01ldGFEYXRhIF9tZXRhOwogICAgcHJpdmF0ZSBmaW5hbCBMb2cg\nX2xvZzsKICAgIHByaXZhdGUgQ29sbGVjdGlvbiBfb2lkcyA9IG51bGw7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2RlZkNvbnMgPSB0cnVlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9yZWRlZmluZSA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9zdWJjbGFzcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9m\nYWlsID0gZmFsc2U7CiAgICBwcml2YXRlIFNldCBfdmlvbGF0aW9ucyA9IG51\nbGw7CiAgICBwcml2YXRlIEZpbGUgX2RpciA9IG51bGw7CiAgICBwcml2YXRl\nIEJ5dGVjb2RlV3JpdGVyIF93cml0ZXIgPSBudWxsOwogICAgcHJpdmF0ZSBN\nYXAgX2JhY2tpbmdGaWVsZHMgPSBudWxsOyAvLyBtYXAgb2Ygc2V0IC8gZ2V0\nIG5hbWVzID0+IGZpZWxkIG5hbWVzCiAgICBwcml2YXRlIE1hcCBfYXR0cnNU\nb0ZpZWxkcyA9IG51bGw7IC8vIG1hcCBvZiBhdHRyIG5hbWVzID0+IGZpZWxk\nIG5hbWVzCiAgICBwcml2YXRlIE1hcCBfZmllbGRzVG9BdHRycyA9IG51bGw7\nIC8vIG1hcCBvZiBmaWVsZCBuYW1lcyA9PiBhdHRyIG5hbWVzCiAgICBwcml2\nYXRlIGJvb2xlYW4gX2lzQWxyZWFkeVJlZGVmaW5lZCA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9pc0FscmVhZHlTdWJjbGFzc2VkID0gZmFsc2U7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2Jjc0NvbmZpZ3VyZWQgPSBmYWxzZTsK\nCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJh\ndGlvbiBhbmQgdHlwZSB0byBlbmhhbmNlLiBUaGlzIHdpbGwgbG9vawogICAg\nICogdXAgdGhlIG1ldGFkYXRhIGZvciA8Y29kZT50eXBlPC9jb2RlPiBmcm9t\nIDxjb2RlPmNvbmY8L2NvZGU+J3MKICAgICAqIHJlcG9zaXRvcnkuCiAgICAg\nKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9u\nIGNvbmYsIENsYXNzIHR5cGUpIHsKICAgICAgICB0aGlzKGNvbmYsIChCQ0Ns\nYXNzKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhl\nbHBlcgogICAgICAgICAgICAubG9hZFByb2plY3RDbGFzc0FjdGlvbihuZXcg\nUHJvamVjdCgpLCB0eXBlKSksCiAgICAgICAgICAgIChNZXRhRGF0YVJlcG9z\naXRvcnkpIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0\nb3IuIFN1cHBseSBjb25maWd1cmF0aW9uIGFuZCB0eXBlIHRvIGVuaGFuY2Uu\nIFRoaXMgd2lsbCBsb29rCiAgICAgKiB1cCB0aGUgbWV0YWRhdGEgZm9yIDxj\nb2RlPm1ldGE8L2NvZGU+IGJ5IGNvbnZlcnRpbmcgYmFjayB0byBhIGNsYXNz\nCiAgICAgKiBhbmQgdGhlbiBsb2FkaW5nIGZyb20gPGNvZGU+Y29uZjwvY29k\nZT4ncyByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgUENFbmhhbmNl\ncihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBDbGFzc01ldGFEYXRhIG1l\ndGEpIHsKICAgICAgICB0aGlzKGNvbmYsIChCQ0NsYXNzKSBBY2Nlc3NDb250\ncm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAg\nICAubG9hZFByb2plY3RDbGFzc0FjdGlvbihuZXcgUHJvamVjdCgpLCBtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSkpLAogICAgICAgICAgICBtZXRhLmdldFJl\ncG9zaXRvcnkoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rv\nci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24uCiAgICAgKgogICAgICogQHBhcmFt\nIHR5cGUgdGhlIGJ5dGVjb2RlIHJlcHJlc2VudGF0aW9uIGZvIHRoZSB0eXBl\nIHRvCiAgICAgKiBlbmhhbmNlOyB0aGlzIGNhbiBiZSBjcmVhdGVkIGZyb20g\nYW55IHN0cmVhbSBvciBmaWxlCiAgICAgKiBAcGFyYW0gcmVwb3MgYSBtZXRh\nZGF0YSByZXBvc2l0b3J5IHRvIHVzZSBmb3IgbWV0YWRhdGEgYWNjZXNzLAog\nICAgICogb3IgbnVsbCB0byBjcmVhdGUgYSBuZXcgcmVwb3JpdG9yeTsgdGhl\nIHJlcG9zaXRvcnkKICAgICAqIGZyb20gdGhlIGdpdmVuIGNvbmZpZ3VyYXRp\nb24gaXNuJ3QgdXNlZCBieSBkZWZhdWx0CiAgICAgKiBiZWNhdXNlIHRoZSBj\nb25maWd1cmF0aW9uIG1pZ2h0IGJlIGFuCiAgICAgKiBpbXBsZW1lbnRhdGlv\nbi1zcGVjaWZpYyBzdWJjbGFzcyB3aG9zZSBtZXRhZGF0YQogICAgICogcmVx\ndWlyZWQgbW9yZSB0aGFuIGp1c3QgYmFzZSBtZXRhZGF0YSBmaWxlcwogICAg\nICogQGRlcHJlY2F0ZWQgdXNlIHtAbGluayAjUENFbmhhbmNlcihPcGVuSlBB\nQ29uZmlndXJhdGlvbiwgQkNDbGFzcywKICAgICAgICBNZXRhRGF0YVJlcG9z\naXRvcnksIENsYXNzTG9hZGVyKX0gaW5zdGVhZC4gCiAgICAgKi8KICAgIHB1\nYmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIEJD\nQ2xhc3MgdHlwZSwKICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3Mp\nIHsKICAgICAgICB0aGlzKGNvbmYsIHR5cGUsIHJlcG9zLCBudWxsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmln\ndXJhdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gdHlwZSB0aGUgYnl0ZWNv\nZGUgcmVwcmVzZW50YXRpb24gZm8gdGhlIHR5cGUgdG8KICAgICAqIGVuaGFu\nY2U7IHRoaXMgY2FuIGJlIGNyZWF0ZWQgZnJvbSBhbnkgc3RyZWFtIG9yIGZp\nbGUKICAgICAqIEBwYXJhbSByZXBvcyBhIG1ldGFkYXRhIHJlcG9zaXRvcnkg\ndG8gdXNlIGZvciBtZXRhZGF0YSBhY2Nlc3MsCiAgICAgKiBvciBudWxsIHRv\nIGNyZWF0ZSBhIG5ldyByZXBvcml0b3J5OyB0aGUgcmVwb3NpdG9yeQogICAg\nICogZnJvbSB0aGUgZ2l2ZW4gY29uZmlndXJhdGlvbiBpc24ndCB1c2VkIGJ5\nIGRlZmF1bHQKICAgICAqIGJlY2F1c2UgdGhlIGNvbmZpZ3VyYXRpb24gbWln\naHQgYmUgYW4KICAgICAqIGltcGxlbWVudGF0aW9uLXNwZWNpZmljIHN1YmNs\nYXNzIHdob3NlIG1ldGFkYXRhCiAgICAgKiByZXF1aXJlZCBtb3JlIHRoYW4g\nanVzdCBiYXNlIG1ldGFkYXRhIGZpbGVzCiAgICAgKiBAcGFyYW0gbG9hZGVy\nIHRoZSBlbnZpcm9ubWVudCBjbGFzc2xvYWRlciB0byB1c2UgZm9yIGxvYWRp\nbmcKICAgICAqIGNsYXNzZXMgYW5kIHJlc291cmNlcy4KICAgICAqLwogICAg\ncHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwg\nQkNDbGFzcyB0eXBlLAogICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBv\ncywgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAgX21hbmFnZWRUeXBl\nID0gdHlwZTsKICAgICAgICBfcGMgPSB0eXBlOwoKICAgICAgICBfbG9nID0g\nY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0Up\nOwoKICAgICAgICBpZiAocmVwb3MgPT0gbnVsbCkgewogICAgICAgICAgICBf\ncmVwb3MgPSBjb25mLm5ld01ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7\nCiAgICAgICAgICAgIF9yZXBvcy5zZXRTb3VyY2VNb2RlKE1ldGFEYXRhUmVw\nb3NpdG9yeS5NT0RFX01FVEEpOwogICAgICAgIH0gZWxzZQogICAgICAgICAg\nICBfcmVwb3MgPSByZXBvczsKICAgICAgICBfbWV0YSA9IF9yZXBvcy5nZXRN\nZXRhRGF0YSh0eXBlLmdldFR5cGUoKSwgbG9hZGVyLCBmYWxzZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IHJlcG9zaXRv\ncnkuIFRoZSByZXBvc2l0b3J5J3MgY29uZmlndXJhdGlvbiB3aWxsCiAgICAg\nKiBiZSB1c2VkLCBhbmQgdGhlIG1ldGFkYXRhIHBhc3NlZCBpbiB3aWxsIGJl\nIHVzZWQgYXMtaXMgd2l0aG91dCBkb2luZwogICAgICogYW55IGFkZGl0aW9u\nYWwgbG9va3Vwcy4gVGhpcyBpcyB1c2VmdWwgd2hlbiBydW5uaW5nIHRoZSBl\nbmhhbmNlcgogICAgICogZHVyaW5nIG1ldGFkYXRhIGxvYWQuCiAgICAgKgog\nICAgICogQHBhcmFtIHJlcG9zIGEgbWV0YWRhdGEgcmVwb3NpdG9yeSB0byB1\nc2UgZm9yIG1ldGFkYXRhIGFjY2VzcywKICAgICAqIG9yIG51bGwgdG8gY3Jl\nYXRlIGEgbmV3IHJlcG9yaXRvcnk7IHRoZSByZXBvc2l0b3J5CiAgICAgKiBm\ncm9tIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGlzbid0IHVzZWQgYnkgZGVm\nYXVsdAogICAgICogYmVjYXVzZSB0aGUgY29uZmlndXJhdGlvbiBtaWdodCBi\nZSBhbgogICAgICogaW1wbGVtZW50YXRpb24tc3BlY2lmaWMgc3ViY2xhc3Mg\nd2hvc2UgbWV0YWRhdGEKICAgICAqIHJlcXVpcmVkIG1vcmUgdGhhbiBqdXN0\nIGJhc2UgbWV0YWRhdGEgZmlsZXMKICAgICAqIEBwYXJhbSB0eXBlIHRoZSBi\neXRlY29kZSByZXByZXNlbnRhdGlvbiBmbyB0aGUgdHlwZSB0bwogICAgICog\nZW5oYW5jZTsgdGhpcyBjYW4gYmUgY3JlYXRlZCBmcm9tIGFueSBzdHJlYW0g\nb3IgZmlsZQogICAgICogQHBhcmFtIG1ldGEgdGhlIG1ldGFkYXRhIHRvIHVz\nZSBmb3IgcHJvY2Vzc2luZyB0aGlzIHR5cGUuCiAgICAgKgogICAgICogQHNp\nbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE1ldGFE\nYXRhUmVwb3NpdG9yeSByZXBvcywgQkNDbGFzcyB0eXBlLAogICAgICAgIENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIF9tYW5hZ2VkVHlwZSA9IHR5\ncGU7CiAgICAgICAgX3BjID0gdHlwZTsKCiAgICAgICAgX2xvZyA9IHJlcG9z\nLmdldENvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuZ2V0TG9nKE9wZW5K\nUEFDb25maWd1cmF0aW9uLkxPR19FTkhBTkNFKTsKCiAgICAgICAgX3JlcG9z\nID0gcmVwb3M7CiAgICAgICAgX21ldGEgPSBtZXRhOwogICAgfQoKICAgIHN0\nYXRpYyBTdHJpbmcgdG9QQ1N1YmNsYXNzTmFtZShDbGFzcyBjbHMpIHsKICAg\nICAgICByZXR1cm4gU3RyaW5ncy5nZXRQYWNrYWdlTmFtZShQQ0VuaGFuY2Vy\nLmNsYXNzKSArICIuIgogICAgICAgICAgICArIGNscy5nZXROYW1lKCkucmVw\nbGFjZSgnLicsICckJykgKyAiJHBjc3ViY2xhc3MiOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciBvciBub3QgPGNvZGU+Y2xhc3NOYW1lPC9jb2Rl\nPiBpcyB0aGUgbmFtZSBmb3IgYQogICAgICogZHluYW1pY2FsbHktY3JlYXRl\nZCBwZXJzaXN0ZW5jZS1jYXBhYmxlIHN1YmNsYXNzLgogICAgICoKICAgICAq\nIEBzaW5jZSAxLjEuMAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xl\nYW4gaXNQQ1N1YmNsYXNzTmFtZShTdHJpbmcgY2xhc3NOYW1lKSB7CiAgICAg\nICAgcmV0dXJuIGNsYXNzTmFtZS5zdGFydHNXaXRoKFN0cmluZ3MuZ2V0UGFj\na2FnZU5hbWUoUENFbmhhbmNlci5jbGFzcykpCiAgICAgICAgICAgICYmIGNs\nYXNzTmFtZS5lbmRzV2l0aCgiJHBjc3ViY2xhc3MiKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIElmIDxjb2RlPmNsYXNzTmFtZTwvY29kZT4gaXMgYSBkeW5h\nbWljYWxseS1jcmVhdGVkIHBlcnNpc3RlbmNlLWNhcGFibGUKICAgICAqIHN1\nYmNsYXNzIG5hbWUsIHJldHVybnMgdGhlIG5hbWUgb2YgdGhlIGNsYXNzIHRo\nYXQgaXQgc3ViY2xhc3Nlcy4KICAgICAqIE90aGVyd2lzZSwgcmV0dXJucyA8\nY29kZT5jbGFzc05hbWU8L2NvZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAx\nLjEuMAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyB0b01hbmFn\nZWRUeXBlTmFtZShTdHJpbmcgY2xhc3NOYW1lKSB7CiAgICAgICAgaWYgKGlz\nUENTdWJjbGFzc05hbWUoY2xhc3NOYW1lKSkgewogICAgICAgICAgICBjbGFz\nc05hbWUgPSBjbGFzc05hbWUuc3Vic3RyaW5nKAogICAgICAgICAgICAgICAg\nU3RyaW5ncy5nZXRQYWNrYWdlTmFtZShQQ0VuaGFuY2VyLmNsYXNzKS5sZW5n\ndGgoKSArIDEpOwogICAgICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUu\nc3Vic3RyaW5nKDAsIGNsYXNzTmFtZS5sYXN0SW5kZXhPZigiJCIpKTsKICAg\nICAgICAgICAgLy8gdGhpcyBpcyBub3QgY29ycmVjdCBmb3IgbmVzdGVkIFBD\ncwogICAgICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUucmVwbGFjZSgn\nJCcsICcuJyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBj\nbGFzc05hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4g\nU3VwcGx5IGNvbmZpZ3VyYXRpb24sIHR5cGUsIGFuZCBtZXRhZGF0YS4KICAg\nICAqLwogICAgcHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRp\nb24gY29uZiwgQkNDbGFzcyB0eXBlLAogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIHRoaXMoY29uZiwgdHlwZSwgbWV0YS5nZXRSZXBv\nc2l0b3J5KCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBi\neXRlY29kZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgcGVyc2lzdGVuY2UtY2Fw\nYWJsZSBjbGFzcwogICAgICogYmVpbmcgbWFuaXB1bGF0ZWQuCiAgICAgKi8K\nICAgIHB1YmxpYyBCQ0NsYXNzIGdldFBDQnl0ZWNvZGUoKSB7CiAgICAgICAg\ncmV0dXJuIF9wYzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hbmFnZWQgY2xhc3Mg\nYmVpbmcKICAgICAqIG1hbmlwdWxhdGVkLiBUaGlzIGlzIHVzdWFsbHkgdGhl\nIHNhbWUgYXMge0BsaW5rICNnZXRQQ0J5dGVjb2RlfSwKICAgICAqIGV4Y2Vw\ndCB3aGVuIHJ1bm5pbmcgdGhlIGVuaGFuY2VyIHRvIHJlZGVmaW5lIGFuZCBz\ndWJjbGFzcwogICAgICogZXhpc3RpbmcgcGVyc2lzdGVudCB0eXBlcy4KICAg\nICAqLwogICAgcHVibGljIEJDQ2xhc3MgZ2V0TWFuYWdlZFR5cGVCeXRlY29k\nZSgpIHsKICAgICAgICByZXR1cm4gX21hbmFnZWRUeXBlOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIGNsYXNz\nIGJlaW5nIG1hbmlwdWxhdGVkLCBvciBudWxsIGlmIG5vdAogICAgICogYSBw\nZXJzaXN0ZW50IHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFE\nYXRhIGdldE1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBfbWV0YTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRo\nZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBhZGQgYSBuby1hcmdzCiAgICAgKiBj\nb25zdHJ1Y3RvciBpZiBvbmUgaXMgbm90IGFscmVhZHkgcHJlc2VudCBpbiB0\naGUgY2xhc3MuIE9wZW5KUEEKICAgICAqIHJlcXVpcmVzIHRoYXQgYSBuby1h\ncmcgY29uc3RydWN0b3IgKHdoZXRoZXIgY3JlYXRlZCBieSB0aGUgY29tcGls\nZXIKICAgICAqIG9yIGJ5IHRoZSB1c2VyKSBiZSBwcmVzZW50IGluIGEgUEMu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEFkZERlZmF1bHRDb25z\ndHJ1Y3RvcigpIHsKICAgICAgICByZXR1cm4gX2RlZkNvbnM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRo\nZSBlbmhhbmNlciBzaG91bGQgYWRkIGEgbm8tYXJncwogICAgICogY29uc3Ry\ndWN0b3IgaWYgb25lIGlzIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNs\nYXNzLiBPcGVuSlBBCiAgICAgKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNv\nbnN0cnVjdG9yICh3aGV0aGVyIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAg\nICAgKiBvciBieSB0aGUgdXNlcikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRBZGREZWZhdWx0Q29uc3RydWN0b3Io\nYm9vbGVhbiBhZGREZWZhdWx0Q29uc3RydWN0b3IpIHsKICAgICAgICBfZGVm\nQ29ucyA9IGFkZERlZmF1bHRDb25zdHJ1Y3RvcjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBtdXRhdGUgaXRz\nIGFyZ3VtZW50cywgb3IganVzdCBydW4gdmFsaWRhdGlvbgogICAgICogYW5k\nIG9wdGlvbmFsIHN1YmNsYXNzaW5nIGxvZ2ljIG9uIHRoZW0uIFVzdWFsbHkg\ndXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoCiAgICAgKiA8Y29kZT5zZXRDcmVh\ndGVTdWJjbGFzcyh0cnVlKTwvY29kZT4uCiAgICAgKgogICAgICogQHNpbmNl\nIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFJlZGVmaW5l\nKCkgewogICAgICAgIHJldHVybiBfcmVkZWZpbmU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRoZSBlbmhhbmNlciBzaG91bGQgbXV0YXRlIGl0\ncyBhcmd1bWVudHMsIG9yIGp1c3QgcnVuIHZhbGlkYXRpb24KICAgICAqIGFu\nZCBvcHRpb25hbCBzdWJjbGFzc2luZyBsb2dpYyBvbiB0aGVtLiBVc3VhbGx5\nIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aAogICAgICogPGNvZGU+c2V0Q3Jl\nYXRlU3ViY2xhc3ModHJ1ZSk8L2NvZGU+LgogICAgICoKICAgICAqIEBzaW5j\nZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZWRlZmluZShi\nb29sZWFuIHJlZGVmaW5lKSB7CiAgICAgICAgX3JlZGVmaW5lID0gcmVkZWZp\nbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHRo\nYXQgdGhpcyBpbnN0YW5jZSBpcyBlbmhhbmNpbmcgaGFzIGFscmVhZHkgYmVl\nbgogICAgICogcmVkZWZpbmVkLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAu\nMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FscmVhZHlSZWRlZmlu\nZWQoKSB7CiAgICAgICAgcmV0dXJuIF9pc0FscmVhZHlSZWRlZmluZWQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHRoYXQgdGhp\ncyBpbnN0YW5jZSBpcyBlbmhhbmNpbmcgaGFzIGFscmVhZHkgYmVlbgogICAg\nICogc3ViY2xhc3NlZCBpbiB0aGlzIGluc3RhbmNlJ3MgZW52aXJvbm1lbnQg\nY2xhc3Nsb2FkZXIuCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQWxyZWFkeVN1YmNsYXNzZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9pc0FscmVhZHlTdWJjbGFzc2VkOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIG1h\na2UgaXRzIGFyZ3VtZW50cyBwZXJzaXN0ZW5jZS1jYXBhYmxlLAogICAgICog\nb3IgZ2VuZXJhdGUgYSBwZXJzaXN0ZW5jZS1jYXBhYmxlIHN1YmNsYXNzLgog\nICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRDcmVhdGVTdWJjbGFzcygpIHsKICAgICAgICByZXR1cm4g\nX3N1YmNsYXNzOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUg\nZW5oYW5jZXIgc2hvdWxkIG1ha2UgaXRzIGFyZ3VtZW50cyBwZXJzaXN0ZW5j\nZS1jYXBhYmxlLAogICAgICogb3IgZ2VuZXJhdGUgYSBwZXJzaXN0ZW5jZS1j\nYXBhYmxlIHN1YmNsYXNzLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDcmVhdGVTdWJjbGFzcyhib29s\nZWFuIHN1YmNsYXNzKSB7CiAgICAgICAgX3N1YmNsYXNzID0gc3ViY2xhc3M7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZhaWwgaWYgdGhl\nIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFjY2VzcyBhbmQKICAg\nICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQgaXQgbWF5IGJlIHZp\nb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAqIGFjY2VzcyByZXN0\ncmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEVuZm9y\nY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucygpIHsKICAgICAgICByZXR1cm4gX2Zh\naWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZhaWwgaWYg\ndGhlIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFjY2VzcyBhbmQK\nICAgICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQgaXQgbWF5IGJl\nIHZpb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAqIGFjY2VzcyBy\nZXN0cmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVuZm9y\nY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyhib29sZWFuIGZhaWwpIHsKICAgICAg\nICBfZmFpbCA9IGZhaWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYmFz\nZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0by4gVGhlIHBy\nb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBiZSBjcmVhdGVk\nIGJlbmVhdGggdGhpcyBkaXJlY3RvcnkuIERlZmF1bHRzIHRvCiAgICAgKiBv\ndmVyd3JpdGluZyB0aGUgZXhpc3RpbmcgY2xhc3MgZmlsZSBpZiBudWxsLgog\nICAgICovCiAgICBwdWJsaWMgRmlsZSBnZXREaXJlY3RvcnkoKSB7CiAgICAg\nICAgcmV0dXJuIF9kaXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYmFz\nZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0by4gVGhlIHBy\nb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBiZSBjcmVhZWQg\nYmVuZWF0aCB0aGlzIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8KICAgICAqIG92\nZXJ3cml0aW5nIHRoZSBleGlzdGluZyBjbGFzcyBmaWxlIGlmIG51bGwuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERpcmVjdG9yeShGaWxlIGRpcikg\newogICAgICAgIF9kaXIgPSBkaXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGN1cnJlbnQge0BsaW5rIEJ5dGVjb2RlV3JpdGVyfSB0byB3\ncml0ZSB0byBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBC\neXRlY29kZVdyaXRlciBnZXRCeXRlY29kZVdyaXRlcigpIHsKICAgICAgICBy\nZXR1cm4gX3dyaXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\ne0BsaW5rIEJ5dGVjb2RlV3JpdGVyfSB0byB3cml0ZSB0aGUgYnl0ZWNvZGUg\ndG8gb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRCeXRlY29kZVdyaXRlcihCeXRlY29kZVdyaXRlciB3cml0ZXIpIHsKICAg\nICAgICBfd3JpdGVyID0gd3JpdGVyOwogICAgfQoKICAgIC8qKgogICAgICog\nUGVyZm9ybSBieXRlY29kZSBlbmhhbmNlbWVudHMuCiAgICAgKgogICAgICog\nQHJldHVybiA8Y29kZT5FTkhBTkNFXyo8L2NvZGU+IGNvbnN0YW50CiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgcnVuKCkgewogICAgICAgIGlmIChfbG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoImVuaGFuY2Utc3RhcnQiLCBfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpKSk7\nCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIG1hbmFnZWQgaW50\nZXJmYWNlLCBza2lwCiAgICAgICAgICAgIGlmIChfcGMuaXNJbnRlcmZhY2Uo\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBFTkhBTkNFX0lOVEVSRkFDRTsK\nCiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGFscmVhZHkgZW5oYW5jZWQKICAg\nICAgICAgICAgQ2xhc3NbXSBpbnRlcmZhY2VzID0gX21hbmFnZWRUeXBlLmdl\ndERlY2xhcmVkSW50ZXJmYWNlVHlwZXMoKTsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBpbnRlcmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBpZiAoaW50ZXJmYWNlc1tpXS5nZXROYW1lKCkuZXF1YWxz\nKFBDVFlQRS5nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgX2xvZy50cmFjZShfbG9jLmdldCgicGMtdHlwZSIsIF9tYW5hZ2VkVHlw\nZS5nZXRUeXBlKCkpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRU5I\nQU5DRV9OT05FOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBjb25maWd1cmVCQ3MoKTsKCiAgICAgICAgICAgIC8vIHZh\nbGlkYXRlIHByb3BlcnRpZXMgYmVmb3JlIHJlcGxhY2luZyBmaWVsZCBhY2Nl\nc3Mgc28gdGhhdAogICAgICAgICAgICAvLyB3ZSBidWlsZCB1cCBhIHJlY29y\nZCBvZiBiYWNraW5nIGZpZWxkcywgZXRjCiAgICAgICAgICAgIGlmIChfbWV0\nYSAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiBfbWV0YS5nZXRBY2Nlc3NU\neXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVSVFkpIHsKICAg\nICAgICAgICAgICAgIHZhbGlkYXRlUHJvcGVydGllcygpOwogICAgICAgICAg\nICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpCiAgICAgICAgICAgICAg\nICAgICAgYWRkQXR0cmlidXRlVHJhbnNsYXRpb24oKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vzcygp\nOwogICAgICAgICAgICBwcm9jZXNzVmlvbGF0aW9ucygpOwoKICAgICAgICAg\nICAgaWYgKF9tZXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGVuaGFu\nY2VDbGFzcygpOwogICAgICAgICAgICAgICAgYWRkRmllbGRzKCk7CiAgICAg\nICAgICAgICAgICBhZGRTdGF0aWNJbml0aWFsaXplcigpOwogICAgICAgICAg\nICAgICAgYWRkUENNZXRob2RzKCk7CiAgICAgICAgICAgICAgICBhZGRBY2Nl\nc3NvcnMoKTsKICAgICAgICAgICAgICAgIGFkZEF0dGFjaERldGFjaENvZGUo\nKTsKICAgICAgICAgICAgICAgIGFkZFNlcmlhbGl6YXRpb25Db2RlKCk7CiAg\nICAgICAgICAgICAgICBhZGRDbG9uaW5nQ29kZSgpOwogICAgICAgICAgICAg\nICAgcnVuQXV4aWxpYXJ5RW5oYW5jZXJzKCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gRU5IQU5DRV9QQzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJwZXJzLWF3YXJlIiwgX21hbmFnZWRUeXBlLmdl\ndFR5cGUoKSkpOwogICAgICAgICAgICByZXR1cm4gRU5IQU5DRV9BV0FSRTsK\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJlbmhhbmNlLWVycm9yIiwKICAgICAgICAgICAgICAgIF9tYW5h\nZ2VkVHlwZS5nZXRUeXBlKCkuZ2V0TmFtZSgpLCBlLmdldE1lc3NhZ2UoKSks\nIGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgY29uZmln\ndXJlQkNzKCkgewogICAgICAgIGlmICghX2Jjc0NvbmZpZ3VyZWQpIHsKICAg\nICAgICAgICAgaWYgKGdldFJlZGVmaW5lKCkpIHsKICAgICAgICAgICAgICAg\nIGlmIChfbWFuYWdlZFR5cGUuZ2V0QXR0cmlidXRlKFJFREVGSU5FRF9BVFRS\nSUJVVEUpID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX21hbmFnZWRU\neXBlLmFkZEF0dHJpYnV0ZShSRURFRklORURfQVRUUklCVVRFKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBfaXNBbHJlYWR5\nUmVkZWZpbmVkID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgICAgIFBD\nU3ViY2xhc3NWYWxpZGF0b3IgdmFsID0gbmV3IFBDU3ViY2xhc3NWYWxpZGF0\nb3IoCiAgICAgICAgICAgICAgICAgICAgX21ldGEsIF9tYW5hZ2VkVHlwZSwg\nX2xvZywgX2ZhaWwpOwogICAgICAgICAgICAgICAgdmFsLmFzc2VydENhblN1\nYmNsYXNzKCk7CgogICAgICAgICAgICAgICAgX3BjID0gX21hbmFnZWRUeXBl\nLmdldFByb2plY3QoKS5sb2FkQ2xhc3MoCiAgICAgICAgICAgICAgICAgICAg\ndG9QQ1N1YmNsYXNzTmFtZShfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpKSk7CiAg\nICAgICAgICAgICAgICBpZiAoX3BjLmdldFN1cGVyY2xhc3NCQygpICE9IF9t\nYW5hZ2VkVHlwZSkgewogICAgICAgICAgICAgICAgICAgIF9wYy5zZXRTdXBl\ncmNsYXNzKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgX3Bj\nLnNldEFic3RyYWN0KF9tYW5hZ2VkVHlwZS5pc0Fic3RyYWN0KCkpOwogICAg\nICAgICAgICAgICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNlKER5bmFtaWNQ\nZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MpOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICBfaXNBbHJlYWR5U3ViY2xhc3Nl\nZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIF9iY3NDb25maWd1cmVkID0gdHJ1ZTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSB0aGUgZ2VuZXJhdGVkIGJ5dGVj\nb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWNvcmQoKQogICAgICAg\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9tYW5hZ2VkVHlw\nZSAhPSBfcGMgJiYgZ2V0UmVkZWZpbmUoKSkKICAgICAgICAgICAgcmVjb3Jk\nKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAgcmVjb3JkKF9wYyk7CiAgICAgICAg\naWYgKF9vaWRzICE9IG51bGwpCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gX29pZHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAg\nICAgICAgICAgICByZWNvcmQoKEJDQ2xhc3MpIGl0ci5uZXh0KCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIGdpdmVuIGNsYXNzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcmVjb3JkKEJDQ2xhc3MgYmMpCiAgICAg\nICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX3dyaXRlciAh\nPSBudWxsKQogICAgICAgICAgICBfd3JpdGVyLndyaXRlKGJjKTsKICAgICAg\nICBlbHNlIGlmIChfZGlyID09IG51bGwpCiAgICAgICAgICAgIGJjLndyaXRl\nKCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEZpbGUgZGlyID0gRmls\nZXMuZ2V0UGFja2FnZUZpbGUoX2RpciwgYmMuZ2V0UGFja2FnZU5hbWUoKSwg\ndHJ1ZSk7CiAgICAgICAgICAgIGJjLndyaXRlKG5ldyBGaWxlKGRpciwgYmMu\nZ2V0Q2xhc3NOYW1lKCkgKyAiLmNsYXNzIikpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHRoYXQgdGhlIG1ldGhvZHMgaW4g\ndGhpcyBwcm9wZXJ0eS1hY2Nlc3MgaW5zdGFuY2UgYXJlCiAgICAgKiB3cml0\ndGVuIGNvcnJlY3RseS4gVGhpcyBtZXRob2QgYWxzbyBnYXRoZXJzIGluZm9y\nbWF0aW9uIG9uIGVhY2gKICAgICAqIHByb3BlcnR5J3MgYmFja2luZyBmaWVs\nZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlUHJvcGVydGll\ncygpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kczsKICAgICAgICBp\nZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkKICAgICAgICAgICAgZm1kcyA9IF9t\nZXRhLmdldEZpZWxkcygpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZm1k\ncyA9IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgTWV0aG9k\nIG1ldGg7CiAgICAgICAgQkNNZXRob2QgZ2V0dGVyLCBzZXR0ZXI7CiAgICAg\nICAgQkNGaWVsZCByZXR1cm5lZCwgYXNzaWduZWQgPSBudWxsOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoIShmbWRzW2ldLmdldEJhY2tpbmdNZW1iZXIoKSBpbnN0\nYW5jZW9mIE1ldGhvZCkpIHsKICAgICAgICAgICAgICAgIGFkZFZpb2xhdGlv\nbigicHJvcGVydHktYmFkLW1lbWJlciIsCiAgICAgICAgICAgICAgICAgICAg\nbmV3IE9iamVjdFtdeyBmbWRzW2ldLCBmbWRzW2ldLmdldEJhY2tpbmdNZW1i\nZXIoKSB9LAogICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1l\ndGggPSAoTWV0aG9kKSBmbWRzW2ldLmdldEJhY2tpbmdNZW1iZXIoKTsKICAg\nICAgICAgICAgLy8gIyMjIyMgdGhpcyB3aWxsIGZhaWwgaWYgd2Ugb3ZlcnJp\nZGUgYW5kIGRvbid0IGNhbGwgc3VwZXIuCiAgICAgICAgICAgIEJDQ2xhc3Mg\nZGVjbGFyaW5nVHlwZSA9IF9tYW5hZ2VkVHlwZS5nZXRQcm9qZWN0KCkKICAg\nICAgICAgICAgICAgIC5sb2FkQ2xhc3MoZm1kc1tpXS5nZXREZWNsYXJpbmdU\neXBlKCkpOwogICAgICAgICAgICBnZXR0ZXIgPSBkZWNsYXJpbmdUeXBlLmdl\ndERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0TmFtZSgpLAogICAgICAgICAgICAg\nICAgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICAgICAgaWYg\nKGdldHRlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBhZGRWaW9sYXRp\nb24oInByb3BlcnR5LW5vLWdldHRlciIsIG5ldyBPYmplY3RbXXsgZm1kc1tp\nXSB9LAogICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nZWQgPSBnZXRSZXR1cm5lZEZpZWxkKGdldHRlcik7CiAgICAgICAgICAgIGlm\nIChyZXR1cm5lZCAhPSBudWxsKQogICAgICAgICAgICAgICAgcmVnaXN0ZXJC\nYWNraW5nRmllbGRJbmZvKGZtZHNbaV0sIGdldHRlciwgcmV0dXJuZWQpOwoK\nICAgICAgICAgICAgc2V0dGVyID0gZGVjbGFyaW5nVHlwZS5nZXREZWNsYXJl\nZE1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZHNbaV0pLAogICAgICAgICAgICAg\nICAgbmV3IENsYXNzW117IGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkgfSk7\nCiAgICAgICAgICAgIGlmIChzZXR0ZXIgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgaWYgKHJldHVybmVkID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LW5vLXNldHRlciIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgZm1kc1tpXSB9LCB0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoIWdldFJlZGVmaW5lKCkpIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBjcmVhdGUgc3ludGhldGljIHNldHRlcgogICAgICAg\nICAgICAgICAgICAgIHNldHRlciA9IF9tYW5hZ2VkVHlwZS5kZWNsYXJlTWV0\naG9kKGdldFNldHRlck5hbWUoZm1kc1tpXSksCiAgICAgICAgICAgICAgICAg\nICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBmbWRzW2ldLmdldERl\nY2xhcmVkVHlwZSgpIH0pOwogICAgICAgICAgICAgICAgICAgIHNldHRlci5t\nYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICAgICAgICAgIENvZGUgY29kZSA9\nIHNldHRlci5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS54bG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUucHV0ZmllbGQoKS5zZXRGaWVsZChyZXR1cm5lZCk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZXR0ZXIgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGFzc2lnbmVkID0gZ2V0QXNzaWduZWRGaWVs\nZChzZXR0ZXIpOwoKICAgICAgICAgICAgaWYgKGFzc2lnbmVkICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGlmIChzZXR0ZXIgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICByZWdpc3RlckJhY2tpbmdGaWVsZEluZm8oZm1kc1tp\nXSwgc2V0dGVyLCBhc3NpZ25lZCk7CgogICAgICAgICAgICAgICAgaWYgKGFz\nc2lnbmVkICE9IHJldHVybmVkKQogICAgICAgICAgICAgICAgICAgIGFkZFZp\nb2xhdGlvbigicHJvcGVydHktc2V0dGVyLWdldHRlci1taXNtYXRjaCIsIG5l\ndyBPYmplY3RbXQogICAgICAgICAgICAgICAgICAgICAgICB7IGZtZHNbaV0s\nIGFzc2lnbmVkLmdldE5hbWUoKSwgKHJldHVybmVkID09IG51bGwpIAogICAg\nICAgICAgICAgICAgICAgICAgICA/IG51bGwgOiByZXR1cm5lZC5nZXROYW1l\nKCkgfSwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIHByaXZhdGUgdm9pZCByZWdpc3RlckJhY2tpbmdGaWVsZEluZm8oRmll\nbGRNZXRhRGF0YSBmbWQsIEJDTWV0aG9kIG1ldGhvZCwKICAgICAgICBCQ0Zp\nZWxkIGZpZWxkKSB7CiAgICAgICAgaWYgKF9iYWNraW5nRmllbGRzID09IG51\nbGwpCiAgICAgICAgICAgIF9iYWNraW5nRmllbGRzID0gbmV3IEhhc2hNYXAo\nKTsKICAgICAgICBfYmFja2luZ0ZpZWxkcy5wdXQobWV0aG9kLmdldE5hbWUo\nKSwgZmllbGQuZ2V0TmFtZSgpKTsKCiAgICAgICAgaWYgKF9hdHRyc1RvRmll\nbGRzID09IG51bGwpCiAgICAgICAgICAgIF9hdHRyc1RvRmllbGRzID0gbmV3\nIEhhc2hNYXAoKTsKICAgICAgICBfYXR0cnNUb0ZpZWxkcy5wdXQoZm1kLmdl\ndE5hbWUoKSwgZmllbGQuZ2V0TmFtZSgpKTsKCiAgICAgICAgaWYgKF9maWVs\nZHNUb0F0dHJzID09IG51bGwpCiAgICAgICAgICAgIF9maWVsZHNUb0F0dHJz\nID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfZmllbGRzVG9BdHRycy5wdXQo\nZmllbGQuZ2V0TmFtZSgpLCBmbWQuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgYWRkQXR0cmlidXRlVHJhbnNsYXRpb24oKSB7CiAgICAg\nICAgX3BjLmRlY2xhcmVJbnRlcmZhY2UoQXR0cmlidXRlVHJhbnNsYXRvci5j\nbGFzcyk7CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVN\nZXRob2QoUFJFICsgIkF0dHJpYnV0ZUluZGV4VG9GaWVsZE5hbWUiLAogICAg\nICAgICAgICBTdHJpbmcuY2xhc3MsIG5ldyBDbGFzc1tdIHsgaW50LmNsYXNz\nIH0pOwogICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgQ29k\nZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CgogICAgICAg\nIC8vIHN3aXRjaCAodmFsKQogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICBUYWJsZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9\nIGNvZGUudGFibGVzd2l0Y2goKTsKICAgICAgICB0YWJpbnMuc2V0TG93KDAp\nOwogICAgICAgIHRhYmlucy5zZXRIaWdoKGZtZHMubGVuZ3RoIC0gMSk7Cgog\nICAgICAgIC8vIGNhc2UgaToKICAgICAgICAvLyAgICAgcmV0dXJuIDxfYXR0\ncnNUb0ZpZWxkcy5nZXQoZm1kc1tpXS5nZXROYW1lKCkpPgogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICB0YWJpbnMuYWRkVGFyZ2V0KGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSgKICAgICAgICAgICAgICAgIF9hdHRyc1RvRmllbGRzLmdldChmbWRzW2ld\nLmdldE5hbWUoKSkpKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBkZWZhdWx0OiB0aHJvdyBuZXcgSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAgICAgICAgdGFiaW5zLnNldERlZmF1\nbHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAgICAgICAgICAgKGNvZGUsIEls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcykpOwoKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nbmFtZSBvZiB0aGUgc2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxk\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgZ2V0U2V0dGVy\nTmFtZShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHJldHVybiAic2V0\nIiArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUoZm1kLmdldE5hbWUoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGZpZWxkIHJldHVybmVk\nIGJ5IHRoZSBnaXZlbiBtZXRob2QsIG9yIG51bGwgaWYgbm9uZS4KICAgICAq\nIFBhY2thZ2UtcHJvdGVjdGVkIGFuZCBzdGF0aWMgZm9yIHRlc3RpbmcuCiAg\nICAgKi8KICAgIHN0YXRpYyBCQ0ZpZWxkIGdldFJldHVybmVkRmllbGQoQkNN\nZXRob2QgbWV0aCkgewogICAgICAgIHJldHVybiBmaW5kRmllbGQobWV0aCwg\nKChDb2RlKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKSkueHJldHVy\nbigpCiAgICAgICAgICAgIC5zZXRUeXBlKG1ldGguZ2V0UmV0dXJuVHlwZSgp\nKSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBm\naWVsZCBhc3NpZ25lZCBpbiB0aGUgZ2l2ZW4gbWV0aG9kLCBvciBudWxsIGlm\nIG5vbmUuCiAgICAgKiBQYWNrYWdlLXByb3RlY3RlZCBhbmQgc3RhdGljIGZv\nciB0ZXN0aW5nLgogICAgICovCiAgICBzdGF0aWMgQkNGaWVsZCBnZXRBc3Np\nZ25lZEZpZWxkKEJDTWV0aG9kIG1ldGgpIHsKICAgICAgICByZXR1cm4gZmlu\nZEZpZWxkKG1ldGgsICgoQ29kZSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rp\nb24oKSkpLnB1dGZpZWxkKCksIHRydWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBmaWVsZCByZXR1cm5lZCAvIGFzc2lnbmVkIGJ5IDxj\nb2RlPm1ldGg8L2NvZGU+LiBSZXR1cm5zCiAgICAgKiBudWxsIGlmIG5vbi1m\naWVsZHMgKG1ldGhvZHMsIGxpdGVyYWxzLCBwYXJhbWV0ZXJzLCB2YXJpYWJs\nZXMpIGFyZQogICAgICogcmV0dXJuZWQsIG9yIGlmIG5vbi1wYXJhbWV0ZXJz\nIGFyZSBhc3NpZ25lZCB0byBmaWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIEJDRmllbGQgZmluZEZpZWxkKEJDTWV0aG9kIG1ldGgsIEluc3Ry\ndWN0aW9uIHRlbXBsYXRlLAogICAgICAgIGJvb2xlYW4gZmluZEFjY2Vzc2Vk\nKSB7CiAgICAgICAgLy8gaWdub3JlIGFueSBzdGF0aWMgbWV0aG9kcy4gT3Bl\nbkpQQSBvbmx5IGN1cnJlbnRseSBzdXBwb3J0cwogICAgICAgIC8vIG5vbi1z\ndGF0aWMgc2V0dGVycyBhbmQgZ2V0dGVycwogICAgICAgIGlmIChtZXRoLmlz\nU3RhdGljKCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBD\nb2RlIGNvZGUgPSBtZXRoLmdldENvZGUoZmFsc2UpOwogICAgICAgIGlmIChj\nb2RlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAgICAgICAgQkNGaWVsZCBmaWVsZCA9\nIG51bGwsIGN1cjsKICAgICAgICBJbnN0cnVjdGlvbiB0ZW1wbGF0ZUlucywg\ncHJldklucywgZWFybGllckluczsKICAgICAgICB3aGlsZSAoY29kZS5zZWFy\nY2hGb3J3YXJkKHRlbXBsYXRlKSkgewogICAgICAgICAgICBpbnQgYmFja3Vw\nQ291bnQgPSAzOwogICAgICAgICAgICB0ZW1wbGF0ZUlucyA9IGNvZGUucHJl\ndmlvdXMoKTsKICAgICAgICAgICAgaWYgKCFjb2RlLmhhc1ByZXZpb3VzKCkp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcHJl\ndklucyA9IGNvZGUucHJldmlvdXMoKTsKCiAgICAgICAgICAgIGlmIChwcmV2\nSW5zIGluc3RhbmNlb2YgQ2xhc3NJbnN0cnVjdGlvbgogICAgICAgICAgICAg\nICAgJiYgY29kZS5oYXNQcmV2aW91cygpKSB7CiAgICAgICAgICAgICAgICBw\ncmV2SW5zID0gY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICAgICAgYmFj\na3VwQ291bnQrKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFj\nb2RlLmhhc1ByZXZpb3VzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICAgICAgZWFybGllcklucyA9IGNvZGUucHJldmlvdXMoKTsK\nCiAgICAgICAgICAgIC8vIGlmIHRoZSBvcGNvZGUgdHdvIGJlZm9yZSB0aGUg\ndGVtcGxhdGUgd2FzIGFuIGFsb2FkXzAsIGNoZWNrCiAgICAgICAgICAgIC8v\nIGFnYWluc3QgdGhlIG1pZGRsZSBpbnN0cnVjdGlvbiBiYXNlZCBvbiB3aGF0\nIHR5cGUgb2YgZmluZAogICAgICAgICAgICAvLyB3ZSdyZSBkb2luZwogICAg\nICAgICAgICBpZiAoIShlYXJsaWVySW5zIGluc3RhbmNlb2YgTG9hZEluc3Ry\ndWN0aW9uKQogICAgICAgICAgICAgICAgfHwgISgoTG9hZEluc3RydWN0aW9u\nKSBlYXJsaWVySW5zKS5pc1RoaXMoKSkKICAgICAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICAgICAgLy8gaWYgdGhlIG1pZGRsZSBpbnN0cnVj\ndGlvbiB3YXMgYSBnZXRmaWVsZCwgdGhlbiBpdCdzIHRoZQogICAgICAgICAg\nICAvLyBmaWVsZCB0aGF0J3MgYmVpbmcgYWNjZXNzZWQKICAgICAgICAgICAg\naWYgKCFmaW5kQWNjZXNzZWQgJiYgcHJldklucyBpbnN0YW5jZW9mIEdldEZp\nZWxkSW5zdHJ1Y3Rpb24pIHsKICAgICAgICAgICAgICAgIGZpbmFsIEZpZWxk\nSW5zdHJ1Y3Rpb24gZlByZXZJbnMgPSAoRmllbGRJbnN0cnVjdGlvbikgcHJl\ndkluczsKICAgICAgICAgICAgICAgIGN1ciA9IChCQ0ZpZWxkKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBK\nMkRvUHJpdkhlbHBlci5nZXRGaWVsZEluc3RydWN0aW9uRmllbGRBY3Rpb24o\nZlByZXZJbnMpKTsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBtaWRkbGUg\naW5zdHJ1Y3Rpb24gd2FzIGFuIHhsb2FkXzEsIHRoZW4gdGhlCiAgICAgICAg\nICAgICAgICAvLyBtYXRjaGVkIGluc3RydWN0aW9uIGlzIHRoZSBmaWVsZCB0\naGF0J3MgYmVpbmcgc2V0LgogICAgICAgICAgICB9IGVsc2UgaWYgKGZpbmRB\nY2Nlc3NlZCAmJiBwcmV2SW5zIGluc3RhbmNlb2YgTG9hZEluc3RydWN0aW9u\nCiAgICAgICAgICAgICAgICAmJiAoKExvYWRJbnN0cnVjdGlvbikgcHJldklu\ncykuZ2V0UGFyYW0oKSA9PSAwKSB7CiAgICAgICAgICAgICAgICBmaW5hbCBG\naWVsZEluc3RydWN0aW9uIGZUZW1wbGF0ZUlucyA9CiAgICAgICAgICAgICAg\nICAgICAgKEZpZWxkSW5zdHJ1Y3Rpb24pIHRlbXBsYXRlSW5zOwogICAgICAg\nICAgICAgICAgY3VyID0gKEJDRmllbGQpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAgICAg\nLmdldEZpZWxkSW5zdHJ1Y3Rpb25GaWVsZEFjdGlvbihmVGVtcGxhdGVJbnMp\nKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgICAgIGlmIChmaWVsZCAhPSBudWxsICYmIGN1ciAh\nPSBmaWVsZCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nICAgICBmaWVsZCA9IGN1cjsKCiAgICAgICAgICAgIC8vIHJlYWR5IGZvciBu\nZXh0IHNlYXJjaCBpdGVyYXRpb24KICAgICAgICAgICAgd2hpbGUgKGJhY2t1\ncENvdW50ID4gMCkgewogICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAg\nICAgICAgICAgICAgICBiYWNrdXBDb3VudC0tOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBmaWVsZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlY29yZCBhIHZpb2xhdGlvbiBvZiB0aGUgcHJvcGVydHkgYWNj\nZXNzIHJlc3RyaWN0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZFZpb2xhdGlvbihTdHJpbmcga2V5LCBPYmplY3RbXSBhcmdzLCBib29sZWFu\nIGZhdGFsKSB7CiAgICAgICAgaWYgKF92aW9sYXRpb25zID09IG51bGwpCiAg\nICAgICAgICAgIF92aW9sYXRpb25zID0gbmV3IEhhc2hTZXQoKTsKICAgICAg\nICBfdmlvbGF0aW9ucy5hZGQoX2xvYy5nZXQoa2V5LCBhcmdzKSk7CiAgICAg\nICAgX2ZhaWwgfD0gZmF0YWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2cg\nLyB0aHJvdyByZWNvcmRlZCBwcm9wZXJ0eSBhY2Nlc3MgdmlvbGF0aW9ucy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByb2Nlc3NWaW9sYXRpb25zKCkg\newogICAgICAgIGlmIChfdmlvbGF0aW9ucyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIFN0cmluZyBzZXAgPSBKMkRvUHJpdkhlbHBl\nci5nZXRMaW5lU2VwYXJhdG9yKCk7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1\nZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IF92aW9sYXRpb25zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoaXRyLm5leHQoKSk7CiAgICAg\nICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZChzZXApOwogICAgICAgIH0KICAgICAgICBNZXNzYWdlIG1zZyA9\nIF9sb2MuZ2V0KCJwcm9wZXJ0eS12aW9sYXRpb25zIiwgYnVmKTsKCiAgICAg\nICAgaWYgKF9mYWlsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihtc2cpOwogICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkK\nICAgICAgICAgICAgX2xvZy53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXBsYWNlZCBhbGwgZGlyZWN0IGFjY2VzcyB0byBtYW5hZ2VkIGZp\nZWxkcyB3aXRoIHRoZSBhcHByb3ByaWF0ZQogICAgICogcGNHZXQvcGNTZXQg\nbWV0aG9kLiBOb3RlIHRoYXQgdGhpcyBpbmNsdWRlcyBhY2Nlc3MgdG8gZmll\nbGRzCiAgICAgKiBvd25lZCBieSBQZXJzaXN0ZW5jZUNhcGFibGUgY2xhc3Nl\ncyBvdGhlciB0aGFuIHRoaXMgb25lLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3MoKSB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBjcmVhdGUgdGVtcGxh\ndGUgcHV0ZmllbGQvZ2V0ZmllbGQgaW5zdHJ1Y3Rpb25zIHRvIHNlYXJjaCBm\nb3IKICAgICAgICBDb2RlIHRlbXBsYXRlID0gKENvZGUpIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5uZXdDb2RlQWN0aW9uKCkpOwogICAgICAgIEluc3RydWN0aW9uIHB1dCA9\nIHRlbXBsYXRlLnB1dGZpZWxkKCk7CiAgICAgICAgSW5zdHJ1Y3Rpb24gZ2V0\nID0gdGVtcGxhdGUuZ2V0ZmllbGQoKTsKICAgICAgICBJbnN0cnVjdGlvbiBz\ndGF0ID0gdGVtcGxhdGUuaW52b2tlc3RhdGljKCk7CgogICAgICAgIC8vIGxv\nb2sgdGhyb3VnaCBhbGwgbWV0aG9kczsgdGhpcyBpcyBkb25lIGJlZm9yZSBh\nbnkgbWV0aG9kcyBhcmUgYWRkZWQKICAgICAgICAvLyBzbyB3ZSBkb24ndCBu\nZWVkIHRvIHdvcnJ5IGFib3V0IGV4Y2x1ZGluZyBzeW50aGV0aWMgbWV0aG9k\ncy4KICAgICAgICBCQ01ldGhvZFtdIG1ldGhvZHMgPSBfbWFuYWdlZFR5cGUu\nZ2V0RGVjbGFyZWRNZXRob2RzKCk7CiAgICAgICAgQ29kZSBjb2RlOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWV0aG9kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBjb2RlID0gbWV0aG9kc1tpXS5nZXRDb2RlKGZhbHNl\nKTsKCiAgICAgICAgICAgIC8vIGRvbid0IG1vZGlmeSB0aGUgbWV0aG9kcyBz\ncGVjaWZpZWQgYnkgdGhlIGF1eGlsaWFyeSBlbmhhbmNlcnMKICAgICAgICAg\nICAgaWYgKGNvZGUgIT0gbnVsbCAmJiAhc2tpcEVuaGFuY2UobWV0aG9kc1tp\nXSkpIHsKICAgICAgICAgICAgICAgIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxk\nQWNjZXNzKGNvZGUsIGdldCwgdHJ1ZSwgc3RhdCk7CiAgICAgICAgICAgICAg\nICByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vzcyhjb2RlLCBwdXQsIGZh\nbHNlLCBzdGF0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJlcGxhY2VzIGFsbCBpbnN0cnVjdGlvbnMgbWF0Y2hp\nbmcgdGhlIGdpdmVuIHRlbXBsYXRlIGluIHRoZSBnaXZlbgogICAgICogY29k\nZSBibG9jayB3aXRoIGNhbGxzIHRvIHRoZSBhcHByb3ByaWF0ZSBnZW5lcmF0\nZWQgZ2V0dGVyL3NldHRlci4KICAgICAqCiAgICAgKiBAcGFyYW0gY29kZSB0\naGUgY29kZSBibG9jayB0byBtb2RpZnk7IHRoZSBjb2RlIGl0ZXJhdG9yIHdp\nbGwKICAgICAqIGJlIHBsYWNlZCBiZWZvcmUgdGhlIGZpcnN0IGluc3RydWN0\naW9uIG9uIG1ldGhvZCBzdGFydCwKICAgICAqIGFuZCB3aWxsIGJlIGFmdGVy\nIHRoZSBsYXN0IGluc3RydWN0aW9uIG9uIG1ldGhvZCBjb21wbGV0aW9uCiAg\nICAgKiBAcGFyYW0gaW5zIHRoZSB0ZW1wbGF0ZSBpbnN0cnVjdGlvbiB0byBz\nZWFyY2ggZm9yOyBlaXRoZXIgYQogICAgICogZ2V0ZmllbGQgb3IgcHV0Zmll\nbGQgaW5zdHJ1Y3Rpb24KICAgICAqIEBwYXJhbSBnZXQgYm9vbGVhbiBpbmRp\nY2F0aW5nIGlmIHRoaXMgaXMgYSBnZXQgaW5zdHJ1Y3Rpb24KICAgICAqIEBw\nYXJhbSBzdGF0IHRlbXBsYXRlIGludm9rZXN0YXRpYyBpbnN0cnVjdGlvbiB0\nbyByZXBsYWNlIHdpdGgKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxh\nY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNzKENvZGUgY29kZSwgSW5zdHJ1Y3Rp\nb24gaW5zLAogICAgICAgIGJvb2xlYW4gZ2V0LCBJbnN0cnVjdGlvbiBzdGF0\nKSB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBjb2Rl\nLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIEZpZWxkSW5zdHJ1Y3Rpb24gZmk7\nCiAgICAgICAgTWV0aG9kSW5zdHJ1Y3Rpb24gbWk7CiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBvd25lcjsKICAgICAgICBTdHJpbmcgbmFtZSwgdHlwZU5hbWUs\nIG1ldGhvZE5hbWU7CiAgICAgICAgd2hpbGUgKGNvZGUuc2VhcmNoRm9yd2Fy\nZChpbnMpKSB7CiAgICAgICAgICAgIC8vIGJhY2sgdXAgdG8gdGhlIG1hdGNo\nZWQgaW5zdHJ1Y3Rpb24KICAgICAgICAgICAgZmkgPSAoRmllbGRJbnN0cnVj\ndGlvbikgY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICBuYW1lID0gZmku\nZ2V0RmllbGROYW1lKCk7CiAgICAgICAgICAgIHR5cGVOYW1lID0gZmkuZ2V0\nRmllbGRUeXBlTmFtZSgpOwogICAgICAgICAgICBvd25lciA9IGdldFBlcnNp\nc3RlbmNlQ2FwYWJsZU93bmVyKG5hbWUsIGZpLmdldEZpZWxkRGVjbGFyZXJU\neXBlKCkpOwoKICAgICAgICAgICAgaWYgKG93bmVyICE9IG51bGwKICAgICAg\nICAgICAgICAgICYmIG93bmVyLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01l\ndGFEYXRhLkFDQ0VTU19QUk9QRVJUWSkgewogICAgICAgICAgICAgICAgLy8g\naWYgd2UncmUgZGlyZWN0bHkgYWNjZXNzaW5nIGEgZmllbGQgaW4gYW5vdGhl\nciBjbGFzcwogICAgICAgICAgICAgICAgLy8gaGllcmFyY2h5IHRoYXQgdXNl\ncyBwcm9wZXJ0eSBhY2Nlc3MsIHNvbWV0aGluZyBpcyB3cm9uZwogICAgICAg\nICAgICAgICAgaWYgKG93bmVyICE9IF9tZXRhICYmIG93bmVyLmdldERlY2xh\ncmVkRmllbGQobmFtZSkgIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgICAg\nIF9tZXRhICE9IG51bGwgJiYgIW93bmVyLmdldERlc2NyaWJlZFR5cGUoKQog\nICAgICAgICAgICAgICAgICAgICAgICAuaXNBc3NpZ25hYmxlRnJvbShfbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJwcm9wZXJ0eS1maWVs\nZC1hY2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW117IF9tZXRhLCBvd25lciwgbmFtZSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgpIH0pKTsKCiAgICAg\nICAgICAgICAgICAvLyBpZiB3ZSdyZSBkaXJlY3RseSBhY2Nlc3NpbmcgYSBw\ncm9wZXJ0eS1iYWNraW5nIGZpZWxkIG91dHNpZGUKICAgICAgICAgICAgICAg\nIC8vIHRoZSBwcm9wZXJ0eSBpbiBvdXIgb3duIGNsYXNzLCBub3RpZnkgdXNl\ncgogICAgICAgICAgICAgICAgaWYgKGlzQmFja2luZ0ZpZWxkT2ZBbm90aGVy\nUHJvcGVydHkobmFtZSwgY29kZSkpCiAgICAgICAgICAgICAgICAgICAgYWRk\nVmlvbGF0aW9uKCJwcm9wZXJ0eS1maWVsZC1hY2Nlc3MiLCBuZXcgT2JqZWN0\nW117IF9tZXRhLAogICAgICAgICAgICAgICAgICAgICAgICBvd25lciwgbmFt\nZSwgY29kZS5nZXRNZXRob2QoKS5nZXROYW1lKCkgfSwgZmFsc2UpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBpZiAob3duZXIgPT0gbnVsbCB8fAog\nICAgICAgICAgICAgICAgb3duZXIuZ2V0RGVjbGFyZWRGaWVsZChmcm9tQmFj\na2luZ0ZpZWxkTmFtZShuYW1lKSkgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgLy8gbm90IHBlcnNpc3RlbnQgZmllbGQ/CiAgICAgICAgICAgICAgICBj\nb2RlLm5leHQoKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKCFnZXRSZWRlZmluZSgpICYmICFnZXRDcmVhdGVT\ndWJjbGFzcygpCiAgICAgICAgICAgICAgICAmJiBvd25lci5nZXRBY2Nlc3NU\neXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAgICAg\nICAgICAgICAgIC8vIHJlcGxhY2UgdGhlIGluc3RydWN0aW9uIHdpdGggYSBj\nYWxsIHRvIHRoZSBnZW5lcmF0ZWQgYWNjZXNzCiAgICAgICAgICAgICAgICAv\nLyBtZXRob2QKICAgICAgICAgICAgICAgIG1pID0gKE1ldGhvZEluc3RydWN0\naW9uKSBjb2RlLnNldChzdGF0KTsKCiAgICAgICAgICAgICAgICAvLyBpbnZv\na2UgdGhlIHByb3BlciBhY2Nlc3MgbWV0aG9kLCB3aGV0aGVyIGdldHRlciBv\nciBzZXR0ZXIKICAgICAgICAgICAgICAgIFN0cmluZyBwcmVmaXggPSAoZ2V0\nKSA/IFBSRSArICJHZXQiIDogUFJFICsgIlNldCI7CiAgICAgICAgICAgICAg\nICBtZXRob2ROYW1lID0gcHJlZml4ICsgbmFtZTsKICAgICAgICAgICAgICAg\nIGlmIChnZXQpIHsKICAgICAgICAgICAgICAgICAgICBtaS5zZXRNZXRob2Qo\nZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAg\nICAgICBtZXRob2ROYW1lLCB0eXBlTmFtZSwgbmV3IFN0cmluZ1tdCiAgICAg\nICAgICAgICAgICAgICAgICAgIHsgZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgp\nIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICBtaS5zZXRNZXRob2QoZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgpLAog\nICAgICAgICAgICAgICAgICAgICAgICBtZXRob2ROYW1lLCAidm9pZCIsIG5l\ndyBTdHJpbmdbXQogICAgICAgICAgICAgICAgICAgICAgICB7IGdldFR5cGUo\nb3duZXIpLmdldE5hbWUoKSwgdHlwZU5hbWUgfSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgICAgICBu\nYW1lID0gZnJvbUJhY2tpbmdGaWVsZE5hbWUobmFtZSk7CiAgICAgICAgICAg\nICAgICBpZiAoZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgYWRkTm90aWZ5\nQWNjZXNzKGNvZGUsIG93bmVyLmdldEZpZWxkKG5hbWUpKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaW5zZXJ0IHRoZSBzZXQgb3Bl\ncmF0aW9ucyBhZnRlciB0aGUgZmllbGQgbXV0YXRpb24sIGJ1dAogICAgICAg\nICAgICAgICAgICAgIC8vIGZpcnN0IGxvYWQgdGhlIG9sZCB2YWx1ZSBmb3Ig\ndXNlIGluIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIFN0YXRlTWFuYWdl\nci5zZXR0aW5nWFhYIG1ldGhvZC4KICAgICAgICAgICAgICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAg\nICAgICBmaW5hbCBGaWVsZEluc3RydWN0aW9uIGZGaSA9IGZpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZCgKICAgICAg\nICAgICAgICAgICAgICAgICAgKEJDRmllbGQpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAuZ2V0RmllbGRJbnN0cnVjdGlvbkZpZWxkQWN0aW9uKGZG\naSkpKTsKICAgICAgICAgICAgICAgICAgICBpbnQgdmFsID0gY29kZS5nZXRO\nZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLnhz\ndG9yZSgpLnNldExvY2FsKHZhbCkuc2V0VHlwZShmaS5nZXRGaWVsZFR5cGUo\nKSk7CgogICAgICAgICAgICAgICAgICAgIC8vIG1vdmUgcGFzdCB0aGUgcHV0\nZmllbGQKICAgICAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAg\nICAgICAgICAgICAgICBhZGROb3RpZnlNdXRhdGlvbihjb2RlLCBvd25lci5n\nZXRGaWVsZChuYW1lKSwgdmFsLCAtMSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb2RlLm5leHQo\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBhZGROb3Rp\nZnlBY2Nlc3MoQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAg\nICAgIC8vIFBDSGVscGVyLmFjY2Vzc2luZ0ZpZWxkKHRoaXMsIDxhYnNvbHV0\nZS1pbmRleD4pOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZtZC5nZXRJbmRleCgp\nKTsKICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWRl\nZmluaXRpb25IZWxwZXIuY2xhc3MsCiAgICAgICAgICAgICJhY2Nlc3NpbmdG\naWVsZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsg\nT2JqZWN0LmNsYXNzLCBpbnQuY2xhc3MgfSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGlzIG11c3QgYmUgY2FsbGVkIGFmdGVyIHNldHRpbmcgdGhlIHZh\nbHVlIGluIHRoZSBvYmplY3QuCiAgICAgKiAKICAgICAqIEBwYXJhbSBjb2Rl\nCiAgICAgKiBAcGFyYW0gdmFsIHRoZSBwb3NpdGlvbiBpbiB0aGUgbG9jYWwg\ndmFyaWFibGUgdGFibGUgd2hlcmUgdGhlCiAgICAgKiBvbGQgdmFsdWUgaXMg\nc3RvcmVkCiAgICAgKiBAcGFyYW0gcGFyYW0gdGhlIHBhcmFtZXRlciBwb3Np\ndGlvbiBjb250YWluaW5nIHRoZSBuZXcgdmFsdWUsIG9yCiAgICAgKiAtMSBp\nZiB0aGUgbmV3IHZhbHVlIGlzIHVuYXZhaWxhYmxlIGFuZCBzaG91bGQgdGhl\ncmVmb3JlIGJlIGxvb2tlZAogICAgICogdXAuCiAgICAgKiBAdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkTm90aWZ5TXV0YXRpb24oQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZt\nZCwgaW50IHZhbCwKICAgICAgICBpbnQgcGFyYW0pCiAgICAgICAgdGhyb3dz\nIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gUENIZWxwZXIu\nc2V0dGluZ0ZpZWxkKHRoaXMsIDxhYnNvbHV0ZS1pbmRleD4sIG9sZCwgbmV3\nKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWQuZ2V0SW5kZXgoKSk7CiAgICAg\nICAgQ2xhc3MgdHlwZSA9IGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAg\nICAvLyB3ZSBvbmx5IGhhdmUgc3BlY2lhbCBzaWduYXR1cmVzIGZvciBwcmlt\naXRpdmVzIGFuZCBTdHJpbmdzCiAgICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0\naXZlKCkgJiYgdHlwZSAhPSBTdHJpbmcuY2xhc3MpCiAgICAgICAgICAgIHR5\ncGUgPSBPYmplY3QuY2xhc3M7CiAgICAgICAgY29kZS54bG9hZCgpLnNldExv\nY2FsKHZhbCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBpZiAocGFyYW0gPT0g\nLTEpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29k\nZSwgZm1kKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb2RlLnhs\nb2FkKCkuc2V0UGFyYW0ocGFyYW0pLnNldFR5cGUodHlwZSk7CiAgICAgICAg\nfQogICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZGVm\naW5pdGlvbkhlbHBlci5jbGFzcywgInNldHRpbmdGaWVsZCIsCiAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsKICAgICAgICAgICAgICAg\nIE9iamVjdC5jbGFzcywgaW50LmNsYXNzLCB0eXBlLCB0eXBlCiAgICAgICAg\nfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUg\nZ2l2ZW4gaW5zdHJ1Y3Rpb24gYWNjZXNzZXMgYSBmaWVsZCB0aGF0IGlzIGEg\nYmFja2luZwogICAgICogZmllbGQgb2YgYW5vdGhlciBwcm9wZXJ0eSBpbiB0\naGlzIHByb3BlcnR5LWFjY2VzcyBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIGlzQmFja2luZ0ZpZWxkT2ZBbm90aGVyUHJvcGVydHkoU3Ry\naW5nIG5hbWUsIENvZGUgY29kZSkgewogICAgICAgIFN0cmluZyBtZXRoTmFt\nZSA9IGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgpOwogICAgICAgIHJldHVy\nbiAhIjxpbml0PiIuZXF1YWxzKG1ldGhOYW1lKQogICAgICAgICAgICAmJiBf\nYmFja2luZ0ZpZWxkcyAhPSBudWxsCiAgICAgICAgICAgICYmICFuYW1lLmVx\ndWFscyhfYmFja2luZ0ZpZWxkcy5nZXQobWV0aE5hbWUpKQogICAgICAgICAg\nICAmJiBfYmFja2luZ0ZpZWxkcy5jb250YWluc1ZhbHVlKG5hbWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1cm4gdGhl\nIGRlY2xhcmluZyBQZXJzaXN0ZW5jZUNhcGFibGUgY2xhc3Mgb2YKICAgICAq\nIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqCiAgICAgKiBAcGFyYW0gZmllbGRO\nYW1lIHRoZSBuYW1lIG9mIHRoZSBmaWVsZAogICAgICogQHBhcmFtIG93bmVy\nIHRoZSBub21pbmFsIG93bmVyIG9mIHRoZSBmaWVsZAogICAgICogQHJldHVy\nbiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUgdHlw\nZSB0aGF0CiAgICAgKiBkZWNsYXJlcyB0aGUgZmllbGQgKGFuZCB0aGVyZWZv\ncmUgaGFzIHRoZSBzdGF0aWMgbWV0aG9kKSwgb3IgbnVsbCBpZiBub25lCiAg\nICAgKi8KICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRQZXJzaXN0ZW5j\nZUNhcGFibGVPd25lcihTdHJpbmcgZmllbGROYW1lLAogICAgICAgIENsYXNz\nIG93bmVyKSB7CiAgICAgICAgLy8gZmluZCB0aGUgYWN0dWFsIGFuY2VzdG9y\nIGNsYXNzIHRoYXQgZGVjbGFyZXMgdGhlIGZpZWxkLCB0aGVuCiAgICAgICAg\nLy8gY2hlY2sgaWYgdGhlIGNsYXNzIGlzIHBlcnNpc3RlbnQsIGFuZCBpZiB0\naGUgZmllbGQgaXMgbWFuYWdlZAogICAgICAgIEZpZWxkIGYgPSBSZWZsZWN0\naW9uLmZpbmRGaWVsZChvd25lciwgZmllbGROYW1lLCBmYWxzZSk7CiAgICAg\nICAgaWYgKGYgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIC8vIG1hbmFnZWQgaW50ZXJmYWNlCiAgICAgICAgaWYgKF9tZXRh\nICE9IG51bGwgJiYgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmlzSW50ZXJm\nYWNlKCkpCiAgICAgICAgICAgIHJldHVybiBfbWV0YTsKCiAgICAgICAgcmV0\ndXJuIF9yZXBvcy5nZXRNZXRhRGF0YShmLmdldERlY2xhcmluZ0NsYXNzKCks\nIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYWxs\nIHN5bnRoZXRpYyBtZXRob2RzIHRvIHRoZSBieXRlY29kZSBieSBkZWxlZ2F0\naW5nIHRvCiAgICAgKiB0aGUgdmFyaW91cyBhZGRYWFhNZXRob2RzICgpIGZ1\nbmN0aW9ucyBpbiB0aGlzIGNsYXNzLiBJbmNsdWRlcwogICAgICogYWxsIHN0\nYXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9kcy4KICAgICAqIE5vdGUgdGhhdCB0\naGUgJ3N0b2NrJyBtZXRob2RzIGxpa2UgPGNvZGU+cGNJc1RyYW5zYWN0aW9u\nYWw8L2NvZGU+LAogICAgICogPGNvZGU+cGNGZXRjaE9iamVjdElkPC9jb2Rl\nPiwgZXRjIGFyZSBkZWZpbmVkIG9ubHkgaW4gdGhlCiAgICAgKiBsZWFzdC1k\nZXJpdmVkIFBlcnNpc3RlbmNlQ2FwYWJsZSB0eXBlLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkUENNZXRob2RzKCkKICAgICAgICB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBhZGRDbGVhckZpZWxkc01l\ndGhvZCgpOwogICAgICAgIGFkZE5ld0luc3RhbmNlTWV0aG9kKHRydWUpOwog\nICAgICAgIGFkZE5ld0luc3RhbmNlTWV0aG9kKGZhbHNlKTsKICAgICAgICBh\nZGRNYW5hZ2VkRmllbGRDb3VudE1ldGhvZCgpOwogICAgICAgIGFkZFJlcGxh\nY2VGaWVsZHNNZXRob2RzKCk7CiAgICAgICAgYWRkUHJvdmlkZUZpZWxkc01l\ndGhvZHMoKTsKICAgICAgICBhZGRDb3B5RmllbGRzTWV0aG9kKCk7CgogICAg\nICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxsIHx8IGdl\ndENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgYWRkU3RvY2tNZXRo\nb2RzKCk7CiAgICAgICAgICAgIGFkZEdldFZlcnNpb25NZXRob2QoKTsKICAg\nICAgICAgICAgYWRkUmVwbGFjZVN0YXRlTWFuYWdlck1ldGhvZCgpOwoKICAg\nICAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgpICE9IENsYXNz\nTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAgICAgICBhZGRO\nb09wQXBwbGljYXRpb25JZGVudGl0eU1ldGhvZHMoKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGFkZCB0aGUgYXBwIGlkIG1ldGhvZHMgdG8gZWFjaCBzdWJj\nbGFzcyByYXRoZXIKICAgICAgICAvLyB0aGFuIGp1c3QgdGhlIHN1cGVyY2xh\nc3MsIHNpbmNlIGl0IGlzIHBvc3NpYmxlIHRvIGhhdmUKICAgICAgICAvLyBh\nIHN1YmNsYXNzIHdpdGggYW4gYXBwIGlkIGhpZXJhcmNoeSB0aGF0IG1hdGNo\nZXMgdGhlCiAgICAgICAgLy8gcGVyc2lzdGVudCBjbGFzcyBpbmhlcml0YW5j\nZSBoaWVyYXJjaHkKICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBl\nKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTgogICAgICAgICAg\nICAmJiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8fCBnZXRD\ncmVhdGVTdWJjbGFzcygpIHx8CiAgICAgICAgICAgICAgICBfbWV0YS5nZXRP\nYmplY3RJZFR5cGUoKSAhPQogICAgICAgICAgICAgICAgICAgIF9tZXRhLmdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0T2JqZWN0SWRUeXBlKCkpKSB7\nCiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNUb09iamVjdElkTWV0aG9k\nKHRydWUpOwogICAgICAgICAgICBhZGRDb3B5S2V5RmllbGRzVG9PYmplY3RJ\nZE1ldGhvZChmYWxzZSk7CiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNG\ncm9tT2JqZWN0SWRNZXRob2QodHJ1ZSk7CiAgICAgICAgICAgIGFkZENvcHlL\nZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2QoZmFsc2UpOwogICAgICAgICAg\nICBhZGROZXdPYmplY3RJZEluc3RhbmNlTWV0aG9kKHRydWUpOwogICAgICAg\nICAgICBhZGROZXdPYmplY3RJZEluc3RhbmNlTWV0aG9kKGZhbHNlKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBtZXRob2QgdG8g\nY2xlYXIgYWxsIHBlcnNpc3RlbnQgZmllbGRzOyB3ZSdsbCBjYWxsIHRoaXMg\nZnJvbQogICAgICogdGhlIG5ldyBpbnN0YW5jZSBtZXRob2QgdG8gZW5zdXJl\nIHRoYXQgdW5sb2FkZWQgZmllbGRzIGhhdmUKICAgICAqIGRlZmF1bHQgdmFs\ndWVzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ2xlYXJGaWVsZHNN\nZXRob2QoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24g\newogICAgICAgIC8vIHByb3RlY3RlZCB2b2lkIHBjQ2xlYXJGaWVsZHMgKCkK\nICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQ\nUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBu\ndWxsKTsKICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgpOwogICAgICAg\nIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAv\nLyBzdXBlci5wY0NsZWFyRmllbGRzICgpCiAgICAgICAgaWYgKF9tZXRhLmdl\ndFBDU3VwZXJjbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1YmNsYXNz\nKCkpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5\ncGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpKSwgUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywKICAg\nICAgICAgICAgICAgIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkgIT0g\nRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CWVRFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hB\nUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkRPVUJMRToKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBGKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKDBMKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYWRkU2V0\nTWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICB9Cgog\nICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+cGNOZXdJ\nbnN0YW5jZTwvY29kZT4gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAq\nIFRoZXNlIG1ldGhvZHMgYXJlIHVzZWQgYnkgdGhlIGltcGwgaGVscGVyIHRv\nIGNyZWF0ZSBuZXcKICAgICAqIG1hbmFnZWQgaW5zdGFuY2VzIGVmZmljaWVu\ndGx5IHdpdGhvdXQgcmVmbGVjdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0g\nb2lkIHNldCB0byB0cnVlIHRvIG1pbWljIHRoZSBtZXRob2QgdmVyc2lvbiB0\naGF0IHRha2VzCiAgICAgKiBhbiBvaWQgdmFsdWUgYXMgd2VsbCBhcyBhIHN0\nYXRlIG1hbmFnZXIKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5ld0lu\nc3RhbmNlTWV0aG9kKGJvb2xlYW4gb2lkKSB7CiAgICAgICAgLy8gcHVibGlj\nIFBlcnNpc3RlbmNlQ2FwYWJsZSBwY05ld0luc3RhbmNlICguLi4pCiAgICAg\nICAgQ2xhc3NbXSBhcmdzID0KICAgICAgICAgICAgKG9pZCkgPyBuZXcgQ2xh\nc3NbXXsgU01UWVBFLCBPYmplY3QuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfQog\nICAgICAgICAgICAgICAgOiBuZXcgQ2xhc3NbXXsgU01UWVBFLCBib29sZWFu\nLmNsYXNzIH07CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgIk5ld0luc3RhbmNlIiwgUENUWVBFLCBhcmdzKTsK\nICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAg\nICAgICAgLy8gaWYgdGhlIHR5cGUgaXMgYWJzdHJhY3QsIHRocm93IGEgVXNl\nckV4Y2VwdGlvbgogICAgICAgIGlmIChfcGMuaXNBYnN0cmFjdCgpKSB7CiAg\nICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIFVTRVJFWENFUCk7CiAg\nICAgICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICAvLyBYWFggcGMgPSBuZXcgWFhYICgpOwogICAgICAgIGNvZGUu\nYW5ldygpLnNldFR5cGUoX3BjKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwg\ndm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgaW50IGluc3QgPSBjb2RlLmdl\ndE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0\nTG9jYWwoaW5zdCk7CgogICAgICAgIC8vIGlmIChjbGVhcikKICAgICAgICAv\nLyAgIHBjLnBjQ2xlYXJGaWVsZHMgKCk7CiAgICAgICAgY29kZS5pbG9hZCgp\nLnNldFBhcmFtKChvaWQpID8gMiA6IDEpOwogICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBub2NsZWFyID0gY29kZS5pZmVxKCk7CiAgICAgICAgY29kZS5hbG9h\nZCgpLnNldExvY2FsKGluc3QpOwogICAgICAgIGNvZGUuaW52b2tldmlydHVh\nbCgpLnNldE1ldGhvZChQUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lkLmNsYXNz\nLCBudWxsKTsKCiAgICAgICAgLy8gcGMucGNTdGF0ZU1hbmFnZXIgPSBzbTsK\nICAgICAgICBub2NsZWFyLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0TG9j\nYWwoaW5zdCkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsK\nICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCgogICAgICAgIC8vIGNvcHkga2V5IGZpZWxkcyBmcm9tIG9pZAogICAgICAg\nIGlmIChvaWQpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2Fs\nKGluc3QpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSk7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQ\nUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAgICAg\nICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0p\nOwogICAgICAgIH0KCiAgICAgICAgLy8gcmV0dXJuIHBjOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5wcm90ZWN0ZWQgc3RhdGljIGludCBw\nY0dldE1hbmFnZWRGaWVsZENvdW50ICgpPC9jb2RlPgogICAgICogbWV0aG9k\nIHRvIHRoZSBieXRlY29kZSwgcmV0dXJuaW5nIHRoZSBpbmhlcml0ZWQgZmll\nbGQgY291bnQgYWRkZWQKICAgICAqIHRvIHRoZSBudW1iZXIgb2YgbWFuYWdl\nZCBmaWVsZHMgaW4gdGhlIGN1cnJlbnQgUGVyc2lzdGVuY2VDYXBhYmxlIGNs\nYXNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkTWFuYWdlZEZpZWxk\nQ291bnRNZXRob2QoKSB7CiAgICAgICAgLy8gcHJvdGVjdGVkIHN0YXRpYyBp\nbnQgcGNHZXRNYW5hZ2VkRmllbGRDb3VudCAoKQogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRNYW5hZ2Vk\nRmllbGRDb3VudCIsCiAgICAgICAgICAgIGludC5jbGFzcywgbnVsbCk7CiAg\nICAgICAgbWV0aG9kLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBtZXRob2Qu\nbWFrZVByb3RlY3RlZCgpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5n\nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyByZXR1cm4gPGZpZWxkcz4gKyBw\nY0luaGVyaXRlZEZpZWxkQ291bnQKICAgICAgICAvLyBhd2hpdGU6IHRoZSBh\nYm92ZSBzaG91bGQgd29yaywgYnV0IEknbSBzZWVpbmcgYSBtZXNzZWQgdXAg\nc2l0dWF0aW9uCiAgICAgICAgLy8gYWxsIG9mIGEgc3VkZGVuIHdoZXJlIHdo\nZW4gYSBzdWJjbGFzcyBjYWxscyB0aGlzIG1ldGhvZCwgaXQgc29tZWhvdwog\nICAgICAgIC8vIGhhcHBlbnMgYmVmb3JlIDxjbGluaXQ+IGlzIGV2ZXIgaW52\nb2tlZCwgYW5kIHNvIG91cgogICAgICAgIC8vIHBjSW5oZXJpdGVkRmllbGRD\nb3VudCBmaWVsZCBpc24ndCBpbml0aWFsaXplZCEgIHNvIGluc3RlYWQsCiAg\nICAgICAgLy8gcmV0dXJuIDxmaWVsZHM+ICsgPHN1cGVyY2xhc3M+LnBjR2V0\nTWFuYWdlZEZpZWxkQ291bnQgKCkKICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUoX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKS5sZW5ndGgpOwog\nICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7\nCiAgICAgICAgICAgIENsYXNzIHN1cGVyQ2xhc3MgPSBnZXRUeXBlKF9tZXRh\nLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpOwogICAgICAgICAgICBTdHJp\nbmcgc3VwZXJOYW1lID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/CiAgICAgICAg\nICAgICAgICBQQ0VuaGFuY2VyLnRvUENTdWJjbGFzc05hbWUoc3VwZXJDbGFz\ncykgOgogICAgICAgICAgICAgICAgc3VwZXJDbGFzcy5nZXROYW1lKCk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKHN1cGVy\nTmFtZSwKICAgICAgICAgICAgICAgIFBSRSArICJHZXRNYW5hZ2VkRmllbGRD\nb3VudCIsIGludC5jbGFzcy5nZXROYW1lKCksIG51bGwpOwogICAgICAgICAg\nICBjb2RlLmlhZGQoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5pcmV0dXJu\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSNwY1Byb3ZpZGVGaWVsZH0gYW5kCiAgICAgKiB7QGxpbmsgUGVyc2lz\ndGVuY2VDYXBhYmxlI3BjUHJvdmlkZUZpZWxkc30gbWV0aG9kcyB0byB0aGUg\nYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQcm92aWRl\nRmllbGRzTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNQcm92aWRlRmll\nbGQgKGludCBmaWVsZE51bWJlcikKICAgICAgICBCQ01ldGhvZCBtZXRob2Qg\nPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUHJvdmlkZUZpZWxkIiwgdm9p\nZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhlIHN3aXRj\naCAoKQogICAgICAgIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNoTWV0aG9k\nKFBSRSArICJQcm92aWRlRmllbGQiLCBjb2RlKTsKCiAgICAgICAgLy8gaWYg\nbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0aHJvdyBleGNlcHRpb24K\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1YmNs\nYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9tZXRh\nLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgaWYgKGZtZHMubGVuZ3Ro\nID09IDApCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAgICAgICBjb2RlLmls\nb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAgICAgICBUYWJsZVN3\naXRjaEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2goKTsK\nICAgICAgICAgICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICAgICAgdGFi\naW5zLnNldEhpZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAgICAgIC8v\nIDxmaWVsZD4gPSBwY1N0YXRlTWFuYWdlci5wcm92aWRlZDx0eXBlPkZpZWxk\nCiAgICAgICAgICAgIC8vICAgICAodGhpcywgZmllbGROdW1iZXIpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIHRhYmlucy5hZGRUYXJnZXQobG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgY29k\nZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1k\nc1tpXSk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgp\nLnNldE1ldGhvZChnZXRTdGF0ZU1hbmFnZXJNZXRob2QKICAgICAgICAgICAg\nICAgICAgICAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgInByb3ZpZGVk\nIiwgZmFsc2UsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBjb2RlLnZyZXR1\ncm4oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGVmYXVsdDog\ndGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAg\nICAgICB0YWJpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlvbgog\nICAgICAgICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbi5jbGFzcykpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCgogICAgICAgIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihtZXRo\nb2QpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBl\ncnNpc3RlbmNlQ2FwYWJsZSNwY1JlcGxhY2VGaWVsZH0gYW5kCiAgICAgKiB7\nQGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjUmVwbGFjZUZpZWxkc30gbWV0\naG9kcyB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhZGRSZXBsYWNlRmllbGRzTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQg\ncGNSZXBsYWNlRmllbGQgKGludCBmaWVsZE51bWJlcikKICAgICAgICBCQ01l\ndGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVwbGFj\nZUZpZWxkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117\nIGludC5jbGFzcyB9KTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5nIHRocm91\nZ2ggdGhlIHN3aXRjaCAoKQogICAgICAgIGludCByZWxMb2NhbCA9IGJlZ2lu\nU3dpdGNoTWV0aG9kKFBSRSArICJSZXBsYWNlRmllbGQiLCBjb2RlKTsKCiAg\nICAgICAgLy8gaWYgbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0aHJv\ndyBleGNlcHRpb24KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdl\ndENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAg\nICAgICA6IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgaWYg\nKGZtZHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9u\nKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAg\nICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAg\nICAgICBUYWJsZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFi\nbGVzd2l0Y2goKTsKICAgICAgICAgICAgdGFiaW5zLnNldExvdygwKTsKICAg\nICAgICAgICAgdGFiaW5zLnNldEhpZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAg\nICAgICAgICAgIC8vIDxmaWVsZD4gPSBwY1N0YXRlTWFuYWdlci5yZXBsYWNl\nPHR5cGU+RmllbGQKICAgICAgICAgICAgLy8gICh0aGlzLCBmaWVsZE51bWJl\ncik7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgLy8gZm9yIHRoZSBhZGRTZXRN\nYW5hZ2VkVmFsdWVDb2RlIGNhbGwgYmVsb3cuCiAgICAgICAgICAgICAgICB0\nYWJpbnMuYWRkVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpKTsKCiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgY29k\nZS5pbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgY29kZS5p\nbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVNYW5hZ2VyTWV0\naG9kCiAgICAgICAgICAgICAgICAgICAgKGZtZHNbaV0uZ2V0RGVjbGFyZWRU\neXBlKCksICJyZXBsYWNlIiwgdHJ1ZSwgZmFsc2UpKTsKICAgICAgICAgICAg\nICAgIGlmICghZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKS5pc1ByaW1pdGl2\nZSgpKQogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0\nVHlwZShmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKCiAgICAgICAgICAg\nICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwog\nICAgICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IHRocm93IG5ldyBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24gKCkKICAgICAgICAgICAgdGFiaW5zLnNldERlZmF1\nbHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAgICAgICAgICAgICAgIChjb2Rl\nLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpKTsKICAgICAgICB9\nCgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICBhZGRNdWx0aXBs\nZUZpZWxkc01ldGhvZFZlcnNpb24obWV0aG9kKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGND\nb3B5RmllbGRzfSBtZXRob2QgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkQ29weUZpZWxkc01ldGhvZCgpCiAgICAgICAg\ndGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVi\nbGljIHZvaWQgcGNDb3B5RmllbGQgKE9iamVjdCBwYywgaW50IGZpZWxkKQog\nICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBS\nRSArICJDb3B5RmllbGQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLmdldE5h\nbWUoKSwKICAgICAgICAgICAgbmV3IFN0cmluZ1tdeyBfbWFuYWdlZFR5cGUu\nZ2V0TmFtZSgpLCBpbnQuY2xhc3MuZ2V0TmFtZSgpIH0pOwogICAgICAgIG1l\ndGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0\naG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGFkZHMgZXZlcnl0aGlu\nZyB0aHJvdWdoIHRoZSBzd2l0Y2ggKCkKICAgICAgICBpbnQgcmVsTG9jYWwg\nPSBiZWdpblN3aXRjaE1ldGhvZChQUkUgKyAiQ29weUZpZWxkIiwgY29kZSk7\nCgogICAgICAgIC8vIGlmIG5vIGZpZWxkcyBpbiB0aGlzIGluc3QsIGp1c3Qg\ndGhyb3cgZXhjZXB0aW9uCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAg\nICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAg\nIGlmIChmbWRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0aHJvd0V4Y2Vw\ndGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAg\nICAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJlbExvY2FsKTsKICAg\nICAgICAgICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBjb2Rl\nLnRhYmxlc3dpdGNoKCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRMb3coMCk7\nCiAgICAgICAgICAgIHRhYmlucy5zZXRIaWdoKGZtZHMubGVuZ3RoIC0gMSk7\nCgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIC8vIDxmaWVsZD4gPSBvdGhlci48\nZmllbGQ+OwogICAgICAgICAgICAgICAgLy8gb3Igc2V0PGZpZWxkPiAob3Ro\nZXIuZ2V0PGZpZWxkPik7CiAgICAgICAgICAgICAgICB0YWJpbnMuYWRkVGFy\nZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAg\nICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSwg\nZmFsc2UpOwogICAgICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29k\nZShjb2RlLCBmbWRzW2ldKTsKCiAgICAgICAgICAgICAgICAvLyBicmVhazsK\nICAgICAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBkZWZhdWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uICgpCiAgICAgICAgICAgIHRhYmlucy5zZXREZWZh\ndWx0VGFyZ2V0KHRocm93RXhjZXB0aW9uCiAgICAgICAgICAgICAgICAoY29k\nZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKSk7CiAgICAgICAg\nfQoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgYWRkTXVsdGlw\nbGVGaWVsZHNNZXRob2RWZXJzaW9uKG1ldGhvZCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCB0aGUgY29kZSBjb21tb24g\ndG8gdGhlIGJlZ2lubmluZyBvZiBib3RoIHRoZQogICAgICogcGNSZXBsYWNl\nRmllbGQgbWV0aG9kIGFuZCB0aGUgcGNQcm92aWRlRmllbGQgbWV0aG9kLiBU\naGlzIGluY2x1ZGVzCiAgICAgKiBjYWxjdWxhdGluZyB0aGUgcmVsYXRpdmUg\nZmllbGQgbnVtYmVyIG9mIHRoZSBkZXNpcmVkIGZpZWxkIGFuZCBjYWxsaW5n\nCiAgICAgKiB0aGUgc3VwZXJjbGFzcyBpZiBuZWNlc3NhcnkuCiAgICAgKgog\nICAgICogQHJldHVybiB0aGUgaW5kZXggaW4gd2hpY2ggdGhlIGxvY2FsIHZh\ncmlhYmxlIGhvbGRpbmcgdGhlIHJlbGF0aXZlCiAgICAgKiBmaWVsZCBudW1i\nZXIgaXMgc3RvcmVkCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGJlZ2luU3dp\ndGNoTWV0aG9kKFN0cmluZyBuYW1lLCBDb2RlIGNvZGUpIHsKICAgICAgICBi\nb29sZWFuIGNvcHkgPSAoUFJFICsgIkNvcHlGaWVsZCIpLmVxdWFscyhuYW1l\nKTsKICAgICAgICBpbnQgZmllbGROdW1iZXIgPSAoY29weSkgPyAxIDogMDsK\nCiAgICAgICAgaW50IHJlbExvY2FsID0gY29kZS5nZXROZXh0TG9jYWxzSW5k\nZXgoKTsKICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAg\nICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1iZXIpOwog\nICAgICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKHJlbExvY2FsKTsK\nICAgICAgICAgICAgcmV0dXJuIHJlbExvY2FsOwogICAgICAgIH0KCiAgICAg\nICAgLy8gaW50IHJlbCA9IGZpZWxkTnVtYmVyIC0gcGNJbmhlcml0ZWRGaWVs\nZENvdW50CiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVt\nYmVyKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVS\nSVQsIGludC5jbGFzcyk7CiAgICAgICAgY29kZS5pc3ViKCk7CiAgICAgICAg\nY29kZS5pc3RvcmUoKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAgY29k\nZS5pbG9hZCgpLnNldExvY2FsKHJlbExvY2FsKTsKCiAgICAgICAgLy8gc3Vw\nZXI6IGlmIChyZWwgPCAwKSBzdXBlci5wY1JlcGxhY2VGaWVsZCAoZmllbGRO\ndW1iZXIpOyByZXR1cm47CiAgICAgICAgLy8gbm8gc3VwZXI6IGlmIChyZWwg\nPCAwKSB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpOwog\nICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZnZSgpOwog\nICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICBTdHJpbmdbXSBhcmdzOwogICAgICAgICAgICBpZiAo\nY29weSkgewogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBTdHJpbmdbXXsg\nZ2V0VHlwZShfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS4KICAg\nICAgICAgICAgICAgICAgICBnZXROYW1lKCksIGludC5jbGFzcy5nZXROYW1l\nKCkgfTsKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgw\nKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBhcmdzID0g\nbmV3IFN0cmluZ1tdeyBpbnQuY2xhc3MuZ2V0TmFtZSgpIH07CiAgICAgICAg\nICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbShmaWVsZE51bWJlcik7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBl\nKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKSkuZ2V0TmFtZSgpLCBuYW1lLCAKICAgICAgICAgICAgICAgIHZvaWQu\nY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICAgICAgY29kZS52cmV0\ndXJuKCk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHRocm93RXhjZXB0\naW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7Cgog\nICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICBy\nZXR1cm4gcmVsTG9jYWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIGhl\nbHBlciBtZXRob2QsIGdpdmVuIHRoZSBwY1JlcGxhY2VGaWVsZCBvciBwY1By\nb3ZpZGVGaWVsZAogICAgICogbWV0aG9kLCBhZGRzIHRoZSBieXRlY29kZSBm\nb3IgdGhlIGNvcnJlc3BvbmRpbmcgJ3BsdXJhbCcgdmVyc2lvbgogICAgICog\nb2YgdGhlIG1ldGhvZCAtLSB0aGUgdmVyc2lvbiB0aGF0IHRha2VzIGFuIGlu\ndFtdIG9mIGZpZWxkcyB0bwogICAgICogdG8gYWNjZXNzIHJhdGhlciB0aGFu\nIGEgc2luZ2xlIGZpZWxkLiBUaGUgbXVsdGlwbGUgZmllbGRzIHZlcnNpb24K\nICAgICAqIHNpbXBseSBsb29wcyB0aHJvdWdoIHRoZSBwcm92aWRlZCBpbmRl\neGVzIGFuZCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgKiBzaW5ndWxhciB2ZXJz\naW9uIGZvciBlYWNoIG9uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihCQ01ldGhvZCBzaW5nbGUp\nIHsKICAgICAgICBib29sZWFuIGNvcHkgPSAoUFJFICsgIkNvcHlGaWVsZCIp\nLmVxdWFscyhzaW5nbGUuZ2V0TmFtZSgpKTsKCiAgICAgICAgLy8gcHVibGlj\nIHZvaWQgPG1ldGhvZD5zIChpbnRbXSBmaWVsZHMpCiAgICAgICAgQ2xhc3Nb\nXSBhcmdzID0gKGNvcHkpID8gbmV3IENsYXNzW117IE9iamVjdC5jbGFzcywg\naW50W10uY2xhc3MgfQogICAgICAgICAgICA6IG5ldyBDbGFzc1tdeyBpbnRb\nXS5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKHNpbmdsZS5nZXROYW1lKCkgKyAicyIsCiAgICAgICAgICAg\nIHZvaWQuY2xhc3MsIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhv\nZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICBpbnQgZmllbGROdW1iZXJzID0g\nMDsKICAgICAgICBpbnQgaW5zdCA9IDA7CiAgICAgICAgaWYgKGNvcHkpIHsK\nICAgICAgICAgICAgZmllbGROdW1iZXJzID0gMTsKCiAgICAgICAgICAgIGlm\nIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgICAgICAvLyBn\nZXQgdGhlIG1hbmFnZWQgaW5zdGFuY2UgaW50byB0aGUgbG9jYWwgdmFyaWFi\nbGUgdGFibGUKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0\nTWV0aG9kKEltcGxIZWxwZXIuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAg\nImdldE1hbmFnZWRJbnN0YW5jZSIsIE9iamVjdC5jbGFzcywKICAgICAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShfbWFuYWdl\nZFR5cGUpOwogICAgICAgICAgICAgICAgaW5zdCA9IGNvZGUuZ2V0TmV4dExv\nY2Fsc0luZGV4KCk7CiAgICAgICAgICAgICAgICBjb2RlLmFzdG9yZSgpLnNl\ndExvY2FsKGluc3QpOwoKICAgICAgICAgICAgICAgIC8vIHRoZXJlIG1pZ2h0\nIGJlIGEgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBjbGFzc2VzIG9mICd0aGlz\nJwogICAgICAgICAgICAgICAgLy8gdnMgJ290aGVyJyBpbiB0aGlzIGNvbnRl\neHQ7IHVzZSB0aGUgUEMgbWV0aG9kcyB0byBnZXQgdGhlIFNNCiAgICAgICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoSW1wbEhl\nbHBlci5jbGFzcywKICAgICAgICAgICAgICAgICAgICAidG9QZXJzaXN0ZW5j\nZUNhcGFibGUiLCBQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAg\nICAgICAgICAgICAgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3MsIE9iamVj\ndC5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAg\nICAgICAgICAgICAgICAgICAicGNHZXRTdGF0ZU1hbmFnZXIiLCBTdGF0ZU1h\nbmFnZXIuY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgLy8gWFhYIG90aGVyID0gKFhYWCkgcGM7CiAgICAgICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoX3BjKTsKICAgICAgICAg\nICAgICAgIGluc3QgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAg\nICAgICAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpbnN0KTsKCiAg\nICAgICAgICAgICAgICAvLyBhY2Nlc3MgdGhlIG90aGVyJ3Mgc20gZmllbGQg\nZGlyZWN0bHkKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChpbnN0KTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRG\naWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gaWYgKG90aGVyLnBjU3RhdGVNYW5hZ2VyICE9IHBjU3RhdGVNYW5hZ2Vy\nKQogICAgICAgICAgICAvLwl0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uCgogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxk\nKFNNLCBTTVRZUEUpOwogICAgICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZp\nbnMgPSBjb2RlLmlmYWNtcGVxKCk7CiAgICAgICAgICAgIHRocm93RXhjZXB0\naW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAg\nICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKCiAgICAg\nICAgICAgIC8vIGlmIChwY1N0YXRlTWFuYWdlciA9PSBudWxsKQogICAgICAg\nICAgICAvLyAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbgogICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUp\nOwogICAgICAgICAgICBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAg\nICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxTdGF0ZUV4Y2Vw\ndGlvbi5jbGFzcyk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2Rl\nLm5vcCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIGZvciAoaW50IGkgPSAw\nOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAg\nICBpbnQgaWR4ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAg\nICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKGlkeCk7CiAgICAgICAgSnVtcElu\nc3RydWN0aW9uIHRlc3RpbnMgPSBjb2RlLmdvMigpOwoKICAgICAgICAvLyA8\nbWV0aG9kPiAoZmllbGRzW2ldKTsKICAgICAgICBJbnN0cnVjdGlvbiBib2R5\naW5zID0gbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgaWYgKGNvcHkpCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChpbnN0KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oZmllbGRO\ndW1iZXJzKTsKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwoaWR4KTsK\nICAgICAgICBjb2RlLmlhbG9hZCgpOwogICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChzaW5nbGUpOwoKICAgICAgICAvLyBpKys7CiAg\nICAgICAgY29kZS5paW5jKCkuc2V0SW5jcmVtZW50KDEpLnNldExvY2FsKGlk\neCk7CgogICAgICAgIC8vIGkgPCBmaWVsZHMubGVuZ3RoCiAgICAgICAgdGVz\ndGlucy5zZXRUYXJnZXQoY29kZS5pbG9hZCgpLnNldExvY2FsKGlkeCkpOwog\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbShmaWVsZE51bWJlcnMpOwog\nICAgICAgIGNvZGUuYXJyYXlsZW5ndGgoKTsKICAgICAgICBjb2RlLmlmaWNt\ncGx0KCkuc2V0VGFyZ2V0KGJvZHlpbnMpOwogICAgICAgIGNvZGUudnJldHVy\nbigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgdGhlICdzdG9jaycgbWV0aG9kcyB0byB0aGUgYnl0ZWNv\nZGU7IHRoZXNlIGluY2x1ZGUgbWV0aG9kcwogICAgICogbGlrZSB7QGxpbmsg\nUGVyc2lzdGVuY2VDYXBhYmxlI3BjRmV0Y2hPYmplY3RJZH0KICAgICAqIGFu\nZCB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjSXNUcmFuc2FjdGlvbmFs\nfS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN0b2NrTWV0aG9kcygp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgLy8gcGNHZXRHZW5lcmljQ29udGV4dAog\nICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAog\nICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAg\nICAgIFNNVFlQRSwgImdldCIgKyBDT05URVhUTkFNRSwgKENsYXNzW10pIG51\nbGwpKSwgZmFsc2UpOwogICAgCiAgICAgICAgICAgIC8vIHBjRmV0Y2hPYmpl\nY3RJZAogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0\naG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgIFNNVFlQRSwgImZldGNoT2JqZWN0SWQiLCAoQ2xhc3NbXSkg\nbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc0RlbGV0\nZWQKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhv\nZCgKICAgICAgICAgICAgICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICBTTVRZUEUsICJpc0RlbGV0ZWQiLCAoQ2xhc3NbXSkgbnVsbCkp\nLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc0RpcnR5CiAgICAg\nICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAg\nICAgICAgICAgICAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRE\nZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nU01UWVBFLCAiaXNEaXJ0eSIsIChDbGFzc1tdKSBudWxsKSksIHRydWUpOwog\nICAgCiAgICAgICAgICAgIC8vIHBjSXNOZXcKICAgICAgICAgICAgdHJhbnNs\nYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIChN\nZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAg\nICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9k\nQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJpc05l\ndyIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAg\nICAvLyBwY0lzUGVyc2lzdGVudAogICAgICAgICAgICB0cmFuc2xhdGVGcm9t\nU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkg\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24o\nCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImlzUGVyc2lzdGVu\ndCIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAg\nICAvLyBwY0lzVHJhbnNhY3Rpb25hbAogICAgICAgICAgICB0cmFuc2xhdGVG\ncm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhv\nZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAg\nICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rp\nb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImlzVHJhbnNh\nY3Rpb25hbCIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAg\nICAgICAgICAvLyBwY1NlcmlhbGl6aW5nCiAgICAgICAgICAgIHRyYW5zbGF0\nZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0\naG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAg\nICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFj\ndGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAic2VyaWFs\naXppbmciLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAg\nICAgICAgLy8gcGNEaXJ0eQogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3Rh\ndGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAg\nICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAg\nICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImRpcnR5IiwgbmV3IENs\nYXNzW117IFN0cmluZy5jbGFzcyB9KSksIGZhbHNlKTsKICAgIAogICAgICAg\nICAgICAvLyBwY0dldFN0YXRlTWFuYWdlcgogICAgICAgICAgICBCQ01ldGhv\nZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldFN0YXRlTWFu\nYWdlciIsCiAgICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXIuY2xhc3MsIG51\nbGwpOwogICAgICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00s\nIFN0YXRlTWFuYWdlci5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVy\nbigpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAg\nfSBjYXRjaCAoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbiBwYWUpIHsKICAg\nICAgICAgICAgIHRocm93IChOb1N1Y2hNZXRob2RFeGNlcHRpb24pIHBhZS5n\nZXRFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCBhIHN0b2NrIG1ldGhvZCB0byB0aGUg\nYnl0ZWNvZGUuIEVhY2gKICAgICAqIHN0b2NrIG1ldGhvZCBzaW1wbHkgZGVs\nZWdhdGVzIHRvIGEgY29ycmVzcG9uZGluZyBTdGF0ZU1hbmFnZXIgbWV0aG9k\nLgogICAgICogR2l2ZW4gdGhlIFN0YXRlTWFuYWdlciBtZXRob2QsIHRoZW4s\nIHRoaXMgZnVuY3Rpb24gdHJhbnNsYXRlcyBpdCBpbnRvCiAgICAgKiB0aGUg\nd3JhcHBlciBtZXRob2QgdGhhdCBzaG91bGQgYmUgYWRkZWQgdG8gdGhlIGJ5\ndGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNsYXRlRnJv\nbVN0YXRlTWFuYWdlck1ldGhvZChNZXRob2QgbSwKICAgICAgICBib29sZWFu\nIGlzRGlydHlDaGVja01ldGhvZCkgewogICAgICAgIC8vIGZvcm0gdGhlIG5h\nbWUgb2YgdGhlIG1ldGhvZCBieSBwcmVwZW5kaW5nICdwYycgdG8gdGhlIHNt\nIG1ldGhvZAogICAgICAgIFN0cmluZyBuYW1lID0gUFJFICsgU3RyaW5nVXRp\nbHMuY2FwaXRhbGl6ZShtLmdldE5hbWUoKSk7CiAgICAgICAgQ2xhc3NbXSBw\nYXJhbXMgPSBtLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgQ2xhc3Mg\ncmV0dXJuVHlwZSA9IG0uZ2V0UmV0dXJuVHlwZSgpOwoKICAgICAgICAvLyBh\nZGQgdGhlIG1ldGhvZCB0byB0aGUgcGMKICAgICAgICBCQ01ldGhvZCBtZXRo\nb2QgPSBfcGMuZGVjbGFyZU1ldGhvZChuYW1lLCByZXR1cm5UeXBlLCBwYXJh\nbXMpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUp\nOwoKICAgICAgICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkgcmV0\ndXJuIDxkZWZhdWx0PjsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQo\nU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0g\nY29kZS5pZm5vbm51bGwoKTsKICAgICAgICBpZiAocmV0dXJuVHlwZS5lcXVh\nbHMoYm9vbGVhbi5jbGFzcykpCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShmYWxzZSk7CiAgICAgICAgZWxzZSBpZiAoIXJldHVyblR5\ncGUuZXF1YWxzKHZvaWQuY2xhc3MpKQogICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUueHJldHVybigpLnNldFR5\ncGUocmV0dXJuVHlwZSk7CgogICAgICAgIC8vIGlmIHRoaXMgaXMgdGhlIGRp\ncnR5LWNoZWNrIG1ldGhvZCBhbmQgd2UncmUgc3ViY2xhc3NpbmcgYnV0IG5v\ndAogICAgICAgIC8vIHJlZGVmaW5pbmcsIGhvb2sgaW50byBQQ0hlbHBlciB0\nbyBkbyB0aGUgZGlydHkgY2hlY2sKICAgICAgICBpZiAoaXNEaXJ0eUNoZWNr\nTWV0aG9kICYmICFnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgIC8vIFJl\nZGVmaW5pdGlvbkhlbHBlci5kaXJ0eUNoZWNrKHNtKTsKICAgICAgICAgICAg\naWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgICAgICBjb2RlLmR1cCgpOyAvLyBmb3IgdGhl\nIHJldHVybiBzdGF0ZW1lbnQgYmVsb3cKICAgICAgICAgICAgY29kZS5pbnZv\na2VzdGF0aWMoKS5zZXRNZXRob2QoUmVkZWZpbml0aW9uSGVscGVyLmNsYXNz\nLCAKICAgICAgICAgICAgICAgICJkaXJ0eUNoZWNrIiwgdm9pZC5jbGFzcywg\nbmV3IENsYXNzW10geyBTTVRZUEUgfSk7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIH0KICAgICAgICAKICAgICAg\nICAvLyByZXR1cm4gcGNTdGF0ZU1hbmFnZXIuPG1ldGhvZD4gKDxhcmdzPik7\nCiAgICAgICAgLy8gbWFuYWdlZCBpbnN0YW5jZSBsb2FkZWQgYWJvdmUgaW4g\naWYtZWxzZSBibG9jawogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFy\nYW1zLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0\nUGFyYW0oaSk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRN\nZXRob2QobSk7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShyZXR1\ncm5UeXBlKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxl\nI3BjR2V0VmVyc2lvbn0gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZEdldFZlcnNpb25NZXRob2QoKQogICAg\nICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRW\nZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAg\nICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAg\nICAgLy8gaWYgKHBjU3RhdGVNYW5hZ2VyID09IG51bGwpCiAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5n\nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJ\nbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSB2ZXJzaW9uRmllbGQgPSBfbWV0YS5nZXRWZXJzaW9u\nRmllbGQoKTsKCiAgICAgICAgaWYgKHZlcnNpb25GaWVsZCA9PSBudWxsKQog\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOyAvLyByZXR1\ncm4gbnVsbDsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gcmV0dXJu\nIDx2ZXJzaW9uRmllbGQ+OwogICAgICAgICAgICBDbGFzcyB3cmFwcGVyID0g\ndG9QcmltaXRpdmVXcmFwcGVyKHZlcnNpb25GaWVsZCk7CiAgICAgICAgICAg\nIGlmICh3cmFwcGVyICE9IHZlcnNpb25GaWVsZC5nZXREZWNsYXJlZFR5cGUo\nKSkgewogICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh3cmFw\ncGVyKTsKICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwg\ndmVyc2lvbkZpZWxkKTsKICAgICAgICAgICAgaWYgKHdyYXBwZXIgIT0gdmVy\nc2lvbkZpZWxkLmdldERlY2xhcmVkVHlwZSgpKQogICAgICAgICAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHdyYXBwZXIsICI8aW5p\ndD4iLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFz\nc1tdeyB2ZXJzaW9uRmllbGQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAg\nICAgfQogICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICAvLyByZXR1\ncm4gcGNTdGF0ZU1hbmFnZXIuZ2V0VmVyc2lvbiAoKTsKICAgICAgICBpZmlu\ncy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkp\nOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBF\nKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChT\nTVRZUEUsICJnZXRWZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAg\nICBudWxsKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHZlcnNpb24gZmllbGQgdHlwZSBhcyBhIHByaW1pdGl2ZSB3cmFwcGVyLCBv\nciBudWxsIGlmCiAgICAgKiB0aGUgdmVyc2lvbiBmaWVsZCBpcyBub3QgcHJp\nbWl0aXZlLgogICAgICovCiAgICBwcml2YXRlIENsYXNzIHRvUHJpbWl0aXZl\nV3JhcHBlcihGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgcmV0dXJuIEJv\nb2xlYW4uY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gQnl0ZS5jbGFzczsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBDaGFyYWN0ZXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRPVUJMRToKICAgICAgICAgICAgICAgIHJldHVybiBEb3VibGUuY2xhc3M7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAg\nICAgICAgcmV0dXJuIEZsb2F0LmNsYXNzOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gSW50ZWdlci5j\nbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAg\nICAgICAgICAgIHJldHVybiBMb25nLmNsYXNzOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBTaG9y\ndC5jbGFzczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNs\nYXJlZFR5cGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtA\nbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlU3RhdGVNYW5hZ2Vy\nfQogICAgICogbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZFJlcGxhY2VTdGF0ZU1hbmFnZXJNZXRob2QoKSB7\nCiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNSZXBsYWNlU3RhdGVNYW5hZ2Vy\nIChTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0g\nX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlJlcGxhY2VTdGF0ZU1hbmFnZXIi\nLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU01UWVBF\nIH0pOwogICAgICAgIG1ldGhvZC5zZXRTeW5jaHJvbml6ZWQodHJ1ZSk7CiAg\nICAgICAgbWV0aG9kLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9u\nKFNlY3VyaXR5RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgKHBjU3Rh\ndGVNYW5hZ2VyICE9IG51bGwpCiAgICAgICAgLy8JcGNTdGF0ZU1hbmFnZXIg\nPSBwY1N0YXRlTWFuYWdlci5yZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsKICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAg\nICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm51bGwoKTsKICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tl\naW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwgInJlcGxhY2VTdGF0ZU1h\nbmFnZXIiLAogICAgICAgICAgICBTTVRZUEUsIG5ldyBDbGFzc1tdeyBTTVRZ\nUEUgfSk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAvLyBT\nZWN1cml0eU1hbmFnZXIgc2VjID0gU3lzdGVtLmdldFNlY3VyaXR5TWFuYWdl\nciAoKTsKICAgICAgICAvLyBpZiAoc2VjICE9IG51bGwpCiAgICAgICAgLy8J\nCXNlYy5jaGVja1Blcm1pc3Npb24gKFBlcm1pc3Npb24uU0VUX1NUQVRFX01B\nTkFHRVIpOwogICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmludm9rZXN0\nYXRpYygpLnNldE1ldGhvZChTeXN0ZW0uY2xhc3MsCiAgICAgICAgICAgICJn\nZXRTZWN1cml0eU1hbmFnZXIiLCBTZWN1cml0eU1hbmFnZXIuY2xhc3MsIG51\nbGwpKTsKCiAgICAgICAgLy8gcGNTdGF0ZU1hbmFnZXIgPSBzbTsKICAgICAg\nICBpZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAg\nICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUgUGVyc2lzdGVu\nY2VDYXBhYmxlIG1ldGhvZHMgZGVhbGluZyB3aXRoIGFwcGxpY2F0aW9uCiAg\nICAgKiBpZGVudGl0eSBhbmQgZ2l2ZXMgdGhlbSBuby1vcCBpbXBsZW1lbnRh\ndGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROb09wQXBwbGlj\nYXRpb25JZGVudGl0eU1ldGhvZHMoKSB7CiAgICAgICAgLy8gcHVibGljIHZv\naWQgcGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0SWRGaWVsZFN1\ncHBsaWVyIGZzLAogICAgICAgIC8vIAlPYmplY3Qgb2lkKQogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5\nS2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tdeyBPSURGU1RZUEUsIE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwoKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVs\nZHNUb09iamVjdElkIChPYmplY3Qgb2lkKQogICAgICAgIG1ldGhvZCA9IF9w\nYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9PYmplY3RJ\nZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmpl\nY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRy\ndWUpOwogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBj\nQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0SWRGaWVsZENvbnN1\nbWVyIGZjLAogICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAgbWV0aG9k\nID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9t\nT2JqZWN0SWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3Nb\nXXsgT0lERkNUWVBFLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJldHVybigp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAg\nIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAo\nT2JqZWN0IG9pZCkKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7\nCiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAg\nIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdPYmplY3RJ\nZEluc3RhbmNlICgpCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIk5ld09iamVjdElkSW5zdGFuY2UiLAogICAgICAgICAgICBP\nYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgp\nOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwoKICAgICAgICAvLyBwdWJsaWMgT2JqZWN0IHBjTmV3T2JqZWN0SWRJ\nbnN0YW5jZSAoT2JqZWN0IG9iaikKICAgICAgICBtZXRob2QgPSBfcGMuZGVj\nbGFyZU1ldGhvZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIsCiAgICAg\nICAgICAgIE9iamVjdC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFz\ncyB9KTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2Rl\nLmFyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgdGhlIDxjb2RlPnBjQ29weUtleUZpZWxkc1Rv\nT2JqZWN0SWQ8L2NvZGU+IG1ldGhvZHMKICAgICAqIHRvIGNsYXNzZXMgdXNp\nbmcgYXBwbGljYXRpb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBhZGRDb3B5S2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZChib29sZWFu\nIGZpZWxkTWFuYWdlcikKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVs\nZHNUb09iamVjdElkIChPYmplY3RJZEZpZWxkU3VwcGxpZXIgZnMsCiAgICAg\nICAgLy8JT2JqZWN0IG9pZCkKICAgICAgICBTdHJpbmdbXSBhcmdzID0gKGZp\nZWxkTWFuYWdlcikgPwogICAgICAgICAgICBuZXcgU3RyaW5nW117IE9JREZT\nVFlQRS5nZXROYW1lKCksIE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfQogICAg\nICAgICAgICA6IG5ldyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdldE5hbWUo\nKSB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0\naG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAgICAg\nICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc2lu\nZ2xlIGZpZWxkIGlkZW50aXR5IGFsd2F5cyB0aHJvd3MgZXhjZXB0aW9uCiAg\nICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAg\nICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSU5URVJORVhDRVApOwogICAg\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgLy8gY2FsbCBzdXBlcmNsYXNzIG1ldGhvZAogICAgICAgIGlmIChf\nbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVT\ndWJjbGFzcygpKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGFyZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oaSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAg\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLAogICAgICAg\nICAgICAgICAgUFJFICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElkIiwgdm9p\nZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gT2JqZWN0IGlkID0gb2lkOwogICAgICAgIGlmIChmaWVsZE1hbmFnZXIp\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsK\nCiAgICAgICAgaWYgKF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpIHsK\nICAgICAgICAgICAgLy8gb2lkID0gKChPYmplY3RJZCkgaWQpLmdldElkICgp\nOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0\nSWQuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAg\nICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gPG9pZCB0eXBlPiBpZCA9ICg8b2lkIHR5cGU+KSBvaWQ7CiAgICAgICAg\naW50IGlkID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBD\nbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKG9pZFR5cGUpOwogICAgICAg\nIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaWQpOwoKICAgICAgICAvLyBpbnQg\naW5oZXJpdGVkID0gcGNJbmhlcml0ZWRGaWVsZENvdW50OwogICAgICAgIGlu\ndCBpbmhlcml0ZWQgPSAwOwogICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsK\nICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklU\nLCBpbnQuY2xhc3MpOwogICAgICAgICAgICBpbmhlcml0ZWQgPSBjb2RlLmdl\ndE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgICAgICBjb2RlLmlzdG9yZSgp\nLnNldExvY2FsKGluaGVyaXRlZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBp\nZC48ZmllbGQ+ID0gZnMuZmV0Y2g8dHlwZT5GaWVsZCAoPGluZGV4Pik7IG9y\nLi4uCiAgICAgICAgLy8gaWQuPGZpZWxkPiA9IHBjLjxmaWVsZD47CiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygp\nID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXRE\nZWNsYXJlZEZpZWxkcygpOwogICAgICAgIENsYXNzIHR5cGU7CiAgICAgICAg\nU3RyaW5nIG5hbWU7CiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAgICAgTWV0\naG9kIHNldHRlcjsKICAgICAgICBib29sZWFuIHJlZmxlY3Q7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwoaWQpOwoKICAgICAgICAgICAgbmFtZSA9IGZtZHNbaV0uZ2V0TmFt\nZSgpOwogICAgICAgICAgICB0eXBlID0gZm1kc1tpXS5nZXRPYmplY3RJZEZp\nZWxkVHlwZSgpOwogICAgICAgICAgICBpZiAoX21ldGEuZ2V0QWNjZXNzVHlw\nZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAg\nICAgICAgICBzZXR0ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgZmllbGQg\nPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCBuYW1lLCB0cnVlKTsK\nICAgICAgICAgICAgICAgIHJlZmxlY3QgPSAhTW9kaWZpZXIuaXNQdWJsaWMo\nZmllbGQuZ2V0TW9kaWZpZXJzKCkpOwogICAgICAgICAgICAgICAgaWYgKHJl\nZmxlY3QpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNsYXNzY29uc3Rh\nbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJl\nZmxlY3Rpb24uY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAiZmlu\nZEZpZWxkIiwgRmllbGQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xhc3MuY2xh\nc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5jbGFzcywgYm9v\nbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZpZWxkID0gbnVsbDsKICAgICAg\nICAgICAgICAgIHNldHRlciA9IFJlZmxlY3Rpb24uZmluZFNldHRlcihvaWRU\neXBlLCBuYW1lLCB0eXBlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJlZmxl\nY3QgPSAhTW9kaWZpZXIuaXNQdWJsaWMoc2V0dGVyLmdldE1vZGlmaWVycygp\nKTsKICAgICAgICAgICAgICAgIGlmIChyZWZsZWN0KSB7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mob2lkVHlw\nZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25z\ndGFudCgpLnNldENsYXNzKHR5cGUpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9u\nLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAgICAgImZpbmRTZXR0ZXIi\nLCBNZXRob2QuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xhc3MuY2xhc3MsCiAg\nICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5jbGFzcywgQ2xhc3MuY2xh\nc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsKICAg\nICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAg\nICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChpbmhlcml0ZWQpOwog\nICAgICAgICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZAogICAgICAgICAgICAg\nICAgICAgIChnZXRGaWVsZFN1cHBsaWVyTWV0aG9kKHR5cGUpKTsKICAgICAg\nICAgICAgICAgIGlmIChmbWRzW2ldLmdldE9iamVjdElkRmllbGRUeXBlQ29k\nZSgpID09IEphdmFUeXBlcy5PQkpFQ1QpIHsKICAgICAgICAgICAgICAgIAlj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAg\nICAgICAgICAgICAgCWNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChP\nYmplY3RJZC5jbGFzcywgImdldElkIiwgCiAgICAgICAgICAgIAkJCU9iamVj\ndC5jbGFzcywgbnVsbCk7ICAgICAgICAgICAgICAgIAkKICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgdHlwZSBvZiB0aGlz\nIGZpZWxkIG1ldGEgZGF0YSBpcwogICAgICAgICAgICAgICAgLy8gbm9uLXBy\naW1pdGl2ZSBhbmQgbm9uLXN0cmluZywgYmUgc3VyZSB0byBjYXN0CiAgICAg\nICAgICAgICAgICAvLyB0byB0aGUgYXBwcm9wcmlhdGUgdHlwZS4KICAgICAg\nICAgICAgICAgIGlmICghcmVmbGVjdCAmJiAhdHlwZS5pc1ByaW1pdGl2ZSgp\nCiAgICAgICAgICAgICAgICAgICAgJiYgIXR5cGUuZ2V0TmFtZSgpLmVxdWFs\ncyhTdHJpbmcuY2xhc3MuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRW\nYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CgogICAgICAgICAgICAgICAgLy8g\nZ2V0IGlkL3BrIGZyb20gcGMgaW5zdGFuY2UKICAgICAgICAgICAgICAgIGlm\nIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMu\nUEMpCiAgICAgICAgICAgICAgICAgICAgYWRkRXh0cmFjdE9iamVjdElkRmll\nbGRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGlmIChyZWZsZWN0ICYmIGZpZWxkICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJl\nZmxlY3Rpb24uY2xhc3MsICJzZXQiLCAKICAgICAgICAgICAgICAgICAgICB2\nb2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgRmllbGQu\nY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgKHR5cGUuaXNQcmltaXRpdmUo\nKSkgPyB0eXBlIDogT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICB9IGVs\nc2UgaWYgKHJlZmxlY3QpIHsgCiAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAic2V0Iiwg\nCiAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10g\neyBPYmplY3QuY2xhc3MsIE1ldGhvZC5jbGFzcywKICAgICAgICAgICAgICAg\nICAgICAodHlwZS5pc1ByaW1pdGl2ZSgpKSA/IHR5cGUgOiBPYmplY3QuY2xh\nc3MgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmllbGQgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChzZXR0ZXIpOwogICAgICAgIH0KICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgY29kZSB0byBleHRyYWN0IHRo\nZSBpZCBvZiB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgcmVsYXRpb24gZmllbGQg\nZm9yCiAgICAgKiBzZXR0aW5nIGludG8gYW4gb2JqZWN0aWQgaW5zdGFuY2Uu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRFeHRyYWN0T2JqZWN0SWRG\naWVsZFZhbHVlQ29kZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgcGspIHsK\nICAgICAgICAvLyBpZiAodmFsICE9IG51bGwpIAogICAgICAgIC8vICB2YWwg\nPSAoKFBlcnNpc3RlbmNlQ2FwYWJsZSkgdmFsKS5wY0ZldGNoT2JqZWN0SWQo\nKTsKICAgICAgICBpbnQgcGMgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgp\nOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwocGMpOwogICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChwYyk7CiAgICAgICAgSnVtcEluc3Ry\ndWN0aW9uIGlmbnVsbDEgPSBjb2RlLmlmbnVsbCgpOwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRMb2NhbChwYyk7CiAgICAgICAgY29kZS5jaGVja2Nhc3Qo\nKS5zZXRUeXBlKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcyk7IAogICAgICAg\nIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFBlcnNpc3RlbmNl\nQ2FwYWJsZS5jbGFzcywKICAgICAgICAgICAgUFJFICsgIkZldGNoT2JqZWN0\nSWQiLCBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIGludCBvaWQgPSBj\nb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3Jl\nKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9j\nYWwob2lkKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZudWxsMiA9IGNv\nZGUuaWZudWxsKCk7IAoKICAgICAgICAvLyBmb3IgZGF0YXN0b3JlIC8gc2lu\nZ2xlLWZpZWxkIGlkZW50aXR5OgogICAgICAgIC8vIGlmICh2YWwgIT0gbnVs\nbCkKICAgICAgICAvLyAgIHZhbCA9ICgoT3BlbkpQQUlkKSB2YWwpLmdldElk\nKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBwa21ldGEgPSBway5nZXREZWNs\nYXJlZFR5cGVNZXRhRGF0YSgpOwogICAgICAgIGludCBwa2NvZGUgPSBway5n\nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKTsKICAgICAgICBDbGFzcyBwa3R5\ncGUgPSBway5nZXRPYmplY3RJZEZpZWxkVHlwZSgpOwogICAgICAgIGlmIChw\na21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9E\nQVRBU1RPUkUgCiAgICAgICAgICAgICYmIHBrY29kZSA9PSBKYXZhVHlwZXMu\nTE9ORykgewogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lk\nKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKElkLmNs\nYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKElkLmNsYXNzLCAiZ2V0SWQiLCAKICAgICAgICAgICAgICAgIGxvbmcu\nY2xhc3MsIG51bGwpOwogICAgICAgIH0gZWxzZSBpZiAocGttZXRhLmdldElk\nZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFKSB7\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAg\nICAgIH0gZWxzZSBpZiAocGttZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsK\nICAgICAgICAgICAgc3dpdGNoIChwa2NvZGUpIHsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgICAg\nIGNvZGUuYW5ldygpLnNldFR5cGUoQnl0ZS5jbGFzcyk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBu\nbyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lk\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoQnl0ZUlkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQnl0ZUlkLmNsYXNzLCAiZ2V0SWQi\nLAogICAgICAgICAgICAgICAgICAgICAgICBieXRlLmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5C\nWVRFX09CSikKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKEJ5dGUuY2xhc3MsICI8aW5pdD4iLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNz\nW10ge2J5dGUuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoQ2hhcmFjdGVy\nLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOwogICAg\nICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShDaGFySWQuY2xhc3MpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChD\naGFySWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNoYXIuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChw\na2NvZGUgPT0gSmF2YVR5cGVzLkNIQVJfT0JKKQogICAgICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoQ2hhcmFj\ndGVyLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8aW5p\ndD4iLCB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7Y2hhci5jbGFzc30pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmFuZXcoKS5zZXRUeXBlKERvdWJsZS5jbGFzcyk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBu\nbyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxF\nOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChv\naWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0\nVHlwZShEb3VibGVJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKERvdWJsZUlkLmNsYXNzLCAi\nZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBkb3VibGUuY2xhc3Ms\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2\nYVR5cGVzLkRPVUJMRV9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChEb3VibGUuY2xhc3MsICI8\naW5pdD4iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xh\nc3MsIG5ldyBDbGFzc1tde2RvdWJsZS5jbGFzc30pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRkxPQVRfT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNl\ndFR5cGUoRmxvYXQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\nZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShGbG9hdElkLmNs\nYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoRmxvYXRJZC5jbGFzcywgImdldElkIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgZmxvYXQuY2xhc3MsIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkZMT0FUX09CSikK\nICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKEZsb2F0LmNsYXNzLCAiPGluaXQ+IiwgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXtmbG9h\ndC5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKEludGVnZXIuY2xhc3MpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAg\nICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLklOVDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2Fz\ndCgpLnNldFR5cGUoSW50SWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChJbnRJZC5jbGFzcywg\nImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgaW50LmNsYXNzLCBu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFU\neXBlcy5JTlRfT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoSW50ZWdlci5jbGFzcywgIjxpbml0\nPiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBu\nZXcgQ2xhc3NbXSB7aW50LmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09C\nSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKExv\nbmcuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAg\nICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKExvbmdJZC5jbGFzcyk7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKExvbmdJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgbG9uZy5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKHBrY29kZSA9PSBKYXZhVHlwZXMuTE9OR19PQkopCiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChMb25n\nLmNsYXNzLCAiPGluaXQ+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHtsb25nLmNsYXNzfSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgICAgICAgICAgY29kZS5h\nbmV3KCkuc2V0VHlwZShTaG9ydC5jbGFzcyk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVh\nawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFNo\nb3J0SWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChTaG9ydElkLmNsYXNzLCAiZ2V0SWQiLAog\nICAgICAgICAgICAgICAgICAgICAgICBzaG9ydC5jbGFzcywgbnVsbCk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuU0hP\nUlRfT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2QoU2hvcnQuY2xhc3MsICI8aW5pdD4iLCAKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFz\nc1tde3Nob3J0LmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAg\nICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEYXRl\nSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChEYXRlSWQuY2xhc3MsICJnZXRJZCIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIERhdGUuY2xhc3MsIG51bGwpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShTdHJpbmdJZC5jbGFzcyk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmlu\nZ0lkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBT\ndHJpbmcuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lk\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoQmlnRGVjaW1hbElkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQmlnRGVjaW1hbElkLmNs\nYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBCaWdEZWNp\nbWFsSWQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lk\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoQmlnSW50ZWdlcklkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQmlnSW50ZWdlcklkLmNs\nYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBCaWdJbnRl\nZ2VySWQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChPYmplY3RJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZWxzZSBpZiAocGttZXRhLmdldE9iamVjdElkVHlwZSgp\nICE9IG51bGwpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2Fs\nKG9pZCk7CiAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLk9C\nSkVDVCkgewogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChPYmplY3RJZC5jbGFzcywgImdldElk\nIiwgCiAgICAgICAgICAgIAkJCU9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAg\nICAgICAgIH0gCiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShwa3R5cGUpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24g\nZ28yID0gY29kZS5nbzIoKTsKCiAgICAgICAgLy8gaWYgKHZhbCA9PSBudWxs\nKQogICAgICAgIC8vICAgdmFsID0gPGRlZmF1bHQ+OwogICAgICAgIEluc3Ry\ndWN0aW9uIGRlZjsKICAgICAgICBzd2l0Y2ggKHBrY29kZSkgewogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAg\nZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZhbHNlKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKChieXRlKSAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAg\nZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKChjaGFyKSAwKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5ET1VCTEU6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAg\nZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBGKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6\nCiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoMCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUu\nY29uc3RhbnQoKS5zZXRWYWx1ZSgwTCk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAg\nICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoKHNob3J0\nKSAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNl\ndE51bGwoKTsKICAgICAgICB9CiAgICAgICAgaWZudWxsMS5zZXRUYXJnZXQo\nZGVmKTsKICAgICAgICBpZm51bGwyLnNldFRhcmdldChkZWYpOwogICAgICAg\nIGdvMi5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGRzIHRoZSA8Y29kZT5wY0NvcHlLZXlGaWVsZHNGcm9tT2JqZWN0\nSWQ8L2NvZGU+IG1ldGhvZHMKICAgICAqIHRvIGNsYXNzZXMgdXNpbmcgYXBw\nbGljYXRpb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGRDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkTWV0aG9kKGJvb2xlYW4gZmll\nbGRNYW5hZ2VyKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zy\nb21PYmplY3RJZCAoT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZjLAogICAgICAg\nIC8vCU9iamVjdCBvaWQpCiAgICAgICAgU3RyaW5nW10gYXJncyA9IChmaWVs\nZE1hbmFnZXIpIAogICAgICAgICAgICA/ICBuZXcgU3RyaW5nW117IE9JREZD\nVFlQRS5nZXROYW1lKCksIE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfQogICAg\nICAgICAgICA6IG5ldyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdldE5hbWUo\nKSB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0\naG9kKFBSRSArICJDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIiwKICAgICAg\nICAgICAgdm9pZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIENv\nZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBj\nYWxsIHN1cGVyY2xhc3MgbWV0aG9kCiAgICAgICAgaWYgKF9tZXRhLmdldFBD\nU3VwZXJjbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkp\nIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJncy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbShpKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpKS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBQ\nUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsIHZvaWQuY2xhc3Mu\nZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICB9CgogICAgICAgIGlmIChmaWVs\nZE1hbmFnZXIpCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgx\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgwKTsKCiAgICAgICAgaWYgKCFfbWV0YS5pc09wZW5KUEFJZGVudGl0\neSgpICYmIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpIHsKICAgICAg\nICAgICAgLy8gb2lkID0gKChPYmplY3RJZCkgaWQpLmdldElkICgpOwogICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xh\nc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICBP\nYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgLy8gPG9p\nZCB0eXBlPiBjYXN0ID0gKDxvaWQgdHlwZT4pIG9pZDsKICAgICAgICBpbnQg\naWQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIENsYXNz\nIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUob2lkVHlwZSk7CiAgICAgICAgY29k\nZS5hc3RvcmUoKS5zZXRMb2NhbChpZCk7CgogICAgICAgIC8vIGZzLnN0b3Jl\nPHR5cGU+RmllbGQgKDxpbmRleD4sIGlkLjxmaWVsZD4pOyBvci4uLgogICAg\nICAgIC8vIHRoaXMuPGZpZWxkPiA9IGlkLjxmaWVsZD4KICAgICAgICAvLyBv\nciBmb3Igc2luZ2xlIGZpZWxkIGlkZW50aXR5OiBpZC5nZXRJZCAoKQogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0Q3JlYXRlU3ViY2xhc3Mo\nKSA/IF9tZXRhLmdldEZpZWxkcygpCiAgICAgICAgICAgIDogX21ldGEuZ2V0\nRGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBTdHJpbmcgbmFtZTsKICAgICAg\nICBDbGFzcyB0eXBlOwogICAgICAgIENsYXNzIHVud3JhcHBlZDsKICAgICAg\nICBGaWVsZCBmaWVsZDsKICAgICAgICBNZXRob2QgZ2V0dGVyOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIG5hbWUgPSBmbWRzW2ld\nLmdldE5hbWUoKTsKICAgICAgICAgICAgdHlwZSA9IGZtZHNbaV0uZ2V0T2Jq\nZWN0SWRGaWVsZFR5cGUoKTsKICAgICAgICAgICAgaWYgKCFmaWVsZE1hbmFn\nZXIgCiAgICAgICAgICAgICAgICAmJiBmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpIHsKICAgICAgICAgICAgICAgIC8v\nIHNtLmdldFBDUHJpbWFyeUtleShvaWQsIGkgKyBwY0luaGVyaXRlZEZpZWxk\nQ291bnQpOyAKICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgY29kZS5kdXAoKTsgLy8g\nbGVhdmUgb3JpZyBvbiBzdGFjayB0byBzZXQgdmFsdWUgaW50bwogICAgICAg\nICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUp\nOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGlkKTsK\nICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsK\nICAgICAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5I\nRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuaWFkZCgp\nOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRN\nZXRob2QoU3RhdGVNYW5hZ2VyLmNsYXNzLCAKICAgICAgICAgICAgICAgICAg\nICAiZ2V0UENQcmltYXJ5S2V5IiwgT2JqZWN0LmNsYXNzLCAKICAgICAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgaW50LmNs\nYXNzIH0pOwogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICB9\nIGVsc2UgeyAKICAgICAgICAgICAgICAgIHVud3JhcHBlZCA9IChmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpIAogICAg\nICAgICAgICAgICAgICAgID8gdHlwZSA6IHVud3JhcFNpbmdsZUZpZWxkSWRl\nbnRpdHkoZm1kc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGRNYW5h\nZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZShpKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdldHN0YXRp\nYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UK\nICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKCiAgICAgICAgICAgICAgICBpZiAodW53cmFwcGVkICE9IHR5\ncGUpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBl\nKHR5cGUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwoaWQpOwogICAgICAgICAgICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQ\nQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob2lkVHlw\nZSA9PSBPYmplY3RJZC5jbGFzcykgewogICAgICAgICAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qob2lkVHlwZSwgImdl\ndElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5jbGFz\ncywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZmllbGRN\nYW5hZ2VyICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNb\naV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0g\nZWxzZSBpZiAob2lkVHlwZSA9PSBEYXRlSWQuY2xhc3MpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKG9pZFR5cGUsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBEYXRlLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKCFmaWVsZE1hbmFnZXIgJiYgdHlwZSAhPSBEYXRlLmNsYXNzKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiZ2V0SWQiLCAK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcHBlZCwgbnVsbCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bndyYXBwZWQgIT0gdHlw\nZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3Bl\nY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+IiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsg\ndW53cmFwcGVkIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENs\nYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKXsKICAgICAgICAgICAgICAgICAg\nICBmaWVsZCA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKG9pZFR5cGUsIG5hbWUs\nIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChNb2RpZmllci5pc1B1\nYmxpYyhmaWVsZC5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIFJlZmxlY3Rpb24uZ2V0WFhYKG9pZCwgUmVmbGVjdGlvbi5maW5kRmll\nbGQoLi4uKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Nj\nb25zdGFudCgpLnNldENsYXNzKG9pZFR5cGUpOwogICAgICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICJmaW5kRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3\nIENsYXNzW10geyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNz\nLmNsYXNzLCBTdHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0\naG9kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZ2V0UmVmbGVjdGlv\nbkdldHRlck1ldGhvZCh0eXBlLCBGaWVsZC5jbGFzcykpOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBl\nICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIGdldHRlciA9IFJlZmxlY3Rpb24uZmluZEdldHRlcihvaWRU\neXBlLCBuYW1lLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoTW9k\naWZpZXIuaXNQdWJsaWMoZ2V0dGVyLmdldE1vZGlmaWVycygpKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKGdldHRlcik7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIFJlZmxlY3Rpb24uZ2V0WFhYKG9pZCwg\nUmVmbGVjdGlvbi5maW5kR2V0dGVyKC4uLikpOwogICAgICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBl\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24u\nY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmluZEdldHRl\nciIsIE1ldGhvZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9v\nbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5p\nbnZva2VzdGF0aWMoKS5zZXRNZXRob2QKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIChnZXRSZWZsZWN0aW9uR2V0dGVyTWV0aG9kKHR5cGUsIE1ldGhv\nZC5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXR5cGUu\naXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZSh0eXBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZE1hbmFn\nZXIpCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNl\ndE1ldGhvZChnZXRGaWVsZENvbnN1bWVyTWV0aG9kKHR5cGUpKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVl\nQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICB9CiAgICAgICAgY29kZS52\ncmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGlmIHRoZSBjbGFzcyB1c2VzIHRoZSBDbGFz\ncy9TdHJpbmcgY29uc3RydWN0b3IKICAgICAqIGluc3RlYWQgb2YganVzdCBT\ndHJpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgQm9vbGVhbiB1c2VzQ2xhc3NT\ndHJpbmdJZENvbnN0cnVjdG9yKCkgewogICAgICAgIGlmIChfbWV0YS5nZXRJ\nZGVudGl0eVR5cGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9O\nKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKCiAgICAgICAg\naWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAg\naWYgKF9tZXRhLmdldE9iamVjdElkVHlwZSgpID09IE9iamVjdElkLmNsYXNz\nKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJl\ndHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgfQoKICAgICAgICBDbGFzcyBv\naWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgb2lkVHlwZS5nZXRDb25zdHJ1Y3RvcihuZXcgQ2xh\nc3NbXXsgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAg\nICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICB9IGNhdGNoIChUaHJv\nd2FibGUgdCkgewogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAg\nICBvaWRUeXBlLmdldENvbnN0cnVjdG9yKG5ldyBDbGFzc1tdeyBTdHJpbmcu\nY2xhc3MgfSk7CiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwog\nICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhl\nIGdpdmVuIGZpZWxkIGlzIGEgd3JhcHBlci10eXBlIHNpbmdsZSBmaWVsZCBp\nZGVudGl0eSBwcmltYXJ5IGtleSwKICAgICAqIHJldHVybiBpdHMgY29ycmVz\ncG9uZGluZyBwcmltaXRpdmUgY2xhc3MuIEVsc2UgcmV0dXJuIHRoZSBmaWVs\nZCB0eXBlLgogICAgICovCiAgICBwcml2YXRlIENsYXNzIHVud3JhcFNpbmds\nZUZpZWxkSWRlbnRpdHkoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBp\nZiAoIWZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCkuaXNPcGVuSlBBSWRlbnRp\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5cGUo\nKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGJ5dGUuY2xhc3M7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGNoYXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJM\nRV9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gZG91YmxlLmNsYXNzOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmxvYXQuY2xhc3M7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gaW50\nLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6\nCiAgICAgICAgICAgICAgICByZXR1cm4gc2hvcnQuY2xhc3M7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGxvbmcuY2xhc3M7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJvcGVy\nIGdldHRlciBtZXRob2Qgb2YgdGhlIHtAbGluayBSZWZsZWN0aW9ufSBoZWxw\nZXIgZm9yCiAgICAgKiBhIGZpZWxkIG9yIGdldHRlciBtZXRob2Qgb2YgdGhl\nIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldFJl\nZmxlY3Rpb25HZXR0ZXJNZXRob2QoQ2xhc3MgdHlwZSwgQ2xhc3MgYXJnVHlw\nZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAg\nICAgICBTdHJpbmcgbmFtZSA9ICJnZXQiOwogICAgICAgIGlmICh0eXBlLmlz\nUHJpbWl0aXZlKCkpCiAgICAgICAgICAgIG5hbWUgKz0gU3RyaW5nVXRpbHMu\nY2FwaXRhbGl6ZSh0eXBlLmdldE5hbWUoKSk7CiAgICAgICAgcmV0dXJuIFJl\nZmxlY3Rpb24uY2xhc3MuZ2V0TWV0aG9kKG5hbWUsIG5ldyBDbGFzc1tdIHsg\nT2JqZWN0LmNsYXNzLCAKICAgICAgICAgICAgYXJnVHlwZSB9KTsgCiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByb3BlciBmZXRjaCBtZXRo\nb2Qgb2YgdGhlIE9iamVjdElkRmllbGRTdXBwbGllciBmb3IKICAgICAqIGEg\nZmllbGQgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUg\nTWV0aG9kIGdldEZpZWxkU3VwcGxpZXJNZXRob2QoQ2xhc3MgdHlwZSkKICAg\nICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gZ2V0TWV0aG9kKE9JREZTVFlQRSwgdHlwZSwgImZldGNoIiwgdHJ1\nZSwgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgcHJvcGVyIGZldGNoIG1ldGhvZCBvZiB0aGUgT2JqZWN0SWRGaWVs\nZENvbnN1bWVyIGZvcgogICAgICogYSBmaWVsZCBvZiB0aGUgZ2l2ZW4gdHlw\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBNZXRob2QgZ2V0RmllbGRDb25zdW1l\nck1ldGhvZChDbGFzcyB0eXBlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIHJldHVybiBnZXRNZXRob2QoT0lERkNU\nWVBFLCB0eXBlLCAic3RvcmUiLCBmYWxzZSwgZmFsc2UsIGZhbHNlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHBjTmV3T2JqZWN0SWRJbnN0\nYW5jZSBtZXRob2QgdG8gY2xhc3NlcyB1c2luZwogICAgICogYXBwbGljYXRp\nb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROZXdP\nYmplY3RJZEluc3RhbmNlTWV0aG9kKGJvb2xlYW4gb2JqKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1Ymxp\nYyBPYmplY3QgcGNOZXdPYmplY3RJZEluc3RhbmNlICgpCiAgICAgICAgQ2xh\nc3NbXSBhcmdzID0gKG9iaikgPyBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNz\nIH0gOiBudWxsOwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArICJOZXdPYmplY3RJZEluc3RhbmNlIiwKICAgICAg\nICAgICAgT2JqZWN0LmNsYXNzLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgQm9vbGVhbiB1c2Vz\nQ2xzU3RyaW5nID0gdXNlc0NsYXNzU3RyaW5nSWRDb25zdHJ1Y3RvcigpOwog\nICAgICAgIENsYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUo\nKTsKICAgICAgICBpZiAob2JqICYmIHVzZXNDbHNTdHJpbmcgPT0gbnVsbCkg\newogICAgICAgICAgICAvLyB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uICguLi4pOwogICAgICAgICAgICBTdHJpbmcgbXNnID0gX2xvYy5n\nZXQoInN0ci1jb25zIiwgb2lkVHlwZSwKICAgICAgICAgICAgICAgIF9tZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSkuZ2V0TWVzc2FnZSgpOwogICAgICAgICAg\nICBjb2RlLmFuZXcoKS5zZXRUeXBlKElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShtc2cpOwogICAgICAgICAgICBj\nb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoSWxsZWdhbEFyZ3VtZW50\nRXhjZXB0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgIjxpbml0PiIsIHZv\naWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSk7CiAgICAg\nICAgICAgIGNvZGUuYXRocm93KCk7CiAgICAgICAgICAgIGNvZGUudnJldHVy\nbigpOwoKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIV9tZXRhLmlz\nT3BlbkpQQUlkZW50aXR5KCkgJiYgX21ldGEuaXNPYmplY3RJZFR5cGVTaGFy\nZWQoKSkgewogICAgICAgICAgICAvLyBuZXcgT2JqZWN0SWQgKGNscywgb2lk\nKQogICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKE9iamVjdElkLmNs\nYXNzKTsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29k\nZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0YSkpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gbmV3IDxvaWQgY2xhc3M+ICgpOwogICAg\nICAgIGNvZGUuYW5ldygpLnNldFR5cGUob2lkVHlwZSk7CiAgICAgICAgY29k\nZS5kdXAoKTsKICAgICAgICBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRpdHko\nKSB8fCAob2JqICYmIHVzZXNDbHNTdHJpbmcgPT0gQm9vbGVhbi5UUlVFKSkK\nICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZ2V0\nVHlwZShfbWV0YSkpOwogICAgICAgIGlmIChvYmopIHsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUoU3RyaW5nLmNsYXNzKTsKICAgICAgICAgICAg\naWYgKHVzZXNDbHNTdHJpbmcgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAg\nICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgU3RyaW5n\nLmNsYXNzIH07CiAgICAgICAgICAgIGVsc2UgaWYgKHVzZXNDbHNTdHJpbmcg\nPT0gQm9vbGVhbi5GQUxTRSkKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcg\nQ2xhc3NbXXsgU3RyaW5nLmNsYXNzIH07CiAgICAgICAgfSBlbHNlIGlmIChf\nbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAgIC8vIG5l\ndyA8dHlwZT5JZGVudGl0eSAoWFhYLmNsYXNzLCA8cGs+KTsKICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGEgcGsgPSBfbWV0YS5nZXRQcmltYXJ5S2V5Rmll\nbGRzKClbMF07CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUo\nY29kZSwgcGspOwogICAgICAgICAgICBpZiAocGsuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgICAgIGFkZEV4\ndHJhY3RPYmplY3RJZEZpZWxkVmFsdWVDb2RlKGNvZGUsIHBrKTsKICAgICAg\nICAgICAgaWYgKF9tZXRhLmdldE9iamVjdElkVHlwZSgpID09IE9iamVjdElk\nLmNsYXNzKQogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBD\nbGFzcy5jbGFzcywgT2JqZWN0LmNsYXNzIH07CiAgICAgICAgICAgIGVsc2Ug\naWYgKF9tZXRhLmdldE9iamVjdElkVHlwZSgpID09IERhdGUuY2xhc3MpCiAg\nICAgICAgICAgICAgICBhcmdzID0gbmV3IENsYXNzW117IENsYXNzLmNsYXNz\nLCBEYXRlLmNsYXNzIH07CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIHBrLmdldE9i\namVjdElkRmllbGRUeXBlKCkgfTsKICAgICAgICB9CgogICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiPGluaXQ+Iiwg\ndm9pZC5jbGFzcywgYXJncyk7CiAgICAgICAgaWYgKCFfbWV0YS5pc09wZW5K\nUEFJZGVudGl0eSgpICYmIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkp\nCiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChP\nYmplY3RJZC5jbGFzcywgIjxpbml0PiIsCiAgICAgICAgICAgICAgICB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIE9iamVjdC5jbGFz\ncyB9KTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGVuIGNvbW11bmlj\nYXRpbmcgd2l0aCB0aGUgU3RhdGVNYW5hZ2VyLCBtYW55IG1ldGhvZHMgYXJl\nIHVzZWQKICAgICAqIGRlcGVuZGluZyBvbiB0aGUgY2xhc3Mgb2Ygc3RhdGUg\nYmVpbmcgcGFzc2VkLiBUaGlzIG1ldGhvZCwKICAgICAqIGdpdmVuIHRoZSB0\neXBlIG9mIGluZm9ybWF0aW9uIGJlaW5nIHBhc3NlZCBhbmQgdGhlIHByZWZp\neAogICAgICogKCdwcm92aWRlZCcsICdyZXBsYWNlJywgZXRjKSBvZiB0aGUg\nbWV0aG9kIHRvCiAgICAgKiBjYWxsLCByZXR1cm5zIHRoZSBTdGF0ZU1hbmFn\nZXIgbWV0aG9kIHRoYXQgc2hvdWxkIGJlIHVzZWQuCiAgICAgKgogICAgICog\nQHBhcmFtIHR5cGUgdGhlIHR5cGUgb2Ygc3RhdGUgYmVpbmcgcGFzc2VkCiAg\nICAgKiBAcGFyYW0gcHJlZml4IHRoZSBwcmVmaXggb2YgdGhlIG1ldGhvZCB0\nbyBjYWxsOyBhbGwgbWV0aG9kcwogICAgICogZW5kIGluICdbc3RhdGUgdHlw\nZV1GaWVsZCc7IG9ubHkgdGhlIHByZWZpeCB2YXJpZXMKICAgICAqIEBwYXJh\nbSBnZXQgdHJ1ZSBpZiByZWNlaXZpbmcgaW5mb3JtYXRpb24gZnJvbSB0aGUK\nICAgICAqIFN0YXRlTWFuYWdlciwgZmFsc2UgaWYgcGFzc2luZyBpdCB0byB0\naGUgU00KICAgICAqIEBwYXJhbSBjdXJWYWx1ZSB0cnVlIGlmIHRoZSBjdXJy\nZW50IHN0YXRlIHZhbHVlIGlzIHBhc3NlZCB0bwogICAgICogdGhlIFN0YXRl\nTWFuYWdlciBhcyBhbiBleHRyYSBhcmd1bWVudAogICAgICovCiAgICBwcml2\nYXRlIE1ldGhvZCBnZXRTdGF0ZU1hbmFnZXJNZXRob2QoQ2xhc3MgdHlwZSwg\nU3RyaW5nIHByZWZpeCwKICAgICAgICBib29sZWFuIGdldCwgYm9vbGVhbiBj\ndXJWYWx1ZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gZ2V0TWV0aG9kKFNNVFlQRSwgdHlwZSwgcHJl\nZml4LCBnZXQsIHRydWUsIGN1clZhbHVlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgbWV0aG9kIG9mIHRoZSBnaXZlbiBvd25lciB0eXBl\nIG1hdGNoaW5nIHRoZSBnaXZlbiBjcml0ZXJpYS4KICAgICAqCiAgICAgKiBA\ncGFyYW0gdHlwZSB0aGUgdHlwZSBvZiBzdGF0ZSBiZWluZyBwYXNzZWQKICAg\nICAqIEBwYXJhbSBwcmVmaXggdGhlIHByZWZpeCBvZiB0aGUgbWV0aG9kIHRv\nIGNhbGw7IGFsbCBtZXRob2RzCiAgICAgKiBlbmQgaW4gJ1tzdGF0ZSB0eXBl\nXUZpZWxkJzsgb25seSB0aGUgcHJlZml4IHZhcmllcwogICAgICogQHBhcmFt\nIGdldCB0cnVlIGlmIHJlY2VpdmluZyBpbmZvcm1hdGlvbiBmcm9tIHRoZQog\nICAgICogb3duZXIsIGZhbHNlIGlmIHBhc3NpbmcgaXQgdG8gdGhlIG93bmVy\nCiAgICAgKiBAcGFyYW0gaGFzcGMgdHJ1ZSBpZiB0aGUgcGMgaXMgcGFzc2Vk\nIGFzIGFuIGV4dHJhIGFyZ3VtZW50CiAgICAgKiBAcGFyYW0gY3VyVmFsdWUg\ndHJ1ZSBpZiB0aGUgY3VycmVudCBzdGF0ZSB2YWx1ZSBpcyBwYXNzZWQgdG8K\nICAgICAqIHRoZSBvd25lciBhcyBhbiBleHRyYSBhcmd1bWVudAogICAgICov\nCiAgICBwcml2YXRlIE1ldGhvZCBnZXRNZXRob2QoQ2xhc3Mgb3duZXIsIENs\nYXNzIHR5cGUsIFN0cmluZyBwcmVmaXgsCiAgICAgICAgYm9vbGVhbiBnZXQs\nIGJvb2xlYW4gaGFzcGMsIGJvb2xlYW4gY3VyVmFsdWUpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYWxsIG1l\ndGhvZHMgZW5kIGluIFtmaWVsZCB0eXBlXUZpZWxkLCB3aGVyZSB0aGUgZmll\nbGQgdHlwZQogICAgICAgIC8vIGNhbiBiZSBhbnkgb2YgdGhlIHByaW1pdHZl\nIHR5cGVzIChidXQgY2FwaXRhbGl6ZWQpLCAnU3RyaW5nJywKICAgICAgICAv\nLyBvciAnT2JqZWN0JzsgZmlndXJlIG91dCB3aGF0IHR5cGUgdG8gdXNlCiAg\nICAgICAgU3RyaW5nIHR5cGVOYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAg\nICAgaWYgKHR5cGUuaXNQcmltaXRpdmUoKSkKICAgICAgICAgICAgdHlwZU5h\nbWUgPSB0eXBlTmFtZS5zdWJzdHJpbmcoMCwgMSkudG9VcHBlckNhc2UoKQog\nICAgICAgICAgICAgICAgKyB0eXBlTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAg\nICAgZWxzZSBpZiAodHlwZS5lcXVhbHMoU3RyaW5nLmNsYXNzKSkKICAgICAg\nICAgICAgdHlwZU5hbWUgPSAiU3RyaW5nIjsKICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgdHlwZU5hbWUgPSAiT2JqZWN0IjsKICAgICAgICAgICAgdHlw\nZSA9IE9iamVjdC5jbGFzczsKICAgICAgICB9CgogICAgICAgIC8vIHRoZSBm\naWVsZCBpbmRleCBpcyBhbHdheXMgcGFzc2VkIGFzIGFuIGFyZzsgdGhlIHBj\nIGluc3RhbmNlIGFuZAogICAgICAgIC8vIHRoZSBjdXJyZW50IHZhbHVlIG1h\neSBiZSBwYXNzZWQ7IGlmIHNldHRpbmcgdGhlIG5ldyB2YWx1ZSBpcwogICAg\nICAgIC8vIGFsc28gcGFzc2VkCiAgICAgICAgTGlzdCBwbGlzdCA9IG5ldyBB\ncnJheUxpc3QoNCk7CiAgICAgICAgaWYgKGhhc3BjKQogICAgICAgICAgICBw\nbGlzdC5hZGQoUENUWVBFKTsKICAgICAgICBwbGlzdC5hZGQoaW50LmNsYXNz\nKTsKICAgICAgICBpZiAoIWdldCB8fCBjdXJWYWx1ZSkKICAgICAgICAgICAg\ncGxpc3QuYWRkKHR5cGUpOwogICAgICAgIGlmICghZ2V0ICYmIGN1clZhbHVl\nKSB7CiAgICAgICAgICAgIHBsaXN0LmFkZCh0eXBlKTsKICAgICAgICAgICAg\ncGxpc3QuYWRkKGludC5jbGFzcyk7CiAgICAgICAgfQoKICAgICAgICAvLyB1\nc2UgcmVmbGVjdGlvbiB0byByZXR1cm4gdGhlIHJpZ2h0IG1ldGhvZAogICAg\nICAgIFN0cmluZyBuYW1lID0gcHJlZml4ICsgdHlwZU5hbWUgKyAiRmllbGQi\nOwogICAgICAgIENsYXNzW10gcGFyYW1zID0gKENsYXNzW10pIHBsaXN0LnRv\nQXJyYXkobmV3IENsYXNzW3BsaXN0LnNpemUoKV0pOwogICAgICAgIAogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAoTWV0aG9kKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKG93bmVyLCBuYW1l\nLCBwYXJhbXMpKTsKICAgICAgICB9IGNhdGNoIChQcml2aWxlZ2VkQWN0aW9u\nRXhjZXB0aW9uIHBhZSkgewogICAgICAgICAgICAgdGhyb3cgKE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbikgcGFlLmdldEV4Y2VwdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIHRo\nZSBjb2RlIG5lY2Vzc2FyeSB0byB0aHJvdyB0aGUgZ2l2ZW4KICAgICAqIGV4\nY2VwdGlvbiB0eXBlLCBzYW5zIG1lc3NhZ2UuCiAgICAgKi8KICAgIHByaXZh\ndGUgSW5zdHJ1Y3Rpb24gdGhyb3dFeGNlcHRpb24oQ29kZSBjb2RlLCBDbGFz\ncyB0eXBlKSB7CiAgICAgICAgSW5zdHJ1Y3Rpb24gaW5zID0gY29kZS5hbmV3\nKCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+\nIiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgY29kZS5hdGhyb3coKTsK\nICAgICAgICByZXR1cm4gaW5zOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\ncyB0aGUgUGVyc2lzdGVuY2VDYXBhYmxlIGludGVyZmFjZSB0byB0aGUgY2xh\nc3MgYmVpbmcKICAgICAqIGVuaGFuY2VkLCBhbmQgYWRkcyBhIGRlZmF1bHQg\nY29uc3RydWN0b3IgZm9yIHVzZSBieSBPcGVuSlBBCiAgICAgKiBpZiBpdCBp\ncyBub3QgYWxyZWFkeSBwcmVzZW50LgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgZW5oYW5jZUNsYXNzKCkgewogICAgICAgIC8vIG1ha2UgdGhlIGNsYXNz\nIGltcGxlbWVudCBQZXJzaXN0ZW5jZUNhcGFibGUKICAgICAgICBfcGMuZGVj\nbGFyZUludGVyZmFjZShQQ1RZUEUpOwoKICAgICAgICAvLyBhZGQgYSB2ZXJz\naW9uIHN0YW1wCiAgICAgICAgYWRkR2V0RW5oYW5jZW1lbnRDb250cmFjdFZl\ncnNpb25NZXRob2QoKTsKCiAgICAgICAgLy8gZmluZCB0aGUgZGVmYXVsdCBj\nb25zdHJ1Y3RvcgogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5nZXRE\nZWNsYXJlZE1ldGhvZCgiPGluaXQ+IiwgKFN0cmluZ1tdKSBudWxsKTsKCiAg\nICAgICAgLy8gYSBkZWZhdWx0IGNvbnN0cnVjdG9yIGlzIHJlcXVpcmVkCiAg\nICAgICAgaWYgKG1ldGhvZCA9PSBudWxsKSB7CiAgICAgICAgICAgIFN0cmlu\nZyBuYW1lID0gX3BjLmdldE5hbWUoKTsKICAgICAgICAgICAgaWYgKCFfZGVm\nQ29ucykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJlbmhhbmNlLWRlZmF1bHRjb25zdCIsIG5hbWUpKTsKCiAg\nICAgICAgICAgIG1ldGhvZCA9IF9wYy5hZGREZWZhdWx0Q29uc3RydWN0b3Io\nKTsKICAgICAgICAgICAgU3RyaW5nIGFjY2VzczsKICAgICAgICAgICAgaWYg\nKF9tZXRhLmlzRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAgICAvLyBl\neHRlcm5hbGl6YWJsZSByZXF1aXJlcyB0aGF0IHRoZSBjb25zdHJ1Y3Rvcgog\nICAgICAgICAgICAgICAgLy8gYmUgcHVibGljLCBzbyBtYWtlIHRoZSBhZGRl\nZCBjb25zdHJ1Y3RvciBwdWJsaWMKICAgICAgICAgICAgICAgIG1ldGhvZC5t\nYWtlUHVibGljKCk7CiAgICAgICAgICAgICAgICBhY2Nlc3MgPSAicHVibGlj\nIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChfcGMuaXNGaW5hbCgpKSB7CiAg\nICAgICAgICAgICAgICBtZXRob2QubWFrZVByaXZhdGUoKTsKICAgICAgICAg\nICAgICAgIGFjY2VzcyA9ICJwcml2YXRlIjsKICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAg\nICAgICAgICAgICAgICBhY2Nlc3MgPSAicHJvdGVjdGVkIjsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBpZiAoIShfbWV0YS5nZXREZXNjcmliZWRUeXBl\nKCkuaXNJbnRlcmZhY2UoKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKQogICAg\nICAgICAgICAgICAgJiYgX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAg\nICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImVuaGFuY2UtYWRkZGVmYXVs\ndGNvbnN0IiwgbmFtZSwgYWNjZXNzKSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQWRkcyB0aGUgZm9sbG93aW5nIGZpZWxkcyB0byB0aGUg\nUGVyc2lzdGVuY2VDYXBhYmxlIGluc3RhbmNlOgogICAgICogPHVsPgogICAg\nICogPGxpPjxjb2RlPnByaXZhdGUgc3RhdGljIGludCBwY0luaGVyaXRlZEZp\nZWxkQ291bnQ8L2NvZGU+PC9saT4KICAgICAqIDxsaT48Y29kZT5wcml2YXRl\nIHN0YXRpYyBDbGFzcyBwY1BDU3VwZXJjbGFzczwvY29kZT4KICAgICAqIDwv\nbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgU3RyaW5nW10g\ncGNGaWVsZE5hbWVzPC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJp\ndmF0ZSBzdGF0aWMgQ2xhc3NbXSBwY0ZpZWxkVHlwZXM8L2NvZGU+PC9saT4K\nICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBieXRlW10gcGNGaWVs\nZEZsYWdzPC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJvdGVjdGVk\nIHRyYW5zaWVudCBTdGF0ZU1hbmFnZXIgcGNTdGF0ZU1hbmFnZXI8L2NvZGU+\nCiAgICAgKiBpZiBubyBQZXJzaXN0ZW5jZUNhcGFibGUgc3VwZXJjbGFzcyBw\ncmVzZW50KTwvbGk+CiAgICAgKiA8L3VsPgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkRmllbGRzKCkgewogICAgICAgIF9wYy5kZWNsYXJlRmllbGQo\nSU5IRVJJVCwgaW50LmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAg\nX3BjLmRlY2xhcmVGaWVsZChQUkUgKyAiRmllbGROYW1lcyIsIFN0cmluZ1td\nLmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVG\naWVsZChQUkUgKyAiRmllbGRUeXBlcyIsIENsYXNzW10uY2xhc3MpLnNldFN0\nYXRpYyh0cnVlKTsKICAgICAgICBfcGMuZGVjbGFyZUZpZWxkKFBSRSArICJG\naWVsZEZsYWdzIiwgYnl0ZVtdLmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAg\nICAgICAgX3BjLmRlY2xhcmVGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpLnNl\ndFN0YXRpYyh0cnVlKTsKCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJj\nbGFzcygpID09IG51bGwgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAg\nICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmRlY2xhcmVGaWVsZChTTSwg\nU01UWVBFKTsKICAgICAgICAgICAgZmllbGQubWFrZVByb3RlY3RlZCgpOwog\nICAgICAgICAgICBmaWVsZC5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogTW9kaWZpZXMgdGhlIGNsYXNzIGlu\naXRpYWxpemF0aW9uIG1ldGhvZCAoY3JlYXRpbmcgb25lIGlmIG5lY2Vzc2Fy\neSkKICAgICAqIHRvIGluaXRpYWxpemUgdGhlIHN0YXRpYyBmaWVsZHMgb2Yg\ndGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZSBhbmQKICAgICAqIHRv\nIHJlZ2lzdGVyIGl0IHdpdGggdGhlIGltcGwgaGVscGVyLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkU3RhdGljSW5pdGlhbGl6ZXIoKSB7CiAgICAg\nICAgQ29kZSBjb2RlID0gZ2V0T3JDcmVhdGVDbGFzc0luaXRDb2RlKHRydWUp\nOwogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAg\nICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAg\nICAgICAgICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKElOSEVS\nSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAvLyBwY0luaGVyaXRlZEZpZWxkQ291bnQgPSA8c3VwZXJDbGFz\ncz4ucGNHZXRNYW5hZ2VkRmllbGRDb3VudCgpCiAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgog\nICAgICAgICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkp\nLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBQUkUgKyAiR2V0TWFu\nYWdlZEZpZWxkQ291bnQiLCBpbnQuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsK\nICAgICAgICAgICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoSU5I\nRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gcGNQQ1N1cGVyY2xhc3MgPSA8c3VwZXJDbGFzcz47CiAgICAgICAgICAg\nIC8vIHRoaXMgaW50ZW50aW9uYWxseSBjYWxscyBnZXREZXNjcmliZWRUeXBl\nKCkgZGlyZWN0bHkKICAgICAgICAgICAgLy8gaW5zdGVhZCBvZiBQQ0VuaGFu\nY2VyLmdldFR5cGUoKQogICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQo\nKS5zZXRDbGFzcygKICAgICAgICAgICAgICAgIF9tZXRhLmdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAg\nICAgY29kZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChTVVBFUiwgQ2xhc3MuY2xh\nc3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gcGNGaWVsZE5hbWVzID0gbmV3\nIFN0cmluZ1tdIHsgIjxuYW1lMT4iLCAiPG5hbWUyPiIsIC4uLiB9OwogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRG\naWVsZHMoKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1k\ncy5sZW5ndGgpOwogICAgICAgIGNvZGUuYW5ld2FycmF5KCkuc2V0VHlwZShT\ndHJpbmcuY2xhc3MpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzW2ldLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgIGNvZGUuYWFzdG9yZSgpOwogICAgICAgIH0KICAg\nICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZE5h\nbWVzIiwgU3RyaW5nW10uY2xhc3MpOwoKICAgICAgICAvLyBwY0ZpZWxkVHlw\nZXMgPSBuZXcgQ2xhc3NbXSB7IDx0eXBlMT4uY2xhc3MsIDx0eXBlMj4uY2xh\nc3MsIC4uLiB9OwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShm\nbWRzLmxlbmd0aCk7CiAgICAgICAgY29kZS5hbmV3YXJyYXkoKS5zZXRUeXBl\nKENsYXNzLmNsYXNzKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAg\nICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAgICAgY29kZS5hYXN0b3JlKCk7\nCiAgICAgICAgfQogICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQo\nUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNzKTsKCiAgICAgICAg\nLy8gcGNGaWVsZEZsYWdzID0gbmV3IGJ5dGVbXSB7IDxmbGFnMT4sIDxmbGFn\nMj4sIC4uLiB9OwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShm\nbWRzLmxlbmd0aCk7CiAgICAgICAgY29kZS5uZXdhcnJheSgpLnNldFR5cGUo\nYnl0ZS5jbGFzcyk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGdldEZpZWxkRmxhZyhmbWRz\nW2ldKSk7CiAgICAgICAgICAgIGNvZGUuYmFzdG9yZSgpOwogICAgICAgIH0K\nICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVs\nZEZsYWdzIiwgYnl0ZVtdLmNsYXNzKTsKCiAgICAgICAgLy8gUENSZWdpc3Ry\neS5yZWdpc3RlciAoY2xzLAogICAgICAgIC8vCXBjRmllbGROYW1lcywgcGNG\naWVsZFR5cGVzLCBwY0ZpZWxkRmxhZ3MsCiAgICAgICAgLy8gIHBjUENTdXBl\ncmNsYXNzLCBhbGlhcywgbmV3IFhYWCAoKSk7CiAgICAgICAgY29kZS5jbGFz\nc2NvbnN0YW50KCkuc2V0Q2xhc3MoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJG\naWVsZE5hbWVzIiwgU3RyaW5nW10uY2xhc3MpOwogICAgICAgIGNvZGUuZ2V0\nc3RhdGljKCkuc2V0RmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1td\nLmNsYXNzKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBS\nRSArICJGaWVsZEZsYWdzIiwgYnl0ZVtdLmNsYXNzKTsKICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKFNVUEVSLCBDbGFzcy5jbGFzcyk7CiAg\nICAgICAgCiAgICAgICAgaWYgKF9tZXRhLmlzTWFwcGVkKCkpCiAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShfbWV0YS5nZXRUeXBlQWxp\nYXMoKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0TnVsbCgpOwoKICAgICAgICBpZiAoX3BjLmlzQWJzdHJhY3QoKSkK\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShfcGMp\nOwogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3Ms\nIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5pbnZva2VzdGF0aWMo\nKS5zZXRNZXRob2QoSEVMUEVSVFlQRSwgInJlZ2lzdGVyIiwgdm9pZC5jbGFz\ncywKICAgICAgICAgICAgbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBTdHJp\nbmdbXS5jbGFzcywgQ2xhc3NbXS5jbGFzcywKICAgICAgICAgICAgICAgIGJ5\ndGVbXS5jbGFzcywgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgUENUWVBF\nIH0pOwoKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGZsYWcgZm9yIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgYnl0ZSBnZXRGaWVsZEZsYWcoRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBG\naWVsZE1ldGFEYXRhLk1BTkFHRV9OT05FKQogICAgICAgICAgICByZXR1cm4g\nLTE7CgogICAgICAgIGJ5dGUgZmxhZ3MgPSAwOwogICAgICAgIGlmIChmbWQu\nZ2V0RGVjbGFyZWRUeXBlKCkuaXNQcmltaXRpdmUoKQogICAgICAgICAgICB8\nfCBTZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShmbWQuZ2V0\nRGVjbGFyZWRUeXBlKCkpKQogICAgICAgICAgICBmbGFncyA9IFBlcnNpc3Rl\nbmNlQ2FwYWJsZS5TRVJJQUxJWkFCTEU7CgogICAgICAgIGlmIChmbWQuZ2V0\nTWFuYWdlbWVudCgpID09IEZpZWxkTWV0YURhdGEuTUFOQUdFX1RSQU5TQUNU\nSU9OQUwpCiAgICAgICAgICAgIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2FwYWJs\nZS5DSEVDS19XUklURTsKICAgICAgICBlbHNlIGlmICghZm1kLmlzUHJpbWFy\neUtleSgpICYmICFmbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAg\nICAgICAgIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19XUklU\nRQogICAgICAgICAgICAgICAgfCBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tf\nUkVBRDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZsYWdzIHw9IFBlcnNp\nc3RlbmNlQ2FwYWJsZS5NRURJQVRFX1dSSVRFCiAgICAgICAgICAgICAgICB8\nIFBlcnNpc3RlbmNlQ2FwYWJsZS5NRURJQVRFX1JFQUQ7CiAgICAgICAgcmV0\ndXJuIGZsYWdzOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgY29k\nZSB0byBwcm9wZXJseSBoYW5kbGUgUGVyc2lzdGVuY2VDYXBhYmxlIHNlcmlh\nbGl6YXRpb24KICAgICAqIHRvIHRoZSBieXRlY29kZS4gVGhpcyBpbmNsdWRl\ncyBjcmVhdGluZyBhbmQgaW5pdGlhbGl6aW5nIHRoZQogICAgICogc3RhdGlj\nIDxjb2RlPnNlcmlhbFZlcnNpb25VSUQ8L2NvZGU+IGNvbnN0YW50IGlmIG5v\ndCBhbHJlYWR5IGRlZmluZWQsCiAgICAgKiBhcyB3ZWxsIGFzIGNyZWF0aW5n\nIGEgY3VzdG9tIDxjb2RlPndyaXRlT2JqZWN0PC9jb2RlPiBtZXRob2QgaWYg\ndGhlCiAgICAgKiBjbGFzcyBpcyBTZXJpYWxpemFibGUgYW5kIGRvZXMgbm90\nIGRlZmluZSB0aGVtLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU2Vy\naWFsaXphdGlvbkNvZGUoKSB7CiAgICAgICAgaWYgKGV4dGVybmFsaXplRGV0\nYWNoZWQoKQogICAgICAgICAgICB8fCAhU2VyaWFsaXphYmxlLmNsYXNzLmlz\nQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xh\nc3MoKSkgewogICAgICAgICAgICAvLyAjIyMjIyB3aGF0IHNob3VsZCBoYXBw\nZW4gaWYgYSB0eXBlIGlzIEV4dGVybmFsaXphYmxlPyBJdCBsb29rcwogICAg\nICAgICAgICAvLyAjIyMjIyBsaWtlIEV4dGVybmFsaXphYmxlIGNsYXNzZXMg\nd2lsbCBub3QgYmUgc2VyaWFsaXplZCBhcyBQQ3MKICAgICAgICAgICAgLy8g\nIyMjIyMgYmFzZWQgb24gdGhpcyBsb2dpYy4KICAgICAgICAgICAgaWYgKCFF\neHRlcm5hbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKAogICAgICAg\nICAgICAgICAgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAg\nICAgICAgIGFkZFN1YmNsYXNzU2VyaWFsaXphdGlvbkNvZGUoKTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgbm90IGFs\ncmVhZHkgcHJlc2VudCwgYWRkIGEgc2VyaWFsVmVyc2lvblVJRCBmaWVsZDsg\naWYgdGhlIGluc3RhbmNlCiAgICAgICAgLy8gaXMgZGV0YWNoYWJsZSBhbmQg\ndXNlcyBkZXRhY2hlZCBzdGF0ZSB3aXRob3V0IGEgZGVjbGFyZWQgZmllbGQs\nCiAgICAgICAgLy8gY2FuJ3QgYWRkIGEgc2VyaWFsIHZlcnNpb24gVUlEIGJl\nY2F1c2Ugd2UnbGwgYmUgYWRkaW5nIGV4dHJhIGZpZWxkcwogICAgICAgIC8v\nIHRvIHRoZSBlbmhhbmNlZCB2ZXJzaW9uCiAgICAgICAgQkNGaWVsZCBmaWVs\nZCA9IF9wYy5nZXREZWNsYXJlZEZpZWxkKCJzZXJpYWxWZXJzaW9uVUlEIik7\nCiAgICAgICAgaWYgKGZpZWxkID09IG51bGwpIHsKICAgICAgICAgICAgTG9u\nZyB1aWQgPSBudWxsOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgdWlkID0gTnVtYmVycy52YWx1ZU9mKE9iamVjdFN0cmVhbUNsYXNzLmxv\nb2t1cAogICAgICAgICAgICAgICAgICAgIChfbWV0YS5nZXREZXNjcmliZWRU\neXBlKCkpLmdldFNlcmlhbFZlcnNpb25VSUQoKSk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAgICAvLyBsYXN0\nLWNoYW5jZSBjYXRjaCBmb3IgYnVnICMyODMgKHdoaWNoIGNhbiBoYXBwZW4K\nICAgICAgICAgICAgICAgIC8vIGluIGEgdmFyaWV0eSBvZiBDbGFzc0xvYWRp\nbmcgZW52aXJvbm1lbnRzKQogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4o\nX2xvYy5nZXQoImVuaGFuY2UtdWlkLWFjY2VzcyIsIF9tZXRhKSwgdCk7CiAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgX2xvZy53\nYXJuKF9sb2MuZ2V0KCJlbmhhbmNlLXVpZC1hY2Nlc3MiLCBfbWV0YSkpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB3ZSBjb3VsZG4ndCBh\nY2Nlc3MgdGhlIHNlcmlhbFZlcnNpb25VSUQsIHdlIHdpbGwgaGF2ZSB0bwog\nICAgICAgICAgICAvLyBza2lwIHRoZSBvdmVycmlkZSBvZiB0aGF0IGZpZWxk\nIGFuZCBub3QgYmUgc2VyaWFsaXphdGlvbgogICAgICAgICAgICAvLyBjb21w\nYXRpYmxlIHdpdGggbm9uLWVuaGFuY2VkIGNsYXNzZXMKICAgICAgICAgICAg\naWYgKHVpZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmaWVsZCA9IF9w\nYy5kZWNsYXJlRmllbGQoInNlcmlhbFZlcnNpb25VSUQiLCBsb25nLmNsYXNz\nKTsKICAgICAgICAgICAgICAgIGZpZWxkLm1ha2VQcml2YXRlKCk7CiAgICAg\nICAgICAgICAgICBmaWVsZC5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgICAg\nICAgICBmaWVsZC5zZXRGaW5hbCh0cnVlKTsKCiAgICAgICAgICAgICAgICBD\nb2RlIGNvZGUgPSBnZXRPckNyZWF0ZUNsYXNzSW5pdENvZGUoZmFsc2UpOwog\nICAgICAgICAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwogICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHVpZC5sb25nVmFsdWUo\nKSk7CiAgICAgICAgICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxk\nKGZpZWxkKTsKCiAgICAgICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGFk\nZCB3cml0ZSBvYmplY3QgbWV0aG9kCiAgICAgICAgQkNNZXRob2Qgd3JpdGUg\nPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoIndyaXRlT2JqZWN0IiwKICAgICAg\nICAgICAgbmV3IENsYXNzW117IE9iamVjdE91dHB1dFN0cmVhbS5jbGFzcyB9\nKTsKICAgICAgICBib29sZWFuIGZ1bGwgPSB3cml0ZSA9PSBudWxsOwogICAg\nICAgIGlmIChmdWxsKSB7CiAgICAgICAgICAgIC8vIHByaXZhdGUgdm9pZCB3\ncml0ZU9iamVjdCAoT2JqZWN0T3V0cHV0U3RyZWFtIG91dCkKICAgICAgICAg\nICAgd3JpdGUgPSBfcGMuZGVjbGFyZU1ldGhvZCgid3JpdGVPYmplY3QiLCB2\nb2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW117IE9iamVj\ndE91dHB1dFN0cmVhbS5jbGFzcyB9KTsKICAgICAgICAgICAgd3JpdGUuZ2V0\nRXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xh\nc3MpOwogICAgICAgICAgICB3cml0ZS5tYWtlUHJpdmF0ZSgpOwogICAgICAg\nIH0KICAgICAgICBtb2RpZnlXcml0ZU9iamVjdE1ldGhvZCh3cml0ZSwgZnVs\nbCk7CgogICAgICAgIC8vIGFuZCByZWFkIG9iamVjdAogICAgICAgIEJDTWV0\naG9kIHJlYWQgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoInJlYWRPYmplY3Qi\nLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0u\nY2xhc3MgfSk7CiAgICAgICAgZnVsbCA9IHJlYWQgPT0gbnVsbDsKICAgICAg\nICBpZiAoZnVsbCkgewogICAgICAgICAgICAvLyBwcml2YXRlIHZvaWQgcmVh\nZE9iamVjdCAoT2JqZWN0SW5wdXRTdHJlYW0gaW4pCiAgICAgICAgICAgIHJl\nYWQgPSBfcGMuZGVjbGFyZU1ldGhvZCgicmVhZE9iamVjdCIsIHZvaWQuY2xh\nc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRT\ndHJlYW0uY2xhc3MgfSk7CiAgICAgICAgICAgIHJlYWQuZ2V0RXhjZXB0aW9u\ncyh0cnVlKS5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAg\nICAgICAgICByZWFkLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9u\nCiAgICAgICAgICAgICAgICAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFz\ncyk7CiAgICAgICAgICAgIHJlYWQubWFrZVByaXZhdGUoKTsKICAgICAgICB9\nCiAgICAgICAgbW9kaWZ5UmVhZE9iamVjdE1ldGhvZChyZWFkLCBmdWxsKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkU3ViY2xhc3NTZXJpYWxpemF0\naW9uQ29kZSgpIHsKICAgICAgICAvLyBmb3IgZ2VuZXJhdGVkIHN1YmNsYXNz\nZXMsIHNlcmlhbGl6YXRpb24gbXVzdCB3cml0ZSBhbiBpbnN0YW5jZSBvZgog\nICAgICAgIC8vIHRoZSBzdXBlcmNsYXNzIGluc3RlYWQgb2YgdGhlIHN1YmNs\nYXNzLCBzbyB0aGF0IHRoZSBjbGllbnQgVk0gY2FuCiAgICAgICAgLy8gZGVz\nZXJpYWxpemUgc3VjY2Vzc2Z1bGx5LgoKICAgICAgICAvLyBwcml2YXRlIE9i\namVjdCB3cml0ZVJlcGxhY2UoKSB0aHJvd3MgT2JqZWN0U3RyZWFtRXhjZXB0\naW9uCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRo\nb2QoIndyaXRlUmVwbGFjZSIsIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAg\nICAgbWV0aG9kLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uKE9i\namVjdFN0cmVhbUV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgQ29kZSBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIE9iamVjdCBv\nID0gbmV3IDxtYW5hZ2VkLXR5cGU+KCkKICAgICAgICBjb2RlLmFuZXcoKS5z\nZXRUeXBlKF9tYW5hZ2VkVHlwZSk7IC8vIGZvciByZXR1cm4KICAgICAgICBj\nb2RlLmR1cCgpOyAvLyBmb3IgcG9zdC08aW5pdD4gd29yawogICAgICAgIGNv\nZGUuZHVwKCk7IC8vIGZvciA8aW5pdD4KICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2QoX21hbmFnZWRUeXBlLmdldFR5cGUoKSwgIjxp\nbml0PiIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG51bGwpOwoKICAgICAg\nICAvLyBjb3B5IGFsbCB0aGUgZmllbGRzLgogICAgICAgIC8vICMjIyMjIGxp\nbWl0aW5nIHRvIEpQQSBAVHJhbnNpZW50IGxpbWl0YXRpb25zCiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKGZtZHNbaV0uaXNUcmFuc2llbnQoKSkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAvLyBvLjxmaWVsZD4g\nPSB0aGlzLjxmaWVsZD4gKG9yIHJlZmxlY3RpdmUgYW5hbG9nKQogICAgICAg\nICAgICBjb2RlLmR1cCgpOyAvLyBmb3IgcHV0ZmllbGQKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFRoaXMoKTsgLy8gZm9yIGdldGZpZWxkCiAgICAg\nICAgICAgIGdldGZpZWxkKGNvZGUsIF9tYW5hZ2VkVHlwZSwgZm1kc1tpXS5n\nZXROYW1lKCkpOwogICAgICAgICAgICBwdXRmaWVsZChjb2RlLCBfbWFuYWdl\nZFR5cGUsIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgZm1k\nc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgfQoKICAgICAgICBj\nb2RlLmFyZXR1cm4oKS5zZXRUeXBlKE9iamVjdC5jbGFzcyk7CgogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0aGUgY2xhc3MgYmVpbmcgZW5oYW5jZWQgc2hvdWxkIGV4dGVybmFsaXpl\nIHRvIGEgZGV0YWNoZWQKICAgICAqIGluc3RhbmNlIHJhdGhlciB0aGFuIHNl\ncmlhbGl6ZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGV4dGVybmFs\naXplRGV0YWNoZWQoKSB7CiAgICAgICAgcmV0dXJuIENsYXNzTWV0YURhdGEu\nU1lOVEhFVElDLmVxdWFscyhfbWV0YS5nZXREZXRhY2hlZFN0YXRlKCkpCiAg\nICAgICAgICAgICYmIFNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVG\ncm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkKICAgICAgICAgICAgJiYg\nIV9yZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuZ2V0RGV0YWNoU3RhdGVJbnN0\nYW5jZSgpLgogICAgICAgICAgICBpc0RldGFjaGVkU3RhdGVUcmFuc2llbnQo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBjdXN0b20gd3JpdGVP\nYmplY3QgbWV0aG9kIHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICoge0Bs\naW5rIE9iamVjdE91dHB1dFN0cmVhbSNkZWZhdWx0V3JpdGVPYmplY3R9IG1l\ndGhvZCwKICAgICAqIGJ1dCBvbmx5IGFmdGVyIGNhbGxpbmcgdGhlIGludGVy\nbmFsIDxjb2RlPnBjU2VyaWFsaXppbmc8L2NvZGU+IG1ldGhvZC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIG1vZGlmeVdyaXRlT2JqZWN0TWV0aG9kKEJD\nTWV0aG9kIG1ldGhvZCwgYm9vbGVhbiBmdWxsKSB7CiAgICAgICAgQ29kZSBj\nb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5iZWZv\ncmVGaXJzdCgpOwoKICAgICAgICAvLyBib29sIGNsZWFyID0gcGNTZXJpYWxp\nemluZyAoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nUFJFICsgIlNlcmlhbGl6aW5nIiwKICAgICAgICAgICAgYm9vbGVhbi5jbGFz\ncywgbnVsbCk7CiAgICAgICAgaW50IGNsZWFyID0gY29kZS5nZXROZXh0TG9j\nYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKGNs\nZWFyKTsKCiAgICAgICAgaWYgKGZ1bGwpIHsKICAgICAgICAgICAgLy8gb3V0\nLmRlZmF1bHRXcml0ZU9iamVjdCAoKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1\nYWwoKS5zZXRNZXRob2QoT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzLAogICAg\nICAgICAgICAgICAgImRlZmF1bHRXcml0ZU9iamVjdCIsIHZvaWQuY2xhc3Ms\nIG51bGwpOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICB9\nCgogICAgICAgIEluc3RydWN0aW9uIHRtcGxhdGUgPSAoKENvZGUpIEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpKS52cmV0dXJuKCk7CiAgICAgICAg\nSnVtcEluc3RydWN0aW9uIHRvcmV0OwogICAgICAgIEluc3RydWN0aW9uIHJl\ndDsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CiAgICAgICAgd2hpbGUg\nKGNvZGUuc2VhcmNoRm9yd2FyZCh0bXBsYXRlKSkgewogICAgICAgICAgICBy\nZXQgPSBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAgICAgIC8vIGlmIChjbGVh\ncikgcGNTZXREZXRhY2hlZFN0YXRlIChudWxsKTsKICAgICAgICAgICAgY29k\nZS5pbG9hZCgpLnNldExvY2FsKGNsZWFyKTsKICAgICAgICAgICAgdG9yZXQg\nPSBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXROdWxsKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChQUkUgKyAiU2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAg\nICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0p\nOwogICAgICAgICAgICB0b3JldC5zZXRUYXJnZXQocmV0KTsKICAgICAgICAg\nICAgY29kZS5uZXh0KCk7IC8vIGp1bXAgb3ZlciByZXR1cm4KICAgICAgICB9\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIGEgY3VzdG9tIHJlYWRPYmplY3QgbWV0aG9kIHRoYXQgZGVsZWdh\ndGVzIHRvIHRoZQogICAgICoge0BsaW5rIE9iamVjdElucHV0U3RyZWFtI3Jl\nYWRPYmplY3R9IG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG1v\nZGlmeVJlYWRPYmplY3RNZXRob2QoQkNNZXRob2QgbWV0aG9kLCBib29sZWFu\nIGZ1bGwpIHsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0\ncnVlKTsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIC8v\nIGlmIHRoaXMgaW5zdGFuY2UgdXNlcyBzeW50aGV0aWMgZGV0YWNoZWQgc3Rh\ndGUsIG5vdGUgdGhhdCBpdCBoYXMKICAgICAgICAvLyBiZWVuIGRlc2VyaWFs\naXplZAogICAgICAgIGlmIChDbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVh\nbHMoX21ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgpKSkgewogICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUu\nY2xhc3MsCiAgICAgICAgICAgICAgICAiREVTRVJJQUxJWkVEIiwgT2JqZWN0\nLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7\nCiAgICAgICAgfQoKICAgICAgICBpZiAoZnVsbCkgewogICAgICAgICAgICAv\nLyBpbi5kZWZhdWx0UmVhZE9iamVjdCAoKTsKICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MsCiAg\nICAgICAgICAgICAgICAiZGVmYXVsdFJlYWRPYmplY3QiLCB2b2lkLmNsYXNz\nLCBudWxsKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAg\nfQoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENyZWF0ZXMgdGhlIHBjSXNEZXRhY2hlZCgpIG1ldGhvZCB0byBkZXRl\ncm1pbmUgaWYgYW4gaW5zdGFuY2UKICAgICAqIGlzIGRldGFjaGVkLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkSXNEZXRhY2hlZE1ldGhvZCgpCiAg\nICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAg\nLy8gcHVibGljIGJvb2xlYW4gcGNJc0RldGFjaGVkKCkKICAgICAgICBCQ01l\ndGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiSXNEZXRh\nY2hlZCIsCiAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MsIG51bGwpOwogICAg\nICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgYm9vbGVhbiBuZWVkc0Rl\nZmluaXRpdmVNZXRob2QgPSB3cml0ZUlzRGV0YWNoZWRNZXRob2QoY29kZSk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgaWYgKCFuZWVkc0Rl\nZmluaXRpdmVNZXRob2QpIAogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIHByaXZhdGUgYm9vbGVhbiBwY0lzRGV0YWNoZWRTdGF0ZURlZmluaXRp\ndmUoKQogICAgICAgIC8vICAgcmV0dXJuIGZhbHNlOwogICAgICAgIC8vIGF1\neGlsbGlhcnkgZW5oYW5jZXJzIG1heSBjaGFuZ2UgdGhlIHJldHVybiB2YWx1\nZSBvZiB0aGlzIG1ldGhvZAogICAgICAgIC8vIGlmIHRoZWlyIHNwZWNzIGNv\nbnNpZGVyIGRldGFjaGVkIHN0YXRlIGRlZmluaXRpdmUKICAgICAgICBtZXRo\nb2QgPSBfcGMuZGVjbGFyZU1ldGhvZChJU0RFVEFDSEVEU1RBVEVERUZJTklU\nSVZFLCBib29sZWFuLmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAg\nICBtZXRob2QubWFrZVByaXZhdGUoKTsKICAgICAgICBjb2RlID0gbWV0aG9k\nLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKGZhbHNlKTsKICAgICAgICBjb2RlLmlyZXR1cm4oKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMg\ndGhlIGJvZHkgb2YgdGhlIHBjSXNEZXRhY2hlZCgpIG1ldGhvZCB0byBkZXRl\ncm1pbmUgaWYgYW4KICAgICAqIGluc3RhbmNlIGlzIGRldGFjaGVkLgogICAg\nICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB3ZSBuZWVkIGEgcGNJc0RldGFj\naGVkU3RhdGVEZWZpbml0aXZlIG1ldGhvZCwgZmFsc2UKICAgICAqIG90aGVy\nd2lzZQogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gd3JpdGVJc0RldGFj\naGVkTWV0aG9kKENvZGUgY29kZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBub3QgZGV0YWNoYWJsZTogcmV0\ndXJuIEJvb2xlYW4uRkFMU0UKICAgICAgICBpZiAoIV9tZXRhLmlzRGV0YWNo\nYWJsZSgpKSB7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0Rmll\nbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcyk7CiAg\nICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkK\nICAgICAgICAvLwkJcmV0dXJuIChzbS5pc0RldGFjaGVkICgpKSA/IEJvb2xl\nYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmlucyA9IGNvZGUuaWZudWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIGNvZGUuaW52b2tlaW50\nZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwgImlzRGV0YWNoZWQiLAogICAg\nICAgICAgICBib29sZWFuLmNsYXNzLCBudWxsKTsKICAgICAgICBKdW1wSW5z\ndHJ1Y3Rpb24gaWZmYWxzZSA9IGNvZGUuaWZlcSgpOwogICAgICAgIGNvZGUu\nZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBC\nb29sZWFuLmNsYXNzKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAg\nICBpZmZhbHNlLnNldFRhcmdldChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxk\nKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsCiAgICAgICAgICAgIEJvb2xlYW4u\nY2xhc3MpKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgLy8g\naWYgd2UgdXNlIGRldGFjaGVkIHN0YXRlOgogICAgICAgIC8vIGlmIChwY0dl\ndERldGFjaGVkU3RhdGUgKCkgIT0gbnVsbAogICAgICAgIC8vICAgICAmJiBw\nY0dldERldGFjaGVkU3RhdGUgIT0gREVTRVJJQUxJWkVEKQogICAgICAgIC8v\nICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgIEJvb2xlYW4gc3Rh\ndGUgPSBfbWV0YS51c2VzRGV0YWNoZWRTdGF0ZSgpOwogICAgICAgIEp1bXBJ\nbnN0cnVjdGlvbiBub3RkZXNlciA9IG51bGw7CiAgICAgICAgSW5zdHJ1Y3Rp\nb24gdGFyZ2V0OwogICAgICAgIGlmIChzdGF0ZSAhPSBCb29sZWFuLkZBTFNF\nKSB7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIs\nCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAg\nICAgICBpZmlucyA9IGNvZGUuaWZudWxsKCk7CiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVk\nU3RhdGUiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQZXJzaXN0\nZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAgICAgICAgICAiREVTRVJJQUxJ\nWkVEIiwgT2JqZWN0LmNsYXNzKTsKICAgICAgICAgICAgbm90ZGVzZXIgPSBj\nb2RlLmlmYWNtcGVxKCk7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCku\nc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNz\nKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CgogICAgICAgICAgICBp\nZiAoc3RhdGUgPT0gQm9vbGVhbi5UUlVFKSB7CiAgICAgICAgICAgICAgICAv\nLyBpZiB3ZSBoYXZlIHRvIHVzZSBkZXRhY2hlZCBzdGF0ZToKICAgICAgICAg\nICAgICAgIC8vIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICAg\nICAgdGFyZ2V0ID0gY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFu\nLmNsYXNzLCAiRkFMU0UiLAogICAgICAgICAgICAgICAgICAgIEJvb2xlYW4u\nY2xhc3MpOwogICAgICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRhcmdl\ndCk7CiAgICAgICAgICAgICAgICBub3RkZXNlci5zZXRUYXJnZXQodGFyZ2V0\nKTsKICAgICAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBjcmVhdGUgYXJ0aWZpY2lhbCB0YXJnZXQgdG8gc2ltcGxp\nZnkKICAgICAgICB0YXJnZXQgPSBjb2RlLm5vcCgpOwogICAgICAgIGlmaW5z\nLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAgIGlmIChub3RkZXNlciAhPSBu\ndWxsKQogICAgICAgICAgICBub3RkZXNlci5zZXRUYXJnZXQodGFyZ2V0KTsK\nCiAgICAgICAgLy8gYWxsb3cgdXNlcnMgd2l0aCB2ZXJzaW9uIG9yIGF1dG8t\nYXNzaWduZWQgcGsgZmllbGRzIHRvIG1hbnVhbGx5IAogICAgICAgIC8vIGNv\nbnN0cnVjdCBhICJkZXRhY2hlZCIgaW5zdGFuY2UsIHNvIGNoZWNrIHRoZXNl\nIGJlZm9yZSB0YWtpbmcgaW50byAKICAgICAgICAvLyBhY2NvdW50IG5vbi1l\neGlzdGVudCBkZXRhY2hlZCBzdGF0ZQoKICAgICAgICAvLyBjb25zaWRlciBk\nZXRhY2hlZCBpZiB2ZXJzaW9uIGlzIG5vbi1kZWZhdWx0CiAgICAgICAgRmll\nbGRNZXRhRGF0YSB2ZXJzaW9uID0gX21ldGEuZ2V0VmVyc2lvbkZpZWxkKCk7\nCiAgICAgICAgaWYgKHN0YXRlICE9IEJvb2xlYW4uVFJVRSAmJiB2ZXJzaW9u\nICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgKDx2ZXJzaW9uPiAhPSA8\nZGVmYXVsdD4pCiAgICAgICAgICAgIC8vCQlyZXR1cm4gdHJ1ZTsKICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgdmVyc2lvbik7\nCiAgICAgICAgICAgIGlmaW5zID0gaWZEZWZhdWx0VmFsdWUoY29kZSwgdmVy\nc2lvbik7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQo\nQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAg\nICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIGlmaW5zLnNldFRh\ncmdldChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3Ms\nICJGQUxTRSIsCiAgICAgICAgICAgICAgICBCb29sZWFuLmNsYXNzKSk7CiAg\nICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBjb25zaWRlciBkZXRhY2hl\nZCBpZiBhdXRvLWdlbm5lZCBwcmltYXJ5IGtleXMgYXJlIG5vbi1kZWZhdWx0\nCiAgICAgICAgaWZpbnMgPSBudWxsOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBpZmluczIgPSBudWxsOwogICAgICAgIGJvb2xlYW4gaGFzQXV0b0Fzc2ln\nbmVkUEsgPSBmYWxzZTsKICAgICAgICBpZiAoc3RhdGUgIT0gQm9vbGVhbi5U\nUlVFCiAgICAgICAgICAgICYmIF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09\nIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pIHsKICAgICAgICAgICAg\nLy8gZm9yIGVhY2ggcGsgZmllbGQ6CiAgICAgICAgICAgIC8vIGlmICg8cGs+\nICE9IDxkZWZhdWx0PiBbJiYgISIiLmVxdWFscyAoPHBrPildKQogICAgICAg\nICAgICAvLwkJcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIHBrcyA9IF9tZXRhLmdldFByaW1hcnlLZXlGaWVsZHMo\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwa3MubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChwa3NbaV0uZ2V0VmFsdWVT\ndHJhdGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHRhcmdldCA9\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgaWYgKGlmaW5zICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\naWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAgICAgICBpZiAo\naWZpbnMyICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgaWZpbnMyLnNl\ndFRhcmdldCh0YXJnZXQpOwogICAgICAgICAgICAgICAgaWZpbnMyID0gbnVs\nbDsKCiAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNv\nZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAgICBpZmlucyA9IGlmRGVmYXVs\ndFZhbHVlKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAocGtz\nW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuU1RSSU5H\nKSB7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKCIiKTsKICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBhZGRHZXRN\nYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmluZy5j\nbGFzcywgImVxdWFscyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2xl\nYW4uY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAg\nICAgICAgICAgICAgICAgaWZpbnMyID0gY29kZS5pZm5lKCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNl\ndEZpZWxkKEJvb2xlYW4uY2xhc3MsICJUUlVFIiwKICAgICAgICAgICAgICAg\nICAgICBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuYXJl\ndHVybigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBj\ncmVhdGUgYXJ0aWZpY2lhbCB0YXJnZXQgdG8gc2ltcGxpZnkKICAgICAgICB0\nYXJnZXQgPSBjb2RlLm5vcCgpOwogICAgICAgIGlmIChpZmlucyAhPSBudWxs\nKQogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAg\nICBpZiAoaWZpbnMyICE9IG51bGwpCiAgICAgICAgICAgIGlmaW5zMi5zZXRU\nYXJnZXQodGFyZ2V0KTsKCiAgICAgICAgLy8gaWYgaGFzIGF1dG8tYXNzaWdu\nZWQgcGsgYW5kIHdlIGdldCB0byB0aGlzIHBvaW50LCBtdXN0IGhhdmUgZGVm\nYXVsdAogICAgICAgIC8vIHZhbHVlLCBzbyBtdXN0IGJlIG5ldyBpbnN0YW5j\nZQogICAgICAgIGlmIChoYXNBdXRvQXNzaWduZWRQSykgewogICAgICAgICAg\nICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJG\nQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAg\nICAgICAgLy8gaWYgZGV0YWNoZWQgc3RhdGUgaXMgbm90IGRlZmluaXRpdmUs\nIGp1c3QgZ2l2ZSB1cCBub3cgYW5kIHJldHVybgogICAgICAgIC8vIG51bGwg\nc28gdGhhdCB0aGUgcnVudGltZSB3aWxsIHBlcmZvcm0gYSBEQiBsb29rdXAg\ndG8gZGV0ZXJtaW5lCiAgICAgICAgLy8gd2hldGhlciB3ZSdyZSBkZXRhY2hl\nZCBvciBuZXcKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChJU0RFVEFDSEVE\nU1RBVEVERUZJTklUSVZFLCBib29sZWFuLmNsYXNzLAogICAgICAgICAgICBu\ndWxsKTsKICAgICAgICBpZmlucyA9IGNvZGUuaWZuZSgpOwogICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwoKICAg\nICAgICAvLyBubyBkZXRhY2hlZCBzdGF0ZTogaWYgaW5zdGFuY2UgdXNlcyBk\nZXRhY2hlZCBzdGF0ZSBhbmQgaXQncyBub3QKICAgICAgICAvLyBzeW50aGV0\naWMgb3IgdGhlIGluc3RhbmNlIGlzIG5vdCBzZXJpYWxpemFibGUgb3IgdGhl\nIHN0YXRlIGlzbid0CiAgICAgICAgLy8gdHJhbnNpZW50LCBtdXN0IG5vdCBi\nZSBkZXRhY2hlZAogICAgICAgIGlmIChzdGF0ZSA9PSBudWxsCiAgICAgICAg\nICAgICYmICghQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKF9tZXRh\nLmdldERldGFjaGVkU3RhdGUoKSkKICAgICAgICAgICAgfHwgIVNlcmlhbGl6\nYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSkKICAgICAgICAgICAgfHwgIV9yZXBvcy5nZXRDb25maWd1cmF0\naW9uKCkuZ2V0RGV0YWNoU3RhdGVJbnN0YW5jZSgpLgogICAgICAgICAgICBp\nc0RldGFjaGVkU3RhdGVUcmFuc2llbnQoKSkpIHsKICAgICAgICAgICAgLy8g\ncmV0dXJuIEJvb2xlYW4uRkFMU0UKICAgICAgICAgICAgY29kZS5nZXRzdGF0\naWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFu\nLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gbm8gZGV0\nYWNoZWQgc3RhdGU6IGlmIGluc3RhbmNlIHVzZXMgZGV0YWNoZWQgc3RhdGUg\nKGFuZCBtdXN0IGJlCiAgICAgICAgLy8gc3ludGhldGljIGFuZCB0cmFuc2ll\nbnQgaW4gc2VyaWFsaXphYmxlIGluc3RhbmNlIGF0IHRoaXMgcG9pbnQpLAog\nICAgICAgIC8vIG5vdCBkZXRhY2hlZCBpZiBzdGF0ZSBub3Qgc2V0IHRvIERF\nU0VSSUFMSVpFRAogICAgICAgIGlmIChzdGF0ZSA9PSBudWxsKSB7CiAgICAg\nICAgICAgIC8vIGlmIChwY0dldERldGFjaGVkU3RhdGUgKCkgPT0gbnVsbCkg\nLy8gaW5zdGVhZCBvZiBERVNFUklBTElaRUQKICAgICAgICAgICAgLy8gICAg\nIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRl\nIiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAg\nICAgICAgIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAgICAgICAg\nY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFM\nU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsK\nICAgICAgICB9CgogICAgICAgIC8vIGdpdmUgdXA7IHdlIGp1c3QgZG9uJ3Qg\na25vdwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAg\nICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb21wYXJlIHRoZSBnaXZlbiBmaWVsZCB0byBp\ndHMgSmF2YSBkZWZhdWx0LCByZXR1cm5pbmcgdGhlCiAgICAgKiBjb21wYXJp\nc29uIGluc3RydWN0aW9uLiBUaGUgZmllbGQgdmFsdWUgd2lsbCBhbHJlYWR5\nIGJlIG9uIHRoZSBzdGFjay4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nSnVtcEluc3RydWN0aW9uIGlmRGVmYXVsdFZhbHVlKENvZGUgY29kZSwKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZl\ncSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAg\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAg\nICAgICAgICAgICAgY29kZS5kY21wbCgpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIGNvZGUuaWZlcSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5G\nTE9BVDoKICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSgwRik7CiAgICAgICAgICAgICAgICBjb2RlLmZjbXBsKCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoMEwpOwogICAgICAgICAgICAgICAgY29kZS5sY21wKCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZm51\nbGwoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIg\nbWV0aG9kIHRvIGdldCB0aGUgY29kZSBmb3IgdGhlIGNsYXNzIGluaXRpYWxp\nemVyIG1ldGhvZCwKICAgICAqIGNyZWF0aW5nIHRoZSBtZXRob2QgaWYgaXQg\nZG9lcyBub3QgYWxyZWFkeSBleGlzdC4KICAgICAqLwogICAgcHJpdmF0ZSBD\nb2RlIGdldE9yQ3JlYXRlQ2xhc3NJbml0Q29kZShib29sZWFuIHJlcGxhY2VM\nYXN0KSB7CiAgICAgICAgQkNNZXRob2QgY2xpbml0ID0gX3BjLmdldERlY2xh\ncmVkTWV0aG9kKCI8Y2xpbml0PiIpOwogICAgICAgIENvZGUgY29kZTsKICAg\nICAgICBpZiAoY2xpbml0ICE9IG51bGwpIHsKICAgICAgICAgICAgY29kZSA9\nIGNsaW5pdC5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICBpZiAocmVwbGFj\nZUxhc3QpIHsKICAgICAgICAgICAgICAgIENvZGUgdGVtcGxhdGUgPSAoQ29k\nZSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAg\nICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKTsKICAg\nICAgICAgICAgICAgIGNvZGUuc2VhcmNoRm9yd2FyZCh0ZW1wbGF0ZS52cmV0\ndXJuKCkpOwogICAgICAgICAgICAgICAgY29kZS5wcmV2aW91cygpOwogICAg\nICAgICAgICAgICAgY29kZS5zZXQodGVtcGxhdGUubm9wKCkpOwogICAgICAg\nICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIGNvZGU7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgc3Rh\ndGljIGluaXRpYWxpemVyIG1ldGhvZCBpZiBub24gZXhpc3RzCiAgICAgICAg\nY2xpbml0ID0gX3BjLmRlY2xhcmVNZXRob2QoIjxjbGluaXQ+Iiwgdm9pZC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgY2xpbml0Lm1ha2VQYWNrYWdlKCk7CiAg\nICAgICAgY2xpbml0LnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBjbGluaXQu\nc2V0RmluYWwodHJ1ZSk7CgogICAgICAgIGNvZGUgPSBjbGluaXQuZ2V0Q29k\nZSh0cnVlKTsKICAgICAgICBpZiAoIXJlcGxhY2VMYXN0KSB7CiAgICAgICAg\nICAgIGNvZGUudnJldHVybigpOwogICAgICAgICAgICBjb2RlLnByZXZpb3Vz\nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb2RlOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkcyBieXRlY29kZSBtb2RpZnlpbmcgdGhlIGNsb25p\nbmcgYmVoYXZpb3Igb2YgdGhlIGNsYXNzIGJlaW5nCiAgICAgKiBlbmhhbmNl\nZCB0byBjb3JyZWN0bHkgcmVwbGFjZSB0aGUgPGNvZGU+cGNTdGF0ZU1hbmFn\nZXI8L2NvZGU+IAogICAgICogaW5zdGFuY2UgZmllbGRzIG9mIGFueSBjbG9u\nZSBjcmVhdGVkIHdpdGggdGhlaXIgZGVmYXVsdCB2YWx1ZXMuIAogICAgICog\nQWxzbywgaWYgdGhpcyBjbGFzcyBpcyB0aGUgYmFzZSBQQyB0eXBlIGFuZCBk\nb2VzIG5vdCBkZWNsYXJlZCAKICAgICAqIGEgY2xvbmUgbWV0aG9kLCBvbmUg\nd2lsbCBiZSBhZGRlZC4gQWxzbywgaWYgX3BjIGlzIGEgc3ludGhldGljCiAg\nICAgKiBzdWJjbGFzcywgY3JlYXRlIHRoZSBjbG9uZSgpIG1ldGhvZCB0aGF0\nIGNsZWFycyB0aGUgc3RhdGUgbWFuYWdlcgogICAgICogdGhhdCBtYXkgaGF2\nZSBiZWVuIGluaXRpYWxpemVkIGluIGEgc3VwZXIncyBjbG9uZSgpIG1ldGhv\nZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENsb25pbmdDb2RlKCkg\newogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxs\nICYmICFnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIC8vIGFkZCB0aGUgY2xvbmUgbWV0aG9kIGlmIG5lY2Vzc2Fy\neQogICAgICAgIEJDTWV0aG9kIGNsb25lID0gX3BjLmdldERlY2xhcmVkTWV0\naG9kKCJjbG9uZSIsIAogICAgICAgICAgICAoU3RyaW5nW10pIG51bGwpOwog\nICAgICAgIFN0cmluZyBzdXBlck5hbWUgPSBfbWFuYWdlZFR5cGUuZ2V0U3Vw\nZXJjbGFzc05hbWUoKTsKICAgICAgICBDb2RlIGNvZGUgPSBudWxsOwogICAg\nICAgIGlmIChjbG9uZSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGFkZCBj\nbG9uZSBzdXBwb3J0IGZvciBiYXNlIGNsYXNzZXMKICAgICAgICAgICAgLy8g\nd2hpY2ggYWxzbyBpbXBsZW1lbnQgY2xvbmVhYmxlCiAgICAgICAgICAgIGJv\nb2xlYW4gaXNDbG9uZWFibGUgPSBDbG9uZWFibGUuY2xhc3MuaXNBc3NpZ25h\nYmxlRnJvbSgKICAgICAgICAgICAgICAgIF9tYW5hZ2VkVHlwZS5nZXRUeXBl\nKCkpOwogICAgICAgICAgICBib29sZWFuIGV4dGVuZHNPYmplY3QgPQogICAg\nICAgICAgICAgICAgc3VwZXJOYW1lLmVxdWFscyhPYmplY3QuY2xhc3MuZ2V0\nTmFtZSgpKTsKICAgICAgICAgICAgaWYgKCFpc0Nsb25lYWJsZSB8fCAoIWV4\ndGVuZHNPYmplY3QgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKCFnZXRDcmVhdGVT\ndWJjbGFzcygpKQogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKAogICAg\nICAgICAgICAgICAgICAgICAgICBfbG9jLmdldCgiZW5oYW5jZS1jbG9uZWFi\nbGUiLCBfbWFuYWdlZFR5cGUuZ2V0TmFtZSgpKSk7CgogICAgICAgICAgICAv\nLyBhZGQgY2xvbmUgbWV0aG9kCiAgICAgICAgICAgIC8vIHByb3RlY3RlZCBP\nYmplY3QgY2xvbmUgKCkgdGhyb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0\naW9uCiAgICAgICAgICAgIGNsb25lID0gX3BjLmRlY2xhcmVNZXRob2QoImNs\nb25lIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgaWYgKCFz\nZXRWaXNpYmlsaXR5VG9TdXBlck1ldGhvZChjbG9uZSkpCiAgICAgICAgICAg\nICAgICBjbG9uZS5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIGNsb25l\nLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uCiAgICAgICAgICAg\nICAgICAoQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24uY2xhc3MpOwogICAg\nICAgICAgICBjb2RlID0gY2xvbmUuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nICAgIC8vIHJldHVybiBzdXBlci5jbG9uZSAoKTsKICAgICAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChzdXBlck5hbWUsICJjbG9u\nZSIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpLCBu\ndWxsKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgLy8gZ2V0IHRoZSBjbG9uZSBtZXRob2QgY29k\nZQogICAgICAgICAgICBjb2RlID0gY2xvbmUuZ2V0Q29kZShmYWxzZSk7CiAg\nICAgICAgICAgIGlmIChjb2RlID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgdGVtcGxhdGUg\nc3VwZXIuY2xvbmUgKCkgaW5zdHJ1Y3Rpb24gdG8gbWF0Y2ggYWdhaW5zdAog\nICAgICAgIEluc3RydWN0aW9uIHRlbXBsYXRlID0gKChDb2RlKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIubmV3Q29kZUFjdGlvbigpKSkuaW52b2tlc3BlY2lhbCgpCiAgICAg\nICAgICAgIC5zZXRNZXRob2Qoc3VwZXJOYW1lLCAiY2xvbmUiLCBPYmplY3Qu\nY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKCiAgICAgICAgLy8gZmluZCBjYWxs\ncyB0byB0aGUgdGVtcGxhdGUgaW5zdHJ1Y3Rpb247IG9uIG1hdGNoCiAgICAg\nICAgLy8gY2xvbmUgd2lsbCBiZSBvbiBzdGFjawogICAgICAgIGNvZGUuYmVm\nb3JlRmlyc3QoKTsKICAgICAgICBpZiAoY29kZS5zZWFyY2hGb3J3YXJkKHRl\nbXBsYXRlKSkgewogICAgICAgICAgICAvLyAoKDx0eXBlPikgY2xvbmUpLnBj\nU3RhdGVNYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKF9wYyk7CiAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAg\nICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKCiAg\nICAgICAgICAgIC8vIGlmIG1vZGlmaWVkLCBpbmNyZWFzZSBzdGFjawogICAg\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogR2V0cyB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyBy\nZWdpc3RlcmVkIGFzIHtAbGluayBTZXJ2aWNlcyBzZXJ2aWNlc30uCiAgICAg\nKi8KICAgIHB1YmxpYyBBdXhpbGlhcnlFbmhhbmNlcltdIGdldEF1eGlsaWFy\neUVuaGFuY2VycygpIHsKCQlyZXR1cm4gX2F1eEVuaGFuY2VyczsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBBbGxvdyBhbnkgcmVnaXN0ZXJlZCBhdXhp\nbGlhcnkgY29kZSBnZW5lcmF0b3JzIHRvIHJ1bi4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHJ1bkF1eGlsaWFyeUVuaGFuY2VycygpIHsKICAgIAlmb3Ig\nKGludCBpID0gMDsgaSA8IF9hdXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAg\nICAJCV9hdXhFbmhhbmNlcnNbaV0ucnVuKF9wYywgX21ldGEpOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIG1ldGhv\nZCBiZSBza2lwcGVkLgogICAgICogCiAgICAgKiBAcGFyYW0gbWV0aG9kIG1l\ndGhvZCB0byBiZSBza2lwcGVkIG9yIG5vdAogICAgICogQHJldHVybiB0cnVl\nIGlmIGFueSBvZiB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyBza2lwcyB0aGUg\nZ2l2ZW4gbWV0aG9kLAogICAgICogb3IgaWYgdGhlIG1ldGhvZCBpcyBhIGNv\nbnN0cnVjdG9yCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBza2lwRW5o\nYW5jZShCQ01ldGhvZCBtZXRob2QpIHsKICAgICAgICBpZiAoIjxpbml0PiIu\nZXF1YWxzKG1ldGhvZC5nZXROYW1lKCkpKQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICAKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9h\ndXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAgICAJCWlmIChfYXV4RW5oYW5j\nZXJzW2ldLnNraXBFbmhhbmNlKG1ldGhvZCkpCiAgICAJCQlyZXR1cm4gdHJ1\nZTsKICAgICAgICAKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIHN5bnRoZXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9k\ncyB0aGF0IHdpbGwgcmVwbGFjZSBhbGwgZGlyZWN0CiAgICAgKiBmaWVsZCBh\nY2Nlc3Nlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEFjY2Vzc29y\ncygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFz\ncygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5n\nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZ2V0Q3Jl\nYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICAgICAgaWYgKCFnZXRSZWRl\nZmluZSgpCiAgICAgICAgICAgICAgICAgICAgJiYgX21ldGEuZ2V0QWNjZXNz\nVHlwZSgpICE9IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAg\nICAgICAgICAgICAgICAgYWRkU3ViY2xhc3NTZXRNZXRob2QoZm1kc1tpXSk7\nCiAgICAgICAgICAgICAgICAgICAgYWRkU3ViY2xhc3NHZXRNZXRob2QoZm1k\nc1tpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICBhZGRHZXRNZXRob2QoaSwgZm1kc1tpXSk7CiAg\nICAgICAgICAgICAgICBhZGRTZXRNZXRob2QoaSwgZm1kc1tpXSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRz\nIGEgbm9uLXN0YXRpYyBzZXR0ZXIgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlIHN1\ncGVyIG1ldGhvZHMsIGFuZAogICAgICogcGVyZm9ybXMgYW55IG5lY2Vzc2Fy\neSBmaWVsZCB0cmFja2luZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZFN1YmNsYXNzU2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAg\nIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIENsYXNz\nIHByb3BUeXBlID0gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIFN0\ncmluZyBzZXR0ZXJOYW1lID0gZ2V0U2V0dGVyTmFtZShmbWQpOwogICAgICAg\nIEJDTWV0aG9kIHNldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKHNldHRlck5h\nbWUsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgcHJv\ncFR5cGUgfSk7CiAgICAgICAgc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRob2Qo\nc2V0dGVyKTsKICAgICAgICBDb2RlIGNvZGUgPSBzZXR0ZXIuZ2V0Q29kZSh0\ncnVlKTsKCiAgICAgICAgLy8gbm90IG5lY2Vzc2FyeSBpZiB3ZSdyZSBhbHJl\nYWR5IHRyYWNraW5nIGFjY2VzcyB2aWEgcmVkZWZpbml0aW9uCiAgICAgICAg\naWYgKCFnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgIC8vIGdldCB0aGUg\nb3JpZyB2YWx1ZSBvbnRvIHN0YWNrCiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRUaGlzKCk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNv\nZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAgaW50IHZhbCA9IGNvZGUuZ2V0\nTmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAgIGNvZGUueHN0b3JlKCku\nc2V0TG9jYWwodmFsKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7\nCiAgICAgICAgICAgIGFkZE5vdGlmeU11dGF0aW9uKGNvZGUsIGZtZCwgdmFs\nLCAwKTsKICAgICAgICB9CgogICAgICAgIC8vICMjIyMjIHRlc3QgY2FzZTog\nQiBleHRlbmRzIEEuIE1ldGhvZHMgZGVmaW5lZCBpbiBBLiBXaGF0CiAgICAg\nICAgLy8gIyMjIyMgaGFwcGVucz8KICAgICAgICAvLyBzdXBlci5zZXRYWFgo\nLi4uKQogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAg\nY29kZS54bG9hZCgpLnNldFBhcmFtKDApLnNldFR5cGUocHJvcFR5cGUpOwog\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChfbWFuYWdl\nZFR5cGUuZ2V0VHlwZSgpLAogICAgICAgICAgICBzZXR0ZXJOYW1lLCB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IHByb3BUeXBlIH0pOwoKICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0K\nCiAgICBwcml2YXRlIGJvb2xlYW4gc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRo\nb2QoQkNNZXRob2QgbWV0aG9kKSB7CiAgICAgICAgQkNNZXRob2RbXSBtZXRo\nb2RzID0gX21hbmFnZWRUeXBlLmdldE1ldGhvZHMobWV0aG9kLmdldE5hbWUo\nKSwKICAgICAgICAgICAgbWV0aG9kLmdldFBhcmFtVHlwZXMoKSk7CiAgICAg\nICAgaWYgKG1ldGhvZHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hY2Nlc3NvciIsCiAg\nICAgICAgICAgICAgICBfbWFuYWdlZFR5cGUuZ2V0TmFtZSgpLCBtZXRob2Qu\nZ2V0TmFtZSgpKSk7CiAgICAgICAgQkNNZXRob2Qgc3VwZXJNZXRoID0gbWV0\naG9kc1swXTsKICAgICAgICBpZiAoc3VwZXJNZXRoLmlzUHJpdmF0ZSgpKSB7\nCiAgICAgICAgICAgIG1ldGhvZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHN1cGVyTWV0aC5p\nc1BhY2thZ2UoKSkgewogICAgICAgICAgICBtZXRob2QubWFrZVBhY2thZ2Uo\nKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIGlm\nIChzdXBlck1ldGguaXNQcm90ZWN0ZWQoKSkgewogICAgICAgICAgICBtZXRo\nb2QubWFrZVByb3RlY3RlZCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9IGVsc2UgaWYgKHN1cGVyTWV0aC5pc1B1YmxpYygpKSB7CiAg\nICAgICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgbm9uLXN0YXRpYyBnZXR0ZXIg\ndGhhdCBkZWxlZ2F0ZXMgdG8gdGhlIHN1cGVyIG1ldGhvZHMsIGFuZAogICAg\nICogcGVyZm9ybXMgYW55IG5lY2Vzc2FyeSBmaWVsZCB0cmFja2luZy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN1YmNsYXNzR2V0TWV0aG9kKEZp\nZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgU3RyaW5nIG1ldGhOYW1lID0g\nImdldCIgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZtZC5nZXROYW1lKCkp\nOwogICAgICAgIGlmIChfbWFuYWdlZFR5cGUuZ2V0TWV0aG9kcyhtZXRoTmFt\nZSwgbmV3IENsYXNzWzBdKS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgbWV0\naE5hbWUgPSAiaXMiICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShmbWQuZ2V0\nTmFtZSgpKTsKICAgICAgICBCQ01ldGhvZCBnZXR0ZXIgPSBfcGMuZGVjbGFy\nZU1ldGhvZChtZXRoTmFtZSwgZm1kLmdldERlY2xhcmVkVHlwZSgpLAogICAg\nICAgICAgICBudWxsKTsKICAgICAgICBzZXRWaXNpYmlsaXR5VG9TdXBlck1l\ndGhvZChnZXR0ZXIpOwogICAgICAgIGdldHRlci5tYWtlUHVibGljKCk7CiAg\nICAgICAgQ29kZSBjb2RlID0gZ2V0dGVyLmdldENvZGUodHJ1ZSk7CgogICAg\nICAgIC8vIGlmIHdlJ3JlIG5vdCBhbHJlYWR5IHRyYWNraW5nIGZpZWxkIGFj\nY2VzcyB2aWEgcmVmbGVjdGlvbiwgdGhlbiB3ZQogICAgICAgIC8vIG11c3Qg\nbWFrZSB0aGUgZ2V0dGVyIGhvb2sgaW4gbGF6eSBsb2FkaW5nIGJlZm9yZSBh\nY2Nlc3NpbmcgdGhlIHN1cGVyCiAgICAgICAgLy8gbWV0aG9kLgogICAgICAg\nIGlmICghZ2V0UmVkZWZpbmUoKSkKICAgICAgICAgICAgYWRkTm90aWZ5QWNj\nZXNzKGNvZGUsIGZtZCk7CgogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlz\nKCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9t\nYW5hZ2VkVHlwZS5nZXRUeXBlKCksIG1ldGhOYW1lLAogICAgICAgICAgICBm\nbWQuZ2V0RGVjbGFyZWRUeXBlKCksIG51bGwpOwogICAgICAgIGNvZGUueHJl\ndHVybigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMg\nYSBzdGF0aWMgZ2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxkLgog\nICAgICogVGhlIGdlbmVyYXRlZCBtZXRob2QgaW50ZXJhY3RzIHdpdGggdGhl\nIGluc3RhbmNlIHN0YXRlIGFuZCB0aGUKICAgICAqIFN0YXRlTWFuYWdlciB0\nbyBnZXQgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZC4KICAgICAqCiAgICAgKiBA\ncGFyYW0gaW5kZXggdGhlIHJlbGF0aXZlIG51bWJlciBvZiB0aGUgZmllbGQK\nICAgICAqIEBwYXJhbSBmbWQgbWV0YWRhdGEgYWJvdXQgdGhlIGZpZWxkIHRv\nIGdldAogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWV0aG9kKGlu\ndCBpbmRleCwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNNZXRob2QgbWV0aG9k\nID0gY3JlYXRlR2V0TWV0aG9kKGZtZCk7CiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIHJlYWRzIGFy\nZSBub3QgY2hlY2tlZCwganVzdCByZXR1cm4gdGhlIHZhbHVlCiAgICAgICAg\nYnl0ZSBmaWVsZEZsYWcgPSBnZXRGaWVsZEZsYWcoZm1kKTsKICAgICAgICBp\nZiAoKGZpZWxkRmxhZyAmIFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19SRUFE\nKSA9PSAwCiAgICAgICAgICAgICYmIChmaWVsZEZsYWcgJiBQZXJzaXN0ZW5j\nZUNhcGFibGUuTUVESUFURV9SRUFEKSA9PSAwKSB7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgICAgIGFk\nZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAg\nY29kZS54cmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkp\nOwoKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBpZiAoaW5zdC5wY1N0\nYXRlTWFuYWdlciA9PSBudWxsKSByZXR1cm4gaW5zdC48ZmllbGQ+OwogICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAg\nIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAg\nICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAg\nY29kZS54cmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkp\nOwoKICAgICAgICAvLyBpbnQgZmllbGQgPSBwY0luaGVyaXRlZEZpZWxkQ291\nbnQgKyA8ZmllbGRpbmRleD47CiAgICAgICAgaW50IGZpZWxkTG9jYWwgPSBj\nb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGlmaW5zLnNldFRh\ncmdldChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5j\nbGFzcykpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpbmRl\neCk7CiAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgY29kZS5pc3RvcmUo\nKS5zZXRMb2NhbChmaWVsZExvY2FsKTsKCiAgICAgICAgLy8gaW5zdC5wY1N0\nYXRlTWFuYWdlci5hY2Nlc3NpbmdGaWVsZCAoZmllbGQpOwogICAgICAgIC8v\nIHJldHVybiBpbnN0LjxmaWVsZD47CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExv\nY2FsKGZpZWxkTG9jYWwpOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkuc2V0TWV0aG9kKFNNVFlQRSwgImFjY2Vzc2luZ0ZpZWxkIiwgdm9pZC5j\nbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsK\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAg\nICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAg\nICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkcyBhIHN0YXRpYyBzZXR0ZXIgbWV0aG9kIGZvciB0aGUgZ2l2\nZW4gZmllbGQuCiAgICAgKiBUaGUgZ2VuZXJhdGVkIG1ldGhvZCBpbnRlcmFj\ndHMgd2l0aCB0aGUgaW5zdGFuY2Ugc3RhdGUgYW5kIHRoZQogICAgICogU3Rh\ndGVNYW5hZ2VyIHRvIHNldCB0aGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogICAg\nICoKICAgICAqIEBwYXJhbSBpbmRleCB0aGUgcmVsYXRpdmUgbnVtYmVyIG9m\nIHRoZSBmaWVsZAogICAgICogQHBhcmFtIGZtZCBtZXRhZGF0YSBhYm91dCB0\naGUgZmllbGQgdG8gc2V0CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRT\nZXRNZXRob2QoaW50IGluZGV4LCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAg\nICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBCQ01l\ndGhvZCBtZXRob2QgPSBjcmVhdGVTZXRNZXRob2QoZm1kKTsKICAgICAgICBD\nb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8g\nUENFbmhhbmNlciB1c2VzIHN0YXRpYyBtZXRob2RzOyBQQ1N1YmNsYXNzZXIg\nZG9lcyBub3QuCiAgICAgICAgaW50IGZpcnN0UGFyYW1PZmZzZXQgPSBnZXRB\nY2Nlc3NvclBhcmFtZXRlck9mZnNldCgpOwoKICAgICAgICAvLyBpZiAoaW5z\ndC5wY1N0YXRlTWFuYWdlciA9PSBudWxsKSBpbnN0LjxmaWVsZD4gPSB2YWx1\nZTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwog\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVs\nbCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7\nCiAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGZpcnN0UGFyYW1PZmZz\nZXQpOwogICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1k\nKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgLy8gaW5zdC5w\nY1N0YXRlTWFuYWdlci5zZXR0aW5nPGZpZWxkVHlwZT5GaWVsZCAoaW5zdCwK\nICAgICAgICAvLyAgICAgcGNJbmhlcml0ZWRGaWVsZENvdW50ICsgPGluZGV4\nPiwgaW5zdC48ZmllbGQ+LCB2YWx1ZSwgMCk7CiAgICAgICAgaWZpbnMuc2V0\nVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSkpOwogICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAg\nIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNz\nKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaW5kZXgpOwog\nICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29k\nZShjb2RlLCBmbWQpOwogICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShm\naXJzdFBhcmFtT2Zmc2V0KTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoMCk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRN\nZXRob2QoZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kCiAgICAgICAgICAgIChmbWQu\nZ2V0RGVjbGFyZWRUeXBlKCksICJzZXR0aW5nIiwgZmFsc2UsIHRydWUpKTsK\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmVzIHdoaWNoIGF0\ndGFjaCAvIGRldGFjaCBtZXRob2RzIHRvIHVzZS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZEF0dGFjaERldGFjaENvZGUoKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHNlZSBpZiBh\nbnkgc3VwZXJjbGFzc2VzIGFyZSBkZXRhY2hhYmxlCiAgICAgICAgYm9vbGVh\nbiBwYXJlbnREZXRhY2hhYmxlID0gZmFsc2U7CiAgICAgICAgZm9yIChDbGFz\nc01ldGFEYXRhIHBhcmVudCA9IF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCk7CiAgICAgICAgICAgIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBw\nYXJlbnQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkgewogICAgICAgICAg\nICBpZiAocGFyZW50LmlzRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAg\nICBwYXJlbnREZXRhY2hhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBw\nYXJlbnQgbm90IGRldGFjaGFibGUsIHdlIG5lZWQgdG8gYWRkIHRoZSBkZXRh\nY2ggc3RhdGUgZmllbGRzIGFuZAogICAgICAgIC8vIGFjY2Vzc29yIG1ldGhv\nZHMKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVs\nbCB8fCBnZXRDcmVhdGVTdWJjbGFzcygpCiAgICAgICAgICAgIHx8IHBhcmVu\ndERldGFjaGFibGUgIT0gX21ldGEuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAg\nICAgICAgYWRkSXNEZXRhY2hlZE1ldGhvZCgpOwogICAgICAgICAgICBhZGRE\nZXRhY2hlZFN0YXRlTWV0aG9kcyhfbWV0YS51c2VzRGV0YWNoZWRTdGF0ZSgp\nCiAgICAgICAgICAgICAgICAhPSBCb29sZWFuLkZBTFNFKTsKICAgICAgICB9\nCgogICAgICAgIC8vIGlmIHdlIGRldGFjaCBvbiBzZXJpYWxpemUsIHdlIGFs\nc28gbmVlZCB0byBpbXBsZW1lbnQgdGhlCiAgICAgICAgLy8gZXh0ZXJuYWxp\nemFibGUgaW50ZXJmYWNlIHRvIHdyaXRlIGp1c3QgdGhlIHN0YXRlIGZvciB0\naGUgZmllbGRzCiAgICAgICAgLy8gYmVpbmcgZGV0YWNoZWQKICAgICAgICBp\nZiAoZXh0ZXJuYWxpemVEZXRhY2hlZCgpKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBhZGREZXRhY2hFeHRlcm5hbGl6ZShwYXJlbnRE\nZXRhY2hhYmxlLAogICAgICAgICAgICAgICAgICAgIF9tZXRhLnVzZXNEZXRh\nY2hlZFN0YXRlKCkgIT0gQm9vbGVhbi5GQUxTRSk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihuc21lKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCB0aGUgZmllbGRzIHRvIGhvbGQgZGV0YWNoZWQgc3RhdGUgYW5kIHRoZWly\nIGFjY2Vzc29yIG1ldGhvZHMuCiAgICAgKgogICAgICogQHBhcmFtIGltcGwg\nd2hldGhlciB0byBmdWxseSBpbXBsZW1lbnQgZGV0YWNoIHN0YXRlIGZ1bmN0\naW9uYWxpdHkKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZERldGFjaGVk\nU3RhdGVNZXRob2RzKGJvb2xlYW4gaW1wbCkgewogICAgICAgIEZpZWxkIGRl\ndGFjaEZpZWxkID0gX21ldGEuZ2V0RGV0YWNoZWRTdGF0ZUZpZWxkKCk7CiAg\nICAgICAgU3RyaW5nIG5hbWUgPSBudWxsOwogICAgICAgIFN0cmluZyBkZWNs\nYXJlciA9IG51bGw7CiAgICAgICAgaWYgKGltcGwgJiYgZGV0YWNoRmllbGQg\nPT0gbnVsbCkgewogICAgICAgICAgICBuYW1lID0gUFJFICsgIkRldGFjaGVk\nU3RhdGUiOwogICAgICAgICAgICBkZWNsYXJlciA9IF9wYy5nZXROYW1lKCk7\nCiAgICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxk\nKG5hbWUsIE9iamVjdC5jbGFzcyk7CiAgICAgICAgICAgIGZpZWxkLm1ha2VQ\ncml2YXRlKCk7CiAgICAgICAgICAgIGZpZWxkLnNldFRyYW5zaWVudCh0cnVl\nKTsKICAgICAgICB9IGVsc2UgaWYgKGltcGwpIHsKICAgICAgICAgICAgbmFt\nZSA9IGRldGFjaEZpZWxkLmdldE5hbWUoKTsKICAgICAgICAgICAgZGVjbGFy\nZXIgPSBkZXRhY2hGaWVsZC5nZXREZWNsYXJpbmdDbGFzcygpLmdldE5hbWUo\nKTsKICAgICAgICB9CgogICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNHZXRE\nZXRhY2hlZFN0YXRlICgpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3Bj\nLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAg\nICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5z\nZXRTdGF0aWMoZmFsc2UpOwogICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7\nCiAgICAgICAgaW50IGFjY2VzcyA9IG1ldGhvZC5nZXRBY2Nlc3NGbGFncygp\nOwoKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nICAgICAgICBpZiAoaW1wbCkgewogICAgICAgICAgICAvLyByZXR1cm4gcGNE\nZXRhY2hlZFN0YXRlOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgX21h\nbmFnZWRUeXBlLmdldFByb2plY3QoKS5sb2FkQ2xhc3MoZGVjbGFyZXIpLAog\nICAgICAgICAgICAgICAgbmFtZSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5h\ncmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CgogICAgICAgIC8v\nIHB1YmxpYyB2b2lkIHBjU2V0RGV0YWNoZWRTdGF0ZSAoT2JqZWN0IHN0YXRl\nKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJT\nZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3\nIENsYXNzIFtdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgbWV0aG9kLnNl\ndEFjY2Vzc0ZsYWdzKGFjY2Vzcyk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5n\nZXRDb2RlKHRydWUpOwogICAgICAgIGlmIChpbXBsKSB7CiAgICAgICAgICAg\nIC8vIHBjRGV0YWNoZWRTdGF0ZSA9IHN0YXRlOwogICAgICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBwdXRmaWVsZChj\nb2RlLCBfbWFuYWdlZFR5cGUuZ2V0UHJvamVjdCgpLmxvYWRDbGFzcyhkZWNs\nYXJlciksCiAgICAgICAgICAgICAgICBuYW1lLCBPYmplY3QuY2xhc3MpOwog\nICAgICAgIH0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdG8gPGNv\nZGU+Y29kZTwvY29kZT4gdGhlIGluc3RydWN0aW9ucyB0byBnZXQgZmllbGQK\nICAgICAqIDxjb2RlPmF0dHJOYW1lPC9jb2RlPiBkZWNsYXJlZCBpbiB0eXBl\nIDxjb2RlPmRlY2xhcmVyPC9jb2RlPgogICAgICogb250byB0aGUgdG9wIG9m\nIHRoZSBzdGFjay4KICAgICAqCiAgICAgKiBUaGUgaW5zdGFuY2UgdG8gYWNj\nZXNzIG11c3QgYWxyZWFkeSBiZSBvbiB0aGUgdG9wIG9mIHRoZQogICAgICog\nc3RhY2sgd2hlbiB0aGlzIGlzIGludm9rZWQuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBnZXRmaWVsZChDb2RlIGNvZGUsIEJDQ2xhc3MgZGVjbGFyZXIs\nIFN0cmluZyBhdHRyTmFtZSkgewogICAgICAgIGlmIChkZWNsYXJlciA9PSBu\ndWxsKQogICAgICAgICAgICBkZWNsYXJlciA9IF9tYW5hZ2VkVHlwZTsKCiAg\nICAgICAgLy8gZmlyc3QsIHNlZSBpZiB3ZSBjYW4gY29udmVydCB0aGUgYXR0\ncmlidXRlIG5hbWUgdG8gYSBmaWVsZCBuYW1lCiAgICAgICAgU3RyaW5nIGZp\nZWxkTmFtZSA9IHRvQmFja2luZ0ZpZWxkTmFtZShhdHRyTmFtZSk7CgogICAg\nICAgIC8vIG5leHQsIGZpbmQgdGhlIGZpZWxkIGluIHRoZSBtYW5hZ2VkIHR5\ncGUgaGllcmFyY2h5CiAgICAgICAgQkNGaWVsZCBmaWVsZCA9IG51bGw7CiAg\nICAgICAgb3V0ZXI6IGZvciAoQkNDbGFzcyBiYyA9IF9wYzsgYmMgIT0gbnVs\nbDsgYmMgPSBiYy5nZXRTdXBlcmNsYXNzQkMoKSkgewogICAgICAgICAgICBC\nQ0ZpZWxkW10gZmllbGRzID0gKEJDRmllbGRbXSkgQWNjZXNzQ29udHJvbGxl\ncgogICAgICAgICAgICAgICAgLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBl\nci5nZXRCQ0NsYXNzRmllbGRzQWN0aW9uKGJjLAogICAgICAgICAgICAgICAg\nICAgIGZpZWxkTmFtZSkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZmll\nbGQgPSBmaWVsZHNbaV07CiAgICAgICAgICAgICAgICAvLyBpZiB3ZSByZWFj\naCBhIGZpZWxkIGRlY2xhcmVkIGluIHRoaXMgdHlwZSwgdGhlbiB0aGlzIGlz\nIHRoZQogICAgICAgICAgICAgICAgLy8gbW9zdC1tYXNraW5nIGZpZWxkLCBh\nbmQgaXMgdGhlIG9uZSB0aGF0IHdlIHdhbnQuCiAgICAgICAgICAgICAgICBp\nZiAoZmllbGRzW2ldLmdldERlY2xhcmVyKCkgPT0gZGVjbGFyZXIpIHsKICAg\nICAgICAgICAgICAgICAgICBicmVhayBvdXRlcjsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGdldENy\nZWF0ZVN1YmNsYXNzKCkgJiYgY29kZS5nZXRNZXRob2QoKS5nZXREZWNsYXJl\ncigpID09IF9wYwogICAgICAgICAgICAmJiAoZmllbGQgPT0gbnVsbCB8fCAh\nZmllbGQuaXNQdWJsaWMoKSkpIHsKICAgICAgICAgICAgLy8gd2UncmUgY3Jl\nYXRpbmcgdGhlIHN1YmNsYXNzLCBub3QgcmVkZWZpbmluZyB0aGUgdXNlciB0\neXBlLgoKICAgICAgICAgICAgLy8gUmVmbGVjdGlvbi5nZXRYWFgodGhpcywg\nUmVmbGVjdGlvbi5maW5kRmllbGQoLi4uKSk7CiAgICAgICAgICAgIGNvZGUu\nY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGRlY2xhcmVyKTsKICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZpZWxkTmFtZSk7CiAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVjdGlv\nbi5jbGFzcywKICAgICAgICAgICAgICAgICJmaW5kRmllbGQiLCBGaWVsZC5j\nbGFzcywgbmV3IENsYXNzW10gewogICAgICAgICAgICAgICAgQ2xhc3MuY2xh\nc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAg\nICAgQ2xhc3MgdHlwZSA9IF9tZXRhLmdldEZpZWxkKGF0dHJOYW1lKS5nZXRE\nZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKAogICAgICAgICAg\nICAgICAgICAgIGdldFJlZmxlY3Rpb25HZXR0ZXJNZXRob2QodHlwZSwgRmll\nbGQuY2xhc3MpKTsKICAgICAgICAgICAgfSBjYXRjaCAoTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8vIHNob3VsZCBuZXZl\nciBoYXBwZW4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4\nY2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXR5\ncGUuaXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAg\nICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCku\nc2V0RmllbGQoZGVjbGFyZXIuZ2V0TmFtZSgpLCBmaWVsZE5hbWUsCiAgICAg\nICAgICAgICAgICBmaWVsZC5nZXRUeXBlKCkuZ2V0TmFtZSgpKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRvIDxjb2RlPmNvZGU8\nL2NvZGU+IHRoZSBpbnN0cnVjdGlvbnMgdG8gc2V0IGZpZWxkCiAgICAgKiA8\nY29kZT5hdHRyTmFtZTwvY29kZT4gZGVjbGFyZWQgaW4gdHlwZSA8Y29kZT5k\nZWNsYXJlcjwvY29kZT4KICAgICAqIHRvIHRoZSB2YWx1ZSBvZiB0eXBlIDxj\nb2RlPmZpZWxkVHlwZTwvY29kZT4gb24gdGhlIHRvcCBvZiB0aGUgc3RhY2su\nCiAgICAgKgogICAgICogV2hlbiB0aGlzIG1ldGhvZCBpcyBpbnZva2VkLCB0\naGUgdmFsdWUgdG8gbG9hZCBtdXN0CiAgICAgKiBhbHJlYWR5IGJlIG9uIHRo\nZSB0b3Agb2YgdGhlIHN0YWNrIGluIDxjb2RlPmNvZGU8L2NvZGU+LAogICAg\nICogYW5kIHRoZSBpbnN0YW5jZSB0byBsb2FkIGludG8gbXVzdCBiZSBzZWNv\nbmQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwdXRmaWVsZChDb2RlIGNv\nZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0cmluZyBhdHRyTmFtZSwKICAgICAg\nICBDbGFzcyBmaWVsZFR5cGUpIHsKICAgICAgICBpZiAoZGVjbGFyZXIgPT0g\nbnVsbCkKICAgICAgICAgICAgZGVjbGFyZXIgPSBfbWFuYWdlZFR5cGU7Cgog\nICAgICAgIFN0cmluZyBmaWVsZE5hbWUgPSB0b0JhY2tpbmdGaWVsZE5hbWUo\nYXR0ck5hbWUpOwoKICAgICAgICBpZiAoZ2V0UmVkZWZpbmUoKSB8fCBnZXRD\ncmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIC8vIFJlZmxlY3Rpb24u\nc2V0KHRoaXMsIFJlZmxlY3Rpb24uZmluZEZpZWxkKC4uLiksIHZhbHVlKTsK\nICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZGVj\nbGFyZXIpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nZmllbGROYW1lKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKHRydWUpOwogICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgImZp\nbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7CiAgICAgICAg\nICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBib29sZWFuLmNs\nYXNzIH0pOwogICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1l\ndGhvZChSZWZsZWN0aW9uLmNsYXNzLCAic2V0IiwKICAgICAgICAgICAgICAg\nIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7CiAg\nICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICAg\nICAgICAgIGZpZWxkVHlwZS5pc1ByaW1pdGl2ZSgpID8gZmllbGRUeXBlIDog\nT2JqZWN0LmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICBGaWVsZC5jbGFz\ncyB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb2RlLnB1dGZp\nZWxkKCkKICAgICAgICAgICAgICAgIC5zZXRGaWVsZChkZWNsYXJlci5nZXRO\nYW1lKCksIGZpZWxkTmFtZSwgZmllbGRUeXBlLmdldE5hbWUoKSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYgdXNpbmcgcHJvcGVydHkg\nYWNjZXNzLCBzZWUgaWYgdGhlcmUgaXMgYSBkaWZmZXJlbnQgYmFja2luZyBm\naWVsZAogICAgICogbmFtZSBmb3IgdGhlIHBlcnNpc3RlbnQgYXR0cmlidXRl\nIDxjb2RlPm5hbWU8L2NvZGU+LgogICAgICovCiAgICBwcml2YXRlIFN0cmlu\nZyB0b0JhY2tpbmdGaWVsZE5hbWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBp\nZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUND\nRVNTX1BST1BFUlRZCiAgICAgICAgICAgICYmIF9hdHRyc1RvRmllbGRzICE9\nIG51bGwgJiYgX2F0dHJzVG9GaWVsZHMuY29udGFpbnNLZXkobmFtZSkpCiAg\nICAgICAgICAgIG5hbWUgPSAoU3RyaW5nKSBfYXR0cnNUb0ZpZWxkcy5nZXQo\nbmFtZSk7CiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJZiB1c2luZyBwcm9wZXJ0eSBhY2Nlc3MsIHNlZSBpZiB0aGVyZSBp\ncyBhIGRpZmZlcmVudCBwZXJzaXN0ZW50CiAgICAgKiBhdHRyaWJ1dGUgbmFt\nZSBmb3IgdGhlIGJhY2tpbmcgZmllbGQgPGNvZGU+bmFtZTwvY29kZT4uCiAg\nICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGZyb21CYWNraW5nRmllbGROYW1l\nKFN0cmluZyBuYW1lKSB7CiAgICAgICAgLy8gbWV0YSBpcyBudWxsIHdoZW4g\nZG9pbmcgcGVyc2lzdGVuY2UtYXdhcmUgZW5oYW5jZW1lbnQKICAgICAgICBp\nZiAoX21ldGEgIT0gbnVsbAogICAgICAgICAgICAmJiBfbWV0YS5nZXRBY2Nl\nc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVSVFkKICAg\nICAgICAgICAgJiYgX2ZpZWxkc1RvQXR0cnMgIT0gbnVsbCAmJiBfZmllbGRz\nVG9BdHRycy5jb250YWluc0tleShuYW1lKSkKICAgICAgICAgICAgcmV0dXJu\nIChTdHJpbmcpIF9maWVsZHNUb0F0dHJzLmdldChuYW1lKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIC8qKgog\nICAgICogSW1wbGVtZW50IHRoZSBleHRlcm5hbGl6YWJsZSBpbnRlcmZhY2Ug\ndG8gZGV0YWNoIG9uIHNlcmlhbGl6ZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZERldGFjaEV4dGVybmFsaXplKGJvb2xlYW4gcGFyZW50RGV0YWNo\nYWJsZSwKICAgICAgICBib29sZWFuIGRldGFjaGVkU3RhdGUpCiAgICAgICAg\ndGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gZW5z\ndXJlIHRoYXQgdGhlIGRlY2xhcmVkIGRlZmF1bHQgY29uc3RydWN0b3IgaXMg\ncHVibGljIAogICAgICAgIC8vIGZvciBleHRlcm5hbGl6YXRpb24KICAgICAg\nICBCQ01ldGhvZCBtZXRoID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCI8aW5p\ndD4iLCAoU3RyaW5nW10pIG51bGwpOwogICAgICAgIGlmICghbWV0aC5pc1B1\nYmxpYygpKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZW5oYW5j\nZS1kZWZjb25zLWV4dGVybiIsIAogICAgICAgICAgICAgICAgICBfbWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkpKTsKICAgICAgICAgICAgbWV0aC5tYWtlUHVi\nbGljKCk7CiAgICAgICAgfQogICAgICAgIC8vIGRlY2xhcmUgZXh0ZXJuYWxp\nemFibGUgaW50ZXJmYWNlCiAgICAgICAgaWYgKCFFeHRlcm5hbGl6YWJsZS5j\nbGFzcy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSkpCiAgICAgICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNlKEV4dGVybmFs\naXphYmxlLmNsYXNzKTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSB1c2Vy\nIGRvZXNuJ3QgYWxyZWFkeSBoYXZlIGN1c3RvbSBleHRlcm5hbGl6YXRpb24g\nb3IKICAgICAgICAvLyBzZXJpYWxpemF0aW9uIG1ldGhvZHMKICAgICAgICBD\nbGFzc1tdIGlucHV0ID0gbmV3IENsYXNzW117IE9iamVjdElucHV0U3RyZWFt\nLmNsYXNzIH07CiAgICAgICAgQ2xhc3NbXSBvdXRwdXQgPSBuZXcgQ2xhc3Nb\nXXsgT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzIH07CiAgICAgICAgaWYgKF9t\nYW5hZ2VkVHlwZS5nZXREZWNsYXJlZE1ldGhvZCgicmVhZE9iamVjdCIsIGlu\ncHV0KSAhPSBudWxsCiAgICAgICAgICAgIHx8IF9tYW5hZ2VkVHlwZS5nZXRE\nZWNsYXJlZE1ldGhvZCgid3JpdGVPYmplY3QiLCBvdXRwdXQpICE9IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJkZXRhY2gtY3VzdG9tLXNlciIsIF9tZXRhKSk7CiAgICAgICAgaW5wdXRb\nMF0gPSBPYmplY3RJbnB1dC5jbGFzczsKICAgICAgICBvdXRwdXRbMF0gPSBP\nYmplY3RPdXRwdXQuY2xhc3M7CiAgICAgICAgaWYgKF9tYW5hZ2VkVHlwZS5n\nZXREZWNsYXJlZE1ldGhvZCgicmVhZEV4dGVybmFsIiwgaW5wdXQpICE9IG51\nbGwKICAgICAgICAgICAgfHwgX21hbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0\naG9kKCJ3cml0ZUV4dGVybmFsIiwgb3V0cHV0KSAhPSBudWxsKQogICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZGV0YWNo\nLWN1c3RvbS1leHRlcm4iLCBfbWV0YSkpOwoKICAgICAgICAvLyBjcmVhdGUg\nbGlzdCBvZiBhbGwgdW5tYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAg\nICAgICBCQ0ZpZWxkW10gZmllbGRzID0gX21hbmFnZWRUeXBlLmdldERlY2xh\ncmVkRmllbGRzKCk7CiAgICAgICAgQ29sbGVjdGlvbiB1bm1nZCA9IG5ldyBB\ncnJheUxpc3QoZmllbGRzLmxlbmd0aCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYg\nKCFmaWVsZHNbaV0uaXNUcmFuc2llbnQoKSAmJiAhZmllbGRzW2ldLmlzU3Rh\ndGljKCkKICAgICAgICAgICAgICAgICYmICFmaWVsZHNbaV0uaXNGaW5hbCgp\nCiAgICAgICAgICAgICAgICAmJiAhZmllbGRzW2ldLmdldE5hbWUoKS5zdGFy\ndHNXaXRoKFBSRSkKICAgICAgICAgICAgICAgICYmIF9tZXRhLmdldERlY2xh\ncmVkRmllbGQoZmllbGRzW2ldLmdldE5hbWUoKSkgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHVubWdkLmFkZChmaWVsZHNbaV0pOwogICAgICAgIH0KCiAg\nICAgICAgYWRkUmVhZEV4dGVybmFsKHBhcmVudERldGFjaGFibGUsIGRldGFj\naGVkU3RhdGUpOwogICAgICAgIGFkZFJlYWRVbm1hbmFnZWQodW5tZ2QsIHBh\ncmVudERldGFjaGFibGUpOwogICAgICAgIGFkZFdyaXRlRXh0ZXJuYWwocGFy\nZW50RGV0YWNoYWJsZSwgZGV0YWNoZWRTdGF0ZSk7CiAgICAgICAgYWRkV3Jp\ndGVVbm1hbmFnZWQodW5tZ2QsIHBhcmVudERldGFjaGFibGUpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkIGN1c3RvbSByZWFkRXh0ZXJuYWwgbWV0aG9k\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUmVhZEV4dGVybmFsKGJv\nb2xlYW4gcGFyZW50RGV0YWNoYWJsZSwKICAgICAgICBib29sZWFuIGRldGFj\naGVkU3RhdGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlv\nbiB7CiAgICAgICAgQ2xhc3NbXSBpbmFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2Jq\nZWN0SW5wdXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3Bj\nLmRlY2xhcmVNZXRob2QoInJlYWRFeHRlcm5hbCIsIHZvaWQuY2xhc3MsIGlu\nYXJncyk7CiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMgPSBtZXRoLmdldEV4\nY2VwdGlvbnModHJ1ZSk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJ\nT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlv\nbihDbGFzc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1cGVy\nLnJlYWRFeHRlcm5hbCAoaW4pOwogICAgICAgIENsYXNzIHN1cCA9IF9tZXRh\nLmdldERlc2NyaWJlZFR5cGUoKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAg\naWYgKCFwYXJlbnREZXRhY2hhYmxlICYmIEV4dGVybmFsaXphYmxlLmNsYXNz\nLmlzQXNzaWduYWJsZUZyb20oc3VwKSkgewogICAgICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2Qoc3VwLCAicmVhZEV4dGVybmFsIiwKICAgICAg\nICAgICAgICAgIHZvaWQuY2xhc3MsIGluYXJncyk7CiAgICAgICAgfQoKICAg\nICAgICAvLyByZWFkVW5tYW5hZ2VkIChpbik7CiAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChnZXRUeXBlKF9tZXRhKSwKICAgICAgICAgICAgUFJFICsgIlJl\nYWRVbm1hbmFnZWQiLCB2b2lkLmNsYXNzLCBpbmFyZ3MpOwoKICAgICAgICBp\nZiAoZGV0YWNoZWRTdGF0ZSkgewogICAgICAgICAgICAvLyBwY1NldERldGFj\naGVkU3RhdGUgKGluLnJlYWRPYmplY3QgKCkpOwogICAgICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9r\nZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RJbnB1dC5jbGFzcywgInJl\nYWRPYmplY3QiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxs\nKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKFBSRSArICJTZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIHZv\naWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CgogICAg\nICAgICAgICAvLyBwY1JlcGxhY2VTdGF0ZU1hbmFnZXIgKChTdGF0ZU1hbmFn\nZXIpIGluLnJlYWRPYmplY3QgKCkpOwogICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVy\nZmFjZSgpLnNldE1ldGhvZChPYmplY3RJbnB1dC5jbGFzcywgInJlYWRPYmpl\nY3QiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFN0YXRlTWFuYWdl\nci5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChQUkUgKyAiUmVwbGFjZVN0YXRlTWFuYWdlciIsCiAgICAgICAg\nICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU3RhdGVNYW5hZ2Vy\nLmNsYXNzIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVhZCBtYW5hZ2Vk\nIGZpZWxkcwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEu\nZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNUcmFu\nc2llbnQoKSkKICAgICAgICAgICAgICAgIHJlYWRFeHRlcm5hbChjb2RlLCBm\nbWRzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZSgpLCBmbWRzW2ldKTsKCiAgICAgICAgY29kZS52\ncmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZWFkIHVubWFuYWdlZCBmaWVsZHMgZnJvbSB0aGUgc3Ry\nZWFtIChwY1JlYWRVbm1hbmFnZWQpLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkUmVhZFVubWFuYWdlZChDb2xsZWN0aW9uIHVubWdkLCBib29sZWFu\nIHBhcmVudERldGFjaGFibGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NbXSBpbmFyZ3MgPSBuZXcgQ2xh\nc3NbXXsgT2JqZWN0SW5wdXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBt\nZXRoID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlJlYWRVbm1hbmFnZWQi\nLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBpbmFyZ3MpOwogICAgICAgIG1l\ndGgubWFrZVByb3RlY3RlZCgpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBz\nID0gbWV0aC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vwcy5h\nZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgIGV4Y2Vw\ncy5hZGRFeGNlcHRpb24oQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICAvLyBzdXBlci5yZWFkVW5tYW5hZ2VkIChpbik7CiAgICAgICAgaWYg\nKHBhcmVudERldGFjaGFibGUpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFs\nKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBn\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKSwgUFJFICsgIlJlYWRVbm1hbmFn\nZWQiLCB2b2lkLmNsYXNzLCAKICAgICAgICAgICAgICAgIGluYXJncyk7CiAg\nICAgICAgfQoKICAgICAgICAvLyByZWFkIGRlY2xhcmVkIHVubWFuYWdlZCBz\nZXJpYWxpemFibGUgZmllbGRzCiAgICAgICAgQkNGaWVsZCBmaWVsZDsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHVubWdkLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGZpZWxkID0gKEJDRmllbGQp\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHJlYWRFeHRlcm5hbChjb2RlLCBm\naWVsZC5nZXROYW1lKCksIGZpZWxkLmdldFR5cGUoKSwgbnVsbCk7CiAgICAg\nICAgfQogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0\nbyByZWFkIGEgZmllbGQgZnJvbSBhbiBleHRlcm5hbGl6YXRpb24gaW5wdXQg\nc3RyZWFtLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVhZEV4dGVybmFs\nKENvZGUgY29kZSwgU3RyaW5nIGZpZWxkTmFtZSwgQ2xhc3MgdHlwZSwKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgbWV0aE5hbWU7CiAg\nICAgICAgaWYgKHR5cGUuaXNQcmltaXRpdmUoKSkgewogICAgICAgICAgICBt\nZXRoTmFtZSA9IHR5cGUuZ2V0TmFtZSgpOwogICAgICAgICAgICBtZXRoTmFt\nZSA9IENoYXJhY3Rlci50b1VwcGVyQ2FzZShtZXRoTmFtZS5jaGFyQXQoMCkp\nCiAgICAgICAgICAgICAgICArIG1ldGhOYW1lLnN1YnN0cmluZygxKTsKICAg\nICAgICAgICAgbWV0aE5hbWUgPSAicmVhZCIgKyBtZXRoTmFtZTsKICAgICAg\nICB9IGVsc2UKICAgICAgICAgICAgbWV0aE5hbWUgPSAicmVhZE9iamVjdCI7\nCgogICAgICAgIC8vIDxmaWVsZD4gPSBpbi5yZWFkPHR5cGU+ICgpOwogICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBDbGFzcyByZXQg\nPSAodHlwZS5pc1ByaW1pdGl2ZSgpKSA/IHR5cGUgOiBPYmplY3QuY2xhc3M7\nCiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2Jq\nZWN0SW5wdXQuY2xhc3MsIG1ldGhOYW1lLAogICAgICAgICAgICByZXQsIG51\nbGwpOwogICAgICAgIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUg\nIT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUodHlwZSk7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAg\nICAgICAgICBwdXRmaWVsZChjb2RlLCBudWxsLCBmaWVsZE5hbWUsIHR5cGUp\nOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBhZGRTZXRNYW5hZ2VkVmFs\ndWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkFSUkFZOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVD\nVElPTjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICAg\nICAgICAgIC8vIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIC8vICAgc20ucHJveHlEZXRhY2hlZERlc2VyaWFsaXplZCAoPGluZGV4Pik7\nCiAgICAgICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgICAgIElm\nSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbnVsbCgpOwogICAgICAgICAg\nICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChT\nTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoZm1kLmdldEluZGV4KCkpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwK\nICAgICAgICAgICAgICAgICAgICAgICAgInByb3h5RGV0YWNoZWREZXNlcmlh\nbGl6ZWQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgICAgICAgICAgICAg\nIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBjdXN0b20gd3Jp\ndGVFeHRlcm5hbCBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGRXcml0ZUV4dGVybmFsKGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSwKICAg\nICAgICBib29sZWFuIGRldGFjaGVkU3RhdGUpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NbXSBvdXRhcmdz\nID0gbmV3IENsYXNzW117IE9iamVjdE91dHB1dC5jbGFzcyB9OwogICAgICAg\nIEJDTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZCgid3JpdGVFeHRl\ncm5hbCIsIHZvaWQuY2xhc3MsIG91dGFyZ3MpOwogICAgICAgIEV4Y2VwdGlv\nbnMgZXhjZXBzID0gbWV0aC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAg\nIGV4Y2Vwcy5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nLy8gc3VwZXIud3JpdGVFeHRlcm5hbCAob3V0KTsKICAgICAgICBDbGFzcyBz\ndXAgPSBnZXRUeXBlKF9tZXRhKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAg\naWYgKCFwYXJlbnREZXRhY2hhYmxlICYmIEV4dGVybmFsaXphYmxlLmNsYXNz\nLmlzQXNzaWduYWJsZUZyb20oc3VwKSkgewogICAgICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2Qoc3VwLCAid3JpdGVFeHRlcm5hbCIsCiAgICAg\nICAgICAgICAgICB2b2lkLmNsYXNzLCBvdXRhcmdzKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIHdyaXRlVW5tYW5hZ2VkIChvdXQpOwogICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YSksCiAgICAgICAgICAgIFBSRSAr\nICJXcml0ZVVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIG91dGFyZ3MpOwoKICAg\nICAgICBKdW1wSW5zdHJ1Y3Rpb24gZ28yID0gbnVsbDsKICAgICAgICBpZiAo\nZGV0YWNoZWRTdGF0ZSkgewogICAgICAgICAgICAvLyBpZiAoc20gIT0gbnVs\nbCkKICAgICAgICAgICAgLy8gICBpZiAoc20ud3JpdGVEZXRhY2hlZCAob3V0\nKSkKICAgICAgICAgICAgLy8gICAgICByZXR1cm47CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAg\nICAgIElmSW5zdHJ1Y3Rpb24gaWZudWxsID0gY29kZS5pZm51bGwoKTsKICAg\nICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAg\nICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBF\nKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZ\nUEUsICJ3cml0ZURldGFjaGVkIiwKICAgICAgICAgICAgICAgIGJvb2xlYW4u\nY2xhc3MsIG91dGFyZ3MpOwogICAgICAgICAgICBnbzIgPSBjb2RlLmlmZXEo\nKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgICAgICAv\nLyBlbHNlCiAgICAgICAgICAgIC8vICAgb3V0LndyaXRlT2JqZWN0IChwY0dl\ndERldGFjaGVkU3RhdGUgKCkpOwogICAgICAgICAgICBDbGFzc1tdIG9iamFy\nZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH07CiAgICAgICAgICAg\nIGlmbnVsbC5zZXRUYXJnZXQoY29kZS5hbG9hZCgpLnNldFBhcmFtKDApKTsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQ\nUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICBPYmpl\nY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVy\nZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRwdXQuY2xhc3MsCiAgICAgICAg\nICAgICAgICAid3JpdGVPYmplY3QiLCB2b2lkLmNsYXNzLCBvYmphcmdzKTsK\nICAgICAgICAgICAgLy8gICAgb3V0LndyaXRlT2JqZWN0IChudWxsKSAvLyBT\ndGF0ZU1hbmFnZXIKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoKE9i\namVjdCkgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkuc2V0TWV0aG9kKE9iamVjdE91dHB1dC5jbGFzcywKICAgICAgICAgICAg\nICAgICJ3cml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsIG9iamFyZ3MpOwogICAg\nICAgIH0KICAgICAgICBpZiAoZ28yICE9IG51bGwpCiAgICAgICAgICAgIGdv\nMi5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CgogICAgICAgIC8vIHdyaXRlIG1h\nbmFnZWQgZmllbGRzCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBf\nbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghZm1kc1tpXS5p\nc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgd3JpdGVFeHRlcm5hbChj\nb2RlLCBmbWRzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBm\nbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCBmbWRzW2ldKTsKCiAgICAgICAg\nLy8gcmV0dXJuCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSB1bm1h\nbmFnZWQgZmllbGRzIHRvIHRoZSBzdHJlYW0gKHBjV3JpdGVVbm1hbmFnZWQp\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkV3JpdGVVbm1hbmFnZWQo\nQ29sbGVjdGlvbiB1bm1nZCwgYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlKQog\nICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAg\nIENsYXNzW10gb3V0YXJncyA9IG5ldyBDbGFzc1tdeyBPYmplY3RPdXRwdXQu\nY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xhcmVN\nZXRob2QoUFJFICsgIldyaXRlVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywKICAg\nICAgICAgICAgb3V0YXJncyk7CiAgICAgICAgbWV0aC5tYWtlUHJvdGVjdGVk\nKCk7CiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMgPSBtZXRoLmdldEV4Y2Vw\ndGlvbnModHJ1ZSk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4\nY2VwdGlvbi5jbGFzcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRD\nb2RlKHRydWUpOwoKICAgICAgICAvLyBzdXBlci53cml0ZVVubWFuYWdlZCAo\nb3V0KTsKICAgICAgICBpZiAocGFyZW50RGV0YWNoYWJsZSkgewogICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBj\nb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4K\nICAgICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQ\nUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lkLmNsYXNzLCAKICAgICAgICAg\nICAgICAgIG91dGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gd3JpdGUg\nZGVjbGFyZWQgdW5tYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAg\nICBCQ0ZpZWxkIGZpZWxkOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\ndW5tZ2QuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgZmllbGQgPSAoQkNGaWVsZCkgaXRyLm5leHQoKTsKICAgICAgICAgICAg\nd3JpdGVFeHRlcm5hbChjb2RlLCBmaWVsZC5nZXROYW1lKCksIGZpZWxkLmdl\ndFR5cGUoKSwgbnVsbCk7CiAgICAgICAgfQogICAgICAgIGNvZGUudnJldHVy\nbigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgog\nICAgICogSGVscGVyIG1ldGhvZCB0byB3cml0ZSBhIGZpZWxkIHRvIGFuIGV4\ndGVybmFsaXphdGlvbiBvdXRwdXQgc3RyZWFtLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgd3JpdGVFeHRlcm5hbChDb2RlIGNvZGUsIFN0cmluZyBmaWVs\nZE5hbWUsIENsYXNzIHR5cGUsCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgU3RyaW5nIG1ldGhOYW1lOwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0\naXZlKCkpIHsKICAgICAgICAgICAgbWV0aE5hbWUgPSB0eXBlLmdldE5hbWUo\nKTsKICAgICAgICAgICAgbWV0aE5hbWUgPSBDaGFyYWN0ZXIudG9VcHBlckNh\nc2UobWV0aE5hbWUuY2hhckF0KDApKQogICAgICAgICAgICAgICAgKyBtZXRo\nTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgIG1ldGhOYW1lID0gIndy\naXRlIiArIG1ldGhOYW1lOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBt\nZXRoTmFtZSA9ICJ3cml0ZU9iamVjdCI7CgogICAgICAgIC8vIG91dC53cml0\nZTx0eXBlPiAoPGZpZWxkPik7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgZ2V0\nZmllbGQoY29kZSwgbnVsbCwgZmllbGROYW1lKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsK\nICAgICAgICBDbGFzc1tdIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgdHlwZSB9Owog\nICAgICAgIGlmICh0eXBlID09IGJ5dGUuY2xhc3MgfHwgdHlwZSA9PSBjaGFy\nLmNsYXNzIHx8IHR5cGUgPT0gc2hvcnQuY2xhc3MpCiAgICAgICAgICAgIGFy\nZ3NbMF0gPSBpbnQuY2xhc3M7CiAgICAgICAgZWxzZSBpZiAoIXR5cGUuaXNQ\ncmltaXRpdmUoKSkKICAgICAgICAgICAgYXJnc1swXSA9IE9iamVjdC5jbGFz\nczsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChP\nYmplY3RPdXRwdXQuY2xhc3MsIG1ldGhOYW1lLAogICAgICAgICAgICB2b2lk\nLmNsYXNzLCBhcmdzKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0\nTWFuYWdlZFZhbHVlQ29kZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1k\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kLCB0cnVlKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGZpZWxkIHZhbHVlIHNw\nZWNpZmllZCBieSA8Y29kZT5mbWQ8L2NvZGU+IG9udG8gdGhlIHN0YWNrLgog\nICAgICogQmVmb3JlIHRoaXMgbWV0aG9kIGlzIGNhbGxlZCwgdGhlIG9iamVj\ndCB0aGF0IHRoZSBkYXRhIHNob3VsZCBiZSBsb2FkZWQKICAgICAqIGZyb20g\nd2lsbCBiZSBvbiB0aGUgdG9wIG9mIHRoZSBzdGFjay4KICAgICAqCiAgICAg\nKiBAcGFyYW0gZnJvbVNhbWVDbGFzcyBpZiA8Y29kZT50cnVlPC9jb2RlPiwg\ndGhlbiA8Y29kZT5mbWQ8L2NvZGU+IGlzCiAgICAgKiBiZWluZyBsb2FkZWQg\nZnJvbSBhbiBpbnN0YW5jZSBvZiB0aGUgc2FtZSBjbGFzcyBhcyB0aGUgY3Vy\ncmVudCBleGVjdXRpb24KICAgICAqIGNvbnRleHQuIElmIDxjb2RlPmZhbHNl\nPC9jb2RlPiwgdGhlbiB0aGUgaW5zdGFuY2Ugb24gdGhlIHRvcCBvZiB0aGUg\nc3RhY2sKICAgICAqIG1pZ2h0IGJlIGEgc3VwZXJjbGFzcyBvZiB0aGUgY3Vy\ncmVudCBleGVjdXRpb24gY29udGV4dCdzICd0aGlzJyBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUo\nQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBib29sZWFu\nIGZyb21TYW1lQ2xhc3MpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gaWYgcmVkZWZpbmluZywgdGhlbiB3ZSBt\ndXN0IGFsd2F5cyByZWZsZWN0IChvciBhY2Nlc3MgdGhlIGZpZWxkCiAgICAg\nICAgLy8gZGlyZWN0bHkgaWYgYWNjZXNzaWJsZSksIHNpbmNlIHRoZSByZWRl\nZmluZWQgbWV0aG9kcyB3aWxsIGFsd2F5cwogICAgICAgIC8vIHRyaWdnZXIg\nbWV0aG9kIGNhbGxzIHRvIFN0YXRlTWFuYWdlciwgZXZlbiBmcm9tIGludGVy\nbmFsIGRpcmVjdC0KICAgICAgICAvLyBhY2Nlc3MgdXNhZ2UuIFdlIGNvdWxk\nIHdvcmsgYXJvdW5kIHRoaXMgYnkgbm90IHJlZGVmaW5pbmcsIGFuZAogICAg\nICAgIC8vIGp1c3QgZG8gYSBzdWJjbGFzcyBhcHByb2FjaCBpbnN0ZWFkLiBC\ndXQgdGhpcyBpcyBub3QgYSBnb29kIG9wdGlvbiwKICAgICAgICAvLyBzaW5j\nZSBpdCB3b3VsZCBzYWNyaWZpY2UgbGF6eSBsb2FkaW5nIGFuZCBlZmZpY2ll\nbnQgZGlydHkgdHJhY2tpbmcuCgogICAgICAgIGlmIChnZXRSZWRlZmluZSgp\nCiAgICAgICAgICAgIHx8IF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFz\nc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkgewogICAgICAgICAgICBnZXRmaWVs\nZChjb2RlLCBudWxsLCBmbWQuZ2V0TmFtZSgpKTsKICAgICAgICB9IGVsc2Ug\naWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgLy8gcHJv\ncGVydHkgYWNjZXNzLCBhbmQgd2UncmUgbm90IHJlZGVmaW5pbmcuIElmIHdl\nJ3JlIG9wZXJhdGluZwogICAgICAgICAgICAvLyBvbiBhbiBpbnN0YW5jZSB0\naGF0IGlzIGRlZmluaXRlbHkgdGhlIHNhbWUgdHlwZSBhcyAndGhpcycsIHRo\nZW4KICAgICAgICAgICAgLy8gY2FsbCBzdXBlcmNsYXNzIG1ldGhvZCB0byBi\neXBhc3MgdHJhY2tpbmcuIE90aGVyd2lzZSwgcmVmbGVjdAogICAgICAgICAg\nICAvLyB0byBib3RoIGJ5cGFzcyB0cmFja2luZyBhbmQgYXZvaWQgY2xhc3Mg\ndmVyaWZpY2F0aW9uIGVycm9ycy4KICAgICAgICAgICAgaWYgKGZyb21TYW1l\nQ2xhc3MpIHsKICAgICAgICAgICAgICAgIE1ldGhvZCBtZXRoID0gKE1ldGhv\nZCkgZm1kLmdldEJhY2tpbmdNZW1iZXIoKTsKICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChtZXRoKTsKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIG51\nbGwsIGZtZC5nZXROYW1lKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgLy8gcmVndWxhciBlbmhhbmNlbWVudCArIHBy\nb3BlcnR5IGFjY2VzcwogICAgICAgICAgICBNZXRob2QgbWV0aCA9IChNZXRo\nb2QpIGZtZC5nZXRCYWNraW5nTWVtYmVyKCk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyBtZXRoLmdldE5hbWUo\nKSwKICAgICAgICAgICAgICAgIG1ldGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRo\nLmdldFBhcmFtZXRlclR5cGVzKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFN0b3JlIHRoZSB2YWx1ZSBhdCB0aGUgdG9wIG9mIHRoZSBz\ndGFjayBpbnRvIHRoZSBmaWVsZCB2YWx1ZSBzcGVjaWZpZWQKICAgICAqIGJ5\nIDxjb2RlPmZtZDwvY29kZT4uIEJlZm9yZSB0aGlzIG1ldGhvZCBpcyBjYWxs\nZWQsIHRoZSBkYXRhIHRvIGxvYWQgd2lsbAogICAgICogYmUgb24gdGhlIHRv\ncCBvZiB0aGUgc3RhY2sgYW5kIHRoZSBvYmplY3QgdGhhdCB0aGUgZGF0YSBz\naG91bGQgYmUgbG9hZGVkCiAgICAgKiBpbnRvIHdpbGwgYmUgc2Vjb25kIGlu\nIHRoZSBzdGFjay4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNldE1h\nbmFnZWRWYWx1ZUNvZGUoQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBpZiByZWRlZmluaW5nLCB0aGVuIHdlIG11c3QgYWx3YXlzIHJlZmxl\nY3QgKG9yIGFjY2VzcyB0aGUgZmllbGQKICAgICAgICAvLyBkaXJlY3RseSBp\nZiBhY2Nlc3NpYmxlKSwgc2luY2UgdGhlIHJlZGVmaW5lZCBtZXRob2RzIHdp\nbGwgYWx3YXlzCiAgICAgICAgLy8gdHJpZ2dlciBtZXRob2QgY2FsbHMgdG8g\nU3RhdGVNYW5hZ2VyLCBldmVuIGZyb20gaW50ZXJuYWwgZGlyZWN0LQogICAg\nICAgIC8vIGFjY2VzcyB1c2FnZS4gV2UgY291bGQgd29yayBhcm91bmQgdGhp\ncyBieSBub3QgcmVkZWZpbmluZywgYW5kCiAgICAgICAgLy8ganVzdCBkbyBh\nIHN1YmNsYXNzIGFwcHJvYWNoIGluc3RlYWQuIEJ1dCB0aGlzIGlzIG5vdCBh\nIGdvb2Qgb3B0aW9uLAogICAgICAgIC8vIHNpbmNlIGl0IHdvdWxkIHNhY3Jp\nZmljZSBsYXp5IGxvYWRpbmcgYW5kIGVmZmljaWVudCBkaXJ0eSB0cmFja2lu\nZy4KCiAgICAgICAgaWYgKGdldFJlZGVmaW5lKCkKICAgICAgICAgICAgfHwg\nX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNT\nX0ZJRUxEKSB7CiAgICAgICAgICAgIHB1dGZpZWxkKGNvZGUsIG51bGwsIGZt\nZC5nZXROYW1lKCksIGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAg\nfSBlbHNlIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAg\nIC8vIHByb3BlcnR5IGFjY2VzcywgYW5kIHdlJ3JlIG5vdCByZWRlZmluaW5n\nLiBpbnZva2UgdGhlCiAgICAgICAgICAgIC8vIHN1cGVyY2xhc3MgbWV0aG9k\nIHRvIGJ5cGFzcyB0cmFja2luZy4KICAgICAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCksCiAg\nICAgICAgICAgICAgICBnZXRTZXR0ZXJOYW1lKGZtZCksIHZvaWQuY2xhc3Ms\nCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IGZtZC5nZXREZWNsYXJl\nZFR5cGUoKSB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBy\nZWd1bGFyIGVuaGFuY2VtZW50ICsgcHJvcGVydHkgYWNjZXNzCiAgICAgICAg\nICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyBnZXRT\nZXR0ZXJOYW1lKGZtZCksCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBu\nZXcgQ2xhc3NbXSB7IGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG9mZnNldCB0\naGF0IHRoZSBmaXJzdCBtZWFuaW5nZnVsIGFjY2Vzc29yIHBhcmFtZXRlciBp\ncyBhdC4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgZ2V0QWNjZXNzb3JQYXJh\nbWV0ZXJPZmZzZXQoKSB7CiAgICAgICAgcmV0dXJuIChfbWV0YS5nZXRBY2Nl\nc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpID8gMSA6\nIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIHtAbGluayBJbnN0\ncnVjdGlvbn1zIHRvIGxvYWQgdGhlIGluc3RhbmNlIHRvIG1vZGlmeSBvbnRv\nIHRoZQogICAgICogc3RhY2ssIGFuZCByZXR1cm4gaXQuIElmIDxjb2RlPmZv\nclN0YXRpYzwvY29kZT4gaXMgc2V0LCB0aGVuCiAgICAgKiA8Y29kZT5jb2Rl\nPC9jb2RlPiBpcyBpbiBhbiBhY2Nlc3NvciBtZXRob2Qgb3IgYW5vdGhlciBz\ndGF0aWMgbWV0aG9kOwogICAgICogb3RoZXJ3aXNlLCBpdCBpcyBpbiBvbmUg\nb2YgdGhlIFBDLXNwZWNpZmllZCBtZXRob2RzLgogICAgICoKICAgICAqIEBy\nZXR1cm4gdGhlIGZpcnN0IGluc3RydWN0aW9uIGFkZGVkIHRvIDxjb2RlPmNv\nZGU8L2NvZGU+LgogICAgICovCiAgICBwcml2YXRlIEluc3RydWN0aW9uIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoQ29kZSBjb2RlLCBib29sZWFuIGZvclN0YXRp\nYykgewogICAgICAgIGlmIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xh\nc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQgJiYgZm9yU3RhdGljKQogICAgICAg\nICAgICByZXR1cm4gY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nIHJldHVybiBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIHRoZSBnZW5lcmF0ZWQgZ2V0dGVyIHtAbGluayBC\nQ01ldGhvZH0gZm9yIDxjb2RlPmZtZDwvY29kZT4uIFRoZQogICAgICogY2Fs\nbGluZyBlbnZpcm9ubWVudCB3aWxsIHRoZW4gcG9wdWxhdGUgdGhpcyBtZXRo\nb2QncyBjb2RlIGJsb2NrLgogICAgICovCiAgICBwcml2YXRlIEJDTWV0aG9k\nIGNyZWF0ZUdldE1ldGhvZChGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAg\nIEJDTWV0aG9kIGdldHRlcjsKICAgICAgICBpZiAoX21ldGEuZ2V0QWNjZXNz\nVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAg\nICAgICAgIC8vIHN0YXRpYyA8ZmllbGR0eXBlPiBwY0dldDxmaWVsZD4gKFhY\nWCBpbnN0KQogICAgICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmdldERl\nY2xhcmVkRmllbGQoZm1kLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGdldHRl\nciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXQiICsgZm1kLmdldE5h\nbWUoKSwgZm1kLgogICAgICAgICAgICAgICAgZ2V0RGVjbGFyZWRUeXBlKCku\nZ2V0TmFtZSgpLCBuZXcgU3RyaW5nW117IF9wYy5nZXROYW1lKCkgfSk7CiAg\nICAgICAgICAgIGdldHRlci5zZXRBY2Nlc3NGbGFncyhmaWVsZC5nZXRBY2Nl\nc3NGbGFncygpCiAgICAgICAgICAgICAgICAmIH5Db25zdGFudHMuQUNDRVNT\nX1RSQU5TSUVOVCAmIH5Db25zdGFudHMuQUNDRVNTX1ZPTEFUSUxFKTsKICAg\nICAgICAgICAgZ2V0dGVyLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICAgICAg\nZ2V0dGVyLnNldEZpbmFsKHRydWUpOwogICAgICAgICAgICByZXR1cm4gZ2V0\ndGVyOwogICAgICAgIH0KCiAgICAgICAgLy8gcHJvcGVydHkgYWNjZXNzOgog\nICAgICAgIC8vIGNvcHkgdGhlIHVzZXIncyBnZXR0ZXIgbWV0aG9kIHRvIGEg\nbmV3IG5hbWU7IHdlIGNhbid0IGp1c3QgcmVzZXQKICAgICAgICAvLyB0aGUg\nbmFtZSwgYmVjYXVzZSB0aGF0IHdpbGwgYWxzbyByZXNldCBhbGwgY2FsbHMg\ndG8gdGhlIG1ldGhvZAogICAgICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkg\nZm1kLmdldEJhY2tpbmdNZW1iZXIoKTsKICAgICAgICBnZXR0ZXIgPSBfcGMu\nZ2V0RGVjbGFyZWRNZXRob2QobWV0aC5nZXROYW1lKCksCiAgICAgICAgICAg\nIG1ldGguZ2V0UGFyYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgQkNNZXRob2Qg\nbmV3Z2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgbWV0aC5nZXRO\nYW1lKCksCiAgICAgICAgICAgIG1ldGguZ2V0UmV0dXJuVHlwZSgpLCBtZXRo\nLmdldFBhcmFtZXRlclR5cGVzKCkpOwogICAgICAgIG5ld2dldHRlci5zZXRB\nY2Nlc3NGbGFncyhnZXR0ZXIuZ2V0QWNjZXNzRmxhZ3MoKSk7CiAgICAgICAg\nbmV3Z2V0dGVyLm1ha2VQcm90ZWN0ZWQoKTsgCiAgICAgICAgdHJhbnNmZXJD\nb2RlQXR0cmlidXRlcyhnZXR0ZXIsIG5ld2dldHRlcik7CiAgICAgICAgcmV0\ndXJuIGdldHRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUg\nZ2VuZXJhdGVkIHNldHRlciB7QGxpbmsgQkNNZXRob2R9IGZvciA8Y29kZT5m\nbWQ8L2NvZGU+LiBUaGUKICAgICAqIGNhbGxpbmcgZW52aXJvbm1lbnQgd2ls\nbCB0aGVuIHBvcHVsYXRlIHRoaXMgbWV0aG9kJ3MgY29kZSBibG9jay4KICAg\nICAqLwogICAgcHJpdmF0ZSBCQ01ldGhvZCBjcmVhdGVTZXRNZXRob2QoRmll\nbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBCQ01ldGhvZCBzZXR0ZXI7CiAg\nICAgICAgaWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFE\nYXRhLkFDQ0VTU19GSUVMRCkgewogICAgICAgICAgICAvLyBzdGF0aWMgdm9p\nZCBwY1NldDxmaWVsZD4gKFhYWCBpbnN0LCA8ZmllbGR0eXBlPiB2YWx1ZSkK\nICAgICAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5nZXREZWNsYXJlZEZp\nZWxkKGZtZC5nZXROYW1lKCkpOwogICAgICAgICAgICBzZXR0ZXIgPSBfcGMu\nZGVjbGFyZU1ldGhvZChQUkUgKyAiU2V0IiArIGZtZC5nZXROYW1lKCksIHZv\naWQuY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgZ2V0VHlw\nZShfbWV0YSksIGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICAg\nICAgc2V0dGVyLnNldEFjY2Vzc0ZsYWdzKGZpZWxkLmdldEFjY2Vzc0ZsYWdz\nKCkKICAgICAgICAgICAgICAgICYgfkNvbnN0YW50cy5BQ0NFU1NfVFJBTlNJ\nRU5UICYgfkNvbnN0YW50cy5BQ0NFU1NfVk9MQVRJTEUpOwogICAgICAgICAg\nICBzZXR0ZXIuc2V0U3RhdGljKHRydWUpOwogICAgICAgICAgICBzZXR0ZXIu\nc2V0RmluYWwodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBzZXR0ZXI7CiAg\nICAgICAgfQoKICAgICAgICAvLyBwcm9wZXJ0eSBhY2Nlc3M6CiAgICAgICAg\nLy8gY29weSB0aGUgdXNlcidzIGdldHRlciBtZXRob2QgdG8gYSBuZXcgbmFt\nZTsgd2UgY2FuJ3QganVzdCByZXNldAogICAgICAgIC8vIHRoZSBuYW1lLCBi\nZWNhdXNlIHRoYXQgd2lsbCBhbHNvIHJlc2V0IGFsbCBjYWxscyB0byB0aGUg\nbWV0aG9kCiAgICAgICAgc2V0dGVyID0gX3BjLmdldERlY2xhcmVkTWV0aG9k\nKGdldFNldHRlck5hbWUoZm1kKSwKICAgICAgICAgICAgbmV3IENsYXNzW117\nIGZtZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICBCQ01ldGhvZCBu\nZXdzZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyBzZXR0ZXIuZ2V0\nTmFtZSgpLAogICAgICAgICAgICBzZXR0ZXIuZ2V0UmV0dXJuTmFtZSgpLCBz\nZXR0ZXIuZ2V0UGFyYW1OYW1lcygpKTsKICAgICAgICBuZXdzZXR0ZXIuc2V0\nQWNjZXNzRmxhZ3Moc2V0dGVyLmdldEFjY2Vzc0ZsYWdzKCkpOwogICAgICAg\nIG5ld3NldHRlci5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgdHJhbnNmZXJD\nb2RlQXR0cmlidXRlcyhzZXR0ZXIsIG5ld3NldHRlcik7CiAgICAgICAgcmV0\ndXJuIHNldHRlcjsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0RW5o\nYW5jZW1lbnRDb250cmFjdFZlcnNpb25NZXRob2QoKSB7CiAgICAgICAgLy8g\ncHVibGljIGludCBnZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbigpCiAg\nICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJF\nICsgCiAgICAgICAgICAgICAgICAiR2V0RW5oYW5jZW1lbnRDb250cmFjdFZl\ncnNpb24iLCBpbnQuY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5tYWtl\nUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKEVOSEFO\nQ0VSX1ZFUlNJT04pOwogICAgICAgIGNvZGUuaXJldHVybigpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBjb25jcmV0ZSB0eXBlIGZvciB0aGUgZ2l2ZW4gY2xhc3MsIGkuZS4g\naW1wbCBmb3IgbWFuYWdlZAogICAgICogaW50ZXJmYWNlcwogICAgICovCiAg\nICBwdWJsaWMgQ2xhc3MgZ2V0VHlwZShDbGFzc01ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICBpZiAobWV0YS5nZXRJbnRlcmZhY2VJbXBsKCkgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG1ldGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwog\nICAgICAgIHJldHVybiBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIE1vdmUgY29kZS1yZWxhdGVkIGF0dHJpYnV0ZXMg\nZnJvbSBvbmUgbWV0aG9kIHRvIGFub3RoZXIuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIHZvaWQgdHJhbnNmZXJDb2RlQXR0cmlidXRlcyhCQ01ldGhv\nZCBmcm9tLCBCQ01ldGhvZCB0bykgewogICAgICAgIENvZGUgY29kZSA9IGZy\nb20uZ2V0Q29kZShmYWxzZSk7CiAgICAgICAgaWYgKGNvZGUgIT0gbnVsbCkg\newogICAgICAgICAgICB0by5hZGRBdHRyaWJ1dGUoY29kZSk7CiAgICAgICAg\nICAgIGZyb20ucmVtb3ZlQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgRXhj\nZXB0aW9ucyBleGNlcHMgPSBmcm9tLmdldEV4Y2VwdGlvbnMoZmFsc2UpOwog\nICAgICAgIGlmIChleGNlcHMgIT0gbnVsbCkKICAgICAgICAgICAgdG8uYWRk\nQXR0cmlidXRlKGV4Y2Vwcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2Fn\nZTogamF2YSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ0VuaGFuY2Vy\nIFtvcHRpb25dKgogICAgICogJmx0O2NsYXNzIG5hbWUgfCAuamF2YSBmaWxl\nIHwgLmNsYXNzIGZpbGUgfCAuamRvIGZpbGUmZ3Q7KwogICAgICogIFdoZXJl\nIHRoZSBmb2xsb3dpbmcgb3B0aW9ucyBhcmUgcmVjb2duaXplZC4KICAgICAq\nIDx1bD4KICAgICAqIDxsaT48aT4tcHJvcGVydGllcy8tcCAmbHQ7cHJvcGVy\ndGllcyBmaWxlJmd0OzwvaT46IFRoZSBwYXRoIHRvIGEgT3BlbkpQQQogICAg\nICogcHJvcGVydGllcyBmaWxlIGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYXMg\nb3V0bGluZWQgaW4KICAgICAqIHtAbGluayBDb25maWd1cmF0aW9ufTsgb3B0\naW9uYWwuPC9saT4KICAgICAqIDxsaT48aT4tJmx0O3Byb3BlcnR5IG5hbWUm\nZ3Q7ICZsdDtwcm9wZXJ0eSB2YWx1ZSZndDs8L2k+OiBBbGwgYmVhbgogICAg\nICogcHJvcGVydGllcyBvZiB0aGUgc3RhbmRhcmQgT3BlbkpQQSB7QGxpbmsg\nT3BlbkpQQUNvbmZpZ3VyYXRpb259IGNhbiBiZQogICAgICogc2V0IGJ5IHVz\naW5nIHRoZWlyIG5hbWVzIGFuZCBzdXBwbHlpbmcgYSB2YWx1ZTsgZm9yIGV4\nYW1wbGU6CiAgICAgKiA8bGk+PGk+LWRpcmVjdG9yeS8tZCAmbHQ7YnVpbGQg\nZGlyZWN0b3J5Jmd0OzwvaT46IFRoZSBwYXRoIHRvIHRoZSBiYXNlCiAgICAg\nKiBkaXJlY3Rvcnkgd2hlcmUgZW5oYW5jZWQgY2xhc3NlcyBhcmUgc3RvcmVk\nLiBCeSBkZWZhdWx0LCB0aGUKICAgICAqIGVuaGFuY2VyIG92ZXJ3cml0ZXMg\ndGhlIG9yaWdpbmFsIC5jbGFzcyBmaWxlIHdpdGggdGhlIGVuaGFuY2VkCiAg\nICAgKiB2ZXJzaW9uLiBVc2UgdGhpcyBvcHRpb24gdG8gc3RvcmUgdGhlIGdl\nbmVyYXRlZCAuY2xhc3MgZmlsZSBpbgogICAgICogYW5vdGhlciBkaXJlY3Rv\ncnkuIFRoZSBwYWNrYWdlIHN0cnVjdHVyZSB3aWxsIGJlIGNyZWF0ZWQgYmVu\nZWF0aAogICAgICogdGhlIGdpdmVuIGRpcmVjdG9yeS48L2xpPgogICAgICog\nPGxpPjxpPi1hZGREZWZhdWx0Q29uc3RydWN0b3IvLWFkYyBbdHJ1ZS90IHwg\nZmFsc2UvZl08L2k+OiBXaGV0aGVyIHRvCiAgICAgKiBhZGQgYSBkZWZhdWx0\nIGNvbnN0cnVjdG9yIHRvIHBlcnNpc3RlbnQgY2xhc3NlcyBtaXNzaW5nIG9u\nZSwgYXMKICAgICAqIG9wcG9zZWQgdG8gdGhyb3dpbmcgYW4gZXhjZXB0aW9u\nLiBEZWZhdWx0cyB0byB0cnVlLjwvbGk+CiAgICAgKiA8bGk+PGk+LXRtcENs\nYXNzTG9hZGVyLy10Y2wgW3RydWUvdCB8IGZhbHNlL2ZdPC9pPjogV2hldGhl\nciB0bwogICAgICogbG9hZCB0aGUgcHJlLWVuaGFuY2VkIGNsYXNzZXMgdXNp\nbmcgYSB0ZW1wb3JhcnkgY2xhc3MgbG9hZGVyLgogICAgICogRGVmYXVsdHMg\ndG8gdHJ1ZS4gU2V0IHRoaXMgdG8gZmFsc2Ugd2hlbiBhdHRlbXB0aW5nIHRv\nIGRlYnVnCiAgICAgKiBjbGFzcyBsb2FkaW5nIGVycm9ycy48L2xpPgogICAg\nICogPGxpPjxpPi1lbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMvLWVwciBb\ndHJ1ZS90IHwgZmFsc2UvZl08L2k+OgogICAgICogV2hldGhlciB0byB0aHJv\ndyBhbiBleGNlcHRpb24gaWYgYSBQUk9QRVJUWSBhY2Nlc3MgZW50aXR5IGFw\ncGVhcnMKICAgICAqIHRvIGJlIHZpb2xhdGluZyBzdGFuZGFyZCBwcm9wZXJ0\neSByZXN0cmljdGlvbnMuIERlZmF1bHRzIHRvIGZhbHNlLjwvbGk+CiAgICAg\nKiA8L3VsPgogICAgICogIEVhY2ggYWRkaXRpb25hbCBhcmd1bWVudCBjYW4g\nYmUgZWl0aGVyIHRoZSBmdWxsIGNsYXNzIG5hbWUgb2YgdGhlCiAgICAgKiB0\neXBlIHRvIGVuaGFuY2UsIHRoZSBwYXRoIHRvIHRoZSAuamF2YSBmaWxlIGZv\nciB0aGUgdHlwZSwgdGhlIHBhdGggdG8KICAgICAqIHRoZSAuY2xhc3MgZmls\nZSBmb3IgdGhlIHR5cGUsIG9yIHRoZSBwYXRoIHRvIGEgLmpkbyBmaWxlIGxp\nc3Rpbmcgb25lCiAgICAgKiBvciBtb3JlIHR5cGVzIHRvIGVuaGFuY2UuCiAg\nICAgKiBJZiB0aGUgdHlwZSBiZWluZyBlbmhhbmNlZCBoYXMgbWV0YWRhdGEs\nIGl0IHdpbGwgYmUgZW5oYW5jZWQgYXMgYQogICAgICogcGVyc2lzdGVuY2Ug\nY2FwYWJsZSBjbGFzcy4gSWYgbm90LCBpdCB3aWxsIGJlIGNvbnNpZGVyZWQg\nYSBwZXJzaXN0ZW5jZQogICAgICogYXdhcmUgY2xhc3MsIGFuZCBhbGwgYWNj\nZXNzIHRvIGZpZWxkcyBvZiBwZXJzaXN0ZW5jZSBjYXBhYmxlIGNsYXNzZXMK\nICAgICAqIHdpbGwgYmUgcmVwbGFjZWQgYnkgdGhlIGFwcHJvcHJpYXRlCWdl\ndC9zZXQgbWV0aG9kLiBJZiB0aGUgdHlwZQogICAgICogZXhwbGljaXRseSBk\nZWNsYXJlcyB0aGUgcGVyc2lzdGVuY2UtY2FwYWJsZSBpbnRlcmZhY2UsIGl0\nIHdpbGwKICAgICAqIG5vdCBiZSBlbmhhbmNlZC4gVGh1cywgaXQgaXMgc2Fm\nZSB0byBpbnZva2UgdGhlIGVuaGFuY2VyIG9uIGNsYXNzZXMKICAgICAqIHRo\nYXQgYXJlIGFscmVhZHkgZW5oYW5jZWQuCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsKICAgICAgICBPcHRp\nb25zIG9wdHMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgIGFyZ3MgPSBvcHRz\nLnNldEZyb21DbWRMaW5lKGFyZ3MpOwogICAgICAgIGlmICghcnVuKGFyZ3Ms\nIG9wdHMpKQogICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oX2xvYy5n\nZXQoImVuaGFuY2UtdXNhZ2UiKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\ndW4gdGhlIHRvb2wuIFJldHVybnMgZmFsc2UgaWYgaW52YWxpZCBvcHRpb25z\nIGdpdmVuLiBSdW5zIGFnYWluc3QgYWxsCiAgICAgKiB0aGUgcGVyc2lzdGVu\nY2UgdW5pdHMgZGVmaW5lZCBpbiB0aGUgcmVzb3VyY2UgdG8gcGFyc2UuCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBydW4oZmluYWwgU3Ry\naW5nW10gYXJncywgT3B0aW9ucyBvcHRzKSB7CiAgICAgICAgcmV0dXJuIENv\nbmZpZ3VyYXRpb25zLnJ1bkFnYWluc3RBbGxBbmNob3JzKG9wdHMsCiAgICAg\nICAgICAgIG5ldyBDb25maWd1cmF0aW9ucy5SdW5uYWJsZSgpIHsKICAgICAg\nICAgICAgcHVibGljIGJvb2xlYW4gcnVuKE9wdGlvbnMgb3B0cykgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIE9wZW5KUEFDb25maWd1\ncmF0aW9uIGNvbmYgPSBuZXcgT3BlbkpQQUNvbmZpZ3VyYXRpb25JbXBsKCk7\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBQQ0VuaGFuY2VyLnJ1bihjb25mLCBhcmdzLCBvcHRzKTsKICAgICAg\nICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgY29u\nZi5jbG9zZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSdW4gdGhlIHRvb2wu\nIFJldHVybnMgZmFsc2UgaWYgaW52YWxpZCBvcHRpb25zIGdpdmVuLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gcnVuKE9wZW5KUEFDb25m\naWd1cmF0aW9uIGNvbmYsIFN0cmluZ1tdIGFyZ3MsCiAgICAgICAgT3B0aW9u\ncyBvcHRzKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\nRmxhZ3MgZmxhZ3MgPSBuZXcgRmxhZ3MoKTsKICAgICAgICBmbGFncy5kaXJl\nY3RvcnkgPSBGaWxlcy5nZXRGaWxlKG9wdHMucmVtb3ZlUHJvcGVydHkoImRp\ncmVjdG9yeSIsICJkIiwKICAgICAgICAgICAgbnVsbCksIG51bGwpOwogICAg\nICAgIGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3RvciA9IG9wdHMucmVtb3Zl\nQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgiYWRkRGVmYXVsdENvbnN0\ncnVjdG9yIiwgImFkYyIsIGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7\nCiAgICAgICAgZmxhZ3MudG1wQ2xhc3NMb2FkZXIgPSBvcHRzLnJlbW92ZUJv\nb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoInRtcENsYXNzTG9hZGVyIiwg\nInRjbCIsIGZsYWdzLnRtcENsYXNzTG9hZGVyKTsKICAgICAgICBmbGFncy5l\nbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMgPSBvcHRzLnJlbW92ZUJvb2xl\nYW5Qcm9wZXJ0eQogICAgICAgICAgICAoImVuZm9yY2VQcm9wZXJ0eVJlc3Ry\naWN0aW9ucyIsICJlcHIiLAogICAgICAgICAgICAgICAgZmxhZ3MuZW5mb3Jj\nZVByb3BlcnR5UmVzdHJpY3Rpb25zKTsKCiAgICAgICAgLy8gZm9yIHVuaXQg\ndGVzdGluZwogICAgICAgIEJ5dGVjb2RlV3JpdGVyIHdyaXRlciA9IChCeXRl\nY29kZVdyaXRlcikgb3B0cy5nZXQoCiAgICAgICAgICAgIFBDRW5oYW5jZXIu\nY2xhc3MuZ2V0TmFtZSgpICsgIiNieXRlY29kZVdyaXRlciIpOwoKICAgICAg\nICBDb25maWd1cmF0aW9ucy5wb3B1bGF0ZUNvbmZpZ3VyYXRpb24oY29uZiwg\nb3B0cyk7CiAgICAgICAgcmV0dXJuIHJ1bihjb25mLCBhcmdzLCBmbGFncywg\nbnVsbCwgd3JpdGVyLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVu\naGFuY2UgdGhlIGdpdmVuIGNsYXNzZXMuCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgYm9vbGVhbiBydW4oT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwg\nU3RyaW5nW10gYXJncywKICAgICAgICBGbGFncyBmbGFncywgTWV0YURhdGFS\nZXBvc2l0b3J5IHJlcG9zLCBCeXRlY29kZVdyaXRlciB3cml0ZXIsCiAgICAg\nICAgQ2xhc3NMb2FkZXIgbG9hZGVyKQogICAgICAgIHRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxsKQogICAgICAgICAg\nICBsb2FkZXIgPSBjb25mLmdldENsYXNzUmVzb2x2ZXJJbnN0YW5jZSgpLgog\nICAgICAgICAgICAgICAgZ2V0Q2xhc3NMb2FkZXIoUENFbmhhbmNlci5jbGFz\ncywgbnVsbCk7CiAgICAgICAgaWYgKGZsYWdzLnRtcENsYXNzTG9hZGVyKQog\nICAgICAgICAgICBsb2FkZXIgPSAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAg\nICAgICAubmV3VGVtcG9yYXJ5Q2xhc3NMb2FkZXJBY3Rpb24obG9hZGVyKSk7\nCgogICAgICAgIGlmIChyZXBvcyA9PSBudWxsKSB7CiAgICAgICAgICAgIHJl\ncG9zID0gY29uZi5uZXdNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwog\nICAgICAgICAgICByZXBvcy5zZXRTb3VyY2VNb2RlKE1ldGFEYXRhUmVwb3Np\ndG9yeS5NT0RFX01FVEEpOwogICAgICAgIH0KCiAgICAgICAgTG9nIGxvZyA9\nIGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19UT09MKTsK\nICAgICAgICBDb2xsZWN0aW9uIGNsYXNzZXM7CiAgICAgICAgaWYgKGFyZ3Mg\nPT0gbnVsbCB8fCBhcmdzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIGxv\nZy5pbmZvKF9sb2MuZ2V0KCJydW5uaW5nLWFsbC1jbGFzc2VzIikpOwogICAg\nICAgICAgICBjbGFzc2VzID0gcmVwb3MuZ2V0UGVyc2lzdGVudFR5cGVOYW1l\ncyh0cnVlLCBsb2FkZXIpOwogICAgICAgICAgICBpZiAoY2xhc3NlcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIAlsb2cud2FybihfbG9jLmdldCgibm8tY2xh\nc3MtdG8tZW5oYW5jZSIpKTsKICAgICAgICAgICAgCXJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENs\nYXNzQXJnUGFyc2VyIGNhcCA9IGNvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5\nSW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9y\neSgpLm5ld0NsYXNzQXJnUGFyc2VyKCk7CiAgICAgICAgICAgIGNhcC5zZXRD\nbGFzc0xvYWRlcihsb2FkZXIpOwogICAgICAgICAgICBjbGFzc2VzID0gbmV3\nIEhhc2hTZXQoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBh\ncmdzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgY2xhc3Nlcy5hZGRB\nbGwoQXJyYXlzLmFzTGlzdChjYXAucGFyc2VUeXBlcyhhcmdzW2ldKSkpOwog\nICAgICAgIH0KCiAgICAgICAgUHJvamVjdCBwcm9qZWN0ID0gbmV3IFByb2pl\nY3QoKTsKICAgICAgICBCQ0NsYXNzIGJjOwogICAgICAgIFBDRW5oYW5jZXIg\nZW5oYW5jZXI7CiAgICAgICAgaW50IHN0YXR1czsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IGNsYXNzZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgT2JqZWN0IG8gPSBpdHIubmV4dCgpOwogICAg\nICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2UtcnVubmluZyIsIG8p\nKTsKCiAgICAgICAgICAgIGlmIChvIGluc3RhbmNlb2YgU3RyaW5nKQogICAg\nICAgICAgICAgICAgYmMgPSBwcm9qZWN0LmxvYWRDbGFzcygoU3RyaW5nKSBv\nLCBsb2FkZXIpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBi\nYyA9IHByb2plY3QubG9hZENsYXNzKChDbGFzcykgbyk7CiAgICAgICAgICAg\nIGVuaGFuY2VyID0gbmV3IFBDRW5oYW5jZXIoY29uZiwgYmMsIHJlcG9zLCBs\nb2FkZXIpOwogICAgICAgICAgICBpZiAod3JpdGVyICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBlbmhhbmNlci5zZXRCeXRlY29kZVdyaXRlcih3cml0ZXIp\nOwogICAgICAgICAgICBlbmhhbmNlci5zZXREaXJlY3RvcnkoZmxhZ3MuZGly\nZWN0b3J5KTsKICAgICAgICAgICAgZW5oYW5jZXIuc2V0QWRkRGVmYXVsdENv\nbnN0cnVjdG9yKGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAg\nICAgICAgIHN0YXR1cyA9IGVuaGFuY2VyLnJ1bigpOwogICAgICAgICAgICBp\nZiAoc3RhdHVzID09IEVOSEFOQ0VfTk9ORSkgewogICAgICAgICAgICAgICAg\naWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAg\nIGxvZy50cmFjZShfbG9jLmdldCgiZW5oYW5jZS1ub3J1biIpKTsKICAgICAg\nICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT0gRU5IQU5DRV9JTlRFUkZBQ0Up\nIHsKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkK\nICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImVuaGFu\nY2UtaW50ZXJmYWNlIikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1\ncyA9PSBFTkhBTkNFX0FXQVJFKSB7CiAgICAgICAgICAgICAgICBpZiAobG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJlbmhhbmNlLWF3YXJlIikpOwogICAgICAgICAgICAg\nICAgZW5oYW5jZXIucmVjb3JkKCk7CiAgICAgICAgICAgIH0gZWxzZQogICAg\nICAgICAgICAgICAgZW5oYW5jZXIucmVjb3JkKCk7CiAgICAgICAgICAgIHBy\nb2plY3QuY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSdW4gZmxhZ3MuCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgY2xhc3MgRmxhZ3MgewoKICAgICAgICBwdWJsaWMg\nRmlsZSBkaXJlY3RvcnkgPSBudWxsOwogICAgICAgIHB1YmxpYyBib29sZWFu\nIGFkZERlZmF1bHRDb25zdHJ1Y3RvciA9IHRydWU7CiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gdG1wQ2xhc3NMb2FkZXIgPSB0cnVlOwoJCXB1YmxpYyBib29s\nZWFuIGVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyA9IGZhbHNlOwoJfQoK\nCS8qKgogCSAqIFBsdWdpbiBpbnRlcmZhY2UgZm9yIGFkZGl0aW9uYWwgZW5o\nYW5jZW1lbnQuCgkgKi8KCXB1YmxpYyBzdGF0aWMgaW50ZXJmYWNlIEF1eGls\naWFyeUVuaGFuY2VyCgl7CgkJcHVibGljIHZvaWQgcnVuIChCQ0NsYXNzIGJj\nLCBDbGFzc01ldGFEYXRhIG1ldGEpOwoJCXB1YmxpYyBib29sZWFuIHNraXBF\nbmhhbmNlKEJDTWV0aG9kIG0pOwoJfQp9Cg==\n","encoding":"base64"}

