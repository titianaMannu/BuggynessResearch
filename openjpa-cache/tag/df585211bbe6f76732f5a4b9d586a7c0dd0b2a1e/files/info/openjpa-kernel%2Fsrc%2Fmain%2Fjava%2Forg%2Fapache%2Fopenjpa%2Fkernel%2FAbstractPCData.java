{"sha":"d14712996cde315d011e4362b640e4a7b0e54358","node_id":"MDQ6QmxvYjIwNjM2NDpkMTQ3MTI5OTZjZGUzMTVkMDExZTQzNjJiNjQwZTRhN2IwZTU0MzU4","size":15138,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d14712996cde315d011e4362b640e4a7b0e54358","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2YS51dGlsLkFycmF5\nTGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsK\naW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2YS51dGlsLkhhc2hN\nYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTG9jYWxlOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuT3JwaGFuZWRLZXlBY3Rpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkNoYW5nZVRyYWNrZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94eTsKCi8qKgogKiBBYnN0\ncmFjdCBiYXNlIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgY29yZSBQQ0RhdGEg\nYmVoYXZpb3IuCiAqCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBh\ndXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBhYnN0\ncmFjdCBjbGFzcyBBYnN0cmFjdFBDRGF0YQogICAgaW1wbGVtZW50cyBQQ0Rh\ndGEgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgT2JqZWN0IE5VTEwgPSBu\nZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3Rb\nXSBFTVBUWV9BUlJBWSA9IG5ldyBPYmplY3RbMF07CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGxvYWRlZCBmaWVsZCBtYXNrLgogICAgICovCiAgICBw\ndWJsaWMgYWJzdHJhY3QgQml0U2V0IGdldExvYWRlZCgpOwoKICAgIC8qKgog\nICAgICogQ3JlYXRlIGEgbmV3IHBjZGF0YSBmb3IgaG9sZGluZyB0aGUgc3Rh\ndGUgb2YgYW4gZW1iZWRkZWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHB1Ymxp\nYyBhYnN0cmFjdCBBYnN0cmFjdFBDRGF0YSBuZXdFbWJlZGRlZFBDRGF0YShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtKTsKCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0xvYWRlZChpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gZ2V0TG9hZGVk\nKCkuZ2V0KGZpZWxkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZm9y\nbSB0aGUgZ2l2ZW4gZGF0YSB2YWx1ZSBpbnRvIGl0cyBmaWVsZCB2YWx1ZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCB0b0ZpZWxkKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIE9i\namVjdCBkYXRhLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgUHJveHlEYXRhTGlzdCBjID0g\nKFByb3h5RGF0YUxpc3QpIGRhdGE7CiAgICAgICAgICAgICAgICBDb2xsZWN0\naW9uIGMyID0gKENvbGxlY3Rpb24pIHNtLm5ld0ZpZWxkUHJveHkoZm1kLmdl\ndEluZGV4KCkpOwogICAgICAgICAgICAgICAgYzIgPSB0b05lc3RlZEZpZWxk\ncyhzbSwgZm1kLmdldEVsZW1lbnQoKSwgKENvbGxlY3Rpb24pIGRhdGEsCiAg\nICAgICAgICAgICAgICAgICAgZmV0Y2gsIGNvbnRleHQpOwogICAgICAgICAg\nICAgICAgaWYgKGMyIGluc3RhbmNlb2YgUHJveHkpIHsKICAgICAgICAgICAg\nICAgICAgICBDaGFuZ2VUcmFja2VyIGN0ID0gKChQcm94eSkgYzIpLmdldENo\nYW5nZVRyYWNrZXIoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3QgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgY3Quc2V0TmV4dFNlcXVl\nbmNlKGMubmV4dFNlcXVlbmNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIHJldHVybiBjMjsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTUFQOgogICAgICAgICAgICAgICAgTWFwIG0gPSAoTWFwKSBkYXRhOwog\nICAgICAgICAgICAgICAgTWFwIG0yID0gKE1hcCkgc20ubmV3RmllbGRQcm94\neShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9u\nIGtleXMgPSBuZXcgQXJyYXlMaXN0IChtLnNpemUoKSk7CiAgICAgICAgICAg\nICAgICBDb2xsZWN0aW9uIHZhbHVlcyA9IG5ldyBBcnJheUxpc3QobS5zaXpl\nKCkpOyAgICAgICAgICAKCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nPE1hcC5FbnRyeT4gbWkgPSBtLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsKICAg\nICAgICAgICAgICAgICAgICBtaS5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICAgICAgTWFwLkVudHJ5IGUgPSBtaS5uZXh0KCk7CiAgICAgICAgICAg\nICAgICAgICAga2V5cy5hZGQoZS5nZXRLZXkoKSk7CiAgICAgICAgICAgICAg\nICAgICAgdmFsdWVzLmFkZChlLmdldFZhbHVlKCkpOwogICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgIE9iamVjdFtdIGtleUFycmF5ID0ga2V5\ncy50b0FycmF5KCk7CiAgICAgICAgICAgICAgICBPYmplY3RbXSB2YWx1ZUFy\ncmF5ID0gdG9OZXN0ZWRGaWVsZHMoc20sIGZtZC5nZXRFbGVtZW50KCksCiAg\nICAgICAgICAgICAgICAgICAgdmFsdWVzLCBmZXRjaCwgY29udGV4dCkudG9B\ncnJheSgpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaWR4ID0gMDsgaWR4\nIDwga2V5QXJyYXkubGVuZ3RoOyBpZHgrKykKICAgICAgICAgICAgICAgICAg\nICBtMi5wdXQoa2V5QXJyYXlbaWR4XSwgdmFsdWVBcnJheVtpZHhdKTsKCiAg\nICAgICAgICAgICAgICByZXR1cm4gbTI7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgaW50IGxlbmd0aCA9IEFy\ncmF5LmdldExlbmd0aChkYXRhKTsKICAgICAgICAgICAgICAgIE9iamVjdCBh\nID0gQXJyYXkubmV3SW5zdGFuY2UoZm1kLmdldEVsZW1lbnQoKS5nZXREZWNs\nYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICBsZW5ndGgpOwogICAg\nICAgICAgICAgICAgaWYgKGxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBhOwoKICAgICAgICAgICAgICAgIGlmIChpc0ltbXV0YWJs\nZVR5cGUoZm1kLmdldEVsZW1lbnQoKSkpIHsKICAgICAgICAgICAgICAgICAg\nICBTeXN0ZW0uYXJyYXljb3B5KGRhdGEsIDAsIGEsIDAsIGxlbmd0aCk7CiAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgQXJyYXkuc2V0KGEsIGksIHRvTmVzdGVkRmllbGQoc20s\nIGZtZC5nZXRFbGVtZW50KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBBcnJheS5nZXQoZGF0YSwgaSksIGZldGNoLCBjb250ZXh0KSk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgcmV0dXJuIGE7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICByZXR1cm4gdG9OZXN0ZWRGaWVsZChzbSwgZm1kLCBkYXRhLCBm\nZXRjaCwgY29udGV4dCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogVHJhbnNmb3JtIHRoZSBnaXZlbiBkYXRhIHZhbHVlIHRvIGl0cyBmaWVs\nZCB2YWx1ZS4gVGhlIGRhdGEgdmFsdWUKICAgICAqIG1heSBiZSBhIGtleSwg\ndmFsdWUsIG9yIGVsZW1lbnQgb2YgYSBtYXAgb3IgY29sbGVjdGlvbi4KICAg\nICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCB0b05lc3RlZEZpZWxkKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIFZhbHVlTWV0YURhdGEgdm1kLAogICAgICAg\nIE9iamVjdCBkYXRhLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVj\ndCBjb250ZXh0KSB7CiAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIHN3aXRjaCAodm1kLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5EQVRFOgogICAgICAgICAgICAgICAgcmV0dXJuICgoRGF0ZSkgZGF0YSku\nY2xvbmUoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgog\nICAgICAgICAgICAgICAgcmV0dXJuIChMb2NhbGUpIGRhdGE7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgaWYgKHZt\nZC5pc0VtYmVkZGVkKCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRv\nRW1iZWRkZWRGaWVsZChzbSwgdm1kLCBkYXRhLCBmZXRjaCwgY29udGV4dCk7\nCiAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgT2JqZWN0\nIHJldCA9CiAgICAgICAgICAgICAgICAgICAgdG9SZWxhdGlvbkZpZWxkKHNt\nLCB2bWQsIGRhdGEsIGZldGNoLCBjb250ZXh0KTsKICAgICAgICAgICAgICAg\nIGlmIChyZXQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\ncmV0OwogICAgICAgICAgICAgICAgT3JwaGFuZWRLZXlBY3Rpb24gYWN0aW9u\nID0gc20uZ2V0Q29udGV4dCgpLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAg\nICAgICAgICAgICAgICBnZXRPcnBoYW5lZEtleUFjdGlvbkluc3RhbmNlKCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uLm9ycGhhbihkYXRhLCBz\nbSwgdm1kKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nIHJldHVybiBkYXRhOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFRyYW5zZm9ybSB0aGUgZ2l2ZW4gZGF0YSB2YWx1ZSB0byBpdHMgZmllbGQg\ndmFsdWUuIFRoZSBkYXRhIHZhbHVlCiAgICAgKiBtYXkgYmUgYSBrZXksIHZh\nbHVlLCBvciBlbGVtZW50IG9mIGEgbWFwIG9yIGNvbGxlY3Rpb24uCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIHRvTmVzdGVkRmllbGRzKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIAogICAgICAgIFZhbHVlTWV0YURhdGEg\ndm1kLCBDb2xsZWN0aW9uIGRhdGEsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwKICAgICAgICBPYmplY3QgY29udGV4dCkgewogICAgICAgIGlmIChkYXRh\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBD\nb2xsZWN0aW9uIHJldCA9IG5ldyBBcnJheUxpc3QoZGF0YS5zaXplKCkpOwog\nICAgICAgIHN3aXRjaCAodm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHI9ZGF0YS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICByZXQuYWRkKCgoRGF0ZSlp\ndHIubmV4dCgpKS5jbG9uZSgpKTsKICAgICAgICAgICAgICAgIHJldHVybiBy\nZXQ7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyPWRhdGEuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgcmV0LmFkZCgo\nTG9jYWxlKSBpdHIubmV4dCgpKTsKICAgICAgICAgICAgICAgIHJldHVybiBy\nZXQ7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAg\nICAgICAgaWYgKHZtZC5pc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0cj1kYXRhLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldC5hZGQo\ndG9FbWJlZGRlZEZpZWxkKHNtLCB2bWQsIGl0ci5uZXh0KCksIGZldGNoCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAsIGNvbnRleHQpKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJl\ndDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIG5vIGJy\nZWFrCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAg\nICAgICAgICAgICAgICBPYmplY3RbXSByID0gdG9SZWxhdGlvbkZpZWxkcyhz\nbSwgZGF0YSwgZmV0Y2gpOwogICAgICAgICAgICAgICAgaWYgKHIgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nci5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJb\naV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldC5h\nZGQocltpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICByZXQuYWRkKHNtLmdldENvbnRleHQo\nKS5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBnZXRPcnBoYW5lZEtleUFjdGlvbkluc3RhbmNlKCkuCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBvcnBoYW4oZGF0YSwgc20sIHZt\nZCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhOwogICAg\nICAgIH0KICAgIH0KCiAgICAKICAgIC8qKgogICAgICogVHJhbnNmb3JtIHRo\nZSBnaXZlbiBkYXRhIGludG8gYSByZWxhdGlvbiBmaWVsZCB2YWx1ZS4gRGVm\nYXVsdAogICAgICogaW1wbGVtZW50YXRpb24gYXNzdW1lcyB0aGUgZGF0YSBp\ncyBhbiBvaWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgdG9SZWxh\ndGlvbkZpZWxkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFZhbHVlTWV0YURh\ndGEgdm1kLAogICAgICAgIE9iamVjdCBkYXRhLCBGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgcmV0dXJuIHNt\nLmdldENvbnRleHQoKS5maW5kKGRhdGEsIGZldGNoLCBudWxsLCBudWxsLCAw\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZm9ybSB0aGUgZ2l2ZW4g\nZGF0YSBpbnRvIHJlbGF0aW9uIGZpZWxkIHZhbHVlcy4gRGVmYXVsdAogICAg\nICogaW1wbGVtZW50YXRpb24gYXNzdW1lcyB0aGUgZGF0YSBpcyBhbiBvaWQu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3RbXSB0b1JlbGF0aW9uRmll\nbGRzKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgT2JqZWN0IGRh\ndGEsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIHJldHVy\nbiBzbS5nZXRDb250ZXh0KCkuZmluZEFsbCgoQ29sbGVjdGlvbikgZGF0YSwg\nZmV0Y2gsIG51bGwsIG51bGwsIDApOwogICAgfQoKICAgIC8qKgogICAgICog\nVHJhbnNmb3JtIHRoZSBnaXZlbiBkYXRhIGludG8gYW4gZW1iZWRkZWQgUEMg\nZmllbGQgdmFsdWUuIERlZmF1bHQKICAgICAqIGltcGxlbWVudGF0aW9uIGFz\nc3VtZXMgdGhlIGRhdGEgaXMgYW4ge0BsaW5rIEFic3RyYWN0UENEYXRhfS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCB0b0VtYmVkZGVkRmllbGQo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgVmFsdWVNZXRhRGF0YSB2bWQsCiAg\nICAgICAgT2JqZWN0IGRhdGEsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwg\nT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBBYnN0cmFjdFBDRGF0YSBwY2Rh\ndGEgPSAoQWJzdHJhY3RQQ0RhdGEpIGRhdGE7CiAgICAgICAgT3BlbkpQQVN0\nYXRlTWFuYWdlciBlbWJlZGRlZCA9IHNtLmdldENvbnRleHQoKS5lbWJlZChu\ndWxsLAogICAgICAgICAgICBwY2RhdGEuZ2V0SWQoKSwgc20sIHZtZCk7CiAg\nICAgICAgcGNkYXRhLmxvYWQoZW1iZWRkZWQsIChCaXRTZXQpIHBjZGF0YS5n\nZXRMb2FkZWQoKS5jbG9uZSgpLAogICAgICAgICAgICBmZXRjaCwgY29udGV4\ndCk7CiAgICAgICAgcmV0dXJuIGVtYmVkZGVkLmdldE1hbmFnZWRJbnN0YW5j\nZSgpOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNmb3JtIHRoZSBnaXZl\nbiBmaWVsZCB2YWx1ZSB0byBhIGRhdGEgdmFsdWUgZm9yIGNhY2hpbmcuIFJl\ndHVybgogICAgICoge0BsaW5rICNOVUxMfSBpZiB1bmFibGUgdG8gY2FjaGUu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgdG9EYXRhKEZpZWxkTWV0\nYURhdGEgZm1kLCBPYmplY3QgdmFsLCBTdG9yZUNvbnRleHQgY3R4KSB7CiAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAg\nICAgICAgICAgICAgICBDb2xsZWN0aW9uIGMgPSAoQ29sbGVjdGlvbikgdmFs\nOwogICAgICAgICAgICAgICAgaWYgKGMuaXNFbXB0eSgpKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBQcm94eURhdGFMaXN0LkVNUFRZX0xJU1Q7CiAg\nICAgICAgICAgICAgICBQcm94eURhdGFMaXN0IGMyID0gbnVsbDsKICAgICAg\nICAgICAgICAgIGludCBzaXplOwogICAgICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBjaSA9IGMuaXRlcmF0b3IoKTsgY2kuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgICAgIHZhbCA9IHRvTmVzdGVkRGF0YShmbWQuZ2V0RWxl\nbWVudCgpLCBjaS5uZXh0KCksIGN0eCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHZhbCA9PSBOVUxMKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gTlVMTDsKICAgICAgICAgICAgICAgICAgICBpZiAoYzIgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgICAgICBzaXplID0gYy5zaXplKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGMyID0gbmV3IFByb3h5RGF0YUxpc3Qo\nc2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjIGluc3RhbmNl\nb2YgUHJveHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYW5n\nZVRyYWNrZXIgY3QgPSAoKFByb3h5KSBjKS5nZXRDaGFuZ2VUcmFja2VyKCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3QgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMi5uZXh0U2VxdWVu\nY2UgPSBjdC5nZXROZXh0U2VxdWVuY2UoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMi5u\nZXh0U2VxdWVuY2UgPSBzaXplOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBjMi5hZGQodmFsKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIHJldHVybiBjMjsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgTWFwIG0gPSAoTWFw\nKSB2YWw7CiAgICAgICAgICAgICAgICBpZiAobS5pc0VtcHR5KCkpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX01BUDsK\nICAgICAgICAgICAgICAgIE1hcCBtMiA9IG51bGw7CiAgICAgICAgICAgICAg\nICBNYXAuRW50cnkgZTsKICAgICAgICAgICAgICAgIE9iamVjdCB2YWwyOwog\nICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBtaSA9IG0uZW50cnlTZXQo\nKS5pdGVyYXRvcigpOyBtaS5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAg\nICAgICAgZSA9IChNYXAuRW50cnkpIG1pLm5leHQoKTsKICAgICAgICAgICAg\nICAgICAgICB2YWwgPSB0b05lc3RlZERhdGEoZm1kLmdldEtleSgpLCBlLmdl\ndEtleSgpLCBjdHgpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWwgPT0g\nTlVMTCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAg\nICAgICAgICAgICAgICAgICAgdmFsMiA9IHRvTmVzdGVkRGF0YShmbWQuZ2V0\nRWxlbWVudCgpLCBlLmdldFZhbHVlKCksIGN0eCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHZhbDIgPT0gTlVMTCkKICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIE5VTEw7CiAgICAgICAgICAgICAgICAgICAgaWYgKG0yID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIG0yID0gbmV3IEhhc2hN\nYXAobS5zaXplKCkpOwogICAgICAgICAgICAgICAgICAgIG0yLnB1dCh2YWws\nIHZhbDIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0\ndXJuIG0yOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAg\nICAgICAgICAgICAgIGludCBsZW5ndGggPSBBcnJheS5nZXRMZW5ndGgodmFs\nKTsKICAgICAgICAgICAgICAgIGlmIChsZW5ndGggPT0gMCkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gRU1QVFlfQVJSQVk7CgogICAgICAgICAgICAg\nICAgT2JqZWN0IGE7CiAgICAgICAgICAgICAgICBpZiAoaXNJbW11dGFibGVU\neXBlKGZtZC5nZXRFbGVtZW50KCkpKSB7CiAgICAgICAgICAgICAgICAgICAg\nYSA9IEFycmF5Lm5ld0luc3RhbmNlKGZtZC5nZXRFbGVtZW50KCkuZ2V0RGVj\nbGFyZWRUeXBlKCksIAogICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGgp\nOwogICAgICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkodmFsLCAw\nLCBhLCAwLCBsZW5ndGgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgICAgICBPYmplY3RbXSBkYXRhID0gbmV3IE9iamVjdFts\nZW5ndGhdOwogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0\nYVtpXSA9IHRvTmVzdGVkRGF0YShmbWQuZ2V0RWxlbWVudCgpLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIEFycmF5LmdldCh2YWwsIGkpLCBjdHgp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBh\nID0gZGF0YTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJl\ndHVybiBhOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\ncmV0dXJuIHRvTmVzdGVkRGF0YShmbWQsIHZhbCwgY3R4KTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZGVj\nbGFyZWQgdHlwZSBvZiB0aGUgZ2l2ZW4gdmFsdWUgaXMgaW1tdXRhYmxlLgog\nICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNJbW11dGFibGVUeXBlKFZh\nbHVlTWV0YURhdGEgZWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoZWxlbWVu\ndC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5O\nVU1CRVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU5fT0JK\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nSU5UX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRyYW5zZm9ybSB0aGUgZ2l2ZW4gbmVzdGVkIHZhbHVlIHRvIGEgY2Fj\naGFibGUgdmFsdWUuIFJldHVybgogICAgICoge0BsaW5rICNOVUxMfSBpZiB0\naGUgdmFsdWUgY2Fubm90IGJlIGNhY2hlZC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIE9iamVjdCB0b05lc3RlZERhdGEoVmFsdWVNZXRhRGF0YSB2bWQsIE9i\namVjdCB2YWwsCiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAg\nIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIHN3aXRjaCAodm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgICAg\nIGlmICh2bWQuaXNFbWJlZGRlZCgpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiB0b0VtYmVkZGVkRGF0YSh2YWwsIGN0eCk7CiAgICAgICAgICAgICAg\nICAvLyBubyBicmVhawogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19V\nTlRZUEVEOgogICAgICAgICAgICAgICAgcmV0dXJuIHRvUmVsYXRpb25EYXRh\nKHZhbCwgY3R4KTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToK\nICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBQcm94eSkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gKChQcm94eSkgdmFsKS5jb3B5KHZh\nbCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuICgoRGF0ZSkgdmFsKS5jbG9uZSgpOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgICAgICByZXR1cm4gKExv\nY2FsZSkgdmFsOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6\nCiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgUHJveHkpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuICgoUHJveHkpIHZhbCkuY29weSh2\nYWwpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiB2YWw7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gdmFsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgdmFsdWUgdG8gY2FjaGUgZm9yIHRoZSBnaXZlbiBv\nYmplY3QuIENhY2hlcyBpdHMgb2lkIGJ5CiAgICAgKiBkZWZhdWx0LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IHRvUmVsYXRpb25EYXRhKE9iamVj\ndCB2YWwsIFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICByZXR1cm4gY3R4\nLmdldE9iamVjdElkKHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHZhbHVlIHRvIGNhY2hlIGZvciB0aGUgZ2l2ZW4gZW1iZWRkZWQg\nUEMuIENhY2hlcyBhCiAgICAgKiB7QGxpbmsgUENEYXRhfSBmcm9tIHtAbGlu\nayAjbmV3RW1iZWRkZWRQQ0RhdGF9IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBPYmplY3QgdG9FbWJlZGRlZERhdGEoT2JqZWN0IHZhbCwg\nU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIGlmIChjdHggPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIE5VTEw7CgogICAgICAgIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20gPSBjdHguZ2V0U3RhdGVNYW5hZ2VyKHZhbCk7CiAgICAg\nICAgaWYgKHNtID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBOVUxMOwoK\nICAgICAgICAvLyBoYXZlIHRvIGNhY2hlIGFsbCBkYXRhLCBzbyBtYWtlIHN1\ncmUgaXQncyBhbGwgbG9hZGVkCiAgICAgICAgLy8gIyMjIHByZXZlbnQgbG9h\nZGluZyBvZiB0aGluZ3MgdGhhdCBhcmVuJ3QgY2FjaGVkIChsb2JzLCBscnMs\nIGV0YykKICAgICAgICBjdHgucmV0cmlldmUodmFsLCBmYWxzZSwgbnVsbCk7\nCgogICAgICAgIFBDRGF0YSBwY2RhdGEgPSBuZXdFbWJlZGRlZFBDRGF0YShz\nbSk7CiAgICAgICAgcGNkYXRhLnN0b3JlKHNtKTsKICAgICAgICByZXR1cm4g\ncGNkYXRhOwogICAgfQoKICAgIC8qKgogICAgICogVHJhY2tzIHByb3h5IGRh\ndGEgYWxvbmcgd2l0aCBsaXN0IGVsZW1lbnRzLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBjbGFzcyBQcm94eURhdGFMaXN0CiAgICAgICAgZXh0ZW5k\ncyBBcnJheUxpc3QgewoKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFBy\nb3h5RGF0YUxpc3QgRU1QVFlfTElTVCA9IG5ldyBQcm94eURhdGFMaXN0KDAp\nOwoKICAgICAgICBwdWJsaWMgaW50IG5leHRTZXF1ZW5jZSA9IDA7CgogICAg\nICAgIHB1YmxpYyBQcm94eURhdGFMaXN0KGludCBzaXplKSB7CgkJCXN1cGVy\nIChzaXplKTsKCQl9Cgl9Cn0K\n","encoding":"base64"}

