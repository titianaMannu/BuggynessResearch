{"sha":"60ac73f3c193e4b87585ad1342d99f3d35f66f02","node_id":"MDQ6QmxvYjIwNjM2NDo2MGFjNzNmM2MxOTNlNGI4NzU4NWFkMTM0MmQ5OWYzZDM1ZjY2ZjAy","size":165841,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/60ac73f3c193e4b87585ad1342d99f3d35f66f02","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsOw0KDQppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsNCmltcG9y\ndCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOw0KaW1wb3J0IGphdmEuaW8u\nT2JqZWN0T3V0cHV0U3RyZWFtOw0KaW1wb3J0IGphdmEuaW8uU2VyaWFsaXph\nYmxlOw0KaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOw0KaW1w\nb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsNCmltcG9ydCBq\nYXZhLnV0aWwuQWJzdHJhY3RDb2xsZWN0aW9uOw0KaW1wb3J0IGphdmEudXRp\nbC5BcnJheUxpc3Q7DQppbXBvcnQgamF2YS51dGlsLkJpdFNldDsNCmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsNCmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7DQppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7DQppbXBvcnQg\namF2YS51dGlsLkhhc2hTZXQ7DQppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOw0KaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0Ow0KaW1wb3J0IGphdmEu\ndXRpbC5MaXN0Ow0KaW1wb3J0IGphdmEudXRpbC5NYXA7DQppbXBvcnQgamF2\nYS51dGlsLlNldDsNCmltcG9ydCBqYXZheC50cmFuc2FjdGlvbi5TdGF0dXM7\nDQppbXBvcnQgamF2YXgudHJhbnNhY3Rpb24uU3luY2hyb25pemF0aW9uOw0K\nDQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLml0ZXJh\ndG9ycy5JdGVyYXRvckNoYWluOw0KaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9u\ncy5jb2xsZWN0aW9ucy5tYXAuSWRlbnRpdHlNYXA7DQppbXBvcnQgb3JnLmFw\nYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5MaW5rZWRNYXA7DQppbXBv\ncnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLnNldC5NYXBCYWNr\nZWRTZXQ7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuQ29tcGF0\naWJpbGl0eTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVu\nSlBBQ29uZmlndXJhdGlvbjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZGF0YWNhY2hlLkRhdGFDYWNoZTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZWUuTWFuYWdlZFJ1bnRpbWU7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmVuaGFuY2UuUENSZWdpc3RyeTsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7DQppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50Ow0KaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudE1hbmFn\nZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LlJlbW90ZUNv\nbW1pdEV2ZW50TWFuYWdlcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZXZlbnQuVHJhbnNhY3Rpb25FdmVudDsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuVHJhbnNhY3Rpb25FdmVudE1hbmFnZXI7DQppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb25QYXJz\nZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOw0K\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhl\nbHBlcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5S\nZWZlcmVuY2VIYXNoTWFwOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5SZWZlcmVuY2VIYXNoU2V0Ow0KaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5SZWZlcmVuY2VNYXA7DQppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQubG9ja3MuUmVlbnRyYW50TG9jazsNCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOw0KaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7DQppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5\nOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0\nYURhdGE7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVN\nZXRhRGF0YTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1\nZVN0cmF0ZWdpZXM7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nQXBwbGljYXRpb25JZHM7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuQ2FsbGJhY2tFeGNlcHRpb247DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuRXhjZXB0aW9uczsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5HZW5lcmFsRXhjZXB0aW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkltcGxIZWxwZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247DQppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOw0KaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk5vVHJhbnNhY3Rpb25FeGNl\ncHRpb247DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0\nRXhpc3RzRXhjZXB0aW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLk9iamVjdElkOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247DQppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuT3B0aW1pc3RpY0V4Y2VwdGlvbjsNCmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5SdW50aW1lRXhjZXB0aW9uVHJh\nbnNsYXRvcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdG9y\nZUV4Y2VwdGlvbjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5V\nbnN1cHBvcnRlZEV4Y2VwdGlvbjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5Vc2VyRXhjZXB0aW9uOw0KDQovKioNCiAqIENvbmNyZXRlIHtA\nbGluayBCcm9rZXJ9LiBUaGUgYnJva2VyIGhhbmRsZXMgb2JqZWN0LWxldmVs\nIGJlaGF2aW9yLA0KICogYnV0IGxlYXZlcyBhbGwgaW50ZXJhY3Rpb24gd2l0\naCB0aGUgZGF0YSBzdG9yZSB0byBhIHtAbGluayBTdG9yZU1hbmFnZXJ9DQog\nKiB0aGF0IG11c3QgYmUgc3VwcGxpZWQgYXQgaW5pdGlhbGl6YXRpb24uDQog\nKg0KICogQGF1dGhvciBBYmUgV2hpdGUNCiAqLw0KcHVibGljIGNsYXNzIEJy\nb2tlckltcGwNCiAgICBpbXBsZW1lbnRzIEJyb2tlciwgRmluZENhbGxiYWNr\ncywgQ2xvbmVhYmxlLCBTZXJpYWxpemFibGUgew0KDQogICAgLyoqDQogICAg\nICogSW5jcmVtZW50YWwgZmx1c2guDQogICAgICovDQogICAgcHJvdGVjdGVk\nIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfSU5DID0gMDsNCg0KICAgIC8qKg0K\nICAgICAqIEZsdXNoIGluIHByZXBhcmF0aW9uIG9mIGNvbW1pdC4NCiAgICAg\nKi8NCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9DT01N\nSVQgPSAxOw0KDQogICAgLyoqDQogICAgICogRmx1c2ggdG8gY2hlY2sgY29u\nc2lzdGVuY3kgb2YgY2FjaGUsIHRoZW4gaW1tZWRpYXRlbHkgcm9sbGJhY2sg\nY2hhbmdlcy4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFs\nIGludCBGTFVTSF9ST0xMQkFDSyA9IDI7DQoNCiAgICAvKioNCiAgICAgKiBS\ndW4gcGVyc2lzdGVuY2UtYnktcmVhY2hhYmlsaXR5IGFuZCBvdGhlciBmbHVz\naC10aW1lIG9wZXJhdGlvbnMgd2l0aG91dA0KICAgICAqIGFjY2Vzc2luZyB0\naGUgZGF0YWJhc2UuDQogICAgICovDQogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBpbnQgRkxVU0hfTE9HSUNBTCA9IDM7DQoNCiAgICBzdGF0aWMgZmlu\nYWwgaW50IFNUQVRVU19JTklUID0gMDsNCiAgICBzdGF0aWMgZmluYWwgaW50\nIFNUQVRVU19UUkFOU0lFTlQgPSAxOw0KICAgIHN0YXRpYyBmaW5hbCBpbnQg\nU1RBVFVTX09JRF9BU1NJR04gPSAyOw0KICAgIHN0YXRpYyBmaW5hbCBpbnQg\nU1RBVFVTX0NPTU1JVF9ORVcgPSAzOw0KDQogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfQUNUSVZFID0gMiA8PCAwOw0KICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX1NUT1JFX0FDVElWRSA9IDIgPDwgMTsN\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19DTE9TRV9JTlZP\nS0VEID0gMiA8PCAyOw0KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBG\nTEFHX1BSRVNUT1JJTkcgPSAyIDw8IDM7DQogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfREVSRUZERUxFVElORyA9IDIgPDwgNDsNCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVTSElORyA9IDIgPDwg\nNTsNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19TVE9SRV9G\nTFVTSElORyA9IDIgPDwgNjsNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgRkxBR19GTFVTSEVEID0gMiA8PCA3Ow0KICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBGTEFHX0ZMVVNIX1JFUVVJUkVEID0gMiA8PCA4Ow0KICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1JFTU9URV9MSVNURU5F\nUiA9IDIgPDwgOTsNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxB\nR19SRVRBSU5FRF9DT05OID0gMiA8PCAxMDsNCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19UUkFOU19FTkRJTkcgPSAyIDw8IDExOw0KDQog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10gRU1QVFlfT0JKRUNU\nUyA9IG5ldyBPYmplY3RbMF07DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBMb2NhbGl6ZXIgX2xvYyA9DQogICAgICAgIExvY2FsaXplci5mb3JQYWNr\nYWdlKEJyb2tlckltcGwuY2xhc3MpOw0KDQogICAgLy8JdGhlIHN0b3JlIG1h\nbmFnZXIgaW4gdXNlOyB0aGlzIG1heSBiZSBhIGRlY29yYXRvciBzdWNoIGFz\nIGENCiAgICAvLwlkYXRhIGNhY2hlIHN0b3JlIG1hbmFnZXIgYXJvdW5kIHRo\nZSBuYXRpdmUgc3RvcmUgbWFuYWdlcg0KICAgIHByaXZhdGUgdHJhbnNpZW50\nIERlbGVnYXRpbmdTdG9yZU1hbmFnZXIgX3N0b3JlID0gbnVsbDsNCg0KICAg\nIHByaXZhdGUgRmV0Y2hDb25maWd1cmF0aW9uIF9mYyA9IG51bGw7DQogICAg\ncHJpdmF0ZSBTdHJpbmcgX3VzZXIgPSBudWxsOw0KICAgIHByaXZhdGUgU3Ry\naW5nIF9wYXNzID0gbnVsbDsNCg0KICAgIC8vIHRoZXNlIG11c3QgYmUgcmVi\ndWlsdCBieSB0aGUgZmFjYWRlIGxheWVyIGR1cmluZyBpdHMgZGVzZXJpYWxp\nemF0aW9uDQogICAgcHJpdmF0ZSB0cmFuc2llbnQgTG9nIF9sb2cgPSBudWxs\nOw0KICAgIHByaXZhdGUgdHJhbnNpZW50IENvbXBhdGliaWxpdHkgX2NvbXBh\ndCA9IG51bGw7DQogICAgcHJpdmF0ZSB0cmFuc2llbnQgTWFuYWdlZFJ1bnRp\nbWUgX3J1bnRpbWUgPSBudWxsOw0KICAgIHByaXZhdGUgdHJhbnNpZW50IExv\nY2tNYW5hZ2VyIF9sbSA9IG51bGw7DQogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nSW52ZXJzZU1hbmFnZXIgX2ltID0gbnVsbDsNCiAgICBwcml2YXRlIHRyYW5z\naWVudCBSZWVudHJhbnRMb2NrIF9sb2NrID0gbnVsbDsNCiAgICBwcml2YXRl\nIHRyYW5zaWVudCBPcENhbGxiYWNrcyBfY2FsbCA9IG51bGw7DQogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3IgX2V4\ndHJhbnMgPSBudWxsOw0KDQogICAgLy8gcmVmIHRvIHByb2R1Y2luZyBmYWN0\nb3J5IGFuZCBjb25maWd1cmF0aW9uDQogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nQWJzdHJhY3RCcm9rZXJGYWN0b3J5IF9mYWN0b3J5ID0gbnVsbDsNCiAgICBw\ncml2YXRlIHRyYW5zaWVudCBPcGVuSlBBQ29uZmlndXJhdGlvbiBfY29uZiA9\nIG51bGw7DQoNCiAgICAvLyBjYWNoZSBjbGFzcyBsb2FkZXIgYXNzb2NpYXRl\nZCB3aXRoIHRoZSBicm9rZXINCiAgICBwcml2YXRlIHRyYW5zaWVudCBDbGFz\nc0xvYWRlciBfbG9hZGVyID0gbnVsbDsNCg0KICAgIC8vIHVzZXIgc3RhdGUN\nCiAgICBwcml2YXRlIFN5bmNocm9uaXphdGlvbiBfc3luYyA9IG51bGw7DQog\nICAgcHJpdmF0ZSBNYXAgX3VzZXJPYmplY3RzID0gbnVsbDsNCg0KICAgIC8v\nIG1hbmFnZWQgb2JqZWN0IGNhY2hlcw0KICAgIHByaXZhdGUgTWFuYWdlZENh\nY2hlIF9jYWNoZSA9IG51bGw7DQogICAgcHJpdmF0ZSBUcmFuc2FjdGlvbmFs\nQ2FjaGUgX3RyYW5zQ2FjaGUgPSBudWxsOw0KICAgIHByaXZhdGUgU2V0IF90\ncmFuc0FkZGl0aW9ucyA9IG51bGw7DQogICAgcHJpdmF0ZSBTZXQgX2RlcmVm\nQ2FjaGUgPSBudWxsOw0KICAgIHByaXZhdGUgU2V0IF9kZXJlZkFkZGl0aW9u\ncyA9IG51bGw7DQoNCiAgICAvLyB0aGVzZSBhcmUgdXNlZCBmb3IgbWV0aG9k\nLWludGVybmFsIHN0YXRlIG9ubHkNCiAgICBwcml2YXRlIHRyYW5zaWVudCBN\nYXAgX2xvYWRpbmcgPSBudWxsOw0KICAgIHByaXZhdGUgdHJhbnNpZW50IFNl\ndCBfb3BlcmF0aW5nID0gbnVsbDsNCg0KICAgIHByaXZhdGUgU2V0IF9wZXJz\naXN0ZWRDbHNzID0gbnVsbDsNCiAgICBwcml2YXRlIFNldCBfdXBkYXRlZENs\nc3MgPSBudWxsOw0KICAgIHByaXZhdGUgU2V0IF9kZWxldGVkQ2xzcyA9IG51\nbGw7DQogICAgcHJpdmF0ZSBTZXQgX3BlbmRpbmcgPSBudWxsOw0KICAgIHBy\naXZhdGUgaW50IGZpbmRBbGxEZXB0aCA9IDA7DQoNCiAgICAvLyB0cmFjayBp\nbnN0YW5jZXMgdGhhdCBiZWNvbWUgdHJhbnNhY3Rpb25hbCBhZnRlciB0aGUg\nZmlyc3Qgc2F2ZXBvaW50DQogICAgLy8gKHRoZSBmaXJzdCB1c2VzIHRoZSB0\ncmFuc2FjdGlvbmFsIGNhY2hlKQ0KICAgIHByaXZhdGUgU2V0IF9zYXZlcG9p\nbnRDYWNoZSA9IG51bGw7DQogICAgcHJpdmF0ZSBMaW5rZWRNYXAgX3NhdmVw\nb2ludHMgPSBudWxsOw0KICAgIHByaXZhdGUgdHJhbnNpZW50IFNhdmVwb2lu\ndE1hbmFnZXIgX3NwbSA9IG51bGw7DQoNCiAgICAvLyB0cmFjayBvcGVuIHF1\nZXJpZXMgYW5kIGV4dGVudHMgc28gd2UgY2FuIGZyZWUgdGhlaXIgcmVzb3Vy\nY2VzIG9uIGNsb3NlDQogICAgcHJpdmF0ZSB0cmFuc2llbnQgUmVmZXJlbmNl\nSGFzaFNldCBfcXVlcmllcyA9IG51bGw7DQogICAgcHJpdmF0ZSB0cmFuc2ll\nbnQgUmVmZXJlbmNlSGFzaFNldCBfZXh0ZW50cyA9IG51bGw7DQoNCiAgICAv\nLyB0cmFjayBvcGVyYXRpb24gc3RhY2sgZGVwdGguIFRyYW5zaWVudCBiZWNh\ndXNlIG9wZXJhdGlvbnMgY2Fubm90DQogICAgLy8gc3BhbiBzZXJpYWxpemF0\naW9uLg0KICAgIHByaXZhdGUgdHJhbnNpZW50IGludCBfb3BlcmF0aW9uQ291\nbnQgPSAwOw0KDQogICAgLy8gb3B0aW9ucw0KICAgIHByaXZhdGUgYm9vbGVh\nbiBfbm9udHJhbnNSZWFkID0gZmFsc2U7DQogICAgcHJpdmF0ZSBib29sZWFu\nIF9ub250cmFuc1dyaXRlID0gZmFsc2U7DQogICAgcHJpdmF0ZSBib29sZWFu\nIF9yZXRhaW5TdGF0ZSA9IGZhbHNlOw0KICAgIHByaXZhdGUgaW50IF9hdXRv\nQ2xlYXIgPSBDTEVBUl9EQVRBU1RPUkU7DQogICAgcHJpdmF0ZSBpbnQgX3Jl\nc3RvcmVTdGF0ZSA9IFJFU1RPUkVfSU1NVVRBQkxFOw0KICAgIHByaXZhdGUg\nYm9vbGVhbiBfb3B0aW1pc3RpYyA9IGZhbHNlOw0KICAgIHByaXZhdGUgYm9v\nbGVhbiBfaWdub3JlQ2hhbmdlcyA9IGZhbHNlOw0KICAgIHByaXZhdGUgYm9v\nbGVhbiBfbXVsdGl0aHJlYWRlZCA9IGZhbHNlOw0KICAgIHByaXZhdGUgYm9v\nbGVhbiBfbWFuYWdlZCA9IGZhbHNlOw0KICAgIHByaXZhdGUgYm9vbGVhbiBf\nc3luY01hbmFnZWQgPSBmYWxzZTsNCiAgICBwcml2YXRlIGludCBfY29ublJl\ndGFpbk1vZGUgPSBDT05OX1JFVEFJTl9ERU1BTkQ7DQogICAgcHJpdmF0ZSBi\nb29sZWFuIF9ldmljdERhdGFDYWNoZSA9IGZhbHNlOw0KICAgIHByaXZhdGUg\nYm9vbGVhbiBfcG9wdWxhdGVEYXRhQ2FjaGUgPSB0cnVlOw0KICAgIHByaXZh\ndGUgYm9vbGVhbiBfbGFyZ2VUcmFuc2FjdGlvbiA9IGZhbHNlOw0KICAgIHBy\naXZhdGUgaW50IF9hdXRvRGV0YWNoID0gMDsNCiAgICBwcml2YXRlIGludCBf\nZGV0YWNoU3RhdGUgPSBERVRBQ0hfTE9BREVEOw0KICAgIHByaXZhdGUgYm9v\nbGVhbiBfZGV0YWNoZWROZXcgPSB0cnVlOw0KICAgIHByaXZhdGUgYm9vbGVh\nbiBfb3JkZXJEaXJ0eSA9IGZhbHNlOw0KDQogICAgLy8gc3RhdHVzDQogICAg\ncHJpdmF0ZSBpbnQgX2ZsYWdzID0gMDsNCg0KICAgIC8vIHRoaXMgaXMgbm90\nIGluIHN0YXR1cyBiZWNhdXNlIGl0IHNob3VsZCBub3QgYmUgc2VyaWFsaXpl\nZA0KICAgIHByaXZhdGUgdHJhbnNpZW50IGJvb2xlYW4gX2lzU2VyaWFsaXpp\nbmcgPSBmYWxzZTsNCg0KICAgIC8vIHRyYW5zaWVudCBiZWNhdXNlIGNsb3Nl\nZCBicm9rZXJzIGNhbid0IGJlIHNlcmlhbGl6ZWQNCiAgICBwcml2YXRlIHRy\nYW5zaWVudCBib29sZWFuIF9jbG9zZWQgPSBmYWxzZTsNCiAgICBwcml2YXRl\nIHRyYW5zaWVudCBSdW50aW1lRXhjZXB0aW9uIF9jbG9zZWRFeGNlcHRpb24g\nPSBudWxsOw0KDQogICAgLy8gZXZlbnQgbWFuYWdlcnMNCiAgICBwcml2YXRl\nIFRyYW5zYWN0aW9uRXZlbnRNYW5hZ2VyIF90cmFuc0V2ZW50TWFuYWdlciA9\nIG51bGw7DQogICAgcHJpdmF0ZSBpbnQgX3RyYW5zQ2FsbGJhY2tNb2RlID0g\nMDsNCiAgICBwcml2YXRlIExpZmVjeWNsZUV2ZW50TWFuYWdlciBfbGlmZUV2\nZW50TWFuYWdlciA9IG51bGw7DQogICAgcHJpdmF0ZSBpbnQgX2xpZmVDYWxs\nYmFja01vZGUgPSAwOw0KDQogICAgcHJpdmF0ZSB0cmFuc2llbnQgYm9vbGVh\nbiBfaW5pdGlhbGl6ZVdhc0ludm9rZWQgPSBmYWxzZTsNCiAgICBwcml2YXRl\nIExpbmtlZExpc3QgX2ZjczsNCg0KICAgIC8qKg0KICAgICAqIFNldCB0aGUg\ncGVyc2lzdGVuY2UgbWFuYWdlcidzIGF1dGhlbnRpY2F0aW9uLiBUaGlzIGlz\nIHRoZSBmaXJzdA0KICAgICAqIG1ldGhvZCBjYWxsZWQgYWZ0ZXIgY29uc3Ry\ndWN0aW9uLg0KICAgICAqDQogICAgICogQHBhcmFtIHVzZXIgdGhlIHVzZXJu\nYW1lIHRoaXMgYnJva2VyIHJlcHJlc2VudHM7IHVzZWQgd2hlbiBwb29saW5n\nDQogICAgICogYnJva2VycyB0byBtYWtlIHN1cmUgdGhhdCBhIHJlcXVlc3Qg\ndG8gdGhlIGZhY3RvcnkgZm9yDQogICAgICogYSBjb25uZWN0aW9uIHdpdGgg\nYW4gZXhwbGljaXQgdXNlciBpcyBkZWxlZ2F0ZWQgdG8gYSBzdWl0YWJsZSBi\ncm9rZXINCiAgICAgKiBAcGFyYW0gcGFzcyB0aGUgcGFzc3dvcmQgZm9yIHRo\nZSBhYm92ZSB1c2VyDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2V0QXV0\naGVudGljYXRpb24oU3RyaW5nIHVzZXIsIFN0cmluZyBwYXNzKSB7DQogICAg\nICAgIF91c2VyID0gdXNlcjsNCiAgICAgICAgX3Bhc3MgPSBwYXNzOw0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgdGhlIHBlcnNpc3Rl\nbmNlIG1hbmFnZXIuIFRoaXMgbWV0aG9kIGlzIGNhbGxlZA0KICAgICAqIGF1\ndG9tYXRpY2FsbHkgYnkgdGhlIGZhY3RvcnkgYmVmb3JlIHVzZS4NCiAgICAg\nKg0KICAgICAqIEBwYXJhbSBmYWN0b3J5IHRoZSBmYWN0b3J5IHVzZWQgdG8g\nY3JlYXRlIHRoaXMgYnJva2VyDQogICAgICogQHBhcmFtIHNtIGEgY29uY3Jl\ndGUgU3RvcmVNYW5hZ2VyIGltcGxlbWVudGF0aW9uIHRvDQogICAgICogaGFu\nZGxlIGludGVyYWN0aW9uIHdpdGggdGhlIGRhdGEgc3RvcmUNCiAgICAgKiBA\ncGFyYW0gbWFuYWdlZCB0aGUgdHJhbnNhY3Rpb24gbW9kZQ0KICAgICAqIEBw\nYXJhbSBjb25uTW9kZSB0aGUgY29ubmVjdGlvbiByZXRhaW4gbW9kZQ0KICAg\nICAqIEBwYXJhbSBmcm9tRGVzZXJpYWxpemF0aW9uIHdoZXRoZXIgdGhpcyBj\nYWxsIGhhcHBlbmVkIGJlY2F1c2Ugb2YgYQ0KICAgICAqIGRlc2VyaWFsaXph\ndGlvbiBvciBjcmVhdGlvbiBvZiBhIG5ldyBCcm9rZXJJbXBsLg0KICAgICAq\nLw0KICAgIHB1YmxpYyB2b2lkIGluaXRpYWxpemUoQWJzdHJhY3RCcm9rZXJG\nYWN0b3J5IGZhY3RvcnksDQogICAgICAgIERlbGVnYXRpbmdTdG9yZU1hbmFn\nZXIgc20sIGJvb2xlYW4gbWFuYWdlZCwgaW50IGNvbm5Nb2RlLA0KICAgICAg\nICBib29sZWFuIGZyb21EZXNlcmlhbGl6YXRpb24pIHsNCiAgICAgICAgX2lu\naXRpYWxpemVXYXNJbnZva2VkID0gdHJ1ZTsNCiAgICAgICAgX2xvYWRlciA9\nIChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nDQogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xhc3NM\nb2FkZXJBY3Rpb24oKSk7DQogICAgICAgIGlmICghZnJvbURlc2VyaWFsaXph\ndGlvbikNCiAgICAgICAgICAgIF9jb25mID0gZmFjdG9yeS5nZXRDb25maWd1\ncmF0aW9uKCk7DQogICAgICAgIF9jb21wYXQgPSBfY29uZi5nZXRDb21wYXRp\nYmlsaXR5SW5zdGFuY2UoKTsNCiAgICAgICAgX2ZhY3RvcnkgPSBmYWN0b3J5\nOw0KICAgICAgICBfbG9nID0gX2NvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1\ncmF0aW9uLkxPR19SVU5USU1FKTsNCiAgICAgICAgaWYgKCFmcm9tRGVzZXJp\nYWxpemF0aW9uKQ0KICAgICAgICAgICAgX2NhY2hlID0gbmV3IE1hbmFnZWRD\nYWNoZSh0aGlzKTsNCiAgICAgICAgaW5pdGlhbGl6ZU9wZXJhdGluZ1NldCgp\nOw0KICAgICAgICBfY29ublJldGFpbk1vZGUgPSBjb25uTW9kZTsNCiAgICAg\nICAgX21hbmFnZWQgPSBtYW5hZ2VkOw0KICAgICAgICBpZiAobWFuYWdlZCkN\nCiAgICAgICAgICAgIF9ydW50aW1lID0gX2NvbmYuZ2V0TWFuYWdlZFJ1bnRp\nbWVJbnN0YW5jZSgpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBfcnVu\ndGltZSA9IG5ldyBMb2NhbE1hbmFnZWRSdW50aW1lKHRoaXMpOw0KDQogICAg\nICAgIGlmICghZnJvbURlc2VyaWFsaXphdGlvbikgew0KICAgICAgICAgICAg\nX2xpZmVFdmVudE1hbmFnZXIgPSBuZXcgTGlmZWN5Y2xlRXZlbnRNYW5hZ2Vy\nKCk7DQogICAgICAgICAgICBfdHJhbnNFdmVudE1hbmFnZXIgPSBuZXcgVHJh\nbnNhY3Rpb25FdmVudE1hbmFnZXIoKTsNCiAgICAgICAgICAgIGludCBjbW9k\nZSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuDQog\nICAgICAgICAgICAgICAgZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVs\ndHMoKS5nZXRDYWxsYmFja01vZGUoKTsNCiAgICAgICAgICAgIHNldExpZmVj\neWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKGNtb2RlKTsNCiAgICAgICAgICAg\nIHNldFRyYW5zYWN0aW9uTGlzdGVuZXJDYWxsYmFja01vZGUoY21vZGUpOw0K\nDQogICAgICAgICAgICAvLyBzZXR1cCBkZWZhdWx0IG9wdGlvbnMNCiAgICAg\nICAgICAgIF9mYWN0b3J5LmNvbmZpZ3VyZUJyb2tlcih0aGlzKTsNCiAgICAg\nICAgfQ0KDQogICAgICAgIC8vIG1ha2Ugc3VyZSB0byBkbyB0aGlzIGFmdGVy\nIGNvbmZpZ3VyaW5nIGJyb2tlciBzbyB0aGF0IHN0b3JlIG1hbmFnZXINCiAg\nICAgICAgLy8gY2FuIGxvb2sgdG8gYnJva2VyIGNvbmZpZ3VyYXRpb247IHdl\nIHNldCBib3RoIHN0b3JlIGFuZCBsb2NrIG1hbmFnZXJzDQogICAgICAgIC8v\nIGJlZm9yZSBpbml0aWFsaXppbmcgdGhlbSBiZWNhdXNlIHRoZXkgbWF5IGVh\nY2ggdHJ5IHRvIGFjY2VzcyB0aGUNCiAgICAgICAgLy8gb3RoZXIgaW4gdGhp\nZXIgaW5pdGlhbGl6YXRpb24NCiAgICAgICAgX3N0b3JlID0gc207DQogICAg\nICAgIF9sbSA9IF9jb25mLm5ld0xvY2tNYW5hZ2VySW5zdGFuY2UoKTsNCiAg\nICAgICAgX2ltID0gX2NvbmYubmV3SW52ZXJzZU1hbmFnZXJJbnN0YW5jZSgp\nOw0KICAgICAgICBfc3BtID0gX2NvbmYuZ2V0U2F2ZXBvaW50TWFuYWdlcklu\nc3RhbmNlKCk7DQogICAgICAgIF9zdG9yZS5zZXRDb250ZXh0KHRoaXMpOw0K\nICAgICAgICBfbG0uc2V0Q29udGV4dCh0aGlzKTsNCg0KICAgICAgICBpZiAo\nX2Nvbm5SZXRhaW5Nb2RlID09IENPTk5fUkVUQUlOX0FMV0FZUykNCiAgICAg\nICAgICAgIHJldGFpbkNvbm5lY3Rpb24oKTsNCiAgICAgICAgaWYgKCFmcm9t\nRGVzZXJpYWxpemF0aW9uKSB7DQogICAgICAgICAgICBfZmMgPSBfc3RvcmUu\nbmV3RmV0Y2hDb25maWd1cmF0aW9uKCk7DQogICAgICAgICAgICBfZmMuc2V0\nQ29udGV4dCh0aGlzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHN5bmNo\nIHdpdGggdGhlIGdsb2JhbCB0cmFuc2FjdGlvbiBpbiBwcm9ncmVzcywgaWYg\nYW55DQogICAgICAgIGlmIChfZmFjdG9yeS5zeW5jV2l0aE1hbmFnZWRUcmFu\nc2FjdGlvbih0aGlzLCBmYWxzZSkpDQogICAgICAgICAgICBiZWdpbkludGVy\nbmFsKCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIGluaXRpYWxpemVP\ncGVyYXRpbmdTZXQoKSB7DQogICAgICAgIF9vcGVyYXRpbmcgPSBNYXBCYWNr\nZWRTZXQuZGVjb3JhdGUobmV3IElkZW50aXR5TWFwKCkpOw0KICAgIH0NCiAg\nICANCiAgICAvKioNCiAgICAgKiBHZXRzIHRoZSB1bm1vZGlmaWFibGUgc2V0\nIG9mIGluc3RhbmNlcyBiZWluZyBvcGVyYXRlZC4NCiAgICAgKi8NCiAgICBw\ncm90ZWN0ZWQgU2V0IGdldE9wZXJhdGluZ1NldCgpIHsNCiAgICAJcmV0dXJu\nIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZVNldChfb3BlcmF0aW5nKTsNCiAg\nICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IGNsb25lKCkNCiAgICAgICAgdGhy\nb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsNCiAgICAgICAgaWYg\nKF9pbml0aWFsaXplV2FzSW52b2tlZCkNCiAgICAgICAgICAgIHRocm93IG5l\ndyBDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbigpOw0KICAgICAgICBlbHNl\nIHsNCiAgICAgICAgICAgIHJldHVybiBzdXBlci5jbG9uZSgpOw0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlIGEge0BsaW5r\nIE1hcH0gdG8gYmUgdXNlZCBmb3IgdGhlIHByaW1hcnkgbWFuYWdlZCBvYmpl\nY3QgY2FjaGUuDQogICAgICogTWFwcyBvaWRzIHRvIHN0YXRlIG1hbmFnZXJz\nLiBCeSBkZWZhdWx0LCB0aGlzIGNyZWF0ZXMgYQ0KICAgICAqIHtAbGluayBS\nZWZlcmVuY2VNYXB9IHdpdGggc29mdCB2YWx1ZXMuDQogICAgICovDQogICAg\ncHJvdGVjdGVkIE1hcCBuZXdNYW5hZ2VkT2JqZWN0Q2FjaGUoKSB7DQogICAg\nICAgIHJldHVybiBuZXcgUmVmZXJlbmNlSGFzaE1hcChSZWZlcmVuY2VNYXAu\nSEFSRCwgUmVmZXJlbmNlTWFwLlNPRlQpOw0KICAgIH0NCg0KICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBJbXBsZW1l\nbnRhdGlvbiBvZiBTdG9yZUNvbnRleHQNCiAgICAvLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vDQoNCiAgICBwdWJsaWMgQnJva2VyIGdldEJy\nb2tlcigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAg\nLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBQcm9wZXJ0aWVzDQogICAgLy8vLy8v\nLy8vLy8vLy8NCg0KICAgIHB1YmxpYyB2b2lkIHNldEltcGxpY2l0QmVoYXZp\nb3IoT3BDYWxsYmFja3MgY2FsbCwNCiAgICAgICAgUnVudGltZUV4Y2VwdGlv\nblRyYW5zbGF0b3IgZXgpIHsNCiAgICAgICAgaWYgKF9jYWxsID09IG51bGwp\nDQogICAgICAgICAgICBfY2FsbCA9IGNhbGw7DQogICAgICAgIGlmIChfZXh0\ncmFucyA9PSBudWxsKQ0KICAgICAgICAgICAgX2V4dHJhbnMgPSBleDsNCiAg\nICB9DQoNCiAgICBSdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvciBnZXRJbnN0\nYW5jZUV4Y2VwdGlvblRyYW5zbGF0b3IoKSB7DQogICAgICAgIHJldHVybiAo\nX29wZXJhdGlvbkNvdW50ID09IDApID8gX2V4dHJhbnMgOiBudWxsOw0KICAg\nIH0NCg0KICAgIHB1YmxpYyBCcm9rZXJGYWN0b3J5IGdldEJyb2tlckZhY3Rv\ncnkoKSB7DQogICAgICAgIHJldHVybiBfZmFjdG9yeTsNCiAgICB9DQoNCiAg\nICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlv\nbigpIHsNCiAgICAgICAgcmV0dXJuIF9jb25mOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gZ2V0RmV0Y2hDb25maWd1cmF0aW9u\nKCkgew0KICAgICAgICByZXR1cm4gX2ZjOw0KICAgIH0NCg0KICAgIHB1Ymxp\nYyBGZXRjaENvbmZpZ3VyYXRpb24gcHVzaEZldGNoQ29uZmlndXJhdGlvbigp\nIHsNCiAgICAgICAgaWYgKF9mY3MgPT0gbnVsbCkNCiAgICAgICAgICAgIF9m\nY3MgPSBuZXcgTGlua2VkTGlzdCgpOw0KICAgICAgICBfZmNzLmFkZChfZmMp\nOw0KICAgICAgICBfZmMgPSAoRmV0Y2hDb25maWd1cmF0aW9uKSBfZmMuY2xv\nbmUoKTsNCiAgICAgICAgcmV0dXJuIF9mYzsNCiAgICB9DQoNCiAgICBwdWJs\naWMgdm9pZCBwb3BGZXRjaENvbmZpZ3VyYXRpb24oKSB7DQogICAgICAgIGlm\nIChfZmNzID09IG51bGwgfHwgX2Zjcy5pc0VtcHR5KCkpDQogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZmV0Y2gtY29u\nZmlndXJhdGlvbi1zdGFjay1lbXB0eSIpKTsNCiAgICAgICAgX2ZjID0gKEZl\ndGNoQ29uZmlndXJhdGlvbikgX2Zjcy5yZW1vdmVMYXN0KCk7DQogICAgfQ0K\nDQogICAgcHVibGljIGludCBnZXRDb25uZWN0aW9uUmV0YWluTW9kZSgpIHsN\nCiAgICAgICAgcmV0dXJuIF9jb25uUmV0YWluTW9kZTsNCiAgICB9DQoNCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc01hbmFnZWQoKSB7DQogICAgICAgIHJldHVy\nbiBfbWFuYWdlZDsNCiAgICB9DQoNCiAgICBwdWJsaWMgTWFuYWdlZFJ1bnRp\nbWUgZ2V0TWFuYWdlZFJ1bnRpbWUoKSB7DQogICAgICAgIHJldHVybiBfcnVu\ndGltZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIgZ2V0Q2xh\nc3NMb2FkZXIoKSB7DQogICAgICAgIHJldHVybiBfbG9hZGVyOw0KICAgIH0N\nCg0KICAgIHB1YmxpYyBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyIGdldFN0b3Jl\nTWFuYWdlcigpIHsNCiAgICAgICAgcmV0dXJuIF9zdG9yZTsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgTG9ja01hbmFnZXIgZ2V0TG9ja01hbmFnZXIoKSB7DQog\nICAgICAgIHJldHVybiBfbG07DQogICAgfQ0KDQogICAgcHVibGljIEludmVy\nc2VNYW5hZ2VyIGdldEludmVyc2VNYW5hZ2VyKCkgew0KICAgICAgICByZXR1\ncm4gX2ltOw0KICAgIH0NCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29ubmVj\ndGlvblVzZXJOYW1lKCkgew0KICAgICAgICByZXR1cm4gX3VzZXI7DQogICAg\nfQ0KDQogICAgcHVibGljIFN0cmluZyBnZXRDb25uZWN0aW9uUGFzc3dvcmQo\nKSB7DQogICAgICAgIHJldHVybiBfcGFzczsNCiAgICB9DQoNCiAgICBwdWJs\naWMgYm9vbGVhbiBnZXRNdWx0aXRocmVhZGVkKCkgew0KICAgICAgICByZXR1\ncm4gX211bHRpdGhyZWFkZWQ7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQg\nc2V0TXVsdGl0aHJlYWRlZChib29sZWFuIG11bHRpdGhyZWFkZWQpIHsNCiAg\nICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBfbXVsdGl0aHJlYWRlZCA9\nIG11bHRpdGhyZWFkZWQ7DQogICAgICAgIGlmIChtdWx0aXRocmVhZGVkICYm\nIF9sb2NrID09IG51bGwpDQogICAgICAgICAgICBfbG9jayA9IG5ldyBSZWVu\ndHJhbnRMb2NrKCk7DQogICAgICAgIGVsc2UgaWYgKCFtdWx0aXRocmVhZGVk\nKQ0KICAgICAgICAgICAgX2xvY2sgPSBudWxsOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyBib29sZWFuIGdldElnbm9yZUNoYW5nZXMoKSB7DQogICAgICAgIHJl\ndHVybiBfaWdub3JlQ2hhbmdlczsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9p\nZCBzZXRJZ25vcmVDaGFuZ2VzKGJvb2xlYW4gdmFsKSB7DQogICAgICAgIGFz\nc2VydE9wZW4oKTsNCiAgICAgICAgX2lnbm9yZUNoYW5nZXMgPSB2YWw7DQog\nICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gZ2V0Tm9udHJhbnNhY3Rpb25h\nbFJlYWQoKSB7DQogICAgICAgIHJldHVybiBfbm9udHJhbnNSZWFkOw0KICAg\nIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldE5vbnRyYW5zYWN0aW9uYWxSZWFk\nKGJvb2xlYW4gdmFsKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApDQogICAg\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiaWxs\nZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsNCg0KICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhlIHJ1bnRpbWUgc3VwcG9ydHMgaXQNCiAgICAgICAgaWYgKHZhbCAm\nJiAhX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zDQogICAgICAg\nICAgICAoX2NvbmYuT1BUSU9OX05PTlRSQU5TX1JFQUQpKQ0KICAgICAgICAg\nICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0DQog\nICAgICAgICAgICAgICAgKCJub250cmFucy1yZWFkLW5vdC1zdXBwb3J0ZWQi\nKSk7DQoNCiAgICAgICAgX25vbnRyYW5zUmVhZCA9IHZhbDsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXROb250cmFuc2FjdGlvbmFsV3JpdGUo\nKSB7DQogICAgICAgIHJldHVybiBfbm9udHJhbnNXcml0ZTsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgdm9pZCBzZXROb250cmFuc2FjdGlvbmFsV3JpdGUoYm9v\nbGVhbiB2YWwpIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfUFJFU1RPUklORykgIT0gMCkNCiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbGxlZ2Fs\nLW9wLWluLXByZXN0b3JlIikpOw0KDQogICAgICAgIF9ub250cmFuc1dyaXRl\nID0gdmFsOw0KICAgIH0NCg0KICAgIHB1YmxpYyBib29sZWFuIGdldE9wdGlt\naXN0aWMoKSB7DQogICAgICAgIHJldHVybiBfb3B0aW1pc3RpYzsNCiAgICB9\nDQoNCiAgICBwdWJsaWMgdm9pZCBzZXRPcHRpbWlzdGljKGJvb2xlYW4gdmFs\nKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgaWYgKChfZmxh\nZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkNCiAgICAgICAgICAgIHRocm93IG5l\ndyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInRyYW5zLWFjdGl2\nZSIsDQogICAgICAgICAgICAgICAgIk9wdGltaXN0aWMiKSk7DQoNCiAgICAg\nICAgLy8gbWFrZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRzIGl0DQogICAg\nICAgIGlmICh2YWwgJiYgIV9jb25mLnN1cHBvcnRlZE9wdGlvbnMoKS5jb250\nYWlucyhfY29uZi5PUFRJT05fT1BUSU1JU1RJQykpDQogICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQNCiAgICAg\nICAgICAgICAgICAoIm9wdGltaXN0aWMtbm90LXN1cHBvcnRlZCIpKTsNCg0K\nICAgICAgICBfb3B0aW1pc3RpYyA9IHZhbDsNCiAgICB9DQoNCiAgICBwdWJs\naWMgaW50IGdldFJlc3RvcmVTdGF0ZSgpIHsNCiAgICAgICAgcmV0dXJuIF9y\nZXN0b3JlU3RhdGU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0UmVz\ndG9yZVN0YXRlKGludCB2YWwpIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0K\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQ0KICAg\nICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9j\nLmdldCgidHJhbnMtYWN0aXZlIiwNCiAgICAgICAgICAgICAgICAiUmVzdG9y\nZSIpKTsNCg0KICAgICAgICBfcmVzdG9yZVN0YXRlID0gdmFsOw0KICAgIH0N\nCg0KICAgIHB1YmxpYyBib29sZWFuIGdldFJldGFpblN0YXRlKCkgew0KICAg\nICAgICByZXR1cm4gX3JldGFpblN0YXRlOw0KICAgIH0NCg0KICAgIHB1Ymxp\nYyB2b2lkIHNldFJldGFpblN0YXRlKGJvb2xlYW4gdmFsKSB7DQogICAgICAg\nIGFzc2VydE9wZW4oKTsNCiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BS\nRVNUT1JJTkcpICE9IDApDQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsN\nCiAgICAgICAgX3JldGFpblN0YXRlID0gdmFsOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyBpbnQgZ2V0QXV0b0NsZWFyKCkgew0KICAgICAgICByZXR1cm4gX2F1\ndG9DbGVhcjsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvQ2xl\nYXIoaW50IHZhbCkgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAg\nIF9hdXRvQ2xlYXIgPSB2YWw7DQogICAgfQ0KDQogICAgcHVibGljIGludCBn\nZXRBdXRvRGV0YWNoKCkgew0KICAgICAgICByZXR1cm4gX2F1dG9EZXRhY2g7\nDQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0QXV0b0RldGFjaChpbnQg\nZGV0YWNoRmxhZ3MpIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAg\nICBfYXV0b0RldGFjaCA9IGRldGFjaEZsYWdzOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyB2b2lkIHNldEF1dG9EZXRhY2goaW50IGRldGFjaEZsYWcsIGJvb2xl\nYW4gb24pIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBpZiAo\nb24pDQogICAgICAgICAgICBfYXV0b0RldGFjaCB8PSBkZXRhY2hGbGFnOw0K\nICAgICAgICBlbHNlDQogICAgICAgICAgICBfYXV0b0RldGFjaCAmPSB+ZGV0\nYWNoRmxhZzsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldERldGFjaFN0\nYXRlKCkgew0KICAgICAgICByZXR1cm4gX2RldGFjaFN0YXRlOw0KICAgIH0N\nCg0KICAgIHB1YmxpYyB2b2lkIHNldERldGFjaFN0YXRlKGludCBtb2RlKSB7\nDQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgX2RldGFjaFN0YXRl\nID0gbW9kZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RldGFj\naGVkTmV3KCkgew0KICAgICAgICByZXR1cm4gX2RldGFjaGVkTmV3Ow0KICAg\nIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldERldGFjaGVkTmV3KGJvb2xlYW4g\naXNOZXcpIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBfZGV0\nYWNoZWROZXcgPSBpc05ldzsNCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXRTeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbnMoKSB7DQogICAgICAg\nIHJldHVybiBfc3luY01hbmFnZWQ7DQogICAgfQ0KDQogICAgcHVibGljIHZv\naWQgc2V0U3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb25zKGJvb2xlYW4gc3lu\nYykgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAgIF9zeW5jTWFu\nYWdlZCA9IHN5bmM7DQogICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gZ2V0\nRXZpY3RGcm9tRGF0YUNhY2hlKCkgew0KICAgICAgICByZXR1cm4gX2V2aWN0\nRGF0YUNhY2hlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldEV2aWN0\nRnJvbURhdGFDYWNoZShib29sZWFuIGV2aWN0KSB7DQogICAgICAgIGFzc2Vy\ndE9wZW4oKTsNCiAgICAgICAgX2V2aWN0RGF0YUNhY2hlID0gZXZpY3Q7DQog\nICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gZ2V0UG9wdWxhdGVEYXRhQ2Fj\naGUoKSB7DQogICAgICAgIHJldHVybiBfcG9wdWxhdGVEYXRhQ2FjaGU7DQog\nICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0UG9wdWxhdGVEYXRhQ2FjaGUo\nYm9vbGVhbiBjYWNoZSkgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAg\nICAgIF9wb3B1bGF0ZURhdGFDYWNoZSA9IGNhY2hlOw0KICAgIH0NCg0KICAg\nIHB1YmxpYyBib29sZWFuIGlzVHJhY2tDaGFuZ2VzQnlUeXBlKCkgew0KICAg\nICAgICByZXR1cm4gX2xhcmdlVHJhbnNhY3Rpb247DQogICAgfQ0KDQogICAg\ncHVibGljIHZvaWQgc2V0VHJhY2tDaGFuZ2VzQnlUeXBlKGJvb2xlYW4gbGFy\nZ2VUcmFuc2FjdGlvbikgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAg\nICAgIF9sYXJnZVRyYW5zYWN0aW9uID0gbGFyZ2VUcmFuc2FjdGlvbjsNCiAg\nICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IGdldFVzZXJPYmplY3QoT2JqZWN0\nIGtleSkgew0KICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAg\nICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4gKF91c2VyT2JqZWN0cyA9\nPSBudWxsKSA/IG51bGwgOiBfdXNlck9iamVjdHMuZ2V0KGtleSk7DQogICAg\nICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsN\nCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3QgcHV0VXNl\nck9iamVjdChPYmplY3Qga2V5LCBPYmplY3QgdmFsKSB7DQogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKGZhbHNlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAg\nICAgIGlmICh2YWwgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICByZXR1cm4g\nKF91c2VyT2JqZWN0cyA9PSBudWxsKSA/IG51bGwgOiBfdXNlck9iamVjdHMu\ncmVtb3ZlKGtleSk7DQoNCiAgICAgICAgICAgIGlmIChfdXNlck9iamVjdHMg\nPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBfdXNlck9iamVjdHMgPSBuZXcg\nSGFzaE1hcCgpOw0KICAgICAgICAgICAgcmV0dXJuIF91c2VyT2JqZWN0cy5w\ndXQoa2V5LCB2YWwpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAv\nLy8vLy8vLy8vDQogICAgLy8gRXZlbnRzDQogICAgLy8vLy8vLy8vLw0KDQog\nICAgcHVibGljIHZvaWQgYWRkTGlmZWN5Y2xlTGlzdGVuZXIoT2JqZWN0IGxp\nc3RlbmVyLCBDbGFzc1tdIGNsYXNzZXMpIHsNCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgX2xp\nZmVFdmVudE1hbmFnZXIuYWRkTGlzdGVuZXIobGlzdGVuZXIsIGNsYXNzZXMp\nOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBy\nZW1vdmVMaWZlY3ljbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIpIHsNCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0K\nICAgICAgICAgICAgX2xpZmVFdmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIo\nbGlzdGVuZXIpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJs\naWMgaW50IGdldExpZmVjeWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKCkgew0K\nICAgICAgICByZXR1cm4gX2xpZmVDYWxsYmFja01vZGU7DQogICAgfQ0KDQog\nICAgcHVibGljIHZvaWQgc2V0TGlmZWN5Y2xlTGlzdGVuZXJDYWxsYmFja01v\nZGUoaW50IG1vZGUpIHsNCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2Up\nOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgX2xpZmVDYWxsYmFja01v\nZGUgPSBtb2RlOw0KICAgICAgICAgICAgX2xpZmVFdmVudE1hbmFnZXIuc2V0\nRmFpbEZhc3QoKG1vZGUgJiBDQUxMQkFDS19GQUlMX0ZBU1QpICE9IDApOw0K\nICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHaXZl\nIHN0YXRlIG1hbmFnZXJzIGFjY2VzcyB0byB0aGUgbGlmZWN5Y2xlIGV2ZW50\nIG1hbmFnZXIuDQogICAgICovDQogICAgcHVibGljIExpZmVjeWNsZUV2ZW50\nTWFuYWdlciBnZXRMaWZlY3ljbGVFdmVudE1hbmFnZXIoKSB7DQogICAgICAg\nIHJldHVybiBfbGlmZUV2ZW50TWFuYWdlcjsNCiAgICB9DQoNCiAgICAvKioN\nCiAgICAgKiBGaXJlIGdpdmVuIGxpZmVjeWNsZSBldmVudCwgaGFuZGxpbmcg\nYW55IGV4Y2VwdGlvbnMgYXBwcm9wcmlhdGVseS4NCiAgICAgKg0KICAgICAq\nIEByZXR1cm4gd2hldGhlciBldmVudHMgYXJlIGJlaW5nIHByb2Nlc3NlZCBh\ndCB0aGlzIHRpbWUNCiAgICAgKi8NCiAgICBib29sZWFuIGZpcmVMaWZlY3lj\nbGVFdmVudChPYmplY3Qgc3JjLCBPYmplY3QgcmVsYXRlZCwgQ2xhc3NNZXRh\nRGF0YSBtZXRhLA0KICAgICAgICBpbnQgZXZlbnRUeXBlKSB7DQogICAgICAg\nIGlmIChfbGlmZUV2ZW50TWFuYWdlciA9PSBudWxsKQ0KICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOw0KICAgICAgICBoYW5kbGVDYWxsYmFja0V4Y2VwdGlv\nbnMoX2xpZmVFdmVudE1hbmFnZXIuZmlyZUV2ZW50KHNyYywgcmVsYXRlZCwg\nDQogICAgICAgICAgICBtZXRhLCBldmVudFR5cGUpLCBfbGlmZUNhbGxiYWNr\nTW9kZSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8q\nKg0KICAgICAqIFRha2UgYWN0aW9ucyBvbiBjYWxsYmFjayBleGNlcHRpb25z\nIGRlcGVuZGluZyBvbiBjYWxsYmFjayBtb2RlLg0KICAgICAqLw0KICAgIHBy\naXZhdGUgdm9pZCBoYW5kbGVDYWxsYmFja0V4Y2VwdGlvbnMoRXhjZXB0aW9u\nW10gZXhjZXBzLCBpbnQgbW9kZSkgew0KICAgICAgICBpZiAoZXhjZXBzLmxl\nbmd0aCA9PSAwIHx8IChtb2RlICYgQ0FMTEJBQ0tfSUdOT1JFKSAhPSAwKQ0K\nICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIE9wZW5KUEFFeGNlcHRp\nb24gY2U7DQogICAgICAgIGlmIChleGNlcHMubGVuZ3RoID09IDEpDQogICAg\nICAgICAgICBjZSA9IG5ldyBDYWxsYmFja0V4Y2VwdGlvbihleGNlcHNbMF0p\nOw0KICAgICAgICBlbHNlIA0KICAgICAgICAgICAgY2UgPSBuZXcgQ2FsbGJh\nY2tFeGNlcHRpb24oX2xvYy5nZXQoImNhbGxiYWNrLWVyciIpKS4NCiAgICAg\nICAgICAgICAgICBzZXROZXN0ZWRUaHJvd2FibGVzKGV4Y2Vwcyk7DQogICAg\nICAgIGlmICgobW9kZSAmIENBTExCQUNLX1JPTExCQUNLKSAhPSAwICYmIChf\nZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkgew0KICAgICAgICAgICAgY2Uu\nc2V0RmF0YWwodHJ1ZSk7DQogICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJ\nbnRlcm5hbChjZSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChtb2RlICYg\nQ0FMTEJBQ0tfTE9HKSAhPSAwICYmIF9sb2cuaXNXYXJuRW5hYmxlZCgpKQ0K\nICAgICAgICAgICAgX2xvZy53YXJuKGNlKTsNCiAgICAgICAgaWYgKChtb2Rl\nICYgQ0FMTEJBQ0tfUkVUSFJPVykgIT0gMCkNCiAgICAgICAgICAgIHRocm93\nIGNlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGFkZFRyYW5zYWN0aW9u\nTGlzdGVuZXIoT2JqZWN0IHRsKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIF90cmFuc0V2\nZW50TWFuYWdlci5hZGRMaXN0ZW5lcih0bCk7DQogICAgICAgICAgICBpZiAo\ndGwgaW5zdGFuY2VvZiBSZW1vdGVDb21taXRFdmVudE1hbmFnZXIpDQogICAg\nICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVNT1RFX0xJU1RFTkVSOw0K\nICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCByZW1v\ndmVUcmFuc2FjdGlvbkxpc3RlbmVyKE9iamVjdCB0bCkgew0KICAgICAgICBi\nZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAgICAgIHRyeSB7DQogICAgICAg\nICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLnJlbW92ZUxpc3RlbmVyKHRs\nKQ0KICAgICAgICAgICAgICAgICYmICh0bCBpbnN0YW5jZW9mIFJlbW90ZUNv\nbW1pdEV2ZW50TWFuYWdlcikpDQogICAgICAgICAgICAgICAgX2ZsYWdzICY9\nIH5GTEFHX1JFTU9URV9MSVNURU5FUjsNCiAgICAgICAgfSBmaW5hbGx5IHsN\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgcHVibGljIGludCBnZXRUcmFuc2FjdGlvbkxpc3RlbmVyQ2Fs\nbGJhY2tNb2RlKCkgew0KICAgICAgICByZXR1cm4gX3RyYW5zQ2FsbGJhY2tN\nb2RlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldFRyYW5zYWN0aW9u\nTGlzdGVuZXJDYWxsYmFja01vZGUoaW50IG1vZGUpIHsNCiAgICAgICAgYmVn\naW5PcGVyYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAg\nICAgX3RyYW5zQ2FsbGJhY2tNb2RlID0gbW9kZTsNCiAgICAgICAgICAgIF90\ncmFuc0V2ZW50TWFuYWdlci5zZXRGYWlsRmFzdCgobW9kZSAmIENBTExCQUNL\nX0ZBSUxfRkFTVCkgIT0gMCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0K\nICAgIC8qKg0KICAgICAqIEZpcmUgZ2l2ZW4gdHJhbnNhY3Rpb24gZXZlbnQs\nIGhhbmRsaW5nIGFueSBleGNlcHRpb25zIGFwcHJvcHJpYXRlbHkuDQogICAg\nICovDQogICAgcHJpdmF0ZSB2b2lkIGZpcmVUcmFuc2FjdGlvbkV2ZW50KFRy\nYW5zYWN0aW9uRXZlbnQgdHJhbnMpIHsNCiAgICAgICAgaWYgKF90cmFuc0V2\nZW50TWFuYWdlciAhPSBudWxsKQ0KICAgICAgICAgICAgaGFuZGxlQ2FsbGJh\nY2tFeGNlcHRpb25zKF90cmFuc0V2ZW50TWFuYWdlci5maXJlRXZlbnQodHJh\nbnMpLA0KICAgICAgICAgICAgICAgIF90cmFuc0NhbGxiYWNrTW9kZSk7DQog\nICAgfQ0KDQogICAgLy8vLy8vLy8vLy8NCiAgICAvLyBMb29rdXBzDQogICAg\nLy8vLy8vLy8vLy8NCg0KICAgIHB1YmxpYyBPYmplY3QgZmluZChPYmplY3Qg\nb2lkLCBib29sZWFuIHZhbGlkYXRlLCBGaW5kQ2FsbGJhY2tzIGNhbGwpIHsN\nCiAgICAgICAgaW50IGZsYWdzID0gT0lEX0NPUFkgfCBPSURfQUxMT1dfTkVX\nIHwgT0lEX05PREVMRVRFRDsNCiAgICAgICAgaWYgKCF2YWxpZGF0ZSkNCiAg\nICAgICAgICAgIGZsYWdzIHw9IE9JRF9OT1ZBTElEQVRFOw0KICAgICAgICBy\nZXR1cm4gZmluZChvaWQsIF9mYywgbnVsbCwgbnVsbCwgZmxhZ3MsIGNhbGwp\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3QgZmluZChPYmplY3Qgb2lk\nLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEJpdFNldCBleGNsdWRlLA0K\nICAgICAgICBPYmplY3QgZWRhdGEsIGludCBmbGFncykgew0KICAgICAgICBy\nZXR1cm4gZmluZChvaWQsIGZldGNoLCBleGNsdWRlLCBlZGF0YSwgZmxhZ3Ms\nIG51bGwpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEludGVybmFsIGZp\nbmRlci4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgT2JqZWN0IGZpbmQoT2Jq\nZWN0IG9pZCwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBCaXRTZXQgZXhj\nbHVkZSwNCiAgICAgICAgT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3MsIEZpbmRD\nYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQ0K\nICAgICAgICAgICAgY2FsbCA9IHRoaXM7DQogICAgICAgIG9pZCA9IGNhbGwu\ncHJvY2Vzc0FyZ3VtZW50KG9pZCk7DQogICAgICAgIGlmIChvaWQgPT0gbnVs\nbCkgew0KICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRF\nKSA9PSAwKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RG\nb3VuZEV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC1vaWQiKSk7DQogICAgICAg\nICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7DQog\nICAgICAgIH0NCiAgICAgICAgaWYgKGZldGNoID09IG51bGwpDQogICAgICAg\nICAgICBmZXRjaCA9IF9mYzsNCg0KICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGFzc2VydE5vbnRy\nYW5zYWN0aW9uYWxSZWFkKCk7DQoNCiAgICAgICAgICAgIC8vIGNhY2hlZCBp\nbnN0YW5jZT8NCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBn\nZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChvaWQsDQogICAgICAgICAgICAgICAg\nKGZsYWdzICYgT0lEX0FMTE9XX05FVykgIT0gMCB8fCBoYXNGbHVzaGVkKCkp\nOw0KICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsNCiAgICAgICAgICAg\nICAgICBpZiAoIXJlcXVpcmVzTG9hZChzbSwgdHJ1ZSwgZmV0Y2gsIGVkYXRh\nLCBmbGFncykpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnBy\nb2Nlc3NSZXR1cm4ob2lkLCBzbSk7DQoNCiAgICAgICAgICAgICAgICBpZiAo\nIXNtLmlzTG9hZGluZygpKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIG1h\na2Ugc3VyZSBhbGwgdGhlIGNvbmZpZ3VyZWQgZmllbGRzIGFyZSBsb2FkZWQ7\nIGRvIHRoaXMNCiAgICAgICAgICAgICAgICAgICAgLy8gYWZ0ZXIgbWFraW5n\nIGluc3RhbmNlIHRyYW5zYWN0aW9uYWwgZm9yIGxvY2tpbmcNCiAgICAgICAg\nICAgICAgICAgICAgaWYgKCFzbS5pc1RyYW5zYWN0aW9uYWwoKSAmJiB1c2VU\ncmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gpKQ0KICAgICAgICAgICAgICAgICAg\nICAgICAgc20udHJhbnNhY3Rpb25hbCgpOw0KICAgICAgICAgICAgICAgICAg\nICBib29sZWFuIGxvYWRlZDsNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsN\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZCA9IHNtLmxvYWQoZmV0\nY2gsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIA0KICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGV4Y2x1ZGUsIGVkYXRhLCBmYWxzZSk7DQogICAg\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0\naW9uIG9uZmUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZmxh\nZ3MgJiBPSURfTk9ERUxFVEVEKSAhPSAwDQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgfHwgKGZsYWdzICYgT0lEX05PVkFMSURBVEUpICE9IDApDQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgb25mZTsNCiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4o\nb2lkLCBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAg\nICAgICAgICAgICAgIC8vIGlmIG5vIGRhdGEgbmVlZGVkIHRvIGJlIGxvYWRl\nZCBhbmQgdGhlIHVzZXIgd2FudHMgdG8NCiAgICAgICAgICAgICAgICAgICAg\nLy8gdmFsaWRhdGUsIGp1c3QgbWFrZSBzdXJlIHRoZSBvYmplY3QgZXhpc3Rz\nDQogICAgICAgICAgICAgICAgICAgIGlmICghbG9hZGVkICYmIChmbGFncyAm\nIE9JRF9OT1ZBTElEQVRFKSA9PSAwDQogICAgICAgICAgICAgICAgICAgICAg\nICAmJiBfY29tcGF0LmdldFZhbGlkYXRlVHJ1ZUNoZWNrc1N0b3JlKCkNCiAg\nICAgICAgICAgICAgICAgICAgICAgICYmICFzbS5pc1RyYW5zYWN0aW9uYWwo\nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgIV9zdG9yZS5leGlzdHMo\nc20sIGVkYXRhKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChm\nbGFncyAmIE9JRF9OT0RFTEVURUQpID09IDApDQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51\nbGwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVj\ndE5vdEZvdW5kRXhjZXB0aW9uKF9sb2MuZ2V0DQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKCJkZWwtaW5zdGFuY2UiLCBzbS5nZXRNYW5hZ2VkSW5z\ndGFuY2UoKSwgb2lkKSkuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKTsNCiAg\nICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAg\nICAgICAgICAgICAgIC8vIHNpbmNlIHRoZSBvYmplY3Qgd2FzIGNhY2hlZCwg\nd2UgbWF5IG5lZWQgdG8gdXBncmFkZSBsb2NrDQogICAgICAgICAgICAgICAg\nLy8gaWYgY3VycmVudCBsZXZlbCBpcyBoaWdoZXIgdGhhbiBsZXZlbCBvZiBp\nbml0aWFsIGxvYWQNCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfQUNUSVZFKSAhPSAwKSB7DQogICAgICAgICAgICAgICAgICAgIGludCBs\nZXZlbCA9IGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKTsNCiAgICAgICAgICAg\nICAgICAgICAgX2xtLmxvY2soc20sIGxldmVsLCBmZXRjaC5nZXRMb2NrVGlt\nZW91dCgpLCBlZGF0YSk7DQogICAgICAgICAgICAgICAgICAgIHNtLnJlYWRM\nb2NrZWQobGV2ZWwsIGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCkpOw0KICAg\nICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbC5w\ncm9jZXNzUmV0dXJuKG9pZCwgc20pOw0KICAgICAgICAgICAgfQ0KDQogICAg\nICAgICAgICAvLyBpZiB0aGVyZSdzIG5vIGNhY2hlZCBzbSBmb3IgYSBuZXcv\ndHJhbnNpZW50IGlkIHR5cGUsIHdlDQogICAgICAgICAgICAvLyBpdCBkZWZp\nbml0ZWx5IGRvZXNuJ3QgZXhpc3QNCiAgICAgICAgICAgIGlmIChvaWQgaW5z\ndGFuY2VvZiBTdGF0ZU1hbmFnZXJJZCkNCiAgICAgICAgICAgICAgICByZXR1\ncm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7DQoNCiAgICAgICAg\nICAgIC8vIGluaXRpYWxpemUgYSBuZXcgc3RhdGUgbWFuYWdlciBmb3IgdGhl\nIGRhdGFzdG9yZSBpbnN0YW5jZQ0KICAgICAgICAgICAgc20gPSBuZXdTdGF0\nZU1hbmFnZXJJbXBsKG9pZCwgKGZsYWdzICYgT0lEX0NPUFkpICE9IDApOw0K\nICAgICAgICAgICAgYm9vbGVhbiBsb2FkID0gcmVxdWlyZXNMb2FkKHNtLCBm\nYWxzZSwgZmV0Y2gsIGVkYXRhLCBmbGFncyk7DQogICAgICAgICAgICBzbSA9\nIGluaXRpYWxpemUoc20sIGxvYWQsIGZldGNoLCBlZGF0YSk7DQogICAgICAg\nICAgICBpZiAoc20gPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGlmICgo\nZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkNCiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKG9pZCk7\nDQogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihv\naWQsIG51bGwpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBt\nYWtlIHN1cmUgYWxsIGNvbmZpZ3VyZWQgZmllbGRzIHdlcmUgbG9hZGVkDQog\nICAgICAgICAgICBpZiAobG9hZCkgew0KICAgICAgICAgICAgICAgIHRyeSB7\nDQogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoZmV0Y2gsIFN0YXRlTWFu\nYWdlckltcGwuTE9BRF9GR1MsIGV4Y2x1ZGUsDQogICAgICAgICAgICAgICAg\nICAgICAgICBlZGF0YSwgZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG9uZmUpIHsNCiAgICAgICAg\nICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT0RFTEVURUQpICE9IDAN\nCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IChmbGFncyAmIE9JRF9OT1ZB\nTElEQVRFKSAhPSAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nb25mZTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vz\nc1JldHVybihvaWQsIG51bGwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAg\nICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1\ncm4ob2lkLCBzbSk7DQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsNCiAgICAgICAgICAgIHRocm93IGtlOw0KICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7DQogICAgICAgIH0gZmluYWxs\neSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0K\nICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgYSBuZXdseS1j\nb25zdHJ1Y3RlZCBzdGF0ZSBtYW5hZ2VyLg0KICAgICAqLw0KICAgIHByb3Rl\nY3RlZCBTdGF0ZU1hbmFnZXJJbXBsIGluaXRpYWxpemUoU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSwgYm9vbGVhbiBsb2FkLA0KICAgICAgICBGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIE9iamVjdCBlZGF0YSkgew0KICAgICAgICBpZiAoIWxv\nYWQpIHsNCiAgICAgICAgICAgIHNtLmluaXRpYWxpemUoc20uZ2V0TWV0YURh\ndGEoKS5nZXREZXNjcmliZWRUeXBlKCksDQogICAgICAgICAgICAgICAgUENT\ndGF0ZS5IT0xMT1cpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAg\nUENTdGF0ZSBzdGF0ZSA9ICh1c2VUcmFuc2FjdGlvbmFsU3RhdGUoZmV0Y2gp\nKQ0KICAgICAgICAgICAgICAgID8gUENTdGF0ZS5QQ0xFQU4gOiBQQ1N0YXRl\nLlBOT05UUkFOUzsNCiAgICAgICAgICAgIHNtLnNldExvYWRpbmcodHJ1ZSk7\nDQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGlmICghX3N0\nb3JlLmluaXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgZWRhdGEpKQ0KICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0g\nZmluYWxseSB7DQogICAgICAgICAgICAgICAgc20uc2V0TG9hZGluZyhmYWxz\nZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJu\nIHNtOw0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3RbXSBmaW5kQWxsKENv\nbGxlY3Rpb24gb2lkcywgYm9vbGVhbiB2YWxpZGF0ZSwNCiAgICAgICAgRmlu\nZENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAgIGludCBmbGFncyA9IE9JRF9D\nT1BZIHwgT0lEX0FMTE9XX05FVyB8IE9JRF9OT0RFTEVURUQ7DQogICAgICAg\nIGlmICghdmFsaWRhdGUpDQogICAgICAgICAgICBmbGFncyB8PSBPSURfTk9W\nQUxJREFURTsNCiAgICAgICAgcmV0dXJuIGZpbmRBbGwob2lkcywgX2ZjLCBu\ndWxsLCBudWxsLCBmbGFncywgY2FsbCk7DQogICAgfQ0KDQogICAgcHVibGlj\nIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVjdGlvbiBvaWRzLCBGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsDQogICAgICAgIEJpdFNldCBleGNsdWRlLCBPYmpl\nY3QgZWRhdGEsIGludCBmbGFncykgew0KICAgICAgICByZXR1cm4gZmluZEFs\nbChvaWRzLCBmZXRjaCwgZXhjbHVkZSwgZWRhdGEsIGZsYWdzLCBudWxsKTsN\nCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJbnRlcm5hbCBmaW5kZXIuDQog\nICAgICovDQogICAgcHJvdGVjdGVkIE9iamVjdFtdIGZpbmRBbGwoQ29sbGVj\ndGlvbiBvaWRzLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsDQogICAgICAg\nIEJpdFNldCBleGNsdWRlLCBPYmplY3QgZWRhdGEsIGludCBmbGFncywgRmlu\nZENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAgIGZpbmRBbGxEZXB0aCArKzsN\nCg0KICAgICAgICAvLyB0aHJvdyBhbnkgZXhjZXB0aW9ucyBmb3IgbnVsbCBv\naWRzIHVwIGltbWVkaWF0ZWx5DQogICAgICAgIGlmIChvaWRzID09IG51bGwp\nDQogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24o\nIm9pZHMgPT0gbnVsbCIpOw0KICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05P\nVkFMSURBVEUpICE9IDAgJiYgb2lkcy5jb250YWlucyhudWxsKSkNCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxs\nLW9pZHMiKSk7DQoNCiAgICAgICAgLy8gd2UgaGF2ZSB0byB1c2UgYSBtYXAg\nb2Ygb2lkLT5zbSByYXRoZXIgdGhhbiBhIHNpbXBsZQ0KICAgICAgICAvLyBh\ncnJheSwgc28gdGhhdCB3ZSBtYWtlIHN1cmUgbm90IHRvIGNyZWF0ZSBtdWx0\naXBsZSBzbXMgZm9yIGVxdWl2YWxlbnQNCiAgICAgICAgLy8gb2lkcyBpZiB0\naGUgdXNlciBoYXMgZHVwbGljYXRlcyBpbiB0aGUgZ2l2ZW4gYXJyYXkNCiAg\nICAgICAgaWYgKF9sb2FkaW5nID09IG51bGwpDQogICAgICAgICAgICBfbG9h\nZGluZyA9IG5ldyBIYXNoTWFwKChpbnQpIChvaWRzLnNpemUoKSAqIDEuMzMg\nKyAxKSk7DQoNCiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkNCiAgICAgICAg\nICAgIGNhbGwgPSB0aGlzOw0KICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkN\nCiAgICAgICAgICAgIGZldGNoID0gX2ZjOw0KDQogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXNz\nZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsNCg0KICAgICAgICAgICAgLy8g\nY29sbGVjdGlvbiBvZiBzdGF0ZSBtYW5hZ2VycyB0byBwYXNzIHRvIHN0b3Jl\nIG1hbmFnZXINCiAgICAgICAgICAgIExpc3QgbG9hZCA9IG51bGw7DQogICAg\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOw0KICAgICAgICAgICAgYm9v\nbGVhbiBpbml0aWFsaXplZDsNCiAgICAgICAgICAgIGJvb2xlYW4gdHJhbnNT\ndGF0ZSA9IHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShmZXRjaCk7DQogICAgICAg\nICAgICBPYmplY3Qgb2JqLCBvaWQ7DQogICAgICAgICAgICBpbnQgaWR4ID0g\nMDsNCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2lkcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOyBpZHgrKykgew0KICAgICAgICAgICAg\nICAgIC8vIGlmIHdlJ3ZlIGFscmVhZHkgc2VlbiB0aGlzIG9pZCwgc2tpcCBy\nZXBlYXRzDQogICAgICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsNCiAg\nICAgICAgICAgICAgICBvaWQgPSBjYWxsLnByb2Nlc3NBcmd1bWVudChvYmop\nOw0KICAgICAgICAgICAgICAgIGlmIChvaWQgPT0gbnVsbCB8fCBfbG9hZGlu\nZy5jb250YWluc0tleShvYmopKQ0KICAgICAgICAgICAgICAgICAgICBjb250\naW51ZTsNCg0KICAgICAgICAgICAgICAgIC8vIGlmIHdlIGRvbid0IGhhdmUg\nYSBjYWNoZWQgaW5zdGFuY2Ugb3IgaXQgaXMgbm90IHRyYW5zYWN0aW9uYWwN\nCiAgICAgICAgICAgICAgICAvLyBhbmQgaXMgaG9sbG93IG9yIHdlIG5lZWQg\ndG8gdmFsaWRhdGUsIGxvYWQgaXQNCiAgICAgICAgICAgICAgICBzbSA9IGdl\ndFN0YXRlTWFuYWdlckltcGxCeUlkKG9pZCwgKGZsYWdzICYgT0lEX0FMTE9X\nX05FVykgIT0gMA0KICAgICAgICAgICAgICAgICAgICB8fCBoYXNGbHVzaGVk\nKCkpOw0KICAgICAgICAgICAgICAgIGluaXRpYWxpemVkID0gc20gIT0gbnVs\nbDsNCiAgICAgICAgICAgICAgICBpZiAoIWluaXRpYWxpemVkKQ0KICAgICAg\nICAgICAgICAgICAgICBzbSA9IG5ld1N0YXRlTWFuYWdlckltcGwob2lkLCAo\nZmxhZ3MgJiBPSURfQ09QWSkgIT0gMCk7DQoNCiAgICAgICAgICAgICAgICBf\nbG9hZGluZy5wdXQob2JqLCBzbSk7DQogICAgICAgICAgICAgICAgaWYgKHJl\ncXVpcmVzTG9hZChzbSwgaW5pdGlhbGl6ZWQsIGZldGNoLCBlZGF0YSwgZmxh\nZ3MpKSB7DQogICAgICAgICAgICAgICAgICAgIHRyYW5zU3RhdGUgPSB0cmFu\nc1N0YXRlIHx8IHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShmZXRjaCk7DQogICAg\nICAgICAgICAgICAgICAgIGlmIChpbml0aWFsaXplZCAmJiAhc20uaXNUcmFu\nc2FjdGlvbmFsKCkgJiYgdHJhbnNTdGF0ZSkNCiAgICAgICAgICAgICAgICAg\nICAgICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsNCiAgICAgICAgICAgICAgICAg\nICAgaWYgKGxvYWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAg\nIGxvYWQgPSBuZXcgQXJyYXlMaXN0KG9pZHMuc2l6ZSgpIC0gaWR4KTsNCiAg\nICAgICAgICAgICAgICAgICAgbG9hZC5hZGQoc20pOw0KICAgICAgICAgICAg\nICAgIH0gZWxzZSBpZiAoIWluaXRpYWxpemVkKQ0KICAgICAgICAgICAgICAg\nICAgICBzbS5pbml0aWFsaXplKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgUENTdGF0ZS5I\nT0xMT1cpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBwYXNz\nIGFsbCBzdGF0ZSBtYW5hZ2VycyBpbiBuZWVkIG9mIGxvYWRpbmcgb3IgdmFs\naWRhdGlvbiB0byB0aGUNCiAgICAgICAgICAgIC8vIHN0b3JlIG1hbmFnZXIN\nCiAgICAgICAgICAgIGlmIChsb2FkICE9IG51bGwpIHsNCiAgICAgICAgICAg\nICAgICBQQ1N0YXRlIHN0YXRlID0gKHRyYW5zU3RhdGUpID8gUENTdGF0ZS5Q\nQ0xFQU4NCiAgICAgICAgICAgICAgICAgICAgOiBQQ1N0YXRlLlBOT05UUkFO\nUzsNCiAgICAgICAgICAgICAgICBDb2xsZWN0aW9uIGZhaWxlZCA9IF9zdG9y\nZS5sb2FkQWxsKGxvYWQsIHN0YXRlLA0KICAgICAgICAgICAgICAgICAgICBT\ndG9yZU1hbmFnZXIuRk9SQ0VfTE9BRF9OT05FLCBmZXRjaCwgZWRhdGEpOw0K\nDQogICAgICAgICAgICAgICAgLy8gc2V0IGZhaWxlZCBpbnN0YW5jZXMgdG8g\nbnVsbA0KICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAh\nZmFpbGVkLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAo\nKGZsYWdzICYgT0lEX05PVkFMSURBVEUpICE9IDApDQogICAgICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihm\nYWlsZWQpOw0KICAgICAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IGZhaWxlZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykNCiAgICAg\nICAgICAgICAgICAgICAgICAgIF9sb2FkaW5nLnB1dChpdHIubmV4dCgpLCBu\ndWxsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAg\nICAgICAgICAgIC8vIGNyZWF0ZSByZXN1bHRzIGFycmF5OyBtYWtlIHN1cmUg\nYWxsIGNvbmZpZ3VyZWQgZmllbGRzIGFyZQ0KICAgICAgICAgICAgLy8gbG9h\nZGVkIGluIGVhY2ggaW5zdGFuY2UNCiAgICAgICAgICAgIE9iamVjdFtdIHJl\nc3VsdHMgPSBuZXcgT2JqZWN0W29pZHMuc2l6ZSgpXTsNCiAgICAgICAgICAg\nIGJvb2xlYW4gYWN0aXZlID0gKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAw\nOw0KICAgICAgICAgICAgaW50IGxldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tM\nZXZlbCgpOw0KICAgICAgICAgICAgaWR4ID0gMDsNCiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gb2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOyBpZHgrKykgew0KICAgICAgICAgICAgICAgIG9pZCA9IGl0ci5uZXh0\nKCk7DQogICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkg\nX2xvYWRpbmcuZ2V0KG9pZCk7DQogICAgICAgICAgICAgICAgaWYgKHNtICE9\nIG51bGwgJiYgcmVxdWlyZXNMb2FkKHNtLCB0cnVlLCBmZXRjaCwgZWRhdGEs\nIGZsYWdzKSkgew0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgICAgICAgICAgICAgc20ubG9hZChmZXRjaCwgU3RhdGVNYW5hZ2Vy\nSW1wbC5MT0FEX0ZHUywNCiAgICAgICAgICAgICAgICAgICAgICAgIAlleGNs\ndWRlLCBlZGF0YSwgZmFsc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGFjdGl2ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9s\nbS5sb2NrKHNtLCBsZXZlbCwgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwgZWRh\ndGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtLnJlYWRMb2Nr\nZWQobGV2ZWwsIGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCkpOw0KICAgICAg\nICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQog\nICAgICAgICAgICAgICAgICAgIGNhdGNoIChPYmplY3ROb3RGb3VuZEV4Y2Vw\ndGlvbiBvbmZlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGZs\nYWdzICYgT0lEX05PREVMRVRFRCkgIT0gMA0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHx8IChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQ0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG9uZmU7DQogICAg\nICAgICAgICAgICAgICAgICAgICBzbSA9IG51bGw7DQogICAgICAgICAgICAg\nICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAg\ncmVzdWx0c1tpZHhdID0gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOw0K\nICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7DQog\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAg\nICAgICAgIHRocm93IGtlOw0KICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAg\nICBmaW5kQWxsRGVwdGgtLTsNCiAgICAgICAgICAgIGlmIChmaW5kQWxsRGVw\ndGggPT0gMCkNCiAgICAgICAgICAgICAgICBfbG9hZGluZyA9IG51bGw7DQog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIHByaXZhdGUgYm9vbGVhbiBoYXNGbHVzaGVkKCkgew0KICAgICAg\nICByZXR1cm4gKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0gMDsNCiAgICB9\nDQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4g\naW5zdGFuY2UgbmVlZHMgbG9hZGluZyBiZWZvcmUgYmVpbmcgcmV0dXJuZWQN\nCiAgICAgKiB0byB0aGUgdXNlci4NCiAgICAgKi8NCiAgICBwcml2YXRlIGJv\nb2xlYW4gcmVxdWlyZXNMb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIGJv\nb2xlYW4gaW5pdGlhbGl6ZWQsDQogICAgICAgIEZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3MpIHsNCiAgICAgICAg\naWYgKCFmZXRjaC5yZXF1aXJlc0xvYWQoKSkNCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsNCiAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRF\nKSA9PSAwKQ0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIGlm\nIChlZGF0YSAhPSBudWxsKSAvLyB0YWtlIGFkdmFudGFnZSBvZiBleGlzdGlu\nZyByZXN1bHQNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICBp\nZiAoaW5pdGlhbGl6ZWQgJiYgc20uZ2V0UENTdGF0ZSgpICE9IFBDU3RhdGUu\nSE9MTE9XKQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICBp\nZiAoIWluaXRpYWxpemVkICYmIHNtLmdldE1ldGFEYXRhKCkuZ2V0UENTdWJj\nbGFzc2VzKCkubGVuZ3RoID4gMCkNCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOw0KICAgICAgICByZXR1cm4gIV9jb21wYXQuZ2V0VmFsaWRhdGVGYWxzZVJl\ndHVybnNIb2xsb3coKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1\ncm4gd2hldGhlciB0byB1c2UgYSB0cmFuc2FjdGlvbmFsIHN0YXRlLg0KICAg\nICAqLw0KICAgIHByaXZhdGUgYm9vbGVhbiB1c2VUcmFuc2FjdGlvbmFsU3Rh\ndGUoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7DQogICAgICAgIHJldHVy\nbiAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDAgJiYgKCFfb3B0aW1pc3Rp\nYw0KICAgICAgICAgICAgfHwgX2F1dG9DbGVhciA9PSBDTEVBUl9BTEwNCiAg\nICAgICAgICAgIHx8IGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKSAhPSBMT0NL\nX05PTkUpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3QgZmluZENhY2hl\nZChPYmplY3Qgb2lkLCBGaW5kQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAg\naWYgKGNhbGwgPT0gbnVsbCkNCiAgICAgICAgICAgIGNhbGwgPSB0aGlzOw0K\nICAgICAgICBvaWQgPSBjYWxsLnByb2Nlc3NBcmd1bWVudChvaWQpOw0KICAg\nICAgICBpZiAob2lkID09IG51bGwpDQogICAgICAgICAgICByZXR1cm4gY2Fs\nbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7DQoNCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQo\nb2lkLCB0cnVlKTsNCiAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nlc3NS\nZXR1cm4ob2lkLCBzbSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAg\nIHB1YmxpYyBDbGFzcyBnZXRPYmplY3RJZFR5cGUoQ2xhc3MgY2xzKSB7DQog\nICAgICAgIGlmIChjbHMgPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOw0KDQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsNCiAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9j\nb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuDQogICAgICAg\nICAgICAgICAgZ2V0TWV0YURhdGEoY2xzLCBfbG9hZGVyLCBmYWxzZSk7DQog\nICAgICAgICAgICBpZiAobWV0YSA9PSBudWxsDQogICAgICAgICAgICAgICAg\nfHwgbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklE\nX1VOS05PV04pDQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAg\nICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01l\ndGFEYXRhLklEX0FQUExJQ0FUSU9OKQ0KICAgICAgICAgICAgICAgIHJldHVy\nbiBtZXRhLmdldE9iamVjdElkVHlwZSgpOw0KDQogICAgICAgICAgICByZXR1\ncm4gX3N0b3JlLmdldERhdGFTdG9yZUlkVHlwZShtZXRhKTsNCiAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAgICAg\ndGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9u\nKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIE9i\namVjdCBuZXdPYmplY3RJZChDbGFzcyBjbHMsIE9iamVjdCB2YWwpIHsNCiAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuIG51\nbGw7DQoNCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOw0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2Nv\nbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4NCiAgICAgICAg\nICAgICAgICBnZXRNZXRhRGF0YShjbHMsIF9sb2FkZXIsIHRydWUpOw0KICAg\nICAgICAgICAgc3dpdGNoIChtZXRhLmdldElkZW50aXR5VHlwZSgpKSB7DQog\nICAgICAgICAgICBjYXNlIENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFOg0K\nICAgICAgICAgICAgICAgIC8vIGRlbGVnYXRlIHRvIHN0b3JlIG1hbmFnZXIg\nZm9yIGRhdGFzdG9yZSBpZHMNCiAgICAgICAgICAgICAgICBpZiAodmFsIGlu\nc3RhbmNlb2YgU3RyaW5nDQogICAgICAgICAgICAgICAgICAgICYmICgoU3Ry\naW5nKSB2YWwpLnN0YXJ0c1dpdGgoU3RhdGVNYW5hZ2VySWQuU1RSSU5HX1BS\nRUZJWCkpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdGVN\nYW5hZ2VySWQoKFN0cmluZykgdmFsKTsNCiAgICAgICAgICAgICAgICByZXR1\ncm4gX3N0b3JlLm5ld0RhdGFTdG9yZUlkKHZhbCwgbWV0YSk7DQogICAgICAg\nICAgICBjYXNlIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT046DQogICAg\nICAgICAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNBc3NpZ25hYmxlKG1ldGEu\nZ2V0T2JqZWN0SWRUeXBlKCksIA0KICAgICAgICAgICAgICAgICAgICB2YWwu\nZ2V0Q2xhc3MoKSkpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFtZXRh\nLmlzT3BlbkpQQUlkZW50aXR5KCkgDQogICAgICAgICAgICAgICAgICAgICAg\nICAmJiBtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpDQogICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdElkKGNscywgdmFsKTsN\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsNCiAgICAgICAgICAg\nICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBzdHJpbmdpZmllZCBhcHAg\naWQ/DQogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmlu\nZyANCiAgICAgICAgICAgICAgICAgICAgJiYgIV9jb25mLmdldENvbXBhdGli\naWxpdHlJbnN0YW5jZSgpLg0KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0\nU3RyaWN0SWRlbnRpdHlWYWx1ZXMoKQ0KICAgICAgICAgICAgICAgICAgICAm\nJiAhTW9kaWZpZXIuaXNBYnN0cmFjdChjbHMuZ2V0TW9kaWZpZXJzKCkpKQ0K\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gUENSZWdpc3RyeS5uZXdPYmpl\nY3RJZChjbHMsIChTdHJpbmcpIHZhbCk7DQoNCiAgICAgICAgICAgICAgICBP\nYmplY3RbXSBhcnIgPSAodmFsIGluc3RhbmNlb2YgT2JqZWN0W10pID8gKE9i\namVjdFtdKSB2YWwNCiAgICAgICAgICAgICAgICAgICAgOiBuZXcgT2JqZWN0\nW117IHZhbCB9Ow0KICAgICAgICAgICAgICAgIHJldHVybiBBcHBsaWNhdGlv\nbklkcy5mcm9tUEtWYWx1ZXMoYXJyLCBtZXRhKTsNCiAgICAgICAgICAgIGRl\nZmF1bHQ6DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93bmlkIiwgY2xzKSk7DQogICAgICAg\nICAgICB9DQogICAgICAgIH0gY2F0Y2ggKElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbiBpYWUpIHsNCiAgICAgICAgCXRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJiYWQtaWQtdmFsdWUiLCB2YWwsDQogICAgICAgICAgICAg\nICAgdmFsLmdldENsYXNzKCkuZ2V0TmFtZSgpLCBjbHMpKS5zZXRDYXVzZShp\nYWUpOw0KICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nDQogICAgICAgICAgICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRjaCAoQ2xh\nc3NDYXN0RXhjZXB0aW9uIGNjZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1pZC12YWx1ZSIsIHZhbCwN\nCiAgICAgICAgICAgICAgICB2YWwuZ2V0Q2xhc3MoKS5nZXROYW1lKCksIGNs\ncykpLnNldENhdXNlKGNjZSk7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogQ3JlYXRlIGEgbmV3IHN0YXRlIG1hbmFnZXIgZm9yIHRo\nZSBnaXZlbiBvaWQuDQogICAgICovDQogICAgcHJpdmF0ZSBTdGF0ZU1hbmFn\nZXJJbXBsIG5ld1N0YXRlTWFuYWdlckltcGwoT2JqZWN0IG9pZCwgYm9vbGVh\nbiBjb3B5KSB7DQogICAgICAgIC8vIHNlZSBpZiB3ZSdyZSBpbiB0aGUgcHJv\nY2VzcyBvZiBsb2FkaW5nIHRoaXMgb2lkIGluIGEgbG9hZEFsbCBjYWxsDQog\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207DQogICAgICAgIGlmIChfbG9h\nZGluZyAhPSBudWxsKSB7DQogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFn\nZXJJbXBsKSBfbG9hZGluZy5nZXQob2lkKTsNCiAgICAgICAgICAgIGlmIChz\nbSAhPSBudWxsICYmIHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpID09IG51\nbGwpDQogICAgICAgICAgICAgICAgcmV0dXJuIHNtOw0KICAgICAgICB9DQoN\nCiAgICAgICAgLy8gZmluZCBtZXRhZGF0YSBmb3IgdGhlIG9pZA0KICAgICAg\nICBDbGFzcyBwY1R5cGUgPSBfc3RvcmUuZ2V0TWFuYWdlZFR5cGUob2lkKTsN\nCiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zID0gX2NvbmYuZ2V0\nTWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKTsNCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhOw0KICAgICAgICBpZiAocGNUeXBlICE9IG51bGwpDQog\nICAgICAgICAgICBtZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEocGNUeXBlLCBf\nbG9hZGVyLCB0cnVlKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgbWV0\nYSA9IHJlcG9zLmdldE1ldGFEYXRhKG9pZCwgX2xvYWRlciwgdHJ1ZSk7DQoN\nCiAgICAgICAgLy8gY29weSB0aGUgb2lkIGlmIG5lZWRlZA0KICAgICAgICBp\nZiAoY29weSAmJiBfY29tcGF0LmdldENvcHlPYmplY3RJZHMoKSkgew0KICAg\nICAgICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NN\nZXRhRGF0YS5JRF9BUFBMSUNBVElPTikNCiAgICAgICAgICAgICAgICBvaWQg\nPSBBcHBsaWNhdGlvbklkcy5jb3B5KG9pZCwgbWV0YSk7DQogICAgICAgICAg\nICBlbHNlIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0\nYURhdGEuSURfVU5LTk9XTikNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibWV0YS11bmtub3duaWQiLCBtZXRh\nKSk7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgb2lkID0g\nX3N0b3JlLmNvcHlEYXRhU3RvcmVJZChvaWQsIG1ldGEpOw0KICAgICAgICB9\nDQoNCiAgICAgICAgc20gPSBuZXdTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgbWV0\nYSk7DQogICAgICAgIHNtLnNldE9iamVjdElkKG9pZCk7DQogICAgICAgIHJl\ndHVybiBzbTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGUgYSBz\ndGF0ZSBtYW5hZ2VyIGZvciB0aGUgZ2l2ZW4gb2lkIGFuZCBtZXRhZGF0YS4N\nCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbCBuZXdT\ndGF0ZU1hbmFnZXJJbXBsKE9iamVjdCBvaWQsDQogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSkgew0KICAgICAgICByZXR1cm4gbmV3IFN0YXRlTWFuYWdl\nckltcGwob2lkLCBtZXRhLCB0aGlzKTsNCiAgICB9DQoNCiAgICAvLy8vLy8v\nLy8vLy8vLy8NCiAgICAvLyBUcmFuc2FjdGlvbg0KICAgIC8vLy8vLy8vLy8v\nLy8vLw0KDQogICAgcHVibGljIHZvaWQgYmVnaW4oKSB7DQogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkNCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJhY3RpdmUiKSk7DQogICAgICAgICAgICBfZmFjdG9yeS5zeW5jV2l0\naE1hbmFnZWRUcmFuc2FjdGlvbih0aGlzLCB0cnVlKTsNCiAgICAgICAgICAg\nIGJlZ2luSW50ZXJuYWwoKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogTm90aWZ5IHRoZSBzdG9yZSBtYW5hZ2VyIG9mIGEg\ndHJhbnNhY3Rpb24uDQogICAgICovDQogICAgcHJpdmF0ZSB2b2lkIGJlZ2lu\nSW50ZXJuYWwoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBiZWdp\nblN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKF9vcHRpbWlzdGljKTsNCiAgICAg\nICAgICAgIF9mbGFncyB8PSBGTEFHX0FDVElWRTsNCg0KICAgICAgICAgICAg\nLy8gc3RhcnQgbG9ja2luZw0KICAgICAgICAgICAgaWYgKCFfb3B0aW1pc3Rp\nYykgew0KICAgICAgICAgICAgICAgIF9mYy5zZXRSZWFkTG9ja0xldmVsKF9j\nb25mLmdldFJlYWRMb2NrTGV2ZWxDb25zdGFudCgpKTsNCiAgICAgICAgICAg\nICAgICBfZmMuc2V0V3JpdGVMb2NrTGV2ZWwoX2NvbmYuZ2V0V3JpdGVMb2Nr\nTGV2ZWxDb25zdGFudCgpKTsNCiAgICAgICAgICAgICAgICBfZmMuc2V0TG9j\na1RpbWVvdXQoX2NvbmYuZ2V0TG9ja1RpbWVvdXQoKSk7DQogICAgICAgICAg\nICB9DQogICAgICAgICAgICBfbG0uYmVnaW5UcmFuc2FjdGlvbigpOw0KDQog\nICAgICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0JlZ2luTGlz\ndGVuZXJzKCkpDQogICAgICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZl\nbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywNCiAgICAgICAgICAgICAg\nICAgICAgVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9CRUdJTiwgbnVsbCwgbnVs\nbCwgbnVsbCwgbnVsbCkpOw0KICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7DQogICAgICAgICAgICAvLyBpZiB3ZSBhbHJlYWR5IHN0\nYXJ0ZWQgdGhlIHRyYW5zYWN0aW9uLCBkb24ndCBsZXQgaXQgY29tbWl0DQog\nICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQ0K\nICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKGtlKTsN\nCiAgICAgICAgICAgIHRocm93IGtlLnNldEZhdGFsKHRydWUpOw0KICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAg\nICAvLyBpZiB3ZSBhbHJlYWR5IHN0YXJ0ZWQgdGhlIHRyYW5zYWN0aW9uLCBk\nb24ndCBsZXQgaXQgY29tbWl0DQogICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfQUNUSVZFKSAhPSAwKQ0KICAgICAgICAgICAgICAgIHNldFJvbGxi\nYWNrT25seUludGVybmFsKHJlKTsNCiAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihyZSkuc2V0RmF0YWwodHJ1ZSk7DQogICAgICAgIH0N\nCg0KICAgICAgICBpZiAoX3BlbmRpbmcgIT0gbnVsbCkgew0KICAgICAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsNCiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXQgPSBfcGVuZGluZy5pdGVyYXRvcigpOyBpdC5oYXNOZXh0KCk7\nKSB7DQogICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkg\naXQubmV4dCgpOw0KICAgICAgICAgICAgICAgIHNtLnRyYW5zYWN0aW9uYWwo\nKTsNCiAgICAgICAgICAgICAgICBpZiAoc20uaXNEaXJ0eSgpKQ0KICAgICAg\nICAgICAgICAgICAgICBzZXREaXJ0eShzbSwgdHJ1ZSk7DQogICAgICAgICAg\nICB9DQogICAgICAgICAgICBfcGVuZGluZyA9IG51bGw7DQogICAgICAgIH0N\nCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBiZWdpblN0b3JlKCkgew0KICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsNCiAgICAgICAgdHJ5IHsNCiAg\nICAgICAgICAgIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7DQogICAg\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSA9PSAw\nKQ0KICAgICAgICAgICAgICAgIGJlZ2luU3RvcmVNYW5hZ2VyVHJhbnNhY3Rp\nb24oZmFsc2UpOw0KICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7DQogICAgICAgICAgICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAgdGhyb3cg\nbmV3IFN0b3JlRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsN\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgLyoqDQogICAgICogQmVnaW4gYSBzdG9yZSBtYW5hZ2VyIHRy\nYW5zYWN0aW9uLg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9pZCBiZWdpblN0\nb3JlTWFuYWdlclRyYW5zYWN0aW9uKGJvb2xlYW4gb3B0aW1pc3RpYykgew0K\nICAgICAgICBpZiAoIW9wdGltaXN0aWMpIHsNCiAgICAgICAgICAgIHJldGFp\nbkNvbm5lY3Rpb24oKTsNCiAgICAgICAgICAgIF9zdG9yZS5iZWdpbigpOw0K\nICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfU1RPUkVfQUNUSVZFOw0KICAg\nICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKF9jb25uUmV0YWluTW9k\nZSA9PSBDT05OX1JFVEFJTl9UUkFOUykNCiAgICAgICAgICAgICAgICByZXRh\naW5Db25uZWN0aW9uKCk7DQogICAgICAgICAgICBfc3RvcmUuYmVnaW5PcHRp\nbWlzdGljKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAg\nKiBFbmQgdGhlIGN1cnJlbnQgc3RvcmUgbWFuYWdlciB0cmFuc2FjdGlvbi4g\nVGhyb3dzIGFuDQogICAgICogZXhjZXB0aW9uIHRvIHNpZ25hbCBhIGZvcmNl\nZCByb2xsYmFjayBhZnRlciBmYWlsZWQgY29tbWl0LCBvdGhlcndpc2UNCiAg\nICAgKiByZXR1cm5zIGFueSBleGNlcHRpb24gZW5jb3VudGVyZWQgZHVyaW5n\nIHRoZSBlbmQgcHJvY2Vzcy4NCiAgICAgKi8NCiAgICBwcml2YXRlIFJ1bnRp\nbWVFeGNlcHRpb24gZW5kU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24oYm9vbGVh\nbiByb2xsYmFjaykgew0KICAgICAgICBib29sZWFuIGZvcmNlZFJvbGxiYWNr\nID0gZmFsc2U7DQogICAgICAgIGJvb2xlYW4gcmVsZWFzZUNvbm4gPSBmYWxz\nZTsNCiAgICAgICAgUnVudGltZUV4Y2VwdGlvbiBlcnIgPSBudWxsOw0KICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NU\nT1JFX0FDVElWRSkgIT0gMCkgew0KICAgICAgICAgICAgICAgIHJlbGVhc2VD\nb25uID0gX2Nvbm5SZXRhaW5Nb2RlICE9IENPTk5fUkVUQUlOX0FMV0FZUzsN\nCiAgICAgICAgICAgICAgICBpZiAocm9sbGJhY2spDQogICAgICAgICAgICAg\nICAgICAgIF9zdG9yZS5yb2xsYmFjaygpOw0KICAgICAgICAgICAgICAgIGVs\nc2UNCiAgICAgICAgICAgICAgICAgICAgX3N0b3JlLmNvbW1pdCgpOw0KICAg\nICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZWxlYXNlQ29u\nbiA9IF9jb25uUmV0YWluTW9kZSA9PSBDT05OX1JFVEFJTl9UUkFOUzsNCiAg\nICAgICAgICAgICAgICBfc3RvcmUucm9sbGJhY2tPcHRpbWlzdGljKCk7DQog\nICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIGlmICghcm9sbGJhY2sp\nIHsNCiAgICAgICAgICAgICAgICBmb3JjZWRSb2xsYmFjayA9IHRydWU7DQog\nICAgICAgICAgICAgICAgdHJ5IHsgX3N0b3JlLnJvbGxiYWNrKCk7IH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUyKSB7fQ0KICAgICAgICAgICAgfQ0K\nICAgICAgICAgICAgZXJyID0gcmU7DQogICAgICAgIH0gZmluYWxseSB7DQog\nICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfU1RPUkVfQUNUSVZFOw0KICAg\nICAgICB9DQoNCiAgICAgICAgaWYgKHJlbGVhc2VDb25uKSB7DQogICAgICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHJlbGVhc2VDb25uZWN0aW9u\nKCk7DQogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nKSB7DQogICAgICAgICAgICAgICAgaWYgKGVyciA9PSBudWxsKQ0KICAgICAg\nICAgICAgICAgICAgICBlcnIgPSByZTsNCiAgICAgICAgICAgIH0NCiAgICAg\nICAgfQ0KDQogICAgICAgIGlmIChmb3JjZWRSb2xsYmFjaykNCiAgICAgICAg\nICAgIHRocm93IGVycjsNCiAgICAgICAgcmV0dXJuIGVycjsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgdm9pZCBjb21taXQoKSB7DQogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKGZhbHNlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGFz\nc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7DQoNCiAgICAgICAgICAgIGph\ndmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0NCiAgICAgICAg\nICAgICAgICBfcnVudGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRU\ncmFuc2FjdGlvbigpOw0KICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwp\nDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgibnVsbC10cmFucyIpKTsNCg0KICAgICAgICAgICAg\nLy8gdGhpcyBjb21taXQgb24gdGhlIHRyYW5zYWN0aW9uIHdpbGwgY2F1c2Ug\nb3VyDQogICAgICAgICAgICAvLyBiZWZvcmVDb21wbGV0aW9uIG1ldGhvZCB0\nbyBiZSBpbnZva2VkDQogICAgICAgICAgICB0cmFucy5jb21taXQoKTsNCiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkNCiAgICAgICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwg\na2UpOw0KICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNl\nRW5hYmxlZCgpKQ0KICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoImVuZC10cmFucy1lcnJvciIpLCBlKTsNCiAgICAgICAgICAgIHRocm93\nIG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsN\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgcHVibGljIHZvaWQgcm9sbGJhY2soKSB7DQogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKGZhbHNlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAg\nICAgIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7DQoNCiAgICAgICAg\nICAgIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0NCiAg\nICAgICAgICAgICAgICBfcnVudGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIo\nKS5nZXRUcmFuc2FjdGlvbigpOw0KICAgICAgICAgICAgaWYgKHRyYW5zICE9\nIG51bGwpDQogICAgICAgICAgICAgICAgdHJhbnMucm9sbGJhY2soKTsNCiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkNCiAgICAgICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwg\na2UpOw0KICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNl\nRW5hYmxlZCgpKQ0KICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoImVuZC10cmFucy1lcnJvciIpLCBlKTsNCiAgICAgICAgICAgIHRocm93\nIG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsN\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgcHVibGljIGJvb2xlYW4gc3luY1dpdGhNYW5hZ2VkVHJhbnNh\nY3Rpb24oKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgbG9j\naygpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX0FDVElWRSkgIT0gMCkNCiAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsNCiAgICAgICAgICAgIGlmICghX21hbmFnZWQpDQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdl\ndCgidHJhbnMtbm90LW1hbmFnZWQiKSk7DQogICAgICAgICAgICBpZiAoX2Zh\nY3Rvcnkuc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24odGhpcywgZmFsc2Up\nKSB7DQogICAgICAgICAgICAgICAgYmVnaW5JbnRlcm5hbCgpOw0KICAgICAg\nICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAg\nICAgICAgICAgdW5sb2NrKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBw\ndWJsaWMgdm9pZCBjb21taXRBbmRSZXN1bWUoKSB7DQogICAgICAgIGVuZEFu\nZFJlc3VtZSh0cnVlKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCByb2xs\nYmFja0FuZFJlc3VtZSgpIHsNCiAgICAgICAgZW5kQW5kUmVzdW1lKGZhbHNl\nKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHZvaWQgZW5kQW5kUmVzdW1lKGJv\nb2xlYW4gY29tbWl0KSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNl\nKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChjb21taXQpDQog\nICAgICAgICAgICAgICAgY29tbWl0KCk7DQogICAgICAgICAgICBlbHNlDQog\nICAgICAgICAgICAgICAgcm9sbGJhY2soKTsNCiAgICAgICAgICAgIGJlZ2lu\nKCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBib29s\nZWFuIGdldFJvbGxiYWNrT25seSgpIHsNCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQ0KICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsNCg0KICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rpb24u\nVHJhbnNhY3Rpb24gdHJhbnMgPQ0KICAgICAgICAgICAgICAgIF9ydW50aW1l\nLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7DQog\nICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVsbCkNCiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICByZXR1cm4gdHJhbnMuZ2V0\nU3RhdHVzKCkgPT0gU3RhdHVzLlNUQVRVU19NQVJLRURfUk9MTEJBQ0s7DQog\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAg\nICAgICAgIHRocm93IGtlOw0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\nZSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBUaHJv\nd2FibGUgZ2V0Um9sbGJhY2tDYXVzZSgpIHsNCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQ0KICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOw0KDQogICAgICAgICAgICBqYXZheC50cmFuc2FjdGlv\nbi5UcmFuc2FjdGlvbiB0cmFucyA9DQogICAgICAgICAgICAgICAgX3J1bnRp\nbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsN\nCiAgICAgICAgICAgIGlmICh0cmFucyA9PSBudWxsKQ0KICAgICAgICAgICAg\nICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgaWYgKHRyYW5zLmdldFN0\nYXR1cygpID09IFN0YXR1cy5TVEFUVVNfTUFSS0VEX1JPTExCQUNLKQ0KICAg\nICAgICAgICAgICAgIHJldHVybiBfcnVudGltZS5nZXRSb2xsYmFja0NhdXNl\nKCk7DQoNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJv\ndyBrZTsNCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsNCiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOw0KICAgICAg\nICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQog\nICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRSb2xsYmFj\na09ubHkoKSB7DQogICAgICAgIHNldFJvbGxiYWNrT25seShuZXcgVXNlckV4\nY2VwdGlvbigpKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRSb2xs\nYmFja09ubHkoVGhyb3dhYmxlIGNhdXNlKSB7DQogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXNz\nZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKTsNCiAgICAgICAgICAgIHNldFJv\nbGxiYWNrT25seUludGVybmFsKGNhdXNlKTsNCiAgICAgICAgfSBmaW5hbGx5\nIHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQog\nICAgfQ0KDQogICAgLyoqDQogICAgICogTWFyayB0aGUgY3VycmVudCB0cmFu\nc2FjdGlvbiBhcyByb2xsYmFjay1vbmx5Lg0KICAgICAqLw0KICAgIHByaXZh\ndGUgdm9pZCBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChUaHJvd2FibGUgY2F1\nc2UpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGphdmF4LnRyYW5z\nYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0NCiAgICAgICAgICAgICAgICBf\ncnVudGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRUcmFuc2FjdGlv\nbigpOw0KICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwpDQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9j\nLmdldCgibnVsbC10cmFucyIpKTsNCiAgICAgICAgICAgIC8vIGVuc3VyZSB0\ncmFuIGlzIGluIGEgdmFsaWQgc3RhdGUgdG8gYWNjZXB0IHRoZSBzZXRSb2xs\nYmFja09ubHkNCiAgICAgICAgICAgIGludCB0cmFuU3RhdHVzID0gdHJhbnMu\nZ2V0U3RhdHVzKCk7DQogICAgICAgICAgICBpZiAoKHRyYW5TdGF0dXMgIT0g\nU3RhdHVzLlNUQVRVU19OT19UUkFOU0FDVElPTikNCiAgICAgICAgICAgICAg\nICAgICAgJiYgKHRyYW5TdGF0dXMgIT0gU3RhdHVzLlNUQVRVU19ST0xMRURC\nQUNLKQ0KICAgICAgICAgICAgICAgICAgICAmJiAodHJhblN0YXR1cyAhPSBT\ndGF0dXMuU1RBVFVTX0NPTU1JVFRFRCkpDQogICAgICAgICAgICAgICAgX3J1\nbnRpbWUuc2V0Um9sbGJhY2tPbmx5KGNhdXNlKTsNCiAgICAgICAgICAgIGVs\nc2UgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkNCiAgICAgICAgICAgICAg\nICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJpbnZhbGlkLXRyYW4tc3RhdHVzIiwg\nbmV3IEludGVnZXIoDQogICAgICAgICAgICAgICAgICAgICAgICB0cmFuU3Rh\ndHVzKSwgInNldFJvbGxiYWNrT25seSIpKTsNCiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAgICAgdGhyb3cga2U7\nDQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAg\nICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsNCiAgICAgICAgfQ0K\nICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldFNhdmVwb2ludChTdHJpbmcg\nbmFtZSkgew0KICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsNCiAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9u\nKCk7DQogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMgIT0gbnVsbCAmJiBf\nc2F2ZXBvaW50cy5jb250YWluc0tleShuYW1lKSkNCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgic2F2ZXBvaW50\nLWV4aXN0cyIsIG5hbWUpKTsNCg0KICAgICAgICAgICAgaWYgKGhhc0ZsdXNo\nZWQoKSAmJiAhX3NwbS5zdXBwb3J0c0luY3JlbWVudGFsRmx1c2goKSkNCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24o\nX2xvYy5nZXQNCiAgICAgICAgICAgICAgICAgICAgKCJzYXZlcG9pbnQtZmx1\nc2gtbm90LXN1cHBvcnRlZCIpKTsNCg0KICAgICAgICAgICAgT3BlbkpQQVNh\ndmVwb2ludCBzYXZlID0gX3NwbS5uZXdTYXZlcG9pbnQobmFtZSwgdGhpcyk7\nDQogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMgPT0gbnVsbCB8fCBfc2F2\nZXBvaW50cy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICBzYXZlLnNh\ndmUoZ2V0VHJhbnNhY3Rpb25hbFN0YXRlcygpKTsNCiAgICAgICAgICAgICAg\nICBfc2F2ZXBvaW50cyA9IG5ldyBMaW5rZWRNYXAoKTsNCiAgICAgICAgICAg\nIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRDYWNo\nZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBzYXZlLnNhdmUoQ29s\nbGVjdGlvbnMuRU1QVFlfTElTVCk7DQogICAgICAgICAgICAgICAgZWxzZSB7\nDQogICAgICAgICAgICAgICAgICAgIHNhdmUuc2F2ZShfc2F2ZXBvaW50Q2Fj\naGUpOw0KICAgICAgICAgICAgICAgICAgICBfc2F2ZXBvaW50Q2FjaGUuY2xl\nYXIoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAg\nICAgICAgICBfc2F2ZXBvaW50cy5wdXQobmFtZSwgc2F2ZSk7DQogICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAg\nIHRocm93IGtlOw0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgew0K\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7DQog\nICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHJlbGVh\nc2VTYXZlcG9pbnQoKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNl\nKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50\ncyA9PSBudWxsIHx8IF9zYXZlcG9pbnRzLmlzRW1wdHkoKSkNCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8t\nbGFzdHNhdmVwb2ludCIpKTsNCiAgICAgICAgICAgIHJlbGVhc2VTYXZlcG9p\nbnQoKFN0cmluZykgX3NhdmVwb2ludHMuZ2V0DQogICAgICAgICAgICAgICAg\nKF9zYXZlcG9pbnRzLnNpemUoKSAtIDEpKTsNCiAgICAgICAgfSBmaW5hbGx5\nIHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQog\nICAgfQ0KDQogICAgcHVibGljIHZvaWQgcmVsZWFzZVNhdmVwb2ludChTdHJp\nbmcgc2F2ZXBvaW50KSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNl\nKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRy\nYW5zYWN0aW9uKCk7DQoNCiAgICAgICAgICAgIGludCBpbmRleCA9IChfc2F2\nZXBvaW50cyA9PSBudWxsKSA/IC0xDQogICAgICAgICAgICAgICAgOiBfc2F2\nZXBvaW50cy5pbmRleE9mKHNhdmVwb2ludCk7DQogICAgICAgICAgICBpZiAo\naW5kZXggPCAwKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1zYXZlcG9pbnQiLCBzYXZlcG9pbnQpKTsN\nCg0KICAgICAgICAgICAgLy8gY2xlYXIgb2xkIGluIHJldmVyc2UNCiAgICAg\nICAgICAgIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZTsNCiAgICAgICAgICAgIHdo\naWxlIChfc2F2ZXBvaW50cy5zaXplKCkgPiBpbmRleCArIDEpIHsNCiAgICAg\nICAgICAgICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9p\nbnRzLnJlbW92ZQ0KICAgICAgICAgICAgICAgICAgICAoX3NhdmVwb2ludHMu\nc2l6ZSgpIC0gMSk7DQogICAgICAgICAgICAgICAgc2F2ZS5yZWxlYXNlKGZh\nbHNlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc2F2ZSA9IChP\ncGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoaW5kZXgpOw0K\nICAgICAgICAgICAgc2F2ZS5yZWxlYXNlKHRydWUpOw0KICAgICAgICAgICAg\naWYgKF9zYXZlcG9pbnRDYWNoZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAg\nIF9zYXZlcG9pbnRDYWNoZS5jbGVhcigpOw0KICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJvdyBrZTsN\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOw0KICAgICAgICB9IGZp\nbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAg\nIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCByb2xsYmFja1RvU2F2ZXBv\naW50KCkgew0KICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAg\nICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMgPT0gbnVs\nbCB8fCBfc2F2ZXBvaW50cy5pc0VtcHR5KCkpDQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWxhc3RzYXZl\ncG9pbnQiKSk7DQogICAgICAgICAgICByb2xsYmFja1RvU2F2ZXBvaW50KChT\ndHJpbmcpIF9zYXZlcG9pbnRzLmdldA0KICAgICAgICAgICAgICAgIChfc2F2\nZXBvaW50cy5zaXplKCkgLSAxKSk7DQogICAgICAgIH0gZmluYWxseSB7DQog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrVG9TYXZlcG9pbnQoU3RyaW5n\nIHNhdmVwb2ludCkgew0KICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7\nDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFu\nc2FjdGlvbigpOw0KDQogICAgICAgICAgICBpbnQgaW5kZXggPSAoX3NhdmVw\nb2ludHMgPT0gbnVsbCkgPyAtMQ0KICAgICAgICAgICAgICAgIDogX3NhdmVw\nb2ludHMuaW5kZXhPZihzYXZlcG9pbnQpOw0KICAgICAgICAgICAgaWYgKGlu\nZGV4IDwgMCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tc2F2ZXBvaW50Iiwgc2F2ZXBvaW50KSk7DQoN\nCiAgICAgICAgICAgIC8vIGNsZWFyIG9sZCBpbiByZXZlcnNlDQogICAgICAg\nICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7DQogICAgICAgICAgICB3aGls\nZSAoX3NhdmVwb2ludHMuc2l6ZSgpID4gaW5kZXggKyAxKSB7DQogICAgICAg\nICAgICAgICAgc2F2ZSA9IChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50\ncy5yZW1vdmUNCiAgICAgICAgICAgICAgICAgICAgKF9zYXZlcG9pbnRzLnNp\nemUoKSAtIDEpOw0KICAgICAgICAgICAgICAgIHNhdmUucmVsZWFzZShmYWxz\nZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHNhdmUgPSAoT3Bl\nbkpQQVNhdmVwb2ludCkgX3NhdmVwb2ludHMucmVtb3ZlKGluZGV4KTsNCiAg\nICAgICAgICAgIENvbGxlY3Rpb24gc2F2ZWQgPSBzYXZlLnJvbGxiYWNrKF9z\nYXZlcG9pbnRzLnZhbHVlcygpKTsNCiAgICAgICAgICAgIGlmIChfc2F2ZXBv\naW50Q2FjaGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICBfc2F2ZXBvaW50\nQ2FjaGUuY2xlYXIoKTsNCiAgICAgICAgICAgIGlmIChoYXNUcmFuc2FjdGlv\nbmFsT2JqZWN0cygpKSB7DQogICAgICAgICAgICAgICAgLy8gYnVpbGQgdXAg\nYSBuZXcgY29sbGVjdGlvbiBvZiBzdGF0ZXMNCiAgICAgICAgICAgICAgICBU\ncmFuc2FjdGlvbmFsQ2FjaGUgb2xkVHJhbnNDYWNoZSA9IF90cmFuc0NhY2hl\nOw0KICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uYWxDYWNoZSBuZXdUcmFu\nc0NhY2hlID0gbmV3IFRyYW5zYWN0aW9uYWxDYWNoZQ0KICAgICAgICAgICAg\nICAgICAgICAoX29yZGVyRGlydHkpOw0KICAgICAgICAgICAgICAgIF90cmFu\nc0NhY2hlID0gbnVsbDsNCg0KICAgICAgICAgICAgICAgIC8vIGN1cnJlbnRs\neSB0aGVyZSBpcyB0aGUgYXNzdW1wdGlvbiB0aGF0IGluY3JlbWVudGFsDQog\nICAgICAgICAgICAgICAgLy8gZmx1c2ggaXMgZWl0aGVyIGEpIG5vdCBhbGxv\nd2VkLCBvciBiKSByZXF1aXJlZA0KICAgICAgICAgICAgICAgIC8vIHByZS1z\nYXZlcG9pbnQuICB0aGlzIHNvbHZlcyBhIG51bWJlciBvZiBpc3N1ZXMgaW5j\nbHVkaW5nDQogICAgICAgICAgICAgICAgLy8gc3RvcmluZyBmbHVzaGVkIHN0\nYXRlcyBhcyB3ZWxsIGFzIE9JRCBoYW5kbGluZy4NCiAgICAgICAgICAgICAg\nICAvLyBpZiBmdXR1cmUgcGx1Z2lucyBkbyBub3QgZm9sbG93IHRoaXMsIHdl\nIG5lZWQgdG8gY2FjaGUNCiAgICAgICAgICAgICAgICAvLyBtb3JlIGluZm8g\ncGVyIHN0YXRlDQogICAgICAgICAgICAgICAgU2F2ZXBvaW50RmllbGRNYW5h\nZ2VyIGZtOw0KICAgICAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207\nDQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzYXZlZC5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0KICAgICAgICAgICAgICAg\nICAgICBmbSA9IChTYXZlcG9pbnRGaWVsZE1hbmFnZXIpIGl0ci5uZXh0KCk7\nDQogICAgICAgICAgICAgICAgICAgIHNtID0gZm0uZ2V0U3RhdGVNYW5hZ2Vy\nKCk7DQogICAgICAgICAgICAgICAgICAgIHNtLnJvbGxiYWNrVG9TYXZlcG9p\nbnQoZm0pOw0KICAgICAgICAgICAgICAgICAgICBvbGRUcmFuc0NhY2hlLnJl\nbW92ZShzbSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChzbS5pc0RpcnR5\nKCkpDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdUcmFuc0NhY2hlLmFk\nZERpcnR5KHNtKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3VHJhbnNDYWNoZS5hZGRDbGVhbihzbSk7\nDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gb2xkVHJhbnNDYWNoZS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgew0KICAgICAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1h\nbmFnZXJJbXBsKSBpdHIubmV4dCgpOw0KICAgICAgICAgICAgICAgICAgICBz\nbS5yb2xsYmFjaygpOw0KICAgICAgICAgICAgICAgICAgICByZW1vdmVGcm9t\nVHJhbnNhY3Rpb24oc20pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAg\nICAgICAgICBfdHJhbnNDYWNoZSA9IG5ld1RyYW5zQ2FjaGU7DQogICAgICAg\nICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsNCiAgICAgICAgICAgIHRocm93IGtlOw0KICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24oZSk7DQogICAgICAgIH0gZmluYWxseSB7DQog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIHB1YmxpYyB2b2lkIGZsdXNoKCkgew0KICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIC8v\nIHJldHVybiBzaWxlbnRseSBpZiBubyB0cmFucyBpcyBhY3RpdmUsIG9yIGlm\nIHRoaXMgaXMgYSByZWVudHJhbnQNCiAgICAgICAgICAgIC8vIGNhbGwsIHdo\naWNoIGNhbiBoYXBwZW4gaWYgdGhlIHN0b3JlIG1hbmFnZXIgdHJpZXMgdG8g\nZ2V0IGFuDQogICAgICAgICAgICAvLyBhdXRvLWluYyBvaWQgZHVyaW5nIGZs\ndXNoDQogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9\nPSAwDQogICAgICAgICAgICAgICAgfHwgKF9mbGFncyAmIEZMQUdfU1RPUkVf\nRkxVU0hJTkcpICE9IDApDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KDQog\nICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHJ1bnRpbWUgc3VwcG9ydHMg\naXQNCiAgICAgICAgICAgIGlmICghX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygp\nLmNvbnRhaW5zKF9jb25mLk9QVElPTl9JTkNfRkxVU0gpKQ0KICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdl\ndA0KICAgICAgICAgICAgICAgICAgICAoImluY3JlbWVudGFsLWZsdXNoLW5v\ndC1zdXBwb3J0ZWQiKSk7DQogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMg\nIT0gbnVsbCAmJiAhX3NhdmVwb2ludHMuaXNFbXB0eSgpDQogICAgICAgICAg\nICAgICAgJiYgIV9zcG0uc3VwcG9ydHNJbmNyZW1lbnRhbEZsdXNoKCkpDQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9u\nKF9sb2MuZ2V0DQogICAgICAgICAgICAgICAgICAgICgic2F2ZXBvaW50LWZs\ndXNoLW5vdC1zdXBwb3J0ZWQiKSk7DQoNCiAgICAgICAgICAgIHRyeSB7DQog\nICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZMVVNIX0lOQyk7DQogICAgICAg\nICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hFRDsNCiAgICAgICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAg\nICAgICAvLyByb2xsYmFjayBvbiBmbHVzaCBlcnJvcjsgb2JqZWN0cyBtYXkg\nYmUgaW4gaW5jb25zaXN0ZW50IHN0YXRlDQogICAgICAgICAgICAgICAgc2V0\nUm9sbGJhY2tPbmx5KGtlKTsNCiAgICAgICAgICAgICAgICB0aHJvdyBrZS5z\nZXRGYXRhbCh0cnVlKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgICAgICAvLyByb2xsYmFjayBv\nbiBmbHVzaCBlcnJvcjsgb2JqZWN0cyBtYXkgYmUgaW4gaW5jb25zaXN0ZW50\nIHN0YXRlDQogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5KHJlKTsN\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24ocmUp\nLnNldEZhdGFsKHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQog\nICAgICAgIGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nDQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBwcmVGbHVz\naCgpIHsNCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQogICAgICAg\nIHRyeSB7DQogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZF\nKSAhPSAwKQ0KICAgICAgICAgICAgICAgIGZsdXNoU2FmZShGTFVTSF9MT0dJ\nQ0FMKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHZv\naWQgdmFsaWRhdGVDaGFuZ2VzKCkgew0KICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIC8vIGlmIG5v\nIHRyYW5zLCBqdXN0IHJldHVybjsgaWYgYWN0aXZlIGRhdGFzdG9yZSB0cmFu\ncywgZmx1c2gNCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpID09IDApDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JFX0FDVElWRSkgIT0gMCkgew0K\nICAgICAgICAgICAgICAgIGZsdXNoKCk7DQogICAgICAgICAgICAgICAgcmV0\ndXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhlIHJ1bnRpbWUgc3VwcG9ydHMgaW5jIGZsdXNoDQogICAgICAgICAg\nICBpZiAoIV9jb25mLnN1cHBvcnRlZE9wdGlvbnMoKS5jb250YWlucyhfY29u\nZi5PUFRJT05fSU5DX0ZMVVNIKSkNCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQNCiAgICAgICAgICAg\nICAgICAgICAgKCJpbmNyZW1lbnRhbC1mbHVzaC1ub3Qtc3VwcG9ydGVkIikp\nOw0KDQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGZsdXNo\nU2FmZShGTFVTSF9ST0xMQkFDSyk7DQogICAgICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICAgICAgdGhyb3cg\na2U7DQogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9u\nKHJlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmaW5h\nbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9\nDQogICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gaXNBY3RpdmUoKSB7DQog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0K\nICAgICAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0g\nMDsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIGJvb2xl\nYW4gaXNTdG9yZUFjdGl2ZSgpIHsNCiAgICAgICAgLy8gd2UgbmVlZCB0byBs\nb2NrIGhlcmUsIGJlY2F1c2Ugd2UgbWlnaHQgYmUgaW4gdGhlIG1pZGRsZSBv\nZiBhbg0KICAgICAgICAvLyBhdG9taWMgdHJhbnNhY3Rpb24gcHJvY2VzcyAo\nZS5nLiwgY29tbWl0QW5kUmVzdW1lKQ0KICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHJldHVybiAo\nX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpICE9IDA7DQogICAgICAgIH0g\nZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAg\nICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uIGlzIGVuZGluZywgaS5lLiBpbiB0\naGUgMm5kIHBoYXNlDQogICAgICogb2YgYSBjb21taXQgb3Igcm9sbGJhY2sN\nCiAgICAgKi8NCiAgICBib29sZWFuIGlzVHJhbnNhY3Rpb25FbmRpbmcoKSB7\nDQogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19UUkFOU19FTkRJTkcp\nICE9IDA7DQogICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gYmVnaW5PcGVy\nYXRpb24oYm9vbGVhbiBzeW5jVHJhbnMpIHsNCiAgICAgICAgbG9jaygpOw0K\nICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0T3BlbigpOw0KDQog\nICAgICAgICAgICBpZiAoc3luY1RyYW5zICYmIF9vcGVyYXRpb25Db3VudCA9\nPSAwICYmIF9zeW5jTWFuYWdlZA0KICAgICAgICAgICAgICAgICYmIChfZmxh\nZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkNCiAgICAgICAgICAgICAgICBzeW5j\nV2l0aE1hbmFnZWRUcmFuc2FjdGlvbigpOw0KICAgICAgICAgICAgcmV0dXJu\nIF9vcGVyYXRpb25Db3VudCsrID09IDE7DQogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgIHVubG9jaygpOw0K\nICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHVubG9jaygpOw0KICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOw0KICAg\nICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogTWFyayB0aGUgb3Bl\ncmF0aW9uIG92ZXIuIElmIG91dGVybW9zdCBjYWxsZXIgb2Ygc3RhY2ssIHJl\ndHVybnMgdHJ1ZQ0KICAgICAqIGFuZCB3aWxsIGRldGFjaCBtYW5hZ2VkIGlu\nc3RhbmNlcyBpZiBuZWNlc3NhcnkuDQogICAgICovDQogICAgcHVibGljIGJv\nb2xlYW4gZW5kT3BlcmF0aW9uKCkgew0KICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgaWYgKF9vcGVyYXRpb25Db3VudCA9PSAxICYmIChfYXV0b0RldGFj\naCAmIERFVEFDSF9OT05UWFJFQUQpICE9IDANCiAgICAgICAgICAgICAgICAm\nJiAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApIHsNCiAgICAgICAgICAg\nICAgICBkZXRhY2hBbGxJbnRlcm5hbChudWxsKTsNCiAgICAgICAgICAgIH0N\nCiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291bnQgPCAxKQ0KICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihfbG9jLmdl\ndCgibXVsdGktdGhyZWFkZWQtYWNjZXNzIikpOw0KICAgICAgICAgICAgcmV0\ndXJuIF9vcGVyYXRpb25Db3VudCA9PSAxOw0KICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJvdyBrZTsN\nCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOw0KICAg\nICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgX29wZXJhdGlvbkNvdW50\nLS07DQogICAgICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50ID09IDApDQog\nICAgICAgICAgICAgICAgaW5pdGlhbGl6ZU9wZXJhdGluZ1NldCgpOw0KICAg\nICAgICAgICAgdW5sb2NrKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBw\ndWJsaWMgU3luY2hyb25pemF0aW9uIGdldFN5bmNocm9uaXphdGlvbigpIHsN\nCiAgICAgICAgcmV0dXJuIF9zeW5jOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2\nb2lkIHNldFN5bmNocm9uaXphdGlvbihTeW5jaHJvbml6YXRpb24gc3luYykg\new0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAgIF9zeW5jID0gc3lu\nYzsNCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLw0KICAgIC8vIEltcGxlbWVudGF0aW9uIG9m\nIFN5bmNocm9uaXphdGlvbiBpbnRlcmZhY2UNCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgcHVi\nbGljIHZvaWQgYmVmb3JlQ29tcGxldGlvbigpIHsNCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nLy8gdXNlci1zdXBwbGllZCBzeW5jaHJvbml6YXRpb24NCiAgICAgICAgICAg\nIGlmIChfc3luYyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIF9zeW5jLmJl\nZm9yZUNvbXBsZXRpb24oKTsNCg0KICAgICAgICAgICAgZmx1c2hTYWZlKEZM\nVVNIX0NPTU1JVCk7DQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsNCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVk\nKCkpDQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5k\nLXRyYW5zLWVycm9yIiksIGtlKTsNCiAgICAgICAgICAgIHRocm93IHRyYW5z\nbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9uKGtlKTsNCiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAg\naWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkNCiAgICAgICAgICAgICAgICBf\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwgcmUpOw0K\nICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlTWFuYWdlZENvbXBsZXRpb25F\neGNlcHRpb24obmV3IFN0b3JlRXhjZXB0aW9uKHJlKSk7DQogICAgICAgIH0g\nZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAg\nICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGFmdGVyQ29tcGxldGlv\nbihpbnQgc3RhdHVzKSB7DQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNl\nKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRy\nYW5zYWN0aW9uKCk7DQoNCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1RS\nQU5TX0VORElORzsNCiAgICAgICAgICAgIGVuZFRyYW5zYWN0aW9uKHN0YXR1\ncyk7DQogICAgICAgICAgICBpZiAoX3N5bmMgIT0gbnVsbCkNCiAgICAgICAg\nICAgICAgICBfc3luYy5hZnRlckNvbXBsZXRpb24oc3RhdHVzKTsNCg0KICAg\nICAgICAgICAgaWYgKChfYXV0b0RldGFjaCAmIERFVEFDSF9DT01NSVQpICE9\nIDApDQogICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwobnVsbCk7\nDQogICAgICAgICAgICBlbHNlIGlmIChzdGF0dXMgPT0gU3RhdHVzLlNUQVRV\nU19ST0xMRURCQUNLIA0KICAgICAgICAgICAgICAgICYmIChfYXV0b0RldGFj\naCAmIERFVEFDSF9ST0xMQkFDSykgIT0gMCkgew0KICAgICAgICAgICAgICAg\nIGRldGFjaEFsbEludGVybmFsKG51bGwpOw0KICAgICAgICAgICAgfQ0KDQog\nICAgICAgICAgICAvLyBpbiBhbiBlZSBjb250ZXh0LCBpdCdzIHBvc3NpYmxl\nIHRoYXQgdGhlIHVzZXIgdHJpZWQgdG8gY2xvc2UNCiAgICAgICAgICAgIC8v\nIHVzIGJ1dCB3ZSBkaWRuJ3QgYWN0dWFsbHkgY2xvc2UgYmVjYXVzZSB3ZSB3\nZXJlIHdhaXRpbmcgb24gdGhpcw0KICAgICAgICAgICAgLy8gdHJhbnNhY3Rp\nb247IGlmIHRoYXQncyB0cnVlLCB0aGVuIGNsb3NlIG5vdw0KICAgICAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX0NMT1NFX0lOVk9LRUQpICE9IDANCiAg\nICAgICAgICAgICAgICAmJiBfY29tcGF0LmdldENsb3NlT25NYW5hZ2VkQ29t\nbWl0KCkpDQogICAgICAgICAgICAgICAgZnJlZSgpOw0KICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICBpZiAo\nX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQ0KICAgICAgICAgICAgICAgIF9sb2cu\ndHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBrZSk7DQogICAg\nICAgICAgICB0aHJvdyB0cmFuc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2Vw\ndGlvbihrZSk7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsNCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkp\nDQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRy\nYW5zLWVycm9yIiksIHJlKTsNCiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0\nZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9uKG5ldyBTdG9yZUV4Y2VwdGlv\nbihyZSkpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgX2Zs\nYWdzICY9IH5GTEFHX0FDVElWRTsNCiAgICAgICAgICAgIF9mbGFncyAmPSB+\nRkxBR19GTFVTSEVEOw0KICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1RS\nQU5TX0VORElORzsNCg0KICAgICAgICAgICAgLy8gZXZlbnQgbWFuYWdlciBu\ndWxsZWQgaWYgZnJlZWQgYnJva2VyDQogICAgICAgICAgICBpZiAoX3RyYW5z\nRXZlbnRNYW5hZ2VyICE9IG51bGwgDQogICAgICAgICAgICAgICAgJiYgX3Ry\nYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVycygpKSB7DQogICAgICAg\nICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9u\nRXZlbnQodGhpcywNCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID09IFN0\nYXR1cy5TVEFUVVNfQ09NTUlUVEVEDQogICAgICAgICAgICAgICAgICAgICAg\nICA/IFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfQ09NTUlUX0NPTVBMRVRFDQog\nICAgICAgICAgICAgICAgICAgICAgICA6IFRyYW5zYWN0aW9uRXZlbnQuQUZU\nRVJfUk9MTEJBQ0tfQ09NUExFVEUsDQogICAgICAgICAgICAgICAgICAgIG51\nbGwsIG51bGwsIG51bGwsIG51bGwpKTsNCiAgICAgICAgICAgIH0NCg0KICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoN\nCiAgICAvKioNCiAgICAgKiBJZiB3ZSdyZSBpbiBhIG1hbmFnZWQgdHJhbnNh\nY3Rpb24sIHVzZSBvdXIgaW1wbGljaXQgYmVoYXZpb3IgZXhjZXB0aW9uDQog\nICAgICogdHJhbnNsYXRvciB0byB0cmFuc2xhdGUgYmVmb3JlL2FmdGVyQ29t\ncGxldGlvbiBjYWxsYmFjayBlcnJvcnMuDQogICAgICovDQogICAgcHJpdmF0\nZSBSdW50aW1lRXhjZXB0aW9uIHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9u\nRXhjZXB0aW9uDQogICAgICAgIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQog\nICAgICAgIHJldHVybiAoIV9tYW5hZ2VkIHx8IF9leHRyYW5zID09IG51bGwp\nID8gcmUgOiBfZXh0cmFucy50cmFuc2xhdGUocmUpOw0KICAgIH0NCg0KICAg\nIC8qKg0KICAgICAqIEZsdXNoIHNhZmVseSwgY2F0Y2hpbmcgcmVlbnRyYW50\nIGNhbGxzLg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9pZCBmbHVzaFNhZmUo\naW50IHJlYXNvbikgew0KICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfRkxV\nU0hJTkcpICE9IDApDQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0\nYXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJyZWVudHJhbnQtZmx1c2giKSk7DQoN\nCiAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hJTkc7DQogICAgICAgIHRy\neSB7DQogICAgICAgICAgICBmbHVzaChyZWFzb24pOw0KICAgICAgICB9IGZp\nbmFsbHkgew0KICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNISU5H\nOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRmx1c2gg\ndGhlIHRyYW5zYWN0aW9uYWwgc3RhdGUgdG8gdGhlIGRhdGEgc3RvcmUuIFN1\nYmNsYXNzZXMgdGhhdA0KICAgICAqIGN1c3RvbWl6ZSBjb21taXQgYmVoYXZp\nb3Igc2hvdWxkIG92ZXJyaWRlIHRoaXMgbWV0aG9kLiBUaGUgbWV0aG9kDQog\nICAgICogYXNzdW1lcyB0aGF0IHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyIGlz\nIGxvY2tlZCwgaXMgbm90IGNsb3NlZCwNCiAgICAgKiBhbmQgaGFzIGFuIGFj\ndGl2ZSB0cmFuc2FjdGlvbi4NCiAgICAgKg0KICAgICAqIEBwYXJhbSByZWFz\nb24gb25lIG9mIHtAbGluayAjRkxVU0hfSU5DfSwge0BsaW5rICNGTFVTSF9D\nT01NSVR9LA0KICAgICAqIHtAbGluayAjRkxVU0hfUk9MTEJBQ0t9LCBvciB7\nQGxpbmsgI0ZMVVNIX0xPR0lDQUx9DQogICAgICogQHNpbmNlIDAuMi41DQog\nICAgICovDQogICAgcHJvdGVjdGVkIHZvaWQgZmx1c2goaW50IHJlYXNvbikg\new0KICAgICAgICAvLyB0aGlzIHdpbGwgZW5saXN0IHByb3hpZWQgc3RhdGVz\nIGFzIG5lY2Vzc2FyeSBzbyB3ZSBrbm93IHdoZXRoZXIgd2UNCiAgICAgICAg\nLy8gaGF2ZSBhbnl0aGluZyB0byBmbHVzaA0KICAgICAgICBDb2xsZWN0aW9u\nIHRyYW5zYWN0aW9uYWwgPSBnZXRUcmFuc2FjdGlvbmFsU3RhdGVzKCk7DQoN\nCiAgICAgICAgLy8gZG8gd2UgYWN0dWFsbHkgaGF2ZSB0byBmbHVzaD8gIG9u\nbHkgaWYgb3VyIGZsYWdzIHNheSBzbywgb3IgaWYNCiAgICAgICAgLy8gd2Ug\naGF2ZSB0cmFuc2FjdGlvbiBsaXN0ZW5lcnMgdGhhdCBuZWVkIHRvIGJlIGlu\ndm9rZWQgZm9yIGNvbW1pdA0KICAgICAgICAvLyAobm8gbmVlZCB0byBpbnZv\na2UgdGhlbSBvbiBpbmMgZmx1c2ggaWYgbm90aGluZyBpcyBkaXJ0eSkuICB3\nZQ0KICAgICAgICAvLyBzcGVjaWFsIGNhc2UgdGhlIHJlbW90ZSBjb21taXQg\nbGlzdGVuZXIgdXNlZCBieSB0aGUgZGF0YWNhY2hlIGNhdXNlDQogICAgICAg\nIC8vIHdlIGtub3cgaXQgZG9lc24ndCByZXF1aXJlIHRoZSBjb21taXQgZXZl\nbnQgd2hlbiBub3RoaW5nIGNoYW5nZXMNCiAgICAgICAgYm9vbGVhbiBmbHVz\naCA9IChfZmxhZ3MgJiBGTEFHX0ZMVVNIX1JFUVVJUkVEKSAhPSAwOw0KICAg\nICAgICBib29sZWFuIGxpc3RlbmVycyA9IChfdHJhbnNFdmVudE1hbmFnZXIu\naGFzRmx1c2hMaXN0ZW5lcnMoKQ0KICAgICAgICAgICAgfHwgX3RyYW5zRXZl\nbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVycygpKQ0KICAgICAgICAgICAgJiYg\nKChfZmxhZ3MgJiBGTEFHX1JFTU9URV9MSVNURU5FUikgPT0gMA0KICAgICAg\nICAgICAgfHwgX3RyYW5zRXZlbnRNYW5hZ2VyLmdldExpc3RlbmVycygpLnNp\nemUoKSA+IDEpOw0KICAgICAgICBpZiAoIWZsdXNoICYmIChyZWFzb24gIT0g\nRkxVU0hfQ09NTUlUIHx8ICFsaXN0ZW5lcnMpKQ0KICAgICAgICAgICAgcmV0\ndXJuOw0KDQogICAgICAgIENvbGxlY3Rpb24gbW9ianMgPSBudWxsOw0KICAg\nICAgICBfZmxhZ3MgfD0gRkxBR19QUkVTVE9SSU5HOw0KICAgICAgICB0cnkg\new0KICAgICAgICAgICAgaWYgKGZsdXNoKSB7DQogICAgICAgICAgICAgICAg\nLy8gY2FsbCBwcmUgc3RvcmUgb24gYWxsIGN1cnJlbnRseSB0cmFuc2FjdGlv\nbmFsIG9ianMNCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIHRyYW5zYWN0aW9uYWwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspDQog\nICAgICAgICAgICAgICAgICAgICgoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5l\neHQoKSkuYmVmb3JlRmx1c2gocmVhc29uLCBfY2FsbCk7DQogICAgICAgICAg\nICAgICAgZmx1c2hBZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsN\nCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gaG9wZWZ1bGx5IG5v\ndyBhbGwgZGVwZW5kZW50IGluc3RhbmNlcyB0aGF0IGFyZSBnb2luZyB0byBl\nbmQNCiAgICAgICAgICAgIC8vIHVwIHJlZmVyZW5jZWQgaGF2ZSBiZWVuIG1h\ncmtlZCBhcyBzdWNoOyBkZWxldGUgdW5yZWZlZA0KICAgICAgICAgICAgLy8g\nZGVwZW5kZW50cw0KICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfREVSRUZE\nRUxFVElORzsNCiAgICAgICAgICAgIGlmIChmbHVzaCAmJiBfZGVyZWZDYWNo\nZSAhPSBudWxsICYmICFfZGVyZWZDYWNoZS5pc0VtcHR5KCkpIHsNCiAgICAg\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9kZXJlZkNhY2hlLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQ0KICAgICAgICAgICAgICAgICAg\nICBkZWxldGVEZXJlZigoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKSk7\nDQogICAgICAgICAgICAgICAgZmx1c2hBZGRpdGlvbnModHJhbnNhY3Rpb25h\nbCwgcmVhc29uKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYg\nKHJlYXNvbiAhPSBGTFVTSF9MT0dJQ0FMKSB7DQogICAgICAgICAgICAgICAg\nLy8gaWYgbm8gZGF0YXN0b3JlIHRyYW5zYWN0aW9uLCBzdGFydCBvbmU7IGV2\nZW4gaWYgd2UgZG9uJ3QNCiAgICAgICAgICAgICAgICAvLyB0aGluayB3ZSds\nbCBuZWVkIHRvIGZsdXNoIGF0IHRoaXMgcG9pbnQsIG91ciB0cmFuc2FjdGlv\nbg0KICAgICAgICAgICAgICAgIC8vIGxpc3RlbmVycyBtaWdodCBpbnRyb2R1\nY2Ugc29tZSBkaXJ0eSBvYmplY3RzIG9yIGludGVyYWN0DQogICAgICAgICAg\nICAgICAgLy8gZGlyZWN0bHkgd2l0aCB0aGUgZGF0YWJhc2UNCiAgICAgICAg\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSA9PSAw\nKQ0KICAgICAgICAgICAgICAgICAgICBiZWdpblN0b3JlTWFuYWdlclRyYW5z\nYWN0aW9uKGZhbHNlKTsNCg0KICAgICAgICAgICAgICAgIGlmICgoX3RyYW5z\nRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlzdGVuZXJzKCkNCiAgICAgICAgICAg\nICAgICAgICAgfHwgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVy\ncygpKQ0KICAgICAgICAgICAgICAgICAgICAmJiAoZmx1c2ggfHwgcmVhc29u\nID09IEZMVVNIX0NPTU1JVCkpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8g\nZmlyZSBldmVudHMNCiAgICAgICAgICAgICAgICAgICAgbW9ianMgPSBuZXcg\nTWFuYWdlZE9iamVjdENvbGxlY3Rpb24odHJhbnNhY3Rpb25hbCk7DQogICAg\nICAgICAgICAgICAgICAgIGlmIChyZWFzb24gPT0gRkxVU0hfQ09NTUlUDQog\nICAgICAgICAgICAgICAgICAgICAgICAmJiBfdHJhbnNFdmVudE1hbmFnZXIu\naGFzRW5kTGlzdGVuZXJzKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAg\nIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRo\naXMsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9u\nRXZlbnQuQkVGT1JFX0NPTU1JVCwgbW9ianMsDQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgX3BlcnNpc3RlZENsc3MsIF91cGRhdGVkQ2xzcywgX2Rl\nbGV0ZWRDbHNzKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNo\nQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7DQogICAgICAgICAg\nICAgICAgICAgICAgICBmbHVzaCA9IChfZmxhZ3MgJiBGTEFHX0ZMVVNIX1JF\nUVVJUkVEKSAhPSAwOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAg\nICAgICAgICAgICAgICAgaWYgKGZsdXNoICYmIF90cmFuc0V2ZW50TWFuYWdl\nci5oYXNGbHVzaExpc3RlbmVycygpKSB7DQogICAgICAgICAgICAgICAgICAg\nICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVu\ndCh0aGlzLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2Fj\ndGlvbkV2ZW50LkJFRk9SRV9GTFVTSCwgbW9ianMsDQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgX3BlcnNpc3RlZENsc3MsIF91cGRhdGVkQ2xzcywg\nX2RlbGV0ZWRDbHNzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBmbHVz\naEFkZGl0aW9ucyh0cmFuc2FjdGlvbmFsLCByZWFzb24pOw0KICAgICAgICAg\nICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAg\nfQ0KICAgICAgICB9DQogICAgICAgIGZpbmFsbHkgew0KICAgICAgICAgICAg\nX2ZsYWdzICY9IH5GTEFHX1BSRVNUT1JJTkc7DQogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkZMQUdfREVSRUZERUxFVElORzsNCiAgICAgICAgICAgIF90cmFu\nc0FkZGl0aW9ucyA9IG51bGw7DQogICAgICAgICAgICBfZGVyZWZBZGRpdGlv\nbnMgPSBudWxsOw0KDQogICAgICAgICAgICAvLyBhbHNvIGNsZWFyIGRlcmVm\nZWQgc2V0OyB0aGUgZGVsZXRlcyBoYXZlIGJlZW4gcmVjb3JkZWQNCiAgICAg\nICAgICAgIGlmIChfZGVyZWZDYWNoZSAhPSBudWxsKQ0KICAgICAgICAgICAg\nICAgIF9kZXJlZkNhY2hlID0gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAg\nIC8vIGZsdXNoIHRvIHN0b3JlIG1hbmFnZXINCiAgICAgICAgTGlzdCBleGNl\ncHMgPSBudWxsOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKGZs\ndXNoICYmIHJlYXNvbiAhPSBGTFVTSF9MT0dJQ0FMKSB7DQogICAgICAgICAg\nICAgICAgX2ZsYWdzIHw9IEZMQUdfU1RPUkVfRkxVU0hJTkc7DQogICAgICAg\nICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywNCiAgICAgICAgICAgICAg\nICAgICAgbmV3Rmx1c2hFeGNlcHRpb24oX3N0b3JlLmZsdXNoKHRyYW5zYWN0\naW9uYWwpKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZmluYWxseSB7\nDQogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfU1RPUkVfRkxVU0hJTkc7\nDQoNCiAgICAgICAgICAgIGlmIChyZWFzb24gPT0gRkxVU0hfUk9MTEJBQ0sp\nDQogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgZW5kU3Rv\ncmVNYW5hZ2VyVHJhbnNhY3Rpb24odHJ1ZSkpOw0KICAgICAgICAgICAgZWxz\nZSBpZiAocmVhc29uICE9IEZMVVNIX0xPR0lDQUwpDQogICAgICAgICAgICAg\nICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIX1JFUVVJUkVEOw0KDQogICAgICAg\nICAgICAvLyBtYXJrIHN0YXRlcyBhcyBmbHVzaGVkDQogICAgICAgICAgICBp\nZiAoZmx1c2gpIHsNCiAgICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtOw0KICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdHJh\nbnNhY3Rpb25hbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0KICAg\nICAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIu\nbmV4dCgpOw0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gdGhlIHN0YXRlIG1heSBoYXZlIGJlY29tZSB0\ncmFuc2llbnQsIHN1Y2ggYXMgaWYNCiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGl0IGlzIGVtYmVkZGVkIGFuZCB0aGUgb3duZXIgaGFzIGJlZW4gZGVs\nZXRlZCBkdXJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMg\nZmx1c2ggcHJvY2VzczsgYnVnICMxMTAwDQogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuVFJBTlNJRU5U\nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KDQog\nICAgICAgICAgICAgICAgICAgICAgICBzbS5hZnRlckZsdXNoKHJlYXNvbik7\nDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVhc29uID09IEZMVVNI\nX0lOQykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIG5v\ndCBhYm91dCB0byBjbGVhciB0cmFucyBjYWNoZSBmb3IgY29tbWl0IA0KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFueXdheSwgcmUtY2FjaGUg\nZGlydHkgb2JqZWN0cyB3aXRoIGRlZmF1bHQgc29mdA0KICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIHJlZnM7IHdlIGRvbid0IG5lZWQgaGFyZCBy\nZWZzIG5vdyB0aGF0IHRoZSANCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAvLyBjaGFuZ2VzIGhhdmUgYmVlbiBmbHVzaGVkDQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgc20ucHJveHlGaWVsZHModHJ1ZSwgZmFsc2UpOw0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlLmZsdXNo\nZWQoc20pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAg\nICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgew0KICAgICAgICAg\nICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgZSk7DQogICAg\nICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAg\nICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyB0aHJvdyBhbnkgZXhj\nZXB0aW9ucyB0byBzaG9ydGN1dCBsaXN0ZW5lcnMgb24gZmFpbA0KICAgICAg\nICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCB0cnVlKTsNCg0KICAg\nICAgICBpZiAoZmx1c2ggJiYgcmVhc29uICE9IEZMVVNIX1JPTExCQUNLICYm\nIHJlYXNvbiAhPSBGTFVTSF9MT0dJQ0FMDQogICAgICAgICAgICAmJiBfdHJh\nbnNFdmVudE1hbmFnZXIuaGFzRmx1c2hMaXN0ZW5lcnMoKSkgew0KICAgICAg\nICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZl\nbnQodGhpcywNCiAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkFG\nVEVSX0ZMVVNILCBtb2JqcywgX3BlcnNpc3RlZENsc3MsDQogICAgICAgICAg\nICAgICAgX3VwZGF0ZWRDbHNzLCBfZGVsZXRlZENsc3MpKTsNCiAgICAgICAg\nfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZsdXNoIG5ld2x5LXRyYW5z\nYWN0aW9uYWwgb2JqZWN0cy4NCiAgICAgKi8NCiAgICBwcml2YXRlIHZvaWQg\nZmx1c2hBZGRpdGlvbnMoQ29sbGVjdGlvbiB0cmFuc2FjdGlvbmFsLCBpbnQg\ncmVhc29uKSB7DQogICAgICAgIGJvb2xlYW4gbG9vcDsNCiAgICAgICAgZG8g\new0KICAgICAgICAgICAgLy8gZmx1c2ggbmV3IHRyYW5zYWN0aW9uYWwgaW5z\ndGFuY2VzOyBub3RlIGxvZ2ljYWwgb3INCiAgICAgICAgICAgIGxvb3AgPSBm\nbHVzaFRyYW5zQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbikNCiAg\nICAgICAgICAgICAgICB8IGRlbGV0ZURlcmVmQWRkaXRpb25zKF9kZXJlZkNh\nY2hlKTsNCiAgICAgICAgfSB3aGlsZSAobG9vcCk7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogRmx1c2ggdHJhbnNhY3Rpb25hbCBhZGRpdGlvbnMuDQog\nICAgICovDQogICAgcHJpdmF0ZSBib29sZWFuIGZsdXNoVHJhbnNBZGRpdGlv\nbnMoQ29sbGVjdGlvbiB0cmFuc2FjdGlvbmFsLCBpbnQgcmVhc29uKSB7DQog\nICAgICAgIGlmIChfdHJhbnNBZGRpdGlvbnMgPT0gbnVsbCB8fCBfdHJhbnNB\nZGRpdGlvbnMuaXNFbXB0eSgpKQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOw0KDQogICAgICAgIC8vIGtlZXAgbG9jYWwgdHJhbnNhY3Rpb25hbCBsaXN0\nIGNvcHkgdXAgdG8gZGF0ZQ0KICAgICAgICB0cmFuc2FjdGlvbmFsLmFkZEFs\nbChfdHJhbnNBZGRpdGlvbnMpOw0KDQogICAgICAgIC8vIGNvcHkgdGhlIGNo\nYW5nZSBzZXQsIHRoZW4gY2xlYXIgaXQgZm9yIHRoZSBuZXh0IGl0ZXJhdGlv\nbg0KICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsW10gc3RhdGVzID0gKFN0YXRl\nTWFuYWdlckltcGxbXSkgX3RyYW5zQWRkaXRpb25zLg0KICAgICAgICAgICAg\ndG9BcnJheShuZXcgU3RhdGVNYW5hZ2VySW1wbFtfdHJhbnNBZGRpdGlvbnMu\nc2l6ZSgpXSk7DQogICAgICAgIF90cmFuc0FkZGl0aW9ucyA9IG51bGw7DQoN\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdGF0ZXMubGVuZ3RoOyBp\nKyspDQogICAgICAgICAgICBzdGF0ZXNbaV0uYmVmb3JlRmx1c2gocmVhc29u\nLCBfY2FsbCk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAg\nIC8qKg0KICAgICAqIERlbGV0ZSBuZXcgZGVyZWZlcmVuY2VkIG9iamVjdHMu\nDQogICAgICovDQogICAgcHJpdmF0ZSBib29sZWFuIGRlbGV0ZURlcmVmQWRk\naXRpb25zKENvbGxlY3Rpb24gZGVyZWZzKSB7DQogICAgICAgIGlmIChfZGVy\nZWZBZGRpdGlvbnMgPT0gbnVsbCB8fCBfZGVyZWZBZGRpdGlvbnMuaXNFbXB0\neSgpKQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgIC8v\nIHJlbWVtYmVyIHRoZXNlIGFkZGl0aW9ucyBpbiBjYXNlIG9uZSBiZWNvbWVz\nIGRlcmVmZWQgYWdhaW4gbGF0ZXINCiAgICAgICAgZGVyZWZzLmFkZEFsbChf\nZGVyZWZBZGRpdGlvbnMpOw0KDQogICAgICAgIFN0YXRlTWFuYWdlckltcGxb\nXSBzdGF0ZXMgPSAoU3RhdGVNYW5hZ2VySW1wbFtdKSBfZGVyZWZBZGRpdGlv\nbnMuDQogICAgICAgICAgICB0b0FycmF5KG5ldyBTdGF0ZU1hbmFnZXJJbXBs\nW19kZXJlZkFkZGl0aW9ucy5zaXplKCldKTsNCiAgICAgICAgX2RlcmVmQWRk\naXRpb25zID0gbnVsbDsNCg0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHN0YXRlcy5sZW5ndGg7IGkrKykNCiAgICAgICAgICAgIGRlbGV0ZURlcmVm\nKHN0YXRlc1tpXSk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0K\nICAgIC8qKg0KICAgICAqIERlbGV0ZSBhIGRlcmVmZXJlbmNlZCBkZXBlbmRl\nbnQuDQogICAgICovDQogICAgcHJpdmF0ZSB2b2lkIGRlbGV0ZURlcmVmKFN0\nYXRlTWFuYWdlckltcGwgc20pIHsNCiAgICAgICAgaW50IGFjdGlvbiA9IHBy\nb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9ERUxFVEUsDQogICAgICAg\nICAgICBzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgc20sIG51bGwpOw0KICAg\nICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pICE9IDAp\nDQogICAgICAgICAgICBzbS5kZWxldGUoKTsNCiAgICAgICAgaWYgKChhY3Rp\nb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgIT0gMCkNCiAgICAgICAg\nICAgIHNtLmNhc2NhZGVEZWxldGUoX2NhbGwpOw0KICAgIH0NCg0KICAgIC8q\nKg0KICAgICAqIERldGVybWluZSB0aGUgYWN0aW9uIHRvIHRha2UgYmFzZWQg\nb24gdGhlIHVzZXIncyBnaXZlbiBjYWxsYmFja3MgYW5kDQogICAgICogb3Vy\nIGltcGxpY2l0IGJlaGF2aW9yLg0KICAgICAqLw0KICAgIHByaXZhdGUgaW50\nIHByb2Nlc3NBcmd1bWVudChpbnQgb3AsIE9iamVjdCBvYmosIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sDQogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsN\nCiAgICAgICAgaWYgKGNhbGwgIT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVy\nbiBjYWxsLnByb2Nlc3NBcmd1bWVudChvcCwgb2JqLCBzbSk7DQogICAgICAg\nIGlmIChfY2FsbCAhPSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuIF9jYWxs\nLnByb2Nlc3NBcmd1bWVudChvcCwgb2JqLCBzbSk7DQogICAgICAgIHJldHVy\nbiBPcENhbGxiYWNrcy5BQ1RfUlVOIHwgT3BDYWxsYmFja3MuQUNUX0NBU0NB\nREU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGhyb3cgdGhlIHByb3Bl\nciBleGNlcHRpb24gYmFzZWQgb24gdGhlIGdpdmVuIHNldCBvZiBmbHVzaCBl\ncnJvcnMsIG9yDQogICAgICogZG8gbm90aGluZyBpZiBubyBlcnJvcnMgb2Nj\ndXJyZWQuDQogICAgICovDQogICAgcHJpdmF0ZSBPcGVuSlBBRXhjZXB0aW9u\nIG5ld0ZsdXNoRXhjZXB0aW9uKENvbGxlY3Rpb24gZXhjZXBzKSB7DQogICAg\nICAgIGlmIChleGNlcHMgPT0gbnVsbCB8fCBleGNlcHMuaXNFbXB0eSgpKQ0K\nICAgICAgICAgICAgcmV0dXJuIG51bGw7DQoNCiAgICAgICAgVGhyb3dhYmxl\nW10gdCA9IChUaHJvd2FibGVbXSkgZXhjZXBzLnRvQXJyYXkNCiAgICAgICAg\nICAgIChuZXcgVGhyb3dhYmxlW2V4Y2Vwcy5zaXplKCldKTsNCiAgICAgICAg\nTGlzdCBmYWlsZWQgPSBuZXcgQXJyYXlMaXN0KHQubGVuZ3RoKTsNCg0KICAg\nICAgICAvLyBjcmVhdGUgZmF0YWwgZXhjZXB0aW9uIHdpdGggbmVzdGVkIGV4\nY2VwdGlvbnMgZm9yIGFsbCB0aGUgZmFpbGVkDQogICAgICAgIC8vIG9iamVj\ndHM7IGlmIGFsbCBPTCBleGNlcHRpb25zLCB0aHJvdyBhIHRvcC1sZXZlbCBP\nTCBleGNlcHRpb24NCiAgICAgICAgYm9vbGVhbiBvcHQgPSB0cnVlOw0KICAg\nICAgICBmb3IgKGludCBpID0gMDsgb3B0ICYmIGkgPCB0Lmxlbmd0aDsgaSsr\nKSB7DQogICAgICAgICAgICBvcHQgPSB0W2ldIGluc3RhbmNlb2YgT3B0aW1p\nc3RpY0V4Y2VwdGlvbjsNCiAgICAgICAgICAgIGlmIChvcHQpIHsNCiAgICAg\nICAgICAgICAgICBPYmplY3QgZiA9ICgoT3B0aW1pc3RpY0V4Y2VwdGlvbikg\ndFtpXSkuZ2V0RmFpbGVkT2JqZWN0KCk7DQogICAgICAgICAgICAgICAgaWYg\nKGYgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgZmFpbGVkLmFkZChm\nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAob3B0\nICYmICFmYWlsZWQuaXNFbXB0eSgpKQ0KICAgICAgICAgICAgcmV0dXJuIG5l\ndyBPcHRpbWlzdGljRXhjZXB0aW9uKGZhaWxlZCwgdCk7DQogICAgICAgIGlm\nIChvcHQpDQogICAgICAgICAgICByZXR1cm4gbmV3IE9wdGltaXN0aWNFeGNl\ncHRpb24odCk7DQogICAgICAgIHJldHVybiBuZXcgU3RvcmVFeGNlcHRpb24o\nX2xvYy5nZXQoInJvbGxlZC1iYWNrIikpLg0KICAgICAgICAgICAgc2V0TmVz\ndGVkVGhyb3dhYmxlcyh0KS5zZXRGYXRhbCh0cnVlKTsNCiAgICB9DQoNCiAg\nICAvKioNCiAgICAgKiBFbmQgdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24sIG1h\na2luZyBhcHByb3ByaWF0ZSBzdGF0ZSB0cmFuc2l0aW9ucy4NCiAgICAgKi8N\nCiAgICBwcm90ZWN0ZWQgdm9pZCBlbmRUcmFuc2FjdGlvbihpbnQgc3RhdHVz\nKSB7DQogICAgICAgIC8vIGlmIGEgZGF0YSBzdG9yZSB0cmFuc2FjdGlvbiB3\nYXMgaW4gcHJvZ3Jlc3MsIGRvIHRoZQ0KICAgICAgICAvLyBhcHByb3ByaWF0\nZSB0cmFuc2FjdGlvbiBjaGFuZ2UNCiAgICAgICAgYm9vbGVhbiByb2xsYmFj\nayA9IHN0YXR1cyAhPSBTdGF0dXMuU1RBVFVTX0NPTU1JVFRFRDsNCiAgICAg\nICAgTGlzdCBleGNlcHMgPSBudWxsOw0KDQogICAgICAgIHRyeSB7DQogICAg\nICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBlbmRTdG9yZU1hbmFnZXJU\ncmFuc2FjdGlvbihyb2xsYmFjaykpOw0KICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAgICByb2xsYmFjayA9IHRy\ndWU7DQogICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCByZSk7DQog\nICAgICAgIH0NCg0KICAgICAgICAvLyBnbyBiYWNrIHRvIGRlZmF1bHQgbm9u\nZSBsb2NrIGxldmVsDQogICAgICAgIF9mYy5zZXRSZWFkTG9ja0xldmVsKExP\nQ0tfTk9ORSk7DQogICAgICAgIF9mYy5zZXRXcml0ZUxvY2tMZXZlbChMT0NL\nX05PTkUpOw0KICAgICAgICBfZmMuc2V0TG9ja1RpbWVvdXQoLTEpOw0KDQog\nICAgICAgIENvbGxlY3Rpb24gdHJhbnNTdGF0ZXM7DQogICAgICAgIGlmICho\nYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQ0KICAgICAgICAgICAgdHJhbnNT\ndGF0ZXMgPSBfdHJhbnNDYWNoZTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAg\nICAgdHJhbnNTdGF0ZXMgPSBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOw0KDQog\nICAgICAgIC8vIGZpcmUgYWZ0ZXIgcm9sbGJhY2svY29tbWl0IGV2ZW50DQog\nICAgICAgIENvbGxlY3Rpb24gbW9ianMgPSBudWxsOw0KICAgICAgICBpZiAo\nX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVycygpKSB7DQogICAg\nICAgICAgICBtb2JqcyA9IG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbih0\ncmFuc1N0YXRlcyk7DQogICAgICAgICAgICBpbnQgZXZlbnRUeXBlID0gKHJv\nbGxiYWNrKSA/IFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfUk9MTEJBQ0sNCiAg\nICAgICAgICAgICAgICA6IFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfQ09NTUlU\nOw0KICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5z\nYWN0aW9uRXZlbnQodGhpcywgZXZlbnRUeXBlLCBtb2JqcywgDQogICAgICAg\nICAgICAgICAgX3BlcnNpc3RlZENsc3MsIF91cGRhdGVkQ2xzcywgX2RlbGV0\nZWRDbHNzKSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBudWxsIHRyYW5z\nYWN0aW9uYWwgY2FjaGVzIG5vdyBzbyB0aGF0IGFsbCB0aGUgcmVtb3ZlRnJv\nbVRyYW5zYWN0aW9uDQogICAgICAgIC8vIGNhbGxzIGFzIHdlIHRyYW5zaXRp\nb24gZWFjaCBvYmplY3QgZG9uJ3QgaGF2ZSB0byBkbyBhbnkgd29yazsgZG9u\nJ3QNCiAgICAgICAgLy8gY2xlYXIgdHJhbnMgY2FjaGUgb2JqZWN0IGJlY2F1\nc2Ugd2Ugc3RpbGwgbmVlZCB0aGUgdHJhbnNTdGF0ZXMNCiAgICAgICAgLy8g\ncmVmZXJlbmNlIHRvIGl0IGJlbG93DQogICAgICAgIF90cmFuc0NhY2hlID0g\nbnVsbDsNCiAgICAgICAgaWYgKF9wZXJzaXN0ZWRDbHNzICE9IG51bGwpDQog\nICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcyA9IG51bGw7DQogICAgICAgIGlm\nIChfdXBkYXRlZENsc3MgIT0gbnVsbCkNCiAgICAgICAgICAgIF91cGRhdGVk\nQ2xzcyA9IG51bGw7DQogICAgICAgIGlmIChfZGVsZXRlZENsc3MgIT0gbnVs\nbCkNCiAgICAgICAgICAgIF9kZWxldGVkQ2xzcyA9IG51bGw7DQoNCiAgICAg\nICAgLy8gbmV3IGNhY2hlIHdvdWxkIGdldCBjbGVhcmVkIGFueXdheSBkdXJp\nbmcgdHJhbnNpdGlvbnMsIGJ1dCBkb2luZyBzbw0KICAgICAgICAvLyBpbW1l\nZGlhdGVseSBzYXZlcyB1cyBzb21lIGxvb2t1cHMNCiAgICAgICAgX2NhY2hl\nLmNsZWFyTmV3KCk7DQoNCiAgICAgICAgLy8gdGVsbCBhbGwgZGVyZWZlZCBp\nbnN0YW5jZXMgdGhleSdyZSBubyBsb25nZXIgZGVyZWZlZDsgd2UgY2FuJ3QN\nCiAgICAgICAgLy8gcmVseSBvbiByb2xsYmFjayBhbmQgY29tbWl0IGNhbGxz\nIGJlbG93IGNhdXNlIHNvbWUgaW5zdGFuY2VzIG1pZ2h0DQogICAgICAgIC8v\nIG5vdCBiZSB0cmFuc2FjdGlvbmFsDQogICAgICAgIGlmIChfZGVyZWZDYWNo\nZSAhPSBudWxsICYmICFfZGVyZWZDYWNoZS5pc0VtcHR5KCkpIHsNCiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2RlcmVmQ2FjaGUuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspDQogICAgICAgICAgICAgICAgKChTdGF0\nZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpKS5zZXREZXJlZmVyZW5jZWREZXBl\nbmRlbnQNCiAgICAgICAgICAgICAgICAgICAgKGZhbHNlLCBmYWxzZSk7DQog\nICAgICAgICAgICBfZGVyZWZDYWNoZSA9IG51bGw7DQogICAgICAgIH0NCg0K\nICAgICAgICAvLyBwZWZvcm0gY29tbWl0IG9yIHJvbGxiYWNrIHN0YXRlIHRy\nYW5zaXRpb25zIG9uIGVhY2ggaW5zdGFuY2UNCiAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbTsNCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB0cmFu\nc1N0YXRlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0KICAgICAg\nICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsNCiAg\nICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgaWYgKHJvbGxiYWNr\nKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIHRlbGwgb2JqZWN0cyB0aGF0\nIG1heSBoYXZlIGJlZW4gZGVyZWZlZCB0aGVuIGZsdXNoZWQNCiAgICAgICAg\nICAgICAgICAgICAgLy8gKGFuZCB0aGVyZWZvcmUgZGVsZXRlZCkgdG8gdW4t\nZGVyZWYNCiAgICAgICAgICAgICAgICAgICAgc20uc2V0RGVyZWZlcmVuY2Vk\nRGVwZW5kZW50KGZhbHNlLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgICAg\nIHNtLnJvbGxiYWNrKCk7DQogICAgICAgICAgICAgICAgfSBlbHNlDQogICAg\nICAgICAgICAgICAgICAgIHNtLmNvbW1pdCgpOw0KICAgICAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAgICAg\nIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJlKTsNCiAgICAgICAgICAgIH0NCiAg\nICAgICAgfQ0KDQogICAgICAgIC8vIG5vdGlmeSB0aGUgbG9jayBtYW5hZ2Vy\nIHRvIGNsZWFuIHVwIGFuZCByZWxlYXNlIHJlbWFpbmluZyBsb2Nrcw0KICAg\nICAgICBfbG0uZW5kVHJhbnNhY3Rpb24oKTsNCg0KICAgICAgICAvLyBjbGVh\nciBvbGQgc2F2ZXBvaW50cyBpbiByZXZlcnNlDQogICAgICAgIE9wZW5KUEFT\nYXZlcG9pbnQgc2F2ZTsNCiAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzICE9\nIG51bGwgJiYgX3NhdmVwb2ludHMuc2l6ZSgpID4gMCkgew0KICAgICAgICAg\nICAgc2F2ZSA9DQogICAgICAgICAgICAgICAgKE9wZW5KUEFTYXZlcG9pbnQp\nIF9zYXZlcG9pbnRzLnJlbW92ZShfc2F2ZXBvaW50cy5zaXplKCkgLSAxKTsN\nCiAgICAgICAgICAgIHNhdmUucmVsZWFzZShmYWxzZSk7DQogICAgICAgIH0N\nCiAgICAgICAgX3NhdmVwb2ludHMgPSBudWxsOw0KICAgICAgICBfc2F2ZXBv\naW50Q2FjaGUgPSBudWxsOw0KDQogICAgICAgIC8vIGZpcmUgYWZ0ZXIgc3Rh\ndGUgY2hhbmdlIGV2ZW50DQogICAgICAgIGlmIChfdHJhbnNFdmVudE1hbmFn\nZXIuaGFzRW5kTGlzdGVuZXJzKCkpDQogICAgICAgICAgICBmaXJlVHJhbnNh\nY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlzLCBUcmFuc2Fj\ndGlvbkV2ZW50Lg0KICAgICAgICAgICAgICAgIEFGVEVSX1NUQVRFX1RSQU5T\nSVRJT05TLCBtb2JqcywgbnVsbCwgbnVsbCwgbnVsbCkpOw0KDQogICAgICAg\nIC8vIG5vdyBjbGVhciB0cmFucyBjYWNoZTsga2VlcCBjbGVhcmVkIHZlcnNp\nb24gcmF0aGVyIHRoYW4NCiAgICAgICAgLy8gbnVsbCB0byBhdm9pZCBoYXZp\nbmcgdG8gcmUtY3JlYXRlIHRoZSBzZXQgbGF0ZXI7IG1vcmUgZWZmaWNpZW50\nDQogICAgICAgIGlmICh0cmFuc1N0YXRlcyAhPSBDb2xsZWN0aW9ucy5FTVBU\nWV9MSVNUKSB7DQogICAgICAgICAgICBfdHJhbnNDYWNoZSA9IChUcmFuc2Fj\ndGlvbmFsQ2FjaGUpIHRyYW5zU3RhdGVzOw0KICAgICAgICAgICAgX3RyYW5z\nQ2FjaGUuY2xlYXIoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRocm93TmVz\ndGVkRXhjZXB0aW9ucyhleGNlcHMsIHRydWUpOw0KICAgIH0NCg0KICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vDQogICAgLy8gT2JqZWN0IGxpZmVjeWNsZQ0K\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vDQoNCiAgICBwdWJsaWMgdm9pZCBw\nZXJzaXN0KE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAg\nICAgcGVyc2lzdChvYmosIG51bGwsIHRydWUsIGNhbGwpOw0KICAgIH0NCg0K\nICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIHBlcnNpc3QoT2JqZWN0\nIG9iaiwgT2JqZWN0IGlkLA0KICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7\nDQogICAgICAgIHJldHVybiBwZXJzaXN0KG9iaiwgaWQsIHRydWUsIGNhbGwp\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHBlcnNpc3RBbGwoQ29sbGVj\ndGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAgIHBlcnNp\nc3RBbGwob2JqcywgdHJ1ZSwgY2FsbCk7DQogICAgfQ0KDQogICAgLyoqDQog\nICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2JqZWN0cy4gIEluZGljYXRlIHdo\nZXRoZXIgdGhpcyB3YXMgYW4gZXhwbGljaXQgcGVyc2lzdA0KICAgICAqIChQ\nTkVXKSBvciBhIHByb3Zpc29uYWwgcGVyc2lzdCAoUE5FV1BST1ZJU0lPTkFM\nKS4NCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBwZXJzaXN0QWxsKENvbGxl\nY3Rpb24gb2JqcywgYm9vbGVhbiBleHBsaWNpdCwgDQogICAgICAgIE9wQ2Fs\nbGJhY2tzIGNhbGwpIHsNCiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQ0K\nICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOw0KICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7DQogICAgICAg\nIHRyeSB7DQogICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOw0K\nDQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgICAgICB0cnkg\new0KICAgICAgICAgICAgICAgICAgICBwZXJzaXN0KGl0ci5uZXh0KCksIGV4\ncGxpY2l0LCBjYWxsKTsNCiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2Vy\nRXhjZXB0aW9uIHVlKSB7DQogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9\nIGFkZChleGNlcHMsIHVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAg\nICAgICB9DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgICAgICB0aHJvd05lc3RlZEV4\nY2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7DQogICAgfQ0KDQogICAgLyoqDQog\nICAgICogSWYgdGhlIGdpdmVuIGVsZW1lbnQgaXMgbm90IG51bGwsIGFkZCBp\ndCB0byB0aGUgZ2l2ZW4gbGlzdCwNCiAgICAgKiBjcmVhdGluZyB0aGUgbGlz\ndCBpZiBuZWNlc3NhcnkuDQogICAgICovDQogICAgcHJpdmF0ZSBMaXN0IGFk\nZChMaXN0IGwsIE9iamVjdCBvKSB7DQogICAgICAgIGlmIChvID09IG51bGwp\nDQogICAgICAgICAgICByZXR1cm4gbDsNCiAgICAgICAgaWYgKGwgPT0gbnVs\nbCkNCiAgICAgICAgICAgIGwgPSBuZXcgTGlua2VkTGlzdCgpOw0KICAgICAg\nICBsLmFkZChvKTsNCiAgICAgICAgcmV0dXJuIGw7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogVGhyb3cgYW4gZXhjZXB0aW9uIHdyYXBwaW5nIHRoZSBn\naXZlbiBuZXN0ZWQgZXhjZXB0aW9ucy4NCiAgICAgKi8NCiAgICBwcml2YXRl\nIHZvaWQgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKExpc3QgZXhjZXBzLCBib29s\nZWFuIGRhdGFzdG9yZSkgew0KICAgICAgICBpZiAoZXhjZXBzID09IG51bGwg\nfHwgZXhjZXBzLmlzRW1wdHkoKSkNCiAgICAgICAgICAgIHJldHVybjsNCiAg\nICAgICAgaWYgKGRhdGFzdG9yZSAmJiBleGNlcHMuc2l6ZSgpID09IDEpDQog\nICAgICAgICAgICB0aHJvdyAoUnVudGltZUV4Y2VwdGlvbikgZXhjZXBzLmdl\ndCgwKTsNCg0KICAgICAgICBib29sZWFuIGZhdGFsID0gZmFsc2U7DQogICAg\nICAgIFRocm93YWJsZVtdIHQgPSAoVGhyb3dhYmxlW10pIGV4Y2Vwcy50b0Fy\ncmF5DQogICAgICAgICAgICAobmV3IFRocm93YWJsZVtleGNlcHMuc2l6ZSgp\nXSk7DQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdC5sZW5ndGg7IGkr\nKykgew0KICAgICAgICAgICAgaWYgKHRbaV0gaW5zdGFuY2VvZiBPcGVuSlBB\nRXhjZXB0aW9uDQogICAgICAgICAgICAgICAgJiYgKChPcGVuSlBBRXhjZXB0\naW9uKSB0W2ldKS5pc0ZhdGFsKCkpDQogICAgICAgICAgICAgICAgZmF0YWwg\nPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIE9wZW5KUEFFeGNlcHRpb24g\nZXJyOw0KICAgICAgICBpZiAoZGF0YXN0b3JlKQ0KICAgICAgICAgICAgZXJy\nID0gbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJuZXN0ZWQtZXhjZXBz\nIikpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBlcnIgPSBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgibmVzdGVkLWV4Y2VwcyIpKTsNCiAgICAg\nICAgdGhyb3cgZXJyLnNldE5lc3RlZFRocm93YWJsZXModCkuc2V0RmF0YWwo\nZmF0YWwpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFBlcnNpc3QgdGhl\nIGdpdmVuIG9iamVjdC4gIEluZGljYXRlIHdoZXRoZXIgdGhpcyB3YXMgYW4g\nZXhwbGljaXQgcGVyc2lzdA0KICAgICAqIChQTkVXKSBvciBhIHByb3Zpc29u\nYWwgcGVyc2lzdCAoUE5FV1BST1ZJU0lPTkFMKQ0KICAgICAqLw0KICAgIHB1\nYmxpYyB2b2lkIHBlcnNpc3QoT2JqZWN0IG9iaiwgYm9vbGVhbiBleHBsaWNp\ndCwgT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBwZXJzaXN0KG9iaiwg\nbnVsbCwgZXhwbGljaXQsIGNhbGwpOw0KICAgIH0NCg0KICAgIC8qKg0KICAg\nICAqIFBlcnNpc3QgdGhlIGdpdmVuIG9iamVjdC4gIEluZGljYXRlIHdoZXRo\nZXIgdGhpcyB3YXMgYW4gZXhwbGljaXQgcGVyc2lzdA0KICAgICAqIChQTkVX\nKSBvciBhIHByb3Zpc29uYWwgcGVyc2lzdCAoUE5FV1BST1ZJU0lPTkFMKS4N\nCiAgICAgKiBTZWUge0BsaW5rIEJyb2tlcn0gZm9yIGRldGFpbHMgb24gdGhp\ncyBtZXRob2QuDQogICAgICovDQogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgcGVyc2lzdChPYmplY3Qgb2JqLCBPYmplY3QgaWQsIGJvb2xlYW4g\nZXhwbGljaXQsDQogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7\nDQoNCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRy\neSB7DQogICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOw0KDQog\nICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5h\nZ2VySW1wbChvYmosIHRydWUpOw0KICAgICAgICAgICAgaWYgKCFfb3BlcmF0\naW5nLmFkZChvYmopKQ0KICAgICAgICAgICAgICAgIHJldHVybiBzbTsNCg0K\nICAgICAgICAgICAgaW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChPcENh\nbGxiYWNrcy5PUF9QRVJTSVNULCBvYmosIHNtLCBjYWxsKTsNCiAgICAgICAg\nICAgIGlmIChhY3Rpb24gPT0gT3BDYWxsYmFja3MuQUNUX05PTkUpDQogICAg\nICAgICAgICAgICAgcmV0dXJuIHNtOw0KDQogICAgICAgICAgICAvLyBBQ1Rf\nQ0FTQ0FERQ0KICAgICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNr\ncy5BQ1RfUlVOKSA9PSAwKSB7DQogICAgICAgICAgICAgICAgaWYgKHNtICE9\nIG51bGwpDQogICAgICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0\nKGNhbGwpOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAg\nICAgICAgY2FzY2FkZVRyYW5zaWVudChPcENhbGxiYWNrcy5PUF9QRVJTSVNU\nLCBvYmosIGNhbGwsDQogICAgICAgICAgICAgICAgICAgICAgICAicGVyc2lz\ndCIpOw0KICAgICAgICAgICAgICAgIHJldHVybiBzbTsNCiAgICAgICAgICAg\nIH0NCg0KICAgICAgICAgICAgLy8gQUNUX1JVTg0KICAgICAgICAgICAgUGVy\nc2lzdGVuY2VDYXBhYmxlIHBjOw0KICAgICAgICAgICAgaWYgKHNtICE9IG51\nbGwpIHsNCiAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQ0K\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0RXhpc3RzRXhj\nZXB0aW9uKF9sb2MuZ2V0DQogICAgICAgICAgICAgICAgICAgICAgICAoInBl\ncnNpc3QtZGV0YWNoZWQiLCBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS4N\nCiAgICAgICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChvYmop\nOw0KDQogICAgICAgICAgICAgICAgaWYgKCFzbS5pc0VtYmVkZGVkKCkpIHsN\nCiAgICAgICAgICAgICAgICAgICAgc20ucGVyc2lzdCgpOw0KICAgICAgICAg\nICAgICAgICAgICBfY2FjaGUucGVyc2lzdChzbSk7DQogICAgICAgICAgICAg\nICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUp\nICE9IDApDQogICAgICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVy\nc2lzdChjYWxsKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNtOw0K\nICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIGFuIGVt\nYmVkZGVkIGZpZWxkOyBub3RpZnkgdGhlIG93bmVyIHRoYXQgdGhlIHZhbHVl\nIGhhcw0KICAgICAgICAgICAgICAgIC8vIGNoYW5nZWQgYnkgYmVjb21pbmcg\naW5kZXBlbmRlbnRseSBwZXJzaXN0ZW50DQogICAgICAgICAgICAgICAgc20u\nZ2V0T3duZXIoKS5kaXJ0eShzbS5nZXRPd25lckluZGV4KCkpOw0KICAgICAg\nICAgICAgICAgIF9jYWNoZS5wZXJzaXN0KHNtKTsNCiAgICAgICAgICAgICAg\nICBwYyA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpOw0KICAgICAgICAg\nICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBwYyA9IGFzc2VydFBlcnNp\nc3RlbmNlQ2FwYWJsZShvYmopOw0KICAgICAgICAgICAgICAgIGlmIChwYy5w\nY0lzRGV0YWNoZWQoKSA9PSBCb29sZWFuLlRSVUUpDQogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBPYmplY3RFeGlzdHNFeGNlcHRpb24oX2xvYy5n\nZXQNCiAgICAgICAgICAgICAgICAgICAgICAgICgicGVyc2lzdC1kZXRhY2hl\nZCIsIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkpLg0KICAgICAgICAgICAg\nICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KG9iaik7DQogICAgICAgICAg\nICB9DQoNCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25m\nLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuDQogICAgICAgICAg\nICAgICAgZ2V0TWV0YURhdGEob2JqLmdldENsYXNzKCksIF9sb2FkZXIsIHRy\ndWUpOw0KICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KG9iaiwgbnVs\nbCwgbWV0YSwgTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX1BFUlNJU1QpOw0KDQog\nICAgICAgICAgICAvLyBjcmVhdGUgaWQgZm9yIGluc3RhbmNlDQogICAgICAg\nICAgICBpZiAoaWQgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGlmICht\nZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQ\nTElDQVRJT04pDQogICAgICAgICAgICAgICAgICAgIGlkID0gQXBwbGljYXRp\nb25JZHMuY3JlYXRlKHBjLCBtZXRhKTsNCiAgICAgICAgICAgICAgICBlbHNl\nIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEu\nSURfVU5LTk9XTikNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93bmlkIiwgbWV0YSkp\nOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAg\naWQgPSBTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0aGlzKTsNCiAgICAg\nICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGRvbid0\nIGFscmVhZHkgaGF2ZSB0aGUgaW5zdGFuY2UgY2FjaGVkDQogICAgICAgICAg\nICBjaGVja0ZvckR1cGxpY2F0ZUlkKGlkLCBvYmopOw0KDQogICAgICAgICAg\nICAvLyBpZiBoYWQgZW1iZWRkZWQgc20sIG51bGwgaXQNCiAgICAgICAgICAg\nIGlmIChzbSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHBjLnBjUmVwbGFj\nZVN0YXRlTWFuYWdlcihudWxsKTsNCg0KICAgICAgICAgICAgLy8gY3JlYXRl\nIG5ldyBzbQ0KICAgICAgICAgICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1w\nbChpZCwgbWV0YSwgdGhpcyk7DQogICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfQUNUSVZFKSAhPSAwKSB7DQogICAgICAgICAgICAgICAgaWYgKGV4\ncGxpY2l0KQ0KICAgICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKHBj\nLCBQQ1N0YXRlLlBORVcpOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAg\nICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5QTkVX\nUFJPVklTSU9OQUwpOw0KICAgICAgICAgICAgfSBlbHNlDQogICAgICAgICAg\nICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5QTk9OVFJBTlNORVcp\nOw0KICAgICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1Rf\nQ0FTQ0FERSkgIT0gMCkNCiAgICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVy\nc2lzdChjYWxsKTsNCiAgICAgICAgICAgIHJldHVybiBzbTsNCiAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAgICAg\ndGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9u\nKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAg\nICogVGVtcG9yYXJpbHkgbWFuYWdlIHRoZSBnaXZlbiBpbnN0YW5jZSBpbiBv\ncmRlciB0byBjYXNjYWRlIHRoZSBnaXZlbg0KICAgICAqIG9wZXJhdGlvbiB0\naHJvdWdoIGl0Lg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9pZCBjYXNjYWRl\nVHJhbnNpZW50KGludCBvcCwgT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2Fs\nbCwNCiAgICAgICAgU3RyaW5nIGVyck9wKSB7DQogICAgICAgIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYyA9IGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmop\nOw0KDQogICAgICAgIC8vIGlmIHVzaW5nIGRldGFjaGVkIHN0YXRlIG1hbmFn\nZXIsIGRvbid0IHJlcGxhY2UNCiAgICAgICAgaWYgKHBjLnBjR2V0U3RhdGVN\nYW5hZ2VyKCkgIT0gbnVsbCkNCiAgICAgICAgICAgIHRocm93IG5ld0RldGFj\naGVkRXhjZXB0aW9uKG9iaiwgZXJyT3ApOw0KDQogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3Rh\nbmNlKCkuDQogICAgICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0Q2xhc3Mo\nKSwgX2xvYWRlciwgdHJ1ZSk7DQogICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChTdGF0ZU1hbmFnZXJJZC4NCiAg\nICAgICAgICAgIG5ld0luc3RhbmNlKHRoaXMpLCBtZXRhLCB0aGlzKTsNCiAg\nICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5UTE9BREVEKTsNCiAg\nICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHN3aXRjaCAob3ApIHsNCiAgICAg\nICAgICAgICAgICBjYXNlIE9wQ2FsbGJhY2tzLk9QX1BFUlNJU1Q6DQogICAg\nICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwpOw0KICAg\nICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNl\nIE9wQ2FsbGJhY2tzLk9QX0RFTEVURToNCiAgICAgICAgICAgICAgICAgICAg\nc20uY2FzY2FkZURlbGV0ZShjYWxsKTsNCiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBPcENhbGxiYWNrcy5PUF9S\nRUZSRVNIOg0KICAgICAgICAgICAgICAgICAgICBzbS5nYXRoZXJDYXNjYWRl\nUmVmcmVzaChjYWxsKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQog\nICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKFN0cmluZy52YWx1ZU9mKG9w\nKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZmluYWxs\neSB7DQogICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOw0KICAgICAgICB9\nDQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgZGVsZXRlQWxsKENvbGxlY3Rp\nb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGFz\nc2VydFdyaXRlT3BlcmF0aW9uKCk7DQoNCiAgICAgICAgICAgIExpc3QgZXhj\nZXBzID0gbnVsbDsNCiAgICAgICAgICAgIE9iamVjdCBvYmo7DQogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOw0KICAgICAgICAgICAg\nICAgICAgICBpZiAob2JqICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAg\nICAgICBkZWxldGUob2JqLCBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1\nZSksIGNhbGwpOw0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNl\ncHRpb24gdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRk\nKGV4Y2VwcywgdWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAg\nIH0NCiAgICAgICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMs\nIGZhbHNlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGlj\nIHZvaWQgZGVsZXRlKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsN\nCiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJu\nOw0KDQogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0\ncnkgew0KICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRpb24oKTsNCiAg\nICAgICAgICAgIGRlbGV0ZShvYmosIGdldFN0YXRlTWFuYWdlckltcGwob2Jq\nLCB0cnVlKSwgY2FsbCk7DQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNl\ncHRpb24ga2UpIHsNCiAgICAgICAgICAgIHRocm93IGtlOw0KICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7DQogICAgICAgIH0gZmlu\nYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAg\nfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEludGVybmFsIGRlbGV0ZS4N\nCiAgICAgKi8NCiAgICB2b2lkIGRlbGV0ZShPYmplY3Qgb2JqLCBTdGF0ZU1h\nbmFnZXJJbXBsIHNtLCBPcENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAgIGlm\nICghX29wZXJhdGluZy5hZGQob2JqKSkNCiAgICAgICAgICAgIHJldHVybjsN\nCg0KICAgICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2Fs\nbGJhY2tzLk9QX0RFTEVURSwgb2JqLCBzbSwgY2FsbCk7DQogICAgICAgIGlm\nIChhY3Rpb24gPT0gT3BDYWxsYmFja3MuQUNUX05PTkUpDQogICAgICAgICAg\nICByZXR1cm47DQoNCiAgICAgICAgLy8gQUNUX0NBU0NBREUNCiAgICAgICAg\naWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKSB7DQog\nICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICBz\nbS5jYXNjYWRlRGVsZXRlKGNhbGwpOw0KICAgICAgICAgICAgZWxzZQ0KICAg\nICAgICAgICAgICAgIGNhc2NhZGVUcmFuc2llbnQoT3BDYWxsYmFja3MuT1Bf\nREVMRVRFLCBvYmosIGNhbGwsICJkZWxldGUiKTsNCiAgICAgICAgICAgIHJl\ndHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEFDVF9SVU4NCiAgICAg\nICAgaWYgKHNtICE9IG51bGwpIHsNCiAgICAgICAgICAgIGlmIChzbS5pc0Rl\ndGFjaGVkKCkpDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRF\neGNlcHRpb24ob2JqLCAiZGVsZXRlIik7DQogICAgICAgICAgICBpZiAoKGFj\ndGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSAhPSAwKQ0KICAgICAg\nICAgICAgICAgIHNtLmNhc2NhZGVEZWxldGUoY2FsbCk7DQogICAgICAgICAg\nICBzbS5kZWxldGUoKTsNCiAgICAgICAgfSBlbHNlIGlmIChhc3NlcnRQZXJz\naXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNoZWQoKSA9PSBCb29sZWFu\nLlRSVUUpDQogICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlv\nbihvYmosICJkZWxldGUiKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBU\naHJvdyBhbiBleGNlcHRpb24gaW5kaWNhdGluZyB0aGF0IHRoZSBjdXJyZW50\nIGFjdGlvbiBjYW4ndCBiZQ0KICAgICAqIHBlcmZvcm1lZCBvbiBhIGRldGFj\naGVkIG9iamVjdC4NCiAgICAgKi8NCiAgICBwcml2YXRlIE9wZW5KUEFFeGNl\ncHRpb24gbmV3RGV0YWNoZWRFeGNlcHRpb24oT2JqZWN0IG9iaiwNCiAgICAg\nICAgU3RyaW5nIG9wZXJhdGlvbikgew0KICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWRldGFjaGVkLW9wIiwgb3BlcmF0\naW9uLA0KICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopKSku\nc2V0RmFpbGVkT2JqZWN0KG9iaik7DQogICAgfQ0KDQogICAgcHVibGljIHZv\naWQgcmVsZWFzZUFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsNCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOw0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOw0KICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAg\nICAgICAgICAgICAgICAgICAgcmVsZWFzZShpdHIubmV4dCgpLCBjYWxsKTsN\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7\nDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVl\nKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAg\nICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7DQog\nICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHJlbGVh\nc2UoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBp\nZiAob2JqID09IG51bGwpDQogICAgICAgICAgICByZXR1cm47DQoNCiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0KICAg\nICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdl\nckltcGwob2JqLCB0cnVlKTsNCiAgICAgICAgICAgIGludCBhY3Rpb24gPSBw\ncm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfUkVMRUFTRSwgb2JqLCBz\nbSwgY2FsbCk7DQoNCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKQ0KICAg\nICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIGlmICgoYWN0aW9u\nICYgT3BDYWxsYmFja3MuQUNUX1JVTikgIT0gMCAmJiBzbS5pc1BlcnNpc3Rl\nbnQoKSkgew0KICAgICAgICAgICAgICAgIGJvb2xlYW4gcGVuZGluZyA9IHNt\nLmlzUGVuZGluZ1RyYW5zYWN0aW9uYWwoKTsNCiAgICAgICAgICAgICAgICBz\nbS5yZWxlYXNlKHRydWUpOw0KICAgICAgICAgICAgICAgIGlmIChwZW5kaW5n\nKQ0KICAgICAgICAgICAgICAgICAgICByZW1vdmVGcm9tUGVuZGluZ1RyYW5z\nYWN0aW9uKHNtKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAg\nICBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAgICAg\ndGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9u\nKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgZW1iZWQoT2JqZWN0IG9iaiwgT2JqZWN0IGlk\nLA0KICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG93bmVyLCBWYWx1ZU1l\ndGFEYXRhIG93bmVyTWV0YSkgew0KICAgICAgICBiZWdpbk9wZXJhdGlvbih0\ncnVlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgb3JpZyA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsN\nCiAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwpIHsNCiAgICAgICAgICAg\nICAgICAvLyBpZiBhbHJlYWR5IGVtYmVkZGVkLCBub3RoaW5nIHRvIGRvDQog\nICAgICAgICAgICAgICAgaWYgKG9yaWcuZ2V0T3duZXIoKSA9PSBvd25lciAm\nJiBvcmlnLmdldE1ldGFEYXRhKCkuDQogICAgICAgICAgICAgICAgICAgIGdl\ndEVtYmVkZGluZ01ldGFEYXRhKCkgPT0gb3duZXJNZXRhKQ0KICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gb3JpZzsNCg0KICAgICAgICAgICAgICAgIC8v\nIG90aGVyd2lzZSBtYWtlIHN1cmUgcGMgaXMgZnVsbHkgbG9hZGVkIGZvciB3\naGVuIHdlIGNvcHkgaXRzDQogICAgICAgICAgICAgICAgLy8gZGF0YSBiZWxv\ndw0KICAgICAgICAgICAgICAgIG9yaWcubG9hZChfZmMsIFN0YXRlTWFuYWdl\nckltcGwuTE9BRF9BTEwsIG51bGwsIG51bGwsIGZhbHNlKTsNCiAgICAgICAg\nICAgIH0NCg0KICAgICAgICAgICAgLy8gY3JlYXRlIG5ldyBzdGF0ZSBtYW5h\nZ2VyIHdpdGggZW1iZWRkZWQgbWV0YWRhdGENCiAgICAgICAgICAgIENsYXNz\nTWV0YURhdGEgbWV0YSA9IG93bmVyTWV0YS5nZXRFbWJlZGRlZE1ldGFEYXRh\nKCk7DQogICAgICAgICAgICBpZiAobWV0YSA9PSBudWxsKQ0KICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihfbG9jLmdldCgi\nYmFkLWVtYmVkIiwgb3duZXJNZXRhKSk7DQoNCiAgICAgICAgICAgIGlmIChp\nZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIGlkID0gU3RhdGVNYW5hZ2Vy\nSWQubmV3SW5zdGFuY2UodGhpcyk7DQoNCiAgICAgICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChpZCwgbWV0YSwg\ndGhpcyk7DQogICAgICAgICAgICBzbS5zZXRPd25lcigoU3RhdGVNYW5hZ2Vy\nSW1wbCkgb3duZXIsIG93bmVyTWV0YSk7DQoNCiAgICAgICAgICAgIFBlcnNp\nc3RlbmNlQ2FwYWJsZSBjb3B5Ow0KICAgICAgICAgICAgUENTdGF0ZSBzdGF0\nZTsNCiAgICAgICAgICAgIENsYXNzIHR5cGUgPSBtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKTsNCiAgICAgICAgICAgIGlmIChvYmogIT0gbnVsbCkgew0KICAg\nICAgICAgICAgICAgIC8vIGdpdmUgY29weSBhbmQgdGhlIG9yaWdpbmFsIGlu\nc3RhbmNlIHRoZSBzYW1lIHN0YXRlIG1hbmFnZXINCiAgICAgICAgICAgICAg\nICAvLyBzbyB0aGF0IHdlIGNhbiBjb3B5IGZpZWxkcyBmcm9tIG9uZSB0byB0\naGUgb3RoZXINCiAgICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIGNv\ncHlTTTsNCiAgICAgICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGM7\nDQogICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkgew0KICAgICAg\nICAgICAgICAgICAgICBjb3B5U00gPSBzbTsNCiAgICAgICAgICAgICAgICAg\nICAgcGMgPSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKTsNCiAgICAg\nICAgICAgICAgICAgICAgcGMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsN\nCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAg\nICBjb3B5U00gPSBvcmlnOw0KICAgICAgICAgICAgICAgICAgICBwYyA9IG9y\naWcuZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7DQogICAgICAgICAgICAgICAg\nfQ0KDQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAg\nICAgLy8gY29weSB0aGUgaW5zdGFuY2UuICB3ZSBkbyB0aGlzIGV2ZW4gaWYg\naXQgZG9lc24ndCBhbHJlYWR5DQogICAgICAgICAgICAgICAgICAgIC8vIGhh\ndmUgYSBzdGF0ZSBtYW5hZ2VyIGluIGNhc2UgaXQgaXMgbGF0ZXIgYXNzaWdu\nZWQgdG8gYQ0KICAgICAgICAgICAgICAgICAgICAvLyBQQyBmaWVsZDsgYXQg\ndGhhdCBwb2ludCBpdCdzIHRvbyBsYXRlIHRvIGNvcHkNCiAgICAgICAgICAg\nICAgICAgICAgY29weSA9IFBDUmVnaXN0cnkubmV3SW5zdGFuY2UodHlwZSwg\nY29weVNNLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIGludFtdIGZp\nZWxkcyA9IG5ldyBpbnRbbWV0YS5nZXRGaWVsZHMoKS5sZW5ndGhdOw0KICAg\nICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5s\nZW5ndGg7IGkrKykNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkc1tp\nXSA9IGk7DQogICAgICAgICAgICAgICAgICAgIGNvcHkucGNDb3B5RmllbGRz\nKHBjLCBmaWVsZHMpOw0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IFBD\nU3RhdGUuRUNPUFk7DQogICAgICAgICAgICAgICAgICAgIGNvcHkucGNSZXBs\nYWNlU3RhdGVNYW5hZ2VyKG51bGwpOw0KICAgICAgICAgICAgICAgIH0gZmlu\nYWxseSB7DQogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBpbnN0YW5j\nZSBkaWRuJ3QgaGF2ZSBhIHN0YXRlIG1hbmFnZXIgdG8gc3RhcnQsDQogICAg\nICAgICAgICAgICAgICAgIC8vIHJldmVydCBpdCB0byBiZWluZyB0cmFuc2ll\nbnQNCiAgICAgICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkNCiAg\nICAgICAgICAgICAgICAgICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdl\ncihudWxsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVs\nc2Ugew0KICAgICAgICAgICAgICAgIGNvcHkgPSBQQ1JlZ2lzdHJ5Lm5ld0lu\nc3RhbmNlKHR5cGUsIHNtLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgaWYg\nKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCAmJiAhX29wdGltaXN0aWMp\nDQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gUENTdGF0ZS5FQ0xFQU47\nDQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICBz\ndGF0ZSA9IFBDU3RhdGUuRU5PTlRSQU5TOw0KICAgICAgICAgICAgfQ0KDQog\nICAgICAgICAgICBzbS5pbml0aWFsaXplKGNvcHksIHN0YXRlKTsNCiAgICAg\nICAgICAgIHJldHVybiBzbTsNCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgew0KICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBm\naW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSWYgbm90IGFscmVhZHkg\nY2FjaGVkLCBjcmVhdGUgYW4gZW1wdHkgY29weSBvZiB0aGUgZ2l2ZW4gc3Rh\ndGUNCiAgICAgKiBtYW5hZ2VyIGluIHRoZSBnaXZlbiBzdGF0ZS4NCiAgICAg\nKi8NCiAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIGNvcHkoT3BlbkpQQVN0YXRl\nTWFuYWdlciBjb3B5LCBQQ1N0YXRlIHN0YXRlKSB7DQogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nYXNzZXJ0T3BlbigpOw0KICAgICAgICAgICAgT2JqZWN0IG9pZCA9IGNvcHku\nZmV0Y2hPYmplY3RJZCgpOw0KICAgICAgICAgICAgQ2xhc3MgdHlwZSA9IGNv\ncHkuZ2V0TWFuYWdlZEluc3RhbmNlKCkuZ2V0Q2xhc3MoKTsNCiAgICAgICAg\nICAgIGlmIChvaWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsNCiAgICAgICAgICAgIC8vIGNhY2hl\nZCBpbnN0YW5jZT8NCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20g\nPSBudWxsOw0KICAgICAgICAgICAgaWYgKCFjb3B5LmlzRW1iZWRkZWQoKSkN\nCiAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlk\nKG9pZCwgdHJ1ZSk7DQogICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkgew0K\nICAgICAgICAgICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9j\nb25mLg0KICAgICAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YVJlcG9zaXRv\ncnlJbnN0YW5jZSgpOw0KICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSA9IHJlcG9zLmdldE1ldGFEYXRhKHR5cGUsIF9sb2FkZXIsIHRydWUp\nOw0KICAgICAgICAgICAgICAgIC8vIGNvbnN0cnVjdCBhIG5ldyBzdGF0ZSBt\nYW5hZ2VyIHdpdGggYWxsIGluZm8ga25vd24NCiAgICAgICAgICAgICAgICBz\nbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgbWV0YSwgdGhpcyk7DQog\nICAgICAgICAgICAgICAgc20uc2V0T2JqZWN0SWQob2lkKTsNCiAgICAgICAg\nICAgICAgICBzbS5pbml0aWFsaXplKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVz\nY3JpYmVkVHlwZSgpLCBzdGF0ZSk7DQogICAgICAgICAgICB9DQogICAgICAg\nICAgICByZXR1cm4gc207DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAN\nCiAgICBwdWJsaWMgdm9pZCByZWZyZXNoQWxsKENvbGxlY3Rpb24gb2Jqcywg\nT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBpZiAob2JqcyA9PSBudWxs\nIHx8IG9ianMuaXNFbXB0eSgpKQ0KICAgICAgICAgICAgcmV0dXJuOw0KDQog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0K\nICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsNCg0K\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSANCiAgICAgICAgICAgICAgICBnYXRoZXJD\nYXNjYWRlUmVmcmVzaChpdHIubmV4dCgpLCBjYWxsKTsNCiAgICAgICAgICAg\nIGlmIChfb3BlcmF0aW5nLmlzRW1wdHkoKSkNCiAgICAgICAgICAgIAlyZXR1\ncm47DQogICAgICAgICAgICBpZiAoX29wZXJhdGluZy5zaXplKCkgPT0gMSkN\nCiAgICAgICAgICAgIAlyZWZyZXNoSW50ZXJuYWwoX29wZXJhdGluZy5pdGVy\nYXRvcigpLm5leHQoKSwgY2FsbCk7DQogICAgICAgICAgICBlbHNlDQogICAg\nICAgICAgICAJcmVmcmVzaEludGVybmFsKF9vcGVyYXRpbmcsIGNhbGwpOw0K\nICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCByZWZy\nZXNoKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuOw0KDQogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAg\nICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsNCg0KICAg\nICAgICAgICAgZ2F0aGVyQ2FzY2FkZVJlZnJlc2gob2JqLCBjYWxsKTsNCiAg\nICAgICAgICAgIGlmIChfb3BlcmF0aW5nLmlzRW1wdHkoKSkNCiAgICAgICAg\nICAgIAlyZXR1cm47DQogICAgICAgICAgICBpZiAoX29wZXJhdGluZy5zaXpl\nKCkgPT0gMSkNCiAgICAgICAgICAgIAlyZWZyZXNoSW50ZXJuYWwoX29wZXJh\ndGluZy5pdGVyYXRvcigpLm5leHQoKSwgY2FsbCk7DQogICAgICAgICAgICBl\nbHNlDQogICAgICAgICAgICAJcmVmcmVzaEludGVybmFsKF9vcGVyYXRpbmcs\nIGNhbGwpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBHYXRoZXJzIGFsbCBvYmplY3RzIHJlYWNoYWJsZSB0aHJvdWdoIGNh\nc2NhZGUtcmVmcmVzaCByZWxhdGlvbnMNCiAgICAgKiBpbnRvIHRoZSBvcGVy\nYXRpbmcgc2V0Lg0KICAgICAqLw0KICAgIHZvaWQgZ2F0aGVyQ2FzY2FkZVJl\nZnJlc2goT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAg\nICBpZiAob2JqID09IG51bGwpDQogICAgICAgICAgICByZXR1cm47DQogICAg\nICAgIGlmICghX29wZXJhdGluZy5hZGQob2JqKSkNCiAgICAgICAgICAgIHJl\ndHVybjsNCg0KICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIGZhbHNlKTsNCiAgICAgICAgaW50IGFjdGlv\nbiA9IHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9SRUZSRVNILCBv\nYmosIHNtLCBjYWxsKTsNCiAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxi\nYWNrcy5BQ1RfQ0FTQ0FERSkgPT0gMCkNCiAgICAgICAgICAgIHJldHVybjsN\nCg0KICAgICAgICBpZiAoc20gIT0gbnVsbCkNCiAgICAgICAgICAgIHNtLmdh\ndGhlckNhc2NhZGVSZWZyZXNoKGNhbGwpOw0KICAgICAgICBlbHNlDQogICAg\nICAgICAgICBjYXNjYWRlVHJhbnNpZW50KE9wQ2FsbGJhY2tzLk9QX1JFRlJF\nU0gsIG9iaiwgY2FsbCwgInJlZnJlc2giKTsNCiAgICB9DQoNCiAgICAvKioN\nCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2l0aCB0aGUgZnVsbCBz\nZXQgb2Ygb2JqZWN0cyByZWFjaGFibGUgdmlhDQogICAgICogY2FzY2FkZS1y\nZWZyZXNoIHJlbGF0aW9ucyBmcm9tIHRoZSB1c2VyLWdpdmVuIGluc3RhbmNl\ncy4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgdm9pZCByZWZyZXNoSW50ZXJu\nYWwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7DQogICAg\nCWlmIChvYmpzID09IG51bGwgfHwgb2Jqcy5pc0VtcHR5KCkpDQogICAgCQly\nZXR1cm47DQogICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsNCiAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgIC8vIGNvbGxlY3QgaW5zdGFuY2VzIHRoYXQg\nbmVlZCBhIHJlZnJlc2gNCiAgICAgICAgICAgIENvbGxlY3Rpb24gbG9hZCA9\nIG51bGw7DQogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOw0KICAg\nICAgICAgICAgT2JqZWN0IG9iajsNCiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0K\nICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7DQogICAgICAgICAg\nICAgICAgaWYgKG9iaiA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsNCg0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAg\nICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUp\nOw0KICAgICAgICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChP\ncENhbGxiYWNrcy5PUF9SRUZSRVNILCBvYmosIHNtLCBjYWxsKQ0KICAgICAg\nICAgICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAw\nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQoNCiAgICAg\nICAgICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsNCiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkpIA0KICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9u\nKG9iaiwgInJlZnJlc2giKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVs\nc2UgaWYgKHNtLmJlZm9yZVJlZnJlc2godHJ1ZSkpIHsNCiAgICAgICAgICAg\nICAgICAgICAgICAgIAlpZiAobG9hZCA9PSBudWxsKQ0KICAgICAgICAgICAg\nICAgICAgICAgICAgCQlsb2FkID0gbmV3IEFycmF5TGlzdChvYmpzLnNpemUo\nKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZC5hZGQoc20p\nOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmop\nLnBjSXNEZXRhY2hlZCgpDQogICAgICAgICAgICAgICAgICAgICAgICA9PSBC\nb29sZWFuLlRSVUUpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZyZXNoIik7DQogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAg\nICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBrZSk7DQog\nICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAg\nICAvLyByZWZyZXNoIGFsbA0KICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVs\nbCkgew0KICAgICAgICAgICAgICAgIENvbGxlY3Rpb24gZmFpbGVkID0gX3N0\nb3JlLmxvYWRBbGwobG9hZCwgbnVsbCwNCiAgICAgICAgICAgICAgICAgICAg\nU3RvcmVNYW5hZ2VyLkZPUkNFX0xPQURfUkVGUkVTSCwgX2ZjLCBudWxsKTsN\nCiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZhaWxl\nZC5pc0VtcHR5KCkpDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFk\nZChleGNlcHMsIG5ld09iamVjdE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCkp\nOw0KDQogICAgICAgICAgICAgICAgLy8gcGVyZm9ybSBwb3N0LXJlZnJlc2gg\ndHJhbnNpdGlvbnMgYW5kIG1ha2Ugc3VyZSBhbGwgZmV0Y2gNCiAgICAgICAg\nICAgICAgICAvLyBncm91cCBmaWVsZHMgYXJlIGxvYWRlZA0KICAgICAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gbG9hZC5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgew0KICAgICAgICAgICAgICAgICAgICBzbSA9IChT\ndGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOw0KICAgICAgICAgICAgICAg\nICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgZmFpbGVkLmNvbnRhaW5zKHNt\nLmdldElkKCkpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nDQoNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAg\nICAgICAgICAgIHNtLmFmdGVyUmVmcmVzaCgpOw0KICAgICAgICAgICAgICAg\nICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9G\nR1MsIG51bGwsIG51bGwsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZXhj\nZXBzID0gYWRkKGV4Y2Vwcywga2UpOw0KICAgICAgICAgICAgICAgICAgICB9\nDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAg\nICAgICAvLyBub3cgaW52b2tlIHBvc3RSZWZyZXNoIG9uIGFsbCB0aGUgaW5z\ndGFuY2VzDQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFu\nYWdlckltcGwoaXRyLm5leHQoKSwgdHJ1ZSk7DQogICAgICAgICAgICAgICAg\nICAgIGlmIChzbSAhPSBudWxsICYmICFzbS5pc0RldGFjaGVkKCkpDQogICAg\nICAgICAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoc20uZ2V0\nTWFuYWdlZEluc3RhbmNlKCksIG51bGwsDQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQuQUZU\nRVJfUkVGUkVTSCk7DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAgICAgICAgICAgICBleGNlcHMg\nPSBhZGQoZXhjZXBzLCBrZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAg\nICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7DQogICAgICAgICAgICB0aHJvdyBrZTsNCiAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24ocmUpOw0KICAgICAgICB9DQogICAgICAgIHRo\ncm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsNCiAgICB9DQoN\nCiAgICAvKioNCiAgICAgKiBPcHRpbWl6YXRpb24gZm9yIHNpbmdsZS1vYmpl\nY3QgcmVmcmVzaC4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgdm9pZCByZWZy\nZXNoSW50ZXJuYWwoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgew0K\nICAgICAgICB0cnkgew0KICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsNCiAgICAgICAg\nICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFRlJF\nU0gsIG9iaiwgc20sIGNhbGwpDQogICAgICAgICAgICAgICAgJiBPcENhbGxi\nYWNrcy5BQ1RfUlVOKSA9PSAwKQ0KICAgICAgICAgICAgICAgIHJldHVybjsN\nCg0KICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsNCiAgICAgICAgICAg\nICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQ0KICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZWZyZXNoIik7\nDQogICAgICAgICAgICAgICAgZWxzZSBpZiAoc20uYmVmb3JlUmVmcmVzaChm\nYWxzZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0\nYXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsN\nCiAgICAgICAgICAgICAgICAgICAgc20uYWZ0ZXJSZWZyZXNoKCk7DQogICAg\nICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVF\ndmVudChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgbnVsbCwNCiAgICAgICAg\nICAgICAgICAgICAgc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQu\nQUZURVJfUkVGUkVTSCk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGFzc2Vy\ndFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRhY2hlZCgpDQogICAg\nICAgICAgICAgICAgPT0gQm9vbGVhbi5UUlVFKQ0KICAgICAgICAgICAgICAg\nIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2giKTsN\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAg\nICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICAN\nCiAgICBwdWJsaWMgdm9pZCByZXRyaWV2ZUFsbChDb2xsZWN0aW9uIG9ianMs\nIGJvb2xlYW4gZGZnT25seSwNCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkg\new0KICAgICAgICBpZiAob2JqcyA9PSBudWxsIHx8IG9ianMuaXNFbXB0eSgp\nKQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICBpZiAob2Jqcy5zaXpl\nKCkgPT0gMSkgew0KICAgICAgICAgICAgcmV0cmlldmUob2Jqcy5pdGVyYXRv\ncigpLm5leHQoKSwgZGZnT25seSwgY2FsbCk7DQogICAgICAgICAgICByZXR1\ncm47DQogICAgICAgIH0NCg0KICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7\nDQogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkg\new0KICAgICAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICAgICAgYXNz\nZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsNCg0KICAgICAgICAgICAgLy8g\nY29sbGVjdCBhbGwgaG9sbG93IGluc3RhbmNlcyBmb3IgbG9hZA0KICAgICAg\nICAgICAgT2JqZWN0IG9iajsNCiAgICAgICAgICAgIENvbGxlY3Rpb24gbG9h\nZCA9IG51bGw7DQogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOw0K\nICAgICAgICAgICAgQ29sbGVjdGlvbiBzbXMgPSBuZXcgQXJyYXlMaXN0KG9i\nanMuc2l6ZSgpKTsNCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0KICAgICAgICAg\nICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7DQogICAgICAgICAgICAgICAgaWYg\nKG9iaiA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsN\nCg0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAg\nIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOw0KICAgICAg\nICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNr\ncy5PUF9SRVRSSUVWRSwgb2JqLCBzbSwgY2FsbCkNCiAgICAgICAgICAgICAg\nICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkNCiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KDQogICAgICAgICAgICAg\nICAgICAgIGlmIChzbSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQ0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJl\ndHJpZXZlIik7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNQ\nZXJzaXN0ZW50KCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBz\nbXMuYWRkKHNtKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuSE9MTE9XKSB7DQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkID09IG51bGwpDQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkID0gbmV3\nIEFycmF5TGlzdCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsb2FkLmFkZChzbSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmop\nLnBjSXNEZXRhY2hlZCgpDQogICAgICAgICAgICAgICAgICAgICAgICA9PSBC\nb29sZWFuLlRSVUUpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZXRyaWV2ZSIpOw0KICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsNCiAgICAg\nICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOw0KICAg\nICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAg\nLy8gbG9hZCBhbGwgaG9sbG93IGluc3RhbmNlcw0KICAgICAgICAgICAgQ29s\nbGVjdGlvbiBmYWlsZWQgPSBudWxsOw0KICAgICAgICAgICAgaWYgKGxvYWQg\nIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGludCBtb2RlID0gKGRmZ09u\nbHkpID8gX3N0b3JlLkZPUkNFX0xPQURfREZHDQogICAgICAgICAgICAgICAg\nICAgIDogX3N0b3JlLkZPUkNFX0xPQURfQUxMOw0KICAgICAgICAgICAgICAg\nIGZhaWxlZCA9IF9zdG9yZS5sb2FkQWxsKGxvYWQsIG51bGwsIG1vZGUsIF9m\nYywgbnVsbCk7DQogICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxs\nICYmICFmYWlsZWQuaXNFbXB0eSgpKQ0KICAgICAgICAgICAgICAgICAgICBl\neGNlcHMgPSBhZGQoZXhjZXBzLCBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlv\nbihmYWlsZWQpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8g\ncmV0cmlldmUgYWxsIG5vbi1mYWlsZWQgaW5zdGFuY2VzDQogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgew0KICAgICAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdl\nckltcGwpIGl0ci5uZXh0KCk7DQogICAgICAgICAgICAgICAgaWYgKGZhaWxl\nZCAhPSBudWxsICYmIGZhaWxlZC5jb250YWlucyhzbS5nZXRJZCgpKSkNCiAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7DQoNCiAgICAgICAgICAgICAg\nICBpbnQgbW9kZSA9IChkZmdPbmx5KSA/IFN0YXRlTWFuYWdlckltcGwuTE9B\nRF9GR1MNCiAgICAgICAgICAgICAgICAgICAgOiBTdGF0ZU1hbmFnZXJJbXBs\nLkxPQURfQUxMOw0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAg\nICAgICAgICAgIHNtLmJlZm9yZVJlYWQoLTEpOw0KICAgICAgICAgICAgICAg\nICAgICBzbS5sb2FkKF9mYywgbW9kZSwgbnVsbCwgbnVsbCwgZmFsc2UpOw0K\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsNCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywg\na2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAg\nICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0\naW9uKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgICAgIHRocm93TmVzdGVk\nRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsNCiAgICB9DQoNCiAgICBwdWJs\naWMgdm9pZCByZXRyaWV2ZShPYmplY3Qgb2JqLCBib29sZWFuIGRmZ09ubHks\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAgaWYgKG9iaiA9PSBudWxs\nKQ0KICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0\nT3BlbigpOw0KICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJl\nYWQoKTsNCg0KICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdl\ndFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsNCiAgICAgICAgICAgIGlm\nICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFVFJJRVZFLCBv\nYmosIHNtLCBjYWxsKQ0KICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3Mu\nQUNUX1JVTikgPT0gMCkNCiAgICAgICAgICAgICAgICByZXR1cm47DQoNCiAg\nICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAg\naWYgKHNtLmlzRGV0YWNoZWQoKSkNCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmV0cmlldmUiKTsNCiAg\nICAgICAgICAgICAgICBpZiAoc20uaXNQZXJzaXN0ZW50KCkpIHsNCiAgICAg\nICAgICAgICAgICAgICAgaW50IG1vZGUgPSAoZGZnT25seSkgPyBTdGF0ZU1h\nbmFnZXJJbXBsLkxPQURfRkdTDQogICAgICAgICAgICAgICAgICAgICAgICA6\nIFN0YXRlTWFuYWdlckltcGwuTE9BRF9BTEw7DQogICAgICAgICAgICAgICAg\nICAgIHNtLmJlZm9yZVJlYWQoLTEpOw0KICAgICAgICAgICAgICAgICAgICBz\nbS5sb2FkKF9mYywgbW9kZSwgbnVsbCwgbnVsbCwgZmFsc2UpOw0KICAgICAg\nICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVy\nc2lzdGVuY2VDYXBhYmxlKG9iaikucGNJc0RldGFjaGVkKCkNCiAgICAgICAg\nICAgICAgICA9PSBCb29sZWFuLlRSVUUpDQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmV0cmlldmUiKTsNCiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAg\nICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhj\nZXB0aW9uKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVi\nbGljIHZvaWQgZXZpY3RBbGwoT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAgICAgIHRyeSB7DQogICAg\nICAgICAgICAvLyBldmljdCBhbGwgUENsZWFuIGFuZCBQTm9uVHJhbnMgb2Jq\nZWN0cw0KICAgICAgICAgICAgQ29sbGVjdGlvbiBjID0gZ2V0TWFuYWdlZFN0\nYXRlcygpOw0KICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsNCiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgew0KICAgICAgICAgICAgICAgIHNtID0gKFN0YXRl\nTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7DQogICAgICAgICAgICAgICAgaWYg\nKHNtLmlzUGVyc2lzdGVudCgpICYmICFzbS5pc0RpcnR5KCkpDQogICAgICAg\nICAgICAgICAgICAgIGV2aWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBj\nYWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmaW5h\nbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9\nDQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgZXZpY3RBbGwoQ29sbGVjdGlv\nbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAgIExpc3QgZXhj\nZXBzID0gbnVsbDsNCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOw0K\nICAgICAgICB0cnkgew0KICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAg\nICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgZXZpY3QoaXRy\nLm5leHQoKSwgY2FsbCk7DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNl\nckV4Y2VwdGlvbiB1ZSkgew0KICAgICAgICAgICAgICAgICAgICBleGNlcHMg\nPSBhZGQoZXhjZXBzLCB1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAg\nICAgICAgfQ0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7DQogICAgICAgIH0NCiAgICAgICAgdGhyb3dOZXN0ZWRF\neGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOw0KICAgIH0NCg0KICAgIHB1Ymxp\nYyB2b2lkIGV2aWN0QWxsKEV4dGVudCBleHRlbnQsIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsNCiAgICAgICAgaWYgKGV4dGVudCA9PSBudWxsKQ0KICAgICAgICAg\nICAgcmV0dXJuOw0KDQogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsN\nCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIC8vIGV2aWN0IGFsbCBQQ2xl\nYW4gYW5kIFBOb25UcmFucyBvYmplY3RzIGluIGV4dGVudA0KICAgICAgICAg\nICAgQ29sbGVjdGlvbiBjID0gZ2V0TWFuYWdlZFN0YXRlcygpOw0KICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsNCiAgICAgICAgICAgIENsYXNz\nIGNsczsNCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0KICAgICAgICAgICAgICAgIHNt\nID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7DQogICAgICAgICAg\nICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpICYmICFzbS5pc0RpcnR5KCkp\nIHsNCiAgICAgICAgICAgICAgICAgICAgY2xzID0gc20uZ2V0TWV0YURhdGEo\nKS5nZXREZXNjcmliZWRUeXBlKCk7DQogICAgICAgICAgICAgICAgICAgIGlm\nIChjbHMgPT0gZXh0ZW50LmdldEVsZW1lbnRUeXBlKCkNCiAgICAgICAgICAg\nICAgICAgICAgICAgIHx8IChleHRlbnQuaGFzU3ViY2xhc3NlcygpDQogICAg\nICAgICAgICAgICAgICAgICAgICAmJiBleHRlbnQuZ2V0RWxlbWVudFR5cGUo\nKS5pc0Fzc2lnbmFibGVGcm9tKGNscykpKQ0KICAgICAgICAgICAgICAgICAg\nICAgICAgZXZpY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIGNhbGwpOw0K\nICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBm\naW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgZXZpY3QoT2JqZWN0IG9i\naiwgT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBpZiAob2JqID09IG51\nbGwpDQogICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0\ncnVlKTsNCiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2Fs\nbGJhY2tzLk9QX0VWSUNULCBvYmosIHNtLCBjYWxsKQ0KICAgICAgICAgICAg\nICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkNCiAgICAgICAgICAg\nICAgICByZXR1cm47DQogICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkNCiAg\nICAgICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgICAgIHNtLmV2aWN0\nKCk7DQogICAgICAgICAgICBpZiAoX2V2aWN0RGF0YUNhY2hlICYmIHNtLmdl\ndE9iamVjdElkKCkgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIERhdGFD\nYWNoZSBjYWNoZSA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGF0YUNhY2hlKCk7\nDQogICAgICAgICAgICAgICAgaWYgKGNhY2hlICE9IG51bGwpDQogICAgICAg\nICAgICAgICAgICAgIGNhY2hlLnJlbW92ZShzbS5nZXRPYmplY3RJZCgpKTsN\nCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAgICAgdGhyb3cga2U7DQog\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsNCiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsNCiAgICAg\nICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0K\nICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIE9iamVjdCBkZXRhY2go\nT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAgICBpZiAo\nb2JqID09IG51bGwpDQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAg\nICAgaWYgKGNhbGwgPT0gbnVsbCkNCiAgICAgICAgICAgIGNhbGwgPSBfY2Fs\nbDsNCg0KICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsNCiAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgRGV0YWNoTWFuYWdlcih0\naGlzLCBmYWxzZSwgY2FsbCkuZGV0YWNoKG9iaik7DQogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgIHRocm93\nIGtlOw0KICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nDQogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7\nDQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3Rb\nXSBkZXRhY2hBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxs\nKSB7DQogICAgICAgIGlmIChvYmpzID09IG51bGwpDQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsNCiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQ0KICAg\nICAgICAgICAgcmV0dXJuIEVNUFRZX09CSkVDVFM7DQogICAgICAgIGlmIChj\nYWxsID09IG51bGwpDQogICAgICAgICAgICBjYWxsID0gX2NhbGw7DQoNCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQog\nICAgICAgICAgICByZXR1cm4gbmV3IERldGFjaE1hbmFnZXIodGhpcywgZmFs\nc2UsIGNhbGwpLmRldGFjaEFsbChvYmpzKTsNCiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAgICAgICAgICAgdGhyb3cga2U7\nDQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsNCiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsNCiAg\nICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgZGV0YWNo\nQWxsKE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAgZGV0YWNoQWxsKGNh\nbGwsIHRydWUpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGRldGFjaEFs\nbChPcENhbGxiYWNrcyBjYWxsLCBib29sZWFuIGZsdXNoKSB7DQogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgLy8gSWYgYSBmbHVzaCBpcyBkZXNpcmVkIChiYXNlZCBvbiBpbnB1\ndCBwYXJtKSwgdGhlbiBjaGVjayBpZiB0aGUNCiAgICAgICAgICAgIC8vICAg\nImRpcnR5IiBmbGFnIGlzIHNldCBiZWZvcmUgY2FsbGluZyBmbHVzaCgpLg0K\nICAgICAgICAgICAgaWYgKChmbHVzaCkgJiYgKChfZmxhZ3MgJiBGTEFHX0ZM\nVVNIX1JFUVVJUkVEKSAhPSAwKSkNCiAgICAgICAgICAgICAgICBmbHVzaCgp\nOw0KICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwoY2FsbCk7DQogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAg\nICAgIHRocm93IGtlOw0KICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihyZSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHByaXZh\ndGUgdm9pZCBkZXRhY2hBbGxJbnRlcm5hbChPcENhbGxiYWNrcyBjYWxsKSB7\nDQogICAgICAgIENvbGxlY3Rpb24gc3RhdGVzID0gZ2V0TWFuYWdlZFN0YXRl\ncygpOw0KICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOw0KICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHN0YXRlcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgew0KICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1w\nbCkgaXRyLm5leHQoKTsNCiAgICAgICAgICAgIGlmICghc20uaXNQZXJzaXN0\nZW50KCkpDQogICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOw0KICAgICAg\nICAgICAgZWxzZSBpZiAoIXNtLmdldE1ldGFEYXRhKCkuaXNEZXRhY2hhYmxl\nKCkpIHsNCiAgICAgICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOw0KICAg\nICAgICAgICAgICAgIGl0ci5yZW1vdmUoKTsNCiAgICAgICAgICAgIH0NCiAg\nICAgICAgfQ0KICAgICAgICBpZiAoc3RhdGVzLmlzRW1wdHkoKSkNCiAgICAg\nICAgICAgIHJldHVybjsNCg0KICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQ0K\nICAgICAgICAgICAgY2FsbCA9IF9jYWxsOw0KICAgICAgICBuZXcgRGV0YWNo\nTWFuYWdlcih0aGlzLCB0cnVlLCBjYWxsKS5kZXRhY2hBbGwNCiAgICAgICAg\nICAgIChuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oc3RhdGVzKSk7DQog\nICAgfQ0KDQogICAgcHVibGljIE9iamVjdCBhdHRhY2goT2JqZWN0IG9iaiwg\nYm9vbGVhbiBjb3B5TmV3LCBPcENhbGxiYWNrcyBjYWxsKSB7DQogICAgICAg\nIGlmIChvYmogPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0K\nDQogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkg\new0KICAgICAgICAgICAgLy8gbWFrZSBzdXJlIG5vdCB0byB0cnkgdG8gc2V0\nIHJvbGxiYWNrIG9ubHkgaWYgdGhpcyBmYWlscw0KICAgICAgICAgICAgYXNz\nZXJ0V3JpdGVPcGVyYXRpb24oKTsNCiAgICAgICAgICAgIHRyeSB7DQogICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBBdHRhY2hNYW5hZ2VyKHRoaXMsIGNv\ncHlOZXcsIGNhbGwpLmF0dGFjaChvYmopOw0KICAgICAgICAgICAgfSBjYXRj\naCAoT3B0aW1pc3RpY0V4Y2VwdGlvbiBvZSkgew0KICAgICAgICAgICAgICAg\nIHNldFJvbGxiYWNrT25seShvZSk7DQogICAgICAgICAgICAgICAgdGhyb3cg\nb2Uuc2V0RmF0YWwodHJ1ZSk7DQogICAgICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICAgICAgdGhyb3cga2U7\nDQogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZpbmFs\nbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0N\nCiAgICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0W10gYXR0YWNoQWxsKENvbGxl\nY3Rpb24gb2JqcywgYm9vbGVhbiBjb3B5TmV3LA0KICAgICAgICBPcENhbGxi\nYWNrcyBjYWxsKSB7DQogICAgICAgIGlmIChvYmpzID09IG51bGwpDQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgaWYgKG9ianMuaXNFbXB0\neSgpKQ0KICAgICAgICAgICAgcmV0dXJuIEVNUFRZX09CSkVDVFM7DQoNCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQogICAgICAgIHRyeSB7DQog\nICAgICAgICAgICAvLyBtYWtlIHN1cmUgbm90IHRvIHRyeSB0byBzZXQgcm9s\nbGJhY2sgb25seSBpZiB0aGlzIGZhaWxzDQogICAgICAgICAgICBhc3NlcnRX\ncml0ZU9wZXJhdGlvbigpOw0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IEF0dGFjaE1hbmFnZXIodGhpcywgY29weU5l\ndywgY2FsbCkuYXR0YWNoQWxsKG9ianMpOw0KICAgICAgICAgICAgfSBjYXRj\naCAoT3B0aW1pc3RpY0V4Y2VwdGlvbiBvZSkgew0KICAgICAgICAgICAgICAg\nIHNldFJvbGxiYWNrT25seShvZSk7DQogICAgICAgICAgICAgICAgdGhyb3cg\nb2Uuc2V0RmF0YWwodHJ1ZSk7DQogICAgICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICAgICAgdGhyb3cga2U7\nDQogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZpbmFs\nbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0N\nCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBub250cmFuc2FjdGlvbmFsQWxs\nKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgew0KICAgICAg\nICBiZWdpbk9wZXJhdGlvbih0cnVlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAg\nICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsNCiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAg\nICAgIG5vbnRyYW5zYWN0aW9uYWwoaXRyLm5leHQoKSwgY2FsbCk7DQogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgew0KICAg\nICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7DQog\nICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAg\ndGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOw0KICAgICAg\nICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQog\nICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBub250cmFuc2Fj\ndGlvbmFsKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuOw0KDQog\nICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0K\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFu\nYWdlckltcGwob2JqLCB0cnVlKTsNCiAgICAgICAgICAgIGlmICgocHJvY2Vz\nc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX05PTlRSQU5TQUNUSU9OQUwsIG9i\naiwgc20sIGNhbGwpDQogICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5B\nQ1RfUlVOKSA9PSAwKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAg\nICAgICAgIGlmIChzbSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHNtLm5v\nbnRyYW5zYWN0aW9uYWwoKTsNCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgew0KICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBm\naW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogTWFrZSB0aGUgZ2l2ZW4g\naW5zdGFuY2VzIHRyYW5zYWN0aW9uYWwuDQogICAgICovDQogICAgcHVibGlj\nIHZvaWQgdHJhbnNhY3Rpb25hbEFsbChDb2xsZWN0aW9uIG9ianMsIGJvb2xl\nYW4gdXBkYXRlVmVyc2lvbiwNCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkg\new0KICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpDQogICAgICAgICAgICBy\nZXR1cm47DQogICAgICAgIGlmIChvYmpzLnNpemUoKSA9PSAxKSB7DQogICAg\nICAgICAgICB0cmFuc2FjdGlvbmFsKG9ianMuaXRlcmF0b3IoKS5uZXh0KCks\nIHVwZGF0ZVZlcnNpb24sIGNhbGwpOw0KICAgICAgICAgICAgcmV0dXJuOw0K\nICAgICAgICB9DQoNCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7DQog\nICAgICAgIHRyeSB7DQogICAgICAgICAgICAvLyBjb2xsZWN0IGFsbCBob2xs\nb3cgaW5zdGFuY2VzIGZvciBsb2FkLCBhbmQgbWFrZSB1bm1hbmFuZ2VkDQog\nICAgICAgICAgICAvLyBpbnN0YW5jZXMgdHJhbnNpZW50LXRyYW5zYWN0aW9u\nYWwNCiAgICAgICAgICAgIENvbGxlY3Rpb24gbG9hZCA9IG51bGw7DQogICAg\nICAgICAgICBPYmplY3Qgb2JqOw0KICAgICAgICAgICAgU3RhdGVNYW5hZ2Vy\nSW1wbCBzbTsNCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YTsNCiAg\nICAgICAgICAgIENvbGxlY3Rpb24gc21zID0gbmV3IEFycmF5TGlzdChvYmpz\nLnNpemUoKSk7DQogICAgICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7DQog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgICAgICBvYmogPSBp\ndHIubmV4dCgpOw0KICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkN\nCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQoNCiAgICAgICAgICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRl\nTWFuYWdlckltcGwob2JqLCB0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAg\naWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfVFJBTlNBQ1RJ\nT05BTCwgb2JqLCBzbSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGwp\nICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkNCiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOw0KDQogICAgICAgICAgICAgICAgICAgIGlm\nIChzbSA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBt\nYW5hZ2UgdHJhbnNpZW50IGluc3RhbmNlDQogICAgICAgICAgICAgICAgICAg\nICAgICBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFu\nY2UoKS4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRNZXRhRGF0\nYShvYmouZ2V0Q2xhc3MoKSwgX2xvYWRlciwgdHJ1ZSk7DQoNCiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwNCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAoU3RhdGVNYW5hZ2VySWQubmV3\nSW5zdGFuY2UodGhpcyksIG1ldGEsIHRoaXMpOw0KICAgICAgICAgICAgICAg\nICAgICAgICAgc20uaW5pdGlhbGl6ZShhc3NlcnRQZXJzaXN0ZW5jZUNhcGFi\nbGUob2JqKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ1N0YXRl\nLlRDTEVBTik7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc20u\naXNQZXJzaXN0ZW50KCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFz\nc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7DQogICAgICAgICAgICAgICAgICAg\nICAgICBzbXMuYWRkKHNtKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xMT1cpIHsNCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZCA9PSBudWxsKQ0KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkID0gbmV3IEFycmF5\nTGlzdCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQuYWRk\nKHNtKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAg\nICAgICAgICAgICAgICAgc20uc2V0Q2hlY2tWZXJzaW9uKHRydWUpOw0KICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKHVwZGF0ZVZlcnNpb24pDQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0VXBkYXRlVmVyc2lvbih0\ncnVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFH\nX0ZMVVNIX1JFUVVJUkVEOyAvLyB2ZXJzaW9uIGNoZWNrL3VwDQogICAgICAg\nICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAg\nICAgICAgY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsNCiAgICAgICAgICAg\nICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOw0KICAgICAgICAg\nICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gbG9h\nZCBhbGwgaG9sbG93IGluc3RhbmNlcw0KICAgICAgICAgICAgQ29sbGVjdGlv\nbiBmYWlsZWQgPSBudWxsOw0KICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVs\nbCkgew0KICAgICAgICAgICAgICAgIGZhaWxlZCA9IF9zdG9yZS5sb2FkQWxs\nKGxvYWQsIG51bGwsIF9zdG9yZS5GT1JDRV9MT0FEX05PTkUsDQogICAgICAg\nICAgICAgICAgICAgIF9mYywgbnVsbCk7DQogICAgICAgICAgICAgICAgaWYg\nKGZhaWxlZCAhPSBudWxsICYmICFmYWlsZWQuaXNFbXB0eSgpKQ0KICAgICAg\nICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLA0KICAgICAgICAg\nICAgICAgICAgICAgICAgbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFp\nbGVkKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRyYW5zYWN0\naW9uYWxTdGF0ZXNBbGwoc21zLCBmYWlsZWQsIGV4Y2Vwcyk7DQogICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAg\nIHRocm93IGtlOw0KICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihyZSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAg\nICAqIE1ha2UgdGhlIGdpdmVuIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFsLg0K\nICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIHRyYW5zYWN0aW9uYWwoT2JqZWN0\nIG9iaiwgYm9vbGVhbiB1cGRhdGVWZXJzaW9uLA0KICAgICAgICBPcENhbGxi\nYWNrcyBjYWxsKSB7DQogICAgICAgIGlmIChvYmogPT0gbnVsbCkNCiAgICAg\nICAgICAgIHJldHVybjsNCg0KICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVl\nKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7DQogICAg\nICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9U\nUkFOU0FDVElPTkFMLCBvYmosIHNtLCBjYWxsKQ0KICAgICAgICAgICAgICAg\nICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkNCiAgICAgICAgICAgICAg\nICByZXR1cm47DQoNCiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsICYmIHNt\nLmlzUGVyc2lzdGVudCgpKSB7DQogICAgICAgICAgICAgICAgYXNzZXJ0QWN0\naXZlVHJhbnNhY3Rpb24oKTsNCiAgICAgICAgICAgICAgICBzbS50cmFuc2Fj\ndGlvbmFsKCk7DQogICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRl\nTWFuYWdlckltcGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsNCiAg\nICAgICAgICAgICAgICBzbS5zZXRDaGVja1ZlcnNpb24odHJ1ZSk7DQogICAg\nICAgICAgICAgICAgaWYgKHVwZGF0ZVZlcnNpb24pDQogICAgICAgICAgICAg\nICAgICAgIHNtLnNldFVwZGF0ZVZlcnNpb24odHJ1ZSk7DQogICAgICAgICAg\nICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7IC8vIHZlcnNp\nb24gY2hlY2svdXANCiAgICAgICAgICAgIH0gZWxzZSBpZiAoc20gPT0gbnVs\nbCkgew0KICAgICAgICAgICAgICAgIC8vIG1hbmFnZSB0cmFuc2llbnQgaW5z\ndGFuY2UNCiAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBf\nY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLg0KICAgICAg\nICAgICAgICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0Q2xhc3MoKSwgX2xv\nYWRlciwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgT2JqZWN0IGlkID0gU3Rh\ndGVNYW5hZ2VySWQubmV3SW5zdGFuY2UodGhpcyk7DQogICAgICAgICAgICAg\nICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChpZCwgbWV0YSwgdGhpcyk7\nDQogICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShhc3NlcnRQZXJzaXN0\nZW5jZUNhcGFibGUob2JqKSwNCiAgICAgICAgICAgICAgICAgICAgUENTdGF0\nZS5UQ0xFQU4pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAg\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0\naHJvdyBrZTsNCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAg\nKiBUcmFuc2l0aW9uIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VycyB0byB0cmFu\nc2FjdGlvbmFsLg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9pZCB0cmFuc2Fj\ndGlvbmFsU3RhdGVzQWxsKENvbGxlY3Rpb24gc21zLCBDb2xsZWN0aW9uIGZh\naWxlZCwNCiAgICAgICAgTGlzdCBleGNlcHMpIHsNCiAgICAgICAgLy8gbWFr\nZSBpbnN0YW5jZXMgdHJhbnNhY3Rpb25hbCBhbmQgbWFrZSBzdXJlIHRoZXkg\nYXJlIGxvYWRlZA0KICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOw0KICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgew0KICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2Vy\nSW1wbCkgaXRyLm5leHQoKTsNCiAgICAgICAgICAgIGlmIChmYWlsZWQgIT0g\nbnVsbCAmJiBmYWlsZWQuY29udGFpbnMoc20uZ2V0SWQoKSkpDQogICAgICAg\nICAgICAgICAgY29udGludWU7DQoNCiAgICAgICAgICAgIHRyeSB7DQogICAg\nICAgICAgICAgICAgc20udHJhbnNhY3Rpb25hbCgpOw0KICAgICAgICAgICAg\nICAgIHNtLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBu\ndWxsLCBudWxsLCBmYWxzZSk7DQogICAgICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICAgICAgZXhjZXBzID0g\nYWRkKGV4Y2Vwcywga2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQog\nICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsN\nCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vLy8vLy8vLw0KICAgIC8vIEV4dGVu\ndCwgUXVlcnkNCiAgICAvLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgcHVibGlj\nIEV4dGVudCBuZXdFeHRlbnQoQ2xhc3MgdHlwZSwgYm9vbGVhbiBzdWJjbGFz\nc2VzKSB7DQogICAgICAgIHJldHVybiBuZXdFeHRlbnQodHlwZSwgc3ViY2xh\nc3NlcywgbnVsbCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBFeHRlbnQgbmV3\nRXh0ZW50KENsYXNzIHR5cGUsIGJvb2xlYW4gc3ViY2xhc3NlcywNCiAgICAg\nICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7DQogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nRXh0ZW50SW1wbCBleHRlbnQgPSBuZXcgRXh0ZW50SW1wbCh0aGlzLCB0eXBl\nLCBzdWJjbGFzc2VzLCBmZXRjaCk7DQogICAgICAgICAgICBpZiAoX2V4dGVu\ndHMgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBfZXh0ZW50cyA9IG5ldyBS\nZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hTZXQuV0VBSyk7DQogICAg\nICAgICAgICBfZXh0ZW50cy5hZGQoZXh0ZW50KTsNCg0KICAgICAgICAgICAg\ncmV0dXJuIGV4dGVudDsNCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgew0KICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0g\nY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBmaW5h\nbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9\nDQogICAgfQ0KDQogICAgcHVibGljIEl0ZXJhdG9yIGV4dGVudEl0ZXJhdG9y\nKENsYXNzIHR5cGUsIGJvb2xlYW4gc3ViY2xhc3NlcywNCiAgICAgICAgRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLCBib29sZWFuIGlnbm9yZUNoYW5nZXMp\nIHsNCiAgICAgICAgRXh0ZW50IGV4dGVudCA9IG5ld0V4dGVudCh0eXBlLCBz\ndWJjbGFzc2VzLCBmZXRjaCk7DQogICAgICAgIGV4dGVudC5zZXRJZ25vcmVD\naGFuZ2VzKGlnbm9yZUNoYW5nZXMpOw0KICAgICAgICByZXR1cm4gZXh0ZW50\nLml0ZXJhdG9yKCk7DQogICAgfQ0KDQogICAgcHVibGljIFF1ZXJ5IG5ld1F1\nZXJ5KFN0cmluZyBsYW5nLCBDbGFzcyBjbHMsIE9iamVjdCBxdWVyeSkgew0K\nICAgICAgICBRdWVyeSBxID0gbmV3UXVlcnkobGFuZywgcXVlcnkpOw0KICAg\nICAgICBxLnNldENhbmRpZGF0ZVR5cGUoY2xzLCB0cnVlKTsNCiAgICAgICAg\ncmV0dXJuIHE7DQogICAgfQ0KDQogICAgcHVibGljIFF1ZXJ5IG5ld1F1ZXJ5\nKFN0cmluZyBsYW5nLCBPYmplY3QgcXVlcnkpIHsNCiAgICAgICAgLy8gY29t\nbW9uIG1pc3Rha2VzDQogICAgICAgIGlmIChxdWVyeSBpbnN0YW5jZW9mIEV4\ndGVudCB8fCBxdWVyeSBpbnN0YW5jZW9mIENsYXNzKQ0KICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1uZXctcXVl\ncnkiKSk7DQoNCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOw0KICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgU3RvcmVRdWVyeSBzcSA9IF9zdG9y\nZS5uZXdRdWVyeShsYW5nKTsNCiAgICAgICAgICAgIGlmIChzcSA9PSBudWxs\nKSB7DQogICAgICAgICAgICAgICAgRXhwcmVzc2lvblBhcnNlciBlcCA9IFF1\nZXJ5TGFuZ3VhZ2VzLnBhcnNlckZvckxhbmd1YWdlKGxhbmcpOw0KICAgICAg\nICAgICAgICAgIGlmIChlcCAhPSBudWxsKQ0KICAgICAgICAgICAgICAgICAg\nICBzcSA9IG5ldyBFeHByZXNzaW9uU3RvcmVRdWVyeShlcCk7DQogICAgICAg\nICAgICAgICAgZWxzZSBpZiAoUXVlcnlMYW5ndWFnZXMuTEFOR19NRVRIT0RR\nTC5lcXVhbHMobGFuZykpDQogICAgICAgICAgICAgICAgICAgIHNxID0gbmV3\nIE1ldGhvZFN0b3JlUXVlcnkoKTsNCiAgICAgICAgICAgICAgICBlbHNlDQog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2Vw\ndGlvbihsYW5nKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgUXVl\ncnkgcSA9IG5ld1F1ZXJ5SW1wbChsYW5nLCBzcSk7DQogICAgICAgICAgICBx\nLnNldElnbm9yZUNoYW5nZXMoX2lnbm9yZUNoYW5nZXMpOw0KICAgICAgICAg\nICAgaWYgKHF1ZXJ5ICE9IG51bGwpDQogICAgICAgICAgICAgICAgcS5zZXRR\ndWVyeShxdWVyeSk7DQoNCiAgICAgICAgICAgIC8vIHRyYWNrIHF1ZXJpZXMN\nCiAgICAgICAgICAgIGlmIChfcXVlcmllcyA9PSBudWxsKQ0KICAgICAgICAg\nICAgICAgIF9xdWVyaWVzID0gbmV3IFJlZmVyZW5jZUhhc2hTZXQoUmVmZXJl\nbmNlSGFzaFNldC5XRUFLKTsNCiAgICAgICAgICAgIF9xdWVyaWVzLmFkZChx\nKTsNCiAgICAgICAgICAgIHJldHVybiBxOw0KICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJvdyBrZTsN\nCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOw0KICAg\nICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGUg\nYSBuZXcgcXVlcnkuDQogICAgICovDQogICAgcHJvdGVjdGVkIFF1ZXJ5SW1w\nbCBuZXdRdWVyeUltcGwoU3RyaW5nIGxhbmcsIFN0b3JlUXVlcnkgc3EpIHsN\nCiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUltcGwodGhpcywgbGFuZywgc3Ep\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyBTZXEgZ2V0SWRlbnRpdHlTZXF1ZW5j\nZShDbGFzc01ldGFEYXRhIG1ldGEpIHsNCiAgICAgICAgaWYgKG1ldGEgPT0g\nbnVsbCkNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICByZXR1\ncm4gZ2V0U2VxdWVuY2UobWV0YSwgbnVsbCk7DQogICAgfQ0KDQogICAgcHVi\nbGljIFNlcSBnZXRWYWx1ZVNlcXVlbmNlKEZpZWxkTWV0YURhdGEgZm1kKSB7\nDQogICAgICAgIGlmIChmbWQgPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOw0KICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2UoZm1kLmdldERl\nZmluaW5nTWV0YURhdGEoKSwgZm1kKTsNCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBSZXR1cm4gYSBzZXF1ZW5jZSBmb3IgdGhlIGdpdmVuIGNsYXNzIGFu\nZCBvcHRpb25hbCBmaWVsZC4NCiAgICAgKi8NCiAgICBwcml2YXRlIFNlcSBn\nZXRTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEsIEZpZWxkTWV0YURhdGEg\nZm1kKSB7DQogICAgICAgIC8vIGdldCBzZXF1ZW5jZSBzdHJhdGVneSBmcm9t\nIG1ldGFkYXRhDQogICAgICAgIGludCBzdHJhdGVneTsNCiAgICAgICAgaWYg\nKGZtZCA9PSBudWxsKQ0KICAgICAgICAgICAgc3RyYXRlZ3kgPSBtZXRhLmdl\ndElkZW50aXR5U3RyYXRlZ3koKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAg\nICAgc3RyYXRlZ3kgPSBmbWQuZ2V0VmFsdWVTdHJhdGVneSgpOw0KDQogICAg\nICAgIC8vIHdlIGNhbiBoYW5kbGUgbm9uLW5hdGl2ZSBzdHJhdGVnaWVzIHdp\ndGhvdXQgdGhlIHN0b3JlIG1hbmFnZXINCiAgICAgICAgc3dpdGNoIChzdHJh\ndGVneSkgew0KICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMuVVVJ\nRF9IRVg6DQogICAgICAgICAgICAgICAgcmV0dXJuIFVVSURIZXhTZXEuZ2V0\nSW5zdGFuY2UoKTsNCiAgICAgICAgICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVz\nLlVVSURfU1RSSU5HOg0KICAgICAgICAgICAgICAgIHJldHVybiBVVUlEU3Ry\naW5nU2VxLmdldEluc3RhbmNlKCk7DQogICAgICAgICAgICBjYXNlIFZhbHVl\nU3RyYXRlZ2llcy5VVUlEX1RZUEU0X0hFWDoNCiAgICAgICAgICAgICAgICBy\nZXR1cm4gVVVJRFR5cGU0SGV4U2VxLmdldEluc3RhbmNlKCk7DQogICAgICAg\nICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX1RZUEU0X1NUUklORzoN\nCiAgICAgICAgICAgICAgICByZXR1cm4gVVVJRFR5cGU0U3RyaW5nU2VxLmdl\ndEluc3RhbmNlKCk7DQogICAgICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2ll\ncy5TRVFVRU5DRToNCiAgICAgICAgICAgICAgICBTZXF1ZW5jZU1ldGFEYXRh\nIHNtZCA9IChmbWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgPyBt\nZXRhLmdldElkZW50aXR5U2VxdWVuY2VNZXRhRGF0YSgpDQogICAgICAgICAg\nICAgICAgICAgIDogZm1kLmdldFZhbHVlU2VxdWVuY2VNZXRhRGF0YSgpOw0K\nICAgICAgICAgICAgICAgIHJldHVybiBzbWQuZ2V0SW5zdGFuY2UoX2xvYWRl\ncik7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIC8v\nIHVzZSBzdG9yZSBtYW5hZ2VyIGZvciBuYXRpdmUgc2VxdWVuY2UNCiAgICAg\nICAgICAgICAgICBpZiAoZm1kID09IG51bGwpIHsNCiAgICAgICAgICAgICAg\nICAgICAgLy8gdGhpcyB3aWxsIHJldHVybiBhIHNlcXVlbmNlIGV2ZW4gZm9y\nIGFwcCBpZCBjbGFzc2VzLA0KICAgICAgICAgICAgICAgICAgICAvLyB3aGlj\naCBpcyB3aGF0IHdlIHdhbnQgZm9yIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5\nDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfc3RvcmUuZ2V0RGF0YVN0\nb3JlSWRTZXF1ZW5jZShtZXRhKTsNCiAgICAgICAgICAgICAgICB9DQogICAg\nICAgICAgICAgICAgcmV0dXJuIF9zdG9yZS5nZXRWYWx1ZVNlcXVlbmNlKGZt\nZCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vLw0KICAg\nIC8vIExvY2tpbmcNCiAgICAvLy8vLy8vLy8vLw0KDQogICAgcHVibGljIHZv\naWQgbG9jayhPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7DQogICAg\nICAgIGlmIChvYmogPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybjsNCg0K\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsgLy8gaGF2ZSB0byBzeW5j\nIG9yIGxvY2sgbGV2ZWwgYWx3YXlzIE5PTkUNCiAgICAgICAgdHJ5IHsNCiAg\nICAgICAgICAgIGxvY2sob2JqLCBfZmMuZ2V0V3JpdGVMb2NrTGV2ZWwoKSwg\nX2ZjLmdldExvY2tUaW1lb3V0KCksIGNhbGwpOw0KICAgICAgICB9IGZpbmFs\nbHkgew0KICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7DQogICAgICAgIH0N\nCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBsb2NrKE9iamVjdCBvYmosIGlu\ndCBsZXZlbCwgaW50IHRpbWVvdXQsIE9wQ2FsbGJhY2tzIGNhbGwpIHsNCiAg\nICAgICAgaWYgKG9iaiA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuOw0K\nDQogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOw0KICAgICAgICB0cnkg\new0KICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsNCg0K\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFu\nYWdlckltcGwob2JqLCB0cnVlKTsNCiAgICAgICAgICAgIGlmICgocHJvY2Vz\nc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX0xPQ0ssIG9iaiwgc20sIGNhbGwp\nDQogICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAw\nKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIGlmIChz\nbSA9PSBudWxsIHx8ICFzbS5pc1BlcnNpc3RlbnQoKSkNCiAgICAgICAgICAg\nICAgICByZXR1cm47DQoNCiAgICAgICAgICAgIF9sbS5sb2NrKHNtLCBsZXZl\nbCwgdGltZW91dCwgbnVsbCk7DQogICAgICAgICAgICBzbS5yZWFkTG9ja2Vk\nKGxldmVsLCBsZXZlbCk7IC8vIHVzZSBzYW1lIGxldmVsIGZvciBmdXR1cmUg\nd3JpdGUNCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\new0KICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBH\nZW5lcmFsRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAg\nICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0K\nDQogICAgcHVibGljIHZvaWQgbG9ja0FsbChDb2xsZWN0aW9uIG9ianMsIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsNCiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgp\nKQ0KICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOyAvLyBoYXZlIHRvIHN5bmMgb3IgbG9jayBsZXZlbCBhbHdh\neXMgTk9ORQ0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgbG9ja0FsbChv\nYmpzLCBfZmMuZ2V0V3JpdGVMb2NrTGV2ZWwoKSwgX2ZjLmdldExvY2tUaW1l\nb3V0KCksDQogICAgICAgICAgICAgICAgY2FsbCk7DQogICAgICAgIH0gZmlu\nYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAg\nfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGxvY2tBbGwoQ29sbGVjdGlv\nbiBvYmpzLCBpbnQgbGV2ZWwsIGludCB0aW1lb3V0LA0KICAgICAgICBPcENh\nbGxiYWNrcyBjYWxsKSB7DQogICAgICAgIGlmIChvYmpzLmlzRW1wdHkoKSkN\nCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgaWYgKG9ianMuc2l6ZSgp\nID09IDEpIHsNCiAgICAgICAgICAgIGxvY2sob2Jqcy5pdGVyYXRvcigpLm5l\neHQoKSwgbGV2ZWwsIHRpbWVvdXQsIGNhbGwpOw0KICAgICAgICAgICAgcmV0\ndXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1\nZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhc3NlcnRBY3RpdmVU\ncmFuc2FjdGlvbigpOw0KDQogICAgICAgICAgICBDb2xsZWN0aW9uIHNtcyA9\nIG5ldyBBcnJheUxpc3Qob2Jqcy5zaXplKCkpOw0KICAgICAgICAgICAgT2Jq\nZWN0IG9iajsNCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207DQog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgICAgICBvYmogPSBp\ndHIubmV4dCgpOw0KICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkN\nCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQoNCiAgICAgICAgICAg\nICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsNCiAg\nICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNr\ncy5PUF9MT0NLLCBvYmosIHNtLCBjYWxsKQ0KICAgICAgICAgICAgICAgICAg\nICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApDQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIGlmIChzbSAhPSBu\ndWxsICYmIHNtLmlzUGVyc2lzdGVudCgpKQ0KICAgICAgICAgICAgICAgICAg\nICBzbXMuYWRkKHNtKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAg\nX2xtLmxvY2tBbGwoc21zLCBsZXZlbCwgdGltZW91dCwgbnVsbCk7DQogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykNCiAgICAgICAgICAgICAgICAoKFN0YXRlTWFuYWdl\nckltcGwpIGl0ci5uZXh0KCkpLnJlYWRMb2NrZWQobGV2ZWwsIGxldmVsKTsN\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0KICAg\nICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAg\nLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBDb25uZWN0aW9uDQogICAgLy8vLy8v\nLy8vLy8vLy8NCg0KICAgIHB1YmxpYyBib29sZWFuIGNhbmNlbEFsbCgpIHsN\nCiAgICAgICAgLy8gdGhpcyBtZXRob2QgZG9lcyBub3QgbG9jaywgc2luY2Ug\nd2Ugd2FudCB0byBhbGxvdyBhIGRpZmZlcmVudA0KICAgICAgICAvLyB0aHJl\nYWQgdG8gYmUgYWJsZSB0byBjYW5jZWwgb24gYSBsb2NrZWQtdXAgcGVyc2lz\ndGVuY2UgbWFuYWdlcg0KDQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGZsdXNoaW5nLCBo\nYXZlIHRvIHNldCByb2xsYmFjayBvbmx5IC0tIGRvIHRoaXMgYmVmb3JlIHdl\nDQogICAgICAgICAgICAvLyBhdHRlbXB0IHRvIGNhbmNlbCwgYmVjYXVzZSBv\ndGhlcndpc2UgdGhlIGNhbmNlbCBtaWdodCBjYXNlIHRoZQ0KICAgICAgICAg\nICAgLy8gdHJhbnNhY3Rpb24gdG8gY29tcGxldGUgYmVmb3JlIHdlIGhhdmUg\nYSBjaGFuY2UgdG8gc2V0IHRoZQ0KICAgICAgICAgICAgLy8gcm9sbGJhY2sg\nb25seSBmbGFnDQogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RP\nUkVfRkxVU0hJTkcpICE9IDApDQogICAgICAgICAgICAgICAgc2V0Um9sbGJh\nY2tPbmx5SW50ZXJuYWwobmV3IFVzZXJFeGNlcHRpb24oKSk7DQogICAgICAg\nICAgICByZXR1cm4gX3N0b3JlLmNhbmNlbEFsbCgpOw0KICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJv\ndyBrZTsNCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\new0KICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHJlKTsN\nCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3QgZ2V0Q29u\nbmVjdGlvbigpIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBp\nZiAoIV9jb25mLnN1cHBvcnRlZE9wdGlvbnMoKS5jb250YWlucw0KICAgICAg\nICAgICAgKF9jb25mLk9QVElPTl9EQVRBU1RPUkVfQ09OTkVDVElPTikpDQog\nICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xv\nYy5nZXQoImNvbm4tbm90LXN1cHBvcnRlZCIpKTsNCg0KICAgICAgICByZXR1\ncm4gX3N0b3JlLmdldENsaWVudENvbm5lY3Rpb24oKTsNCiAgICB9DQoNCiAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNDb25uZWN0aW9uKCkgew0KICAgICAgICBh\nc3NlcnRPcGVuKCk7DQogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19S\nRVRBSU5FRF9DT05OKSAhPSAwOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAq\nIFRlbGwgc3RvcmUgdG8gcmV0YWluIGNvbm5lY3Rpb24gaWYgd2UgaGF2ZW4n\ndCBhbHJlYWR5Lg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9pZCByZXRhaW5D\nb25uZWN0aW9uKCkgew0KICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfUkVU\nQUlORURfQ09OTikgPT0gMCkgew0KICAgICAgICAgICAgX3N0b3JlLnJldGFp\nbkNvbm5lY3Rpb24oKTsNCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1JF\nVEFJTkVEX0NPTk47DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBUZWxsIHN0b3JlIHRvIHJlbGVhc2UgY29ubmVjdGlvbiBpZiB3ZSBo\nYXZlIHJldGFpbmVkIG9uZS4NCiAgICAgKi8NCiAgICBwcml2YXRlIHZvaWQg\ncmVsZWFzZUNvbm5lY3Rpb24oKSB7DQogICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19SRVRBSU5FRF9DT05OKSAhPSAwKSB7DQogICAgICAgICAgICBfc3Rv\ncmUucmVsZWFzZUNvbm5lY3Rpb24oKTsNCiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19SRVRBSU5FRF9DT05OOw0KICAgICAgICB9DQogICAgfQ0KDQog\nICAgLy8vLy8vLy8vDQogICAgLy8gQ2FjaGUNCiAgICAvLy8vLy8vLy8NCg0K\nICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldE1hbmFnZWRPYmplY3RzKCkgew0K\nICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAgICAgIHRyeSB7\nDQogICAgICAgICAgICByZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0\naW9uKGdldE1hbmFnZWRTdGF0ZXMoKSk7DQogICAgICAgIH0gZmluYWxseSB7\nDQogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAg\nIH0NCg0KICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldFRyYW5zYWN0aW9uYWxP\nYmplY3RzKCkgew0KICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7DQog\nICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IE1hbmFnZWRP\nYmplY3RDb2xsZWN0aW9uKGdldFRyYW5zYWN0aW9uYWxTdGF0ZXMoKSk7DQog\nICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBDb2xsZWN0aW9u\nIGdldFBlbmRpbmdUcmFuc2FjdGlvbmFsT2JqZWN0cygpIHsNCiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOw0KICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgcmV0dXJuIG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbg0KICAg\nICAgICAgICAgICAgIChnZXRQZW5kaW5nVHJhbnNhY3Rpb25hbFN0YXRlcygp\nKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIENvbGxl\nY3Rpb24gZ2V0RGlydHlPYmplY3RzKCkgew0KICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXR1\ncm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKGdldERpcnR5U3RhdGVz\nKCkpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgYm9v\nbGVhbiBnZXRPcmRlckRpcnR5T2JqZWN0cygpIHsNCiAgICAgICAgcmV0dXJu\nIF9vcmRlckRpcnR5Ow0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldE9y\nZGVyRGlydHlPYmplY3RzKGJvb2xlYW4gb3JkZXIpIHsNCiAgICAgICAgX29y\nZGVyRGlydHkgPSBvcmRlcjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBS\nZXR1cm4gYSBjb3B5IG9mIGFsbCBtYW5hZ2VkIHN0YXRlIG1hbmFnZXJzLg0K\nICAgICAqLw0KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGdldE1hbmFnZWRT\ndGF0ZXMoKSB7DQogICAgICAgIHJldHVybiBfY2FjaGUuY29weSgpOw0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIHRy\nYW5zYWN0aW9uYWwgc3RhdGUgbWFuYWdlcnMuDQogICAgICovDQogICAgcHJv\ndGVjdGVkIENvbGxlY3Rpb24gZ2V0VHJhbnNhY3Rpb25hbFN0YXRlcygpIHsN\nCiAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQ0KICAg\nICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7DQogICAg\nICAgIHJldHVybiBfdHJhbnNDYWNoZS5jb3B5KCk7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogV2hldGhlciBvciBub3QgdGhlcmUgYXJlIGFueSB0cmFu\nc2FjdGlvbmFsIG9iamVjdHMgaW4gdGhlIGN1cnJlbnQNCiAgICAgKiBwZXJz\naXN0ZW5jZSBjb250ZXh0LiBJZiB0aGVyZSBhcmUgYW55IGluc3RhbmNlcyB3\naXRoIHVudHJhY2tlZCBzdGF0ZSwNCiAgICAgKiB0aGlzIG1ldGhvZCB3aWxs\nIGNhdXNlIHRob3NlIGluc3RhbmNlcyB0byBiZSBzY2FubmVkLg0KICAgICAq\nLw0KICAgIHByaXZhdGUgYm9vbGVhbiBoYXNUcmFuc2FjdGlvbmFsT2JqZWN0\ncygpIHsNCiAgICAgICAgX2NhY2hlLmRpcnR5Q2hlY2soKTsNCiAgICAgICAg\ncmV0dXJuIF90cmFuc0NhY2hlICE9IG51bGw7DQogICAgfQ0KDQogICAgLyoq\nDQogICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgZGlydHkgc3RhdGUgbWFu\nYWdlcnMuDQogICAgICovDQogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gZ2V0\nRGlydHlTdGF0ZXMoKSB7DQogICAgICAgIGlmICghaGFzVHJhbnNhY3Rpb25h\nbE9iamVjdHMoKSkNCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5F\nTVBUWV9MSVNUOw0KDQogICAgICAgIHJldHVybiBfdHJhbnNDYWNoZS5jb3B5\nRGlydHkoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gYSBj\nb3B5IG9mIGFsbCBzdGF0ZSBtYW5hZ2VycyB3aGljaCB3aWxsIGJlY29tZQ0K\nICAgICAqIHRyYW5zYWN0aW9uYWwgdXBvbiB0aGUgbmV4dCB0cmFuc2FjdGlv\nbi4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXRQZW5k\naW5nVHJhbnNhY3Rpb25hbFN0YXRlcygpIHsNCiAgICAgICAgaWYgKF9wZW5k\naW5nID09IG51bGwpDQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMu\nRU1QVFlfTElTVDsNCiAgICAgICAgcmV0dXJuIG5ldyBBcnJheUxpc3QoX3Bl\nbmRpbmcpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNldCB0aGUgY2Fj\naGVkIFN0YXRlTWFuYWdlciBmb3IgdGhlIGluc3RhbmNlIHRoYXQgaGFkIHRo\nZSBnaXZlbiBvaWQuDQogICAgICogVGhpcyBtZXRob2QgbXVzdCBub3QgYmUg\nY2FsbGVkIG11bHRpcGxlIHRpbWVzIGZvciBuZXcgaW5zdGFuY2VzLg0KICAg\nICAqDQogICAgICogQHBhcmFtIGlkIHRoZSBpZCBwcmV2aW91c2x5IHVzZWQg\nYnkgdGhlIGluc3RhbmNlDQogICAgICogQHBhcmFtIHNtIHRoZSBzdGF0ZSBt\nYW5hZ2VyIGZvciB0aGUgaW5zdGFuY2U7IGlmIHRoZSBzdGF0ZQ0KICAgICAq\nIG1hbmFnZXIgaXMgdHJhbnNpZW50LCB3ZSdsbCBzdG9wIG1hbmFnaW5nIHRo\nZSBpbnN0YW5jZTsNCiAgICAgKiBpZiBpdCBoYXMgdXBkYXRlZCBpdHMgb2lk\nLCB3ZSdsbCByZS1jYWNoZSB1bmRlciB0aGUgbmV3IG9pZA0KICAgICAqIEBw\nYXJhbSBzdGF0dXMgb25lIG9mIG91ciBTVEFUVVMgY29uc3RhbnRzIGRlc2Ny\naWJpbmcgd2h5IHdlJ3JlDQogICAgICogc2V0dGluZyB0aGUgc3RhdGUgbWFu\nYWdlcg0KICAgICAqLw0KICAgIHZvaWQgc2V0U3RhdGVNYW5hZ2VyKE9iamVj\ndCBpZCwgU3RhdGVNYW5hZ2VySW1wbCBzbSwgaW50IHN0YXR1cykgew0KICAg\nICAgICBsb2NrKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBzd2l0\nY2ggKHN0YXR1cykgew0KICAgICAgICAgICAgICAgIGNhc2UgU1RBVFVTX0lO\nSVQ6DQogICAgICAgICAgICAgICAgICAgIF9jYWNoZS5hZGQoc20pOw0KICAg\nICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNl\nIFNUQVRVU19UUkFOU0lFTlQ6DQogICAgICAgICAgICAgICAgICAgIF9jYWNo\nZS5yZW1vdmUoaWQsIHNtKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nDQogICAgICAgICAgICAgICAgY2FzZSBTVEFUVVNfT0lEX0FTU0lHTjoNCiAg\nICAgICAgICAgICAgICAgICAgYXNzaWduT2JqZWN0SWQoX2NhY2hlLCBpZCwg\nc20pOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAg\nICAgICBjYXNlIFNUQVRVU19DT01NSVRfTkVXOg0KICAgICAgICAgICAgICAg\nICAgICBfY2FjaGUuY29tbWl0TmV3KGlkLCBzbSk7DQogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigp\nOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZpbmFsbHkg\new0KICAgICAgICAgICAgdW5sb2NrKCk7DQogICAgICAgIH0NCiAgICB9DQoN\nCiAgICAvKioNCiAgICAgKiBOb3RpZnkgdGhlIGJyb2tlciB0aGF0IHRoZSBn\naXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZA0KICAgICAqIGJlIGFkZGVkIHRv\nIHRoZSBzZXQgb2YgaW5zdGFuY2VzIGludm9sdmVkIGluIHRoZSBjdXJyZW50\nIHRyYW5zYWN0aW9uLg0KICAgICAqLw0KICAgIHZvaWQgYWRkVG9UcmFuc2Fj\ndGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7DQogICAgICAgIC8vIHdlIG9u\nbHkgYWRkIGNsZWFuIGluc3RhbmNlcyBub3c7IGRpcnR5IGluc3RhbmNlcyBh\ncmUgYWRkZWQgaW4NCiAgICAgICAgLy8gdGhlIHNldERpcnR5IGNhbGxiYWNr\nDQogICAgICAgIGlmIChzbS5pc0RpcnR5KCkpDQogICAgICAgICAgICByZXR1\ncm47DQoNCiAgICAgICAgbG9jaygpOw0KICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQ0KICAgICAg\nICAgICAgICAgIF90cmFuc0NhY2hlID0gbmV3IFRyYW5zYWN0aW9uYWxDYWNo\nZShfb3JkZXJEaXJ0eSk7DQogICAgICAgICAgICBfdHJhbnNDYWNoZS5hZGRD\nbGVhbihzbSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICB1\nbmxvY2soKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAq\nIE5vdGlmeSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlciB0aGF0IHRoZSBnaXZl\nbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZA0KICAgICAqIGJlIHJlbW92ZWQgZnJv\nbSB0aGUgc2V0IG9mIGluc3RhbmNlcyBpbnZvbHZlZCBpbiB0aGUgY3VycmVu\ndCB0cmFuc2FjdGlvbi4NCiAgICAgKi8NCiAgICB2b2lkIHJlbW92ZUZyb21U\ncmFuc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7DQogICAgICAgIGxv\nY2soKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChfdHJhbnND\nYWNoZSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIC8vIGludGVudGlvbmFs\nIGRpcmVjdCBhY2Nlc3M7IHdlIGRvbid0IHdhbnQgdG8gcmVjb21wdXRlDQog\nICAgICAgICAgICAgICAgLy8gZGlydGluZXNzIHdoaWxlIHJlbW92aW5nIGlu\nc3RhbmNlcyBmcm9tIHRoZSB0cmFuc2FjdGlvbg0KICAgICAgICAgICAgICAg\nIF90cmFuc0NhY2hlLnJlbW92ZShzbSk7DQogICAgICAgICAgICBpZiAoX2Rl\ncmVmQ2FjaGUgIT0gbnVsbCAmJiAhc20uaXNQZXJzaXN0ZW50KCkpDQogICAg\nICAgICAgICAgICAgX2RlcmVmQ2FjaGUucmVtb3ZlKHNtKTsNCiAgICAgICAg\nfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIHVubG9jaygpOw0KICAgICAgICB9\nDQogICAgfQ0KDQogICAgLyoqDQogICAgICogTm90aWZpY2F0aW9uIHRoYXQg\ndGhlIGdpdmVuIGluc3RhbmNlIGhhcyBiZWVuIGRpcnRpZWQuIFRoaXMNCiAg\nICAgKiBub3RpZmljYXRpb24gaXMgZ2l2ZW4gd2hlbiBhbiBvYmplY3QgZmly\nc3QgdHJhbnNpdGlvbnMgdG8gYSBkaXJ0eSBzdGF0ZSwNCiAgICAgKiBhbmQg\nZXZlcnkgdGltZSB0aGUgb2JqZWN0IGlzIG1vZGlmaWVkIGJ5IHRoZSB1c2Vy\nIHRoZXJlYWZ0ZXIuDQogICAgICovDQogICAgdm9pZCBzZXREaXJ0eShTdGF0\nZU1hbmFnZXJJbXBsIHNtLCBib29sZWFuIGZpcnN0RGlydHkpIHsNCiAgICAg\nICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpKQ0KICAgICAgICAgICAgX2ZsYWdz\nIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7DQoNCiAgICAgICAgaWYgKF9zYXZl\ncG9pbnRzICE9IG51bGwgJiYgIV9zYXZlcG9pbnRzLmlzRW1wdHkoKSkgew0K\nICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRDYWNoZSA9PSBudWxsKQ0KICAg\nICAgICAgICAgICAgIF9zYXZlcG9pbnRDYWNoZSA9IG5ldyBIYXNoU2V0KCk7\nDQogICAgICAgICAgICBfc2F2ZXBvaW50Q2FjaGUuYWRkKHNtKTsNCiAgICAg\nICAgfQ0KDQogICAgICAgIGlmIChmaXJzdERpcnR5ICYmIHNtLmlzVHJhbnNh\nY3Rpb25hbCgpKSB7DQogICAgICAgICAgICBsb2NrKCk7DQogICAgICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgICAgIC8vIGNhY2hlIGRpcnR5IGluc3Rh\nbmNlDQogICAgICAgICAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2Jq\nZWN0cygpKQ0KICAgICAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZSA9IG5l\ndyBUcmFuc2FjdGlvbmFsQ2FjaGUoX29yZGVyRGlydHkpOw0KICAgICAgICAg\nICAgICAgIF90cmFuc0NhY2hlLmFkZERpcnR5KHNtKTsNCg0KICAgICAgICAg\nICAgICAgIC8vIGFsc28gcmVjb3JkIHRoYXQgdGhlIGNsYXNzIGlzIGRpcnR5\nDQogICAgICAgICAgICAgICAgaWYgKHNtLmlzTmV3KCkpIHsNCiAgICAgICAg\nICAgICAgICAgICAgaWYgKF9wZXJzaXN0ZWRDbHNzID09IG51bGwpDQogICAg\nICAgICAgICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcyA9IG5ldyBIYXNo\nU2V0KCk7DQogICAgICAgICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzLmFk\nZChzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSk7DQogICAg\nICAgICAgICAgICAgfSBlbHNlIGlmIChzbS5pc0RlbGV0ZWQoKSkgew0KICAg\nICAgICAgICAgICAgICAgICBpZiAoX2RlbGV0ZWRDbHNzID09IG51bGwpDQog\nICAgICAgICAgICAgICAgICAgICAgICBfZGVsZXRlZENsc3MgPSBuZXcgSGFz\naFNldCgpOw0KICAgICAgICAgICAgICAgICAgICBfZGVsZXRlZENsc3MuYWRk\nKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsNCiAgICAg\nICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpZiAo\nX3VwZGF0ZWRDbHNzID09IG51bGwpDQogICAgICAgICAgICAgICAgICAgICAg\nICBfdXBkYXRlZENsc3MgPSBuZXcgSGFzaFNldCgpOw0KICAgICAgICAgICAg\nICAgICAgICBfdXBkYXRlZENsc3MuYWRkKHNtLmdldE1ldGFEYXRhKCkuZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAg\nICAgICAgICAgICAvLyBpZiB0cmFja2luZyBjaGFuZ2VzIGFuZCB0aGlzIGlu\nc3RhbmNlIHdhc24ndCBhbHJlYWR5IGRpcnR5LA0KICAgICAgICAgICAgICAg\nIC8vIGFkZCB0byBjaGFuZ2VkIHNldDsgd2UgdXNlIHRoaXMgZm9yIGRldGVj\ndGluZyBpbnN0YW5jZXMgdGhhdA0KICAgICAgICAgICAgICAgIC8vIGVudGVy\nIHRoZSB0cmFuc2FjdGlvbiBkdXJpbmcgcHJlIHN0b3JlDQogICAgICAgICAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApIHsN\nCiAgICAgICAgICAgICAgICAgICAgaWYgKF90cmFuc0FkZGl0aW9ucyA9PSBu\ndWxsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgX3RyYW5zQWRkaXRpb25z\nID0gbmV3IEhhc2hTZXQoKTsNCiAgICAgICAgICAgICAgICAgICAgX3RyYW5z\nQWRkaXRpb25zLmFkZChzbSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAg\nICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgICAgICB1bmxvY2soKTsN\nCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0K\nICAgICAqIE5vdGlmeSB0aGUgYnJva2VyIHRoYXQgdGhlIGdpdmVuIHN0YXRl\nIG1hbmFnZXIgc2hvdWxkDQogICAgICogYmUgYWRkZWQgdG8gdGhlIHNldCBv\nZiBpbnN0YW5jZXMgdGhhdCB3aWxsIGJlY29tZSB0cmFuc2FjdGlvbmFsDQog\nICAgICogb24gdGhlIG5leHQgdHJhbnNhY3Rpb24NCiAgICAgKi8NCiAgICB2\nb2lkIGFkZFRvUGVuZGluZ1RyYW5zYWN0aW9uKFN0YXRlTWFuYWdlckltcGwg\nc20pIHsNCiAgICAgICAgbG9jaygpOw0KICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgaWYgKF9wZW5kaW5nID09IG51bGwpDQogICAgICAgICAgICAgICAg\nX3BlbmRpbmcgPSBuZXcgSGFzaFNldCgpOw0KICAgICAgICAgICAgX3BlbmRp\nbmcuYWRkKHNtKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAg\nIHVubG9jaygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAg\nICogTm90aWZ5IHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyIHRoYXQgdGhlIGdp\ndmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkDQogICAgICogYmUgcmVtb3ZlZCBm\ncm9tIHRoZSBzZXQgb2YgaW5zdGFuY2VzIGludm9sdmVkIGluIHRoZSBuZXh0\nIHRyYW5zYWN0aW9uLg0KICAgICAqLw0KICAgIHZvaWQgcmVtb3ZlRnJvbVBl\nbmRpbmdUcmFuc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7DQogICAg\nICAgIGxvY2soKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChf\ncGVuZGluZyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIF9wZW5kaW5nLnJl\nbW92ZShzbSk7DQogICAgICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVs\nbCAmJiAhc20uaXNQZXJzaXN0ZW50KCkpDQogICAgICAgICAgICAgICAgX2Rl\ncmVmQ2FjaGUucmVtb3ZlKHNtKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAg\nICAgICAgICAgIHVubG9jaygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogQWRkIGEgZGVyZWZlcmVuY2VkIGRlcGVuZGVudCBvYmpl\nY3QgdG8gdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIncyBjYWNoZS4NCiAgICAg\nKiBPbiBmbHVzaCwgdGhlc2Ugb2JqZWN0cyB3aWxsIGJlIGRlbGV0ZWQuDQog\nICAgICovDQogICAgdm9pZCBhZGREZXJlZmVyZW5jZWREZXBlbmRlbnQoU3Rh\ndGVNYW5hZ2VySW1wbCBzbSkgew0KICAgICAgICBsb2NrKCk7DQogICAgICAg\nIHRyeSB7DQogICAgICAgICAgICAvLyBpZiB3ZSdyZSBpbiB0aGUgbWlkZGxl\nIG9mIGZsdXNoIGFuZCBpbnRyb2R1Y2luZyBtb3JlIGRlcmVmcw0KICAgICAg\nICAgICAgLy8gdmlhIGluc3RhbmNlIGNhbGxiYWNrcywgYWRkIHRoZW0gdG8g\ndGhlIHNwZWNpYWwgYWRkaXRpb25zIHNldA0KICAgICAgICAgICAgaWYgKChf\nZmxhZ3MgJiBGTEFHX0RFUkVGREVMRVRJTkcpICE9IDApIHsNCiAgICAgICAg\nICAgICAgICBpZiAoX2RlcmVmQWRkaXRpb25zID09IG51bGwpDQogICAgICAg\nICAgICAgICAgICAgIF9kZXJlZkFkZGl0aW9ucyA9IG5ldyBIYXNoU2V0KCk7\nDQogICAgICAgICAgICAgICAgX2RlcmVmQWRkaXRpb25zLmFkZChzbSk7DQog\nICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmIChfZGVy\nZWZDYWNoZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBfZGVyZWZD\nYWNoZSA9IG5ldyBIYXNoU2V0KCk7DQogICAgICAgICAgICAgICAgX2RlcmVm\nQ2FjaGUuYWRkKHNtKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAg\nICAgICBmaW5hbGx5IHsNCiAgICAgICAgICAgIHVubG9jaygpOw0KICAgICAg\nICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVtb3ZlIHRoZSBnaXZl\nbiBwcmV2aW91c2x5IGRlcmVmZXJlbmNlZCBkZXBlbmRlbnQgb2JqZWN0IGZy\nb20gdGhlDQogICAgICogY2FjaGUuIEl0IGlzIG5vdyByZWZlcmVuY2VkLg0K\nICAgICAqLw0KICAgIHZvaWQgcmVtb3ZlRGVyZWZlcmVuY2VkRGVwZW5kZW50\nKFN0YXRlTWFuYWdlckltcGwgc20pIHsNCiAgICAgICAgbG9jaygpOw0KICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgYm9vbGVhbiByZW1vdmVkID0gZmFs\nc2U7DQogICAgICAgICAgICBpZiAoX2RlcmVmQWRkaXRpb25zICE9IG51bGwp\nDQogICAgICAgICAgICAgICAgcmVtb3ZlZCA9IF9kZXJlZkFkZGl0aW9ucy5y\nZW1vdmUoc20pOw0KICAgICAgICAgICAgaWYgKCFyZW1vdmVkICYmIChfZGVy\nZWZDYWNoZSA9PSBudWxsIHx8ICFfZGVyZWZDYWNoZS5yZW1vdmUoc20pKSkN\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0\naW9uKF9sb2MuZ2V0KCJub3QtZGVyZWZlZCIsDQogICAgICAgICAgICAgICAg\nICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcoc20uZ2V0TWFuYWdlZEluc3RhbmNl\nKCkpKSkuDQogICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChz\nbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkuDQogICAgICAgICAgICAgICAgICAg\nIHNldEZhdGFsKHRydWUpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAg\nICAgICAgdW5sb2NrKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJs\naWMgdm9pZCBkaXJ0eVR5cGUoQ2xhc3MgY2xzKSB7DQogICAgICAgIGlmIChj\nbHMgPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICBi\nZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAgICAgIHRyeSB7DQogICAgICAg\nICAgICBpZiAoX3VwZGF0ZWRDbHNzID09IG51bGwpDQogICAgICAgICAgICAg\nICAgX3VwZGF0ZWRDbHNzID0gbmV3IEhhc2hTZXQoKTsNCiAgICAgICAgICAg\nIF91cGRhdGVkQ2xzcy5hZGQoY2xzKTsNCiAgICAgICAgfSBmaW5hbGx5IHsN\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0UGVyc2lzdGVkVHlwZXMo\nKSB7DQogICAgICAgIGlmIChfcGVyc2lzdGVkQ2xzcyA9PSBudWxsIHx8IF9w\nZXJzaXN0ZWRDbHNzLmlzRW1wdHkoKSkNCiAgICAgICAgICAgIHJldHVybiBD\nb2xsZWN0aW9ucy5FTVBUWV9MSVNUOw0KICAgICAgICByZXR1cm4gQ29sbGVj\ndGlvbnMudW5tb2RpZmlhYmxlQ29sbGVjdGlvbihfcGVyc2lzdGVkQ2xzcyk7\nDQogICAgfQ0KDQogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0VXBkYXRlZFR5\ncGVzKCkgew0KICAgICAgICBpZiAoX3VwZGF0ZWRDbHNzID09IG51bGwgfHwg\nX3VwZGF0ZWRDbHNzLmlzRW1wdHkoKSkNCiAgICAgICAgICAgIHJldHVybiBD\nb2xsZWN0aW9ucy5FTVBUWV9MSVNUOw0KICAgICAgICByZXR1cm4gQ29sbGVj\ndGlvbnMudW5tb2RpZmlhYmxlQ29sbGVjdGlvbihfdXBkYXRlZENsc3MpOw0K\nICAgIH0NCg0KICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldERlbGV0ZWRUeXBl\ncygpIHsNCiAgICAgICAgaWYgKF9kZWxldGVkQ2xzcyA9PSBudWxsIHx8IF9k\nZWxldGVkQ2xzcy5pc0VtcHR5KCkpDQogICAgICAgICAgICByZXR1cm4gQ29s\nbGVjdGlvbnMuRU1QVFlfTElTVDsNCiAgICAgICAgcmV0dXJuIENvbGxlY3Rp\nb25zLnVubW9kaWZpYWJsZUNvbGxlY3Rpb24oX2RlbGV0ZWRDbHNzKTsNCiAg\nICB9DQoNCiAgICAvLy8vLy8vLy8vLw0KICAgIC8vIENsb3NpbmcNCiAgICAv\nLy8vLy8vLy8vLw0KDQogICAgcHVibGljIGJvb2xlYW4gaXNDbG9zZWQoKSB7\nDQogICAgICAgIHJldHVybiBfY2xvc2VkOw0KICAgIH0NCg0KICAgIHB1Ymxp\nYyBib29sZWFuIGlzQ2xvc2VJbnZva2VkKCkgew0KICAgICAgICByZXR1cm4g\nX2Nsb3NlZCB8fCAoX2ZsYWdzICYgRkxBR19DTE9TRV9JTlZPS0VEKSAhPSAw\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgew0KICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7DQogICAgICAgIHRyeSB7DQogICAg\nICAgICAgICAvLyB0aHJvdyBhbiBleGNlcHRpb24gaWYgY2xvc2luZyBpbiBh\nbiBhY3RpdmUgbG9jYWwgdHJhbnMNCiAgICAgICAgICAgIGlmICghX21hbmFn\nZWQgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQ0KICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQoImFjdGl2ZSIpKTsNCg0KICAgICAgICAgICAgLy8gb25seSBjbG9zZSBp\nZiBub3QgYWN0aXZlOyBpZiBhY3RpdmUgbWFuYWdlZCB0cmFucyB3YWl0DQog\nICAgICAgICAgICAvLyBmb3IgY29tcGxldGlvbg0KICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZMQUdfQ0xPU0VfSU5WT0tFRDsNCg0KICAgICAgICAgICAgaWYg\nKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkNCiAgICAgICAgICAgICAg\nICBmcmVlKCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0K\nICAgICAqIEZyZWUgdGhlIHJlc291cmNlcyB1c2VkIGJ5IHRoaXMgcGVyc2lz\ndGVuY2UgbWFuYWdlci4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgdm9pZCBm\ncmVlKCkgew0KICAgICAgICBSdW50aW1lRXhjZXB0aW9uIGVyciA9IG51bGw7\nDQogICAgICAgIGlmICgoX2F1dG9EZXRhY2ggJiBERVRBQ0hfQ0xPU0UpICE9\nIDApIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgZGV0\nYWNoQWxsSW50ZXJuYWwoX2NhbGwpOw0KICAgICAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAgICAgIGVyciA9\nIHJlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgX3N5\nbmMgPSBudWxsOw0KICAgICAgICBfdXNlck9iamVjdHMgPSBudWxsOw0KICAg\nICAgICBfY2FjaGUuY2xlYXIoKTsNCiAgICAgICAgX3RyYW5zQ2FjaGUgPSBu\ndWxsOw0KICAgICAgICBfcGVyc2lzdGVkQ2xzcyA9IG51bGw7DQogICAgICAg\nIF91cGRhdGVkQ2xzcyA9IG51bGw7DQogICAgICAgIF9kZWxldGVkQ2xzcyA9\nIG51bGw7DQogICAgICAgIF9kZXJlZkNhY2hlID0gbnVsbDsNCiAgICAgICAg\nX3BlbmRpbmcgPSBudWxsOw0KICAgICAgICBfbG9hZGVyID0gbnVsbDsNCiAg\nICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyID0gbnVsbDsNCiAgICAgICAgX2xp\nZmVFdmVudE1hbmFnZXIgPSBudWxsOw0KDQogICAgICAgIE9wZW5KUEFTYXZl\ncG9pbnQgc2F2ZTsNCiAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzICE9IG51\nbGwgJiYgIV9zYXZlcG9pbnRzLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAg\nc2F2ZSA9DQogICAgICAgICAgICAgICAgKE9wZW5KUEFTYXZlcG9pbnQpIF9z\nYXZlcG9pbnRzLnJlbW92ZShfc2F2ZXBvaW50cy5zaXplKCkgLSAxKTsNCiAg\nICAgICAgICAgIHNhdmUucmVsZWFzZShmYWxzZSk7DQogICAgICAgIH0NCiAg\nICAgICAgX3NhdmVwb2ludHMgPSBudWxsOw0KICAgICAgICBfc2F2ZXBvaW50\nQ2FjaGUgPSBudWxsOw0KDQogICAgICAgIGlmIChfcXVlcmllcyAhPSBudWxs\nKSB7DQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9xdWVyaWVz\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgKChRdWVyeSkgaXRyLm5l\neHQoKSkuY2xvc2VSZXNvdXJjZXMoKTsNCiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAgICAgICAg\nfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX3F1ZXJpZXMgPSBudWxs\nOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKF9leHRlbnRzICE9IG51bGwp\nIHsNCiAgICAgICAgICAgIEV4dGVudCBlOw0KICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBfZXh0ZW50cy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgew0KICAgICAgICAgICAgICAgIGUgPSAoRXh0ZW50KSBpdHIubmV4\ndCgpOw0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAg\nICAgIGUuY2xvc2VBbGwoKTsNCiAgICAgICAgICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7DQogICAgICAgICAgICAgICAgfQ0KICAg\nICAgICAgICAgfQ0KICAgICAgICAgICAgX2V4dGVudHMgPSBudWxsOw0KICAg\nICAgICB9DQoNCiAgICAgICAgdHJ5IHsgcmVsZWFzZUNvbm5lY3Rpb24oKTsg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkge30NCg0KICAgICAgICBf\nbG0uY2xvc2UoKTsNCiAgICAgICAgX3N0b3JlLmNsb3NlKCk7DQogICAgICAg\nIF9mbGFncyA9IDA7DQogICAgICAgIF9jbG9zZWQgPSB0cnVlOw0KICAgICAg\nICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQ0KICAgICAgICAgICAgX2Ns\nb3NlZEV4Y2VwdGlvbiA9IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKTsN\nCg0KICAgICAgICBfZmFjdG9yeS5yZWxlYXNlQnJva2VyKHRoaXMpOw0KDQog\nICAgICAgIGlmIChlcnIgIT0gbnVsbCkNCiAgICAgICAgICAgIHRocm93IGVy\ncjsNCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vDQogICAgLy8g\nU3luY2hyb25pemF0aW9uDQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLw0KDQog\nICAgcHVibGljIHZvaWQgbG9jaygpIHsNCiAgICAgICAgaWYgKF9sb2NrICE9\nIG51bGwpDQogICAgICAgICAgICBfbG9jay5sb2NrKCk7DQogICAgfQ0KDQog\nICAgcHVibGljIHZvaWQgdW5sb2NrKCkgew0KICAgICAgICBpZiAoX2xvY2sg\nIT0gbnVsbCkNCiAgICAgICAgICAgIF9sb2NrLnVubG9jaygpOw0KICAgIH0N\nCg0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vDQogICAgLy8gU3RhdGUgbWFu\nYWdlbWVudA0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vDQoNCiAgICBwdWJs\naWMgT2JqZWN0IG5ld0luc3RhbmNlKENsYXNzIGNscykgew0KICAgICAgICBh\nc3NlcnRPcGVuKCk7DQoNCiAgICAgICAgaWYgKCFjbHMuaXNJbnRlcmZhY2Uo\nKSAmJiBNb2RpZmllci5pc0Fic3RyYWN0KGNscy5nZXRNb2RpZmllcnMoKSkp\nDQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25F\neGNlcHRpb24oX2xvYy5nZXQNCiAgICAgICAgICAgICAgICAoIm5ldy1hYnN0\ncmFjdCIsIGNscykuZ2V0TWVzc2FnZSgpKTsNCg0KICAgICAgICAvLyAxLjUg\nZG9lc24ndCBpbml0aWFsaXplIGNsYXNzZXMgd2l0aG91dCBhIHRydWUgQ2xh\nc3MuZm9yTmFtZQ0KICAgICAgICBpZiAoIVBDUmVnaXN0cnkuaXNSZWdpc3Rl\ncmVkKGNscykpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAg\nICAgQ2xhc3MuZm9yTmFtZShjbHMuZ2V0TmFtZSgpLCB0cnVlLCANCiAgICAg\nICAgICAgICAgICAgICAgKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgNCiAgICAgICAgICAgICAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGNscykpKTsNCiAgICAg\nICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7DQogICAgICAgICAgICB9\nDQogICAgICAgIH0NCg0KICAgICAgICBpZiAoX2NvbmYuZ2V0TWV0YURhdGFS\nZXBvc2l0b3J5SW5zdGFuY2UoKS5nZXRNZXRhRGF0YShjbHMsDQogICAgICAg\nICAgICBnZXRDbGFzc0xvYWRlcigpLCBmYWxzZSkgPT0gbnVsbCkNCiAgICAg\nICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oDQog\nICAgICAgICAgICAgICAgX2xvYy5nZXQoIm5vLWludGVyZmFjZS1tZXRhZGF0\nYSIsIGNscy5nZXROYW1lKCkpLmdldE1lc3NhZ2UoKSk7DQoNCiAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgIHJldHVybiBQQ1JlZ2lzdHJ5Lm5ld0luc3Rh\nbmNlKGNscywgbnVsbCwgZmFsc2UpOw0KICAgICAgICB9IGNhdGNoIChJbGxl\nZ2FsU3RhdGVFeGNlcHRpb24gaXNlKSB7DQogICAgICAgICAgICBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24gaWFlID0NCiAgICAgICAgICAgICAgICBuZXcg\nSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKGlzZS5nZXRNZXNzYWdlKCkpOw0K\nICAgICAgICAgICAgaWFlLnNldFN0YWNrVHJhY2UoaXNlLmdldFN0YWNrVHJh\nY2UoKSk7DQogICAgICAgICAgICB0aHJvdyBpYWU7DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IGdldE9iamVjdElkKE9iamVjdCBv\nYmopIHsNCiAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICBpZiAoSW1w\nbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkNCiAgICAgICAgICAgIHJldHVy\nbiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25m\nKSkNCiAgICAgICAgICAgICAgICAucGNGZXRjaE9iamVjdElkKCk7DQogICAg\nICAgIHJldHVybiBudWxsOw0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnQgZ2V0\nTG9ja0xldmVsKE9iamVjdCBvKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsN\nCiAgICAgICAgaWYgKG8gPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiBM\nb2NrTGV2ZWxzLkxPQ0tfTk9ORTsNCg0KICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtID0gZ2V0U3RhdGVNYW5hZ2VyKG8pOw0KICAgICAgICBpZiAo\nc20gPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiBMb2NrTGV2ZWxzLkxP\nQ0tfTk9ORTsNCiAgICAgICAgcmV0dXJuIGdldExvY2tNYW5hZ2VyKCkuZ2V0\nTG9ja0xldmVsKHNtKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndFZlcnNpb24oT2JqZWN0IG9iaikgew0KICAgICAgICBhc3NlcnRPcGVuKCk7\nDQogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKQ0K\nICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VD\nYXBhYmxlKG9iaiwgX2NvbmYpKS5wY0dldFZlcnNpb24oKTsNCiAgICAgICAg\ncmV0dXJuIG51bGw7DQogICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gaXNE\naXJ0eShPYmplY3Qgb2JqKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAg\nICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpIHsNCiAg\nICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IEltcGxIZWxwZXIu\ndG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZik7DQogICAgICAgICAg\nICByZXR1cm4gcGMucGNJc0RpcnR5KCk7DQogICAgICAgIH0NCiAgICAgICAg\ncmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBib29sZWFuIGlz\nVHJhbnNhY3Rpb25hbChPYmplY3Qgb2JqKSB7DQogICAgICAgIGFzc2VydE9w\nZW4oKTsNCiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9i\naikpDQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9QZXJzaXN0\nZW5jZUNhcGFibGUob2JqLCBfY29uZikpDQogICAgICAgICAgICAgICAgLnBj\nSXNUcmFuc2FjdGlvbmFsKCk7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAg\nICB9DQoNCiAgICBwdWJsaWMgYm9vbGVhbiBpc1BlcnNpc3RlbnQoT2JqZWN0\nIG9iaikgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAgIGlmIChJ\nbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKQ0KICAgICAgICAgICAgcmV0\ndXJuIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2Nv\nbmYpKS5wY0lzUGVyc2lzdGVudCgpOw0KICAgICAgICByZXR1cm4gZmFsc2U7\nDQogICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gaXNOZXcoT2JqZWN0IG9i\naikgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAgIGlmIChJbXBs\nSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKQ0KICAgICAgICAgICAgcmV0dXJu\nIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYp\nKS5wY0lzTmV3KCk7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RlbGV0ZWQoT2JqZWN0IG9iaikgew0K\nICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAgIGlmIChJbXBsSGVscGVy\nLmlzTWFuYWdlYWJsZShvYmopKQ0KICAgICAgICAgICAgcmV0dXJuIChJbXBs\nSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKS5wY0lz\nRGVsZXRlZCgpOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQog\nICAgcHVibGljIGJvb2xlYW4gaXNEZXRhY2hlZChPYmplY3Qgb2JqKSB7DQog\nICAgICAgIGlmICghKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpKQ0K\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYyA9IEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFi\nbGUob2JqLCBfY29uZik7DQogICAgICAgIEJvb2xlYW4gZGV0YWNoZWQgPSBw\nYy5wY0lzRGV0YWNoZWQoKTsNCiAgICAgICAgaWYgKGRldGFjaGVkICE9IG51\nbGwpDQogICAgICAgICAgICByZXR1cm4gZGV0YWNoZWQuYm9vbGVhblZhbHVl\nKCk7DQoNCiAgICAgICAgLy8gbGFzdCByZXNvcnQ6IGluc3RhbmNlIGlzIGRl\ndGFjaGVkIGlmIGl0IGhhcyBhIHN0b3JlIHJlY29yZA0KICAgICAgICBDbGFz\nc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJ\nbnN0YW5jZSgpLg0KICAgICAgICAgICAgZ2V0TWV0YURhdGEoSW1wbEhlbHBl\nci5nZXRNYW5hZ2VkSW5zdGFuY2UocGMpLmdldENsYXNzKCksDQogICAgICAg\nICAgICAgICAgX2xvYWRlciwgdHJ1ZSk7DQogICAgICAgIE9iamVjdCBvaWQg\nPSBBcHBsaWNhdGlvbklkcy5jcmVhdGUocGMsIG1ldGEpOw0KICAgICAgICBp\nZiAob2lkID09IG51bGwpDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQog\nICAgICAgIHJldHVybiBmaW5kKG9pZCwgbnVsbCwgRVhDTFVERV9BTEwsIG51\nbGwsIDApICE9IG51bGw7DQogICAgfQ0KDQogICAgcHVibGljIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgZ2V0U3RhdGVNYW5hZ2VyKE9iamVjdCBvYmopIHsNCiAg\nICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICByZXR1cm4gZ2V0U3RhdGVN\nYW5hZ2VySW1wbChvYmosIGZhbHNlKTsNCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBSZXR1cm4gdGhlIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBnaXZlbiBp\nbnN0YW5jZSwgb3IgbnVsbC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBhc3Nl\ncnRUaGlzQ29udGV4dCBpZiB0cnVlLCB0aG93IGFuIGV4Y2VwdGlvbiBpZiB0\naGUgZ2l2ZW4NCiAgICAgKiBvYmplY3QgaXMgbWFuYWdlZCBieSBhbm90aGVy\nIGJyb2tlcg0KICAgICAqLw0KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJ\nbXBsIGdldFN0YXRlTWFuYWdlckltcGwoT2JqZWN0IG9iaiwNCiAgICAgICAg\nYm9vbGVhbiBhc3NlcnRUaGlzQ29udGV4dCkgew0KICAgICAgICBpZiAoSW1w\nbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkgew0KICAgICAgICAgICAgUGVy\nc2lzdGVuY2VDYXBhYmxlIHBjID0gSW1wbEhlbHBlci50b1BlcnNpc3RlbmNl\nQ2FwYWJsZShvYmosIF9jb25mKTsNCiAgICAgICAgICAgIGlmIChwYy5wY0dl\ndEdlbmVyaWNDb250ZXh0KCkgPT0gdGhpcykNCiAgICAgICAgICAgICAgICBy\nZXR1cm4gKFN0YXRlTWFuYWdlckltcGwpIHBjLnBjR2V0U3RhdGVNYW5hZ2Vy\nKCk7DQogICAgICAgICAgICBpZiAoYXNzZXJ0VGhpc0NvbnRleHQgJiYgcGMu\ncGNHZXRHZW5lcmljQ29udGV4dCgpICE9IG51bGwpDQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1tYW5h\nZ2VkIiwNCiAgICAgICAgICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmlu\nZyhvYmopKSkuc2V0RmFpbGVkT2JqZWN0KG9iaik7DQogICAgICAgIH0NCiAg\nICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KDQogICAgLyoqDQogICAgICog\nUmV0dXJuIHRoZSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZ2l2ZW4gb2lkLg0K\nICAgICAqDQogICAgICogQHBhcmFtIGFsbG93TmV3IGlmIHRydWUsIG9iamVj\ndHMgbWFkZSBwZXJzaXN0ZW50IGluIHRoZSBjdXJyZW50DQogICAgICogdHJh\nbnNhY3Rpb24gd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgc2VhcmNoOyBpZg0K\nICAgICAqIG11bHRpcGxlIG5ldyBvYmplY3RzIG1hdGNoIHRoZSBnaXZlbiBv\naWQsIGl0IGlzDQogICAgICogdW5kZWZpbmVkIHdoaWNoIHdpbGwgYmUgcmV0\ndXJuZWQNCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1w\nbCBnZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChPYmplY3Qgb2lkLA0KICAgICAg\nICBib29sZWFuIGFsbG93TmV3KSB7DQogICAgICAgIHJldHVybiBfY2FjaGUu\nZ2V0QnlJZChvaWQsIGFsbG93TmV3KTsNCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBSZXR1cm4gdGhlIGdpdmVuIGluc3RhbmNlIGFzIGEge0BsaW5rIFBl\ncnNpc3RlbmNlQ2FwYWJsZX0uDQogICAgICogSWYgdGhlIGluc3RhbmNlIGlz\nIG5vdCBtYW5hZ2VhYmxlIHRocm93IHRoZSBwcm9wZXIgZXhjZXB0aW9uLg0K\nICAgICAqLw0KICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZUNhcGFibGUgYXNz\nZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKE9iamVjdCBvYmopIHsNCiAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQog\nICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKQ0KICAg\nICAgICAgICAgcmV0dXJuIEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFi\nbGUob2JqLCBfY29uZik7DQoNCiAgICAgICAgLy8gY2hlY2sgZm9yIGRpZmZl\ncmVudCBpbnN0YW5jZXMgb2YgdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRl\ncmZhY2UNCiAgICAgICAgLy8gYW5kIHRocm93IGEgYmV0dGVyIGVycm9yIHRo\nYXQgbWVudGlvbnMgdGhlIGNsYXNzIGxvYWRlcnMNCiAgICAgICAgQ2xhc3Nb\nXSBpbnRmcyA9IG9iai5nZXRDbGFzcygpLmdldEludGVyZmFjZXMoKTsNCiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGludGZzICE9IG51bGwgJiYgaSA8IGlu\ndGZzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAoaW50ZnNbaV0u\nZ2V0TmFtZSgpLmVxdWFscyhQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MuZ2V0\nTmFtZSgpKSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJwYy1sb2FkZXItZGlmZmVyZW50IiwNCiAgICAg\nICAgICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopLA0KICAg\nICAgICAgICAgICAgICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKA0KICAgICAgICAgICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oDQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzKSks\nDQogICAgICAgICAgICAgICAgICAgIChDbGFzc0xvYWRlcikgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoDQogICAgICAgICAgICAgICAgICAgICAg\nICBKMkRvUHJpdkhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihpbnRmc1tp\nXSkpKSkNCiAgICAgICAgICAgICAgICAgICAgLnNldEZhaWxlZE9iamVjdChv\nYmopOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8g\nbm90IGVuaGFuY2VkDQogICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJwYy1jYXN0IiwNCiAgICAgICAgICAgIEV4Y2VwdGlvbnMu\ndG9TdHJpbmcob2JqKSkpLnNldEZhaWxlZE9iamVjdChvYmopOw0KICAgIH0N\nCg0KICAgIC8vLy8vLy8vLw0KICAgIC8vIFV0aWxzDQogICAgLy8vLy8vLy8v\nDQogICAgLyoqDQogICAgICogVGhyb3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBj\nb250ZXh0IGlzIGNsb3NlZC4gIFRoZSBleGFjdCBtZXNzYWdlIGFuZA0KICAg\nICAqIGNvbnRlbnQgb2YgdGhlIGV4Y2VwdGlvbiB2YXJpZXMgd2hldGhlciBU\nUkFDRSBpcyBlbmFibGVkIG9yIG5vdC4NCiAgICAgKi8NCiAgICBwdWJsaWMg\ndm9pZCBhc3NlcnRPcGVuKCkgew0KICAgICAgICBpZiAoX2Nsb3NlZCkgew0K\nICAgICAgICAgICAgaWYgKF9jbG9zZWRFeGNlcHRpb24gPT0gbnVsbCkgIC8v\nIFRSQUNFIG5vdCBlbmFibGVkDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiY2xvc2VkLW5vdHJh\nY2UiKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRGYXRhbCh0cnVl\nKTsNCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIE9wZW5K\nUEFFeGNlcHRpb24gZSA9IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oDQog\nICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJjbG9zZWQiKSwgX2Nsb3Nl\nZEV4Y2VwdGlvbikuc2V0RmF0YWwodHJ1ZSk7DQogICAgICAgICAgICAgICAg\nZS5zZXRDYXVzZShfY2xvc2VkRXhjZXB0aW9uKTsNCiAgICAgICAgICAgICAg\nICB0aHJvdyBlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0K\nDQogICAgcHVibGljIHZvaWQgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKSB7\nDQogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApDQog\nICAgICAgICAgICB0aHJvdyBuZXcgTm9UcmFuc2FjdGlvbkV4Y2VwdGlvbihf\nbG9jLmdldCgibm90LWFjdGl2ZSIpKTsNCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBUaHJvdyBleGNlcHRpb24gaWYgYSB0cmFuc2FjdGlvbi1yZWxhdGVk\nIG9wZXJhdGlvbiBpcyBhdHRlbXB0ZWQgYW5kDQogICAgICogbm8gdHJhbnNh\nY3Rpb24gaXMgYWN0aXZlLg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9pZCBh\nc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigpIHsNCiAgICAgICAgaWYgKChf\nZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkNCiAgICAgICAgICAgIHRocm93\nIG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1hY3Rp\ndmUiKSk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgYXNzZXJ0Tm9udHJh\nbnNhY3Rpb25hbFJlYWQoKSB7DQogICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19BQ1RJVkUpID09IDAgJiYgIV9ub250cmFuc1JlYWQpDQogICAgICAgICAg\nICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nb24tdHJhbnMtcmVhZCIpKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBh\nc3NlcnRXcml0ZU9wZXJhdGlvbigpIHsNCiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX0FDVElWRSkgPT0gMCAmJiAoIV9ub250cmFuc1dyaXRlDQogICAg\nICAgICAgICB8fCAoX2F1dG9EZXRhY2ggJiBERVRBQ0hfTk9OVFhSRUFEKSAh\nPSAwKSkNCiAgICAgICAgICAgIHRocm93IG5ldyBOb1RyYW5zYWN0aW9uRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJ3cml0ZS1vcGVyYXRpb24iKSk7DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogUmV0dXJuIGFuIG9iamVjdCBub3QgZm91bmQg\nZXhjZXB0aW9uIGNvbnRhaW5pbmcgbmVzdGVkIGV4Y2VwdGlvbnMNCiAgICAg\nKiBmb3IgYWxsIG9mIHRoZSBnaXZlbiBmYWlsZWQgb2JqZWN0cy4NCiAgICAg\nKi8NCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlv\nbiBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbg0KICAgICAgICAoQ29sbGVj\ndGlvbiBmYWlsZWQpIHsNCiAgICAgICAgVGhyb3dhYmxlW10gdCA9IG5ldyBU\naHJvd2FibGVbZmFpbGVkLnNpemUoKV07DQogICAgICAgIGludCBpZHggPSAw\nOw0KICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGZhaWxlZC5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOyBpZHgrKykNCiAgICAgICAgICAgIHRbaWR4\nXSA9IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihpdHIubmV4dCgpKTsN\nCiAgICAgICAgcmV0dXJuIG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihm\nYWlsZWQsIHQpOw0KICAgIH0NCg0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vDQogICAgLy8gRmluZENhbGxiYWNrcyBpbXBsZW1lbnRh\ndGlvbg0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoN\nCiAgICBwdWJsaWMgT2JqZWN0IHByb2Nlc3NBcmd1bWVudChPYmplY3Qgb2lk\nKSB7DQogICAgICAgIHJldHVybiBvaWQ7DQogICAgfQ0KDQogICAgcHVibGlj\nIE9iamVjdCBwcm9jZXNzUmV0dXJuKE9iamVjdCBvaWQsIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20pIHsNCiAgICAgICAgcmV0dXJuIChzbSA9PSBudWxsKSA/\nIG51bGwgOiBzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKTsNCiAgICB9DQoNCiAg\nICBwcml2YXRlIHZvaWQgd3JpdGVPYmplY3QoT2JqZWN0T3V0cHV0U3RyZWFt\nIG91dCkgdGhyb3dzIElPRXhjZXB0aW9uIHsNCiAgICAgICAgYXNzZXJ0T3Bl\nbigpOw0KICAgICAgICBsb2NrKCk7DQogICAgICAgIHRyeSB7DQogICAgICAg\nICAgICBpZiAoaXNBY3RpdmUoKSkgew0KICAgICAgICAgICAgICAgIGlmICgh\nZ2V0T3B0aW1pc3RpYygpKQ0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKA0KICAgICAgICAgICAgICAgICAg\nICAgICAgX2xvYy5nZXQoImNhbnQtc2VyaWFsaXplLXBlc3NpbWlzdGljLWJy\nb2tlciIpKTsNCiAgICAgICAgICAgICAgICBpZiAoaGFzRmx1c2hlZCgpKQ0K\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhj\nZXB0aW9uKA0KICAgICAgICAgICAgICAgICAgICAgICAgX2xvYy5nZXQoImNh\nbnQtc2VyaWFsaXplLWZsdXNoZWQtYnJva2VyIikpOw0KICAgICAgICAgICAg\nICAgIGlmIChoYXNDb25uZWN0aW9uKCkpDQogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oDQogICAgICAgICAg\nICAgICAgICAgICAgICBfbG9jLmdldCgiY2FudC1zZXJpYWxpemUtY29ubmVj\ndGVkLWJyb2tlciIpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgICAgICBfaXNTZXJpYWxpemluZyA9IHRydWU7\nDQogICAgICAgICAgICAgICAgb3V0LndyaXRlT2JqZWN0KF9mYWN0b3J5Lmdl\ndFBvb2xLZXkoKSk7DQogICAgICAgICAgICAgICAgb3V0LmRlZmF1bHRXcml0\nZU9iamVjdCgpOw0KICAgICAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAg\nICAgICAgICBfaXNTZXJpYWxpemluZyA9IGZhbHNlOw0KICAgICAgICAgICAg\nfQ0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgdW5sb2NrKCk7\nDQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwcml2YXRlIHZvaWQgcmVhZE9i\namVjdChPYmplY3RJbnB1dFN0cmVhbSBpbikNCiAgICAgICAgdGhyb3dzIENs\nYXNzTm90Rm91bmRFeGNlcHRpb24sIElPRXhjZXB0aW9uIHsNCiAgICAgICAg\nT2JqZWN0IGZhY3RvcnlLZXkgPSBpbi5yZWFkT2JqZWN0KCk7DQogICAgICAg\nIEFic3RyYWN0QnJva2VyRmFjdG9yeSBmYWN0b3J5ID0NCiAgICAgICAgICAg\nIEFic3RyYWN0QnJva2VyRmFjdG9yeS5nZXRQb29sZWRGYWN0b3J5Rm9yS2V5\nKGZhY3RvcnlLZXkpOw0KDQogICAgICAgIC8vIHRoaXMgbmVlZHMgdG8gaGFw\ncGVuIGJlZm9yZSBkZWZhdWx0UmVhZE9iamVjdCBzbyB0aGF0IGl0J3MNCiAg\nICAgICAgLy8gYXZhaWxhYmxlIGZvciBjYWxscyB0byBicm9rZXIuZ2V0Q29u\nZmlndXJhdGlvbigpIGR1cmluZw0KICAgICAgICAvLyBTdGF0ZU1hbmFnZXIg\nZGVzZXJpYWxpemF0aW9uDQogICAgICAgIF9jb25mID0gZmFjdG9yeS5nZXRD\nb25maWd1cmF0aW9uKCk7DQogICAgICAgIA0KICAgICAgICBpbi5kZWZhdWx0\nUmVhZE9iamVjdCgpOw0KICAgICAgICBmYWN0b3J5LmluaXRpYWxpemVCcm9r\nZXIoX21hbmFnZWQsIF9jb25uUmV0YWluTW9kZSwgdGhpcywgdHJ1ZSk7DQoN\nCiAgICAgICAgLy8gcmUtaW5pdGlhbGl6ZSB0aGUgbG9jayBpZiBuZWVkZWQu\nDQogICAgICAgIHNldE11bHRpdGhyZWFkZWQoX211bHRpdGhyZWFkZWQpOw0K\nDQogICAgICAgIGlmIChpc0FjdGl2ZSgpICYmIF9ydW50aW1lIGluc3RhbmNl\nb2YgTG9jYWxNYW5hZ2VkUnVudGltZSkNCiAgICAgICAgICAgICgoTG9jYWxN\nYW5hZ2VkUnVudGltZSkgX3J1bnRpbWUpLmJlZ2luKCk7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogV2hldGhlciBvciBub3QgdGhpcyBicm9rZXIgaXMg\naW4gdGhlIG1pZHN0IG9mIGJlaW5nIHNlcmlhbGl6ZWQuDQogICAgICoNCiAg\nICAgKiBAc2luY2UgMS4xLjAgDQogICAgICovDQogICAgYm9vbGVhbiBpc1Nl\ncmlhbGl6aW5nKCkgew0KICAgICAgICByZXR1cm4gX2lzU2VyaWFsaXppbmc7\nDQogICAgfQ0KDQogICAgLyoqDQogICAgICogVHJhbnNhY3Rpb25hbCBjYWNo\nZSB0aGF0IGhvbGRzIHNvZnQgcmVmcyB0byBjbGVhbiBpbnN0YW5jZXMuDQog\nICAgICovDQogICAgc3RhdGljIGNsYXNzIFRyYW5zYWN0aW9uYWxDYWNoZQ0K\nICAgICAgICBpbXBsZW1lbnRzIFNldCwgU2VyaWFsaXphYmxlIHsNCg0KICAg\nICAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX29yZGVyRGlydHk7DQogICAg\nICAgIHByaXZhdGUgU2V0IF9kaXJ0eSA9IG51bGw7DQogICAgICAgIHByaXZh\ndGUgU2V0IF9jbGVhbiA9IG51bGw7DQoNCiAgICAgICAgcHVibGljIFRyYW5z\nYWN0aW9uYWxDYWNoZShib29sZWFuIG9yZGVyRGlydHkpIHsNCiAgICAgICAg\nICAgIF9vcmRlckRpcnR5ID0gb3JkZXJEaXJ0eTsNCiAgICAgICAgfQ0KDQog\nICAgICAgIC8qKg0KICAgICAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCB0\ncmFuc2FjdGlvbmFsIHN0YXRlIG1hbmFnZXJzLg0KICAgICAgICAgKi8NCiAg\nICAgICAgcHVibGljIENvbGxlY3Rpb24gY29weSgpIHsNCiAgICAgICAgICAg\nIGlmIChpc0VtcHR5KCkpDQogICAgICAgICAgICAgICAgcmV0dXJuIENvbGxl\nY3Rpb25zLkVNUFRZX0xJU1Q7DQoNCiAgICAgICAgICAgIC8vIHNpemUgbWF5\nIG5vdCBiZSBlbnRpcmVseSBhY2N1cmF0ZSBkdWUgdG8gcmVmcyBleHBpcmlu\nZywgc28NCiAgICAgICAgICAgIC8vIG1hbnVhbGx5IGNvcHkgZWFjaCBvYmpl\nY3Q7IGRvZXNuJ3QgbWF0dGVyIHRoaXMgd2F5IGlmIHNpemUgdG9vDQogICAg\nICAgICAgICAvLyBiaWcgYnkgc29tZQ0KICAgICAgICAgICAgTGlzdCBjb3B5\nID0gbmV3IEFycmF5TGlzdChzaXplKCkpOw0KICAgICAgICAgICAgaWYgKF9k\naXJ0eSAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gX2RpcnR5Lml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQ0KICAg\nICAgICAgICAgICAgICAgICBjb3B5LmFkZChpdHIubmV4dCgpKTsNCiAgICAg\nICAgICAgIGlmIChfY2xlYW4gIT0gbnVsbCkNCiAgICAgICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IF9jbGVhbi5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykNCiAgICAgICAgICAgICAgICAgICAgY29weS5hZGQoaXRyLm5l\neHQoKSk7DQogICAgICAgICAgICByZXR1cm4gY29weTsNCiAgICAgICAgfQ0K\nDQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFs\nbCBkaXJ0eSBzdGF0ZSBtYW5hZ2Vycy4NCiAgICAgICAgICovDQogICAgICAg\nIHB1YmxpYyBDb2xsZWN0aW9uIGNvcHlEaXJ0eSgpIHsNCiAgICAgICAgICAg\nIGlmIChfZGlydHkgPT0gbnVsbCB8fCBfZGlydHkuaXNFbXB0eSgpKQ0KICAg\nICAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOw0K\nICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheUxpc3QoX2RpcnR5KTsNCiAg\nICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBUcmFuc2ZlciB0\naGUgZ2l2ZW4gaW5zdGFuY2UgZnJvbSB0aGUgZGlydHkgY2FjaGUgdG8gdGhl\nIGNsZWFuIGNhY2hlLg0KICAgICAgICAgKi8NCiAgICAgICAgcHVibGljIHZv\naWQgZmx1c2hlZChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7DQogICAgICAgICAg\nICBpZiAoc20uaXNEaXJ0eSgpICYmIF9kaXJ0eSAhPSBudWxsICYmIF9kaXJ0\neS5yZW1vdmUoc20pKQ0KICAgICAgICAgICAgICAgIGFkZENsZWFuSW50ZXJu\nYWwoc20pOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAq\nIEFkZCB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhlIGNsZWFuIGNhY2hlLg0K\nICAgICAgICAgKi8NCiAgICAgICAgcHVibGljIHZvaWQgYWRkQ2xlYW4oU3Rh\ndGVNYW5hZ2VySW1wbCBzbSkgew0KICAgICAgICAgICAgaWYgKGFkZENsZWFu\nSW50ZXJuYWwoc20pICYmIF9kaXJ0eSAhPSBudWxsKQ0KICAgICAgICAgICAg\nICAgIF9kaXJ0eS5yZW1vdmUoc20pOw0KICAgICAgICB9DQoNCiAgICAgICAg\ncHJpdmF0ZSBib29sZWFuIGFkZENsZWFuSW50ZXJuYWwoU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSkgew0KICAgICAgICAgICAgaWYgKF9jbGVhbiA9PSBudWxsKQ0K\nICAgICAgICAgICAgICAgIF9jbGVhbiA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0\nKFJlZmVyZW5jZUhhc2hTZXQuU09GVCk7DQogICAgICAgICAgICByZXR1cm4g\nX2NsZWFuLmFkZChzbSk7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAg\nICAgICAgICogQWRkIHRoZSBnaXZlbiBpbnN0YW5jZSB0byB0aGUgZGlydHkg\nY2FjaGUuDQogICAgICAgICAqLw0KICAgICAgICBwdWJsaWMgdm9pZCBhZGRE\naXJ0eShTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7DQogICAgICAgICAgICBpZiAo\nX2RpcnR5ID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICBpZiAoX29yZGVy\nRGlydHkpDQogICAgICAgICAgICAgICAgICAgIF9kaXJ0eSA9IE1hcEJhY2tl\nZFNldC5kZWNvcmF0ZShuZXcgTGlua2VkTWFwKCkpOw0KICAgICAgICAgICAg\nICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgX2RpcnR5ID0gbmV3IEhh\nc2hTZXQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChfZGly\ndHkuYWRkKHNtKSkNCiAgICAgICAgICAgICAgICByZW1vdmVDbGVhbkludGVy\nbmFsKHNtKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAg\nKiBSZW1vdmUgdGhlIGdpdmVuIGluc3RhbmNlIGZyb20gdGhlIGNhY2hlLg0K\nICAgICAgICAgKi8NCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlKFN0\nYXRlTWFuYWdlckltcGwgc20pIHsNCiAgICAgICAgICAgIHJldHVybiByZW1v\ndmVDbGVhbkludGVybmFsKHNtKQ0KICAgICAgICAgICAgICAgIHx8IChfZGly\ndHkgIT0gbnVsbCAmJiBfZGlydHkucmVtb3ZlKHNtKSk7DQogICAgICAgIH0N\nCg0KICAgICAgICBwcml2YXRlIGJvb2xlYW4gcmVtb3ZlQ2xlYW5JbnRlcm5h\nbChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7DQogICAgICAgICAgICByZXR1cm4g\nX2NsZWFuICE9IG51bGwgJiYgX2NsZWFuLnJlbW92ZShzbSk7DQogICAgICAg\nIH0NCg0KICAgICAgICBwdWJsaWMgSXRlcmF0b3IgaXRlcmF0b3IoKSB7DQog\nICAgICAgICAgICBJdGVyYXRvckNoYWluIGNoYWluID0gbmV3IEl0ZXJhdG9y\nQ2hhaW4oKTsNCiAgICAgICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCAmJiAh\nX2RpcnR5LmlzRW1wdHkoKSkNCiAgICAgICAgICAgICAgICBjaGFpbi5hZGRJ\ndGVyYXRvcihfZGlydHkuaXRlcmF0b3IoKSk7DQogICAgICAgICAgICBpZiAo\nX2NsZWFuICE9IG51bGwgJiYgIV9jbGVhbi5pc0VtcHR5KCkpDQogICAgICAg\nICAgICAgICAgY2hhaW4uYWRkSXRlcmF0b3IoX2NsZWFuLml0ZXJhdG9yKCkp\nOw0KICAgICAgICAgICAgcmV0dXJuIGNoYWluOw0KICAgICAgICB9DQoNCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnMoT2JqZWN0IG9iaikgew0K\nICAgICAgICAgICAgcmV0dXJuIChfZGlydHkgIT0gbnVsbCAmJiBfZGlydHku\nY29udGFpbnMob2JqKSkNCiAgICAgICAgICAgICAgICB8fCAoX2NsZWFuICE9\nIG51bGwgJiYgX2NsZWFuLmNvbnRhaW5zKG9iaikpOw0KICAgICAgICB9DQoN\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNBbGwoQ29sbGVjdGlv\nbiBjb2xsKSB7DQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNv\nbGwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspDQogICAgICAgICAgICAg\nICAgaWYgKCFjb250YWlucyhpdHIubmV4dCgpKSkNCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7\nDQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsN\nCiAgICAgICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCkNCiAgICAgICAgICAg\nICAgICBfZGlydHkgPSBudWxsOw0KICAgICAgICAgICAgaWYgKF9jbGVhbiAh\nPSBudWxsKQ0KICAgICAgICAgICAgICAgIF9jbGVhbiA9IG51bGw7DQogICAg\nICAgIH0NCg0KICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5KCkgew0K\nICAgICAgICAgICAgcmV0dXJuIChfZGlydHkgPT0gbnVsbCB8fCBfZGlydHku\naXNFbXB0eSgpKQ0KICAgICAgICAgICAgICAgICYmIChfY2xlYW4gPT0gbnVs\nbCB8fCBfY2xlYW4uaXNFbXB0eSgpKTsNCiAgICAgICAgfQ0KDQogICAgICAg\nIHB1YmxpYyBpbnQgc2l6ZSgpIHsNCiAgICAgICAgICAgIGludCBzaXplID0g\nMDsNCiAgICAgICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCkNCiAgICAgICAg\nICAgICAgICBzaXplICs9IF9kaXJ0eS5zaXplKCk7DQogICAgICAgICAgICBp\nZiAoX2NsZWFuICE9IG51bGwpDQogICAgICAgICAgICAgICAgc2l6ZSArPSBf\nY2xlYW4uc2l6ZSgpOw0KICAgICAgICAgICAgcmV0dXJuIHNpemU7DQogICAg\nICAgIH0NCg0KICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGQoT2JqZWN0IG9i\naikgew0KICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0\naW9uRXhjZXB0aW9uKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBhZGRBbGwoQ29sbGVjdGlvbiBjb2xsKSB7DQogICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsN\nCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZShP\nYmplY3Qgb2JqKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRPcGVyYXRpb25FeGNlcHRpb24oKTsNCiAgICAgICAgfQ0KDQogICAgICAg\nIHB1YmxpYyBib29sZWFuIHJlbW92ZUFsbChDb2xsZWN0aW9uIGNvbGwpIHsN\nCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4\nY2VwdGlvbigpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGJvb2xl\nYW4gcmV0YWluQWxsKENvbGxlY3Rpb24gYykgew0KICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7DQogICAg\nICAgIH0NCg0KICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheSgpIHsN\nCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4\nY2VwdGlvbigpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIE9iamVj\ndFtdIHRvQXJyYXkoT2JqZWN0W10gYXJyKSB7DQogICAgICAgICAgICB0aHJv\ndyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsNCiAgICAg\nICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFVuaXF1ZSBpZCBmb3Ig\nc3RhdGUgbWFuYWdlcnMgb2YgbmV3IGRhdGFzdG9yZSBpbnN0YW5jZXMgd2l0\naG91dCBhc3NpZ25lZA0KICAgICAqIG9iamVjdCBpZHMuDQogICAgICovDQog\nICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgU3RhdGVNYW5hZ2VySWQNCiAgICAg\nICAgaW1wbGVtZW50cyBTZXJpYWxpemFibGUgew0KDQogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgU3RyaW5nIFNUUklOR19QUkVGSVggPSAib3Blbmpw\nYXNtOiI7DQoNCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgbG9uZyBfZ2VuZXJh\ndG9yID0gMDsNCg0KICAgICAgICBwcml2YXRlIGZpbmFsIGludCBfYmhhc2g7\nDQogICAgICAgIHByaXZhdGUgZmluYWwgbG9uZyBfaWQ7DQoNCiAgICAgICAg\ncHVibGljIHN0YXRpYyBTdGF0ZU1hbmFnZXJJZCBuZXdJbnN0YW5jZShCcm9r\nZXIgYikgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0ZU1hbmFnZXJJ\nZChTeXN0ZW0uaWRlbnRpdHlIYXNoQ29kZShiKSwgX2dlbmVyYXRvcisrKTsN\nCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgU3RhdGVNYW5hZ2VySWQo\naW50IGJoYXNoLCBsb25nIGlkKSB7DQogICAgICAgICAgICBfYmhhc2ggPSBi\naGFzaDsNCiAgICAgICAgICAgIF9pZCA9IGlkOw0KICAgICAgICB9DQoNCiAg\nICAgICAgcHVibGljIFN0YXRlTWFuYWdlcklkKFN0cmluZyBzdHIpIHsNCiAg\nICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoU1RSSU5HX1BSRUZJWC5s\nZW5ndGgoKSk7DQogICAgICAgICAgICBpbnQgaWR4ID0gc3RyLmluZGV4T2Yo\nJzonKTsNCiAgICAgICAgICAgIF9iaGFzaCA9IEludGVnZXIucGFyc2VJbnQo\nc3RyLnN1YnN0cmluZygwLCBpZHgpKTsNCiAgICAgICAgICAgIF9pZCA9IExv\nbmcucGFyc2VMb25nKHN0ci5zdWJzdHJpbmcoaWR4ICsgMSkpOw0KICAgICAg\nICB9DQoNCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBv\ndGhlcikgew0KICAgICAgICAgICAgaWYgKG90aGVyID09IHRoaXMpDQogICAg\nICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICBpZiAoIShv\ndGhlciBpbnN0YW5jZW9mIFN0YXRlTWFuYWdlcklkKSkNCiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJ\nZCBzaWQgPSAoU3RhdGVNYW5hZ2VySWQpIG90aGVyOw0KICAgICAgICAgICAg\ncmV0dXJuIF9iaGFzaCA9PSBzaWQuX2JoYXNoICYmIF9pZCA9PSBzaWQuX2lk\nOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgp\nIHsNCiAgICAgICAgICAgIHJldHVybiAoaW50KSAoX2lkIF4gKF9pZCA+Pj4g\nMzIpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9T\ndHJpbmcoKSB7DQogICAgICAgICAgICByZXR1cm4gU1RSSU5HX1BSRUZJWCAr\nIF9iaGFzaCArICI6IiArIF9pZDsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAg\nIC8qKg0KICAgICAqIENvbGxlY3Rpb24gdHlwZSB0aGF0IGhvbGRzIHN0YXRl\nIG1hbmFnZXJzIGJ1dCB3aG9zZSBpbnRlcmZhY2UgZGVhbHMNCiAgICAgKiB3\naXRoIHRoZSBjb3JyZXNwb25kaW5nIG1hbmFnZWQgb2JqZWN0cy4NCiAgICAg\nKi8NCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBNYW5hZ2VkT2JqZWN0Q29s\nbGVjdGlvbg0KICAgICAgICBleHRlbmRzIEFic3RyYWN0Q29sbGVjdGlvbiB7\nDQoNCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBDb2xsZWN0aW9uIF9zdGF0ZXM7\nDQoNCiAgICAgICAgcHVibGljIE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKENv\nbGxlY3Rpb24gc3RhdGVzKSB7DQogICAgICAgICAgICBfc3RhdGVzID0gc3Rh\ndGVzOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIENvbGxlY3Rpb24g\nZ2V0U3RhdGVNYW5hZ2VycygpIHsNCiAgICAgICAgICAgIHJldHVybiBfc3Rh\ndGVzOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGludCBzaXplKCkg\new0KICAgICAgICAgICAgcmV0dXJuIF9zdGF0ZXMuc2l6ZSgpOw0KICAgICAg\nICB9DQoNCiAgICAgICAgcHVibGljIEl0ZXJhdG9yIGl0ZXJhdG9yKCkgew0K\nICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVyYXRvcigpIHsNCiAgICAgICAg\nICAgICAgICBwcml2YXRlIGZpbmFsIEl0ZXJhdG9yIF9pdHIgPSBfc3RhdGVz\nLml0ZXJhdG9yKCk7DQoNCiAgICAgICAgICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNOZXh0KCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2l0\nci5oYXNOZXh0KCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAg\nICAgICAgcHVibGljIE9iamVjdCBuZXh0KCkgew0KICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gKChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBfaXRyLm5leHQo\nKSkuDQogICAgICAgICAgICAgICAgICAgICAgICBnZXRNYW5hZ2VkSW5zdGFu\nY2UoKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCByZW1vdmUoKSB7DQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigpOw0KICAgICAgICAgICAg\nICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICB9DQoNCiAg\nICAvKioNCiAgICAgKiBBc3NpZ24gdGhlIG9iamVjdCBpZCB0byB0aGUgY2Fj\naGUuIEV4Y2VwdGlvbiB3aWxsIGJlDQogICAgICogdGhyb3duIGlmIHRoZSBp\nZCBhbHJlYWR5IGV4aXN0cyBpbiB0aGUgY2FjaGUuIA0KICAgICAqLw0KICAg\nIHByb3RlY3RlZCB2b2lkIGFzc2lnbk9iamVjdElkKE9iamVjdCBjYWNoZSwg\nT2JqZWN0IGlkLCANCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSkgew0K\nICAgICAgICAoKE1hbmFnZWRDYWNoZSkgY2FjaGUpLmFzc2lnbk9iamVjdElk\nKGlkLCBzbSk7IA0KICAgIH0NCg0KICAgIC8qKiANCiAgICAgKiBUaGlzIG1l\ndGhvZCBtYWtlcyBzdXJlIHdlIGRvbid0IGFscmVhZHkgaGF2ZSB0aGUgaW5z\ndGFuY2UgY2FjaGVkDQogICAgICovDQogICAgcHJvdGVjdGVkIHZvaWQgY2hl\nY2tGb3JEdXBsaWNhdGVJZChPYmplY3QgaWQsIE9iamVjdCBvYmopIHsNCiAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBvdGhlciA9IGdldFN0YXRlTWFuYWdl\nckltcGxCeUlkKGlkLCBmYWxzZSk7DQogICAgICAgIGlmIChvdGhlciAhPSBu\ndWxsICYmICFvdGhlci5pc0RlbGV0ZWQoKSAmJiAhb3RoZXIuaXNOZXcoKSkN\nCiAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3RFeGlzdHNFeGNlcHRpb24o\nX2xvYy5nZXQoImNhY2hlLWV4aXN0cyIsDQogICAgICAgICAgICAgICAgb2Jq\nLmdldENsYXNzKCkuZ2V0TmFtZSgpLCBpZCkpLnNldEZhaWxlZE9iamVjdChv\nYmopOw0KICAgIH0NCn0NCg==\n","encoding":"base64"}

