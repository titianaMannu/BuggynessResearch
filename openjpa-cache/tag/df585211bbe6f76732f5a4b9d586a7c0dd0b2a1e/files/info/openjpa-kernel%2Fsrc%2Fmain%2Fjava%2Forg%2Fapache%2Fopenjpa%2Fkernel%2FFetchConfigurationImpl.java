{"sha":"9363edb9daf678d36f7e7841b05435fb08037481","node_id":"MDQ6QmxvYjIwNjM2NDo5MzYzZWRiOWRhZjY3OGQzNmY3ZTc4NDFiMDU0MzVmYjA4MDM3NDgx","size":22913,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9363edb9daf678d36f7e7841b05435fb08037481","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwu\nQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0\naWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQ\nQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnJvcC5FYWdlclJlc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnJvcC5MaXN0UmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5SZXN1bHRMaXN0OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0UHJvdmlk\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5TaW1wbGVS\nZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3Au\nV2luZG93UmVzdWx0TGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmV0Y2hHcm91cDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Ob1RyYW5zYWN0aW9uRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBBbGxvd3Mg\nY29uZmlndXJhdGlvbiBhbmQgb3B0aW1pemF0aW9uIG9mIGhvdyBvYmplY3Rz\nIGFyZSBsb2FkZWQgZnJvbQogKiB0aGUgZGF0YSBzdG9yZS4KICoKICogQHNp\nbmNlIDAuMy4wCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgUGlu\nYWtpIFBvZGRhcgogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRmV0\nY2hDb25maWd1cmF0aW9uSW1wbAogICAgaW1wbGVtZW50cyBGZXRjaENvbmZp\nZ3VyYXRpb24sIENsb25lYWJsZSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAg\nICAgIChGZXRjaENvbmZpZ3VyYXRpb25JbXBsLmNsYXNzKTsKCiAgICAvKioK\nICAgICAqIENvbmZpZ3VyYWJsZSBzdGF0ZSBzaGFyZWQgdGhyb3VnaG91dCBh\nIHRyYXZlcnNhbCBjaGFpbi4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRp\nYyBjbGFzcyBDb25maWd1cmF0aW9uU3RhdGUKICAgICAgICBpbXBsZW1lbnRz\nIFNlcmlhbGl6YWJsZQogICAgewogICAgICAgIHB1YmxpYyB0cmFuc2llbnQg\nU3RvcmVDb250ZXh0IGN0eCA9IG51bGw7CiAgICAgICAgcHVibGljIGludCBm\nZXRjaEJhdGNoU2l6ZSA9IDA7CiAgICAgICAgcHVibGljIGludCBtYXhGZXRj\naERlcHRoID0gMTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBxdWVyeUNhY2hl\nID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgaW50IGZsdXNoUXVlcnkgPSAwOwog\nICAgICAgIHB1YmxpYyBpbnQgbG9ja1RpbWVvdXQgPSAtMTsKICAgICAgICBw\ndWJsaWMgaW50IHJlYWRMb2NrTGV2ZWwgPSBMT0NLX05PTkU7CiAgICAgICAg\ncHVibGljIGludCB3cml0ZUxvY2tMZXZlbCA9IExPQ0tfTk9ORTsKICAgICAg\nICBwdWJsaWMgU2V0IGZldGNoR3JvdXBzID0gbnVsbDsKICAgICAgICBwdWJs\naWMgU2V0IGZpZWxkcyA9IG51bGw7CiAgICAgICAgcHVibGljIFNldCByb290\nQ2xhc3NlczsKICAgICAgICBwdWJsaWMgU2V0IHJvb3RJbnN0YW5jZXM7CiAg\nICAgICAgcHVibGljIE1hcCBoaW50cyA9IG51bGw7CiAgICAgICAgCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gZmV0Y2hHcm91cENvbnRhaW5zRGVmYXVsdCA9\nIGZhbHNlOwogICAgICAgIHB1YmxpYyBib29sZWFuIGZldGNoR3JvdXBDb250\nYWluc0FsbCA9IGZhbHNlOwogICAgfQoKICAgIHByaXZhdGUgZmluYWwgQ29u\nZmlndXJhdGlvblN0YXRlIF9zdGF0ZTsKICAgIHByaXZhdGUgRmV0Y2hDb25m\naWd1cmF0aW9uSW1wbCBfcGFyZW50OwogICAgcHJpdmF0ZSBTdHJpbmcgX2Zy\nb21GaWVsZDsKICAgIHByaXZhdGUgQ2xhc3MgX2Zyb21UeXBlOwogICAgcHJp\ndmF0ZSBTdHJpbmcgX2RpcmVjdFJlbGF0aW9uT3duZXI7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2xvYWQgPSB0cnVlOwogICAgcHJpdmF0ZSBpbnQgX2F2YWls\nYWJsZVJlY3Vyc2lvbjsKICAgIHByaXZhdGUgaW50IF9hdmFpbGFibGVEZXB0\naDsKICAgIAogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbkltcGwoKSB7\nCiAgICAgICAgdGhpcyhudWxsKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgRmV0\nY2hDb25maWd1cmF0aW9uSW1wbChDb25maWd1cmF0aW9uU3RhdGUgc3RhdGUp\nIHsKICAgICAgICBfc3RhdGUgPSAoc3RhdGUgPT0gbnVsbCkgPyBuZXcgQ29u\nZmlndXJhdGlvblN0YXRlKCkgOiBzdGF0ZTsKICAgICAgICBfYXZhaWxhYmxl\nRGVwdGggPSBfc3RhdGUubWF4RmV0Y2hEZXB0aDsKICAgIH0gCgogICAgcHVi\nbGljIFN0b3JlQ29udGV4dCBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVy\nbiBfc3RhdGUuY3R4OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbnRl\neHQoU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIC8vIGNhbid0IHJlc2V0\nIG5vbi1udWxsIGNvbnRleHQgdG8gYW5vdGhlciBjb250ZXh0CiAgICAgICAg\naWYgKGN0eCAhPSBudWxsICYmIF9zdGF0ZS5jdHggIT0gbnVsbCAmJiBjdHgg\nIT0gX3N0YXRlLmN0eCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFs\nRXhjZXB0aW9uKCk7CiAgICAgICAgX3N0YXRlLmN0eCA9IGN0eDsKICAgICAg\nICBpZiAoY3R4ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gaW5pdGlhbGl6ZSB0byBjb25mIGluZm8KICAgICAgICBPcGVuSlBB\nQ29uZmlndXJhdGlvbiBjb25mID0gY3R4LmdldENvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICBzZXRGZXRjaEJhdGNoU2l6ZShjb25mLmdldEZldGNoQmF0Y2hT\naXplKCkpOwogICAgICAgIHNldEZsdXNoQmVmb3JlUXVlcmllcyhjb25mLmdl\ndEZsdXNoQmVmb3JlUXVlcmllc0NvbnN0YW50KCkpOwogICAgICAgIHNldExv\nY2tUaW1lb3V0KGNvbmYuZ2V0TG9ja1RpbWVvdXQoKSk7CiAgICAgICAgY2xl\nYXJGZXRjaEdyb3VwcygpOwogICAgICAgIGFkZEZldGNoR3JvdXBzKEFycmF5\ncy5hc0xpc3QoY29uZi5nZXRGZXRjaEdyb3Vwc0xpc3QoKSkpOwogICAgICAg\nIHNldE1heEZldGNoRGVwdGgoY29uZi5nZXRNYXhGZXRjaERlcHRoKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ2xvbmUgdGhpcyBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHVibGljIE9iamVjdCBjbG9uZSgpIHsKICAgICAgICBGZXRj\naENvbmZpZ3VyYXRpb25JbXBsIGNsb25lID0gbmV3SW5zdGFuY2UobnVsbCk7\nCiAgICAgICAgY2xvbmUuX3N0YXRlLmN0eCA9IF9zdGF0ZS5jdHg7CiAgICAg\nICAgY2xvbmUuX3BhcmVudCA9IF9wYXJlbnQ7CiAgICAgICAgY2xvbmUuX2Zy\nb21GaWVsZCA9IF9mcm9tRmllbGQ7CiAgICAgICAgY2xvbmUuX2Zyb21UeXBl\nID0gX2Zyb21UeXBlOwogICAgICAgIGNsb25lLl9kaXJlY3RSZWxhdGlvbk93\nbmVyID0gX2RpcmVjdFJlbGF0aW9uT3duZXI7CiAgICAgICAgY2xvbmUuX2xv\nYWQgPSBfbG9hZDsKICAgICAgICBjbG9uZS5fYXZhaWxhYmxlUmVjdXJzaW9u\nID0gX2F2YWlsYWJsZVJlY3Vyc2lvbjsKICAgICAgICBjbG9uZS5fYXZhaWxh\nYmxlRGVwdGggPSBfYXZhaWxhYmxlRGVwdGg7CiAgICAgICAgY2xvbmUuY29w\neSh0aGlzKTsKICAgICAgICByZXR1cm4gY2xvbmU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYSBuZXcgaG9sbG93IGluc3RhbmNlLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgRmV0Y2hDb25maWd1cmF0aW9uSW1wbCBuZXdJbnN0\nYW5jZShDb25maWd1cmF0aW9uU3RhdGUgc3RhdGUpIHsKICAgICAgICByZXR1\ncm4gbmV3IEZldGNoQ29uZmlndXJhdGlvbkltcGwoc3RhdGUpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGNvcHkoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nKSB7CiAgICAgICAgc2V0RmV0Y2hCYXRjaFNpemUoZmV0Y2guZ2V0RmV0Y2hC\nYXRjaFNpemUoKSk7CiAgICAgICAgc2V0TWF4RmV0Y2hEZXB0aChmZXRjaC5n\nZXRNYXhGZXRjaERlcHRoKCkpOwogICAgICAgIHNldFF1ZXJ5Q2FjaGVFbmFi\nbGVkKGZldGNoLmdldFF1ZXJ5Q2FjaGVFbmFibGVkKCkpOwogICAgICAgIHNl\ndEZsdXNoQmVmb3JlUXVlcmllcyhmZXRjaC5nZXRGbHVzaEJlZm9yZVF1ZXJp\nZXMoKSk7CiAgICAgICAgc2V0TG9ja1RpbWVvdXQoZmV0Y2guZ2V0TG9ja1Rp\nbWVvdXQoKSk7CiAgICAgICAgY2xlYXJGZXRjaEdyb3VwcygpOwogICAgICAg\nIGFkZEZldGNoR3JvdXBzKGZldGNoLmdldEZldGNoR3JvdXBzKCkpOwogICAg\nICAgIGNsZWFyRmllbGRzKCk7CiAgICAgICAgYWRkRmllbGRzKGZldGNoLmdl\ndEZpZWxkcygpKTsKCiAgICAgICAgLy8gZG9uJ3QgdXNlIHNldHRlcnMgYmVj\nYXVzZSByZXF1aXJlIGFjdGl2ZSB0cmFuc2FjdGlvbgogICAgICAgIF9zdGF0\nZS5yZWFkTG9ja0xldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpOwog\nICAgICAgIF9zdGF0ZS53cml0ZUxvY2tMZXZlbCA9IGZldGNoLmdldFdyaXRl\nTG9ja0xldmVsKCk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRGZXRjaEJh\ndGNoU2l6ZSgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmZldGNoQmF0Y2hT\naXplOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0\nRmV0Y2hCYXRjaFNpemUoaW50IGZldGNoQmF0Y2hTaXplKSB7CiAgICAgICAg\naWYgKGZldGNoQmF0Y2hTaXplID09IERFRkFVTFQgJiYgX3N0YXRlLmN0eCAh\nPSBudWxsKQogICAgICAgICAgICBmZXRjaEJhdGNoU2l6ZSA9IF9zdGF0ZS5j\ndHguZ2V0Q29uZmlndXJhdGlvbigpLmdldEZldGNoQmF0Y2hTaXplKCk7CiAg\nICAgICAgaWYgKGZldGNoQmF0Y2hTaXplICE9IERFRkFVTFQpCiAgICAgICAg\nICAgIF9zdGF0ZS5mZXRjaEJhdGNoU2l6ZSA9IGZldGNoQmF0Y2hTaXplOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0\nTWF4RmV0Y2hEZXB0aCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLm1heEZl\ndGNoRGVwdGg7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlv\nbiBzZXRNYXhGZXRjaERlcHRoKGludCBkZXB0aCkgewogICAgICAgIGlmIChk\nZXB0aCA9PSBERUZBVUxUICYmIF9zdGF0ZS5jdHggIT0gbnVsbCkKICAgICAg\nICAgICAgZGVwdGggPSBfc3RhdGUuY3R4LmdldENvbmZpZ3VyYXRpb24oKS5n\nZXRNYXhGZXRjaERlcHRoKCk7CiAgICAgICAgaWYgKGRlcHRoICE9IERFRkFV\nTFQpCiAgICAgICAgewogICAgICAgICAgICBfc3RhdGUubWF4RmV0Y2hEZXB0\naCA9IGRlcHRoOwogICAgICAgICAgICBpZiAoX3BhcmVudCA9PSBudWxsKQog\nICAgICAgICAgICAgICAgX2F2YWlsYWJsZURlcHRoID0gZGVwdGg7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGdldFF1ZXJ5Q2FjaGVFbmFibGVkKCkgewogICAgICAgIHJldHVy\nbiBfc3RhdGUucXVlcnlDYWNoZTsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hD\nb25maWd1cmF0aW9uIHNldFF1ZXJ5Q2FjaGVFbmFibGVkKGJvb2xlYW4gY2Fj\naGUpIHsKICAgICAgICBfc3RhdGUucXVlcnlDYWNoZSA9IGNhY2hlOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0Rmx1\nc2hCZWZvcmVRdWVyaWVzKCkgewogICAgICAgIHJldHVybiBfc3RhdGUuZmx1\nc2hRdWVyeTsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9u\nIHNldEZsdXNoQmVmb3JlUXVlcmllcyhpbnQgZmx1c2gpIHsKICAgICAgICBp\nZiAoZmx1c2ggPT0gREVGQVVMVCAmJiBfc3RhdGUuY3R4ICE9IG51bGwpCiAg\nICAgICAgICAgIF9zdGF0ZS5mbHVzaFF1ZXJ5ID0gX3N0YXRlLmN0eC5nZXRD\nb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICBnZXRGbHVzaEJlZm9y\nZVF1ZXJpZXNDb25zdGFudCgpOwogICAgICAgIGVsc2UgaWYgKGZsdXNoICE9\nIERFRkFVTFQpCiAgICAgICAgICAgIF9zdGF0ZS5mbHVzaFF1ZXJ5ID0gZmx1\nc2g7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFNl\ndCBnZXRGZXRjaEdyb3VwcygpIHsKICAgICAgICByZXR1cm4gKF9zdGF0ZS5m\nZXRjaEdyb3VwcyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX1NFVCAK\nICAgICAgICAgICAgOiBfc3RhdGUuZmV0Y2hHcm91cHM7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaGFzRmV0Y2hHcm91cChTdHJpbmcgZ3JvdXApIHsK\nICAgICAgICByZXR1cm4gX3N0YXRlLmZldGNoR3JvdXBzICE9IG51bGwKICAg\nICAgICAgICAgJiYgKGhhc0ZldGNoR3JvdXBBbGwoKQogICAgICAgICAgICB8\nfCAgX3N0YXRlLmZldGNoR3JvdXBzLmNvbnRhaW5zKGdyb3VwKSk7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gaGFzRmV0Y2hHcm91cERlZmF1bHQoKQog\nICAgewogICAgICAgIC8vIEZldGNoIGdyb3VwIEFsbCBpbmNsdWRlcyBmZXRj\naCBncm91cCBEZWZhdWx0IGJ5IGRlZmluaXRpb24KICAgICAgICByZXR1cm4g\nX3N0YXRlLmZldGNoR3JvdXBDb250YWluc0RlZmF1bHQgfHwgCiAgICAgICAg\nICAgIF9zdGF0ZS5mZXRjaEdyb3VwQ29udGFpbnNBbGw7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBib29sZWFuIGhhc0ZldGNoR3JvdXBBbGwoKQogICAgewog\nICAgICAgIHJldHVybiBfc3RhdGUuZmV0Y2hHcm91cENvbnRhaW5zQWxsOwog\nICAgfQogICAgCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIGFkZEZl\ndGNoR3JvdXAoU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShuYW1lKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm51bGwtZmciKSk7CgogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3N0YXRlLmZldGNo\nR3JvdXBzID09IG51bGwpCiAgICAgICAgICAgICAgICBfc3RhdGUuZmV0Y2hH\ncm91cHMgPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICBfc3RhdGUuZmV0\nY2hHcm91cHMuYWRkKG5hbWUpOwogICAgICAgICAgICBpZiAoRmV0Y2hHcm91\ncC5OQU1FX0FMTC5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgICAgICBfc3Rh\ndGUuZmV0Y2hHcm91cENvbnRhaW5zQWxsID0gdHJ1ZTsKICAgICAgICAgICAg\nZWxzZSBpZiAoRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQuZXF1YWxzKG5hbWUp\nKQogICAgICAgICAgICAgICAgX3N0YXRlLmZldGNoR3JvdXBDb250YWluc0Rl\nZmF1bHQgPSB0cnVlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAg\nIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIGFkZEZldGNoR3Jv\ndXBzKENvbGxlY3Rpb24gZ3JvdXBzKSB7CiAgICAgICAgaWYgKGdyb3VwcyA9\nPSBudWxsIHx8IGdyb3Vwcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gZ3JvdXBzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICBhZGRGZXRj\naEdyb3VwKChTdHJpbmcpIGl0ci5uZXh0KCkpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gcmVt\nb3ZlRmV0Y2hHcm91cChTdHJpbmcgZ3JvdXApIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5mZXRjaEdy\nb3VwcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfc3RhdGUuZmV0Y2hH\ncm91cHMucmVtb3ZlKGdyb3VwKTsKICAgICAgICAgICAgICAgIGlmIChGZXRj\naEdyb3VwLk5BTUVfQUxMLmVxdWFscyhncm91cCkpCiAgICAgICAgICAgICAg\nICAgICAgX3N0YXRlLmZldGNoR3JvdXBDb250YWluc0FsbCA9IGZhbHNlOwog\nICAgICAgICAgICAgICAgZWxzZSBpZiAoRmV0Y2hHcm91cC5OQU1FX0RFRkFV\nTFQuZXF1YWxzKGdyb3VwKSkKICAgICAgICAgICAgICAgICAgICBfc3RhdGUu\nZmV0Y2hHcm91cENvbnRhaW5zRGVmYXVsdCA9IGZhbHNlOwogICAgICAgICAg\nICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1\nYmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gcmVtb3ZlRmV0Y2hHcm91cHMoQ29s\nbGVjdGlvbiBncm91cHMpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5mZXRjaEdyb3VwcyAhPSBudWxs\nICYmIGdyb3VwcyAhPSBudWxsKQogICAgICAgICAgICAgICAgZm9yIChPYmpl\nY3QgZ3JvdXAgOiBncm91cHMpCiAgICAgICAgICAgICAgICAgICAgcmVtb3Zl\nRmV0Y2hHcm91cChncm91cC50b1N0cmluZygpKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJh\ndGlvbiBjbGVhckZldGNoR3JvdXBzKCkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3N0YXRlLmZldGNoR3JvdXBz\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9zdGF0ZS5mZXRjaEdyb3Vw\ncy5jbGVhcigpOwogICAgICAgICAgICAgICAgX3N0YXRlLmZldGNoR3JvdXBD\nb250YWluc0FsbCA9IGZhbHNlOwogICAgICAgICAgICAgICAgX3N0YXRlLmZl\ndGNoR3JvdXBDb250YWluc0RlZmF1bHQgPSB0cnVlOwogICAgICAgICAgICB9\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1Ymxp\nYyBGZXRjaENvbmZpZ3VyYXRpb24gcmVzZXRGZXRjaEdyb3VwcygpIHsKICAg\nICAgICBjbGVhckZldGNoR3JvdXBzKCk7CiAgICAgICAgaWYgKF9zdGF0ZS5j\ndHggIT0gbnVsbCkKICAgICAgICAgICAgYWRkRmV0Y2hHcm91cHMoQXJyYXlz\nLmFzTGlzdChfc3RhdGUuY3R4LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAg\nICAgICAgICAgIGdldEZldGNoR3JvdXBzTGlzdCgpKSk7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFNldCBnZXRGaWVsZHMoKSB7\nCiAgICAgICAgcmV0dXJuIChfc3RhdGUuZmllbGRzID09IG51bGwpID8gQ29s\nbGVjdGlvbnMuRU1QVFlfU0VUIDogX3N0YXRlLmZpZWxkczsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNGaWVsZChTdHJpbmcgZmllbGQpIHsKICAg\nICAgICByZXR1cm4gX3N0YXRlLmZpZWxkcyAhPSBudWxsICYmIF9zdGF0ZS5m\naWVsZHMuY29udGFpbnMoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBGZXRj\naENvbmZpZ3VyYXRpb24gYWRkRmllbGQoU3RyaW5nIGZpZWxkKSB7CiAgICAg\nICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoZmllbGQpKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC1maWVs\nZCIpKTsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmIChfc3RhdGUuZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAg\nICBfc3RhdGUuZmllbGRzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAg\nX3N0YXRlLmZpZWxkcy5hZGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9u\nIGFkZEZpZWxkcyhDb2xsZWN0aW9uIGZpZWxkcykgewogICAgICAgIGlmIChm\naWVsZHMgPT0gbnVsbCB8fCBmaWVsZHMuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm4gdGhpczsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmIChfc3RhdGUuZmllbGRzID09IG51bGwpCiAgICAg\nICAgICAgICAgICBfc3RhdGUuZmllbGRzID0gbmV3IEhhc2hTZXQoKTsKICAg\nICAgICAgICAgX3N0YXRlLmZpZWxkcy5hZGRBbGwoZmllbGRzKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNo\nQ29uZmlndXJhdGlvbiByZW1vdmVGaWVsZChTdHJpbmcgZmllbGQpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9z\ndGF0ZS5maWVsZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5m\naWVsZHMucmVtb3ZlKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiByZW1v\ndmVGaWVsZHMoQ29sbGVjdGlvbiBmaWVsZHMpIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5maWVsZHMg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5maWVsZHMucmVtb3Zl\nQWxsKGZpZWxkcyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAg\nfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gY2xlYXJGaWVsZHMo\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmIChfc3RhdGUuZmllbGRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBf\nc3RhdGUuZmllbGRzLmNsZWFyKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0\naGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TG9ja1RpbWVvdXQoKSB7\nCiAgICAgICAgcmV0dXJuIF9zdGF0ZS5sb2NrVGltZW91dDsKICAgIH0KCiAg\nICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIHNldExvY2tUaW1lb3V0KGlu\ndCB0aW1lb3V0KSB7CiAgICAgICAgaWYgKHRpbWVvdXQgPT0gREVGQVVMVCAm\nJiBfc3RhdGUuY3R4ICE9IG51bGwpCiAgICAgICAgICAgIF9zdGF0ZS5sb2Nr\nVGltZW91dCA9IF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJhdGlvbigpLmdldExv\nY2tUaW1lb3V0KCk7CiAgICAgICAgZWxzZSBpZiAodGltZW91dCAhPSBERUZB\nVUxUKQogICAgICAgICAgICBfc3RhdGUubG9ja1RpbWVvdXQgPSB0aW1lb3V0\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nZ2V0UmVhZExvY2tMZXZlbCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLnJl\nYWRMb2NrTGV2ZWw7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJh\ndGlvbiBzZXRSZWFkTG9ja0xldmVsKGludCBsZXZlbCkgewogICAgICAgIGlm\nIChfc3RhdGUuY3R4ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0aGlz\nOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKGxl\ndmVsID09IERFRkFVTFQpCiAgICAgICAgICAgICAgICBfc3RhdGUucmVhZExv\nY2tMZXZlbCA9IF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJhdGlvbigpLgogICAg\nICAgICAgICAgICAgICAgIGdldFJlYWRMb2NrTGV2ZWxDb25zdGFudCgpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfc3RhdGUucmVhZExv\nY2tMZXZlbCA9IGxldmVsOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IGdldFdyaXRlTG9ja0xldmVsKCkgewog\nICAgICAgIHJldHVybiBfc3RhdGUud3JpdGVMb2NrTGV2ZWw7CiAgICB9Cgog\nICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBzZXRXcml0ZUxvY2tMZXZl\nbChpbnQgbGV2ZWwpIHsKICAgICAgICBpZiAoX3N0YXRlLmN0eCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gdGhpczsKCiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0\naW9uKCk7CiAgICAgICAgICAgIGlmIChsZXZlbCA9PSBERUZBVUxUKQogICAg\nICAgICAgICAgICAgX3N0YXRlLndyaXRlTG9ja0xldmVsID0gX3N0YXRlLmN0\neC5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nV3JpdGVMb2NrTGV2ZWxDb25zdGFudCgpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBfc3RhdGUud3JpdGVMb2NrTGV2ZWwgPSBsZXZlbDsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGlj\nIFJlc3VsdExpc3QgbmV3UmVzdWx0TGlzdChSZXN1bHRPYmplY3RQcm92aWRl\nciByb3ApIHsKICAgICAgICBpZiAocm9wIGluc3RhbmNlb2YgTGlzdFJlc3Vs\ndE9iamVjdFByb3ZpZGVyKQogICAgICAgICAgICByZXR1cm4gbmV3IFNpbXBs\nZVJlc3VsdExpc3Qocm9wKTsKICAgICAgICBpZiAoX3N0YXRlLmZldGNoQmF0\nY2hTaXplIDwgMCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBFYWdlclJlc3Vs\ndExpc3Qocm9wKTsKICAgICAgICBpZiAocm9wLnN1cHBvcnRzUmFuZG9tQWNj\nZXNzKCkpCiAgICAgICAgICAgIHJldHVybiBuZXcgU2ltcGxlUmVzdWx0TGlz\ndChyb3ApOwogICAgICAgIHJldHVybiBuZXcgV2luZG93UmVzdWx0TGlzdChy\nb3ApOwogICAgfQoKICAgIC8qKgogICAgICogVGhyb3cgYW4gZXhjZXB0aW9u\nIGlmIG5vIHRyYW5zYWN0aW9uIGlzIGFjdGl2ZS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCkgewogICAgICAg\nIGlmIChfc3RhdGUuY3R4ICE9IG51bGwgJiYgIV9zdGF0ZS5jdHguaXNBY3Rp\ndmUoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE5vVHJhbnNhY3Rpb25FeGNl\ncHRpb24oX2xvYy5nZXQoIm5vdC1hY3RpdmUiKSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0SGludChTdHJpbmcgbmFtZSwgT2JqZWN0IHZhbHVlKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChfc3RhdGUuaGludHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0\nZS5oaW50cyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIF9zdGF0ZS5o\naW50cy5wdXQobmFtZSwgdmFsdWUpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldEhpbnQoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1\ncm4gKF9zdGF0ZS5oaW50cyA9PSBudWxsKSA/IG51bGwgOiBfc3RhdGUuaGlu\ndHMuZ2V0KG5hbWUpOwogICAgfQoKICAgIHB1YmxpYyBTZXQgZ2V0Um9vdENs\nYXNzZXMoKSB7CiAgICAgICAgcmV0dXJuIChfc3RhdGUucm9vdENsYXNzZXMg\nPT0gbnVsbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQgCiAgICAgICAgICAg\nIDogX3N0YXRlLnJvb3RDbGFzc2VzOwogICAgfQoKICAgIHB1YmxpYyBGZXRj\naENvbmZpZ3VyYXRpb24gc2V0Um9vdENsYXNzZXMoQ29sbGVjdGlvbiBjbGFz\nc2VzKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmIChfc3RhdGUucm9vdENsYXNzZXMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9zdGF0ZS5yb290Q2xhc3Nlcy5jbGVhcigpOwogICAgICAgICAg\nICBpZiAoY2xhc3NlcyAhPSBudWxsICYmICFjbGFzc2VzLmlzRW1wdHkoKSkg\newogICAgICAgICAgICAgICAgaWYgKF9zdGF0ZS5yb290Q2xhc3NlcyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIF9zdGF0ZS5yb290Q2xhc3NlcyA9\nIG5ldyBIYXNoU2V0KGNsYXNzZXMpOwogICAgICAgICAgICAgICAgZWxzZSAK\nICAgICAgICAgICAgICAgICAgICBfc3RhdGUucm9vdENsYXNzZXMuYWRkQWxs\nKGNsYXNzZXMpOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBTZXQgZ2V0Um9vdEluc3RhbmNl\ncygpIHsKICAgICAgICByZXR1cm4gKF9zdGF0ZS5yb290SW5zdGFuY2VzID09\nIG51bGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfU0VUIAogICAgICAgICAgICA6\nIF9zdGF0ZS5yb290SW5zdGFuY2VzOwogICAgfQoKICAgIHB1YmxpYyBGZXRj\naENvbmZpZ3VyYXRpb24gc2V0Um9vdEluc3RhbmNlcyhDb2xsZWN0aW9uIGlu\nc3RhbmNlcykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoX3N0YXRlLnJvb3RJbnN0YW5jZXMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9zdGF0ZS5yb290SW5zdGFuY2VzLmNsZWFyKCk7CiAg\nICAgICAgICAgIGlmIChpbnN0YW5jZXMgIT0gbnVsbCAmJiAhaW5zdGFuY2Vz\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgaWYgKF9zdGF0ZS5yb290\nSW5zdGFuY2VzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3N0YXRl\nLnJvb3RJbnN0YW5jZXMgPSBuZXcgSGFzaFNldChpbnN0YW5jZXMpOwogICAg\nICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgICAgICBfc3RhdGUu\ncm9vdEluc3RhbmNlcy5hZGRBbGwoaW5zdGFuY2VzKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBsb2NrKCkgewogICAgICAgIGlmIChfc3RhdGUuY3R4ICE9IG51\nbGwpCiAgICAgICAgICAgIF9zdGF0ZS5jdHgubG9jaygpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHVubG9jaygpIHsKICAgICAgICBpZiAoX3N0YXRlLmN0\neCAhPSBudWxsKQogICAgICAgICAgICBfc3RhdGUuY3R4LnVubG9jaygpOwog\nICAgfQoKICAgIC8vLy8vLy8vLy8vLy8KICAgIC8vIFRyYXZlcnNhbAogICAg\nLy8vLy8vLy8vLy8vLwogICAgCiAgICBwdWJsaWMgaW50IHJlcXVpcmVzRmV0\nY2goRmllbGRNZXRhRGF0YSBmbSkgewogICAgICAgIGlmICghaW5jbHVkZXMo\nZm0pKQogICAgICAgICAgICByZXR1cm4gRkVUQ0hfTk9ORTsKICAgICAgICAK\nICAgICAgICBDbGFzcyB0eXBlID0gZ2V0UmVsYXRpb25UeXBlKGZtKTsKICAg\nICAgICBpZiAodHlwZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gRkVU\nQ0hfTE9BRDsKICAgICAgICBpZiAoX2F2YWlsYWJsZURlcHRoID09IDApCiAg\nICAgICAgICAgIHJldHVybiBGRVRDSF9OT05FOwoKICAgICAgICAvLyB3ZSBj\nYW4gc2tpcCBjYWxjdWxhdGluZyByZWN1cnNpb24gZGVwdGggaWYgdGhpcyBp\ncyBhIHRvcC1sZXZlbCBjb25mOgogICAgICAgIC8vIHRoZSBmaWVsZCBpcyBp\nbiBvdXIgZmV0Y2ggZ3JvdXBzLCBzbyBjYW4ndCBwb3NzaWJseSBub3Qgc2Vs\nZWN0CiAgICAgICAgaWYgKF9wYXJlbnQgPT0gbnVsbCkgCiAgICAgICAgICAg\nIHJldHVybiBGRVRDSF9MT0FEOwoKICAgICAgICBpbnQgcmRlcHRoID0gZ2V0\nQXZhaWxhYmxlUmVjdXJzaW9uRGVwdGgoZm0sIHR5cGUsIGZhbHNlKTsKICAg\nICAgICBpZiAocmRlcHRoICE9IEZldGNoR3JvdXAuREVQVEhfSU5GSU5JVEUg\nJiYgcmRlcHRoIDw9IDApCiAgICAgICAgICAgIHJldHVybiBGRVRDSF9OT05F\nOwoKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzKF9kaXJlY3RSZWxh\ndGlvbk93bmVyLCBmbS5nZXRGdWxsTmFtZSgpKSkKICAgICAgICAgICAgcmV0\ndXJuIEZFVENIX1JFRjsKICAgICAgICByZXR1cm4gRkVUQ0hfTE9BRDsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc0xvYWQoKSB7CiAgICAg\nICAgcmV0dXJuIF9sb2FkOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZp\nZ3VyYXRpb24gdHJhdmVyc2UoRmllbGRNZXRhRGF0YSBmbSkgewogICAgICAg\nIENsYXNzIHR5cGUgPSBnZXRSZWxhdGlvblR5cGUoZm0pOwogICAgICAgIGlm\nICh0eXBlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwoKICAg\nICAgICBGZXRjaENvbmZpZ3VyYXRpb25JbXBsIGNsb25lID0gbmV3SW5zdGFu\nY2UoX3N0YXRlKTsKICAgICAgICBjbG9uZS5fcGFyZW50ID0gdGhpczsKICAg\nICAgICBjbG9uZS5fYXZhaWxhYmxlRGVwdGggPSByZWR1Y2UoX2F2YWlsYWJs\nZURlcHRoKTsKICAgICAgICBjbG9uZS5fZnJvbUZpZWxkID0gZm0uZ2V0RnVs\nbE5hbWUoZmFsc2UpOwogICAgICAgIGNsb25lLl9mcm9tVHlwZSA9IHR5cGU7\nCiAgICAgICAgY2xvbmUuX2F2YWlsYWJsZVJlY3Vyc2lvbiA9IGdldEF2YWls\nYWJsZVJlY3Vyc2lvbkRlcHRoKGZtLCB0eXBlLCB0cnVlKTsKICAgICAgICBp\nZiAoU3RyaW5nVXRpbHMuZXF1YWxzKF9kaXJlY3RSZWxhdGlvbk93bmVyLCBm\nbS5nZXRGdWxsTmFtZSgpKSkKICAgICAgICAgICAgY2xvbmUuX2xvYWQgPSBm\nYWxzZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNsb25lLl9sb2FkID0g\nX2xvYWQ7CgogICAgICAgIEZpZWxkTWV0YURhdGEgb3duZXIgPSBmbS5nZXRN\nYXBwZWRCeU1ldGFEYXRhKCk7CiAgICAgICAgaWYgKG93bmVyICE9IG51bGwg\nJiYgb3duZXIuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAg\nICAgICAgIGNsb25lLl9kaXJlY3RSZWxhdGlvbk93bmVyID0gb3duZXIuZ2V0\nRnVsbE5hbWUoKTsKICAgICAgICAKICAgICAgICByZXR1cm4gY2xvbmU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIG91ciBjb25maWd1cmF0aW9u\nIHN0YXRlIGluY2x1ZGVzIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIGluY2x1ZGVzKEZpZWxkTWV0YURhdGEgZm1kKSB7\nCiAgICAgICAgaWYgKGhhc0ZldGNoR3JvdXBBbGwoKQogICAgICAgICAgICB8\nfCAoZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpIAogICAgICAgICAgICAm\nJiBoYXNGZXRjaEdyb3VwRGVmYXVsdCgpKQogICAgICAgICAgICB8fCBoYXNG\naWVsZChmbWQuZ2V0RnVsbE5hbWUoZmFsc2UpKSkKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgU3RyaW5nW10gZmdzID0gZm1kLmdldEN1c3Rv\nbUZldGNoR3JvdXBzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChoYXNGZXRjaEdyb3Vw\nKGZnc1tpXSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICByZXR1cm4gZmFsc2U7IAogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBhdmFpbGFibGUgcmVjdXJzaW9uIGRlcHRoIHZpYSB0aGUgZ2l2ZW4g\nZmllbGQgZm9yIHRoZQogICAgICogZ2l2ZW4gdHlwZS4KICAgICAqCiAgICAg\nKiBAcGFyYW0gdHJhdmVyc2Ugd2hldGhlciB3ZSdyZSB0cmF2ZXJzaW5nIHRo\nZSBmaWVsZAogICAgICovCiAgICBwcml2YXRlIGludCBnZXRBdmFpbGFibGVS\nZWN1cnNpb25EZXB0aChGaWVsZE1ldGFEYXRhIGZtLCBDbGFzcyB0eXBlLCAK\nICAgICAgICBib29sZWFuIHRyYXZlcnNlKSB7CiAgICAgICAgLy8gc2VlIGlm\nIHRoZXJlJ3MgYSBwcmV2aW91cyBsaW1pdAogICAgICAgIGludCBhdmFpbCA9\nIEludGVnZXIuTUlOX1ZBTFVFOwogICAgICAgIGZvciAoRmV0Y2hDb25maWd1\ncmF0aW9uSW1wbCBmID0gdGhpczsgZiAhPSBudWxsOyBmID0gZi5fcGFyZW50\nKSB7CiAgICAgICAgICAgIGlmIChJbXBsSGVscGVyLmlzQXNzaWduYWJsZShm\nLl9mcm9tVHlwZSwgdHlwZSkpIHsKICAgICAgICAgICAgICAgIGF2YWlsID0g\nZi5fYXZhaWxhYmxlUmVjdXJzaW9uOwogICAgICAgICAgICAgICAgaWYgKHRy\nYXZlcnNlKQogICAgICAgICAgICAgICAgICAgIGF2YWlsID0gcmVkdWNlKGF2\nYWlsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGlmIChhdmFpbCA9PSAwKQogICAgICAgICAgICBy\nZXR1cm4gMDsKICAgICAgICAKICAgICAgICAvLyBjYWxjdWxhdGUgZmV0Y2gg\nZ3JvdXBzIG1heAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IGZtLmdl\ndERlZmluaW5nTWV0YURhdGEoKTsKICAgICAgICBpbnQgbWF4ID0gSW50ZWdl\nci5NSU5fVkFMVUU7CiAgICAgICAgaWYgKGZtLmlzSW5EZWZhdWx0RmV0Y2hH\ncm91cCgpKQogICAgICAgICAgICBtYXggPSBtZXRhLmdldEZldGNoR3JvdXAo\nRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQpLgogICAgICAgICAgICAgICAgZ2V0\nUmVjdXJzaW9uRGVwdGgoZm0pOwogICAgICAgIFN0cmluZ1tdIGdyb3VwcyA9\nIGZtLmdldEN1c3RvbUZldGNoR3JvdXBzKCk7CiAgICAgICAgaW50IGN1cjsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgbWF4ICE9IEZldGNoR3JvdXAuREVQ\nVEhfSU5GSU5JVEUgCiAgICAgICAgICAgICYmIGkgPCBncm91cHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgLy8gaWdub3JlIGN1c3RvbSBncm91cHMg\ndGhhdCBhcmUgaW5hY3RpdmUgaW4gdGhpcyBjb25maWd1cmF0aW9uCiAgICAg\nICAgICAgIGlmICghdGhpcy5oYXNGZXRjaEdyb3VwKGdyb3Vwc1tpXSkpIGNv\nbnRpbnVlOwogICAgICAgICAgICBjdXIgPSBtZXRhLmdldEZldGNoR3JvdXAo\nZ3JvdXBzW2ldKS5nZXRSZWN1cnNpb25EZXB0aChmbSk7CiAgICAgICAgICAg\nIGlmIChjdXIgPT0gRmV0Y2hHcm91cC5ERVBUSF9JTkZJTklURSB8fCBjdXIg\nPiBtYXgpIAogICAgICAgICAgICAgICAgbWF4ID0gY3VyOwogICAgICAgIH0K\nICAgICAgICAvLyByZWR1Y2UgbWF4IGlmIHdlJ3JlIHRyYXZlcnNpbmcgYSBz\nZWxmLXR5cGUgcmVsYXRpb24KICAgICAgICBpZiAodHJhdmVyc2UgJiYgbWF4\nICE9IEludGVnZXIuTUlOX1ZBTFVFCiAgICAgICAgICAgICYmIEltcGxIZWxw\nZXIuaXNBc3NpZ25hYmxlKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCB0eXBl\nKSkKICAgICAgICAgICAgbWF4ID0gcmVkdWNlKG1heCk7CgogICAgICAgIC8v\nIHRha2UgbWluL2RlZmluZWQgb2YgcHJldmlvdXMgYXZhaWwgYW5kIGZldGNo\nIGdyb3VwIG1heAogICAgICAgIGlmIChhdmFpbCA9PSBJbnRlZ2VyLk1JTl9W\nQUxVRSAmJiBtYXggPT0gSW50ZWdlci5NSU5fVkFMVUUpIHsKICAgICAgICAg\nICAgaW50IGRlZiA9IEZldGNoR3JvdXAuUkVDVVJTSU9OX0RFUFRIX0RFRkFV\nTFQ7CiAgICAgICAgICAgIHJldHVybiAodHJhdmVyc2UgJiYgSW1wbEhlbHBl\nci5pc0Fzc2lnbmFibGUoCiAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXRE\nZXNjcmliZWRUeXBlKCksIHR5cGUpKSA/IGRlZiAtIDEgOiBkZWY7CiAgICAg\nICAgfQogICAgICAgIGlmIChhdmFpbCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSB8\nfCBhdmFpbCA9PSBGZXRjaEdyb3VwLkRFUFRIX0lORklOSVRFKQogICAgICAg\nICAgICByZXR1cm4gbWF4OwogICAgICAgIGlmIChtYXggPT0gSW50ZWdlci5N\nSU5fVkFMVUUgfHwgbWF4ID09IEZldGNoR3JvdXAuREVQVEhfSU5GSU5JVEUp\nCiAgICAgICAgICAgIHJldHVybiBhdmFpbDsKICAgICAgICByZXR1cm4gTWF0\naC5taW4obWF4LCBhdmFpbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHJlbGF0aW9uIHR5cGUgb2YgdGhlIGdpdmVuIGZpZWxkLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzcyBnZXRSZWxhdGlvblR5cGUo\nRmllbGRNZXRhRGF0YSBmbSkgewogICAgICAgIGlmIChmbS5pc0RlY2xhcmVk\nVHlwZVBDKCkpCiAgICAgICAgICAgIHJldHVybiBmbS5nZXREZWNsYXJlZFR5\ncGUoKTsKICAgICAgICBpZiAoZm0uZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRU\neXBlUEMoKSkKICAgICAgICAgICAgcmV0dXJuIGZtLmdldEVsZW1lbnQoKS5n\nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICBpZiAoZm0uZ2V0S2V5KCkuaXNE\nZWNsYXJlZFR5cGVQQygpKQogICAgICAgICAgICByZXR1cm4gZm0uZ2V0S2V5\nKCkuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZWR1Y2UgdGhlIGdpdmVuIGxvZ2ljYWwg\nZGVwdGggYnkgMS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IHJl\nZHVjZShpbnQgZCkgewogICAgICAgIGlmIChkID09IDApCiAgICAgICAgICAg\nIHJldHVybiAwOwogICAgICAgIGlmIChkICE9IEZldGNoR3JvdXAuREVQVEhf\nSU5GSU5JVEUpCiAgICAgICAgICAgIGQtLTsKICAgICAgICByZXR1cm4gZDsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRGVidWcgbWV0\naG9kcwogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBGZXRjaENvbmZpZ3Vy\nYXRpb24gZ2V0UGFyZW50KCkgewogICAgICAgIHJldHVybiBfcGFyZW50Owog\nICAgfQogICAgCiAgICBib29sZWFuIGlzUm9vdCgpIHsKICAgICAgICByZXR1\ncm4gX3BhcmVudCA9PSBudWxsOwogICAgfQogICAgCiAgICBGZXRjaENvbmZp\nZ3VyYXRpb24gZ2V0Um9vdCgpIHsKICAgICAgICByZXR1cm4gKGlzUm9vdCgp\nKSA/IHRoaXMgOiBfcGFyZW50LmdldFJvb3QoKTsKICAgIH0KCiAgICBpbnQg\nZ2V0QXZhaWxhYmxlRmV0Y2hEZXB0aCgpIHsKICAgICAgICByZXR1cm4gX2F2\nYWlsYWJsZURlcHRoOwogICAgfQoKICAgIGludCBnZXRBdmFpbGFibGVSZWN1\ncnNpb25EZXB0aCgpIHsKICAgICAgICByZXR1cm4gX2F2YWlsYWJsZVJlY3Vy\nc2lvbjsKICAgIH0KCiAgICBTdHJpbmcgZ2V0VHJhdmVyc2VkRnJvbUZpZWxk\nKCkgewogICAgICAgIHJldHVybiBfZnJvbUZpZWxkOwogICAgfQoKICAgIENs\nYXNzIGdldFRyYXZlcnNlZEZyb21UeXBlKCkgewogICAgICAgIHJldHVybiBf\nZnJvbVR5cGU7CiAgICB9CgogICAgTGlzdCBnZXRQYXRoKCkgewogICAgICAg\nIGlmIChpc1Jvb3QoKSkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25z\nLkVNUFRZX0xJU1Q7CiAgICAgICAgcmV0dXJuIHRyYWNrUGF0aChuZXcgQXJy\nYXlMaXN0KCkpOwogICAgfQogICAgCiAgICBMaXN0IHRyYWNrUGF0aChMaXN0\nIHBhdGgpIHsKICAgICAgICBpZiAoX3BhcmVudCAhPSBudWxsKQogICAgICAg\nICAgICBfcGFyZW50LnRyYWNrUGF0aChwYXRoKTsKICAgICAgICBwYXRoLmFk\nZCh0aGlzKTsKICAgICAgICByZXR1cm4gcGF0aDsKICAgIH0KICAgICAgIAog\nICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4g\nIkZldGNoQ29uZmlndXJhdGlvbkAiICsgU3lzdGVtLmlkZW50aXR5SGFzaENv\nZGUodGhpcykgCiAgICAgICAgICAgICsgIiAoIiArIF9hdmFpbGFibGVEZXB0\naCArICIpIiArIGdldFBhdGhTdHJpbmcoKTsKICAgIH0KICAgIAogICAgcHJp\ndmF0ZSBTdHJpbmcgZ2V0UGF0aFN0cmluZygpCiAgICB7CiAgICAgICAgTGlz\ndCBwYXRoID0gZ2V0UGF0aCgpOwogICAgICAgIGlmIChwYXRoLmlzRW1wdHko\nKSkKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIFN0cmluZ0J1ZmZl\nciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCkuYXBwZW5kICgiOiAiKTsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBhdGguaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgoKEZldGNo\nQ29uZmlndXJhdGlvbkltcGwpIGl0ci5uZXh0KCkpLgogICAgICAgICAgICAg\nICAgZ2V0VHJhdmVyc2VkRnJvbUZpZWxkKCkpOwogICAgICAgICAgICBpZiAo\naXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIi0+\nIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsK\nICAgIH0KfQo=\n","encoding":"base64"}

