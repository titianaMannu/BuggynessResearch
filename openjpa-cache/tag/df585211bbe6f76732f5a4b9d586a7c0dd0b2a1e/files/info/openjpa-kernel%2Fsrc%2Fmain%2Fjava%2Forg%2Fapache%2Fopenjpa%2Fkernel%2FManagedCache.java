{"sha":"36371784c0363c4151b8eeee698d1b84d04b7d15","node_id":"MDQ6QmxvYjIwNjM2NDozNjM3MTc4NGMwMzYzYzQxNTFiOGVlZWU2OThkMWI4NGQwNGI3ZDE1","size":11172,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/36371784c0363c4151b8eeee698d1b84d04b7d15","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLg0KICovDQpwYWNrYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWw7DQoNCmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsNCmltcG9ydCBq\nYXZhLnV0aWwuQXJyYXlMaXN0Ow0KaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0\naW9uOw0KaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsNCmltcG9ydCBq\nYXZhLnV0aWwuSGFzaE1hcDsNCmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsN\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7DQppbXBvcnQgamF2YS51dGls\nLkxpc3Q7DQppbXBvcnQgamF2YS51dGlsLk1hcDsNCg0KaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7DQppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlJlZmVyZW5jZUhhc2hTZXQ7DQpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRXhjZXB0aW9uczsNCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlv\nbjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0\naW9uOw0KDQovKioNCiAqIENhY2hlIG9mIG1hbmFnZWQgb2JqZWN0cy4gTXVz\ndCBiZSBzdGF0aWMgZm9yIHNlcmlhbGl6YXRpb24gcmVhc29ucy4NCiAqLw0K\nY2xhc3MgTWFuYWdlZENhY2hlIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsN\nCg0KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0N\nCiAgICAgICAgTG9jYWxpemVyLmZvclBhY2thZ2UoTWFuYWdlZENhY2hlLmNs\nYXNzKTsNCg0KICAgIHByaXZhdGUgTWFwIF9tYWluOyAvLyBvaWQgLT4gc20N\nCiAgICBwcml2YXRlIE1hcCBfY29uZmxpY3RzID0gbnVsbDsgLy8gY29uZmxp\nY3Qgb2lkIC0+IG5ldyBzbQ0KICAgIHByaXZhdGUgTWFwIF9uZXdzID0gbnVs\nbDsgLy8gdG1wIGlkIC0+IG5ldyBzbQ0KICAgIHByaXZhdGUgQ29sbGVjdGlv\nbiBfZW1iZWRzID0gbnVsbDsgLy8gZW1iZWRkZWQvbm9uLXBlcnNpc3RlbnQg\nc21zDQogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIF91bnRyYWNrZWQgPSBudWxs\nOyAvLyBoYXJkIHJlZnMgdG8gdW50cmFja2VkIHNtcw0KICAgIHByaXZhdGUg\nQnJva2VySW1wbCBicm9rZXI7DQoNCiAgICAvKioNCiAgICAgKiBDb25zdHJ1\nY3Rvcjsgc3VwcGx5IHByaW1hcnkgY2FjaGUgbWFwLg0KICAgICAqLw0KICAg\nIE1hbmFnZWRDYWNoZShCcm9rZXJJbXBsIGJyb2tlcikgew0KICAgICAgICB0\naGlzLmJyb2tlciA9IGJyb2tlcjsNCiAgICAgICAgX21haW4gPSBicm9rZXIu\nbmV3TWFuYWdlZE9iamVjdENhY2hlKCk7DQogICAgfQ0KDQogICAgLyoqDQog\nICAgICogUmV0dXJuIHRoZSBpbnN0YW5jZSBmb3IgdGhlIGdpdmVuIG9pZCwg\nb3B0aW9uYWxseSBhbGxvd2luZw0KICAgICAqIG5ldyBpbnN0YW5jZXMuDQog\nICAgICovDQogICAgcHVibGljIFN0YXRlTWFuYWdlckltcGwgZ2V0QnlJZChP\nYmplY3Qgb2lkLCBib29sZWFuIGFsbG93TmV3KSB7DQogICAgICAgIGlmIChv\naWQgPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KDQogICAg\nICAgIC8vIGNoZWNrIG1haW4gY2FjaGUgZm9yIG9pZA0KICAgICAgICBTdGF0\nZU1hbmFnZXJJbXBsIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIF9tYWluLmdl\ndChvaWQpOw0KICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtMjsNCiAgICAg\nICAgaWYgKHNtICE9IG51bGwpIHsNCiAgICAgICAgICAgIC8vIGlmIGl0J3Mg\nYSBuZXcgaW5zdGFuY2UsIHdlIGtub3cgaXQncyB0aGUgb25seSBtYXRjaCwg\nYmVjYXVzZQ0KICAgICAgICAgICAgLy8gb3RoZXIgcGVycyBpbnN0YW5jZXMg\nb3ZlcnJpZGUgbmV3IGluc3RhbmNlcyBpbiBfY2FjaGUNCiAgICAgICAgICAg\nIGlmIChzbS5pc05ldygpICYmICFzbS5pc0RlbGV0ZWQoKSkNCiAgICAgICAg\nICAgICAgICByZXR1cm4gKGFsbG93TmV3KSA/IHNtIDogbnVsbDsNCiAgICAg\nICAgICAgIGlmICghYWxsb3dOZXcgfHwgIXNtLmlzRGVsZXRlZCgpKQ0KICAg\nICAgICAgICAgICAgIHJldHVybiBzbTsNCg0KICAgICAgICAgICAgLy8gc20g\naXMgZGVsZXRlZDsgY2hlY2sgY29uZmxpY3QgY2FjaGUNCiAgICAgICAgICAg\nIGlmIChfY29uZmxpY3RzICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBz\nbTIgPSAoU3RhdGVNYW5hZ2VySW1wbCkgX2NvbmZsaWN0cy5nZXQob2lkKTsN\nCiAgICAgICAgICAgICAgICBpZiAoc20yICE9IG51bGwpDQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBzbTI7DQogICAgICAgICAgICB9DQogICAgICAg\nIH0NCg0KICAgICAgICAvLyBhdCB0aGlzIHBvaW50IHNtIGlzIG51bGwgb3Ig\nZGVsZXRlZDsgY2hlY2sgdGhlIG5ldyBjYWNoZSBmb3INCiAgICAgICAgLy8g\nYW55IG1hdGNoZXMuIHRoaXMgYWxsb3dzIHVzIHRvIG1hdGNoIGFwcCBpZCBv\nYmplY3RzIHRvIG5ldw0KICAgICAgICAvLyBpbnN0YW5jZXMgd2l0aG91dCBw\nZXJtYW5hbnQgb2lkcw0KICAgICAgICBpZiAoYWxsb3dOZXcgJiYgX25ld3Mg\nIT0gbnVsbCAmJiAhX25ld3MuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBz\nbTIgPSAoU3RhdGVNYW5hZ2VySW1wbCkgX25ld3MuZ2V0KG9pZCk7DQogICAg\nICAgICAgICBpZiAoc20yICE9IG51bGwpDQogICAgICAgICAgICAgICAgcmV0\ndXJuIHNtMjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc207DQogICAg\nfQ0KDQogICAgLyoqDQogICAgICogQ2FsbCB0aGlzIG1ldGhvZCB3aGVuIGEg\nbmV3IHN0YXRlIG1hbmFnZXIgaW5pdGlhbGl6ZXMgaXRzZWxmLg0KICAgICAq\nLw0KICAgIHB1YmxpYyB2b2lkIGFkZChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7\nDQogICAgICAgIGlmICghc20uaXNJbnRlcmNlcHRpbmcoKSkgew0KICAgICAg\nICAgICAgaWYgKF91bnRyYWNrZWQgPT0gbnVsbCkNCiAgICAgICAgICAgICAg\nICBfdW50cmFja2VkID0gbmV3IEhhc2hTZXQoKTsNCiAgICAgICAgICAgIF91\nbnRyYWNrZWQuYWRkKHNtKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgh\nc20uaXNQZXJzaXN0ZW50KCkgfHwgc20uaXNFbWJlZGRlZCgpKSB7DQogICAg\nICAgICAgICBpZiAoX2VtYmVkcyA9PSBudWxsKQ0KICAgICAgICAgICAgICAg\nIF9lbWJlZHMgPSBuZXcgUmVmZXJlbmNlSGFzaFNldChSZWZlcmVuY2VIYXNo\nU2V0LldFQUspOw0KICAgICAgICAgICAgX2VtYmVkcy5hZGQoc20pOw0KICAg\nICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gaW5p\ndGlhbGl6aW5nIG5ldyBpbnN0YW5jZTsgcHV0IGluIG5ldyBjYWNoZSBiZWNh\ndXNlIHdvbid0IGhhdmUNCiAgICAgICAgLy8gcGVybWFuZW50IG9pZCB5ZXQN\nCiAgICAgICAgaWYgKHNtLmlzTmV3KCkpIHsNCiAgICAgICAgICAgIGlmIChf\nbmV3cyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIF9uZXdzID0gbmV3IEhh\nc2hNYXAoKTsNCiAgICAgICAgICAgIF9uZXdzLnB1dChzbS5nZXRJZCgpLCBz\nbSk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAg\nICAvLyBpbml0aWFsaXppbmcgcGVyc2lzdGVudCBpbnN0YW5jZTsgcHV0IGlu\nIG1haW4gY2FjaGUNCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBvcmlnID0g\nKFN0YXRlTWFuYWdlckltcGwpIF9tYWluLnB1dA0KICAgICAgICAgICAgKHNt\nLmdldE9iamVjdElkKCksIHNtKTsNCiAgICAgICAgaWYgKG9yaWcgIT0gbnVs\nbCkgew0KICAgICAgICAgICAgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCks\nIG9yaWcpOw0KICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImR1cC1sb2FkIiwgc20uZ2V0T2JqZWN0SWQoKSwNCiAgICAg\nICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9yaWcuZ2V0TWFuYWdl\nZEluc3RhbmNlKCkpKSkNCiAgICAgICAgICAgICAgICAuc2V0RmFpbGVkT2Jq\nZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKTsNCiAgICAgICAgfQ0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gc3RhdGUg\nbWFuYWdlciBmcm9tIHRoZSBjYWNoZSB3aGVuIGl0IHRyYW5zaXRpb25zDQog\nICAgICogdG8gdHJhbnNpZW50Lg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lk\nIHJlbW92ZShPYmplY3QgaWQsIFN0YXRlTWFuYWdlckltcGwgc20pIHsNCiAg\nICAgICAgLy8gaWYgaXQgaGFzIGEgcGVybWFuZW50IG9pZCwgcmVtb3ZlIGZy\nb20gbWFpbiAvIGNvbmZsaWN0IGNhY2hlLA0KICAgICAgICAvLyBlbHNlIHJl\nbW92ZSBmcm9tIGVtYmVkZGVkL25vbnRyYW5zIGNhY2hlLCBhbmQgaWYgbm90\nIHRoZXJlDQogICAgICAgIC8vIHJlbW92ZSBmcm9tIG5ldyBjYWNoZQ0KICAg\nICAgICBPYmplY3Qgb3JpZzsNCiAgICAgICAgaWYgKHNtLmdldE9iamVjdElk\nKCkgIT0gbnVsbCkgew0KICAgICAgICAgICAgb3JpZyA9IF9tYWluLnJlbW92\nZShpZCk7DQogICAgICAgICAgICBpZiAob3JpZyAhPSBzbSkgew0KICAgICAg\nICAgICAgICAgIGlmIChvcmlnICE9IG51bGwpDQogICAgICAgICAgICAgICAg\nICAgIF9tYWluLnB1dChpZCwgb3JpZyk7IC8vIHB1dCBiYWNrDQogICAgICAg\nICAgICAgICAgaWYgKF9jb25mbGljdHMgIT0gbnVsbCkgew0KICAgICAgICAg\nICAgICAgICAgICBvcmlnID0gX2NvbmZsaWN0cy5yZW1vdmUoaWQpOw0KICAg\nICAgICAgICAgICAgICAgICBpZiAob3JpZyAhPSBudWxsICYmIG9yaWcgIT0g\nc20pDQogICAgICAgICAgICAgICAgICAgICAgICBfY29uZmxpY3RzLnB1dChp\nZCwgb3JpZyk7IC8vIHB1dCBiYWNrDQogICAgICAgICAgICAgICAgfQ0KICAg\nICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKChfZW1iZWRzID09IG51\nbGwgfHwgIV9lbWJlZHMucmVtb3ZlKHNtKSkNCiAgICAgICAgICAgICYmIF9u\nZXdzICE9IG51bGwpIHsNCiAgICAgICAgICAgIG9yaWcgPSBfbmV3cy5yZW1v\ndmUoaWQpOw0KICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCAmJiBvcmln\nICE9IHNtKQ0KICAgICAgICAgICAgICAgIF9uZXdzLnB1dChpZCwgb3JpZyk7\nIC8vIHB1dCBiYWNrDQogICAgICAgIH0NCg0KICAgICAgICBpZiAoX3VudHJh\nY2tlZCAhPSBudWxsKQ0KICAgICAgICAgICAgX3VudHJhY2tlZC5yZW1vdmUo\nc20pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFuIGVtYmVkZGVkIG9y\nIG5vbnBlcnNpc3RlbnQgbWFuYWdlZCBpbnN0YW5jZSBoYXMgYmVlbiBwZXJz\naXN0ZWQuDQogICAgICovDQogICAgcHVibGljIHZvaWQgcGVyc2lzdChTdGF0\nZU1hbmFnZXJJbXBsIHNtKSB7DQogICAgICAgIGlmIChfZW1iZWRzICE9IG51\nbGwpDQogICAgICAgICAgICBfZW1iZWRzLnJlbW92ZShzbSk7DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogQSBuZXcgaW5zdGFuY2UgaGFzIGp1c3QgYmVl\nbiBhc3NpZ25lZCBhIHBlcm1hbmVudCBvaWQuDQogICAgICovDQogICAgcHVi\nbGljIHZvaWQgYXNzaWduT2JqZWN0SWQoT2JqZWN0IGlkLCBTdGF0ZU1hbmFn\nZXJJbXBsIHNtKSB7DQogICAgICAgIC8vIGlmIGFzc2lnbmluZyBvaWQsIHJl\nbW92ZSBmcm9tIG5ldyBjYWNoZSBhbmQgcHV0IGluIHByaW1hcnk7IG1heQ0K\nICAgICAgICAvLyBub3QgYmUgaW4gbmV3IGNhY2hlIGlmIGFub3RoZXIgbmV3\nIGluc3RhbmNlIGhhZCBzYW1lIGlkDQogICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgb3JpZyA9IG51bGw7DQogICAgICAgIGlmIChfbmV3cyAhPSBudWxsKSB7\nDQogICAgICAgICAgICBvcmlnID0gKFN0YXRlTWFuYWdlckltcGwpIF9uZXdz\nLnJlbW92ZShpZCk7DQogICAgICAgICAgICBpZiAob3JpZyAhPSBudWxsICYm\nIG9yaWcgIT0gc20pDQogICAgICAgICAgICAgICAgX25ld3MucHV0KGlkLCBv\ncmlnKTsgLy8gcHV0IGJhY2sNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHB1\ndCBpbiBtYWluIGNhY2hlLCBidXQgbWFrZSBzdXJlIHdlIGRvbid0IHJlcGxh\nY2UgYW5vdGhlcg0KICAgICAgICAvLyBpbnN0YW5jZSB3aXRoIHRoZSBzYW1l\nIG9pZA0KICAgICAgICBvcmlnID0gKFN0YXRlTWFuYWdlckltcGwpIF9tYWlu\nLnB1dChzbS5nZXRPYmplY3RJZCgpLCBzbSk7DQogICAgICAgIGlmIChvcmln\nICE9IG51bGwpIHsNCiAgICAgICAgICAgIF9tYWluLnB1dChzbS5nZXRPYmpl\nY3RJZCgpLCBvcmlnKTsNCiAgICAgICAgICAgIGlmICghb3JpZy5pc0RlbGV0\nZWQoKSkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgiZHVwLW9pZC1hc3NpZ24iLA0KICAgICAgICAgICAgICAg\nICAgICBzbS5nZXRPYmplY3RJZCgpLA0KICAgICAgICAgICAgICAgICAgICBF\neGNlcHRpb25zLnRvU3RyaW5nKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKSkp\nDQogICAgICAgICAgICAgICAgICAgIC5zZXRGYWlsZWRPYmplY3Qoc20uZ2V0\nTWFuYWdlZEluc3RhbmNlKCkpOw0KDQogICAgICAgICAgICAvLyBzYW1lIG9p\nZCBhcyBkZWxldGVkIGluc3RhbmNlOyBwdXQgaW4gY29uZmxpY3QgY2FjaGUN\nCiAgICAgICAgICAgIGlmIChfY29uZmxpY3RzID09IG51bGwpDQogICAgICAg\nICAgICAgICAgX2NvbmZsaWN0cyA9IG5ldyBIYXNoTWFwKCk7DQogICAgICAg\nICAgICBfY29uZmxpY3RzLnB1dChzbS5nZXRPYmplY3RJZCgpLCBzbSk7DQog\nICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBIG5ldyBpbnN0\nYW5jZSBoYXMgY29tbWl0dGVkOyByZWNhY2hlIHVuZGVyIHBlcm1hbmVudCBv\naWQuDQogICAgICovDQogICAgcHVibGljIHZvaWQgY29tbWl0TmV3KE9iamVj\ndCBpZCwgU3RhdGVNYW5hZ2VySW1wbCBzbSkgew0KICAgICAgICAvLyBpZiB0\naGUgaWQgZGlkbid0IGNoYW5nZSwgdGhlIGluc3RhbmNlIHdhcyBhbHJlYWR5\nIGFzc2lnbmVkIGFuDQogICAgICAgIC8vIGlkLCBidXQgaXQgY291bGQgaGF2\nZSBiZWVuIGluIGNvbmZsaWN0IGNhY2hlDQogICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgb3JpZzsNCiAgICAgICAgaWYgKHNtLmdldE9iamVjdElkKCkgPT0g\naWQpIHsNCiAgICAgICAgICAgIG9yaWcgPSAoX2NvbmZsaWN0cyA9PSBudWxs\nKSA/IG51bGwNCiAgICAgICAgICAgICAgICA6IChTdGF0ZU1hbmFnZXJJbXBs\nKSBfY29uZmxpY3RzLnJlbW92ZShpZCk7DQogICAgICAgICAgICBpZiAob3Jp\nZyA9PSBzbSkgew0KICAgICAgICAgICAgICAgIG9yaWcgPSAoU3RhdGVNYW5h\nZ2VySW1wbCkgX21haW4ucHV0KGlkLCBzbSk7DQogICAgICAgICAgICAgICAg\naWYgKG9yaWcgIT0gbnVsbCAmJiAhb3JpZy5pc0RlbGV0ZWQoKSkgew0KICAg\nICAgICAgICAgICAgICAgICBfbWFpbi5wdXQoc20uZ2V0T2JqZWN0SWQoKSwg\nb3JpZyk7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJkdXAtb2lkLWFzc2lnbiIsDQogICAgICAgICAg\nICAgICAgICAgICAgICBzbS5nZXRPYmplY3RJZCgpLCBFeGNlcHRpb25zLnRv\nU3RyaW5nKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtLmdldE1h\nbmFnZWRJbnN0YW5jZSgpKSkpDQogICAgICAgICAgICAgICAgICAgICAgICAu\nc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKQ0KICAg\nICAgICAgICAgICAgICAgICAgICAgLnNldEZhdGFsKHRydWUpOw0KICAgICAg\nICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVy\nbjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIG9pZCBjaGFuZ2VkLCBzbyBp\ndCBtdXN0IHByZXZpb3VzbHkgaGF2ZSBiZWVuIGEgbmV3IGluc3RhbmNlDQog\nICAgICAgIC8vIHdpdGhvdXQgYW4gYXNzaWduZWQgb2lkLiAgcmVtb3ZlIGl0\nIGZyb20gdGhlIG5ldyBjYWNoZTsgb2sgaWYNCiAgICAgICAgLy8gd2UgZW5k\nIHVwIHJlbW92aW5nIGFub3RoZXIgaW5zdGFuY2Ugd2l0aCBzYW1lIGlkDQog\nICAgICAgIGlmIChfbmV3cyAhPSBudWxsKQ0KICAgICAgICAgICAgX25ld3Mu\ncmVtb3ZlKGlkKTsNCg0KICAgICAgICAvLyBhbmQgcHV0IGludG8gbWFpbiBj\nYWNoZSBub3cgdGhhdCBpZCBpcyBhc3NzaWduZWQNCiAgICAgICAgb3JpZyA9\nIChTdGF0ZU1hbmFnZXJJbXBsKSBfbWFpbi5wdXQoc20uZ2V0T2JqZWN0SWQo\nKSwgc20pOw0KICAgICAgICBpZiAob3JpZyAhPSBudWxsICYmIG9yaWcgIT0g\nc20gJiYgIW9yaWcuaXNEZWxldGVkKCkpIHsNCiAgICAgICAgICAgIC8vIHB1\ndCBiYWNrIG9yaWcgYW5kIHRocm93IGVycm9yDQogICAgICAgICAgICBfbWFp\nbi5wdXQoc20uZ2V0T2JqZWN0SWQoKSwgb3JpZyk7DQogICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZHVwLW9pZC1hc3Np\nZ24iLA0KICAgICAgICAgICAgICAgIHNtLmdldE9iamVjdElkKCksIEV4Y2Vw\ndGlvbnMudG9TdHJpbmcoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkNCiAg\nICAgICAgICAgICAgICAgICAgLnNldEZhaWxlZE9iamVjdChzbS5nZXRNYW5h\nZ2VkSW5zdGFuY2UoKSkuc2V0RmF0YWwodHJ1ZSk7DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCBj\nYWNoZWQgcGVyc2lzdGVudCBvYmplY3RzLg0KICAgICAqLw0KICAgIHB1Ymxp\nYyBDb2xsZWN0aW9uIGNvcHkoKSB7DQogICAgICAgIC8vIHByb3hpZXMgbm90\nIGluY2x1ZGVkIGhlcmUgYmVjYXVzZSB0aGUgc3RhdGUgbWFuYWdlciBpcyBh\nbHdheXMNCiAgICAgICAgLy8gcHJlc2VudCBpbiBvdGhlciBjYWNoZXMgdG9v\nDQoNCiAgICAgICAgaW50IHNpemUgPSBfbWFpbi5zaXplKCk7DQogICAgICAg\nIGlmIChfY29uZmxpY3RzICE9IG51bGwpDQogICAgICAgICAgICBzaXplICs9\nIF9jb25mbGljdHMuc2l6ZSgpOw0KICAgICAgICBpZiAoX25ld3MgIT0gbnVs\nbCkNCiAgICAgICAgICAgIHNpemUgKz0gX25ld3Muc2l6ZSgpOw0KICAgICAg\nICBpZiAoX2VtYmVkcyAhPSBudWxsKQ0KICAgICAgICAgICAgc2l6ZSArPSBf\nZW1iZWRzLnNpemUoKTsNCiAgICAgICAgaWYgKHNpemUgPT0gMCkNCiAgICAg\nICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOw0KDQogICAg\nICAgIExpc3QgY29weSA9IG5ldyBBcnJheUxpc3Qoc2l6ZSk7DQogICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gX21haW4udmFsdWVzKCkuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspDQogICAgICAgICAgICBjb3B5LmFkZChpdHIu\nbmV4dCgpKTsNCiAgICAgICAgaWYgKF9jb25mbGljdHMgIT0gbnVsbCAmJiAh\nX2NvbmZsaWN0cy5pc0VtcHR5KCkpDQogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IF9jb25mbGljdHMudmFsdWVzKCkuaXRlcmF0b3IoKTsNCiAg\nICAgICAgICAgICAgICBpdHIuaGFzTmV4dCgpOykNCiAgICAgICAgICAgICAg\nICBjb3B5LmFkZChpdHIubmV4dCgpKTsNCiAgICAgICAgaWYgKF9uZXdzICE9\nIG51bGwgJiYgIV9uZXdzLmlzRW1wdHkoKSkNCiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gX25ld3MudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspDQogICAgICAgICAgICAgICAgY29weS5hZGQoaXRyLm5l\neHQoKSk7DQogICAgICAgIGlmIChfZW1iZWRzICE9IG51bGwgJiYgIV9lbWJl\nZHMuaXNFbXB0eSgpKQ0KICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBfZW1iZWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQ0KICAgICAg\nICAgICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOw0KICAgICAgICByZXR1\ncm4gY29weTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDbGVhciB0aGUg\nY2FjaGUuDQogICAgICovDQogICAgcHVibGljIHZvaWQgY2xlYXIoKSB7DQog\nICAgICAgIF9tYWluID0gYnJva2VyLm5ld01hbmFnZWRPYmplY3RDYWNoZSgp\nOw0KICAgICAgICBpZiAoX2NvbmZsaWN0cyAhPSBudWxsKQ0KICAgICAgICAg\nICAgX2NvbmZsaWN0cyA9IG51bGw7DQogICAgICAgIGlmIChfbmV3cyAhPSBu\ndWxsKQ0KICAgICAgICAgICAgX25ld3MgPSBudWxsOw0KICAgICAgICBpZiAo\nX2VtYmVkcyAhPSBudWxsKQ0KICAgICAgICAgICAgX2VtYmVkcyA9IG51bGw7\nDQogICAgICAgIGlmIChfdW50cmFja2VkICE9IG51bGwpDQogICAgICAgICAg\nICBfdW50cmFja2VkID0gbnVsbDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAg\nKiBDbGVhciBuZXcgaW5zdGFuY2VzIHdpdGhvdXQgcGVybWFuZW50IG9pZHMu\nDQogICAgICovDQogICAgcHVibGljIHZvaWQgY2xlYXJOZXcoKSB7DQogICAg\nICAgIGlmIChfbmV3cyAhPSBudWxsKQ0KICAgICAgICAgICAgX25ld3MgPSBu\ndWxsOw0KICAgIH0NCg0KICAgIHZvaWQgZGlydHlDaGVjaygpIHsNCiAgICAg\nICAgaWYgKF91bnRyYWNrZWQgPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVy\nbjsNCg0KICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBfdW50cmFja2Vk\nLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOyApDQogICAgICAgICAgICAo\nKFN0YXRlTWFuYWdlckltcGwpIGl0ZXIubmV4dCgpKS5kaXJ0eUNoZWNrKCk7\nDQogICAgfQ0KfQ0K\n","encoding":"base64"}

