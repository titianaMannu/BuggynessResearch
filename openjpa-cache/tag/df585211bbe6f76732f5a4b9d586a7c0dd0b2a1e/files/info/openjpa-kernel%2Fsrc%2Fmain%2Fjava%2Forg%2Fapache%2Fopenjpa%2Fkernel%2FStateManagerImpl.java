{"sha":"46eb28340b42973fdc6eef761c5005ac85f48ae6","node_id":"MDQ6QmxvYjIwNjM2NDo0NmViMjgzNDBiNDI5NzNmZGM2ZWVmNzYxYzUwMDVhYzg1ZjQ4YWU2","size":109906,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/46eb28340b42973fdc6eef761c5005ac85f48ae6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk5vdFNlcmlhbGl6\nYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXRTdHJl\nYW07CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1dDsKaW1wb3J0IGphdmEu\naW8uT2JqZWN0T3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5TZXJpYWxp\nemFibGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRp\nbC5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5U\naW1lWm9uZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJp\nbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5K\nUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVu\naGFuY2UuRHluYW1pY1BlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5lbmhhbmNlLkZpZWxkTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLk1hbmFnZWRJbnN0YW5jZVByb3Zp\nZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdp\nc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNp\nc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhh\nbmNlLlJlZGVmaW5pdGlvbkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudE1hbmFnZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZldGNoR3JvdXA7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVXBkYXRlU3RyYXRlZ2llczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZVN0cmF0ZWdpZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5BcHBsaWNhdGlvbklk\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkV4Y2VwdGlvbnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnZhbGlkU3Rh\ndGVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5P\nYmplY3ROb3RGb3VuZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlByb3h5TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9yOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKaW1wb3J0IHNl\ncnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIEltcGxlbWVudGF0aW9uIG9mIHRo\nZSB7QGxpbmsgT3BlbkpQQVN0YXRlTWFuYWdlcn0gaW50ZXJmYWNlIGZvciB1\nc2UKICogd2l0aCB0aGlzIHJ1bnRpbWUuIEVhY2ggc3RhdGUgbWFuYWdlciBt\nYW5hZ2VzIHRoZSBzdGF0ZSBvZiBhIHNpbmdsZQogKiBwZXJzaXN0ZW5jZSBj\nYXBhYmxlIGluc3RhbmNlLiBUaGUgc3RhdGUgbWFuYWdlciBpcyBhbHNvIHJl\nc3BvbnNpYmxlIGZvcgogKiBhbGwgY29tbXVuaWNhdGlvbnMgYWJvdXQgdGhl\nIGluc3RhbmNlIHRvIHRoZSB7QGxpbmsgU3RvcmVNYW5hZ2VyfS4KICogIFRo\nZSBzdGF0ZSBtYW5hZ2VyIHVzZXMgdGhlIFN0YXRlIHBhdHRlcm4gaW4gYm90\naCBpdHMgaW50ZXJhY3Rpb24gd2l0aAogKiB0aGUgZ292ZXJuZWQgaW5zdGFu\nY2UgYW5kIGl0cyBpbnRlcmFjdGlvbiB3aXRoIHRoZSBicm9rZXIuCiAqIElu\nIGl0cyBpbnRlcmFjdGlvbnMgd2l0aCB0aGUgcGVyc2lzdGVuY2UgY2FwYWJs\nZSBpbnN0YW5jZSwgaXQgdXNlcyB0aGUKICoge0BsaW5rIEZpZWxkTWFuYWdl\ncn0gaW50ZXJmYWNlLiBTaW1pbGFybHksIHdoZW4gaW50ZXJhY3Rpbmcgd2l0\naCB0aGUKICogYnJva2VyLCBpdCB1c2VzIHRoZSB7QGxpbmsgUENTdGF0ZX0g\nc2luZ2xldG9uIHRoYXQgcmVwcmVzZW50cwogKiB0aGUgY3VycmVudCBsaWZl\nY3ljbGUgc3RhdGUgb2YgdGhlIGluc3RhbmNlLgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFN0YXRlTWFuYWdlckltcGwKICAg\nIGltcGxlbWVudHMgT3BlbkpQQVN0YXRlTWFuYWdlciwgU2VyaWFsaXphYmxl\nIHsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBMT0FEX0ZHUyA9IDA7\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBMT0FEX0FMTCA9IDE7CiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBMT0FEX1NFUklBTElaRSA9IDI7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfU0FWRSA9IDIg\nPDwgMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0RFUkVG\nID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdf\nTE9BREVEID0gMiA8PCAyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50\nIEZMQUdfUkVBRF9MT0NLRUQgPSAyIDw8IDM7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19XUklURV9MT0NLRUQgPSAyIDw8IDQ7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19PSURfQVNTSUdORUQgPSAy\nIDw8IDU7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19MT0FE\nSU5HID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfUFJFX0RFTEVUSU5HID0gMiA8PCA3OwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfRkxVU0hFRCA9IDIgPDwgODsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX1BSRV9GTFVTSEVEID0gMiA8PCA5Owog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfRkxVU0hFRF9ESVJU\nWSA9IDIgPDwgMTA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxB\nR19JTVBMX0NBQ0hFID0gMiA8PCAxMTsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX0lOVkVSU0VTID0gMiA8PCAxMjsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX05PX1VOUFJPWFkgPSAyIDw8IDEzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfVkVSU0lPTl9DSEVD\nSyA9IDIgPDwgMTQ7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxB\nR19WRVJTSU9OX1VQREFURSA9IDIgPDwgMTU7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19ERVRBQ0hJTkcgPSAyIDw8IDE2OwoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVy\nLmZvclBhY2thZ2UKICAgICAgICAoU3RhdGVNYW5hZ2VySW1wbC5jbGFzcyk7\nCgogICAgLy8gaW5mb3JtYXRpb24gYWJvdXQgdGhlIGluc3RhbmNlCiAgICBw\ncml2YXRlIHRyYW5zaWVudCBQZXJzaXN0ZW5jZUNhcGFibGUgX3BjID0gbnVs\nbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IENsYXNzTWV0YURhdGEgX21ldGEg\nPSBudWxsOwogICAgcHJpdmF0ZSBCaXRTZXQgX2xvYWRlZCA9IG51bGw7CiAg\nICBwcml2YXRlIEJpdFNldCBfZGlydHkgPSBudWxsOwogICAgcHJpdmF0ZSBC\naXRTZXQgX2ZsdXNoID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9mbGFncyA9\nIDA7CgogICAgLy8gaWQgaXMgdGhlIHN0YXRlIG1hbmFnZXIgaWRlbnRpdHk7\nIG9pZCBpcyB0aGUgcGVyc2lzdGVudCBpZGVudGl0eS4gIG9pZAogICAgLy8g\nbWF5IGJlIG51bGwgZm9yIGVtYmVkZGVkIGFuZCB0cmFuc2llbnQtdHJhbnNh\nY3Rpb25hbCBvYmplY3RzIG9yIG5ldwogICAgLy8gaW5zdGFuY2VzIHRoYXQg\naGF2ZW4ndCBiZWVuIGFzc2lnbmVkIGFuIG9pZC4gIGlkIGlzIHJlYXNzaWdu\nZWQgdG8gb2lkCiAgICAvLyBvbiBzdWNjZXNzZnVsIG9pZCBhc3NpZ25tZW50\nIChvciBmbHVzaCBjb21wbGV0aW9uIGlmIGFzc2lnbm1lbnQgaXMKICAgIC8v\nIGR1cmluZyBmbHVzaCkKICAgIHByaXZhdGUgT2JqZWN0IF9pZCA9IG51bGw7\nCiAgICBwcml2YXRlIE9iamVjdCBfb2lkID0gbnVsbDsKCiAgICAvLyB0aGUg\nbWFuYWdpbmcgcGVyc2lzdGVuY2UgbWFuYWdlciBhbmQgbGlmZWN5Y2xlIHN0\nYXRlCiAgICBwcml2YXRlIHRyYW5zaWVudCBCcm9rZXJJbXBsIF9icm9rZXI7\nIC8vIHRoaXMgaXMgc2VyaWFsaXplZCBzcGVjaWFsbHkKICAgIHByaXZhdGUg\nUENTdGF0ZSBfc3RhdGUgPSBQQ1N0YXRlLlRSQU5TSUVOVDsKCiAgICAvLyB0\naGUgY3VycmVudCBhbmQgbGFzdCBsb2FkZWQgdmVyc2lvbiBpbmRpY2F0b3Jz\nLCBhbmQgdGhlIGxvY2sgb2JqZWN0CiAgICBwcml2YXRlIE9iamVjdCBfdmVy\nc2lvbiA9IG51bGw7CiAgICBwcml2YXRlIE9iamVjdCBfbG9hZFZlcnNpb24g\nPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3QgX2xvY2sgPSBudWxsOwogICAg\ncHJpdmF0ZSBpbnQgX3JlYWRMb2NrTGV2ZWwgPSAtMTsKICAgIHByaXZhdGUg\naW50IF93cml0ZUxvY2tMZXZlbCA9IC0xOwoKICAgIC8vIGRlbGVnYXRlcyB3\naGVuIHByb3ZpZGluZy9yZXBsYWNpbmcgaW5zdGFuY2UgZGF0YQogICAgcHJp\ndmF0ZSBTaW5nbGVGaWVsZE1hbmFnZXIgX3NpbmdsZSA9IG51bGw7CiAgICBw\ncml2YXRlIFNhdmVGaWVsZE1hbmFnZXIgX3NhdmVkID0gbnVsbDsKICAgIHBy\naXZhdGUgRmllbGRNYW5hZ2VyIF9mbSA9IG51bGw7CgogICAgLy8gaW1wbGRh\ndGE7IGZpZWxkIGltcGxkYXRhIGFuZCBpbnRlcm1lZGlhdGUgZGF0YSBzaGFy\nZSB0aGUgc2FtZSBhcnJheQogICAgcHJpdmF0ZSBPYmplY3QgX2ltcGwgPSBu\ndWxsOwogICAgcHJpdmF0ZSBPYmplY3RbXSBfZmllbGRJbXBsID0gbnVsbDsK\nCiAgICAvLyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgb3duZXIgb2YgdGhpcyBp\nbnN0YW5jZSwgaWYgaXQgaXMgZW1iZWRkZWQKICAgIHByaXZhdGUgU3RhdGVN\nYW5hZ2VySW1wbCBfb3duZXIgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX293\nbmVySW5kZXggPSAtMTsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBz\ndXBwbHkgaWQsIHR5cGUgbWV0YWRhdGEsIGFuZCBvd25pbmcgcGVyc2lzdGVu\nY2UgbWFuYWdlci4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdl\nckltcGwoT2JqZWN0IGlkLCBDbGFzc01ldGFEYXRhIG1ldGEsIAogICAgICAg\nIEJyb2tlckltcGwgYnJva2VyKSB7CiAgICAgICAgX2lkID0gaWQ7CiAgICAg\nICAgX21ldGEgPSBtZXRhOwogICAgICAgIF9icm9rZXIgPSBicm9rZXI7CiAg\nICAgICAgX3NpbmdsZSA9IG5ldyBTaW5nbGVGaWVsZE1hbmFnZXIodGhpcywg\nYnJva2VyKTsKCiAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgp\nID09IENsYXNzTWV0YURhdGEuSURfVU5LTk9XTikKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93bmlk\nIiwgX21ldGEpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgb3du\naW5nIHN0YXRlIGFuZCBmaWVsZCBpZiB0aGlzIGlzIGFuIGVtYmVkZGVkIGlu\nc3RhbmNlLgogICAgICovCiAgICB2b2lkIHNldE93bmVyKFN0YXRlTWFuYWdl\nckltcGwgb3duZXIsIFZhbHVlTWV0YURhdGEgb3duZXJNZXRhKSB7CiAgICAg\nICAgX293bmVyID0gb3duZXI7CiAgICAgICAgX293bmVySW5kZXggPSBvd25l\nck1ldGEuZ2V0RmllbGRNZXRhRGF0YSgpLmdldEluZGV4KCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgc3RhdGUgbWFuYWdlciBpcyBp\nbiB0aGUgbWlkZGxlIG9mIGEgbG9hZC4KICAgICAqLwogICAgYm9vbGVhbiBp\nc0xvYWRpbmcoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0xP\nQURJTkcpID4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhp\ncyBzdGF0ZSBtYW5hZ2VyIGlzIGluIHRoZSBtaWRkbGUgb2YgYSBsb2FkIGlu\naXRpYXRlZAogICAgICogYnkgb3V0c2lkZSBjb2RlOyBmb3IgYW55IGludGVy\nbmFsIG1ldGhvZHMgdGhhdCBjYXVzZSBsb2FkaW5nLCB0aGUKICAgICAqIGxv\nYWRpbmcgZmxhZyBpcyBzZXQgYXV0b21hdGljYWxseS4KICAgICAqLwogICAg\ndm9pZCBzZXRMb2FkaW5nKGJvb2xlYW4gbG9hZGluZykgewogICAgICAgIGlm\nIChsb2FkaW5nKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19MT0FESU5H\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0xP\nQURJTkc7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgb3IgcmVzZXQgdGhl\nIGxpZmVjeWNsZSBzdGF0ZSBvZiB0aGUgbWFuYWdlZCBpbnN0YW5jZS4gSWYg\ndGhlCiAgICAgKiB0cmFuc2FjdGlvbmFsIHN0YXRlIG9mIHRoZSBpbnN0YW5j\nZSBjaGFuZ2VzLCBpdCB3aWxsIGJlIGVubGlzdGVkLwogICAgICogZGVsaXN0\nZWQgZnJvbSB0aGUgY3VycmVudCB0cmFuc2FjdGlvbiBhcyBuZWNlc3Nhcnku\nIFRoZSBnaXZlbgogICAgICogc3RhdGUgd2lsbCBiZSBpbml0aWFsaXplZCBh\nZnRlciBiZWluZyBzZXQuIElmIHRoZSBnaXZlbiBzdGF0ZQogICAgICogaXMg\ndGhlIHNhbWUgYXMgdGhlIGN1cnJlbnQgc3RhdGUsIHRoaXMgbWV0aG9kIHdp\nbGwgaGF2ZSBubyBlZmZlY3QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBz\nZXRQQ1N0YXRlKFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICBpZiAoX3N0YXRl\nID09IHN0YXRlKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBub3RpZnkgdGhlIHN0\nb3JlIG1hbmFnZXIgdGhhdCB3ZSdyZSBjaGFuZ2luZyBzdGF0ZXM7IGNhbiB2\nZXRvCiAgICAgICAgICAgIF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuYmVm\nb3JlU3RhdGVDaGFuZ2UodGhpcywgX3N0YXRlLCBzdGF0ZSk7CgogICAgICAg\nICAgICAvLyByZXBsYWNlIHN0YXRlCiAgICAgICAgICAgIGJvb2xlYW4gd2Fz\nRGVsZXRlZCA9IF9zdGF0ZS5pc0RlbGV0ZWQoKTsKICAgICAgICAgICAgYm9v\nbGVhbiB3YXNEaXJ0eSA9IF9zdGF0ZS5pc0RpcnR5KCk7CiAgICAgICAgICAg\nIGJvb2xlYW4gd2FzUGVuZGluZyA9IF9zdGF0ZS5pc1BlbmRpbmdUcmFuc2Fj\ndGlvbmFsKCk7CiAgICAgICAgICAgIF9zdGF0ZSA9IHN0YXRlOwoKICAgICAg\nICAgICAgLy8gZW5saXN0L2RlbGlzdCBmcm9tIHRyYW5zYWN0aW9uCiAgICAg\nICAgICAgIGlmIChfc3RhdGUuaXNUcmFuc2FjdGlvbmFsKCkpIHsKICAgICAg\nICAgICAgICAgIF9icm9rZXIuYWRkVG9UcmFuc2FjdGlvbih0aGlzKTsKICAg\nICAgICAgICAgICAgIGlmIChfc3RhdGUuaXNEZWxldGVkKCkgIT0gd2FzRGVs\nZXRlZCkKICAgICAgICAgICAgICAgICAgICBfYnJva2VyLnNldERpcnR5KHRo\naXMsICF3YXNEaXJ0eSB8fCBpc0ZsdXNoZWQoKSk7CiAgICAgICAgICAgICAg\nICBlbHNlIGlmIChfc3RhdGUuaXNEaXJ0eSgpICYmICF3YXNEaXJ0eSkKICAg\nICAgICAgICAgICAgICAgICBfYnJva2VyLnNldERpcnR5KHRoaXMsIHRydWUp\nOwogICAgICAgICAgICB9IGVsc2UgaWYgKCF3YXNQZW5kaW5nICYmIF9zdGF0\nZS5pc1BlbmRpbmdUcmFuc2FjdGlvbmFsKCkpCiAgICAgICAgICAgICAgICBf\nYnJva2VyLmFkZFRvUGVuZGluZ1RyYW5zYWN0aW9uKHRoaXMpOwogICAgICAg\nICAgICBlbHNlIGlmICh3YXNQZW5kaW5nICYmICFfc3RhdGUuaXNQZW5kaW5n\nVHJhbnNhY3Rpb25hbCgpKQogICAgICAgICAgICAgICAgX2Jyb2tlci5yZW1v\ndmVGcm9tUGVuZGluZ1RyYW5zYWN0aW9uKHRoaXMpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBfYnJva2VyLnJlbW92ZUZyb21UcmFuc2Fj\ndGlvbih0aGlzKTsKCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUKICAgICAg\nICAgICAgX3N0YXRlLmluaXRpYWxpemUodGhpcyk7CiAgICAgICAgICAgIGlm\nIChfc3RhdGUuaXNEZWxldGVkKCkgJiYgIXdhc0RlbGV0ZWQpCiAgICAgICAg\nICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQUZU\nRVJfREVMRVRFKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6\nZShDbGFzcyBjbHMsIFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICAvLyBjaGVj\nayB0byBzZWUgaWYgb3VyIGN1cnJlbnQgb2JqZWN0IGlkIGluc3RhbmNlIGlz\nIHRoZQogICAgICAgIC8vIGNvcnJlY3QgaWQgdHlwZSBmb3IgdGhlIHNwZWNp\nZmllZCBjbGFzczsgdGhpcyBpcyBmb3IgY2FzZXMKICAgICAgICAvLyB3aGVu\nIHdlIGhhdmUgYW4gYXBwbGljYXRpb24gaWQgaGllcmFyY2h5IGFuZCB3ZSBo\nYWQgc2V0IHRoZQogICAgICAgIC8vIG1ldGFkYXRhIHRvIGEgc3VwZXJjbGFz\ncyBpZCAtLSB0aGUgc3ViY2xhc3MnIGlkIG1heSBiZSBhCiAgICAgICAgLy8g\nZGlmZmVyZW50IGNsYXNzLCBzbyB3ZSBuZWVkIHRvIHJlc2V0IGl0CiAgICAg\nICAgaWYgKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSAhPSBjbHMpIHsKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdWIgPSBfbWV0YS5nZXRSZXBvc2l0\nb3J5KCkuZ2V0TWV0YURhdGEKICAgICAgICAgICAgICAgIChjbHMsIF9icm9r\nZXIuZ2V0Q2xhc3NMb2FkZXIoKSwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChf\nb2lkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChfbWV0YS5nZXRJ\nZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRSkK\nICAgICAgICAgICAgICAgICAgICBfb2lkID0gX2Jyb2tlci5nZXRTdG9yZU1h\nbmFnZXIoKS5jb3B5RGF0YVN0b3JlSWQoX29pZCwKICAgICAgICAgICAgICAg\nICAgICAgICAgc3ViKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9tZXRh\nLmlzT3BlbkpQQUlkZW50aXR5KCkpCiAgICAgICAgICAgICAgICAgICAgX29p\nZCA9IEFwcGxpY2F0aW9uSWRzLmNvcHkoX29pZCwgc3ViKTsKICAgICAgICAg\nICAgICAgIGVsc2UgaWYgKHN1Yi5nZXRPYmplY3RJZFR5cGUoKSAhPSBfbWV0\nYS5nZXRPYmplY3RJZFR5cGUoKSkgewogICAgICAgICAgICAgICAgICAgIE9i\namVjdFtdIHBrRmllbGRzID0gQXBwbGljYXRpb25JZHMudG9QS1ZhbHVlcyhf\nb2lkLCBfbWV0YSk7CiAgICAgICAgICAgICAgICAgICAgX29pZCA9IEFwcGxp\nY2F0aW9uSWRzLmZyb21QS1ZhbHVlcyhwa0ZpZWxkcywgc3ViKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfbWV0YSA9\nIHN1YjsKICAgICAgICB9CgogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBp\nbnN0ID0gUENSZWdpc3RyeS5uZXdJbnN0YW5jZShjbHMsIHRoaXMsIF9vaWQs\nIHRydWUpOwogICAgICAgIGlmIChpbnN0ID09IG51bGwpIHsKICAgICAgICAg\nICAgLy8gdGhlIGluc3RhbmNlIHdhcyBudWxsOiBjaGVjayB0byBzZWUgaWYg\ndGhlIGluc3RhbmNlIGlzCiAgICAgICAgICAgIC8vIGFic3RyYWN0IChhcyBj\nYW4gc29tZXRpbWVzIGJlIHRoZSBjYXNlIHdoZW4gdGhlCiAgICAgICAgICAg\nIC8vIGNsYXNzIGRpc2NyaW1pbmF0b3Igc3RyYXRlZ3kgaXMgbm90IGNvbmZp\nZ3VyZWQgY29ycmVjdGx5KQogICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNB\nYnN0cmFjdChjbHMuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImluc3RhbnRpYXRl\nLWFic3RyYWN0IiwKICAgICAgICAgICAgICAgICAgICBjbHMuZ2V0TmFtZSgp\nLCBfb2lkKSk7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2Vw\ndGlvbigpOwogICAgICAgIH0KCiAgICAgICAgaW5pdGlhbGl6ZShpbnN0LCBz\ndGF0ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIHdpdGgg\ndGhlIGdpdmVuIGluc3RhbmNlIGFuZCBzdGF0ZS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgaW5pdGlhbGl6ZShQZXJzaXN0ZW5jZUNhcGFibGUgcGMs\nIFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICBpZiAocGMgPT0gbnVsbCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImlu\naXQtbnVsbC1wYyIsIF9tZXRhKSk7CiAgICAgICAgaWYgKHBjLnBjR2V0U3Rh\ndGVNYW5hZ2VyKCkgIT0gbnVsbCAmJiBwYy5wY0dldFN0YXRlTWFuYWdlcigp\nICE9IHRoaXMpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJpbml0LXNtLXBjIiwKICAgICAgICAgICAgICAgIEV4Y2Vw\ndGlvbnMudG9TdHJpbmcocGMpKSkuc2V0RmFpbGVkT2JqZWN0KHBjKTsKICAg\nICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIodGhpcyk7CgogICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAg\nICAgICAgX2xvYWRlZCA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAg\nICAgIF9mbHVzaCA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAgICAg\nIF9kaXJ0eSA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwoKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgLy8gbWFyayBwcmltYXJ5IGtleSBhbmQgbm9uLXBlcnNpc3RlbnQg\nZmllbGRzIGFzIGxvYWRlZAogICAgICAgICAgICBpZiAoZm1kc1tpXS5pc1By\naW1hcnlLZXkoKQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRNYW5h\nZ2VtZW50KCkgIT0gZm1kc1tpXS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAg\nICAgICAgICAgIF9sb2FkZWQuc2V0KGkpOwoKICAgICAgICAgICAgLy8gcmVj\nb3JkIHdoZXRoZXIgdGhlcmUgYXJlIGFueSBtYW5hZ2VkIGludmVyc2UgZmll\nbGRzCiAgICAgICAgICAgIGlmIChfYnJva2VyLmdldEludmVyc2VNYW5hZ2Vy\nKCkgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgZm1kc1tpXS5nZXRJbnZl\ncnNlTWV0YURhdGFzKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX0lOVkVSU0VTOwogICAgICAgIH0KCiAgICAgICAgcGMu\ncGNTZXREZXRhY2hlZFN0YXRlKG51bGwpOwogICAgICAgIF9wYyA9IHBjOwoK\nICAgICAgICBpZiAoX29pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkKICAgICAg\nICAgICAgKChPcGVuSlBBSWQpIF9vaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5\ncGUoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKCiAgICAgICAgLy8gaW5p\ndGlhbGl6ZSBvdXIgc3RhdGUgYW5kIGFkZCBvdXJzZWx2ZXMgdG8gdGhlIGJy\nb2tlcidzIGNhY2hlCiAgICAgICAgc2V0UENTdGF0ZShzdGF0ZSk7CiAgICAg\nICAgaWYgKF9icm9rZXIuZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQoZ2V0T2Jq\nZWN0SWQoKSwgZmFsc2UpID09IG51bGwpIHsKICAgICAgICAJX2Jyb2tlci5z\nZXRTdGF0ZU1hbmFnZXIoX2lkLCB0aGlzLCBCcm9rZXJJbXBsLlNUQVRVU19J\nTklUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlID09IFBDU3RhdGUu\nUE5FVykKICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNs\nZUV2ZW50LkFGVEVSX1BFUlNJU1QpOwoKICAgICAgICAvLyBpZiB0aGlzIGlz\nIGEgbm9uLXRyYWNraW5nIFBDLCBhZGQgYSBoYXJkIHJlZiB0byB0aGUgYXBw\ncm9wcmlhdGUgZGF0YQogICAgICAgIC8vIHNldHMgYW5kIGdpdmUgaXQgYW4g\nb3Bwb3J0dW5pdHkgdG8gbWFrZSBhIHN0YXRlIHNuYXBzaG90LgogICAgICAg\nIGlmICghaXNJbnRlcmNlcHRpbmcoKSkgewogICAgICAgICAgICBzYXZlRmll\nbGRzKHRydWUpOwogICAgICAgICAgICBpZiAoIWlzTmV3KCkpCiAgICAgICAg\nICAgICAgICBSZWRlZmluaXRpb25IZWxwZXIuYXNzaWduTGF6eUxvYWRQcm94\naWVzKHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgb3Igbm90IGRhdGEgYWNjZXNzIGluIHRoaXMgaW5zdGFuY2UgaXMg\naW50ZXJjZXB0ZWQuIFRoaXMgZGlmZmVycwogICAgICogZnJvbSB7QGxpbmsg\nQ2xhc3NNZXRhRGF0YSNpc0ludGVyY2VwdGluZygpfSBpbiB0aGF0IGl0IGNo\nZWNrcyBmb3IKICAgICAqIHByb3BlcnR5IGFjY2VzcyArIHN1YmNsYXNzaW5n\nIGluIGFkZGl0aW9uIHRvIHRoZSByZWRlZmluaXRpb24gLwogICAgICogZW5o\nYW5jZW1lbnQgY2hlY2tzLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ludGVyY2VwdGluZygpIHsK\nICAgICAgICBpZiAoZ2V0TWV0YURhdGEoKS5pc0ludGVyY2VwdGluZygpKQog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoZ2V0TWV0YURh\ndGEoKS5nZXRBY2Nlc3NUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1Nf\nRklFTEQKICAgICAgICAgICAgJiYgX3BjIGluc3RhbmNlb2YgRHluYW1pY1Bl\ncnNpc3RlbmNlQ2FwYWJsZSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7Cgog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEZp\ncmUgdGhlIGdpdmVuIGxpZmVjeWNsZSBldmVudCB0byBhbGwgbGlzdGVuZXJz\nLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gZmlyZUxpZmVjeWNsZUV2\nZW50KGludCB0eXBlKSB7CiAgICAgICAgcmV0dXJuIF9icm9rZXIuZmlyZUxp\nZmVjeWNsZUV2ZW50KGdldE1hbmFnZWRJbnN0YW5jZSgpLCBudWxsLAogICAg\nICAgICAgICBfbWV0YSwgdHlwZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nbG9hZChGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBsb2Fk\nKGZldGNoLCBMT0FEX0ZHUywgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgfQoK\nICAgIC8qKgogICAgICogTG9hZCB0aGUgc3RhdGUgb2YgdGhpcyBpbnN0YW5j\nZSBiYXNlZCBvbiB0aGUgZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlvbgogICAg\nICogYW5kIGxvYWQgbW9kZS4gUmV0dXJuIHRydWUgaWYgYW55IGRhdGEgd2Fz\nIGxvYWRlZCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBwcm90ZWN0\nZWQgYm9vbGVhbiBsb2FkKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50\nIGxvYWRNb2RlLAogICAgICAgIEJpdFNldCBleGNsdWRlLCBPYmplY3Qgc2Rh\ndGEsIGJvb2xlYW4gZm9yV3JpdGUpIHsKICAgICAgICBpZiAoIWZvcldyaXRl\nICYmICghaXNQZXJzaXN0ZW50KCkgfHwgaXNOZXcoKSB8fCBpc0RlbGV0ZWQo\nKSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gaWYg\nYW55IGZpZWxkcyBiZWluZyBsb2FkZWQsIGRvIHN0YXRlIHRyYW5zaXRpb25z\nIGZvciByZWFkCiAgICAgICAgQml0U2V0IGZpZWxkcyA9IGdldFVubG9hZGVk\nSW50ZXJuYWwoZmV0Y2gsIGxvYWRNb2RlLCBleGNsdWRlKTsKICAgICAgICBi\nb29sZWFuIGFjdGl2ZSA9IF9icm9rZXIuaXNBY3RpdmUoKTsKICAgICAgICBp\nZiAoIWZvcldyaXRlICYmIGZpZWxkcyAhPSBudWxsKQogICAgICAgICAgICBi\nZWZvcmVSZWFkKC0xKTsKCiAgICAgICAgLy8gY2FsbCBsb2FkIGV2ZW4gaWYg\nbm8gZmllbGRzIGFyZSBiZWluZyBsb2FkZWQsIGJlY2F1c2UgaXQgdGFrZXMK\nICAgICAgICAvLyBjYXJlIG9mIGNoZWNraW5nIGlmIHRoZSBERkcgaXMgbG9h\nZGVkLCBtYWtpbmcgc3VyZSB2ZXJzaW9uIGluZm8KICAgICAgICAvLyBpcyBs\nb2FkZWQsIGV0YwogICAgICAgIGludCBsb2NrTGV2ZWwgPSBjYWxjdWxhdGVM\nb2NrTGV2ZWwoYWN0aXZlLCBmb3JXcml0ZSwgZmV0Y2gpOwogICAgICAgIGJv\nb2xlYW4gcmV0ID0gbG9hZEZpZWxkcyhmaWVsZHMsIGZldGNoLCBsb2NrTGV2\nZWwsIHNkYXRhKTsKICAgICAgICBvYnRhaW5Mb2NrcyhhY3RpdmUsIGZvcldy\naXRlLCBsb2NrTGV2ZWwsIGZldGNoLCBzZGF0YSk7CiAgICAgICAgcmV0dXJu\nIHJldDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldE1hbmFnZWRJbnN0\nYW5jZSgpIHsKICAgICAgICBpZiAoX3BjIGluc3RhbmNlb2YgTWFuYWdlZElu\nc3RhbmNlUHJvdmlkZXIpCiAgICAgICAgICAgIHJldHVybiAoKE1hbmFnZWRJ\nbnN0YW5jZVByb3ZpZGVyKSBfcGMpLmdldE1hbmFnZWRJbnN0YW5jZSgpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIF9wYzsKICAgIH0KCiAg\nICBwdWJsaWMgUGVyc2lzdGVuY2VDYXBhYmxlIGdldFBlcnNpc3RlbmNlQ2Fw\nYWJsZSgpIHsKICAgICAgICByZXR1cm4gX3BjOwogICAgfQoKICAgIHB1Ymxp\nYyBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhKCkgewogICAgICAgIHJldHVy\nbiBfbWV0YTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFuYWdl\nciBnZXRPd25lcigpIHsKICAgICAgICByZXR1cm4gX293bmVyOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgZ2V0T3duZXJJbmRleCgpIHsKICAgICAgICByZXR1\ncm4gX293bmVySW5kZXg7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNF\nbWJlZGRlZCgpIHsKICAgICAgICByZXR1cm4gX293bmVyICE9IG51bGw7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNGbHVzaGVkKCkgewogICAgICAg\nIHJldHVybiAoX2ZsYWdzICYgRkxBR19GTFVTSEVEKSA+IDA7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNGbHVzaGVkRGlydHkoKSB7CiAgICAgICAg\ncmV0dXJuIChfZmxhZ3MgJiBGTEFHX0ZMVVNIRURfRElSVFkpID4gMDsKICAg\nIH0KCiAgICBwdWJsaWMgQml0U2V0IGdldExvYWRlZCgpIHsKICAgICAgICBy\nZXR1cm4gX2xvYWRlZDsKICAgIH0KCiAgICBwdWJsaWMgQml0U2V0IGdldEZs\ndXNoZWQoKSB7CiAgICAgICAgcmV0dXJuIF9mbHVzaDsKICAgIH0KCiAgICBw\ndWJsaWMgQml0U2V0IGdldERpcnR5KCkgewogICAgICAgIHJldHVybiBfZGly\ndHk7CiAgICB9CgogICAgcHVibGljIEJpdFNldCBnZXRVbmxvYWRlZChGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICAvLyBjb2xsZWN0IGZp\nZWxkcyB0byBsb2FkIGZyb20gZGF0YSBzdG9yZSBiYXNlZCBvbiBmZXRjaCBj\nb25maWd1cmF0aW9uCiAgICAgICAgQml0U2V0IGZpZWxkcyA9IGdldFVubG9h\nZGVkSW50ZXJuYWwoZmV0Y2gsIExPQURfRkdTLCBudWxsKTsKICAgICAgICBy\nZXR1cm4gKGZpZWxkcyA9PSBudWxsKSA/IG5ldyBCaXRTZXQoMCkgOiBmaWVs\nZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCB2ZXJzaW9uIG9m\nIHtAbGluayBPcGVuSlBBU3RhdGVNYW5hZ2VyI2dldFVubG9hZGVkfSB0aGF0\nIGF2b2lkcwogICAgICogY3JlYXRpbmcgYW4gZW1wdHkgYml0IHNldCBieSBy\nZXR1cm5pbmcgbnVsbCB3aGVuIHRoZXJlIGFyZSBubyB1bmxvYWRlZAogICAg\nICogZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIEJpdFNldCBnZXRVbmxv\nYWRlZEludGVybmFsKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IG1v\nZGUsCiAgICAgICAgQml0U2V0IGV4Y2x1ZGUpIHsKICAgICAgICBpZiAoZXhj\nbHVkZSA9PSBTdG9yZUNvbnRleHQuRVhDTFVERV9BTEwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICBCaXRTZXQgZmllbGRzID0gbnVsbDsK\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxk\ncygpOwogICAgICAgIGJvb2xlYW4gbG9hZDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYg\nKF9sb2FkZWQuZ2V0KGkpIHx8IChleGNsdWRlICE9IG51bGwgJiYgZXhjbHVk\nZS5nZXQoaSkpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAg\nICAgICBzd2l0Y2ggKG1vZGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgTE9B\nRF9TRVJJQUxJWkU6CiAgICAgICAgICAgICAgICAgICAgbG9hZCA9ICFmbWRz\nW2ldLmlzVHJhbnNpZW50KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIExPQURfRkdTOgogICAgICAgICAgICAg\nICAgICAgIGxvYWQgPSBmZXRjaCA9PSBudWxsIHx8IGZldGNoLnJlcXVpcmVz\nRmV0Y2goZm1kc1tpXSkgCiAgICAgICAgICAgICAgICAgICAgICAgICE9IEZl\ndGNoQ29uZmlndXJhdGlvbi5GRVRDSF9OT05FOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDogLy8gTE9BRF9B\nTEwKICAgICAgICAgICAgICAgICAgICBsb2FkID0gdHJ1ZTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKGxvYWQpIHsKICAgICAgICAgICAgICAg\nIGlmIChmaWVsZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBmaWVs\nZHMgPSBuZXcgQml0U2V0KGZtZHMubGVuZ3RoKTsKICAgICAgICAgICAgICAg\nIGZpZWxkcy5zZXQoaSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGZpZWxkczsKICAgIH0KCiAgICBwdWJsaWMgU3RvcmVDb250\nZXh0IGdldENvbnRleHQoKSB7CiAgICAgICAgcmV0dXJuIF9icm9rZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBNYW5hZ2luZyBicm9rZXIuCiAgICAgKi8K\nICAgIEJyb2tlckltcGwgZ2V0QnJva2VyKCkgewogICAgICAgIHJldHVybiBf\nYnJva2VyOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0SWQoKSB7CiAg\nICAgICAgcmV0dXJuIF9pZDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndE9iamVjdElkKCkgewogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSB0\naGlzOwogICAgICAgIHdoaWxlIChzbS5nZXRPd25lcigpICE9IG51bGwpCiAg\nICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIHNtLmdldE93bmVy\nKCk7CiAgICAgICAgcmV0dXJuIHNtLl9vaWQ7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0T2JqZWN0SWQoT2JqZWN0IG9pZCkgewogICAgICAgIF9vaWQg\nPSBvaWQ7CiAgICAgICAgaWYgKF9wYyAhPSBudWxsICYmIG9pZCBpbnN0YW5j\nZW9mIE9wZW5KUEFJZCkKICAgICAgICAgICAgKChPcGVuSlBBSWQpIG9pZCku\nc2V0TWFuYWdlZEluc3RhbmNlVHlwZShfbWV0YS5nZXREZXNjcmliZWRUeXBl\nKCkpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGFzc2lnbk9iamVjdElk\nKGJvb2xlYW4gZmx1c2gpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcmV0dXJuIGFzc2lnbk9iamVjdElkKGZsdXNoLCBm\nYWxzZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXNrIHN0b3Jl\nIG1hbmFnZXIgdG8gYXNzaWduIG91ciBvaWQsIG9wdGlvbmFsbHkgZmx1c2hp\nbmcgYW5kCiAgICAgKiBvcHRpb25hbGx5IHJlY2FjaGluZyBvbiB0aGUgbmV3\nIG9pZC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGFzc2lnbk9iamVj\ndElkKGJvb2xlYW4gZmx1c2gsIGJvb2xlYW4gcHJlRmx1c2hpbmcpIHsKICAg\nICAgICBpZiAoX29pZCAhPSBudWxsIHx8IGlzRW1iZWRkZWQoKSB8fCAhaXNQ\nZXJzaXN0ZW50KCkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAg\nICBpZiAoX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5hc3NpZ25PYmplY3RJ\nZCh0aGlzLCBwcmVGbHVzaGluZykpIHsKICAgICAgICAgICAgaWYgKCFwcmVG\nbHVzaGluZykKICAgICAgICAgICAgICAgIGFzc2VydE9iamVjdElkQXNzaWdu\nZWQodHJ1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChmbHVzaCkKICAgICAgICAg\nICAgX2Jyb2tlci5mbHVzaCgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSBzdXJlIHdlIHdlcmUgYXNzaWduZWQgYW4gb2lk\nLCBhbmQgcGVyZm9ybSBhY3Rpb25zIHRvIG1ha2UgaXQKICAgICAqIHBlcm1h\nbmVudC4KICAgICAqCiAgICAgKiBAcGFyYW0gcmVjYWNoZSB3aGV0aGVyIHRv\nIHJlY2FjaGUgb3Vyc2VsZiBvbiB0aGUgbmV3IG9pZAogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYXNzZXJ0T2JqZWN0SWRBc3NpZ25lZChib29sZWFuIHJl\nY2FjaGUpIHsKICAgICAgICBpZiAoIWlzTmV3KCkgfHwgaXNEZWxldGVkKCkg\nfHwgaXNQcm92aXNpb25hbCgpIAogICAgICAgICAgICB8fCAoX2ZsYWdzICYg\nRkxBR19PSURfQVNTSUdORUQpICE9IDApCiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICBpZiAoX29pZCA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChf\nbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RB\nVEFTVE9SRSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4\nY2VwdGlvbihFeGNlcHRpb25zLnRvU3RyaW5nCiAgICAgICAgICAgICAgICAg\nICAgKGdldE1hbmFnZWRJbnN0YW5jZSgpKSk7CiAgICAgICAgICAgIF9vaWQg\nPSBBcHBsaWNhdGlvbklkcy5jcmVhdGUoX3BjLCBfbWV0YSk7CiAgICAgICAg\nfQoKICAgICAgICBPYmplY3Qgb3JpZyA9IF9pZDsKICAgICAgICBfaWQgPSBf\nb2lkOwogICAgICAgIGlmIChyZWNhY2hlKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBfYnJva2VyLnNldFN0YXRlTWFuYWdlcihvcmln\nLCB0aGlzLAogICAgICAgICAgICAgICAgICAgIEJyb2tlckltcGwuU1RBVFVT\nX09JRF9BU1NJR04pOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICBfaWQgPSBvcmlnOwogICAg\nICAgICAgICAgICAgX29pZCA9IG51bGw7CiAgICAgICAgICAgICAgICB0aHJv\ndyByZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19PSURfQVNTSUdORUQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nc3NpZ24gdGhlIHByb3BlciBnZW5lcmF0ZWQgdmFsdWUgdG8gdGhlIGdpdmVu\nIGZpZWxkIGJhc2VkIG9uIGl0cwogICAgICogdmFsdWUtc3RyYXRlZ3kuCiAg\nICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBhc3NpZ25GaWVsZChpbnQgZmll\nbGQsIGJvb2xlYW4gcHJlRmx1c2hpbmcpIHsKICAgICAgICBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtID0gdGhpczsKICAgICAgICB3aGlsZSAoc20uaXNFbWJl\nZGRlZCgpKQogICAgICAgICAgICBzbSA9IHNtLmdldE93bmVyKCk7CiAgICAg\nICAgaWYgKCFzbS5pc05ldygpIHx8IHNtLmlzRmx1c2hlZCgpIHx8IHNtLmlz\nRGVsZXRlZCgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAg\nIC8vIHNwZWNpYWwtY2FzZSBvaWQgZmllbGRzLCB3aGljaCByZXF1aXJlIHVz\nIHRvIGxvb2sgaW5zaWRlIHRoZSBvaWQKICAgICAgICAvLyBvYmplY3QKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxk\nKTsKICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBK\nYXZhVHlwZXMuT0lEKSB7CiAgICAgICAgICAgIC8vIHRyeSB0byBzaG9ydGN1\ndCBpZiBwb3NzaWJsZQogICAgICAgICAgICBpZiAoX29pZCAhPSBudWxsIHx8\nIGlzRW1iZWRkZWQoKSB8fCAhaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgICAgIC8vIGNoZWNrIGVtYmVk\nZGVkIGZpZWxkcyBvZiBvaWQgZm9yIHZhbHVlIHN0cmF0ZWd5ICsgZGVmYXVs\ndCB2YWx1ZQogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gcGtzID0gZm1k\nLmdldEVtYmVkZGVkTWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKICAgICAgICAg\nICAgT3BlbkpQQVN0YXRlTWFuYWdlciBvaWRzbSA9IG51bGw7CiAgICAgICAg\nICAgIGJvb2xlYW4gYXNzaWduID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyAhYXNzaWduICYmIGkgPCBwa3MubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIGlmIChwa3NbaV0uZ2V0VmFsdWVTdHJhdGVneSgp\nID09IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKG9pZHNtID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgb2lkc20gPSBuZXcgT2JqZWN0SWRTdGF0\nZU1hbmFnZXIoZmV0Y2hPYmplY3RGaWVsZChmaWVsZCksCiAgICAgICAgICAg\nICAgICAgICAgICAgIHRoaXMsIGZtZCk7CiAgICAgICAgICAgICAgICBhc3Np\nZ24gPSBvaWRzbS5pc0RlZmF1bHRWYWx1ZShpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gYXNzaWduICYmIGFzc2lnbk9iamVjdElkKCFw\ncmVGbHVzaGluZywgcHJlRmx1c2hpbmcpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gSnVzdCByZXR1cm4gaWYgdGhlcmUncyBubyB2YWx1ZSBnZW5lcmF0aW9u\nIHN0cmF0ZWd5CiAgICAgICAgaWYgKGZtZC5nZXRWYWx1ZVN0cmF0ZWd5KCkg\nPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAKICAgICAgICAvLyBUaHJvdyBleGNlcHRpb24gaWYg\nZmllbGQgYWxyZWFkeSBoYXMgYSB2YWx1ZSBhc3NpZ25lZC4KICAgICAgICAv\nLyBAR2VuZXJhdGVkVmFsdWUgb3ZlcnJpZGVzIFBPSk8gaW5pdGlhbCB2YWx1\nZXMgYW5kIHNldHRlciBtZXRob2RzCiAgICAgICAgaWYgKCFmbWQuaXNWYWx1\nZUdlbmVyYXRlZCgpICYmICFpc0RlZmF1bHRWYWx1ZShmaWVsZCkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQoCiAgICAgICAgICAgICAgICAiZXhpc3RpbmctdmFsdWUtb3ZlcnJpZGUt\nZXhjZXAiLCBmbWQuZ2V0RnVsbE5hbWUoZmFsc2UpKSk7CgogICAgICAgIC8v\nIGZvciBwcmltYXJ5IGtleSBmaWVsZHMsIGFzc2lnbiB0aGUgb2JqZWN0IGlk\nIGFuZCByZWNhY2hlIHNvIHRoYXQKICAgICAgICAvLyB0byB0aGUgdXNlciwg\nc28gaXQgbG9va3MgbGlrZSB0aGUgb2lkIGFsd2F5cyBtYXRjaGVzIHRoZSBw\nayBmaWVsZHMKICAgICAgICBpZiAoZm1kLmlzUHJpbWFyeUtleSgpICYmICFp\nc0VtYmVkZGVkKCkpCiAgICAgICAgICAgIHJldHVybiBhc3NpZ25PYmplY3RJ\nZCghcHJlRmx1c2hpbmcsIHByZUZsdXNoaW5nKTsKCiAgICAgICAgLy8gZm9y\nIG90aGVyIGZpZWxkcyBqdXN0IGFzc2lnbiB0aGUgZmllbGQgb3IgZmx1c2gg\naWYgbmVlZGVkCiAgICAgICAgaWYgKF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2Vy\nKCkuYXNzaWduRmllbGQodGhpcywgZmllbGQsIHByZUZsdXNoaW5nKSkgewog\nICAgICAgICAgICBmbWQuc2V0VmFsdWVHZW5lcmF0ZWQodHJ1ZSk7CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIXBy\nZUZsdXNoaW5nKQogICAgICAgICAgICBfYnJva2VyLmZsdXNoKCk7CiAgICAg\nICAgcmV0dXJuICFwcmVGbHVzaGluZzsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGdldExvY2soKSB7CiAgICAgICAgcmV0dXJuIF9sb2NrOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldExvY2soT2JqZWN0IGxvY2spIHsKICAgICAg\nICBfbG9jayA9IGxvY2s7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRW\nZXJzaW9uKCkgewogICAgICAgIHJldHVybiBfdmVyc2lvbjsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRWZXJzaW9uKE9iamVjdCB2ZXJzaW9uKSB7CiAg\nICAgICAgX2xvYWRWZXJzaW9uID0gdmVyc2lvbjsKICAgICAgICBhc3NpZ25W\nZXJzaW9uRmllbGQodmVyc2lvbik7CiAgICB9CgogICAgT2JqZWN0IGdldExv\nYWRWZXJzaW9uKCkgewogICAgICAgIHJldHVybiBfbG9hZFZlcnNpb247CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0TmV4dFZlcnNpb24oT2JqZWN0IHZl\ncnNpb24pIHsKICAgICAgICBhc3NpZ25WZXJzaW9uRmllbGQodmVyc2lvbik7\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGFzc2lnblZlcnNpb25GaWVsZChP\nYmplY3QgdmVyc2lvbikgewogICAgICAgIF92ZXJzaW9uID0gdmVyc2lvbjsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIHZmaWVsZCA9IF9tZXRhLmdldFZlcnNp\nb25GaWVsZCgpOwogICAgICAgIGlmICh2ZmllbGQgIT0gbnVsbCkKICAgICAg\nICAgICAgc3RvcmUodmZpZWxkLmdldEluZGV4KCksIEphdmFUeXBlcy5jb252\nZXJ0KHZlcnNpb24sCiAgICAgICAgICAgICAgICB2ZmllbGQuZ2V0VHlwZUNv\nZGUoKSkpOwogICAgfQoKICAgIHB1YmxpYyBQQ1N0YXRlIGdldFBDU3RhdGUo\nKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZTsKICAgIH0KCiAgICBwdWJsaWMg\nc3luY2hyb25pemVkIE9iamVjdCBnZXRJbXBsRGF0YSgpIHsKICAgICAgICBy\nZXR1cm4gX2ltcGw7CiAgICB9CgogICAgcHVibGljIHN5bmNocm9uaXplZCBP\nYmplY3Qgc2V0SW1wbERhdGEoT2JqZWN0IGRhdGEsIGJvb2xlYW4gY2FjaGVh\nYmxlKSB7CiAgICAgICAgT2JqZWN0IG9sZCA9IF9pbXBsOwogICAgICAgIF9p\nbXBsID0gZGF0YTsKICAgICAgICBpZiAoY2FjaGVhYmxlICYmIGRhdGEgIT0g\nbnVsbCkKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfSU1QTF9DQUNIRTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19JTVBM\nX0NBQ0hFOwogICAgICAgIHJldHVybiBvbGQ7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNJbXBsRGF0YUNhY2hlYWJsZSgpIHsKICAgICAgICByZXR1\ncm4gKF9mbGFncyAmIEZMQUdfSU1QTF9DQUNIRSkgIT0gMDsKICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IGdldEltcGxEYXRhKGludCBmaWVsZCkgewogICAg\nICAgIHJldHVybiBnZXRFeHRyYUZpZWxkRGF0YShmaWVsZCwgdHJ1ZSk7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBzZXRJbXBsRGF0YShpbnQgZmllbGQs\nIE9iamVjdCBkYXRhKSB7CiAgICAgICAgcmV0dXJuIHNldEV4dHJhRmllbGRE\nYXRhKGZpZWxkLCBkYXRhLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgc3lu\nY2hyb25pemVkIGJvb2xlYW4gaXNJbXBsRGF0YUNhY2hlYWJsZShpbnQgZmll\nbGQpIHsKICAgICAgICBpZiAoX2ZpZWxkSW1wbCA9PSBudWxsIHx8ICFfbG9h\nZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICBpZiAoX21ldGEuZ2V0RmllbGQoZmllbGQpLnVzZXNJbXBsRGF0YSgp\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBp\nbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJbmRleChmaWVsZCk7\nCiAgICAgICAgcmV0dXJuIGlkeCAhPSAtMSAmJiBfZmllbGRJbXBsW2lkeF0g\nIT0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldEludGVybWVk\naWF0ZShpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gZ2V0RXh0cmFGaWVs\nZERhdGEoZmllbGQsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRJbnRlcm1lZGlhdGUoaW50IGZpZWxkLCBPYmplY3QgZGF0YSkgewogICAg\nICAgIHNldEV4dHJhRmllbGREYXRhKGZpZWxkLCBkYXRhLCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRhdGEgZnJvbSB0aGUg\ncHJvcGVyIGluZGV4IG9mIHRoZSBleHRyYSBmaWVsZCBkYXRhIGFycmF5Lgog\nICAgICovCiAgICBwcml2YXRlIHN5bmNocm9uaXplZCBPYmplY3QgZ2V0RXh0\ncmFGaWVsZERhdGEoaW50IGZpZWxkLCBib29sZWFuIGlzTG9hZGVkKSB7CiAg\nICAgICAgLy8gb25seSByZXR1cm4gdGhlIGZpZWxkIGRhdGEgaWYgdGhlIGZp\nZWxkIGlzIGluIHRoZSByaWdodCBsb2FkZWQKICAgICAgICAvLyBzdGF0ZTsg\nb3RoZXJ3aXNlIHdlIG1pZ2h0IHJldHVybiBpbnRlcm1lZGlhdGUgZm9yIGlt\ncGwgZGF0YSBvcgogICAgICAgIC8vIHZpY2UgdmVyc2EKICAgICAgICBpZiAo\nX2ZpZWxkSW1wbCA9PSBudWxsIHx8IF9sb2FkZWQuZ2V0KGZpZWxkKSAhPSBp\nc0xvYWRlZCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaW50\nIGlkeCA9IF9tZXRhLmdldEV4dHJhRmllbGREYXRhSW5kZXgoZmllbGQpOwog\nICAgICAgIHJldHVybiAoaWR4ID09IC0xKSA/IG51bGwgOiBfZmllbGRJbXBs\nW2lkeF07CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGRhdGEgZnJv\nbSB0byBwcm9wZXIgaW5kZXggb2YgdGhlIGV4dHJhIGZpZWxkIGRhdGEgYXJy\nYXkuCiAgICAgKi8KICAgIHByaXZhdGUgc3luY2hyb25pemVkIE9iamVjdCBz\nZXRFeHRyYUZpZWxkRGF0YShpbnQgZmllbGQsIE9iamVjdCBkYXRhLAogICAg\nICAgIGJvb2xlYW4gbG9hZGVkKSB7CiAgICAgICAgaW50IGlkeCA9IF9tZXRh\nLmdldEV4dHJhRmllbGREYXRhSW5kZXgoZmllbGQpOwogICAgICAgIGlmIChp\nZHggPT0gLTEpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2Vw\ndGlvbihTdHJpbmcudmFsdWVPZihfbWV0YS5nZXRGaWVsZChmaWVsZCkpKTsK\nCiAgICAgICAgT2JqZWN0IG9sZCA9IChfZmllbGRJbXBsID09IG51bGwpID8g\nbnVsbCA6IF9maWVsZEltcGxbaWR4XTsKICAgICAgICBpZiAoZGF0YSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIC8vIGNhbm5vdCBzZXQgaWYgZmllbGQgaW4g\nd3JvbmcgbG9hZGVkIHN0YXRlCiAgICAgICAgICAgIGlmIChfbG9hZGVkLmdl\ndChmaWVsZCkgIT0gbG9hZGVkKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKFN0cmluZy52YWx1ZU9mKF9tZXRhLmdldEZp\nZWxkCiAgICAgICAgICAgICAgICAgICAgKGZpZWxkKSkpOwoKICAgICAgICAg\nICAgLy8gc2V0IGRhdGEKICAgICAgICAgICAgaWYgKF9maWVsZEltcGwgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9maWVsZEltcGwgPSBuZXcgT2JqZWN0\nW19tZXRhLmdldEV4dHJhRmllbGREYXRhTGVuZ3RoKCldOwogICAgICAgICAg\nICBfZmllbGRJbXBsW2lkeF0gPSBkYXRhOwogICAgICAgIH0gZWxzZSBpZiAo\nX2ZpZWxkSW1wbCAhPSBudWxsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSA9PSBs\nb2FkZWQpCiAgICAgICAgICAgIF9maWVsZEltcGxbaWR4XSA9IG51bGw7CiAg\nICAgICAgcmV0dXJuIG9sZDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZl\ndGNoKGludCBmaWVsZCkgewogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZp\nZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIF9tZXRhLmdldEZp\nZWxkKGZpZWxkKS5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcik7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBmZXRjaEZpZWxkKGludCBmaWVsZCwg\nYm9vbGVhbiB0cmFuc2l0aW9ucykgewogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmIChmbWQg\nPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vLWZpZWxkIiwKICAgICAgICAgICAgICAgIFN0cmluZy52\nYWx1ZU9mKGZpZWxkKSwgZ2V0TWFuYWdlZEluc3RhbmNlKCkuZ2V0Q2xhc3Mo\nKSkpLgogICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KGdldE1hbmFn\nZWRJbnN0YW5jZSgpKTsKCiAgICAgICAgLy8gZG8gbm9ybWFsIHN0YXRlIHRy\nYW5zaXRpb25zCiAgICAgICAgaWYgKCFmbWQuaXNQcmltYXJ5S2V5KCkgJiYg\ndHJhbnNpdGlvbnMpCiAgICAgICAgICAgIGFjY2Vzc2luZ0ZpZWxkKGZpZWxk\nKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAg\nICAgICAgICAgIHJldHVybiBmZXRjaFN0cmluZ0ZpZWxkKGZpZWxkKTsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGZldGNoT2JqZWN0RmllbGQoZmllbGQpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgcmV0\ndXJuIChmZXRjaEJvb2xlYW5GaWVsZChmaWVsZCkpID8gQm9vbGVhbi5UUlVF\nCiAgICAgICAgICAgICAgICAgICAgOiBCb29sZWFuLkZBTFNFOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAgcmV0\ndXJuIG5ldyBCeXRlKGZldGNoQnl0ZUZpZWxkKGZpZWxkKSk7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IENoYXJhY3RlcihmZXRjaENoYXJGaWVsZChmaWVsZCkpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gbmV3IERvdWJsZShmZXRjaERvdWJsZUZpZWxkKGZpZWxkKSk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBGbG9hdChmZXRjaEZsb2F0RmllbGQoZmllbGQp\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAg\nICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihmZXRjaEludEZpZWxkKGZp\nZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAg\nICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGZldGNoTG9uZ0Zp\nZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JU\nOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTaG9ydChmZXRjaFNob3J0\nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgIHJldHVybiBmZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmUoaW50IGZpZWxkLCBP\nYmplY3QgdmFsKSB7CiAgICAgICAgdmFsID0gX21ldGEuZ2V0RmllbGQoZmll\nbGQpLmdldEZpZWxkVmFsdWUodmFsLCBfYnJva2VyKTsKICAgICAgICBzdG9y\nZUZpZWxkKGZpZWxkLCB2YWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0\nb3JlRmllbGQoaW50IGZpZWxkLCBPYmplY3QgdmFsKSB7CiAgICAgICAgc3Rv\ncmVGaWVsZChmaWVsZCwgdmFsLCB0aGlzKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIDxwPkNoZWNrcyB3aGV0aGVyIG9yIG5vdCA8Y29kZT5fcGM8L2NvZGU+\nIGlzIGRpcnR5LiBJbiB0aGUgY2FzZXMgd2hlcmUKICAgICAqIGZpZWxkIHRy\nYWNraW5nIGlzIG5vdCBoYXBwZW5pbmcgKHNlZSBiZWxvdyksIHRoaXMgbWV0\naG9kIHdpbGwgZG8gYQogICAgICogc3RhdGUgY29tcGFyaXNvbiB0byBmaW5k\nIHdoZXRoZXIgPGNvZGU+X3BjPC9jb2RlPiBpcyBkaXJ0eSwgYW5kIHdpbGwK\nICAgICAqIHVwZGF0ZSB0aGlzIGluc3RhbmNlIHdpdGggdGhpcyBpbmZvcm1h\ndGlvbi4gSW4gdGhlIGNhc2VzIHdoZXJlIGZpZWxkCiAgICAgKiB0cmFja2lu\nZyBpcyBoYXBwZW5pbmcsIHRoaXMgbWV0aG9kIGlzIGEgbm8tb3AuPC9wPgog\nICAgICoKICAgICAqIDxwPkZpZWxkcyBhcmUgdHJhY2tlZCBmb3IgYWxsIGNs\nYXNzZXMgdGhhdCBhcmUgcnVuIHRocm91Z2ggdGhlIE9wZW5KUEEKICAgICAq\nIGVuaGFuY2VyIHByaW9yIHRvIG9yIGR1cmluZyBkZXBsb3ltZW50LCBhbmQg\nYWxsIGNsYXNzZXMgKGVuaGFuY2VkIG9yCiAgICAgKiB1bmVuaGFuY2VkKSBp\nbiBhIEphdmEgNiBlbnZpcm9ubWVudCBvciBuZXdlci48L3A+CiAgICAgKgog\nICAgICogPHA+SW4gYSBKYXZhIDUgVk0gb3Igb2xkZXI6CiAgICAgKiA8YnI+\nLSBpbnN0YW5jZXMgb2YgdW5lbmhhbmNlZCBjbGFzc2VzIHRoYXQgdXNlCiAg\nICAgKiBwcm9wZXJ0eSBhY2Nlc3MgYW5kIG9iZXkgdGhlIHByb3BlcnR5IGFj\nY2VzcyBsaW1pdGF0aW9ucyBhcmUgdHJhY2tlZAogICAgICogd2hlbiB0aGUg\naW5zdGFuY2VzIGFyZSBsb2FkZWQgZnJvbSB0aGUgZGF0YWJhc2UgYnkgT3Bl\nbkpQQSwgYW5kIGFyZQogICAgICogbm90IHRyYWNrZWQgd2hlbiB0aGUgaW5z\ndGFuY2VzIGFyZSBjcmVhdGVkIGJ5IGFwcGxpY2F0aW9uIGNvZGUuCiAgICAg\nKiA8YnI+LSBpbnN0YW5jZXMgb2YgdW5lbmhhbmNlZCBjbGFzc2VzIHRoYXQg\ndXNlIGZpZWxkIGFjY2VzcyBhcmUKICAgICAqIG5ldmVyIHRyYWNrZWQuPC9w\nPgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJs\naWMgdm9pZCBkaXJ0eUNoZWNrKCkgewogICAgICAgIGlmICghbmVlZHNEaXJ0\neUNoZWNrKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU2F2ZUZp\nZWxkTWFuYWdlciBzYXZlZCA9IGdldFNhdmVGaWVsZE1hbmFnZXIoKTsKICAg\nICAgICBpZiAoc2F2ZWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1zYXZlZC1maWVsZHMi\nLAogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRU\neXBlKCkuZ2V0TmFtZSgpKSk7CgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\nbWRzID0gZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgLy8gcGsgYW5kIHZlcnNpb24gZmllbGRzIGNhbm5vdCBiZSBtdXRhdGVk\nOyBkb24ndCBtYXJrIHRoZW0KICAgICAgICAgICAgLy8gYXMgc3VjaC4gIyMj\nIyMgdmFsaWRhdGU/CiAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1h\ncnlLZXkoKSAmJiAhZm1kc1tpXS5pc1ZlcnNpb24oKQogICAgICAgICAgICAg\nICAgJiYgX2xvYWRlZC5nZXQoaSkpIHsKICAgICAgICAgICAgICAgIGlmICgh\nc2F2ZWQuaXNGaWVsZEVxdWFsKGksIGZldGNoKGkpKSkgewogICAgICAgICAg\nICAgICAgICAgIGRpcnR5KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBu\nZWVkc0RpcnR5Q2hlY2soKSB7CiAgICAgICAgaWYgKGlzSW50ZXJjZXB0aW5n\nKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoaXNE\nZWxldGVkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBp\nZiAoaXNOZXcoKSAmJiAhaXNGbHVzaGVkKCkpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGZldGNoSW5pdGlhbEZpZWxkKGludCBmaWVsZCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpID09IFJl\nc3RvcmVTdGF0ZS5SRVNUT1JFX05PTkUKICAgICAgICAgICAgJiYgKChfZmxh\nZ3MgJiBGTEFHX0lOVkVSU0VTKSA9PSAwCiAgICAgICAgICAgIHx8IGZtZC5n\nZXRJbnZlcnNlTWV0YURhdGFzKCkubGVuZ3RoID09IDApKQogICAgICAgICAg\nICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJy\nZXN0b3JlLXVuc2V0IikpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nREFURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5NQVA6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVD\nVDoKICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIG5vdCBzYXZpbmcgbXV0\nYWJsZSB0eXBlcywgdGhyb3cgYW4gZXhjZXB0aW9uCiAgICAgICAgICAgICAg\nICBpZiAoX2Jyb2tlci5nZXRSZXN0b3JlU3RhdGUoKSAhPSBSZXN0b3JlU3Rh\ndGUuUkVTVE9SRV9BTEwKICAgICAgICAgICAgICAgICAgICAmJiAoKF9mbGFn\ncyAmIEZMQUdfSU5WRVJTRVMpID09IDAKICAgICAgICAgICAgICAgICAgICB8\nfCBmbWQuZ2V0SW52ZXJzZU1ldGFEYXRhcygpLmxlbmd0aCA9PSAwKSkKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0\naW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICgibXV0YWJs\nZS1yZXN0b3JlLXVuc2V0IikpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc2F2ZWQgPT0gbnVs\nbCB8fCAhX2xvYWRlZC5nZXQoZmllbGQpIHx8ICFfZGlydHkuZ2V0KGZpZWxk\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaEZpZWxkKGZpZWxkLCBm\nYWxzZSk7CgogICAgICAgICAgICAvLyBpZiB0aGUgZmllbGQgaXMgZGlydHkg\nYnV0IHdlIG5ldmVyIGxvYWRlZCBpdCwgd2UgY2FuJ3QgcmVzdG9yZSBpdAog\nICAgICAgICAgICBpZiAoX3NhdmVkLmdldFVubG9hZGVkKCkuZ2V0KGZpZWxk\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoImluaXRpYWwtdW5sb2FkZWQiLAogICAgICAgICAg\nICAgICAgICAgIGZtZCkpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9z\nYXZlZC5nZXRTdGF0ZSgpLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHJldHVybiBmZXRjaEZpZWxkKF9zaW5nbGUsIGZtZCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogRmV0Y2ggdGhlIHNwZWNpZmllZCBmaWVsZCBm\ncm9tIHRoZSBzcGVjaWZpZWQgZmllbGQgbWFuYWdlciwgd3JhcHBpbmcgaXQK\nICAgICAqIGluIGFuIG9iamVjdCBpZiBpdCdzIGEgcHJpbWl0aXZlLiBBIGZp\nZWxkIHNob3VsZCBiZSBwcm92aWRlZCB0byB0aGUKICAgICAqIGZpZWxkIG1h\nbmFnZXIgYmVmb3JlIHRoaXMgY2FsbCBpcyBtYWRlLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBPYmplY3QgZmV0Y2hGaWVsZChGaWVsZE1hbmFnZXIg\nZm0sIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaW50IGZpZWxkID0g\nZm1kLmdldEluZGV4KCk7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJP\nT0xFQU46CiAgICAgICAgICAgICAgICByZXR1cm4gKGZtLmZldGNoQm9vbGVh\nbkZpZWxkKGZpZWxkKSkgPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAg\nICAgICA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJZVEU6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJ5dGUoZm0u\nZmV0Y2hCeXRlRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcmFj\ndGVyKGZtLmZldGNoQ2hhckZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgRG91YmxlKGZtLmZldGNoRG91YmxlRmllbGQoZmllbGQpKTsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IEZsb2F0KGZtLmZldGNoRmxvYXRGaWVsZChmaWVsZCkpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAg\nICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGZtLmZldGNoSW50RmllbGQoZmll\nbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAg\nICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZm0uZmV0Y2hMb25n\nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hP\nUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNob3J0KGZtLmZldGNo\nU2hvcnRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TVFJJTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gZm0uZmV0Y2hTdHJp\nbmdGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZm0uZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJlbW90ZShpbnQg\nZmllbGQsIE9iamVjdCB2YWx1ZSkgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVs\nZCwgQm9vbGVhbi5GQUxTRSwgZmFsc2UpOwogICAgICAgICAgICBzdG9yZUZp\nZWxkKGZpZWxkLCB2YWx1ZSwgX3NpbmdsZSk7CiAgICAgICAgICAgIHJlcGxh\nY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9z\ndERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8KICAgIC8vIExpZmVjeWNsZSBvcGVyYXRpb25zCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIE5vdGlm\naWNhdGlvbiB0aGF0IHRoZSBvYmplY3QgaXMgYWJvdXQgdG8gYmUgYWNjZXNz\nZWQuCiAgICAgKgogICAgICogQHBhcmFtIGZpZWxkIHRoZSBmaWVsZCBudW1i\nZXIgYmVpbmcgcmVhZCwgb3IgLTEgaWYgbm90IGEgc2luZ2xlCiAgICAgKiBm\naWVsZCByZWFkCiAgICAgKi8KICAgIHZvaWQgYmVmb3JlUmVhZChpbnQgZmll\nbGQpIHsKICAgICAgICAvLyBhbGxvdyB1bm1lZGlhdGVkIHJlYWRzIG9mIHBy\naW1hcnkga2V5IGZpZWxkcwogICAgICAgIGlmIChmaWVsZCAhPSAtMSAmJiBf\nbWV0YS5nZXRGaWVsZChmaWVsZCkuaXNQcmltYXJ5S2V5KCkpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgaWYgKF9icm9rZXIuaXNBY3RpdmUoKSAm\nJiAhX2Jyb2tlci5pc1RyYW5zYWN0aW9uRW5kaW5nKCkpIHsKICAgICAgICAg\nICAgaWYgKF9icm9rZXIuZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAgICAg\nICAgc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlT3B0aW1pc3RpY1JlYWQodGhp\ncywgZmllbGQpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlUmVhZCh0aGlzLCBmaWVsZCkpOwog\nICAgICAgIH0gZWxzZSBpZiAoX2Jyb2tlci5nZXROb250cmFuc2FjdGlvbmFs\nUmVhZCgpKQogICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVO\nb250cmFuc2FjdGlvbmFsUmVhZCh0aGlzLCBmaWVsZCkpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlv\nbihfbG9jLmdldCgibm9uLXRyYW5zLXJlYWQiKSkuCiAgICAgICAgICAgICAg\nICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0\nYXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNiZWZvcmVGbHVzaAog\nICAgICovCiAgICB2b2lkIGJlZm9yZUZsdXNoKGludCByZWFzb24sIE9wQ2Fs\nbGJhY2tzIGNhbGwpIHsKICAgICAgICBfc3RhdGUuYmVmb3JlRmx1c2godGhp\ncywgcmVhc29uID09IEJyb2tlckltcGwuRkxVU0hfTE9HSUNBTCwgY2FsbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJl\nbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2ZsdXNoCiAg\nICAgKi8KICAgIHZvaWQgYWZ0ZXJGbHVzaChpbnQgcmVhc29uKSB7CiAgICAg\nICAgLy8gbm90aGluZyBoYXBwZW5zIHdoZW4gd2UgZmx1c2ggbm9uLXBlcnNp\nc3RlbnQgc3RhdGVzCiAgICAgICAgaWYgKCFpc1BlcnNpc3RlbnQoKSkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAocmVhc29uICE9IEJyb2tl\nckltcGwuRkxVU0hfUk9MTEJBQ0sKICAgICAgICAgICAgJiYgcmVhc29uICE9\nIEJyb2tlckltcGwuRkxVU0hfTE9HSUNBTCkgewogICAgICAgICAgICAvLyBh\nbmFseXplIHByZXZpb3VzIHN0YXRlIGZvciBsYXRlcgogICAgICAgICAgICBi\nb29sZWFuIHdhc05ldyA9IGlzTmV3KCk7CiAgICAgICAgICAgIGJvb2xlYW4g\nd2FzRmx1c2hlZCA9IGlzRmx1c2hlZCgpOwogICAgICAgICAgICBib29sZWFu\nIHdhc0RlbGV0ZWQgPSBpc0RlbGV0ZWQoKTsKCiAgICAgICAgICAgIC8vIGFs\nbCBkaXJ0eSBmaWVsZHMgd2VyZSBmbHVzaGVkCiAgICAgICAgICAgIF9mbHVz\naC5vcihfZGlydHkpOwoKICAgICAgICAgICAgLy8gaW1wb3J0YW50IHRvIHNl\ndCBmbHVzaGVkIGJpdCBhZnRlciBjYWxsaW5nIF9zdGF0ZS5mbHVzaCBzbwog\nICAgICAgICAgICAvLyB0aGF0IHRoZSBzdGF0ZSBjYW4gdGVsbCB3aGV0aGVy\nIHRoaXMgaXMgdGhlIGZpcnN0IGZsdXNoCiAgICAgICAgICAgIHNldFBDU3Rh\ndGUoX3N0YXRlLmZsdXNoKHRoaXMpKTsKICAgICAgICAgICAgX2ZsYWdzIHw9\nIEZMQUdfRkxVU0hFRDsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZM\nVVNIRURfRElSVFk7CgogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfVkVS\nU0lPTl9DSEVDSzsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1ZFUlNJ\nT05fVVBEQVRFOwoKICAgICAgICAgICAgLy8gaWYgdGhpcyB3YXMgYW4gaW5j\nIGZsdXNoIGR1cmluZyB3aGljaCB3ZSBoYWQgb3VyIGlkZW50aXR5CiAgICAg\nICAgICAgIC8vIGFzc2lnbmVkLCB0ZWxsIHRoZSBicm9rZXIgdG8gY2FjaGUg\ndXMgdW5kZXIgb3VyIGZpbmFsIG9pZAogICAgICAgICAgICBpZiAocmVhc29u\nID09IEJyb2tlckltcGwuRkxVU0hfSU5DKQogICAgICAgICAgICAgICAgYXNz\nZXJ0T2JqZWN0SWRBc3NpZ25lZCh0cnVlKTsKCiAgICAgICAgICAgIC8vIGlm\nIHRoaXMgb2JqZWN0IHdhcyBzdG9yZWQgd2l0aCBwcmVGbHVzaCwgZG8gcG9z\ndC1zdG9yZSBjYWxsYmFjawogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfUFJFX0ZMVVNIRUQpID4gMCkKICAgICAgICAgICAgICAgIGZpcmVMaWZl\nY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9TVE9SRSk7CgogICAg\nICAgICAgICAvLyBkbyBwb3N0LXVwZGF0ZSBhcyBuZWVkZWQKICAgICAgICAg\nICAgaWYgKHdhc05ldyAmJiAhd2FzRmx1c2hlZCkKICAgICAgICAgICAgICAg\nIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9QRVJT\nSVNUX1BFUkZPUk1FRCk7CiAgICAgICAgICAgIGVsc2UgaWYgKHdhc0RlbGV0\nZWQpCiAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5\nY2xlRXZlbnQuQUZURVJfREVMRVRFX1BFUkZPUk1FRCk7CiAgICAgICAgICAg\nIGVsc2UgCiAgICAgICAgICAgICAgICAvLyB1cGRhdGVzIGFuZCBuZXctZmx1\nc2hlZCB3aXRoIGNoYW5nZXMKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3lj\nbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9VUERBVEVfUEVSRk9STUVE\nKTsKICAgICAgICB9IGVsc2UgaWYgKHJlYXNvbiA9PSBCcm9rZXJJbXBsLkZM\nVVNIX1JPTExCQUNLKSB7CiAgICAgICAgICAgIC8vIHJldmVydCB0byBsYXN0\nIGxvYWRlZCB2ZXJzaW9uIGFuZCBvcmlnaW5hbCBvaWQKICAgICAgICAgICAg\nYXNzaWduVmVyc2lvbkZpZWxkKF9sb2FkVmVyc2lvbik7CiAgICAgICAgICAg\nIGlmIChpc05ldygpICYmIChfZmxhZ3MgJiBGTEFHX09JRF9BU1NJR05FRCkg\nPT0gMCkKICAgICAgICAgICAgICAgIF9vaWQgPSBudWxsOwogICAgICAgIH0K\nICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfUFJFX0ZMVVNIRUQ7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUg\nYWZ0ZXIgY2hlY2tpbmcgdGhlIHZhbHVlCiAgICAgKiBvZiB0aGUgUmV0YWlu\nU3RhdGUgZmxhZy4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjY29tbWl0\nCiAgICAgKiBAc2VlIFBDU3RhdGUjY29tbWl0UmV0YWluCiAgICAgKi8KICAg\nIHZvaWQgY29tbWl0KCkgewogICAgICAgIC8vIHJlbGVhc2UgbG9ja3MgYmVm\nb3JlIG9pZCB1cGRhdGVkCiAgICAgICAgcmVsZWFzZUxvY2tzKCk7CgogICAg\nICAgIC8vIHVwZGF0ZSB2ZXJzaW9uIGFuZCBvaWQgaW5mb3JtYXRpb24KICAg\nICAgICBzZXRWZXJzaW9uKF92ZXJzaW9uKTsKICAgICAgICBfZmxhZ3MgJj0g\nfkZMQUdfRkxVU0hFRDsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hF\nRF9ESVJUWTsKCiAgICAgICAgT2JqZWN0IG9yaWcgPSBfaWQ7CiAgICAgICAg\nYXNzZXJ0T2JqZWN0SWRBc3NpZ25lZChmYWxzZSk7CgogICAgICAgIGJvb2xl\nYW4gd2FzTmV3ID0gaXNOZXcoKSAmJiAhaXNEZWxldGVkKCkgJiYgIWlzUHJv\ndmlzaW9uYWwoKTsKICAgICAgICBpZiAoX2Jyb2tlci5nZXRSZXRhaW5TdGF0\nZSgpKQogICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5jb21taXRSZXRh\naW4odGhpcykpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0UENTdGF0\nZShfc3RhdGUuY29tbWl0KHRoaXMpKTsKCiAgICAgICAgLy8gYXNrIHRoZSBi\ncm9rZXIgdG8gcmUtY2FjaGUgdXMgaWYgd2Ugd2VyZSBuZXcgcHJldmlvdXNs\neQogICAgICAgIGlmICh3YXNOZXcpCiAgICAgICAgICAgIF9icm9rZXIuc2V0\nU3RhdGVNYW5hZ2VyKG9yaWcsIHRoaXMsIEJyb2tlckltcGwuU1RBVFVTX0NP\nTU1JVF9ORVcpOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRv\nIHRoZSBjdXJyZW50IHN0YXRlIGFmdGVyIGNoZWNraW5nIHRoZSB2YWx1ZQog\nICAgICogb2YgdGhlIFJldGFpblN0YXRlIGZsYWcuCiAgICAgKgogICAgICog\nQHNlZSBQQ1N0YXRlI3JvbGxiYWNrCiAgICAgKiBAc2VlIFBDU3RhdGUjcm9s\nbGJhY2tSZXN0b3JlCiAgICAgKi8KICAgIHZvaWQgcm9sbGJhY2soKSB7CiAg\nICAgICAgLy8gcmVsZWFzZSBsb2NrcwogICAgICAgIHJlbGVhc2VMb2Nrcygp\nOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSEVEOwogICAgICAgIF9m\nbGFncyAmPSB+RkxBR19GTFVTSEVEX0RJUlRZOwogICAgICAgIGFmdGVyRmx1\nc2goQnJva2VySW1wbC5GTFVTSF9ST0xMQkFDSyk7CgogICAgICAgIGlmIChf\nYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpICE9IFJlc3RvcmVTdGF0ZS5SRVNU\nT1JFX05PTkUpCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLnJvbGxi\nYWNrUmVzdG9yZSh0aGlzKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\nZXRQQ1N0YXRlKF9zdGF0ZS5yb2xsYmFjayh0aGlzKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSb2xsYmFjayBzdGF0ZSBvZiB0aGUgbWFuYWdlZCBpbnN0\nYW5jZSB0byB0aGUgZ2l2ZW4gc2F2ZXBvaW50LgogICAgICovCiAgICB2b2lk\nIHJvbGxiYWNrVG9TYXZlcG9pbnQoU2F2ZXBvaW50RmllbGRNYW5hZ2VyIHNh\ndmVwb2ludCkgewogICAgICAgIF9zdGF0ZSA9IHNhdmVwb2ludC5nZXRQQ1N0\nYXRlKCk7CiAgICAgICAgQml0U2V0IGxvYWRlZCA9IHNhdmVwb2ludC5nZXRM\nb2FkZWQoKTsKICAgICAgICBmb3IgKGludCBpID0gMCwgbGVuID0gbG9hZGVk\nLmxlbmd0aCgpOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgaWYgKGxv\nYWRlZC5nZXQoaSkgJiYgc2F2ZXBvaW50LnJlc3RvcmVGaWVsZChpKSkgewog\nICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxkKHNhdmVwb2ludC5nZXRDb3B5\nKCksIHNhdmVwb2ludCwgaSk7CiAgICAgICAgICAgICAgICByZXBsYWNlRmll\nbGQoX3BjLCBzYXZlcG9pbnQsIGkpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIF9sb2FkZWQgPSBsb2FkZWQ7CiAgICAgICAgX2RpcnR5ID0g\nc2F2ZXBvaW50LmdldERpcnR5KCk7CiAgICAgICAgX2ZsdXNoID0gc2F2ZXBv\naW50LmdldEZsdXNoZWQoKTsKICAgICAgICBfdmVyc2lvbiA9IHNhdmVwb2lu\ndC5nZXRWZXJzaW9uKCk7CiAgICAgICAgX2xvYWRWZXJzaW9uID0gc2F2ZXBv\naW50LmdldExvYWRWZXJzaW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBE\nZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICog\nQHNlZSBQQ1N0YXRlI3BlcnNpc3QKICAgICAqIEBzZWUgQnJva2VyI3BlcnNp\nc3QKICAgICAqLwogICAgdm9pZCBwZXJzaXN0KCkgewogICAgICAgIHNldFBD\nU3RhdGUoX3N0YXRlLnBlcnNpc3QodGhpcykpOwogICAgfQoKICAgIC8qKgog\nICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAgICoK\nICAgICAqIEBzZWUgUENTdGF0ZSNkZWxldGUKICAgICAqIEBzZWUgQnJva2Vy\nI2RlbGV0ZQogICAgICovCiAgICB2b2lkIGRlbGV0ZSgpIHsKICAgICAgICBz\nZXRQQ1N0YXRlKF9zdGF0ZS5kZWxldGUodGhpcykpOwogICAgfQoKICAgIC8q\nKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAg\nICoKICAgICAqIEBzZWUgUENTdGF0ZSNub250cmFuc2FjdGlvbmFsCiAgICAg\nKiBAc2VlIEJyb2tlciNub250cmFuc2FjdGlvbmFsCiAgICAgKi8KICAgIHZv\naWQgbm9udHJhbnNhY3Rpb25hbCgpIHsKICAgICAgICBzZXRQQ1N0YXRlKF9z\ndGF0ZS5ub250cmFuc2FjdGlvbmFsKHRoaXMpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAq\nCiAgICAgKiBAc2VlIFBDU3RhdGUjdHJhbnNhY3Rpb25hbAogICAgICogQHNl\nZSBCcm9rZXIjdHJhbnNhY3Rpb25hbAogICAgICovCiAgICB2b2lkIHRyYW5z\nYWN0aW9uYWwoKSB7CiAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUudHJhbnNh\nY3Rpb25hbCh0aGlzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0\nZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQ\nQ1N0YXRlI25vbnByb3Zpc2lvbmFsCiAgICAgKi8KICAgIHZvaWQgbm9ucHJv\ndmlzaW9uYWwoYm9vbGVhbiBsb2dpY2FsLCBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUubm9ucHJvdmlzaW9uYWwodGhp\ncywgbG9naWNhbCwgY2FsbCkpOwogICAgfQoKICAgIC8qKgogICAgICogRGVs\nZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBz\nZWUgUENTdGF0ZSNyZWxlYXNlCiAgICAgKiBAc2VlIEJyb2tlciNyZWxlYXNl\nCiAgICAgKi8KICAgIHZvaWQgcmVsZWFzZShib29sZWFuIHVucHJveHkpIHsK\nICAgICAgICByZWxlYXNlKHVucHJveHksIGZhbHNlKTsKICAgIH0KCiAgICB2\nb2lkIHJlbGVhc2UoYm9vbGVhbiB1bnByb3h5LCBib29sZWFuIGZvcmNlKSB7\nCiAgICAgICAgLy8gb3B0aW1pemF0aW9uIGZvciBkZXRhY2gtaW4tcGxhY2Ug\nc3BlY2lhbCBjYXNlIHdoZW4gZmllbGRzIGFyZQogICAgICAgIC8vIGFscmVh\nZHkgKHVuKXByb3hpZWQgY29ycmVjdGx5CiAgICAgICAgaWYgKCF1bnByb3h5\nKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19OT19VTlBST1hZOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChmb3JjZSkKICAgICAgICAgICAg\nICAgIHNldFBDU3RhdGUoUENTdGF0ZS5UUkFOU0lFTlQpOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5yZWxl\nYXNlKHRoaXMpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBf\nZmxhZ3MgJj0gfkZMQUdfTk9fVU5QUk9YWTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUu\nCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2V2aWN0CiAgICAgKiBAc2Vl\nIEJyb2tlciNldmljdAogICAgICovCiAgICB2b2lkIGV2aWN0KCkgewogICAg\nICAgIHNldFBDU3RhdGUoX3N0YXRlLmV2aWN0KHRoaXMpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEdhdGhlciByZWxhdGlvbnMgcmVhY2hhYmxlIGZyb20g\ndmFsdWVzIHVzaW5nCiAgICAgKiB7QGxpbmsgVmFsdWVNZXRhRGF0YSNDQVND\nQURFX0lNTUVESUFURX0uCiAgICAgKi8KICAgIHZvaWQgZ2F0aGVyQ2FzY2Fk\nZVJlZnJlc2goT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGlmICghX2xvYWRlZC5nZXQoaSkpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgIGlmIChmbWRzW2ldLmdldENhc2NhZGVSZWZy\nZXNoKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURQogICAg\nICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRLZXkoKS5nZXRDYXNjYWRlUmVm\ncmVzaCgpCiAgICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NB\nREVfSU1NRURJQVRFCiAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdldEVs\nZW1lbnQoKS5nZXRDYXNjYWRlUmVmcmVzaCgpCiAgICAgICAgICAgICAgICA9\nPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKSB7CiAgICAgICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQoaSwgZmV0Y2hGaWVs\nZChpLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5nYXRoZXJD\nYXNjYWRlUmVmcmVzaChjYWxsKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUu\nY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBiZWZvcmVSZWZyZXNoKGJvb2xlYW4gcmVmcmVzaEFs\nbCkgewogICAgICAgIC8vIG5vdGU6IGFsbCBsb2dpYyBwbGFjZWQgaGVyZSBy\nYXRoZXIgdGhhbiBpbiB0aGUgc3RhdGVzIGZvcgogICAgICAgIC8vIG9wdGlt\naXphdGlvbjsgdGhpcyBtZXRob2QgcHVibGljIGIvYyB1c2VkIGJ5IHJlbW90\nZSBwYWNrYWdlCgogICAgICAgIC8vIG5vdGhpbmcgdG8gZG8gZm9yIG5vbiBw\nZXJzaXN0ZW50IG9yIG5ldyB1bmZsdXNoZWQgaW5zdGFuY2VzCiAgICAgICAg\naWYgKCFpc1BlcnNpc3RlbnQoKSB8fCAoaXNOZXcoKSAmJiAhaXNGbHVzaGVk\nKCkpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBpZiBkaXJ0eSBuZWVk\nIHRvIGNsZWFyIGZpZWxkcwogICAgICAgICAgICBpZiAoaXNEaXJ0eSgpKSB7\nCiAgICAgICAgICAgICAgICBjbGVhckZpZWxkcygpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGlmIHNvbWUgZmllbGRzIGhhdmUgYmVlbiBsb2FkZWQgYnV0IHRoZSBpbnN0\nYW5jZSBpcyBvdXQgb2YKICAgICAgICAgICAgLy8gZGF0ZSBvciB0aGlzIGlz\nIHBhcnQgb2YgYSByZWZyZXNoQWxsKCkgYW5kIHdlIGRvbid0IHdhbnQgdG8K\nICAgICAgICAgICAgLy8gdGFrZSB0aGUgZXh0cmEgaGl0IHRvIHNlZSBpZiB0\naGUgaW5zdGFuY2UgaXMgb3V0IG9mIGRhdGUsIGNsZWFyCiAgICAgICAgICAg\nIGlmIChfbG9hZGVkLmxlbmd0aCgpID4gMCAmJiAocmVmcmVzaEFsbCB8fCBp\nc0VtYmVkZGVkKCkKICAgICAgICAgICAgICAgIHx8ICFzeW5jVmVyc2lvbihu\ndWxsKSkpIHsKICAgICAgICAgICAgICAgIE9iamVjdCB2ZXJzaW9uID0gX3Zl\ncnNpb247CiAgICAgICAgICAgICAgICBjbGVhckZpZWxkcygpOwoKICAgICAg\nICAgICAgICAgIC8vIGlmIHN5bmNWZXJzaW9uIGp1c3QgcmVwbGFjZWQgdGhl\nIHZlcnNpb24sIHJlc2V0IGl0CiAgICAgICAgICAgICAgICBpZiAoIXJlZnJl\nc2hBbGwgJiYgIWlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgICAgICAgICBz\nZXRWZXJzaW9uKHZlcnNpb24pOwogICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gc3RhdGUgdHJh\nbnNpdGlvbnMgYWZ0ZXIgcmVmcmVzaC4gVGhpcyBtZXRob2QgaXMgb25seQog\nICAgICogY2FsbGVkIGlmIHtAbGluayAjYmVmb3JlUmVmcmVzaH0gcmV0dXJu\ncyB0cnVlLgogICAgICovCiAgICB2b2lkIGFmdGVyUmVmcmVzaCgpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gdHJh\nbnNpdGlvbiB0byBjbGVhbiBvciBub250cmFuc2FjdGlvbmFsIGRlcGVuZGlu\nZyBvbiB0cmFucyBzdGF0dXMKICAgICAgICAgICAgaWYgKCFfYnJva2VyLmlz\nQWN0aXZlKCkpCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5h\nZnRlck5vbnRyYW5zYWN0aW9uYWxSZWZyZXNoKCkpOwogICAgICAgICAgICBl\nbHNlIGlmIChfYnJva2VyLmdldE9wdGltaXN0aWMoKSkKICAgICAgICAgICAg\nICAgIHNldFBDU3RhdGUoX3N0YXRlLmFmdGVyT3B0aW1pc3RpY1JlZnJlc2go\nKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNldFBDU3Rh\ndGUoX3N0YXRlLmFmdGVyUmVmcmVzaCgpKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBNYXJrIHRoaXMgb2JqZWN0IGFzIGEgZGVyZWZlcmVuY2Vk\nIGRlcGVuZGVudCBvYmplY3QuCiAgICAgKi8KICAgIHZvaWQgc2V0RGVyZWZl\ncmVuY2VkRGVwZW5kZW50KGJvb2xlYW4gZGVyZWYsIGJvb2xlYW4gbm90aWZ5\nKSB7CiAgICAgICAgaWYgKCFkZXJlZiAmJiAoX2ZsYWdzICYgRkxBR19ERVJF\nRikgPiAwKSB7CiAgICAgICAgICAgIGlmIChub3RpZnkpCiAgICAgICAgICAg\nICAgICBfYnJva2VyLnJlbW92ZURlcmVmZXJlbmNlZERlcGVuZGVudCh0aGlz\nKTsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0RFUkVGOwogICAgICAg\nIH0gZWxzZSBpZiAoZGVyZWYgJiYgKF9mbGFncyAmIEZMQUdfREVSRUYpID09\nIDApIHsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfREVSRUY7CiAgICAg\nICAgICAgIGlmIChub3RpZnkpCiAgICAgICAgICAgICAgICBfYnJva2VyLmFk\nZERlcmVmZXJlbmNlZERlcGVuZGVudCh0aGlzKTsKICAgICAgICB9CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8KICAgIC8vIExvY2tpbmcKICAgIC8vLy8vLy8v\nLy8vCgogICAgLyoqCiAgICAgKiBOb3RpZmljYXRpb24gdGhhdCB3ZSd2ZSBi\nZWVuIHJlYWQtbG9ja2VkLiBQYXNzIGluIHRoZSBsZXZlbCBhdCB3aGljaAog\nICAgICogd2Ugd2VyZSBsb2NrZWQgYW5kIHRoZSBsZXZlbCBhdCB3aGljaCB3\nZSBzaG91bGQgd3JpdGUgbG9jayBvdXJzZWx2ZXMKICAgICAqIG9uIGRpcnR5\nLgogICAgICovCiAgICB2b2lkIHJlYWRMb2NrZWQoaW50IHJlYWRMb2NrTGV2\nZWwsIGludCB3cml0ZUxvY2tMZXZlbCkgewogICAgICAgIC8vIG1ha2Ugc3Vy\nZSBvYmplY3QgaXMgYWRkZWQgdG8gdHJhbnNhY3Rpb24gc28gbG9jayB3aWxs\nIGdldAogICAgICAgIC8vIGNsZWFyZWQgb24gY29tbWl0L3JvbGxiYWNrCiAg\nICAgICAgaWYgKHJlYWRMb2NrTGV2ZWwgIT0gTG9ja0xldmVscy5MT0NLX05P\nTkUpCiAgICAgICAgICAgIHRyYW5zYWN0aW9uYWwoKTsKCiAgICAgICAgX3Jl\nYWRMb2NrTGV2ZWwgPSByZWFkTG9ja0xldmVsOwogICAgICAgIF93cml0ZUxv\nY2tMZXZlbCA9IHdyaXRlTG9ja0xldmVsOwogICAgICAgIF9mbGFncyB8PSBG\nTEFHX1JFQURfTE9DS0VEOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19XUklU\nRV9MT0NLRUQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGxv\nY2sgbGV2ZWwgdG8gdXNlIHdoZW4gbG9hZGluZyBzdGF0ZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBpbnQgY2FsY3VsYXRlTG9ja0xldmVsKGJvb2xlYW4gYWN0\naXZlLCBib29sZWFuIGZvcldyaXRlLAogICAgICAgIEZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCkgewogICAgICAgIGlmICghYWN0aXZlKQogICAgICAgICAg\nICByZXR1cm4gTG9ja0xldmVscy5MT0NLX05PTkU7CiAgICAgICAgaWYgKGZl\ndGNoID09IG51bGwpCiAgICAgICAgICAgIGZldGNoID0gX2Jyb2tlci5nZXRG\nZXRjaENvbmZpZ3VyYXRpb24oKTsKCiAgICAgICAgaWYgKF9yZWFkTG9ja0xl\ndmVsID09IC0xKQogICAgICAgICAgICBfcmVhZExvY2tMZXZlbCA9IGZldGNo\nLmdldFJlYWRMb2NrTGV2ZWwoKTsKICAgICAgICBpZiAoX3dyaXRlTG9ja0xl\ndmVsID09IC0xKQogICAgICAgICAgICBfd3JpdGVMb2NrTGV2ZWwgPSBmZXRj\naC5nZXRXcml0ZUxvY2tMZXZlbCgpOwogICAgICAgIHJldHVybiAoZm9yV3Jp\ndGUpID8gX3dyaXRlTG9ja0xldmVsIDogX3JlYWRMb2NrTGV2ZWw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBNYWtlIHN1cmUgd2UncmUgbG9ja2VkIGF0IHRo\nZSBnaXZlbiBsZXZlbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG9idGFp\nbkxvY2tzKGJvb2xlYW4gYWN0aXZlLCBib29sZWFuIGZvcldyaXRlLCBpbnQg\nbG9ja0xldmVsLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwg\nT2JqZWN0IHNkYXRhKSB7CiAgICAgICAgaWYgKCFhY3RpdmUpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYgd2UgaGF2ZW4ndCBiZWVuIGxv\nY2tlZCB5ZXQsIGxvY2sgbm93IGF0IHRoZSBnaXZlbiBsZXZlbAogICAgICAg\nIGludCBmbGFnID0gKGZvcldyaXRlKSA/IEZMQUdfV1JJVEVfTE9DS0VEIDog\nRkxBR19SRUFEX0xPQ0tFRDsKICAgICAgICBpZiAoKF9mbGFncyAmIGZsYWcp\nID09IDApIHsKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIG9iamVjdCBpcyBh\nZGRlZCB0byB0cmFuc2FjdGlvbiBzbyBsb2NrIHdpbGwgZ2V0CiAgICAgICAg\nICAgIC8vIGNsZWFyZWQgb24gY29tbWl0L3JvbGxiYWNrCiAgICAgICAgICAg\nIGlmIChsb2NrTGV2ZWwgIT0gTG9ja0xldmVscy5MT0NLX05PTkUpCiAgICAg\nICAgICAgICAgICB0cmFuc2FjdGlvbmFsKCk7CgogICAgICAgICAgICBpZiAo\nZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAgICAgIGZldGNoID0gX2Jyb2tl\nci5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgX2Jyb2tl\nci5nZXRMb2NrTWFuYWdlcigpLmxvY2sodGhpcywgbG9ja0xldmVsLAogICAg\nICAgICAgICAgICAgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwgc2RhdGEpOwog\nICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19SRUFEX0xPQ0tFRDsKICAgICAg\nICAgICAgX2ZsYWdzIHw9IGZsYWc7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmVsZWFzZSBsb2Nrcy4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHJlbGVhc2VMb2NrcygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVs\nbCkKICAgICAgICAgICAgX2Jyb2tlci5nZXRMb2NrTWFuYWdlcigpLnJlbGVh\nc2UodGhpcyk7CiAgICAgICAgX3JlYWRMb2NrTGV2ZWwgPSAtMTsKICAgICAg\nICBfd3JpdGVMb2NrTGV2ZWwgPSAtMTsKICAgICAgICBfZmxhZ3MgJj0gfkZM\nQUdfUkVBRF9MT0NLRUQ7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1dSSVRF\nX0xPQ0tFRDsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2Yg\nU3RhdGVNYW5hZ2VyIGludGVyZmFjZQogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIEBy\nZXR1cm4gd2hldGhlciBvciBub3QgdW5sb2FkZWQgZmllbGRzIHNob3VsZCBi\nZSBjbG9zZWQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHNlcmlhbGl6\naW5nKCkgewogICAgICAgIC8vIGlmIHRoZSBicm9rZXIgaXMgaW4gdGhlIG1p\nZHN0IG9mIGEgc2VyaWFsaXphdGlvbiwgdGhlbiBubyBzcGVjaWFsCiAgICAg\nICAgLy8gaGFuZGxpbmcgc2hvdWxkIGJlIHBlcmZvcm1lZCBvbiB0aGUgaW5z\ndGFuY2UsIGFuZCBubyBzdWJzZXF1ZW50CiAgICAgICAgLy8gbG9hZCBzaG91\nbGQgaGFwcGVuCiAgICAgICAgaWYgKF9icm9rZXIuaXNTZXJpYWxpemluZygp\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmIChfbWV0YS5pc0RldGFjaGFibGUoKSkKICAgICAgICAg\nICAgICAgIHJldHVybiBEZXRhY2hNYW5hZ2VyLnByZVNlcmlhbGl6ZSh0aGlz\nKTsKCiAgICAgICAgICAgIGxvYWQoX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3Vy\nYXRpb24oKSwgTE9BRF9TRVJJQUxJWkUsIG51bGwsIG51bGwsIAogICAgICAg\nICAgICAgICAgZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiB3cml0ZURldGFjaGVkKE9iamVjdE91dHB1dCBv\ndXQpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBCaXRT\nZXQgaWR4cyA9IG5ldyBCaXRTZXQoX21ldGEuZ2V0RmllbGRzKCkubGVuZ3Ro\nKTsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYm9vbGVhbiBkZXRzbSA9IERldGFjaE1hbmFnZXIud3JpdGVEZXRhY2hlZFN0\nYXRlKHRoaXMsIG91dCwgaWR4cyk7CiAgICAgICAgICAgIGlmIChkZXRzbSkK\nICAgICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0RFVEFDSElORzsKCiAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGZtZHNbaV0uaXNU\ncmFuc2llbnQoKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwog\nICAgICAgICAgICAgICAgX3NpbmdsZS5zZXJpYWxpemUob3V0LCAhaWR4cy5n\nZXQoaSkpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0g\nY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhy\nb3cgdHJhbnNsYXRlKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBfZmxhZ3MgJj0gfkZMQUdfREVUQUNISU5HOwogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcHJv\neHlEZXRhY2hlZERlc2VyaWFsaXplZChpbnQgaWR4KSB7CiAgICAgICAgLy8g\nd2UgZG9uJ3Qgc2VyaWFsaXplIHN0YXRlIG1hbmFnZXIgaW1wbHMKICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1RyYW5zYWN0aW9uYWwoKSB7CiAgICAgICAgLy8g\nc3BlY2lhbCBjYXNlIGZvciBUQ0xFQU4sIHdoaWNoIHdlIHdhbnQgdG8gYXBw\nZWFyIG5vbi10cmFucyB0bwogICAgICAgIC8vIGludGVybmFsIGNvZGUsIGJ1\ndCB3aGljaCBwdWJsaWNseSBzaG91bGQgYmUgdHJhbnNhY3Rpb25hbAogICAg\nICAgIHJldHVybiBfc3RhdGUgPT0gUENTdGF0ZS5UQ0xFQU4gfHwgX3N0YXRl\nLmlzVHJhbnNhY3Rpb25hbCgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGlzUGVuZGluZ1RyYW5zYWN0aW9uYWwoKSB7CiAgICAgICAgcmV0dXJuIF9z\ndGF0ZS5pc1BlbmRpbmdUcmFuc2FjdGlvbmFsKCk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNQcm92aXNpb25hbCgpIHsKICAgICAgICByZXR1cm4g\nX3N0YXRlLmlzUHJvdmlzaW9uYWwoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc1BlcnNpc3RlbnQoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5p\nc1BlcnNpc3RlbnQoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc05l\ndygpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzTmV3KCk7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNEZWxldGVkKCkgewogICAgICAgIHJldHVy\nbiBfc3RhdGUuaXNEZWxldGVkKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaXNEaXJ0eSgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzRGlydHko\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RldGFjaGVkKCkgewog\nICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19ERVRBQ0hJTkcpICE9IDA7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRHZW5lcmljQ29udGV4dCgp\nIHsKICAgICAgICByZXR1cm4gX2Jyb2tlcjsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGZldGNoT2JqZWN0SWQoKSB7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYXNzaWduT2JqZWN0SWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChf\nb2lkID09IG51bGwgfHwgIV9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLgog\nICAgICAgICAgICAgICAgZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCkuZ2V0\nQ29weU9iamVjdElkcygpKQogICAgICAgICAgICAgICAgcmV0dXJuIF9vaWQ7\nCgogICAgICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0g\nQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5jb3B5RGF0YVN0b3Jl\nSWQoX29pZCwgX21ldGEpOwogICAgICAgICAgICByZXR1cm4gQXBwbGljYXRp\nb25JZHMuY29weShfb2lkLCBfbWV0YSk7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xh\ndGUocmUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndFBDUHJpbWFyeUtleShPYmplY3Qgb2lkLCBpbnQgZmllbGQpIHsKICAgICAg\nICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsK\nICAgICAgICBPYmplY3QgcGsgPSBBcHBsaWNhdGlvbklkcy5nZXQob2lkLCBm\nbWQpOwogICAgICAgIGlmIChwayA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSByZWxtZXRhID0gZm1k\nLmdldERlY2xhcmVkVHlwZU1ldGFEYXRhKCk7CiAgICAgICAgcGsgPSBBcHBs\naWNhdGlvbklkcy53cmFwKHJlbG1ldGEsIHBrKTsKICAgICAgICBpZiAocmVs\nbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RB\nVEFTVE9SRQogICAgICAgICAgICAmJiBmbWQuZ2V0T2JqZWN0SWRGaWVsZFR5\ncGVDb2RlKCkgPT0gSmF2YVR5cGVzLkxPTkcpCiAgICAgICAgICAgIHBrID0g\nX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5uZXdEYXRhU3RvcmVJZChwaywg\ncmVsbWV0YSk7CiAgICAgICAgZWxzZSBpZiAocmVsbWV0YS5nZXRJZGVudGl0\neVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OIAogICAg\nICAgICAgICAmJiBmbWQuZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKSAhPSByZWxt\nZXRhLmdldE9iamVjdElkVHlwZSgpKQogICAgICAgICAgICBwayA9IEFwcGxp\nY2F0aW9uSWRzLmZyb21QS1ZhbHVlcyhuZXcgT2JqZWN0W10geyBwayB9LCBy\nZWxtZXRhKTsKICAgICAgICByZXR1cm4gX2Jyb2tlci5maW5kKHBrLCBmYWxz\nZSwgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGJ5dGUgcmVwbGFjZUZsYWdz\nKCkgewogICAgICAgIC8vIHdlIGFsd2F5cyB1c2UgbG9hZCByZXF1aXJlZCBz\nbyB0aGF0IHdlIGNhbiBkZXRlY3Qgd2hlbiBvYmplY3RzCiAgICAgICAgLy8g\nYXJlIHRvdWNoZWQgZm9yIGxvY2tpbmcgb3IgbWFraW5nIHRyYW5zYWN0aW9u\nYWwKICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VDYXBhYmxlLkxPQURfUkVR\nVUlSRUQ7CiAgICB9CgogICAgcHVibGljIFN0YXRlTWFuYWdlciByZXBsYWNl\nU3RhdGVNYW5hZ2VyKFN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIHJldHVy\nbiBzbTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhY2Nlc3NpbmdGaWVsZChp\nbnQgZmllbGQpIHsKICAgICAgICAvLyBwb3NzaWJseSBjaGFuZ2Ugc3RhdGUK\nICAgICAgICB0cnkgewogICAgICAgICAgICBiZWZvcmVSZWFkKGZpZWxkKTsK\nICAgICAgICAgICAgYmVmb3JlQWNjZXNzRmllbGQoZmllbGQpOwogICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAg\ndGhyb3cgdHJhbnNsYXRlKHJlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBMb2FkIHRoZSBnaXZlbiBmaWVsZCBiZWZvcmUgYWNjZXNzLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBiZWZvcmVBY2Nlc3NGaWVsZChp\nbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYm9vbGVhbiBhY3RpdmUgPSBfYnJva2VyLmlzQWN0aXZlKCk7\nCiAgICAgICAgICAgIGludCBsb2NrTGV2ZWwgPSBjYWxjdWxhdGVMb2NrTGV2\nZWwoYWN0aXZlLCBmYWxzZSwgbnVsbCk7CiAgICAgICAgICAgIGlmICghX2xv\nYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZp\nZWxkLCBsb2NrTGV2ZWwsIGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgYXNzaWduRmllbGQoZmllbGQsIGZhbHNlKTsK\nICAgICAgICAgICAgb2J0YWluTG9ja3MoYWN0aXZlLCBmYWxzZSwgbG9ja0xl\ndmVsLCBudWxsLCBudWxsKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRpcnR5KFN0cmluZyBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAg\nICAgICAgdGhyb3cgdHJhbnNsYXRlKG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1maWVsZCIsIGZpZWxkLAogICAgICAgICAgICAgICAgSW1wbEhl\nbHBlci5nZXRNYW5hZ2VkSW5zdGFuY2UoX3BjKS5nZXRDbGFzcygpKSkKICAg\nICAgICAgICAgICAgIC5zZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3Rh\nbmNlKCkpKTsKCiAgICAgICAgZGlydHkoZm1kLmdldEluZGV4KCksIG51bGws\nIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRpcnR5KGludCBmaWVs\nZCkgewogICAgICAgIGRpcnR5KGZpZWxkLCBudWxsLCB0cnVlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIE1ha2UgdGhlIGdpdmVuIGZpZWxkIGRpcnR5Lgog\nICAgICoKICAgICAqIEBwYXJhbSBtdXRhdGUgaWYgbnVsbCwgbWF5IGJlIGFu\nIFNDTyBtdXRhdGlvbjsgaWYgdHJ1ZSwgaXMgY2VydGFpbmx5CiAgICAgKiBh\nIG11dGF0aW9uIChvciBhdCBsZWFzdCB0cmVhdCBhcyBvbmUpCiAgICAgKiBA\ncmV0dXJuIHtAbGluayBCb29sZWFuI0ZBTFNFfSBpZiB0aGlzIGluc3RhbmNl\nIHdhcyBhbHJlYWR5IGRpcnR5LAogICAgICogPGNvZGU+bnVsbDwvY29kZT4g\naWYgaXQgd2FzIGRpcnR5IGJ1dCBub3Qgc2luY2UgZmx1c2gsIGFuZAogICAg\nICoge0BsaW5rIEJvb2xlYW4jVFJVRX0gaWYgaXQgd2FzIG5vdCBkaXJ0eQog\nICAgICovCiAgICBwcml2YXRlIEJvb2xlYW4gZGlydHkoaW50IGZpZWxkLCBC\nb29sZWFuIG11dGF0ZSwgYm9vbGVhbiBsb2FkRmV0Y2hHcm91cCkgewogICAg\nICAgIGJvb2xlYW4gbG9ja2VkID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBu\nZXdGbHVzaCA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gY2xlYW4gPSBmYWxz\nZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgaWYgKCFp\nc05ldygpIHx8IGlzRmx1c2hlZCgpKSB7CiAgICAgICAgICAgICAgICBpZiAo\nZm1kLmdldFVwZGF0ZVN0cmF0ZWd5KCkgPT0gVXBkYXRlU3RyYXRlZ2llcy5S\nRVNUUklDVCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAg\nICAgICgidXBkYXRlLXJlc3RyaWN0IiwgZm1kKSk7CiAgICAgICAgICAgICAg\nICBpZiAoZm1kLmdldFVwZGF0ZVN0cmF0ZWd5KCkgPT0gVXBkYXRlU3RyYXRl\nZ2llcy5JR05PUkUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xl\nYW4uRkFMU0U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc0Vt\nYmVkZGVkKCkpIHsKICAgICAgICAgICAgICAgIC8vIG5vdGlmeSBvd25lciBv\nZiBjaGFuZ2UKICAgICAgICAgICAgICAgIF9vd25lci5kaXJ0eShfb3duZXJJ\nbmRleCwgQm9vbGVhbi5UUlVFLCBsb2FkRmV0Y2hHcm91cCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGlzIHRoaXMgYSBkaXJlY3QgbXV0YXRp\nb24gb2YgYW4gc2NvIGZpZWxkPwogICAgICAgICAgICBpZiAobXV0YXRlID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRBVEU6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FM\nRU5EQVI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JK\nRUNUOgogICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGUgPSBCb29sZWFu\nLlRSVUU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAg\nICAgICAgICAgICBtdXRhdGUgPQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKGZtZC5pc0VtYmVkZGVkKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVh\nbi5GQUxTRTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAg\nICAgbXV0YXRlID0gQm9vbGVhbi5GQUxTRTsgLy8gbm90IHNjbwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBwb3Nz\naWJseSBjaGFuZ2Ugc3RhdGUKICAgICAgICAgICAgYm9vbGVhbiBhY3RpdmUg\nPSBfYnJva2VyLmlzQWN0aXZlKCk7CiAgICAgICAgICAgIGNsZWFuID0gIV9z\ndGF0ZS5pc0RpcnR5KCk7IC8vIGludGVudGlvbmFsIGRpcmVjdCBhY2Nlc3MK\nCiAgICAgICAgICAgIC8vIGZpcmUgZXZlbnQgZmFzdCBiZWZvcmUgc3RhdGUg\nY2hhbmdlLgogICAgICAgICAgICBpZiAoY2xlYW4pCiAgICAgICAgICAgICAg\nICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0RJ\nUlRZKTsKICAgICAgICAgICAgaWYgKGFjdGl2ZSkgewogICAgICAgICAgICAg\nICAgaWYgKF9icm9rZXIuZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAgICAg\nICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmJlZm9yZU9wdGltaXN0aWNXcml0\nZSh0aGlzLCBmaWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgbXV0YXRl\nLmJvb2xlYW5WYWx1ZSgpKSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlV3JpdGUo\ndGhpcywgZmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgIG11dGF0ZS5i\nb29sZWFuVmFsdWUoKSkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZtZC5n\nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lT\nVEVOVCkgewogICAgICAgICAgICAgICAgaWYgKGlzUGVyc2lzdGVudCgpICYm\nICFfYnJva2VyLmdldE5vbnRyYW5zYWN0aW9uYWxXcml0ZSgpKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJub24tdHJhbnMt\nd3JpdGUiKSkuc2V0RmFpbGVkT2JqZWN0CiAgICAgICAgICAgICAgICAgICAg\nICAgIChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CgogICAgICAgICAgICAgICAg\nc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlTm9udHJhbnNhY3Rpb25hbFdyaXRl\nKHRoaXMsIGZpZWxkLAogICAgICAgICAgICAgICAgICAgIG11dGF0ZS5ib29s\nZWFuVmFsdWUoKSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0gMCkgewogICAgICAgICAgICAg\nICAgbmV3Rmx1c2ggPSAoX2ZsYWdzICYgRkxBR19GTFVTSEVEX0RJUlRZKSA9\nPSAwOwogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hFRF9E\nSVJUWTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jaygpOwogICAg\nICAgICAgICBsb2NrZWQgPSB0cnVlOwoKICAgICAgICAgICAgLy8gbm90ZSB0\naGF0IHRoZSBmaWVsZCBpcyBpbiBuZWVkIG9mIGZsdXNoaW5nIGFnYWluLCBh\nbmQgdGVsbCB0aGUKICAgICAgICAgICAgLy8gYnJva2VyIHRvbwogICAgICAg\nICAgICBfZmx1c2guY2xlYXIoZmllbGQpOwogICAgICAgICAgICBfYnJva2Vy\nLnNldERpcnR5KHRoaXMsIG5ld0ZsdXNoICYmICFjbGVhbik7CgogICAgICAg\nICAgICAvLyBzYXZlIHRoZSBmaWVsZCBmb3Igcm9sbGJhY2sgaWYgbmVlZGVk\nCiAgICAgICAgICAgIHNhdmVGaWVsZChmaWVsZCk7CgogICAgICAgICAgICAv\nLyBkaXJ0eSB0aGUgZmllbGQgYW5kIG1hcmsgbG9hZGVkOyBsb2FkIGZldGNo\nIGdyb3VwIGlmIG5lZWRlZAogICAgICAgICAgICBpbnQgbG9ja0xldmVsID0g\nY2FsY3VsYXRlTG9ja0xldmVsKGFjdGl2ZSwgdHJ1ZSwgbnVsbCk7CiAgICAg\nICAgICAgIGlmICghX2RpcnR5LmdldChmaWVsZCkpIHsKICAgICAgICAgICAg\nICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBf\nZGlydHkuc2V0KGZpZWxkKTsKCiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhlIGZpZWxkJ3MgZmV0Y2ggZ3JvdXAgaXMgbG9hZGVkCiAgICAgICAg\nICAgICAgICBpZiAobG9hZEZldGNoR3JvdXAgJiYgaXNQZXJzaXN0ZW50KCkK\nICAgICAgICAgICAgICAgICAgICAmJiBmbWQuZ2V0TWFuYWdlbWVudCgpID09\nIGZtZC5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgICAgICBs\nb2FkRmllbGQoZmllbGQsIGxvY2tMZXZlbCwgdHJ1ZSwgdHJ1ZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgb2J0YWluTG9ja3MoYWN0aXZlLCB0cnVl\nLCBsb2NrTGV2ZWwsIG51bGwsIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNs\nYXRlKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\nbG9ja2VkKQogICAgICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQoK\nICAgICAgICBpZiAoY2xlYW4pCiAgICAgICAgICAgIHJldHVybiBCb29sZWFu\nLlRSVUU7CiAgICAgICAgaWYgKG5ld0ZsdXNoKSB7CiAgICAgICAgICAgIC8v\nIHRoaXMgZXZlbnQgY2FuIGJlIGZpcmVkIGxhdGVyIGNhdXNlIHdlJ3JlIGFs\ncmVhZHkgZGlydHkuCiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChM\naWZlY3ljbGVFdmVudC5CRUZPUkVfRElSVFlfRkxVU0hFRCk7CiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQm9v\nbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUgcG9zdC1k\naXJ0eSBldmVudHMgYWZ0ZXIgZmllbGQgdmFsdWUgY2hhbmdlcy4KICAgICAq\nCiAgICAgKiBAcGFyYW0gc3RhdHVzIHJldHVybiB2YWx1ZSBmcm9tIHtAbGlu\nayAjZGlydHkoaW50LCBCb29sZWFuLCBib29sZWFuKX0KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBvc3REaXJ0eShCb29sZWFuIHN0YXR1cykgewogICAg\nICAgIGlmIChCb29sZWFuLlRSVUUuZXF1YWxzKHN0YXR1cykpCiAgICAgICAg\nICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9E\nSVJUWSk7CiAgICAgICAgZWxzZSBpZiAoc3RhdHVzID09IG51bGwpCiAgICAg\nICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRF\nUl9ESVJUWV9GTFVTSEVEKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZW1v\ndmVkKGludCBmaWVsZCwgT2JqZWN0IHJlbW92ZWQsIGJvb2xlYW4ga2V5KSB7\nCiAgICAgICAgaWYgKHJlbW92ZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBkZXJlZmVyZW5j\nZSBkZXBlbmRlbnQgZmllbGRzLCBkZWxldGUgZW1iZWRkZWQKICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgICAgIFZhbHVlTWV0YURhdGEgdm1kID0gKGtleSkgPyBmbWQu\nZ2V0S2V5KCkgOiBmbWQuZ2V0RWxlbWVudCgpOwogICAgICAgICAgICBpZiAo\ndm1kLmlzRW1iZWRkZWRQQygpKQogICAgICAgICAgICAgICAgX3NpbmdsZS5k\nZWxldGUodm1kLCByZW1vdmVkLCBudWxsKTsKICAgICAgICAgICAgZWxzZSBp\nZiAodm1kLmdldENhc2NhZGVEZWxldGUoKSA9PSBWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfQVVUTykKICAgICAgICAgICAgICAgIF9zaW5nbGUuZGVyZWZlcmVu\nY2VEZXBlbmRlbnQocmVtb3ZlZCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUo\ncmUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IG5ld1By\nb3h5KGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\nX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0\nZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBuZXdGaWVsZFByb3h5\nKGZpZWxkKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0VHlwZUNvZGUoKSkg\newogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAg\nICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBqYXZhLnNxbC5E\nYXRlLmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgamF2\nYS5zcWwuRGF0ZShTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CiAgICAg\nICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGphdmEu\nc3FsLlRpbWVzdGFtcC5jbGFzcykKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IGphdmEuc3FsLlRpbWVzdGFtcChTeXN0ZW0uY3VycmVudFRpbWVN\naWxsaXMoKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVk\nVHlwZSgpID09IGphdmEuc3FsLlRpbWUuY2xhc3MpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBqYXZhLnNxbC5UaW1lKFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0\nZSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAg\nICAgICAgICAgICAgIHJldHVybiBDYWxlbmRhci5nZXRJbnN0YW5jZSgpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBIYXNoTWFwKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3RmllbGRQcm94eShpbnQgZmll\nbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZp\nZWxkKGZpZWxkKTsKICAgICAgICBQcm94eU1hbmFnZXIgbWdyID0gX2Jyb2tl\nci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldFByb3h5TWFu\nYWdlckluc3RhbmNlKCk7CiAgICAgICAgT2JqZWN0IGluaXQgPSBmbWQuZ2V0\nSW5pdGlhbGl6ZXIoKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRB\nVEU6CiAgICAgICAgICAgICAgICByZXR1cm4gbWdyLm5ld0RhdGVQcm94eShm\nbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgIHJldHVybiBtZ3IubmV3\nQ2FsZW5kYXJQcm94eShmbWQuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAg\nICAgICAgICAgICAgaW5pdCBpbnN0YW5jZW9mIFRpbWVab25lID8gKFRpbWVa\nb25lKSBpbml0IDogbnVsbCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICByZXR1cm4gbWdyLm5ld0Nv\nbGxlY3Rpb25Qcm94eShmbWQuZ2V0UHJveHlUeXBlKCksCiAgICAgICAgICAg\nICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSwK\nICAgICAgICAgICAgICAgICAgICBpbml0IGluc3RhbmNlb2YgQ29tcGFyYXRv\nciA/IChDb21wYXJhdG9yKSBpbml0IDogbnVsbCk7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIHJldHVybiBtZ3Iu\nbmV3TWFwUHJveHkoZm1kLmdldFByb3h5VHlwZSgpLAogICAgICAgICAgICAg\nICAgICAgIGZtZC5nZXRLZXkoKS5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAg\nICAgICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlw\nZSgpLAogICAgICAgICAgICAgICAgICAgIGluaXQgaW5zdGFuY2VvZiBDb21w\nYXJhdG9yID8gKENvbXBhcmF0b3IpIGluaXQgOiBudWxsKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaXNEZWZhdWx0VmFsdWUoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsK\nICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQp\nOwogICAgICAgICAgICBib29sZWFuIHJldCA9IF9zaW5nbGUuaXNEZWZhdWx0\nVmFsdWUoKTsKICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAg\nICAgICByZXR1cm4gcmV0OwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KICAgIC8vIFJlY29yZCB0aGF0IHRoZSBmaWVsZCBpcyBkaXJ0eSAod2hp\nY2ggbWlnaHQgbG9hZCBERkcpCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJs\naWMgdm9pZCBzZXR0aW5nQm9vbGVhbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYywgaW50IGZpZWxkLAogICAgICAgIGJvb2xlYW4gY3VyVmFsLCBib29s\nZWFuIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VU\nX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAm\nJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7\nCiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4u\nRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUu\nc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAg\nIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldHRpbmdCeXRlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBp\nbnQgZmllbGQsCiAgICAgICAgYnl0ZSBjdXJWYWwsIGJ5dGUgbmV3VmFsLCBp\nbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAg\nICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0\nKGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9Cgog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29s\nZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09\nIFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUJ5dGVGaWVs\nZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBj\nLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ0NoYXJG\naWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAg\nICBjaGFyIGN1clZhbCwgY2hhciBuZXdWYWwsIGludCBzZXQpIHsKICAgICAg\nICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5l\nd1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlL\nZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5\nKGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBuZXdWYWwp\nOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nRG91YmxlRmllbGQoUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgZG91YmxlIGN1clZh\nbCwgZG91YmxlIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQg\nIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1\nclZhbCAmJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShm\naWVsZCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJv\nb2xlYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9z\naW5nbGUuc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAg\nICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAg\nICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0dGluZ0Zsb2F0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxl\nIHBjLCBpbnQgZmllbGQsCiAgICAgICAgZmxvYXQgY3VyVmFsLCBmbG9hdCBu\nZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1P\nVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xv\nYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAg\nICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNF\nLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0b3Jl\nRmxvYXRGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFj\nZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3RE\naXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\ndGluZ0ludEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxk\nLAogICAgICAgIGludCBjdXJWYWwsIGludCBuZXdWYWwsIGludCBzZXQpIHsK\nICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAg\naWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1By\naW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9\nIGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIp\nOwogICAgICAgICAgICBfc2luZ2xlLnN0b3JlSW50RmllbGQoZmllbGQsIG5l\nd1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdMb25nRmllbGQoUGVyc2lz\ndGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgbG9uZyBjdXJW\nYWwsIGxvbmcgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAh\nPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3Vy\nVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZp\nZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9v\nbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3Np\nbmdsZS5zdG9yZUxvbmdGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAg\nICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAg\nICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0dGluZ09iamVjdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkLAogICAgICAgIE9iamVjdCBjdXJWYWwsIE9iamVjdCBu\nZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1P\nVEUpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGlmIChfbG9hZGVkLmdldChm\naWVsZCkpIHsKICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFs\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAg\nICAvLyBvbmx5IGNvbXBhcmUgbmV3IHRvIG9sZCB2YWx1ZXMgaWYgdGhlIGNv\nbXBhcmlzb24gaXMgZ29pbmcgdG8KICAgICAgICAgICAgICAgIC8vIGJlIGNo\nZWFwIC0tIGRvbid0IGNvbXBhcmUgY29sbGVjdGlvbnMsIG1hcHMsIFVEVHMK\nICAgICAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFS\nUkFZOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExF\nQ1RJT046CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQ\nOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAg\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAg\nICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdW\nYWwgIT0gbnVsbCAmJiBuZXdWYWwuZXF1YWxzKGN1clZhbCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0\naGlzIGlzIGEgZGVwZW5kZW50IHVubG9hZGVkIGZpZWxkLCBtYWtlIHN1cmUg\ndG8gbG9hZAogICAgICAgICAgICAgICAgLy8gaXQgbm93CiAgICAgICAgICAg\nICAgICBpZiAoZm1kLmdldENhc2NhZGVEZWxldGUoKSA9PSBWYWx1ZU1ldGFE\nYXRhLkNBU0NBREVfQVVUTwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5n\nZXRLZXkoKS5nZXRDYXNjYWRlRGVsZXRlKCkKICAgICAgICAgICAgICAgICAg\nICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTwogICAgICAgICAgICAg\nICAgICAgIHx8IGZtZC5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZURlbGV0ZSgp\nCiAgICAgICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURF\nX0FVVE8pCiAgICAgICAgICAgICAgICAgICAgY3VyVmFsID0gZmV0Y2hPYmpl\nY3RGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFz\nc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgICAgIGlm\nIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQp\nCiAgICAgICAgICAgICAgICBhc3NlcnROb3RNYW5hZ2VkT2JqZWN0SWQobmV3\nVmFsKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9v\nbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgaWYg\nKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xl\nLnN0b3JlT2JqZWN0RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAg\nICAgICBfc2luZ2xlLnVucHJveHkoKTsKICAgICAgICAgICAgICAgIF9zaW5n\nbGUuZGVyZWZlcmVuY2VEZXBlbmRlbnQoKTsKICAgICAgICAgICAgICAgIF9z\naW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfc2lu\nZ2xlLnN0b3JlT2JqZWN0RmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAg\nICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAg\nICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldHRpbmdTaG9ydEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkLAogICAgICAgIHNob3J0IGN1clZhbCwgc2hvcnQgbmV3\nVmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RF\nKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2Fk\nZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAg\nICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwg\nc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZVNo\nb3J0RmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGly\ndHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRp\nbmdTdHJpbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVs\nZCwKICAgICAgICBTdHJpbmcgY3VyVmFsLCBTdHJpbmcgbmV3VmFsLCBpbnQg\nc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAg\nICAgICAgIGlmIChTdHJpbmdVdGlscy5lcXVhbHMobmV3VmFsLCBjdXJWYWwp\nICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxk\nKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVh\nbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3Npbmds\nZS5zdG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAg\nICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIERpc2FsbG93cyBjaGFuZ2luZyBwcmltYXJ5IGtleSBmaWVsZHMgZm9y\nIGluc3RhbmNlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFzc2VydE5v\nUHJpbWFyeUtleUNoYW5nZShpbnQgZmllbGQpIHsKICAgICAgICBpZiAoX29p\nZCAhPSBudWxsICYmIF9tZXRhLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlL\nZXkoKSkKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKG5ldyBJbnZhbGlk\nU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICgiY2hh\nbmdlLWlkZW50aXR5IikpLnNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5z\ndGFuY2UoKSkpOwogICAgfQoKICAgIC8qKgogICAgICogRGlzYWxsb3dzIHNl\ndHRpbmcgYW4gb2JqZWN0IGlkIGZpZWxkIHRvIGEgbWFuYWdlZCBpbnN0YW5j\nZS4KICAgICAqLwogICAgdm9pZCBhc3NlcnROb3RNYW5hZ2VkT2JqZWN0SWQo\nT2JqZWN0IHZhbCkgewogICAgICAgIGlmICh2YWwgIT0gbnVsbAogICAgICAg\nICAgICAmJiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh2YWws\nCiAgICAgICAgICAgICAgICAgZ2V0Q29udGV4dCgpLmdldENvbmZpZ3VyYXRp\nb24oKSkpLnBjR2V0R2VuZXJpY0NvbnRleHQoKSE9IG51bGwpCiAgICAgICAg\nICAgIHRocm93IHRyYW5zbGF0ZShuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAoIm1hbmFnZWQtb2lkIiwgRXhj\nZXB0aW9ucy50b1N0cmluZyh2YWwpLAogICAgICAgICAgICAgICAgICAgIEV4\nY2VwdGlvbnMudG9TdHJpbmcoZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuCiAg\nICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3Rh\nbmNlKCkpKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBEZWxlZ2F0ZSB0byBGaWVsZE1hbmFnZXIKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBwcm92\naWRlZEJvb2xlYW5GaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCwKICAgICAgICBib29sZWFuIGN1clZhbCkgewogICAgICAgIF9mbS5z\ndG9yZUJvb2xlYW5GaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBwcm92aWRlZEJ5dGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMsIGludCBmaWVsZCwKICAgICAgICBieXRlIGN1clZhbCkgewogICAg\nICAgIF9mbS5zdG9yZUJ5dGVGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZENoYXJGaWVsZChQZXJzaXN0ZW5j\nZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBjaGFyIGN1clZhbCkg\newogICAgICAgIF9mbS5zdG9yZUNoYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZERvdWJsZUZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGRvdWJs\nZSBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVEb3VibGVGaWVsZChmaWVs\nZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZEZs\nb2F0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAg\nICAgICAgZmxvYXQgY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlRmxvYXRG\naWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBw\ncm92aWRlZEludEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZp\nZWxkLAogICAgICAgIGludCBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVJ\nbnRGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBwcm92aWRlZExvbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGlu\ndCBmaWVsZCwKICAgICAgICBsb25nIGN1clZhbCkgewogICAgICAgIF9mbS5z\ndG9yZUxvbmdGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBwcm92aWRlZE9iamVjdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYywgaW50IGZpZWxkLAogICAgICAgIE9iamVjdCBjdXJWYWwpIHsKICAg\nICAgICBfZm0uc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZFNob3J0RmllbGQoUGVyc2lz\ndGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgc2hvcnQgY3Vy\nVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlU2hvcnRGaWVsZChmaWVsZCwgY3Vy\nVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZFN0cmluZ0Zp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAg\nIFN0cmluZyBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVTdHJpbmdGaWVs\nZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBy\nZXBsYWNlQm9vbGVhbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50\nIGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaEJvb2xlYW5GaWVs\nZChmaWVsZCk7CiAgICB9CgogICAgcHVibGljIGJ5dGUgcmVwbGFjZUJ5dGVG\naWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAg\nICAgIHJldHVybiBfZm0uZmV0Y2hCeXRlRmllbGQoZmllbGQpOwogICAgfQoK\nICAgIHB1YmxpYyBjaGFyIHJlcGxhY2VDaGFyRmllbGQoUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZl\ndGNoQ2hhckZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgZG91Ymxl\nIHJlcGxhY2VEb3VibGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGlu\ndCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hEb3VibGVGaWVs\nZChmaWVsZCk7CiAgICB9CgogICAgcHVibGljIGZsb2F0IHJlcGxhY2VGbG9h\ndEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAg\nICAgICAgcmV0dXJuIF9mbS5mZXRjaEZsb2F0RmllbGQoZmllbGQpOwogICAg\nfQoKICAgIHB1YmxpYyBpbnQgcmVwbGFjZUludEZpZWxkKFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5m\nZXRjaEludEZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBy\nZXBsYWNlTG9uZ0ZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZp\nZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaExvbmdGaWVsZChmaWVs\nZCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCByZXBsYWNlT2JqZWN0Rmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAg\nICByZXR1cm4gX2ZtLmZldGNoT2JqZWN0RmllbGQoZmllbGQpOwogICAgfQoK\nICAgIHB1YmxpYyBzaG9ydCByZXBsYWNlU2hvcnRGaWVsZChQZXJzaXN0ZW5j\nZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0u\nZmV0Y2hTaG9ydEZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIHJlcGxhY2VTdHJpbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMs\nIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hTdHJpbmdG\naWVsZChmaWVsZCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgRmllbGRN\nYW5hZ2VyCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCgogICAgcHVibGljIGJvb2xlYW4gZmV0Y2hCb29sZWFuKGludCBmaWVsZCkg\newogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQo\nZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAg\nICAgICAgICAgIHJldHVybiBmZXRjaEJvb2xlYW5GaWVsZChmaWVsZCk7Cgog\nICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7\nCiAgICAgICAgcmV0dXJuICgoQm9vbGVhbikgZm1kLmdldEV4dGVybmFsVmFs\ndWUodmFsLCBfYnJva2VyKSkuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gZmV0Y2hCb29sZWFuRmllbGQoaW50IGZpZWxkKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZp\nZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNl\nKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZp\nZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hCb29sZWFu\nRmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYnl0ZSBm\nZXRjaEJ5dGUoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQu\naXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoQnl0\nZUZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmll\nbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZt\nZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLmJ5dGVWYWx1ZSgp\nOwogICAgfQoKICAgIHB1YmxpYyBieXRlIGZldGNoQnl0ZUZpZWxkKGludCBm\naWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAg\nIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNl\nLCBmYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2lu\nZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNo\nQnl0ZUZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGNo\nYXIgZmV0Y2hDaGFyKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICgh\nZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRj\naENoYXJGaWVsZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRj\naEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoQ2hhcmFj\ndGVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5jaGFy\nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgY2hhciBmZXRjaENoYXJGaWVs\nZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAg\nICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05F\nLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9w\nYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3Npbmds\nZS5mZXRjaENoYXJGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBkb3VibGUgZmV0Y2hEb3VibGUoaW50IGZpZWxkKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAg\ncmV0dXJuIGZldGNoRG91YmxlRmllbGQoZmllbGQpOwoKICAgICAgICBPYmpl\nY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJl\ndHVybiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJv\na2VyKSkuZG91YmxlVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgZG91Ymxl\nIGZldGNoRG91YmxlRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQo\nZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2Nr\nTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAg\nIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hEb3VibGVGaWVsZChmaWVsZCk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBmbG9hdCBmZXRjaEZsb2F0KGludCBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVk\nKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaEZsb2F0RmllbGQoZmllbGQp\nOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFs\nc2UpOwogICAgICAgIHJldHVybiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFs\nVmFsdWUodmFsLCBfYnJva2VyKSkuZmxvYXRWYWx1ZSgpOwogICAgfQoKICAg\nIHB1YmxpYyBmbG9hdCBmZXRjaEZsb2F0RmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgh\nX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxk\nKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsK\nCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hGbG9hdEZpZWxk\nKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBmZXRjaElu\ndChpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9t\nZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVy\nbmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hJbnRGaWVsZChm\naWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxk\nLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0\nZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5pbnRWYWx1ZSgpOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgZmV0Y2hJbnRGaWVsZChpbnQgZmllbGQpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFf\nbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQo\nZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoK\nICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQp\nOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaEludEZpZWxkKGZp\nZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGxvbmcgZmV0Y2hMb25n\nKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21l\ndGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJu\nYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaExvbmdGaWVsZChm\naWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxk\nLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0\nZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5sb25nVmFsdWUoKTsKICAgIH0K\nCiAgICBwdWJsaWMgbG9uZyBmZXRjaExvbmdGaWVsZChpbnQgZmllbGQpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmll\nbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2Up\nOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmll\nbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaExvbmdGaWVs\nZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0\nY2hPYmplY3QoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQu\naXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoT2Jq\nZWN0RmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hG\naWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVybiBmbWQuZ2V0RXh0\nZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3QgZmV0Y2hPYmplY3RGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVk\nLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQs\nIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAg\nICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAg\nICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaE9iamVjdEZpZWxkKGZpZWxk\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHNob3J0IGZldGNoU2hvcnQo\naW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0\nYS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5h\nbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoU2hvcnRGaWVsZChm\naWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxk\nLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0\nZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5zaG9ydFZhbHVlKCk7CiAgICB9\nCgogICAgcHVibGljIHNob3J0IGZldGNoU2hvcnRGaWVsZChpbnQgZmllbGQp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2Fk\nRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFs\nc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaFNob3J0\nRmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5n\nIGZldGNoU3RyaW5nKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICgh\nZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRj\naFN0cmluZ0ZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZl\ndGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKFN0cmlu\nZykgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKTsKICAgIH0K\nCiAgICBwdWJsaWMgU3RyaW5nIGZldGNoU3RyaW5nRmllbGQoaW50IGZpZWxk\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGlmICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9h\nZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZh\nbHNlKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUs\nIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hTdHJp\nbmdGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHN0b3JlQm9vbGVhbihpbnQgZmllbGQsIGJvb2xlYW4gZXh0ZXJuYWxWYWwp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxk\nKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQog\nICAgICAgICAgICBzdG9yZUJvb2xlYW5GaWVsZChmaWVsZCwgZXh0ZXJuYWxW\nYWwpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBPYmplY3QgdmFsID0g\nKGV4dGVybmFsVmFsKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7\nCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZh\nbHVlKHZhbCwgX2Jyb2tlcikpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzdG9yZUJvb2xlYW5GaWVsZChpbnQgZmllbGQsIGJvb2xlYW4g\nY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIF9zaW5nbGUuc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIGN1clZh\nbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZp\nZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAg\nICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzdG9yZUJ5dGUoaW50IGZpZWxkLCBieXRlIGV4\ndGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0\nYS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5h\nbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVCeXRlRmllbGQoZmllbGQsIGV4\ndGVybmFsVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmll\nbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBCeXRlKGV4dGVybmFs\nVmFsKSwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzdG9yZUJ5dGVGaWVsZChpbnQgZmllbGQsIGJ5dGUgY3Vy\nVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIF9zaW5nbGUuc3RvcmVCeXRlRmllbGQoZmllbGQsIGN1clZhbCk7CiAg\nICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsK\nICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAg\nICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzdG9yZUNoYXIoaW50IGZpZWxkLCBjaGFyIGV4dGVybmFs\nVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQo\nKSkKICAgICAgICAgICAgc3RvcmVDaGFyRmllbGQoZmllbGQsIGV4dGVybmFs\nVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmll\nbGQsIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBDaGFyYWN0ZXIoZXh0ZXJuYWxW\nYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHN0b3JlQ2hhckZpZWxkKGludCBmaWVsZCwgY2hhciBjdXJW\nYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgX3NpbmdsZS5zdG9yZUNoYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAg\nICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwog\nICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAg\nICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHN0b3JlRG91YmxlKGludCBmaWVsZCwgZG91YmxlIGV4dGVy\nbmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6\nZWQoKSkKICAgICAgICAgICAgc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgZXh0\nZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVs\nZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUobmV3IERvdWJsZShleHRlcm5h\nbFZhbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc3RvcmVEb3VibGVGaWVsZChpbnQgZmllbGQsIGRvdWJs\nZSBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgX3NpbmdsZS5zdG9yZURvdWJsZUZpZWxkKGZpZWxkLCBjdXJW\nYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBm\naWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAg\nICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc3RvcmVGbG9hdChpbnQgZmllbGQsIGZsb2F0\nIGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVGbG9hdEZpZWxkKGZpZWxk\nLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9y\nZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShuZXcgRmxvYXQoZXh0\nZXJuYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHN0b3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZs\nb2F0IGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBfc2luZ2xlLnN0b3JlRmxvYXRGaWVsZChmaWVsZCwgY3Vy\nVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwog\nICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlSW50KGludCBmaWVsZCwgaW50IGV4\ndGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0\nYS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5h\nbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVJbnRGaWVsZChmaWVsZCwgZXh0\nZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVs\nZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUoTnVtYmVycy52YWx1ZU9mKGV4\ndGVybmFsVmFsKSwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzdG9yZUludEZpZWxkKGludCBmaWVsZCwgaW50\nIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlSW50RmllbGQoZmllbGQsIGN1clZhbCk7\nCiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAg\nICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzdG9yZUxvbmcoaW50IGZpZWxkLCBsb25nIGV4dGVy\nbmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6\nZWQoKSkKICAgICAgICAgICAgc3RvcmVMb25nRmllbGQoZmllbGQsIGV4dGVy\nbmFsVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQo\nZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKE51bWJlcnMudmFsdWVPZihleHRl\ncm5hbFZhbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc3RvcmVMb25nRmllbGQoaW50IGZpZWxkLCBsb25n\nIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBjdXJWYWwp\nOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVs\nZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAg\nICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc3RvcmVPYmplY3QoaW50IGZpZWxkLCBPYmplY3Qg\nZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9t\nZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBleHRlcm5hbFZhbCA9IGZt\nZC5vcmRlcihleHRlcm5hbFZhbCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVPYmplY3RGaWVsZChmaWVs\nZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Rv\ncmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUoZXh0ZXJuYWxWYWws\nIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZU9iamVj\ndEZpZWxkKGludCBmaWVsZCwgT2JqZWN0IGN1clZhbCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0b3Jl\nT2JqZWN0RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIF9zaW5n\nbGUucHJveHkodHJ1ZSwgZmFsc2UpOwogICAgICAgICAgICByZXBsYWNlRmll\nbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNldExvYWRl\nZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBu\ndWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVTaG9y\ndChpbnQgZmllbGQsIHNob3J0IGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3Rv\ncmVTaG9ydEZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRW\nYWx1ZShuZXcgU2hvcnQoZXh0ZXJuYWxWYWwpLAogICAgICAgICAgICAgICAg\nX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU2hvcnRG\naWVsZChpbnQgZmllbGQsIHNob3J0IGN1clZhbCkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0b3JlU2hv\ncnRGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZp\nZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2Fk\nZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwg\nbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU3Ry\naW5nKGludCBmaWVsZCwgU3RyaW5nIGV4dGVybmFsVmFsKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAg\nc3RvcmVTdHJpbmdGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZp\nZWxkVmFsdWUoZXh0ZXJuYWxWYWwsIF9icm9rZXIpKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzdG9yZVN0cmluZ0ZpZWxkKGludCBmaWVsZCwgU3RyaW5n\nIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlU3RyaW5nRmllbGQoZmllbGQsIGN1clZh\nbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZp\nZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAg\nICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSBnaXZlbiBmaWVsZCB2YWx1ZSBp\nbnRvIHRoZSBnaXZlbiBmaWVsZCBtYW5hZ2VyLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgc3RvcmVGaWVsZChpbnQgZmllbGQsIE9iamVjdCB2YWwsIEZp\nZWxkTWFuYWdlciBmbSkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\nX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmIChmbWQgPT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLWZpZWxkLWluZGV4IiwKICAgICAgICAgICAgICAgIFN0cmluZy52\nYWx1ZU9mKGZpZWxkKSwgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkuCiAg\nICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3Rh\nbmNlKCkpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoK\nICAgICAgICAgICAgICAgIGJvb2xlYW4gYm9vbCA9IHZhbCAhPSBudWxsICYm\nICgoQm9vbGVhbikgdmFsKS5ib29sZWFuVmFsdWUoKTsKICAgICAgICAgICAg\nICAgIGZtLnN0b3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBib29sKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFOgogICAgICAgICAgICAgICAgYnl0ZSBiID0gKHZhbCA9PSBudWxsKSA/\nIDAgOiAoKE51bWJlcikgdmFsKS5ieXRlVmFsdWUoKTsKICAgICAgICAgICAg\nICAgIGZtLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBiKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgog\nICAgICAgICAgICAgICAgY2hhciBjID0gKHZhbCA9PSBudWxsKSA/IDAgOiAo\nKENoYXJhY3RlcikgdmFsKS5jaGFyVmFsdWUoKTsKICAgICAgICAgICAgICAg\nIGZtLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBjKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAg\nICAgICAgICAgICAgICBkb3VibGUgZCA9ICh2YWwgPT0gbnVsbCkgPyAwIDog\nKChOdW1iZXIpIHZhbCkuZG91YmxlVmFsdWUoKTsKICAgICAgICAgICAgICAg\nIGZtLnN0b3JlRG91YmxlRmllbGQoZmllbGQsIGQpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgog\nICAgICAgICAgICAgICAgZmxvYXQgZiA9ICh2YWwgPT0gbnVsbCkgPyAwIDog\nKChOdW1iZXIpIHZhbCkuZmxvYXRWYWx1ZSgpOwogICAgICAgICAgICAgICAg\nZm0uc3RvcmVGbG9hdEZpZWxkKGZpZWxkLCBmKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAg\nICAgICAgICAgICBpbnQgaSA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1i\nZXIpIHZhbCkuaW50VmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3Jl\nSW50RmllbGQoZmllbGQsIGkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAg\nICBsb25nIGwgPSAodmFsID09IG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwp\nLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3RvcmVMb25nRmll\nbGQoZmllbGQsIGwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgc2hv\ncnQgcyA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZhbCkuc2hv\ncnRWYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3RvcmVTaG9ydEZpZWxk\nKGZpZWxkLCBzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICBmbS5z\ndG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCAoU3RyaW5nKSB2YWwpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICBmbS5zdG9yZU9iamVjdEZpZWxkKGZpZWxkLCB2YWwpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vCiAgICAvLyBVdGlsaXRp\nZXMKICAgIC8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIEVyYXNlIHRo\nZSBmYWN0IHRoYXQgdGhpcyBpbnN0YW5jZSBoYXMgYmVlbiBmbHVzaGVkLgog\nICAgICovCiAgICB2b2lkIGVyYXNlRmx1c2goKSB7CiAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX0ZMVVNIRUQ7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZM\nVVNIRURfRElSVFk7CgogICAgICAgIGludCBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCkubGVuZ3RoOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\nczsgaSsrKQogICAgICAgICAgICBfZmx1c2guY2xlYXIoaSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWNvcmRzIHRoYXQgYWxsIGluc3RhbmNlIGZpZWxk\ncyBhcmUvYXJlIG5vdCBsb2FkZWQuCiAgICAgKiBQcmltYXJ5IGtleSBhbmQg\nbm9uLXBlcnNpc3RlbnQgZmllbGRzIGFyZSBub3QgYWZmZWN0ZWQuCiAgICAg\nKi8KICAgIHZvaWQgc2V0TG9hZGVkKGJvb2xlYW4gdmFsKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKCFmbWRzW2ldLmlzUHJpbWFyeUtleSgpCiAgICAg\nICAgICAgICAgICAmJiBmbWRzW2ldLmdldE1hbmFnZW1lbnQoKSA9PSBmbWRz\nW2ldLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgc2V0TG9h\nZGVkKGksIHZhbCk7CiAgICAgICAgfQogICAgICAgIGlmICghdmFsKSB7CiAg\nICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19MT0FERUQ7CiAgICAgICAgICAg\nIHNldERpcnR5KGZhbHNlKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nX2ZsYWdzIHw9IEZMQUdfTE9BREVEOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVjb3JkcyB0aGF0IGFsbCBpbnN0YW5jZSBmaWVsZHMgYXJlL2FyZSBub3Qg\nZGlydHksCiAgICAgKiBhbmQgY2hhbmdlcyB0aGUgZmxhZ3Mgb2YgdGhlIGlu\nc3RhbmNlIGFjY29yZGluZ2x5LgogICAgICovCiAgICB2b2lkIHNldERpcnR5\nKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBib29sZWFuIHVwZGF0ZSA9\nICFpc05ldygpIHx8IGlzRmx1c2hlZCgpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\ndmFsICYmICghdXBkYXRlCiAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdl\ndFVwZGF0ZVN0cmF0ZWd5KCkgIT0gVXBkYXRlU3RyYXRlZ2llcy5JR05PUkUp\nKQogICAgICAgICAgICAgICAgX2RpcnR5LnNldChpKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoIXZhbCkgewogICAgICAgICAgICAgICAgLy8gd2UgbmV2ZXIg\nY29uc2lkZXIgY2xlYW4gZmllbGRzIGZsdXNoZWQ7IHRoaXMgYWxzbyB0YWtl\ncwogICAgICAgICAgICAgICAgLy8gY2FyZSBvZiBjbGVhcmluZyB0aGUgZmx1\nc2hlZCBmaWVsZHMgb24gY29tbWl0L3JvbGxiYWNrCiAgICAgICAgICAgICAg\nICBfZmx1c2guY2xlYXIoaSk7CiAgICAgICAgICAgICAgICBfZGlydHkuY2xl\nYXIoaSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh2\nYWwpCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0xPQURFRDsKICAgIH0K\nCiAgICAvKioKICAgICAqIEV4ZWN1dGVzIHByZS1jbGVhciBjYWxsYmFja3Ms\nIGNsZWFycyBhbGwgbWFuYWdlZCBmaWVsZHMsIGFuZCBjYWxscyB0aGUKICAg\nICAqIHtAbGluayAjc2V0TG9hZGVkfSBtZXRob2Qgd2l0aCBhIHZhbHVlIG9m\nIGZhbHNlLiBQcmltYXJ5IGtleSBmaWVsZHMKICAgICAqIGFyZSBub3QgY2xl\nYXJlZC4KICAgICAqLwogICAgdm9pZCBjbGVhckZpZWxkcygpIHsKICAgICAg\nICBpZiAoIWlzSW50ZXJjZXB0aW5nKCkpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJF\nRk9SRV9DTEVBUik7CgogICAgICAgIC8vIHVucHJveHkgYWxsIGZpZWxkcwog\nICAgICAgIHVucHJveHlGaWVsZHMoKTsKCiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNsZWFyIG5vbi1wayBmaWVsZHMK\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRG\naWVsZHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoIWZtZHNbaV0u\naXNQcmltYXJ5S2V5KCkgJiYgZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkKICAg\nICAgICAgICAgICAgICAgICA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJT\nSVNURU5UKQogICAgICAgICAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMs\nIENsZWFyRmllbGRNYW5hZ2VyLmdldEluc3RhbmNlKCksIGkpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBmb3JnZXQgdmVyc2lvbiBpbmZvIGFu\nZCBpbXBsIGRhdGEgc28gd2UgcmUtcmVhZCBuZXh0IHRpbWUKICAgICAgICAg\nICAgc2V0TG9hZGVkKGZhbHNlKTsKICAgICAgICAgICAgX3ZlcnNpb24gPSBu\ndWxsOwogICAgICAgICAgICBfbG9hZFZlcnNpb24gPSBudWxsOwogICAgICAg\nICAgICBpZiAoX2ZpZWxkSW1wbCAhPSBudWxsKQogICAgICAgICAgICAgICAg\nQXJyYXlzLmZpbGwoX2ZpZWxkSW1wbCwgbnVsbCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQoKICAgICAg\nICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQUZURVJfQ0xF\nQVIpOwogICAgfQoKICAgIC8qKgogICAgICogUmVjb3JkIHRoYXQgd2Ugc2hv\ndWxkIHNhdmUgYW55IGZpZWxkcyB0aGF0IGNoYW5nZSBmcm9tIHRoaXMgcG9p\nbnQKICAgICAqIGZvcndhcmQuCiAgICAgKi8KICAgIHZvaWQgc2F2ZUZpZWxk\ncyhib29sZWFuIGltbWVkaWF0ZSkgewogICAgICAgIGlmIChfYnJva2VyLmdl\ndFJlc3RvcmVTdGF0ZSgpID09IFJlc3RvcmVTdGF0ZS5SRVNUT1JFX05PTkUK\nICAgICAgICAgICAgJiYgKF9mbGFncyAmIEZMQUdfSU5WRVJTRVMpID09IDAp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgX2ZsYWdzIHw9IEZMQUdf\nU0FWRTsKICAgICAgICBpZiAoaW1tZWRpYXRlKSB7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwLCBsZW4gPSBfbG9hZGVkLmxlbmd0aCgpOyBpIDwgbGVu\nOyBpKyspCiAgICAgICAgICAgICAgICBzYXZlRmllbGQoaSk7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+RkxBR19TQVZFOwogICAgICAgICAgICAvLyBPUEVO\nSlBBLTY1OQogICAgICAgICAgICAvLyByZWNvcmQgYSBzYXZlZCBmaWVsZCBt\nYW5hZ2VyIGV2ZW4gaWYgbm8gZmllbGQgaXMgY3VycmVudGx5IGxvYWRlZAog\nICAgICAgICAgICAvLyBhcyBleGlzdGVuY2Ugb2YgYSBTYXZlRmllbGRNYW5h\nZ2VyIGlzIGNyaXRpY2FsIGZvciBhIGRpcnR5IGNoZWNrCiAgICAgICAgICAg\nIGlmIChfc2F2ZWQgPT0gbnVsbCkKICAgICAgICAgICAgCV9zYXZlZCA9IG5l\ndyBTYXZlRmllbGRNYW5hZ2VyKHRoaXMsIGdldFBlcnNpc3RlbmNlQ2FwYWJs\nZSgpLCAKICAgICAgICAgICAgCQkJCV9kaXJ0eSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogSWYgdGhlIGZpZWxkIGlzbid0IGFscmVhZHkg\nc2F2ZWQsIHNhdmVzIHRoZSBjdXJyZW50bHkgbG9hZGVkIGZpZWxkCiAgICAg\nKiBzdGF0ZSBvZiB0aGUgaW5zdGFuY2UuIFRoZSBzYXZlZCB2YWx1ZXMgY2Fu\nIGFsbCBiZSByZXN0b3JlZCB2aWEKICAgICAqIHtAbGluayAjcmVzdG9yZUZp\nZWxkc30uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzYXZlRmllbGQoaW50\nIGZpZWxkKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NBVkUpID09\nIDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYgdGhpcyBp\ncyBhIG1hbmFnZWQgaW52ZXJzZSBmaWVsZCwgbG9hZCBpdCBzbyB3ZSdyZSBz\ndXJlIHRvIGhhdmUKICAgICAgICAvLyB0aGUgb3JpZ2luYWwgdmFsdWUKICAg\nICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSAmJiAoKF9mbGFncyAmIEZM\nQUdfSU5WRVJTRVMpICE9IDAKICAgICAgICAgICAgJiYgX21ldGEuZ2V0Rmll\nbGQoZmllbGQpLmdldEludmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPiAwKSkK\nICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tf\nTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgLy8gZG9uJ3QgYm90aGVy\nIGNyZWF0aW5nIHRoZSBzYXZlIGZpZWxkIG1hbmFnZXIgaWYgd2UncmUgbm90\nIGdvaW5nIHRvCiAgICAgICAgLy8gc2F2ZSB0aGUgb2xkIGZpZWxkIHZhbHVl\nIGFueXdheQogICAgICAgIGlmIChfc2F2ZWQgPT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAg\nX3NhdmVkID0gbmV3IFNhdmVGaWVsZE1hbmFnZXIodGhpcywgbnVsbCwgX2Rp\ncnR5KTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgLy8gY29weSB0aGUgZmllbGQgdG8gc2F2\nZSBmaWVsZCBtYW5hZ2VyOyBpZiB0aGUgZmllbGQgaXMgbm90IGRpcmVjdGx5\nCiAgICAgICAgLy8gY29weWFibGUsIGltbWVkaWF0ZWx5IHByb3ZpZGUgYW5k\nIHJlcGxhY2UgaXQgdmlhIHRoZSBzYXZlIGZpZWxkCiAgICAgICAgLy8gbWFu\nYWdlciwgd2hpY2ggd2lsbCBjb3B5IHRoZSBtdXRhYmxlIHZhbHVlIHRvIHBy\nZXZlbnQgYnktcmVmIG1vZHMKICAgICAgICBpZiAoX3NhdmVkLnNhdmVGaWVs\nZChmaWVsZCkpIHsKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3Nh\ndmVkLCBmaWVsZCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfc2F2ZWQu\nZ2V0U3RhdGUoKSwgX3NhdmVkLCBmaWVsZCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogTm90aWZpY2F0aW9uIHRoYXQgdGhlIHN0YXRlIHdp\nbGwgbm90IG5lZWQgdG8gYmUgcm9sbGVkIGJhY2sKICAgICAqIHRvIHRoYXQg\nb2YgdGhlIGxhc3QgY2FsbCB0byB7QGxpbmsgI3NhdmVGaWVsZHN9LgogICAg\nICovCiAgICB2b2lkIGNsZWFyU2F2ZWRGaWVsZHMoKSB7CiAgICAgICAgaWYg\nKGlzSW50ZXJjZXB0aW5nKCkpIHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5G\nTEFHX1NBVkU7CiAgICAgICAgICAgIF9zYXZlZCA9IG51bGw7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBTYXZlRmllbGRNYW5hZ2VyIGdldFNhdmVG\naWVsZE1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIF9zYXZlZDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJvbGxiYWNrIHRoZSBzdGF0ZSBvZiB0aGUgaW5z\ndGFuY2UgdG8gdGhlIHNhdmVkIHN0YXRlIGZyb20gdGhlCiAgICAgKiBsYXN0\nIGNhbGwgdG8ge0BsaW5rICNzYXZlRmllbGRzfSwgb3IgdG8gZGVmYXVsdCB2\nYWx1ZXMgaWYgbmV2ZXIgc2F2ZWQuCiAgICAgKi8KICAgIHZvaWQgcmVzdG9y\nZUZpZWxkcygpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKF9zYXZlZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBpZiAoKF9mbGFncyAmIEZMQUdfU0FWRSkgPT0gMCkKICAgICAgICAgICAg\nICAgICAgICBjbGVhckZpZWxkcygpOwogICAgICAgICAgICAgICAgZWxzZSAv\nLyBvbmx5IHVubG9hZGVkIGZpZWxkcyB3ZXJlIGRpcnRpZWQKICAgICAgICAg\nICAgICAgICAgICBfbG9hZGVkLmFuZE5vdChfbG9hZGVkKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICAvLyB3ZSBkaXJlY3Qgc3RhdGUgdHJhbnNpdGlv\nbnMgYmFzZWQgb24gb3VyIG93biBnZXRSZXN0b3JlU3RhdGUKICAgICAgICAg\nICAgLy8gbWV0aG9kLCBidXQgdG8gZGVjaWRlIHdoZXRoZXIgdG8gYWN0dWFs\nbHkgcm9sbGJhY2sgZmllbGQKICAgICAgICAgICAgLy8gdmFsdWVzLCB3ZSBj\nb25zdWx0IHRoZSBicm9rZXIgZm9yIHRoZSB1c2VyJ3Mgc2V0dGluZwogICAg\nICAgICAgICBlbHNlIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpICE9\nIFJlc3RvcmVTdGF0ZS5SRVNUT1JFX05PTkUpIHsKICAgICAgICAgICAgICAg\nIC8vIHJvbGxiYWNrIGFsbCBjdXJyZW50bHktbG9hZGVkIGZpZWxkcwogICAg\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9sb2FkZWQubGVu\nZ3RoKCk7IGkgPCBsZW47IGkrKykKICAgICAgICAgICAgICAgICAgICBpZiAo\nX2xvYWRlZC5nZXQoaSkgJiYgX3NhdmVkLnJlc3RvcmVGaWVsZChpKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NhdmVk\nLCBpKTsKCiAgICAgICAgICAgICAgICAvLyByb2xsYmFjayBsb2FkZWQgc2V0\nCiAgICAgICAgICAgICAgICBfbG9hZGVkLmFuZE5vdChfc2F2ZWQuZ2V0VW5s\nb2FkZWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJlcGxhY2VzIGFsbCBzZWNvbmQgY2xhc3Mgb2Jq\nZWN0IGZpZWxkcyB3aXRoIGZyZXNoIHByb3hpZWQgaW5zdGFuY2VzCiAgICAg\nKiBjb250YWluaW5nIHRoZSBzYW1lIGluZm9ybWF0aW9uIGFzIHRoZSBvcmln\naW5hbHMuCiAgICAgKi8KICAgIHZvaWQgcHJveHlGaWVsZHMoYm9vbGVhbiBy\nZXNldCwgYm9vbGVhbiByZXBsYWNlTnVsbCkgewogICAgICAgIC8vIHdlIG9u\nbHkgcmVwbGFjZSBudWxscyBpZiB0aGUgcnVudGltZSBjYW4ndCBkaWZmZXJl\nbnRpYXRlIGJldHdlZW4KICAgICAgICAvLyBudWxsIGFuZCBlbXB0eSBjb250\nYWluZXJzLiAgd2UgcmVwbGFjZSBudWxscyBpbiB0aGlzIGNhc2UgdG8KICAg\nICAgICAvLyBtYWludGFpbiBjb25zaXN0ZW5jeSB3aGV0aGVyIHZhbHVlcyBh\ncmUgYmVpbmcgcmV0YWluZWQgb3Igbm90CiAgICAgICAgaWYgKHJlcGxhY2VO\ndWxsKQogICAgICAgICAgICByZXBsYWNlTnVsbCA9ICFfYnJva2VyLmdldENv\nbmZpZ3VyYXRpb24oKS5zdXBwb3J0ZWRPcHRpb25zKCkuCiAgICAgICAgICAg\nICAgICBjb250YWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJT05fTlVM\nTF9DT05UQUlORVIpOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9sb2FkZWQubGVu\nZ3RoKCk7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9s\nb2FkZWQuZ2V0KGkpKSB7CiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZUZp\nZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKF9zaW5nbGUucHJveHkocmVzZXQsIHJlcGxhY2VOdWxsKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7\nCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVbnByb3h5\nIGFsbCBmaWVsZHMuCiAgICAgKi8KICAgIHZvaWQgdW5wcm94eUZpZWxkcygp\nIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfTk9fVU5QUk9YWSkgIT0g\nMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9s\nb2FkZWQubGVuZ3RoKCk7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAg\nICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAg\nICAgICBfc2luZ2xlLnVucHJveHkoKTsKICAgICAgICAgICAgICAgIF9zaW5n\nbGUucmVsZWFzZUVtYmVkZGVkKCk7CiAgICAgICAgICAgICAgICBfc2luZ2xl\nLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEdldCByZWFkeSBmb3IgYSBmbHVzaC4gUGVyc2lz\ndHMgYWxsIHBlcnNpc3RlbmNlLWNhcGFibGUgb2JqZWN0IGZpZWxkcywKICAg\nICAqIGFuZCBjaGVja3MgZm9yIGlsbGVnYWwgbnVsbCB2YWx1ZXMuIEFsc28g\nYXNzaWducyBvaWRzIGFuZCBmaWVsZCB2YWx1ZXMKICAgICAqIGZvciBhbGwg\nc3RyYXRlZ2llcyB0aGF0IGRvbid0IHJlcXVpcmUgZmx1c2hpbmcuCiAgICAg\nKi8KICAgIHZvaWQgcHJlRmx1c2goYm9vbGVhbiBsb2dpY2FsLCBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRV9G\nTFVTSEVEKSAhPSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlm\nIChpc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICBmaXJlTGlmZWN5Y2xl\nRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX1NUT1JFKTsKICAgICAgICAg\nICAgLy8gQkVGT1JFX1BFUlNJU1QgaXMgaGFuZGxlZCBkdXJpbmcgQnJva2Vy\nLnBlcnNpc3QgYW5kIEJyb2tlci5hdHRhY2gKICAgICAgICAgICAgaWYgKGlz\nRGVsZXRlZCgpKQogICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50\nKExpZmVjeWNsZUV2ZW50LkJFRk9SRV9ERUxFVEUpOwogICAgICAgICAgICBl\nbHNlIGlmICghKGlzTmV3KCkgJiYgIWlzRmx1c2hlZCgpKSkKICAgICAgICAg\nICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZP\nUkVfVVBEQVRFKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUFJFX0ZM\nVVNIRUQ7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKCFsb2dpY2FsKQogICAgICAgICAgICAgICAg\nYXNzaWduT2JqZWN0SWQoZmFsc2UsIHRydWUpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMCwgbGVuID0gX21ldGEuZ2V0RmllbGRzKCkubGVuZ3RoOyBp\nIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmICgobG9naWNhbCB8\nfCAhYXNzaWduRmllbGQoaSwgdHJ1ZSkpICYmICFfZmx1c2guZ2V0KGkpCiAg\nICAgICAgICAgICAgICAgICAgJiYgX2RpcnR5LmdldChpKSkgewogICAgICAg\nICAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChfc2luZ2xlLnByZUZsdXNoKGxvZ2lj\nYWwsIGNhbGwpKQogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlRmll\nbGQoX3BjLCBfc2luZ2xlLCBpKTsKICAgICAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGly\ndHlDaGVjaygpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ug\nY2FsbGJhY2tzIGZvciBkZWxldGlvbi4KICAgICAqLwogICAgdm9pZCBwcmVE\nZWxldGUoKSB7CiAgICAgICAgLy8gc2V0IGEgZmxhZyB3aGlsZSBjYWxsIHBy\nZSBkZWxldGUgY2FsbGJhY2sgc28gdGhhdCB1c2VyIGNhbid0CiAgICAgICAg\nLy8gZ2V0IGludG8gaW5maW5pdGUgcmVjdXJzaW9uIGJ5IGNhbGxpbmcgZGVs\nZXRlKHRoaXMpCiAgICAgICAgLy8gd2l0aGluIGhpcyBjYWxsYmFjayBtZXRo\nb2QKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfUFJFX0RFTEVUSU5HKSA9\nPSAwKSB7CiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1BSRV9ERUxFVElO\nRzsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZpcmVMaWZl\nY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZPUkVfREVMRVRFKTsKICAg\nICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19QUkVfREVMRVRJTkc7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDYXNjYWRlIGRlbGV0ZXMgYW5kIGRl\ncmVmZXJlbmNlIGRlcGVuZGVudCBmaWVsZHMuCiAgICAgKi8KICAgIHZvaWQg\nY2FzY2FkZURlbGV0ZShPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0Q2FzY2FkZURlbGV0ZSgpICE9IFZh\nbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FCiAgICAgICAgICAgICAgICB8fCBm\nbWRzW2ldLmdldEtleSgpLmdldENhc2NhZGVEZWxldGUoKQogICAgICAgICAg\nICAgICAgIT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUKICAgICAgICAg\nICAgICAgIHx8IGZtZHNbaV0uZ2V0RWxlbWVudCgpLmdldENhc2NhZGVEZWxl\ndGUoKQogICAgICAgICAgICAgICAgIT0gVmFsdWVNZXRhRGF0YS5DQVNDQURF\nX05PTkUpIHsKICAgICAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVPYmplY3RG\naWVsZChpLCBmZXRjaEZpZWxkKGksIGZhbHNlKSk7CiAgICAgICAgICAgICAg\nICBfc2luZ2xlLmRlbGV0ZShjYWxsKTsKICAgICAgICAgICAgICAgIF9zaW5n\nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIENhbGxlZCBhZnRlciBhbiBpbnN0YW5jZSBpcyBwZXJz\naXN0ZWQgYnkgYSB1c2VyIHRocm91Z2ggdGhlIGJyb2tlci4KICAgICAqIENh\nc2NhZGVzIHRoZSBwZXJzaXN0IG9wZXJhdGlvbiB0byBmaWVsZHMgbWFya2Vk\nCiAgICAgKiB7QGxpbmsgVmFsdWVNZXRhRGF0YSNDQVNDQURFX0lNTUVESUFU\nRX0uCiAgICAgKi8KICAgIHZvaWQgY2FzY2FkZVBlcnNpc3QoT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21l\ndGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5n\nZXQoaSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAg\nIGlmIChmbWRzW2ldLmdldENhc2NhZGVQZXJzaXN0KCkgPT0gVmFsdWVNZXRh\nRGF0YS5DQVNDQURFX0lNTUVESUFURQogICAgICAgICAgICAgICAgfHwgZm1k\nc1tpXS5nZXRLZXkoKS5nZXRDYXNjYWRlUGVyc2lzdCgpCiAgICAgICAgICAg\nICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFCiAgICAg\nICAgICAgICAgICB8fCBmbWRzW2ldLmdldEVsZW1lbnQoKS5nZXRDYXNjYWRl\nUGVyc2lzdCgpCiAgICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfSU1NRURJQVRFKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlT2JqZWN0RmllbGQoaSwgZmV0Y2hGaWVsZChpLCBmYWxzZSkpOwogICAg\nICAgICAgICAgICAgX3NpbmdsZS5wZXJzaXN0KGNhbGwpOwogICAgICAgICAg\nICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgZ2l2ZW4gZmllbGQg\nc2V0IGZyb20gdGhlIGRhdGEgc3RvcmUgaW50byB0aGUgaW5zdGFuY2UuCiAg\nICAgKiBSZXR1cm4gdHJ1ZSBpZiBhbnkgZGF0YSBpcyBsb2FkZWQsIGZhbHNl\nIG90aGVyd2lzZS4KICAgICAqLwogICAgYm9vbGVhbiBsb2FkRmllbGRzKEJp\ndFNldCBmaWVsZHMsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGxv\nY2tMZXZlbCwKICAgICAgICBPYmplY3Qgc2RhdGEpIHsKICAgICAgICAvLyBj\nYW4ndCBsb2FkIHZlcnNpb24gZmllbGQgZnJvbSBzdG9yZQogICAgICAgIGlm\nIChmaWVsZHMgIT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nIHZmaWVsZCA9IF9tZXRhLmdldFZlcnNpb25GaWVsZCgpOwogICAgICAgICAg\nICBpZiAodmZpZWxkICE9IG51bGwpCiAgICAgICAgICAgICAgICBmaWVsZHMu\nY2xlYXIodmZpZWxkLmdldEluZGV4KCkpOwogICAgICAgIH0KCiAgICAgICAg\nYm9vbGVhbiByZXQgPSBmYWxzZTsKICAgICAgICBzZXRMb2FkaW5nKHRydWUp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIGFueSBmaWVsZHMg\nZ2l2ZW4sIGxvYWQgdGhlbQogICAgICAgICAgICBpbnQgbGVuID0gKGZpZWxk\ncyA9PSBudWxsKSA/IDAgOiBmaWVsZHMubGVuZ3RoKCk7CiAgICAgICAgICAg\nIGlmIChsZW4gPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAoZmV0Y2ggPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBmZXRjaCA9IF9icm9rZXIuZ2V0\nRmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoIV9i\ncm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkubG9hZCh0aGlzLCBmaWVsZHMsIGZl\ndGNoLAogICAgICAgICAgICAgICAgICAgIGxvY2tMZXZlbCwgc2RhdGEpKSB7\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVjdE5vdEZvdW5k\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJkZWwtaW5zdGFuY2UiLAogICAgICAgICAg\nICAgICAgICAgICAgICBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCksIF9vaWQp\nKS4KICAgICAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KGdl\ndE1hbmFnZWRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIHJldCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIG1ha2Ugc3VyZSB2ZXJzaW9uIGluZm9ybWF0aW9uIGhhcyBiZWVu\nIHNldDsgdmVyc2lvbiBpbmZvIG11c3QKICAgICAgICAgICAgLy8gYWx3YXlz\nIGJlIHNldCBhZnRlciB0aGUgZmlyc3Qgc3RhdGUgbG9hZCBvciBzZXQgKHdo\naWNoIGlzIHdoeQogICAgICAgICAgICAvLyB3ZSBkbyB0aGlzIGV2ZW4gaWYg\nbm8gZmllbGRzIHdlcmUgbG9hZGVkIC0tIGNvdWxkIGJlIHRoYXQgdGhpcwog\nICAgICAgICAgICAvLyBtZXRob2QgaXMgYmVpbmcgY2FsbGVkIGFmdGVyIGEg\nZmllbGQgaXMgc2V0KS4uLiBzb21lIGluc3RhbmNlcwogICAgICAgICAgICAv\nLyBtaWdodCBub3QgaGF2ZSB2ZXJzaW9uIGluZm8sIGluIHdoaWNoIGNhc2Ug\ndGhpcyBnZXRzIGNhbGxlZAogICAgICAgICAgICAvLyBtdXRpcGxlIHRpbWVz\nOyB0aGF0IHNob3VsZCBiZSBvayB0b28KICAgICAgICAgICAgaWYgKF9sb2Fk\nVmVyc2lvbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBzeW5jVmVyc2lv\nbihzZGF0YSk7CiAgICAgICAgICAgICAgICByZXQgPSByZXQgfHwgX2xvYWRW\nZXJzaW9uICE9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgZmluYWxseSB7CiAgICAgICAgICAgIHNldExvYWRpbmcoZmFsc2UpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gc2VlIGlmIHRoZSBkZmcgaXMgbm93IGxv\nYWRlZDsgZG8gdGhpcyByZWdhcmRsZXNzIG9mIHdoZXRoZXIgd2UKICAgICAg\nICAvLyBsb2FkZWQgYW55IGZpZWxkcywgY2F1c2UgbWF5IGFscmVhZHkgaGF2\nZSBiZWVuIGxvYWRlZCBieQogICAgICAgIC8vIFN0b3JlTWFuYWdlciBkdXJp\nbmcgaW5pdGlhbGl6YXRpb24KICAgICAgICBwb3N0TG9hZCgtMSwgZmV0Y2gp\nOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBM\nb2FkIHRoZSBnaXZlbiBmaWVsZCdzIGZldGNoIGdyb3VwOyB0aGUgZmllbGQg\naXRzZWxmIG1heSBhbHJlYWR5IGJlCiAgICAgKiBsb2FkZWQgaWYgaXQgaXMg\nYmVpbmcgc2V0IGJ5IHRoZSB1c2VyLgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCBsb2FkRmllbGQoaW50IGZpZWxkLCBpbnQgbG9ja0xldmVsLCBib29s\nZWFuIGZvcldyaXRlLAogICAgICAgIGJvb2xlYW4gZmdzKSB7CiAgICAgICAg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoID0gX2Jyb2tlci5nZXRGZXRjaENv\nbmZpZ3VyYXRpb24oKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9t\nZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBCaXRTZXQgZmllbGRzID0g\nbnVsbDsKCiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGRmZyBmaWVsZCBvciB3\nZSBuZWVkIHRvIGxvYWQgb3VyIGRmZywgZG8gc28KICAgICAgICBpZiAoZmdz\nICYmIChfZmxhZ3MgJiBGTEFHX0xPQURFRCkgPT0gMCkKICAgICAgICAgICAg\nZmllbGRzID0gZ2V0VW5sb2FkZWRJbnRlcm5hbChmZXRjaCwgTE9BRF9GR1Ms\nIG51bGwpOwogICAgICAgIAogICAgICAgIC8vIGNoZWNrIGZvciBsb2FkIGZl\ndGNoIGdyb3VwCiAgICAgICAgU3RyaW5nIGxmZyA9IGZtZC5nZXRMb2FkRmV0\nY2hHcm91cCgpOwogICAgICAgIGJvb2xlYW4gbGZnQWRkZWQgPSBmYWxzZTsK\nICAgICAgICBpZiAobGZnICE9IG51bGwpIHsgIAogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoaSkgJiYgKGkgPT0g\nZmllbGQKICAgICAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmlzSW5GZXRj\naEdyb3VwKGxmZykpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxk\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBu\nZXcgQml0U2V0KGZtZHMubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICBm\naWVsZHMuc2V0KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyByZWxhdGlvbiBmaWVsZCBpcyBsb2FkZWQgd2l0\naCB0aGUgbG9hZC1mZXRjaC1ncm91cAogICAgICAgICAgICAvLyBidXQgdGhp\ncyBhZGRpdGlvbiBtdXN0IGJlIHJldmVydGVkIG9uY2UgdGhlIGxvYWQgaXMg\nb3ZlcgogICAgICAgICAgICBpZiAoIWZldGNoLmhhc0ZldGNoR3JvdXAobGZn\nKSkgewogICAgICAgICAgICAgICAgZmV0Y2guYWRkRmV0Y2hHcm91cChsZmcp\nOwogICAgICAgICAgICAgICAgbGZnQWRkZWQgPSB0cnVlOwogICAgICAgICAg\nICB9CiAgICAgICAgfSBlbHNlIGlmIChmbWQuaXNJbkRlZmF1bHRGZXRjaEdy\nb3VwKCkgJiYgZmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgLy8gbm8g\nbG9hZCBncm91cCBidXQgZGZnOiBhZGQgZGZnIGZpZWxkcyBpZiB3ZSBoYXZl\nbid0IGFscmVhZHkKICAgICAgICAgICAgZmllbGRzID0gZ2V0VW5sb2FkZWRJ\nbnRlcm5hbChmZXRjaCwgTE9BRF9GR1MsIG51bGwpOwogICAgICAgIH0gZWxz\nZSBpZiAoIV9sb2FkZWQuZ2V0KGZtZC5nZXRJbmRleCgpKSkgewogICAgICAg\nICAgICAvLyBubyBsb2FkIGdyb3VwIG9yIGRmZzogbG9hZCBpbmRpdmlkdWFs\nIGZpZWxkCiAgICAgICAgICAgIGlmIChmaWVsZHMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGZpZWxkcyA9IG5ldyBCaXRTZXQoKTsKICAgICAgICAgICAg\nZmllbGRzLnNldChmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBjYWxsIHRoaXMgbWV0aG9kIGV2ZW4gaWYgdGhlcmUgYXJlIG5vIHVu\nbG9hZGVkIGZpZWxkczsgbG9hZEZpZWxkcwogICAgICAgIC8vIHRha2VzIGNh\ncmUgb2YgdGhpbmdzIGxpa2UgbG9hZGluZyB2ZXJzaW9uIGluZm8gYW5kIHNl\ndHRpbmcgUEMgZmxhZ3MKICAgICAgICB0cnkgewogICAgICAgICAgICBsb2Fk\nRmllbGRzKGZpZWxkcywgZmV0Y2gsIGxvY2tMZXZlbCwgbnVsbCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGxmZ0FkZGVkKQogICAg\nICAgICAgICAgICAgZmV0Y2gucmVtb3ZlRmV0Y2hHcm91cChsZmcpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8g\ncHJvdmlkZSB0aGUgZ2l2ZW4gZmllbGQgbnVtYmVyIHRvIHRoZSBnaXZlbgog\nICAgICogZmllbGQgbWFuYWdlci4KICAgICAqLwogICAgdm9pZCBwcm92aWRl\nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBGaWVsZE1hbmFnZXIgc3Rv\ncmUsIGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWFuYWdlciBiZWZvcmVG\nTSA9IF9mbTsKICAgICAgICBfZm0gPSBzdG9yZTsKICAgICAgICBwYy5wY1By\nb3ZpZGVGaWVsZChmaWVsZCk7CiAgICAgICAgLy8gUmV0YWluaW5nIG9yaWdp\nbmFsIEZNIGJlY2F1c2Ugb2YgdGhlIHBvc3NpYmlsaXR5IG9mIHJlZW50cmFu\ndCBjYWxscwogICAgICAgIF9mbSA9IGJlZm9yZUZNOwogICAgfQoKICAgIC8q\nKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXBsYWNlIHRoZSBnaXZlbiBm\naWVsZCBudW1iZXIgdG8gdGhlIGdpdmVuCiAgICAgKiBmaWVsZCBtYW5hZ2Vy\nLgogICAgICovCiAgICB2b2lkIHJlcGxhY2VGaWVsZChQZXJzaXN0ZW5jZUNh\ncGFibGUgcGMsIEZpZWxkTWFuYWdlciBsb2FkLCBpbnQgZmllbGQpIHsKICAg\nICAgICBGaWVsZE1hbmFnZXIgYmVmb3JlRk0gPSBfZm07CiAgICAgICAgX2Zt\nID0gbG9hZDsKICAgICAgICBwYy5wY1JlcGxhY2VGaWVsZChmaWVsZCk7CiAg\nICAgICAgLy8gUmV0YWluaW5nIG9yaWdpbmFsIEZNIGJlY2F1c2Ugb2YgdGhl\nIHBvc3NpYmlsaXR5IG9mIHJlZW50cmFudCBjYWxscwogICAgICAgIF9mbSA9\nIGJlZm9yZUZNOwogICAgfQoKICAgIC8qKgogICAgICogTWFyayB0aGUgZmll\nbGQgYXMgbG9hZGVkIG9yIHVubG9hZGVkLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgc2V0TG9hZGVkKGludCBmaWVsZCwgYm9vbGVhbiBpc0xvYWRlZCkg\newogICAgICAgIC8vIGRvbid0IGNvbnRpbnVlIGlmIGxvYWRlZCBzdGF0ZSBp\ncyBhbHJlYWR5IGNvcnJlY3Q7IG90aGVyd2lzZSB3ZQogICAgICAgIC8vIGNh\nbiBlbmQgdXAgY2xlYXJpbmcgX2ZpZWxkSW1wbCB3aGVuIHdlIHNob3VsZG4n\ndAogICAgICAgIGlmIChfbG9hZGVkLmdldChmaWVsZCkgPT0gaXNMb2FkZWQp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYgbG9hZGluZywg\nY2xlYXIgaW50ZXJtZWRpYXRlIGRhdGE7IGlmIHVubG9hZGluZywgY2xlYXIg\naW1wbCBkYXRhCiAgICAgICAgaWYgKF9maWVsZEltcGwgIT0gbnVsbCkgewog\nICAgICAgICAgICBpbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJ\nbmRleChmaWVsZCk7CiAgICAgICAgICAgIGlmIChpZHggIT0gLTEpCiAgICAg\nICAgICAgICAgICBfZmllbGRJbXBsW2lkeF0gPSBudWxsOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKGlzTG9hZGVkKQogICAgICAgICAgICBfbG9hZGVkLnNl\ndChmaWVsZCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfbG9hZGVkLmNs\nZWFyKGZpZWxkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gcG9z\ndC1sb2FkIHN0ZXBzLCBpbmNsdWRpbmcgdGhlIHBvc3QgbG9hZCBjYWxsYmFj\nay4KICAgICAqIFdlIGhhdmUgdG8gY2hlY2sgdGhlIGRmZyBhZnRlciBhbGwg\nZmllbGQgbG9hZHMgYmVjYXVzZSBpdCBtaWdodCBiZQogICAgICogbG9hZGVk\nIGluIG11bHRpcGxlIHN0ZXBzIHdoZW4gcGFnaW5nIGlzIGludm9sdmVkOyB0\naGUgaW5pdGlhbCBsb2FkCiAgICAgKiBtaWdodCBleGNsdWRlIHNvbWUgZmll\nbGRzIHdoaWNoIGFyZSB0aGVuIGltbWVkaWF0ZWx5IGxvYWRlZCBpbiBhCiAg\nICAgKiBzZXBhcmF0ZSBzdGVwIGJlZm9yZSBiZWluZyByZXR1cm5lZCB0byB0\naGUgdXNlci4KICAgICAqCiAgICAgKiBAcGFyYW0gZmllbGQgdGhlIGZpZWxk\nIGluZGV4IHRoYXQgd2FzIGxvYWRlZCwgb3IgLTEgdG8gaW5kaWNhdGUKICAg\nICAqIHRoYXQgYSBncm91cCBvZiBwb3NzaWJseSB1bmtub3duIGZpZWxkcyB3\nYXMgbG9hZGVkCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwb3N0TG9hZChp\nbnQgZmllbGQsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIC8vIG5vIG5lZWQgZm9yIHBvc3RMb2FkIGNhbGxiYWNrPwogICAgICAgIGlm\nICgoX2ZsYWdzICYgRkxBR19MT0FERUQpICE9IDApCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgLy8gaW4gdGhlIG1pZGRsZSBvZiBhIGdyb3VwIGxv\nYWQsIGFmdGVyIHdoaWNoIHRoaXMgbWV0aG9kIHdpbGwgYmUKICAgICAgICAv\nLyBjYWxsZWQgYWdhaW4/CiAgICAgICAgaWYgKGZpZWxkICE9IC0xICYmIGlz\nTG9hZGluZygpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIG5v\nIGxpc3RlbmVycz8KICAgICAgICBMaWZlY3ljbGVFdmVudE1hbmFnZXIgbWdy\nID0gX2Jyb2tlci5nZXRMaWZlY3ljbGVFdmVudE1hbmFnZXIoKTsKICAgICAg\nICBpZiAobWdyID09IG51bGwgfHwgIW1nci5oYXNMb2FkTGlzdGVuZXJzKGdl\ndE1hbmFnZWRJbnN0YW5jZSgpLCBfbWV0YSkpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZl\ndGNoID0gX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAg\nICAvLyBpcyB0aGlzIGZpZWxkIGEgcG9zdC1sb2FkIGZpZWxkPwogICAgICAg\nIGlmIChmaWVsZCAhPSAtMSkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgaWYg\nKGZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAKICAgICAgICAgICAgICAg\nICYmIGZldGNoLmhhc0ZldGNoR3JvdXAoRmV0Y2hHcm91cC5OQU1FX0RFRkFV\nTFQpCiAgICAgICAgICAgICAgICAmJiBwb3N0TG9hZChGZXRjaEdyb3VwLk5B\nTUVfREVGQVVMVCwgZmV0Y2gpKQogICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICBTdHJpbmdbXSBmZ3MgPSBmbWQuZ2V0Q3VzdG9tRmV0Y2hH\ncm91cHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmZ3Mu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoZmV0Y2guaGFzRmV0\nY2hHcm91cChmZ3NbaV0pICYmIHBvc3RMb2FkKGZnc1tpXSwgZmV0Y2gpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGZldGNoLmdldEZldGNo\nR3JvdXBzKCkuaXRlcmF0b3IoKTsgCiAgICAgICAgICAgICAgICBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgaWYgKHBvc3RMb2FkKChTdHJp\nbmcpIGl0ci5uZXh0KCksIGZldGNoKSkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQZXJmb3JtIHBvc3QtbG9hZCBhY3Rpb25zIGlmIHRoZSBnaXZl\nbiBmZXRjaCBncm91cCBpcyBhIHBvc3QtbG9hZCBncm91cAogICAgICogYW5k\nIGlzIGZ1bGx5IGxvYWRlZC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIHBvc3RMb2FkKFN0cmluZyBmZ05hbWUsIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkgewogICAgICAgIEZldGNoR3JvdXAgZmcgPSBfbWV0YS5nZXRGZXRj\naEdyb3VwKGZnTmFtZSk7CiAgICAgICAgaWYgKGZnID09IG51bGwgfHwgIWZn\nLmlzUG9zdExvYWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChpKSAmJiBmbWRzW2ld\nLmlzSW5GZXRjaEdyb3VwKGZnTmFtZSkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CgogICAgICAgIF9mbGFncyB8PSBGTEFHX0xPQURFRDsKICAg\nICAgICBfYnJva2VyLmZpcmVMaWZlY3ljbGVFdmVudChnZXRNYW5hZ2VkSW5z\ndGFuY2UoKSwgZmV0Y2gsIF9tZXRhLCAKICAgICAgICAJTGlmZWN5Y2xlRXZl\nbnQuQUZURVJfTE9BRCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTeW5jaHJvbml6ZSBvdXIgdmVyc2lvbiBvYmplY3Qg\nd2l0aCB0aGUgZGF0YXN0b3JlLgogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gc3luY1ZlcnNpb24oT2JqZWN0IHNkYXRhKSB7CiAgICAgICAgcmV0dXJu\nIF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuc3luY1ZlcnNpb24odGhpcywg\nc2RhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB3aGV0aGVy\nIHRoaXMgaW5zdGFuY2UgbmVlZHMgYSB2ZXJzaW9uIGNoZWNrLgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc1ZlcnNpb25DaGVja1JlcXVpcmVkKCkg\newogICAgICAgIC8vIGV4cGxpY2l0IGZsYWcgZm9yIHZlcnNpb24gY2hlY2sK\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfVkVSU0lPTl9DSEVDSykgIT0g\nMCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIGlmICghX2Jy\nb2tlci5nZXRPcHRpbWlzdGljKCkgJiYgIV9icm9rZXIuZ2V0Q29uZmlndXJh\ndGlvbigpLgogICAgICAgICAgICBnZXRDb21wYXRpYmlsaXR5SW5zdGFuY2Uo\nKS5nZXROb25PcHRpbWlzdGljVmVyc2lvbkNoZWNrKCkpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzVmVyc2lv\nbkNoZWNrUmVxdWlyZWQodGhpcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgd2hldGhlciB0aGlzIGluc3RhbmNlIHJlcXVpcmVzIGEgdmVyc2lvbiBj\naGVjayBvbiB0aGUgbmV4dCBmbHVzaC4KICAgICAqLwogICAgdm9pZCBzZXRD\naGVja1ZlcnNpb24oYm9vbGVhbiB2ZXJzaW9uQ2hlY2spIHsKICAgICAgICBp\nZiAodmVyc2lvbkNoZWNrKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19W\nRVJTSU9OX0NIRUNLOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX1ZFUlNJT05fQ0hFQ0s7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBpbnN0YW5jZSBuZWVkcyBhIHZlcnNp\nb24gdXBkYXRlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1ZlcnNp\nb25VcGRhdGVSZXF1aXJlZCgpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAm\nIEZMQUdfVkVSU0lPTl9VUERBVEUpID4gMDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB3aGV0aGVyIHRoaXMgaW5zdGFuY2UgcmVxdWlyZXMgYSB2ZXJz\naW9uIHVwZGF0ZSBvbiB0aGUgbmV4dCBmbHVzaC4KICAgICAqLwogICAgdm9p\nZCBzZXRVcGRhdGVWZXJzaW9uKGJvb2xlYW4gdmVyc2lvblVwZGF0ZSkgewog\nICAgICAgIGlmICh2ZXJzaW9uVXBkYXRlKQogICAgICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19WRVJTSU9OX1VQREFURTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIF9mbGFncyAmPSB+RkxBR19WRVJTSU9OX1VQREFURTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRyYW5zbGF0ZSB0aGUgZ2l2ZW4gZXhjZXB0aW9uIGJh\nc2VkIG9uIHRoZSBicm9rZXIncyBpbXBsaWNpdCBiZWhhdmlvci4KICAgICAq\nIFRyYW5zbGF0aW9uIG9ubHkgb2NjdXJzIGlmIHRoZSBleGNlcHRpb24gaXMg\naW5pdGlhdGVkIGJ5IGEgdXNlciBhY3Rpb24KICAgICAqIG9uIGFuIGluc3Rh\nbmNlLCBhbmQgdGhlcmVmb3JlIHdpbGwgbm90IGJlIGNhdWdodCBhbmQgdHJh\nbnNsYXRlZCBieSB0aGUKICAgICAqIGJyb2tlci4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFJ1bnRpbWVFeGNlcHRpb24gdHJhbnNsYXRlKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICBSdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRv\nciB0cmFucyA9IF9icm9rZXIuCiAgICAgICAgICAgIGdldEluc3RhbmNlRXhj\nZXB0aW9uVHJhbnNsYXRvcigpOwogICAgICAgIHJldHVybiAodHJhbnMgPT0g\nbnVsbCkgPyByZSA6IHRyYW5zLnRyYW5zbGF0ZShyZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBMb2NrIHRoZSBzdGF0ZSBtYW5hZ2VyIGlmIHRoZSBtdWx0\naXRocmVhZGVkIG9wdGlvbiBpcyBzZXQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIGxvY2soKSB7CiAgICAgICAgLy8gdXNlIGJyb2tlci1sZXZlbCBs\nb2NrIHRvIGF2b2lkIGRlYWRsb2NrIHNpdHVhdGlvbnMgd2l0aCB0aGUgc3Rh\ndGUKICAgICAgICAvLyBtYW5hZ2VyIGxvY2sgYW5kIGJyb2tlciBsb2NrIGJl\naW5nIG9idGFpbmVkIGluIGRpZmZlcmVudCBvcmRlcnMKICAgICAgICBfYnJv\na2VyLmxvY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVubG9jayB0aGUg\nc3RhdGUgbWFuYWdlci4KICAgICAqLwoJcHJvdGVjdGVkIHZvaWQgdW5sb2Nr\nICgpCgl7CgkJLy8gdXNlIGJyb2tlci1sZXZlbCBsb2NrIHRvIGF2b2lkIGRl\nYWRsb2NrIHNpdHVhdGlvbnMgd2l0aCB0aGUgc3RhdGUgCgkJLy8gbWFuYWdl\nciBsb2NrIGFuZCBicm9rZXIgbG9jayBiZWluZyBvYnRhaW5lZCBpbiBkaWZm\nZXJlbnQgb3JkZXJzCgkJX2Jyb2tlci51bmxvY2sgKCk7Cgl9CgogICAgcHJp\ndmF0ZSB2b2lkIHdyaXRlT2JqZWN0KE9iamVjdE91dHB1dFN0cmVhbSBvb3Mp\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgb29zLndyaXRlT2JqZWN0\nKF9icm9rZXIpOwogICAgICAgIG9vcy5kZWZhdWx0V3JpdGVPYmplY3QoKTsK\nICAgICAgICBvb3Mud3JpdGVPYmplY3QoX21ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpKTsKICAgICAgICB3cml0ZVBDKG9vcywgX3BjKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdyaXRlIDxjb2RlPnBjPC9jb2RlPiB0byA8Y29kZT5vb3M8\nL2NvZGU+LCBoYW5kbGluZyBpbnRlcm5hbC1mb3JtCiAgICAgKiBzZXJpYWxp\nemF0aW9uLiA8Y29kZT5wYzwvY29kZT4gbXVzdCBiZSBvZiB0aGUgc2FtZSB0\neXBlIHRoYXQgdGhpcwogICAgICogc3RhdGUgbWFuYWdlciBtYW5hZ2VzLgog\nICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAgICB2b2lkIHdy\naXRlUEMoT2JqZWN0T3V0cHV0U3RyZWFtIG9vcywgUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKCFTZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShfbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAgICB0aHJvdyBuZXcg\nTm90U2VyaWFsaXphYmxlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgX21l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSk7CgogICAgICAgIG9v\ncy53cml0ZU9iamVjdChwYyk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHJl\nYWRPYmplY3QoT2JqZWN0SW5wdXRTdHJlYW0gaW4pCiAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5kRXhjZXB0aW9uIHsKICAgICAg\nICBfYnJva2VyID0gKEJyb2tlckltcGwpIGluLnJlYWRPYmplY3QoKTsKICAg\nICAgICBpbi5kZWZhdWx0UmVhZE9iamVjdCgpOwoKICAgICAgICAvLyB3ZSBu\nZWVkIHRvIHN0b3JlIHRoZSBjbGFzcyBiZWZvcmUgdGhlIHBjIGluc3RhbmNl\nIHNvIHRoYXQgd2UgY2FuCiAgICAgICAgLy8gY3JlYXRlIF9tZXRhIGJlZm9y\nZSBjYWxsaW5nIHJlYWRQQygpLCB3aGljaCByZWxpZXMgb24gX21ldGEgYmVp\nbmcKICAgICAgICAvLyBub24tbnVsbCB3aGVuIHJlY29uc3RpdHV0aW5nIFJl\nZmxlY3RpbmdQQyBpbnN0YW5jZXMuIFNhZGx5LCB0aGlzCiAgICAgICAgLy8g\ncGVuYWxpemVzIHRoZSBzZXJpYWxpemF0aW9uIGZvb3RwcmludCBvZiBub24t\nUmVmbGVjdGluZ1BDIFNNcyBhbHNvLgogICAgICAgIENsYXNzIG1hbmFnZWRU\neXBlID0gKENsYXNzKSBpbi5yZWFkT2JqZWN0KCk7CiAgICAgICAgX21ldGEg\nPSBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRNZXRhRGF0YVJlcG9z\naXRvcnlJbnN0YW5jZSgpCiAgICAgICAgICAgIC5nZXRNZXRhRGF0YShtYW5h\nZ2VkVHlwZSwgbnVsbCwgdHJ1ZSk7CgogICAgICAgIF9wYyA9IHJlYWRQQyhp\nbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0aGUgZGVzZXJp\nYWxpemVkIDxjb2RlPm88L2NvZGU+IHRvIGEge0BsaW5rIFBlcnNpc3RlbmNl\nQ2FwYWJsZX0KICAgICAqIGluc3RhbmNlIGFwcHJvcHJpYXRlIGZvciBzdG9y\naW5nIGluIDxjb2RlPl9wYzwvY29kZT4uCiAgICAgKgogICAgICogQHNpbmNl\nIDEuMS4wCiAgICAgKi8KICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSByZWFkUEMo\nT2JqZWN0SW5wdXRTdHJlYW0gaW4pCiAgICAgICAgdGhyb3dzIENsYXNzTm90\nRm91bmRFeGNlcHRpb24sIElPRXhjZXB0aW9uIHsKICAgICAgICBPYmplY3Qg\nbyA9IGluLnJlYWRPYmplY3QoKTsKCiAgICAgICAgaWYgKG8gPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYzsKICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgUGVyc2lz\ndGVuY2VDYXBhYmxlKSkKICAgICAgICAgICAgcGMgPSBJbXBsSGVscGVyLnRv\nUGVyc2lzdGVuY2VDYXBhYmxlKG8sIHRoaXMpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxlKSBvOwoKICAgICAg\nICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIodGhpcyk7CiAgICAgICAgcmV0\ndXJuIHBjOwogICAgfQp9Cg==\n","encoding":"base64"}

