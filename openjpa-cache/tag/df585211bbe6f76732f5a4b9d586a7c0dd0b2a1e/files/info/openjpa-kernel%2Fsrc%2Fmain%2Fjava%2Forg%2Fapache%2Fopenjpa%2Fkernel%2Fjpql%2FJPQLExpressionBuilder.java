{"sha":"1bf5af3824a9c71b765c664b3952dd00dddd5ec5","node_id":"MDQ6QmxvYjIwNjM2NDoxYmY1YWYzODI0YTljNzFiNzY1YzY2NGIzOTUyZGQwMGRkZGQ1ZWM1","size":62700,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1bf5af3824a9c71b765c664b3952dd00dddd5ec5","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmpwcWw7CgppbXBv\ncnQgamF2YS5pby5QcmludFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uU2VyaWFs\naXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmllbGQ7CmltcG9y\ndCBqYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRIYXNoU2V0\nOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5TdGFj\nazsKaW1wb3J0IGphdmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5hcGFj\naGUuY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5FeHByZXNzaW9uU3RvcmVRdWVy\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlDb250\nZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeU9w\nZXJhdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0\nb3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nQnJva2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuZXhwcy5BYnN0cmFjdEV4cHJlc3Npb25CdWlsZGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuRXhwcmVzc2lvbkZh\nY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMu\nTGl0ZXJhbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5QYXJhbWV0ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLmV4cHMuUGF0aDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nZXhwcy5RdWVyeUV4cHJlc3Npb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5leHBzLlN1YnF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5leHBzLlZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5jb25mLkNvbXBhdGliaWxpdHk7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsK\naW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIEJ1aWxkZXIgZm9y\nIEpQUUwgZXhwcmVzc2lvbnMuIFRoaXMgY2xhc3MgdGFrZXMgdGhlIHF1ZXJ5\nIHBhcnNlZAogKiBpbiB7QGxpbmsgSlBRTH0gYW5kIGNvbnZlcnRzIGl0IHRv\nIGFuIGV4cHJlc3Npb24gdHJlZSB1c2luZwogKiBhbiB7QGxpbmsgRXhwcmVz\nc2lvbkZhY3Rvcnl9LiBQdWJsaWMgZm9yIHVuaXQgdGVzdGluZyBwdXJwb3Nl\ncy4KICoKICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICogQGF1dGhv\nciBQYXRyaWNrIExpbnNrZXkKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNs\nYXNzIEpQUUxFeHByZXNzaW9uQnVpbGRlcgogICAgZXh0ZW5kcyBBYnN0cmFj\ndEV4cHJlc3Npb25CdWlsZGVyCiAgICBpbXBsZW1lbnRzIEpQUUxUcmVlQ29u\nc3RhbnRzIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgVkFSX1BB\nVEggPSAxOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFZBUl9FUlJP\nUiA9IDI7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9s\nb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChKUFFMRXhwcmVz\nc2lvbkJ1aWxkZXIuY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgU3RhY2sg\nY29udGV4dHMgPSBuZXcgU3RhY2soKTsKICAgIHByaXZhdGUgTGlua2VkTWFw\nIHBhcmFtZXRlclR5cGVzOwogICAgcHJpdmF0ZSBpbnQgYWxpYXNDb3VudCA9\nIDA7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAqCiAgICAg\nKiBAcGFyYW0gZmFjdG9yeSB0aGUgZXhwcmVzc2lvbiBmYWN0b3J5IHRvIHVz\nZQogICAgICogQHBhcmFtIHF1ZXJ5IHVzZWQgdG8gcmVzb2x2ZSB2YXJpYWJs\nZXMsIHBhcmFtZXRlcnMsCiAgICAgKiBhbmQgY2xhc3MgbmFtZXMgdXNlZCBp\nbiB0aGUgcXVlcnkKICAgICAqIEBwYXJhbSBwYXJzZWRRdWVyeSB0aGUgcGFy\nc2VkIHF1ZXJ5CiAgICAgKi8KICAgIHB1YmxpYyBKUFFMRXhwcmVzc2lvbkJ1\naWxkZXIoRXhwcmVzc2lvbkZhY3RvcnkgZmFjdG9yeSwKICAgICAgICBFeHBy\nZXNzaW9uU3RvcmVRdWVyeSBxdWVyeSwgT2JqZWN0IHBhcnNlZFF1ZXJ5KSB7\nCiAgICAgICAgc3VwZXIoZmFjdG9yeSwgcXVlcnkuZ2V0UmVzb2x2ZXIoKSk7\nCgogICAgICAgIGNvbnRleHRzLnB1c2gobmV3IENvbnRleHQocGFyc2VkUXVl\ncnkgaW5zdGFuY2VvZiBQYXJzZWRKUFFMCiAgICAgICAgICAgID8gKFBhcnNl\nZEpQUUwpIHBhcnNlZFF1ZXJ5CiAgICAgICAgICAgIDogcGFyc2VkUXVlcnkg\naW5zdGFuY2VvZiBTdHJpbmcKICAgICAgICAgICAgPyBnZXRQYXJzZWRRdWVy\neSgoU3RyaW5nKSBwYXJzZWRRdWVyeSkKICAgICAgICAgICAgOiBudWxsLCBu\ndWxsKSk7CgogICAgICAgIGlmIChjdHgoKS5wYXJzZWQgPT0gbnVsbCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKHBhcnNlZFF1\nZXJ5ICsgIiIpOwogICAgfQoKICAgIHByb3RlY3RlZCBMb2NhbGl6ZXIgZ2V0\nTG9jYWxpemVyKCkgewogICAgICAgIHJldHVybiBfbG9jOwogICAgfQoKICAg\nIHByb3RlY3RlZCBDbGFzc0xvYWRlciBnZXRDbGFzc0xvYWRlcigpIHsKICAg\nICAgICAvLyB3ZSBkb24ndCByZXNvbHZlIGluIHRoZSBjb250ZXh0IG9mIGFu\neXRoaW5nIGJ1dCBvdXJzZWx2ZXMKICAgICAgICByZXR1cm4gZ2V0Q2xhc3Mo\nKS5nZXRDbGFzc0xvYWRlcigpOwogICAgfQoKICAgIHByb3RlY3RlZCBQYXJz\nZWRKUFFMIGdldFBhcnNlZFF1ZXJ5KCkgewogICAgICAgIHJldHVybiBjdHgo\nKS5wYXJzZWQ7CiAgICB9CgogICAgcHJvdGVjdGVkIFBhcnNlZEpQUUwgZ2V0\nUGFyc2VkUXVlcnkoU3RyaW5nIGpwcWwpIHsKICAgICAgICByZXR1cm4gbmV3\nIFBhcnNlZEpQUUwoanBxbCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHNl\ndENhbmRpZGF0ZShDbGFzc01ldGFEYXRhIGNtZCwgU3RyaW5nIHNjaGVtYUFs\naWFzKSB7CiAgICAgICAgYWRkQWNjZXNzUGF0aChjbWQpOwoKICAgICAgICBp\nZiAoY21kICE9IG51bGwpCiAgICAgICAgICAgIGN0eCgpLm1ldGEgPSBjbWQ7\nCgogICAgICAgIGlmIChzY2hlbWFBbGlhcyAhPSBudWxsKQogICAgICAgICAg\nICBjdHgoKS5zY2hlbWFBbGlhcyA9IHNjaGVtYUFsaWFzOwogICAgfQoKICAg\nIHByaXZhdGUgU3RyaW5nIG5leHRBbGlhcygpIHsKICAgICAgICByZXR1cm4g\nImpwcWxhbGlhcyIgKyAoKythbGlhc0NvdW50KTsKICAgIH0KCiAgICBwcm90\nZWN0ZWQgQ2xhc3NNZXRhRGF0YSByZXNvbHZlQ2xhc3NNZXRhRGF0YShKUFFM\nTm9kZSBub2RlKSB7CiAgICAgICAgLy8gaGFuZGxlIGxvb2tpbmcgdXAgYWxp\nYXMgbmFtZXMKICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSA9IGFzc2VydFNj\naGVtYU5hbWUobm9kZSk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBn\nZXRDbGFzc01ldGFEYXRhKHNjaGVtYU5hbWUsIGZhbHNlKTsKICAgICAgICBp\nZiAoY21kICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBjbWQ7CgogICAg\nICAgIC8vIHdlIG1pZ2h0IGJlIHJlZmVyZW5jaW5nIGEgY29sbGVjdGlvbiBm\naWVsZCBvZiBhIHN1YnF1ZXJ5J3MgcGFyZW50CiAgICAgICAgaWYgKGlzUGF0\naChub2RlKSkgewogICAgICAgICAgICBQYXRoIHBhdGggPSBnZXRQYXRoKG5v\nZGUpOwogICAgICAgICAgICByZXR1cm4gZ2V0RmllbGRUeXBlKHBhdGgubGFz\ndCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIG5vdyBydW4gYWdhaW4gdG8g\ndGhyb3cgdGhlIGNvcnJlY3QgZXhjZXB0aW9uCiAgICAgICAgcmV0dXJuIGdl\ndENsYXNzTWV0YURhdGEoc2NoZW1hTmFtZSwgdHJ1ZSk7CiAgICB9CgogICAg\ncHJpdmF0ZSBDbGFzc01ldGFEYXRhIGdldENsYXNzTWV0YURhdGEoU3RyaW5n\nIGFsaWFzLCBib29sZWFuIGFzc2VydFZhbGlkKSB7CiAgICAgICAgQ2xhc3NM\nb2FkZXIgbG9hZGVyID0gZ2V0Q2xhc3NMb2FkZXIoKTsKICAgICAgICBNZXRh\nRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSByZXNvbHZlci5nZXRDb25maWd1cmF0\naW9uKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3Rh\nbmNlKCk7CgogICAgICAgIC8vIGZpcnN0IGNoZWNrIGZvciB0aGUgYWxpYXMK\nICAgICAgICBDbGFzc01ldGFEYXRhIGNtZCA9IHJlcG9zLmdldE1ldGFEYXRh\nKGFsaWFzLCBsb2FkZXIsIGZhbHNlKTsKCiAgICAgICAgaWYgKGNtZCAhPSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gY21kOwoKICAgICAgICAvLyBub3cg\nY2hlY2sgZm9yIHRoZSBjbGFzcyBuYW1lOyB0aGlzIGlzIG5vdCB0ZWNobmlj\nYWxseSBwZXJtaXR0ZWQKICAgICAgICAvLyBieSB0aGUgSlBBIHNwZWMsIGJ1\ndCBpcyByZXF1aXJlZCBpbiBvcmRlciB0byBiZSBhYmxlIHRvIGV4ZWN1dGUK\nICAgICAgICAvLyBKUFFMIHF1ZXJpZXMgZnJvbSBvdGhlciBmYWNhZGVzIChs\naWtlIEpETykgdGhhdCBkbyBub3QgaGF2ZQogICAgICAgIC8vIHRoZSBjb25j\nZXB0IG9mIGVudGl0eSBuYW1lcyBvciBhbGlhc2VzCiAgICAgICAgQ2xhc3Mg\nYyA9IHJlc29sdmVyLmNsYXNzRm9yTmFtZShhbGlhcywgbnVsbCk7CiAgICAg\nICAgaWYgKGMgIT0gbnVsbCkKICAgICAgICAgICAgY21kID0gcmVwb3MuZ2V0\nTWV0YURhdGEoYywgbG9hZGVyLCBhc3NlcnRWYWxpZCk7CiAgICAgICAgZWxz\nZSBpZiAoYXNzZXJ0VmFsaWQpCiAgICAgICAgICAgIGNtZCA9IHJlcG9zLmdl\ndE1ldGFEYXRhKGFsaWFzLCBsb2FkZXIsIGZhbHNlKTsKCiAgICAgICAgaWYg\nKGNtZCA9PSBudWxsICYmIGFzc2VydFZhbGlkKSB7CiAgICAgICAgICAgIFN0\ncmluZyBjbG9zZSA9IHJlcG9zLmdldENsb3Nlc3RBbGlhc05hbWUoYWxpYXMp\nOwogICAgICAgICAgICBpZiAoY2xvc2UgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3Qtc2NoZW1h\nLW5hbWUtaGludCIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtd\neyBhbGlhcywgY2xvc2UsIHJlcG9zLmdldEFsaWFzTmFtZXMoKSB9LCBudWxs\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhyb3cgcGFy\nc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC1zY2hlbWEtbmFtZSIsCiAgICAg\nICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBhbGlhcywgcmVwb3MuZ2V0\nQWxpYXNOYW1lcygpIH0sIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgcmV0\ndXJuIGNtZDsKICAgIH0KCiAgICBwcml2YXRlIENsYXNzIGdldENhbmRpZGF0\nZVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIGdldENhbmRpZGF0ZU1ldGFEYXRh\nKCkuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgfQoKICAgIHByaXZhdGUgQ2xh\nc3NNZXRhRGF0YSBnZXRDYW5kaWRhdGVNZXRhRGF0YSgpIHsKICAgICAgICBp\nZiAoY3R4KCkubWV0YSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gY3R4\nKCkubWV0YTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbHMgPSBnZXRDYW5k\naWRhdGVNZXRhRGF0YShyb290KCkpOwogICAgICAgIGlmIChjbHMgPT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwg\nIm5vdC1zY2hlbWEtbmFtZSIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW117IHJvb3QoKSB9LCBudWxsKTsKCiAgICAgICAgc2V0Q2FuZGlkYXRlKGNs\ncywgbnVsbCk7CiAgICAgICAgcmV0dXJuIGNsczsKICAgIH0KCiAgICBwcm90\nZWN0ZWQgQ2xhc3NNZXRhRGF0YSBnZXRDYW5kaWRhdGVNZXRhRGF0YShKUFFM\nTm9kZSBub2RlKSB7CiAgICAgICAgLy8gZXhhbWluZyB0aGUgbm9kZSB0byBm\naW5kIHRoZSBjYW5kaWRhdGUgcXVlcnkKICAgICAgICAvLyAjIyMgdGhpcyBz\naG91bGQgYWN0dWFsbHkgYmUgdGhlIHByaW1hcnkgU0VMRUNUIGluc3RhbmNl\nCiAgICAgICAgLy8gcmVzb2x2ZWQgYWdhaW5zdCB0aGUgZnJvbSB2YXJpYWJs\nZSBkZWNsYXJhdGlvbnMKICAgICAgICBKUFFMTm9kZSBmcm9tID0gbm9kZS5m\naW5kQ2hpbGRCeUlEKEpKVEZST01JVEVNLCB0cnVlKTsKICAgICAgICBpZiAo\nZnJvbSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIE9QRU5KUEEtMTUgYWxs\nb3cgc3VicXVlcnkgd2l0aG91dCBhIEZST01JVEVNCiAgICAgICAgICAgIGlm\nIChub2RlLmlkID09IEpKVFNVQlNFTEVDVCkgeyAKICAgICAgICAgICAgICAg\nIGZyb20gPSBub2RlLmZpbmRDaGlsZEJ5SUQoSkpURlJPTSwgdHJ1ZSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAg\nICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm8tZnJvbS1jbGF1\nc2UiLCBudWxsLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmcm9tLmNoaWxkcmVuLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIEpQUUxOb2RlIG4gPSBmcm9tLmNoaWxk\ncmVuW2ldOwoKICAgICAgICAgICAgaWYgKG4uaWQgPT0gSkpUQUJTVFJBQ1RT\nQ0hFTUFOQU1FKSB7CiAgICAgICAgICAgICAgICAvLyB3ZSBzaW1wbHkgcmV0\ndXJuIHRoZSBmaXJzdCBhYnN0cmFjdCBzY2hlbWEgY2hpbGQKICAgICAgICAg\nICAgICAgIC8vIGFzIHJlc29sdmVkIGludG8gYSBjbGFzcwogICAgICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSByZXNvbHZlQ2xhc3NNZXRhRGF0\nYShuKTsKCiAgICAgICAgICAgICAgICBpZiAoY21kICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGNtZDsKCiAgICAgICAgICAgICAgICAv\nLyBub3QgYSBzY2hlbWE6IHRyZWF0IGl0IGFzIGEgY2xhc3MKICAgICAgICAg\nICAgICAgIFN0cmluZyBjbHMgPSBhc3NlcnRTY2hlbWFOYW1lKG4pOwogICAg\nICAgICAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3Qtc2NoZW1h\nLW5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117\nIHJvb3QoKSB9LCBudWxsKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0\nQ2xhc3NNZXRhRGF0YShjbHMsIHRydWUpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIC8vIE9QRU5KUEEtMTUgc3VwcG9ydCBzdWJxdWVyeSdzIGZyb20g\nY2xhdXNlIGRvIG5vdCBzdGFydCB3aXRoIAogICAgICAgICAgICAvLyBpZGVu\ndGlmaWNhdGlvbl92YXJpYWJsZV9kZWNsYXJhdGlvbigpCiAgICAgICAgICAg\nIGlmIChub2RlLmlkID09IEpKVFNVQlNFTEVDVCkgewogICAgICAgICAgICAg\nICAgaWYgKG4uaWQgPT0gSkpUSU5ORVJKT0lOKSB7CiAgICAgICAgICAgICAg\nICAgICAgbiA9IG4uZ2V0Q2hpbGQoMCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBpZiAobi5pZCA9PSBKSlRQQVRIKSB7CiAgICAgICAg\nICAgICAgICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0aChuKTsKICAgICAgICAg\nICAgICAgICAgICBDbGFzc01ldGFEYXRhIGNtZCA9IGdldEZpZWxkVHlwZShw\nYXRoLmxhc3QoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNtZCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbWQ7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2Ug\newogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlv\nbihFWF9VU0VSLCAibm8tYWxpYXMiLCAKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBuZXcgT2JqZWN0W117IG4gfSwgbnVsbCk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nICAgICAgICAgICAKICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIHByb3RlY3RlZCBTdHJpbmcgY3VycmVudFF1ZXJ5KCkgewog\nICAgICAgIHJldHVybiBjdHgoKS5wYXJzZWQgPT0gbnVsbCB8fCByb290KCku\ncGFyc2VyID09IG51bGwgPyBudWxsCiAgICAgICAgICAgIDogcm9vdCgpLnBh\ncnNlci5qcHFsOwogICAgfQoKICAgIFF1ZXJ5RXhwcmVzc2lvbnMgZ2V0UXVl\ncnlFeHByZXNzaW9ucygpIHsKICAgICAgICBRdWVyeUV4cHJlc3Npb25zIGV4\ncHMgPSBuZXcgUXVlcnlFeHByZXNzaW9ucygpOwoKICAgICAgICBldmFsUXVl\ncnlPcGVyYXRpb24oZXhwcyk7CgogICAgICAgIEV4cHJlc3Npb24gZmlsdGVy\nID0gbnVsbDsKICAgICAgICBmaWx0ZXIgPSBhbmQoZXZhbEZyb21DbGF1c2Uo\ncm9vdCgpLmlkID09IEpKVFNFTEVDVCksIGZpbHRlcik7CiAgICAgICAgZmls\ndGVyID0gYW5kKGV2YWxXaGVyZUNsYXVzZSgpLCBmaWx0ZXIpOwogICAgICAg\nIGZpbHRlciA9IGFuZChldmFsU2VsZWN0Q2xhdXNlKGV4cHMpLCBmaWx0ZXIp\nOwoKICAgICAgICBleHBzLmZpbHRlciA9IGZpbHRlciA9PSBudWxsID8gZmFj\ndG9yeS5lbXB0eUV4cHJlc3Npb24oKSA6IGZpbHRlcjsKCiAgICAgICAgZXZh\nbEdyb3VwaW5nQ2xhdXNlKGV4cHMpOwogICAgICAgIGV2YWxIYXZpbmdDbGF1\nc2UoZXhwcyk7CiAgICAgICAgZXZhbEZldGNoSm9pbnMoZXhwcyk7CiAgICAg\nICAgZXZhbFNldENsYXVzZShleHBzKTsKICAgICAgICBldmFsT3JkZXJpbmdD\nbGF1c2VzKGV4cHMpOwoKICAgICAgICBpZiAocGFyYW1ldGVyVHlwZXMgIT0g\nbnVsbCkKICAgICAgICAgICAgZXhwcy5wYXJhbWV0ZXJUeXBlcyA9IHBhcmFt\nZXRlclR5cGVzOwoKICAgICAgICBleHBzLmFjY2Vzc1BhdGggPSBnZXRBY2Nl\nc3NQYXRoKCk7CgogICAgICAgIHJldHVybiBleHBzOwogICAgfQoKICAgIHBy\naXZhdGUgRXhwcmVzc2lvbiBhbmQoRXhwcmVzc2lvbiBlMSwgRXhwcmVzc2lv\nbiBlMikgewogICAgICAgIHJldHVybiBlMSA9PSBudWxsID8gZTIgOiBlMiA9\nPSBudWxsID8gZTEgOiBmYWN0b3J5LmFuZChlMSwgZTIpOwogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIFN0cmluZyBhc3NlbWJsZShKUFFMTm9kZSBub2Rl\nKSB7CiAgICAgICAgcmV0dXJuIGFzc2VtYmxlKG5vZGUsICIuIiwgMCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBc3NlbWJsZSB0aGUgY2hpbGRyZW4gb2Yg\ndGhlIHNwZWNpZmljIG5vZGUgYnkgYXBwZW5kaW5nIGVhY2gKICAgICAqIGNo\naWxkLCBzZXBhcmF0ZWQgYnkgdGhlIGRlbGltaXRlci4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGFzc2VtYmxlKEpQUUxOb2RlIG5vZGUs\nIFN0cmluZyBkZWxpbWl0ZXIsIGludCBsYXN0KSB7CiAgICAgICAgU3RyaW5n\nQnVmZmVyIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBK\nUFFMTm9kZVtdIHBhcnRzID0gbm9kZS5jaGlsZHJlbjsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgcGFydHMgIT0gbnVsbCAmJiBpIDwgcGFydHMubGVuZ3Ro\nIC0gbGFzdDsgaSsrKQogICAgICAgICAgICByZXN1bHQuYXBwZW5kKHJlc3Vs\ndC5sZW5ndGgoKSA+IDAgPyBkZWxpbWl0ZXIgOiAiIikuCiAgICAgICAgICAg\nICAgICBhcHBlbmQocGFydHNbaV0udGV4dCk7CgogICAgICAgIHJldHVybiBy\nZXN1bHQudG9TdHJpbmcoKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Np\nb24gYXNzaWduUHJvamVjdGlvbnMoSlBRTE5vZGUgcGFyYW1ldGVyc05vZGUs\nCiAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBleHBzKSB7CiAgICAgICAgaW50\nIGNvdW50ID0gcGFyYW1ldGVyc05vZGUuZ2V0Q2hpbGRDb3VudCgpOwogICAg\nICAgIGV4cHMucHJvamVjdGlvbnMgPSBuZXcgVmFsdWVbY291bnRdOwogICAg\nICAgIGV4cHMucHJvamVjdGlvbkNsYXVzZXMgPSBuZXcgU3RyaW5nW2NvdW50\nXTsKICAgICAgICBleHBzLnByb2plY3Rpb25BbGlhc2VzID0gbmV3IFN0cmlu\nZ1tjb3VudF07CgogICAgICAgIEV4cHJlc3Npb24gZXhwID0gbnVsbDsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAg\nICAgICAgSlBRTE5vZGUgcGFyZW50ID0gcGFyYW1ldGVyc05vZGUuZ2V0Q2hp\nbGQoaSk7CiAgICAgICAgICAgIEpQUUxOb2RlIG5vZGUgPSBvbmx5Q2hpbGQo\ncGFyZW50KTsKICAgICAgICAgICAgVmFsdWUgcHJvaiA9IGdldFZhbHVlKG5v\nZGUpOwogICAgICAgICAgICBleHBzLnByb2plY3Rpb25zW2ldID0gcHJvajsK\nICAgICAgICAgICAgZXhwcy5wcm9qZWN0aW9uQ2xhdXNlc1tpXSA9IGFzc2Vt\nYmxlKG5vZGUpOwogICAgICAgICAgICBleHBzLnByb2plY3Rpb25BbGlhc2Vz\nW2ldID0gbmV4dEFsaWFzKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBl\neHA7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGV2YWxRdWVyeU9wZXJhdGlv\nbihRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICAvLyBkZXRlcm1p\nbmUgd2hldGhlciB3ZSB3YW50IHRvIHNlbGVjdCwgZGVsZXRlLCBvciB1cGRh\ndGUKICAgICAgICBpZiAocm9vdCgpLmlkID09IEpKVFNFTEVDVCB8fCByb290\nKCkuaWQgPT0gSkpUU1VCU0VMRUNUKQogICAgICAgICAgICBleHBzLm9wZXJh\ndGlvbiA9IFF1ZXJ5T3BlcmF0aW9ucy5PUF9TRUxFQ1Q7CiAgICAgICAgZWxz\nZSBpZiAocm9vdCgpLmlkID09IEpKVERFTEVURSkKICAgICAgICAgICAgZXhw\ncy5vcGVyYXRpb24gPSBRdWVyeU9wZXJhdGlvbnMuT1BfREVMRVRFOwogICAg\nICAgIGVsc2UgaWYgKHJvb3QoKS5pZCA9PSBKSlRVUERBVEUpCiAgICAgICAg\nICAgIGV4cHMub3BlcmF0aW9uID0gUXVlcnlPcGVyYXRpb25zLk9QX1VQREFU\nRTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0\naW9uKEVYX1VOU1VQUE9SVEVELCAidW5yZWNvZ25pemVkLW9wZXJhdGlvbiIs\nCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IHJvb3QoKSB9LCBudWxs\nKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZhbEdyb3VwaW5nQ2xhdXNl\nKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykgewogICAgICAgIC8vIGhhbmRsZSBH\nUk9VUCBCWSBjbGF1c2VzCiAgICAgICAgSlBRTE5vZGUgZ3JvdXBCeU5vZGUg\nPSByb290KCkuZmluZENoaWxkQnlJRChKSlRHUk9VUEJZLCBmYWxzZSk7Cgog\nICAgICAgIGlmIChncm91cEJ5Tm9kZSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGludCBncm91cEJ5Q291bnQgPSBncm91cEJ5Tm9k\nZS5nZXRDaGlsZENvdW50KCk7CgogICAgICAgIGV4cHMuZ3JvdXBpbmcgPSBu\nZXcgVmFsdWVbZ3JvdXBCeUNvdW50XTsKCiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBncm91cEJ5Q291bnQ7IGkrKykgewogICAgICAgICAgICBKUFFM\nTm9kZSBub2RlID0gZ3JvdXBCeU5vZGUuZ2V0Q2hpbGQoaSk7CiAgICAgICAg\nICAgIGV4cHMuZ3JvdXBpbmdbaV0gPSBnZXRWYWx1ZShub2RlKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGV2YWxIYXZpbmdDbGF1c2Uo\nUXVlcnlFeHByZXNzaW9ucyBleHBzKSB7CiAgICAgICAgLy8gaGFuZGxlIEhB\nVklORyBjbGF1c2VzCiAgICAgICAgSlBRTE5vZGUgaGF2aW5nTm9kZSA9IHJv\nb3QoKS5maW5kQ2hpbGRCeUlEKEpKVEhBVklORywgZmFsc2UpOwoKICAgICAg\nICBpZiAoaGF2aW5nTm9kZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGV4cHMuaGF2aW5nID0gZ2V0RXhwcmVzc2lvbihvbmx5Q2hp\nbGQoaGF2aW5nTm9kZSkpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBldmFs\nT3JkZXJpbmdDbGF1c2VzKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykgewogICAg\nICAgIC8vIGhhbmRsZSBPUkRFUiBCWSBjbGF1c2VzCiAgICAgICAgSlBRTE5v\nZGUgb3JkZXJieSA9IHJvb3QoKS5maW5kQ2hpbGRCeUlEKEpKVE9SREVSQlks\nIGZhbHNlKTsKICAgICAgICBpZiAob3JkZXJieSAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGludCBvcmRlcmNvdW50ID0gb3JkZXJieS5nZXRDaGlsZENvdW50\nKCk7CiAgICAgICAgICAgIGV4cHMub3JkZXJpbmcgPSBuZXcgVmFsdWVbb3Jk\nZXJjb3VudF07CiAgICAgICAgICAgIGV4cHMub3JkZXJpbmdDbGF1c2VzID0g\nbmV3IFN0cmluZ1tvcmRlcmNvdW50XTsKICAgICAgICAgICAgZXhwcy5hc2Nl\nbmRpbmcgPSBuZXcgYm9vbGVhbltvcmRlcmNvdW50XTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBvcmRlcmNvdW50OyBpKyspIHsKICAgICAg\nICAgICAgICAgIEpQUUxOb2RlIG5vZGUgPSBvcmRlcmJ5LmdldENoaWxkKGkp\nOwogICAgICAgICAgICAgICAgZXhwcy5vcmRlcmluZ1tpXSA9IGdldFZhbHVl\nKGZpcnN0Q2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAgZXhwcy5vcmRl\ncmluZ0NsYXVzZXNbaV0gPSBhc3NlbWJsZShmaXJzdENoaWxkKG5vZGUpKTsK\nICAgICAgICAgICAgICAgIC8vIG9tbWlzc2lvbiBvZiBBU0MvREVTQyB0b2tl\nbiBpbXBsaWVzIGFzY2VuZGluZwogICAgICAgICAgICAgICAgZXhwcy5hc2Nl\nbmRpbmdbaV0gPSBub2RlLmdldENoaWxkQ291bnQoKSA8PSAxIHx8CiAgICAg\nICAgICAgICAgICAgICAgbGFzdENoaWxkKG5vZGUpLmlkID09IEpKVEFTQ0VO\nRElORyA/IHRydWUgOiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZXZhbFNlbGVjdENsYXVz\nZShRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAgICBpZiAoZXhwcy5v\ncGVyYXRpb24gIT0gUXVlcnlPcGVyYXRpb25zLk9QX1NFTEVDVCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEpQUUxOb2RlIHNlbGVjdE5v\nZGUgPSByb290KCk7CgogICAgICAgIEpQUUxOb2RlIHNlbGVjdENsYXVzZSA9\nIHNlbGVjdE5vZGUuCiAgICAgICAgICAgIGZpbmRDaGlsZEJ5SUQoSkpUU0VM\nRUNUQ0xBVVNFLCBmYWxzZSk7CiAgICAgICAgaWYgKHNlbGVjdENsYXVzZSAh\nPSBudWxsICYmIHNlbGVjdENsYXVzZS5oYXNDaGlsZElEKEpKVERJU1RJTkNU\nKSkKICAgICAgICAgICAgZXhwcy5kaXN0aW5jdCA9IGV4cHMuRElTVElOQ1Rf\nVFJVRSB8IGV4cHMuRElTVElOQ1RfQVVUTzsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIGV4cHMuZGlzdGluY3QgPSBleHBzLkRJU1RJTkNUX0ZBTFNFOwoK\nICAgICAgICBKUFFMTm9kZSBjb25zdHJ1Y3RvciA9IHNlbGVjdE5vZGUuZmlu\nZENoaWxkQnlJRChKSlRDT05TVFJVQ1RPUiwgdHJ1ZSk7CiAgICAgICAgaWYg\nKGNvbnN0cnVjdG9yICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gYnVpbGQg\ndXAgdGhlIGZ1bGx5LXF1YWxpZmllZCByZXN1bHQgY2xhc3MgbmFtZSBieQog\nICAgICAgICAgICAvLyBhcHBlbmRpbmcgdG9nZXRoZXIgdGhlIGNvbXBvbmVu\ndHMgb2YgdGhlIGNoaWxkcmVuCiAgICAgICAgICAgIFN0cmluZyByZXN1bHRD\nbGFzc05hbWUgPSBhc3NlbWJsZShsZWZ0KGNvbnN0cnVjdG9yKSk7CiAgICAg\nICAgICAgIGV4cHMucmVzdWx0Q2xhc3MgPSByZXNvbHZlci5jbGFzc0Zvck5h\nbWUocmVzdWx0Q2xhc3NOYW1lLCBudWxsKTsKCiAgICAgICAgICAgIC8vIG5v\ndyBhc3NpZ24gdGhlIGFyZ3VtZW50cyB0byB0aGUgc2VsZWN0IGNsYXVzZSBh\ncyB0aGUgcHJvamVjdGlvbnMKICAgICAgICAgICAgcmV0dXJuIGFzc2lnblBy\nb2plY3Rpb25zKHJpZ2h0KGNvbnN0cnVjdG9yKSwgZXhwcyk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgLy8gaGFuZGxlIFNFTEVDVCBjbGF1c2Vz\nCiAgICAgICAgICAgIEpQUUxOb2RlIGV4cE5vZGUgPSBzZWxlY3ROb2RlLgog\nICAgICAgICAgICAgICAgZmluZENoaWxkQnlJRChKSlRTRUxFQ1RFWFBSRVNT\nSU9OUywgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChleHBOb2RlID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGlu\ndCBzZWxlY3RDb3VudCA9IGV4cE5vZGUuZ2V0Q2hpbGRDb3VudCgpOwogICAg\nICAgICAgICBKUFFMTm9kZSBzZWxlY3RDaGlsZCA9IGZpcnN0Q2hpbGQoZXhw\nTm9kZSk7CgogICAgICAgICAgICAvLyBpZiB3ZSBhcmUgc2VsZWN0aW5nIGp1\nc3Qgb25lIHRoaW5nIGFuZCB0aGF0IHRoaW5nIGlzIHRoZQogICAgICAgICAg\nICAvLyBzY2hlbWEncyBhbGlhcywgdGhlbiBkbyBub3QgdHJlYXQgaXQgYXMg\nYSBwcm9qZWN0aW9uCiAgICAgICAgICAgIGlmIChzZWxlY3RDb3VudCA9PSAx\nICYmIHNlbGVjdENoaWxkICE9IG51bGwgJiYKICAgICAgICAgICAgICAgIHNl\nbGVjdENoaWxkLmdldENoaWxkQ291bnQoKSA9PSAxICYmCiAgICAgICAgICAg\nICAgICBvbmx5Q2hpbGQoc2VsZWN0Q2hpbGQpICE9IG51bGwgJiYKICAgICAg\nICAgICAgICAgIGFzc2VydFNjaGVtYUFsaWFzKCkuCiAgICAgICAgICAgICAg\nICAgICAgZXF1YWxzSWdub3JlQ2FzZShvbmx5Q2hpbGQoc2VsZWN0Q2hpbGQp\nLnRleHQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEpQUUwgZG9lcyBu\nb3QgZmlsdGVyIHJlbGF0aW9uYWwgam9pbnMgZm9yIHByb2plY3Rpb25zCiAg\nICAgICAgICAgICAgICBleHBzLmRpc3RpbmN0ICY9IH5leHBzLkRJU1RJTkNU\nX0FVVE87CiAgICAgICAgICAgICAgICByZXR1cm4gYXNzaWduUHJvamVjdGlv\nbnMoZXhwTm9kZSwgZXhwcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSBTdHJpbmcgYXNzZXJ0U2NoZW1hQWxpYXMoKSB7\nCiAgICAgICAgU3RyaW5nIGFsaWFzID0gY3R4KCkuc2NoZW1hQWxpYXM7Cgog\nICAgICAgIGlmIChhbGlhcyA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBw\nYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAiYWxpYXMtcmVxdWlyZWQiLAogICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBjdHgoKS5tZXRhIH0sIG51bGwp\nOwoKICAgICAgICByZXR1cm4gYWxpYXM7CiAgICB9CgogICAgcHJvdGVjdGVk\nIEV4cHJlc3Npb24gZXZhbEZldGNoSm9pbnMoUXVlcnlFeHByZXNzaW9ucyBl\neHBzKSB7CiAgICAgICAgRXhwcmVzc2lvbiBmaWx0ZXIgPSBudWxsOwoKICAg\nICAgICAvLyBoYW5kbGUgSk9JTiBGRVRDSAogICAgICAgIFNldCBqb2lucyA9\nIG51bGw7CiAgICAgICAgU2V0IGlubmVySm9pbnMgPSBudWxsOwoKICAgICAg\nICBKUFFMTm9kZVtdIG91dGVycyA9IHJvb3QoKS5maW5kQ2hpbGRyZW5CeUlE\nKEpKVE9VVEVSRkVUQ0hKT0lOKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\nb3V0ZXJzICE9IG51bGwgJiYgaSA8IG91dGVycy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgKGpvaW5zID09IG51bGwgPyBqb2lucyA9IG5ldyBUcmVlU2V0\nKCkgOiBqb2lucykuCiAgICAgICAgICAgICAgICBhZGQoZ2V0UGF0aChvbmx5\nQ2hpbGQob3V0ZXJzW2ldKSkubGFzdCgpLmdldEZ1bGxOYW1lKGZhbHNlKSk7\nCgogICAgICAgIEpQUUxOb2RlW10gaW5uZXJzID0gcm9vdCgpLmZpbmRDaGls\nZHJlbkJ5SUQoSkpUSU5ORVJGRVRDSEpPSU4pOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpbm5lcnMgIT0gbnVsbCAmJiBpIDwgaW5uZXJzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIFN0cmluZyBwYXRoID0gZ2V0UGF0aChvbmx5\nQ2hpbGQoaW5uZXJzW2ldKSkubGFzdCgpCiAgICAgICAgICAgICAgICAuZ2V0\nRnVsbE5hbWUoZmFsc2UpOwogICAgICAgICAgICAoam9pbnMgPT0gbnVsbCA/\nIGpvaW5zID0gbmV3IFRyZWVTZXQoKSA6IGpvaW5zKS5hZGQocGF0aCk7CiAg\nICAgICAgICAgIChpbm5lckpvaW5zID09IG51bGwgPyBpbm5lckpvaW5zID0g\nbmV3IFRyZWVTZXQoKSA6IGlubmVySm9pbnMpLgogICAgICAgICAgICAgICAg\nYWRkKHBhdGgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGpvaW5zICE9IG51\nbGwpCiAgICAgICAgICAgIGV4cHMuZmV0Y2hQYXRocyA9IChTdHJpbmdbXSkg\nam9pbnMuCiAgICAgICAgICAgICAgICB0b0FycmF5KG5ldyBTdHJpbmdbam9p\nbnMuc2l6ZSgpXSk7CiAgICAgICAgaWYgKGlubmVySm9pbnMgIT0gbnVsbCkK\nICAgICAgICAgICAgZXhwcy5mZXRjaElubmVyUGF0aHMgPSAoU3RyaW5nW10p\nIGlubmVySm9pbnMuCiAgICAgICAgICAgICAgICB0b0FycmF5KG5ldyBTdHJp\nbmdbaW5uZXJKb2lucy5zaXplKCldKTsKCiAgICAgICAgcmV0dXJuIGZpbHRl\ncjsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBldmFsU2V0Q2xhdXNlKFF1\nZXJ5RXhwcmVzc2lvbnMgZXhwcykgewogICAgICAgIC8vIGhhbmRsZSBTRVQg\nZmllbGQgPSB2YWx1ZQogICAgICAgIEpQUUxOb2RlW10gbm9kZXMgPSByb290\nKCkuZmluZENoaWxkcmVuQnlJRChKSlRVUERBVEVJVEVNKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgbm9kZXMgIT0gbnVsbCAmJiBpIDwgbm9kZXMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0aChm\naXJzdENoaWxkKG5vZGVzW2ldKSk7CiAgICAgICAgICAgIEpQUUxOb2RlIGxh\nc3RDaGlsZCA9IGxhc3RDaGlsZChub2Rlc1tpXSk7CiAgICAgICAgICAgIFZh\nbHVlIHZhbCA9IChsYXN0Q2hpbGQuY2hpbGRyZW4gPT0gbnVsbCkgCiAgICAg\nICAgICAgICAgICAgICAgICA/IG51bGwgOiBnZXRWYWx1ZShvbmx5Q2hpbGQo\nbGFzdENoaWxkKSk7CiAgICAgICAgICAgIGV4cHMucHV0VXBkYXRlKHBhdGgs\nIHZhbCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lv\nbiBldmFsV2hlcmVDbGF1c2UoKSB7CiAgICAgICAgLy8gZXZhbHVhdGUgdGhl\nIFdIRVJFIGNsYXVzZQogICAgICAgIEpQUUxOb2RlIHdoZXJlTm9kZSA9IHJv\nb3QoKS5maW5kQ2hpbGRCeUlEKEpKVFdIRVJFLCBmYWxzZSk7CiAgICAgICAg\naWYgKHdoZXJlTm9kZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICByZXR1cm4gKEV4cHJlc3Npb24pIGV2YWwod2hlcmVOb2Rl\nKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZXZhbEZyb21DbGF1\nc2UoYm9vbGVhbiBuZWVkc0FsaWFzKSB7CiAgICAgICAgRXhwcmVzc2lvbiBl\neHAgPSBudWxsOwoKICAgICAgICAvLyBidWlsZCB1cCB0aGUgYWxpYXMgbWFw\nIGluIHRoZSBGUk9NIGNsYXVzZQogICAgICAgIEpQUUxOb2RlIGZyb20gPSBy\nb290KCkuZmluZENoaWxkQnlJRChKSlRGUk9NLCBmYWxzZSk7CiAgICAgICAg\naWYgKGZyb20gPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNl\ncHRpb24oRVhfVVNFUiwgIm5vLWZyb20tY2xhdXNlIiwgbnVsbCwgbnVsbCk7\nCgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZnJvbS5jaGlsZHJlbi5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBKUFFMTm9kZSBub2RlID0gZnJv\nbS5jaGlsZHJlbltpXTsKCiAgICAgICAgICAgIGlmIChub2RlLmlkID09IEpK\nVEZST01JVEVNKQogICAgICAgICAgICAgICAgZXhwID0gZXZhbEZyb21JdGVt\nKGV4cCwgbm9kZSwgbmVlZHNBbGlhcyk7CiAgICAgICAgICAgIGVsc2UgaWYg\nKG5vZGUuaWQgPT0gSkpUT1VURVJKT0lOKQogICAgICAgICAgICAgICAgZXhw\nID0gYWRkSm9pbihub2RlLCBmYWxzZSwgZXhwKTsKICAgICAgICAgICAgZWxz\nZSBpZiAobm9kZS5pZCA9PSBKSlRJTk5FUkpPSU4pCiAgICAgICAgICAgICAg\nICBleHAgPSBhZGRKb2luKG5vZGUsIHRydWUsIGV4cCk7CiAgICAgICAgICAg\nIGVsc2UgaWYgKG5vZGUuaWQgPT0gSkpUSU5ORVJGRVRDSEpPSU4pCiAgICAg\nICAgICAgICAgICA7IC8vIHdlIGhhbmRsZSBpbm5lciBmZXRjaCBqb2lucyBp\nbiB0aGUgZXZhbEZldGNoSm9pbnMoKSBtZXRob2QKICAgICAgICAgICAgZWxz\nZSBpZiAobm9kZS5pZCA9PSBKSlRPVVRFUkZFVENISk9JTikKICAgICAgICAg\nICAgICAgIDsgLy8gd2UgaGFuZGxlIG91dGVyIGZldGNoIGpvaW5zIGluIHRo\nZSBldmFsRmV0Y2hKb2lucygpIG1ldGhvZAogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAi\nbm90LXNjaGVtYS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IG5vZGUgfSwgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICByZXR1\ncm4gZXhwOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIGpvaW4gY29u\nZGl0aW9uIHRvIHRoZSBnaXZlbiBleHByZXNzaW9uLgogICAgICoKICAgICAq\nIEBwYXJhbSBub2RlIHRoZSBub2RlIHRvIGNoZWNrCiAgICAgKiBAcGFyYW0g\naW5uZXIgd2hldGhlciBvciBub3QgdGhlIGpvaW4gc2hvdWxkIGJlIGFuIGlu\nbmVyIGpvaW4KICAgICAqIEBwYXJhbSBleHAgYW4gZXhpc3RpbmcgZXhwcmVz\nc2lvbiB0byBBTkQsIG9yIG51bGwgaWYgbm9uZQogICAgICogQHJldHVybiB0\naGUgRXhwcmVzc2lvbiB3aXRoIHRoZSBqb2luIGNvbmRpdGlvbiBhZGRlZAog\nICAgICovCiAgICBwcml2YXRlIEV4cHJlc3Npb24gYWRkSm9pbihKUFFMTm9k\nZSBub2RlLCBib29sZWFuIGlubmVyLCBFeHByZXNzaW9uIGV4cCkgewogICAg\nICAgIC8vIHRoZSB0eXBlIHdpbGwgYmUgdGhlIGRlY2xhcmVkIHR5cGUgZm9y\nIHRoZSBmaWVsZAogICAgICAgIFBhdGggcGF0aCA9IGdldFBhdGgoZmlyc3RD\naGlsZChub2RlKSwgZmFsc2UsIGlubmVyKTsKCiAgICAgICAgSlBRTE5vZGUg\nYWxpYXMgPSBub2RlLmdldENoaWxkQ291bnQoKSA+PSAyID8gcmlnaHQobm9k\nZSkgOiBudWxsOwogICAgICAgIC8vIE9QRU5KUEEtMTUgc3VwcG9ydCBzdWJx\ndWVyeSdzIGZyb20gY2xhdXNlIGRvIG5vdCBzdGFydCB3aXRoIAogICAgICAg\nIC8vIGlkZW50aWZpY2F0aW9uX3ZhcmlhYmxlX2RlY2xhcmF0aW9uKCkKICAg\nICAgICBpZiAoaW5uZXIgJiYgY3R4KCkuc3VicXVlcnkgIT0gbnVsbCAmJiBj\ndHgoKS5zY2hlbWFBbGlhcyA9PSBudWxsKSB7CiAgICAgICAgICAgIHNldENh\nbmRpZGF0ZShnZXRGaWVsZFR5cGUocGF0aC5sYXN0KCkpLCBhbGlhcy50ZXh0\nKTsKCiAgICAgICAgICAgIFBhdGggc3VicGF0aCA9IGZhY3RvcnkubmV3UGF0\naChjdHgoKS5zdWJxdWVyeSk7CiAgICAgICAgICAgIHN1YnBhdGguc2V0TWV0\nYURhdGEoY3R4KCkuc3VicXVlcnkuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAg\nICAgIGV4cCA9ICBhbmQoZXhwLCBmYWN0b3J5LmVxdWFsKHBhdGgsIHN1YnBh\ndGgpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhZGRKb2luKHBhdGgs\nIGFsaWFzLCBleHApOwogICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lvbiBh\nZGRKb2luKFBhdGggcGF0aCwgSlBRTE5vZGUgYWxpYXNOb2RlLAogICAgICAg\nIEV4cHJlc3Npb24gZXhwKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBwYXRoLmxhc3QoKTsKCiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAg\nICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAicGF0aC1u\nby1tZXRhIiwKICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgcGF0aCwg\nbnVsbCB9LCBudWxsKTsKCiAgICAgICAgU3RyaW5nIGFsaWFzID0gYWxpYXNO\nb2RlICE9IG51bGwgPyBhbGlhc05vZGUudGV4dCA6IG5leHRBbGlhcygpOwoK\nICAgICAgICBWYWx1ZSB2YXIgPSBnZXRWYXJpYWJsZShhbGlhcywgdHJ1ZSk7\nCiAgICAgICAgdmFyLnNldE1ldGFEYXRhKGdldEZpZWxkVHlwZShmbWQpKTsK\nCiAgICAgICAgRXhwcmVzc2lvbiBqb2luID0gbnVsbDsKCiAgICAgICAgLy8g\naWYgdGhlIHZhcmlhYmxlIGlzIGFscmVhZHkgYm91bmQsIGdldCB0aGUgdmFy\nJ3MgdmFsdWUgYW5kCiAgICAgICAgLy8gZG8gYSByZWd1bGFyIGNvbnRhaW5z\nIHdpdGggdGhhdAogICAgICAgIGJvb2xlYW4gYm91bmQgPSBpc0JvdW5kKHZh\ncik7CiAgICAgICAgaWYgKGJvdW5kKSB7CiAgICAgICAgICAgIHZhciA9IGdl\ndFZhbHVlKGFsaWFzTm9kZSwgVkFSX1BBVEgpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIGJpbmQodmFyKTsKICAgICAgICAgICAgam9pbiA9IGFu\nZChqb2luLCBmYWN0b3J5LmJpbmRWYXJpYWJsZSh2YXIsIHBhdGgpKTsKICAg\nICAgICB9CgogICAgICAgIGlmICghZm1kLmlzVHlwZVBDKCkpIC8vIG11bHRp\nLXZhbHVlZCByZWxhdGlvbgogICAgICAgIHsKICAgICAgICAgICAgaWYgKGJv\ndW5kKQogICAgICAgICAgICAgICAgam9pbiA9IGFuZChqb2luLCBmYWN0b3J5\nLmNvbnRhaW5zKHBhdGgsIHZhcikpOwoKICAgICAgICAgICAgc2V0SW1wbGlj\naXRDb250YWluc1R5cGVzKHBhdGgsIHZhciwgQ09OVEFJTlNfVFlQRV9FTEVN\nRU5UKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhbmQoZXhwLCBqb2lu\nKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gZXZhbEZyb21JdGVt\nKEV4cHJlc3Npb24gZXhwLCBKUFFMTm9kZSBub2RlLAogICAgICAgIGJvb2xl\nYW4gbmVlZHNBbGlhcykgewogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0g\ncmVzb2x2ZUNsYXNzTWV0YURhdGEoZmlyc3RDaGlsZChub2RlKSk7CgogICAg\nICAgIFN0cmluZyBhbGlhcyA9IG51bGw7CgogICAgICAgIGlmIChub2RlLmdl\ndENoaWxkQ291bnQoKSA8IDIpIHsKICAgICAgICAgICAgaWYgKG5lZWRzQWxp\nYXMpCiAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9V\nU0VSLCAiYWxpYXMtcmVxdWlyZWQiLAogICAgICAgICAgICAgICAgICAgIG5l\ndyBPYmplY3RbXXsgY21kIH0sIG51bGwpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIGFsaWFzID0gcmlnaHQobm9kZSkudGV4dDsKICAgICAgICAg\nICAgSlBRTE5vZGUgbGVmdCA9IGxlZnQobm9kZSk7CgogICAgICAgICAgICAv\nLyBjaGVjayB0byBzZWUgaWYgdGhlIHdlIGFyZSByZWZlcnJpbmcgdG8gYSBw\nYXRoIGluIHRoZSBmcm9tCiAgICAgICAgICAgIC8vIGNsYXVzZSwgc2luY2Ug\nd2UgbWlnaHQgYmUgaW4gYSBzdWJxdWVyeSBhZ2FpbnN0IGEgY29sbGVjdGlv\nbgogICAgICAgICAgICBpZiAoaXNQYXRoKGxlZnQpKSB7CiAgICAgICAgICAg\nICAgICBQYXRoIHBhdGggPSBnZXRQYXRoKGxlZnQpOwogICAgICAgICAgICAg\nICAgc2V0Q2FuZGlkYXRlKGdldEZpZWxkVHlwZShwYXRoLmxhc3QoKSksIGFs\naWFzKTsKCiAgICAgICAgICAgICAgICBQYXRoIHN1YnBhdGggPSBmYWN0b3J5\nLm5ld1BhdGgoY3R4KCkuc3VicXVlcnkpOwogICAgICAgICAgICAgICAgc3Vi\ncGF0aC5zZXRNZXRhRGF0YShjdHgoKS5zdWJxdWVyeS5nZXRNZXRhRGF0YSgp\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBhbmQoZXhwLCBmYWN0b3J5LmVx\ndWFsKHBhdGgsIHN1YnBhdGgpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIC8vIHdlIGhhdmUgYW4gYWxpYXM6IGJpbmQgaXQgYXMg\nYSB2YXJpYWJsZQogICAgICAgICAgICAgICAgVmFsdWUgdmFyID0gZ2V0VmFy\naWFibGUoYWxpYXMsIHRydWUpOwogICAgICAgICAgICAgICAgdmFyLnNldE1l\ndGFEYXRhKGNtZCk7CiAgICAgICAgICAgICAgICBiaW5kKHZhcik7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vICMjIyB3ZSBhc3NpZ24g\ndGhlIGZpcnN0IEZST01JVEVNIGluc3RhbmNlIHdlIHNlZSBhcwogICAgICAg\nIC8vIHRoZSBnbG9iYWwgY2FuZGlkYXRlLCB3aGljaCBpcyBpbmNvcnJlY3Q6\nIHdlIHNob3VsZAogICAgICAgIC8vIGluc3RlYWQgYmUgbWFwcGluZyB0aGlz\nIHRvIHRoZSBTRUxFQ1RJVEVNIHRvIHNlZQogICAgICAgIC8vIHdoaWNoIGlz\nIHRoZSBkZXNpcmVkIGNhbmRpZGF0ZQogICAgICAgIGlmIChjdHgoKS5zY2hl\nbWFBbGlhcyA9PSBudWxsKQogICAgICAgICAgICBzZXRDYW5kaWRhdGUoY21k\nLCBhbGlhcyk7CgogICAgICAgIHJldHVybiBleHA7CiAgICB9CgogICAgcHJv\ndGVjdGVkIGJvb2xlYW4gaXNEZWNsYXJlZFZhcmlhYmxlKFN0cmluZyBuYW1l\nKSB7CiAgICAgICAgLy8gSlBRTCBkb2Vzbid0IHN1cHBvcnQgZGVjbGFyaW5n\nIHZhcmlhYmxlcwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENoZWNrIHRvIHNlZSBpZiB0aGUgc3BlY2lmaWMgbm9kZSBp\ncyBhIHBhdGggKHZzLiBhIHNjaGVtYSBuYW1lKQogICAgICovCiAgICBib29s\nZWFuIGlzUGF0aChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgaWYgKG5vZGUu\nZ2V0Q2hpbGRDb3VudCgpIDwgMikKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoKICAgICAgICBmaW5hbCBTdHJpbmcgbmFtZSA9IGZpcnN0Q2hpbGQobm9k\nZSkudGV4dDsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3\naGVyZSB0aGUgY2xhc3MgbmFtZSBpcyB0aGUgYWxpYXMKICAgICAgICAvLyBm\nb3IgdGhlIGNhbmRpZGF0ZSAod2UgZG9uJ3QgdXNlIHZhcmlhYmxlcyBmb3Ig\ndGhpcykKICAgICAgICBpZiAoZ2V0TWV0YURhdGFGb3JBbGlhcyhuYW1lKSAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgaWYg\nKCFpc1NlZW5WYXJpYWJsZShuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICBmaW5hbCBWYWx1ZSB2YXIgPSBnZXRWYXJpYWJsZShu\nYW1lLCBmYWxzZSk7CgogICAgICAgIGlmICh2YXIgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGlzQm91bmQodmFyKTsKCiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIENsYXNzTWV0YURhdGEg\nZ2V0RmllbGRUeXBlKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaWYg\nKGZtZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBudWxsOwogICAgICAgIFZhbHVlTWV0\nYURhdGEgdm1kOwoKICAgICAgICBpZiAoKHZtZCA9IGZtZC5nZXRFbGVtZW50\nKCkpICE9IG51bGwpCiAgICAgICAgICAgIGNtZCA9IHZtZC5nZXREZWNsYXJl\nZFR5cGVNZXRhRGF0YSgpOwogICAgICAgIGVsc2UgaWYgKCh2bWQgPSBmbWQu\nZ2V0S2V5KCkpICE9IG51bGwpCiAgICAgICAgICAgIGNtZCA9IHZtZC5nZXRE\nZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwogICAgICAgIGVsc2UgaWYgKCh2bWQg\nPSBmbWQuZ2V0VmFsdWUoKSkgIT0gbnVsbCkKICAgICAgICAgICAgY21kID0g\ndm1kLmdldERlY2xhcmVkVHlwZU1ldGFEYXRhKCk7CgogICAgICAgIGlmIChj\nbWQgPT0gbnVsbCB8fCBjbWQuZ2V0RGVzY3JpYmVkVHlwZSgpID09IE9iamVj\ndC5jbGFzcykKICAgICAgICAgICAgY21kID0gZm1kLmdldERlY2xhcmVkVHlw\nZU1ldGFEYXRhKCk7CgogICAgICAgIHJldHVybiBjbWQ7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBJZGVudGlmaWNhdGlvbiB2YXJpYWJsZXMgaW4gSlBRTCBh\ncmUgY2FzZSBpbnNlbnNpdGl2ZSwgc28gbG93ZXItY2FzZQogICAgICogYWxs\nIHZhcmlhYmxlcyB3ZSBhcmUgZ29pbmcgdG8gYmluZC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFZhbHVlIGdldFZhcmlhYmxlKFN0cmluZyBpZCwgYm9vbGVh\nbiBiaW5kKSB7CiAgICAgICAgaWYgKGlkID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VmFyaWFi\nbGUoaWQudG9Mb3dlckNhc2UoKSwgYmluZCk7CiAgICB9CgogICAgcHJvdGVj\ndGVkIGJvb2xlYW4gaXNTZWVuZFZhcmlhYmxlKFN0cmluZyBpZCkgewogICAg\nICAgIHJldHVybiBpZCAhPSBudWxsICYmIHN1cGVyLmlzU2VlblZhcmlhYmxl\nKGlkLnRvTG93ZXJDYXNlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJucyB0aGUgY2xhc3MgbmFtZSB1c2luZyB0aGUgY2hpbGRyZW4gb2YgdGhl\nIEpQUUxOb2RlLgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyBhc3NlcnRT\nY2hlbWFOYW1lKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBpZiAobm9kZS5p\nZCAhPSBKSlRBQlNUUkFDVFNDSEVNQU5BTUUpCiAgICAgICAgICAgIHRocm93\nIHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3QtaWRlbnRpZmVyIiwKICAg\nICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZSB9LCBudWxsKTsKCiAg\nICAgICAgcmV0dXJuIGFzc2VtYmxlKG5vZGUpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVjdXJzaXZlIGhlbHBlciBtZXRob2QgdG8gZXZhbHVhdGUgdGhl\nIGdpdmVuIG5vZGUuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IGV2YWwo\nSlBRTE5vZGUgbm9kZSkgewogICAgICAgIFZhbHVlIHZhbDEgPSBudWxsOwog\nICAgICAgIFZhbHVlIHZhbDIgPSBudWxsOwogICAgICAgIFZhbHVlIHZhbDMg\nPSBudWxsOwoKICAgICAgICBib29sZWFuIG5vdCA9IG5vZGUubm90OwoKICAg\nICAgICBzd2l0Y2ggKG5vZGUuaWQpIHsKICAgICAgICAgICAgY2FzZSBKSlRX\nSEVSRTogLy8gdG9wLWxldmVsIFdIRVJFIGNsYXVzZQogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldEV4cHJlc3Npb24ob25seUNoaWxkKG5vZGUpKTsKCiAg\nICAgICAgICAgIGNhc2UgSkpUQk9PTEVBTkxJVEVSQUw6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFjdG9yeS5uZXdMaXRlcmFsKCJ0cnVlIi5lcXVhbHNJ\nZ25vcmVDYXNlCiAgICAgICAgICAgICAgICAgICAgKG5vZGUudGV4dCkgPyBC\nb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFLAogICAgICAgICAgICAgICAg\nICAgIExpdGVyYWwuVFlQRV9CT09MRUFOKTsKCiAgICAgICAgICAgIGNhc2Ug\nSkpUSU5URUdFUkxJVEVSQUw6CiAgICAgICAgICAgICAgICAvLyB1c2UgQmln\nRGVjaW1hbCBiZWNhdXNlIGl0IGNhbiBoYW5kbGUgcGFyc2luZyBleHBvbmVu\ndHMKICAgICAgICAgICAgICAgIEJpZ0RlY2ltYWwgaW50bGl0ID0gbmV3IEJp\nZ0RlY2ltYWwKICAgICAgICAgICAgICAgICAgICAobm9kZS50ZXh0LmVuZHNX\naXRoKCJsIikgfHwgbm9kZS50ZXh0LmVuZHNXaXRoKCJMIikKICAgICAgICAg\nICAgICAgICAgICAgICAgPyBub2RlLnRleHQuc3Vic3RyaW5nKDAsIG5vZGUu\ndGV4dC5sZW5ndGgoKSAtIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIDog\nbm9kZS50ZXh0KS4KICAgICAgICAgICAgICAgICAgICBtdWx0aXBseShuZXcg\nQmlnRGVjaW1hbChuZWdhdGl2ZShub2RlKSkpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhY3RvcnkubmV3TGl0ZXJhbChuZXcgTG9uZyhpbnRsaXQubG9u\nZ1ZhbHVlKCkpLAogICAgICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9O\nVU1CRVIpOwoKICAgICAgICAgICAgY2FzZSBKSlRERUNJTUFMTElURVJBTDoK\nICAgICAgICAgICAgICAgIEJpZ0RlY2ltYWwgZGVjbGl0ID0gbmV3IEJpZ0Rl\nY2ltYWwKICAgICAgICAgICAgICAgICAgICAobm9kZS50ZXh0LmVuZHNXaXRo\nKCJkIikgfHwgbm9kZS50ZXh0LmVuZHNXaXRoKCJEIikgfHwKICAgICAgICAg\nICAgICAgICAgICAgICAgbm9kZS50ZXh0LmVuZHNXaXRoKCJmIikgfHwgbm9k\nZS50ZXh0LmVuZHNXaXRoKCJGIikKICAgICAgICAgICAgICAgICAgICAgICAg\nPyBub2RlLnRleHQuc3Vic3RyaW5nKDAsIG5vZGUudGV4dC5sZW5ndGgoKSAt\nIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIDogbm9kZS50ZXh0KS4KICAg\nICAgICAgICAgICAgICAgICBtdWx0aXBseShuZXcgQmlnRGVjaW1hbChuZWdh\ndGl2ZShub2RlKSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnku\nbmV3TGl0ZXJhbChkZWNsaXQsIExpdGVyYWwuVFlQRV9OVU1CRVIpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRTVFJJTkdMSVRFUkFMOgogICAgICAgICAgICBj\nYXNlIEpKVFRSSU1DSEFSQUNURVI6CiAgICAgICAgICAgIGNhc2UgSkpURVND\nQVBFQ0hBUkFDVEVSOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnku\nbmV3TGl0ZXJhbCh0cmltUXVvdGVzKG5vZGUudGV4dCksCiAgICAgICAgICAg\nICAgICAgICAgTGl0ZXJhbC5UWVBFX1NRX1NUUklORyk7CgogICAgICAgICAg\nICBjYXNlIEpKVFBBVFRFUk5WQUxVRToKICAgICAgICAgICAgICAgIHJldHVy\nbiBldmFsKGZpcnN0Q2hpbGQobm9kZSkpOwoKICAgICAgICAgICAgY2FzZSBK\nSlROQU1FRElOUFVUUEFSQU1FVEVSOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFBhcmFtZXRlcihub2RlLnRleHQsIGZhbHNlKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUUE9TSVRJT05BTElOUFVUUEFSQU1FVEVSOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFBhcmFtZXRlcihub2RlLnRleHQsIHRydWUpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRPUjogLy8geCBPUiB5CiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFjdG9yeS5vcihnZXRFeHByZXNzaW9uKGxlZnQobm9k\nZSkpLAogICAgICAgICAgICAgICAgICAgIGdldEV4cHJlc3Npb24ocmlnaHQo\nbm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQU5EOiAvLyB4IEFORCB5\nCiAgICAgICAgICAgICAgICByZXR1cm4gYW5kKGdldEV4cHJlc3Npb24obGVm\ndChub2RlKSksCiAgICAgICAgICAgICAgICAgICAgZ2V0RXhwcmVzc2lvbihy\naWdodChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRFUVVBTFM6IC8v\nIHggPSB5CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChu\nb2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQo\nbm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwx\nLCB2YWwyLCBudWxsKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLmVxdWFsKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlROT1RF\nUVVBTFM6IC8vIHggPD4geQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZh\nbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZh\nbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0\nVHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFjdG9yeS5ub3RFcXVhbCh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUTEVTU1RIQU46IC8vIHggPCB5CiAgICAgICAgICAgICAgICB2\nYWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2\nYWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwogICAgICAgICAgICAgICAg\nc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBudWxsKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lmxlc3NUaGFuKHZhbDEsIHZhbDIpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRMRVNTT1JFUVVBTDogLy8geCA8PSB5CiAg\nICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChub2RlKSk7CiAg\nICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSkpOwog\nICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBu\ndWxsKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lmxlc3NUaGFu\nRXF1YWwodmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVEdSRUFU\nRVJUSEFOOiAvLyB4ID4geQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZh\nbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZh\nbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0\nVHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFjdG9yeS5ncmVhdGVyVGhhbih2YWwxLCB2YWwyKTsKCiAgICAgICAg\nICAgIGNhc2UgSkpUR1JFQVRFUk9SRVFVQUw6IC8vIHggPj0geQogICAgICAg\nICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAg\nICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAg\nICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgbnVsbCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5ncmVhdGVyVGhhbkVx\ndWFsKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRBREQ6IC8v\nIHggKyB5CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUobGVmdChu\nb2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQo\nbm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwx\nLCB2YWwyLCBUWVBFX05VTUJFUik7CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFjdG9yeS5hZGQodmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpK\nVFNVQlRSQUNUOiAvLyB4IC0geQogICAgICAgICAgICAgICAgdmFsMSA9IGdl\ndFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdl\ndFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxp\nY2l0VHlwZXModmFsMSwgdmFsMiwgVFlQRV9OVU1CRVIpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3Rvcnkuc3VidHJhY3QodmFsMSwgdmFsMik7Cgog\nICAgICAgICAgICBjYXNlIEpKVE1VTFRJUExZOiAvLyB4ICogeQogICAgICAg\nICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAg\nICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAg\nICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgVFlQRV9O\nVU1CRVIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubXVsdGlw\nbHkodmFsMSwgdmFsMik7CgogICAgICAgICAgICBjYXNlIEpKVERJVklERTog\nLy8geCAvIHkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0\nKG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdo\ndChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZh\nbDEsIHZhbDIsIFRZUEVfTlVNQkVSKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5LmRpdmlkZSh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNh\nc2UgSkpUQkVUV0VFTjogLy8geC5maWVsZCBbTk9UXSBCRVRXRUVOIDUgQU5E\nIDEwCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUoY2hpbGQobm9k\nZSwgMCwgMykpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKGNo\naWxkKG5vZGUsIDEsIDMpKTsKICAgICAgICAgICAgICAgIHZhbDMgPSBnZXRW\nYWx1ZShjaGlsZChub2RlLCAyLCAzKSk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwzLCBudWxsKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBldmFsTm90KG5vdCwgYW5kKGZhY3RvcnkuZ3Jl\nYXRlclRoYW5FcXVhbCh2YWwxLCB2YWwyKSwKICAgICAgICAgICAgICAgICAg\nICBmYWN0b3J5Lmxlc3NUaGFuRXF1YWwodmFsMSwgdmFsMykpKTsKCiAgICAg\nICAgICAgIGNhc2UgSkpUSU46IC8vIHguZmllbGQgW05PVF0gSU4gKCdhJywg\nJ2InLCAnYycpCgogICAgICAgICAgICAgICAgRXhwcmVzc2lvbiBpbkV4cCA9\nIG51bGw7CiAgICAgICAgICAgICAgICBJdGVyYXRvciBpbkl0ZXJhdG9yID0g\nbm9kZS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAgLy8gdGhlIGZpcnN0\nIGNoaWxkIGlzIHRoZSBwYXRoCiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0\nVmFsdWUoKEpQUUxOb2RlKSBpbkl0ZXJhdG9yLm5leHQoKSk7CgogICAgICAg\nICAgICAgICAgd2hpbGUgKGluSXRlcmF0b3IuaGFzTmV4dCgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKChKUFFMTm9kZSkgaW5J\ndGVyYXRvci5uZXh0KCkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBzcGVj\naWFsIGNhc2UgZm9yIDx2YWx1ZT4gSU4gKDxzdWJxdWVyeT4pIG9yCiAgICAg\nICAgICAgICAgICAgICAgLy8gPHZhbHVlPiBJTiAoPHNpbmdsZSB2YWx1ZT4p\nCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodmFsMiBpbnN0YW5jZW9mIExp\ndGVyYWwpICYmIG5vZGUuZ2V0Q2hpbGRDb3VudCgpID09IDIpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybiBldmFsTm90KG5vdCwgZmFjdG9yeS5j\nb250YWlucyh2YWwyLCB2YWwxKSk7IAoKICAgICAgICAgICAgICAgICAgICAv\nLyB0aGlzIGlzIGN1cnJlbnRseSBhIHNlcXVlbmNlIG9mIE9SIGV4cHJlc3Np\nb25zLCBzaW5jZSB3ZQogICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdCBo\nYXZlIHN1cHBvcnQgZm9yIElOIGV4cHJlc3Npb25zCiAgICAgICAgICAgICAg\nICAgICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBudWxsKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoaW5FeHAgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgaW5FeHAgPSBmYWN0b3J5LmVxdWFsKHZhbDEsIHZh\nbDIpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICAgICAgaW5FeHAgPSBmYWN0b3J5Lm9yKGluRXhwLCBmYWN0b3J5LmVx\ndWFsKHZhbDEsIHZhbDIpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICAvLyB3ZSBhZGRpdGlvbmFsbHkgbmVlZCB0byBhZGQgaW4gYSAi\nTk9UIE5VTEwiIGNsYXVzZSwgc2luY2UKICAgICAgICAgICAgICAgIC8vIHRo\nZSBJTiBiZWhhdmlvciB0aGF0IGlzIGV4cGVjdGVkIGJ5IHRoZSBDVFMgYWxz\nbyBleHBlY3RzCiAgICAgICAgICAgICAgICAvLyB0byBmaWx0ZXIgb3VyIE5V\nTExzCiAgICAgICAgICAgICAgICByZXR1cm4gYW5kKGV2YWxOb3Qobm90LCBp\nbkV4cCksCiAgICAgICAgICAgICAgICAgICAgZmFjdG9yeS5ub3RFcXVhbCh2\nYWwxLCBmYWN0b3J5LmdldE51bGwoKSkpOwoKICAgICAgICAgICAgY2FzZSBK\nSlRJU05VTEw6IC8vIHguZmllbGQgSVMgW05PVF0gTlVMTAogICAgICAgICAg\nICAgICAgaWYgKG5vdCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5ub3RFcXVhbAogICAgICAgICAgICAgICAgICAgICAgICAoZ2V0VmFs\ndWUob25seUNoaWxkKG5vZGUpKSwgZmFjdG9yeS5nZXROdWxsKCkpOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5LmVxdWFsCiAgICAgICAgICAgICAgICAgICAgICAgIChnZXRWYWx1\nZShvbmx5Q2hpbGQobm9kZSkpLCBmYWN0b3J5LmdldE51bGwoKSk7CgogICAg\nICAgICAgICBjYXNlIEpKVFBBVEg6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0UGF0aE9yQ29uc3RhbnQobm9kZSk7CgogICAgICAgICAgICBjYXNlIEpK\nVElERU5USUZJRVI6CiAgICAgICAgICAgIGNhc2UgSkpUSURFTlRJRklDQVRJ\nT05WQVJJQUJMRToKICAgICAgICAgICAgICAgIHJldHVybiBnZXRJZGVudGlm\naWVyKG5vZGUpOwoKICAgICAgICAgICAgY2FzZSBKSlROT1Q6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFjdG9yeS5ub3QoZ2V0RXhwcmVzc2lvbihvbmx5\nQ2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTElLRTogLy8g\nZmllbGQgTElLRSAnJXNvbWV2YWwlJwogICAgICAgICAgICAgICAgdmFsMSA9\nIGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9\nIGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKCiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlKHZhbDIsIFRZUEVfU1RSSU5HKTsKCiAgICAg\nICAgICAgICAgICAvLyBsb29rIGZvciBhbiBlc2NhcGUgY2hhcmFjdGVyIGJl\nbmVhdGggdGhlIG5vZGUKICAgICAgICAgICAgICAgIFN0cmluZyBlc2NhcGUg\nPSBudWxsOwogICAgICAgICAgICAgICAgSlBRTE5vZGUgZXNjYXBlTm9kZSA9\nIHJpZ2h0KG5vZGUpLgogICAgICAgICAgICAgICAgICAgIGZpbmRDaGlsZEJ5\nSUQoSkpURVNDQVBFQ0hBUkFDVEVSLCB0cnVlKTsKICAgICAgICAgICAgICAg\nIGlmIChlc2NhcGVOb2RlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nZXNjYXBlID0gdHJpbVF1b3Rlcyhvbmx5Q2hpbGQoZXNjYXBlTm9kZSkudGV4\ndCk7CgogICAgICAgICAgICAgICAgaWYgKG5vdCkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZmFjdG9yeS5ub3RNYXRjaGVzKHZhbDEsIHZhbDIsICJf\nIiwgIiUiLCBlc2NhcGUpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5Lm1hdGNoZXModmFsMSwgdmFs\nMiwgIl8iLCAiJSIsIGVzY2FwZSk7CgogICAgICAgICAgICBjYXNlIEpKVElT\nRU1QVFk6CiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbE5vdChub3QsCiAg\nICAgICAgICAgICAgICAgICAgZmFjdG9yeS5pc0VtcHR5KGdldFZhbHVlKG9u\nbHlDaGlsZChub2RlKSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU0laRToK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnNpemUoZ2V0VmFsdWUo\nb25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVFVQUEVS\nOgogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKG9ubHlDaGlsZChu\nb2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFsMSwg\nVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnku\ndG9VcHBlckNhc2UodmFsMSk7CgogICAgICAgICAgICBjYXNlIEpKVExPV0VS\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkudG9Mb3dlckNhc2Uo\nZ2V0U3RyaW5nVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAg\nICBjYXNlIEpKVExFTkdUSDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0\nb3J5LnN0cmluZ0xlbmd0aChnZXRTdHJpbmdWYWx1ZShvbmx5Q2hpbGQobm9k\nZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQUJTOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhY3RvcnkuYWJzKGdldE51bWJlclZhbHVlKG9ubHlDaGls\nZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRTUVJUOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhY3Rvcnkuc3FydChnZXROdW1iZXJWYWx1ZShv\nbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTU9EOgog\nICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwog\nICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsK\nICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwg\nVFlQRV9OVU1CRVIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnku\nbW9kKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRUUklNOiAv\nLyBUUklNKFtbd2hlcmVdIFtjaGFyXSBGUk9NXSBmaWVsZCkKICAgICAgICAg\nICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsYXN0Q2hpbGQobm9kZSkpOwogICAg\nICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDEsIFRZUEVfU1RSSU5H\nKTsKCiAgICAgICAgICAgICAgICBCb29sZWFuIHRyaW1XaGVyZSA9IG51bGw7\nCgogICAgICAgICAgICAgICAgSlBRTE5vZGUgZmlyc3RUcmltQ2hpbGQgPSBm\naXJzdENoaWxkKG5vZGUpOwoKICAgICAgICAgICAgICAgIGlmIChub2RlLmdl\ndENoaWxkQ291bnQoKSA+IDEpIHsKICAgICAgICAgICAgICAgICAgICB0cmlt\nV2hlcmUgPQogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdFRyaW1DaGls\nZC5pZCA9PSBKSlRUUklNTEVBRElORyA/IEJvb2xlYW4uVFJVRQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgOgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZmlyc3RUcmltQ2hpbGQuaWQgPT0gSkpUVFJJTVRSQUlMSU5HID8g\nQm9vbGVhbi5GQUxTRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIDogbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBW\nYWx1ZSB0cmltQ2hhcjsKCiAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBh\ncmUgMyBjaGlsZHJlbiwgdGhlbiB3ZSBrbm93IHRoZSB0cmltCiAgICAgICAg\nICAgICAgICAvLyBjaGFyIGlzIHRoZSBzZWNvbmQgbm9kZQogICAgICAgICAg\nICAgICAgaWYgKG5vZGUuZ2V0Q2hpbGRDb3VudCgpID09IDMpCiAgICAgICAg\nICAgICAgICAgICAgdHJpbUNoYXIgPSBnZXRWYWx1ZShzZWNvbmRDaGlsZChu\nb2RlKSk7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIHR3\nbyBjaGlsZHJlbiwgdGhlbiB3ZSBuZWVkIHRvIGNoZWNrIHRvIHNlZQogICAg\nICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBmaXJzdCBjaGlsZCBpcyBhIGxl\nYWRpbmcvdHJhaWxpbmcvYm90aCBub2RlLAogICAgICAgICAgICAgICAgICAg\nIC8vIG9yIHRoZSB0cmltIGNoYXJhY3RlciBub2RlCiAgICAgICAgICAgICAg\nICBlbHNlIGlmIChub2RlLmdldENoaWxkQ291bnQoKSA9PSAyCiAgICAgICAg\nICAgICAgICAgICAgJiYgZmlyc3RUcmltQ2hpbGQuaWQgIT0gSkpUVFJJTUxF\nQURJTkcKICAgICAgICAgICAgICAgICAgICAmJiBmaXJzdFRyaW1DaGlsZC5p\nZCAhPSBKSlRUUklNVFJBSUxJTkcKICAgICAgICAgICAgICAgICAgICAmJiBm\naXJzdFRyaW1DaGlsZC5pZCAhPSBKSlRUUklNQk9USCkKICAgICAgICAgICAg\nICAgICAgICB0cmltQ2hhciA9IGdldFZhbHVlKGZpcnN0Q2hpbGQobm9kZSkp\nOwogICAgICAgICAgICAgICAgICAgIC8vIG90aHdlcndpc2UsIHdlIGRlZmF1\nbHQgdG8gdHJpbW1pbmcgdGhlIHNwYWNlIGNoYXJhY3RlcgogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRyaW1DaGFyID0gZmFj\ndG9yeS5uZXdMaXRlcmFsKCIgIiwgTGl0ZXJhbC5UWVBFX1NUUklORyk7Cgog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkudHJpbSh2YWwxLCB0cmlt\nQ2hhciwgdHJpbVdoZXJlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ09OQ0FU\nOgogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkp\nOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUp\nKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwxLCBUWVBF\nX1NUUklORyk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFs\nMiwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rv\ncnkuY29uY2F0KHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRT\nVUJTVFJJTkc6CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFsdWUoY2hp\nbGQobm9kZSwgMCwgMykpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZh\nbHVlKGNoaWxkKG5vZGUsIDEsIDMpKTsKICAgICAgICAgICAgICAgIHZhbDMg\nPSBnZXRWYWx1ZShjaGlsZChub2RlLCAyLCAzKSk7CiAgICAgICAgICAgICAg\nICBzZXRJbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwogICAgICAg\nICAgICAgICAgc2V0SW1wbGljaXRUeXBlKHZhbDIsIEludGVnZXIuVFlQRSk7\nCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFsMywgSW50ZWdl\nci5UWVBFKTsKCiAgICAgICAgICAgICAgICAvLyB0aGUgc2VtYW50aWNzIG9m\nIHRoZSBKUFFMIHN1YnN0cmluZygpIGZ1bmN0aW9uCiAgICAgICAgICAgICAg\nICAvLyBhcmUgdGhhdCBhcmcyIGlzIHRoZSAxLWJhc2VkIHN0YXJ0IGluZGV4\nLCBhbmQgYXJnMyBpcwogICAgICAgICAgICAgICAgLy8gdGhlIGxlbmd0aCBv\nZiB0aGUgc3RyaW5nIHRvIGJlIHJldHVybjsgdGhpcyBpcyBkaWZmZXJlbnQK\nICAgICAgICAgICAgICAgIC8vIHRoYW4gdGhlIHNlbWFudGljcyBvZiB0aGUg\nRXhwcmVzc2lvbkZhY3RvcnkncyBzdWJzdHJpbmcsCiAgICAgICAgICAgICAg\nICAvLyB3aGljaCBtYXRjaGVzIHRoZSBKYXZhIGxhbmd1YWdlICgwLWJhc2Vk\nIHN0YXJ0IGluZGV4LAogICAgICAgICAgICAgICAgLy8gYXJnMiBpcyB0aGUg\nZW5kIGluZGV4KTogd2UgcGVyZm9ybSB0aGUgdHJhbnNsYXRpb24gYnkKICAg\nICAgICAgICAgICAgIC8vIGFkZGluZyBvbmUgdG8gdGhlIGZpcnN0IGFyZ3Vt\nZW50LCBhbmQgdGhlbiBhZGRpbmcgdGhlCiAgICAgICAgICAgICAgICAvLyBm\naXJzdCBhcmd1bWVudCB0byB0aGUgc2Vjb25kIGFyZ3VtZW50IHRvIGdldCB0\naGUgZW5kSW5kZXgKICAgICAgICAgICAgICAgIFZhbHVlIHN0YXJ0OwogICAg\nICAgICAgICAgICAgVmFsdWUgZW5kOwogICAgICAgICAgICAgICAgaWYgKHZh\nbDIgaW5zdGFuY2VvZiBMaXRlcmFsICYmIHZhbDMgaW5zdGFuY2VvZiBMaXRl\ncmFsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gb3B0aW1pemUgU1FMIGZv\nciB0aGUgY29tbW9uIGNhc2Ugb2YgdHdvIGxpdGVyYWxzCiAgICAgICAgICAg\nICAgICAgICAgbG9uZyBqcHFsU3RhcnQgPSAoKE51bWJlcikgKChMaXRlcmFs\nKSB2YWwyKS5nZXRWYWx1ZSgpKQogICAgICAgICAgICAgICAgICAgICAgICAu\nbG9uZ1ZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgbG9uZyBsZW5ndGgg\nPSAoKE51bWJlcikgKChMaXRlcmFsKSB2YWwzKS5nZXRWYWx1ZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgICAubG9uZ1ZhbHVlKCk7CiAgICAgICAgICAg\nICAgICAgICAgc3RhcnQgPSBmYWN0b3J5Lm5ld0xpdGVyYWwobmV3IExvbmco\nanBxbFN0YXJ0IC0gMSksCiAgICAgICAgICAgICAgICAgICAgICAgIExpdGVy\nYWwuVFlQRV9OVU1CRVIpOwogICAgICAgICAgICAgICAgICAgIGxvbmcgZW5k\nSW5kZXggPSBsZW5ndGggKyAoanBxbFN0YXJ0IC0gMSk7CiAgICAgICAgICAg\nICAgICAgICAgZW5kID0gZmFjdG9yeS5uZXdMaXRlcmFsKG5ldyBMb25nKGVu\nZEluZGV4KSwKICAgICAgICAgICAgICAgICAgICAgICAgTGl0ZXJhbC5UWVBF\nX05VTUJFUik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIHN0YXJ0ID0gZmFjdG9yeS5zdWJ0cmFjdCh2YWwyLCBmYWN0\nb3J5Lm5ld0xpdGVyYWwKICAgICAgICAgICAgICAgICAgICAgICAgKE51bWJl\ncnMudmFsdWVPZigxKSwgTGl0ZXJhbC5UWVBFX05VTUJFUikpOwogICAgICAg\nICAgICAgICAgICAgIGVuZCA9IGZhY3RvcnkuYWRkKHZhbDMsCiAgICAgICAg\nICAgICAgICAgICAgICAgIChmYWN0b3J5LnN1YnRyYWN0KHZhbDIsIGZhY3Rv\ncnkubmV3TGl0ZXJhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKE51\nbWJlcnMudmFsdWVPZigxKSwgTGl0ZXJhbC5UWVBFX05VTUJFUikpKSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9y\neS5zdWJzdHJpbmcodmFsMSwgZmFjdG9yeS5uZXdBcmd1bWVudExpc3QoCiAg\nICAgICAgICAgICAgICAgICAgc3RhcnQsIGVuZCkpOwoKICAgICAgICAgICAg\nY2FzZSBKSlRMT0NBVEU6CiAgICAgICAgICAgICAgICAvLyBhcyB3aXRoIFNV\nQlNUUklORyAoYWJvdmUpLCB0aGUgc2VtYW50aWNzIGZvciBMT0NBVEUgZGlm\nZmVyCiAgICAgICAgICAgICAgICAvLyBmcm9tIEV4cHJlc3Npb25GYWN0b3J5\nLmluZGV4T2YgaW4gdGhhdCBMT0NBVEUgdXNlcyBhCiAgICAgICAgICAgICAg\nICAvLyAwLWJhc2VkIGluZGV4LCBhbmQgaW5kZXhPZiB1c2VzIGEgMS1iYXNl\nZCBpbmRleAogICAgICAgICAgICAgICAgVmFsdWUgbG9jYXRlUGF0aCA9IGdl\ndFZhbHVlKGZpcnN0Q2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAgVmFs\ndWUgbG9jYXRlU2VhcmNoID0gZ2V0VmFsdWUoc2Vjb25kQ2hpbGQobm9kZSkp\nOwogICAgICAgICAgICAgICAgVmFsdWUgbG9jYXRlRnJvbUluZGV4ID0gbnVs\nbDsKICAgICAgICAgICAgICAgIGlmIChub2RlLmdldENoaWxkQ291bnQoKSA+\nIDIpIC8vIG9wdGlvbmFsIHN0YXJ0IGluZGV4IGFyZwogICAgICAgICAgICAg\nICAgICAgIGxvY2F0ZUZyb21JbmRleCA9IGdldFZhbHVlKHRoaXJkQ2hpbGQo\nbm9kZSkpOwoKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZShsb2Nh\ndGVQYXRoLCBUWVBFX1NUUklORyk7CiAgICAgICAgICAgICAgICBzZXRJbXBs\naWNpdFR5cGUobG9jYXRlU2VhcmNoLCBUWVBFX1NUUklORyk7CgogICAgICAg\nICAgICAgICAgaWYgKGxvY2F0ZUZyb21JbmRleCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZShsb2NhdGVGcm9tSW5kZXgs\nIFRZUEVfU1RSSU5HKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9y\neS5hZGQoZmFjdG9yeS5pbmRleE9mKGxvY2F0ZVNlYXJjaCwKICAgICAgICAg\nICAgICAgICAgICBsb2NhdGVGcm9tSW5kZXggPT0gbnVsbCA/IGxvY2F0ZVBh\ndGgKICAgICAgICAgICAgICAgICAgICAgICAgOiBmYWN0b3J5Lm5ld0FyZ3Vt\nZW50TGlzdChsb2NhdGVQYXRoLAogICAgICAgICAgICAgICAgICAgICAgICBm\nYWN0b3J5LnN1YnRyYWN0KGxvY2F0ZUZyb21JbmRleCwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGZhY3RvcnkubmV3TGl0ZXJhbChOdW1iZXJzLnZh\nbHVlT2YoMSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGl0\nZXJhbC5UWVBFX05VTUJFUikpKSksCiAgICAgICAgICAgICAgICAgICAgZmFj\ndG9yeS5uZXdMaXRlcmFsKE51bWJlcnMudmFsdWVPZigxKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgTGl0ZXJhbC5UWVBFX05VTUJFUikpOwoKICAgICAg\nICAgICAgY2FzZSBKSlRBR0dSRUdBVEU6CiAgICAgICAgICAgICAgICAvLyBz\naW1wbHkgcGFzcy10aHJvdWdoIHdoaWxlIGFzc2VydGluZyBhIHNpbmdsZSBj\naGlsZAogICAgICAgICAgICAgICAgcmV0dXJuIGV2YWwob25seUNoaWxkKG5v\nZGUpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ09VTlQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFjdG9yeS5jb3VudChnZXRWYWx1ZShsYXN0Q2hpbGQo\nbm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTUFYOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3RvcnkubWF4KGdldE51bWJlclZhbHVlKG9ubHlD\naGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRNSU46CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5taW4oZ2V0TnVtYmVyVmFsdWUo\nb25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVFNVTToK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN1bShnZXROdW1iZXJW\nYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpU\nQVZFUkFHRToKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmF2Zyhn\nZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpURElTVElOQ1RQQVRIOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhY3RvcnkuZGlzdGluY3QoZ2V0VmFsdWUob25seUNoaWxkKG5vZGUpKSk7\nCgogICAgICAgICAgICBjYXNlIEpKVEVYSVNUUzoKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5LmlzTm90RW1wdHkoKFZhbHVlKSBldmFsKG9ubHlD\naGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRBTlk6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5hbnkoKFZhbHVlKSBldmFsKG9u\nbHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRBTEw6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5hbGwoKFZhbHVlKSBldmFs\nKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRTVUJT\nRUxFQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0U3VicXVlcnkobm9k\nZSk7CgogICAgICAgICAgICBjYXNlIEpKVE1FTUJFUk9GOgogICAgICAgICAg\nICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSksIFZBUl9QQVRIKTsK\nICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSwg\nVkFSX1BBVEgpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRDb250YWlu\nc1R5cGVzKHZhbDIsIHZhbDEsIENPTlRBSU5TX1RZUEVfRUxFTUVOVCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gZXZhbE5vdChub3QsIGZhY3RvcnkuY29u\ndGFpbnModmFsMiwgdmFsMSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRDVVJS\nRU5UREFURToKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmdldEN1\ncnJlbnREYXRlKCk7CgogICAgICAgICAgICBjYXNlIEpKVENVUlJFTlRUSU1F\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ2V0Q3VycmVudFRp\nbWUoKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ1VSUkVOVFRJTUVTVEFNUDoK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmdldEN1cnJlbnRUaW1l\nc3RhbXAoKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU0VMRUNURVhURU5TSU9O\nOgogICAgICAgICAgICAgICAgYXNzZXJ0UXVlcnlFeHRlbnNpb25zKCJTRUxF\nQ1QiKTsKICAgICAgICAgICAgICAgIHJldHVybiBldmFsKG9ubHlDaGlsZChu\nb2RlKSk7CgogICAgICAgICAgICBjYXNlIEpKVEdST1VQQllFWFRFTlNJT046\nCiAgICAgICAgICAgICAgICBhc3NlcnRRdWVyeUV4dGVuc2lvbnMoIkdST1VQ\nIEJZIik7CiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbChvbmx5Q2hpbGQo\nbm9kZSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRPUkRFUkJZRVhURU5TSU9O\nOgogICAgICAgICAgICAgICAgYXNzZXJ0UXVlcnlFeHRlbnNpb25zKCJPUkRF\nUiBCWSIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGV2YWwob25seUNoaWxk\nKG5vZGUpKTsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9GQVRBTCwgImJhZC10cmVlIiwK\nICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5vZGUgfSwgbnVs\nbCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBhc3NlcnRR\ndWVyeUV4dGVuc2lvbnMoU3RyaW5nIGNsYXVzZSkgewogICAgICAgIE9wZW5K\nUEFDb25maWd1cmF0aW9uIGNvbmYgPSByZXNvbHZlci5nZXRDb25maWd1cmF0\naW9uKCk7CiAgICAgICAgc3dpdGNoKGNvbmYuZ2V0Q29tcGF0aWJpbGl0eUlu\nc3RhbmNlKCkuZ2V0SlBRTCgpKSB7CiAgICAgICAgICAgIGNhc2UgQ29tcGF0\naWJpbGl0eS5KUFFMX1dBUk46CiAgICAgICAgICAgICAgICAvLyBjaGVjayBp\nZiB3ZSd2ZSBhbHJlYWR5IHdhcm5lZCBmb3IgdGhpcyBxdWVyeS1mYWN0b3J5\nIGNvbWJvCiAgICAgICAgICAgICAgICBTdG9yZUNvbnRleHQgY3R4ID0gcmVz\nb2x2ZXIuZ2V0UXVlcnlDb250ZXh0KCkuZ2V0U3RvcmVDb250ZXh0KCk7CiAg\nICAgICAgICAgICAgICBTdHJpbmcgcXVlcnkgPSBjdXJyZW50UXVlcnkoKTsK\nICAgICAgICAgICAgICAgIGlmIChjdHguZ2V0QnJva2VyKCkgIT0gbnVsbCAm\nJiBxdWVyeSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5n\nIGtleSA9IGdldENsYXNzKCkuZ2V0TmFtZSgpICsgIjoiICsgcXVlcnk7CiAg\nICAgICAgICAgICAgICAgICAgQnJva2VyRmFjdG9yeSBmYWN0b3J5ID0gY3R4\nLmdldEJyb2tlcigpLmdldEJyb2tlckZhY3RvcnkoKTsKICAgICAgICAgICAg\nICAgICAgICBPYmplY3QgaGFzV2FybmVkID0gZmFjdG9yeS5nZXRVc2VyT2Jq\nZWN0KGtleSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1dhcm5lZCAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZh\nY3RvcnkucHV0VXNlck9iamVjdChrZXksIEJvb2xlYW4uVFJVRSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBMb2cgbG9nID0gY29uZi5n\nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX1FVRVJZKTsKICAgICAg\nICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJxdWVyeS1leHRlbnNpb25z\nLXdhcm5pbmciLCBjbGF1c2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGN1\ncnJlbnRRdWVyeSgpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBDb21wYXRpYmlsaXR5LkpQUUxfU1RSSUNUOgogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFBhcnNlRXhjZXB0aW9uKF9sb2MuZ2V0KCJx\ndWVyeS1leHRlbnNpb25zLWVycm9yIiwKICAgICAgICAgICAgICAgICAgICBj\nbGF1c2UsIGN1cnJlbnRRdWVyeSgpKS5nZXRNZXNzYWdlKCkpOwogICAgICAg\nICAgICBjYXNlIENvbXBhdGliaWxpdHkuSlBRTF9FWFRFTkRFRDoKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAg\nICAgICAgICAgICAgICAgICAiQ29tcGF0aWJpbGl0eS5nZXRKUFFMKCkgPT0g\nIgogICAgICAgICAgICAgICAgICAgICAgICArIGNvbmYuZ2V0Q29tcGF0aWJp\nbGl0eUluc3RhbmNlKCkuZ2V0SlBRTCgpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHJvdGVjdGVkIHZvaWQgc2V0SW1wbGljaXRUeXBlcyhWYWx1ZSB2YWwx\nLCBWYWx1ZSB2YWwyLCBDbGFzcyBleHBlY3RlZCkgewogICAgICAgIHN1cGVy\nLnNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgZXhwZWN0ZWQpOwoKICAg\nICAgICAvLyBhcyB3ZWxsIGFzIHNldHRpbmcgdGhlIHR5cGVzIGZvciBjb252\nZXJzaW9ucywgd2UgYWxzbyBuZWVkIHRvCiAgICAgICAgLy8gZW5zdXJlIHRo\nYXQgYW55IHBhcmFtZXRlcnMgYXJlIGRlY2xhcmVkIHdpdGggdGhlIGNvcnJl\nY3QgdHlwZSwKICAgICAgICAvLyBzaW5jZSB0aGUgSlBBIHNwZWMgZXhwZWN0\ncyB0aGF0IHRoZXNlIHdpbGwgYmUgdmFsaWRhdGVkCiAgICAgICAgUGFyYW1l\ndGVyIHBhcmFtID0gdmFsMSBpbnN0YW5jZW9mIFBhcmFtZXRlciA/IChQYXJh\nbWV0ZXIpIHZhbDEKICAgICAgICAgICAgOiB2YWwyIGluc3RhbmNlb2YgUGFy\nYW1ldGVyID8gKFBhcmFtZXRlcikgdmFsMiA6IG51bGw7CiAgICAgICAgUGF0\naCBwYXRoID0gdmFsMSBpbnN0YW5jZW9mIFBhdGggPyAoUGF0aCkgdmFsMQog\nICAgICAgICAgICA6IHZhbDIgaW5zdGFuY2VvZiBQYXRoID8gKFBhdGgpIHZh\nbDIgOiBudWxsOwoKICAgICAgICAvLyB3ZSBvbmx5IGNoZWNrIGZvciBwYXJh\nbWV0ZXItdG8tcGF0aCBjb21wYXJpc29ucwogICAgICAgIGlmIChwYXJhbSA9\nPSBudWxsIHx8IHBhdGggPT0gbnVsbCB8fCBwYXJhbWV0ZXJUeXBlcyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gcGF0aC5sYXN0KCk7CiAgICAgICAgaWYgKGZtZCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIENsYXNzIHR5cGUgPSBw\nYXRoLmlzWFBhdGgoKSA/IHBhdGguZ2V0VHlwZSgpIDogZm1kLmdldERlY2xh\ncmVkVHlwZSgpOwogICAgICAgIGlmICh0eXBlID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgU3RyaW5nIHBhcmFtTmFtZSA9IHBhcmFt\nLmdldFBhcmFtZXRlck5hbWUoKTsKICAgICAgICBpZiAocGFyYW1OYW1lID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gbWFrZSBz\ndXJlIHdlIGhhdmUgYWxyZWFkeSBkZWNsYXJlZCB0aGUgcGFyYW1ldGVyCiAg\nICAgICAgaWYgKHBhcmFtZXRlclR5cGVzLmNvbnRhaW5zS2V5KHBhcmFtTmFt\nZSkpCiAgICAgICAgICAgIHBhcmFtZXRlclR5cGVzLnB1dChwYXJhbU5hbWUs\nIHR5cGUpOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0U3RyaW5nVmFs\ndWUoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVybiBnZXRUeXBlVmFs\ndWUobm9kZSwgVFlQRV9TVFJJTkcpOwogICAgfQoKICAgIHByaXZhdGUgVmFs\ndWUgZ2V0TnVtYmVyVmFsdWUoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJl\ndHVybiBnZXRUeXBlVmFsdWUobm9kZSwgVFlQRV9OVU1CRVIpOwogICAgfQoK\nICAgIHByaXZhdGUgVmFsdWUgZ2V0VHlwZVZhbHVlKEpQUUxOb2RlIG5vZGUs\nIENsYXNzIGltcGxpY2l0VHlwZSkgewogICAgICAgIFZhbHVlIHZhbCA9IGdl\ndFZhbHVlKG5vZGUpOwogICAgICAgIHNldEltcGxpY2l0VHlwZSh2YWwsIGlt\ncGxpY2l0VHlwZSk7CiAgICAgICAgcmV0dXJuIHZhbDsKICAgIH0KCiAgICBw\ncml2YXRlIFZhbHVlIGdldFN1YnF1ZXJ5KEpQUUxOb2RlIG5vZGUpIHsKICAg\nICAgICBmaW5hbCBib29sZWFuIHN1YmNsYXNzZXMgPSB0cnVlOwogICAgICAg\nIFN0cmluZyBhbGlhcyA9IG5leHRBbGlhcygpOwoKICAgICAgICAvLyBwYXJz\nZSB0aGUgc3VicXVlcnkKICAgICAgICBQYXJzZWRKUFFMIHBhcnNlZCA9IG5l\ndyBQYXJzZWRKUFFMKG5vZGUucGFyc2VyLmpwcWwsIG5vZGUpOwoKICAgICAg\nICBDbGFzc01ldGFEYXRhIGNhbmRpZGF0ZSA9IGdldENhbmRpZGF0ZU1ldGFE\nYXRhKG5vZGUpOwogICAgICAgIFN1YnF1ZXJ5IHN1YnEgPSBmYWN0b3J5Lm5l\nd1N1YnF1ZXJ5KGNhbmRpZGF0ZSwgc3ViY2xhc3NlcywgYWxpYXMpOwogICAg\nICAgIHN1YnEuc2V0TWV0YURhdGEoY2FuZGlkYXRlKTsKCiAgICAgICAgY29u\ndGV4dHMucHVzaChuZXcgQ29udGV4dChwYXJzZWQsIHN1YnEpKTsKCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBzdWJleHAg\nPSBnZXRRdWVyeUV4cHJlc3Npb25zKCk7CiAgICAgICAgICAgIHN1YnEuc2V0\nUXVlcnlFeHByZXNzaW9ucyhzdWJleHApOwogICAgICAgICAgICByZXR1cm4g\nc3VicTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAvLyByZW1v\ndmUgdGhlIHN1YnF1ZXJ5IHBhcnNlIGNvbnRleHQKICAgICAgICAgICAgY29u\ndGV4dHMucG9wKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmVjb3JkIHRoZSBuYW1lcyBhbmQgb3JkZXIgb2YgaW1wbGljaXQgcGFyYW1l\ndGVycy4KICAgICAqLwogICAgcHJpdmF0ZSBQYXJhbWV0ZXIgZ2V0UGFyYW1l\ndGVyKFN0cmluZyBpZCwgYm9vbGVhbiBwb3NpdGlvbmFsKSB7CiAgICAgICAg\naWYgKHBhcmFtZXRlclR5cGVzID09IG51bGwpCiAgICAgICAgICAgIHBhcmFt\nZXRlclR5cGVzID0gbmV3IExpbmtlZE1hcCg2KTsKICAgICAgICBpZiAoIXBh\ncmFtZXRlclR5cGVzLmNvbnRhaW5zS2V5KGlkKSkKICAgICAgICAgICAgcGFy\nYW1ldGVyVHlwZXMucHV0KGlkLCBUWVBFX09CSkVDVCk7CgogICAgICAgIENs\nYXNzIHR5cGUgPSBPYmplY3QuY2xhc3M7CiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhID0gbnVsbDsKICAgICAgICBpbnQgaW5kZXg7CgogICAgICAgIGlm\nIChwb3NpdGlvbmFsKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAvLyBpbmRleGVzIGluIEpQUUwgYXJlIDEtYmFzZWQsIGFzIG9wcG9z\nZWQgdG8gMC1iYXNlZCBpbgogICAgICAgICAgICAgICAgLy8gdGhlIGNvcmUg\nRXhwcmVzc2lvbkZhY3RvcnkKICAgICAgICAgICAgICAgIGluZGV4ID0gSW50\nZWdlci5wYXJzZUludChpZCkgLSAxOwogICAgICAgICAgICB9IGNhdGNoIChO\ndW1iZXJGb3JtYXRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhy\nb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImJhZC1wb3NpdGlvbmFsLXBh\ncmFtZXRlciIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBp\nZCB9LCBlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGluZGV4\nIDwgMCkKICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVY\nX1VTRVIsICJiYWQtcG9zaXRpb25hbC1wYXJhbWV0ZXIiLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXXsgaWQgfSwgbnVsbCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHRoZSBpbmRleCBp\ncyBqdXN0IHRoZSBjdXJyZW50IHNpemUgb2YgdGhlIHBhcmFtcwogICAgICAg\nICAgICBpbmRleCA9IHBhcmFtZXRlclR5cGVzLmluZGV4T2YoaWQpOwogICAg\nICAgIH0KCiAgICAgICAgUGFyYW1ldGVyIHBhcmFtID0gZmFjdG9yeS5uZXdQ\nYXJhbWV0ZXIoaWQsIHR5cGUpOwogICAgICAgIHBhcmFtLnNldE1ldGFEYXRh\nKG1ldGEpOwogICAgICAgIHBhcmFtLnNldEluZGV4KGluZGV4KTsKCiAgICAg\nICAgcmV0dXJuIHBhcmFtOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2tz\nIHRvIHNlZSBpZiB3ZSBzaG91bGQgZXZhbHVhdGUgZm9yIGEgTk9UIGV4cHJl\nc3Npb24uCiAgICAgKi8KICAgIHByaXZhdGUgRXhwcmVzc2lvbiBldmFsTm90\nKGJvb2xlYW4gbm90LCBFeHByZXNzaW9uIGV4cCkgewogICAgICAgIHJldHVy\nbiBub3QgPyBmYWN0b3J5Lm5vdChleHApIDogZXhwOwogICAgfQoKICAgIC8q\nKgogICAgICogVHJpbSBvZmYgbGVhZGluZyBhbmQgdHJhaWxpbmcgc2luZ2xl\nLXF1b3RlcywgYW5kIHRoZW4KICAgICAqIHJlcGxhY2UgYW55IGludGVybmFs\nICcnIGluc3RhbmNlcyB3aXRoICcgKHNpbmNlIHJlcGVhdGluZyB0aGUKICAg\nICAqIHF1b3RlIGlzIHRoZSBKUFFMIG1lY2hhbmlzbSBvZiBlc2NhcGluZyBh\nIHNpbmdsZSBxdW90ZSkuCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIHRy\naW1RdW90ZXMoU3RyaW5nIHN0cikgewogICAgICAgIGlmIChzdHIgPT0gbnVs\nbCB8fCBzdHIubGVuZ3RoKCkgPD0gMSkKICAgICAgICAgICAgcmV0dXJuIHN0\ncjsKCiAgICAgICAgaWYgKHN0ci5zdGFydHNXaXRoKCInIikgJiYgc3RyLmVu\nZHNXaXRoKCInIikpCiAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmco\nMSwgc3RyLmxlbmd0aCgpIC0gMSk7CgogICAgICAgIGludCBpbmRleCA9IC0x\nOwoKICAgICAgICB3aGlsZSAoKGluZGV4ID0gc3RyLmluZGV4T2YoIicnIiwg\naW5kZXggKyAxKSkgIT0gLTEpCiAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJz\ndHJpbmcoMCwgaW5kZXggKyAxKSArIHN0ci5zdWJzdHJpbmcoaW5kZXggKyAy\nKTsKCiAgICAgICAgcmV0dXJuIHN0cjsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFuIEludGVnZXJMaXRlcmFsIGFuZCBEZWNpbWFsTGl0ZXJhbCBub2RlIHdp\nbGwKICAgICAqIGhhdmUgYSBjaGlsZCBub2RlIG9mIE5lZ2F0aXZlIGlmIGl0\nIGlzIG5lZ2F0aXZlOgogICAgICogaWYgc28sIHRoaXMgbWV0aG9kIHJldHVy\nbnMgLTEsIGVsc2UgaXQgcmV0dXJucyAxLgogICAgICovCiAgICBwcml2YXRl\nIHNob3J0IG5lZ2F0aXZlKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBpZiAo\nbm9kZS5jaGlsZHJlbiAhPSBudWxsICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3Ro\nID09IDEKICAgICAgICAgICAgJiYgZmlyc3RDaGlsZChub2RlKS5pZCA9PSBK\nSlRORUdBVElWRSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgcHJpdmF0ZSBW\nYWx1ZSBnZXRJZGVudGlmaWVyKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBm\naW5hbCBTdHJpbmcgbmFtZSA9IG5vZGUudGV4dDsKICAgICAgICBmaW5hbCBW\nYWx1ZSB2YWwgPSBnZXRWYXJpYWJsZShuYW1lLCBmYWxzZSk7CgogICAgICAg\nIENsYXNzTWV0YURhdGEgY21kID0gZ2V0TWV0YURhdGFGb3JBbGlhcyhuYW1l\nKTsKCiAgICAgICAgaWYgKGNtZCAhPSBudWxsKSB7CiAgICAgICAgICAgIC8v\nIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgY2xhc3MgbmFtZSBpcyB0aGUg\nYWxpYXMKICAgICAgICAgICAgLy8gZm9yIHRoZSBjYW5kaWRhdGUgKHdlIGRv\nbid0IHVzZSB2YXJpYWJsZXMgZm9yIHRoaXMpCiAgICAgICAgICAgIFZhbHVl\nIHRoaXogPSBmYWN0b3J5LmdldFRoaXMoKTsKICAgICAgICAgICAgdGhpei5z\nZXRNZXRhRGF0YShjbWQpOwogICAgICAgICAgICByZXR1cm4gdGhpejsKICAg\nICAgICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFBhdGgpIHsKICAgICAg\nICAgICAgcmV0dXJuIChQYXRoKSB2YWw7CiAgICAgICAgfSBlbHNlIGlmICh2\nYWwgaW5zdGFuY2VvZiBWYWx1ZSkgewogICAgICAgICAgICByZXR1cm4gKFZh\nbHVlKSB2YWw7CiAgICAgICAgfQoKICAgICAgICB0aHJvdyBwYXJzZUV4Y2Vw\ndGlvbihFWF9VU0VSLCAidW5rbm93bi1pZGVudGlmaWVyIiwKICAgICAgICAg\nICAgbmV3IE9iamVjdFtdeyBuYW1lIH0sIG51bGwpOwogICAgfQoKICAgIHBy\naXZhdGUgVmFsdWUgZ2V0UGF0aE9yQ29uc3RhbnQoSlBRTE5vZGUgbm9kZSkg\newogICAgICAgIC8vIGZpcnN0IGNoZWNrIHRvIHNlZSBpZiB0aGUgcGF0aCBp\ncyBhbiBlbnVtIG9yIHN0YXRpYyBmaWVsZCwgYW5kCiAgICAgICAgLy8gaWYg\nc28sIGxvYWQgaXQKICAgICAgICBTdHJpbmcgY2xhc3NOYW1lID0gYXNzZW1i\nbGUobm9kZSwgIi4iLCAxKTsKICAgICAgICBDbGFzcyBjID0gcmVzb2x2ZXIu\nY2xhc3NGb3JOYW1lKGNsYXNzTmFtZSwgbnVsbCk7CiAgICAgICAgaWYgKGMg\nIT0gbnVsbCkgewogICAgICAgICAgICBTdHJpbmcgZmllbGROYW1lID0gbGFz\ndENoaWxkKG5vZGUpLnRleHQ7CgogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgRmllbGQgZmllbGQgPSBjLmdldEZpZWxkKGZpZWxkTmFtZSk7\nCiAgICAgICAgICAgICAgICBPYmplY3QgdmFsdWUgPSBmaWVsZC5nZXQobnVs\nbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5uZXdMaXRlcmFs\nKHZhbHVlLCBMaXRlcmFsLlRZUEVfVU5LTk9XTik7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKE5vU3VjaEZpZWxkRXhjZXB0aW9uIG5zZmUpIHsKICAgICAgICAg\nICAgICAgIGlmIChub2RlLmluRW51bVBhdGgpCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vLWZpZWxkIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBjLmdldE5h\nbWUoKSwgZmllbGROYW1lIH0sIG5zZmUpOwogICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXRoKG5vZGUsIGZh\nbHNlLCB0cnVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VT\nRVIsICJ1bmFjY2Vzc2libGUtZmllbGQiLAogICAgICAgICAgICAgICAgICAg\nIG5ldyBPYmplY3RbXXsgY2xhc3NOYW1lLCBmaWVsZE5hbWUgfSwgZSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1\ncm4gZ2V0UGF0aChub2RlLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgUGF0aCBnZXRQYXRoKEpQUUxOb2RlIG5vZGUpIHsK\nICAgICAgICByZXR1cm4gZ2V0UGF0aChub2RlLCBmYWxzZSwgdHJ1ZSk7CiAg\nICB9CgogICAgcHJpdmF0ZSBQYXRoIGdldFBhdGgoSlBRTE5vZGUgbm9kZSwg\nYm9vbGVhbiBwY09ubHksIGJvb2xlYW4gaW5uZXIpIHsKICAgICAgICAvLyBy\nZXNvbHZlIHRoZSBmaXJzdCBlbGVtZW50IGFnYWluc3QgdGhlIGFsaWFzZXMg\nbWFwIC4uLgogICAgICAgIC8vIGkuZS4sIHRoZSBwYXRoICJTRUxFQ1QgeC5p\nZCBGUk9NIFNvbWVDbGFzcyB4IHdoZXJlIHguaWQgPiAxMCIKICAgICAgICAv\nLyB3aWxsIG5lZWQgdG8gaGF2ZSAieCIgaW4gdGhlIGFsaWFzIG1hcCBpbiBv\ncmRlciB0byByZXNvbHZlCiAgICAgICAgUGF0aCBwYXRoOwoKICAgICAgICBm\naW5hbCBTdHJpbmcgbmFtZSA9IGZpcnN0Q2hpbGQobm9kZSkudGV4dDsKICAg\nICAgICBmaW5hbCBWYWx1ZSB2YWwgPSBnZXRWYXJpYWJsZShuYW1lLCBmYWxz\nZSk7CgogICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgY2xh\nc3MgbmFtZSBpcyB0aGUgYWxpYXMKICAgICAgICAvLyBmb3IgdGhlIGNhbmRp\nZGF0ZSAod2UgZG9uJ3QgdXNlIHZhcmlhYmxlcyBmb3IgdGhpcykKICAgICAg\nICBpZiAobmFtZS5lcXVhbHNJZ25vcmVDYXNlKGN0eCgpLnNjaGVtYUFsaWFz\nKSkgewogICAgICAgICAgICBpZiAoY3R4KCkuc3VicXVlcnkgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgcGF0aCA9IGZhY3RvcnkubmV3UGF0aChjdHgo\nKS5zdWJxdWVyeSk7CiAgICAgICAgICAgICAgICBwYXRoLnNldE1ldGFEYXRh\nKGN0eCgpLnN1YnF1ZXJ5LmdldE1ldGFEYXRhKCkpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgcGF0aCA9IGZhY3RvcnkubmV3UGF0\naCgpOwogICAgICAgICAgICAgICAgcGF0aC5zZXRNZXRhRGF0YShjdHgoKS5t\nZXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZ2V0TWV0\nYURhdGFGb3JBbGlhcyhuYW1lKSAhPSBudWxsKQogICAgICAgICAgICBwYXRo\nID0gbmV3UGF0aChudWxsLCBnZXRNZXRhRGF0YUZvckFsaWFzKG5hbWUpKTsK\nICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBQYXRoKQogICAgICAg\nICAgICBwYXRoID0gKFBhdGgpIHZhbDsKICAgICAgICBlbHNlIGlmICh2YWwu\nZ2V0TWV0YURhdGEoKSAhPSBudWxsKQogICAgICAgICAgICBwYXRoID0gbmV3\nUGF0aCh2YWwsIHZhbC5nZXRNZXRhRGF0YSgpKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJwYXRo\nLWludmFsaWQiLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBhc3Nl\nbWJsZShub2RlKSwgbmFtZSB9LCBudWxsKTsKCiAgICAgICAgLy8gd2FsayB0\naHJvdWdoIHRoZSBjaGlsZHJlbiBhbmQgYXNzZW1ibGUgdGhlIHBhdGgKICAg\nICAgICBib29sZWFuIGFsbG93TnVsbCA9ICFpbm5lcjsKICAgICAgICBmb3Ig\nKGludCBpID0gMTsgaSA8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKHBhdGguaXNYUGF0aCgpKSB7CiAgICAgICAgICAg\nICAgICBmb3IgKGludCBqID0gaTsgaiA8bm9kZS5jaGlsZHJlbi5sZW5ndGg7\nIGorKykKICAgICAgICAgICAgICAgICAgICBwYXRoID0gKFBhdGgpIHRyYXZl\ncnNlWFBhdGgocGF0aCwgbm9kZS5jaGlsZHJlbltqXS50ZXh0KTsKICAgICAg\nICAgICAgICAgIHJldHVybiBwYXRoOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHBhdGggPSAoUGF0aCkgdHJhdmVyc2VQYXRoKHBhdGgsIG5vZGUuY2hp\nbGRyZW5baV0udGV4dCwgcGNPbmx5LAogICAgICAgICAgICAgICAgYWxsb3dO\ndWxsKTsKCiAgICAgICAgICAgIC8vIGFsbCB0cmF2ZXJzYWxzIGJ1dCB0aGUg\nZmlyc3Qgb25lIHdpbGwgYWx3YXlzIGJlIGlubmVyIGpvaW5zCiAgICAgICAg\nICAgIGFsbG93TnVsbCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0\ndXJuIHBhdGg7CiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNzIGdldERlY2xh\ncmVkVmFyaWFibGVUeXBlKFN0cmluZyBuYW1lKSB7CiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBjbWQgPSBnZXRNZXRhRGF0YUZvckFsaWFzKG5hbWUpOwogICAg\nICAgIGlmIChjbWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNtZC5n\nZXREZXNjcmliZWRUeXBlKCk7CgogICAgICAgIGlmIChuYW1lICE9IG51bGwg\nJiYgbmFtZS5lcXVhbHMoY3R4KCkuc2NoZW1hQWxpYXMpKQogICAgICAgICAg\nICByZXR1cm4gZ2V0Q2FuZGlkYXRlVHlwZSgpOwoKICAgICAgICAvLyBKUFFM\nIGhhcyBubyBkZWNsYXJlZCB2YXJpYWJsZXMKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gRXhwcmVzc2lv\nbiBmb3IgdGhlIGdpdmVuIG5vZGUgYnkgZXZhbCdpbmcgaXQuCiAgICAgKi8K\nICAgIHByaXZhdGUgRXhwcmVzc2lvbiBnZXRFeHByZXNzaW9uKEpQUUxOb2Rl\nIG5vZGUpIHsKICAgICAgICBPYmplY3QgZXhwID0gZXZhbChub2RlKTsKCiAg\nICAgICAgLy8gY2hlY2sgZm9yIGJvb2xlYW4gdmFsdWVzIHVzZWQgYXMgZXhw\ncmVzc2lvbnMKICAgICAgICBpZiAoIShleHAgaW5zdGFuY2VvZiBFeHByZXNz\naW9uKSkKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYXNFeHByZXNzaW9u\nKChWYWx1ZSkgZXhwKTsKICAgICAgICByZXR1cm4gKEV4cHJlc3Npb24pIGV4\ncDsKICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldFZhbHVlKEpQUUxOb2Rl\nIG5vZGUpIHsKICAgICAgICByZXR1cm4gZ2V0VmFsdWUobm9kZSwgVkFSX1BB\nVEgpOwogICAgfQoKICAgIHByaXZhdGUgUGF0aCBuZXdQYXRoKFZhbHVlIHZh\nbCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgUGF0aCBwYXRoID0g\ndmFsID09IG51bGwgPyBmYWN0b3J5Lm5ld1BhdGgoKSA6IGZhY3RvcnkubmV3\nUGF0aCh2YWwpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAg\nICAgIHBhdGguc2V0TWV0YURhdGEobWV0YSk7CiAgICAgICAgcmV0dXJuIHBh\ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgVmFsdWUgZm9y\nIHRoZSBnaXZlbiBub2RlIGJ5IGV2YWwnaW5nIGl0LgogICAgICovCiAgICBw\ncml2YXRlIFZhbHVlIGdldFZhbHVlKEpQUUxOb2RlIG5vZGUsIGludCBoYW5k\nbGVWYXIpIHsKICAgICAgICBWYWx1ZSB2YWwgPSAoVmFsdWUpIGV2YWwobm9k\nZSk7CgogICAgICAgIC8vIGRldGVybWluZWQgaG93IHRvIGV2YWx1YXRlIGEg\ndmFyaWFibGUKICAgICAgICBpZiAoIXZhbC5pc1ZhcmlhYmxlKCkpCiAgICAg\nICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgZWxzZSBpZiAoaGFuZGxlVmFy\nID09IFZBUl9QQVRIICYmICEodmFsIGluc3RhbmNlb2YgUGF0aCkpCiAgICAg\nICAgICAgIHJldHVybiBuZXdQYXRoKHZhbCwgdmFsLmdldE1ldGFEYXRhKCkp\nOwogICAgICAgIGVsc2UgaWYgKGhhbmRsZVZhciA9PSBWQVJfRVJST1IpCiAg\nICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ1bmV4\ncGVjdGVkLXZhciIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5v\nZGUudGV4dCB9LCBudWxsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJl\ndHVybiB2YWw7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gUGFyc2UgQ29udGV4dCBNYW5hZ2VtZW50CiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHJpdmF0ZSBDb250ZXh0\nIGN0eCgpIHsKICAgICAgICByZXR1cm4gKENvbnRleHQpIGNvbnRleHRzLnBl\nZWsoKTsKICAgIH0KCiAgICBwcml2YXRlIEpQUUxOb2RlIHJvb3QoKSB7CiAg\nICAgICAgcmV0dXJuIGN0eCgpLnBhcnNlZC5yb290OwogICAgfQoKICAgIHBy\naXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YUZvckFsaWFzKFN0cmlu\nZyBhbGlhcykgewogICAgICAgIGZvciAoaW50IGkgPSBjb250ZXh0cy5zaXpl\nKCkgLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICBDb250ZXh0IGNv\nbnRleHQgPSAoQ29udGV4dCkgY29udGV4dHMuZ2V0KGkpOwogICAgICAgICAg\nICBpZiAoYWxpYXMuZXF1YWxzSWdub3JlQ2FzZShjb250ZXh0LnNjaGVtYUFs\naWFzKSkKICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0Lm1ldGE7CiAg\nICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwcml2\nYXRlIGNsYXNzIENvbnRleHQgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFBh\ncnNlZEpQUUwgcGFyc2VkOwogICAgICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0\nYSBtZXRhOwogICAgICAgIHByaXZhdGUgU3RyaW5nIHNjaGVtYUFsaWFzOwog\nICAgICAgIHByaXZhdGUgU3VicXVlcnkgc3VicXVlcnk7CgogICAgICAgIENv\nbnRleHQoUGFyc2VkSlBRTCBwYXJzZWQsIFN1YnF1ZXJ5IHN1YnF1ZXJ5KSB7\nCiAgICAgICAgICAgIHRoaXMucGFyc2VkID0gcGFyc2VkOwogICAgICAgICAg\nICB0aGlzLnN1YnF1ZXJ5ID0gc3VicXVlcnk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE5vZGUg\ndHJhdmVyc2FsIHV0aWxpdGllcwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwoKICAgIHByaXZhdGUgSlBRTE5vZGUgb25seUNoaWxkKEpQUUxO\nb2RlIG5vZGUpCiAgICAgICAgdGhyb3dzIFVzZXJFeGNlcHRpb24gewogICAg\nICAgIEpQUUxOb2RlIGNoaWxkID0gZmlyc3RDaGlsZChub2RlKTsKCiAgICAg\nICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMSkKICAgICAgICAgICAg\ndGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm11bHRpLWNoaWxkcmVu\nIiwKICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgbm9kZSwgQXJyYXlz\nLmFzTGlzdChub2RlLmNoaWxkcmVuKSB9LCBudWxsKTsKCiAgICAgICAgcmV0\ndXJuIGNoaWxkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUg\nbGVmdCBub2RlICh0aGUgZmlyc3Qgb2YgdGhlIGNoaWxkcmVuKSwgYW5kIGFz\nc2VydHMKICAgICAqIHRoYXQgdGhlcmUgYXJlIGV4YWN0bHkgdHdvIGNoaWxk\ncmVuLgogICAgICovCiAgICBwcml2YXRlIEpQUUxOb2RlIGxlZnQoSlBRTE5v\nZGUgbm9kZSkgewogICAgICAgIHJldHVybiBjaGlsZChub2RlLCAwLCAyKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHJpZ2h0IG5vZGUg\nKHRoZSBzZWNvbmQgb2YgdGhlIGNoaWxkcmVuKSwgYW5kIGFzc2VydHMKICAg\nICAqIHRoYXQgdGhlcmUgYXJlIGV4YWN0bHkgdHdvIGNoaWxkcmVuLgogICAg\nICovCiAgICBwcml2YXRlIEpQUUxOb2RlIHJpZ2h0KEpQUUxOb2RlIG5vZGUp\nIHsKICAgICAgICByZXR1cm4gY2hpbGQobm9kZSwgMSwgMik7CiAgICB9Cgog\nICAgcHJpdmF0ZSBKUFFMTm9kZSBjaGlsZChKUFFMTm9kZSBub2RlLCBpbnQg\nY2hpbGROdW0sIGludCBhc3NlcnRDb3VudCkgewogICAgICAgIGlmIChub2Rl\nLmNoaWxkcmVuLmxlbmd0aCAhPSBhc3NlcnRDb3VudCkKICAgICAgICAgICAg\ndGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIndyb25nLWNoaWxkLWNv\ndW50IiwKICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgbmV3IEludGVn\nZXIoYXNzZXJ0Q291bnQpLCBub2RlLAogICAgICAgICAgICAgICAgICAgIEFy\ncmF5cy5hc0xpc3Qobm9kZS5jaGlsZHJlbikgfSwgbnVsbCk7CgogICAgICAg\nIHJldHVybiBub2RlLmNoaWxkcmVuW2NoaWxkTnVtXTsKICAgIH0KCiAgICBw\ncml2YXRlIEpQUUxOb2RlIGZpcnN0Q2hpbGQoSlBRTE5vZGUgbm9kZSkgewog\nICAgICAgIGlmIChub2RlLmNoaWxkcmVuID09IG51bGwgfHwgbm9kZS5jaGls\nZHJlbi5sZW5ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNl\ncHRpb24oRVhfVVNFUiwgIm5vLWNoaWxkcmVuIiwKICAgICAgICAgICAgICAg\nIG5ldyBPYmplY3RbXXsgbm9kZSB9LCBudWxsKTsKICAgICAgICByZXR1cm4g\nbm9kZS5jaGlsZHJlblswXTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBK\nUFFMTm9kZSBzZWNvbmRDaGlsZChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAg\ncmV0dXJuIG5vZGUuY2hpbGRyZW5bMV07CiAgICB9CgogICAgcHJpdmF0ZSBz\ndGF0aWMgSlBRTE5vZGUgdGhpcmRDaGlsZChKUFFMTm9kZSBub2RlKSB7CiAg\nICAgICAgcmV0dXJuIG5vZGUuY2hpbGRyZW5bMl07CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgSlBRTE5vZGUgbGFzdENoaWxkKEpQUUxOb2RlIG5vZGUp\nIHsKICAgICAgICByZXR1cm4gbGFzdENoaWxkKG5vZGUsIDApOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIE50aCBmcm9tIHRoZSBsYXN0IGNoaWxkLiBF\nLmcuLAogICAgICogbGFzdENoaWxkKDEpIHdpbGwgcmV0dXJuIHRoZSBzZWNv\nbmQtdG8tdGhlLWxhc3QgY2hpbGQuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIEpQUUxOb2RlIGxhc3RDaGlsZChKUFFMTm9kZSBub2RlLCBpbnQgZnJv\nbUxhc3QpIHsKICAgICAgICByZXR1cm4gbm9kZS5jaGlsZHJlbltub2RlLmNo\naWxkcmVuLmxlbmd0aCAtICgxICsgZnJvbUxhc3QpXTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEJhc2Ugbm9kZSB0aGF0IHdpbGwgYmUgZ2VuZXJhdGVkIGJ5\nIHRoZSBKUFFMRXhwcmVzc2lvbkJ1aWxkZXI7IGJhc2UKICAgICAqIGNsYXNz\nIG9mIHRoZSB7QGxpbmsgU2ltcGxlTm9kZX0gdGhhdCBpcyB1c2VkIGJ5IHtA\nbGluayBKUFFMfS4KICAgICAqCiAgICAgKiBAYXV0aG9yIE1hcmMgUHJ1ZCdo\nb21tZWF1eAogICAgICogQHNlZSBOb2RlCiAgICAgKiBAc2VlIFNpbXBsZU5v\nZGUKICAgICAqLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IHN0YXRpYyBjbGFz\ncyBKUFFMTm9kZQogICAgICAgIGltcGxlbWVudHMgTm9kZSwgU2VyaWFsaXph\nYmxlIHsKCiAgICAgICAgZmluYWwgaW50IGlkOwogICAgICAgIGZpbmFsIEpQ\nUUwgcGFyc2VyOwogICAgICAgIEpQUUxOb2RlIHBhcmVudDsKICAgICAgICBK\nUFFMTm9kZVtdIGNoaWxkcmVuOwogICAgICAgIFN0cmluZyB0ZXh0OwogICAg\nICAgIGJvb2xlYW4gbm90ID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBpbkVu\ndW1QYXRoID0gZmFsc2U7CgogICAgICAgIHB1YmxpYyBKUFFMTm9kZShKUFFM\nIHBhcnNlciwgaW50IGlkKSB7CiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDsK\nICAgICAgICAgICAgdGhpcy5wYXJzZXIgPSBwYXJzZXI7CiAgICAgICAgICAg\nIHRoaXMuaW5FbnVtUGF0aCA9IHBhcnNlci5pbkVudW1QYXRoOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgamp0T3BlbigpIHsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIGpqdENsb3NlKCkgewogICAgICAgIH0K\nCiAgICAgICAgSlBRTE5vZGVbXSBmaW5kQ2hpbGRyZW5CeUlEKGludCBpZCkg\newogICAgICAgICAgICBDb2xsZWN0aW9uPEpQUUxOb2RlPiBzZXQgPSBuZXcg\nTGlua2VkSGFzaFNldDxKUFFMTm9kZT4oKTsKICAgICAgICAgICAgZmluZENo\naWxkcmVuQnlJRChpZCwgc2V0KTsKICAgICAgICAgICAgcmV0dXJuIHNldC50\nb0FycmF5KG5ldyBKUFFMTm9kZVtzZXQuc2l6ZSgpXSk7CiAgICAgICAgfQoK\nICAgICAgICBwcml2YXRlIHZvaWQgZmluZENoaWxkcmVuQnlJRChpbnQgaWQs\nIENvbGxlY3Rpb248SlBRTE5vZGU+IHNldCkgewogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgY2hpbGRyZW4gIT0gbnVsbCAmJiBpIDwgY2hpbGRyZW4u\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChjaGlsZHJlbltp\nXS5pZCA9PSBpZCkKICAgICAgICAgICAgICAgICAgICBzZXQuYWRkKGNoaWxk\ncmVuW2ldKTsKCiAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS5maW5kQ2hp\nbGRyZW5CeUlEKGlkLCBzZXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBib29sZWFuIGhhc0NoaWxkSUQoaW50IGlkKSB7CiAgICAgICAg\nICAgIHJldHVybiBmaW5kQ2hpbGRCeUlEKGlkLCBmYWxzZSkgIT0gbnVsbDsK\nICAgICAgICB9CgogICAgICAgIEpQUUxOb2RlIGZpbmRDaGlsZEJ5SUQoaW50\nIGlkLCBib29sZWFuIHJlY3Vyc2UpIHsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGNoaWxkcmVuICE9IG51bGwgJiYgaSA8IGNoaWxkcmVuLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBKUFFMTm9kZSBjaGlsZCA9IGNo\naWxkcmVuW2ldOwoKICAgICAgICAgICAgICAgIGlmIChjaGlsZC5pZCA9PSBp\nZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGRyZW5baV07Cgog\nICAgICAgICAgICAgICAgaWYgKHJlY3Vyc2UpIHsKICAgICAgICAgICAgICAg\nICAgICBKUFFMTm9kZSBmb3VuZCA9IGNoaWxkLmZpbmRDaGlsZEJ5SUQoaWQs\nIHJlY3Vyc2UpOwogICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm91bmQ7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIG5vdCBmb3VuZAogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIGpqdFNldFBhcmVudChOb2RlIHBhcmVu\ndCkgewogICAgICAgICAgICB0aGlzLnBhcmVudCA9IChKUFFMTm9kZSkgcGFy\nZW50OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE5vZGUgamp0R2V0UGFy\nZW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQ7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBqanRBZGRDaGlsZChOb2RlIG4s\nIGludCBpKSB7CiAgICAgICAgICAgIGlmIChjaGlsZHJlbiA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IG5ldyBKUFFMTm9kZVtpICsg\nMV07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+PSBjaGlsZHJlbi5sZW5n\ndGgpIHsKICAgICAgICAgICAgICAgIEpQUUxOb2RlIGNbXSA9IG5ldyBKUFFM\nTm9kZVtpICsgMV07CiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5\nKGNoaWxkcmVuLCAwLCBjLCAwLCBjaGlsZHJlbi5sZW5ndGgpOwogICAgICAg\nICAgICAgICAgY2hpbGRyZW4gPSBjOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBjaGlsZHJlbltpXSA9IChKUFFMTm9kZSkgbjsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBOb2RlIGpqdEdldENoaWxkKGludCBpKSB7CiAgICAg\nICAgICAgIHJldHVybiBjaGlsZHJlbltpXTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBpbnQgZ2V0Q2hpbGRDb3VudCgpIHsKICAgICAgICAgICAgcmV0\ndXJuIGpqdEdldE51bUNoaWxkcmVuKCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSlBRTE5vZGUgZ2V0Q2hpbGQoaW50IGluZGV4KSB7CiAgICAgICAg\nICAgIHJldHVybiAoSlBRTE5vZGUpIGpqdEdldENoaWxkKGluZGV4KTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBJdGVyYXRvciBpdGVyYXRvcigpIHsK\nICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5hc0xpc3QoY2hpbGRyZW4pLml0\nZXJhdG9yKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGpqdEdl\ndE51bUNoaWxkcmVuKCkgewogICAgICAgICAgICByZXR1cm4gKGNoaWxkcmVu\nID09IG51bGwpID8gMCA6IGNoaWxkcmVuLmxlbmd0aDsKICAgICAgICB9Cgog\nICAgICAgIHZvaWQgc2V0VGV4dChTdHJpbmcgdGV4dCkgewogICAgICAgICAg\nICB0aGlzLnRleHQgPSB0ZXh0OwogICAgICAgIH0KCiAgICAgICAgdm9pZCBz\nZXRUb2tlbihUb2tlbiB0KSB7CiAgICAgICAgICAgIHNldFRleHQodC5pbWFn\nZSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5n\nKCkgewogICAgICAgICAgICByZXR1cm4gSlBRTFRyZWVDb25zdGFudHMuamp0\nTm9kZU5hbWVbdGhpcy5pZF07CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nU3RyaW5nIHRvU3RyaW5nKFN0cmluZyBwcmVmaXgpIHsKICAgICAgICAgICAg\ncmV0dXJuIHByZWZpeCArIHRvU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBEZWJ1Z2dpbmcgbWV0aG9kLgogICAgICAgICAq\nCiAgICAgICAgICogQHNlZSAjZHVtcChqYXZhLmlvLlByaW50U3RyZWFtLFN0\ncmluZykKICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBkdW1wKFN0\ncmluZyBwcmVmaXgpIHsKICAgICAgICAgICAgZHVtcChTeXN0ZW0ub3V0LCBw\ncmVmaXgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgZHVtcCgp\nIHsKICAgICAgICAgICAgZHVtcCgiICIpOwogICAgICAgIH0KCiAgICAgICAg\nLyoqCiAgICAgICAgICogRGVidWdnaW5nIG1ldGhvZCB0byBvdXRwdXQgYSBw\nYXJzZSB0cmVlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG91dCB0\naGUgc3RyZWFtIHRvIHdoaWNoIHRvIHdyaXRlIHRoZSBkZWJ1Z2dpbmcgaW5m\nbwogICAgICAgICAqIEBwYXJhbSBwcmVmaXggdGhlIHByZWZpeCB0byB3cml0\nZSBvdXQgYmVmb3JlIGxpbmVzCiAgICAgICAgICovCiAgICAgICAgcHVibGlj\nIHZvaWQgZHVtcChQcmludFN0cmVhbSBvdXQsIFN0cmluZyBwcmVmaXgpIHsK\nICAgICAgICAgICAgZHVtcChvdXQsIHByZWZpeCwgZmFsc2UpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgZHVtcChQcmludFN0cmVhbSBvdXQs\nIFN0cmluZyBwcmVmaXgsIGJvb2xlYW4gdGV4dCkgewogICAgICAgICAgICBv\ndXQucHJpbnRsbih0b1N0cmluZyhwcmVmaXgpCiAgICAgICAgICAgICAgICAr\nICh0ZXh0ICYmIHRoaXMudGV4dCAhPSBudWxsID8gIiBbIiArIHRoaXMudGV4\ndCArICJdIiA6ICIiKSk7CiAgICAgICAgICAgIGlmIChjaGlsZHJlbiAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNo\naWxkcmVuLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgSlBR\nTE5vZGUgbiA9IChKUFFMTm9kZSkgY2hpbGRyZW5baV07CiAgICAgICAgICAg\nICAgICAgICAgaWYgKG4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBuLmR1bXAob3V0LCBwcmVmaXggKyAiICIsIHRleHQpOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFB1YmxpYyBmb3Ig\ndW5pdCB0ZXN0aW5nIHB1cnBvc2VzLgogICAgICogQG5vamF2YWRvYwogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFBhcnNlZEpQUUwKICAgICAg\nICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIC8vIFRoaXMg\naXMgb25seSBldmVyIHVzZWQgZHVyaW5nIHBhcnNlOyB3aGVuIFBhcnNlZEpQ\nUUwgaW5zdGFuY2VzCiAgICAgICAgLy8gYXJlIHNlcmlhbGl6ZWQsIHRoZXkg\nd2lsbCBoYXZlIGFscmVhZHkgYmVlbiBwYXJzZWQuCiAgICAgICAgcHJpdmF0\nZSBmaW5hbCB0cmFuc2llbnQgSlBRTE5vZGUgcm9vdDsKCiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBTdHJpbmcgcXVlcnk7CiAgICAgICAgCiAgICAgICAgLy8g\nY2FjaGUgb2YgY2FuZGlkYXRlIHR5cGUgZGF0YS4gVGhpcyBpcyBzdG9yZWQg\naGVyZSBpbiBjYXNlIHRoaXMgIAogICAgICAgIC8vIHBhcnNlIHRyZWUgaXMg\ncmV1c2VkIGluIGEgY29udGV4dCB0aGF0IGRvZXMgbm90IGtub3cgd2hhdCB0\naGUgCiAgICAgICAgLy8gY2FuZGlkYXRlIHR5cGUgaXMgYWxyZWFkeS4gCiAg\nICAgICAgcHJpdmF0ZSBDbGFzcyBfY2FuZGlkYXRlVHlwZTsKCiAgICAgICAg\nUGFyc2VkSlBRTChTdHJpbmcganBxbCkgewogICAgICAgICAgICB0aGlzKGpw\ncWwsIHBhcnNlKGpwcWwpKTsKICAgICAgICB9CgogICAgICAgIFBhcnNlZEpQ\nUUwoU3RyaW5nIHF1ZXJ5LCBKUFFMTm9kZSByb290KSB7CiAgICAgICAgICAg\nIHRoaXMucm9vdCA9IHJvb3Q7CiAgICAgICAgICAgIHRoaXMucXVlcnkgPSBx\ndWVyeTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgc3RhdGljIEpQUUxO\nb2RlIHBhcnNlKFN0cmluZyBqcHFsKSB7CiAgICAgICAgICAgIGlmIChqcHFs\nID09IG51bGwpCiAgICAgICAgICAgICAgICBqcHFsID0gIiI7CgogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIChKUFFMTm9kZSkg\nbmV3IEpQUUwoanBxbCkucGFyc2VRdWVyeSgpOwogICAgICAgICAgICB9IGNh\ndGNoIChFcnJvciBlKSB7CiAgICAgICAgICAgICAgICAvLyBzcGVjaWFsIGhh\nbmRsaW5nIGZvciBFcnJvciBzdWJjbGFzc2VzLCB3aGljaCB0aGUKICAgICAg\nICAgICAgICAgIC8vIHBhcnNlciBtYXkgc29tZXRpbWVzICh1bmZvcnR1bmF0\nZWx5KSB0aHJvdwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoInBhcnNlLWVycm9yIiwKICAgICAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W117IGUudG9TdHJpbmcoKSwganBxbCB9KSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZvaWQgcG9wdWxhdGUo\nRXhwcmVzc2lvblN0b3JlUXVlcnkgcXVlcnkpIHsKICAgICAgICAgICAgUXVl\ncnlDb250ZXh0IGN0eCA9IHF1ZXJ5LmdldENvbnRleHQoKTsKCiAgICAgICAg\nICAgIC8vIGlmIHRoZSBvd25pbmcgcXVlcnkncyBjb250ZXh0IGRvZXMgbm90\nIGhhdmUKICAgICAgICAgICAgLy8gYW55IGNhbmRpZGF0ZSBjbGFzcywgdGhl\nbiBzZXQgaXQgaGVyZQogICAgICAgICAgICBpZiAoY3R4LmdldENhbmRpZGF0\nZVR5cGUoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX2NhbmRp\nZGF0ZVR5cGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfY2FuZGlk\nYXRlVHlwZSA9IG5ldyBKUFFMRXhwcmVzc2lvbkJ1aWxkZXIKICAgICAgICAg\nICAgICAgICAgICAgICAgKG51bGwsIHF1ZXJ5LCB0aGlzKS5nZXRDYW5kaWRh\ndGVUeXBlKCk7CiAgICAgICAgICAgICAgICBjdHguc2V0Q2FuZGlkYXRlVHlw\nZShfY2FuZGlkYXRlVHlwZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgCiAgICAgICAgLyoqCiAgICAgICAgICogUHVibGljIGZv\nciB1bml0IHRlc3RpbmcgcHVycG9zZXMuCiAgICAgICAgICovCiAgICAgICAg\ncHVibGljIENsYXNzIGdldENhbmRpZGF0ZVR5cGUoKSB7CiAgICAgICAgICAg\nIHJldHVybiBfY2FuZGlkYXRlVHlwZTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBTdHJpbmcgdG9TdHJpbmcgKCkKCQl7CgkJCXJldHVybiB0aGlzLnF1\nZXJ5OwoJCX0KCX0KfQoK\n","encoding":"base64"}

