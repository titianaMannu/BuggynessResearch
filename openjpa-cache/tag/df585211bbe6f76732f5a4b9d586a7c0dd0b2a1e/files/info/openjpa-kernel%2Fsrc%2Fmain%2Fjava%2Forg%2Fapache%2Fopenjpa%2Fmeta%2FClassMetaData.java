{"sha":"ff281018388d031b17ea3a43b71a659ad610341d","node_id":"MDQ6QmxvYjIwNjM2NDpmZjI4MTAxODM4OGQwMzFiMTdlYTNhNDNiNzFhNjU5YWQ2MTAzNDFk","size":80058,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ff281018388d031b17ea3a43b71a659ad610341d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2\nYS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1w\nb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7\nCmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5EYXRhQ2FjaGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJs\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5WYWx1ZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5WYWx1ZUxpc3Rl\nbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLlNvdXJjZVRyYWNr\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1By\naXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi54bWwu\nQ29tbWVudGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\naWdEZWNpbWFsSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\naWdJbnRlZ2VySWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\neXRlSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DaGFySWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5EYXRlSWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Eb3VibGVJZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50SWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkxvbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0SWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5PcGVuSlBBSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5TaG9ydElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuU3RyaW5nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5n\nczsKCi8qKgogKiBDb250YWlucyBtZXRhZGF0YSBhYm91dCBhIHBlcnNpc3Rl\nbnQgdHlwZS4KICogVGhpcyBtZXRhZGF0YSBpcyBhdmFpbGFibGUgYm90aCBh\ndCBlbmhhbmNlbWVudCB0aW1lIGFuZCBydW50aW1lLgogKiAgTm90ZSB0aGF0\nIHRoaXMgY2xhc3MgZW1wbG95cyBhZ2dyZXNzaXZlIGNhY2hpbmcsIGFuZCB0\naGVyZWZvcmUgaXQgaXMKICogaW1wb3J0YW50IHRvIGZpbmFsaXplIHRoZSBj\nb25maWd1cmF0aW9uIG9mIGZpZWxkIG1ldGFkYXRhcyBiZWZvcmUgaW52b2tp\nbmcKICogbWV0aG9kcyB0aGF0IGRlcGVuZCBvbiB0aGF0IGNvbmZpZ3VyYXRp\nb24sIHN1Y2ggYXMKICoge0BsaW5rICNnZXRQcmltYXJ5S2V5RmllbGRzfS4K\nICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCnB1YmxpYyBjbGFzcyBDbGFz\nc01ldGFEYXRhCiAgICBleHRlbmRzIEV4dGVuc2lvbnMKICAgIGltcGxlbWVu\ndHMgQ29tcGFyYWJsZSwgU291cmNlVHJhY2tlciwgTWV0YURhdGFDb250ZXh0\nLCBNZXRhRGF0YU1vZGVzLAogICAgQ29tbWVudGFibGUsIFZhbHVlTGlzdGVu\nZXIgewoKICAgIC8qKgogICAgICogVW5rb253biBpZGVudGl0eSB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBJRF9VTktOT1dO\nID0gMDsKCiAgICAvKioKICAgICAqIERhdGFzdG9yZSBpZGVudGl0eSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBJRF9EQVRB\nU1RPUkUgPSAxOwoKICAgIC8qKgogICAgICogQXBwbGljYXRpb24gaWRlbnRp\ndHkgdHlwZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nSURfQVBQTElDQVRJT04gPSAyOwoKICAgIC8qKgogICAgICogVW5rbm93biBh\nY2Nlc3MgdHlwZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgQUNDRVNTX1VOS05PV04gPSAwOwoKICAgIC8qKgogICAgICogUGVyc2lz\ndGVudCBhdHRyaWJ1dGVzIGFyZSBhY2Nlc3NlZCB2aWEgZGlyZWN0IGZpZWxk\nIGFjY2Vzcy4gQml0IGZsYWcuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IEFDQ0VTU19GSUVMRCA9IDIgPDwgMDsKCiAgICAvKioKICAg\nICAqIFBlcnNpc3RlbnQgYXR0cmlidXRlcyBhcmUgYWNjZXNzZWQgdmlhIHNl\ndHRlcnMgYW5kIGdldHRlcnMuIEJpdCBmbGFnLgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBBQ0NFU1NfUFJPUEVSVFkgPSAyIDw8IDE7\nCgogICAgLyoqCiAgICAgKiBWYWx1ZSBmb3IgdXNpbmcgYSBzeW50aGV0aWMg\nZGV0YWNoZWQgc3RhdGUgZmllbGQsIHdoaWNoIGlzIHRoZSBkZWZhdWx0Lgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTWU5USEVU\nSUMgPSAiYHN5biI7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgREVGQVVMVF9TVFJJTkcgPSAiYCI7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQog\nICAgICAgIChDbGFzc01ldGFEYXRhLmNsYXNzKTsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBGZXRjaEdyb3VwW10gRU1QVFlfRkVUQ0hfR1JPVVBfQVJS\nQVkKICAgICAgICA9IG5ldyBGZXRjaEdyb3VwWzBdOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgU3RyaW5nW10gRU1QVFlfU1RSSU5HX0FSUkFZID0gbmV3\nIFN0cmluZ1swXTsKCiAgICBwcml2YXRlIE1ldGFEYXRhUmVwb3NpdG9yeSBf\ncmVwb3M7CiAgICBwcml2YXRlIHRyYW5zaWVudCBDbGFzc0xvYWRlciBfbG9h\nZGVyID0gbnVsbDsKCiAgICBwcml2YXRlIGZpbmFsIFZhbHVlTWV0YURhdGEg\nX293bmVyOwogICAgcHJpdmF0ZSBmaW5hbCBMaWZlY3ljbGVNZXRhRGF0YSBf\nbGlmZU1ldGEgPSBuZXcgTGlmZWN5Y2xlTWV0YURhdGEodGhpcyk7CiAgICBw\ncml2YXRlIEZpbGUgX3NyY0ZpbGUgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQg\nX3NyY1R5cGUgPSBTUkNfT1RIRVI7CiAgICBwcml2YXRlIFN0cmluZ1tdIF9j\nb21tZW50cyA9IG51bGw7CiAgICBwcml2YXRlIGludCBfbGlzdEluZGV4ID0g\nLTE7CiAgICBwcml2YXRlIGludCBfc3JjTW9kZSA9IE1PREVfTUVUQSB8IE1P\nREVfTUFQUElORzsKICAgIHByaXZhdGUgaW50IF9yZXNNb2RlID0gTU9ERV9O\nT05FOwoKICAgIHByaXZhdGUgQ2xhc3MgX3R5cGUgPSBPYmplY3QuY2xhc3M7\nCiAgICBwcml2YXRlIGZpbmFsIE1hcCBfZmllbGRNYXAgPSBuZXcgVHJlZU1h\ncCgpOwogICAgcHJpdmF0ZSBNYXAgX3N1cEZpZWxkTWFwID0gbnVsbDsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfZGVmU3VwRmllbGRzID0gZmFsc2U7CiAgICBw\ncml2YXRlIENvbGxlY3Rpb24gX3N0YXRpY0ZpZWxkcyA9IG51bGw7CiAgICBw\ncml2YXRlIGludFtdIF9maWVsZERhdGFUYWJsZSA9IG51bGw7CiAgICBwcml2\nYXRlIE1hcCBfZmdNYXAgPSBudWxsOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBOb3RlOiBpZiB5b3UgYWRkIGFkZGl0aW9uYWwgc3Rh\ndGUsIG1ha2Ugc3VyZSB0byBhZGQgaXQgdG8gY29weSgpCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwoKICAgIHByaXZhdGUgQ2xhc3MgX29iamVjdElk\nID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBfb2JqZWN0SWRTaGFyZWQg\nPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9vcGVuanBhSWQgPSBudWxs\nOwogICAgcHJpdmF0ZSBCb29sZWFuIF9leHRlbnQgPSBudWxsOwogICAgcHJp\ndmF0ZSBCb29sZWFuIF9lbWJlZGRlZCA9IG51bGw7CiAgICBwcml2YXRlIEJv\nb2xlYW4gX2ludGVyZmFjZSA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzIF9p\nbXBsID0gbnVsbDsKICAgIHByaXZhdGUgTGlzdCBfaW50ZXJmYWNlcyA9IG51\nbGw7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfaWZhY2VNYXAgPSBuZXcgSGFz\naE1hcCgpOwogICAgcHJpdmF0ZSBpbnQgX2lkZW50aXR5ID0gSURfVU5LTk9X\nTjsKICAgIHByaXZhdGUgaW50IF9pZFN0cmF0ZWd5ID0gVmFsdWVTdHJhdGVn\naWVzLk5PTkU7CiAgICBwcml2YXRlIGludCBfYWNjZXNzVHlwZSA9IEFDQ0VT\nU19VTktOT1dOOwoKICAgIHByaXZhdGUgU3RyaW5nIF9zZXFOYW1lID0gREVG\nQVVMVF9TVFJJTkc7CiAgICBwcml2YXRlIFNlcXVlbmNlTWV0YURhdGEgX3Nl\ncU1ldGEgPSBudWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX2NhY2hlTmFtZSA9\nIERFRkFVTFRfU1RSSU5HOwogICAgcHJpdmF0ZSBpbnQgX2NhY2hlVGltZW91\ndCA9IEludGVnZXIuTUlOX1ZBTFVFOwogICAgcHJpdmF0ZSBCb29sZWFuIF9k\nZXRhY2hhYmxlID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9kZXRhY2hT\ndGF0ZSA9IERFRkFVTFRfU1RSSU5HOwogICAgcHJpdmF0ZSBTdHJpbmcgX2Fs\naWFzID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF92ZXJzaW9uSWR4ID0gSW50\nZWdlci5NSU5fVkFMVUU7CgogICAgcHJpdmF0ZSBDbGFzcyBfc3VwZXIgPSBu\ndWxsOwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIF9zdXBlck1ldGEgPSBu\ndWxsOwogICAgcHJpdmF0ZSBDbGFzc1tdIF9zdWJzID0gbnVsbDsKICAgIHBy\naXZhdGUgQ2xhc3NNZXRhRGF0YVtdIF9zdWJNZXRhcyA9IG51bGw7CiAgICBw\ncml2YXRlIENsYXNzTWV0YURhdGFbXSBfbWFwU3ViTWV0YXMgPSBudWxsOwoK\nICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9maWVsZHMgPSBudWxsOwog\nICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX3VubWdkRmllbGRzID0gbnVs\nbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9hbGxGaWVsZHMgPSBu\ndWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2FsbFBLRmllbGRz\nID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9hbGxERkdG\naWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2Rl\nZmluZWRGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRh\nW10gX2xpc3RpbmdGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1l\ndGFEYXRhW10gX2FsbExpc3RpbmdGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0\nZSBGZXRjaEdyb3VwW10gX2ZncyA9IG51bGw7CiAgICBwcml2YXRlIEZldGNo\nR3JvdXBbXSBfY3VzdG9tRkdzID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfaW50ZXJjZXB0aW5nID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBDb25z\ndHJ1Y3Rvci4gU3VwcGx5IGRlc2NyaWJlZCB0eXBlIGFuZCByZXBvc2l0b3J5\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YShDbGFzcyB0\neXBlLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICBfcmVw\nb3MgPSByZXBvczsKICAgICAgICBfb3duZXIgPSBudWxsOwogICAgICAgIHNl\ndERlc2NyaWJlZFR5cGUodHlwZSk7CiAgICAgICAgcmVnaXN0ZXJGb3JWYWx1\nZVVwZGF0ZSgiRGF0YUNhY2hlVGltZW91dCIpOwogICAgfQoKICAgIC8qKgog\nICAgICogRW1iZWRkZWQgY29uc3RydWN0b3IuIFN1cHBseSBlbWJlZGRpbmcg\ndmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhKFZh\nbHVlTWV0YURhdGEgb3duZXIpIHsKICAgICAgICBfb3duZXIgPSBvd25lcjsK\nICAgICAgICBfcmVwb3MgPSBvd25lci5nZXRSZXBvc2l0b3J5KCk7CiAgICAg\nICAgc2V0RW52Q2xhc3NMb2FkZXIob3duZXIuZ2V0RmllbGRNZXRhRGF0YSgp\nLmdldERlZmluaW5nTWV0YURhdGEoKS4KICAgICAgICAgICAgZ2V0RW52Q2xh\nc3NMb2FkZXIoKSk7CiAgICAgICAgcmVnaXN0ZXJGb3JWYWx1ZVVwZGF0ZSgi\nRGF0YUNhY2hlVGltZW91dCIpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBvd25pbmcgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHVibGlj\nIE1ldGFEYXRhUmVwb3NpdG9yeSBnZXRSZXBvc2l0b3J5KCkgewogICAgICAg\nIHJldHVybiBfcmVwb3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGlz\nIG1ldGFkYXRhIGlzIGZvciBhbiBlbWJlZGRlZCBvYmplY3QsIHJldHVybmlu\nZyB0aGUgb3duaW5nIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgVmFsdWVN\nZXRhRGF0YSBnZXRFbWJlZGRpbmdNZXRhRGF0YSgpIHsKICAgICAgICByZXR1\ncm4gX293bmVyOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHBlcnNpc3Rl\nbmNlIGNhcGFibGUgY2xhc3MgZGVzY3JpYmVkIGJ5IHRoaXMgbWV0YWRhdGEu\nCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzcyBnZXREZXNjcmliZWRUeXBlKCkg\newogICAgICAgIHJldHVybiBfdHlwZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgY2xhc3MgZGVzY2liZWQgYnkgdGhpcyBtZXRhZGF0YS4gVGhl\nIHR5cGUgbWF5IGJlIHJlc2V0IHdoZW4KICAgICAqIGFuIGVtYmVkZGVkIHZh\nbHVlIGNoYW5nZXMgaXRzIGRlY2xhcmVkIHR5cGUuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIHNldERlc2NyaWJlZFR5cGUoQ2xhc3MgdHlwZSkgewog\nICAgICAgIGlmICh0eXBlLmdldFN1cGVyY2xhc3MoKSAhPSBudWxsICYmICJq\nYXZhLmxhbmcuRW51bSIuZXF1YWxzCiAgICAgICAgICAgICh0eXBlLmdldFN1\ncGVyY2xhc3MoKS5nZXROYW1lKCkpKQogICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImVudW0iLCB0eXBlKSk7CiAg\nICAgICAgX3R5cGUgPSB0eXBlOwogICAgICAgIGlmIChQZXJzaXN0ZW5jZUNh\ncGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAg\nICAgc2V0SW50ZXJjZXB0aW5nKHRydWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIGVudmlyb25tZW50YWwgbG9hZGVyIHVzZWQgd2hlbiBsb2FkaW5n\nIHRoaXMgbWV0YWRhdGEuCiAgICAgKiBUaGUgY2xhc3MgbWV0YWRhdGEgc2hv\ndWxkIHVzZSB0aGlzIGxvYWRlciB3aGVuIGxvYWRpbmcgbWV0YWRhdGEgZm9y\nCiAgICAgKiBpdHMgc3VwZXJjbGFzcyBhbmQgZmllbGQgdHlwZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBDbGFzc0xvYWRlciBnZXRFbnZDbGFzc0xvYWRlcigp\nIHsKICAgICAgICByZXR1cm4gX2xvYWRlcjsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBjbGFzcyBlbnZpcm9ubWVudGFsIGxvYWRlciB1c2VkIHdoZW4g\nbG9hZGluZyB0aGlzIG1ldGFkYXRhLgogICAgICogVGhlIGNsYXNzIG1ldGFk\nYXRhIHNob3VsZCB1c2UgdGhpcyBsb2FkZXIgd2hlbiBsb2FkaW5nIG1ldGFk\nYXRhIGZvcgogICAgICogaXRzIHN1cGVyY2xhc3MgYW5kIGZpZWxkIHR5cGVz\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbnZDbGFzc0xvYWRlcihD\nbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBfbG9hZGVyID0gbG9hZGVy\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHBlcnNpc3RlbmNlIGNhcGFi\nbGUgc3VwZXJjbGFzcyBvZiB0aGUgZGVzY3JpYmVkIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBDbGFzcyBnZXRQQ1N1cGVyY2xhc3MoKSB7CiAgICAgICAg\ncmV0dXJuIF9zdXBlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBwZXJz\naXN0ZW5jZSBjYXBhYmxlIHN1cGVyY2xhc3Mgb2YgdGhlIGRlc2NyaWJlZCB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQQ1N1cGVyY2xhc3Mo\nQ2xhc3MgcGMpIHsKICAgICAgICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAg\nICAgICBfc3VwZXIgPSBwYzsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBt\nZXRhZGF0YSBmb3IgdGhpcyBjbGFzcycgc3VwZXJjbGFzcy4KICAgICAqLwog\nICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKSB7CiAgICAgICAgaWYgKF9zdXBlck1ldGEgPT0gbnVsbCAmJiBfc3Vw\nZXIgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX293bmVyICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIF9zdXBlck1ldGEgPSBfcmVwb3MubmV3RW1i\nZWRkZWRDbGFzc01ldGFEYXRhKF9vd25lcik7CiAgICAgICAgICAgICAgICBf\nc3VwZXJNZXRhLnNldERlc2NyaWJlZFR5cGUoX3N1cGVyKTsKICAgICAgICAg\nICAgfSBlbHNlCiAgICAgICAgICAgICAgICBfc3VwZXJNZXRhID0gX3JlcG9z\nLmdldE1ldGFEYXRhKF9zdXBlciwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBfc3VwZXJNZXRhOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIG1ldGFkYXRhIGZvciB0aGlzIGNsYXNzJyBzdXBlcmNsYXNz\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBjbGVhckFsbEZp\nZWxkQ2FjaGUoKTsKICAgICAgICBfc3VwZXJNZXRhID0gbWV0YTsKICAgICAg\nICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICBzZXRQQ1N1cGVyY2xh\nc3MobWV0YS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciB0aGlzIGNsYXNzIGlzIG1hcHBlZCB0byB0aGUgZGF0\nYXN0b3JlLiBCeSBkZWZhdWx0LCBvbmx5CiAgICAgKiByZXR1cm5zIGZhbHNl\nIGlmIGNsYXNzIGlzIGVtYmVkZGVkLW9ubHksIGJ1dCBzdWJjbGFzc2VzIG1p\nZ2h0IG92ZXJyaWRlCiAgICAgKiB0byBhbGxvdyB1bm1hcHBlZCBvdGhlciB0\neXBlcy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNNYXBwZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9lbWJlZGRlZCAhPSBCb29sZWFuLlRSVUU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNsb3Nlc3QgbWFwcGVk\nIHN1cGVyY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRh\nIGdldE1hcHBlZFBDU3VwZXJjbGFzc01ldGFEYXRhKCkgewogICAgICAgIENs\nYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsK\nICAgICAgICBpZiAoc3VwID09IG51bGwgfHwgc3VwLmlzTWFwcGVkKCkpCiAg\nICAgICAgICAgIHJldHVybiBzdXA7CiAgICAgICAgcmV0dXJuIHN1cC5nZXRN\nYXBwZWRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBrbm93biBwZXJzaXN0ZW5jZSBjYXBhYmxlIHN1\nYmNsYXNzZXMgb2YgdGhlIGRlc2NyaWJlZCB0eXBlLAogICAgICogb3IgZW1w\ndHkgYXJyYXkgaWYgbm9uZSBvciBpZiB0aGlzIGlzIGVtYmVkZGVkIG1ldGFk\nYXRhLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NbXSBnZXRQQ1N1YmNsYXNz\nZXMoKSB7CiAgICAgICAgaWYgKF9vd25lciAhPSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gX3JlcG9zLkVNUFRZX0NMQVNTRVM7CgogICAgICAgIF9yZXBv\ncy5wcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMoX2xvYWRlcik7CiAgICAgICAg\naWYgKF9zdWJzID09IG51bGwpIHsKICAgICAgICAgICAgQ29sbGVjdGlvbiBz\ndWJzID0gX3JlcG9zLmdldFBDU3ViY2xhc3NlcyhfdHlwZSk7CiAgICAgICAg\nICAgIF9zdWJzID0gKENsYXNzW10pIHN1YnMudG9BcnJheShuZXcgQ2xhc3Nb\nc3Vicy5zaXplKCldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9zdWJz\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBm\nb3IgdGhlIGtub3duIHBlcnNpc3RlbmNlIGNhcGFibGUgc3ViY2xhc3NlcyBv\nZgogICAgICogdGhlIGRlc2NyaWJlZCB0eXBlLCBvciBlbXB0eSBhcnJheSBp\nZiBub25lIG9yIGlmIHRoaXMgaXMgZW1iZWRkZWQKICAgICAqIG1ldGFkYXRh\nLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdldFBDU3Vi\nY2xhc3NNZXRhRGF0YXMoKSB7CiAgICAgICAgaWYgKF9vd25lciAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gX3JlcG9zLkVNUFRZX01FVEFTOwoKICAg\nICAgICBDbGFzc1tdIHN1YnMgPSBnZXRQQ1N1YmNsYXNzZXMoKTsgLy8gY2hl\nY2tzIGZvciBuZXcKICAgICAgICBpZiAoX3N1Yk1ldGFzID09IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKHN1YnMubGVuZ3RoID09IDApCiAgICAgICAgICAg\nICAgICBfc3ViTWV0YXMgPSBfcmVwb3MuRU1QVFlfTUVUQVM7CiAgICAgICAg\nICAgIGVsc2UgewogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1l\ndGFzID0gX3JlcG9zLm5ld0NsYXNzTWV0YURhdGFBcnJheQogICAgICAgICAg\nICAgICAgICAgIChzdWJzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHN1YnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nICAgICAgICAgbWV0YXNbaV0gPSBfcmVwb3MuZ2V0TWV0YURhdGEoc3Vic1tp\nXSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBfc3ViTWV0YXMg\nPSBtZXRhczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX3N1Yk1ldGFzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFs\nbCBtYXBwZWQgc3ViY2xhc3Nlcy4KICAgICAqLwogICAgcHVibGljIENsYXNz\nTWV0YURhdGFbXSBnZXRNYXBwZWRQQ1N1YmNsYXNzTWV0YURhdGFzKCkgewog\nICAgICAgIGlmIChfb3duZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIF9yZXBvcy5FTVBUWV9NRVRBUzsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtd\nIHN1YnMgPSBnZXRQQ1N1YmNsYXNzTWV0YURhdGFzKCk7IC8vIGNoZWNrcyBm\nb3IgbmV3CiAgICAgICAgaWYgKF9tYXBTdWJNZXRhcyA9PSBudWxsKSB7CiAg\nICAgICAgICAgIGlmIChzdWJzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAg\nICAgX21hcFN1Yk1ldGFzID0gc3ViczsKICAgICAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgICAgICBMaXN0IG1hcHBlZCA9IG5ldyBBcnJheUxpc3Qoc3Vi\ncy5sZW5ndGgpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBzdWJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGlmIChz\ndWJzW2ldLmlzTWFwcGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1h\ncHBlZC5hZGQoc3Vic1tpXSk7CiAgICAgICAgICAgICAgICBfbWFwU3ViTWV0\nYXMgPSAoQ2xhc3NNZXRhRGF0YVtdKSBtYXBwZWQudG9BcnJheQogICAgICAg\nICAgICAgICAgICAgIChfcmVwb3MubmV3Q2xhc3NNZXRhRGF0YUFycmF5KG1h\ncHBlZC5zaXplKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gX21hcFN1Yk1ldGFzOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHR5cGUgb2YgaWRlbnRpdHkgYmVpbmcgdXNlZC4gVGhpcyB3aWxsIGJl\nIG9uZSBvZjoKICAgICAqIDx1bD4KICAgICAqIDxsaT57QGxpbmsgI0lEX1VO\nS05PV059OiB1bmtub3duIGlkZW50aXR5IHR5cGU8L2xpPgogICAgICogPGxp\nPntAbGluayAjSURfREFUQVNUT1JFfTogaWRlbnRpdHkgbWFuYWdlZCBieSB0\naGUgZGF0YSBzdG9yZSBhbmQKICAgICAqIGluZGVwZW5kZW50CW9mIHRoZSBm\naWVsZHMgb2YgdGhlIGluc3RhbmNlPC9saT4KICAgICAqIDxsaT57QGxpbmsg\nI0lEX0FQUExJQ0FUSU9OfTogaWRlbnRpdHkgbWFuYWdlZCBieSB0aGUgYXBw\nbGljYXRpb24gYW5kCiAgICAgKiBkZWZpbmVkIGJ5IG9uZSBvciBtb3JlIGZp\nZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xpPgogICAgICogPC91bD4gSWYgdW5z\ncGVjaWZpZWQsIGRlZmF1bHRzIHRvIHtAbGluayAjSURfREFUQVNUT1JFfSBp\nZiB0aGVyZSBhcmUgbm8KICAgICAqIHByaW1hcnkga2V5IGZpZWxkcywgYW5k\nIHtAbGluayAjSURfQVBQTElDQVRJT059IG90aGVyd2lzZS4KICAgICAqLwog\nICAgcHVibGljIGludCBnZXRJZGVudGl0eVR5cGUoKSB7CiAgICAgICAgaWYg\nKF9pZGVudGl0eSA9PSBJRF9VTktOT1dOKSB7CiAgICAgICAgICAgIENsYXNz\nTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAg\nICAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5nZXRJZGVudGl0eVR5\ncGUoKSAhPSBJRF9VTktOT1dOKQogICAgICAgICAgICAgICAgX2lkZW50aXR5\nID0gc3VwLmdldElkZW50aXR5VHlwZSgpOwogICAgICAgICAgICBlbHNlIGlm\nIChnZXRQcmltYXJ5S2V5RmllbGRzKCkubGVuZ3RoID4gMCkKICAgICAgICAg\nICAgICAgIF9pZGVudGl0eSA9IElEX0FQUExJQ0FUSU9OOwogICAgICAgICAg\nICBlbHNlIGlmIChpc01hcHBlZCgpKQogICAgICAgICAgICAgICAgX2lkZW50\naXR5ID0gSURfREFUQVNUT1JFOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBfaWRlbnRpdHkgPSBfcmVwb3MuZ2V0TWV0YURhdGFGYWN0b3J5\nKCkuZ2V0RGVmYXVsdHMoKS4KICAgICAgICAgICAgICAgICAgICBnZXREZWZh\ndWx0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\naWRlbnRpdHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiBp\nZGVudGl0eSBiZWluZyB1c2VkLiBUaGlzIHdpbGwgYmUgb25lIG9mOgogICAg\nICogPHVsPgogICAgICogPGxpPntAbGluayAjSURfVU5LTk9XTn06IHVua25v\nd24gaWRlbnRpdHkgdHlwZTwvbGk+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9E\nQVRBU1RPUkV9OiBpZGVudGl0eSBtYW5hZ2VkIGJ5IHRoZSBkYXRhIHN0b3Jl\nIGFuZAogICAgICogaW5kZXBlbmRlbnQJb2YgdGhlIGZpZWxkcyBvZiB0aGUg\naW5zdGFuY2U8L2xpPgogICAgICogPGxpPntAbGluayAjSURfQVBQTElDQVRJ\nT059OiBpZGVudGl0eSBtYW5hZ2VkIGJ5IHRoZSBhcHBsaWNhdGlvbiBhbmQK\nICAgICAqIGRlZmluZWQgYnkgb25lIG9yIG1vcmUgZmllbGRzIG9mIHRoZSBp\nbnN0YW5jZTwvbGk+CiAgICAgKiA8L3VsPiBJZiB1bnNwZWNpZmllZCwgZGVm\nYXVsdHMgdG8ge0BsaW5rICNJRF9EQVRBU1RPUkV9IGlmIHRoZXJlIGFyZSBu\nbwogICAgICogcHJpbWFyeSBrZXkgZmllbGRzLCBhbmQge0BsaW5rICNJRF9B\nUFBMSUNBVElPTn0gb3RoZXJ3aXNlLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRJZGVudGl0eVR5cGUoaW50IHR5cGUpIHsKICAgICAgICBfaWRlbnRp\ndHkgPSB0eXBlOwogICAgICAgIGlmICh0eXBlICE9IElEX0FQUExJQ0FUSU9O\nKSB7CiAgICAgICAgICAgIF9vYmplY3RJZCA9IG51bGw7CiAgICAgICAgICAg\nIF9vcGVuanBhSWQgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFRoZSBtZXRhZGF0YS1zcGVjaWZpZWQgY2xhc3MgdG8gdXNlIGZv\nciB0aGUgb2JqZWN0IElELgogICAgICovCiAgICBwdWJsaWMgQ2xhc3MgZ2V0\nT2JqZWN0SWRUeXBlKCkgewogICAgICAgIGlmIChfb2JqZWN0SWQgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RJZDsKICAgICAgICBpZiAo\nZ2V0SWRlbnRpdHlUeXBlKCkgIT0gSURfQVBQTElDQVRJT04pCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0g\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAoc3VwICE9\nIG51bGwgJiYgc3VwLmdldElkZW50aXR5VHlwZSgpICE9IElEX1VOS05PV04p\nIHsKICAgICAgICAgICAgX29iamVjdElkID0gc3VwLmdldE9iamVjdElkVHlw\nZSgpOwogICAgICAgICAgICByZXR1cm4gX29iamVjdElkOwogICAgICAgIH0K\nCiAgICAgICAgLy8gZmlndXJlIG91dCBvcGVuanBhIGlkZW50aXR5IHR5cGUg\nYmFzZWQgb24gcHJpbWFyeSBrZXkgZmllbGQKICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gcGtzID0gZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgIGlm\nIChwa3MubGVuZ3RoICE9IDEpCiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIHN3aXRjaCAocGtzWzBdLmdldE9iamVjdElkRmllbGRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAg\nICAgX29iamVjdElkID0gQnl0ZUlkLmNsYXNzOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICAg\nICAgX29iamVjdElkID0gQ2hhcklkLmNsYXNzOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAg\nICAgICAgIF9vYmplY3RJZCA9IERvdWJsZUlkLmNsYXNzOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FU\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAg\nICAgICAgICAgICBfb2JqZWN0SWQgPSBGbG9hdElkLmNsYXNzOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAg\nICAgICAgICAgIF9vYmplY3RJZCA9IEludElkLmNsYXNzOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAg\nICAgICAgICAgX29iamVjdElkID0gTG9uZ0lkLmNsYXNzOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JU\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAg\nICAgICAgICAgICBfb2JqZWN0SWQgPSBTaG9ydElkLmNsYXNzOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNU\nUklORzoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IFN0cmluZ0lkLmNs\nYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBE\nYXRlSWQuY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBPYmpl\nY3RJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAgICAgICAgICAg\nX29iamVjdElkID0gQmlnRGVjaW1hbElkLmNsYXNzOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVH\nRVI6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBCaWdJbnRlZ2VySWQu\nY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9vYmplY3RJZDsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBtZXRhZGF0YS1zcGVjaWZpZWQgY2xhc3MgdG8gdXNlIGZvciB0aGUgb2Jq\nZWN0IElELgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRPYmplY3RJZFR5\ncGUoQ2xhc3MgY2xzLCBib29sZWFuIHNoYXJlZCkgewogICAgICAgIF9vYmpl\nY3RJZCA9IG51bGw7CiAgICAgICAgX29wZW5qcGFJZCA9IG51bGw7CiAgICAg\nICAgX29iamVjdElkU2hhcmVkID0gbnVsbDsKICAgICAgICBpZiAoY2xzICE9\nIG51bGwpIHsKICAgICAgICAgICAgLy8gZG9uJ3QgbGV0IHBlb3BsZSBhc3Np\nZ24gT3BlbkpQQUlkIHR5cGVzOyBzYWZlciB0byBjYWxjdWxhdGUgaXQKICAg\nICAgICAgICAgLy8gb3Vyc2VsdmVzCiAgICAgICAgICAgIHNldElkZW50aXR5\nVHlwZShJRF9BUFBMSUNBVElPTik7CiAgICAgICAgICAgIGlmICghT3BlbkpQ\nQUlkLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkgewogICAgICAgICAg\nICAgICAgX29iamVjdElkID0gY2xzOwogICAgICAgICAgICAgICAgX29iamVj\ndElkU2hhcmVkID0gKHNoYXJlZCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFu\nLkZBTFNFOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciB0aGlzIHR5cGUgdXNlcyBhbiBhcHBsaWNhdGlv\nbiBpZGVudGl0eSBjbGFzcyB0aGF0IGlzIHNoYXJlZAogICAgICogd2l0aCBv\ndGhlciBjbGFzc2VzLCBhbmQgaXMgdGhlcmVmb3JlIHdyYXBwZWQgaW4gYW4g\ne0BsaW5rIE9iamVjdElkfS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\naXNPYmplY3RJZFR5cGVTaGFyZWQoKSB7CiAgICAgICAgaWYgKF9vYmplY3RJ\nZFNoYXJlZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX29iamVjdElk\nU2hhcmVkLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgIGlmIChfc3VwZXIgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCkuaXNPYmplY3RJZFR5cGVTaGFyZWQoKTsKICAgICAgICByZXR1cm4g\naXNPcGVuSlBBSWRlbnRpdHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgdGhpcyB0eXBlIHVzZXMgT3BlbkpQQSBpZGVudGl0eS4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gaXNPcGVuSlBBSWRlbnRpdHkoKSB7CiAg\nICAgICAgaWYgKF9vcGVuanBhSWQgPT0gbnVsbCkgewogICAgICAgICAgICBD\nbGFzcyBjbHMgPSBnZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICAgICAgaWYg\nKGNscyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgICAgICBfb3BlbmpwYUlkID0gKE9wZW5KUEFJZC5jbGFzcy5pc0Fz\nc2lnbmFibGVGcm9tKGNscykpID8gQm9vbGVhbi5UUlVFCiAgICAgICAgICAg\nICAgICA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBfb3BlbmpwYUlkLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIHN0cmF0ZWd5IHRvIHVzZSBmb3IgZGF0YXN0b3JlIGlkZW50\naXR5IGdlbmVyYXRpb24uCiAgICAgKiBPbmUgb2YgdGhlIGNvbnN0YW50cyBm\ncm9tIHtAbGluayBWYWx1ZVN0cmF0ZWdpZXN9LgogICAgICovCiAgICBwdWJs\naWMgaW50IGdldElkZW50aXR5U3RyYXRlZ3koKSB7CiAgICAgICAgaWYgKGdl\ndElkZW50aXR5VHlwZSgpID09IElEX0RBVEFTVE9SRQogICAgICAgICAgICAm\nJiBfaWRTdHJhdGVneSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkgewogICAg\nICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01l\ndGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAu\nZ2V0SWRlbnRpdHlUeXBlKCkgIT0gSURfVU5LTk9XTikKICAgICAgICAgICAg\nICAgIF9pZFN0cmF0ZWd5ID0gc3VwLmdldElkZW50aXR5U3RyYXRlZ3koKTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2lkU3RyYXRlZ3kg\nPSBWYWx1ZVN0cmF0ZWdpZXMuTkFUSVZFOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gX2lkU3RyYXRlZ3k7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\nc3RyYXRlZ3kgdG8gdXNlIGZvciBkYXRhc3RvcmUgaWRlbnRpdHkgZ2VuZXJh\ndGlvbi4KICAgICAqIE9uZSBvZiB0aGUgY29uc3RhbnRzIGZyb20ge0BsaW5r\nIFZhbHVlU3RyYXRlZ2llc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndElkZW50aXR5U3RyYXRlZ3koaW50IHN0cmF0ZWd5KSB7CiAgICAgICAgX2lk\nU3RyYXRlZ3kgPSBzdHJhdGVneTsKICAgICAgICBpZiAoc3RyYXRlZ3kgIT0g\nVmFsdWVTdHJhdGVnaWVzLlNFUVVFTkNFKQogICAgICAgICAgICBzZXRJZGVu\ndGl0eVNlcXVlbmNlTmFtZShudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBkYXRhc3RvcmUgaWRlbnRpdHkgc2VxdWVuY2UgbmFtZSwgb3IgbnVs\nbCBmb3Igbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRJZGVu\ndGl0eVNlcXVlbmNlTmFtZSgpIHsKICAgICAgICBpZiAoREVGQVVMVF9TVFJJ\nTkcuZXF1YWxzKF9zZXFOYW1lKSkgewogICAgICAgICAgICBpZiAoX3N1cGVy\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBfc2VxTmFtZSA9IGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCkuZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX3NlcU5hbWUgPSBu\ndWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3NlcU5hbWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgZGF0YXN0b3JlIGlkZW50aXR5IHNlcXVl\nbmNlIG5hbWUsIG9yIG51bGwgZm9yIG5vbmUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldElkZW50aXR5U2VxdWVuY2VOYW1lKFN0cmluZyBzZXFOYW1l\nKSB7CiAgICAgICAgX3NlcU5hbWUgPSBzZXFOYW1lOwogICAgICAgIF9zZXFN\nZXRhID0gbnVsbDsKICAgICAgICBpZiAoc2VxTmFtZSAhPSBudWxsKQogICAg\nICAgICAgICBzZXRJZGVudGl0eVN0cmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5T\nRVFVRU5DRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNZXRhZGF0YSBmb3Ig\ndGhlIGRhdGFzdG9yZSBpZGVudGl0eSBzZXF1ZW5jZS4KICAgICAqLwogICAg\ncHVibGljIFNlcXVlbmNlTWV0YURhdGEgZ2V0SWRlbnRpdHlTZXF1ZW5jZU1l\ndGFEYXRhKCkgewogICAgICAgIGlmIChfc2VxTWV0YSA9PSBudWxsICYmIGdl\ndElkZW50aXR5U2VxdWVuY2VOYW1lKCkgIT0gbnVsbCkKICAgICAgICAgICAg\nX3NlcU1ldGEgPSBfcmVwb3MuZ2V0U2VxdWVuY2VNZXRhRGF0YSh0aGlzLAog\nICAgICAgICAgICAgICAgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKSwgdHJ1\nZSk7CiAgICAgICAgcmV0dXJuIF9zZXFNZXRhOwogICAgfQoKICAgIC8qKgog\nICAgICogSW5mb3JtYXRpb24gYWJvdXQgbGlmZWN5Y2xlIGNhbGxiYWNrcyBm\nb3IgdGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIExpZmVjeWNsZU1l\ndGFEYXRhIGdldExpZmVjeWNsZU1ldGFEYXRhKCkgewogICAgICAgIHJldHVy\nbiBfbGlmZU1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRo\nZSBhbGlhcyBmb3IgdGhlIGRlc2NyaWJlZCB0eXBlLCBvciA8Y29kZT5udWxs\nPC9jb2RlPiBpZiBub25lCiAgICAgKiBoYXMgYmVlbiBzZXQuCiAgICAgKiAK\nICAgICAqIEBzZWUgI3NldFR5cGVBbGlhcwogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nIGdldFR5cGVBbGlhcygpIHsKICAgICAgICBpZiAoX2FsaWFzID09\nIG51bGwpCiAgICAgICAgICAgIF9hbGlhcyA9IFN0cmluZ3MuZ2V0Q2xhc3NO\nYW1lKF90eXBlKTsKICAgICAgICByZXR1cm4gX2FsaWFzOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0cyB0aGUgYWxpYXMgZm9yIHRoZSBkZXNjcmliZWQg\ndHlwZS4gVGhlIGFsaWFzIGNhbiBiZQogICAgICogYW55IGFyYml0cmFyeSBz\ndHJpbmcgdGhhdCB0aGUgaW1wbGVtZW50YXRpb24gY2FuIGxhdGVyIHVzZSB0\nbwogICAgICogcmVmZXIgdG8gdGhlIGNsYXNzLiBOb3RlIHRoYXQgYXQgcnVu\ndGltZSwgb25seSB0aGUgYWxpYXMKICAgICAqIGNvbXB1dGVkIHdoZW4gdGhl\nIHBlcnNpc3RlbnQgdHlwZSB3YXMgZW5oYW5jZWQgaXMgdXNlZC4KICAgICAq\nCiAgICAgKiBAcGFyYW0gYWxpYXMgdGhlIGFsaWFzIG5hbWUgdG8gYXBwbHkg\ndG8gdGhlIGRlc2NyaWJlZCB0eXBlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFR5cGVBbGlhcyhTdHJpbmcgYWxpYXMpIHsKICAgICAgICBfYWxpYXMg\nPSBhbGlhczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBhY2Nlc3MgdHlw\nZSB1c2VkIGJ5IHRoaXMgY2xhc3MuIEVpdGhlciB7QGxpbmsgI0FDQ0VTU19G\nSUVMRH0KICAgICAqIG9yIHtAbGluayAjQUNDRVNTX1BST1BFUlRZfS4KICAg\nICAqLwogICAgcHVibGljIGludCBnZXRBY2Nlc3NUeXBlKCkgewogICAgICAg\nIGlmIChfYWNjZXNzVHlwZSA9PSBBQ0NFU1NfVU5LTk9XTikgewogICAgICAg\nICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBzdXAuZ2V0QWNjZXNzVHlwZSgpOwogICAgICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRSZXBvc2l0b3J5\nKCkuZ2V0TWV0YURhdGFGYWN0b3J5KCkuCiAgICAgICAgICAgICAgICAgICAg\nZ2V0RGVmYXVsdHMoKS5nZXREZWZhdWx0QWNjZXNzVHlwZSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWNjZXNzVHlwZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBhY2Nlc3MgdHlwZSB1c2VkIGJ5\nIHRoaXMgY2xhc3MuIE11c3QgYmUgZWl0aGVyCiAgICAgKiB7QGxpbmsgI0FD\nQ0VTU19GSUVMRH0gb3Ige0BsaW5rICNBQ0NFU1NfUFJPUEVSVFl9LgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRBY2Nlc3NUeXBlKGludCB0eXBlKSB7\nCiAgICAgICAgX2FjY2Vzc1R5cGUgPSB0eXBlOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciB0aGUgdHlwZSByZXF1aXJlcyBleHRlbnQgbWFuYWdl\nbWVudC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0UmVxdWlyZXNF\neHRlbnQoKSB7CiAgICAgICAgaWYgKF9vd25lciAhPSBudWxsIHx8IGlzRW1i\nZWRkZWRPbmx5KCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgaWYgKF9leHRlbnQgPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzc01l\ndGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAg\nICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9leHRl\nbnQgPSAoc3VwLmdldFJlcXVpcmVzRXh0ZW50KCkpID8gQm9vbGVhbi5UUlVF\nCiAgICAgICAgICAgICAgICAgICAgOiBCb29sZWFuLkZBTFNFOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICBfZXh0ZW50ID0gQm9vbGVhbi5U\nUlVFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2V4dGVudC5ib29sZWFu\nVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5\ncGUgcmVxdWlyZXMgZXh0ZW50IG1hbmFnZW1lbnQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldFJlcXVpcmVzRXh0ZW50KGJvb2xlYW4gcmVxKSB7CiAg\nICAgICAgX2V4dGVudCA9IChyZXEpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVh\nbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5\ncGUgY2FuIG9ubHkgYmUgdXNlZCBhcyBhbiBlbWJlZGRlZCBvYmplY3QuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRW1iZWRkZWRPbmx5KCkgewog\nICAgICAgIGlmIChfZW1iZWRkZWQgPT0gbnVsbCkgewogICAgICAgICAgICBD\nbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7\nCiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9lbWJlZGRlZCA9IChzdXAuaXNFbWJlZGRlZE9ubHkoKSkgPyBCb29sZWFu\nLlRSVUUKICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4uRkFMU0U7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9lbWJlZGRlZCA9IEJv\nb2xlYW4uRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZW1iZWRk\nZWQuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIHRoZSB0eXBlIGNhbiBvbmx5IGJlIHVzZWQgYXMgYW4gZW1iZWRkZWQg\nb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbWJlZGRlZE9u\nbHkoYm9vbGVhbiBlbWJlZCkgewogICAgICAgIF9lbWJlZGRlZCA9IChlbWJl\nZCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgfQoKICAg\nIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSdzIGZpZWxkcyBhcmUgYWN0\naXZlbHkgaW50ZXJjZXB0ZWQsIGVpdGhlciBieQogICAgICogcmVkZWZpbml0\naW9uIG9yIGVuaGFuY2VtZW50LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc0ludGVyY2VwdGluZygpIHsKICAgICAgICByZXR1cm4gX2ludGVyY2Vw\ndGluZzsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUn\ncyBmaWVsZHMgYXJlIGFjdGl2ZWx5IGludGVyY2VwdGVkLCBlaXRoZXIgYnkK\nICAgICAqIHJlZGVmaW5pdGlvbiBvciBlbmhhbmNlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0SW50ZXJjZXB0aW5nKGJvb2xlYW4gaW50ZXJj\nZXB0aW5nKSB7CiAgICAgICAgX2ludGVyY2VwdGluZyA9IGludGVyY2VwdGlu\nZzsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIHR5cGUgaXMg\nYSBtYW5hZ2VkIGludGVyZmFjZS4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gaXNNYW5hZ2VkSW50ZXJmYWNlKCkgewogICAgICAgIGlmICghX3R5cGUu\naXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIHJldHVybiBfaW50ZXJmYWNlID09IG51bGwgPyBmYWxzZSA6IF9pbnRl\ncmZhY2UuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIHRoZSB0eXBlIGlzIGEgbWFuYWdlZCBpbnRlcmZhY2UKICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0TWFuYWdlZEludGVyZmFjZShib29sZWFu\nIG1hbmFnZWRJbnRlcmZhY2UpIHsKICAgICAgICBpZiAoIV90eXBlLmlzSW50\nZXJmYWNlKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgibm90LWludGVyZmFjZSIsIF90eXBlKSk7CiAgICAg\nICAgX2ludGVyZmFjZSA9IG1hbmFnZWRJbnRlcmZhY2UgPyBCb29sZWFuLlRS\nVUUgOiBCb29sZWFuLkZBTFNFOwoKICAgICAgICAvLyBtYW5hZ2VkIGludGVy\nZmFjZXMgYWx3YXlzIGRvIHByb3BlciBpbnRlcmNlcHRpb247IE9wZW5KUEEg\nZ2VuZXJhdGVzCiAgICAgICAgLy8gdGhlIGltcGxlbWVudGF0aW9ucy4KICAg\nICAgICBpZiAoaXNNYW5hZ2VkSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHNl\ndEludGVyY2VwdGluZyh0cnVlKTsKCiAgICAgICAgLy8gbWFuYWdlZCBpbnRl\ncmZhY2VzIGFsd2F5cyB1c2UgcHJvcGVydHkgYWNjZXNzLgogICAgICAgIHNl\ndEFjY2Vzc1R5cGUoQUNDRVNTX1BST1BFUlRZKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgbWFuYWdlZCBpbnRlcmZhY2UgaW1wbGVtZW50\nb3IgaWYgYW55LgogICAgICovCiAgICBwdWJsaWMgQ2xhc3MgZ2V0SW50ZXJm\nYWNlSW1wbCgpIHsKICAgICAgICByZXR1cm4gX2ltcGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIG1hbmFnZWQgaW50ZXJmYWNlIGltcGxlbWVu\ndG9yIGNsYXNzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRlcmZh\nY2VJbXBsKENsYXNzIGltcGwpIHsKICAgICAgICBfaW1wbCA9IGltcGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGV4cGxpY2l0bHkgZGVj\nbGFyZWQgaW50ZXJmYWNlcyB0aGlzIGNsYXNzIGltcGxlbWVudHMuCiAgICAg\nKi8KICAgIHB1YmxpYyBDbGFzc1tdIGdldERlY2xhcmVkSW50ZXJmYWNlcygp\nIHsKICAgICAgICBpZiAoX2ludGVyZmFjZXMgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIE1ldGFEYXRhUmVwb3NpdG9yeS5FTVBUWV9DTEFTU0VTOwog\nICAgICAgIHJldHVybiAoQ2xhc3NbXSkgX2ludGVyZmFjZXMudG9BcnJheShu\nZXcgQ2xhc3NbX2ludGVyZmFjZXMuc2l6ZSgpXSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBFeHBsaWNpdGx5IGRlY2xhcmUgdGhlIGdpdmVuIGludGVyZmFj\nZSBhbW9uZyB0aGUgb25lcyB0aGlzCiAgICAgKiBjbGFzcyBpbXBsZW1lbnRz\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGREZWNsYXJlZEludGVyZmFj\nZShDbGFzcyBpZmFjZSkgewogICAgICAgIGlmIChpZmFjZSA9PSBudWxsIHx8\nICFpZmFjZS5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImRlY2xhcmUtbm9uLWludGVy\nZmFjZSIsCiAgICAgICAgICAgICAgICB0aGlzLCBpZmFjZSkpOwogICAgICAg\nIGlmIChfaW50ZXJmYWNlcyA9PSBudWxsKQogICAgICAgICAgICBfaW50ZXJm\nYWNlcyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICBfaW50ZXJmYWNlcy5h\nZGQoaWZhY2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBn\naXZlbiBpbnRlcmZhY2UgZnJvbSB0aGUgZGVjbGFyZWQgbGlzdC4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlRGVjbGFyZWRJbnRlcmZhY2Uo\nQ2xhc3MgaWZhY2UpIHsKICAgICAgICBpZiAoX2ludGVyZmFjZXMgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBf\naW50ZXJmYWNlcy5yZW1vdmUoaWZhY2UpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWxpYXMgcHJvcGVydGllcyBmcm9tIHRoZSBnaXZlbiBpbnRlcmZhY2Ug\nZHVyaW5nICBxdWVyaWVzIHRvCiAgICAgKiB0aGUgbG9jYWwgZmllbGQuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEludGVyZmFjZVByb3BlcnR5QWxp\nYXMoQ2xhc3MgaWZhY2UsIFN0cmluZyBvcmlnLCAKICAgICAgICBTdHJpbmcg\nbG9jYWwpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9pZmFjZU1hcCkgewog\nICAgICAgICAgICBNYXAgZmllbGRzID0gKE1hcCkgX2lmYWNlTWFwLmdldChp\nZmFjZSk7CiAgICAgICAgICAgIGlmIChmaWVsZHMgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgZmllbGRzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAg\nICAgICAgIF9pZmFjZU1hcC5wdXQoaWZhY2UsIGZpZWxkcyk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgaWYgKGZpZWxkcy5jb250YWluc0tleShvcmln\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiZHVwbGljYXRlLWlmYWNlLWFsaWFzIiwgCiAgICAgICAg\nICAgICAgICAgICAgdGhpcywgb3JpZywgbG9jYWwpKTsKICAgICAgICAgICAg\nZmllbGRzLnB1dChvcmlnLCBsb2NhbCk7CiAgICAgICAgfQogICAgfQogICAg\nCiAgICAvKioKICAgICAqIEdldCBsb2NhbCBmaWVsZCBhbGlhcyBmb3IgdGhl\nIGdpdmVuIGludGVyZmFjZSBwcm9wZXJ0eS4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZyBnZXRJbnRlcmZhY2VQcm9wZXJ0eUFsaWFzKENsYXNzIGlmYWNl\nLCBTdHJpbmcgb3JpZykgewogICAgICAgIHN5bmNocm9uaXplZCAoX2lmYWNl\nTWFwKSB7CiAgICAgICAgICAgIE1hcCBmaWVsZHMgPSAoTWFwKSBfaWZhY2VN\nYXAuZ2V0KGlmYWNlKTsKICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJl\ndHVybiAoU3RyaW5nKSBmaWVsZHMuZ2V0KG9yaWcpOwogICAgICAgIH0KICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGFsaWFzZXMgcHJv\ncGVydHkgbmFtZWQgZm9yIHRoZSBnaXZlbiBpbnRlcmZhY2UuCiAgICAgKi8K\nICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRJbnRlcmZhY2VBbGlhc2VkUHJvcGVy\ndGllcyhDbGFzcyBpZmFjZSkgewogICAgICAgIHN5bmNocm9uaXplZCAoX2lm\nYWNlTWFwKSB7CiAgICAgICAgICAgIE1hcCBmaWVsZHMgPSAoTWFwKSBfaWZh\nY2VNYXAuZ2V0KGlmYWNlKTsKICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIEVNUFRZX1NUUklOR19BUlJB\nWTsKICAgICAgICAgICAgcmV0dXJuIChTdHJpbmdbXSkgZmllbGRzLmtleVNl\ndCgpLnRvQXJyYXkoCiAgICAgICAgICAgICAgICBuZXcgU3RyaW5nW2ZpZWxk\ncy5zaXplKCldKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBudW1iZXIgb2YgZmllbGRzIHRoYXQgdXNlIGltcGwg\nb3IgaW50ZXJtZWRpYXRlIGRhdGEsIGluCiAgICAgKiBvcmRlciB0byBjcmVh\ndGUgYSBjb21wYWN0ZWQgYXJyYXkgZm9yIHN0b3JhZ2Ugb2Ygc2FpZCBkYXRh\nLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldEV4dHJhRmllbGREYXRhTGVu\nZ3RoKCkgewogICAgICAgIGludFtdIHRhYmxlID0gZ2V0RXh0cmFGaWVsZERh\ndGFUYWJsZSgpOwogICAgICAgIGZvciAoaW50IGkgPSB0YWJsZS5sZW5ndGgg\nLSAxOyBpID49IDA7IGktLSkKICAgICAgICAgICAgaWYgKHRhYmxlW2ldICE9\nIC0xKQogICAgICAgICAgICAgICAgcmV0dXJuIHRhYmxlW2ldICsgMTsKICAg\nICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgaW1wbCAvIGludGVybWVkaWF0ZSBmaWVsZCBkYXRhIGluZGV4IG9mIHRo\nZSBnaXZlbiBmaWVsZAogICAgICogaW4gdGhlIGNvbXBhY3RlZCBhcnJheSwg\nb3IgLTEgaWYgdGhlIGZpZWxkIGRvZXMgbm90IHVzZSBleHRyYSBkYXRhLgog\nICAgICoKICAgICAqIEBzZWUgI2dldEV4dHJhRmllbGREYXRhTGVuZ3RoCiAg\nICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0RXh0cmFGaWVsZERhdGFJbmRleChp\nbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gZ2V0RXh0cmFGaWVsZERhdGFU\nYWJsZSgpW2ZpZWxkXTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMg\nYSB0YWJsZSBtYXBwaW5nIGVhY2ggZmllbGQgaW5kZXggdG8gaXRzIGV4dHJh\nIGRhdGEgaW5kZXguCiAgICAgKi8KICAgIHByaXZhdGUgaW50W10gZ2V0RXh0\ncmFGaWVsZERhdGFUYWJsZSgpIHsKICAgICAgICBpZiAoX2ZpZWxkRGF0YVRh\nYmxlID09IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZt\nZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50W10gdGFibGUgPSBu\nZXcgaW50W2ZtZHMubGVuZ3RoXTsKICAgICAgICAgICAgaW50IGlkeCA9IDA7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgaWYgKGZtZHNbaV0udXNlc0ludGVy\nbWVkaWF0ZSgpCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kc1tpXS51c2Vz\nSW1wbERhdGEoKSAhPSBCb29sZWFuLkZBTFNFKQogICAgICAgICAgICAgICAg\nICAgIHRhYmxlW2ldID0gaWR4Kys7CiAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgdGFibGVbaV0gPSAtMTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBfZmllbGREYXRhVGFibGUgPSB0YWJsZTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIF9maWVsZERhdGFUYWJsZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBuYW1lIHJl\ncHJlc2VudHMgYSBtYW5hZ2VkIG9yIHN0YXRpYyBmaWVsZCBvZgogICAgICog\ndGhpcyBjbGFzcywgaW5jbHVkaW5nIHN1cGVyY2xhc3MgZmllbGRzLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FjY2Vzc2libGVGaWVsZChTdHJp\nbmcgZmllbGQpIHsKICAgICAgICBpZiAoZ2V0RGVjbGFyZWRGaWVsZChmaWVs\nZCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\naWYgKF9zdGF0aWNGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBGaWVs\nZFtdIGZpZWxkcyA9IChGaWVsZFtdKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERl\nY2xhcmVkRmllbGRzQWN0aW9uKF90eXBlKSk7IAogICAgICAgICAgICBTZXQg\nbmFtZXMgPSBuZXcgSGFzaFNldCgoaW50KSAoZmllbGRzLmxlbmd0aCAqIDEu\nMzMgKyAxKSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmll\nbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKE1vZGlmaWVy\nLmlzU3RhdGljKGZpZWxkc1tpXS5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAg\nICAgICAgICAgICAgbmFtZXMuYWRkKGZpZWxkc1tpXS5nZXROYW1lKCkpOwog\nICAgICAgICAgICBfc3RhdGljRmllbGRzID0gbmFtZXM7CiAgICAgICAgfQog\nICAgICAgIGlmIChfc3RhdGljRmllbGRzLmNvbnRhaW5zKGZpZWxkKSkKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKF9zdXBlciAhPSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKS5pc0FjY2Vzc2libGVGaWVsZChmaWVsZCk7CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBmaWVs\nZCBtZXRhZGF0YXMsIGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxkcy4KICAg\nICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXRGaWVsZHMoKSB7\nCiAgICAgICAgaWYgKF9hbGxGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAg\nICBpZiAoX3N1cGVyID09IG51bGwpCiAgICAgICAgICAgICAgICBfYWxsRmll\nbGRzID0gZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0\nRGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBzdXBGaWVsZHMgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLgog\nICAgICAgICAgICAgICAgICAgIGdldEZpZWxkcygpOwoKICAgICAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBhbGxGaWVsZHMgPSBfcmVwb3MubmV3Rmll\nbGRNZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAgICAgICAgKGZpZWxkcy5s\nZW5ndGggKyBzdXBGaWVsZHMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIFN5\nc3RlbS5hcnJheWNvcHkoc3VwRmllbGRzLCAwLCBhbGxGaWVsZHMsIDAsIHN1\ncEZpZWxkcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgcmVwbGFjZURlZmlu\nZWRTdXBlcmNsYXNzRmllbGRzKGFsbEZpZWxkcywgc3VwRmllbGRzLmxlbmd0\naCk7CgogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVs\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBmaWVsZHNb\naV0uc2V0SW5kZXgoc3VwRmllbGRzLmxlbmd0aCArIGkpOwogICAgICAgICAg\nICAgICAgICAgIGFsbEZpZWxkc1tzdXBGaWVsZHMubGVuZ3RoICsgaV0gPSBm\naWVsZHNbaV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBf\nYWxsRmllbGRzID0gYWxsRmllbGRzOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBfYWxsRmllbGRzOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVwbGFjZSBzdXBlcmNsYXNzIGZpZWxkcyB0aGF0IHdlIGRlZmlu\nZSB3aXRoIG91ciB2ZXJzaW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncmVwbGFjZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKEZpZWxkTWV0YURhdGFb\nXSBmaWVsZHMsCiAgICAgICAgaW50IGxlbikgewogICAgICAgIGlmIChfc3Vw\nRmllbGRNYXAgPT0gbnVsbCB8fCAhX2RlZlN1cEZpZWxkcykKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICAvLyBkb24ndCBhc3N1bWUgZmllbGRzIGFy\nZSBpbiBvcmRlcjsgdGhpcyBtZXRob2QgaXMgdXNlZCBmb3IKICAgICAgICAv\nLyBsaXN0aW5nIG9yZGVyIGFzIHdlbGwKICAgICAgICBGaWVsZE1ldGFEYXRh\nIHN1cEZpZWxkOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGVuOyBp\nKyspIHsKICAgICAgICAgICAgc3VwRmllbGQgPSAoRmllbGRNZXRhRGF0YSkg\nX3N1cEZpZWxkTWFwLmdldChmaWVsZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAg\nICAgICAgaWYgKHN1cEZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGZpZWxkc1tpXSA9IHN1cEZpZWxkOwogICAgICAgICAgICAgICAgc3VwRmll\nbGQuc2V0SW5kZXgoaSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN1cGVyY2xhc3MgY29weSBv\nZiB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGaWVs\nZE1ldGFEYXRhIGdldFN1cGVyY2xhc3NGaWVsZChGaWVsZE1ldGFEYXRhIHN1\ncEZpZWxkKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzbSA9IGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBzbSA9PSBudWxsID8gbnVsbCA6IHNtLmdldEZpZWxkKHN1cEZpZWxkLmdl\ndE5hbWUoKSk7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsIHx8IGZtZC5nZXRN\nYW5hZ2VtZW50KCkgIT0gZm1kLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInVu\nbWFuYWdlZC1zdXAtZmllbGQiLAogICAgICAgICAgICAgICAgc3VwRmllbGQs\nIHRoaXMpKTsKICAgICAgICByZXR1cm4gZm1kOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIG9ubHkgdGhlIGZpZWxkcyBmb3IgdGhpcyBjbGFzcywg\nd2l0aG91dCBzdXBlcmNsYXNzIGZpZWxkcy4KICAgICAqLwogICAgcHVibGlj\nIEZpZWxkTWV0YURhdGFbXSBnZXREZWNsYXJlZEZpZWxkcygpIHsKICAgICAg\nICBpZiAoX2ZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIExpc3QgZmll\nbGRzID0gbmV3IEFycmF5TGlzdChfZmllbGRNYXAuc2l6ZSgpKTsKICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQ7CiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gX2ZpZWxkTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBmbWQgPSAoRmllbGRN\nZXRhRGF0YSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChmbWQu\nZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0YURhdGEuTUFOQUdFX05PTkUp\nIHsKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0RGVjbGFyZWRJbmRleChm\naWVsZHMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0SW5k\nZXgoZm1kLmdldERlY2xhcmVkSW5kZXgoKSk7CiAgICAgICAgICAgICAgICAg\nICAgZmllbGRzLmFkZChmbWQpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgICAgIF9maWVsZHMgPSAoRmllbGRNZXRhRGF0YVtd\nKSBmaWVsZHMudG9BcnJheQogICAgICAgICAgICAgICAgKF9yZXBvcy5uZXdG\naWVsZE1ldGFEYXRhQXJyYXkoZmllbGRzLnNpemUoKSkpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX2ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBwcmltYXJ5IGtleSBmaWVsZHMsIG9yIGVtcHR5IGFycmF5IGlm\nIG5vbmUuIFRoZSBvcmRlcgogICAgICogaW4gd2hpY2ggdGhlIGtleXMgYXJl\nIHJldHVybmVkIHdpbGwgYmUgdGhlIG9yZGVyIGluIHdoaWNoCiAgICAgKiB0\naGUgZmllbGRzIGFyZSBkZWNsYXJlZCwgc3RhcnRpbmcgYXQgdGhlIGxlYXN0\nLWRlcml2ZWQgc3VwZXJjbGFzcwogICAgICogYW5kIGVuZGluZyB3aXRoIHRo\nZSBwcmltYXJ5IGtleSBmaWVsZHMgb2YgdGhlIG1vc3QtZGVyaXZlZCBzdWJj\nbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXRQ\ncmltYXJ5S2V5RmllbGRzKCkgewogICAgICAgIC8vIGNoZWNrIGZvciBwayBm\naWVsZHMgZXZlbiBpZiBub3Qgc2V0IHRvIElEX0FQUExJQ0FUSU9OIHNvIHRo\nYXQKICAgICAgICAvLyBhcHAgaWQgdG9vbCBzZWVzIHRoZW0gZXZlbiB3aGVu\nIHVzZXIgZG9lc24ndCBkZWNsYXJlIGFwcCBpZAogICAgICAgIGlmIChfYWxs\nUEtGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZmllbGRzID0gZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGludCBudW0g\nPSAwOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNQ\ncmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICAgICAgbnVtKys7CgogICAg\nICAgICAgICBpZiAobnVtID09IDApCiAgICAgICAgICAgICAgICBfYWxsUEtG\naWVsZHMgPSBfcmVwb3MuRU1QVFlfRklFTERTOwogICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBfcmVw\nb3MubmV3RmllbGRNZXRhRGF0YUFycmF5KG51bSk7CiAgICAgICAgICAgICAg\nICBudW0gPSAwOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoZmllbGRzW2ldLmlzUHJpbWFyeUtleSgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGZpZWxkc1tpXS5zZXRQcmltYXJ5S2V5SW5kZXgobnVtKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgcGtzW251bV0gPSBmaWVsZHNbaV07\nCiAgICAgICAgICAgICAgICAgICAgICAgIG51bSsrOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9h\nbGxQS0ZpZWxkcyA9IHBrczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gX2FsbFBLRmllbGRzOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBsaXN0IG9mIGZpZWxkcyBpbiB0aGUgZGVmYXVsdCBm\nZXRjaCBncm91cCwKICAgICAqIGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxk\ncywgb3IgYW4gZW1wdHkgYXJyYXkgaWYgbm9uZS4KICAgICAqLwogICAgcHVi\nbGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWZhdWx0RmV0Y2hHcm91cEZpZWxk\ncygpIHsKICAgICAgICBpZiAoX2FsbERGR0ZpZWxkcyA9PSBudWxsKSB7CiAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMo\nKTsKICAgICAgICAgICAgaW50IG51bSA9IDA7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgaWYgKGZpZWxkc1tpXS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkK\nICAgICAgICAgICAgICAgICAgICBudW0rKzsKCiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBkZmdzID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJh\neShudW0pOwogICAgICAgICAgICBudW0gPSAwOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgIGlmIChmaWVsZHNbaV0uaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkp\nCiAgICAgICAgICAgICAgICAgICAgZGZnc1tudW0rK10gPSBmaWVsZHNbaV07\nCiAgICAgICAgICAgIF9hbGxERkdGaWVsZHMgPSBkZmdzOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX2FsbERGR0ZpZWxkczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgdmVyc2lvbiBmaWVsZCBmb3IgdGhpcyBjbGFz\ncywgaWYgYW55LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBn\nZXRWZXJzaW9uRmllbGQoKSB7CiAgICAgICAgaWYgKF92ZXJzaW9uSWR4ID09\nIEludGVnZXIuTUlOX1ZBTFVFKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50IGlk\neCA9IC0xOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxk\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tp\nXS5pc1ZlcnNpb24oKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpZHgg\nIT0gLTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKCJtdWx0LXZlcnMtZmllbGRzIiwgdGhpcywgZmllbGRzW2lkeF0s\nIGZpZWxkc1tpXSkpOwogICAgICAgICAgICAgICAgICAgIGlkeCA9IGk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3Zl\ncnNpb25JZHggPSBpZHg7CiAgICAgICAgfQogICAgICAgIGlmIChfdmVyc2lv\nbklkeCA9PSAtMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\ncmV0dXJuIGdldEZpZWxkcygpW192ZXJzaW9uSWR4XTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBwZXJzaXN0\nZW50IG9yIHRyYW5zYWN0aW9uYWwgZmllbGQgd2l0aAogICAgICogdGhlIGdp\ndmVuIGFic29sdXRlIGluZGV4LgogICAgICoKICAgICAqIEByZXR1cm4gdGhl\nIGZpZWxkJ3MgbWV0YWRhdGEsIG9yIG51bGwgaWYgbm90IGZvdW5kCiAgICAg\nKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldEZpZWxkKGludCBpbmRl\neCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVs\nZHMoKTsKICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IGZpZWxk\ncy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJl\ndHVybiBmaWVsZHNbaW5kZXhdOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQgb3IgdHJhbnNh\nY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4gcmVsYXRpdmUg\naW5kZXguCiAgICAgKgogICAgICogQHJldHVybiB0aGUgZmllbGQncyBtZXRh\nZGF0YSwgb3IgbnVsbCBpZiBub3QgZm91bmQKICAgICAqLwogICAgcHVibGlj\nIEZpZWxkTWV0YURhdGEgZ2V0RGVjbGFyZWRGaWVsZChpbnQgaW5kZXgpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RGVjbGFyZWRG\naWVsZHMoKTsKICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IGZp\nZWxkcy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIHJldHVybiBmaWVsZHNbaW5kZXhdOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQgb3IgdHJh\nbnNhY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4gbmFtZS4K\nICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBv\nciBudWxsIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBwdWJsaWMgRmllbGRN\nZXRhRGF0YSBnZXRGaWVsZChTdHJpbmcgbmFtZSkgewogICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kID0gZ2V0RGVjbGFyZWRGaWVsZChuYW1lKTsKICAgICAg\nICBpZiAoZm1kICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmbWQ7CiAg\nICAgICAgaWYgKF9zdXBGaWVsZE1hcCAhPSBudWxsICYmIF9kZWZTdXBGaWVs\nZHMpIHsKICAgICAgICAgICAgZm1kID0gKEZpZWxkTWV0YURhdGEpIF9zdXBG\naWVsZE1hcC5nZXQobmFtZSk7CiAgICAgICAgICAgIGlmIChmbWQgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBmbWQ7CiAgICAgICAgfQogICAg\nICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0RmllbGQobmFtZSk7CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIG1ldGFkYXRhIGZvciB0aGUgcGVyc2lzdGVudCBvciB0cmFuc2FjdGlv\nbmFsIGZpZWxkIHdpdGgKICAgICAqIHRoZSBnaXZlbiBuYW1lLCB3aXRob3V0\nIGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxkcy4KICAgICAqCiAgICAgKiBA\ncmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBvciBudWxsIGlmIG5vdCBm\nb3VuZAogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXREZWNs\nYXJlZEZpZWxkKFN0cmluZyBuYW1lKSB7CiAgICAgICAgRmllbGRNZXRhRGF0\nYSBmaWVsZCA9IChGaWVsZE1ldGFEYXRhKSBfZmllbGRNYXAuZ2V0KG5hbWUp\nOwogICAgICAgIGlmIChmaWVsZCA9PSBudWxsIHx8IGZpZWxkLmdldE1hbmFn\nZW1lbnQoKSA9PSBmaWVsZC5NQU5BR0VfTk9ORSkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGZpZWxkOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGFueSBmaWVsZHMgdGhhdCB3ZXJlIGFkZGVkIGFz\nIG5vbi1tYW5hZ2VkLgogICAgICogQWxsIG90aGVyIG1ldGhvZHMgdG8gZ2V0\nIGZpZWxkcyByZXR1cm4gb25seSB0aG9zZSB0aGF0IGFyZSBtYW5hZ2VkLgog\nICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldERlY2xhcmVk\nVW5tYW5hZ2VkRmllbGRzKCkgewogICAgICAgIGlmIChfdW5tZ2RGaWVsZHMg\nPT0gbnVsbCkgewogICAgICAgICAgICBDb2xsZWN0aW9uIHVubWFuYWdlZCA9\nIG5ldyBBcnJheUxpc3QoMyk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEg\nZmllbGQ7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2ZpZWxk\nTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICBmaWVsZCA9IChGaWVsZE1ldGFEYXRhKSBpdHIubmV4\ndCgpOwogICAgICAgICAgICAgICAgaWYgKGZpZWxkLmdldE1hbmFnZW1lbnQo\nKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9OT05FKQogICAgICAgICAgICAg\nICAgICAgIHVubWFuYWdlZC5hZGQoZmllbGQpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIF91bm1nZEZpZWxkcyA9IChGaWVsZE1ldGFEYXRhW10pIHVu\nbWFuYWdlZC50b0FycmF5CiAgICAgICAgICAgICAgICAoX3JlcG9zLm5ld0Zp\nZWxkTWV0YURhdGFBcnJheSh1bm1hbmFnZWQuc2l6ZSgpKSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBfdW5tZ2RGaWVsZHM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgYSBuZXcgZmllbGQgbWV0YWRhdGEgdG8gdGhpcyBjbGFz\ncy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgYWRkRGVjbGFy\nZWRGaWVsZChTdHJpbmcgbmFtZSwgQ2xhc3MgdHlwZSkgewogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGEobmFt\nZSwgdHlwZSwgdGhpcyk7CiAgICAgICAgY2xlYXJGaWVsZENhY2hlKCk7CiAg\nICAgICAgX2ZpZWxkTWFwLnB1dChuYW1lLCBmbWQpOwogICAgICAgIHJldHVy\nbiBmbWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVu\nIGZpZWxkIGZyb20gbWFuYWdlbWVudC4KICAgICAqCiAgICAgKiBAcmV0dXJu\nIHRydWUgaWYgdGhlIGZpZWxkIHdhcyByZW1vdmVkLCBmYWxzZSBvdGhlcndp\nc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlRGVjbGFyZWRG\naWVsZChGaWVsZE1ldGFEYXRhIGZpZWxkKSB7CiAgICAgICAgaWYgKGZpZWxk\nICE9IG51bGwgJiYgX2ZpZWxkTWFwLnJlbW92ZShmaWVsZC5nZXROYW1lKCkp\nICE9IG51bGwpIHsKICAgICAgICAgICAgY2xlYXJGaWVsZENhY2hlKCk7CiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRl\nZmluZWQgc3VwZXJjbGFzcyBmaWVsZCB3aXRoIHRoZSBnaXZlbiBuYW1lLCBv\nciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFE\nYXRhIGdldERlZmluZWRTdXBlcmNsYXNzRmllbGQoU3RyaW5nIG5hbWUpIHsK\nICAgICAgICBpZiAoX3N1cEZpZWxkTWFwID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAoRmllbGRNZXRhRGF0YSkg\nX3N1cEZpZWxkTWFwLmdldChuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZCBhIG5ldyBkZWZpbmVkIHN1cGVyY2xhc3MgZmllbGQgbWV0YWRhdGEg\ndG8gdGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURh\ndGEgYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChTdHJpbmcgbmFtZSwgQ2xh\nc3MgdHlwZSwKICAgICAgICBDbGFzcyBzdXApIHsKICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhKG5hbWUsIHR5\ncGUsIHRoaXMpOwogICAgICAgIGZtZC5zZXREZWNsYXJpbmdUeXBlKHN1cCk7\nCiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAgX2RlZlN1\ncEZpZWxkcyA9IGZhbHNlOwogICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0g\nbnVsbCkKICAgICAgICAgICAgX3N1cEZpZWxkTWFwID0gbmV3IEhhc2hNYXAo\nKTsKICAgICAgICBfc3VwRmllbGRNYXAucHV0KG5hbWUsIGZtZCk7CiAgICAg\nICAgcmV0dXJuIGZtZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0\naGUgZ2l2ZW4gZmllbGQgZnJvbSBtYW5hZ2VtZW50LgogICAgICoKICAgICAq\nIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZmllbGQgd2FzIHJlbW92ZWQsIGZhbHNl\nIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVE\nZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKEZpZWxkTWV0YURhdGEgZmllbGQpIHsK\nICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCAmJiBfc3VwRmllbGRNYXAgIT0g\nbnVsbAogICAgICAgICAgICAmJiBfc3VwRmllbGRNYXAucmVtb3ZlKGZpZWxk\nLmdldE5hbWUoKSkgIT0gbnVsbCkgewogICAgICAgICAgICBjbGVhckFsbEZp\nZWxkQ2FjaGUoKTsKICAgICAgICAgICAgX2RlZlN1cEZpZWxkcyA9IGZhbHNl\nOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogSW5jb3Jwb3Jh\ndGUgc3VwZXJjbGFzcyBmaWVsZHMgcmVkZWZpbmVkIGluIHRoaXMgc3ViY2xh\nc3MgaW50byB0aGlzCiAgICAgKiBtZXRhZGF0YS4gVGhpcyBtZXRob2QgaXMg\nZ2VuZXJhbGx5IGNhbGxlZCBhZnRlciBtZXRhZGF0YSBpcyByZXNvbHZlZAog\nICAgICogYW5kIG1hcHBpbmcgaW5mb3JtYXRpb24gaXMgbG9hZGVkLCBidXQg\nYmVmb3JlIG1hcHBpbmcgcmVzb2x2ZS4KICAgICAqCiAgICAgKiBAcGFyYW0g\nZm9yY2Ugd2hldGhlciB0byBmb3JjZSByZS1tYXBwaW5nIG9mIGV2ZW4gbWFw\ncGVkIHN1cGVyY2xhc3MgZmllbGRzCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGRlZmluZVN1cGVyY2xhc3NGaWVsZHMoYm9vbGVhbiBmb3JjZSkgewogICAg\nICAgIGlmIChfZGVmU3VwRmllbGRzKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKTsKICAgICAgICBpZiAoaXNNYXBwZWQoKSAmJiBzdXAgIT0gbnVs\nbCkgewogICAgICAgICAgICAvLyByZWRlZmluZSBhbGwgdW5tYXBwZWQgc3Vw\nZXJjbGFzcyBmaWVsZHMKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHN1\ncHMgPSBzdXAuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgc3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\naWYgKChmb3JjZSB8fCAhc3Vwc1tpXS5nZXREZWZpbmluZ01ldGFEYXRhKCku\naXNNYXBwZWQoKSkKICAgICAgICAgICAgICAgICAgICAmJiBnZXREZWZpbmVk\nU3VwZXJjbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0TmFtZSgpKSA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVs\nZChzdXBzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAg\nc3Vwc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgc3Vwc1tpXS5nZXREZWNsYXJp\nbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJlc29sdmVEZWZpbmVkU3VwZXJjbGFzc0ZpZWxk\ncygpOwoKICAgICAgICAvLyB0aGlzIGVuc3VyZXMgdGhhdCBhbGwgZmllbGQg\naW5kZXhlcyBnZXQgc2V0IHdoZW4gZmllbGRzIGFyZSBjYWNoZWQuCiAgICAg\nICAgLy8gSSBkb24ndCBsaWtlIGRvaW5nIHRoaXMgdHdpY2UgKGl0J3MgYWxz\nbyBkb25lIGluIHJlc29sdmVNZXRhKSwgYnV0CiAgICAgICAgLy8gd2UgaGF2\nZSB0byByZS1jYWNoZSBpbiBjYXNlIHRoaXMgY2xhc3Mgb3IgYW55IHN1cGVy\nY2xhc3MgcmVwbGFjZWQKICAgICAgICAvLyBzb21lIGZpZWxkcyB3aXRoIHJl\nZGVmaW5lZCB2ZXJzaW9ucywgYW5kIEkgZG9uJ3Qgd2FudCBvdXRzaWRlIGNv\nZGUKICAgICAgICAvLyB0byBoYXZlIHRvIGNhbGwgdGhpcyBtZXRob2QgYWZ0\nZXIgcmVzb2x2ZSBqdXN0IHRvIGdldCBmaWVsZCBpbmRleGVzLAogICAgICAg\nIC8vIGV0YyBzZXQgY29ycmVjdGx5CiAgICAgICAgY2xlYXJBbGxGaWVsZENh\nY2hlKCk7CiAgICAgICAgY2FjaGVGaWVsZHMoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlc29sdmUgc3VwZXJjbGFzcyBmaWVsZHMgd2UndmUgcmVkZWZp\nbmVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2ZURlZmluZWRT\ndXBlcmNsYXNzRmllbGRzKCkgewogICAgICAgIF9kZWZTdXBGaWVsZHMgPSB0\ncnVlOwogICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZDsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIHN1cDsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IF9zdXBGaWVsZE1hcC52YWx1ZXMoKS5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICBmbWQgPSAoRmllbGRNZXRhRGF0\nYSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgc3VwID0gZ2V0U3VwZXJjbGFz\nc0ZpZWxkKGZtZCk7CgogICAgICAgICAgICAvLyBqcGEgbWV0YWRhdGEgZG9l\nc24ndCBxdWFsaWZ5IHN1cGVyY2xhc3MgZmllbGQgbmFtZXMsIHNvIHdlCiAg\nICAgICAgICAgIC8vIG1pZ2h0IG5vdCBrbm93IHRoZSBkZWNsYXJpbmcgdHlw\nZSB1bnRpbCBub3cKICAgICAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJpbmdU\neXBlKCkgPT0gT2JqZWN0LmNsYXNzKSB7CiAgICAgICAgICAgICAgICBmbWQu\nc2V0RGVjbGFyaW5nVHlwZShzdXAuZ2V0RGVjbGFyaW5nVHlwZSgpKTsKICAg\nICAgICAgICAgICAgIGZtZC5iYWNraW5nTWVtYmVyKGdldFJlcG9zaXRvcnko\nKS5nZXRNZXRhRGF0YUZhY3RvcnkoKS4KICAgICAgICAgICAgICAgICAgICBn\nZXREZWZhdWx0cygpLmdldEJhY2tpbmdNZW1iZXIoZm1kKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgZm1kLmNvcHkoc3VwKTsKICAgICAgICAgICAg\nZm1kLnJlc29sdmUoTU9ERV9NRVRBKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIGFsbCB0aGUgZmllbGRz\nIGRlZmluZWQgYnkgdGhpcyBjbGFzcy4KICAgICAqIFRoaXMgaW5jbHVkZXMg\nbWFwcGVkIGRlY2xhcmVkIGZpZWxkcyBhbmQgYW55IGNvbmNyZXRlIG1hcHBp\nbmcgb2YKICAgICAqIHVubWFwcGVkIHN1cGVyY2xhc3MgZmllbGRzIHBlcmZv\ncm1lZCBieSB0aGlzIGNsYXNzLgogICAgICovCiAgICBwdWJsaWMgRmllbGRN\nZXRhRGF0YVtdIGdldERlZmluZWRGaWVsZHMoKSB7CiAgICAgICAgaWYgKF9k\nZWZpbmVkRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBMaXN0\nIGRlZmluZWQgPSBuZXcgQXJyYXlMaXN0KGZpZWxkcy5sZW5ndGgpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc01hcHBlZCgp\nCiAgICAgICAgICAgICAgICAgICAgJiYgZmllbGRzW2ldLmdldERlZmluaW5n\nTWV0YURhdGEoKSA9PSB0aGlzKQogICAgICAgICAgICAgICAgICAgIGRlZmlu\nZWQuYWRkKGZpZWxkc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nX2RlZmluZWRGaWVsZHMgPSAoRmllbGRNZXRhRGF0YVtdKSBkZWZpbmVkLnRv\nQXJyYXkKICAgICAgICAgICAgICAgIChfcmVwb3MubmV3RmllbGRNZXRhRGF0\nYUFycmF5KGRlZmluZWQuc2l6ZSgpKSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBfZGVmaW5lZEZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgYWxsIGZpZWxkcyBpbiB0aGUgb3JkZXIgdGhleSBhcmUgbGlzdGVk\nIGluIHRoZSBtZXRhZGF0YQogICAgICogZmlsZS4gVW5saXN0ZWQgZmllbGRz\nIGFyZSBwbGFjZWQgYWZ0ZXIgbGlzdGVkIG9uZXMuCiAgICAgKi8KICAgIHB1\nYmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RmllbGRzSW5MaXN0aW5nT3JkZXIo\nKSB7CiAgICAgICAgaWYgKF9hbGxMaXN0aW5nRmllbGRzID09IG51bGwpIHsK\nICAgICAgICAgICAgLy8gY29tYmluZSBkZWNsYXJlZCBhbmQgdW5tYW5hZ2Vk\nIGZpZWxkcyBpbnRvIGxpc3Rpbmcgb3JkZXIgYXJyYXkKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGRlYyA9IGdldERlY2xhcmVkRmllbGRzKCk7CiAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSB1bm1nZCA9IGdldERlY2xhcmVk\nVW5tYW5hZ2VkRmllbGRzKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBkZWNMaXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheQog\nICAgICAgICAgICAgICAgKGRlYy5sZW5ndGggKyB1bm1nZC5sZW5ndGgpOwog\nICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGRlYywgMCwgZGVjTGlzdGlu\nZywgMCwgZGVjLmxlbmd0aCk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNv\ncHkodW5tZ2QsIDAsIGRlY0xpc3RpbmcsIGRlYy5sZW5ndGgsIHVubWdkLmxl\nbmd0aCk7CiAgICAgICAgICAgIEFycmF5cy5zb3J0KGRlY0xpc3RpbmcsIExp\nc3RpbmdPcmRlckNvbXBhcmF0b3IuZ2V0SW5zdGFuY2UoKSk7CgogICAgICAg\nICAgICBpZiAoX3N1cGVyID09IG51bGwpCiAgICAgICAgICAgICAgICBfYWxs\nTGlzdGluZ0ZpZWxkcyA9IGRlY0xpc3Rpbmc7CiAgICAgICAgICAgIGVsc2Ug\newogICAgICAgICAgICAgICAgLy8gcGxhY2Ugc3VwZXJjbGFzcyBmaWVsZHMg\naW4gbGlzdGluZyBvcmRlciBiZWZvcmUgb3VyCiAgICAgICAgICAgICAgICAv\nLyBsaXN0aW5nLW9yZGVyIGRlY2xhcmVkIGZpZWxkcwogICAgICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0RmllbGRzSW5MaXN0aW5n\nT3JkZXIoKTsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBsaXN0\naW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheQogICAgICAgICAg\nICAgICAgICAgIChzdXAubGVuZ3RoICsgZGVjTGlzdGluZy5sZW5ndGgpOwog\nICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShzdXAsIDAsIGxpc3Rp\nbmcsIDAsIHN1cC5sZW5ndGgpOwogICAgICAgICAgICAgICAgcmVwbGFjZURl\nZmluZWRTdXBlcmNsYXNzRmllbGRzKGxpc3RpbmcsIHN1cC5sZW5ndGgpOwog\nICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShkZWNMaXN0aW5nLCAw\nLCBsaXN0aW5nLCBzdXAubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgIGRl\nY0xpc3RpbmcubGVuZ3RoKTsKICAgICAgICAgICAgICAgIF9hbGxMaXN0aW5n\nRmllbGRzID0gbGlzdGluZzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gX2FsbExpc3RpbmdGaWVsZHM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIGFsbCBmaWVsZHMgZGVmaW5lZCBieSB0aGlzIGNs\nYXNzIGluIHRoZSBvcmRlciB0aGV5IGFyZSBsaXN0ZWQKICAgICAqIGluIHRo\nZSBtZXRhZGF0YSBmaWxlLiBVbmxpc3RlZCBmaWVsZHMgYXJlIHBsYWNlZCBh\nZnRlciBsaXN0ZWQgb25lcy4KICAgICAqIFRoaXMgYXJyYXkgaW5jbHVkZXMg\nZGVjbGFyZWQgdHJhbnNhY3Rpb25hbCBhbmQgdW5tYW5hZ2VkIGZpZWxkcy4K\nICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWZpbmVk\nRmllbGRzSW5MaXN0aW5nT3JkZXIoKSB7CiAgICAgICAgaWYgKF9saXN0aW5n\nRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBMaXN0IGRlZmlu\nZWQgPSBuZXcgQXJyYXlMaXN0KGZpZWxkcy5sZW5ndGgpOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uZ2V0RGVmaW5pbmdNZXRhRGF0\nYSgpID09IHRoaXMpCiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZC5hZGQo\nZmllbGRzW2ldKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHVubWdk\nID0gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVsZHMoKTsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGxpc3RpbmcgPSBfcmVwb3MubmV3RmllbGRNZXRh\nRGF0YUFycmF5CiAgICAgICAgICAgICAgICAoZGVmaW5lZC5zaXplKCkgKyB1\nbm1nZC5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGRlZmluZWQuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgICAgICBsaXN0aW5n\nW2ldID0gKEZpZWxkTWV0YURhdGEpIGRlZmluZWQuZ2V0KGkpOwogICAgICAg\nICAgICBTeXN0ZW0uYXJyYXljb3B5KHVubWdkLCAwLCBsaXN0aW5nLCBkZWZp\nbmVkLnNpemUoKSwgdW5tZ2QubGVuZ3RoKTsKICAgICAgICAgICAgQXJyYXlz\nLnNvcnQobGlzdGluZywgTGlzdGluZ09yZGVyQ29tcGFyYXRvci5nZXRJbnN0\nYW5jZSgpKTsKICAgICAgICAgICAgX2xpc3RpbmdGaWVsZHMgPSBsaXN0aW5n\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2xpc3RpbmdGaWVsZHM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0aGUgZGF0YWNhY2hl\nIHRvIHVzZSBmb3IgdGhpcyBjbGFzcywgb3IgbnVsbCBpZiBub25lLgogICAg\nICovCiAgICBwdWJsaWMgU3RyaW5nIGdldERhdGFDYWNoZU5hbWUoKSB7CiAg\nICAgICAgaWYgKERFRkFVTFRfU1RSSU5HLmVxdWFscyhfY2FjaGVOYW1lKSkg\newogICAgICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfY2FjaGVOYW1lID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5n\nZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIF9jYWNoZU5hbWUgPSBEYXRhQ2FjaGUuTkFNRV9ERUZBVUxUOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2NhY2hlTmFtZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgY2FjaGUgbmFtZSBmb3IgdGhpcyBjbGFz\ncy4gU2V0IHRvIG51bGwgdG8gZGlzYWJsZSBjYWNoaW5nLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXREYXRhQ2FjaGVOYW1lKFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgX2NhY2hlTmFtZSA9IG5hbWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgY2FjaGUgdGltZW91dCBmb3IgdGhpcyBjbGFzcy4gLTEgaW5k\naWNhdGVzIG5vIHRpbWVvdXQuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0\nRGF0YUNhY2hlVGltZW91dCgpIHsKICAgICAgICBpZiAoX2NhY2hlVGltZW91\ndCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSkgewogICAgICAgICAgICBpZiAoX3N1\ncGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBfY2FjaGVUaW1lb3V0ID0g\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS4KICAgICAgICAgICAgICAgICAg\nICBnZXREYXRhQ2FjaGVUaW1lb3V0KCk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIF9jYWNoZVRpbWVvdXQgPSBfcmVwb3MuZ2V0Q29uZmln\ndXJhdGlvbigpLgogICAgICAgICAgICAgICAgICAgIGdldERhdGFDYWNoZVRp\nbWVvdXQoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jYWNoZVRpbWVv\ndXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2FjaGUgdGltZW91dCBm\nb3IgdGhpcyBjbGFzcy4gLTEgaW5kaWNhdGVzIG5vIHRpbWVvdXQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldERhdGFDYWNoZVRpbWVvdXQoaW50IHRp\nbWVvdXQpIHsKICAgICAgICBfY2FjaGVUaW1lb3V0ID0gdGltZW91dDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGF0YSBjYWNoZSBmb3Ig\ndGhpcyBjbGFzcywgb3IgbnVsbCBpZiBpdCBpcyBub3QgY2FjaGFibGUuCiAg\nICAgKi8KICAgIHB1YmxpYyBEYXRhQ2FjaGUgZ2V0RGF0YUNhY2hlKCkgewog\nICAgICAgIFN0cmluZyBuYW1lID0gZ2V0RGF0YUNhY2hlTmFtZSgpOwogICAg\nICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIHJldHVybiBfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLmdl\ndERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRE\nYXRhQ2FjaGUobmFtZSwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIGluc3RhbmNlcyBhcmUgZGV0YWNoYWJsZS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gaXNEZXRhY2hhYmxlKCkgewogICAgICAgIGlmIChf\nZGV0YWNoYWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfc3VwZXIg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9kZXRhY2hhYmxlID0gKGdldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKCkuaXNEZXRhY2hhYmxlKCkpCiAgICAgICAg\nICAgICAgICAgICAgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfZGV0YWNoYWJsZSA9\nIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZGV0\nYWNoYWJsZS5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgaW5zdGFuY2VzIGFyZSBkZXRhY2hhYmxlLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXREZXRhY2hhYmxlKGJvb2xlYW4gZGV0YWNoYWJs\nZSkgewogICAgICAgIF9kZXRhY2hhYmxlID0gKGRldGFjaGFibGUpID8gQm9v\nbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBuYW1lIG9mIHRoZSBkZXRhY2ggc3RhdGUgZmllbGQsIG9yIG51\nbGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXREZXRh\nY2hlZFN0YXRlKCkgewogICAgICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVh\nbHMoX2RldGFjaFN0YXRlKSkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRh\nIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAg\nIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuaXNEZXRhY2hhYmxlKCkgPT0gaXNE\nZXRhY2hhYmxlKCkpCiAgICAgICAgICAgICAgICBfZGV0YWNoU3RhdGUgPSBz\ndXAuZ2V0RGV0YWNoZWRTdGF0ZSgpOwogICAgICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgICAgIEJvb2xlYW4gdXNlID0gdXNlc0RldGFjaGVkU3RhdGUo\nU1lOVEhFVElDLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9kZXRhY2hTdGF0\nZSA9IChCb29sZWFuLkZBTFNFLmVxdWFscyh1c2UpKSA/IG51bGwgOiBTWU5U\nSEVUSUM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIF9kZXRhY2hTdGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1l\nIG9mIHRoZSBkZXRhY2ggc3RhdGUgZmllbGQsIG9yIG51bGwgaWYgbm9uZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGV0YWNoZWRTdGF0ZShTdHJp\nbmcgZmllbGQpIHsKICAgICAgICBfZGV0YWNoU3RhdGUgPSBmaWVsZDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGV0YWNoIHN0YXRlIGZp\nZWxkLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVs\nZCBnZXREZXRhY2hlZFN0YXRlRmllbGQoKSB7CiAgICAgICAgLy8gbm8gY2Fj\naGluZzsgb25seSB1c2VkIGF0IGVuaGFuY2VtZW50CiAgICAgICAgU3RyaW5n\nIGZpZWxkTmFtZSA9IGdldERldGFjaGVkU3RhdGUoKTsKICAgICAgICBpZiAo\nZmllbGROYW1lID09IG51bGwgfHwgU1lOVEhFVElDLmVxdWFscyhmaWVsZE5h\nbWUpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgRmllbGQg\nZiA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKF90eXBlLCBmaWVsZE5hbWUsIGZh\nbHNlKTsKICAgICAgICBpZiAoZiAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gZjsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJuby1k\nZXRhY2gtc3RhdGUiLCBmaWVsZE5hbWUsIF90eXBlKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIGFuIGluc3RhbmNlIG9mIHRoaXMgdHlwZSBo\nYXMgZGV0YWNoZWQgc3RhdGUuCiAgICAgKgogICAgICogQHJldHVybiB0cnVl\nIGlmIGEgZGV0YWNoZWQgaW5zdGFuY2UgbXVzdCBoYXZlIGRldGFjaGVkIHN0\nYXRlLCBmYWxzZQogICAgICogaWYgaXQgZG9lcyBub3QsIGFuZCBudWxsIGlm\nIGl0IG1heSB1c2UgYQogICAgICogbWFudWFsbHktY29uc3RydWN0ZWQgaW5z\ndGFuY2Ugd2l0aG91dCBkZXRhY2hlZCBzdGF0ZQogICAgICovCiAgICBwdWJs\naWMgQm9vbGVhbiB1c2VzRGV0YWNoZWRTdGF0ZSgpIHsKICAgICAgICAvLyBu\nbyBuZWVkIHRvIGxldCBjb25mIGRpc2FsbG93IGJlY2F1c2UgaXQncyB0YWtl\nbiBpbnRvIGFjY291bnQgaW4KICAgICAgICAvLyBnZXREZXRhY2hlZFN0YXRl\nKCkgY2FsbAogICAgICAgIHJldHVybiB1c2VzRGV0YWNoZWRTdGF0ZShnZXRE\nZXRhY2hlZFN0YXRlKCksIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgYW4gaW5zdGFuY2Ugb2YgdGhpcyB0eXBlIGhhcyBkZXRhY2hl\nZCBzdGF0ZSwgYXNzdW1pbmcgdGhlIGdpdmVuCiAgICAgKiBkZXRhY2hlZCBz\ndGF0ZSBmaWVsZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgYSBk\nZXRhY2hlZCBpbnN0YW5jZSBtdXN0IGhhdmUgZGV0YWNoZWQgc3RhdGUsIGZh\nbHNlCiAgICAgKiBpZiBpdCBkb2VzIG5vdCwgYW5kIG51bGwgaWYgaXQgbWF5\nIHVzZSBhCiAgICAgKiBtYW51YWxseS1jb25zdHJ1Y3RlZCBpbnN0YW5jZSB3\naXRob3V0IGRldGFjaGVkIHN0YXRlCiAgICAgKi8KICAgIHByaXZhdGUgQm9v\nbGVhbiB1c2VzRGV0YWNoZWRTdGF0ZShTdHJpbmcgZGV0YWNoZWRGaWVsZCwK\nICAgICAgICBib29sZWFuIGNvbmZEaXNhbGxvd3MpIHsKICAgICAgICBpZiAo\nIWlzRGV0YWNoYWJsZSgpKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5G\nQUxTRTsKCiAgICAgICAgLy8gaWYgd2UgZGVjbGFyZSBhIGRldGFjaGVkIHN0\nYXRlIGZpZWxkLCBoYXZlIHRvIHVzZSBpdAogICAgICAgIGlmIChkZXRhY2hl\nZEZpZWxkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZB\nTFNFOwogICAgICAgIGlmICghU1lOVEhFVElDLmVxdWFscyhkZXRhY2hlZEZp\nZWxkKSkKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKCiAgICAg\nICAgLy8gYWxsb3cgY29uZiB0byBkaXNhbGxvdwogICAgICAgIGlmIChjb25m\nRGlzYWxsb3dzICYmICFfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLgogICAg\nICAgICAgICBnZXREZXRhY2hTdGF0ZUluc3RhbmNlKCkuZ2V0RGV0YWNoZWRT\ndGF0ZUZpZWxkKCkpCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNF\nOwoKICAgICAgICAvLyBoYXZlIHRvIHVzZSBkZXRhY2hlZCBzdGF0ZSB0byBz\ndG9yZSBkYXRhc3RvcmUgaWQKICAgICAgICBpZiAoZ2V0SWRlbnRpdHlUeXBl\nKCkgPT0gSURfREFUQVNUT1JFKQogICAgICAgICAgICByZXR1cm4gQm9vbGVh\nbi5UUlVFOwoKICAgICAgICAvLyBhbGxvdyBkZXRhY2hlZCBzdGF0ZSB1c2Us\nIGJ1dCBkb24ndCByZXF1aXJlCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDbGVhciBjYWNoZWQgZmllbGQgZGF0YS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJBbGxGaWVsZENhY2hlKCkg\newogICAgICAgIF9hbGxGaWVsZHMgPSBudWxsOwogICAgICAgIF9hbGxERkdG\naWVsZHMgPSBudWxsOwogICAgICAgIF9hbGxQS0ZpZWxkcyA9IG51bGw7CiAg\nICAgICAgX2RlZmluZWRGaWVsZHMgPSBudWxsOwogICAgICAgIF9saXN0aW5n\nRmllbGRzID0gbnVsbDsKICAgICAgICBfYWxsTGlzdGluZ0ZpZWxkcyA9IG51\nbGw7CiAgICAgICAgX2ZpZWxkRGF0YVRhYmxlID0gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIENsZWFyIGRlZmluZWQgZmllbGQgZGF0YS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJEZWZpbmVkRmllbGRDYWNoZSgp\nIHsKICAgICAgICBfZGVmaW5lZEZpZWxkcyA9IG51bGw7CiAgICAgICAgX2xp\nc3RpbmdGaWVsZHMgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ2xl\nYXIgY2FjaGVkIGZpZWxkIGRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIGNsZWFyRmllbGRDYWNoZSgpIHsKICAgICAgICBjbGVhckFsbEZpZWxk\nQ2FjaGUoKTsKICAgICAgICBfZmllbGRzID0gbnVsbDsKICAgICAgICBfdW5t\nZ2RGaWVsZHMgPSBudWxsOwogICAgICAgIF92ZXJzaW9uSWR4ID0gSW50ZWdl\nci5NSU5fVkFMVUU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBjYWNo\nZWQgc3ViY2xhc3MgZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\nY2xlYXJTdWJjbGFzc0NhY2hlKCkgewogICAgICAgIF9zdWJzID0gbnVsbDsK\nICAgICAgICBfc3ViTWV0YXMgPSBudWxsOwogICAgICAgIF9tYXBTdWJNZXRh\ncyA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBpbXBsIGRh\ndGEgYW5kIGludGVybWVkaWF0ZSBkYXRhIHRhYmxlLgogICAgICovCiAgICB2\nb2lkIGNsZWFyRXh0cmFGaWVsZERhdGFUYWJsZSgpIHsKICAgICAgICBfZmll\nbGREYXRhVGFibGUgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ2Fj\naGUgZmllbGQgYXJyYXlzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY2Fj\naGVGaWVsZHMoKSB7CiAgICAgICAgZ2V0RmllbGRzKCk7CiAgICAgICAgZ2V0\nUHJpbWFyeUtleUZpZWxkcygpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgaGFz\naENvZGUoKSB7CiAgICAgICAgcmV0dXJuIF90eXBlLmdldE5hbWUoKS5oYXNo\nQ29kZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmpl\nY3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCEob3RoZXIgaW5zdGFu\nY2VvZiBDbGFzc01ldGFEYXRhKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIHJldHVybiBfdHlwZSA9PSAoKENsYXNzTWV0YURhdGEpIG90\naGVyKS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICB9CgogICAgcHVibGljIGlu\ndCBjb21wYXJlVG8oT2JqZWN0IG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVy\nID09IHRoaXMpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIHJldHVy\nbiBfdHlwZS5nZXROYW1lKCkuY29tcGFyZVRvKCgoQ2xhc3NNZXRhRGF0YSkg\nb3RoZXIpLgogICAgICAgICAgICBnZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFt\nZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewog\nICAgICAgIHJldHVybiBnZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpOwog\nICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUmVz\nb2x2ZSBhbmQgdmFsaWRhdGUKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIC8qKgogICAgICogVGhlIHJlc29sdmUgbW9kZSBmb3IgdGhpcyBt\nZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRSZXNvbHZlKCkg\newogICAgICAgIHJldHVybiBfcmVzTW9kZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSByZXNvbHZlIG1vZGUgZm9yIHRoaXMgbWV0YWRhdGEuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc29sdmUoaW50IG1vZGUpIHsKICAg\nICAgICBfcmVzTW9kZSA9IG1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgcmVzb2x2ZSBtb2RlIGZvciB0aGlzIG1ldGFkYXRhLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGludCBtb2RlLCBib29sZWFuIG9u\nKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAg\nICBfcmVzTW9kZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAg\nICAgICAgIF9yZXNNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBfcmVzTW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlc29sdmUgYW5kIHZhbGlkYXRlIG1ldGFkYXRhLiBSZXR1cm4gdHJ1ZSBp\nZiBhbHJlYWR5IHJlc29sdmVkLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiByZXNvbHZlKGludCBtb2RlKSB7CiAgICAgICAgaWYgKChfcmVzTW9kZSAm\nIG1vZGUpID09IG1vZGUpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIGludCBjdXIgPSBfcmVzTW9kZTsKICAgICAgICBfcmVzTW9kZSB8PSBt\nb2RlOwoKICAgICAgICBpbnQgdmFsID0gX3JlcG9zLmdldFZhbGlkYXRlKCk7\nCiAgICAgICAgYm9vbGVhbiBydW50aW1lID0gKHZhbCAmIF9yZXBvcy5WQUxJ\nREFURV9SVU5USU1FKSAhPSAwOwogICAgICAgIGJvb2xlYW4gdmFsaWRhdGUg\nPQogICAgICAgICAgICAhSW1wbEhlbHBlci5pc01hbmFnZWRUeXBlKGdldFJl\ncG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCksIF90eXBlKQogICAgICAg\nICAgICB8fCAodmFsICYgTWV0YURhdGFSZXBvc2l0b3J5LlZBTElEQVRFX1VO\nRU5IQU5DRUQpID09IDA7CgogICAgICAgIC8vIHdlIG9ubHkgZG8gYW55IGFj\ndGlvbnMgZm9yIG1ldGFkYXRhIG1vZGUKICAgICAgICBpZiAoKG1vZGUgJiBN\nT0RFX01FVEEpICE9IDAgJiYgKGN1ciAmIE1PREVfTUVUQSkgPT0gMCkgewog\nICAgICAgICAgICByZXNvbHZlTWV0YShydW50aW1lKTsKICAgICAgICAgICAg\naWYgKHZhbGlkYXRlICYmICh2YWwgJiBfcmVwb3MuVkFMSURBVEVfTUVUQSkg\nIT0gMCkKICAgICAgICAgICAgICAgIHZhbGlkYXRlTWV0YShydW50aW1lKTsK\nICAgICAgICB9CiAgICAgICAgaWYgKChtb2RlICYgTU9ERV9NQVBQSU5HKSAh\nPSAwICYmIChjdXIgJiBNT0RFX01BUFBJTkcpID09IDApIHsKICAgICAgICAg\nICAgcmVzb2x2ZU1hcHBpbmcocnVudGltZSk7CiAgICAgICAgICAgIGlmICh2\nYWxpZGF0ZSAmJiAodmFsICYgX3JlcG9zLlZBTElEQVRFX01BUFBJTkcpICE9\nIDApCiAgICAgICAgICAgICAgICB2YWxpZGF0ZU1hcHBpbmcocnVudGltZSk7\nCiAgICAgICAgfQogICAgICAgIGlmICgobW9kZSAmIE1PREVfTUFQUElOR19J\nTklUKSAhPSAwICYmIChjdXIgJiBNT0RFX01BUFBJTkdfSU5JVCkgPT0gMCkK\nICAgICAgICAgICAgaW5pdGlhbGl6ZU1hcHBpbmcoKTsKICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZlIG1ldGFk\nYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZXNvbHZlTWV0YShi\nb29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBib29sZWFuIGVtYmVkID0gX293\nbmVyICE9IG51bGwgJiYgX293bmVyLmdldERlY2xhcmVkVHlwZSgpID09IF90\neXBlOwogICAgICAgIExvZyBsb2cgPSBfcmVwb3MuZ2V0TG9nKCk7CiAgICAg\nICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cu\ndHJhY2UoX2xvYy5nZXQoKGVtYmVkKSA/ICJyZXNvbHZlLWVtYmVkLW1ldGEi\nIDogInJlc29sdmUtbWV0YSIsCiAgICAgICAgICAgICAgICB0aGlzICsgIkAi\nICsgU3lzdGVtLmlkZW50aXR5SGFzaENvZGUodGhpcykpKTsKCiAgICAgICAg\naWYgKHJ1bnRpbWUgJiYgIV90eXBlLmlzSW50ZXJmYWNlKCkgJiYKICAgICAg\nICAgICAgIUltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShnZXRSZXBvc2l0b3J5\nKCkuZ2V0Q29uZmlndXJhdGlvbigpLF90eXBlKSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtZW5oYW5j\nZWQiLCBfdHlwZSkpOwoKICAgICAgICAvLyBhcmUgd2UgdGhlIHRhcmdldCBv\nZiBhbiBlbWJlZGRlZCB2YWx1ZT8KICAgICAgICBpZiAoZW1iZWQpIHsKICAg\nICAgICAgICAgaWYgKF9vd25lci5nZXRGaWVsZE1ldGFEYXRhKCkuZ2V0RGVm\naW5pbmdNZXRhRGF0YSgpLgogICAgICAgICAgICAgICAgZ2V0RGVzY3JpYmVk\nVHlwZSgpLmlzQXNzaWduYWJsZUZyb20oX3R5cGUpKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJyZWN1\ncnNlLWVtYmVkIiwgX293bmVyKSk7CgogICAgICAgICAgICAvLyBjb3B5IGlu\nZm8gZnJvbSB0aGUgInJlYWwiIG1ldGFkYXRhIGZvciB0aGlzIHR5cGUKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX3JlcG9zLmdldE1ldGFE\nYXRhKF90eXBlLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgbWV0YS5y\nZXNvbHZlKE1PREVfTUVUQSk7CiAgICAgICAgICAgIGNvcHkodGhpcywgbWV0\nYSk7CiAgICAgICAgICAgIF9lbWJlZGRlZCA9IEJvb2xlYW4uRkFMU0U7IC8v\nIGVtYmVkZGVkIGluc3RhbmNlIGlzbid0IGVtYmVkZGVkLW9ubHkKICAgICAg\nICB9CgogICAgICAgIC8vIG1ha2Ugc3VyZSBzdXBlcmNsYXNzIGlzIHJlc29s\ndmVkCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkgewogICAg\nICAgICAgICBzdXAucmVzb2x2ZShNT0RFX01FVEEpOwogICAgICAgICAgICBp\nZiAoZW1iZWQpIHsKICAgICAgICAgICAgICAgIC8vIGVtYmVkZGVkIGluc3Rh\nbmNlIGFsd2F5cyByZWRlZmluZSBhbGwgc3VwZXJjbGFzcyBmaWVsZHMKICAg\nICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBzdXBzID0gc3VwLmdldEZp\nZWxkcygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\ndXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9z\ndXBGaWVsZE1hcCA9PSBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgIHx8\nICFfc3VwRmllbGRNYXAuY29udGFpbnNLZXkoc3Vwc1tpXS5nZXROYW1lKCkp\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERlZmluZWRTdXBlcmNs\nYXNzRmllbGQoc3Vwc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBzdXBzW2ldLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgc3Vwc1tpXS5nZXREZWNsYXJpbmdUeXBl\nKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVzb2x2ZSBm\naWVsZHMgYW5kIHJlbW92ZSBpbnZhbGlkcwogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2ZpZWxkTWFw\nLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgIC8vIG9ubHkgcGFzcyBvbiBtZXRhZGF0YSByZXNvbHZlIG1vZGUg\nc28gdGhhdCBtZXRhZGF0YSBpcyBhbHdheXMKICAgICAgICAgICAgLy8gcmVz\nb2x2ZWQgYmVmb3JlIGFueSBvdGhlciByZXNvbHZlIG1vZGVzIG91ciBzdWJj\nbGFzc2VzIHBhc3MgYWxvbmcKICAgICAgICAgICAgZm1kID0gKEZpZWxkTWV0\nYURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGZtZC5yZXNvbHZlKE1P\nREVfTUVUQSk7CgogICAgICAgICAgICBpZiAoIWZtZC5pc0V4cGxpY2l0KCkK\nICAgICAgICAgICAgICAgICYmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5PQkpFQ1QKICAgICAgICAgICAgICAgIHx8IGZtZC5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDX1VOVFlQRUQK\nICAgICAgICAgICAgICAgIHx8IChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5BUlJBWQogICAgICAgICAgICAgICAgJiYgZm1kLmdl\ndEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVDb2RlKCkKICAgICAgICAgICAg\nICAgID09IEphdmFUeXBlcy5PQkpFQ1QpKSkgewogICAgICAgICAgICAgICAg\nX3JlcG9zLmdldExvZygpLndhcm4oX2xvYy5nZXQoInJtLWZpZWxkIiwgZm1k\nKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldExpc3RpbmdJbmRleCgp\nICE9IC0xKQogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRNYW5hZ2VtZW50\nKGZtZC5NQU5BR0VfTk9ORSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAgICAgICAgICAg\nY2xlYXJGaWVsZENhY2hlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIC8vIGVtYmVkZGVkIGluc3RhbmNlcyBtdXN0IGVtYmVkIGFsbCBz\ndXBlcmNsYXNzIGZpZWxkcyB0b28KICAgICAgICBpZiAoZW1iZWQpIHsKICAg\nICAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAgICAgIHJl\nc29sdmVEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkcygpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gdGhpcyBlbnN1cmVzIHRoYXQgYWxsIGZpZWxkIGluZGV4ZXMg\nZ2V0IHNldCB3aGVuIGZpZWxkcyBhcmUgY2FjaGVkCiAgICAgICAgY2FjaGVG\naWVsZHMoKTsKCiAgICAgICAgLy8gcmVzb2x2ZSBsaWZlY3ljbGUgbWV0YWRh\ndGEgbm93IHRvIHByZXZlbnQgbGF6eSB0aHJlYWRpbmcgcHJvYmxlbXMKICAg\nICAgICBfbGlmZU1ldGEucmVzb2x2ZSgpOwoKICAgICAgICAvLyByZWNvcmQg\naW1wbGVtZW50cyBpbiB0aGUgcmVwb3NpdG9yeQogICAgICAgIGlmIChfaW50\nZXJmYWNlcyAhPSBudWxsKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXQgPSBfaW50ZXJmYWNlcy5pdGVyYXRvcigpOyBpdC5oYXNOZXh0KCk7KQog\nICAgICAgICAgICAgICAgX3JlcG9zLmFkZERlY2xhcmVkSW50ZXJmYWNlSW1w\nbCh0aGlzLCAoQ2xhc3MpIGl0Lm5leHQoKSk7CiAgICAgICAgfQoKICAgICAg\nICAvLyByZXNvbHZlIGZldGNoIGdyb3VwcwogICAgICAgIGlmIChfZmdNYXAg\nIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZmdN\nYXAudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAg\nICAgICAgICAgICAoKEZldGNoR3JvdXApIGl0ci5uZXh0KCkpLnJlc29sdmUo\nKTsKCiAgICAgICAgaWYgKCFlbWJlZCAmJiBfdHlwZS5pc0ludGVyZmFjZSgp\nKSB7CiAgICAgICAgICAgIGlmIChfaW50ZXJmYWNlICE9IEJvb2xlYW4uVFJV\nRSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiaW50ZXJmYWNlIiwgX3R5cGUpKTsKCiAgICAgICAgICAg\nIGlmIChydW50aW1lKSB7CiAgICAgICAgICAgICAgICBfaW1wbCA9IF9yZXBv\ncy5nZXRJbXBsR2VuZXJhdG9yKCkuY3JlYXRlSW1wbCh0aGlzKTsKICAgICAg\nICAgICAgICAgIF9yZXBvcy5zZXRJbnRlcmZhY2VJbXBsKHRoaXMsIF9pbXBs\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhp\ncyBpcyBydW50aW1lLCBjcmVhdGUgYSBwYyBpbnN0YW5jZSBhbmQgc2NhbiBp\ndCBmb3IgY29tcGFyYXRvcnMKICAgICAgICBpZiAocnVudGltZSAmJiAhTW9k\naWZpZXIuaXNBYnN0cmFjdChfdHlwZS5nZXRNb2RpZmllcnMoKSkpIHsKICAg\nICAgICAgICAgUHJveHlTZXR1cFN0YXRlTWFuYWdlciBzbSA9IG5ldyBQcm94\neVNldHVwU3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgIHNtLnNldFByb3h5\nRGF0YShQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKF90eXBlLCBzbSwgZmFsc2Up\nLCB0aGlzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxp\nZGF0ZSByZXNvbHZlZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgdmFsaWRhdGVNZXRhKGJvb2xlYW4gcnVudGltZSkgewogICAgICAg\nIHZhbGlkYXRlRGF0YUNhY2hlKCk7CiAgICAgICAgdmFsaWRhdGVEZXRhY2hh\nYmxlKCk7CiAgICAgICAgdmFsaWRhdGVFeHRlbnNpb25LZXlzKCk7CiAgICAg\nICAgdmFsaWRhdGVJZGVudGl0eSgpOwogICAgICAgIHZhbGlkYXRlQWNjZXNz\nVHlwZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBtYXBwaW5n\nIGRhdGEuIExvZ3MgcmVzb2x2ZSBtZXNzYWdlIGFuZCByZXNvbHZlcyBzdXBl\nciBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZXNv\nbHZlTWFwcGluZyhib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBMb2cgbG9n\nID0gX3JlcG9zLmdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVu\nYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJyZXNv\nbHZlLW1hcHBpbmciLCB0aGlzICsgIkAiCiAgICAgICAgICAgICAgICArIFN5\nc3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKSk7CgogICAgICAgIC8vIG1h\na2Ugc3VyZSBzdXBlcmNsYXNzIGlzIHJlc29sdmVkIGZpcnN0CiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgc3VwLnJl\nc29sdmUoTU9ERV9NQVBQSU5HKTsKICAgIH0KCiAgICAvKioKICAgICAqIFZh\nbGlkYXRlIG1hcHBpbmcgZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgdmFsaWRhdGVNYXBwaW5nKGJvb2xlYW4gcnVudGltZSkgewogICAgfQoK\nICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBtYXBwaW5nLiBMb2dzIGluaXQg\nbWVzc2FnZSBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCBpbml0aWFsaXplTWFwcGluZygpIHsKICAgICAgICBMb2cgbG9nID0gX3Jl\ncG9zLmdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJpbml0LW1hcHBp\nbmciLCB0aGlzICsgIkAiCiAgICAgICAgICAgICAgICArIFN5c3RlbS5pZGVu\ndGl0eUhhc2hDb2RlKHRoaXMpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBW\nYWxpZGF0ZSBkYXRhIGNhY2hlIHNldHRpbmdzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgdmFsaWRhdGVEYXRhQ2FjaGUoKSB7CiAgICAgICAgaW50IHRp\nbWVvdXQgPSBnZXREYXRhQ2FjaGVUaW1lb3V0KCk7CiAgICAgICAgaWYgKHRp\nbWVvdXQgPCAtMSB8fCB0aW1lb3V0ID09IDApCiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiY2FjaGUtdGltZW91\ndC1pbnZhbGlkIiwKICAgICAgICAgICAgICAgIF90eXBlLCBTdHJpbmcudmFs\ndWVPZih0aW1lb3V0KSkpOwoKICAgICAgICBpZiAoX3N1cGVyID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBTdHJpbmcgY2FjaGUgPSBn\nZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAgaWYgKGNhY2hlID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3RyaW5nIHN1cGVyQ2Fj\naGUgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldERhdGFDYWNoZU5h\nbWUoKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmVxdWFscyhjYWNoZSwg\nc3VwZXJDYWNoZSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiY2FjaGUtbmFtZXMiLCBuZXcgT2JqZWN0W10K\nICAgICAgICAgICAgICAgIHsgX3R5cGUsIGNhY2hlLCBfc3VwZXIsIHN1cGVy\nQ2FjaGUgfSkpOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQg\ndGhlIGlkZW50aXR5IGhhbmRsaW5nIGZvciB0aGlzIGNsYXNzIGlzIHZhbGlk\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVJZGVudGl0eSgp\nIHsKICAgICAgICAvLyBtYWtlIHN1cmUgaWRlbnRpdHkgdHlwZXMgYXJlIGNv\nbnNpc3RlbnQKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaW50IGlkID0gZ2V0SWRlbnRp\ndHlUeXBlKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5nZXRJ\nZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOCiAgICAgICAgICAgICYmIHN1\ncC5nZXRJZGVudGl0eVR5cGUoKSAhPSBpZCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpZC10eXBlcyIsIF90\neXBlKSk7CgogICAgICAgIC8vIGNoZWNrIGZvciB0aGluZ3MgdGhlIGRhdGEg\nc3RvcmUgZG9lc24ndCBzdXBwb3J0CiAgICAgICAgQ29sbGVjdGlvbiBvcHRz\nID0gX3JlcG9zLmdldENvbmZpZ3VyYXRpb24oKS5zdXBwb3J0ZWRPcHRpb25z\nKCk7CiAgICAgICAgaWYgKGlkID09IElEX0FQUExJQ0FUSU9OCiAgICAgICAg\nICAgICYmICFvcHRzLmNvbnRhaW5zKE9wZW5KUEFDb25maWd1cmF0aW9uLk9Q\nVElPTl9JRF9BUFBMSUNBVElPTikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJhcHBpZC1ub3Qtc3Vw\ncG9ydGVkIiwKICAgICAgICAgICAgICAgIF90eXBlKSk7CiAgICAgICAgfQog\nICAgICAgIGlmIChpZCA9PSBJRF9EQVRBU1RPUkUKICAgICAgICAgICAgJiYg\nIW9wdHMuY29udGFpbnMoT3BlbkpQQUNvbmZpZ3VyYXRpb24uT1BUSU9OX0lE\nX0RBVEFTVE9SRSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9y\ndGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAoImRhdGFz\ndG9yZWlkLW5vdC1zdXBwb3J0ZWQiLCBfdHlwZSkpOwogICAgICAgIH0KCiAg\nICAgICAgaWYgKGlkID09IElEX0FQUExJQ0FUSU9OKSB7CiAgICAgICAgICAg\nIGlmIChfaWRTdHJhdGVneSAhPSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiYXBwaWQtc3RyYXRlZ3kiLCBfdHlwZSkpOwogICAgICAgICAgICB2\nYWxpZGF0ZUFwcElkQ2xhc3MoKTsKICAgICAgICB9IGVsc2UgaWYgKGlkICE9\nIElEX1VOS05PV04pCiAgICAgICAgICAgIHZhbGlkYXRlTm9QS0ZpZWxkcygp\nOwoKICAgICAgICBpbnQgc3RyYXRlZ3kgPSBnZXRJZGVudGl0eVN0cmF0ZWd5\nKCk7CiAgICAgICAgaWYgKHN0cmF0ZWd5ID09IFZhbHVlU3RyYXRlZ2llcy5T\nRVFVRU5DRQogICAgICAgICAgICAmJiBnZXRJZGVudGl0eVNlcXVlbmNlTmFt\nZSgpID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgibm8tc2VxLW5hbWUiLCBfdHlwZSkpOwoKICAg\nICAgICBWYWx1ZVN0cmF0ZWdpZXMuYXNzZXJ0U3VwcG9ydGVkKHN0cmF0ZWd5\nLCB0aGlzLAogICAgICAgICAgICAiZGF0YXN0b3JlIGlkZW50aXR5IHN0cmF0\nZWd5Iik7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHN1cmUgdGhlIGFw\ncGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzIGlzIHZhbGlkLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgdmFsaWRhdGVBcHBJZENsYXNzKCkgewogICAgICAg\nIC8vIGJhc2UgdHlwZXMgbXVzdCBkZWNsYXJlIGFuIG9pZCBjbGFzcyBpZiBu\nb3Qgc2luZ2xlLWZpZWxkIGlkZW50aXR5CiAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIHBrcyA9IGdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBpZiAo\nZ2V0T2JqZWN0SWRUeXBlKCkgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAo\ncGtzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZC1pZC10eXBl\nIiwKICAgICAgICAgICAgICAgICAgICBfdHlwZSwgcGtzWzBdLmdldE5hbWUo\nKSwKICAgICAgICAgICAgICAgICAgICBwa3NbMF0uZ2V0RGVjbGFyZWRUeXBl\nKCkuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm8taWQtY2xhc3MiLCBfdHlwZSkpOwog\nICAgICAgIH0KICAgICAgICBpZiAoX29iamVjdElkID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGlzT3BlbkpQQUlkZW50aXR5\nKCkpIHsKICAgICAgICAgICAgaWYgKHBrc1swXS5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkgewogICAgICAgICAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBlbWJlZCA9IHBrc1swXS5nZXRFbWJlZGRlZE1ldGFEYXRh\nKCk7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3NNZXRob2Rz\nKGVtYmVkLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICB2\nYWxpZGF0ZUFwcElkQ2xhc3NQS3MoZW1iZWQsIGVtYmVkLmdldEZpZWxkcygp\nLAogICAgICAgICAgICAgICAgICAgIGVtYmVkLmdldERlc2NyaWJlZFR5cGUo\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsKSB7CiAgICAgICAgICAg\nIC8vIGNvbmNyZXRlIHN1cGVyY2xhc3Mgb2lkcyBtdXN0IG1hdGNoIG9yIGJl\nIHBhcmVudCBvZiBvdXJzCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3Vw\nID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYg\nKCFzdXAuZ2V0T2JqZWN0SWRUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShfb2Jq\nZWN0SWQpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJpZC1jbGFzc2VzIiwKICAgICAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W117IF90eXBlLCBfb2JqZWN0SWQsIF9zdXBlciwK\nICAgICAgICAgICAgICAgICAgICAgICAgc3VwLmdldE9iamVjdElkVHlwZSgp\nIH0pKTsKCiAgICAgICAgICAgIC8vIHZhbGlkYXRlIHRoYXQgbm8gb3RoZXIg\ncGtzIGFyZSBkZWNsYXJlZCBpZiB3ZSBoYXZlIGEKICAgICAgICAgICAgLy8g\nY29uY3JldGUgUEMgc3VwZXJjbGFzcwogICAgICAgICAgICBpZiAoaGFzQ29u\nY3JldGVQQ1N1cGVyY2xhc3MoKSkKICAgICAgICAgICAgICAgIHZhbGlkYXRl\nTm9QS0ZpZWxkcygpOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhpcyBj\nbGFzcyBoYXMgaXRzIG93biBvaWQgY2xhc3MsIGRvIHNvbWUgbW9yZSB2YWxp\nZGF0aW9uCiAgICAgICAgaWYgKF9zdXBlciA9PSBudWxsCiAgICAgICAgICAg\nIHx8IF9vYmplY3RJZCAhPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdl\ndE9iamVjdElkVHlwZSgpKSB7CiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBu\nb24tYWJzdHJhY3Qgb2lkIGNsYXNzZXMgb3ZlcnJpZGUgdGhlIHByb3BlciBt\nZXRob2RzCiAgICAgICAgICAgIGlmICghTW9kaWZpZXIuaXNBYnN0cmFjdChf\nb2JqZWN0SWQuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICAgICAgdmFs\naWRhdGVBcHBJZENsYXNzTWV0aG9kcyhfb2JqZWN0SWQpOwoKICAgICAgICAg\nICAgLy8gbWFrZSBzdXJlIHRoZSBhcHAgaWQgY2xhc3MgaGFzIGFsbCBwayBm\naWVsZHMKICAgICAgICAgICAgdmFsaWRhdGVBcHBJZENsYXNzUEtzKHRoaXMs\nIHBrcywgX29iamVjdElkKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlzIGNsYXNzIGhhcyBhIGNvbmNyZXRl\nIHBlcnNpc3RlbnQgc3VwZXJjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSBi\nb29sZWFuIGhhc0NvbmNyZXRlUENTdXBlcmNsYXNzKCkgewogICAgICAgIGlm\nIChfc3VwZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIGlmICghTW9kaWZpZXIuaXNBYnN0cmFjdChfc3VwZXIuZ2V0TW9k\naWZpZXJzKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBy\nZXR1cm4gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5oYXNDb25jcmV0ZVBD\nU3VwZXJjbGFzcygpOwogICAgfQoKICAgIC8qKgogICAgICogRW5zdXJlIHRo\nYXQgdGhlIHVzZXIgaGFzIG92ZXJyaWRkZW4gdGhlIGVxdWFscyBhbmQgaGFz\naENvZGUgbWV0aG9kcywKICAgICAqIGFuZCBoYXMgdGhlIHByb3BlciBjb25z\ndHJ1Y3RvcnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFw\ncElkQ2xhc3NNZXRob2RzKENsYXNzIG9pZCkgewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIG9pZC5nZXRDb25zdHJ1Y3RvcigoQ2xhc3NbXSkgbnVsbCk7\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLWNv\nbnMiLCBfdHlwZSkpLgogICAgICAgICAgICAgICAgc2V0Q2F1c2UoZSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBjaGVjayBmb3IgZXF1YWxzIGFuZCBoYXNo\nY29kZSBvdmVycmlkZXM7IGRvbid0IGVuZm9yY2UgaXQKICAgICAgICAvLyBm\nb3IgYWJzdHJhY3QgYXBwIGlkIGNsYXNzZXMsIHNpbmNlIHRoZXkgbWF5IG5v\ndCBuZWNlc3NhcmlseQogICAgICAgIC8vIGRlY2xhcmUgcHJpbWFyeSBrZXkg\nZmllbGRzCiAgICAgICAgTWV0aG9kIG1ldGhvZDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBtZXRob2QgPSBvaWQuZ2V0TWV0aG9kKCJlcXVhbHMiLCBu\nZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKGUpLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0KCiAgICAg\nICAgYm9vbGVhbiBhYnMgPSBNb2RpZmllci5pc0Fic3RyYWN0KF90eXBlLmdl\ndE1vZGlmaWVycygpKTsKICAgICAgICBpZiAoIWFicyAmJiBtZXRob2QuZ2V0\nRGVjbGFyaW5nQ2xhc3MoKSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZXEtbWV0\naG9kIiwgX3R5cGUpKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbWV0\naG9kID0gb2lkLmdldE1ldGhvZCgiaGFzaENvZGUiLCAoQ2xhc3NbXSkgbnVs\nbCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSkuc2V0RmF0YWwodHJ1\nZSk7CiAgICAgICAgfQogICAgICAgIGlmICghYWJzICYmIG1ldGhvZC5nZXRE\nZWNsYXJpbmdDbGFzcygpID09IE9iamVjdC5jbGFzcykKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJoYy1tZXRo\nb2QiLCBfdHlwZSkpOwogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUg\ndGhhdCB0aGUgcHJpbWFyeSBrZXkgY2xhc3MgaGFzIGFsbCBwayBmaWVsZHMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFwcElkQ2xhc3NQ\nS3MoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBmbWRzLCBDbGFzcyBvaWQpIHsKICAgICAgICBpZiAoZm1kcy5sZW5ndGgg\nPT0gMCAmJiAhTW9kaWZpZXIuaXNBYnN0cmFjdChtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKS4KICAgICAgICAgICAgZ2V0TW9kaWZpZXJzKCkpKQogICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLXBrIiwgX3R5cGUpKTsKCiAgICAgICAgLy8gY2hlY2sgdGhhdCB0aGUgb2lk\nIHR5cGUgY29udGFpbnMgYWxsIHBrIGZpZWxkcwogICAgICAgIEZpZWxkIGY7\nCiAgICAgICAgTWV0aG9kIG07CiAgICAgICAgQ2xhc3MgYzsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgc3dpdGNoIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSkg\newogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAg\nICAgICAgICAgICAgICAgYyA9IGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCku\nZ2V0Q29tcG9uZW50VHlwZSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChj\nID09IGJ5dGUuY2xhc3MgfHwgYyA9PSBCeXRlLmNsYXNzCiAgICAgICAgICAg\nICAgICAgICAgICAgIHx8IGMgPT0gY2hhci5jbGFzcyB8fCBjID09IENoYXJh\nY3Rlci5jbGFzcykgewogICAgICAgICAgICAgICAgICAgICAgICBjID0gZm1k\nc1tpXS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIC8vIGVsc2Ugbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lE\nOiAvLyB3ZSdyZSB2YWxpZGF0aW5nIGVtYmVkZGVkIGZpZWxkcwogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiYmFkLXBrLXR5cGUiLAogICAgICAgICAgICAgICAgICAgICAgICBm\nbWRzW2ldKSk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgICAgIGMgPSBmbWRzW2ldLmdldE9iamVjdElkRmllbGRUeXBlKCk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChtZXRhLmdldEFjY2Vz\nc1R5cGUoKSA9PSBBQ0NFU1NfRklFTEQpIHsKICAgICAgICAgICAgICAgIGYg\nPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWQsIGZtZHNbaV0uZ2V0TmFtZSgp\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoZiA9PSBudWxsIHx8ICFm\nLmdldFR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tKGMpKQogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\naW52YWxpZC1pZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIF90eXBlLCBm\nbWRzW2ldLmdldE5hbWUoKSkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKG1l\ndGEuZ2V0QWNjZXNzVHlwZSgpID09IEFDQ0VTU19QUk9QRVJUWSkgewogICAg\nICAgICAgICAgICAgbSA9IFJlZmxlY3Rpb24uZmluZEdldHRlcihvaWQsIGZt\nZHNbaV0uZ2V0TmFtZSgpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAo\nbSA9PSBudWxsIHx8ICFtLmdldFJldHVyblR5cGUoKS5pc0Fzc2lnbmFibGVG\ncm9tKGMpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiaW52YWxpZC1pZCIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIF90eXBlLCBmbWRzW2ldLmdldE5hbWUoKSkpOwogICAg\nICAgICAgICAgICAgbSA9IFJlZmxlY3Rpb24uZmluZFNldHRlcihvaWQsIGZt\nZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0u\nZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKSwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgaWYgKG0gPT0gbnVsbCB8fCBtLmdldFJldHVyblR5cGUoKSAhPSB2b2lk\nLmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiaW52YWxpZC1pZCIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIF90eXBlLCBmbWRzW2ldLmdldE5hbWUoKSkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVmFs\naWRhdGUgdGhhdCB0aGlzIGNsYXNzIGRvZXNuJ3QgZGVjbGFyZSBhbnkgcHJp\nbWFyeSBrZXkgZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFs\naWRhdGVOb1BLRmllbGRzKCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\naWVsZHMgPSBnZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBp\nZiAoZmllbGRzW2ldLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtcGsi\nLCBmaWVsZHNbaV0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VydCB0\naGF0IHRoaXMgY2xhc3MnIGFjY2VzcyB0eXBlIGlzIGFsbG93ZWQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZUFjY2Vzc1R5cGUoKSB7CiAg\nICAgICAgaWYgKF9hY2Nlc3NUeXBlID09IEFDQ0VTU19VTktOT1dOKQogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBn\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0g\nbnVsbCAmJiBzdXAuZ2V0QWNjZXNzVHlwZSgpICE9IEFDQ0VTU19VTktOT1dO\nCiAgICAgICAgICAgICYmIHN1cC5nZXRBY2Nlc3NUeXBlKCkgIT0gX2FjY2Vz\nc1R5cGUgJiYKICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKS5nZXRGaWVsZHMoKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaW5jb25zaXN0ZW50\nLWFjY2VzcyIsCiAgICAgICAgICAgICAgICB0aGlzLCBzdXApKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhhdCBkZXRhY2ht\nZW50IGNvbmZpZ3VyYXRpb24gaXMgdmFsaWQuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCB2YWxpZGF0ZURldGFjaGFibGUoKSB7CiAgICAgICAgYm9vbGVh\nbiBmaXJzdCA9IHRydWU7CiAgICAgICAgZm9yIChDbGFzc01ldGFEYXRhIHBh\ncmVudCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAg\nIGZpcnN0ICYmIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBwYXJlbnQuZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKSkKICAgICAgICB7CiAgICAgICAgICAg\nIGlmIChwYXJlbnQuaXNEZXRhY2hhYmxlKCkpCiAgICAgICAgICAgICAgICBm\naXJzdCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgRmllbGQgZmllbGQg\nPSBnZXREZXRhY2hlZFN0YXRlRmllbGQoKTsKICAgICAgICBpZiAoZmllbGQg\nIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIWZpcnN0KQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJw\nYXJlbnQtZGV0YWNoLXN0YXRlIiwKICAgICAgICAgICAgICAgICAgICBfdHlw\nZSkpOwogICAgICAgICAgICBpZiAoZ2V0RmllbGQoZmllbGQuZ2V0TmFtZSgp\nKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJtYW5hZ2VkLWRldGFjaC1zdGF0ZSIsCiAg\nICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0TmFtZSgpLCBfdHlwZSkpOwog\nICAgICAgICAgICBpZiAoZmllbGQuZ2V0VHlwZSgpICE9IE9iamVjdC5jbGFz\ncykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLWRldGFjaC1zdGF0ZSIsCiAgICAgICAgICAgICAg\nICAgICAgZmllbGQuZ2V0TmFtZSgpLCBfdHlwZSkpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8KICAgIC8vIEZldGNoIEdyb3VwCiAg\nICAvLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nZmV0Y2ggZ3JvdXBzIGRlY2xhcmVkIGV4cGxpY2l0bHkgaW4gdGhpcyB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cFtdIGdldERlY2xhcmVk\nRmV0Y2hHcm91cHMoKSB7CiAgICAgICAgaWYgKF9mZ3MgPT0gbnVsbCkKICAg\nICAgICAgICAgX2ZncyA9IChfZmdNYXAgPT0gbnVsbCkgPyBFTVBUWV9GRVRD\nSF9HUk9VUF9BUlJBWSA6IChGZXRjaEdyb3VwW10pCiAgICAgICAgICAgICAg\nICBfZmdNYXAudmFsdWVzKCkudG9BcnJheShuZXcgRmV0Y2hHcm91cFtfZmdN\nYXAuc2l6ZSgpXSk7IAogICAgICAgIHJldHVybiBfZmdzOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGFsbCBmZXRjaCBncm91cHMgZm9yIHRoaXMg\ndHlwZSwgaW5jbHVkaW5nIHN1cGVyY2xhc3MgZ3JvdXBzLgogICAgICovCiAg\nICBwdWJsaWMgRmV0Y2hHcm91cFtdIGdldEN1c3RvbUZldGNoR3JvdXBzKCkg\newogICAgICAgIGlmIChfY3VzdG9tRkdzID09IG51bGwpIHsKICAgICAgICAg\nICAgLy8gbWFwIGZncyB0byBuYW1lcywgYWxsb3dpbmcgb3VyIGZncyB0byBv\ndmVycmlkZSBzdXBlcnMKICAgICAgICAgICAgTWFwIGZncyA9IG5ldyBIYXNo\nTWFwKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBu\ndWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBGZXRjaEdyb3Vw\nW10gc3VwRkdzID0gc3VwLmdldEN1c3RvbUZldGNoR3JvdXBzKCk7CiAgICAg\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1cEZHcy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgICAgICAgICBmZ3MucHV0KHN1cEZHc1tpXS5n\nZXROYW1lKCksIHN1cEZHc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgRmV0Y2hHcm91cFtdIGRlY3MgPSBnZXREZWNsYXJlZEZldGNoR3JvdXBz\nKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZGVjcy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgICAgIGZncy5wdXQoZGVjc1tpXS5nZXRO\nYW1lKCksIGRlY3NbaV0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g\ncmVtb3ZlIHN0ZCBncm91cHMKICAgICAgICAgICAgZmdzLnJlbW92ZShGZXRj\naEdyb3VwLk5BTUVfREVGQVVMVCk7CiAgICAgICAgICAgIGZncy5yZW1vdmUo\nRmV0Y2hHcm91cC5OQU1FX0FMTCk7CgogICAgICAgICAgICBfY3VzdG9tRkdz\nID0gKEZldGNoR3JvdXBbXSkgZmdzLnZhbHVlcygpLnRvQXJyYXkKICAgICAg\nICAgICAgICAgIChuZXcgRmV0Y2hHcm91cFtmZ3Muc2l6ZSgpXSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBfY3VzdG9tRkdzOwogICAgfQoKICAgIC8q\nKgogICAgICogR2V0cyBhIG5hbWVkIGZlY3RoIGdyb3VwLiBJZiBub3QgYXZh\naWxhYmxlIGluIHRoaXMgcmVjZWl2ZXIgdGhlbiBsb29rcwogICAgICogdXAg\ndGhlIGluaGVyaXRlbmNlIGhpZXJhcmNoeS4gCiAgICAgKgogICAgICogQHBh\ncmFtIG5hbWUgbmFtZSBvZiBhIGZldGNoIGdyb3VwLgogICAgICogQHJldHVy\nbiBhbiBleGlzdGluZyBmZWN0aCBncm91cCBvZiB0aGUgZ2l2ZW4gbmFtZSBp\nZiBrbm93biB0byB0aGlzIAogICAgICogcmVjZWl2ZXIgb3IgYW55IG9mIGl0\ncyBzdXBlcmNsYXNzZXMuIE90aGVyd2lzZSBudWxsLgogICAgICovCiAgICBw\ndWJsaWMgRmV0Y2hHcm91cCBnZXRGZXRjaEdyb3VwKFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgRmV0Y2hHcm91cCBmZyA9IChfZmdNYXAgPT0gbnVsbCkgPyBu\ndWxsIDogKEZldGNoR3JvdXApIF9mZ01hcC5nZXQobmFtZSk7CiAgICAgICAg\naWYgKGZnICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmZzsKICAgICAg\nICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gc3VwLmdldEZldGNoR3JvdXAobmFtZSk7CiAgICAgICAgaWYgKEZldGNo\nR3JvdXAuTkFNRV9ERUZBVUxULmVxdWFscyhuYW1lKSkKICAgICAgICAgICAg\ncmV0dXJuIEZldGNoR3JvdXAuREVGQVVMVDsKICAgICAgICBpZiAoRmV0Y2hH\ncm91cC5OQU1FX0FMTC5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHJldHVy\nbiBGZXRjaEdyb3VwLkFMTDsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZHMgZmV0Y2ggZ3JvdXAgb2YgdGhlIGdpdmVu\nIG5hbWUsIG9yIHJldHVybnMgZXhpc3RpbmcgaW5zdGFuY2UuCiAgICAgKgog\nICAgICogQHBhcmFtIG5hbWUgYSBub24tbnVsbCwgbm9uLWVtcHR5IG5hbWUu\nIE11c3QgYmUgdW5pcXVlIHdpdGhpbiB0aGlzCiAgICAgKiByZWNlaXZlcidz\nIHNjb3BlLiBUaGUgc3VwZXIgY2xhc3MgPGVtPm1heTwvZW0+IGhhdmUgYSBn\ncm91cCB3aXRoCiAgICAgKiB0aGUgc2FtZSBuYW1lLgogICAgICovCiAgICBw\ndWJsaWMgRmV0Y2hHcm91cCBhZGREZWNsYXJlZEZldGNoR3JvdXAoU3RyaW5n\nIG5hbWUpIHsKICAgIAlpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShuYW1lKSkK\nICAgIAkJdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJl\nbXB0eS1mZy1uYW1lIiwgdGhpcykpOwogICAgICAgIGlmIChfZmdNYXAgPT0g\nbnVsbCkKICAgICAgICAgICAgX2ZnTWFwID0gbmV3IEhhc2hNYXAoKTsKICAg\nICAgICBGZXRjaEdyb3VwIGZnID0gKEZldGNoR3JvdXApIF9mZ01hcC5nZXQo\nbmFtZSk7CiAgICAgICAgaWYgKGZnID09IG51bGwpIHsKICAgICAgICAJZmcg\nPSBuZXcgRmV0Y2hHcm91cCh0aGlzLCBuYW1lKTsKICAgICAgICAJX2ZnTWFw\nLnB1dChuYW1lLCBmZyk7CiAgICAgICAgICAgIF9mZ3MgPSBudWxsOwogICAg\nICAgICAgICBfY3VzdG9tRkdzID0gbnVsbDsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGZnOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgZGVj\nbGFyZWQgZmV0Y2ggZ3JvdXAuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIHJlbW92ZURlY2xhcmVkRmV0Y2hHcm91cChGZXRjaEdyb3VwIGZnKSB7CiAg\nICAgICAgaWYgKGZnID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpZiAoX2ZnTWFwLnJlbW92ZShmZy5nZXROYW1lKCkpICE9\nIG51bGwpIHsKICAgICAgICAgICAgX2ZncyA9IG51bGw7CiAgICAgICAgICAg\nIF9jdXN0b21GR3MgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTb3VyY2VUcmFja2VyCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBGaWxlIGdldFNvdXJjZUZpbGUo\nKSB7CiAgICAgICAgcmV0dXJuIF9zcmNGaWxlOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0U291cmNlU2NvcGUoKSB7CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgcHVibGljIGludCBnZXRTb3VyY2VUeXBlKCkgewog\nICAgICAgIHJldHVybiBfc3JjVHlwZTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRTb3VyY2UoRmlsZSBmaWxlLCBpbnQgc3JjVHlwZSkgewogICAgICAg\nIF9zcmNGaWxlID0gZmlsZTsKICAgICAgICBfc3JjVHlwZSA9IHNyY1R5cGU7\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRSZXNvdXJjZU5hbWUoKSB7\nCiAgICAgICAgcmV0dXJuIF90eXBlLmdldE5hbWUoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSB0aGlzIG1ldGFkYXRhIGhhcyBi\nZWVuIGxvYWRlZCB1bmRlci4KICAgICAqLwogICAgcHVibGljIGludCBnZXRT\nb3VyY2VNb2RlKCkgewogICAgICAgIHJldHVybiBfc3JjTW9kZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSB0aGlzIG1ldGFkYXRh\nIGhhcyBiZWVuIGxvYWRlZCB1bmRlci4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0U291cmNlTW9kZShpbnQgbW9kZSkgewogICAgICAgIF9zcmNNb2Rl\nID0gbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9k\nZSB0aGlzIG1ldGFkYXRhIGhhcyBiZWVuIGxvYWRlZCB1bmRlci4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0U291cmNlTW9kZShpbnQgbW9kZSwgYm9v\nbGVhbiBvbikgewogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAg\nICAgICAgICAgX3NyY01vZGUgPSBtb2RlOwogICAgICAgIGVsc2UgaWYgKG9u\nKQogICAgICAgICAgICBfc3JjTW9kZSB8PSBtb2RlOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgX3NyY01vZGUgJj0gfm1vZGU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgaW5kZXggaW4gd2hpY2ggdGhpcyBjbGFzcyB3YXMgbGlz\ndGVkIGluIHRoZSBtZXRhZGF0YS4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2Rl\nPi0xPC9jb2RlPiBpZiB0aGlzIGNsYXNzIHdhcyBub3QgbGlzdGVkIGluIHRo\nZSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRMaXN0aW5n\nSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9saXN0SW5kZXg7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgaW5kZXggaW4gd2hpY2ggdGhpcyBmaWVsZCB3\nYXMgbGlzdGVkIGluIHRoZSBtZXRhZGF0YS4gRGVmYXVsdHMgdG8KICAgICAq\nIDxjb2RlPi0xPC9jb2RlPiBpZiB0aGlzIGNsYXNzIHdhcyBub3QgbGlzdGVk\nIGluIHRoZSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nTGlzdGluZ0luZGV4KGludCBpbmRleCkgewogICAgICAgIF9saXN0SW5kZXgg\nPSBpbmRleDsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8KICAgIC8vIENv\nbW1lbnRhYmxlCiAgICAvLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgU3Ry\naW5nW10gZ2V0Q29tbWVudHMoKSB7CiAgICAgICAgcmV0dXJuIChfY29tbWVu\ndHMgPT0gbnVsbCkgPyBFTVBUWV9DT01NRU5UUyA6IF9jb21tZW50czsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb21tZW50cyhTdHJpbmdbXSBjb21t\nZW50cykgewogICAgICAgIF9jb21tZW50cyA9IGNvbW1lbnRzOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vCiAgICAvLyBTdGF0ZSBjb3B5CiAgICAvLy8v\nLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogQ29weSB0aGUgbWV0YWRhdGEg\nZnJvbSB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhpcyBvbmUuIERvIG5vdAog\nICAgICogY29weSBtYXBwaW5nIGluZm9ybWF0aW9uLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBjb3B5KENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIGlmIChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSAhPSBfdHlwZSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAg\nc3VwZXIuY29weShtZXRhKTsKCiAgICAgICAgLy8gY29weSBjbGFzcy1sZXZl\nbCBpbmZvOyB1c2UgZ2V0IG1ldGhvZHMgdG8gZm9yY2UgcmVzb2x1dGlvbiBv\nZgogICAgICAgIC8vIGxhenkgZGF0YQogICAgICAgIF9zdXBlciA9IG1ldGEu\nZ2V0UENTdXBlcmNsYXNzKCk7CiAgICAgICAgX29iamVjdElkID0gbWV0YS5n\nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBfZXh0ZW50ID0gKG1ldGEuZ2V0\nUmVxdWlyZXNFeHRlbnQoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZB\nTFNFOwogICAgICAgIF9lbWJlZGRlZCA9IChtZXRhLmlzRW1iZWRkZWRPbmx5\nKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBf\naW50ZXJmYWNlID0gKG1ldGEuaXNNYW5hZ2VkSW50ZXJmYWNlKCkpID8gQm9v\nbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBzZXRJbnRlcmNl\ncHRpbmcobWV0YS5pc0ludGVyY2VwdGluZygpKTsKICAgICAgICBfaW1wbCA9\nIG1ldGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAgICAgIF9pZGVudGl0eSA9\nIG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgX2lkU3RyYXRlZ3kg\nPSBtZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKTsKICAgICAgICBfc2VxTmFt\nZSA9IG1ldGEuZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsKICAgICAgICBf\nc2VxTWV0YSA9IG51bGw7CiAgICAgICAgX2FsaWFzID0gbWV0YS5nZXRUeXBl\nQWxpYXMoKTsKICAgICAgICBfYWNjZXNzVHlwZSA9IG1ldGEuZ2V0QWNjZXNz\nVHlwZSgpOwoKICAgICAgICAvLyBvbmx5IGNvcHkgdGhpcyBpbmZvcm1hdGlv\nbiBpZiBpdCB3YXNuJ3Qgc2V0IGV4cGxpY2l0bHkgZm9yIHRoaXMKICAgICAg\nICAvLyBpbnN0YW5jZQogICAgICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVh\nbHMoX2NhY2hlTmFtZSkpCiAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBtZXRh\nLmdldERhdGFDYWNoZU5hbWUoKTsKICAgICAgICBpZiAoX2NhY2hlVGltZW91\ndCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSkKICAgICAgICAgICAgX2NhY2hlVGlt\nZW91dCA9IG1ldGEuZ2V0RGF0YUNhY2hlVGltZW91dCgpOwogICAgICAgIGlm\nIChfZGV0YWNoYWJsZSA9PSBudWxsKQogICAgICAgICAgICBfZGV0YWNoYWJs\nZSA9IG1ldGEuX2RldGFjaGFibGU7CiAgICAgICAgaWYgKERFRkFVTFRfU1RS\nSU5HLmVxdWFscyhfZGV0YWNoU3RhdGUpKQogICAgICAgICAgICBfZGV0YWNo\nU3RhdGUgPSBtZXRhLmdldERldGFjaGVkU3RhdGUoKTsKCiAgICAgICAgLy8g\nc3luY2ggZmllbGQgaW5mb3JtYXRpb247IGZpcnN0IHJlbW92ZSBleHRyYSBm\naWVsZHMKICAgICAgICBjbGVhckZpZWxkQ2FjaGUoKTsKICAgICAgICBfZmll\nbGRNYXAua2V5U2V0KCkucmV0YWluQWxsKG1ldGEuX2ZpZWxkTWFwLmtleVNl\ndCgpKTsKCiAgICAgICAgLy8gYWRkIGNvcGllcyBvZiBkZWNsYXJlZCBmaWVs\nZHM7IG90aGVyIGRlZmluZWQgZmllbGRzIGFscmVhZHkgY29waWVkCiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IG1ldGEuZ2V0RGVjbGFyZWRG\naWVsZHMoKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZpZWxkOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGZpZWxkID0gZ2V0RGVjbGFyZWRGaWVsZChmaWVsZHNbaV0u\nZ2V0TmFtZSgpKTsKICAgICAgICAgICAgaWYgKGZpZWxkID09IG51bGwpCiAg\nICAgICAgICAgICAgICBmaWVsZCA9IGFkZERlY2xhcmVkRmllbGQoZmllbGRz\nW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBmaWVsZHNbaV0u\nZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICBmaWVsZC5zZXREZWNs\nYXJlZEluZGV4KC0xKTsKICAgICAgICAgICAgZmllbGQuc2V0SW5kZXgoLTEp\nOwogICAgICAgICAgICBmaWVsZC5jb3B5KGZpZWxkc1tpXSk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBjb3B5IGZldGNoIGdyb3VwcwogICAgICAgIEZldGNo\nR3JvdXBbXSBmZ3MgPSBtZXRhLmdldERlY2xhcmVkRmV0Y2hHcm91cHMoKTsK\nICAgICAgICBGZXRjaEdyb3VwIGZnOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZnID0gYWRk\nRGVjbGFyZWRGZXRjaEdyb3VwKGZnc1tpXS5nZXROYW1lKCkpOwogICAgICAg\nICAgICBmZy5jb3B5KGZnc1tpXSk7IAogICAgICAgIH0KCiAgICAgICAgLy8g\nY29weSBpZmFjZSByZS1tYXBwaW5nCiAgICAgICAgX2lmYWNlTWFwLmNsZWFy\nKCk7CiAgICAgICAgX2lmYWNlTWFwLnB1dEFsbChtZXRhLl9pZmFjZU1hcCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZWN1cnNpdmUgaGVscGVyIHRvIGNv\ncHkgZW1iZWRkZWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIHZvaWQgY29weShDbGFzc01ldGFEYXRhIGVtYmVkLCBDbGFzc01ldGFE\nYXRhIGRlYykgewogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZGVjLmdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGVtYmVkLnNldFBDU3VwZXJjbGFzcyhzdXAu\nZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgY29weShlbWJlZC5n\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLCBzdXApOwogICAgICAgIH0KICAg\nICAgICBlbWJlZC5jb3B5KGRlYyk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZv\naWQgYWRkRXh0ZW5zaW9uS2V5cyhDb2xsZWN0aW9uIGV4dHMpIHsKICAgICAg\nICBfcmVwb3MuZ2V0TWV0YURhdGFGYWN0b3J5KCkuYWRkQ2xhc3NFeHRlbnNp\nb25LZXlzKGV4dHMpOwogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFyYXRv\nciB1c2VkIHRvIHB1dCBmaWVsZCBtZXRhZGF0YXMgaW50byBsaXN0aW5nIG9y\nZGVyLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBMaXN0aW5n\nT3JkZXJDb21wYXJhdG9yCiAgICAgICAgaW1wbGVtZW50cyBDb21wYXJhdG9y\nIHsKCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTGlzdGluZ09yZGVy\nQ29tcGFyYXRvciBfaW5zdGFuY2UKICAgICAgICAgICAgPSBuZXcgTGlzdGlu\nZ09yZGVyQ29tcGFyYXRvcigpOwoKICAgICAgICAvKioKICAgICAgICAgKiBB\nY2Nlc3Mgc2luZ2xldG9uIGluc3RhbmNlLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyBzdGF0aWMgTGlzdGluZ09yZGVyQ29tcGFyYXRvciBnZXRJbnN0\nYW5jZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9pbnN0YW5jZTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShPYmplY3QgbzEsIE9i\namVjdCBvMikgewogICAgICAgICAgICBpZiAobzEgPT0gbzIpCiAgICAgICAg\nICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgaWYgKG8xID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgaWYgKG8y\nID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CgogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhIGYxID0gKEZpZWxkTWV0YURhdGEpIG8xOwog\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGYyID0gKEZpZWxkTWV0YURhdGEp\nIG8yOwogICAgICAgICAgICBpZiAoZjEuZ2V0TGlzdGluZ0luZGV4KCkgPT0g\nZjIuZ2V0TGlzdGluZ0luZGV4KCkpIHsKICAgICAgICAgICAgICAgIGlmIChm\nMS5nZXRJbmRleCgpID09IGYyLmdldEluZGV4KCkpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGYxLmdldEZ1bGxOYW1lKGZhbHNlKS5jb21wYXJlVG8K\nICAgICAgICAgICAgICAgICAgICAgICAgKGYyLmdldEZ1bGxOYW1lKGZhbHNl\nKSk7CgkJCQlpZiAoZjEuZ2V0SW5kZXggKCkgPT0gLTEpCgkJCQkJcmV0dXJu\nIDE7CgkJCQlpZiAoZjIuZ2V0SW5kZXggKCkgPT0gLTEpCgkJCQkJcmV0dXJu\nIC0xOwoJCQkJcmV0dXJuIGYxLmdldEluZGV4ICgpIC0gZjIuZ2V0SW5kZXgg\nKCk7CgkJCX0JCgkJCWlmIChmMS5nZXRMaXN0aW5nSW5kZXggKCkgPT0gLTEp\nCgkJCQlyZXR1cm4gMTsKCQkJaWYgKGYyLmdldExpc3RpbmdJbmRleCAoKSA9\nPSAtMSkKCQkJCXJldHVybiAtMTsKCQkJcmV0dXJuIGYxLmdldExpc3RpbmdJ\nbmRleCAoKSAtIGYyLmdldExpc3RpbmdJbmRleCAoKTsKCQl9Cgl9CiAgICAK\nICAgIHB1YmxpYyB2b2lkIHJlZ2lzdGVyRm9yVmFsdWVVcGRhdGUoU3RyaW5n\nLi4udmFsdWVzKSB7CiAgICAJaWYgKHZhbHVlcyA9PSBudWxsKQogICAgCQly\nZXR1cm47CiAgICAJZm9yIChTdHJpbmcga2V5IDogdmFsdWVzKSB7CiAgICAJ\nCVZhbHVlIHZhbHVlID0gZ2V0UmVwb3NpdG9yeSgpLmdldENvbmZpZ3VyYXRp\nb24oKQogICAgCQkJLmdldFZhbHVlKGtleSk7CiAgICAJCWlmICh2YWx1ZSAh\nPSBudWxsKQogICAgCQkJdmFsdWUuYWRkTGlzdGVuZXIodGhpcyk7CiAgICAJ\nfQogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCB2YWx1ZUNoYW5nZWQoVmFs\ndWUgdmFsKSB7CiAgICAJaWYgKHZhbCA9PSAgbnVsbCkKICAgIAkJcmV0dXJu\nOwogICAgCVN0cmluZyBrZXkgPSB2YWwuZ2V0UHJvcGVydHkoKTsKICAgIAlp\nZiAoIkRhdGFDYWNoZVRpbWVvdXQiLmVxdWFscyhrZXkpKSB7CiAgICAJCV9j\nYWNoZVRpbWVvdXQgPSBJbnRlZ2VyLk1JTl9WQUxVRTsKICAgIAl9CiAgICB9\nCn0K\n","encoding":"base64"}

