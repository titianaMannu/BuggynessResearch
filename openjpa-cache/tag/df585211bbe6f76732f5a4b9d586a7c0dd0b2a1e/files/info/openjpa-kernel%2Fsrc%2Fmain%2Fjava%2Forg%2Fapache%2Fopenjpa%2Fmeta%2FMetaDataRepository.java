{"sha":"1b5845769d80a1ba85922d93ec1d8be73f420fcf","node_id":"MDQ6QmxvYjIwNjM2NDoxYjU4NDU3NjlkODBhMWJhODU5MjJkOTNlYzFkOGJlNzNmNDIwZmNm","size":69065,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1b5845769d80a1ba85922d93ec1d8be73f420fcf","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNz\nQ29udHJvbGxlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpbmtl\nZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGls\nLlRyZWVTZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3Ry\naW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVu\nSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5l\nbmhhbmNlLkR5bmFtaWNQZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3RyeS5SZWdpc3RlckNs\nYXNzTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkNsb3NlYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuU3RyaW5nRGlzdGFu\nY2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0\nYUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9w\nZW5KUEFJZDsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIFJl\ncG9zaXRvcnkgb2YgYW5kIGZhY3RvcnkgZm9yIHBlcnNpc3RlbnQgbWV0YWRh\ndGEuCiAqCiAqIEBzaW5jZSAwLjMuMAogKiBAYXV0aG9yIEFiZSBXaGl0ZQog\nKiBAYXV0aG9yIFN0ZXZlIEtpbSAocXVlcnkgbWV0YWRhdGEpCiAqLwpwdWJs\naWMgY2xhc3MgTWV0YURhdGFSZXBvc2l0b3J5CiAgICBpbXBsZW1lbnRzIFBD\nUmVnaXN0cnkuUmVnaXN0ZXJDbGFzc0xpc3RlbmVyLCBDb25maWd1cmFibGUs\nIENsb3NlYWJsZSwgCiAgICBNZXRhRGF0YU1vZGVzLCBTZXJpYWxpemFibGUg\newoKICAgIC8qKgogICAgICogQ29uc3RhbnQgdG8gbm90IHZhbGlkYXRlIGFu\neSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgVkFMSURBVEVfTk9ORSA9IDA7CgogICAgLyoqCiAgICAgKiBCaXQgZmxh\nZyB0byB2YWxpZGF0ZSBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBpbnQgVkFMSURBVEVfTUVUQSA9IDE7CgogICAgLyoqCiAg\nICAgKiBCaXQgZmxhZyB0byB2YWxpZGF0ZSBtYXBwaW5ncy4KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVkFMSURBVEVfTUFQUElORyA9\nIDI7CgogICAgLyoqCiAgICAgKiBCaXQgZmxhZyB0byB2YWxpZGF0ZSB1bmVu\naGFuY2VkIG1ldGFkYXRhIG9ubHkuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IFZBTElEQVRFX1VORU5IQU5DRUQgPSA0OwoKICAgIC8q\nKgogICAgICogQml0IGZsYWcgZm9yIHJ1bnRpbWUgdmFsaWRhdGlvbi4gUmVx\ndWlyZXMgdGhhdCBhbGwgY2xhc3NlcyBhcmUKICAgICAqIGVuaGFuY2VkLCBh\nbmQgcGVyZm9ybXMgZXh0cmEgZmllbGQgcmVzb2x1dGlvbiBzdGVwcy4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVkFMSURBVEVfUlVO\nVElNRSA9IDg7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBDbGFzc1td\nIEVNUFRZX0NMQVNTRVMgPSBuZXcgQ2xhc3NbMF07CiAgICBwcm90ZWN0ZWQg\nc3RhdGljIGZpbmFsIE5vblBlcnNpc3RlbnRNZXRhRGF0YVtdIEVNUFRZX05P\nTl9QRVJTSVNURU5UID0gCiAgICAJbmV3IE5vblBlcnNpc3RlbnRNZXRhRGF0\nYVswXTsKICAgIHByb3RlY3RlZCBmaW5hbCBDbGFzc01ldGFEYXRhW10gRU1Q\nVFlfTUVUQVM7CiAgICBwcm90ZWN0ZWQgZmluYWwgRmllbGRNZXRhRGF0YVtd\nIEVNUFRZX0ZJRUxEUzsKICAgIHByb3RlY3RlZCBmaW5hbCBPcmRlcltdIEVN\nUFRZX09SREVSUzsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6\nZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKE1ldGFE\nYXRhUmVwb3NpdG9yeS5jbGFzcyk7CgogICAgLy8gc3lzdGVtIHNlcXVlbmNl\nCiAgICBwcml2YXRlIFNlcXVlbmNlTWV0YURhdGEgX3N5c1NlcSA9IG51bGw7\nCgogICAgLy8gY2FjaGUgb2YgcGFyc2VkIG1ldGFkYXRhLCBvaWQgY2xhc3Mg\ndG8gY2xhc3MsIGFuZCBpbnRlcmZhY2UgY2xhc3MKICAgIC8vIHRvIG1ldGFk\nYXRhcwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX21ldGFzID0gbmV3IEhhc2hN\nYXAoKTsKICAgIHByaXZhdGUgZmluYWwgTWFwIF9vaWRzID0gQ29sbGVjdGlv\nbnMuc3luY2hyb25pemVkTWFwKG5ldyBIYXNoTWFwKCkpOwogICAgcHJpdmF0\nZSBmaW5hbCBNYXAgX2ltcGxzID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVk\nTWFwKG5ldyBIYXNoTWFwKCkpOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX2lm\nYWNlcyA9IENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1h\ncCgpKTsKICAgIHByaXZhdGUgZmluYWwgTWFwIF9xdWVyaWVzID0gbmV3IEhh\nc2hNYXAoKTsKICAgIHByaXZhdGUgZmluYWwgTWFwIF9zZXFzID0gbmV3IEhh\nc2hNYXAoKTsKICAgIHByaXZhdGUgZmluYWwgTWFwIF9hbGlhc2VzID0gQ29s\nbGVjdGlvbnMuc3luY2hyb25pemVkTWFwKG5ldyBIYXNoTWFwKCkpOwogICAg\ncHJpdmF0ZSBmaW5hbCBNYXAgX3Bhd2FyZXMgPSBDb2xsZWN0aW9ucy5zeW5j\naHJvbml6ZWRNYXAobmV3IEhhc2hNYXAoKSk7CiAgICBwcml2YXRlIGZpbmFs\nIE1hcCBfbm9uTWFwcGVkID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkTWFw\nKG5ldyBIYXNoTWFwKCkpOwogICAgCiAgICAvLyBtYXAgb2YgY2xhc3NlcyB0\nbyBsaXN0cyBvZiB0aGVpciBzdWJjbGFzc2VzCiAgICBwcml2YXRlIGZpbmFs\nIE1hcCBfc3VicyA9IENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcg\nSGFzaE1hcCgpKTsKCiAgICAvLyB4bWwgbWFwcGluZwogICAgcHJvdGVjdGVk\nIGZpbmFsIFhNTE1ldGFEYXRhW10gRU1QVFlfWE1MTUVUQVM7CiAgICBwcml2\nYXRlIGZpbmFsIE1hcCBfeG1sbWV0YXMgPSBuZXcgSGFzaE1hcCgpOwoKICAg\nIHByaXZhdGUgdHJhbnNpZW50IE9wZW5KUEFDb25maWd1cmF0aW9uIF9jb25m\nID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IExvZyBfbG9nID0gbnVs\nbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IEludGVyZmFjZUltcGxHZW5lcmF0\nb3IgX2ltcGxHZW4gPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgTWV0\nYURhdGFGYWN0b3J5IF9mYWN0b3J5ID0gbnVsbDsKCiAgICBwcml2YXRlIGlu\ndCBfcmVzTW9kZSA9IE1PREVfTUVUQSB8IE1PREVfTUFQUElORzsKICAgIHBy\naXZhdGUgaW50IF9zb3VyY2VNb2RlID0gTU9ERV9NRVRBIHwgTU9ERV9NQVBQ\nSU5HIHwgTU9ERV9RVUVSWTsKICAgIHByaXZhdGUgaW50IF92YWxpZGF0ZSA9\nIFZBTElEQVRFX01FVEEgfCBWQUxJREFURV9VTkVOSEFOQ0VEOwoKICAgIC8v\nIHdlIGJ1ZmZlciB1cCBhbnkgY2xhc3NlcyB0aGF0IHJlZ2lzdGVyIHRoZW1z\nZWx2ZXMgdG8gcHJldmVudAogICAgLy8gcmVlbnRyYW5jeSBlcnJvcnMgaWYg\nY2xhc3NlcyByZWdpc3RlciBkdXJpbmcgYSBjdXJyZW50IHBhcnNlIChjb21t\nb24pCiAgICBwcml2YXRlIGZpbmFsIENvbGxlY3Rpb24gX3JlZ2lzdGVyZWQg\nPSBuZXcgSGFzaFNldCgpOwoKICAgIC8vIHNldCBvZiBtZXRhZGF0YXMgd2Un\ncmUgaW4gdGhlIHByb2Nlc3Mgb2YgcmVzb2x2aW5nCiAgICBwcml2YXRlIGZp\nbmFsIEluaGVyaXRhbmNlT3JkZXJlZE1ldGFEYXRhTGlzdCBfcmVzb2x2aW5n\nID0KICAgICAgICBuZXcgSW5oZXJpdGFuY2VPcmRlcmVkTWV0YURhdGFMaXN0\nKCk7CiAgICBwcml2YXRlIGZpbmFsIEluaGVyaXRhbmNlT3JkZXJlZE1ldGFE\nYXRhTGlzdCBfbWFwcGluZyA9CiAgICAgICAgbmV3IEluaGVyaXRhbmNlT3Jk\nZXJlZE1ldGFEYXRhTGlzdCgpOwogICAgcHJpdmF0ZSBmaW5hbCBMaXN0IF9l\ncnJzID0gbmV3IExpbmtlZExpc3QoKTsKCiAgICAvLyBzeXN0ZW0gbGlzdGVu\nZXJzCiAgICBwcml2YXRlIExpZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5l\nckxpc3QgX2xpc3RlbmVycyA9CiAgICAgICAgbmV3IExpZmVjeWNsZUV2ZW50\nTWFuYWdlci5MaXN0ZW5lckxpc3QoMyk7CgogICAgLyoqCiAgICAgKiBEZWZh\ndWx0IGNvbnN0cnVjdG9yLiAgQ29uZmlndXJlIHZpYSB7QGxpbmsgQ29uZmln\ndXJhYmxlfS4KICAgICAqLwogICAgcHVibGljIE1ldGFEYXRhUmVwb3NpdG9y\neSgpIHsKICAgICAgICBFTVBUWV9NRVRBUyA9IG5ld0NsYXNzTWV0YURhdGFB\ncnJheSgwKTsKICAgICAgICBFTVBUWV9GSUVMRFMgPSBuZXdGaWVsZE1ldGFE\nYXRhQXJyYXkoMCk7CiAgICAgICAgRU1QVFlfT1JERVJTID0gbmV3T3JkZXJB\ncnJheSgwKTsKICAgICAgICBFTVBUWV9YTUxNRVRBUyA9IG5ld1hNTENsYXNz\nTWV0YURhdGFBcnJheSgwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgY29uZmlndXJhdGlvbiBmb3IgdGhlIHJlcG9zaXRvcnkuCiAgICAg\nKi8KICAgIHB1YmxpYyBPcGVuSlBBQ29uZmlndXJhdGlvbiBnZXRDb25maWd1\ncmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgbG9nLgogICAgICovCiAg\nICBwdWJsaWMgTG9nIGdldExvZygpIHsKICAgICAgICByZXR1cm4gX2xvZzsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBJL08gdXNlZCB0byBsb2FkIG1l\ndGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgTWV0YURhdGFGYWN0b3J5IGdl\ndE1ldGFEYXRhRmFjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX2ZhY3Rvcnk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgSS9PIHVzZWQgdG8gbG9hZCBt\nZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TWV0YURhdGFG\nYWN0b3J5KE1ldGFEYXRhRmFjdG9yeSBmYWN0b3J5KSB7CiAgICAgICAgZmFj\ndG9yeS5zZXRSZXBvc2l0b3J5KHRoaXMpOwogICAgICAgIF9mYWN0b3J5ID0g\nZmFjdG9yeTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSB2\nYWxpZGF0aW9uIGxldmVsLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+VkFM\nSURBVEVfTUVUQSB8IFZBTElEQVRFX1VORU5IQU5DRUQ8L2NvZGU+LgogICAg\nICovCiAgICBwdWJsaWMgaW50IGdldFZhbGlkYXRlKCkgewogICAgICAgIHJl\ndHVybiBfdmFsaWRhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0\nYWRhdGEgdmFsaWRhdGlvbiBsZXZlbC4gRGVmYXVsdHMgdG8KICAgICAqIDxj\nb2RlPlZBTElEQVRFX01FVEEgfCBWQUxJREFURV9VTkVOSEFOQ0VEPC9jb2Rl\nPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VmFsaWRhdGUoaW50IHZh\nbGlkYXRlKSB7CiAgICAgICAgX3ZhbGlkYXRlID0gdmFsaWRhdGU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgdmFsaWRhdGlvbiBsZXZl\nbC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPlZBTElEQVRFX01FVEEgfCBW\nQUxJREFURV9NQVBQSU5HIHwgVkFMSURBVEVfVU5FTkhBTkNFRDwvY29kZT4u\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFZhbGlkYXRlKGludCB2YWxp\nZGF0ZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlmICh2YWxpZGF0ZSA9PSBW\nQUxJREFURV9OT05FKQogICAgICAgICAgICBfdmFsaWRhdGUgPSB2YWxpZGF0\nZTsKICAgICAgICBlbHNlIGlmIChvbikKICAgICAgICAgICAgX3ZhbGlkYXRl\nIHw9IHZhbGlkYXRlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3ZhbGlk\nYXRlICY9IH52YWxpZGF0ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBt\nZXRhZGF0YSByZXNvbHV0aW9uIG1vZGUuIERlZmF1bHRzIHRvCiAgICAgKiA8\nY29kZT5NT0RFX01FVEEgfCBNT0RFX01BUFBJTkc8L2NvZGU+LgogICAgICov\nCiAgICBwdWJsaWMgaW50IGdldFJlc29sdmUoKSB7CiAgICAgICAgcmV0dXJu\nIF9yZXNNb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRh\nIHJlc29sdXRpb24gbW9kZS4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1P\nREVfTUVUQSB8IE1PREVfTUFQUElORzwvY29kZT4uCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldFJlc29sdmUoaW50IG1vZGUpIHsKICAgICAgICBfcmVz\nTW9kZSA9IG1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRh\ndGEgcmVzb2x1dGlvbiBtb2RlLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+\nTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HPC9jb2RlPi4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0UmVzb2x2ZShpbnQgbW9kZSwgYm9vbGVhbiBvbikg\newogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAgICAgICAgICAg\nX3Jlc01vZGUgPSBtb2RlOwogICAgICAgIGVsc2UgaWYgKG9uKQogICAgICAg\nICAgICBfcmVzTW9kZSB8PSBtb2RlOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX3Jlc01vZGUgJj0gfm1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgc291cmNlIG1vZGUgZGV0ZXJtaW5pbmcgd2hhdCBtZXRhZGF0YSB0byBs\nb2FkLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+TU9ERV9NRVRBIHwgTU9E\nRV9NQVBQSU5HIHwgTU9ERV9RVUVSWTwvY29kZT4uCiAgICAgKi8KICAgIHB1\nYmxpYyBpbnQgZ2V0U291cmNlTW9kZSgpIHsKICAgICAgICByZXR1cm4gX3Nv\ndXJjZU1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1v\nZGUgZGV0ZXJtaW5pbmcgd2hhdCBtZXRhZGF0YSB0byBsb2FkLiBEZWZhdWx0\ncyB0bwogICAgICogPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwg\nTU9ERV9RVUVSWTwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFNvdXJjZU1vZGUoaW50IG1vZGUpIHsKICAgICAgICBfc291cmNlTW9kZSA9\nIG1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUg\nZGV0ZXJtaW5pbmcgd2hhdCBtZXRhZGF0YSB0byBsb2FkLiBEZWZhdWx0cyB0\nbwogICAgICogPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9E\nRV9RVUVSWTwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNv\ndXJjZU1vZGUoaW50IG1vZGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAo\nbW9kZSA9PSBNT0RFX05PTkUpCiAgICAgICAgICAgIF9zb3VyY2VNb2RlID0g\nbW9kZTsKICAgICAgICBlbHNlIGlmIChvbikKICAgICAgICAgICAgX3NvdXJj\nZU1vZGUgfD0gbW9kZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9zb3Vy\nY2VNb2RlICY9IH5tb2RlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNsYXNzLgogICAgICoKICAg\nICAqIEBwYXJhbSBjbHMgdGhlIGNsYXNzIHRvIHJldHJpZXZlIG1ldGFkYXRh\nIGZvcgogICAgICogQHBhcmFtIGVudkxvYWRlciB0aGUgZW52aXJvbm1lbnRh\nbCBjbGFzcyBsb2FkZXIsIGlmIGFueQogICAgICogQHBhcmFtIG11c3RFeGlz\ndCBpZiB0cnVlLCB0aHJvd3MgYSB7QGxpbmsgTWV0YURhdGFFeGNlcHRpb259\nCiAgICAgKiBpZiBubyBtZXRhZGF0YSBpcyBmb3VuZAogICAgICovCiAgICBw\ndWJsaWMgc3luY2hyb25pemVkIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEo\nQ2xhc3MgY2xzLAogICAgICAgIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9v\nbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBpZiAoY2xzICE9IG51bGwgJiYK\nICAgICAgICAgICAgRHluYW1pY1BlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcy5p\nc0Fzc2lnbmFibGVGcm9tKGNscykpCiAgICAgICAgICAgIGNscyA9IGNscy5n\nZXRTdXBlcmNsYXNzKCk7CgogICAgICAgIC8vIGlmIGNscyBpcyBhIGdlbmVy\nYXRlZCBpbnRlcmZhY2UsIHVzZSB0aGUgdXNlciBpbnRlcmZhY2UKICAgICAg\nICAvLyB0byBsb2NhdGUgbWV0YWRhdGEKICAgICAgICBpZiAoY2xzICE9IG51\nbGwgJiYgX2ltcGxHZW4uaXNJbXBsVHlwZShjbHMpKQogICAgICAgICAgICBj\nbHMgPSBfaW1wbEdlbi50b01hbmFnZWRJbnRlcmZhY2UoY2xzKTsKCiAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gZ2V0TWV0YURhdGFJbnRlcm5hbChj\nbHMsIGVudkxvYWRlcik7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCAmJiBt\ndXN0RXhpc3QpIHsKICAgICAgICAgICAgaWYgKGNscyAhPSBudWxsICYmCiAg\nICAgICAgICAgICAgICAhSW1wbEhlbHBlci5pc01hbmFnZWRUeXBlKF9jb25m\nLCBjbHMpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1tZXRhLW5vdHBjIiwgY2xzKSkuCiAgICAg\nICAgICAgICAgICAgICAgc2V0RmF0YWwoZmFsc2UpOwoKICAgICAgICAgICAg\nU2V0IHBjTmFtZXMgPSBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLCBl\nbnZMb2FkZXIpOwogICAgICAgICAgICBpZiAocGNOYW1lcyAhPSBudWxsICYm\nIHBjTmFtZXMuc2l6ZSgpID4gMCkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0YS10eXBlcyIs\nCiAgICAgICAgICAgICAgICAgICAgY2xzLCBwY05hbWVzKSk7CgogICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLW1ldGEiLCBjbHMpKTsKICAgICAgICB9CiAgICAgICAgcmVzb2x2ZShtZXRh\nKTsKICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBhbGlhcyBuYW1l\nLgogICAgICoKICAgICAqIEBwYXJhbSBhbGlhcyB0aGUgYWxpYXMgdG8gY2xh\nc3MgdG8gcmV0cmlldmUgbWV0YWRhdGEgZm9yCiAgICAgKiBAcGFyYW0gZW52\nTG9hZGVyIHRoZSBlbnZpcm9ubWVudGFsIGNsYXNzIGxvYWRlciwgaWYgYW55\nCiAgICAgKiBAcGFyYW0gbXVzdEV4aXN0IGlmIHRydWUsIHRocm93cyBhIHtA\nbGluayBNZXRhRGF0YUV4Y2VwdGlvbn0KICAgICAqIGlmIG5vIG1ldGFkYXRh\nIGlzIGZvdW5kCiAgICAgKiBAc2VlIENsYXNzTWV0YURhdGEjZ2V0VHlwZUFs\naWFzCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGdldE1ldGFE\nYXRhKFN0cmluZyBhbGlhcywgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLAogICAg\nICAgIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgaWYgKGFsaWFzID09\nIG51bGwgJiYgbXVzdEV4aXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWFsaWFzLW1ldGEiLCBhbGlh\ncywKICAgICAgICAgICAgICAgIF9hbGlhc2VzKSk7CiAgICAgICAgaWYgKGFs\naWFzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICAvLyBjaGVjayBjYWNoZQogICAgICAgIHByb2Nlc3NSZWdpc3RlcmVkQ2xh\nc3NlcyhlbnZMb2FkZXIpOwogICAgICAgIExpc3QgY2xhc3NMaXN0ID0gKExp\nc3QpIF9hbGlhc2VzLmdldChhbGlhcyk7CgogICAgICAgIC8vIG11bHRpcGxl\nIGNsYXNzZXMgbWF5IGhhdmUgYmVlbiBkZWZpbmVkIHdpdGggdGhlIHNhbWUg\nYWxpYXM6IHdlCiAgICAgICAgLy8gd2lsbCBmaWx0ZXIgYnkgY2hlY2tpbmcg\nYWdhaW5zdCB0aGUgY3VycmVudCBsaXN0IG9mIHRoZQogICAgICAgIC8vIHBl\ncnNpc3RlbnQgdHlwZXMgYW5kIGZpbHRlciBiYXNlZCBvbiB3aGljaCBjbGFz\nc2VzIGFyZSBsb2FkYWJsZQogICAgICAgIC8vIHZpYSB0aGUgY3VycmVudCBl\nbnZpcm9ubWVudCdzIENsYXNzTG9hZGVyCiAgICAgICAgU2V0IHBjTmFtZXMg\nPSBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLCBlbnZMb2FkZXIpOwog\nICAgICAgIENsYXNzIGNscyA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGNsYXNzTGlzdCAhPSBudWxsICYmIGkgPCBjbGFzc0xpc3Quc2l6ZSgp\nOyBpKyspIHsKICAgICAgICAgICAgQ2xhc3MgYyA9IChDbGFzcykgY2xhc3NM\naXN0LmdldChpKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIC8vIHJlLWxvYWQgdGhlIGNsYXNzIGluIHRoZSBjdXJyZW50IGVudmlyb25t\nZW50IGxvYWRlciBzbwogICAgICAgICAgICAgICAgLy8gdGhhdCB3ZSBjYW4g\naGFuZGxlIHJlZGVwbG95bWVudCBvZiB0aGUgc2FtZSBjbGFzcyBuYW1lCiAg\nICAgICAgICAgICAgICBDbGFzcyBuYyA9IENsYXNzLmZvck5hbWUoYy5nZXRO\nYW1lKCksIGZhbHNlLCBlbnZMb2FkZXIpOwoKICAgICAgICAgICAgICAgIC8v\nIGlmIHdlIGhhdmUgc3BlY2lmaWVkIGEgbGlzdCBvZiBwZXJzaXN0ZW50IGNs\nYXNlcywKICAgICAgICAgICAgICAgIC8vIGFsc28gY2hlY2sgdG8gZW5zdXJl\nIHRoYXQgdGhlIGNsYXNzIGlzIGluIHRoYXQgbGlzdAogICAgICAgICAgICAg\nICAgaWYgKHBjTmFtZXMgPT0gbnVsbCB8fCBwY05hbWVzLnNpemUoKSA9PSAw\nIAogICAgICAgICAgICAgICAgICAgIHx8IHBjTmFtZXMuY29udGFpbnMobmMu\nZ2V0TmFtZSgpKSkgewogICAgICAgICAgICAgICAgICAgIGNscyA9IG5jOwog\nICAgICAgICAgICAgICAgICAgIGlmICghY2xhc3NMaXN0LmNvbnRhaW5zKGNs\ncykpCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTGlzdC5hZGQoY2xz\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAg\nICAgICAgICAgIC8vIHRoaXMgaGFwcGVucyB3aGVuIHRoZSBjbGFzcyBpcyBu\nb3QgbG9hZGFibGUgYnkKICAgICAgICAgICAgICAgIC8vIHRoZSBlbnZpcm9u\nbWVudCBjbGFzcyBsb2FkZXIsIHNvIGl0IHdhcyBwcm9iYWJseQogICAgICAg\nICAgICAgICAgLy8gbGlzdGVkIGVsc2V3aGVyZTsgYWxzbyBpZ25vcmUgbGlu\na2FnZSBmYWlsdXJlcyBhbmQKICAgICAgICAgICAgICAgIC8vIG90aGVyIGNs\nYXNzIGxvYWRpbmcgcHJvYmxlbXMKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBpZiAoY2xzICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBn\nZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKCiAgICAg\nICAgLy8gbWF5YmUgdGhpcyBpcyBzb21lIHR5cGUgd2UndmUgc2VlbiBidXQg\nanVzdCBpc24ndCB2YWxpZAogICAgICAgIGlmIChfYWxpYXNlcy5jb250YWlu\nc0tleShhbGlhcykpIHsKICAgICAgICAgICAgaWYgKG11c3RFeGlzdCkKICAg\nICAgICAgICAgICAgIHRocm93Tm9SZWdpc3RlcmVkQWxpYXMoYWxpYXMpOwog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8v\nIHJlY29yZCB0aGF0IHRoaXMgaXMgYW4gaW52YWxpZCB0eXBlCiAgICAgICAg\nX2FsaWFzZXMucHV0KGFsaWFzLCBudWxsKTsKCiAgICAgICAgaWYgKCFtdXN0\nRXhpc3QpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVy\nbiB0aHJvd05vUmVnaXN0ZXJlZEFsaWFzKGFsaWFzKTsKICAgIH0KCiAgICBw\ncml2YXRlIENsYXNzTWV0YURhdGEgdGhyb3dOb1JlZ2lzdGVyZWRBbGlhcyhT\ndHJpbmcgYWxpYXMpIHsKICAgICAgICBTdHJpbmcgY2xvc2UgPSBnZXRDbG9z\nZXN0QWxpYXNOYW1lKGFsaWFzKTsKICAgICAgICBpZiAoY2xvc2UgIT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKAog\nICAgICAgICAgICAgICAgX2xvYy5nZXQoIm5vLWFsaWFzLW1ldGEtaGludCIs\nIGFsaWFzLCBfYWxpYXNlcywgY2xvc2UpKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbigKICAgICAgICAg\nICAgICAgIF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRhIiwgYWxpYXMsIF9hbGlh\nc2VzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRoZSBuZWFy\nZXN0IG1hdGNoIHRvIHRoZSBzcGVjaWZpZWQgYWxpYXMgbmFtZQogICAgICog\nQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2xv\nc2VzdEFsaWFzTmFtZShTdHJpbmcgYWxpYXMpIHsKICAgICAgICBDb2xsZWN0\naW9uIGFsaWFzZXMgPSBnZXRBbGlhc05hbWVzKCk7CiAgICAgICAgcmV0dXJu\nIFN0cmluZ0Rpc3RhbmNlLmdldENsb3Nlc3RMZXZlbnNodGVpbkRpc3RhbmNl\nKGFsaWFzLCBhbGlhc2VzKTsKICAgIH0KCiAgICAvKioKICAgICAqIEByZXR1\ncm4gdGhlIHJlZ2lzdGVyZWQgYWxpYXMgbmFtZXMKICAgICAqIEBzaW5jZSAx\nLjEuMAogICAgICovCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRBbGlhc05h\nbWVzKCkgewogICAgICAgIENvbGxlY3Rpb24gYWxpYXNlcyA9IG5ldyBIYXNo\nU2V0KCk7CiAgICAgICAgc3luY2hyb25pemVkIChfYWxpYXNlcykgewogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSBfYWxpYXNlcy5lbnRyeVNl\ndCgpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICBpdGVyLmhhc05leHQo\nKTsgKSB7CiAgICAgICAgICAgICAgICBNYXAuRW50cnkgZSA9IChNYXAuRW50\ncnkpIGl0ZXIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGUuZ2V0VmFs\ndWUoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGFsaWFzZXMuYWRk\nKGUuZ2V0S2V5KCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBhbGlhc2VzOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJu\nYWwgbWV0aG9kIHRvIGdldCB0aGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBj\nbGFzcywgd2l0aG91dAogICAgICogcmVzb2x2aW5nIGl0LgogICAgICovCiAg\nICBwcml2YXRlIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGFJbnRlcm5hbChD\nbGFzcyBjbHMsCiAgICAgICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAg\nICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgLy8gY2hlY2sgY2FjaGUgZm9yIGV4aXN0aW5nIG1ldGFk\nYXRhLCBvciBnaXZlIHVwIGlmIG5vIG1ldGFkYXRhIGFuZAogICAgICAgIC8v\nIG91ciBsaXN0IG9mIGNvbmZpZ3VyZWQgcGVyc2lzdGVudCB0eXBlcyBkb2Vz\nbid0IGluY2x1ZGUgdGhlIGNsYXNzCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoY2xzKTsKICAgICAg\nICBpZiAobWV0YSAhPSBudWxsICYmICgobWV0YS5nZXRTb3VyY2VNb2RlKCkg\nJiBNT0RFX01FVEEpICE9IDAKICAgICAgICAgICAgfHwgKF9zb3VyY2VNb2Rl\nICYgTU9ERV9NRVRBKSA9PSAwKSkKICAgICAgICAgICAgcmV0dXJuIG1ldGE7\nCgogICAgICAgIC8vIGlmIHJ1bnRpbWUsIGN1dCBvZmYgc2VhcmNoIGlmIG5v\ndCBpbiBwYyBsaXN0LiAgd2UgZG9uJ3QgZG8gdGhpcyBhdAogICAgICAgIC8v\nIGRldiB0aW1lIHNvIHRoYXQgdXNlciBjYW4gbWFuaXB1bGF0ZSBwZXJzaXN0\nZW50IGNsYXNzZXMgaGUncyB3cml0aW5nCiAgICAgICAgLy8gYmVmb3JlIGFk\nZGluZyB0aGVtIHRvIHRoZSBsaXN0CiAgICAgICAgaWYgKChfdmFsaWRhdGUg\nJiBWQUxJREFURV9SVU5USU1FKSAhPSAwKSB7CiAgICAgICAgICAgIFNldCBw\nY05hbWVzID0gZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhmYWxzZSwgZW52TG9h\nZGVyKTsKICAgICAgICAgICAgaWYgKHBjTmFtZXMgIT0gbnVsbCAmJiAhcGNO\nYW1lcy5jb250YWlucyhjbHMuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBtZXRhOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1ldGEgPT0g\nbnVsbCkgewogICAgICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgbWF5YmUg\nd2Uga25vdyB0aGlzIGNsYXNzIGhhcyBubyBtZXRhZGF0YQogICAgICAgICAg\nICBpZiAoX21ldGFzLmNvbnRhaW5zS2V5KGNscykpCiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGlz\nIGlzbid0IGFuIG9idmlvdXNseSBiYWQgY2xhc3MKICAgICAgICAgICAgaWYg\nKGNscy5pc1ByaW1pdGl2ZSgpIHx8IGNscy5nZXROYW1lKCkuc3RhcnRzV2l0\naCgiamF2YS4iKQogICAgICAgICAgICAgICAgfHwgY2xzID09IFBlcnNpc3Rl\nbmNlQ2FwYWJsZS5jbGFzcykKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICAgICAgLy8gZGVzaWduZWQgdG8gZ2V0IGFyb3VuZCBqaWtl\ncyAxLjE3IC8gSkRLMS41IGlzc3VlIHdoZXJlIHN0YXRpYwogICAgICAgICAg\nICAvLyBpbml0aWFsaXplcnMgYXJlIG5vdCBpbnZva2VkIHdoZW4gYSBjbGFz\ncyBpcyByZWZlcmVuY2VkLCBzbyB0aGUKICAgICAgICAgICAgLy8gY2xhc3Mg\nbmV2ZXIgcmVnaXN0ZXJzIGl0c2VsZiB3aXRoIHRoZSBzeXN0ZW0KICAgICAg\nICAgICAgaWYgKChfdmFsaWRhdGUgJiBWQUxJREFURV9SVU5USU1FKSAhPSAw\nKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIENsYXNzLmZvck5hbWUoY2xzLmdldE5hbWUoKSwgdHJ1ZSwKICAgICAgICAg\nICAgICAgICAgICAgICAgKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGNscykpKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8v\nIG5vdCBpbiBjYWNoZTogbG9hZCBtZXRhZGF0YSBvciBtYXBwaW5ncyBkZXBl\nbmRpbmcgb24gc291cmNlIG1vZGUuCiAgICAgICAgLy8gbG9hZGluZyBtZXRh\nZGF0YSBtaWdodCBhbHNvIGxvYWQgbWFwcGluZ3MsIGJ1dCBkb2Vzbid0IGhh\ndmUgdG8KICAgICAgICBpbnQgbW9kZSA9IDA7CiAgICAgICAgaWYgKChfc291\ncmNlTW9kZSAmIE1PREVfTUVUQSkgIT0gMCkKICAgICAgICAgICAgbW9kZSA9\nIF9zb3VyY2VNb2RlICYgfk1PREVfTUFQUElORzsKICAgICAgICBlbHNlIGlm\nICgoX3NvdXJjZU1vZGUgJiBNT0RFX01BUFBJTkcpID09IDApCiAgICAgICAg\nICAgIG1vZGUgPSBfc291cmNlTW9kZTsKICAgICAgICBpZiAobW9kZSAhPSBN\nT0RFX05PTkUpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImxv\nYWQtY2xzIiwgY2xzLCB0b01vZGVTdHJpbmcobW9kZSkpKTsKICAgICAgICAg\nICAgX2ZhY3RvcnkubG9hZChjbHMsIG1vZGUsIGVudkxvYWRlcik7CiAgICAg\nICAgfQoKICAgICAgICAvLyBjaGVjayBjYWNoZSBhZ2FpbgogICAgICAgIGlm\nIChtZXRhID09IG51bGwpCiAgICAgICAgICAgIG1ldGEgPSAoQ2xhc3NNZXRh\nRGF0YSkgX21ldGFzLmdldChjbHMpOwogICAgICAgIGlmIChtZXRhICE9IG51\nbGwgJiYgKChtZXRhLmdldFNvdXJjZU1vZGUoKSAmIE1PREVfTUVUQSkgIT0g\nMAogICAgICAgICAgICB8fCAoX3NvdXJjZU1vZGUgJiBNT0RFX01FVEEpID09\nIDApKQogICAgICAgICAgICByZXR1cm4gbWV0YTsKCiAgICAgICAgLy8gcmVj\nb3JkIHRoYXQgdGhpcyBjbGFzcyBoYXMgbm8gbWV0YWRhdGE7IGNoZWNraW5n\nIGZvciB0aGlzIGxhdGVyCiAgICAgICAgLy8gc3BlZWRzIHRoaW5ncyB1cCBp\nbiBlbnZpcm9ubWVudHMgd2l0aCBzbG93IGNsYXNzIGxvYWRpbmcKICAgICAg\nICAvLyBsaWtlIGFwcHNlcnZlcnMKICAgICAgICBpZiAobWV0YSAhPSBudWxs\nKQogICAgICAgICAgICByZW1vdmVNZXRhRGF0YShtZXRhKTsKICAgICAgICBf\nbWV0YXMucHV0KGNscywgbnVsbCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzdHJpbmcgcmVwcmVzZW50\nYXRpb24gb2YgdGhlIGdpdmVuIG1vZGUgZmxhZ3MuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIFN0cmluZyB0b01vZGVTdHJpbmcoaW50IG1vZGUpIHsK\nICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigz\nMSk7CiAgICAgICAgaWYgKChtb2RlICYgTU9ERV9NRVRBKSAhPSAwKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCJbTUVUQV0iKTsKICAgICAgICBpZiAoKG1v\nZGUgJiBNT0RFX1FVRVJZKSAhPSAwKQogICAgICAgICAgICBidWYuYXBwZW5k\nKCJbUVVFUlldIik7CiAgICAgICAgaWYgKChtb2RlICYgTU9ERV9NQVBQSU5H\nKSAhPSAwKQogICAgICAgICAgICBidWYuYXBwZW5kKCJbTUFQUElOR10iKTsK\nICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01BUFBJTkdfSU5JVCkgIT0gMCkK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiW01BUFBJTkdfSU5JVF0iKTsKICAg\nICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQcmVwYXJlIG1ldGFkYXRhIGZvciBtYXBwaW5nIHJlc29sdXRpb24u\nIFRoaXMgbWV0aG9kIG1pZ2h0IG1hcCBwYXJ0cwogICAgICogb2YgdGhlIG1l\ndGFkYXRhIHRoYXQgZG9uJ3QgcmVseSBvbiBvdGhlciBjbGFzc2VzIGJlaW5n\nIG1hcHBlZCwgYnV0IHRoYXQKICAgICAqIG90aGVyIGNsYXNzZXMgbWlnaHQg\ncmVseSBvbiBkdXJpbmcgdGhlaXIgb3duIG1hcHBpbmcgKGZvciBleGFtcGxl\nLAogICAgICogcHJpbWFyeSBrZXkgZmllbGRzKS4gQnkgZGVmYXVsdCwgdGhp\ncyBtZXRob2Qgb25seSBjYWxscwogICAgICoge0BsaW5rIENsYXNzTWV0YURh\ndGEjZGVmaW5lU3VwZXJjbGFzc0ZpZWxkc30uCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCB2b2lkIHByZXBhcmVNYXBwaW5nKENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIG1ldGEuZGVmaW5lU3VwZXJjbGFzc0ZpZWxkcyhmYWxzZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZlIHRoZSBnaXZlbiBtZXRh\nZGF0YSBpZiBuZWVkZWQuIFRoZXJlIGFyZSB0aHJlZSBnb2FsczoKICAgICAq\nIDxvbD4KICAgICAqIDxsaT5NYWtlIHN1cmUgbm8gdW5yZXNvbHZlZCBtZXRh\nZGF0YSBnZXRzIGJhY2sgdG8gdGhlIGNsaWVudC48L2xpPgogICAgICogPGxp\nPkF2b2lkIGluZmluaXRlIHJlZW50cmFudCBjYWxscyBmb3IgbXV0dWFsbHkt\nZGVwZW5kZW50IG1ldGFkYXRhcyBieQogICAgICogYWxsb3dpbmcgdW5yZXNv\nbHZlZCBtZXRhZGF0YSB0byBiZSByZXR1cm5lZCB0byBvdGhlciBtZXRhZGF0\nYXMuPC9saT4KICAgICAqIDxsaT5BbHdheXMgbWFrZSBzdXJlIHRoZSBzdXBl\ncmNsYXNzIG1ldGFkYXRhIGlzIHJlc29sdmVkIGJlZm9yZSB0aGUKICAgICAq\nIHN1YmNsYXNzIG1ldGFkYXRhIHNvIHRoYXQgdGhlIHN1YmNsYXNzIGNhbiBh\nY2Nlc3MgdGhlIHN1cGVyJ3MgbGlzdAogICAgICogb2YgZmllbGRzLjwvbGk+\nCiAgICAgKiA8L29sPiBOb3RlIHRoYXQgdGhlIGNvZGUgY2FsbGluZyB0aGlz\nIG1ldGhvZCBpcyBzeW5jaHJvbml6ZWQsIHNvIHRoaXMKICAgICAqIG1ldGhv\nZCBkb2Vzbid0IGhhdmUgdG8gYmUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCByZXNvbHZlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIC8vIHJl\ndHVybiBhbnl0aGluZyB0aGF0IGhhcyBpdHMgbWV0YWRhdGEgcmVzb2x2ZWQs\nIGJlY2F1c2UgdGhhdCBtZWFucwogICAgICAgIC8vIGl0IGlzIGVpdGhlciBm\ndWxseSByZXNvbHZlZCBvciBtdXN0IGF0IGxlYXN0IGJlIGluIHRoZSBwcm9j\nZXNzIG9mCiAgICAgICAgLy8gcmVzb2x2aW5nIG1hcHBpbmcsIGV0YyBzaW5j\nZSB3ZSBkbyB0aGF0IHJpZ2h0IGFmdGVyIG1ldGEgcmVzb2x2ZQogICAgICAg\nIGlmIChtZXRhID09IG51bGwgfHwgX3Jlc01vZGUgPT0gTU9ERV9OT05FCiAg\nICAgICAgICAgIHx8IChtZXRhLmdldFJlc29sdmUoKSAmIE1PREVfTUVUQSkg\nIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyByZXNvbHZl\nIG1ldGFkYXRhCiAgICAgICAgTGlzdCByZXNvbHZlZCA9IHJlc29sdmVNZXRh\nKG1ldGEpOwogICAgICAgIGlmIChyZXNvbHZlZCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIC8vIGxvYWQgbWFwcGluZyBkYXRhCiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCByZXNvbHZlZC5zaXplKCk7IGkr\nKykKICAgICAgICAgICAgbG9hZE1hcHBpbmcoKENsYXNzTWV0YURhdGEpIHJl\nc29sdmVkLmdldChpKSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBy\nZXNvbHZlZC5zaXplKCk7IGkrKykKICAgICAgICAgICAgcHJlTWFwcGluZygo\nQ2xhc3NNZXRhRGF0YSkgcmVzb2x2ZWQuZ2V0KGkpKTsKCiAgICAgICAgLy8g\ncmVzb2x2ZSBtYXBwaW5ncwogICAgICAgIGJvb2xlYW4gZXJyID0gdHJ1ZTsK\nICAgICAgICBpZiAoKF9yZXNNb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwKQog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJlc29sdmVkLnNpemUo\nKTsgaSsrKQogICAgICAgICAgICAgICAgZXJyICY9IHJlc29sdmVNYXBwaW5n\nKChDbGFzc01ldGFEYXRhKSByZXNvbHZlZC5nZXQoaSkpOwoKICAgICAgICAv\nLyB0aHJvdyBlcnJvcnMgZW5jb3VudGVyZWQKICAgICAgICBpZiAoZXJyICYm\nICFfZXJycy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgUnVudGltZUV4Y2Vw\ndGlvbiByZTsKICAgICAgICAgICAgaWYgKF9lcnJzLnNpemUoKSA9PSAxKQog\nICAgICAgICAgICAgICAgcmUgPSAoUnVudGltZUV4Y2VwdGlvbikgX2VycnMu\nZ2V0KDApOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZSA9\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicmVzb2x2ZS1lcnJz\nIikpLgogICAgICAgICAgICAgICAgICAgIHNldE5lc3RlZFRocm93YWJsZXMo\nKFRocm93YWJsZVtdKSBfZXJycy50b0FycmF5CiAgICAgICAgICAgICAgICAg\nICAgICAgIChuZXcgRXhjZXB0aW9uW19lcnJzLnNpemUoKV0pKTsKICAgICAg\nICAgICAgX2VycnMuY2xlYXIoKTsKICAgICAgICAgICAgdGhyb3cgcmU7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBtZXRhZGF0\nYSBtb2RlLCByZXR1cm5pbmcgbGlzdCBvZiBwcm9jZXNzZWQgbWV0YWRhZGF0\nYXMsIG9yIG51bGwKICAgICAqIGlmIHdlJ3JlIHN0aWxsIGluIHRoZSBwcm9j\nZXNzIG9mIHJlc29sdmluZyBvdGhlciBtZXRhZGF0YXMuCiAgICAgKi8KICAg\nIHByaXZhdGUgTGlzdCByZXNvbHZlTWV0YShDbGFzc01ldGFEYXRhIG1ldGEp\nIHsKICAgICAgICBpZiAobWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxs\nKSB7CiAgICAgICAgICAgIC8vIHNldCBzdXBlcmNsYXNzCiAgICAgICAgICAg\nIENsYXNzIHN1cCA9IG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldFN1cGVy\nY2xhc3MoKTsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXBNZXRhOwog\nICAgICAgICAgICB3aGlsZSAoc3VwICE9IG51bGwgJiYgc3VwICE9IE9iamVj\ndC5jbGFzcykgewogICAgICAgICAgICAgICAgc3VwTWV0YSA9IGdldE1ldGFE\nYXRhKHN1cCwgbWV0YS5nZXRFbnZDbGFzc0xvYWRlcigpLCBmYWxzZSk7CiAg\nICAgICAgICAgICAgICBpZiAoc3VwTWV0YSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVyY2xhc3Moc3VwKTsKICAgICAg\nICAgICAgICAgICAgICBtZXRhLnNldFBDU3VwZXJjbGFzc01ldGFEYXRhKHN1\ncE1ldGEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgc3VwID0gc3VwLmdl\ndFN1cGVyY2xhc3MoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuaXNJbnRlcmZhY2UoKSkgewogICAg\nICAgICAgICAgICAgQ2xhc3NbXSBzdXBzID0gbWV0YS5nZXREZXNjcmliZWRU\neXBlKCkuZ2V0SW50ZXJmYWNlcygpOwogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICAgICAgc3VwTWV0YSA9IGdldE1ldGFEYXRhKHN1cHNbaV0sIG1ldGEu\nZ2V0RW52Q2xhc3NMb2FkZXIoKSwgCiAgICAgICAgICAgICAgICAgICAgICAg\nIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc3VwTWV0YSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0UENTdXBl\ncmNsYXNzKHN1cCk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoc3VwTWV0YSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFj\nZShfbG9jLmdldCgiYXNzaWduZWQtc3VwIiwgbWV0YSwKICAgICAgICAgICAg\nICAgICAgICBtZXRhLmdldFBDU3VwZXJjbGFzcygpKSk7CiAgICAgICAgfQoK\nICAgICAgICAvLyByZXNvbHZlIHJlbGF0aW9uIHByaW1hcnkga2V5IGZpZWxk\ncyBmb3IgbWFwcGluZyBkZXBlbmRlbmNpZXMKICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZm1kcyA9IG1ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgIGlmIChmbWRzW2ldLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAg\nICAgICAgZ2V0TWV0YURhdGEoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwg\nCiAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXRFbnZDbGFzc0xvYWRlcigp\nLCBmYWxzZSk7CgogICAgICAgIC8vIHJlc29sdmUgbWV0YWRhdGE7IGlmIHdl\nJ3JlIG5vdCBpbiB0aGUgcHJvY2VzcyBvZiByZXNvbHZpbmcKICAgICAgICAv\nLyBvdGhlcnMsIHRoaXMgd2lsbCByZXR1cm4gdGhlIHNldCBvZiBpbnRlcnJl\nbGF0ZWQgbWV0YXMgdGhhdAogICAgICAgIC8vIHJlc29sdmVkCiAgICAgICAg\ncmV0dXJuIHByb2Nlc3NCdWZmZXIobWV0YSwgX3Jlc29sdmluZywgTU9ERV9N\nRVRBKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBMb2FkIG1hcHBpbmcg\naW5mb3JtYXRpb24gZm9yIHRoZSBnaXZlbiBtZXRhZGF0YS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGxvYWRNYXBwaW5nKENsYXNzTWV0YURhdGEgbWV0\nYSkgewogICAgICAgIGlmICgobWV0YS5nZXRSZXNvbHZlKCkgJiBNT0RFX01B\nUFBJTkcpICE9IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\nbG9hZCBtYXBwaW5nIGluZm9ybWF0aW9uCiAgICAgICAgaWYgKChtZXRhLmdl\ndFNvdXJjZU1vZGUoKSAmIE1PREVfTUFQUElORykgPT0gMAogICAgICAgICAg\nICAmJiAoX3NvdXJjZU1vZGUgJiBNT0RFX01BUFBJTkcpICE9IDApIHsKICAg\nICAgICAgICAgLy8gZW1iZWRkZWQtb25seSBtZXRhZGF0YSBkb2Vzbid0IGhh\ndmUgbWFwcGluZywgc28gYWx3YXlzIGxvYWRlZAogICAgICAgICAgICBpZiAo\nbWV0YS5pc0VtYmVkZGVkT25seSgpKQogICAgICAgICAgICAgICAgbWV0YS5z\nZXRTb3VyY2VNb2RlKE1PREVfTUFQUElORywgdHJ1ZSk7CiAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgLy8gbG9hZCBtYXBwaW5nIGRhdGEK\nICAgICAgICAgICAgICAgIGludCBtb2RlID0gX3NvdXJjZU1vZGUgJiB+TU9E\nRV9NRVRBOwogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJsb2FkLW1hcHBpbmciLCBtZXRhLAogICAgICAgICAgICAgICAgICAgICAg\nICB0b01vZGVTdHJpbmcobW9kZSkpKTsKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgX2ZhY3RvcnkubG9hZChtZXRhLmdldERl\nc2NyaWJlZFR5cGUoKSwgbW9kZSwKICAgICAgICAgICAgICAgICAgICAgICAg\nbWV0YS5nZXRFbnZDbGFzc0xvYWRlcigpKTsKICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAg\nICAgICByZW1vdmVNZXRhRGF0YShtZXRhKTsKICAgICAgICAgICAgICAgICAg\nICBfZXJycy5hZGQocmUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUHJlLW1hcHBp\nbmcgcHJlcGFyYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwcmVN\nYXBwaW5nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmICgobWV0\nYS5nZXRSZXNvbHZlKCkgJiBNT0RFX01BUFBJTkcpICE9IDApCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgLy8gcHJlcGFyZSBtYXBwaW5ncyBmb3Ig\ncmVzb2x2ZTsgaWYgbm90IHJlc29sdmluZyBtYXBwaW5ncywgdGhlbgogICAg\nICAgIC8vIG1ha2Ugc3VyZSBhbnkgc3VwZXJjbGFzcyBmaWVsZHMgZGVmaW5l\nZCBpbiBtZXRhZGF0YSBhcmUgcmVzb2x2ZWQKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoKF9yZXNNb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwKSB7\nCiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInByZXAt\nbWFwcGluZyIsIG1ldGEpKTsKICAgICAgICAgICAgICAgIHByZXBhcmVNYXBw\naW5nKG1ldGEpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAg\nIG1ldGEuZGVmaW5lU3VwZXJjbGFzc0ZpZWxkcyhmYWxzZSk7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICBy\nZW1vdmVNZXRhRGF0YShtZXRhKTsKICAgICAgICAgICAgX2VycnMuYWRkKHJl\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZlIGFu\nZCBpbml0aWFsaXplIG1hcHBpbmcuCiAgICAgKgogICAgICogQHJldHVybiBm\nYWxzZSBpZiB3ZSdyZSBzdGlsbCBpbiB0aGUgcHJvY2VzcyBvZiByZXNvbHZp\nbmcgbWFwcGluZ3MKICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHJlc29s\ndmVNYXBwaW5nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIExpc3Qg\nbWFwcGVkID0gcHJvY2Vzc0J1ZmZlcihtZXRhLCBfbWFwcGluZywgTU9ERV9N\nQVBQSU5HKTsKICAgICAgICBpZiAobWFwcGVkID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gaW5pdGlhbGl6ZSBtYXBw\naW5nIGZvciBydW50aW1lIHVzZQogICAgICAgIGlmICgoX3Jlc01vZGUgJiBN\nT0RFX01BUFBJTkdfSU5JVCkgIT0gMCkgewogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IG1hcHBlZC5zaXplKCk7IGkrKykgewogICAgICAgICAg\nICAgICAgbWV0YSA9IChDbGFzc01ldGFEYXRhKSBtYXBwZWQuZ2V0KGkpOwog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBtZXRh\nLnJlc29sdmUoTU9ERV9NQVBQSU5HX0lOSVQpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAg\nICAgICAgIHJlbW92ZU1ldGFEYXRhKG1ldGEpOwogICAgICAgICAgICAgICAg\nICAgIF9lcnJzLmFkZChyZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQcm9jZXNzIHRoZSBnaXZlbiBtZXRhZGF0YSBhbmQg\ndGhlIGFzc29jaWF0ZWQgYnVmZmVyLgogICAgICovCiAgICBwcml2YXRlIExp\nc3QgcHJvY2Vzc0J1ZmZlcihDbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAg\nSW5oZXJpdGFuY2VPcmRlcmVkTWV0YURhdGFMaXN0IGJ1ZmZlciwgaW50IG1v\nZGUpIHsKICAgICAgICAvLyBpZiB3ZSdyZSBhbHJlYWR5IHByb2Nlc3Npbmcg\nYSBtZXRhZGF0YSwganVzdCBidWZmZXIgdGhpcyBvbmU7IHdoZW4KICAgICAg\nICAvLyB0aGUgaW5pdGlhbCBtZXRhZGF0YSBmaW5pc2hlcyBwcm9jZXNzaW5n\nLCB3ZSB0cmF2ZXJzZSB0aGUgYnVmZmVyCiAgICAgICAgLy8gYW5kIHByb2Nl\nc3MgYWxsIHRoZSBvdGhlcnMgdGhhdCB3ZXJlIGludHJvZHVjZWQgZHVyaW5n\nIHJlZW50cmFudAogICAgICAgIC8vIGNhbGxzCiAgICAgICAgaWYgKCFidWZm\nZXIuYWRkKG1ldGEpIHx8IGJ1ZmZlci5zaXplKCkgIT0gMSkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGNvbnRpbnVhbGx5IHBvcCBh\nIG1ldGFkYXRhIGFuZCBwcm9jZXNzIGl0IHVudGlsIHdlIHJ1biBvdXQ7IG5v\ndGUKICAgICAgICAvLyB0aGF0IGVhY2ggcHJvY2Vzc2luZyBjYWxsIG1pZ2h0\nIHBsYWNlIG1vcmUgbWV0YXMgaW4gdGhlIGJ1ZmZlciBhcwogICAgICAgIC8v\nIG9uZSBjbGFzcyB0cmllcyB0byBhY2Nlc3MgbWV0YWRhdGEgZm9yIGFub3Ro\nZXI7IGFsc28gbm90ZSB0aGF0IHRoZQogICAgICAgIC8vIGJ1ZmZlciBvcmRl\ncnMgaXRzZWxmIGZyb20gbGVhc3QgdG8gbW9zdCBkZXJpdmVkCiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBidWZmZXJlZDsKICAgICAgICBMaXN0IHByb2Nlc3Nl\nZCA9IG5ldyBBcnJheUxpc3QoNSk7CiAgICAgICAgd2hpbGUgKCFidWZmZXIu\naXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGJ1ZmZlcmVkID0gYnVmZmVyLnBl\nZWsoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGJ1ZmZl\ncmVkLnJlc29sdmUobW9kZSk7CiAgICAgICAgICAgICAgICBwcm9jZXNzZWQu\nYWRkKGJ1ZmZlcmVkKTsKICAgICAgICAgICAgICAgIGJ1ZmZlci5yZW1vdmUo\nYnVmZmVyZWQpOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgICAgICBfZXJycy5hZGQocmUpOwoKICAg\nICAgICAgICAgICAgIC8vIGFueSBleGNlcHRpb24gZHVyaW5nIHJlc29sdXRp\nb24gb2Ygb25lIHR5cGUgbWVhbnMgd2UgY2FuJ3QKICAgICAgICAgICAgICAg\nIC8vIHJlc29sdmUgYW55IG9mIHRoZSByZWxhdGVkIHR5cGVzLCBzbyBjbGVh\nciBidWZmZXIuICB0aGlzIGFsc28KICAgICAgICAgICAgICAgIC8vIGVuc3Vy\nZXMgdGhhdCBpZiB0d28gdHlwZXMgcmVsYXRlIHRvIGVhY2ggb3RoZXIgYW5k\nIG9uZQogICAgICAgICAgICAgICAgLy8gZGllcywgd2UgZG9uJ3QgZ2V0IGlu\ndG8gaW5maW5pdGUgY3ljbGVzCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IGJ1ZmZlci5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgICAgIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkg\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICByZW1vdmVNZXRhRGF0\nYShtZXRhKTsKICAgICAgICAgICAgICAgICAgICBpZiAobWV0YSAhPSBidWZm\nZXJlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBfZXJycy5hZGQobmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAoInByZXYtZXJycyIsIG1ldGEsIGJ1ZmZlcmVkKSkpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIGJ1ZmZlci5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBwcm9jZXNzZWQ7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYWxsIHRoZSBtZXRhZGF0YSBpbnN0YW5jZXMgY3Vy\ncmVudGx5IGluIHRoZSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMg\nc3luY2hyb25pemVkIENsYXNzTWV0YURhdGFbXSBnZXRNZXRhRGF0YXMoKSB7\nCiAgICAgICAgLy8gcHJldmVudCBjb25jdXJyZW50IG1vZCBlcnJvcnMgd2hl\nbiByZXNvbHZpbmcgb25lIG1ldGFkYXRhCiAgICAgICAgLy8gaW50cm9kdWNl\ncyBvdGhlcnMKICAgICAgICBDbGFzc01ldGFEYXRhW10gbWV0YXMgPSAoQ2xh\nc3NNZXRhRGF0YVtdKSBfbWV0YXMudmFsdWVzKCkuCiAgICAgICAgICAgIHRv\nQXJyYXkobmV3IENsYXNzTWV0YURhdGFbX21ldGFzLnNpemUoKV0pOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWV0YXMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgIGlmIChtZXRhc1tpXSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgZ2V0TWV0YURhdGEobWV0YXNbaV0uZ2V0RGVzY3JpYmVkVHlwZSgpLAog\nICAgICAgICAgICAgICAgICAgIG1ldGFzW2ldLmdldEVudkNsYXNzTG9hZGVy\nKCksIHRydWUpOwoKICAgICAgICBMaXN0IHJlc29sdmVkID0gbmV3IEFycmF5\nTGlzdChfbWV0YXMuc2l6ZSgpKTsKICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGE7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfbWV0YXMudmFsdWVz\nKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nbWV0YSA9IChDbGFzc01ldGFEYXRhKSBpdHIubmV4dCgpOwogICAgICAgICAg\nICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmVzb2x2ZWQu\nYWRkKG1ldGEpOwogICAgICAgIH0KICAgICAgICBtZXRhcyA9IChDbGFzc01l\ndGFEYXRhW10pIHJlc29sdmVkLnRvQXJyYXkKICAgICAgICAgICAgKG5ld0Ns\nYXNzTWV0YURhdGFBcnJheShyZXNvbHZlZC5zaXplKCkpKTsKICAgICAgICBB\ncnJheXMuc29ydChtZXRhcyk7CiAgICAgICAgcmV0dXJuIG1ldGFzOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjYWNoZWQgbWV0YWRhdGEg\nZm9yIHRoZSBnaXZlbiBjbGFzcywgd2l0aG91dCBhbnkgcmVzb2x1dGlvbi4K\nICAgICAqIFJldHVybiBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBDbGFzc01ldGFEYXRhIGdldENhY2hlZE1ldGFEYXRhKENsYXNzIGNscykg\newogICAgICAgIHJldHVybiAoQ2xhc3NNZXRhRGF0YSkgX21ldGFzLmdldChj\nbHMpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBt\nZXRhZGF0YSwgcG9wdWxhdGUgaXQgd2l0aCBkZWZhdWx0IGluZm9ybWF0aW9u\nLCBhZGQgaXQgdG8KICAgICAqIHRoZSByZXBvc2l0b3J5LCBhbmQgcmV0dXJu\nIGl0LiBVc2UgdGhlIGRlZmF1bHQgYWNjZXNzIHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBDbGFzc01ldGFEYXRhIGFkZE1ldGFEYXRhKENsYXNzIGNscykg\newogICAgICAgIHJldHVybiBhZGRNZXRhRGF0YShjbHMsIENsYXNzTWV0YURh\ndGEuQUNDRVNTX1VOS05PV04pOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgbmV3IG1ldGFkYXRhLCBwb3B1bGF0ZSBpdCB3aXRoIGRlZmF1bHQg\naW5mb3JtYXRpb24sIGFkZCBpdCB0bwogICAgICogdGhlIHJlcG9zaXRvcnks\nIGFuZCByZXR1cm4gaXQuCiAgICAgKgogICAgICogQHBhcmFtIGFjY2VzcyB0\naGUgYWNjZXNzIHR5cGUgdG8gdXNlIGluIHBvcHVsYXRpbmcgbWV0YWRhdGEK\nICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgYWRkTWV0YURhdGEo\nQ2xhc3MgY2xzLCBpbnQgYWNjZXNzKSB7CiAgICAgICAgaWYgKGNscyA9PSBu\ndWxsIHx8IGNscy5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gbmV3Q2xhc3NN\nZXRhRGF0YShjbHMpOwogICAgICAgIF9mYWN0b3J5LmdldERlZmF1bHRzKCku\ncG9wdWxhdGUobWV0YSwgYWNjZXNzKTsKCiAgICAgICAgLy8gc3luY2hyb25p\nemUgb24gdGhpcyByYXRoZXIgdGhhbiB0aGUgbWFwLCBiZWNhdXNlIGFsbCBv\ndGhlciBtZXRob2RzCiAgICAgICAgLy8gdGhhdCBhY2Nlc3MgX21ldGFzIGFy\nZSBzeW5jaHJvbml6ZWQgb24gdGhpcwogICAgICAgIHN5bmNocm9uaXplZCAo\ndGhpcykgewogICAgICAgICAgICBpZiAoX3Bhd2FyZXMuY29udGFpbnNLZXko\nY2xzKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldCgicGMtYW5kLWF3YXJlIiwgY2xzKSk7CiAgICAgICAg\nICAgIF9tZXRhcy5wdXQoY2xzLCBtZXRhKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG1ldGE7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ3JlYXRl\nIGEgbmV3IGNsYXNzIG1ldGFkYXRhIGluc3RhbmNlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YSBuZXdDbGFzc01ldGFEYXRhKENsYXNz\nIHR5cGUpIHsKICAgICAgICByZXR1cm4gbmV3IENsYXNzTWV0YURhdGEodHlw\nZSwgdGhpcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\nYXJyYXkgb2YgdGhlIHByb3BlciBjbGFzcyBtZXRhZGF0YSBzdWJjbGFzcy4K\nICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGFbXSBuZXdDbGFz\nc01ldGFEYXRhQXJyYXkoaW50IGxlbmd0aCkgewogICAgICAgIHJldHVybiBu\nZXcgQ2xhc3NNZXRhRGF0YVtsZW5ndGhdOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGEgbmV3IGZpZWxkIG1ldGFkYXRhIGluc3RhbmNlLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgRmllbGRNZXRhRGF0YSBuZXdGaWVsZE1ldGFE\nYXRhKFN0cmluZyBuYW1lLCBDbGFzcyB0eXBlLAogICAgICAgIENsYXNzTWV0\nYURhdGEgb3duZXIpIHsKICAgICAgICByZXR1cm4gbmV3IEZpZWxkTWV0YURh\ndGEobmFtZSwgdHlwZSwgb3duZXIpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlIGEgbmV3IGFycmF5IG9mIHRoZSBwcm9wZXIgZmllbGQgbWV0YWRh\ndGEgc3ViY2xhc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGaWVsZE1ldGFE\nYXRhW10gbmV3RmllbGRNZXRhRGF0YUFycmF5KGludCBsZW5ndGgpIHsKICAg\nICAgICByZXR1cm4gbmV3IEZpZWxkTWV0YURhdGFbbGVuZ3RoXTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBhcnJheSBvZiB0aGUgcHJv\ncGVyIHhtbCBjbGFzcyBtZXRhZGF0YSBzdWJjbGFzcy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFhNTE1ldGFEYXRhW10gbmV3WE1MQ2xhc3NNZXRhRGF0YUFy\ncmF5KGludCBsZW5ndGgpIHsKICAgICAgICByZXR1cm4gbmV3IFhNTENsYXNz\nTWV0YURhdGFbbGVuZ3RoXTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIG5ldyBlbWJlZGRlZCBjbGFzcyBtZXRhZGF0YSBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEgbmV3RW1iZWRkZWRD\nbGFzc01ldGFEYXRhKFZhbHVlTWV0YURhdGEgb3duZXIpIHsKICAgICAgICBy\nZXR1cm4gbmV3IENsYXNzTWV0YURhdGEob3duZXIpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGEgbmV3IHZhbHVlIG1ldGFkYXRhIGluc3RhbmNl\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgVmFsdWVNZXRhRGF0YSBuZXdWYWx1\nZU1ldGFEYXRhKEZpZWxkTWV0YURhdGEgb3duZXIpIHsKICAgICAgICByZXR1\ncm4gbmV3IFZhbHVlTWV0YURhdGFJbXBsKG93bmVyKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhbiB7QGxpbmsgT3JkZXJ9IGZvciB0aGUgZ2l2\nZW4gZmllbGQgYW5kIGRlY2xhcmF0aW9uLiBUaGlzCiAgICAgKiBtZXRob2Qg\nZGVsZWdhdGVzIHRvIHtAbGluayAjbmV3UmVsYXRlZEZpZWxkT3JkZXJ9IGFu\nZAogICAgICoge0BsaW5rICNuZXdWYWx1ZUZpZWxkT3JkZXJ9IGJ5IGRlZmF1\nbHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPcmRlciBuZXdPcmRlcihGaWVs\nZE1ldGFEYXRhIG93bmVyLCBTdHJpbmcgbmFtZSwgYm9vbGVhbiBhc2MpIHsK\nICAgICAgICAvLyBwYXRocyBjYW4gc3RhcnQgd2l0aCAob3IgZXF1YWwpICcj\nZWxlbWVudCcKICAgICAgICBpZiAobmFtZS5zdGFydHNXaXRoKE9yZGVyLkVM\nRU1FTlQpKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoT3Jk\nZXIuRUxFTUVOVC5sZW5ndGgoKSk7CiAgICAgICAgaWYgKG5hbWUubGVuZ3Ro\nKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbHVlT3JkZXIob3du\nZXIsIGFzYyk7CgogICAgICAgIC8vIG5leHQgdG9rZW4gc2hvdWxkIGJlICcu\nJwogICAgICAgIGlmIChuYW1lLmNoYXJBdCgwKSA9PSAnLicpCiAgICAgICAg\nICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygxKTsKCiAgICAgICAgLy8gcmVs\nYXRlZCBmaWVsZAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IG93bmVy\nLmdldEVsZW1lbnQoKS5nZXRUeXBlTWV0YURhdGEoKTsKICAgICAgICBpZiAo\nbWV0YSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vbnBjLWZpZWxkLW9yZGVyYWJsZSIsCiAg\nICAgICAgICAgICAgICBvd25lciwgbmFtZSkpOwogICAgICAgIEZpZWxkTWV0\nYURhdGEgcmVsID0gbWV0YS5nZXRGaWVsZChuYW1lKTsKICAgICAgICBpZiAo\ncmVsID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiYmFkLWZpZWxkLW9yZGVyYWJsZSIsCiAgICAg\nICAgICAgICAgICBvd25lciwgbmFtZSkpOwogICAgICAgIHJldHVybiBuZXdS\nZWxhdGVkRmllbGRPcmRlcihvd25lciwgcmVsLCBhc2MpOwogICAgfQoKICAg\nIC8qKgogICAgICogT3JkZXIgYnkgdGhlIGZpZWxkIHZhbHVlLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgT3JkZXIgbmV3VmFsdWVPcmRlcihGaWVsZE1ldGFE\nYXRhIG93bmVyLCBib29sZWFuIGFzYykgewogICAgICAgIHJldHVybiBuZXcg\nSW5NZW1vcnlWYWx1ZU9yZGVyKGFzYywgZ2V0Q29uZmlndXJhdGlvbigpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE9yZGVyIGJ5IGEgZmllbGQgb2YgdGhl\nIHJlbGF0ZWQgdHlwZS4KICAgICAqLwogICAgcHJvdGVjdGVkIE9yZGVyIG5l\nd1JlbGF0ZWRGaWVsZE9yZGVyKEZpZWxkTWV0YURhdGEgb3duZXIsCiAgICAg\nICAgRmllbGRNZXRhRGF0YSByZWwsIGJvb2xlYW4gYXNjKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBJbk1lbW9yeVJlbGF0ZWRGaWVsZE9yZGVyKHJlbCwgYXNj\nLCBnZXRDb25maWd1cmF0aW9uKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlIGFuIGFycmF5IG9mIG9yZGVycyBvZiB0aGUgZ2l2ZW4gc2l6ZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIE9yZGVyW10gbmV3T3JkZXJBcnJheShp\nbnQgc2l6ZSkgewogICAgICAgIHJldHVybiBuZXcgT3JkZXJbc2l6ZV07CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBtZXRhZGF0YSBpbnN0YW5j\nZSBmcm9tIHRoZSByZXBvc2l0b3J5LgogICAgICoKICAgICAqIEByZXR1cm4g\ndHJ1ZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBub3QgaW4gdGhpcyByZXBvc2l0\nb3J5CiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZU1ldGFEYXRh\nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4g\ncmVtb3ZlTWV0YURhdGEobWV0YS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgbWV0YWRhdGEgaW5zdGFuY2Ug\nZnJvbSB0aGUgcmVwb3NpdG9yeS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRy\ndWUgaWYgcmVtb3ZlZCwgZmFsc2UgaWYgbm90IGluIHRoaXMgcmVwb3NpdG9y\neQogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGJvb2xlYW4gcmVt\nb3ZlTWV0YURhdGEoQ2xhc3MgY2xzKSB7CiAgICAgICAgaWYgKGNscyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKF9t\nZXRhcy5yZW1vdmUoY2xzKSAhPSBudWxsKSB7CiAgICAgICAgICAgIENsYXNz\nIGltcGwgPSAoQ2xhc3MpIF9pZmFjZXMucmVtb3ZlKGNscyk7CiAgICAgICAg\nICAgIGlmIChpbXBsICE9IG51bGwpCiAgICAgICAgICAgICAgICBfbWV0YXMu\ncmVtb3ZlKGltcGwpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkIHRoZSBnaXZlbiBtZXRhZGF0YSBhcyBkZWNsYXJlZCBpbnRlcmZh\nY2UgaW1wbGVtZW50YXRpb24uCiAgICAgKi8KICAgIHZvaWQgYWRkRGVjbGFy\nZWRJbnRlcmZhY2VJbXBsKENsYXNzTWV0YURhdGEgbWV0YSwgQ2xhc3MgaWZh\nY2UpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9pbXBscykgewogICAgICAg\nICAgICBDb2xsZWN0aW9uIHZhbHMgPSAoQ29sbGVjdGlvbikgX2ltcGxzLmdl\ndChpZmFjZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBjaGVjayB0\nbyBzZWUgaWYgdGhlIHN1cGVyY2xhc3MgYWxyZWFkeSBkZWNsYXJlcyB0byBh\ndm9pZCBkdXBzCiAgICAgICAgICAgIGlmICh2YWxzICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gbWV0YS5nZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgZm9yICg7IHN1\ncCAhPSBudWxsOyBzdXAgPSBzdXAuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKSkKICAgICAgICAgICAgICAgICAgICBpZiAodmFscy5jb250YWlucyhzdXAu\nZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZFRvQ29sbGVj\ndGlvbihfaW1wbHMsIGlmYWNlLCBtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwg\nZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgaW1wbGVtZW50YXRpb24gZm9yIHRoZSBnaXZlbiBtYW5hZ2VkIGludGVy\nZmFjZS4KICAgICAqLwogICAgc3luY2hyb25pemVkIHZvaWQgc2V0SW50ZXJm\nYWNlSW1wbChDbGFzc01ldGFEYXRhIG1ldGEsIENsYXNzIGltcGwpIHsKICAg\nICAgICBpZiAoIW1ldGEuaXNNYW5hZ2VkSW50ZXJmYWNlKCkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90\nLW1hbmFnZWQtaW50ZXJmYWNlIiwgCiAgICAgICAgICAgICAgICBtZXRhLCBp\nbXBsKSk7CiAgICAgICAgX2lmYWNlcy5wdXQobWV0YS5nZXREZXNjcmliZWRU\neXBlKCksIGltcGwpOwogICAgICAgIGFkZERlY2xhcmVkSW50ZXJmYWNlSW1w\nbChtZXRhLCBtZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBzdXAgPSBtZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCk7CiAgICAgICAgd2hpbGUgKHN1cCAhPSBudWxsKSB7CiAgICAgICAgICAg\nIC8vIHJlY29yZCBzdXBlcmNsYXNzIGludGVyZmFjZSBpbmZvIHdoaWxlIHdl\nIGNhbiBhcyB3ZWxsIGFzIHdlCiAgICAgICAgICAgIC8vIHdpbGwgb25seSBy\nZWdpc3RlciBjb25jcmV0ZSBzdXBlcmNsYXNzIGluIFBDUmVnaXN0cnkKICAg\nICAgICAgICAgc3VwLmNsZWFyU3ViY2xhc3NDYWNoZSgpOwogICAgICAgICAg\nICBhZGRUb0NvbGxlY3Rpb24oX3N1YnMsIHN1cC5nZXREZXNjcmliZWRUeXBl\nKCksIGltcGwsIHRydWUpOwogICAgICAgICAgICBzdXAgPSAoQ2xhc3NNZXRh\nRGF0YSkgc3VwLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAg\nfQogICAgfQogICAgCiAgICBJbnRlcmZhY2VJbXBsR2VuZXJhdG9yIGdldElt\ncGxHZW5lcmF0b3IoKSB7CiAgICAgICAgcmV0dXJuIF9pbXBsR2VuOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsZWFzdC1kZXJpdmVkIGNs\nYXNzIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gYXBwbGljYXRpb24KICAgICAq\nIGlkZW50aXR5IG9iamVjdC4KICAgICAqCiAgICAgKiBAcGFyYW0gb2lkIHRo\nZSBvaWQgdG8gZ2V0IHRoZSBtZXRhZGF0YSBmb3IKICAgICAqIEBwYXJhbSBl\nbnZMb2FkZXIgdGhlIGVudmlyb25tZW50YWwgY2xhc3MgbG9hZGVyLCBpZiBh\nbnkKICAgICAqIEBwYXJhbSBtdXN0RXhpc3QgaWYgdHJ1ZSwgdGhyb3dzIGEg\ne0BsaW5rIE1ldGFEYXRhRXhjZXB0aW9ufQogICAgICogaWYgbm8gbWV0YWRh\ndGEgaXMgZm91bmQKICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEg\nZ2V0TWV0YURhdGEoT2JqZWN0IG9pZCwgQ2xhc3NMb2FkZXIgZW52TG9hZGVy\nLAogICAgICAgIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgaWYgKG9p\nZCA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1vaWQtbWV0YSIsIG9p\nZCwgIj8iLAogICAgICAgICAgICAgICAgX29pZHMudG9TdHJpbmcoKSkpOwog\nICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIGlmIChvaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQpIHsK\nICAgICAgICAgICAgQ2xhc3MgY2xzID0gKChPcGVuSlBBSWQpIG9pZCkuZ2V0\nVHlwZSgpOwogICAgICAgICAgICByZXR1cm4gZ2V0TWV0YURhdGEoY2xzLCBl\nbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAgICAgICAgfQoKICAgICAgICAvLyBj\naGVjayBjYWNoZQogICAgICAgIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3Nlcyhl\nbnZMb2FkZXIpOwogICAgICAgIENsYXNzIGNscyA9IChDbGFzcykgX29pZHMu\nZ2V0KG9pZC5nZXRDbGFzcygpKTsKICAgICAgICBpZiAoY2xzICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBnZXRNZXRhRGF0YShjbHMsIGVudkxvYWRl\nciwgbXVzdEV4aXN0KTsKCiAgICAgICAgLy8gbWF5YmUgdGhpcyBpcyBzb21l\nIHR5cGUgd2UndmUgc2VlbiBidXQganVzdCBpc24ndCB2YWxpZAogICAgICAg\nIGlmIChfb2lkcy5jb250YWluc0tleShvaWQuZ2V0Q2xhc3MoKSkpIHsKICAg\nICAgICAgICAgaWYgKG11c3RFeGlzdCkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tb2lkLW1ldGEi\nLCBvaWQsCiAgICAgICAgICAgICAgICAgICAgb2lkLmdldENsYXNzKCksIF9v\naWRzKSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAg\nICAgICAgLy8gaWYgc3RpbGwgbm90IG1hdGNoLCByZWdpc3RlciBhbnkgY2xh\nc3NlcyB0aGF0IGxvb2sgc2ltaWxhciB0byB0aGUKICAgICAgICAvLyBvaWQg\nY2xhc3MgYW5kIGNoZWNrIGFnYWluCiAgICAgICAgcmVzb2x2ZUlkZW50aXR5\nQ2xhc3Mob2lkKTsKICAgICAgICBpZiAocHJvY2Vzc1JlZ2lzdGVyZWRDbGFz\nc2VzKGVudkxvYWRlcikubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjbHMg\nPSAoQ2xhc3MpIF9vaWRzLmdldChvaWQuZ2V0Q2xhc3MoKSk7CiAgICAgICAg\nICAgIGlmIChjbHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKICAgICAg\nICB9CgogICAgICAgIC8vIHJlY29yZCB0aGF0IHRoaXMgaXMgYW4gaW52YWxp\nZCB0eXBlCiAgICAgICAgX29pZHMucHV0KG9pZC5nZXRDbGFzcygpLCBudWxs\nKTsKCiAgICAgICAgaWYgKCFtdXN0RXhpc3QpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tb2lkLW1ldGEiLCBvaWQsCiAgICAgICAgICAgIG9pZC5n\nZXRDbGFzcygpLCBfb2lkcykpLnNldEZhaWxlZE9iamVjdChvaWQpOwogICAg\nfQoKICAgIC8qKgogICAgICogTWFrZSBzb21lIGd1ZXNzZXMgYWJvdXQgdGhl\nIG5hbWUgb2YgYSB0YXJnZXQgY2xhc3MgZm9yIGFuCiAgICAgKiB1bmtub3du\nIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcmVzb2x2ZUlkZW50aXR5Q2xhc3MoT2JqZWN0IG9pZCkgewog\nICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBDbGFzcyBvaWRDbGFzcyA9IG9pZC5nZXRDbGFzcygpOwogICAg\nICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9s\nb2cudHJhY2UoX2xvYy5nZXQoInJlc29sdmUtaWRlbnRpdHkiLCBvaWRDbGFz\ncykpOwoKICAgICAgICBDbGFzc0xvYWRlciBjbCA9IChDbGFzc0xvYWRlcikg\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKG9pZENsYXNzKSk7\nIAogICAgICAgIFN0cmluZyBjbGFzc05hbWU7CiAgICAgICAgd2hpbGUgKG9p\nZENsYXNzICE9IG51bGwgJiYgb2lkQ2xhc3MgIT0gT2JqZWN0LmNsYXNzKSB7\nCiAgICAgICAgICAgIGNsYXNzTmFtZSA9IG9pZENsYXNzLmdldE5hbWUoKTsK\nCiAgICAgICAgICAgIC8vIHdlIHRha2UgYSBicnV0ZS1mb3JjZSBhcHByb2Fj\naDogdHJ5IHRvIGxvYWQgYWxsIHRoZSBjbGFzcycKICAgICAgICAgICAgLy8g\nc3Vic3RyaW5ncy4gdGhpcyB3aWxsIGhhbmRsZSB0aGUgZm9sbG93aW5nIGNv\nbW1vbiBuYW1pbmcgY2FzZXM6CiAgICAgICAgICAgIC8vCiAgICAgICAgICAg\nIC8vICAgY29tLmNvbXBhbnkuTXlDbGFzcyRJRAktPiBjb20uY29tcGFueS5N\neUNsYXNzCiAgICAgICAgICAgIC8vICAgY29tLmNvbXBhbnkuTXlDbGFzc0lk\nCS0+IGNvbS5jb21wYW55Lk15Q2xhc3MKICAgICAgICAgICAgLy8gICBjb20u\nY29tcGFueS5NeUNsYXNzT2lkCS0+IGNvbS5jb21wYW55Lk15Q2xhc3MKICAg\nICAgICAgICAgLy8gICBjb20uY29tcGFueS5NeUNsYXNzUEsJLT4gY29tLmNv\nbXBhbnkuTXlDbGFzcwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyB0\naGlzIGlzbid0IHRoZSBmYXN0ZXN0IHRoaW5nIHBvc3NpYmxlLCBidXQgdGhp\ncyBtZXRob2Qgd2lsbAogICAgICAgICAgICAvLyBvbmx5IGJlIGNhbGxlZCBv\nbmNlIHBlciBKVk0gcGVyIHVua25vd24gYXBwIGlkIGNsYXNzCiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSBjbGFzc05hbWUubGVuZ3RoKCk7IGkgPiAxOyBp\nLS0pIHsKICAgICAgICAgICAgICAgIGlmIChjbGFzc05hbWUuY2hhckF0KGkg\nLSAxKSA9PSAnLicpCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBDbGFzcy5m\nb3JOYW1lKGNsYXNzTmFtZS5zdWJzdHJpbmcoMCwgaSksIHRydWUsIGNsKTsK\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICB9IC8vIGNvbnN1bWUgYWxsIGV4Y2VwdGlvbnMKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gbW92ZSB1cCB0aGUgT0lEIGhpZXJh\ncmNoeQogICAgICAgICAgICBvaWRDbGFzcyA9IG9pZENsYXNzLmdldFN1cGVy\nY2xhc3MoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYWxsIGxlYXN0LWRlcml2ZWQgbWV0YWRhdGFzIHdpdGggc29tZSBtYXBw\nZWQgYXNzaWduYWJsZSB0eXBlIHRoYXQKICAgICAqIGltcGxlbWVudCB0aGUg\nZ2l2ZW4gY2xhc3MuCiAgICAgKgogICAgICogQHBhcmFtIGNscyB0aGUgY2xh\nc3Mgb3IgaW50ZXJmYWNlIHRvIHJldHJpZXZlIGltcGxlbWVudG9ycyBmb3IK\nICAgICAqIEBwYXJhbSBlbnZMb2FkZXIgdGhlIGVudmlyb25tZW50YWwgY2xh\nc3MgbG9hZGVyLCBpZiBhbnkKICAgICAqIEBwYXJhbSBtdXN0RXhpc3QgaWYg\ndHJ1ZSwgdGhyb3dzIGEge0BsaW5rIE1ldGFEYXRhRXhjZXB0aW9ufQogICAg\nICogaWYgbm8gbWV0YWRhdGEgaXMgZm91bmQKICAgICAqLwogICAgcHVibGlj\nIENsYXNzTWV0YURhdGFbXSBnZXRJbXBsZW1lbnRvck1ldGFEYXRhcyhDbGFz\ncyBjbHMsCiAgICAgICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFu\nIG11c3RFeGlzdCkgewogICAgICAgIGlmIChjbHMgPT0gbnVsbCAmJiBtdXN0\nRXhpc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tbWV0YSIsIGNscykpOwogICAgICAgIGlmIChjbHMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX01FVEFTOwoKICAg\nICAgICAvLyBnZXQgaW1wbHMgb2YgZ2l2ZW4gaW50ZXJmYWNlIC8gYWJzdHJh\nY3QgY2xhc3MKICAgICAgICBsb2FkUmVnaXN0ZXJlZENsYXNzTWV0YURhdGEo\nZW52TG9hZGVyKTsKICAgICAgICBDb2xsZWN0aW9uIHZhbHMgPSAoQ29sbGVj\ndGlvbikgX2ltcGxzLmdldChjbHMpOwogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YTsKICAgICAgICBDb2xsZWN0aW9uIG1hcHBlZCA9IG51bGw7CiAgICAg\nICAgaWYgKHZhbHMgIT0gbnVsbCkgewogICAgICAgICAgICBzeW5jaHJvbml6\nZWQgKHZhbHMpIHsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gdmFscy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICAgICAgICAgIG1ldGEgPSBnZXRNZXRhRGF0YSgoQ2xhc3MpIGl0ci5u\nZXh0KCksIGVudkxvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKG1ldGEuaXNNYXBwZWQoKQogICAgICAgICAgICAgICAgICAgICAgICB8\nfCBtZXRhLmdldE1hcHBlZFBDU3ViY2xhc3NNZXRhRGF0YXMoKS5sZW5ndGgg\nPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXBwZWQgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBlZCA9IG5l\ndyBBcnJheUxpc3QodmFscy5zaXplKCkpOwogICAgICAgICAgICAgICAgICAg\nICAgICBtYXBwZWQuYWRkKG1ldGEpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgaWYgKG1hcHBlZCA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1tZXRhIiwgY2xzKSk7CiAgICAgICAgaWYgKG1hcHBlZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gRU1QVFlfTUVUQVM7CiAgICAgICAgcmV0dXJu\nIChDbGFzc01ldGFEYXRhW10pIG1hcHBlZC50b0FycmF5KG5ld0NsYXNzTWV0\nYURhdGFBcnJheQogICAgICAgICAgICAobWFwcGVkLnNpemUoKSkpOwogICAg\nfQogICAgIAogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBtZXRhZGF0YSBjb3Jy\nZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBwZXJzaXN0ZW5jZS1hd2FyZSBjbGFz\ncy4gCiAgICAgKiBSZXR1cm5zIG51bGwsIGlmIHRoZSBnaXZlbiBjbGFzcyBp\ncyBub3QgcmVnaXN0ZXJlZCBhcyAKICAgICAqIHBlcnNpc3RlbmNlLWF3YXJl\nLgogICAgICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGdl\ndFBlcnNpc3RlbmNlQXdhcmUoQ2xhc3MgY2xzKSB7CiAgICAJcmV0dXJuIChO\nb25QZXJzaXN0ZW50TWV0YURhdGEpX3Bhd2FyZXMuZ2V0KGNscyk7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogR2V0cyBhbGwgdGhlIG1ldGFkYXRhcyBm\nb3IgcGVyc2lzdGVuY2UtYXdhcmUgY2xhc3NlcwogICAgICogCiAgICAgKiBA\ncmV0dXJuIGVtcHR5IGFycmF5IGlmIG5vIGNsYXNzIGhhcyBiZWVuIHJlZ2lz\ndGVyZWQgYXMgcGVycy1hd2FyZQogICAgICovCiAgICBwdWJsaWMgTm9uUGVy\nc2lzdGVudE1ldGFEYXRhW10gZ2V0UGVyc2lzdGVuY2VBd2FyZXMoKSB7CiAg\nICAgICAgc3luY2hyb25pemVkIChfcGF3YXJlcykgewogICAgICAgICAgICBp\nZiAoX3Bhd2FyZXMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIEVNUFRZX05PTl9QRVJTSVNURU5UOwogICAgICAgICAgICByZXR1cm4gKE5v\nblBlcnNpc3RlbnRNZXRhRGF0YVtdKV9wYXdhcmVzLnZhbHVlcygpLnRvQXJy\nYXkKICAgICAgICAgICAgICAgIChuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRh\nW19wYXdhcmVzLnNpemUoKV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZCB0aGUgZ2l2ZW4gY2xhc3MgYXMgcGVyc2lzdGVuY2UtYXdh\ncmUuCiAgICAgKiAKICAgICAqIEBwYXJhbSBjbHMgbm9uLW51bGwgYW5kIG11\nc3Qgbm90IGFscmVhZGR5IGJlIGFkZGVkIGFzIHBlcnNpdGVuY2UtY2FwYWJs\nZQogICAgICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGFk\nZFBlcnNpc3RlbmNlQXdhcmUoQ2xhc3MgY2xzKSB7CiAgICAJaWYgKGNscyA9\nPSBudWxsKQogICAgCQlyZXR1cm4gbnVsbDsKICAgICAgICBzeW5jaHJvbml6\nZWQodGhpcykgewogICAgICAgICAgICBpZiAoX3Bhd2FyZXMuY29udGFpbnNL\nZXkoY2xzKSkKICAgICAgICAgICAgICAgIHJldHVybiAoTm9uUGVyc2lzdGVu\ndE1ldGFEYXRhKV9wYXdhcmVzLmdldChjbHMpOwogICAgICAgICAgICBpZiAo\nZ2V0Q2FjaGVkTWV0YURhdGEoY2xzKSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJwYy1h\nbmQtYXdhcmUiLCBjbHMpKTsKICAgICAgICAgICAgTm9uUGVyc2lzdGVudE1l\ndGFEYXRhIG1ldGEgPSBuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhKGNscywg\ndGhpcywKICAgICAgICAgICAgICAgIE5vblBlcnNpc3RlbnRNZXRhRGF0YS5U\nWVBFX1BFUlNJU1RFTkNFX0FXQVJFKTsKICAgICAgICAgICAgX3Bhd2FyZXMu\ncHV0KGNscywgbWV0YSk7CiAgICAgICAgICAgIHJldHVybiBtZXRhOwogICAg\nCX0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIHBlcnNpdGVuY2Ut\nYXdhcmUgY2xhc3MgZnJvbSB0aGUgcmVwb3NpdG9yeQogICAgICogCiAgICAg\nKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZAogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiByZW1vdmVQZXJzaXN0ZW5jZUF3YXJlKENsYXNzIGNscykgewog\nICAgCXJldHVybiBfcGF3YXJlcy5yZW1vdmUoY2xzKSAhPSBudWxsOwogICAg\nfQoKICAgIC8qKgogICAgICogR2V0cyB0aGUgbWV0YWRhdGEgY29ycmVzcG9u\nZGluZyB0byB0aGUgZ2l2ZW4gbm9uLW1hcHBlZCBpbnRlcmZhY2UuCiAgICAg\nKiBSZXR1cm5zIG51bGwsIGlmIHRoZSBnaXZlbiBpbnRlcmZhY2UgaXMgbm90\nIHJlZ2lzdGVyZWQgYXMgCiAgICAgKiBwZXJzaXN0ZW5jZS1hd2FyZS4KICAg\nICAqLwogICAgcHVibGljIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBnZXROb25N\nYXBwZWRJbnRlcmZhY2UoQ2xhc3MgaWZhY2UpIHsKICAgIAlyZXR1cm4gKE5v\nblBlcnNpc3RlbnRNZXRhRGF0YSlfbm9uTWFwcGVkLmdldChpZmFjZSk7CiAg\nICB9CiAgICAKICAgIC8qKgogICAgICogR2V0cyB0aGUgY29ycmVzcG9uZGlu\nZyBtZXRhZGF0YXMgZm9yIGFsbCByZWdpc3RlcmVkLCBub24tbWFwcGVkCiAg\nICAgKiBpbnRlcmZhY2VzCiAgICAgKiAKICAgICAqIEByZXR1cm4gZW1wdHkg\nYXJyYXkgaWYgbm8gbm9uLW1hcHBlZCBpbnRlcmZhY2UgaGFzIGJlZW4gcmVn\naXN0ZXJlZC4KICAgICAqLwogICAgcHVibGljIE5vblBlcnNpc3RlbnRNZXRh\nRGF0YVtdIGdldE5vbk1hcHBlZEludGVyZmFjZXMoKSB7CiAgICAgICAgc3lu\nY2hyb25pemVkIChfbm9uTWFwcGVkKSB7CiAgICAgICAgICAgIGlmIChfbm9u\nTWFwcGVkLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiBFTVBU\nWV9OT05fUEVSU0lTVEVOVDsKICAgICAgICAgICAgcmV0dXJuIChOb25QZXJz\naXN0ZW50TWV0YURhdGFbXSlfbm9uTWFwcGVkLnZhbHVlcygpLnRvQXJyYXkK\nICAgICAgICAgICAgICAgIChuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhW19u\nb25NYXBwZWQuc2l6ZSgpXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIHRoZSBnaXZlbiBub24tbWFwcGVkIGludGVyZmFjZSB0byB0\naGUgcmVwb3NpdG9yeS4KICAgICAqIAogICAgICogQHBhcmFtIGlmYWNlIHRo\nZSBub24tbWFwcGVkIGludGVyZmFjZQogICAgICovCiAgICBwdWJsaWMgTm9u\nUGVyc2lzdGVudE1ldGFEYXRhIGFkZE5vbk1hcHBlZEludGVyZmFjZShDbGFz\ncyBpZmFjZSkgewogICAgCWlmIChpZmFjZSA9PSBudWxsKQogICAgCQlyZXR1\ncm4gbnVsbDsKICAgICAgICBpZiAoIWlmYWNlLmlzSW50ZXJmYWNlKCkpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm90LW5vbi1tYXBwZWQiLCBpZmFjZSkpOwogICAgICAgIHN5bmNocm9u\naXplZCh0aGlzKSB7CiAgICAgICAgICAgIGlmIChfbm9uTWFwcGVkLmNvbnRh\naW5zS2V5KGlmYWNlKSkKICAgICAgICAgICAgICAgIHJldHVybiAoTm9uUGVy\nc2lzdGVudE1ldGFEYXRhKV9ub25NYXBwZWQuZ2V0KGlmYWNlKTsKICAgICAg\nICAgICAgaWYgKGdldENhY2hlZE1ldGFEYXRhKGlmYWNlKSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJub24tbWFwcGVkLXBjIiwgaWZhY2UpKTsKICAgICAgICAgICAg\nTm9uUGVyc2lzdGVudE1ldGFEYXRhIG1ldGEgPSBuZXcgTm9uUGVyc2lzdGVu\ndE1ldGFEYXRhKGlmYWNlLCB0aGlzLAogICAgICAgICAgICAgICAgTm9uUGVy\nc2lzdGVudE1ldGFEYXRhLlRZUEVfTk9OX01BUFBFRF9JTlRFUkZBQ0UpOwog\nICAgICAgICAgICBfbm9uTWFwcGVkLnB1dChpZmFjZSwgbWV0YSk7CiAgICAg\nICAgICAgIHJldHVybiBtZXRhOwogICAgCX0KICAgIH0KCiAgICAvKioKICAg\nICAqIFJlbW92ZSBhIG5vbi1tYXBwZWQgaW50ZXJmYWNlIGZyb20gdGhlIHJl\ncG9zaXRvcnkKICAgICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIHJlbW92\nZWQKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlTm9uTWFwcGVk\nSW50ZXJmYWNlKENsYXNzIGlmYWNlKSB7CiAgICAJcmV0dXJuIF9ub25NYXBw\nZWQucmVtb3ZlKGlmYWNlKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAg\nICogQ2xlYXIgdGhlIGNhY2hlIG9mIHBhcnNlZCBtZXRhZGF0YS4gVGhpcyBt\nZXRob2QgYWxzbyBjbGVhcnMgdGhlCiAgICAgKiBpbnRlcm5hbCB7QGxpbmsg\nTWV0YURhdGFGYWN0b3J5IE1ldGFEYXRhRmFjdG9yeX0ncyBjYWNoZS4KICAg\nICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIGNsZWFyKCkgewog\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nIF9sb2cudHJhY2UoX2xvYy5nZXQoImNsZWFyLXJlcG9zIiwgdGhpcykpOwoK\nICAgICAgICBfbWV0YXMuY2xlYXIoKTsKICAgICAgICBfb2lkcy5jbGVhcigp\nOwogICAgICAgIF9zdWJzLmNsZWFyKCk7CiAgICAgICAgX2ltcGxzLmNsZWFy\nKCk7CiAgICAgICAgX3F1ZXJpZXMuY2xlYXIoKTsKICAgICAgICBfc2Vxcy5j\nbGVhcigpOwogICAgICAgIF9yZWdpc3RlcmVkLmNsZWFyKCk7CiAgICAgICAg\nX2ZhY3RvcnkuY2xlYXIoKTsKICAgICAgICBfYWxpYXNlcy5jbGVhcigpOwog\nICAgICAgIF9wYXdhcmVzLmNsZWFyKCk7CiAgICAgICAgX25vbk1hcHBlZC5j\nbGVhcigpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXQg\nb2YgY29uZmlndXJlZCBwZXJzaXN0ZW50IGNsYXNzZXMsIG9yIG51bGwgaWYg\ndGhlIHVzZXIKICAgICAqIGRpZCBub3QgY29uZmlndXJlIGFueS4KICAgICAq\nCiAgICAgKiBAcGFyYW0gZGV2cGF0aCBpZiB0cnVlLCBzZWFyY2ggZm9yIG1l\ndGFkYXRhIGZpbGVzIGluIGRpcmVjdG9yaWVzCiAgICAgKiBpbiB0aGUgY2xh\nc3NwYXRoIGlmIG5vIGNsYXNzZXMgYXJlIGNvbmZpZ3VyZWQgZXhwbGljaXRs\neQogICAgICogQHBhcmFtIGVudkxvYWRlciB0aGUgY2xhc3MgbG9hZGVyIHRv\nIHVzZSwgb3IgbnVsbCBmb3IgZGVmYXVsdAogICAgICovCiAgICBwdWJsaWMg\nc3luY2hyb25pemVkIFNldCBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGJvb2xl\nYW4gZGV2cGF0aCwKICAgICAgICBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsK\nICAgICAgICByZXR1cm4gX2ZhY3RvcnkuZ2V0UGVyc2lzdGVudFR5cGVOYW1l\ncyhkZXZwYXRoLCBlbnZMb2FkZXIpOwogICAgfQoKICAgIC8qKgogICAgICog\nTG9hZCB0aGUgcGVyc2lzdGVudCBjbGFzc2VzIG5hbWVkIGluIGNvbmZpZ3Vy\nYXRpb24uCiAgICAgKiBUaGlzIGVuc3VyZXMgdGhhdCBhbGwgc3ViY2xhc3Nl\ncyBhbmQgYXBwbGljYXRpb24gaWRlbnRpdHkgY2xhc3NlcyBvZgogICAgICog\nZWFjaCB0eXBlIGFyZSBrbm93biBpbiBhZHZhbmNlLCB3aXRob3V0IGhhdmlu\nZyB0byByZWx5IG9uIHRoZQogICAgICogYXBwbGljYXRpb24gbG9hZGluZyB0\naGUgY2xhc3NlcyBiZWZvcmUgcGVyZm9ybWluZyBvcGVyYXRpb25zIHRoYXQK\nICAgICAqIG1pZ2h0IGludm9sdmUgdGhlbS4KICAgICAqCiAgICAgKiBAcGFy\nYW0gZGV2cGF0aCBpZiB0cnVlLCBzZWFyY2ggZm9yIG1ldGFkYXRhIGZpbGVz\nIGluIGRpcmVjdG9yaWVzCiAgICAgKiBpbiB0aGUgY2xhc3NwYXRoIGlmIHRo\nZSBubyBjbGFzc2VzIGFyZSBjb25maWd1cmVkIGV4cGxpY2l0bHkKICAgICAq\nIEBwYXJhbSBlbnZMb2FkZXIgdGhlIGNsYXNzIGxvYWRlciB0byB1c2UsIG9y\nIG51bGwgZm9yIGRlZmF1bHQKICAgICAqIEByZXR1cm4gdGhlIGxvYWRlZCBj\nbGFzc2VzLCBvciBlbXB0eSBjb2xsZWN0aW9uIGlmIG5vbmUKICAgICAqLwog\nICAgcHVibGljIHN5bmNocm9uaXplZCBDb2xsZWN0aW9uIGxvYWRQZXJzaXN0\nZW50VHlwZXMoYm9vbGVhbiBkZXZwYXRoLAogICAgICAgIENsYXNzTG9hZGVy\nIGVudkxvYWRlcikgewogICAgICAgIFNldCBuYW1lcyA9IGdldFBlcnNpc3Rl\nbnRUeXBlTmFtZXMoZGV2cGF0aCwgZW52TG9hZGVyKTsKICAgICAgICBpZiAo\nbmFtZXMgPT0gbnVsbCB8fCBuYW1lcy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwoKICAgICAgICAvLyBh\ndHRlbXB0IHRvIGxvYWQgY2xhc3NlcyBzbyB0aGF0IHRoZXkgZ2V0IHByb2Nl\nc3NlZAogICAgICAgIENsYXNzTG9hZGVyIGNsc0xvYWRlciA9IF9jb25mLmdl\ndENsYXNzUmVzb2x2ZXJJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRDbGFz\nc0xvYWRlcihnZXRDbGFzcygpLCBlbnZMb2FkZXIpOwogICAgICAgIExpc3Qg\nY2xhc3NlcyA9IG5ldyBBcnJheUxpc3QobmFtZXMuc2l6ZSgpKTsKICAgICAg\nICBDbGFzcyBjbHM7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBuYW1l\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBj\nbHMgPSBjbGFzc0Zvck5hbWUoKFN0cmluZykgaXRyLm5leHQoKSwgY2xzTG9h\nZGVyKTsKICAgICAgICAgICAgaWYgKGNscyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBjbGFzc2VzLmFkZChjbHMpOwoKICAgICAgICAgICAgICAgIC8v\nIGlmIHRoZSBjbGFzcyBpcyBhbiBpbnRlcmZhY2UsIGxvYWQgaXRzIG1ldGFk\nYXRhIHRvIGtpY2sKICAgICAgICAgICAgICAgIC8vIG9mZiB0aGUgaW1wbCBn\nZW5lcmF0b3IKICAgICAgICAgICAgICAgIGlmIChjbHMuaXNJbnRlcmZhY2Uo\nKSkKICAgICAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YShjbHMsIGNsc0xv\nYWRlciwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBjbGFzc2VzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBjbGFzcyBmb3IgdGhlIGdpdmVuIG5hbWUsIG9yIG51bGwgaWYgbm90\nIGxvYWRhYmxlLgogICAgICovCiAgICBwcml2YXRlIENsYXNzIGNsYXNzRm9y\nTmFtZShTdHJpbmcgbmFtZSwgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIENsYXNzLmZvck5hbWUobmFt\nZSwgdHJ1ZSwgbG9hZGVyKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICBpZiAoKF92YWxpZGF0ZSAmIFZBTElEQVRFX1JV\nTlRJTUUpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xv\nYy5nZXQoImJhZC1kaXNjb3Zlci1jbGFzcyIsIG5hbWUpKTsKICAgICAgICAg\nICAgfSBlbHNlIGlmIChfbG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgIF9sb2cuaW5mbyhfbG9jLmdldCgiYmFkLWRpc2NvdmVyLWNsYXNz\nIiwgbmFtZSkpOwogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShlKTsKICAgICAgICB9\nIGNhdGNoIChOb1N1Y2hNZXRob2RFcnJvciBuc21lKSB7CiAgICAgICAgICAg\nIGlmIChuc21lLmdldE1lc3NhZ2UoKS5pbmRleE9mKCIucGMiKSA9PSAtMSkK\nICAgICAgICAgICAgICAgIHRocm93IG5zbWU7CgogICAgICAgICAgICAvLyBp\nZiB0aGUgZXJyb3IgaXMgYWJvdXQgYSBtZXRob2QgdGhhdCB1c2VzIHRoZSBQ\nZXJzaXN0ZW5jZUNhcGFibGUKICAgICAgICAgICAgLy8gJ3BjJyBtZXRob2Qg\ncHJlZml4LCBwZXJmb3JtIHNvbWUgbG9nZ2luZyBhbmQgY29udGludWUuIFRo\naXMKICAgICAgICAgICAgLy8gcHJvYmFibHkganVzdCBtZWFucyB0aGF0IHRo\nZSBjbGFzcyBpcyBub3QgeWV0IGVuaGFuY2VkLgogICAgICAgICAgICBpZiAo\nKF92YWxpZGF0ZSAmIFZBTElEQVRFX1JVTlRJTUUpICE9IDApIHsKICAgICAg\nICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImJhZC1kaXNjb3Zlci1j\nbGFzcyIsIG5hbWUpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfbG9nLmlz\nSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cuaW5mbyhfbG9j\nLmdldCgiYmFkLWRpc2NvdmVyLWNsYXNzIiwgbmFtZSkpOwogICAgICAgICAg\nICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nX2xvZy50cmFjZShuc21lKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGtub3duIHN1\nYmNsYXNzZXMgZm9yIHRoZSBnaXZlbiBjbGFzcyBtYXBwaW5nLiBOb3RlCiAg\nICAgKiB0aGF0IHRoaXMgbWV0aG9kIG9ubHkgd29ya3MgZHVyaW5nIHJ1bnRp\nbWUgd2hlbiB0aGUgcmVwb3NpdG9yeSBpcwogICAgICogcmVnaXN0ZXJlZCBh\ncyBhIHtAbGluayBSZWdpc3RlckNsYXNzTGlzdGVuZXJ9LgogICAgICovCiAg\nICBDb2xsZWN0aW9uIGdldFBDU3ViY2xhc3NlcyhDbGFzcyBjbHMpIHsKICAg\nICAgICBDb2xsZWN0aW9uIHN1YnMgPSAoQ29sbGVjdGlvbikgX3N1YnMuZ2V0\nKGNscyk7CiAgICAgICAgaWYgKHN1YnMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAgcmV0dXJu\nIHN1YnM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwogICAgLy8gUmVnaXN0ZXJDbGFzc0xpc3RlbmVyIGlt\ncGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgcmVnaXN0ZXIoQ2xhc3Mg\nY2xzKSB7CiAgICAgICAgLy8gYnVmZmVyIHJlZ2lzdGVyZWQgY2xhc3NlcyB1\nbnRpbCBhbiBvaWQgbWV0YWRhdGEgcmVxdWVzdCBpcyBtYWRlLAogICAgICAg\nIC8vIGF0IHdoaWNoIHBvaW50IHdlJ2xsIHBhcnNlIGV2ZXJ5dGhpbmcgaW4g\ndGhlIGJ1ZmZlcgogICAgICAgIHN5bmNocm9uaXplZCAoX3JlZ2lzdGVyZWQp\nIHsKICAgICAgICAgICAgX3JlZ2lzdGVyZWQuYWRkKGNscyk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2VzIHRoZSBtZXRhZGF0YSBm\nb3IgYWxsIHJlZ2lzdGVyZWQgY2xhc3Nlcy4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGxvYWRSZWdpc3RlcmVkQ2xhc3NNZXRhRGF0YShDbGFzc0xvYWRl\nciBlbnZMb2FkZXIpIHsKICAgICAgICBDbGFzc1tdIHJlZyA9IHByb2Nlc3NS\nZWdpc3RlcmVkQ2xhc3NlcyhlbnZMb2FkZXIpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgcmVnLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YShyZWdbaV0sIGVudkxv\nYWRlciwgZmFsc2UpOwogICAgICAgICAgICB9IGNhdGNoIChNZXRhRGF0YUV4\nY2VwdGlvbiBtZSkgewogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJu\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihtZSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBVcGRhdGVzIG91ciBkYXRhc3RydWN0dXJlcyB3aXRoIHRoZSBsYXRlc3Qg\ncmVnaXN0ZXJlZCBjbGFzc2VzLgogICAgICovCiAgICBDbGFzc1tdIHByb2Nl\nc3NSZWdpc3RlcmVkQ2xhc3NlcyhDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsK\nICAgICAgICBpZiAoX3JlZ2lzdGVyZWQuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm4gRU1QVFlfQ0xBU1NFUzsKCiAgICAgICAgLy8gY29weSBpbnRv\nIG5ldyBjb2xsZWN0aW9uIHRvIGF2b2lkIGNvbmN1cnJlbnQgbW9kIGVycm9y\ncyBvbiByZWVudHJhbnQKICAgICAgICAvLyByZWdpc3RyYXRpb25zCiAgICAg\nICAgQ2xhc3NbXSByZWc7CiAgICAgICAgc3luY2hyb25pemVkIChfcmVnaXN0\nZXJlZCkgewogICAgICAgICAgICByZWcgPSAoQ2xhc3NbXSkgX3JlZ2lzdGVy\nZWQudG9BcnJheShuZXcgQ2xhc3NbX3JlZ2lzdGVyZWQuc2l6ZSgpXSk7CiAg\nICAgICAgICAgIF9yZWdpc3RlcmVkLmNsZWFyKCk7CiAgICAgICAgfQoKICAg\nICAgICBDb2xsZWN0aW9uIHBjTmFtZXMgPSBnZXRQZXJzaXN0ZW50VHlwZU5h\nbWVzKGZhbHNlLCBlbnZMb2FkZXIpOwogICAgICAgIENvbGxlY3Rpb24gZmFp\nbGVkID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJlZy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBkb24ndCBwcm9jZXNzIHR5\ncGVzIHRoYXQgYXJlbid0IGxpc3RlZCBieSB0aGUgdXNlcjsgbWF5IGJlbG9u\nZwogICAgICAgICAgICAvLyB0byBhIGRpZmZlcmVudCBwZXJzaXN0ZW5jZSB1\nbml0CiAgICAgICAgICAgIGlmIChwY05hbWVzICE9IG51bGwgJiYgIXBjTmFt\nZXMuaXNFbXB0eSgpCiAgICAgICAgICAgICAgICAmJiAhcGNOYW1lcy5jb250\nYWlucyhyZWdbaV0uZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHByb2Nl\nc3NSZWdpc3RlcmVkQ2xhc3MocmVnW2ldKTsKICAgICAgICAgICAgfSBjYXRj\naCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIGlmICghX2NvbmYu\nZ2V0UmV0cnlDbGFzc1JlZ2lzdHJhdGlvbigpKQogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZXJy\nb3ItcmVnaXN0ZXJlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ1tp\nXSksIHQpOwoKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQo\nImZhaWxlZC1yZWdpc3RlcmVkIiwgcmVnW2ldKSwgdCk7CiAgICAgICAgICAg\nICAgICBpZiAoZmFpbGVkID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nZmFpbGVkID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICAgICAgZmFp\nbGVkLmFkZChyZWdbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGlmIChmYWlsZWQgIT0gbnVsbCkgewogICAgICAgICAgICBzeW5jaHJv\nbml6ZWQgKF9yZWdpc3RlcmVkKSB7CiAgICAgICAgICAgICAgICBfcmVnaXN0\nZXJlZC5hZGRBbGwoZmFpbGVkKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gcmVnOwogICAgfQoKICAgIC8qKgogICAgICogVXBk\nYXRlcyBvdXIgZGF0YXN0cnVjdHVyZXMgd2l0aCB0aGUgZ2l2ZW4gcmVnaXN0\nZXJlZCBjbGFzcy4KICAgICAqIFJlbGllcyBvbiB0aGUgZmFjdCB0aGF0IGEg\nY2hpbGQgY2xhc3MgY2Fubm90IHJlZ2lzdGVyIGl0c2VsZiB3aXRob3V0CiAg\nICAgKiBhbHNvIHJlZ2lzdGVyaW5nIGl0cyBwYXJlbnQgY2xhc3MgYnkgc3Bl\nY2lmeWluZyBpdHMgcGVyc2lzdGVuY2UKICAgICAqIGNhcGFibGUgc3VwZXJj\nbGFzcyBpbiB0aGUgcmVnaXN0cmF0aW9uIGV2ZW50LgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgcHJvY2Vzc1JlZ2lzdGVyZWRDbGFzcyhDbGFzcyBjbHMp\nIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwcm9jZXNzLXJlZ2lzdGVyZWQi\nLCBjbHMpKTsKCiAgICAgICAgLy8gdXBkYXRlIHN1YmNsYXNzIGxpc3RzOyBz\neW5jaHJvbml6ZSBvbiB0aGlzIGJlY2F1c2UgYWNjZXNzaW5nIF9tZXRhcwog\nICAgICAgIC8vIHJlcXVpcmVzIGl0CiAgICAgICAgQ2xhc3MgbGVhc3REZXJp\ndmVkID0gY2xzOwogICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAg\nICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGE7CiAgICAgICAgICAgIGZvciAo\nQ2xhc3MgYW5jID0gY2xzOwogICAgICAgICAgICAgICAgKGFuYyA9IFBDUmVn\naXN0cnkuZ2V0UGVyc2lzdGVudFN1cGVyY2xhc3MoYW5jKSkgIT0gbnVsbDsp\nIHsKICAgICAgICAgICAgICAgIGFkZFRvQ29sbGVjdGlvbihfc3VicywgYW5j\nLCBjbHMsIHRydWUpOwogICAgICAgICAgICAgICAgbWV0YSA9IChDbGFzc01l\ndGFEYXRhKSBfbWV0YXMuZ2V0KGFuYyk7CiAgICAgICAgICAgICAgICBpZiAo\nbWV0YSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIG1ldGEuY2xlYXJT\ndWJjbGFzc0NhY2hlKCk7CiAgICAgICAgICAgICAgICBsZWFzdERlcml2ZWQg\nPSBhbmM7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHVw\nZGF0ZSBvaWQgbWFwcGluZ3MgaWYgdGhpcyBpcyBhIGJhc2UgY29uY3JldGUg\nY2xhc3MKICAgICAgICBPYmplY3Qgb2lkID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICBvaWQgPSBQQ1JlZ2lzdHJ5Lm5ld09iamVjdElkKGNs\ncyk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJuYWxFeGNlcHRpb24gaWUpIHsK\nICAgICAgICAgICAgLy8gdGhyb3duIGZvciBzaW5nbGUgZmllbGQgaWRlbnRp\ndHkgd2l0aCBudWxsIHBrIGZpZWxkIHZhbHVlCiAgICAgICAgfQogICAgICAg\nIGlmIChvaWQgIT0gbnVsbCkgewogICAgICAgICAgICBDbGFzcyBleGlzdGlu\nZyA9IChDbGFzcykgX29pZHMuZ2V0KG9pZC5nZXRDbGFzcygpKTsKICAgICAg\nICAgICAgaWYgKGV4aXN0aW5nICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIC8vIGlmIHRoZXJlIGlzIGFscmVhZHkgYSBjbGFzcyBmb3IgdGhpcyBPSUQs\nIHRoZW4gd2Uga25vdwogICAgICAgICAgICAgICAgLy8gdGhhdCBtdWx0aXBs\nZSBjbGFzc2VzIGFyZSB1c2luZyB0aGUgc2FtZSBPSUQ6IHRoZXJlZm9yZSwK\nICAgICAgICAgICAgICAgIC8vIHB1dCB0aGUgbGVhc3QgZGVyaXZlZCBQQyBz\ndXBlcmNsYXNzIGludG8gdGhlIG1hcC4gVGhpcwogICAgICAgICAgICAgICAg\nLy8gZ2V0cyBhcm91bmQgdGhlIHByb2JsZW0gb2YgYW4gYWJzdHJhY3QgUEMg\nc3VwZXJjbGFzcwogICAgICAgICAgICAgICAgLy8gdXNpbmcgYXBwbGljYXRp\nb24gaWRlbnRpdHkgKHNpbmNlIG5ld09iamVjdElkCiAgICAgICAgICAgICAg\nICAvLyB3aWxsIHJldHVybiBudWxsIGZvciBhYnN0cmFjdCBjbGFzc2VzKS4K\nICAgICAgICAgICAgICAgIENsYXNzIHN1cCA9IGNsczsKICAgICAgICAgICAg\nICAgIHdoaWxlIChQQ1JlZ2lzdHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNsYXNz\nKHN1cCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBzdXAgPSBQQ1Jl\nZ2lzdHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNsYXNzKHN1cCk7CgogICAgICAg\nICAgICAgICAgX29pZHMucHV0KG9pZC5nZXRDbGFzcygpLCBzdXApOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKGV4aXN0aW5nID09IG51bGwgfHwgY2xzLmlz\nQXNzaWduYWJsZUZyb20oZXhpc3RpbmcpKQogICAgICAgICAgICAgICAgX29p\nZHMucHV0KG9pZC5nZXRDbGFzcygpLCBjbHMpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gdXBkYXRlIG1hcHBpbmdzIGZyb20gaW50ZXJmYWNlcyBhbmQgbm9u\nLXBjIHN1cGVyY2xhc3NlcyB0bwogICAgICAgIC8vIHBjIGltcGxlbWVudGlu\nZyB0eXBlcwogICAgICAgIHN5bmNocm9uaXplZCAoX2ltcGxzKSB7CiAgICAg\nICAgICAgIHVwZGF0ZUltcGxzKGNscywgbGVhc3REZXJpdmVkLCBjbHMpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gc2V0IGFsaWFzIGZvciBjbGFzcwogICAg\nICAgIFN0cmluZyBhbGlhcyA9IFBDUmVnaXN0cnkuZ2V0VHlwZUFsaWFzKGNs\ncyk7CiAgICAgICAgaWYgKGFsaWFzICE9IG51bGwpIHsKICAgICAgICAgICAg\nc3luY2hyb25pemVkIChfYWxpYXNlcykgewogICAgICAgICAgICAgICAgTGlz\ndCBjbGFzc0xpc3QgPSAoTGlzdCkgX2FsaWFzZXMuZ2V0KGFsaWFzKTsKICAg\nICAgICAgICAgICAgIGlmIChjbGFzc0xpc3QgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIGNsYXNzTGlzdCA9IG5ldyBBcnJheUxpc3QoMyk7CiAg\nICAgICAgICAgICAgICAgICAgX2FsaWFzZXMucHV0KGFsaWFzLCBjbGFzc0xp\nc3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFj\nbGFzc0xpc3QuY29udGFpbnMoY2xzKSkKICAgICAgICAgICAgICAgICAgICBj\nbGFzc0xpc3QuYWRkKGNscyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGxpc3Qgb2YgaW1wbGVt\nZW50YXRpb25zIG9mIGJhc2UgY2xhc3NlcyBhbmQgaW50ZXJmYWNlcy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUltcGxzKENsYXNzIGNscywg\nQ2xhc3MgbGVhc3REZXJpdmVkLCBDbGFzcyBjaGVjaykgewogICAgICAgIC8v\nIGFsbG93IHVzZXJzIHRvIHF1ZXJ5IG9uIGNvbW1vbiBub24tcGMgc3VwZXJj\nbGFzc2VzCiAgICAgICAgQ2xhc3Mgc3VwID0gY2hlY2suZ2V0U3VwZXJjbGFz\ncygpOwogICAgICAgIGlmIChsZWFzdERlcml2ZWQgPT0gY2xzICYmIHN1cCAh\nPSBudWxsICYmIHN1cCAhPSBPYmplY3QuY2xhc3MpIHsKICAgICAgICAgICAg\nYWRkVG9Db2xsZWN0aW9uKF9pbXBscywgc3VwLCBjbHMsIGZhbHNlKTsKICAg\nICAgICAgICAgdXBkYXRlSW1wbHMoY2xzLCBsZWFzdERlcml2ZWQsIHN1cCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBhbGxvdyB1c2VycyB0byBxdWVyeSBv\nbiBhbnkgaW1wbGVtZW50ZWQgaW50ZXJmYWNlcyB1bmxlc3MgZGVmYXVsdHMg\nCiAgICAgICAgLy8gc2F5IHRoZSB1c2VyIG11c3QgaW1wbGVtZW50IHBlcnNp\nc3RlbnQgaW50ZXJmYWNlcyBleHBsaWNpdGx5IGluIG1ldGEKICAgICAgICBp\nZiAoIV9mYWN0b3J5LmdldERlZmF1bHRzKCkuaXNEZWNsYXJlZEludGVyZmFj\nZVBlcnNpc3RlbnQoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIENs\nYXNzW10gaW50cyA9IGNoZWNrLmdldEludGVyZmFjZXMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGludHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgLy8gZG9uJ3QgbWFwIGphdmEtc3RhbmRhcmQgaW50ZXJmYWNlcwog\nICAgICAgICAgICBpZiAoaW50c1tpXS5nZXROYW1lKCkuc3RhcnRzV2l0aCgi\namF2YS4iKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgLy8gb25seSBtYXAgbGVhc3QtZGVyaXZlZCBpbnRlcmZhY2UgaW1wbGVt\nZW50b3JzCiAgICAgICAgICAgIGlmIChsZWFzdERlcml2ZWQgPT0gY2xzIHx8\nIGlzTGVhc3REZXJpdmVkSW1wbChpbnRzW2ldLCBjbHMpKSB7CiAgICAgICAg\nICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX2ltcGxzLCBpbnRzW2ldLCBjbHMs\nIGZhbHNlKTsKICAgICAgICAgICAgICAgIHVwZGF0ZUltcGxzKGNscywgbGVh\nc3REZXJpdmVkLCBpbnRzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZl\nbiBjbGFzcyBpcyB0aGUgbGVhc3QtZGVyaXZlZCBwZXJzaXN0ZW50CiAgICAg\nKiBpbXBsZW1lbnRvciBvZiB0aGUgZ2l2ZW4gaW50ZXJmYWNlLCBmYWxzZSBv\ndGhlcndpc2UuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0xlYXN0\nRGVyaXZlZEltcGwoQ2xhc3MgaW50ZXIsIENsYXNzIGNscykgewogICAgICAg\nIENsYXNzIHBhcmVudCA9IFBDUmVnaXN0cnkuZ2V0UGVyc2lzdGVudFN1cGVy\nY2xhc3MoY2xzKTsKICAgICAgICB3aGlsZSAocGFyZW50ICE9IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKEFycmF5cy5hc0xpc3QocGFyZW50LmdldEludGVy\nZmFjZXMoKSkuY29udGFpbnMoaW50ZXIpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgICAgICBwYXJlbnQgPSBQQ1JlZ2lzdHJ5Lmdl\ndFBlcnNpc3RlbnRTdXBlcmNsYXNzKHBhcmVudCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRo\nZSBnaXZlbiB2YWx1ZSB0byB0aGUgY29sbGVjdGlvbiBjYWNoZWQgaW4gdGhl\nIGdpdmVuIG1hcCB1bmRlcgogICAgICogdGhlIGdpdmVuIGtleS4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZFRvQ29sbGVjdGlvbihNYXAgbWFwLCBD\nbGFzcyBrZXksIENsYXNzIHZhbHVlLAogICAgICAgIGJvb2xlYW4gaW5oZXJp\ndGFuY2UpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKG1hcCkgewogICAgICAg\nICAgICBDb2xsZWN0aW9uIGNvbGwgPSAoQ29sbGVjdGlvbikgbWFwLmdldChr\nZXkpOwogICAgICAgICAgICBpZiAoY29sbCA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBpZiAoaW5oZXJpdGFuY2UpIHsKICAgICAgICAgICAgICAgICAg\nICBJbmhlcml0YW5jZUNvbXBhcmF0b3IgY29tcCA9IG5ldyBJbmhlcml0YW5j\nZUNvbXBhcmF0b3IoKTsKICAgICAgICAgICAgICAgICAgICBjb21wLnNldEJh\nc2Uoa2V5KTsKICAgICAgICAgICAgICAgICAgICBjb2xsID0gbmV3IFRyZWVT\nZXQoY29tcCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nICAgICAgICBjb2xsID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICAgICAg\nICAgIG1hcC5wdXQoa2V5LCBjb2xsKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBjb2xsLmFkZCh2YWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbmZpZ3Vy\nYWJsZSBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHNldENvbmZpZ3VyYXRpb24o\nQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAgX2NvbmYgPSAoT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24pIGNvbmY7CiAgICAgICAgX2xvZyA9IF9jb25mLmdl\ndExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfTUVUQURBVEEpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0Q29uZmlndXJhdGlvbigpIHsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAg\nICAgIGluaXRpYWxpemVNZXRhRGF0YUZhY3RvcnkoKTsKICAgICAgICBpZiAo\nX2ltcGxHZW4gPT0gbnVsbCkKICAgICAgICAgICAgX2ltcGxHZW4gPSBuZXcg\nSW50ZXJmYWNlSW1wbEdlbmVyYXRvcih0aGlzKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgaW5pdGlhbGl6ZU1ldGFEYXRhRmFjdG9yeSgpIHsKICAgICAg\nICBpZiAoX2ZhY3RvcnkgPT0gbnVsbCkgewogICAgICAgICAgICBNZXRhRGF0\nYUZhY3RvcnkgbWRmID0gX2NvbmYubmV3TWV0YURhdGFGYWN0b3J5SW5zdGFu\nY2UoKTsKICAgICAgICAgICAgaWYgKG1kZiA9PSBudWxsKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1tZXRhZGF0YWZhY3RvcnkiKSk7CiAgICAgICAgICAgIHNldE1ldGFEYXRh\nRmFjdG9yeShtZGYpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIFF1ZXJ5IG1ldGFkYXRhCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJldHVybiBxdWVyeSBtZXRhZGF0\nYSBmb3IgdGhlIGdpdmVuIGNsYXNzLCBuYW1lLCBhbmQgY2xhc3Nsb2FkZXIu\nCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgUXVlcnlNZXRhRGF0\nYSBnZXRRdWVyeU1ldGFEYXRhKENsYXNzIGNscywgU3RyaW5nIG5hbWUsCiAg\nICAgICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlz\ndCkgewogICAgICAgIFF1ZXJ5TWV0YURhdGEgbWV0YSA9IGdldFF1ZXJ5TWV0\nYURhdGFJbnRlcm5hbChjbHMsIG5hbWUsIGVudkxvYWRlcik7CiAgICAgICAg\naWYgKG1ldGEgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBsb2FkIGFsbCB0\naGUgbWV0YWRhdGFzIGZvciBhbGwgdGhlIGtub3duIGNsYXNzZXMgc28gdGhh\ndAogICAgICAgICAgICAvLyBxdWVyeSBuYW1lcyBhcmUgc2VlbiBhbmQgcmVn\naXN0ZXJlZAogICAgICAgICAgICByZXNvbHZlQWxsKGVudkxvYWRlcik7CiAg\nICAgICAgICAgIG1ldGEgPSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwoY2xz\nLCBuYW1lLCBlbnZMb2FkZXIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1l\ndGEgPT0gbnVsbCAmJiBtdXN0RXhpc3QpIHsKICAgICAgICAgICAgaWYgKGNs\ncyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAoIm5v\nLW5hbWVkLXF1ZXJ5LW51bGwtY2xhc3MiLCAKICAgICAgICAgICAgICAgICAg\nICAgICAgZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhmYWxzZSwgZW52TG9hZGVy\nKSwgbmFtZSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1u\nYW1lZC1xdWVyeSIsCiAgICAgICAgICAgICAgICAgICAgY2xzLCBuYW1lKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBtZXRh\nOwogICAgfQoKICAgIC8qKiAKICAgICAqIFJlc29sdmUgYWxsIGtub3duIG1l\ndGFkYXRhIGNsYXNzZXMuIAogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVz\nb2x2ZUFsbChDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBDb2xs\nZWN0aW9uIHR5cGVzID0gbG9hZFBlcnNpc3RlbnRUeXBlcyhmYWxzZSwgZW52\nTG9hZGVyKTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGkgPSB0eXBlcy5pdGVy\nYXRvcigpOyBpLmhhc05leHQoKTsgKSB7CiAgICAgICAgICAgIENsYXNzIGMg\nPSAoQ2xhc3MpIGkubmV4dCgpOwogICAgICAgICAgICBnZXRNZXRhRGF0YShj\nLCBlbnZMb2FkZXIsIGZhbHNlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gcXVlcnkgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBj\nbGFzcywgbmFtZSwgYW5kIGNsYXNzbG9hZGVyLgogICAgICovCiAgICBwcml2\nYXRlIFF1ZXJ5TWV0YURhdGEgZ2V0UXVlcnlNZXRhRGF0YUludGVybmFsKENs\nYXNzIGNscywgU3RyaW5nIG5hbWUsCiAgICAgICAgQ2xhc3NMb2FkZXIgZW52\nTG9hZGVyKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGNoZWNrIGNhY2hlCiAgICAg\nICAgT2JqZWN0IGtleSA9IGdldFF1ZXJ5S2V5KGNscywgbmFtZSk7CiAgICAg\nICAgUXVlcnlNZXRhRGF0YSBxbSA9IChRdWVyeU1ldGFEYXRhKSBfcXVlcmll\ncy5nZXQoa2V5KTsKICAgICAgICBpZiAocW0gIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIHFtOwoKICAgICAgICAvLyBnZXQgbWV0YWRhdGEgZm9yIGNs\nYXNzLCB3aGljaCB3aWxsIGZpbmQgcXVlcmllcyBpbiBtZXRhZGF0YSBmaWxl\nCiAgICAgICAgaWYgKGNscyAhPSBudWxsICYmIGdldE1ldGFEYXRhKGNscywg\nZW52TG9hZGVyLCBmYWxzZSkgIT0gbnVsbCkgewogICAgICAgICAgICBxbSA9\nIChRdWVyeU1ldGFEYXRhKSBfcXVlcmllcy5nZXQoa2V5KTsKICAgICAgICAg\nICAgaWYgKHFtICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gcW07\nCiAgICAgICAgfQogICAgICAgIGlmICgoX3NvdXJjZU1vZGUgJiBNT0RFX1FV\nRVJZKSA9PSAwKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nLy8gc2VlIGlmIGZhY3RvcnkgY2FuIGZpZ3VyZSBvdXQgYSBzY29wZSBmb3Ig\ndGhpcyBxdWVyeQogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAg\nICAgY2xzID0gX2ZhY3RvcnkuZ2V0UXVlcnlTY29wZShuYW1lLCBlbnZMb2Fk\nZXIpOwoKICAgICAgICAvLyBub3QgaW4gY2FjaGU7IGxvYWQKICAgICAgICBf\nZmFjdG9yeS5sb2FkKGNscywgTU9ERV9RVUVSWSwgZW52TG9hZGVyKTsKICAg\nICAgICByZXR1cm4gKFF1ZXJ5TWV0YURhdGEpIF9xdWVyaWVzLmdldChrZXkp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjYWNoZWQgcXVl\ncnkgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQg\nUXVlcnlNZXRhRGF0YVtdIGdldFF1ZXJ5TWV0YURhdGFzKCkgewogICAgICAg\nIHJldHVybiAoUXVlcnlNZXRhRGF0YVtdKSBfcXVlcmllcy52YWx1ZXMoKS50\nb0FycmF5CiAgICAgICAgICAgIChuZXcgUXVlcnlNZXRhRGF0YVtfcXVlcmll\ncy5zaXplKCldKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nY2FjaGVkIHF1ZXJ5IG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gbmFtZS4KICAg\nICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBRdWVyeU1ldGFEYXRhIGdl\ndENhY2hlZFF1ZXJ5TWV0YURhdGEoQ2xhc3MgY2xzLAogICAgICAgIFN0cmlu\nZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIChRdWVyeU1ldGFEYXRhKSBfcXVl\ncmllcy5nZXQoZ2V0UXVlcnlLZXkoY2xzLCBuYW1lKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgYSBuZXcgcXVlcnkgbWV0YWRhdGEgdG8gdGhlIHJl\ncG9zaXRvcnkgYW5kIHJldHVybiBpdC4KICAgICAqLwogICAgcHVibGljIHN5\nbmNocm9uaXplZCBRdWVyeU1ldGFEYXRhIGFkZFF1ZXJ5TWV0YURhdGEoQ2xh\nc3MgY2xzLCBTdHJpbmcgbmFtZSkgewogICAgICAgIFF1ZXJ5TWV0YURhdGEg\nbWV0YSA9IG5ld1F1ZXJ5TWV0YURhdGEoY2xzLCBuYW1lKTsKICAgICAgICBf\ncXVlcmllcy5wdXQoZ2V0UXVlcnlLZXkobWV0YSksIG1ldGEpOwogICAgICAg\nIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEg\nbmV3IHF1ZXJ5IG1ldGFkYXRhIGluc3RhbmNlLgogICAgICovCiAgICBwcm90\nZWN0ZWQgUXVlcnlNZXRhRGF0YSBuZXdRdWVyeU1ldGFEYXRhKENsYXNzIGNs\ncywgU3RyaW5nIG5hbWUpIHsKICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGEg\nPSBuZXcgUXVlcnlNZXRhRGF0YShuYW1lKTsKICAgICAgICBtZXRhLnNldERl\nZmluaW5nVHlwZShjbHMpOwogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBxdWVyeSBtZXRhZGF0\nYSBmcm9tIHRoZSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgc3lu\nY2hyb25pemVkIGJvb2xlYW4gcmVtb3ZlUXVlcnlNZXRhRGF0YShRdWVyeU1l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9xdWVyaWVz\nLnJlbW92ZShnZXRRdWVyeUtleShtZXRhKSkgIT0gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlbW92ZSBxdWVyeSBtZXRhZGF0YSBmb3IgdGhlIGdp\ndmVuIGNsYXNzIG5hbWUgaWYgaW4gdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8K\nICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgYm9vbGVhbiByZW1vdmVRdWVyeU1l\ndGFEYXRhKENsYXNzIGNscywgU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAo\nbmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgcmV0dXJuIF9xdWVyaWVzLnJlbW92ZShnZXRRdWVyeUtleShjbHMsIG5h\nbWUpKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\ndW5pcXVlIGtleSBmb3IgYSBnaXZlbiBRdWVyeU1ldGFEYXRhLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3QgZ2V0UXVlcnlLZXkoUXVlcnlN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGdldFF1ZXJ5\nS2V5KG1ldGEuZ2V0RGVmaW5pbmdUeXBlKCksIG1ldGEuZ2V0TmFtZSgpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHVuaXF1ZSBrZXkgZm9y\nIGEgZ2l2ZW4gY2xhc3MgLyBuYW1lLiBUaGUgY2xhc3MKICAgICAqIGFyZ3Vt\nZW50IGNhbiBiZSBudWxsLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGlj\nIE9iamVjdCBnZXRRdWVyeUtleShDbGFzcyBjbHMsIFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbmFtZTsKICAgICAgICBRdWVyeUtleSBrZXkgPSBuZXcgUXVlcnlLZXkoKTsK\nICAgICAgICBrZXkuY2xzTmFtZSA9IGNscy5nZXROYW1lKCk7CiAgICAgICAg\na2V5Lm5hbWUgPSBuYW1lOwogICAgICAgIHJldHVybiBrZXk7CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTZXF1ZW5jZSBtZXRh\nZGF0YQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gc2VxdWVuY2UgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBuYW1l\nIGFuZCBjbGFzc2xvYWRlci4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9u\naXplZCBTZXF1ZW5jZU1ldGFEYXRhIGdldFNlcXVlbmNlTWV0YURhdGEoU3Ry\naW5nIG5hbWUsCiAgICAgICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29s\nZWFuIG11c3RFeGlzdCkgewogICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0\nYSA9IGdldFNlcXVlbmNlTWV0YURhdGFJbnRlcm5hbChuYW1lLCBlbnZMb2Fk\nZXIpOwogICAgICAgIGlmIChtZXRhID09IG51bGwgJiYgU2VxdWVuY2VNZXRh\nRGF0YS5OQU1FX1NZU1RFTS5lcXVhbHMobmFtZSkpIHsKICAgICAgICAgICAg\naWYgKF9zeXNTZXEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zeXNTZXEg\nPSBuZXdTZXF1ZW5jZU1ldGFEYXRhKG5hbWUpOwogICAgICAgICAgICByZXR1\ncm4gX3N5c1NlcTsKICAgICAgICB9CiAgICAgICAgaWYgKG1ldGEgPT0gbnVs\nbCAmJiBtdXN0RXhpc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbmFtZWQtc2VxdWVuY2UiLCBuYW1l\nKSk7CiAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBVc2VkIGludGVybmFsbHkgYnkgbWV0YWRhdGEgdG8gcmV0cmlldmUgc2Vx\ndWVuY2UgbWV0YWRhdGFzIGJhc2VkIG9uCiAgICAgKiBwb3NzaWJseS11bnF1\nYWxpZmllZCBzZXF1ZW5jZSBuYW1lLgogICAgICovCiAgICBTZXF1ZW5jZU1l\ndGFEYXRhIGdldFNlcXVlbmNlTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBjb250\nZXh0LCBTdHJpbmcgbmFtZSwKICAgICAgICBib29sZWFuIG11c3RFeGlzdCkg\newogICAgICAgIC8vIHRyeSB3aXRoIGdpdmVuIG5hbWUKICAgICAgICBNZXRh\nRGF0YUV4Y2VwdGlvbiBlID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBTZXF1ZW5jZU1ldGFEYXRhIHNlcSA9IGdldFNlcXVlbmNlTWV0YURh\ndGEobmFtZSwKICAgICAgICAgICAgICAgIGNvbnRleHQuZ2V0RW52Q2xhc3NM\nb2FkZXIoKSwgbXVzdEV4aXN0KTsKICAgICAgICAgICAgaWYgKHNlcSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHNlcTsKICAgICAgICB9IGNh\ndGNoIChNZXRhRGF0YUV4Y2VwdGlvbiBtZGUpIHsKICAgICAgICAgICAgZSA9\nIG1kZTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIGdpdmVuIG5hbWUgYWxy\nZWFkeSBmdWxseSBxdWFsaWZpZWQsIGdpdmUgdXAKICAgICAgICBpZiAobmFt\nZS5pbmRleE9mKCcuJykgIT0gLTEpIHsKICAgICAgICAgICAgaWYgKGUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gdHJ5IHdpdGggcXVh\nbGlmaWVkIG5hbWUKICAgICAgICBuYW1lID0gU3RyaW5ncy5nZXRQYWNrYWdl\nTmFtZShjb250ZXh0LmdldERlc2NyaWJlZFR5cGUoKSkKICAgICAgICAgICAg\nKyAiLiIgKyBuYW1lOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVy\nbiBnZXRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUsIGNvbnRleHQuZ2V0RW52Q2xh\nc3NMb2FkZXIoKSwKICAgICAgICAgICAgICAgIG11c3RFeGlzdCk7CiAgICAg\nICAgfSBjYXRjaCAoTWV0YURhdGFFeGNlcHRpb24gbWRlKSB7CiAgICAgICAg\nICAgIC8vIHRocm93IG9yaWdpbmFsIGV4Y2VwdGlvbgogICAgICAgICAgICBp\nZiAoZSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAg\nICAgICAgdGhyb3cgbWRlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBzZXF1ZW5jZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIG5h\nbWUgYW5kIGNsYXNzbG9hZGVyLgogICAgICovCiAgICBwcml2YXRlIFNlcXVl\nbmNlTWV0YURhdGEgZ2V0U2VxdWVuY2VNZXRhRGF0YUludGVybmFsKFN0cmlu\nZyBuYW1lLAogICAgICAgIENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAg\nICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICAvLyBjaGVjayBjYWNoZQogICAgICAgIFNlcXVlbmNlTWV0\nYURhdGEgbWV0YSA9IChTZXF1ZW5jZU1ldGFEYXRhKSBfc2Vxcy5nZXQobmFt\nZSk7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkgewogICAgICAgICAgICAv\nLyBsb2FkIG1ldGFkYXRhIGZvciByZWdpc3RlcmVkIGNsYXNzZXMgdG8gaG9w\nZWZ1bGx5IGZpbmQgc2VxdWVuY2UKICAgICAgICAgICAgLy8gZGVmaW5pdGlv\nbgogICAgICAgICAgICBsb2FkUmVnaXN0ZXJlZENsYXNzTWV0YURhdGEoZW52\nTG9hZGVyKTsKICAgICAgICAgICAgbWV0YSA9IChTZXF1ZW5jZU1ldGFEYXRh\nKSBfc2Vxcy5nZXQobmFtZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBt\nZXRhOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjYWNoZWQg\nc2VxdWVuY2UgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJv\nbml6ZWQgU2VxdWVuY2VNZXRhRGF0YVtdIGdldFNlcXVlbmNlTWV0YURhdGFz\nKCkgewogICAgICAgIHJldHVybiAoU2VxdWVuY2VNZXRhRGF0YVtdKSBfc2Vx\ncy52YWx1ZXMoKS50b0FycmF5CiAgICAgICAgICAgIChuZXcgU2VxdWVuY2VN\nZXRhRGF0YVtfc2Vxcy5zaXplKCldKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgY2FjaGVkIGEgc2VxdWVuY2UgbWV0YWRhdGEgZm9yIHRo\nZSBnaXZlbiBuYW1lLgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVk\nIFNlcXVlbmNlTWV0YURhdGEgZ2V0Q2FjaGVkU2VxdWVuY2VNZXRhRGF0YSgK\nICAgICAgICBTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVybiAoU2VxdWVu\nY2VNZXRhRGF0YSkgX3NlcXMuZ2V0KG5hbWUpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIGEgbmV3IHNlcXVlbmNlIG1ldGFkYXRhIHRvIHRoZSByZXBv\nc2l0b3J5IGFuZCByZXR1cm4gaXQuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5j\naHJvbml6ZWQgU2VxdWVuY2VNZXRhRGF0YSBhZGRTZXF1ZW5jZU1ldGFEYXRh\nKFN0cmluZyBuYW1lKSB7CiAgICAgICAgU2VxdWVuY2VNZXRhRGF0YSBtZXRh\nID0gbmV3U2VxdWVuY2VNZXRhRGF0YShuYW1lKTsKICAgICAgICBfc2Vxcy5w\ndXQobmFtZSwgbWV0YSk7CiAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc2VxdWVuY2UgbWV0YWRhdGEg\naW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTZXF1ZW5jZU1ldGFE\nYXRhIG5ld1NlcXVlbmNlTWV0YURhdGEoU3RyaW5nIG5hbWUpIHsKICAgICAg\nICByZXR1cm4gbmV3IFNlcXVlbmNlTWV0YURhdGEobmFtZSwgdGhpcyk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIHNlcXVlbmNl\nIG1ldGFkYXRhIGZyb20gdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1\nYmxpYyBzeW5jaHJvbml6ZWQgYm9vbGVhbiByZW1vdmVTZXF1ZW5jZU1ldGFE\nYXRhKFNlcXVlbmNlTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRh\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBy\nZXR1cm4gX3NlcXMucmVtb3ZlKG1ldGEuZ2V0TmFtZSgpKSAhPSBudWxsOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHNlcXVlbmNlIG1ldGFkYXRh\nIGZvciB0aGUgbmFtZSBpZiBpbiB0aGUgcmVwb3NpdG9yeS4KICAgICAqLwog\nICAgcHVibGljIHN5bmNocm9uaXplZCBib29sZWFuIHJlbW92ZVNlcXVlbmNl\nTWV0YURhdGEoU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAobmFtZSA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJu\nIF9zZXFzLnJlbW92ZShuYW1lKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIHRoZSBnaXZlbiBzeXN0ZW0gbGlmZWN5Y2xlIGxpc3RlbmVy\nLgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgYWRkU3lz\ndGVtTGlzdGVuZXIoT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAgICAgLy8gY29w\neSB0byBhdm9pZCBpc3N1ZXMgd2l0aCBMaXN0ZW5lckxpc3QgYW5kIGF2b2lk\nIHVubmNlc3NhcnkKICAgICAgICAvLyBsb2NraW5nIG9uIHRoZSBsaXN0IGR1\ncmluZyBydW50aW1lCiAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxp\nc3RlbmVyTGlzdCBsaXN0ZW5lcnMgPSBuZXcKICAgICAgICAgICAgTGlmZWN5\nY2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdChfbGlzdGVuZXJzKTsKICAg\nICAgICBsaXN0ZW5lcnMuYWRkKGxpc3RlbmVyKTsKICAgICAgICBfbGlzdGVu\nZXJzID0gbGlzdGVuZXJzOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3Zl\nIHRoZSBnaXZlbiBzeXN0ZW0gbGlmZWN5Y2xlIGxpc3RlbmVyLgogICAgICov\nCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGJvb2xlYW4gcmVtb3ZlU3lzdGVt\nTGlzdGVuZXIoT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAgICAgaWYgKCFfbGlz\ndGVuZXJzLmNvbnRhaW5zKGxpc3RlbmVyKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICAvLyBjb3B5IHRvIGF2b2lkIGlzc3VlcyB3aXRo\nIExpc3RlbmVyTGlzdCBhbmQgYXZvaWQgdW5uY2Vzc2FyeQogICAgICAgIC8v\nIGxvY2tpbmcgb24gdGhlIGxpc3QgZHVyaW5nIHJ1bnRpbWUKICAgICAgICBM\naWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0IGxpc3RlbmVycyA9\nIG5ldwogICAgICAgICAgICBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVu\nZXJMaXN0KF9saXN0ZW5lcnMpOwogICAgICAgIGxpc3RlbmVycy5yZW1vdmUo\nbGlzdGVuZXIpOwogICAgICAgIF9saXN0ZW5lcnMgPSBsaXN0ZW5lcnM7CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHN5c3RlbSBsaWZlY3ljbGUgbGlzdGVuZXJzCiAgICAgKi8KICAg\nIHB1YmxpYyBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0IGdl\ndFN5c3RlbUxpc3RlbmVycygpIHsKICAgICAgICByZXR1cm4gX2xpc3RlbmVy\nczsKICAgIH0KCiAgICAvKioKICAgICAqIEZyZWUgdGhlIHJlc291cmNlcyB1\nc2VkIGJ5IHRoaXMgcmVwb3NpdG9yeS4gQ2xvc2VzIGFsbCB1c2VyIHNlcXVl\nbmNlcy4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIGNs\nb3NlKCkgewogICAgICAgIFNlcXVlbmNlTWV0YURhdGFbXSBzbWRzID0gZ2V0\nU2VxdWVuY2VNZXRhRGF0YXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHNtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHNtZHNbaV0uY2xv\nc2UoKTsKICAgICAgICBjbGVhcigpOwogICAgfQoKICAgIC8qKgogICAgICog\nUXVlcnkga2V5IHN0cnVjdC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nY2xhc3MgUXVlcnlLZXkKICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJs\nZSB7CgogICAgICAgIHB1YmxpYyBTdHJpbmcgY2xzTmFtZTsKICAgICAgICBw\ndWJsaWMgU3RyaW5nIG5hbWU7CgogICAgICAgIHB1YmxpYyBpbnQgaGFzaENv\nZGUoKSB7CiAgICAgICAgICAgIGludCBjbHNIYXNoID0gKGNsc05hbWUgPT0g\nbnVsbCkgPyAwIDogY2xzTmFtZS5oYXNoQ29kZSgpOwogICAgICAgICAgICBp\nbnQgbmFtZUhhc2ggPSAobmFtZSA9PSBudWxsKSA/IDAgOiBuYW1lLmhhc2hD\nb2RlKCk7CiAgICAgICAgICAgIHJldHVybiBjbHNIYXNoICsgbmFtZUhhc2g7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2Jq\nZWN0IG9iaikKCQl7CgkJCWlmIChvYmogPT0gdGhpcykKCQkJCXJldHVybiB0\ncnVlOwoJCQlpZiAoIShvYmogaW5zdGFuY2VvZiBRdWVyeUtleSkpCgkJCQly\nZXR1cm4gZmFsc2U7CgkJCgkJCVF1ZXJ5S2V5IHFrID0gKFF1ZXJ5S2V5KSBv\nYmo7CgkJCXJldHVybiBTdHJpbmdVdGlscy5lcXVhbHMgKGNsc05hbWUsIHFr\nLmNsc05hbWUpCgkJCQkmJiBTdHJpbmdVdGlscy5lcXVhbHMgKG5hbWUsIHFr\nLm5hbWUpOwkKCQl9Cgl9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIFhN\nTCBtZXRhZGF0YSBmb3IgYSBnaXZlbiBmaWVsZCBtZXRhZGF0YQogICAgICog\nQHBhcmFtIGZtZAogICAgICogQHJldHVybiBYTUwgbWV0YWRhdGEKICAgICAq\nLwogICAgcHVibGljIHN5bmNocm9uaXplZCBYTUxNZXRhRGF0YSBnZXRYTUxN\nZXRhRGF0YShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIENsYXNzIGNs\ncyA9IGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAvLyBjaGVjayBp\nZiBjYWNoZWQgYmVmb3JlCiAgICAgICAgWE1MTWV0YURhdGEgeG1sbWV0YSA9\nIChYTUxDbGFzc01ldGFEYXRhKSBfeG1sbWV0YXMuZ2V0KGNscyk7CiAgICAg\nICAgaWYgKHhtbG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHht\nbG1ldGE7CiAgICAgICAgCiAgICAgICAgLy8gbG9hZCBKQVhCIFhNTCBtZXRh\nZGF0YQogICAgICAgIF9mYWN0b3J5LmxvYWRYTUxNZXRhRGF0YShmbWQpOwog\nICAgICAgIAogICAgICAgIHhtbG1ldGEgPSAoWE1MQ2xhc3NNZXRhRGF0YSkg\nX3htbG1ldGFzLmdldChjbHMpOwoKICAgICAgICByZXR1cm4geG1sbWV0YTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBtZXRhZGF0YSwg\ncG9wdWxhdGUgaXQgd2l0aCBkZWZhdWx0IGluZm9ybWF0aW9uLCBhZGQgaXQg\ndG8KICAgICAqIHRoZSByZXBvc2l0b3J5LCBhbmQgcmV0dXJuIGl0LgogICAg\nICoKICAgICAqIEBwYXJhbSBhY2Nlc3MgdGhlIGFjY2VzcyB0eXBlIHRvIHVz\nZSBpbiBwb3B1bGF0aW5nIG1ldGFkYXRhCiAgICAgKi8KICAgIHB1YmxpYyBY\nTUxDbGFzc01ldGFEYXRhIGFkZFhNTE1ldGFEYXRhKENsYXNzIHR5cGUsIFN0\ncmluZyBuYW1lKSB7CiAgICAgICAgWE1MQ2xhc3NNZXRhRGF0YSBtZXRhID0g\nbmV3WE1MQ2xhc3NNZXRhRGF0YSh0eXBlLCBuYW1lKTsKICAgICAgICAKICAg\nICAgICAvLyBzeW5jaHJvbml6ZSBvbiB0aGlzIHJhdGhlciB0aGFuIHRoZSBt\nYXAsIGJlY2F1c2UgYWxsIG90aGVyIG1ldGhvZHMKICAgICAgICAvLyB0aGF0\nIGFjY2VzcyBfeG1sbWV0YXMgYXJlIHN5bmNocm9uaXplZCBvbiB0aGlzCiAg\nICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIF94bWxt\nZXRhcy5wdXQodHlwZSwgbWV0YSk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjYWNo\nZWQgWE1MQ2xhc3NNZXRhRGF0YSBmb3IgdGhlIGdpdmVuIGNsYXNzCiAgICAg\nKiBSZXR1cm4gbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgWE1M\nTWV0YURhdGEgZ2V0Q2FjaGVkWE1MTWV0YURhdGEoQ2xhc3MgY2xzKSB7CiAg\nICAgICAgcmV0dXJuIChYTUxNZXRhRGF0YSkgX3htbG1ldGFzLmdldChjbHMp\nOwogICAgfQogICAgCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB4bWwg\nY2xhc3MgbWV0YWRhdGEKICAgICAqIEBwYXJhbSB0eXBlCiAgICAgKiBAcGFy\nYW0gbmFtZQogICAgICogQHJldHVybiBhIFhNTENsYXNzTWV0YURhdGEKICAg\nICAqLwogICAgcHJvdGVjdGVkIFhNTENsYXNzTWV0YURhdGEgbmV3WE1MQ2xh\nc3NNZXRhRGF0YShDbGFzcyB0eXBlLCBTdHJpbmcgbmFtZSkgewogICAgICAg\nIHJldHVybiBuZXcgWE1MQ2xhc3NNZXRhRGF0YSh0eXBlLCBuYW1lKTsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgeG1sIGZpZWxk\nIG1ldGEsIGFkZCBpdCB0byB0aGUgZmllbGRNYXAgaW4gdGhlIGdpdmVuIAog\nICAgICogICAgIHhtbCBjbGFzcyBtZXRhZGF0YQogICAgICogQHBhcmFtIHR5\ncGUKICAgICAqIEBwYXJhbSBuYW1lCiAgICAgKiBAcGFyYW0gbWV0YQogICAg\nICogQHJldHVybiBhIFhNTEZpZWxkTWV0YURhdGEKICAgICAqLwogICAgcHVi\nbGljIFhNTEZpZWxkTWV0YURhdGEgbmV3WE1MRmllbGRNZXRhRGF0YShDbGFz\ncyB0eXBlLCBTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVybiBuZXcgWE1M\nRmllbGRNZXRhRGF0YSh0eXBlLCBuYW1lKTsKICAgIH0KfQo=\n","encoding":"base64"}

