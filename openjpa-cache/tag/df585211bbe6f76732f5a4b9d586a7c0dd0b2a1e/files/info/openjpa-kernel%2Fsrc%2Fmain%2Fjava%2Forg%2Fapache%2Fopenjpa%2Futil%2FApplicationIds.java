{"sha":"32c2c7b4cbaf5f54079b1d2179333466a878f019","node_id":"MDQ6QmxvYjIwNjM2NDozMmMyYzdiNGNiYWY1ZjU0MDc5YjFkMjE3OTMzMzQ2NmE4NzhmMDE5","size":24236,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/32c2c7b4cbaf5f54079b1d2179333466a878f019","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbDsKCmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0\nLk1vZGlmaWVyOwppbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9y\ndCBqYXZhLm1hdGguQmlnSW50ZWdlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc2VjdXJpdHkuUHJpdmls\nZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwoK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLkZpZWxkTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDUmVnaXN0\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0\nZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5PYmplY3RJZFN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuU3RhdGVNYW5hZ2VySW1wbDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5hZ2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVn\naWVzOwppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogVXRpbGl0\neSBjbGFzcyBmb3IgbWFuaXB1bGF0aW5nIGFwcGxpY2F0aW9uIG9iamVjdCBp\nZHMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICov\nCnB1YmxpYyBjbGFzcyBBcHBsaWNhdGlvbklkcyB7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZQogICAgICAgIChBcHBsaWNhdGlvbklkcy5jbGFzcyk7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYzIgPSBMb2NhbGl6ZXIu\nZm9yUGFja2FnZQogICAgICAgIChTdGF0ZU1hbmFnZXJJbXBsLmNsYXNzKTsK\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJpbWFyeSBrZXkgdmFsdWVz\nIGZvciB0aGUgZ2l2ZW4gb2JqZWN0IGlkLiBUaGUgdmFsdWVzCiAgICAgKiB3\naWxsIGJlIHJldHVybmVkIGluIHRoZSBzYW1lIG9yZGVyIGFzIHRoZSBtZXRh\nZGF0YSBwcmltYXJ5IGtleSBmaWVsZHMuCiAgICAgKiBWYWx1ZXMgZm9yIFBD\nIHByaW1hcnkga2V5IGZpZWxkcyB3aWxsIGJlIHRoZSBwcmltYXJ5IGtleSB2\nYWx1ZSBvcgogICAgICogb2lkIHZhbHVlIG9mIHRoZSByZWxhdGVkIGluc3Rh\nbmNlIChkZXBlbmRpbmcgb24gCiAgICAgKiB7QGxpbmsgRmllbGRNZXRhRGF0\nYSNpc09iamVjdElkRmllbGRJZE9mUEN9KS4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBPYmplY3RbXSB0b1BLVmFsdWVzKE9iamVjdCBvaWQsIENsYXNz\nTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBPYmplY3RbXSBwa3M7\nCiAgICAgICAgaWYgKG1ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewogICAg\nICAgICAgICBwa3MgPSBuZXcgT2JqZWN0WzFdOwogICAgICAgICAgICBpZiAo\nb2lkICE9IG51bGwpCiAgICAgICAgICAgICAgICBwa3NbMF0gPSAoKE9wZW5K\nUEFJZCkgb2lkKS5nZXRJZE9iamVjdCgpOwogICAgICAgICAgICByZXR1cm4g\ncGtzOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVzZXQgb3duaW5nICdtZXRh\nJyB0byB0aGUgb3duZXIgb2YgdGhlIHByaW1hcnkga2V5IGZpZWxkcywgYmVj\nYXVzZQogICAgICAgIC8vIHRoZSBvbmUgcGFzc2VkIGluIG1pZ2h0IGJlIGEg\ncHJveHksIGxpa2UgZm9yIGVtYmVkZGVkIG1hcHBpbmdzOwogICAgICAgIC8v\nIHNpbmNlIGdldFByaW1hcnlLZXlGaWVsZHMgaXMgZ3VhcmFudGVlZCB0byBy\nZXR1cm4gdGhlIHByaW1hcnkKICAgICAgICAvLyBrZXlzIGluIHRoZSBvcmRl\nciBvZiBpbmhlcml0YW5jZSwgd2UgYXJlIGd1YXJhbnRlZWQgdGhhdAogICAg\nICAgIC8vIHRoZSBsYXN0IGVsZW1lbnQgd2lsbCBiZSB0aGUgbW9zdC1kZXJp\ndmVkIGNsYXNzLgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gbWV0\nYS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgbWV0YSA9IGZtZHNb\nZm1kcy5sZW5ndGggLSAxXS5nZXREZWNsYXJpbmdNZXRhRGF0YSgpOwogICAg\nICAgIHBrcyA9IG5ldyBPYmplY3RbZm1kcy5sZW5ndGhdOwogICAgICAgIGlm\nIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHBrczsKCiAgICAg\nICAgaWYgKCFNb2RpZmllci5pc0Fic3RyYWN0KG1ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpLmdldE1vZGlmaWVycygpKSkgewogICAgICAgICAgICAvLyBjb3B5\nIGZpZWxkcyBmcm9tIHRoZSBvaWQKICAgICAgICAgICAgUHJpbWFyeUtleUZp\nZWxkTWFuYWdlciBjb25zdW1lciA9IG5ldyBQcmltYXJ5S2V5RmllbGRNYW5h\nZ2VyKCk7CiAgICAgICAgICAgIGNvbnN1bWVyLnNldFN0b3JlKHBrcyk7CiAg\nICAgICAgICAgIG9pZCA9IHdyYXAobWV0YSwgb2lkKTsKICAgICAgICAgICAg\nUENSZWdpc3RyeS5jb3B5S2V5RmllbGRzRnJvbU9iamVjdElkKG1ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgY29uc3VtZXIsIG9p\nZCk7CiAgICAgICAgICAgIHJldHVybiBjb25zdW1lci5nZXRTdG9yZSgpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gZGVmYXVsdCB0byByZWZsZWN0aW9uCiAg\nICAgICAgaWYgKG1ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkKICAgICAg\nICAgICAgb2lkID0gKChPYmplY3RJZCkgb2lkKS5nZXRJZCgpOwogICAgICAg\nIENsYXNzIG9pZFR5cGUgPSBvaWQuZ2V0Q2xhc3MoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgaWYgKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEu\nQUNDRVNTX0ZJRUxEKQogICAgICAgICAgICAgICAgcGtzW2ldID0gUmVmbGVj\ndGlvbi5nZXQob2lkLCBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCAK\nICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldE5hbWUoKSwgdHJ1ZSkp\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBwa3NbaV0gPSBS\nZWZsZWN0aW9uLmdldChvaWQsIFJlZmxlY3Rpb24uZmluZEdldHRlcihvaWRU\neXBlLAogICAgICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0TmFtZSgpLCB0\ncnVlKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwa3M7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogV3JhcHMgdGhlIGdpdmVuIG9iamVjdCBmb3Ig\ndGhlIGdpdmVuIHR5cGUgaW50byBhIE9wZW5KUEEgc3BlY2lmaWMgCiAgICAg\nKiBhcHBsaWNhdGlvbiBpZGVudGl0eSBvYmplY3Qgd3JhcHBlciBpbnN0YW5j\nZSAoaS5lLiBPYmplY3RJZCkgaWYgYWxsIG9mIAogICAgICogdGhlIGZvbGxv\nd2luZyBpcyB0cnVlOgogICAgICogdGhlIGdpdmVuIHR5cGUgaXMgbm90IHVz\naW5nIGJ1aWx0LWluIE9wZW5KUEEgaWRlbnRpdHkgdHlwZXMKICAgICAqIHRo\nZSBnaXZlbiB0eXBlIGlzIHVzaW5nIGEgc2hhcmVkIE9wZW5KUEEgaWRlbnRp\ndHkgdHlwZQogICAgICogdGhlIGdpdmVuIG9iamVjdCBpcyBub3QgYWxyZWFk\neSBhIHdyYXBwZXIgaWRlbnRpdHkgdHlwZQogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIE9iamVjdCB3cmFwKENsYXNzTWV0YURhdGEgbWV0YSwgT2JqZWN0\nIG9pZCkgewogICAgICAgIGlmICghbWV0YS5pc09wZW5KUEFJZGVudGl0eSgp\nIAogICAgICAgICAmJiBtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkgCiAg\nICAgICAgICYmICEob2lkIGluc3RhbmNlb2YgT2JqZWN0SWQpKSB7CiAgICAg\nICAgCXJldHVybiBuZXcgT2JqZWN0SWQobWV0YS5nZXREZXNjcmliZWRUeXBl\nKCksIG9pZCk7CiAgICAgICAgfSAKICAgICAgICByZXR1cm4gb2lkOwogICAg\nfQogICAgCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBuZXcgb2JqZWN0IGlk\nIGNvbnN0cnVjdGVkIGZyb20gdGhlIGdpdmVuIHByaW1hcnkga2V5IHZhbHVl\ncy4KICAgICAqIFZhbHVlcyBmb3IgUEMgcHJpbWFyeSBrZXkgZmllbGRzIHNo\nb3VsZCBiZSB0aGUgcHJpbWFyeSBrZXkgdmFsdWUgb3IKICAgICAqIG9pZCB2\nYWx1ZSBvZiB0aGUgcmVsYXRlZCBpbnN0YW5jZSAoZGVwZW5kaW5nIG9uIAog\nICAgICoge0BsaW5rIEZpZWxkTWV0YURhdGEjaXNPYmplY3RJZEZpZWxkSWRP\nZlBDfSkuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGZyb21Q\nS1ZhbHVlcyhPYmplY3RbXSBwa3MsIENsYXNzTWV0YURhdGEgbWV0YSkgewog\nICAgICAgIGlmIChtZXRhID09IG51bGwgfHwgcGtzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBib29sZWFuIGNvbnZlcnQg\nPSAhbWV0YS5nZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpLgog\nICAgICAgICAgICBnZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKS5nZXRTdHJp\nY3RJZGVudGl0eVZhbHVlcygpOwogICAgICAgIGlmIChtZXRhLmlzT3BlbkpQ\nQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgaW50IHR5cGUgPSBtZXRhLmdl\ndFByaW1hcnlLZXlGaWVsZHMoKVswXS5nZXRPYmplY3RJZEZpZWxkVHlwZUNv\nZGUoKTsKICAgICAgICAgICAgT2JqZWN0IHZhbCA9IChjb252ZXJ0KSA/IEph\ndmFUeXBlcy5jb252ZXJ0KHBrc1swXSwgdHlwZSkgOiBwa3NbMF07CiAgICAg\nICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgICAgIGlmICghY29udmVydCAm\nJiAhKHZhbCBpbnN0YW5jZW9mIEJ5dGUpKQogICAgICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKCIhKHggaW5zdGFu\nY2VvZiBCeXRlKSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcg\nQnl0ZUlkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAg\nICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFsKS5i\neXRlVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nSEFSOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFySWQobWV0YS5n\nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHZh\nbCA9PSBudWxsID8gMCA6ICgoQ2hhcmFjdGVyKSB2YWwpLmNoYXJWYWx1ZSgp\nKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3RhbmNl\nb2YgRG91YmxlKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIENsYXNzQ2FzdEV4Y2VwdGlvbigiISh4IGluc3RhbmNlb2YgRG91YmxlKSIp\nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRG91YmxlSWQobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3RhbmNl\nb2YgRmxvYXQpKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nQ2xhc3NDYXN0RXhjZXB0aW9uKCIhKHggaW5zdGFuY2VvZiBGbG9hdCkiKTsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0SWQobWV0YS5n\nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHZh\nbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmZsb2F0VmFsdWUoKSk7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAg\nICAgICAgIGlmICghY29udmVydCAmJiAhKHZhbCBpbnN0YW5jZW9mIEludGVn\nZXIpKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3ND\nYXN0RXhjZXB0aW9uKCIhKHggaW5zdGFuY2VvZiBJbnRlZ2VyKSIpOwogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSW50SWQobWV0YS5nZXREZXNj\ncmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9PSBu\ndWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmludFZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICAgICAgICAg\nIGlmICghY29udmVydCAmJiAhKHZhbCBpbnN0YW5jZW9mIExvbmcpKQogICAg\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0\naW9uKCIhKHggaW5zdGFuY2VvZiBMb25nKSIpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBuZXcgTG9uZ0lkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAo\nKE51bWJlcikgdmFsKS5sb25nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgICAgICBpZiAoIWNv\nbnZlcnQgJiYgISh2YWwgaW5zdGFuY2VvZiBTaG9ydCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRpb24oIiEo\neCBpbnN0YW5jZW9mIFNob3J0KSIpOwogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgU2hvcnRJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwKICAg\nICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChOdW1i\nZXIpIHZhbCkuc2hvcnRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IFN0cmluZ0lkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCAoU3RyaW5n\nKSB2YWwpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGVJZChtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKSwgKERhdGUpIHZhbCk7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBPYmplY3RJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgdmFsKTsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKCFjb252ZXJ0ICYmICEodmFsIGluc3RhbmNl\nb2YgQmlnRGVjaW1hbCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBDbGFzc0Nhc3RFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAiISh4IGluc3RhbmNlb2YgQmlnRGVjaW1hbCkiKTsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IEJpZ0RlY2ltYWxJZChtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKSwgCiAgICAgICAgICAgICAgICAgICAgICAgIChC\naWdEZWNpbWFsKXZhbCk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CSUdJTlRFR0VSOgogICAgICAgICAgICAgICAgICAgIGlmICghY29udmVy\ndCAmJiAhKHZhbCBpbnN0YW5jZW9mIEJpZ0ludGVnZXIpKQogICAgICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIiEoeCBpbnN0YW5jZW9mIEJp\nZ0ludGVnZXIpIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBC\naWdJbnRlZ2VySWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIAogICAgICAg\nICAgICAgICAgICAgICAgICAoQmlnSW50ZWdlcil2YWwpOwogICAgICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgLy8gY29weSBwa3MgdG8gb2lkCiAgICAgICAgaWYgKCFNb2Rp\nZmllci5pc0Fic3RyYWN0KG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE1v\nZGlmaWVycygpKSkgewogICAgICAgICAgICBPYmplY3Qgb2lkID0gUENSZWdp\nc3RyeS5uZXdPYmplY3RJZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAg\nICAgICAgICAgIFByaW1hcnlLZXlGaWVsZE1hbmFnZXIgcHJvZHVjZXIgPSBu\nZXcgUHJpbWFyeUtleUZpZWxkTWFuYWdlcigpOwogICAgICAgICAgICBwcm9k\ndWNlci5zZXRTdG9yZShwa3MpOwogICAgICAgICAgICBpZiAoY29udmVydCkK\nICAgICAgICAgICAgICAgIHByb2R1Y2VyLnNldE1ldGFEYXRhKG1ldGEpOwog\nICAgICAgICAgICBQQ1JlZ2lzdHJ5LmNvcHlLZXlGaWVsZHNUb09iamVjdElk\nKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgcHJv\nZHVjZXIsIG9pZCk7CiAgICAgICAgICAgIHJldHVybiBBcHBsaWNhdGlvbklk\ncy53cmFwKG1ldGEsIG9pZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBkZWZh\ndWx0IHRvIHJlZmxlY3Rpb24KICAgICAgICBDbGFzcyBvaWRUeXBlID0gbWV0\nYS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBpZiAoTW9kaWZpZXIuaXNB\nYnN0cmFjdChvaWRUeXBlLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm9iamVjdGlkLWFi\nc3RyYWN0IiwgbWV0YSkpOwogICAgICAgIE9iamVjdCBjb3B5ID0gbnVsbDsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBjb3B5ID0gQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhl\nbHBlci5uZXdJbnN0YW5jZUFjdGlvbihvaWRUeXBlKSk7CiAgICAgICAgfSBj\nYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgaWYgKHQgaW5zdGFu\nY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKQogICAgICAgICAgICAg\nICAgdCA9ICgoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgdCkuZ2V0RXhj\nZXB0aW9uKCk7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0\naW9uKHQpOwogICAgICAgIH0KCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZt\nZHMgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBPYmpl\nY3QgdmFsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICB2YWwgPSAoY29udmVydCkgPyBKYXZh\nVHlwZXMuY29udmVydChwa3NbaV0sCiAgICAgICAgICAgICAgICBmbWRzW2ld\nLmdldE9iamVjdElkRmllbGRUeXBlQ29kZSgpKSA6IHBrc1tpXTsKICAgICAg\nICAgICAgaWYgKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURh\ndGEuQUNDRVNTX0ZJRUxEKQogICAgICAgICAgICAgICAgUmVmbGVjdGlvbi5z\nZXQoY29weSwgUmVmbGVjdGlvbi5maW5kRmllbGQob2lkVHlwZSwgCiAgICAg\nICAgICAgICAgICAgICAgZm1kc1tpXS5nZXROYW1lKCksIHRydWUpLCB2YWwp\nOyAKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgUmVmbGVjdGlv\nbi5zZXQoY29weSwgUmVmbGVjdGlvbi5maW5kU2V0dGVyKG9pZFR5cGUsIAog\nICAgICAgICAgICAgICAgICAgIGZtZHNbaV0uZ2V0TmFtZSgpLCBmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZSgpLCB0cnVlKSwgdmFsKTsKICAgICAgICB9Cgog\nICAgICAgIGlmIChtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAg\nICAgICAgIGNvcHkgPSBuZXcgT2JqZWN0SWQobWV0YS5nZXREZXNjcmliZWRU\neXBlKCksIGNvcHkpOwogICAgICAgIHJldHVybiBjb3B5OwogICAgfQoKICAg\nIC8qKgogICAgICogQ29weSB0aGUgZ2l2ZW4gb2lkIHZhbHVlLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBjb3B5KE9iamVjdCBvaWQsIENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwg\nfHwgb2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBpZiAobWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAg\nICAgIC8vIHVzZSBtZXRhIHR5cGUgaW5zdGVhZCBvZiBvaWQgdHlwZSBpbiBj\nYXNlIGl0J3MgYSBzdWJjbGFzcwogICAgICAgICAgICBDbGFzcyBjbHMgPSBt\nZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgT3BlbkpQQUlk\nIGtvaWQgPSAoT3BlbkpQQUlkKSBvaWQ7CiAgICAgICAgICAgIEZpZWxkTWV0\nYURhdGEgcGsgPSBtZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKVswXTsKICAg\nICAgICAgICAgc3dpdGNoIChway5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUo\nKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZUlkKGNscywgKChCeXRlSWQp\nIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5o\nYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJf\nT0JKOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcklkKGNs\ncywgKChDaGFySWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IERvdWJsZUlkKGNscywgKChEb3VibGVJZCkgb2lkKS5nZXRJZCgp\nLAogICAgICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMo\nKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0SWQoY2xzLCAoKEZsb2F0\nSWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29p\nZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5U\nX09CSjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEludElkKGNs\ncywgKChJbnRJZCkgb2lkKS5nZXRJZCgpLAogICAgICAgICAgICAgICAgICAg\nICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBMb25nSWQoY2xzLCAoKExvbmdJZCkgb2lkKS5nZXRJZCgpLAogICAgICAg\nICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IFNob3J0SWQoY2xzLCAoKFNob3J0SWQpIG9pZCku\nZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5oYXNTdWJj\nbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RS\nSU5HOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nSWQo\nY2xzLCBvaWQudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICAgICAg\na29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuT0lEOgogICAgICAgICAgICAgICAgICAgIENsYXNzTWV0YURh\ndGEgZW1iZWQgPSBway5nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAg\nICAgICAgICAgICAgT2JqZWN0IGlubmVyID0ga29pZC5nZXRJZE9iamVjdCgp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChlbWJlZCAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICBpbm5lciA9IGNvcHkoaW5uZXIsIGVtYmVk\nLCBlbWJlZC5nZXRGaWVsZHMoKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIG5ldyBPYmplY3RJZChjbHMsIGlubmVyLCBrb2lkLmhhc1N1YmNsYXNz\nZXMoKSk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RJZChjbHMs\nIGtvaWQuZ2V0SWRPYmplY3QoKSwgCiAgICAgICAgICAgICAgICAgICAgICAg\nIGtvaWQuaGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBEYXRlSWQoY2xzLCAoKERhdGVJZCkgb2lkKS5nZXRJZCgpLAogICAgICAg\nICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgQmlnRGVjaW1hbElkKGNscywgKChC\naWdEZWNpbWFsSWQpIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gbmV3IEJpZ0ludGVnZXJJZChjbHMsICgoQmlnSW50ZWdlcklk\nKSBvaWQpLmdldElkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGtvaWQu\naGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9u\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0\nZSBhIG5ldyBwYyBpbnN0YW5jZSBvZiB0aGUgcmlnaHQgdHlwZSwgc2V0IGl0\ncyBrZXkgZmllbGRzCiAgICAgICAgLy8gdG8gdGhlIG9yaWdpbmFsIG9pZCB2\nYWx1ZXMsIHRoZW4gY29weSBpdHMga2V5IGZpZWxkcyB0byBhIG5ldwogICAg\nICAgIC8vIG9pZCBpbnN0YW5jZQogICAgICAgIGlmICghTW9kaWZpZXIuaXNB\nYnN0cmFjdChtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXRNb2RpZmllcnMo\nKSkKICAgICAgICAgICAgJiYgIWhhc1BDUHJpbWFyeUtleUZpZWxkcyhtZXRh\nKSkgewogICAgICAgICAgICBDbGFzcyB0eXBlID0gbWV0YS5nZXREZXNjcmli\nZWRUeXBlKCk7CiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9\nIFBDUmVnaXN0cnkubmV3SW5zdGFuY2UodHlwZSwgbnVsbCwgb2lkLCAKICAg\nICAgICAgICAgICAgICBmYWxzZSk7CiAgICAgICAgICAgIE9iamVjdCBjb3B5\nID0gcGMucGNOZXdPYmplY3RJZEluc3RhbmNlKCk7CiAgICAgICAgICAgIHBj\nLnBjQ29weUtleUZpZWxkc1RvT2JqZWN0SWQoY29weSk7CiAgICAgICAgICAg\nIHJldHVybiBjb3B5OwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IGNvcHkg\nPSAoIW1ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgPyBvaWQKICAgICAg\nICAgICAgOiAoKE9iamVjdElkKSBvaWQpLmdldElkKCk7CiAgICAgICAgY29w\neSA9IGNvcHkoY29weSwgbWV0YSwgbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRz\nKCkpOwogICAgICAgIGlmIChtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkp\nCiAgICAgICAgICAgIGNvcHkgPSBuZXcgT2JqZWN0SWQobWV0YS5nZXREZXNj\ncmliZWRUeXBlKCksIGNvcHksCiAgICAgICAgICAgICAgICAoKE9wZW5KUEFJ\nZCkgb2lkKS5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgIHJldHVybiBjb3B5\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgYW55IG9m\nIHRoZSBnaXZlbiB0eXBlJ3MgcHJpbWFyeSBrZXkgZmllbGRzIGFyZSAKICAg\nICAqIHBlcnNpc3RlbnQgb2JqZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgYm9vbGVhbiBoYXNQQ1ByaW1hcnlLZXlGaWVsZHMoQ2xhc3NNZXRh\nRGF0YSBtZXRhKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBt\nZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChm\nbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMp\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb3B5IHRoZSBnaXZlbiBp\nZGVudGl0eSBvYmplY3QgdXNpbmcgcmVmbGVjdGlvbi4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGNvcHkoT2JqZWN0IG9pZCwgQ2xhc3NN\nZXRhRGF0YSBtZXRhLAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzKSB7\nCiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IG9pZC5nZXRDbGFzcygp\nOwogICAgICAgIE9iamVjdCBjb3B5ID0gbnVsbDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBjb3B5ID0gQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdJbnN0YW5j\nZUFjdGlvbihvaWRUeXBlKSk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxl\nIHQpIHsKICAgICAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBQcml2aWxlZ2Vk\nQWN0aW9uRXhjZXB0aW9uKQogICAgICAgICAgICAgICAgdCA9ICgoUHJpdmls\nZWdlZEFjdGlvbkV4Y2VwdGlvbikgdCkuZ2V0RXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHQpOwogICAgICAg\nIH0KCiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAgICAgT2JqZWN0IHZhbDsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9\nIEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChtZXRhLmdldEFjY2Vz\nc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkgewogICAg\nICAgICAgICAgICAgICAgIGZpZWxkID0gUmVmbGVjdGlvbi5maW5kRmllbGQo\nb2lkVHlwZSwgZm1kc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAg\nICAgICAgIHRydWUpOwogICAgICAgICAgICAgICAgICAgIFJlZmxlY3Rpb24u\nc2V0KGNvcHksIGZpZWxkLCBSZWZsZWN0aW9uLmdldChvaWQsIGZpZWxkKSk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBwcm9wZXJ0eQogICAgICAg\nICAgICAgICAgICAgIHZhbCA9IFJlZmxlY3Rpb24uZ2V0KG9pZCwgUmVmbGVj\ndGlvbi5maW5kR2V0dGVyKG9pZFR5cGUsCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZtZHNbaV0uZ2V0TmFtZSgpLCB0cnVlKSk7CiAgICAgICAgICAgICAg\nICAgICAgUmVmbGVjdGlvbi5zZXQoY29weSwgUmVmbGVjdGlvbi5maW5kU2V0\ndGVyKG9pZFR5cGUsIGZtZHNbaV0uCiAgICAgICAgICAgICAgICAgICAgICAg\nIGdldE5hbWUoKSwgZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlwZSgpLCB0\ncnVlKSwgdmFsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gY29weTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgZmllbGQgdmFsdWUgZnJv\nbSB0aGUgZ2l2ZW4gb2lkLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9i\namVjdCBnZXQoT2JqZWN0IG9pZCwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAg\nICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIGlmIChvaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQpCiAgICAg\nICAgICAgIHJldHVybiAoKE9wZW5KUEFJZCkgb2lkKS5nZXRJZE9iamVjdCgp\nOwoKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBmbWQuZ2V0RGVmaW5p\nbmdNZXRhRGF0YSgpOwogICAgICAgIENsYXNzIG9pZFR5cGUgPSBvaWQuZ2V0\nQ2xhc3MoKTsKICAgICAgICBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0g\nQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpCiAgICAgICAgICAgIHJldHVy\nbiBSZWZsZWN0aW9uLmdldChvaWQsIFJlZmxlY3Rpb24uZmluZEZpZWxkKG9p\nZFR5cGUsIAogICAgICAgICAgICAgICAgZm1kLmdldE5hbWUoKSwgdHJ1ZSkp\nOwogICAgICAgIHJldHVybiBSZWZsZWN0aW9uLmdldChvaWQsIFJlZmxlY3Rp\nb24uZmluZEdldHRlcihvaWRUeXBlLCBmbWQuZ2V0TmFtZSgpLAogICAgICAg\nICAgICB0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBh\nbiBhcHBsaWNhdGlvbiBpZCBiYXNlZCBvbiB0aGUgY3VycmVudCBwcmltYXJ5\nIGtleSBmaWVsZCBzdGF0ZQogICAgICogb2YgdGhlIGdpdmVuIGluc3RhbmNl\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBjcmVhdGUoUGVy\nc2lzdGVuY2VDYXBhYmxlIHBjLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBpZiAocGMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIE9iamVjdCBvaWQgPSBwYy5wY05ld09iamVjdElkSW5zdGFu\nY2UoKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBpZiAoIW1ldGEuaXNPcGVuSlBBSWRlbnRp\ndHkoKSkgewogICAgICAgICAgICBwYy5wY0NvcHlLZXlGaWVsZHNUb09iamVj\ndElkKG9pZCk7CiAgICAgICAgICAgIHJldHVybiBvaWQ7CiAgICAgICAgfQoK\nICAgICAgICBGaWVsZE1ldGFEYXRhIHBrID0gbWV0YS5nZXRQcmltYXJ5S2V5\nRmllbGRzKClbMF07CiAgICAgICAgaWYgKHBrLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSAhPSBKYXZhVHlwZXMuT0lEKQogICAgICAgICAgICByZXR1cm4gb2lk\nOwoKICAgICAgICAvLyBhbHdheXMgY29weSBvaWQgb2JqZWN0IGluIGNhc2Ug\nZmllbGQgdmFsdWUgbXV0YXRlcyBvciBiZWNvbWVzCiAgICAgICAgLy8gbWFu\nYWdlZAogICAgICAgIE9iamVjdElkIG9iamlkID0gKE9iamVjdElkKSBvaWQ7\nCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBlbWJlZCA9IHBrLmdldEVtYmVkZGVk\nTWV0YURhdGEoKTsKICAgICAgICBvYmppZC5zZXRJZChjb3B5KG9iamlkLmdl\ndElkKCksIGVtYmVkLCBlbWJlZC5nZXRGaWVsZHMoKSkpOwogICAgICAgIHJl\ndHVybiBvYmppZDsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2lnbiBhbiBh\ncHBsaWNhdGlvbiBpZGVudGl0eSBvYmplY3QgdG8gdGhlIGdpdmVuIHN0YXRl\nLCBvciByZXR1cm4KICAgICAqIGZhbHNlIGlmIGRldGVybWluaW5nIHRoZSBh\ncHBsaWNhdGlvbiBpZGVudGl0eSByZXF1aXJlcyBhIGZsdXNoLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gYXNzaWduKE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIFN0b3JlTWFuYWdlciBzdG9yZSwKICAgICAgICBib29s\nZWFuIHByZUZsdXNoKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0g\nc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0\neVR5cGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKCiAgICAg\nICAgYm9vbGVhbiByZXQ7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9\nIG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgIGlmIChtZXRh\nLmlzT3BlbkpQQUlkZW50aXR5KCkKICAgICAgICAgICAgJiYgcGtzWzBdLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0lEKSB7CiAgICAg\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb2lkc20gPSBuZXcgT2JqZWN0\nSWRTdGF0ZU1hbmFnZXIKICAgICAgICAgICAgICAgIChzbS5mZXRjaE9iamVj\ndEZpZWxkKHBrc1swXS5nZXRJbmRleCgpKSwgc20sIHBrc1swXSk7CiAgICAg\nICAgICAgIHJldCA9IGFzc2lnbihvaWRzbSwgc3RvcmUsIHBrc1swXS5nZXRF\nbWJlZGRlZE1ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICBnZXRGaWVsZHMo\nKSwgcHJlRmx1c2gpOwogICAgICAgICAgICBzbS5zdG9yZU9iamVjdEZpZWxk\nKHBrc1swXS5nZXRJbmRleCgpLAogICAgICAgICAgICAgICAgb2lkc20uZ2V0\nTWFuYWdlZEluc3RhbmNlKCkpOwogICAgICAgIH0gZWxzZQogICAgICAgICAg\nICByZXQgPSBhc3NpZ24oc20sIHN0b3JlLCBtZXRhLmdldFByaW1hcnlLZXlG\naWVsZHMoKSwgcHJlRmx1c2gpOwogICAgICAgIGlmICghcmV0KQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGJhc2Ugb2lkIG9uIGZp\nZWxkIHZhbHVlcwogICAgICAgIHNtLnNldE9iamVjdElkKGNyZWF0ZShzbS5n\nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSwgbWV0YSkpOwogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQXNzaWduIGdlbmVyYXRl\nZCB2YWx1ZXMgdG8gZ2l2ZW4gcHJpbWFyeSBrZXkgZmllbGRzLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGFzc2lnbihPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBTdG9yZU1hbmFnZXIgc3RvcmUsCiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIHBrcywgYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgcGtzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICAvLyBJZiB3ZSBhcmUgZ2VuZXJhdGluZyB2YWx1ZXMuLi4KICAgICAg\nICAgICAgaWYgKHBrc1tpXS5nZXRWYWx1ZVN0cmF0ZWd5KCkgIT0gVmFsdWVT\ndHJhdGVnaWVzLk5PTkUpIHsKICAgICAgICAgICAgICAgIC8vIElmIGEgdmFs\ndWUgYWxyZWFkeSBleGlzdHMgb24gdGhpcyBmaWVsZCwgdGhyb3cgZXhjZXB0\naW9uLgogICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBjb25zaWRlcmVkIGFu\nIGFwcGxpY2F0aW9uIGNvZGluZyBlcnJvci4KICAgICAgICAgICAgICAgIGlm\nICghc20uaXNEZWZhdWx0VmFsdWUocGtzW2ldLmdldEluZGV4KCkpKQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYzIuZ2V0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImV4\naXN0aW5nLXZhbHVlLW92ZXJyaWRlLWV4Y2VwIiwgcGtzW2ldCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRGdWxsTmFtZShmYWxz\nZSkpKTsKICAgICAgICAgICAgICAgIC8vIEFzc2lnbiB0aGUgZ2VuZXJhdGVk\nIHZhbHVlCiAgICAgICAgICAgICAgICBpZiAoc3RvcmUuYXNzaWduRmllbGQo\nc20sIHBrc1tpXS5nZXRJbmRleCgpLCBwcmVGbHVzaCkpCiAgICAgICAgICAg\nICAgICAgICAgcGtzW2ldLnNldFZhbHVlR2VuZXJhdGVkKHRydWUpOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAg\nfQoKICAgIC8qKgogICAgICogSGVscGVyIGNsYXNzIHVzZWQgdG8gdHJhbnNm\nZXIgcGsgdmFsdWVzIHRvL2Zyb20gYXBwbGljYXRpb24gb2lkcy4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUHJpbWFyeUtleUZpZWxkTWFu\nYWdlcgogICAgICAgIGltcGxlbWVudHMgRmllbGRNYW5hZ2VyIHsKCiAgICAg\nICAgcHJpdmF0ZSBPYmplY3RbXSBfc3RvcmUgPSBudWxsOwogICAgICAgIHBy\naXZhdGUgaW50IF9pbmRleCA9IDA7CiAgICAgICAgcHJpdmF0ZSBDbGFzc01l\ndGFEYXRhIF9tZXRhID0gbnVsbDsKCiAgICAgICAgcHVibGljIHZvaWQgc2V0\nTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgICAgIF9t\nZXRhID0gbWV0YTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3Rb\nXSBnZXRTdG9yZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdG9yZTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldFN0b3JlKE9iamVjdFtd\nIHN0b3JlKSB7CiAgICAgICAgICAgIF9zdG9yZSA9IHN0b3JlOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVCb29sZWFuRmllbGQoaW50\nIGZpZWxkLCBib29sZWFuIHZhbCkgewogICAgICAgICAgICBzdG9yZSgodmFs\nKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVCeXRlRmllbGQoaW50IGZpZWxk\nLCBieXRlIHZhbCkgewogICAgICAgICAgICBzdG9yZShuZXcgQnl0ZSh2YWwp\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hhckZp\nZWxkKGludCBmaWVsZCwgY2hhciB2YWwpIHsKICAgICAgICAgICAgc3RvcmUo\nbmV3IENoYXJhY3Rlcih2YWwpKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIHN0b3JlU2hvcnRGaWVsZChpbnQgZmllbGQsIHNob3J0IHZhbCkg\newogICAgICAgICAgICBzdG9yZShuZXcgU2hvcnQodmFsKSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUludEZpZWxkKGludCBmaWVs\nZCwgaW50IHZhbCkgewogICAgICAgICAgICBzdG9yZShOdW1iZXJzLnZhbHVl\nT2YodmFsKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9y\nZUxvbmdGaWVsZChpbnQgZmllbGQsIGxvbmcgdmFsKSB7CiAgICAgICAgICAg\nIHN0b3JlKE51bWJlcnMudmFsdWVPZih2YWwpKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIHN0b3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZs\nb2F0IHZhbCkgewogICAgICAgICAgICBzdG9yZShuZXcgRmxvYXQodmFsKSk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZURvdWJsZUZp\nZWxkKGludCBmaWVsZCwgZG91YmxlIHZhbCkgewogICAgICAgICAgICBzdG9y\nZShuZXcgRG91YmxlKHZhbCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIHZvaWQgc3RvcmVTdHJpbmdGaWVsZChpbnQgZmllbGQsIFN0cmluZyB2YWwp\nIHsKICAgICAgICAgICAgc3RvcmUodmFsKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIHN0b3JlT2JqZWN0RmllbGQoaW50IGZpZWxkLCBPYmpl\nY3QgdmFsKSB7CiAgICAgICAgICAgIHN0b3JlKHZhbCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBmZXRjaEJvb2xlYW5GaWVsZChpbnQg\nZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuIChyZXRyaWV2ZShmaWVsZCkg\nPT0gQm9vbGVhbi5UUlVFKSA/IHRydWUgOiBmYWxzZTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBjaGFyIGZldGNoQ2hhckZpZWxkKGludCBmaWVsZCkg\newogICAgICAgICAgICByZXR1cm4gKChDaGFyYWN0ZXIpIHJldHJpZXZlKGZp\nZWxkKSkuY2hhclZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYnl0ZSBmZXRjaEJ5dGVGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAgICAg\ncmV0dXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkpLmJ5dGVWYWx1ZSgp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHNob3J0IGZldGNoU2hvcnRG\naWVsZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVy\nKSByZXRyaWV2ZShmaWVsZCkpLnNob3J0VmFsdWUoKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBpbnQgZmV0Y2hJbnRGaWVsZChpbnQgZmllbGQpIHsK\nICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkp\nLmludFZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgbG9uZyBm\nZXRjaExvbmdGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJu\nICgoTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkpLmxvbmdWYWx1ZSgpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGZsb2F0IGZldGNoRmxvYXRGaWVsZChp\nbnQgZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSByZXRy\naWV2ZShmaWVsZCkpLmZsb2F0VmFsdWUoKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBkb3VibGUgZmV0Y2hEb3VibGVGaWVsZChpbnQgZmllbGQpIHsK\nICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSByZXRyaWV2ZShmaWVsZCkp\nLmRvdWJsZVZhbHVlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3Ry\naW5nIGZldGNoU3RyaW5nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgICAg\nIHJldHVybiAoU3RyaW5nKSByZXRyaWV2ZShmaWVsZCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgT2JqZWN0IGZldGNoT2JqZWN0RmllbGQoaW50IGZp\nZWxkKSB7CiAgICAgICAgICAgIHJldHVybiByZXRyaWV2ZShmaWVsZCk7CiAg\nICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgc3RvcmUoT2JqZWN0IHZh\nbCkgewogICAgICAgICAgICBfc3RvcmVbX2luZGV4KytdID0gdmFsOwogICAg\nICAgIH0KCiAgICAgICAgcHJpdmF0ZSBPYmplY3QgcmV0cmlldmUoaW50IGZp\nZWxkKSB7CiAgICAgICAgICAgIE9iamVjdCB2YWwgPSBfc3RvcmVbX2luZGV4\nKytdOwogICAgICAgICAgICBpZiAoX21ldGEgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChm\naWVsZCk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSAhPSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICAgICAg\ndmFsID0gSmF2YVR5cGVzLmNvbnZlcnQodmFsLCBmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICB2YWwgPSBKYXZhVHlwZXMuY29udmVydCh2YWwsIEphdmFUeXBl\ncy5nZXRUeXBlQ29kZShmbWQuCiAgICAgICAgICAgICAgICAgICAgICAgIGdl\ndE9iamVjdElkRmllbGRUeXBlKCkpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gdmFsOwoJCX0KCX0KfQo=\n","encoding":"base64"}

