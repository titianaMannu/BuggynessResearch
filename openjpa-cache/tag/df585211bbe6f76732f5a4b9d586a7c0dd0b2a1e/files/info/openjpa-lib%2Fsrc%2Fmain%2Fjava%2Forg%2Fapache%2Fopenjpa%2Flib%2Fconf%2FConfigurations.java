{"sha":"d4e4202c3c1c945fd0eb7a76d0b67efaefefe745","node_id":"MDQ6QmxvYjIwNjM2NDpkNGU0MjAyYzNjMWM5NDVmZDBlYjdhNzZkMGI2N2VmYWVmZWZlNzQ1","size":28195,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d4e4202c3c1c945fd0eb7a76d0b67efaefefe745","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLmNvbmY7DQoNCmltcG9ydCBqYXZhLmlvLkZpbGU7DQppbXBvcnQgamF2\nYS5zZWN1cml0eS5BY2Nlc3NDb250cm9sbGVyOw0KaW1wb3J0IGphdmEuc2Vj\ndXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsNCmltcG9ydCBqYXZh\nLnV0aWwuQXJyYXlMaXN0Ow0KaW1wb3J0IGphdmEudXRpbC5BcnJheXM7DQpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247DQppbXBvcnQgamF2YS51dGls\nLkl0ZXJhdG9yOw0KaW1wb3J0IGphdmEudXRpbC5MaXN0Ow0KaW1wb3J0IGph\ndmEudXRpbC5NYXA7DQppbXBvcnQgamF2YS51dGlsLk1pc3NpbmdSZXNvdXJj\nZUV4Y2VwdGlvbjsNCmltcG9ydCBqYXZhLnV0aWwuUHJvcGVydGllczsNCmlt\ncG9ydCBqYXZhLnV0aWwuVHJlZVNldDsNCmltcG9ydCBqYXZheC5uYW1pbmcu\nQ29udGV4dDsNCmltcG9ydCBqYXZheC5uYW1pbmcuSW5pdGlhbENvbnRleHQ7\nDQppbXBvcnQgamF2YXgubmFtaW5nLk5hbWluZ0V4Y2VwdGlvbjsNCg0KaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOw0KaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLmV4Y2VwdGlvbi5OZXN0YWJs\nZVJ1bnRpbWVFeGNlcHRpb247DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5sb2cuTG9nOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5KMkRvUHJpdkhlbHBlcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5PcHRpb25zOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5QYXJzZUV4Y2VwdGlvbjsNCmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuU3RyaW5nRGlzdGFuY2U7DQppbXBvcnQg\namF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVudEhhc2hNYXA7DQppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLmNvbmN1cnJlbnQuQ29u\nY3VycmVudFJlZmVyZW5jZUhhc2hNYXA7DQppbXBvcnQgc2VycC51dGlsLlN0\ncmluZ3M7DQoNCi8qKg0KICogVXRpbGl0eSBtZXRob2RzIGRlYWxpbmcgd2l0\naCBjb25maWd1cmF0aW9uLg0KICoNCiAqIEBhdXRob3IgQWJlIFdoaXRlDQog\nKiBAbm9qYXZhZG9jDQogKi8NCnB1YmxpYyBjbGFzcyBDb25maWd1cmF0aW9u\ncyB7DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlDQogICAgICAgIChDb25maWd1cmF0\naW9ucy5jbGFzcyk7DQogICAgDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAgX2xvYWRlcnMgPSBuZXcNCiAg\nICAgICAgQ29uY3VycmVudFJlZmVyZW5jZUhhc2hNYXAoQ29uY3VycmVudFJl\nZmVyZW5jZUhhc2hNYXAuV0VBSywgDQogICAgICAgICAgICAgICAgQ29uY3Vy\ncmVudFJlZmVyZW5jZUhhc2hNYXAuSEFSRCk7DQoNCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBPYmplY3QgTlVMTF9MT0FERVIgPSAibnVsbC1sb2FkZXIi\nOw0KDQogICAgLyoqDQogICAgICogUmV0dXJuIHRoZSBjbGFzcyBuYW1lIGZy\nb20gdGhlIGdpdmVuIHBsdWdpbiBzdHJpbmcsIG9yIG51bGwgaWYgbm9uZS4N\nCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBnZXRDbGFzc05h\nbWUoU3RyaW5nIHBsdWdpbikgew0KICAgICAgICByZXR1cm4gZ2V0UGx1Z2lu\nQ29tcG9uZW50KHBsdWdpbiwgdHJ1ZSk7DQogICAgfQ0KDQogICAgLyoqDQog\nICAgICogUmV0dXJuIHRoZSBwcm9wZXJ0aWVzIHBhcnQgb2YgdGhlIGdpdmVu\nIHBsdWdpbiBzdHJpbmcsIG9yIG51bGwgaWYgbm9uZS4NCiAgICAgKi8NCiAg\nICBwdWJsaWMgc3RhdGljIFN0cmluZyBnZXRQcm9wZXJ0aWVzKFN0cmluZyBw\nbHVnaW4pIHsNCiAgICAgICAgcmV0dXJuIGdldFBsdWdpbkNvbXBvbmVudChw\nbHVnaW4sIGZhbHNlKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1\ncm4gZWl0aGVyIHRoZSBjbGFzcyBuYW1lIG9yIHByb3BlcnRpZXMgc3RyaW5n\nIGZyb20gYSBwbHVnaW4gc3RyaW5nLg0KICAgICAqLw0KICAgIHByaXZhdGUg\nc3RhdGljIFN0cmluZyBnZXRQbHVnaW5Db21wb25lbnQoU3RyaW5nIHBsdWdp\nbiwgYm9vbGVhbiBjbHNOYW1lKSB7DQogICAgICAgIGlmIChwbHVnaW4gIT0g\nbnVsbCkNCiAgICAgICAgICAgIHBsdWdpbiA9IHBsdWdpbi50cmltKCk7DQog\nICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHBsdWdpbikpDQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsNCg0KICAgICAgICBpbnQgb3BlblBhcmVu\nID0gLTE7DQogICAgICAgIGlmIChwbHVnaW4uY2hhckF0KHBsdWdpbi5sZW5n\ndGgoKSAtIDEpID09ICcpJykNCiAgICAgICAgICAgIG9wZW5QYXJlbiA9IHBs\ndWdpbi5pbmRleE9mKCcoJyk7DQogICAgICAgIGlmIChvcGVuUGFyZW4gPT0g\nLTEpIHsNCiAgICAgICAgICAgIGludCBlcSA9IHBsdWdpbi5pbmRleE9mKCc9\nJyk7DQogICAgICAgICAgICBpZiAoZXEgPT0gLTEpDQogICAgICAgICAgICAg\nICAgcmV0dXJuIChjbHNOYW1lKSA/IHBsdWdpbiA6IG51bGw7DQogICAgICAg\nICAgICByZXR1cm4gKGNsc05hbWUpID8gbnVsbCA6IHBsdWdpbjsNCiAgICAg\nICAgfQ0KDQogICAgICAgIC8vIGNsc05hbWUocHJvcHMpIGZvcm0NCiAgICAg\nICAgaWYgKGNsc05hbWUpDQogICAgICAgICAgICByZXR1cm4gcGx1Z2luLnN1\nYnN0cmluZygwLCBvcGVuUGFyZW4pLnRyaW0oKTsNCiAgICAgICAgU3RyaW5n\nIHByb3AgPSBwbHVnaW4uc3Vic3RyaW5nKG9wZW5QYXJlbiArIDEsDQogICAg\nICAgICAgICBwbHVnaW4ubGVuZ3RoKCkgLSAxKS50cmltKCk7DQogICAgICAg\nIHJldHVybiAocHJvcC5sZW5ndGgoKSA9PSAwKSA/IG51bGwgOiBwcm9wOw0K\nICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENvbWJpbmUgdGhlIGdpdmVuIGNs\nYXNzIG5hbWUgYW5kIHByb3BlcnRpZXMgaW50byBhIHBsdWdpbiBzdHJpbmcu\nDQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgZ2V0UGx1Z2lu\nKFN0cmluZyBjbHNOYW1lLCBTdHJpbmcgcHJvcHMpIHsNCiAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmlzRW1wdHkoY2xzTmFtZSkpDQogICAgICAgICAgICBy\nZXR1cm4gcHJvcHM7DQogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5\nKHByb3BzKSkNCiAgICAgICAgICAgIHJldHVybiBjbHNOYW1lOw0KICAgICAg\nICByZXR1cm4gY2xzTmFtZSArICIoIiArIHByb3BzICsgIikiOw0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIFJldHVybiBhIHBsdWdpbiBzdHJpbmcgdGhh\ndCBjb21iaW5lcyB0aGUgcHJvcGVydGllcyBvZiB0aGUgZ2l2ZW4gcGx1Z2lu\nDQogICAgICogc3RyaW5ncywgd2hlcmUgcHJvcGVydGllcyBvZiA8Y29kZT5v\ndmVycmlkZTwvY29kZT4gd2lsbCBvdmVycmlkZSB0aGUNCiAgICAgKiBzYW1l\nIHByb3BlcnRpZXMgb2YgPGNvZGU+b3JpZzwvY29kZT4uDQogICAgICovDQog\nICAgcHVibGljIHN0YXRpYyBTdHJpbmcgY29tYmluZVBsdWdpbnMoU3RyaW5n\nIG9yaWcsIFN0cmluZyBvdmVycmlkZSkgew0KICAgICAgICBpZiAoU3RyaW5n\nVXRpbHMuaXNFbXB0eShvcmlnKSkNCiAgICAgICAgICAgIHJldHVybiBvdmVy\ncmlkZTsNCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkob3ZlcnJp\nZGUpKQ0KICAgICAgICAgICAgcmV0dXJuIG9yaWc7DQoNCiAgICAgICAgU3Ry\naW5nIG9yaWdDbHMgPSBnZXRDbGFzc05hbWUob3JpZyk7DQogICAgICAgIFN0\ncmluZyBvdmVycmlkZUNscyA9IGdldENsYXNzTmFtZShvdmVycmlkZSk7DQog\nICAgICAgIFN0cmluZyBjbHM7DQogICAgICAgIGlmIChTdHJpbmdVdGlscy5p\nc0VtcHR5KG9yaWdDbHMpKQ0KICAgICAgICAgICAgY2xzID0gb3ZlcnJpZGVD\nbHM7DQogICAgICAgIGVsc2UgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkob3Zl\ncnJpZGVDbHMpKQ0KICAgICAgICAgICAgY2xzID0gb3JpZ0NsczsNCiAgICAg\nICAgZWxzZSBpZiAoIW9yaWdDbHMuZXF1YWxzKG92ZXJyaWRlQ2xzKSkNCiAg\nICAgICAgICAgIHJldHVybiBvdmVycmlkZTsgLy8gY29tcGxldGVseSBkaWZm\nZXJlbnQgcGx1Z2luDQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIGNscyA9\nIG9yaWdDbHM7DQoNCiAgICAgICAgU3RyaW5nIG9yaWdQcm9wcyA9IGdldFBy\nb3BlcnRpZXMob3JpZyk7DQogICAgICAgIFN0cmluZyBvdmVycmlkZVByb3Bz\nID0gZ2V0UHJvcGVydGllcyhvdmVycmlkZSk7DQogICAgICAgIGlmIChTdHJp\nbmdVdGlscy5pc0VtcHR5KG9yaWdQcm9wcykpDQogICAgICAgICAgICByZXR1\ncm4gZ2V0UGx1Z2luKGNscywgb3ZlcnJpZGVQcm9wcyk7DQogICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KG92ZXJyaWRlUHJvcHMpKQ0KICAgICAg\nICAgICAgcmV0dXJuIGdldFBsdWdpbihjbHMsIG9yaWdQcm9wcyk7DQoNCiAg\nICAgICAgUHJvcGVydGllcyBwcm9wcyA9IHBhcnNlUHJvcGVydGllcyhvcmln\nUHJvcHMpOw0KICAgICAgICBwcm9wcy5wdXRBbGwocGFyc2VQcm9wZXJ0aWVz\nKG92ZXJyaWRlUHJvcHMpKTsNCiAgICAgICAgcmV0dXJuIGdldFBsdWdpbihj\nbHMsIHNlcmlhbGl6ZVByb3BlcnRpZXMocHJvcHMpKTsgDQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogQ3JlYXRlIHRoZSBpbnN0YW5jZSB3aXRoIHRoZSBn\naXZlbiBjbGFzcyBuYW1lLCB1c2luZyB0aGUgZ2l2ZW4NCiAgICAgKiBjbGFz\ncyBsb2FkZXIuIE5vIGNvbmZpZ3VyYXRpb24gb2YgdGhlIGluc3RhbmNlIGlz\nIHBlcmZvcm1lZCBieQ0KICAgICAqIHRoaXMgbWV0aG9kLg0KICAgICAqLw0K\nICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IG5ld0luc3RhbmNlKFN0cmluZyBj\nbHNOYW1lLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsNCiAgICAgICAgcmV0dXJu\nIG5ld0luc3RhbmNlKGNsc05hbWUsIG51bGwsIG51bGwsIGxvYWRlciwgdHJ1\nZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ3JlYXRlIGFuZCBjb25m\naWd1cmUgYW4gaW5zdGFuY2Ugd2l0aCB0aGUgZ2l2ZW4gY2xhc3MgbmFtZSBh\nbmQNCiAgICAgKiBwcm9wZXJ0aWVzLg0KICAgICAqLw0KICAgIHB1YmxpYyBz\ndGF0aWMgT2JqZWN0IG5ld0luc3RhbmNlKFN0cmluZyBjbHNOYW1lLCBDb25m\naWd1cmF0aW9uIGNvbmYsDQogICAgICAgIFN0cmluZyBwcm9wcywgQ2xhc3NM\nb2FkZXIgbG9hZGVyKSB7DQogICAgICAgIE9iamVjdCBvYmogPSBuZXdJbnN0\nYW5jZShjbHNOYW1lLCBudWxsLCBjb25mLCBsb2FkZXIsIHRydWUpOw0KICAg\nICAgICBjb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYsIHByb3BzKTsNCiAg\nICAgICAgcmV0dXJuIG9iajsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBI\nZWxwZXIgbWV0aG9kIHVzZWQgYnkgbWVtYmVycyBvZiB0aGlzIHBhY2thZ2Ug\ndG8gaW5zdGFudGlhdGUgcGx1Z2luDQogICAgICogdmFsdWVzLg0KICAgICAq\nLw0KICAgIHN0YXRpYyBPYmplY3QgbmV3SW5zdGFuY2UoU3RyaW5nIGNsc05h\nbWUsIFZhbHVlIHZhbCwgQ29uZmlndXJhdGlvbiBjb25mLA0KICAgICAgICBD\nbGFzc0xvYWRlciBsb2FkZXIsIGJvb2xlYW4gZmF0YWwpIHsNCiAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoY2xzTmFtZSkpDQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsNCg0KICAgICAgICBDbGFzcyBjbHMgPSBudWxsOyAN\nCg0KICAgICAgICB3aGlsZSAoY2xzID09IG51bGwpIHsNCiAgICAgICAgICAg\nIC8vIGNhbid0IGhhdmUgYSBudWxsIHJlZmVyZW5jZSBpbiB0aGUgbWFwLCBz\nbyB1c2Ugc3ltYm9saWMNCiAgICAgICAgICAgIC8vIGNvbnN0YW50IGFzIGtl\neQ0KICAgICAgICAgICAgT2JqZWN0IGtleSA9IGxvYWRlciA9PSBudWxsID8g\nTlVMTF9MT0FERVIgOiBsb2FkZXI7DQogICAgICAgICAgICBNYXAgbG9hZGVy\nQ2FjaGUgPSAoTWFwKSBfbG9hZGVycy5nZXQoa2V5KTsNCiAgICAgICAgICAg\nIGlmIChsb2FkZXJDYWNoZSA9PSBudWxsKSB7IC8vIFdlIGRvbid0IGhhdmUg\nYSBjYWNoZSBmb3IgdGhpcyBsb2FkZXIuDQogICAgICAgICAgICAgICAgbG9h\nZGVyQ2FjaGUgPSBuZXcgQ29uY3VycmVudEhhc2hNYXAoKTsNCiAgICAgICAg\nICAgICAgICBfbG9hZGVycy5wdXQoa2V5LCBsb2FkZXJDYWNoZSk7DQogICAg\nICAgICAgICB9IGVsc2UgeyAgLy8gV2UgaGF2ZSBhIGNhY2hlIGZvciB0aGlz\nIGxvYWRlci4NCiAgICAgICAgICAgICAgICBjbHMgPSAoQ2xhc3MpIGxvYWRl\nckNhY2hlLmdldChjbHNOYW1lKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAg\nICAgICAgaWYgKGNscyA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgdHJ5\nIHsNCiAgICAgICAgICAgICAgICAgICAgY2xzID0gU3RyaW5ncy50b0NsYXNz\nKGNsc05hbWUsIGZpbmREZXJpdmVkTG9hZGVyKGNvbmYsDQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbG9hZGVyKSk7DQogICAgICAgICAgICAgICAg\nICAgIGxvYWRlckNhY2hlLnB1dChjbHNOYW1lLCBjbHMpOw0KICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsNCiAgICAg\nICAgICAgICAgICAgICAgaWYgKGxvYWRlciAhPSBudWxsKSAgLy8gVHJ5IG9u\nZSBtb3JlIHRpbWUgd2l0aCBsb2FkZXI9bnVsbA0KICAgICAgICAgICAgICAg\nICAgICAgICAgbG9hZGVyID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAg\nZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsICE9IG51\nbGwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmUgPSBnZXRDcmVh\ndGVFeGNlcHRpb24oY2xzTmFtZSwgdmFsLCByZSk7DQogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoZmF0YWwpDQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgcmU7DQogICAgICAgICAgICAgICAgICAgICAgICBMb2cg\nbG9nID0gKGNvbmYgPT0gbnVsbCkgPyBudWxsIDogY29uZg0KICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29uZmlndXJhdGlvbkxvZygp\nOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvZyAhPSBudWxsICYm\nIGxvZy5pc0Vycm9yRW5hYmxlZCgpKQ0KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxvZy5lcnJvcihfbG9jDQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAuZ2V0KCJwbHVnaW4tY3JlYXRpb24tZXhjZXB0aW9u\nIiwgdmFsKSwgcmUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAg\nICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICB0cnkg\new0KICAgICAgICAgICAgcmV0dXJuIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKA0KICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0lu\nc3RhbmNlQWN0aW9uKGNscykpOw0KICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgew0KICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBQcml2aWxl\nZ2VkQWN0aW9uRXhjZXB0aW9uKSB7DQogICAgICAgICAgICAgICAgZSA9ICgo\nUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgZSkuZ2V0RXhjZXB0aW9uKCk7\nICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICBSdW50aW1lRXhjZXB0\naW9uIHJlID0gbmV3IE5lc3RhYmxlUnVudGltZUV4Y2VwdGlvbihfbG9jLmdl\ndA0KICAgICAgICAgICAgICAgICgib2JqLWNyZWF0ZSIsIGNscykuZ2V0TWVz\nc2FnZSgpLCBlKTsNCiAgICAgICAgICAgIGlmIChmYXRhbCkNCiAgICAgICAg\nICAgICAgICB0aHJvdyByZTsNCiAgICAgICAgICAgIExvZyBsb2cgPSAoY29u\nZiA9PSBudWxsKSA/IG51bGwgOiBjb25mLmdldENvbmZpZ3VyYXRpb25Mb2co\nKTsNCiAgICAgICAgICAgIGlmIChsb2cgIT0gbnVsbCAmJiBsb2cuaXNFcnJv\nckVuYWJsZWQoKSkNCiAgICAgICAgICAgICAgICBsb2cuZXJyb3IoX2xvYy5n\nZXQoInBsdWdpbi1jcmVhdGlvbi1leGNlcHRpb24iLCB2YWwpLCByZSk7DQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCg0K\nICAgIC8qKg0KICAgICAqIEF0dGVtcHQgdG8gZmluZCBhIGRlcml2ZWQgbG9h\nZGVyIHRoYXQgZGVsZWdhdGVzIHRvIG91ciB0YXJnZXQgbG9hZGVyLg0KICAg\nICAqIFRoaXMgYWxsb3dzIGFwcGxpY2F0aW9uIGxvYWRlcnMgdGhhdCBkZWxl\nZ2F0ZSBhcHByb3ByaWF0ZWx5IGZvciBrbm93bg0KICAgICAqIGNsYXNzZXMg\nZmlyc3QgY3JhY2sgYXQgY2xhc3MgbmFtZXMuDQogICAgICovDQogICAgcHJp\ndmF0ZSBzdGF0aWMgQ2xhc3NMb2FkZXIgZmluZERlcml2ZWRMb2FkZXIoQ29u\nZmlndXJhdGlvbiBjb25mLA0KICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIp\nIHsNCiAgICAgICAgLy8gd2UgYWx3YXlzIHByZWZlciB0aGUgdGhyZWFkIGxv\nYWRlciwgYmVjYXVzZSBpdCdzIHRoZSBvbmx5IHRoaW5nIHdlDQogICAgICAg\nIC8vIGNhbiBhY2Nlc3MgdGhhdCBpc24ndCBib3VuZCB0byB0aGUgT3BlbkpQ\nQSBjbGFzc2xvYWRlciwgdW5sZXNzDQogICAgICAgIC8vIHRoZSBjb25mIG9i\namVjdCBpcyBvZiBhIGN1c3RvbSBjbGFzcw0KICAgICAgICBDbGFzc0xvYWRl\nciBjdHhMb2FkZXIgPSAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKA0KICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0\nQ29udGV4dENsYXNzTG9hZGVyQWN0aW9uKCkpOw0KICAgICAgICBpZiAobG9h\nZGVyID09IG51bGwpIHsNCiAgICAgICAgICAgIGlmIChjdHhMb2FkZXIgIT0g\nbnVsbCkNCiAgICAgICAgICAgICAgICByZXR1cm4gY3R4TG9hZGVyOw0KICAg\nICAgICAgICAgaWYgKGNvbmYgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICBy\nZXR1cm4gKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgNCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0\nQ2xhc3NMb2FkZXJBY3Rpb24oY29uZi5nZXRDbGFzcygpKSk7IA0KICAgICAg\nICAgICAgcmV0dXJuIENvbmZpZ3VyYXRpb25zLmNsYXNzLmdldENsYXNzTG9h\nZGVyKCk7DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKENsYXNzTG9hZGVy\nIHBhcmVudCA9IGN0eExvYWRlcjsgcGFyZW50ICE9IG51bGw7IA0KICAgICAg\nICAgICAgcGFyZW50ID0gKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgNCiAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5nZXRQYXJlbnRBY3Rpb24ocGFyZW50KSkpIHsNCiAgICAgICAgICAgIGlm\nIChwYXJlbnQgPT0gbG9hZGVyKQ0KICAgICAgICAgICAgICAgIHJldHVybiBj\ndHhMb2FkZXI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNvbmYgIT0gbnVs\nbCkgew0KICAgICAgICAgICAgZm9yIChDbGFzc0xvYWRlciBwYXJlbnQgPSAo\nQ2xhc3NMb2FkZXIpDQogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoDQogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2\nSGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGNvbmYuZ2V0Q2xhc3MoKSkp\nOyANCiAgICAgICAgICAgICAgICBwYXJlbnQgIT0gbnVsbDsgDQogICAgICAg\nICAgICAgICAgcGFyZW50ID0gKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgNCiAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIuZ2V0UGFyZW50QWN0aW9uKHBhcmVudCkpKSB7DQogICAgICAg\nICAgICAgICAgaWYgKHBhcmVudCA9PSBsb2FkZXIpDQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKA0KICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1By\naXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24oY29uZi5nZXRDbGFzcygp\nKSk7IA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVy\nbiBsb2FkZXI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJuIGEg\nTGlzdDxTdHJpbmc+IG9mIGFsbCB0aGUgZnVsbHktcXVhbGlmaWVkIGFuY2hv\ncnMgc3BlY2lmaWVkIGluIHRoZQ0KICAgICAqIHByb3BlcnRpZXMgbG9jYXRp\nb24gbGlzdGVkIGluIDxjb2RlPm9wdHM8L2NvZGU+LiBJZiBubyBwcm9wZXJ0\naWVzDQogICAgICogbG9jYXRpb24gaXMgbGlzdGVkIGluIDxjb2RlPm9wdHM8\nL2NvZGU+LCB0aGlzIHJldHVybnMgd2hhdGV2ZXIgdGhlDQogICAgICogcHJv\nZHVjdCBkZXJpdmF0aW9ucyBjYW4gZmluZCBpbiB0aGVpciBkZWZhdWx0IGNv\nbmZpZ3VyYXRpb25zLg0KICAgICAqIElmIHRoZSBwcm9wZXJ0aWVzIGxvY2F0\naW9uIHNwZWNpZmllZCBpbiA8Y29kZT5vcHRzPC9jb2RlPiBhbHJlYWR5DQog\nICAgICogY29udGFpbnMgYW4gYW5jaG9yIHNwZWMsIHRoaXMgcmV0dXJucyB0\naGF0IGFuY2hvci4gTm90ZSB0aGF0IGluIHRoaXMNCiAgICAgKiBmdWxseS1x\ndWFsaWZpZWQtaW5wdXQgY2FzZSwgdGhlIGxvZ2ljIGludm9sdmluZyBwcm9k\ndWN0IGRlcml2YXRpb25zDQogICAgICogYW5kIHJlc291cmNlIHBhcnNpbmcg\naXMgc2hvcnQtY2lyY3VpdGVkLCBzbyB0aGlzIG1ldGhvZA0KICAgICAqIHNo\nb3VsZCBub3QgYmUgdXNlZCBhcyBhIG1lYW5zIHRvIHRlc3QgdGhhdCBhIHBh\ncnRpY3VsYXIgYW5jaG9yIGlzDQogICAgICogZGVmaW5lZCBpbiBhIGdpdmVu\nIGxvY2F0aW9uIGJ5IGludm9raW5nIHdpdGggYSBmdWxseS1xdWFsaWZpZWQg\nYW5jaG9yLg0KICAgICAqDQogICAgICogVGhpcyBkb2VzIG5vdCBtdXRhdGUg\nPGNvZGU+b3B0czwvY29kZT4uDQogICAgICoNCiAgICAgKiBAc2luY2UgMS4x\nLjANCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIExpc3QgZ2V0RnVsbHlR\ndWFsaWZpZWRBbmNob3JzSW5Qcm9wZXJ0aWVzTG9jYXRpb24oDQogICAgICAg\nIE9wdGlvbnMgb3B0cykgew0KICAgICAgICBTdHJpbmcgcHJvcHMgPSBvcHRz\nLmdldFByb3BlcnR5KCJwcm9wZXJ0aWVzIiwgInAiLCBudWxsKTsNCiAgICAg\nICAgaWYgKHByb3BzICE9IG51bGwpIHsNCiAgICAgICAgICAgIGludCBhbmNo\nb3JQb3NpdGlvbiA9IHByb3BzLmluZGV4T2YoIiMiKTsNCiAgICAgICAgICAg\nIGlmIChhbmNob3JQb3NpdGlvbiA+IC0xKQ0KICAgICAgICAgICAgICAgIHJl\ndHVybiBBcnJheXMuYXNMaXN0KG5ldyBTdHJpbmdbXSB7IHByb3BzIH0pOw0K\nICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIFByb2R1Y3REZXJpdmF0aW9u\ncy5nZXRGdWxseVF1YWxpZmllZEFuY2hvcnNJblByb3BlcnRpZXNMb2NhdGlv\nbigNCiAgICAgICAgICAgIHByb3BzKTsNCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBTZXQgdGhlIGdpdmVuIHtAbGluayBDb25maWd1cmF0aW9ufSBpbnN0\nYW5jZSBmcm9tIHRoZSBjb21tYW5kIGxpbmUNCiAgICAgKiBvcHRpb25zIHBy\nb3ZpZGVkLiBBbGwgcHJvcGVydHkgbmFtZXMgb2YgdGhlIGdpdmVuIGNvbmZp\nZ3VyYXRpb24gYXJlDQogICAgICogcmVjb2duaXplZDsgYWRkaXRpb25hbGx5\nLCBpZiBhIDxjb2RlPnByb3BlcnRpZXM8L2NvZGU+IG9yDQogICAgICogPGNv\nZGU+cDwvY29kZT4gYXJndW1lbnQgZXhpc3RzLCB0aGUgcmVzb3VyY2UgaXQN\nCiAgICAgKiBwb2ludHMgdG8gd2lsbCBiZSBsb2FkZWQgYW5kIHNldCBpbnRv\nIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGluc3RhbmNlLg0KICAgICAqIEl0\nIGNhbiBwb2ludCB0byBlaXRoZXIgYSBmaWxlIG9yIGEgcmVzb3VyY2UgbmFt\nZS4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgcG9wdWxhdGVD\nb25maWd1cmF0aW9uKENvbmZpZ3VyYXRpb24gY29uZiwgT3B0aW9ucyBvcHRz\nKSB7DQogICAgICAgIFN0cmluZyBwcm9wcyA9IG9wdHMucmVtb3ZlUHJvcGVy\ndHkoInByb3BlcnRpZXMiLCAicCIsIG51bGwpOw0KICAgICAgICBDb25maWd1\ncmF0aW9uUHJvdmlkZXIgcHJvdmlkZXI7DQogICAgICAgIGlmICghU3RyaW5n\nVXRpbHMuaXNFbXB0eShwcm9wcykpIHsNCiAgICAgICAgICAgIFN0cmluZyBw\nYXRoID0gcHJvcHM7DQogICAgICAgICAgICBTdHJpbmcgYW5jaG9yID0gbnVs\nbDsNCiAgICAgICAgICAgIGludCBpZHggPSBwYXRoLmxhc3RJbmRleE9mKCcj\nJyk7DQogICAgICAgICAgICBpZiAoaWR4ICE9IC0xKSB7DQogICAgICAgICAg\nICAgICAgaWYgKGlkeCA8IHBhdGgubGVuZ3RoKCkgLSAxKQ0KICAgICAgICAg\nICAgICAgICAgICBhbmNob3IgPSBwYXRoLnN1YnN0cmluZyhpZHggKyAxKTsN\nCiAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHJpbmcoMCwgaWR4\nKTsNCiAgICAgICAgICAgICAgICBpZiAocGF0aC5sZW5ndGgoKSA9PSAwKQ0K\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWlzc2luZ1Jlc291cmNl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJhbmNob3Itb25seSIsDQogICAgICAgICAg\nICAgICAgICAgICAgICBwcm9wcykuZ2V0TWVzc2FnZSgpLCBDb25maWd1cmF0\naW9ucy5jbGFzcy5nZXROYW1lKCksIA0KICAgICAgICAgICAgICAgICAgICAg\nICAgcHJvcHMpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBGaWxl\nIGZpbGUgPSBuZXcgRmlsZShwYXRoKTsNCiAgICAgICAgICAgIGlmICgoKEJv\nb2xlYW4pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2\nSGVscGVyDQogICAgICAgICAgICAgICAgLmlzRmlsZUFjdGlvbihmaWxlKSkp\nLmJvb2xlYW5WYWx1ZSgpKQ0KICAgICAgICAgICAgICAgIHByb3ZpZGVyID0g\nUHJvZHVjdERlcml2YXRpb25zLmxvYWQoZmlsZSwgYW5jaG9yLCBudWxsKTsN\nCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGZpbGUgPSBu\nZXcgRmlsZSgiTUVUQS1JTkYiICsgRmlsZS5zZXBhcmF0b3JDaGFyICsgcGF0\naCk7DQogICAgICAgICAgICAgICAgaWYgKCgoQm9vbGVhbikgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXINCiAgICAgICAg\nICAgICAgICAgICAgLmlzRmlsZUFjdGlvbihmaWxlKSkpLmJvb2xlYW5WYWx1\nZSgpKQ0KICAgICAgICAgICAgICAgICAgICBwcm92aWRlciA9IFByb2R1Y3RE\nZXJpdmF0aW9ucy5sb2FkKGZpbGUsIGFuY2hvciwgbnVsbCk7DQogICAgICAg\nICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICBwcm92aWRlciA9\nIFByb2R1Y3REZXJpdmF0aW9ucy5sb2FkKHBhdGgsIGFuY2hvciwgbnVsbCk7\nDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocHJvdmlkZXIgIT0g\nbnVsbCkNCiAgICAgICAgICAgICAgICBwcm92aWRlci5zZXRJbnRvKGNvbmYp\nOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNaXNzaW5nUmVzb3VyY2VFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXByb3Zp\nZGVyIiwNCiAgICAgICAgICAgICAgICAgICAgcHJvcHMpLmdldE1lc3NhZ2Uo\nKSwgQ29uZmlndXJhdGlvbnMuY2xhc3MuZ2V0TmFtZSgpLCANCiAgICAgICAg\nICAgICAgICAgICAgcHJvcHMpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAg\nICAgICAgcHJvdmlkZXIgPSBQcm9kdWN0RGVyaXZhdGlvbnMubG9hZERlZmF1\nbHRzKG51bGwpOw0KICAgICAgICAgICAgaWYgKHByb3ZpZGVyICE9IG51bGwp\nDQogICAgICAgICAgICAgICAgcHJvdmlkZXIuc2V0SW50byhjb25mKTsNCiAg\nICAgICAgfQ0KICAgICAgICBvcHRzLnNldEludG8oY29uZik7DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogSGVscGVyIG1ldGhvZCB0byB0aHJvdyBhbiBp\nbmZvcm1hdGl2ZSBkZXNjcmlwdGlvbiBvbiBpbnN0YW50aWF0aW9uIGVycm9y\nLg0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIFJ1bnRpbWVFeGNlcHRp\nb24gZ2V0Q3JlYXRlRXhjZXB0aW9uKFN0cmluZyBjbHNOYW1lLA0KICAgICAg\nICBWYWx1ZSB2YWwsIEV4Y2VwdGlvbiBlKSB7DQogICAgICAgIC8vIHJlLXRo\ncm93IHRoZSBleGNlcHRpb24gd2l0aCBzb21lIGJldHRlciBpbmZvcm1hdGlv\nbg0KICAgICAgICBmaW5hbCBTdHJpbmcgbXNnOw0KICAgICAgICBmaW5hbCBP\nYmplY3RbXSBwYXJhbXM7DQoNCiAgICAgICAgU3RyaW5nIGFsaWFzID0gdmFs\nLmFsaWFzKGNsc05hbWUpOw0KICAgICAgICBTdHJpbmdbXSBhbGlhc2VzID0g\ndmFsLmdldEFsaWFzZXMoKTsNCiAgICAgICAgU3RyaW5nW10ga2V5czsNCiAg\nICAgICAgaWYgKGFsaWFzZXMubGVuZ3RoID09IDApDQogICAgICAgICAgICBr\nZXlzID0gYWxpYXNlczsNCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBr\nZXlzID0gbmV3IFN0cmluZ1thbGlhc2VzLmxlbmd0aCAvIDJdOw0KICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhbGlhc2VzLmxlbmd0aDsgaSAr\nPSAyKQ0KICAgICAgICAgICAgICAgIGtleXNbaSAvIDJdID0gYWxpYXNlc1tp\nXTsNCiAgICAgICAgfQ0KDQogICAgICAgIFN0cmluZyBjbG9zZXN0Ow0KICAg\nICAgICBpZiAoa2V5cy5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgbXNn\nID0gImludmFsaWQtcGx1Z2luIjsNCiAgICAgICAgICAgIHBhcmFtcyA9IG5l\ndyBPYmplY3RbXXsgdmFsLmdldFByb3BlcnR5KCksIGFsaWFzLCBlLnRvU3Ry\naW5nKCksIH07DQogICAgICAgIH0gZWxzZSBpZiAoKGNsb3Nlc3QgPSBTdHJp\nbmdEaXN0YW5jZS5nZXRDbG9zZXN0TGV2ZW5zaHRlaW5EaXN0YW5jZQ0KICAg\nICAgICAgICAgKGFsaWFzLCBrZXlzLCAwLjVmKSkgPT0gbnVsbCkgew0KICAg\nICAgICAgICAgbXNnID0gImludmFsaWQtcGx1Z2luLWFsaWFzZXMiOw0KICAg\nICAgICAgICAgcGFyYW1zID0gbmV3IE9iamVjdFtdew0KICAgICAgICAgICAg\nICAgIHZhbC5nZXRQcm9wZXJ0eSgpLCBhbGlhcywgZS50b1N0cmluZygpLA0K\nICAgICAgICAgICAgICAgIG5ldyBUcmVlU2V0KEFycmF5cy5hc0xpc3Qoa2V5\ncykpLCB9Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbXNnID0g\nImludmFsaWQtcGx1Z2luLWFsaWFzZXMtaGludCI7DQogICAgICAgICAgICBw\nYXJhbXMgPSBuZXcgT2JqZWN0W117DQogICAgICAgICAgICAgICAgdmFsLmdl\ndFByb3BlcnR5KCksIGFsaWFzLCBlLnRvU3RyaW5nKCksDQogICAgICAgICAg\nICAgICAgbmV3IFRyZWVTZXQoQXJyYXlzLmFzTGlzdChrZXlzKSksIGNsb3Nl\nc3QsIH07DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5ldyBQYXJzZUV4\nY2VwdGlvbihfbG9jLmdldChtc2csIHBhcmFtcyksIGUpOw0KICAgIH0NCg0K\nICAgIC8qKg0KICAgICAqIENvbmZpZ3VyZXMgdGhlIGdpdmVuIG9iamVjdCB3\naXRoIHRoZSBnaXZlbiBwcm9wZXJ0aWVzIGJ5DQogICAgICogbWF0Y2hpbmcg\ndGhlIHByb3BlcnRpZXMgc3RyaW5nIHRvIHRoZSBvYmplY3QncyBzZXR0ZXIN\nCiAgICAgKiBtZXRob2RzLiBUaGUgcHJvcGVydGllcyBzdHJpbmcgc2hvdWxk\nIGJlIGluIHRoZSBmb3JtDQogICAgICogInByb3AxPXZhbDEsIHByb3AyPXZh\nbDIgLi4uIi4gRG9lcyBub3QgdmFsaWRhdGUgdGhhdCBzZXR0ZXINCiAgICAg\nKiBtZXRob2RzIGV4aXN0IGZvciB0aGUgcHJvcGVydGllcy4NCiAgICAgKg0K\nICAgICAqIEB0aHJvd3MgUnVudGltZUV4Y2VwdGlvbiBvbiBjb25maWd1cmF0\naW9uIGVycm9yDQogICAgICovDQogICAgcHVibGljIHN0YXRpYyB2b2lkIGNv\nbmZpZ3VyZUluc3RhbmNlKE9iamVjdCBvYmosIENvbmZpZ3VyYXRpb24gY29u\nZiwNCiAgICAgICAgU3RyaW5nIHByb3BlcnRpZXMpIHsNCiAgICAgICAgY29u\nZmlndXJlSW5zdGFuY2Uob2JqLCBjb25mLCBwcm9wZXJ0aWVzLCBudWxsKTsN\nCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb25maWd1cmVzIHRoZSBnaXZl\nbiBvYmplY3Qgd2l0aCB0aGUgZ2l2ZW4gcHJvcGVydGllcyBieQ0KICAgICAq\nIG1hdGNoaW5nIHRoZSBwcm9wZXJ0aWVzIHN0cmluZyB0byB0aGUgb2JqZWN0\nJ3Mgc2V0dGVyDQogICAgICogbWV0aG9kcy4gVGhlIHByb3BlcnRpZXMgc3Ry\naW5nIHNob3VsZCBiZSBpbiB0aGUgZm9ybQ0KICAgICAqICJwcm9wMT12YWwx\nLCBwcm9wMj12YWwyIC4uLiIuIFZhbGlkYXRlcyB0aGF0IHNldHRlciBtZXRo\nb2RzDQogICAgICogZXhpc3QgZm9yIHRoZSBwcm9wZXJ0aWVzLg0KICAgICAq\nDQogICAgICogQHRocm93cyBSdW50aW1lRXhjZXB0aW9uIG9uIGNvbmZpZ3Vy\nYXRpb24gZXJyb3INCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQg\nY29uZmlndXJlSW5zdGFuY2UoT2JqZWN0IG9iaiwgQ29uZmlndXJhdGlvbiBj\nb25mLA0KICAgICAgICBTdHJpbmcgcHJvcGVydGllcywgU3RyaW5nIGNvbmZp\nZ3VyYXRpb25OYW1lKSB7DQogICAgICAgIGlmIChvYmogPT0gbnVsbCkNCiAg\nICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICBQcm9wZXJ0aWVzIHByb3Bz\nID0gbnVsbDsNCiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KHBy\nb3BlcnRpZXMpKQ0KICAgICAgICAgICAgcHJvcHMgPSBwYXJzZVByb3BlcnRp\nZXMocHJvcGVydGllcyk7DQogICAgICAgIGNvbmZpZ3VyZUluc3RhbmNlKG9i\naiwgY29uZiwgcHJvcHMsIGNvbmZpZ3VyYXRpb25OYW1lKTsNCiAgICB9DQoN\nCiAgICAvKioNCiAgICAgKiBDb25maWd1cmVzIHRoZSBnaXZlbiBvYmplY3Qg\nd2l0aCB0aGUgZ2l2ZW4gcHJvcGVydGllcyBieQ0KICAgICAqIG1hdGNoaW5n\nIHRoZSBwcm9wZXJ0aWVzIHN0cmluZyB0byB0aGUgb2JqZWN0J3Mgc2V0dGVy\nDQogICAgICogbWV0aG9kcy4gRG9lcyBub3QgdmFsaWRhdGUgdGhhdCBzZXR0\nZXIgbWV0aG9kcyBleGlzdCBmb3IgdGhlIHByb3BlcnRpZXMuDQogICAgICoN\nCiAgICAgKiBAdGhyb3dzIFJ1bnRpbWVFeGNlcHRpb24gb24gY29uZmlndXJh\ndGlvbiBlcnJvcg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBj\nb25maWd1cmVJbnN0YW5jZShPYmplY3Qgb2JqLCBDb25maWd1cmF0aW9uIGNv\nbmYsDQogICAgICAgIFByb3BlcnRpZXMgcHJvcGVydGllcykgew0KICAgICAg\nICBjb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYsIHByb3BlcnRpZXMsIG51\nbGwpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENvbmZpZ3VyZXMgdGhl\nIGdpdmVuIG9iamVjdCB3aXRoIHRoZSBnaXZlbiBwcm9wZXJ0aWVzIGJ5DQog\nICAgICogbWF0Y2hpbmcgdGhlIHByb3BlcnRpZXMgc3RyaW5nIHRvIHRoZSBv\nYmplY3QncyBzZXR0ZXINCiAgICAgKiBtZXRob2RzLiBJZiA8Y29kZT5jb25m\naWd1cmF0aW9uTmFtZTwvY29kZT4gaXMNCiAgICAgKiBub24tPGNvZGU+bnVs\nbDwvY29kZT4sIHZhbGlkYXRlcyB0aGF0IHNldHRlciBtZXRob2RzIGV4aXN0\nIGZvcg0KICAgICAqIHRoZSBwcm9wZXJ0aWVzLg0KICAgICAqDQogICAgICog\nQHRocm93cyBSdW50aW1lRXhjZXB0aW9uIG9uIGNvbmZpZ3VyYXRpb24gZXJy\nb3INCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgY29uZmlndXJl\nSW5zdGFuY2UoT2JqZWN0IG9iaiwgQ29uZmlndXJhdGlvbiBjb25mLA0KICAg\nICAgICBQcm9wZXJ0aWVzIHByb3BlcnRpZXMsIFN0cmluZyBjb25maWd1cmF0\naW9uTmFtZSkgew0KICAgICAgICBpZiAob2JqID09IG51bGwpDQogICAgICAg\nICAgICByZXR1cm47DQoNCiAgICAgICAgT3B0aW9ucyBvcHRzOw0KICAgICAg\nICBpZiAocHJvcGVydGllcyBpbnN0YW5jZW9mIE9wdGlvbnMpDQogICAgICAg\nICAgICBvcHRzID0gKE9wdGlvbnMpIHByb3BlcnRpZXM7DQogICAgICAgIGVs\nc2UgeyANCiAgICAgICAgICAgIG9wdHMgPSBuZXcgT3B0aW9ucygpOw0KICAg\nICAgICAgICAgaWYgKHByb3BlcnRpZXMgIT0gbnVsbCkNCiAgICAgICAgICAg\nICAgICBvcHRzLnB1dEFsbChwcm9wZXJ0aWVzKTsNCiAgICAgICAgfQ0KDQog\nICAgICAgIENvbmZpZ3VyYWJsZSBjb25maWd1cmFibGUgPSBudWxsOw0KICAg\nICAgICBpZiAoY29uZiAhPSBudWxsICYmIG9iaiBpbnN0YW5jZW9mIENvbmZp\nZ3VyYWJsZSkNCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZSA9IChDb25maWd1\ncmFibGUpIG9iajsNCg0KICAgICAgICBpZiAoY29uZmlndXJhYmxlICE9IG51\nbGwpIHsNCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZS5zZXRDb25maWd1cmF0\naW9uKGNvbmYpOw0KICAgICAgICAgICAgY29uZmlndXJhYmxlLnN0YXJ0Q29u\nZmlndXJhdGlvbigpOw0KICAgICAgICB9DQogICAgICAgIE9wdGlvbnMgaW52\nYWxpZEVudHJpZXMgPSBvcHRzLnNldEludG8ob2JqKTsNCiAgICAgICAgaWYg\nKG9iaiBpbnN0YW5jZW9mIEdlbmVyaWNDb25maWd1cmFibGUpDQogICAgICAg\nICAgICAoKEdlbmVyaWNDb25maWd1cmFibGUpIG9iaikuc2V0SW50byhpbnZh\nbGlkRW50cmllcyk7DQoNCgkJaWYgKCFpbnZhbGlkRW50cmllcy5pc0VtcHR5\nKCkgJiYgY29uZmlndXJhdGlvbk5hbWUgIT0gbnVsbCkgew0KCQkJTG9jYWxp\nemVyLk1lc3NhZ2UgbXNnID0gbnVsbDsNCgkJCVN0cmluZyBmaXJzdCA9IChT\ndHJpbmcpIGludmFsaWRFbnRyaWVzLmtleVNldCgpLml0ZXJhdG9yKCkubmV4\ndCgpOw0KCQkJaWYgKGludmFsaWRFbnRyaWVzLmtleVNldCgpLnNpemUoKSA9\nPSAxICYmDQoJCQkJZmlyc3QuaW5kZXhPZignLicpID09IC0xKSB7DQoJCQkJ\nLy8gaWYgdGhlcmUncyBqdXN0IG9uZSBtaXNzcGVsbGluZyBhbmQgdGhpcyBp\ncyBub3QgYQ0KCQkJCS8vIHBhdGggdHJhdmVyc2FsLCBjaGVjayBmb3IgbmVh\nciBtaXNzZXMuDQoJCQkJQ29sbGVjdGlvbiBvcHRpb25zID0gZmluZE9wdGlv\nbnNGb3Iob2JqLmdldENsYXNzKCkpOw0KCQkJCVN0cmluZyBjbG9zZSA9IFN0\ncmluZ0Rpc3RhbmNlLmdldENsb3Nlc3RMZXZlbnNodGVpbkRpc3RhbmNlDQoJ\nCQkJCShmaXJzdCwgb3B0aW9ucywgMC43NWYpOw0KCQkJCWlmIChjbG9zZSAh\nPSBudWxsKQ0KCQkJCQltc2cgPSBfbG9jLmdldCgiaW52YWxpZC1jb25maWct\ncGFyYW0taGludCIsIG5ldyBPYmplY3RbXXsNCgkJCQkJCWNvbmZpZ3VyYXRp\nb25OYW1lLCBvYmouZ2V0Q2xhc3MoKSwgZmlyc3QsIGNsb3NlLA0KCQkJCQkJ\nb3B0aW9ucywgfSk7DQoJCQl9DQoNCiAgICAgICAgICAgIGlmIChtc2cgPT0g\nbnVsbCkgew0KICAgICAgICAgICAgICAgIG1zZyA9IF9sb2MuZ2V0KCJpbnZh\nbGlkLWNvbmZpZy1wYXJhbXMiLCBuZXcgU3RyaW5nW117DQogICAgICAgICAg\nICAgICAgICAgIGNvbmZpZ3VyYXRpb25OYW1lLCBvYmouZ2V0Q2xhc3MoKS5n\nZXROYW1lKCksDQogICAgICAgICAgICAgICAgICAgIGludmFsaWRFbnRyaWVz\nLmtleVNldCgpLnRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAgIGZp\nbmRPcHRpb25zRm9yKG9iai5nZXRDbGFzcygpKS50b1N0cmluZygpLCB9KTsN\nCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRocm93IG5ldyBQYXJzZUV4\nY2VwdGlvbihtc2cpOw0KICAgICAgICB9DQogICAgICAgIGlmIChjb25maWd1\ncmFibGUgIT0gbnVsbCkNCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZS5lbmRD\nb25maWd1cmF0aW9uKCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMg\nQ29sbGVjdGlvbiBmaW5kT3B0aW9uc0ZvcihDbGFzcyBjbHMpIHsNCiAgICAg\nICAgQ29sbGVjdGlvbiBjID0gT3B0aW9ucy5maW5kT3B0aW9uc0ZvcihjbHMp\nOw0KICAgICAgICANCiAgICAgICAgLy8gcmVtb3ZlIENvbmZpZ3VyYWJsZS5z\nZXRDb25maWd1cmF0aW9uKCkgYW5kIA0KICAgICAgICAvLyBHZW5lcmljQ29u\nZmlndXJhYmxlLnNldEludG8oKSBmcm9tIHRoZSBzZXQsIGlmIGFwcGxpY2Fi\nbGUuDQogICAgICAgIGlmIChDb25maWd1cmFibGUuY2xhc3MuaXNBc3NpZ25h\nYmxlRnJvbShjbHMpKQ0KICAgICAgICAgICAgYy5yZW1vdmUoIkNvbmZpZ3Vy\nYXRpb24iKTsNCiAgICAgICAgaWYgKEdlbmVyaWNDb25maWd1cmFibGUuY2xh\nc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQ0KICAgICAgICAgICAgYy5yZW1v\ndmUoIkludG8iKTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBjOw0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIFR1cm4gYSBzZXQgb2YgcHJvcGVydGll\ncyBpbnRvIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZy4NCiAgICAgKi8NCiAg\nICBwdWJsaWMgc3RhdGljIFN0cmluZyBzZXJpYWxpemVQcm9wZXJ0aWVzKE1h\ncCBtYXApIHsNCiAgICAgICAgaWYgKG1hcCA9PSBudWxsIHx8IG1hcC5pc0Vt\ncHR5KCkpDQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCg0KICAgICAgICBT\ndHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOw0KICAgICAg\nICBNYXAuRW50cnkgZW50cnk7DQogICAgICAgIFN0cmluZyB2YWw7DQogICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gbWFwLmVudHJ5U2V0KCkuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgIGVudHJ5ID0g\nKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsNCiAgICAgICAgICAgIGlmIChidWYu\nbGVuZ3RoKCkgPiAwKQ0KICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwg\nIik7DQogICAgICAgICAgICBidWYuYXBwZW5kKGVudHJ5LmdldEtleSgpKS5h\ncHBlbmQoJz0nKTsNCiAgICAgICAgICAgIHZhbCA9IFN0cmluZy52YWx1ZU9m\nKGVudHJ5LmdldFZhbHVlKCkpOw0KICAgICAgICAgICAgaWYgKHZhbC5pbmRl\neE9mKCcsJykgIT0gLTEpDQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgn\nIicpLmFwcGVuZCh2YWwpLmFwcGVuZCgnIicpOw0KICAgICAgICAgICAgZWxz\nZQ0KICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQodmFsKTsNCiAgICAgICAg\nfQ0KICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogUGFyc2UgYSBzZXQgb2YgcHJvcGVydGllcyBmcm9t\nIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZy4NCiAgICAgKi8NCiAgICBwdWJs\naWMgc3RhdGljIE9wdGlvbnMgcGFyc2VQcm9wZXJ0aWVzKFN0cmluZyBwcm9w\nZXJ0aWVzKSB7DQogICAgICAgIE9wdGlvbnMgb3B0cyA9IG5ldyBPcHRpb25z\nKCk7DQogICAgICAgIHByb3BlcnRpZXMgPSBTdHJpbmdVdGlscy50cmltVG9O\ndWxsKHByb3BlcnRpZXMpOw0KICAgICAgICBpZiAocHJvcGVydGllcyA9PSBu\ndWxsKQ0KICAgICAgICAgICAgcmV0dXJuIG9wdHM7DQoNCiAgICAgICAgdHJ5\nIHsNCiAgICAgICAgICAgIFN0cmluZ1tdIHByb3BzID0gU3RyaW5ncy5zcGxp\ndChwcm9wZXJ0aWVzLCAiLCIsIDApOw0KICAgICAgICAgICAgaW50IGlkeDsN\nCiAgICAgICAgICAgIGNoYXIgcXVvdGU7DQogICAgICAgICAgICBTdHJpbmcg\ncHJvcDsNCiAgICAgICAgICAgIFN0cmluZyB2YWw7DQogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7DQogICAg\nICAgICAgICAgICAgaWR4ID0gcHJvcHNbaV0uaW5kZXhPZignPScpOw0KICAg\nICAgICAgICAgICAgIGlmIChpZHggPT0gLTEpIHsNCiAgICAgICAgICAgICAg\nICAgICAgLy8gaWYgdGhlIGtleSBpcyBub3QgYXNzaWduZWQgdG8gYW55IHZh\nbHVlLCBzZXQgdGhlDQogICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlIHRv\nIHRoZSBzYW1lIHRoaW5nIGFzIHRoZSBrZXksIGFuZCBjb250aW51ZS4NCiAg\nICAgICAgICAgICAgICAgICAgLy8gVGhpcyBwZXJtaXRzIEdlbmVyaWNDb25m\naWd1cmFibGUgaW5zdGFuY2VzIHRvDQogICAgICAgICAgICAgICAgICAgIC8v\nIGJlaGF2ZSBtZWFuaW5nZnVsbHkuIFdlIG1pZ2h0IGNvbnNpZGVyIHNldHRp\nbmcgdGhlDQogICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlIHRvIHNvbWUg\nd2VsbC1rbm93biAidmFsdWUgd2FzIG5vdCBzZXQsIGJ1dA0KICAgICAgICAg\nICAgICAgICAgICAvLyBrZXkgaXMgcHJlc2VudCIgc3RyaW5nIHNvIHRoYXQg\naW5zdGFuY2VzIGdldHRpbmcNCiAgICAgICAgICAgICAgICAgICAgLy8gdmFs\ndWVzIGluamVjdGVkIGNhbiBkaWZmZXJlbnRpYXRlIGJldHdlZW4gYSBtZW50\naW9uZWQNCiAgICAgICAgICAgICAgICAgICAgLy8gcHJvcGVydHkgYW5kIG9u\nZSBzZXQgdG8gYSBwYXJ0aWN1bGFyIHZhbHVlLg0KICAgICAgICAgICAgICAg\nICAgICBwcm9wID0gcHJvcHNbaV07DQogICAgICAgICAgICAgICAgICAgIHZh\nbCA9IHByb3A7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAg\nICAgICAgICAgICAgcHJvcCA9IHByb3BzW2ldLnN1YnN0cmluZygwLCBpZHgp\nLnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgICAgdmFsID0gcHJvcHNbaV0u\nc3Vic3RyaW5nKGlkeCArIDEpLnRyaW0oKTsNCiAgICAgICAgICAgICAgICB9\nDQoNCiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgdmFsdWUgaXMgcXVvdGVk\nLCByZWFkIHVudGlsIHRoZSBlbmQgcXVvdGUNCiAgICAgICAgICAgICAgICBp\nZiAoKCh2YWwuc3RhcnRzV2l0aCgiXCIiKSAmJiB2YWwuZW5kc1dpdGgoIlwi\nIikpDQogICAgICAgICAgICAgICAgICAgIHx8ICh2YWwuc3RhcnRzV2l0aCgi\nJyIpICYmIHZhbC5lbmRzV2l0aCgiJyIpKSkNCiAgICAgICAgICAgICAgICAg\nICAgJiYgdmFsLmxlbmd0aCgpID4gMSkNCiAgICAgICAgICAgICAgICAgICAg\ndmFsID0gdmFsLnN1YnN0cmluZygxLCB2YWwubGVuZ3RoKCkgLSAxKTsNCiAg\nICAgICAgICAgICAgICBlbHNlIGlmICh2YWwuc3RhcnRzV2l0aCgiXCIiKSB8\nfCB2YWwuc3RhcnRzV2l0aCgiJyIpKSB7DQogICAgICAgICAgICAgICAgICAg\nIHF1b3RlID0gdmFsLmNoYXJBdCgwKTsNCiAgICAgICAgICAgICAgICAgICAg\nU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIodmFsLnN1YnN0\ncmluZygxKSk7DQogICAgICAgICAgICAgICAgICAgIGludCBxdW90SWR4Ow0K\nICAgICAgICAgICAgICAgICAgICB3aGlsZSAoKytpIDwgcHJvcHMubGVuZ3Ro\nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsIik7\nDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHF1b3RJZHggPSBwcm9wc1tp\nXS5pbmRleE9mKHF1b3RlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChxdW90SWR4ICE9IC0xKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZChwcm9wc1tpXS5zdWJzdHJpbmcoMCwgcXVvdElkeCkp\nOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxdW90SWR4ICsg\nMSA8IHByb3BzW2ldLmxlbmd0aCgpKQ0KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKHByb3BzW2ldLnN1YnN0cmluZyhxdW90\nSWR4ICsgMSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlDQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChwcm9wc1tpXSk7DQogICAg\nICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgdmFsID0g\nYnVmLnRvU3RyaW5nKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAg\nICAgICAgIG9wdHMucHV0KHByb3AsIHZhbCk7DQogICAgICAgICAgICB9DQog\nICAgICAgICAgICByZXR1cm4gb3B0czsNCiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IFBh\ncnNlRXhjZXB0aW9uKF9sb2MuZ2V0KCJwcm9wLXBhcnNlIiwgcHJvcGVydGll\ncyksIHJlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAq\nIExvb2tzIHVwIHRoZSBnaXZlbiBuYW1lIGluIEpOREkuIElmIHRoZSBuYW1l\nIGlzIG51bGwsIG51bGwgaXMgcmV0dXJuZWQuDQogICAgICovDQogICAgcHVi\nbGljIHN0YXRpYyBPYmplY3QgbG9va3VwKFN0cmluZyBuYW1lLCBTdHJpbmcg\ndXNlcktleSwgTG9nIGxvZykgew0KICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShuYW1lKSkNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KDQog\nICAgICAgIENvbnRleHQgY3R4ID0gbnVsbDsNCiAgICAgICAgdHJ5IHsNCiAg\nICAgICAgICAgIGN0eCA9IG5ldyBJbml0aWFsQ29udGV4dCgpOw0KICAgICAg\nICAgICAgT2JqZWN0IHJlc3VsdCA9IGN0eC5sb29rdXAobmFtZSk7DQogICAg\nICAgICAgICBpZiAocmVzdWx0ID09IG51bGwgJiYgbG9nICE9IG51bGwgJiYg\nbG9nLmlzV2FybkVuYWJsZWQoKSkNCiAgICAgICAgICAgIAlsb2cud2Fybihf\nbG9jLmdldCgiam5kaS1sb29rdXAtZmFpbGVkIiwgdXNlcktleSwgbmFtZSkp\nOw0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgfSBjYXRj\naCAoTmFtaW5nRXhjZXB0aW9uIG5lKSB7DQogICAgICAgICAgICB0aHJvdyBu\nZXcgTmVzdGFibGVSdW50aW1lRXhjZXB0aW9uKA0KICAgICAgICAgICAgICAg\nIF9sb2MuZ2V0KCJuYW1pbmctZXJyIiwgbmFtZSkuZ2V0TWVzc2FnZSgpLCBu\nZSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICBpZiAoY3R4\nICE9IG51bGwpDQogICAgICAgICAgICAgICAgdHJ5IHsgY3R4LmNsb3NlKCk7\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7fQ0KICAgICAgICB9DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogVGVzdCB3aGV0aGVyIHRoZSBtYXAgY29udGFp\nbnMgdGhlIGdpdmVuIHBhcnRpYWwga2V5LCBwcmVmaXhlZCB3aXRoIGFueQ0K\nICAgICAqIHBvc3NpYmxlIGNvbmZpZ3VyYXRpb24gcHJlZml4Lg0KICAgICAq\nLw0KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBjb250YWluc1Byb3BlcnR5\nKFN0cmluZyBwYXJ0aWFsS2V5LCBNYXAgcHJvcHMpIHsNCiAgICAgICAgaWYg\nKHBhcnRpYWxLZXkgPT0gbnVsbCB8fCBwcm9wcyA9PSBudWxsIHx8IHByb3Bz\nLmlzRW1wdHkoKSkNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAg\nICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIHByb3BzLmNvbnRhaW5zS2V5\nKA0KICAgICAgICAgICAgICAgIFByb2R1Y3REZXJpdmF0aW9ucy5nZXRDb25m\naWd1cmF0aW9uS2V5KHBhcnRpYWxLZXksIHByb3BzKSk7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogR2V0IHRoZSBwcm9wZXJ0eSB1bmRlciB0aGUgZ2l2\nZW4gcGFydGlhbCBrZXksIHByZWZpeGVkIHdpdGggYW55IHBvc3NpYmxlDQog\nICAgICogY29uZmlndXJhdGlvbiBwcmVmaXguDQogICAgICovDQogICAgcHVi\nbGljIHN0YXRpYyBPYmplY3QgZ2V0UHJvcGVydHkoU3RyaW5nIHBhcnRpYWxL\nZXksIE1hcCBtKSB7DQogICAgICAgIGlmIChwYXJ0aWFsS2V5ID09IG51bGwg\nfHwgbSA9PSBudWxsIHx8IG0uaXNFbXB0eSgpKQ0KICAgICAgICAgICAgcmV0\ndXJuIG51bGw7DQogICAgICAgIGVsc2UgDQogICAgICAgICAgICByZXR1cm4g\nbS5nZXQoUHJvZHVjdERlcml2YXRpb25zLmdldENvbmZpZ3VyYXRpb25LZXko\ncGFydGlhbEtleSwgbSkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJl\nbW92ZSB0aGUgcHJvcGVydHkgdW5kZXIgdGhlIGdpdmVuIHBhcnRpYWwga2V5\nLCBwcmVmaXhlZCB3aXRoIGFueQ0KICAgICAqIHBvc3NpYmxlIGNvbmZpZ3Vy\nYXRpb24gcHJlZml4Lg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgT2Jq\nZWN0IHJlbW92ZVByb3BlcnR5KFN0cmluZyBwYXJ0aWFsS2V5LCBNYXAgcHJv\ncHMpIHsNCiAgICAgICAgaWYgKHBhcnRpYWxLZXkgPT0gbnVsbCB8fCBwcm9w\ncyA9PSBudWxsIHx8IHByb3BzLmlzRW1wdHkoKSkNCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOw0KICAgICAgICBpZiAoY29udGFpbnNQcm9wZXJ0eShwYXJ0\naWFsS2V5LCBwcm9wcykpDQogICAgICAgICAgICByZXR1cm4gcHJvcHMucmVt\nb3ZlKFByb2R1Y3REZXJpdmF0aW9ucy5nZXRDb25maWd1cmF0aW9uS2V5KA0K\nICAgICAgICAgICAgICAgIHBhcnRpYWxLZXksIHByb3BzKSk7DQogICAgICAg\nIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCg0KICAg\nIC8qKg0KICAgICAqIFJ1bnMgPGNvZGU+cnVubmFibGU8L2NvZGU+IGFnYWlu\nc3QgYWxsIHRoZSBhbmNob3JzIGluIHRoZSBjb25maWd1cmF0aW9uDQogICAg\nICogcG9pbnRlZCB0byBieSA8Y29kZT5vcHRzPC9jb2RlPi4gRWFjaCBpbnZv\nY2F0aW9uIGdldHMgYSBmcmVzaCBjbG9uZSBvZiANCiAgICAgKiA8Y29kZT5v\ncHRzPC9jb2RlPiB3aXRoIHRoZSA8Y29kZT5wcm9wZXJ0aWVzPC9jb2RlPiBv\ncHRpb24gc2V0DQogICAgICogYXBwcm9wcmlhdGVseS4NCiAgICAgKg0KICAg\nICAqIEBzaW5jZSAxLjEuMA0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMg\nYm9vbGVhbiBydW5BZ2FpbnN0QWxsQW5jaG9ycyhPcHRpb25zIG9wdHMsDQog\nICAgICAgIENvbmZpZ3VyYXRpb25zLlJ1bm5hYmxlIHJ1bm5hYmxlKSB7DQog\nICAgICAgIGlmIChvcHRzLmNvbnRhaW5zS2V5KCJoZWxwIikgfHwgb3B0cy5j\nb250YWluc0tleSgiLWhlbHAiKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOw0KICAgICAgICB9DQogICAgICAgIExpc3QgYW5jaG9ycyA9DQogICAg\nICAgICAgICBDb25maWd1cmF0aW9ucy5nZXRGdWxseVF1YWxpZmllZEFuY2hv\ncnNJblByb3BlcnRpZXNMb2NhdGlvbihvcHRzKTsNCg0KICAgICAgICAvLyBX\nZSB1c2UgJ3Byb3BlcnRpZXMnIGJlbG93OyBnZXQgcmlkIG9mICdwJyB0byBh\ndm9pZCBjb25mbGljdHMuIFRoaXMNCiAgICAgICAgLy8gcmVsaWVzIG9uIGtu\nb3dpbmcgd2hhdCBnZXRGdWxseVF1YWxpZmllZEFuY2hvcnNJblByb3BlcnRp\nZXNMb2NhdGlvbg0KICAgICAgICAvLyBsb29rcyBmb3IuDQogICAgICAgIGlm\nIChvcHRzLmNvbnRhaW5zS2V5KCJwIikpDQogICAgICAgICAgICBvcHRzLnJl\nbW92ZSgicCIpOw0KDQogICAgICAgIGJvb2xlYW4gcmV0ID0gdHJ1ZTsNCiAg\nICAgICAgaWYgKGFuY2hvcnMuc2l6ZSgpID09IDApIHsNCiAgICAgICAgICAg\nIHJldCA9IGxhdW5jaFJ1bm5hYmxlKG9wdHMsIHJ1bm5hYmxlKTsNCiAgICAg\nICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9\nIGFuY2hvcnMuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0KCk7ICkgeyANCiAg\nICAgICAgICAgICAgICBPcHRpb25zIGNsb25lZE9wdGlvbnMgPSAoT3B0aW9u\ncykgb3B0cy5jbG9uZSgpOw0KICAgICAgICAgICAgICAgIGNsb25lZE9wdGlv\nbnMuc2V0UHJvcGVydHkoInByb3BlcnRpZXMiLCBpdGVyLm5leHQoKS50b1N0\ncmluZygpKTsNCiAgICAgICAgICAgICAgICByZXQgJj0gbGF1bmNoUnVubmFi\nbGUoY2xvbmVkT3B0aW9ucywgcnVubmFibGUpOw0KICAgICAgICAgICAgfQ0K\nICAgICAgICB9DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAg\ncHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBsYXVuY2hSdW5uYWJsZShPcHRpb25z\nIG9wdHMsDQogICAgICAgIENvbmZpZ3VyYXRpb25zLlJ1bm5hYmxlIHJ1bm5h\nYmxlKSB7DQogICAgICAgIGJvb2xlYW4gcmV0ID0gdHJ1ZTsNCiAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgIHJldCA9IHJ1bm5hYmxlLnJ1bihvcHRzKTsN\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAg\nIGlmICghKGUgaW5zdGFuY2VvZiBSdW50aW1lRXhjZXB0aW9uKSkNCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlvbihlKTsNCiAg\nICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB0aHJvdyAoUnVudGlt\nZUV4Y2VwdGlvbikgZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmV0\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnRlcmZhY2UgUnVubmFibGUgew0K\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW4oT3B0aW9ucyBvcHRzKSB0aHJv\nd3MgRXhjZXB0aW9uOw0KICAgIH0NCn0NCg==\n","encoding":"base64"}

