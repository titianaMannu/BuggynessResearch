{"sha":"f2209f189675c15b5f842a7c5a78d6cf0def02f4","node_id":"MDQ6QmxvYjIwNjM2NDpmMjIwOWYxODk2NzVjMTViNWY4NDJhN2M1YTc4ZDZjZjBkZWYwMmY0","size":19720,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f2209f189675c15b5f842a7c5a78d6cf0def02f4","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLmxhbmcucmVm\nbGVjdC5NZXRob2Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBv\ncnQgamF2YS51dGlsLkNhbGVuZGFyOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZsdXNoTW9kZVR5cGU7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5RdWVyeTsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLlRlbXBvcmFsVHlwZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1v\nbnMuY29sbGVjdGlvbnMubWFwLkxpbmtlZE1hcDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5lbmhhbmNlLlJlZmxlY3Rpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLkRlbGVnYXRpbmdRdWVyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGVsZWdhdGluZ1Jlc3VsdExpc3Q7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2Vz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeU9wZXJh\ndGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMu\nQWdncmVnYXRlTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLmV4cHMuRmlsdGVyTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnJvcC5SZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5SdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvcjsKCi8q\nKgogKiBJbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUXVlcnl9IGludGVyZmFj\nZS4KICoKICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICogQGF1dGhv\nciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIFF1\nZXJ5SW1wbAogICAgaW1wbGVtZW50cyBPcGVuSlBBUXVlcnlTUEksIFNlcmlh\nbGl6YWJsZSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10g\nRU1QVFlfQVJSQVkgPSBuZXcgT2JqZWN0WzBdOwoKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2th\nZ2UKICAgICAgICAoUXVlcnlJbXBsLmNsYXNzKTsKCiAgICBwcml2YXRlIGZp\nbmFsIERlbGVnYXRpbmdRdWVyeSBfcXVlcnk7CiAgICBwcml2YXRlIHRyYW5z\naWVudCBFbnRpdHlNYW5hZ2VySW1wbCBfZW07CiAgICBwcml2YXRlIHRyYW5z\naWVudCBGZXRjaFBsYW4gX2ZldGNoOwoKICAgIHByaXZhdGUgTWFwIF9uYW1l\nZDsKICAgIHByaXZhdGUgTGlzdCBfcG9zaXRpb25hbDsKCiAgICAvKioKICAg\nICAqIENvbnN0cnVjdG9yOyBzdXBwbHkgZmFjdG9yeSBleGNlcHRpb24gdHJh\nbnNsYXRvciBhbmQgZGVsZWdhdGUuCiAgICAgKiAKICAgICAqIEBwYXJhbSBl\nbQogICAgICogICAgICAgICAgICBUaGUgRW50aXR5TWFuYWdlciB3aGljaCBj\ncmVhdGVkIHRoaXMgcXVlcnkKICAgICAqIEBwYXJhbSByZXQKICAgICAqICAg\nICAgICAgICAgRXhjZXB0aW9uIHRyYW5zbGF0ZXIgZm9yIHRoaXMgcXVlcnkK\nICAgICAqIEBwYXJhbSBxdWVyeQogICAgICogICAgICAgICAgICBUaGUgdW5k\nZXJseWluZyAia2VybmVsIiBxdWVyeS4KICAgICAqLwogICAgcHVibGljIFF1\nZXJ5SW1wbChFbnRpdHlNYW5hZ2VySW1wbCBlbSwgUnVudGltZUV4Y2VwdGlv\nblRyYW5zbGF0b3IgcmV0LAogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuUXVlcnkgcXVlcnkpIHsKICAgICAgICBfZW0gPSBlbTsKICAgICAg\nICBfcXVlcnkgPSBuZXcgRGVsZWdhdGluZ1F1ZXJ5KHF1ZXJ5LCByZXQpOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBzdXBwbHkg\nZmFjdG9yeSBhbmQgZGVsZWdhdGUuCiAgICAgKiBAZGVwcmVjYXRlZAogICAg\nICovCiAgICBwdWJsaWMgUXVlcnlJbXBsKEVudGl0eU1hbmFnZXJJbXBsIGVt\nLCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5IHF1ZXJ5KSB7CiAg\nICAgICAgdGhpcyhlbSwgbnVsbCwgcXVlcnkpOwogICAgfQoKICAgIC8qKgoJ\nICogRGVsZWdhdGUuCgkgKi8KICAgIHB1YmxpYyBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlF1ZXJ5IGdldERlbGVnYXRlKCkgewogICAgICAgIHJldHVy\nbiBfcXVlcnkuZ2V0RGVsZWdhdGUoKTsKICAgIH0KCiAgICBwdWJsaWMgT3Bl\nbkpQQUVudGl0eU1hbmFnZXIgZ2V0RW50aXR5TWFuYWdlcigpIHsKICAgICAg\nICByZXR1cm4gX2VtOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0TGFu\nZ3VhZ2UoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5nZXRMYW5ndWFnZSgp\nOwogICAgfQoKICAgIHB1YmxpYyBRdWVyeU9wZXJhdGlvblR5cGUgZ2V0T3Bl\ncmF0aW9uKCkgewogICAgICAgIHJldHVybiBRdWVyeU9wZXJhdGlvblR5cGUu\nZnJvbUtlcm5lbENvbnN0YW50KF9xdWVyeS5nZXRPcGVyYXRpb24oKSk7CiAg\nICB9CgogICAgcHVibGljIEZldGNoUGxhbiBnZXRGZXRjaFBsYW4oKSB7CiAg\nICAgICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9x\ndWVyeS5hc3NlcnROb3RTZXJpYWxpemVkKCk7CiAgICAgICAgX3F1ZXJ5Lmxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX2ZldGNoID09\nIG51bGwpCiAgICAgICAgICAgICAgICBfZmV0Y2ggPSAoKEVudGl0eU1hbmFn\nZXJGYWN0b3J5SW1wbCkgX2VtLgogICAgICAgICAgICAgICAgICAgIGdldEVu\ndGl0eU1hbmFnZXJGYWN0b3J5KCkpLnRvRmV0Y2hQbGFuKF9xdWVyeS5nZXRC\ncm9rZXIoKSwKICAgICAgICAgICAgICAgICAgICBfcXVlcnkuZ2V0RmV0Y2hD\nb25maWd1cmF0aW9uKCkpOwogICAgICAgICAgICByZXR1cm4gX2ZldGNoOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9xdWVyeS51bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRRdWVy\neVN0cmluZygpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LmdldFF1ZXJ5U3Ry\naW5nKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0SWdub3JlQ2hh\nbmdlcygpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LmdldElnbm9yZUNoYW5n\nZXMoKTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IHNldElnbm9y\nZUNoYW5nZXMoYm9vbGVhbiBpZ25vcmUpIHsKICAgICAgICBfZW0uYXNzZXJ0\nTm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LnNldElnbm9yZUNo\nYW5nZXMoaWdub3JlKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAg\nICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IGFkZEZpbHRlckxpc3RlbmVyKEZpbHRl\nckxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgX2VtLmFzc2VydE5vdENs\nb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5hZGRGaWx0ZXJMaXN0ZW5l\ncihsaXN0ZW5lcik7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAg\ncHVibGljIE9wZW5KUEFRdWVyeSByZW1vdmVGaWx0ZXJMaXN0ZW5lcihGaWx0\nZXJMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAgIF9lbS5hc3NlcnROb3RD\nbG9zZUludm9rZWQoKTsKICAgICAgICBfcXVlcnkucmVtb3ZlRmlsdGVyTGlz\ndGVuZXIobGlzdGVuZXIpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoK\nICAgIHB1YmxpYyBPcGVuSlBBUXVlcnkgYWRkQWdncmVnYXRlTGlzdGVuZXIo\nQWdncmVnYXRlTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICBfZW0uYXNz\nZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LmFkZEFnZ3Jl\nZ2F0ZUxpc3RlbmVyKGxpc3RlbmVyKTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IHJlbW92ZUFnZ3JlZ2F0\nZUxpc3RlbmVyKEFnZ3JlZ2F0ZUxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAg\nICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVy\neS5yZW1vdmVBZ2dyZWdhdGVMaXN0ZW5lcihsaXN0ZW5lcik7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0\nQ2FuZGlkYXRlQ29sbGVjdGlvbigpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5\nLmdldENhbmRpZGF0ZUNvbGxlY3Rpb24oKTsKICAgIH0KCiAgICBwdWJsaWMg\nT3BlbkpQQVF1ZXJ5IHNldENhbmRpZGF0ZUNvbGxlY3Rpb24oQ29sbGVjdGlv\nbiBjb2xsKSB7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgp\nOwogICAgICAgIF9xdWVyeS5zZXRDYW5kaWRhdGVDb2xsZWN0aW9uKGNvbGwp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBDbGFz\ncyBnZXRSZXN1bHRDbGFzcygpIHsKICAgICAgICBDbGFzcyByZXMgPSBfcXVl\ncnkuZ2V0UmVzdWx0VHlwZSgpOwogICAgICAgIGlmIChyZXMgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICByZXR1cm4gX3F1ZXJ5\nLmdldENhbmRpZGF0ZVR5cGUoKTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQ\nQVF1ZXJ5IHNldFJlc3VsdENsYXNzKENsYXNzIGNscykgewogICAgICAgIF9l\nbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBpZiAoSW1wbEhl\nbHBlci5pc01hbmFnZWRUeXBlKF9lbS5nZXRDb25maWd1cmF0aW9uKCksIGNs\ncykpCiAgICAgICAgICAgIF9xdWVyeS5zZXRDYW5kaWRhdGVUeXBlKGNscywg\ndHJ1ZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfcXVlcnkuc2V0UmVz\ndWx0VHlwZShjbHMpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGhhc1N1YmNsYXNzZXMoKSB7CiAgICAgICAgcmV0\ndXJuIF9xdWVyeS5oYXNTdWJjbGFzc2VzKCk7CiAgICB9CgogICAgcHVibGlj\nIE9wZW5KUEFRdWVyeSBzZXRTdWJjbGFzc2VzKGJvb2xlYW4gc3Vicykgewog\nICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBD\nbGFzcyBjbHMgPSBfcXVlcnkuZ2V0Q2FuZGlkYXRlVHlwZSgpOwogICAgICAg\nIF9xdWVyeS5zZXRDYW5kaWRhdGVFeHRlbnQoX3F1ZXJ5LmdldEJyb2tlcigp\nLm5ld0V4dGVudChjbHMsIHN1YnMpKTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEZpcnN0UmVzdWx0KCkgewogICAg\nICAgIHJldHVybiBhc0ludChfcXVlcnkuZ2V0U3RhcnRSYW5nZSgpKTsKICAg\nIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IHNldEZpcnN0UmVzdWx0KGlu\ndCBzdGFydFBvc2l0aW9uKSB7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3Nl\nSW52b2tlZCgpOwogICAgICAgIGxvbmcgZW5kOwogICAgICAgIGlmIChfcXVl\ncnkuZ2V0RW5kUmFuZ2UoKSA9PSBMb25nLk1BWF9WQUxVRSkKICAgICAgICAg\nICAgZW5kID0gTG9uZy5NQVhfVkFMVUU7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBlbmQgPSBzdGFydFBvc2l0aW9uICsKICAgICAgICAgICAgICAgIChf\ncXVlcnkuZ2V0RW5kUmFuZ2UoKSAtIF9xdWVyeS5nZXRTdGFydFJhbmdlKCkp\nOwogICAgICAgIF9xdWVyeS5zZXRSYW5nZShzdGFydFBvc2l0aW9uLCBlbmQp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nZ2V0TWF4UmVzdWx0cygpIHsKICAgICAgICByZXR1cm4gYXNJbnQoX3F1ZXJ5\nLmdldEVuZFJhbmdlKCkgLSBfcXVlcnkuZ2V0U3RhcnRSYW5nZSgpKTsKICAg\nIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IHNldE1heFJlc3VsdHMoaW50\nIG1heCkgewogICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsK\nICAgICAgICBsb25nIHN0YXJ0ID0gX3F1ZXJ5LmdldFN0YXJ0UmFuZ2UoKTsK\nICAgICAgICBpZiAobWF4ID09IEludGVnZXIuTUFYX1ZBTFVFKQogICAgICAg\nICAgICBfcXVlcnkuc2V0UmFuZ2Uoc3RhcnQsIExvbmcuTUFYX1ZBTFVFKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIF9xdWVyeS5zZXRSYW5nZShzdGFy\ndCwgc3RhcnQgKyBtYXgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoK\nICAgIHB1YmxpYyBPcGVuSlBBUXVlcnkgY29tcGlsZSgpIHsKICAgICAgICBf\nZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LmNv\nbXBpbGUoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwcml2\nYXRlIE9iamVjdCBleGVjdXRlKCkgewogICAgICAgIGlmIChfcXVlcnkuZ2V0\nT3BlcmF0aW9uKCkgIT0gUXVlcnlPcGVyYXRpb25zLk9QX1NFTEVDVCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9j\nLmdldCgibm90LXNlbGVjdC1xdWVyeSIsCiAgICAgICAgICAgICAgICBfcXVl\ncnkuZ2V0UXVlcnlTdHJpbmcoKSksIG51bGwsIG51bGwsIGZhbHNlKTsKCiAg\nICAgICAgdmFsaWRhdGVQYXJhbWV0ZXJzKCk7CgogICAgICAgIC8vIGhhbmRs\nZSB3aGljaCB0eXBlcyBvZiBwYXJhbWV0ZXJzIHdlIGFyZSB1c2luZywgaWYg\nYW55CiAgICAgICAgaWYgKF9wb3NpdGlvbmFsICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBfcXVlcnkuZXhlY3V0ZShfcG9zaXRpb25hbC50b0FycmF5\nKCkpOwogICAgICAgIGlmIChfbmFtZWQgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIF9xdWVyeS5leGVjdXRlKF9uYW1lZCk7CiAgICAgICAgcmV0dXJu\nIF9xdWVyeS5leGVjdXRlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxp\nZGF0ZSB0aGF0IHRoZSB0eXBlcyBvZiB0aGUgcGFyYW1ldGVycyBhcmUgY29y\ncmVjdC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlUGFyYW1l\ndGVycygpIHsKICAgICAgICBpZiAoX3Bvc2l0aW9uYWwgIT0gbnVsbCkgewog\nICAgICAgICAgICBMaW5rZWRNYXAgdHlwZXMgPSBfcXVlcnkuZ2V0UGFyYW1l\ndGVyVHlwZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsCiAgICAg\nICAgICAgICAgICBzaXplID0gTWF0aC5taW4oX3Bvc2l0aW9uYWwuc2l6ZSgp\nLCB0eXBlcy5zaXplKCkpOwogICAgICAgICAgICAgICAgaSA8IHNpemU7IGkr\nKykKICAgICAgICAgICAgICAgIHZhbGlkYXRlUGFyYW1ldGVyKFN0cmluZy52\nYWx1ZU9mKGkpLAogICAgICAgICAgICAgICAgICAgIChDbGFzcykgdHlwZXMu\nZ2V0VmFsdWUoaSksIF9wb3NpdGlvbmFsLmdldChpKSk7CiAgICAgICAgfSBl\nbHNlIGlmIChfbmFtZWQgIT0gbnVsbCkgewogICAgICAgICAgICBNYXAgdHlw\nZXMgPSBfcXVlcnkuZ2V0UGFyYW1ldGVyVHlwZXMoKTsKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpID0gX25hbWVkLmVudHJ5U2V0KCkuaXRlcmF0b3Io\nKTsgaS5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBNYXAuRW50cnkg\nZW50cnkgPSAoTWFwLkVudHJ5KSBpLm5leHQoKTsKICAgICAgICAgICAgICAg\nIFN0cmluZyBuYW1lID0gKFN0cmluZykgZW50cnkuZ2V0S2V5KCk7CiAgICAg\nICAgICAgICAgICB2YWxpZGF0ZVBhcmFtZXRlcihuYW1lLCAoQ2xhc3MpIHR5\ncGVzLmdldChuYW1lKSwKICAgICAgICAgICAgICAgICAgICBlbnRyeS5nZXRW\nYWx1ZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgdmFsaWRhdGVQYXJhbWV0ZXIoU3RyaW5nIHBhcmFtRGVz\nYywgQ2xhc3MgdHlwZSwgT2JqZWN0IHBhcmFtKSB7CiAgICAgICAgLy8gbnVs\nbCBwYXJhbWV0ZXJzIGFyZSBhbGxvd2VkLCBzbyBhcmUgbm90IHZhbGlkYXRl\nZAogICAgICAgIGlmIChwYXJhbSA9PSBudWxsIHx8IHR5cGUgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBjaGVjayB0aGUgcGFy\nYW1ldGVyIGFnYWluc3QgdGhlIHdyYXBwZWQgdHlwZQogICAgICAgIGlmICgh\nRmlsdGVycy53cmFwKHR5cGUpLmlzSW5zdGFuY2UocGFyYW0pKQogICAgICAg\nICAgICB0aHJvdyBuZXcgQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQoImJh\nZC1wYXJhbS10eXBlIiwKICAgICAgICAgICAgICAgIHBhcmFtRGVzYywgcGFy\nYW0uZ2V0Q2xhc3MoKS5nZXROYW1lKCksIHR5cGUuZ2V0TmFtZSgpKSwKICAg\nICAgICAgICAgICAgIG51bGwsIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICBw\ndWJsaWMgTGlzdCBnZXRSZXN1bHRMaXN0KCkgewogICAgICAgIF9lbS5hc3Nl\ncnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBPYmplY3Qgb2IgPSBleGVj\ndXRlKCk7CiAgICAgICAgaWYgKG9iIGluc3RhbmNlb2YgTGlzdCkgewogICAg\nICAgICAgICBMaXN0IHJldCA9IChMaXN0KSBvYjsKICAgICAgICAgICAgaWYg\nKHJldCBpbnN0YW5jZW9mIFJlc3VsdExpc3QpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IERlbGVnYXRpbmdSZXN1bHRMaXN0KChSZXN1bHRMaXN0KSBy\nZXQsCiAgICAgICAgICAgICAgICAgICAgUGVyc2lzdGVuY2VFeGNlcHRpb25z\nLmdldFJvbGxiYWNrVHJhbnNsYXRvcihfZW0pKTsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9CgogICAg\nICAgIHJldHVybiBDb2xsZWN0aW9ucy5zaW5nbGV0b25MaXN0KG9iKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEV4ZWN1dGUgYSBxdWVyeSB0aGF0IHJldHVy\nbnMgYSBzaW5nbGUgcmVzdWx0LgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0\nIGdldFNpbmdsZVJlc3VsdCgpIHsKICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xv\nc2VJbnZva2VkKCk7CiAgICAgICAgLy8gdGVtcG9yYXJpbHkgc2V0IHF1ZXJ5\nIHRvIHVuaXF1ZSBzbyB0aGF0IGEgc2luZ2xlIHJlc3VsdCBpcyB2YWxpZGF0\nZWQKICAgICAgICAvLyBhbmQgcmV0dXJuZWQ7IHVuc2V0IGFnYWluIGluIGNh\nc2UgdGhlIHVzZXIgZXhlY3V0ZXMgcXVlcnkgYWdhaW4KICAgICAgICAvLyB2\naWEgZ2V0UmVzdWx0TGlzdAogICAgICAgIF9xdWVyeS5zZXRVbmlxdWUodHJ1\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGV4ZWN1dGUo\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfcXVlcnkuc2V0\nVW5pcXVlKGZhbHNlKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGlu\ndCBleGVjdXRlVXBkYXRlKCkgewogICAgICAgIF9lbS5hc3NlcnROb3RDbG9z\nZUludm9rZWQoKTsKICAgICAgICBpZiAoX3F1ZXJ5LmdldE9wZXJhdGlvbigp\nID09IFF1ZXJ5T3BlcmF0aW9ucy5PUF9ERUxFVEUpIHsKICAgICAgICAgICAg\nLy8gaGFuZGxlIHdoaWNoIHR5cGVzIG9mIHBhcmFtZXRlcnMgd2UgYXJlIHVz\naW5nLCBpZiBhbnkKICAgICAgICAgICAgaWYgKF9wb3NpdGlvbmFsICE9IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm4gYXNJbnQoX3F1ZXJ5LmRlbGV0\nZUFsbChfcG9zaXRpb25hbC50b0FycmF5KCkpKTsKICAgICAgICAgICAgaWYg\nKF9uYW1lZCAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGFzSW50\nKF9xdWVyeS5kZWxldGVBbGwoX25hbWVkKSk7CiAgICAgICAgICAgIHJldHVy\nbiBhc0ludChfcXVlcnkuZGVsZXRlQWxsKCkpOwogICAgICAgIH0KICAgICAg\nICBpZiAoX3F1ZXJ5LmdldE9wZXJhdGlvbigpID09IFF1ZXJ5T3BlcmF0aW9u\ncy5PUF9VUERBVEUpIHsKICAgICAgICAgICAgLy8gaGFuZGxlIHdoaWNoIHR5\ncGVzIG9mIHBhcmFtZXRlcnMgd2UgYXJlIHVzaW5nLCBpZiBhbnkKICAgICAg\nICAgICAgaWYgKF9wb3NpdGlvbmFsICE9IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gYXNJbnQoX3F1ZXJ5LnVwZGF0ZUFsbChfcG9zaXRpb25hbC50\nb0FycmF5KCkpKTsKICAgICAgICAgICAgaWYgKF9uYW1lZCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGFzSW50KF9xdWVyeS51cGRhdGVBbGwo\nX25hbWVkKSk7CiAgICAgICAgICAgIHJldHVybiBhc0ludChfcXVlcnkudXBk\nYXRlQWxsKCkpOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtdXBkYXRlLWRlbGV0ZS1x\ndWVyeSIsCiAgICAgICAgICAgIF9xdWVyeS5nZXRRdWVyeVN0cmluZygpKSwg\nbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQ2Fz\ndCB0aGUgc3BlY2lmaWVkIGxvbmcgZG93biB0byBhbiBpbnQsIGZpcnN0IGNo\nZWNraW5nIGZvciBvdmVyZmxvdy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgaW50IGFzSW50KGxvbmcgbCkgewogICAgICAgIGlmIChsID4gSW50ZWdl\nci5NQVhfVkFMVUUpCiAgICAgICAgICAgIHJldHVybiBJbnRlZ2VyLk1BWF9W\nQUxVRTsKICAgICAgICBpZiAobCA8IEludGVnZXIuTUlOX1ZBTFVFKSAvLyB1\nbmxpa2VseSwgYnV0IHdlIG1pZ2h0IGFzIHdlbGwgY2hlY2sKICAgICAgICAg\nICAgcmV0dXJuIEludGVnZXIuTUlOX1ZBTFVFOwogICAgICAgIHJldHVybiAo\naW50KSBsOwogICAgfQoKICAgIHB1YmxpYyBGbHVzaE1vZGVUeXBlIGdldEZs\ndXNoTW9kZSgpIHsKICAgICAgICByZXR1cm4gRW50aXR5TWFuYWdlckltcGwu\nZnJvbUZsdXNoQmVmb3JlUXVlcmllcyhfcXVlcnkuCiAgICAgICAgICAgIGdl\ndEZldGNoQ29uZmlndXJhdGlvbigpLmdldEZsdXNoQmVmb3JlUXVlcmllcygp\nKTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IHNldEZsdXNoTW9k\nZShGbHVzaE1vZGVUeXBlIGZsdXNoTW9kZSkgewogICAgICAgIF9lbS5hc3Nl\ncnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBfcXVlcnkuZ2V0RmV0Y2hD\nb25maWd1cmF0aW9uKCkuc2V0Rmx1c2hCZWZvcmVRdWVyaWVzCiAgICAgICAg\nICAgIChFbnRpdHlNYW5hZ2VySW1wbC50b0ZsdXNoQmVmb3JlUXVlcmllcyhm\nbHVzaE1vZGUpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBw\ndWJsaWMgT3BlbkpQQVF1ZXJ5IHNldEhpbnQoU3RyaW5nIGtleSwgT2JqZWN0\nIHZhbHVlKSB7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgp\nOwogICAgICAgIGlmIChrZXkgPT0gbnVsbCB8fCAha2V5LnN0YXJ0c1dpdGgo\nIm9wZW5qcGEuIikpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nIFN0cmluZyBrID0ga2V5LnN1YnN0cmluZygib3BlbmpwYS4iLmxlbmd0aCgp\nKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCJTdWJjbGFzc2Vz\nIi5lcXVhbHMoaykpIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0\nYW5jZW9mIFN0cmluZykKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IEJv\nb2xlYW4udmFsdWVPZigoU3RyaW5nKSB2YWx1ZSk7CiAgICAgICAgICAgICAg\nICBzZXRTdWJjbGFzc2VzKCgoQm9vbGVhbikgdmFsdWUpLmJvb2xlYW5WYWx1\nZSgpKTsKICAgICAgICAgICAgfSBlbHNlIGlmICgiRmlsdGVyTGlzdGVuZXIi\nLmVxdWFscyhrKSkKICAgICAgICAgICAgICAgIGFkZEZpbHRlckxpc3RlbmVy\nKEZpbHRlcnMuaGludFRvRmlsdGVyTGlzdGVuZXIodmFsdWUsCiAgICAgICAg\nICAgICAgICAgICAgX3F1ZXJ5LmdldEJyb2tlcigpLmdldENsYXNzTG9hZGVy\nKCkpKTsKICAgICAgICAgICAgZWxzZSBpZiAoIkZpbHRlckxpc3RlbmVycyIu\nZXF1YWxzKGspKSB7CiAgICAgICAgICAgICAgICBGaWx0ZXJMaXN0ZW5lcltd\nIGFyciA9IEZpbHRlcnMuaGludFRvRmlsdGVyTGlzdGVuZXJzKHZhbHVlLAog\nICAgICAgICAgICAgICAgICAgIF9xdWVyeS5nZXRCcm9rZXIoKS5nZXRDbGFz\nc0xvYWRlcigpKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgYXJyLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGFkZEZp\nbHRlckxpc3RlbmVyKGFycltpXSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAo\nIkFnZ3JlZ2F0ZUxpc3RlbmVyIi5lcXVhbHMoaykpCiAgICAgICAgICAgICAg\nICBhZGRBZ2dyZWdhdGVMaXN0ZW5lcihGaWx0ZXJzLmhpbnRUb0FnZ3JlZ2F0\nZUxpc3RlbmVyKHZhbHVlLAogICAgICAgICAgICAgICAgICAgIF9xdWVyeS5n\nZXRCcm9rZXIoKS5nZXRDbGFzc0xvYWRlcigpKSk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKCJGaWx0ZXJMaXN0ZW5lcnMiLmVxdWFscyhrKSkgewogICAgICAg\nICAgICAgICAgQWdncmVnYXRlTGlzdGVuZXJbXSBhcnIgPSBGaWx0ZXJzLmhp\nbnRUb0FnZ3JlZ2F0ZUxpc3RlbmVycwogICAgICAgICAgICAgICAgICAgICh2\nYWx1ZSwgX3F1ZXJ5LmdldEJyb2tlcigpLmdldENsYXNzTG9hZGVyKCkpOwog\nICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcnIubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICAgICAgYWRkQWdncmVnYXRlTGlzdGVu\nZXIoYXJyW2ldKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChrLnN0YXJ0c1dp\ndGgoIkZldGNoUGxhbi4iKSkgewogICAgICAgICAgICAgICAgayA9IGsuc3Vi\nc3RyaW5nKCJGZXRjaFBsYW4uIi5sZW5ndGgoKSk7CiAgICAgICAgICAgICAg\nICBoaW50VG9TZXR0ZXIoZ2V0RmV0Y2hQbGFuKCksIGssIHZhbHVlKTsKICAg\nICAgICAgICAgfSBlbHNlIGlmIChrLnN0YXJ0c1dpdGgoImhpbnQuIikpIHsK\nICAgICAgICAgICAgICAgIGlmICgiaGludC5PcHRpbWl6ZVJlc3VsdENvdW50\nIi5lcXVhbHMoaykpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUg\naW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gbmV3\nIEludGVnZXIoKFN0cmluZykgdmFsdWUpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9IGNhdGNoIChOdW1iZXJGb3JtYXRFeGNlcHRpb24gbmZlKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBO\ndW1iZXIpIAogICAgICAgICAgICAgICAgICAgICAgICB8fCAoKE51bWJlcikg\ndmFsdWUpLmludFZhbHVlKCkgPCAwKQogICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICgiYmFkLXF1ZXJ5LWhpbnQtdmFsdWUi\nLCBrZXksIHZhbHVlKSwgbnVsbCwgbnVsbCwgCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICBfcXVlcnkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkuc2V0SGlu\ndChrZXksIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnRFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1xdWVyeS1oaW50Iiwga2V5KSwKICAgICAgICAgICAg\nICAgICAgICBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIHRocm93IFBlcnNpc3RlbmNlRXhjZXB0aW9ucy50b1BlcnNpc3Rl\nbmNlRXhjZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIHZvaWQgaGludFRvU2V0dGVyKEZldGNoUGxhbiBmZXRjaFBsYW4sIFN0cmlu\nZyBrLCBPYmplY3QgdmFsdWUpIHsKICAgICAgICBpZiAoZmV0Y2hQbGFuID09\nIG51bGwgfHwgayA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIE1ldGhvZCBzZXR0ZXIgPSBSZWZsZWN0aW9uLmZpbmRTZXR0ZXIoZmV0\nY2hQbGFuLmdldENsYXNzKCksIGssIHRydWUpOwogICAgICAgIENsYXNzIHBh\ncmFtVHlwZSA9IHNldHRlci5nZXRQYXJhbWV0ZXJUeXBlcygpWzBdOwogICAg\nICAgIGlmIChFbnVtLmNsYXNzLmlzQXNzaWduYWJsZUZyb20ocGFyYW1UeXBl\nKSAmJiB2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZykKICAgICAgICAgICAgdmFs\ndWUgPSBFbnVtLnZhbHVlT2YocGFyYW1UeXBlLCAoU3RyaW5nKSB2YWx1ZSk7\nCiAgICAgICAgCiAgICAgICAgRmlsdGVycy5oaW50VG9TZXR0ZXIoZmV0Y2hQ\nbGFuLCBrLCB2YWx1ZSk7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFRdWVy\neSBzZXRQYXJhbWV0ZXIoaW50IHBvc2l0aW9uLCBDYWxlbmRhciB2YWx1ZSwK\nICAgICAgICBUZW1wb3JhbFR5cGUgdCkgewogICAgICAgIHJldHVybiBzZXRQ\nYXJhbWV0ZXIocG9zaXRpb24sIHZhbHVlKTsKICAgIH0KCiAgICBwdWJsaWMg\nT3BlbkpQQVF1ZXJ5IHNldFBhcmFtZXRlcihpbnQgcG9zaXRpb24sIERhdGUg\ndmFsdWUsCiAgICAgICAgVGVtcG9yYWxUeXBlIHR5cGUpIHsKICAgICAgICBy\nZXR1cm4gc2V0UGFyYW1ldGVyKHBvc2l0aW9uLCB2YWx1ZSk7CiAgICB9Cgog\nICAgcHVibGljIE9wZW5KUEFRdWVyeSBzZXRQYXJhbWV0ZXIoaW50IHBvc2l0\naW9uLCBPYmplY3QgdmFsdWUpIHsKICAgICAgICBfcXVlcnkuYXNzZXJ0T3Bl\nbigpOwogICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAg\nICAgICBfcXVlcnkubG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgCWlm\nIChpc05hdGl2ZSgpICYmIHBvc2l0aW9uIDwgMSkgewogICAgICAgIAkJdGhy\nb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgiYmFk\nLXBvcy1wYXJhbXMiLCAKICAgICAgICAJCSAgICAgIHBvc2l0aW9uLCBfcXVl\ncnkuZ2V0UXVlcnlTdHJpbmcoKSkudG9TdHJpbmcoKSk7CiAgICAgICAgCX0K\nICAgICAgICAgICAgLy8gbm90IGFsbG93ZWQgdG8gbWl4IHBvc2l0aW9uYWwg\nYW5kIG5hbWVkIHBhcmFtZXRlcnMgKEVEUjIgMy42LjQpCiAgICAgICAgICAg\nIGlmIChfbmFtZWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAg\nICAgICAgICAoIm5vLXBvcy1uYW1lZC1wYXJhbXMtbWl4IiwgX3F1ZXJ5Lmdl\ndFF1ZXJ5U3RyaW5nKCkpLAogICAgICAgICAgICAgICAgICAgIG51bGwsIG51\nbGwsIGZhbHNlKTsKCiAgICAgICAgICAgIGlmIChwb3NpdGlvbiA8IDEpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJpbGxlZ2FsLWluZGV4\nIiwgcG9zaXRpb24pLCBudWxsLCBudWxsLCBmYWxzZSk7CgogICAgICAgICAg\nICBpZiAoX3Bvc2l0aW9uYWwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9w\nb3NpdGlvbmFsID0gbmV3IEFycmF5TGlzdCgpOwoKICAgICAgICAgICAgLy8g\nbWFrZSBzdXJlIGl0IGlzIGF0IGxlYXN0IHRoZSByZXF1ZXN0ZWQgc2l6ZQog\nICAgICAgICAgICB3aGlsZSAoX3Bvc2l0aW9uYWwuc2l6ZSgpIDwgcG9zaXRp\nb24pCiAgICAgICAgICAgICAgICBfcG9zaXRpb25hbC5hZGQobnVsbCk7Cgog\nICAgICAgICAgICAvLyBub3RlIHRoYXQgd2UgYWRkIGl0IHRvIHBvc2l0aW9u\nIC0gMSwgc2luY2Ugc2V0UG9zaXRpb24KICAgICAgICAgICAgLy8gc3RhcnRz\nIGF0IDEsIHdoaWxlIExpc3Qgc3RhcnRzIGF0IDAKICAgICAgICAgICAgX3Bv\nc2l0aW9uYWwuc2V0KHBvc2l0aW9uIC0gMSwgdmFsdWUpOwogICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBfcXVlcnkudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBPcGVuSlBBUXVlcnkgc2V0UGFyYW1ldGVyKFN0cmluZyBuYW1lLCBDYWxl\nbmRhciB2YWx1ZSwKICAgICAgICBUZW1wb3JhbFR5cGUgdCkgewogICAgICAg\nIHJldHVybiBzZXRQYXJhbWV0ZXIobmFtZSwgdmFsdWUpOwogICAgfQoKICAg\nIHB1YmxpYyBPcGVuSlBBUXVlcnkgc2V0UGFyYW1ldGVyKFN0cmluZyBuYW1l\nLCBEYXRlIHZhbHVlLAogICAgICAgIFRlbXBvcmFsVHlwZSB0eXBlKSB7CiAg\nICAgICAgcmV0dXJuIHNldFBhcmFtZXRlcihuYW1lLCB2YWx1ZSk7CiAgICB9\nCgogICAgcHVibGljIE9wZW5KUEFRdWVyeSBzZXRQYXJhbWV0ZXIoU3RyaW5n\nIG5hbWUsIE9iamVjdCB2YWx1ZSkgewogICAgICAgIF9xdWVyeS5hc3NlcnRP\ncGVuKCk7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwog\nICAgICAgIF9xdWVyeS5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAJ\naWYgKGlzTmF0aXZlKCkpIHsKICAgICAgICAJCXRocm93IG5ldyBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW5hbWVkLXBhcmFtcyIs\nIAogICAgICAgIAkJICAgIG5hbWUsIF9xdWVyeS5nZXRRdWVyeVN0cmluZygp\nKS50b1N0cmluZygpKTsKICAgICAgICAJfQogICAgICAgICAgICAvLyBub3Qg\nYWxsb3dlZCB0byBtaXggcG9zaXRpb25hbCBhbmQgbmFtZWQgcGFyYW1ldGVy\ncyAoRURSMiAzLjYuNCkKICAgICAgICAgICAgaWYgKF9wb3NpdGlvbmFsICE9\nIG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRl\nRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJuby1w\nb3MtbmFtZWQtcGFyYW1zLW1peCIsIF9xdWVyeS5nZXRRdWVyeVN0cmluZygp\nKSwKICAgICAgICAgICAgICAgICAgICBudWxsLCBudWxsLCBmYWxzZSk7Cgog\nICAgICAgICAgICBpZiAoX25hbWVkID09IG51bGwpCiAgICAgICAgICAgICAg\nICBfbmFtZWQgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICBfbmFtZWQu\ncHV0KG5hbWUsIHZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5LnVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4gaXNO\nYXRpdmUoKSB7CiAgICAJcmV0dXJuIFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FM\nLmVxdWFscyhnZXRMYW5ndWFnZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBoYXNQb3NpdGlvbmFsUGFyYW1ldGVycygpIHsKICAgICAgICByZXR1\ncm4gX3Bvc2l0aW9uYWwgIT0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0W10gZ2V0UG9zaXRpb25hbFBhcmFtZXRlcnMoKSB7CiAgICAgICAgX3F1\nZXJ5LmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nKF9wb3NpdGlvbmFsID09IG51bGwpID8gRU1QVFlfQVJSQVkgOiBfcG9zaXRp\nb25hbC50b0FycmF5KCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgX3F1ZXJ5LnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgT3BlbkpQQVF1ZXJ5IHNldFBhcmFtZXRlcnMoT2JqZWN0Li4uIHBhcmFt\ncykgewogICAgICAgIF9xdWVyeS5hc3NlcnRPcGVuKCk7CiAgICAgICAgX2Vt\nLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5sb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3Bvc2l0aW9uYWwgPSBu\ndWxsOwogICAgICAgICAgICBfbmFtZWQgPSBudWxsOwogICAgICAgICAgICBp\nZiAocGFyYW1zICE9IG51bGwpCiAgICAgICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAg\nICAgICBzZXRQYXJhbWV0ZXIoaSArIDEsIHBhcmFtc1tpXSk7CiAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIF9xdWVyeS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIE1hcCBnZXROYW1lZFBhcmFtZXRlcnMoKSB7CiAgICAgICAgX3F1ZXJ5\nLmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF9u\nYW1lZCA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX01BUAogICAgICAg\nICAgICAgICAgOiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVNYXAoX25hbWVk\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfcXVlcnkudW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVl\ncnkgc2V0UGFyYW1ldGVycyhNYXAgcGFyYW1zKSB7CiAgICAgICAgX3F1ZXJ5\nLmFzc2VydE9wZW4oKTsKICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZv\na2VkKCk7CiAgICAgICAgX3F1ZXJ5LmxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBfcG9zaXRpb25hbCA9IG51bGw7CiAgICAgICAgICAgIF9u\nYW1lZCA9IG51bGw7CiAgICAgICAgICAgIGlmIChwYXJhbXMgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGZvciAoTWFwLkVudHJ5IGUgOiAoU2V0PE1hcC5F\nbnRyeT4pIHBhcmFtcy5lbnRyeVNldCgpKQogICAgICAgICAgICAgICAgICAg\nIHNldFBhcmFtZXRlcigoU3RyaW5nKSBlLmdldEtleSgpLCBlLmdldFZhbHVl\nKCkpOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBfcXVlcnkudW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVlcnkgY2xvc2VBbGwoKSB7CiAg\nICAgICAgX3F1ZXJ5LmNsb3NlQWxsKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICB9CgogICAgcHVibGljIFN0cmluZ1tdIGdldERhdGFTdG9yZUFjdGlv\nbnMoTWFwIHBhcmFtcykgewogICAgICAgIHJldHVybiBfcXVlcnkuZ2V0RGF0\nYVN0b3JlQWN0aW9ucyhwYXJhbXMpOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\naGFzaENvZGUoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5oYXNoQ29kZSgp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb3Ro\nZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCEob3RoZXIgaW5zdGFuY2VvZiBR\ndWVyeUltcGwpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\ncmV0dXJuIF9xdWVyeS5lcXVhbHMoKChRdWVyeUltcGwpIG90aGVyKS5fcXVl\ncnkpOwoJfQp9Cg==\n","encoding":"base64"}

