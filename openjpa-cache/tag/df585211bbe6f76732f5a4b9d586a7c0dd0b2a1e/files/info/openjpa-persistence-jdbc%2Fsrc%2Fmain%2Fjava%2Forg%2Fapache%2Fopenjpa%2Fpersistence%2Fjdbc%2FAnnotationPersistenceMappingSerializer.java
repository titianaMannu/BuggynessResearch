{"sha":"493a8ee2b54713d5ec840d068f57feebb1735907","node_id":"MDQ6QmxvYjIwNjM2NDo0OTNhOGVlMmI1NDcxM2Q1ZWM4NDBkMDY4ZjU3ZmVlYmIxNzM1OTA3","size":29890,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/493a8ee2b54713d5ec840d068f57feebb1735907","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5qZGJjOwoKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5Bbm5vdGF0aW9u\nUGVyc2lzdGVuY2VNZXRhRGF0YVNlcmlhbGl6ZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuUGVyc2lzdGVuY2VTdHJhdGVneTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5Bbm5vdGF0\naW9uQnVpbGRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuUXVlcnlSZXN1bHRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5NYXBwaW5nUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmc7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGlu\nZ0luZm87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkRp\nc2NyaW1pbmF0b3JNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuTWFwcGluZ0luZm87CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLlNlcXVlbmNlTWFwcGluZzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nSW5mbzsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkZs\nYXRDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuVmVydGljYWxDbGFzc1N0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuRnVsbENsYXNz\nU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLnN0cmF0cy5FbnVtVmFsdWVIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS4qOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YU1vZGVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7\nCgppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBq\nYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnNxbC5UeXBl\nczsKaW1wb3J0IGphdmEubGFuZy5hbm5vdGF0aW9uLkFubm90YXRpb247Cgpp\nbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuVGVtcG9yYWxUeXBlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nRW51bVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Jbmhlcml0YW5j\nZVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5UYWJsZTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlNlY29uZGFyeVRhYmxlOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuSW5oZXJpdGFuY2U7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5EaXNjcmltaW5hdG9yVmFsdWU7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5EaXNjcmltaW5hdG9yQ29sdW1uOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuSm9pblRhYmxlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nTG9iOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuVGVtcG9yYWw7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5FbnVtZXJhdGVkOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuVW5pcXVlQ29uc3RyYWludDsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLlRhYmxlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuSm9pbkNvbHVtbnM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5K\nb2luQ29sdW1uOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJpbWFyeUtl\neUpvaW5Db2x1bW47CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QcmltYXJ5\nS2V5Sm9pbkNvbHVtbnM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TcWxS\nZXN1bHRTZXRNYXBwaW5nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50\naXR5UmVzdWx0OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRmllbGRSZXN1\nbHQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW5SZXN1bHQ7Cgov\nL0B0b2RvOiBqYXZhZG9jcwoKLyoqCiAqIFNlcmlhbGl6ZXMgcGVyc2lzdGVu\nY2UgbWFwcGluZ3MgYXMgYW5ub3RhdGlvbnMuCiAqCiAqIEBzaW5jZSAxLjAu\nMAogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKiBAYXV0aG9yIEdva2hhbiBFcmd1\nbAogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgQW5ub3RhdGlvblBl\ncnNpc3RlbmNlTWFwcGluZ1NlcmlhbGl6ZXIKICAgIGV4dGVuZHMgQW5ub3Rh\ndGlvblBlcnNpc3RlbmNlTWV0YURhdGFTZXJpYWxpemVyIHsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9SRVNVTFRNQVAgPSBUWVBFX1FV\nRVJZICsgMTsKCiAgICBwcml2YXRlIExpc3Q8UXVlcnlSZXN1bHRNYXBwaW5n\nPiBfcmVzdWx0cyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX3N5bmMg\nPSBmYWxzZTsKCiAgICBwcml2YXRlIE1hcDxRdWVyeVJlc3VsdE1hcHBpbmcs\nIExpc3Q8QW5ub3RhdGlvbkJ1aWxkZXI+PiBfcnNtQW5ub3MgPSBudWxsOwog\nICAgCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmln\ndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIEFubm90YXRpb25QZXJzaXN0\nZW5jZU1hcHBpbmdTZXJpYWxpemVyKEpEQkNDb25maWd1cmF0aW9uIGNvbmYp\nIHsKICAgICAgICBzdXBlcihjb25mKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgdG8gYXV0b21hdGljYWxseSBzeW5jaHJvbml6ZSBtYXBwaW5n\nIGluZm8gd2l0aCBkYXRhIGF2YWlsYWJsZQogICAgICogZnJvbSBtYXBwZWQg\nY29tcG9uZW50cyBiZWZvcmUgc2VyaWFsaXphdGlvbi4gRGVmYXVsdHMgdG8g\nZmFsc2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFN5bmNNYXBw\naW5nSW5mbygpIHsKICAgICAgICByZXR1cm4gX3N5bmM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRvIGF1dG9tYXRpY2FsbHkgc3luY2hyb25p\nemUgbWFwcGluZyBpbmZvIHdpdGggZGF0YSBhdmFpbGFibGUKICAgICAqIGZy\nb20gbWFwcGVkIGNvbXBvbmVudHMgYmVmb3JlIHNlcmlhbGl6YXRpb24uIERl\nZmF1bHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRT\neW5jTWFwcGluZ0luZm8oYm9vbGVhbiBzeW5jKSB7CiAgICAgICAgX3N5bmMg\nPSBzeW5jOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgZ2l2ZW4g\ncmVzdWx0IHNldCBtYXBwaW5nIHRvIGxvY2FsIGNhY2hlLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBhZGRRdWVyeVJlc3VsdE1hcHBpbmcoUXVlcnlSZXN1\nbHRNYXBwaW5nIG1ldGEpIHsKICAgICAgICBpZiAoX3Jlc3VsdHMgPT0gbnVs\nbCkKICAgICAgICAgICAgX3Jlc3VsdHMgPSBuZXcgQXJyYXlMaXN0PFF1ZXJ5\nUmVzdWx0TWFwcGluZz4oKTsKICAgICAgICBfcmVzdWx0cy5hZGQobWV0YSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmVzIGdpdmVuIHJlc3VsdCBz\nZXQgbWFwcGluZyBmcm9tIHRoZSBsb2NhbCBjYWNoZS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gcmVtb3ZlUXVlcnlSZXN1bHRNYXBwaW5nKFF1ZXJ5\nUmVzdWx0TWFwcGluZyBtZXRhKSB7CiAgICAgICAgcmV0dXJuIF9yZXN1bHRz\nICE9IG51bGwgJiYgX3Jlc3VsdHMucmVtb3ZlKG1ldGEpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgYWRkQWxsKE1ldGFEYXRhUmVw\nb3NpdG9yeSByZXBvcykgewogICAgICAgIHN1cGVyLmFkZEFsbChyZXBvcyk7\nCiAgICAgICAgZm9yIChRdWVyeVJlc3VsdE1hcHBpbmcgcmVzIDogKChNYXBw\naW5nUmVwb3NpdG9yeSkgcmVwb3MpCiAgICAgICAgICAgIC5nZXRRdWVyeVJl\nc3VsdE1hcHBpbmdzKCkpCiAgICAgICAgICAgIGFkZFF1ZXJ5UmVzdWx0TWFw\ncGluZyhyZXMpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGJv\nb2xlYW4gcmVtb3ZlQWxsKE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcykgewog\nICAgICAgIGJvb2xlYW4gcmVtb3ZlZCA9IHN1cGVyLnJlbW92ZUFsbChyZXBv\ncyk7CiAgICAgICAgZm9yIChRdWVyeVJlc3VsdE1hcHBpbmcgcmVzIDogKChN\nYXBwaW5nUmVwb3NpdG9yeSkgcmVwb3MpCiAgICAgICAgICAgIC5nZXRRdWVy\neVJlc3VsdE1hcHBpbmdzKCkpCiAgICAgICAgICAgIHJlbW92ZWQgfD0gcmVt\nb3ZlUXVlcnlSZXN1bHRNYXBwaW5nKHJlcyk7CiAgICAgICAgcmV0dXJuIHJl\nbW92ZWQ7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBj\nbGVhcigpIHsKICAgICAgICBzdXBlci5jbGVhcigpOwogICAgICAgIGlmIChf\ncmVzdWx0cyAhPSBudWxsKQogICAgICAgICAgICBfcmVzdWx0cy5jbGVhcigp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGFubm90YXRpb24gYnVp\nbGRlciB0byBsaXN0IG9mIGJ1aWxkZXJzIGZvciB0aGUgc3BlY2lmaWVkCiAg\nICAgKiBjbGFzcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgYWRkQW5ub3RhdGlvbihBbm5vdGF0aW9uQnVpbGRlciBhYiwgUXVlcnlS\nZXN1bHRNYXBwaW5nIG1ldGEpIHsKICAgICAgICBpZiAoX3JzbUFubm9zID09\nIG51bGwpCiAgICAgICAgICAgIF9yc21Bbm5vcyA9IG5ldyBIYXNoTWFwPFF1\nZXJ5UmVzdWx0TWFwcGluZywgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4+KCk7\nCiAgICAgICAgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4gbGlzdCA9IF9yc21B\nbm5vcy5nZXQobWV0YSk7CiAgICAgICAgaWYgKGxpc3QgPT0gbnVsbCkgewog\nICAgICAgICAgICBsaXN0ID0gbmV3IEFycmF5TGlzdDxBbm5vdGF0aW9uQnVp\nbGRlcj4oKTsKICAgICAgICAgICAgX3JzbUFubm9zLnB1dChtZXRhLCBsaXN0\nKTsKICAgICAgICB9CiAgICAgICAgbGlzdC5hZGQoYWIpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ3JlYXRlcyBhbiBhbiBhbm5vdGF0aW9uIGJ1aWxkZXIg\nZm9yIHRoZSBzcGVjaWZpZWQgY2xhc3MgbWV0YWRhdGEKICAgICAqIGFuZCBh\nZGRzIGl0IHRvIGxpc3Qgb2YgYnVpbGRlcnMuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBBbm5vdGF0aW9uQnVpbGRlciBhZGRBbm5vdGF0aW9uKAogICAgICAg\nIENsYXNzPD8gZXh0ZW5kcyBBbm5vdGF0aW9uPiBhbm5UeXBlLCBRdWVyeVJl\nc3VsdE1hcHBpbmcgbWV0YSkgewogICAgICAgIEFubm90YXRpb25CdWlsZGVy\nIGFiID0gbmV3QW5ub3RhdGlvbkJ1aWxkZXIoYW5uVHlwZSk7CiAgICAgICAg\naWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGFiOwogICAg\nICAgIGFkZEFubm90YXRpb24oYWIsIG1ldGEpOwogICAgICAgIHJldHVybiBh\nYjsKICAgIH0KCgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBz\nZXJpYWxpemVDbGFzcyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBp\nZiAoX3N5bmMgJiYgaXNNYXBwaW5nTW9kZSgpICYmIG1ldGEgaW5zdGFuY2Vv\nZiBDbGFzc01hcHBpbmcpIHsKICAgICAgICAgICAgLy8gc3luYyBpZiByZXNv\nbHZlZCBhbmQgbWFwcGVkCiAgICAgICAgICAgIENsYXNzTWFwcGluZyBjbHMg\nPSAoQ2xhc3NNYXBwaW5nKSBtZXRhOwogICAgICAgICAgICBpZiAoKGNscy5n\nZXRSZXNvbHZlKCkgJiBNZXRhRGF0YU1vZGVzLk1PREVfTUFQUElORykgIT0g\nMCAmJgogICAgICAgICAgICAgICAgY2xzLmlzTWFwcGVkKCkpIHsKICAgICAg\nICAgICAgICAgIGNscy5zeW5jTWFwcGluZ0luZm8oKTsKICAgICAgICAgICAg\nICAgIGNscy5nZXREaXNjcmltaW5hdG9yKCkuc3luY01hcHBpbmdJbmZvKCk7\nCiAgICAgICAgICAgICAgICBjbHMuZ2V0VmVyc2lvbigpLnN5bmNNYXBwaW5n\nSW5mbygpOwogICAgICAgICAgICAgICAgRmllbGRNYXBwaW5nW10gZmllbGRz\nOwogICAgICAgICAgICAgICAgaWYgKGNscy5nZXRFbWJlZGRpbmdNZXRhRGF0\nYSgpID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gY2xz\nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gY2xzLmdldEZpZWxk\nTWFwcGluZ3MoKTsKICAgICAgICAgICAgICAgIGZvciAoRmllbGRNYXBwaW5n\nIGYgOiBmaWVsZHMpCiAgICAgICAgICAgICAgICAgICAgZi5zeW5jTWFwcGlu\nZ0luZm8oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdXBl\nci5zZXJpYWxpemVDbGFzcyhtZXRhKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZUNsYXNzTWFwcGluZ0NvbnRl\nbnQoQ2xhc3NNZXRhRGF0YSBtYXBwaW5nKSB7CiAgICAgICAgQ2xhc3NNYXBw\naW5nIGNscyA9IChDbGFzc01hcHBpbmcpIG1hcHBpbmc7CiAgICAgICAgQ2xh\nc3NNYXBwaW5nSW5mbyBpbmZvID0gY2xzLmdldE1hcHBpbmdJbmZvKCk7CiAg\nICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWJUYWJsZSA9IGFkZEFubm90YXRp\nb24oVGFibGUuY2xhc3MsIG1hcHBpbmcpOwogICAgICAgIHNlcmlhbGl6ZVRh\nYmxlKGluZm8uZ2V0VGFibGVOYW1lKCksIFN0cmluZ3MKICAgICAgICAgICAg\nLmdldENsYXNzTmFtZShtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKSksIG51\nbGwsCiAgICAgICAgICAgIGluZm8uZ2V0VW5pcXVlcyhpbmZvLmdldFRhYmxl\nTmFtZSgpKSwgYWJUYWJsZSk7CiAgICAgICAgc2VyaWFsaXplQ29sdW1ucyhp\nbmZvLCBDb2xUeXBlLlBLX0pPSU4sIG51bGwsIGFiVGFibGUsIGNscyk7CiAg\nICAgICAgZm9yIChTdHJpbmcgc2Vjb25kIDogaW5mby5nZXRTZWNvbmRhcnlU\nYWJsZU5hbWVzKCkpIHsKICAgICAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIg\nYWJTZWNUYWJsZSA9CiAgICAgICAgICAgICAgICBhZGRBbm5vdGF0aW9uKFNl\nY29uZGFyeVRhYmxlLmNsYXNzLCBtYXBwaW5nKTsKICAgICAgICAgICAgc2Vy\naWFsaXplVGFibGUoc2Vjb25kLCBudWxsLCBpbmZvLCBpbmZvLmdldFVuaXF1\nZXMoc2Vjb25kKSwgYWJTZWNUYWJsZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplSW5oZXJp\ndGFuY2VDb250ZW50KENsYXNzTWV0YURhdGEgbWFwcGluZykgewogICAgICAg\nIENsYXNzTWFwcGluZyBjbHMgPSAoQ2xhc3NNYXBwaW5nKSBtYXBwaW5nOwog\nICAgICAgIENsYXNzTWFwcGluZ0luZm8gaW5mbyA9IGNscy5nZXRNYXBwaW5n\nSW5mbygpOwogICAgICAgIERpc2NyaW1pbmF0b3JNYXBwaW5nSW5mbyBkaW5m\nbyA9IGNscy5nZXREaXNjcmltaW5hdG9yKCkKICAgICAgICAgICAgLmdldE1h\ncHBpbmdJbmZvKCk7CiAgICAgICAgU3RyaW5nIHN0cmF0ID0gaW5mby5nZXRI\naWVyYXJjaHlTdHJhdGVneSgpOwogICAgICAgIGlmIChudWxsID09IHN0cmF0\nKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgU3RyaW5nIGl0eXBlY2xz\nID0gU3RyaW5ncy5nZXRDbGFzc05hbWUoSW5oZXJpdGFuY2VUeXBlLmNsYXNz\nKTsKICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYkluaGVyaXRhbmNlID0K\nICAgICAgICAgICAgYWRkQW5ub3RhdGlvbihJbmhlcml0YW5jZS5jbGFzcywg\nbWFwcGluZyk7CiAgICAgICAgaWYgKEZsYXRDbGFzc1N0cmF0ZWd5LkFMSUFT\nLmVxdWFscyhzdHJhdCkpCiAgICAgICAgICAgIGFiSW5oZXJpdGFuY2UuYWRk\nKCJzdHJhdGVneSIsIGl0eXBlY2xzICsgIi5TSU5HTEVfVEFCTEUiKTsKICAg\nICAgICBlbHNlIGlmIChWZXJ0aWNhbENsYXNzU3RyYXRlZ3kuQUxJQVMuZXF1\nYWxzKHN0cmF0KSkKICAgICAgICAgICAgYWJJbmhlcml0YW5jZS5hZGQoInN0\ncmF0ZWd5IiwgaXR5cGVjbHMgKyAiLkpPSU5FRCIpOwogICAgICAgIGVsc2Ug\naWYgKEZ1bGxDbGFzc1N0cmF0ZWd5LkFMSUFTLmVxdWFscyhzdHJhdCkpCiAg\nICAgICAgICAgIGFiSW5oZXJpdGFuY2UuYWRkKCJzdHJhdGVneSIsIGl0eXBl\nY2xzICsgIi5UQUJMRV9QRVJfQ0xBU1MiKTsKICAgICAgICBpZiAoZGluZm8u\nZ2V0VmFsdWUoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIEFubm90YXRpb25C\ndWlsZGVyIGFiRGlzY1ZhbCA9CiAgICAgICAgICAgICAgICBhZGRBbm5vdGF0\naW9uKERpc2NyaW1pbmF0b3JWYWx1ZS5jbGFzcywgbWFwcGluZyk7CiAgICAg\nICAgICAgIGFiRGlzY1ZhbC5hZGQobnVsbCwgZGluZm8uZ2V0VmFsdWUoKSk7\nCiAgICAgICAgfQogICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiRGlzY0Nv\nbCA9CiAgICAgICAgICAgIGFkZEFubm90YXRpb24oRGlzY3JpbWluYXRvckNv\nbHVtbi5jbGFzcywgbWFwcGluZyk7CiAgICAgICAgc2VyaWFsaXplQ29sdW1u\ncyhkaW5mbywgQ29sVHlwZS5ESVNDLCBudWxsLCBhYkRpc2NDb2wsIG51bGwp\nOwogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIHRhYmxlIG9wdGlv\nbmFsbHkgbGlzdGluZyBwcmltYXJ5LWtleS1qb2lucyBzdG9yZWQKICAgICAq\nIGluIHRoZSBnaXZlbiB7QGxpbmsgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5DbGFzc01hcHBpbmdJbmZvfS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHNlcmlhbGl6ZVRhYmxlKFN0cmluZyB0YWJsZSwgU3RyaW5nIGRlZmF1\nbHROYW1lLAogICAgICAgIENsYXNzTWFwcGluZ0luZm8gc2Vjb25kYXJ5SW5m\nbywgVW5pcXVlW10gdW5pcXVlcywKICAgICAgICBBbm5vdGF0aW9uQnVpbGRl\nciBhYikgewogICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gbnVsbDsKICAg\nICAgICBpZiAoc2Vjb25kYXJ5SW5mbyAhPSBudWxsKQogICAgICAgICAgICBj\nb2xzID0gKExpc3Q8Q29sdW1uPikgc2Vjb25kYXJ5SW5mby5nZXRTZWNvbmRh\ncnlUYWJsZUpvaW5Db2x1bW5zCiAgICAgICAgICAgICAgICAodGFibGUpOwoK\nICAgICAgICBib29sZWFuIHByaW50ID0gKGNvbHMgIT0gbnVsbCAmJiBjb2xz\nLnNpemUoKSA+IDApIHx8CiAgICAgICAgICAgICh1bmlxdWVzICE9IG51bGwg\nJiYgdW5pcXVlcy5sZW5ndGggPiAwKTsKICAgICAgICBpZiAodGFibGUgIT0g\nbnVsbAogICAgICAgICAgICAmJiAoZGVmYXVsdE5hbWUgPT0gbnVsbCB8fCAh\nZGVmYXVsdE5hbWUuZXF1YWxzKHRhYmxlKSkpIHsKICAgICAgICAgICAgcHJp\nbnQgPSB0cnVlOwogICAgICAgICAgICBpbnQgaW5kZXggPSB0YWJsZS5pbmRl\neE9mKCcuJyk7CiAgICAgICAgICAgIGlmIChpbmRleCA8IDApCiAgICAgICAg\nICAgICAgICBhYi5hZGQoIm5hbWUiLCB0YWJsZSk7CiAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgYWIuYWRkKCJzY2hlbWEiLCB0YWJsZS5z\ndWJzdHJpbmcoMCwgaW5kZXgpKTsKICAgICAgICAgICAgICAgIGFiLmFkZCgi\nbmFtZSIsIHRhYmxlLnN1YnN0cmluZyhpbmRleCArIDEpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBpZiAocHJpbnQpIHsKICAgICAgICAg\nICAgaWYgKGNvbHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZm9yIChD\nb2x1bW4gY29sIDogY29scykKICAgICAgICAgICAgICAgICAgICBzZXJpYWxp\nemVDb2x1bW4oY29sLCBDb2xUeXBlLlBLX0pPSU4sCiAgICAgICAgICAgICAg\nICAgICAgICAgIG51bGwsIGZhbHNlLCBhYiwgbnVsbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgaWYgKHVuaXF1ZXMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgZm9yIChVbmlxdWUgdW5pcXVlOiB1bmlxdWVzKSB7CiAgICAg\nICAgICAgICAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWJVbmlxdWVDb25z\ndCA9CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0Fubm90YXRpb25CdWls\nZGVyKFVuaXF1ZUNvbnN0cmFpbnQuY2xhc3MpOwogICAgICAgICAgICAgICAg\nICAgIHNlcmlhbGl6ZVVuaXF1ZUNvbnN0cmFpbnQodW5pcXVlLCBhYlVuaXF1\nZUNvbnN0KTsKICAgICAgICAgICAgICAgICAgICBhYi5hZGQoInVuaXF1ZUNv\nbnN0cmFpbnRzIiwgYWJVbmlxdWVDb25zdCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBzZXJpYWxpemVBdHRyaWJ1dGVPdmVy\ncmlkZShGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBGaWVsZE1ldGFEYXRh\nIG9yaWcpIHsKICAgICAgICBpZiAob3JpZyA9PSBudWxsIHx8IGZtZCA9PSBv\ncmlnKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIEZpZWxk\nTWFwcGluZyBmaWVsZCA9IChGaWVsZE1hcHBpbmcpIGZtZDsKICAgICAgICBG\naWVsZE1hcHBpbmcgZmllbGQyID0gKEZpZWxkTWFwcGluZykgb3JpZzsKICAg\nICAgICBpZiAoZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5oYXNTY2hlbWFDb21w\nb25lbnRzKCkKICAgICAgICAgICAgfHwgZmllbGQyLmdldE1hcHBpbmdJbmZv\nKCkuaGFzU2NoZW1hQ29tcG9uZW50cygpKQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKCiAgICAgICAgVmFsdWVNYXBwaW5nSW5mbyBpbmZvID0gZmllbGQu\nZ2V0VmFsdWVJbmZvKCk7CiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSAo\nTGlzdDxDb2x1bW4+KSBpbmZvLmdldENvbHVtbnMoKTsKICAgICAgICBpZiAo\nY29scyA9PSBudWxsIHx8IGNvbHMuc2l6ZSgpID09IDApCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICBWYWx1ZU1hcHBpbmdJbmZvIGluZm8y\nID0gZmllbGQyLmdldFZhbHVlSW5mbygpOwogICAgICAgIExpc3Q8Q29sdW1u\nPiBjb2xzMiA9IChMaXN0PENvbHVtbj4pIGluZm8yLmdldENvbHVtbnMoKTsK\nICAgICAgICBpZiAoY29sczIgPT0gbnVsbCB8fCBjb2xzMi5zaXplKCkgIT0g\nY29scy5zaXplKCkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIGlmIChjb2xzLnNpemUoKSAhPSAxKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKCiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBDb2x1bW4gY29sMjsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMuc2l6ZSgpOyBpKysp\nIHsKICAgICAgICAgICAgY29sID0gY29scy5nZXQoaSk7CiAgICAgICAgICAg\nIGNvbDIgPSBjb2xzMi5nZXQoaSk7CiAgICAgICAgICAgIGlmICghU3RyaW5n\nVXRpbHMuZXF1YWxzKGNvbC5nZXROYW1lKCksIGNvbDIuZ2V0TmFtZSgpKSkK\nICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAo\nIVN0cmluZ1V0aWxzLmVxdWFscyhjb2wuZ2V0VHlwZU5hbWUoKSwgY29sMi5n\nZXRUeXBlTmFtZSgpKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgICAgICBpZiAoY29sLmdldFNpemUoKSAhPSBjb2wyLmdldFNpemUo\nKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBp\nZiAoY29sLmdldERlY2ltYWxEaWdpdHMoKSAhPSBjb2wyLmdldERlY2ltYWxE\naWdpdHMoKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nICAgICBpZiAoY29sLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxF\nKQogICAgICAgICAgICAgICAgIT0gY29sMi5nZXRGbGFnKENvbHVtbi5GTEFH\nX1VOSU5TRVJUQUJMRSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICAgICAgaWYgKGNvbC5nZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBE\nQVRBQkxFKQogICAgICAgICAgICAgICAgIT0gY29sMi5nZXRGbGFnKENvbHVt\nbi5GTEFHX1VOVVBEQVRBQkxFKSkKICAgICAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVBdHRy\naWJ1dGVPdmVycmlkZU1hcHBpbmdDb250ZW50KEZpZWxkTWV0YURhdGEgZm1k\nLAogICAgICAgIEZpZWxkTWV0YURhdGEgb3JpZywgQW5ub3RhdGlvbkJ1aWxk\nZXIgYWIpIHsKICAgICAgICBGaWVsZE1hcHBpbmcgZm0gPSAoRmllbGRNYXBw\naW5nKSBmbWQ7CiAgICAgICAgc2VyaWFsaXplQ29sdW1ucyhmbS5nZXRWYWx1\nZUluZm8oKSwgQ29sVHlwZS5DT0wsIGZtLmdldE1hcHBpbmdJbmZvKCkKICAg\nICAgICAgICAgLmdldFRhYmxlTmFtZSgpLCBhYiwgZm1kKTsKICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZVN0cmF0ZWd5\nIGdldFN0cmF0ZWd5KEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgUGVy\nc2lzdGVuY2VTdHJhdGVneSBzdHJhdCA9IHN1cGVyLmdldFN0cmF0ZWd5KGZt\nZCk7CiAgICAgICAgRmllbGRNYXBwaW5nIGZpZWxkID0gKEZpZWxkTWFwcGlu\nZykgZm1kOwogICAgICAgIHN3aXRjaCAoc3RyYXQpIHsKICAgICAgICAgICAg\nY2FzZSBNQU5ZX01BTlk6CiAgICAgICAgICAgICAgICAvLyB3ZSBjYW4gZGlm\nZmVyZW50aWF0ZSBhIG9uZS1tYW55IGJ5IHRoZSBmYWN0IHRoYXQgdGhlcmUg\naXMgbm8KICAgICAgICAgICAgICAgIC8vIHNlY29uZGFyeSB0YWJsZSBqb2lu\nLCBvciB0aGUgZmsgaXMgdW5pcXVlCiAgICAgICAgICAgICAgICBpZiAoZmll\nbGQuZ2V0TWFwcGVkQnkoKSA9PSBudWxsCiAgICAgICAgICAgICAgICAgICAg\nJiYgKGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0Sm9pbkRpcmVjdGlvbigp\nCiAgICAgICAgICAgICAgICAgICAgPT0gTWFwcGluZ0luZm8uSk9JTl9OT05F\nCiAgICAgICAgICAgICAgICAgICAgfHwgZmllbGQuZ2V0RWxlbWVudE1hcHBp\nbmcoKS5nZXRWYWx1ZUluZm8oKS5nZXRVbmlxdWUoKQogICAgICAgICAgICAg\nICAgICAgICE9IG51bGwpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBQ\nZXJzaXN0ZW5jZVN0cmF0ZWd5Lk9ORV9NQU5ZOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgTUFOWV9PTkU6CiAgICAgICAgICAg\nICAgICAvLyBpbnZlcnNlIGpvaW4gY29scyBvciB1bmlxdWUgZms/CiAgICAg\nICAgICAgICAgICBpZiAoZmllbGQuZ2V0VmFsdWVJbmZvKCkuZ2V0Sm9pbkRp\ncmVjdGlvbigpCiAgICAgICAgICAgICAgICAgICAgPT0gTWFwcGluZ0luZm8u\nSk9JTl9JTlZFUlNFCiAgICAgICAgICAgICAgICAgICAgfHwgZmllbGQuZ2V0\nVmFsdWVJbmZvKCkuZ2V0VW5pcXVlKCkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5PTkVfT05FOwoK\nICAgICAgICAgICAgICAgIC8vIHNjYW4gZm9yIHByaW1hcnkta2V5LWpvaW4t\nY29sdW1uCiAgICAgICAgICAgICAgICBMaXN0PENvbHVtbj4gY29scyA9IGZp\nZWxkLmdldFZhbHVlSW5mbygpLmdldENvbHVtbnMoKTsKICAgICAgICAgICAg\nICAgIGJvb2xlYW4gcGtKb2luID0gY29scyAhPSBudWxsICYmIGNvbHMuc2l6\nZSgpID4gMDsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBwa0pv\naW4gJiYgaSA8IGNvbHMuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgICAgICAg\nICAgcGtKb2luID0gY29scy5nZXQoaSkuZ2V0RmxhZyhDb2x1bW4uRkxBR19Q\nS19KT0lOKTsKICAgICAgICAgICAgICAgIGlmIChwa0pvaW4pCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3kuT05FX09O\nRTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gc3RyYXQ7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0\nZWQgdm9pZCBzZXJpYWxpemVGaWVsZE1hcHBpbmdDb250ZW50KEZpZWxkTWV0\nYURhdGEgZm1kLAogICAgICAgIFBlcnNpc3RlbmNlU3RyYXRlZ3kgc3RyYXRl\nZ3ksIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAgICAgICAgaWYgKGZtZC5n\nZXRNYXBwZWRCeSgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgLy8gd2hpbGUgSSdkIGxpa2UgdG8gZG8gYXV0byBkZXRlY3Rpb24g\nYmFzZWQgb24gam9pbiBkaXJlY3Rpb25zLCBldGMuCiAgICAgICAgLy8gdGhl\nIGRpc3Rpbmd1aXNoZWQgY29sdW1uIC8gdGFibGUgLyBldGMgbmFtZXMgZm9y\nY2VzIG91ciBoYW5kCiAgICAgICAgLy8gZXNwIGZvciBPcGVuSlBBIGN1c3Rv\nbSBtYXBwaW5ncy4KICAgICAgICBGaWVsZE1hcHBpbmcgZmllbGQgPSAoRmll\nbGRNYXBwaW5nKSBmbWQ7CiAgICAgICAgc3dpdGNoIChzdHJhdGVneSkgewog\nICAgICAgICAgICBjYXNlIE9ORV9PTkU6CiAgICAgICAgICAgIGNhc2UgTUFO\nWV9PTkU6CiAgICAgICAgICAgICAgICBzZXJpYWxpemVDb2x1bW5zKGZpZWxk\nLmdldFZhbHVlSW5mbygpLCBDb2xUeXBlLkpPSU4sCiAgICAgICAgICAgICAg\nICAgICAgZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5nZXRUYWJsZU5hbWUoKSwg\nbnVsbCwgZm1kKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgY2FzZSBPTkVfTUFOWToKICAgICAgICAgICAgICAgIGlmIChmaWVsZC5n\nZXRNYXBwaW5nSW5mbygpLmdldEpvaW5EaXJlY3Rpb24oKSA9PQogICAgICAg\nICAgICAgICAgICAgIE1hcHBpbmdJbmZvLkpPSU5fTk9ORSkgewogICAgICAg\nICAgICAgICAgICAgIHNlcmlhbGl6ZUNvbHVtbnMoZmllbGQuZ2V0RWxlbWVu\ndE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgQ29sVHlwZS5KT0lOLCBudWxsLCBudWxsLCBmbWQpOwogICAgICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIC8vIGVsc2Ugbm8gYnJlYWsKICAgICAgICAgICAgY2FzZSBN\nQU5ZX01BTlk6CiAgICAgICAgICAgICAgICBpZiAoZmllbGQuZ2V0TWFwcGlu\nZ0luZm8oKS5oYXNTY2hlbWFDb21wb25lbnRzKCkKICAgICAgICAgICAgICAg\nICAgICB8fCBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5m\nbygpCiAgICAgICAgICAgICAgICAgICAgLmhhc1NjaGVtYUNvbXBvbmVudHMo\nKSkgewogICAgICAgICAgICAgICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFi\nSm9pblRibCA9CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEFubm90YXRp\nb24oSm9pblRhYmxlLmNsYXNzLCBmbWQpOwogICAgICAgICAgICAgICAgICAg\nIFN0cmluZyB0YWJsZSA9IGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0VGFi\nbGVOYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW50IGluZGV4ID0gdGFi\nbGUuaW5kZXhPZignLicpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\naW5kZXggPCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJKb2lu\nVGJsLmFkZCgibmFtZSIsIHRhYmxlKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYkpvaW5U\nYmwuYWRkKCJzY2hlbWEiLCB0YWJsZS5zdWJzdHJpbmcoMCwgaW5kZXgpKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiSm9pblRibC5hZGQoIm5h\nbWUiLCB0YWJsZS5zdWJzdHJpbmcoaW5kZXggKyAxKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgc2VyaWFsaXplQ29sdW1ucyhmaWVsZC5nZXRNYXBwaW5n\nSW5mbygpLAogICAgICAgICAgICAgICAgICAgICAgICBDb2xUeXBlLkpPSU4s\nIG51bGwsIGFiSm9pblRibCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAg\nc2VyaWFsaXplQ29sdW1ucyhmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdl\ndFZhbHVlSW5mbygpLAogICAgICAgICAgICAgICAgICAgICAgICBDb2xUeXBl\nLklOVkVSU0UsIG51bGwsIGFiSm9pblRibCwgbnVsbCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBzZXJpYWxpemVDb2x1bW5zKGZpZWxkLmdldFZhbHVlSW5mbygpLCBD\nb2xUeXBlLkNPTCwKICAgICAgICAgICAgZmllbGQuZ2V0TWFwcGluZ0luZm8o\nKS5nZXRUYWJsZU5hbWUoKSwgbnVsbCwgZm1kKTsKICAgICAgICBpZiAoc3Ry\nYXRlZ3kgPT0gUGVyc2lzdGVuY2VTdHJhdGVneS5CQVNJQyAmJiBpc0xvYihm\naWVsZCkpIHsKICAgICAgICAgICAgYWRkQW5ub3RhdGlvbihMb2IuY2xhc3Ms\nIGZtZCk7CiAgICAgICAgfQogICAgICAgIFRlbXBvcmFsVHlwZSB0ZW1wb3Jh\nbCA9IGdldFRlbXBvcmFsKGZpZWxkKTsKICAgICAgICBpZiAodGVtcG9yYWwg\nIT0gbnVsbCkgewogICAgICAgICAgICBhZGRBbm5vdGF0aW9uKFRlbXBvcmFs\nLmNsYXNzLCBmbWQpLgogICAgICAgICAgICAgICAgYWRkKG51bGwsIHRlbXBv\ncmFsKTsKICAgICAgICB9CgogICAgICAgIEVudW1UeXBlIGVudW1UeXBlID0g\nZ2V0RW51bVR5cGUoZmllbGQpOwogICAgICAgIGlmIChlbnVtVHlwZSAhPSBu\ndWxsICYmIGVudW1UeXBlICE9IEVudW1UeXBlLk9SRElOQUwpIHsKICAgICAg\nICAgICAgYWRkQW5ub3RhdGlvbihFbnVtZXJhdGVkLmNsYXNzLCBmbWQpLgog\nICAgICAgICAgICAgICAgYWRkKG51bGwsIGVudW1UeXBlKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGZpZWxk\nIGlzIGEgbG9iLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNMb2Io\nRmllbGRNYXBwaW5nIGZpZWxkKSB7CiAgICAgICAgZm9yIChDb2x1bW4gY29s\nIDogKExpc3Q8Q29sdW1uPikgZmllbGQuZ2V0VmFsdWVJbmZvKCkuZ2V0Q29s\ndW1ucygpKQogICAgICAgICAgICBpZiAoY29sLmdldFR5cGUoKSA9PSBUeXBl\ncy5CTE9CIHx8IGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMuQ0xPQikKICAgICAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBmaWVsZCdzIHRlbXBvcmFs\nIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgVGVtcG9yYWxUeXBlIGdldFRl\nbXBvcmFsKEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAgICAgIGlmIChmaWVs\nZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLkRBVEUKICAg\nICAgICAgICAgJiYgZmllbGQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEph\ndmFUeXBlcy5DQUxFTkRBUikKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0gKChKREJDQ29uZmlndXJhdGlv\nbikgZ2V0Q29uZmlndXJhdGlvbigpKQogICAgICAgICAgICAuZ2V0REJEaWN0\naW9uYXJ5SW5zdGFuY2UoKTsKICAgICAgICBpbnQgZGVmID0gZGljdC5nZXRK\nREJDVHlwZShmaWVsZC5nZXRUeXBlQ29kZSgpLCBmYWxzZSk7CiAgICAgICAg\nZm9yIChDb2x1bW4gY29sIDogKExpc3Q8Q29sdW1uPikgZmllbGQuZ2V0VmFs\ndWVJbmZvKCkuZ2V0Q29sdW1ucygpKSB7CiAgICAgICAgICAgIGlmIChjb2wu\nZ2V0VHlwZSgpID09IGRlZikKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICBzd2l0Y2ggKGNvbC5nZXRUeXBlKCkpIHsKICAgICAgICAg\nICAgICAgIGNhc2UgVHlwZXMuREFURToKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gVGVtcG9yYWxUeXBlLkRBVEU7CiAgICAgICAgICAgICAgICBjYXNl\nIFR5cGVzLlRJTUU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRlbXBv\ncmFsVHlwZS5USU1FOwogICAgICAgICAgICAgICAgY2FzZSBUeXBlcy5USU1F\nU1RBTVA6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRlbXBvcmFsVHlw\nZS5USU1FU1RBTVA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gZW51\nbSB0eXBlIGZvciB0aGUgZmllbGQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBF\nbnVtVHlwZSBnZXRFbnVtVHlwZShGaWVsZE1hcHBpbmcgZmllbGQpIHsKICAg\nICAgICBpZiAoZmllbGQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFU\neXBlcy5PQkpFQ1QpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIGlmICghKGZpZWxkLmdldEhhbmRsZXIoKSBpbnN0YW5jZW9mIEVudW1WYWx1\nZUhhbmRsZXIpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBy\nZXR1cm4gKChFbnVtVmFsdWVIYW5kbGVyKSBmaWVsZC5nZXRIYW5kbGVyKCkp\nLmdldFN0b3JlT3JkaW5hbCgpCiAgICAgICAgICAgID8gRW51bVR5cGUuT1JE\nSU5BTCA6IEVudW1UeXBlLlNUUklORzsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNlcmlhbGl6ZSB0aGUgY29sdW1ucyBpbiB0aGUgZ2l2ZW4gbWFwcGluZyBp\nbmZvLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2VyaWFsaXplQ29sdW1u\ncyhNYXBwaW5nSW5mbyBpbmZvLCBDb2xUeXBlIHR5cGUsCiAgICAgICAgU3Ry\naW5nIHNlY29uZGFyeSwgQW5ub3RhdGlvbkJ1aWxkZXIgYWIsIE9iamVjdCBt\nZXRhKSB7CiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSAoTGlzdDxDb2x1\nbW4+KSBpbmZvLmdldENvbHVtbnMoKTsKICAgICAgICBpZiAoY29scyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgQW5ub3RhdGlvbkJ1\naWxkZXIgYWJDb250YWluZXIgPSBhYjsKICAgICAgICBpZiAoY29scy5zaXpl\nKCkgPiAxKSB7CiAgICAgICAgICAgIENsYXNzIGdycFR5cGUgPSB0eXBlLmdl\ndENvbHVtbkdyb3VwQW5ub3RhdGlvblR5cGUoKTsKICAgICAgICAgICAgaWYg\nKG51bGwgIT0gZ3JwVHlwZSkgewogICAgICAgICAgICAgICAgQW5ub3RhdGlv\nbkJ1aWxkZXIgYWJHcnAgPSBuZXdBbm5vdGF0aW9uQnVpbGRlcihncnBUeXBl\nKTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IGFiKQogICAgICAgICAg\nICAgICAgICAgIGFkZEFubm90YXRpb24oYWJHcnAsIG1ldGEpOwogICAgICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGFiLmFkZChudWxs\nLCBhYkdycCk7CiAgICAgICAgICAgICAgICBhYkNvbnRhaW5lciA9IGFiR3Jw\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAoQ29sdW1u\nIGNvbCA6IGNvbHMpCiAgICAgICAgICAgIHNlcmlhbGl6ZUNvbHVtbihjb2ws\nIHR5cGUsIHNlY29uZGFyeSwKICAgICAgICAgICAgICAgIGluZm8uZ2V0VW5p\ncXVlKCkgIT0gbnVsbCwgYWJDb250YWluZXIsIG1ldGEpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2VyaWFsaXplIGEgc2luZ2xlIGNvbHVtbi4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZUNvbHVtbihDb2x1bW4gY29s\nLCBDb2xUeXBlIHR5cGUsIFN0cmluZyBzZWNvbmRhcnksCiAgICAgICAgYm9v\nbGVhbiB1bmlxdWUsIEFubm90YXRpb25CdWlsZGVyIGFiLCBPYmplY3QgbWV0\nYSkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gbWV0YSBpbnN0YW5j\nZW9mIEZpZWxkTWV0YURhdGEgPwogICAgICAgICAgICAoRmllbGRNZXRhRGF0\nYSkgbWV0YSA6IG51bGw7CiAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWJD\nb2wgPSBuZXdBbm5vdGF0aW9uQnVpbGRlcigKICAgICAgICAgICAgdHlwZS5n\nZXRDb2x1bW5Bbm5vdGF0aW9uVHlwZSgpKTsKICAgICAgICBpZiAoY29sLmdl\ndE5hbWUoKSAhPSBudWxsICYmIChudWxsID09IGZtZCB8fAogICAgICAgICAg\nICAhY29sLmdldE5hbWUoKS5lcXVhbHNJZ25vcmVDYXNlKGZtZC5nZXROYW1l\nKCkpKSkKICAgICAgICAgICAgYWJDb2wuYWRkKCJuYW1lIiwgY29sLmdldE5h\nbWUoKSk7CiAgICAgICAgaWYgKGNvbC5nZXRUeXBlTmFtZSgpICE9IG51bGwp\nCiAgICAgICAgICAgIGFiQ29sLmFkZCgiY29sdW1uRGVmaW5pdGlvbiIsIGNv\nbC5nZXRUeXBlTmFtZSgpKTsKICAgICAgICBpZiAoY29sLmdldFRhcmdldCgp\nICE9IG51bGwKICAgICAgICAgICAgJiYgKHR5cGUgPT0gQ29sVHlwZS5KT0lO\nIHx8IHR5cGUgPT0gQ29sVHlwZS5JTlZFUlNFCiAgICAgICAgICAgIHx8IHR5\ncGUgPT0gQ29sVHlwZS5QS19KT0lOKSkKICAgICAgICAgICAgYWJDb2wuYWRk\nKCJyZWZlcmVuY2VkQ29sdW1uTmFtZSIsIGNvbC5nZXRUYXJnZXQoKSk7CiAg\nICAgICAgaWYgKHR5cGUgPT0gQ29sVHlwZS5DT0wgfHwgdHlwZSA9PSBDb2xU\neXBlLkpPSU4KICAgICAgICAgICAgfHwgdHlwZSA9PSBDb2xUeXBlLlBLX0pP\nSU4pIHsKICAgICAgICAgICAgaWYgKHVuaXF1ZSkKICAgICAgICAgICAgICAg\nIGFiQ29sLmFkZCgidW5pcXVlIiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChj\nb2wuaXNOb3ROdWxsKCkpCiAgICAgICAgICAgICAgICBhYkNvbC5hZGQoIm51\nbGxhYmxlIiwgZmFsc2UpOwogICAgICAgICAgICBpZiAoY29sLmdldEZsYWco\nQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFKSkKICAgICAgICAgICAgICAgIGFi\nQ29sLmFkZCgiaW5zZXJ0YWJsZSIsIGZhbHNlKTsKICAgICAgICAgICAgaWYg\nKGNvbC5nZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFKSkKICAgICAg\nICAgICAgICAgIGFiQ29sLmFkZCgidXBkYXRhYmxlIiwgZmFsc2UpOwogICAg\nICAgICAgICBpZiAoc2Vjb25kYXJ5ICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBhYkNvbC5hZGQoInRhYmxlIiwgc2Vjb25kYXJ5KTsKCiAgICAgICAgICAg\nIGlmICh0eXBlID09IENvbFR5cGUuQ09MKSB7CiAgICAgICAgICAgICAgICBp\nZiAoY29sLmdldFNpemUoKSA+IDAgJiYgY29sLmdldFNpemUoKSAhPSAyNTUp\nCiAgICAgICAgICAgICAgICAgICAgYWJDb2wuYWRkKCJsZW5ndGgiLCBjb2wu\nZ2V0U2l6ZSgpKTsKICAgICAgICAgICAgICAgIGlmIChjb2wuZ2V0RGVjaW1h\nbERpZ2l0cygpICE9IDApCiAgICAgICAgICAgICAgICAgICAgYWJDb2wuYWRk\nKCJzY2FsZSIsIGNvbC5nZXREZWNpbWFsRGlnaXRzKCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZSAhPSBDb2xUeXBlLkNP\nTCB8fCBhYkNvbC5oYXNDb21wb25lbnRzKCkpIHsKICAgICAgICAgICAgaWYg\nKG51bGwgIT0gYWIpIHsKICAgICAgICAgICAgICAgIFN0cmluZyBrZXkgPSBu\ndWxsOwogICAgICAgICAgICAgICAgaWYgKGFiLmdldFR5cGUoKSA9PSBKb2lu\nVGFibGUuY2xhc3MpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2godHlw\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEpPSU46CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSAiam9pbkNvbHVtbnMiOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNhc2UgSU5WRVJTRToKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGtleSA9ICJpbnZlcnNlSm9pbkNvbHVtbnMiOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYWIuYWRk\nKGtleSwgYWJDb2wpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgYWRkQW5ub3RhdGlvbihhYkNvbCwgbWV0YSk7CiAgICAgICAgICAg\nIH0gICAgICAgICAgICAgICAgCiAgICAgICAgfQogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBzZXJpYWxpemVVbmlxdWVDb25zdHJhaW50KFVuaXF1ZSB1bmlx\ndWUsCiAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWIpIHsKICAgICAgICBT\ndHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAg\nICBDb2x1bW5bXSBjb2x1bW5zID0gdW5pcXVlLmdldENvbHVtbnMoKTsKICAg\nICAgICBmb3IgKENvbHVtbiBjb2x1bW46Y29sdW1ucykgewogICAgICAgICAg\nICBpZiAoc2IubGVuZ3RoKCkgPiAwKQogICAgICAgICAgICAgICAgc2IuYXBw\nZW5kKCIsICIpOwogICAgICAgICAgICBzYi5hcHBlbmQoY29sdW1uLmdldE5h\nbWUoKSk7CiAgICAgICAgfQogICAgICAgIGlmIChjb2x1bW5zLmxlbmd0aCA+\nIDEpCiAgICAgICAgICAgIHNiLmluc2VydCgwLCAieyIpLmFwcGVuZCgifSIp\nOwogICAgICAgIGFiLmFkZCgiY29sdW1uTmFtZXMiLCBzYi50b1N0cmluZygp\nKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBTZXJpYWxp\nemF0aW9uQ29tcGFyYXRvciBuZXdTZXJpYWxpemF0aW9uQ29tcGFyYXRvcigp\nIHsKICAgICAgICByZXR1cm4gbmV3IEFubm90YXRpb25QZXJzaXN0ZW5jZU1h\ncHBpbmdTZXJpYWxpemVyLgogICAgICAgICAgICBNYXBwaW5nU2VyaWFsaXph\ndGlvbkNvbXBhcmF0b3IoKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHBy\nb3RlY3RlZCB2b2lkIGFkZFN5c3RlbU1hcHBpbmdFbGVtZW50cyhDb2xsZWN0\naW9uIHRvU2VyaWFsaXplKSB7CiAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkp\nCiAgICAgICAgICAgIHRvU2VyaWFsaXplLmFkZEFsbChnZXRRdWVyeVJlc3Vs\ndE1hcHBpbmdzKG51bGwpKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHBy\nb3RlY3RlZCBpbnQgdHlwZShPYmplY3QgbykgewogICAgICAgIGludCB0eXBl\nID0gc3VwZXIudHlwZShvKTsKICAgICAgICBpZiAodHlwZSA9PSAtMSAmJiBv\nIGluc3RhbmNlb2YgUXVlcnlSZXN1bHRNYXBwaW5nKQogICAgICAgICAgICBy\nZXR1cm4gVFlQRV9SRVNVTFRNQVA7CiAgICAgICAgcmV0dXJuIHR5cGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJlc3VsdCBzZXQgbWFw\ncGluZ3MgZm9yIHRoZSBnaXZlbiBzY29wZS4KICAgICAqLwogICAgcHJpdmF0\nZSBMaXN0PFF1ZXJ5UmVzdWx0TWFwcGluZz4gZ2V0UXVlcnlSZXN1bHRNYXBw\naW5ncyhDbGFzc01ldGFEYXRhIGNtKSB7CiAgICAgICAgaWYgKF9yZXN1bHRz\nID09IG51bGwgfHwgX3Jlc3VsdHMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm4gKExpc3Q8UXVlcnlSZXN1bHRNYXBwaW5nPikgQ29sbGVjdGlvbnMu\nRU1QVFlfTElTVDsKCiAgICAgICAgTGlzdDxRdWVyeVJlc3VsdE1hcHBpbmc+\nIHJlc3VsdCA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBf\ncmVzdWx0cy5zaXplKCk7IGkrKykgewogICAgICAgICAgICBRdWVyeVJlc3Vs\ndE1hcHBpbmcgZWxlbWVudCA9IF9yZXN1bHRzLmdldChpKTsKICAgICAgICAg\nICAgaWYgKChjbSA9PSBudWxsICYmIGVsZW1lbnQuZ2V0U291cmNlU2NvcGUo\nKSAhPSBudWxsKSB8fCAoY20gIT0gbnVsbAogICAgICAgICAgICAgICAgJiYg\nZWxlbWVudC5nZXRTb3VyY2VTY29wZSgpICE9IGNtLmdldERlc2NyaWJlZFR5\ncGUoKSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAg\nIGlmIChyZXN1bHQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJlc3VsdCA9\nIG5ldyBBcnJheUxpc3Q8UXVlcnlSZXN1bHRNYXBwaW5nPihfcmVzdWx0cy5z\naXplKCkgLSBpKTsKICAgICAgICAgICAgcmVzdWx0LmFkZChlbGVtZW50KTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIChyZXN1bHQgPT0gbnVsbCkKICAg\nICAgICAgICAgPyAoTGlzdDxRdWVyeVJlc3VsdE1hcHBpbmc+KSBDb2xsZWN0\naW9ucy5FTVBUWV9MSVNUIDogcmVzdWx0OwogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplU3lzdGVtTWFwcGluZ0Vs\nZW1lbnQoT2JqZWN0IG9iaikgewogICAgICAgIGlmIChvYmogaW5zdGFuY2Vv\nZiBRdWVyeVJlc3VsdE1hcHBpbmcpCiAgICAgICAgICAgIHNlcmlhbGl6ZVF1\nZXJ5UmVzdWx0TWFwcGluZygoUXVlcnlSZXN1bHRNYXBwaW5nKSBvYmosIG51\nbGwpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQg\nc2VyaWFsaXplUXVlcnlNYXBwaW5ncyhDbGFzc01ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICBmb3IgKFF1ZXJ5UmVzdWx0TWFwcGluZyByZXMgOiBnZXRRdWVy\neVJlc3VsdE1hcHBpbmdzKG1ldGEpKQogICAgICAgICAgICBzZXJpYWxpemVR\ndWVyeVJlc3VsdE1hcHBpbmcocmVzLCBtZXRhKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNlcmlhbGl6ZSBnaXZlbiByZXN1bHQgc2V0IG1hcHBpbmcuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXJpYWxpemVRdWVyeVJlc3VsdE1h\ncHBpbmcoUXVlcnlSZXN1bHRNYXBwaW5nIG1ldGEsCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBjbHNtZXRhKSB7CiAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIg\nYWIgPSBhZGRBbm5vdGF0aW9uKFNxbFJlc3VsdFNldE1hcHBpbmcuY2xhc3Ms\nIG1ldGEpOwogICAgICAgIGlmIChudWxsICE9IGNsc21ldGEpCiAgICAgICAg\nICAgIGFkZEFubm90YXRpb24oYWIsIGNsc21ldGEpOwogICAgICAgIGFiLmFk\nZCgibmFtZSIsIG1ldGEuZ2V0TmFtZSgpKTsKICAgICAgICBmb3IgKFF1ZXJ5\nUmVzdWx0TWFwcGluZy5QQ1Jlc3VsdCBwYyA6IG1ldGEuZ2V0UENSZXN1bHRz\nKCkpIHsKICAgICAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWJFbnRSZXMg\nPQogICAgICAgICAgICAgICAgbmV3QW5ub3RhdGlvbkJ1aWxkZXIoRW50aXR5\nUmVzdWx0LmNsYXNzKTsKICAgICAgICAgICAgYWIuYWRkKCJlbnRpdGllcyIs\nIGFiRW50UmVzKTsKICAgICAgICAgICAgYWJFbnRSZXMuYWRkKCJlbnRpdHlD\nbGFzcyIsIHBjLmdldENhbmRpZGF0ZVR5cGUoKSk7CiAgICAgICAgICAgIE9i\namVjdCBkaXNjcmltID0gcGMuZ2V0TWFwcGluZyhwYy5ESVNDUklNSU5BVE9S\nKTsKICAgICAgICAgICAgaWYgKGRpc2NyaW0gIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGFiRW50UmVzLmFkZCgiZGlzY3JpbWluYXRvckNvbHVtbiIsIGRp\nc2NyaW0udG9TdHJpbmcoKSk7CgogICAgICAgICAgICBmb3IgKFN0cmluZyBw\nYXRoIDogcGMuZ2V0TWFwcGluZ1BhdGhzKCkpIHsKICAgICAgICAgICAgICAg\nIEFubm90YXRpb25CdWlsZGVyIGFiRmxkUmVzID0KICAgICAgICAgICAgICAg\nICAgICBuZXdBbm5vdGF0aW9uQnVpbGRlcihGaWVsZFJlc3VsdC5jbGFzcyk7\nCiAgICAgICAgICAgICAgICBhYkVudFJlcy5hZGQoImZpZWxkcyIsIGFiRmxk\nUmVzKTsKICAgICAgICAgICAgICAgIGFiRmxkUmVzLmFkZCgibmFtZSIsIHBh\ndGgpOwogICAgICAgICAgICAgICAgYWJGbGRSZXMuYWRkKCJjb2x1bW4iLCBw\nYy5nZXRNYXBwaW5nKHBhdGgpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGZvciAoT2JqZWN0IGNvbCA6IG1ldGEuZ2V0\nQ29sdW1uUmVzdWx0cygpKSB7CiAgICAgICAgICAgIEFubm90YXRpb25CdWls\nZGVyIGFiQ29sUmVzID0KICAgICAgICAgICAgICAgIG5ld0Fubm90YXRpb25C\ndWlsZGVyKENvbHVtblJlc3VsdC5jbGFzcyk7CiAgICAgICAgICAgIGFiQ29s\nUmVzLmFkZCgibmFtZSIsIGNvbC50b1N0cmluZygpKTsKICAgICAgICB9CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxp\nemVTZXF1ZW5jZShTZXF1ZW5jZU1ldGFEYXRhIG1ldGEpIHsKICAgICAgICBp\nZiAoU2VxdWVuY2VNYXBwaW5nLklNUExfVkFMVUVfVEFCTEUuZXF1YWxzKG1l\ndGEuZ2V0U2VxdWVuY2VQbHVnaW4oKSkpIHsKICAgICAgICAgICAgc3VwZXIu\nc2VyaWFsaXplU2VxdWVuY2UobWV0YSk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiVGJsR2Vu\nID0gYWRkQW5ub3RhdGlvbihUYWJsZUdlbmVyYXRvci5jbGFzcywgbWV0YSk7\nCiAgICAgICAgU2VxdWVuY2VNYXBwaW5nIHNlcSA9IChTZXF1ZW5jZU1hcHBp\nbmcpIG1ldGE7CiAgICAgICAgYWJUYmxHZW4uYWRkKCJuYW1lIiwgc2VxLmdl\ndE5hbWUoKSk7CiAgICAgICAgU3RyaW5nIHRhYmxlID0gc2VxLmdldFRhYmxl\nKCk7CiAgICAgICAgaWYgKHRhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAg\naW50IGRvdElkeCA9IHRhYmxlLmluZGV4T2YoJy4nKTsKICAgICAgICAgICAg\naWYgKGRvdElkeCA9PSAtMSkKICAgICAgICAgICAgICAgIGFiVGJsR2VuLmFk\nZCgidGFibGUiLCB0YWJsZSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAg\nICAgICAgICAgYWJUYmxHZW4uYWRkKCJ0YWJsZSIsIHRhYmxlLnN1YnN0cmlu\nZyhkb3RJZHggKyAxKSk7CiAgICAgICAgICAgICAgICBhYlRibEdlbi5hZGQo\nInNjaGVtYSIsIHRhYmxlLnN1YnN0cmluZygwLCBkb3RJZHgpKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlz\nRW1wdHkoc2VxLmdldFByaW1hcnlLZXlDb2x1bW4oKSkpCiAgICAgICAgICAg\nIGFiVGJsR2VuLmFkZCgicGtDb2x1bW5OYW1lIiwgc2VxLmdldFByaW1hcnlL\nZXlDb2x1bW4oKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKHNlcS5nZXRTZXF1ZW5jZUNvbHVtbigpKSkKICAgICAgICAgICAgYWJUYmxH\nZW4uYWRkKCJ2YWx1ZUNvbHVtbk5hbWUiLCBzZXEuZ2V0U2VxdWVuY2VDb2x1\nbW4oKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KHNlcS5n\nZXRQcmltYXJ5S2V5VmFsdWUoKSkpCiAgICAgICAgICAgIGFiVGJsR2VuLmFk\nZCgicGtDb2x1bW5WYWx1ZSIsIHNlcS5nZXRQcmltYXJ5S2V5VmFsdWUoKSk7\nCiAgICAgICAgaWYgKHNlcS5nZXRBbGxvY2F0ZSgpICE9IDUwICYmIHNlcS5n\nZXRBbGxvY2F0ZSgpICE9IC0xKQogICAgICAgICAgICBhYlRibEdlbi5hZGQo\nImFsbG9jYXRpb25TaXplIiwgc2VxLmdldEFsbG9jYXRlKCkgKyAiIik7CiAg\nICAgICAgaWYgKHNlcS5nZXRJbml0aWFsVmFsdWUoKSAhPSAwICYmIHNlcS5n\nZXRJbml0aWFsVmFsdWUoKSAhPSAtMSkKICAgICAgICAgICAgYWJUYmxHZW4u\nYWRkKCJpbml0aWFsVmFsdWUiLCBzZXEuZ2V0SW5pdGlhbFZhbHVlKCkgKyAi\nIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb2x1bW4gdHlwZXMgc2VyaWFs\naXplZCB1bmRlciBkaWZmZXJlbnQgbmFtZXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGVudW0gQ29sVHlwZSB7CgogICAgICAgIENPTCwKICAgICAg\nICBKT0lOLAogICAgICAgIElOVkVSU0UsCiAgICAgICAgUEtfSk9JTiwKICAg\nICAgICBESVNDOwoKICAgICAgICBwcml2YXRlIENsYXNzPD8gZXh0ZW5kcyBB\nbm5vdGF0aW9uPiBnZXRDb2x1bW5Bbm5vdGF0aW9uVHlwZSgpIHsKICAgICAg\nICAgICAgc3dpdGNoKHRoaXMpIHsKICAgICAgICAgICAgICAgIGNhc2UgQ09M\nOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBqYXZheC5wZXJzaXN0ZW5j\nZS5Db2x1bW4uY2xhc3M7CiAgICAgICAgICAgICAgICBjYXNlIEpPSU46CiAg\nICAgICAgICAgICAgICBjYXNlIElOVkVSU0U6CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIEpvaW5Db2x1bW4uY2xhc3M7CiAgICAgICAgICAgICAgICBj\nYXNlIFBLX0pPSU46CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByaW1h\ncnlLZXlKb2luQ29sdW1uLmNsYXNzOwogICAgICAgICAgICAgICAgY2FzZSBE\nSVNDOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBEaXNjcmltaW5hdG9y\nQ29sdW1uLmNsYXNzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBDbGFzczw/IGV4\ndGVuZHMgQW5ub3RhdGlvbj4gZ2V0Q29sdW1uR3JvdXBBbm5vdGF0aW9uVHlw\nZSgpIHsKICAgICAgICAgICAgc3dpdGNoKHRoaXMpIHsKICAgICAgICAgICAg\nICAgIGNhc2UgSk9JTjoKICAgICAgICAgICAgICAgIGNhc2UgSU5WRVJTRToK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gSm9pbkNvbHVtbnMuY2xhc3M7\nCiAgICAgICAgICAgICAgICBjYXNlIFBLX0pPSU46CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIFByaW1hcnlLZXlKb2luQ29sdW1ucy5jbGFzczsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9\nCgogICAgfQoKICAgIC8qKgogICAgICogRXh0ZW5kcyB7QGxpbmsgU2VyaWFs\naXphdGlvbkNvbXBhcmF0b3J9IGZvciBzdG9yZS1zcGVjaWZpYyB0YWdzIHN1\nY2gKICAgICAqIGFzICZsdDtzcWwtcmVzdWx0LXNldC1tYXBwaW5nJmd0Oy4K\nICAgICAqCiAgICAgKiBAYXV0aG9yIFBpbmFraSBQb2RkYXIKICAgICAqLwog\nICAgcHJvdGVjdGVkIGNsYXNzIE1hcHBpbmdTZXJpYWxpemF0aW9uQ29tcGFy\nYXRvcgogICAgICAgIGV4dGVuZHMgU2VyaWFsaXphdGlvbkNvbXBhcmF0b3Ig\newoKICAgICAgICBwcm90ZWN0ZWQgaW50IGNvbXBhcmVVbmtub3duKE9iamVj\ndCBvMSwgT2JqZWN0IG8yKSB7CiAgICAgICAgICAgIGlmICghKG8xIGluc3Rh\nbmNlb2YgUXVlcnlSZXN1bHRNYXBwaW5nKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5jb21wYXJlVW5rbm93bihvMSwgbzIpOwoKICAgICAgICAg\nICAgUXVlcnlSZXN1bHRNYXBwaW5nIHJlczEgPSAoUXVlcnlSZXN1bHRNYXBw\naW5nKSBvMTsKICAgICAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nIHJlczIg\nPSAoUXVlcnlSZXN1bHRNYXBwaW5nKSBvMjsKCiAgICAgICAgICAgIC8vIHN5\nc3RlbSBzY29wZSBiZWZvcmUgY2xhc3Mgc2NvcGUKICAgICAgICAgICAgT2Jq\nZWN0IHNjb3BlMSA9IHJlczEuZ2V0U291cmNlU2NvcGUoKTsKICAgICAgICAg\nICAgT2JqZWN0IHNjb3BlMiA9IHJlczIuZ2V0U291cmNlU2NvcGUoKTsKICAg\nICAgICAgICAgaWYgKHNjb3BlMSA9PSBudWxsICYmIHNjb3BlMiAhPSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBpZiAo\nc2NvcGUxICE9IG51bGwgJiYgc2NvcGUyID09IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gMTsKCiAgICAgICAgICAgIC8vIGNvbXBhcmUgb24gbGlz\ndGluZyBpbmRleCwgb3IgaWYgbm9uZS9zYW1lLCB1c2UgbmFtZQogICAgICAg\nICAgICBpbnQgbGlzdGluZ0luZGV4MSA9IHJlczEuZ2V0TGlzdGluZ0luZGV4\nKCk7CiAgICAgICAgICAgIGludCBsaXN0aW5nSW5kZXgyID0gcmVzMi5nZXRM\naXN0aW5nSW5kZXgoKTsKICAgICAgICAgICAgaWYgKGxpc3RpbmdJbmRleDEg\nIT0gbGlzdGluZ0luZGV4MikKICAgICAgICAgICAgICAgIHJldHVybiBsaXN0\naW5nSW5kZXgxIC0gbGlzdGluZ0luZGV4MjsKICAgICAgICAgICAgcmV0dXJu\nIHJlczEuZ2V0TmFtZSAoKS5jb21wYXJlVG8gKHJlczIuZ2V0TmFtZSAoKSk7\nCgkJfQoJfQp9Cg==\n","encoding":"base64"}

