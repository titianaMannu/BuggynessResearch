{"sha":"65783e93457d13af197dcae4b132088c3bdd23f7","node_id":"MDQ6QmxvYjIwNjM2NDo2NTc4M2U5MzQ1N2QxM2FmMTk3ZGNhZTRiMTMyMDg4YzNiZGQyM2Y3","size":26211,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/65783e93457d13af197dcae4b132088c3bdd23f7","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYzsK\nCmltcG9ydCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5FbnVtTWFw\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFw\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW51bVR5cGU7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5UZW1wb3JhbFR5cGU7CgppbXBvcnQgb3JnLmFw\nYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcueG1s\nLnNheC5TQVhFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZ0luZm87Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkRpc2NyaW1pbmF0\nb3JNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5NYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuTWFwcGluZ1JlcG9zaXRvcnk7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlF1ZXJ5UmVzdWx0TWFwcGluZzsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuU2VxdWVuY2VN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5W\nYWx1ZU1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuRW51bVZhbHVlSGFuZGxlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkZsYXRDbGFzc1N0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuRnVsbENsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5WZXJ0aWNhbENsYXNzU3RyYXRlZ3k7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25h\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBl\nczsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRh\nRGF0YU1vZGVzLk1PREVfTUFQUElORzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuUGVyc2lzdGVuY2VTdHJhdGVn\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5YTUxQ\nZXJzaXN0ZW5jZU1ldGFEYXRhU2VyaWFsaXplcjsKaW1wb3J0IHNlcnAudXRp\nbC5TdHJpbmdzOwoKLyoqCiAqIFNlcmlhbGl6ZXMgcGVyc2lzdGVuY2UgbWFw\ncGluZyB0byBYTUwuCiAqCiAqIEBzaW5jZSAwLjQuMAogKiBAYXV0aG9yIFN0\nZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgWE1MUGVy\nc2lzdGVuY2VNYXBwaW5nU2VyaWFsaXplcgogICAgZXh0ZW5kcyBYTUxQZXJz\naXN0ZW5jZU1ldGFEYXRhU2VyaWFsaXplciB7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IFRZUEVfUkVTVUxUTUFQID0gVFlQRV9RVUVSWSArIDE7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwPENvbFR5cGUsIFN0cmlu\nZz4gX25hbWVzOwoKICAgIHN0YXRpYyB7CiAgICAgICAgX25hbWVzID0gbmV3\nIEVudW1NYXA8Q29sVHlwZSwgU3RyaW5nPihDb2xUeXBlLmNsYXNzKTsKICAg\nICAgICBfbmFtZXMucHV0KENvbFR5cGUuQ09MLCAiY29sdW1uIik7CiAgICAg\nICAgX25hbWVzLnB1dChDb2xUeXBlLkpPSU4sICJqb2luLWNvbHVtbiIpOwog\nICAgICAgIF9uYW1lcy5wdXQoQ29sVHlwZS5JTlZFUlNFLCAiaW52ZXJzZS1q\nb2luLWNvbHVtbiIpOwogICAgICAgIF9uYW1lcy5wdXQoQ29sVHlwZS5QS19K\nT0lOLCAicHJpbWFyeS1rZXktam9pbi1jb2x1bW4iKTsKICAgICAgICBfbmFt\nZXMucHV0KENvbFR5cGUuRElTQywgImRpc2NyaW1pbmF0b3ItY29sdW1uIik7\nCiAgICB9CgogICAgcHJpdmF0ZSBMaXN0PFF1ZXJ5UmVzdWx0TWFwcGluZz4g\nX3Jlc3VsdHMgPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9zeW5jID0g\nZmFsc2U7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNv\nbmZpZ3VyYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBYTUxQZXJzaXN0ZW5j\nZU1hcHBpbmdTZXJpYWxpemVyKEpEQkNDb25maWd1cmF0aW9uIGNvbmYpIHsK\nICAgICAgICBzdXBlcihjb25mKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgdG8gYXV0b21hdGljYWxseSBzeW5jaHJvbml6ZSBtYXBwaW5nIGlu\nZm8gd2l0aCBkYXRhIGF2YWlsYWJsZQogICAgICogZnJvbSBtYXBwZWQgY29t\ncG9uZW50cyBiZWZvcmUgc2VyaWFsaXphdGlvbi4gRGVmYXVsdHMgdG8gZmFs\nc2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFN5bmNNYXBwaW5n\nSW5mbygpIHsKICAgICAgICByZXR1cm4gX3N5bmM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRvIGF1dG9tYXRpY2FsbHkgc3luY2hyb25pemUg\nbWFwcGluZyBpbmZvIHdpdGggZGF0YSBhdmFpbGFibGUKICAgICAqIGZyb20g\nbWFwcGVkIGNvbXBvbmVudHMgYmVmb3JlIHNlcmlhbGl6YXRpb24uIERlZmF1\nbHRzIHRvIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTeW5j\nTWFwcGluZ0luZm8oYm9vbGVhbiBzeW5jKSB7CiAgICAgICAgX3N5bmMgPSBz\neW5jOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgZ2l2ZW4gcmVz\ndWx0IHNldCBtYXBwaW5nIHRvIGxvY2FsIGNhY2hlLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBhZGRRdWVyeVJlc3VsdE1hcHBpbmcoUXVlcnlSZXN1bHRN\nYXBwaW5nIG1ldGEpIHsKICAgICAgICBpZiAoX3Jlc3VsdHMgPT0gbnVsbCkK\nICAgICAgICAgICAgX3Jlc3VsdHMgPSBuZXcgQXJyYXlMaXN0PFF1ZXJ5UmVz\ndWx0TWFwcGluZz4oKTsKICAgICAgICBfcmVzdWx0cy5hZGQobWV0YSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmVzIGdpdmVuIHJlc3VsdCBzZXQg\nbWFwcGluZyBmcm9tIHRoZSBsb2NhbCBjYWNoZS4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gcmVtb3ZlUXVlcnlSZXN1bHRNYXBwaW5nKFF1ZXJ5UmVz\ndWx0TWFwcGluZyBtZXRhKSB7CiAgICAgICAgcmV0dXJuIF9yZXN1bHRzICE9\nIG51bGwgJiYgX3Jlc3VsdHMucmVtb3ZlKG1ldGEpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIHZvaWQgYWRkQWxsKE1ldGFEYXRhUmVwb3Np\ndG9yeSByZXBvcykgewogICAgICAgIHN1cGVyLmFkZEFsbChyZXBvcyk7CiAg\nICAgICAgZm9yIChRdWVyeVJlc3VsdE1hcHBpbmcgcmVzIDogKChNYXBwaW5n\nUmVwb3NpdG9yeSkgcmVwb3MpCiAgICAgICAgICAgIC5nZXRRdWVyeVJlc3Vs\ndE1hcHBpbmdzKCkpCiAgICAgICAgICAgIGFkZFF1ZXJ5UmVzdWx0TWFwcGlu\nZyhyZXMpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGJvb2xl\nYW4gcmVtb3ZlQWxsKE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcykgewogICAg\nICAgIGJvb2xlYW4gcmVtb3ZlZCA9IHN1cGVyLnJlbW92ZUFsbChyZXBvcyk7\nCiAgICAgICAgZm9yIChRdWVyeVJlc3VsdE1hcHBpbmcgcmVzIDogKChNYXBw\naW5nUmVwb3NpdG9yeSkgcmVwb3MpCiAgICAgICAgICAgIC5nZXRRdWVyeVJl\nc3VsdE1hcHBpbmdzKCkpCiAgICAgICAgICAgIHJlbW92ZWQgfD0gcmVtb3Zl\nUXVlcnlSZXN1bHRNYXBwaW5nKHJlcyk7CiAgICAgICAgcmV0dXJuIHJlbW92\nZWQ7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBjbGVh\ncigpIHsKICAgICAgICBzdXBlci5jbGVhcigpOwogICAgICAgIGlmIChfcmVz\ndWx0cyAhPSBudWxsKQogICAgICAgICAgICBfcmVzdWx0cy5jbGVhcigpOwog\nICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFkZENvbW1tZW50cyhPYmplY3Qg\nb2JqKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGlm\nIChpc01hcHBpbmdNb2RlKCkgJiYgIWlzTWV0YURhdGFNb2RlKCkpIHsKICAg\nICAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIENsYXNzTWFwcGluZykKICAg\nICAgICAgICAgICAgIG9iaiA9ICgoQ2xhc3NNYXBwaW5nKSBvYmopLmdldE1h\ncHBpbmdJbmZvKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKG9iaiBpbnN0YW5j\nZW9mIEZpZWxkTWFwcGluZykKICAgICAgICAgICAgICAgIG9iaiA9ICgoRmll\nbGRNYXBwaW5nKSBvYmopLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgfQog\nICAgICAgIHN1cGVyLmFkZENvbW1lbnRzKG9iaik7CiAgICB9CgogICAgQE92\nZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVDbGFzcyhDbGFz\nc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4gYWNjZXNzKQogICAgICAgIHRocm93\ncyBTQVhFeGNlcHRpb24gewogICAgICAgIGlmIChfc3luYyAmJiBpc01hcHBp\nbmdNb2RlKCkgJiYgbWV0YSBpbnN0YW5jZW9mIENsYXNzTWFwcGluZykgewog\nICAgICAgICAgICAvLyBzeW5jIGlmIHJlc29sdmVkIGFuZCBtYXBwZWQKICAg\nICAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IChDbGFzc01hcHBpbmcpIG1l\ndGE7CiAgICAgICAgICAgIGlmICgoY2xzLmdldFJlc29sdmUoKSAmIE1PREVf\nTUFQUElORykgIT0gMCAmJiBjbHMuaXNNYXBwZWQoKSkgewogICAgICAgICAg\nICAgICAgY2xzLnN5bmNNYXBwaW5nSW5mbygpOwogICAgICAgICAgICAgICAg\nY2xzLmdldERpc2NyaW1pbmF0b3IoKS5zeW5jTWFwcGluZ0luZm8oKTsKICAg\nICAgICAgICAgICAgIGNscy5nZXRWZXJzaW9uKCkuc3luY01hcHBpbmdJbmZv\nKCk7CiAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmdbXSBmaWVsZHM7CiAg\nICAgICAgICAgICAgICBpZiAoY2xzLmdldEVtYmVkZGluZ01ldGFEYXRhKCkg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBjbHMuZ2V0\nRGVmaW5lZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBjbHMuZ2V0RmllbGRNYXBw\naW5ncygpOwogICAgICAgICAgICAgICAgZm9yIChGaWVsZE1hcHBpbmcgZiA6\nIGZpZWxkcykKICAgICAgICAgICAgICAgICAgICBmLnN5bmNNYXBwaW5nSW5m\nbygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN1cGVyLnNl\ncmlhbGl6ZUNsYXNzKG1ldGEsIGFjY2Vzcyk7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVDbGFzc01hcHBpbmdD\nb250ZW50KENsYXNzTWV0YURhdGEgbWFwcGluZykKICAgICAgICB0aHJvd3Mg\nU0FYRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0gKENs\nYXNzTWFwcGluZykgbWFwcGluZzsKICAgICAgICBDbGFzc01hcHBpbmdJbmZv\nIGluZm8gPSBjbHMuZ2V0TWFwcGluZ0luZm8oKTsKICAgICAgICBzZXJpYWxp\nemVUYWJsZShpbmZvLmdldFRhYmxlTmFtZSgpLCAidGFibGUiLCBTdHJpbmdz\nCiAgICAgICAgICAgIC5nZXRDbGFzc05hbWUobWFwcGluZy5nZXREZXNjcmli\nZWRUeXBlKCkpLCBudWxsLCAKICAgICAgICAgICAgaW5mby5nZXRVbmlxdWVz\nKGluZm8uZ2V0VGFibGVOYW1lKCkpKTsKICAgICAgICBmb3IgKFN0cmluZyBz\nZWNvbmQgOiBpbmZvLmdldFNlY29uZGFyeVRhYmxlTmFtZXMoKSkKICAgICAg\nICAgICAgc2VyaWFsaXplVGFibGUoc2Vjb25kLCAic2Vjb25kYXJ5LXRhYmxl\nIiwgbnVsbCwgaW5mbywgaW5mby5nZXRVbmlxdWVzKHNlY29uZCkpOwogICAg\nICAgIHNlcmlhbGl6ZUNvbHVtbnMoaW5mbywgQ29sVHlwZS5QS19KT0lOLCBu\ndWxsKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lk\nIHNlcmlhbGl6ZUluaGVyaXRhbmNlQ29udGVudChDbGFzc01ldGFEYXRhIG1h\ncHBpbmcpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAg\nQ2xhc3NNYXBwaW5nIGNscyA9IChDbGFzc01hcHBpbmcpIG1hcHBpbmc7CiAg\nICAgICAgQ2xhc3NNYXBwaW5nSW5mbyBpbmZvID0gY2xzLmdldE1hcHBpbmdJ\nbmZvKCk7CiAgICAgICAgRGlzY3JpbWluYXRvck1hcHBpbmdJbmZvIGRpbmZv\nID0gY2xzLmdldERpc2NyaW1pbmF0b3IoKQogICAgICAgICAgICAuZ2V0TWFw\ncGluZ0luZm8oKTsKICAgICAgICBTdHJpbmcgc3RyYXQgPSBpbmZvLmdldEhp\nZXJhcmNoeVN0cmF0ZWd5KCk7CiAgICAgICAgaWYgKEZsYXRDbGFzc1N0cmF0\nZWd5LkFMSUFTLmVxdWFscyhzdHJhdCkpCiAgICAgICAgICAgIGFkZEF0dHJp\nYnV0ZSgic3RyYXRlZ3kiLCAiU0lOR0xFX1RBQkxFIik7CiAgICAgICAgZWxz\nZSBpZiAoVmVydGljYWxDbGFzc1N0cmF0ZWd5LkFMSUFTLmVxdWFscyhzdHJh\ndCkpCiAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgic3RyYXRlZ3kiLCAiSk9J\nTkVEIik7CiAgICAgICAgZWxzZSBpZiAoRnVsbENsYXNzU3RyYXRlZ3kuQUxJ\nQVMuZXF1YWxzKHN0cmF0KSkKICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJz\ndHJhdGVneSIsICJUQUJMRV9QRVJfQ0xBU1MiKTsKICAgICAgICBpZiAoc3Ry\nYXQgIT0gbnVsbCkgewogICAgICAgICAgICBzdGFydEVsZW1lbnQoImluaGVy\naXRhbmNlIik7CiAgICAgICAgICAgIGVuZEVsZW1lbnQoImluaGVyaXRhbmNl\nIik7CiAgICAgICAgfQogICAgICAgIGlmIChkaW5mby5nZXRWYWx1ZSgpICE9\nIG51bGwpIHsKICAgICAgICAgICAgc3RhcnRFbGVtZW50KCJkaXNjcmltaW5h\ndG9yLXZhbHVlIik7CiAgICAgICAgICAgIGFkZFRleHQoZGluZm8uZ2V0VmFs\ndWUoKSk7CiAgICAgICAgICAgIGVuZEVsZW1lbnQoImRpc2NyaW1pbmF0b3It\ndmFsdWUiKTsKICAgICAgICB9CiAgICAgICAgc2VyaWFsaXplQ29sdW1ucyhk\naW5mbywgQ29sVHlwZS5ESVNDLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNlcmlhbGl6ZSB0YWJsZSBvcHRpb25hbGx5IGxpc3RpbmcgcHJpbWFy\neS1rZXktam9pbnMgc3RvcmVkCiAgICAgKiBpbiB0aGUgZ2l2ZW4ge0BsaW5r\nIENsYXNzTWFwcGluZ0luZm99LgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nc2VyaWFsaXplVGFibGUoU3RyaW5nIHRhYmxlLCBTdHJpbmcgZWxlbWVudE5h\nbWUsCiAgICAgICAgU3RyaW5nIGRlZmF1bHROYW1lLCBDbGFzc01hcHBpbmdJ\nbmZvIHNlY29uZGFyeUluZm8sIFVuaXF1ZVtdIHVuaXF1ZXMpCiAgICAgICAg\ndGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgTGlzdDxDb2x1bW4+IGNv\nbHMgPSBudWxsOwogICAgICAgIGlmIChzZWNvbmRhcnlJbmZvICE9IG51bGwp\nCiAgICAgICAgICAgIGNvbHMgPSAoTGlzdDxDb2x1bW4+KSBzZWNvbmRhcnlJ\nbmZvLmdldFNlY29uZGFyeVRhYmxlSm9pbkNvbHVtbnMKICAgICAgICAgICAg\nICAgICh0YWJsZSk7CgogICAgICAgIGJvb2xlYW4gcHJpbnQgPSAoY29scyAh\nPSBudWxsICYmIGNvbHMuc2l6ZSgpID4gMCkgfHwgCiAgICAgICAgICAgICh1\nbmlxdWVzICE9IG51bGwgJiYgdW5pcXVlcy5sZW5ndGggPiAwKTsKICAgICAg\nICBpZiAodGFibGUgIT0gbnVsbAogICAgICAgICAgICAmJiAoZGVmYXVsdE5h\nbWUgPT0gbnVsbCB8fCAhZGVmYXVsdE5hbWUuZXF1YWxzKHRhYmxlKSkpIHsK\nICAgICAgICAgICAgcHJpbnQgPSB0cnVlOwogICAgICAgICAgICBpbnQgaW5k\nZXggPSB0YWJsZS5pbmRleE9mKCcuJyk7CiAgICAgICAgICAgIGlmIChpbmRl\neCA8IDApCiAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoIm5hbWUiLCB0\nYWJsZSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgYWRk\nQXR0cmlidXRlKCJzY2hlbWEiLCB0YWJsZS5zdWJzdHJpbmcoMCwgaW5kZXgp\nKTsKICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgibmFtZSIsIHRhYmxl\nLnN1YnN0cmluZyhpbmRleCArIDEpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBpZiAocHJpbnQpIHsKICAgICAgICAgICAgc3RhcnRFbGVt\nZW50KGVsZW1lbnROYW1lKTsKICAgICAgICAgICAgaWYgKGNvbHMgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgZm9yIChDb2x1bW4gY29sIDogY29scykK\nICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVDb2x1bW4oY29sLCBDb2xU\neXBlLlBLX0pPSU4sIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAodW5pcXVlcyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nZm9yIChVbmlxdWUgdW5pcXVlOiB1bmlxdWVzKQogICAgICAgICAgICAgICAg\nICAgIHNlcmlhbGl6ZVVuaXF1ZUNvbnN0cmFpbnQodW5pcXVlKTsKICAgICAg\nICAgICAgZW5kRWxlbWVudChlbGVtZW50TmFtZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIGJvb2xlYW4gc2VyaWFs\naXplQXR0cmlidXRlT3ZlcnJpZGUoRmllbGRNZXRhRGF0YSBmbWQsCiAgICAg\nICAgRmllbGRNZXRhRGF0YSBvcmlnKSB7CiAgICAgICAgaWYgKG9yaWcgPT0g\nbnVsbCB8fCBmbWQgPT0gb3JpZykKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoKICAgICAgICBGaWVsZE1hcHBpbmcgZmllbGQgPSAoRmllbGRNYXBwaW5n\nKSBmbWQ7CiAgICAgICAgRmllbGRNYXBwaW5nIGZpZWxkMiA9IChGaWVsZE1h\ncHBpbmcpIG9yaWc7CiAgICAgICAgaWYgKGZpZWxkLmdldE1hcHBpbmdJbmZv\nKCkuaGFzU2NoZW1hQ29tcG9uZW50cygpCiAgICAgICAgICAgIHx8IGZpZWxk\nMi5nZXRNYXBwaW5nSW5mbygpLmhhc1NjaGVtYUNvbXBvbmVudHMoKSkKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIFZhbHVlTWFwcGluZ0lu\nZm8gaW5mbyA9IGZpZWxkLmdldFZhbHVlSW5mbygpOwogICAgICAgIExpc3Q8\nQ29sdW1uPiBjb2xzID0gKExpc3Q8Q29sdW1uPikgaW5mby5nZXRDb2x1bW5z\nKCk7CiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xzLnNpemUoKSA9\nPSAwKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgVmFsdWVN\nYXBwaW5nSW5mbyBpbmZvMiA9IGZpZWxkMi5nZXRWYWx1ZUluZm8oKTsKICAg\nICAgICBMaXN0PENvbHVtbj4gY29sczIgPSAoTGlzdDxDb2x1bW4+KSBpbmZv\nMi5nZXRDb2x1bW5zKCk7CiAgICAgICAgaWYgKGNvbHMyID09IG51bGwgfHwg\nY29sczIuc2l6ZSgpICE9IGNvbHMuc2l6ZSgpKQogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICBpZiAoY29scy5zaXplKCkgIT0gMSkKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIENvbHVtbiBjb2w7CiAgICAg\nICAgQ29sdW1uIGNvbDI7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBj\nb2xzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIGNvbCA9IGNvbHMuZ2V0\nKGkpOwogICAgICAgICAgICBjb2wyID0gY29sczIuZ2V0KGkpOwogICAgICAg\nICAgICBpZiAoIVN0cmluZ1V0aWxzLmVxdWFscyhjb2wuZ2V0TmFtZSgpLCBj\nb2wyLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5lcXVhbHMoY29sLmdldFR5\ncGVOYW1lKCksIGNvbDIuZ2V0VHlwZU5hbWUoKSkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKGNvbC5nZXRTaXplKCkg\nIT0gY29sMi5nZXRTaXplKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICAgICAgaWYgKGNvbC5nZXREZWNpbWFsRGlnaXRzKCkgIT0g\nY29sMi5nZXREZWNpbWFsRGlnaXRzKCkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKGNvbC5nZXRGbGFnKENvbHVtbi5G\nTEFHX1VOSU5TRVJUQUJMRSkKICAgICAgICAgICAgICAgICE9IGNvbDIuZ2V0\nRmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChjb2wuZ2V0RmxhZyhD\nb2x1bW4uRkxBR19VTlVQREFUQUJMRSkKICAgICAgICAgICAgICAgICE9IGNv\nbDIuZ2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZv\naWQgc2VyaWFsaXplQXR0cmlidXRlT3ZlcnJpZGVNYXBwaW5nQ29udGVudChG\naWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBGaWVsZE1ldGFEYXRhIG9yaWcp\nCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgRmllbGRN\nYXBwaW5nIGZtID0gKEZpZWxkTWFwcGluZykgZm1kOwogICAgICAgIHNlcmlh\nbGl6ZUNvbHVtbnMoZm0uZ2V0VmFsdWVJbmZvKCksIENvbFR5cGUuQ09MLCBm\nbS5nZXRNYXBwaW5nSW5mbygpCiAgICAgICAgICAgIC5nZXRUYWJsZU5hbWUo\nKSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgUGVyc2lz\ndGVuY2VTdHJhdGVneSBnZXRTdHJhdGVneShGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgIFBlcnNpc3RlbmNlU3RyYXRlZ3kgc3RyYXQgPSBzdXBlci5n\nZXRTdHJhdGVneShmbWQpOwogICAgICAgIEZpZWxkTWFwcGluZyBmaWVsZCA9\nIChGaWVsZE1hcHBpbmcpIGZtZDsKICAgICAgICBzd2l0Y2ggKHN0cmF0KSB7\nCiAgICAgICAgICAgIGNhc2UgTUFOWV9NQU5ZOgogICAgICAgICAgICAgICAg\nLy8gd2UgY2FuIGRpZmZlcmVudGlhdGUgYSBvbmUtbWFueSBieSB0aGUgZmFj\ndCB0aGF0IHRoZXJlIGlzIG5vCiAgICAgICAgICAgICAgICAvLyBzZWNvbmRh\ncnkgdGFibGUgam9pbiwgb3IgdGhlIGZrIGlzIHVuaXF1ZQogICAgICAgICAg\nICAgICAgaWYgKGZpZWxkLmdldE1hcHBlZEJ5KCkgPT0gbnVsbAogICAgICAg\nICAgICAgICAgICAgICYmIChmaWVsZC5nZXRNYXBwaW5nSW5mbygpLmdldEpv\naW5EaXJlY3Rpb24oKQogICAgICAgICAgICAgICAgICAgID09IE1hcHBpbmdJ\nbmZvLkpPSU5fTk9ORQogICAgICAgICAgICAgICAgICAgIHx8IGZpZWxkLmdl\ndEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuZ2V0VW5pcXVlKCkK\nICAgICAgICAgICAgICAgICAgICAhPSBudWxsKSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5PTkVfTUFOWTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIE1BTllfT05F\nOgogICAgICAgICAgICAgICAgLy8gaW52ZXJzZSBqb2luIGNvbHMgb3IgdW5p\ncXVlIGZrPwogICAgICAgICAgICAgICAgaWYgKGZpZWxkLmdldFZhbHVlSW5m\nbygpLmdldEpvaW5EaXJlY3Rpb24oKQogICAgICAgICAgICAgICAgICAgID09\nIE1hcHBpbmdJbmZvLkpPSU5fSU5WRVJTRQogICAgICAgICAgICAgICAgICAg\nIHx8IGZpZWxkLmdldFZhbHVlSW5mbygpLmdldFVuaXF1ZSgpICE9IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRl\nZ3kuT05FX09ORTsKCiAgICAgICAgICAgICAgICAvLyBzY2FuIGZvciBwcmlt\nYXJ5LWtleS1qb2luLWNvbHVtbgogICAgICAgICAgICAgICAgTGlzdDxDb2x1\nbW4+IGNvbHMgPSBmaWVsZC5nZXRWYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCk7\nCiAgICAgICAgICAgICAgICBib29sZWFuIHBrSm9pbiA9IGNvbHMgIT0gbnVs\nbCAmJiBjb2xzLnNpemUoKSA+IDA7CiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgcGtKb2luICYmIGkgPCBjb2xzLnNpemUoKTsgaSsrKQogICAg\nICAgICAgICAgICAgICAgIHBrSm9pbiA9IGNvbHMuZ2V0KGkpLmdldEZsYWco\nQ29sdW1uLkZMQUdfUEtfSk9JTik7CiAgICAgICAgICAgICAgICBpZiAocGtK\nb2luKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVN0\ncmF0ZWd5Lk9ORV9PTkU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHN0cmF0OwogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplRmllbGRNYXBwaW5nQ29u\ndGVudChGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBQZXJzaXN0ZW5jZVN0\ncmF0ZWd5IHN0cmF0ZWd5KQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24g\newogICAgICAgIGlmIChmbWQuZ2V0TWFwcGVkQnkoKSAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHdoaWxlIEknZCBsaWtlIHRv\nIGRvIGF1dG8gZGV0ZWN0aW9uIGJhc2VkIG9uIGpvaW4gZGlyZWN0aW9ucywg\nZXRjLgogICAgICAgIC8vIHRoZSBkaXN0aW5ndWlzaGVkIGNvbHVtbiAvIHRh\nYmxlIC8gZXRjIG5hbWVzIGZvcmNlcyBvdXIgaGFuZAogICAgICAgIC8vIGVz\ncCBmb3IgT3BlbkpQQSBjdXN0b20gbWFwcGluZ3MuCiAgICAgICAgRmllbGRN\nYXBwaW5nIGZpZWxkID0gKEZpZWxkTWFwcGluZykgZm1kOwogICAgICAgIHN3\naXRjaCAoc3RyYXRlZ3kpIHsKICAgICAgICAgICAgY2FzZSBPTkVfT05FOgog\nICAgICAgICAgICBjYXNlIE1BTllfT05FOgogICAgICAgICAgICAgICAgc2Vy\naWFsaXplQ29sdW1ucyhmaWVsZC5nZXRWYWx1ZUluZm8oKSwgQ29sVHlwZS5K\nT0lOLAogICAgICAgICAgICAgICAgICAgIGZpZWxkLmdldE1hcHBpbmdJbmZv\nKCkuZ2V0VGFibGVOYW1lKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICBjYXNlIE9ORV9NQU5ZOgogICAgICAgICAgICAgICAgaWYg\nKGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0Sm9pbkRpcmVjdGlvbigpID09\nCiAgICAgICAgICAgICAgICAgICAgTWFwcGluZ0luZm8uSk9JTl9OT05FKSB7\nCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplQ29sdW1ucyhmaWVsZC5n\nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLAogICAgICAgICAg\nICAgICAgICAgICAgICBDb2xUeXBlLkpPSU4sIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIC8vIGVsc2Ugbm8gYnJlYWsKICAgICAgICAgICAgY2FzZSBNQU5Z\nX01BTlk6CiAgICAgICAgICAgICAgICBpZiAoZmllbGQuZ2V0TWFwcGluZ0lu\nZm8oKS5oYXNTY2hlbWFDb21wb25lbnRzKCkKICAgICAgICAgICAgICAgICAg\nICB8fCBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygp\nCiAgICAgICAgICAgICAgICAgICAgLmhhc1NjaGVtYUNvbXBvbmVudHMoKSkg\newogICAgICAgICAgICAgICAgICAgIFN0cmluZyB0YWJsZSA9IGZpZWxkLmdl\ndE1hcHBpbmdJbmZvKCkuZ2V0VGFibGVOYW1lKCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHRhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgaW50IGluZGV4ID0gdGFibGUuaW5kZXhPZignLicpOwogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJuYW1lIiwgdGFibGUpOwog\nICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgic2NoZW1hIiwgdGFibGUuc3Vi\nc3RyaW5nKDAsIGluZGV4KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBhZGRBdHRyaWJ1dGUoIm5hbWUiLCB0YWJsZS5zdWJzdHJpbmcoaW5kZXgg\nKyAxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc3RhcnRFbGVtZW50KCJq\nb2luLXRhYmxlIik7CiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplQ29s\ndW1ucyhmaWVsZC5nZXRNYXBwaW5nSW5mbygpLCBDb2xUeXBlLkpPSU4sCiAg\nICAgICAgICAgICAgICAgICAgICAgIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIHNlcmlhbGl6ZUNvbHVtbnMoZmllbGQuZ2V0RWxlbWVudE1hcHBpbmco\nKS5nZXRWYWx1ZUluZm8oKSwKICAgICAgICAgICAgICAgICAgICAgICAgQ29s\nVHlwZS5JTlZFUlNFLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBlbmRF\nbGVtZW50KCJqb2luLXRhYmxlIik7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBzZXJpYWxp\nemVDb2x1bW5zKGZpZWxkLmdldFZhbHVlSW5mbygpLCBDb2xUeXBlLkNPTCwK\nICAgICAgICAgICAgZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5nZXRUYWJsZU5h\nbWUoKSk7CiAgICAgICAgaWYgKHN0cmF0ZWd5ID09IFBlcnNpc3RlbmNlU3Ry\nYXRlZ3kuQkFTSUMgJiYgaXNMb2IoZmllbGQpKSB7CiAgICAgICAgICAgIHN0\nYXJ0RWxlbWVudCgibG9iIik7CiAgICAgICAgICAgIGVuZEVsZW1lbnQoImxv\nYiIpOwogICAgICAgIH0KICAgICAgICBUZW1wb3JhbFR5cGUgdGVtcG9yYWwg\nPSBnZXRUZW1wb3JhbChmaWVsZCk7CiAgICAgICAgaWYgKHRlbXBvcmFsICE9\nIG51bGwpIHsKICAgICAgICAgICAgc3RhcnRFbGVtZW50KCJ0ZW1wb3JhbCIp\nOwogICAgICAgICAgICBhZGRUZXh0KHRlbXBvcmFsLnRvU3RyaW5nKCkpOwog\nICAgICAgICAgICBlbmRFbGVtZW50KCJ0ZW1wb3JhbCIpOwogICAgICAgIH0K\nCiAgICAgICAgRW51bVR5cGUgZW51bVR5cGUgPSBnZXRFbnVtVHlwZShmaWVs\nZCk7CiAgICAgICAgaWYgKGVudW1UeXBlICE9IG51bGwgJiYgZW51bVR5cGUg\nIT0gRW51bVR5cGUuT1JESU5BTCkgewogICAgICAgICAgICBzdGFydEVsZW1l\nbnQoImVudW1lcmF0ZWQiKTsKICAgICAgICAgICAgYWRkVGV4dChlbnVtVHlw\nZS50b1N0cmluZygpKTsKICAgICAgICAgICAgZW5kRWxlbWVudCgiZW51bWVy\nYXRlZCIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERldGVy\nbWluZSBpZiB0aGUgZmllbGQgaXMgYSBsb2IuCiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiBpc0xvYihGaWVsZE1hcHBpbmcgZmllbGQpIHsKICAgICAg\nICBmb3IgKENvbHVtbiBjb2wgOiAoTGlzdDxDb2x1bW4+KSBmaWVsZC5nZXRW\nYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCkpCiAgICAgICAgICAgIGlmIChjb2wu\nZ2V0VHlwZSgpID09IFR5cGVzLkJMT0IgfHwgY29sLmdldFR5cGUoKSA9PSBU\neXBlcy5DTE9CKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGZpZWxkJ3MgdGVtcG9yYWwgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBU\nZW1wb3JhbFR5cGUgZ2V0VGVtcG9yYWwoRmllbGRNYXBwaW5nIGZpZWxkKSB7\nCiAgICAgICAgaWYgKGZpZWxkLmdldERlY2xhcmVkVHlwZUNvZGUoKSAhPSBK\nYXZhVHlwZXMuREFURQogICAgICAgICAgICAmJiBmaWVsZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLkNBTEVOREFSKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSAo\nKEpEQkNDb25maWd1cmF0aW9uKSBnZXRDb25maWd1cmF0aW9uKCkpCiAgICAg\nICAgICAgIC5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAgIGlu\ndCBkZWYgPSBkaWN0LmdldEpEQkNUeXBlKGZpZWxkLmdldFR5cGVDb2RlKCks\nIGZhbHNlKTsKICAgICAgICBmb3IgKENvbHVtbiBjb2wgOiAoTGlzdDxDb2x1\nbW4+KSBmaWVsZC5nZXRWYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCkpIHsKICAg\nICAgICAgICAgaWYgKGNvbC5nZXRUeXBlKCkgPT0gZGVmKQogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIHN3aXRjaCAoY29sLmdldFR5\ncGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBUeXBlcy5EQVRFOgogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBUZW1wb3JhbFR5cGUuREFURTsKICAg\nICAgICAgICAgICAgIGNhc2UgVHlwZXMuVElNRToKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gVGVtcG9yYWxUeXBlLlRJTUU7CiAgICAgICAgICAgICAg\nICBjYXNlIFR5cGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gVGVtcG9yYWxUeXBlLlRJTUVTVEFNUDsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBlbnVtIHR5cGUgZm9yIHRoZSBmaWVsZC4KICAgICAq\nLwogICAgcHJvdGVjdGVkIEVudW1UeXBlIGdldEVudW1UeXBlKEZpZWxkTWFw\ncGluZyBmaWVsZCkgewogICAgICAgIGlmIChmaWVsZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkgIT0gSmF2YVR5cGVzLk9CSkVDVCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgaWYgKCEoZmllbGQuZ2V0SGFuZGxlcigpIGlu\nc3RhbmNlb2YgRW51bVZhbHVlSGFuZGxlcikpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIHJldHVybiAoKEVudW1WYWx1ZUhhbmRsZXIpIGZp\nZWxkLmdldEhhbmRsZXIoKSkuZ2V0U3RvcmVPcmRpbmFsKCkKICAgICAgICAg\nICAgPyBFbnVtVHlwZS5PUkRJTkFMIDogRW51bVR5cGUuU1RSSU5HOwogICAg\nfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIHRoZSBjb2x1bW5zIGluIHRo\nZSBnaXZlbiBtYXBwaW5nIGluZm8uCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBzZXJpYWxpemVDb2x1bW5zKE1hcHBpbmdJbmZvIGluZm8sIENvbFR5cGUg\ndHlwZSwKICAgICAgICBTdHJpbmcgc2Vjb25kYXJ5KQogICAgICAgIHRocm93\ncyBTQVhFeGNlcHRpb24gewogICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0g\nKExpc3Q8Q29sdW1uPikgaW5mby5nZXRDb2x1bW5zKCk7CiAgICAgICAgaWYg\nKGNvbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGZv\nciAoQ29sdW1uIGNvbCA6IGNvbHMpCiAgICAgICAgICAgIHNlcmlhbGl6ZUNv\nbHVtbihjb2wsIHR5cGUsIHNlY29uZGFyeSwgaW5mby5nZXRVbmlxdWUoKSAh\nPSBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBhIHNp\nbmdsZSBjb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXJpYWxp\nemVDb2x1bW4oQ29sdW1uIGNvbCwgQ29sVHlwZSB0eXBlLCBTdHJpbmcgc2Vj\nb25kYXJ5LAogICAgICAgIGJvb2xlYW4gdW5pcXVlKQogICAgICAgIHRocm93\ncyBTQVhFeGNlcHRpb24gewogICAgICAgIGlmIChjb2wuZ2V0TmFtZSgpICE9\nIG51bGwpCiAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgibmFtZSIsIGNvbC5n\nZXROYW1lKCkpOwogICAgICAgIGlmIChjb2wuZ2V0VHlwZU5hbWUoKSAhPSBu\ndWxsKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImNvbHVtbi1kZWZpbml0\naW9uIiwgY29sLmdldFR5cGVOYW1lKCkpOwogICAgICAgIGlmIChjb2wuZ2V0\nVGFyZ2V0KCkgIT0gbnVsbAogICAgICAgICAgICAmJiAodHlwZSA9PSBDb2xU\neXBlLkpPSU4gfHwgdHlwZSA9PSBDb2xUeXBlLklOVkVSU0UKICAgICAgICAg\nICAgfHwgdHlwZSA9PSBDb2xUeXBlLlBLX0pPSU4pKQogICAgICAgICAgICBh\nZGRBdHRyaWJ1dGUoInJlZmVyZW5jZWQtY29sdW1uLW5hbWUiLCBjb2wuZ2V0\nVGFyZ2V0KCkpOwogICAgICAgIGlmICh0eXBlID09IENvbFR5cGUuQ09MIHx8\nIHR5cGUgPT0gQ29sVHlwZS5KT0lOCiAgICAgICAgICAgIHx8IHR5cGUgPT0g\nQ29sVHlwZS5QS19KT0lOKSB7CiAgICAgICAgICAgIGlmICh1bmlxdWUpCiAg\nICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoInVuaXF1ZSIsICJ0cnVlIik7\nCiAgICAgICAgICAgIGlmIChjb2wuaXNOb3ROdWxsKCkpCiAgICAgICAgICAg\nICAgICBhZGRBdHRyaWJ1dGUoIm51bGxhYmxlIiwgImZhbHNlIik7CiAgICAg\nICAgICAgIGlmIChjb2wuZ2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFC\nTEUpKQogICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJpbnNlcnRhYmxl\nIiwgImZhbHNlIik7CiAgICAgICAgICAgIGlmIChjb2wuZ2V0RmxhZyhDb2x1\nbW4uRkxBR19VTlVQREFUQUJMRSkpCiAgICAgICAgICAgICAgICBhZGRBdHRy\naWJ1dGUoInVwZGF0YWJsZSIsICJmYWxzZSIpOwogICAgICAgICAgICBpZiAo\nc2Vjb25kYXJ5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1\ndGUoInRhYmxlIiwgc2Vjb25kYXJ5KTsKCiAgICAgICAgICAgIGlmICh0eXBl\nID09IENvbFR5cGUuQ09MKSB7CiAgICAgICAgICAgICAgICBpZiAoY29sLmdl\ndFNpemUoKSA+IDAgJiYgY29sLmdldFNpemUoKSAhPSAyNTUpCiAgICAgICAg\nICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJsZW5ndGgiLCBjb2wuZ2V0U2l6\nZSgpICsgIiIpOwogICAgICAgICAgICAgICAgaWYgKGNvbC5nZXREZWNpbWFs\nRGlnaXRzKCkgIT0gMCkKICAgICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1\ndGUoInNjYWxlIiwgY29sLmdldERlY2ltYWxEaWdpdHMoKSArICIiKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodHlwZSAhPSBDb2xU\neXBlLkNPTCB8fCBnZXRBdHRyaWJ1dGVzKCkuZ2V0TGVuZ3RoKCkgPiAwKSB7\nCiAgICAgICAgICAgIFN0cmluZyBuYW1lID0gY29sLmdldEZsYWcoQ29sdW1u\nLkZMQUdfUEtfSk9JTikgPyBfbmFtZXMKICAgICAgICAgICAgICAgIC5nZXQo\nQ29sVHlwZS5QS19KT0lOKSA6IF9uYW1lcy5nZXQodHlwZSk7CiAgICAgICAg\nICAgIHN0YXJ0RWxlbWVudChuYW1lKTsKICAgICAgICAgICAgZW5kRWxlbWVu\ndChuYW1lKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHNl\ncmlhbGl6ZVVuaXF1ZUNvbnN0cmFpbnQoVW5pcXVlIHVuaXF1ZSkgdGhyb3dz\nIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgc3RhcnRFbGVtZW50KCJ1bmlxdWUt\nY29uc3RyYWludCIpOwogICAgICAgIENvbHVtbltdIGNvbHVtbnMgPSB1bmlx\ndWUuZ2V0Q29sdW1ucygpOwogICAgICAgIGZvciAoQ29sdW1uIGNvbHVtbjpj\nb2x1bW5zKSB7CiAgICAgICAgICAgIHN0YXJ0RWxlbWVudCgiY29sdW1uLW5h\nbWUiKTsKICAgICAgICAgICAgYWRkVGV4dChjb2x1bW4uZ2V0TmFtZSgpKTsK\nICAgICAgICAgICAgZW5kRWxlbWVudCgiY29sdW1uLW5hbWUiKTsKICAgICAg\nICB9CiAgICAgICAgZW5kRWxlbWVudCgidW5pcXVlLWNvbnN0cmFpbnQiKTsK\nICAgIH0KICAgIAogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgU2VyaWFs\naXphdGlvbkNvbXBhcmF0b3IgbmV3U2VyaWFsaXphdGlvbkNvbXBhcmF0b3Io\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBNYXBwaW5nU2VyaWFsaXphdGlvbkNv\nbXBhcmF0b3IoKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3Rl\nZCB2b2lkIGFkZFN5c3RlbU1hcHBpbmdFbGVtZW50cyhDb2xsZWN0aW9uIHRv\nU2VyaWFsaXplKSB7CiAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkpCiAgICAg\nICAgICAgIHRvU2VyaWFsaXplLmFkZEFsbChnZXRRdWVyeVJlc3VsdE1hcHBp\nbmdzKG51bGwpKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3Rl\nZCBpbnQgdHlwZShPYmplY3QgbykgewogICAgICAgIGludCB0eXBlID0gc3Vw\nZXIudHlwZShvKTsKICAgICAgICBpZiAodHlwZSA9PSAtMSAmJiBvIGluc3Rh\nbmNlb2YgUXVlcnlSZXN1bHRNYXBwaW5nKQogICAgICAgICAgICByZXR1cm4g\nVFlQRV9SRVNVTFRNQVA7CiAgICAgICAgcmV0dXJuIHR5cGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJlc3VsdCBzZXQgbWFwcGluZ3Mg\nZm9yIHRoZSBnaXZlbiBzY29wZS4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0\nPFF1ZXJ5UmVzdWx0TWFwcGluZz4gZ2V0UXVlcnlSZXN1bHRNYXBwaW5ncyhD\nbGFzc01ldGFEYXRhIGNtKSB7CiAgICAgICAgaWYgKF9yZXN1bHRzID09IG51\nbGwgfHwgX3Jlc3VsdHMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4g\nKExpc3Q8UXVlcnlSZXN1bHRNYXBwaW5nPikgQ29sbGVjdGlvbnMuRU1QVFlf\nTElTVDsKCiAgICAgICAgTGlzdDxRdWVyeVJlc3VsdE1hcHBpbmc+IHJlc3Vs\ndCA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfcmVzdWx0\ncy5zaXplKCk7IGkrKykgewogICAgICAgICAgICBRdWVyeVJlc3VsdE1hcHBp\nbmcgZWxlbWVudCA9IF9yZXN1bHRzLmdldChpKTsKICAgICAgICAgICAgaWYg\nKChjbSA9PSBudWxsICYmIGVsZW1lbnQuZ2V0U291cmNlU2NvcGUoKSAhPSBu\ndWxsKSB8fCAoY20gIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgZWxlbWVu\ndC5nZXRTb3VyY2VTY29wZSgpICE9IGNtLmdldERlc2NyaWJlZFR5cGUoKSkp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChy\nZXN1bHQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBB\ncnJheUxpc3Q8UXVlcnlSZXN1bHRNYXBwaW5nPihfcmVzdWx0cy5zaXplKCkg\nLSBpKTsKICAgICAgICAgICAgcmVzdWx0LmFkZChlbGVtZW50KTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIChyZXN1bHQgPT0gbnVsbCkKICAgICAgICAg\nICAgPyAoTGlzdDxRdWVyeVJlc3VsdE1hcHBpbmc+KSBDb2xsZWN0aW9ucy5F\nTVBUWV9MSVNUIDogcmVzdWx0OwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplU3lzdGVtTWFwcGluZ0VsZW1lbnQo\nT2JqZWN0IG9iaikKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAob2JqIGluc3RhbmNlb2YgUXVlcnlSZXN1bHRNYXBwaW5nKQog\nICAgICAgICAgICBzZXJpYWxpemVRdWVyeVJlc3VsdE1hcHBpbmcoKFF1ZXJ5\nUmVzdWx0TWFwcGluZykgb2JqKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZVF1ZXJ5TWFwcGluZ3MoQ2xhc3NN\nZXRhRGF0YSBtZXRhKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewog\nICAgICAgIGZvciAoUXVlcnlSZXN1bHRNYXBwaW5nIHJlcyA6IGdldFF1ZXJ5\nUmVzdWx0TWFwcGluZ3MobWV0YSkpCiAgICAgICAgICAgIHNlcmlhbGl6ZVF1\nZXJ5UmVzdWx0TWFwcGluZyhyZXMpOwogICAgfQoKICAgIC8qKgogICAgICog\nU2VyaWFsaXplIGdpdmVuIHJlc3VsdCBzZXQgbWFwcGluZy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZVF1ZXJ5UmVzdWx0TWFwcGluZyhR\ndWVyeVJlc3VsdE1hcHBpbmcgbWV0YSkKICAgICAgICB0aHJvd3MgU0FYRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoIWdldFNlcmlhbGl6ZUFubm90YXRpb25z\nKCkKICAgICAgICAgICAgJiYgbWV0YS5nZXRTb3VyY2VUeXBlKCkgPT0gbWV0\nYS5TUkNfQU5OT1RBVElPTlMpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgYWRkQXR0cmlidXRlKCJuYW1lIiwgbWV0YS5nZXROYW1lKCkpOwogICAg\nICAgIHN0YXJ0RWxlbWVudCgic3FsLXJlc3VsdC1zZXQtbWFwcGluZyIpOwog\nICAgICAgIGZvciAoUXVlcnlSZXN1bHRNYXBwaW5nLlBDUmVzdWx0IHBjIDog\nbWV0YS5nZXRQQ1Jlc3VsdHMoKSkgewogICAgICAgICAgICBhZGRBdHRyaWJ1\ndGUoImVudGl0eS1jbGFzcyIsIHBjLmdldENhbmRpZGF0ZVR5cGUoKS5nZXRO\nYW1lKCkpOwogICAgICAgICAgICBPYmplY3QgZGlzY3JpbSA9IHBjLmdldE1h\ncHBpbmcocGMuRElTQ1JJTUlOQVRPUik7CiAgICAgICAgICAgIGlmIChkaXNj\ncmltICE9IG51bGwpCiAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImRp\nc2NyaW1pbmF0b3ItY29sdW1uIiwgZGlzY3JpbS50b1N0cmluZygpKTsKCiAg\nICAgICAgICAgIHN0YXJ0RWxlbWVudCgiZW50aXR5LXJlc3VsdCIpOwogICAg\nICAgICAgICBmb3IgKFN0cmluZyBwYXRoIDogcGMuZ2V0TWFwcGluZ1BhdGhz\nKCkpIHsKICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgibmFtZSIsIHBh\ndGgpOwogICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJjb2x1bW4iLCBw\nYy5nZXRNYXBwaW5nKHBhdGgpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAg\nICAgc3RhcnRFbGVtZW50KCJmaWVsZC1yZXN1bHQiKTsKICAgICAgICAgICAg\nICAgIGVuZEVsZW1lbnQoImZpZWxkLXJlc3VsdCIpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGVuZEVsZW1lbnQoImVudGl0eS1yZXN1bHQiKTsKICAg\nICAgICB9CiAgICAgICAgZm9yIChPYmplY3QgY29sIDogbWV0YS5nZXRDb2x1\nbW5SZXN1bHRzKCkpIHsKICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJuYW1l\nIiwgY29sLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBzdGFydEVsZW1lbnQo\nImNvbHVtbi1yZXN1bHQiKTsKICAgICAgICAgICAgZW5kRWxlbWVudCgiY29s\ndW1uLXJlc3VsdCIpOwogICAgICAgIH0KICAgICAgICBlbmRFbGVtZW50KCJz\ncWwtcmVzdWx0LXNldC1tYXBwaW5nIik7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVTZXF1ZW5jZShTZXF1ZW5j\nZU1ldGFEYXRhIG1ldGEpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKCFnZXRTZXJpYWxpemVBbm5vdGF0aW9ucygpCiAgICAg\nICAgICAgICYmIG1ldGEuZ2V0U291cmNlVHlwZSgpID09IG1ldGEuU1JDX0FO\nTk9UQVRJT05TKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKFNl\ncXVlbmNlTWFwcGluZy5JTVBMX1ZBTFVFX1RBQkxFLmVxdWFscyhtZXRhLmdl\ndFNlcXVlbmNlUGx1Z2luKCkpKSB7CiAgICAgICAgICAgIHN1cGVyLnNlcmlh\nbGl6ZVNlcXVlbmNlKG1ldGEpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICBTZXF1ZW5jZU1hcHBpbmcgc2VxID0gKFNlcXVlbmNl\nTWFwcGluZykgbWV0YTsKICAgICAgICBhZGRBdHRyaWJ1dGUoIm5hbWUiLCBz\nZXEuZ2V0TmFtZSgpKTsKICAgICAgICBTdHJpbmcgdGFibGUgPSBzZXEuZ2V0\nVGFibGUoKTsKICAgICAgICBpZiAodGFibGUgIT0gbnVsbCkgewogICAgICAg\nICAgICBpbnQgZG90SWR4ID0gdGFibGUuaW5kZXhPZignLicpOwogICAgICAg\nICAgICBpZiAoZG90SWR4ID09IC0xKQogICAgICAgICAgICAgICAgYWRkQXR0\ncmlidXRlKCJ0YWJsZSIsIHRhYmxlKTsKICAgICAgICAgICAgZWxzZSB7CiAg\nICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoInRhYmxlIiwgdGFibGUuc3Vi\nc3RyaW5nKGRvdElkeCArIDEpKTsKICAgICAgICAgICAgICAgIGFkZEF0dHJp\nYnV0ZSgic2NoZW1hIiwgdGFibGUuc3Vic3RyaW5nKDAsIGRvdElkeCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eShzZXEuZ2V0UHJpbWFyeUtleUNvbHVtbigpKSkKICAgICAg\nICAgICAgYWRkQXR0cmlidXRlKCJway1jb2x1bW4tbmFtZSIsIHNlcS5nZXRQ\ncmltYXJ5S2V5Q29sdW1uKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMu\naXNFbXB0eShzZXEuZ2V0U2VxdWVuY2VDb2x1bW4oKSkpCiAgICAgICAgICAg\nIGFkZEF0dHJpYnV0ZSgidmFsdWUtY29sdW1uLW5hbWUiLCBzZXEuZ2V0U2Vx\ndWVuY2VDb2x1bW4oKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0Vt\ncHR5KHNlcS5nZXRQcmltYXJ5S2V5VmFsdWUoKSkpCiAgICAgICAgICAgIGFk\nZEF0dHJpYnV0ZSgicGstY29sdW1uLXZhbHVlIiwgc2VxLmdldFByaW1hcnlL\nZXlWYWx1ZSgpKTsKICAgICAgICBpZiAoc2VxLmdldEFsbG9jYXRlKCkgIT0g\nNTAgJiYgc2VxLmdldEFsbG9jYXRlKCkgIT0gLTEpCiAgICAgICAgICAgIGFk\nZEF0dHJpYnV0ZSgiYWxsb2NhdGlvbi1zaXplIiwgc2VxLmdldEFsbG9jYXRl\nKCkgKyAiIik7CiAgICAgICAgaWYgKHNlcS5nZXRJbml0aWFsVmFsdWUoKSAh\nPSAwICYmIHNlcS5nZXRJbml0aWFsVmFsdWUoKSAhPSAtMSkKICAgICAgICAg\nICAgYWRkQXR0cmlidXRlKCJpbml0aWFsLXZhbHVlIiwgc2VxLmdldEluaXRp\nYWxWYWx1ZSgpICsgIiIpOwogICAgICAgIHN0YXJ0RWxlbWVudCgidGFibGUt\nZ2VuZXJhdG9yIik7CiAgICAgICAgZW5kRWxlbWVudCgidGFibGUtZ2VuZXJh\ndG9yIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb2x1bW4gdHlwZXMgc2Vy\naWFsaXplZCB1bmRlciBkaWZmZXJlbnQgbmFtZXMuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIGVudW0gQ29sVHlwZSB7CgogICAgICAgIENPTCwKICAg\nICAgICBKT0lOLAogICAgICAgIElOVkVSU0UsCiAgICAgICAgUEtfSk9JTiwK\nICAgICAgICBESVNDCiAgICB9CgogICAgLyoqCiAgICAgKiBFeHRlbmRzIHtA\nbGluayBTZXJpYWxpemF0aW9uQ29tcGFyYXRvcn0gZm9yIHN0b3JlLXNwZWNp\nZmljIHRhZ3Mgc3VjaAogICAgICogYXMgJmx0O3NxbC1yZXN1bHQtc2V0LW1h\ncHBpbmcmZ3Q7LgogICAgICoKICAgICAqIEBhdXRob3IgUGluYWtpIFBvZGRh\ncgogICAgICovCiAgICBwcm90ZWN0ZWQgY2xhc3MgTWFwcGluZ1NlcmlhbGl6\nYXRpb25Db21wYXJhdG9yCiAgICAgICAgZXh0ZW5kcyBTZXJpYWxpemF0aW9u\nQ29tcGFyYXRvciB7CgogICAgICAgIHByb3RlY3RlZCBpbnQgY29tcGFyZVVu\na25vd24oT2JqZWN0IG8xLCBPYmplY3QgbzIpIHsKICAgICAgICAgICAgaWYg\nKCEobzEgaW5zdGFuY2VvZiBRdWVyeVJlc3VsdE1hcHBpbmcpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLmNvbXBhcmVVbmtub3duKG8xLCBvMik7\nCgogICAgICAgICAgICBRdWVyeVJlc3VsdE1hcHBpbmcgcmVzMSA9IChRdWVy\neVJlc3VsdE1hcHBpbmcpIG8xOwogICAgICAgICAgICBRdWVyeVJlc3VsdE1h\ncHBpbmcgcmVzMiA9IChRdWVyeVJlc3VsdE1hcHBpbmcpIG8yOwoKICAgICAg\nICAgICAgLy8gc3lzdGVtIHNjb3BlIGJlZm9yZSBjbGFzcyBzY29wZQogICAg\nICAgICAgICBPYmplY3Qgc2NvcGUxID0gcmVzMS5nZXRTb3VyY2VTY29wZSgp\nOwogICAgICAgICAgICBPYmplY3Qgc2NvcGUyID0gcmVzMi5nZXRTb3VyY2VT\nY29wZSgpOwogICAgICAgICAgICBpZiAoc2NvcGUxID09IG51bGwgJiYgc2Nv\ncGUyICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAg\nICAgICAgIGlmIChzY29wZTEgIT0gbnVsbCAmJiBzY29wZTIgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiAxOwoKICAgICAgICAgICAgLy8gY29t\ncGFyZSBvbiBsaXN0aW5nIGluZGV4LCBvciBpZiBub25lL3NhbWUsIHVzZSBu\nYW1lCiAgICAgICAgICAgIGludCBsaXN0aW5nSW5kZXgxID0gcmVzMS5nZXRM\naXN0aW5nSW5kZXgoKTsKICAgICAgICAgICAgaW50IGxpc3RpbmdJbmRleDIg\nPSByZXMyLmdldExpc3RpbmdJbmRleCgpOwogICAgICAgICAgICBpZiAobGlz\ndGluZ0luZGV4MSAhPSBsaXN0aW5nSW5kZXgyKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGxpc3RpbmdJbmRleDEgLSBsaXN0aW5nSW5kZXgyOwogICAgICAg\nICAgICByZXR1cm4gcmVzMS5nZXROYW1lICgpLmNvbXBhcmVUbyAocmVzMi5n\nZXROYW1lICgpKTsKCQl9Cgl9Cn0K\n","encoding":"base64"}

